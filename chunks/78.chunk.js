"use strict";(self.i6szn8jgzh=self.i6szn8jgzh||[]).push([[78],{15023:(b,n,i)=>{i.r(n),i.d(n,{AnimationGroup:()=>u,TargetedAnimation:()=>O});var e=i(12301),V=i(11612),Q=i(11646),U=i(11813),Y=i(13451),L=i(11778);class B{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(b,n,i,V){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._coreRuntimeAnimation=null,this._animation=n,this._target=b,this._scene=i,this._host=V,this._activeTargets=[],n._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===e.c.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=L.Matrix.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const b={frame:0,value:this._minValue};this._keys.splice(0,0,b)}if(this._target instanceof Array){let b=0;for(const n of this._target)this._preparePath(n,b),this._getOriginalValues(b),b++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const Q=n.getEvents();if(Q&&Q.length>0)for(const e of Q)this._events.push(e._clone());this._enableBlending=b&&b.animationPropertiesOverride?b.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const i=this._animation.targetPropertyPath;if(i.length>1){let e=b;for(let b=0;b<i.length-1;b++){const n=i[b];if(e=e[n],void 0===e)throw new Error(`Invalid property (${n}) in property path (${i.join(".")})`)}this._targetPath=i[i.length-1],this._activeTargets[n]=e}else this._targetPath=i[0],this._activeTargets[n]=b;if(void 0===this._activeTargets[n][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${i.join(".")})`)}get animation(){return this._animation}reset(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])if(this._target instanceof Array){let b=0;for(const n of this._target)void 0!==this._originalValue[b]&&this._setValue(n,this._activeTargets[b],this._originalValue[b],-1,b),b++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let b=0;b<this._events.length;b++)this._events[b].isDone=!1}isStopped(){return this._stopped}dispose(){const b=this._animation.runtimeAnimations.indexOf(this);b>-1&&this._animation.runtimeAnimations.splice(b,1)}setValue(b,n){if(this._targetIsArray)for(let i=0;i<this._target.length;i++){const e=this._target[i];this._setValue(e,this._activeTargets[i],b,n,i)}else this._setValue(this._target,this._directTarget,b,n,0)}_getOriginalValues(){let b,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const i=this._activeTargets[n];b=i.getLocalMatrix&&"_matrix"===this._targetPath?i.getLocalMatrix():i[this._targetPath],b&&b.clone?this._originalValue[n]=b.clone():this._originalValue[n]=b}_registerTargetForLateAnimationBinding(b,n){const i=b.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(i),i._lateAnimationHolders||(i._lateAnimationHolders={}),i._lateAnimationHolders[b.targetPath]||(i._lateAnimationHolders[b.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:n}),b.isAdditive?(i._lateAnimationHolders[b.targetPath].additiveAnimations.push(b),i._lateAnimationHolders[b.targetPath].totalAdditiveWeight+=b.weight):(i._lateAnimationHolders[b.targetPath].animations.push(b),i._lateAnimationHolders[b.targetPath].totalWeight+=b.weight)}_setValue(b,n,i,V,Q){if(this._currentActiveTarget=n,this._weight=V,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const b=n[this._targetPath];b.clone?this._originalBlendValue=b.clone():this._originalBlendValue=b}this._originalBlendValue.m?e.c.AllowMatrixDecomposeForInterpolation?this._currentValue?L.Matrix.DecomposeLerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=L.Matrix.DecomposeLerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue?L.Matrix.LerpToRef(this._originalBlendValue,i,this._blendingFactor,this._currentValue):this._currentValue=L.Matrix.Lerp(this._originalBlendValue,i,this._blendingFactor):this._currentValue=e.c._UniversalLerp(this._originalBlendValue,i,this._blendingFactor);const V=b&&b.animationPropertiesOverride?b.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=V}else this._currentValue?this._currentValue.L?this._currentValue.L(i):this._currentValue=i:null!==i&&void 0!==i&&i.clone?this._currentValue=i.clone():this._currentValue=i;-1!==V?this._registerTargetForLateAnimationBinding(this,this._originalValue[Q]):this._animationState.loopMode===e.c.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[Q],n[this._targetPath]):n[this._targetPath]=this._originalValue[Q]+this._currentValue:n[this._targetPath]=this._currentValue,b.WB&&b.WB(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const i=this._animation.getKeys();b<i[0].frame?b=i[0].frame:b>i[i.length-1].frame&&(b=i[i.length-1].frame);const e=this._events;if(e.length)for(let Q=0;Q<e.length;Q++)e[Q].onlyOnce||(e[Q].isDone=e[Q].frame<b);this._currentFrame=b;const V=this._animation._interpolate(b,this._animationState);this.setValue(V,n)}_prepareForSpeedRatioChange(b){const n=this._previousElapsedTime*(this._animation.framePerSecond*b)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-n}animate(b,n,i,V,Q){let U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;const Y=this._animation,L=Y.targetPropertyPath;if(!L||L.length<1)return this._stopped=!0,!1;let B,mb=!0;const N=this._events;let Z=0;if(this._coreRuntimeAnimation)Z=i-n,B=this._coreRuntimeAnimation.currentFrame,this._currentFrame=B,this._animationState.repeatCount=this._coreRuntimeAnimation._animationState.repeatCount,this._animationState.highLimitValue=this._coreRuntimeAnimation._animationState.highLimitValue,this._animationState.offsetValue=this._coreRuntimeAnimation._animationState.offsetValue;else{let U;(n<this._minFrame||n>this._maxFrame)&&(n=this._minFrame),(i<this._minFrame||i>this._maxFrame)&&(i=this._maxFrame),Z=i-n;let L=b*(Y.framePerSecond*Q)/1e3+this._absoluteFrameOffset,T=0,z=!1;const K=V&&this._animationState.loopMode===e.c.ANIMATIONLOOPMODE_YOYO;if(K){const b=(L-n)/Z,i=Math.sin(b*Math.PI);L=Math.abs(i)*Z+n;const e=i>=0?1:-1;this._yoyoDirection!==e&&(z=!0),this._yoyoDirection=e}if(this._previousElapsedTime=b,this._previousAbsoluteFrame=L,!V&&i>=n&&(L>=Z&&Q>0||L<=0&&Q<0))mb=!1,T=Y._getKeyValue(this._maxValue);else if(!V&&n>=i&&(L<=Z&&Q<0||L>=0&&Q>0))mb=!1,T=Y._getKeyValue(this._minValue);else if(this._animationState.loopMode!==e.c.ANIMATIONLOOPMODE_CYCLE){const b=i.toString()+n.toString();if(!this._offsetsCache[b]){this._animationState.repeatCount=0,this._animationState.loopMode=e.c.ANIMATIONLOOPMODE_CYCLE;const V=Y._interpolate(n,this._animationState),Q=Y._interpolate(i,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),Y.dataType){case e.c.ANIMATIONTYPE_FLOAT:this._offsetsCache[b]=Q-V;break;case e.c.ANIMATIONTYPE_QUATERNION:case e.c.ANIMATIONTYPE_VECTOR3:case e.c.ANIMATIONTYPE_VECTOR2:case e.c.ANIMATIONTYPE_SIZE:case e.c.ANIMATIONTYPE_COLOR3:this._offsetsCache[b]=Q.un(V)}this._highLimitsCache[b]=Q}T=this._highLimitsCache[b],U=this._offsetsCache[b]}if(void 0===U)switch(Y.dataType){case e.c.ANIMATIONTYPE_FLOAT:U=0;break;case e.c.ANIMATIONTYPE_QUATERNION:U=e.i;break;case e.c.ANIMATIONTYPE_VECTOR3:U=e.o;break;case e.c.ANIMATIONTYPE_VECTOR2:U=e.l;break;case e.c.ANIMATIONTYPE_SIZE:U=e.k;break;case e.c.ANIMATIONTYPE_COLOR3:U=e.d;break;case e.c.ANIMATIONTYPE_COLOR4:U=e.h}if(this._host&&this._host.syncRoot){const b=this._host.syncRoot;B=n+Z*((b.masterFrame-b.fromFrame)/(b.toFrame-b.fromFrame))}else B=L>0&&n>i||L<0&&n<i?mb&&0!==Z?i+L%Z:n:mb&&0!==Z?n+L%Z:i;if(!K&&(Q>0&&this.currentFrame>B||Q<0&&this.currentFrame<B)||K&&z){this._onLoop();for(let b=0;b<N.length;b++)N[b].onlyOnce||(N[b].isDone=!1);this._animationState.key=Q>0?0:Y.getKeys().length-1}this._currentFrame=B,this._animationState.repeatCount=0===Z?0:L/Z|0,this._animationState.highLimitValue=T,this._animationState.offsetValue=U}const T=Y._interpolate(B,this._animationState);if(this.setValue(T,U),N.length)for(let e=0;e<N.length;e++)if(Z>=0&&B>=N[e].frame&&N[e].frame>=n||Z<0&&B<=N[e].frame&&N[e].frame<=n){const b=N[e];b.isDone||(b.onlyOnce&&(N.splice(e,1),e--),b.isDone=!0,b.action(B))}return mb||(this._stopped=!0),mb}}var mb=i(11628);class N{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(b){this._weight=-1!==b?Math.min(Math.max(b,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(b){for(let n=0;n<this._runtimeAnimations.length;n++){this._runtimeAnimations[n]._prepareForSpeedRatioChange(b)}this._speedRatio=b,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,Y=arguments.length>6?arguments[6]:void 0,L=arguments.length>7?arguments[7]:void 0,B=arguments.length>8?arguments[8]:void 0,mb=arguments.length>9&&void 0!==arguments[9]&&arguments[9],N=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;this.target=n,this.fromFrame=i,this.toFrame=e,this.loopAnimation=Q,this.onAnimationEnd=Y,this.onAnimationLoop=B,this.isAdditive=mb,this.playOrder=N,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this.KY=!1,this._speedRatio=1,this._weight=-1,this._previousWeight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new V.e,this.onAnimationLoopObservable=new V.e,this._scene=b,L&&this.appendAnimations(n,L),this._speedRatio=U,b._activeAnimatables.push(this)}syncWith(b){if(this._syncRoot=b,b){const b=this._scene._activeAnimatables.indexOf(this);b>-1&&(this._scene._activeAnimatables.splice(b,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(b,n){for(let i=0;i<n.length;i++){const e=n[i],V=new B(b,e,this._scene,this);V._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(V)}}getAnimationByTargetProperty(b){const n=this._runtimeAnimations;for(let i=0;i<n.length;i++)if(n[i].animation.targetProperty===b)return n[i].animation;return null}getRuntimeAnimationByTargetProperty(b){const n=this._runtimeAnimations;for(let i=0;i<n.length;i++)if(n[i].animation.targetProperty===b)return n[i];return null}reset(){const b=this._runtimeAnimations;for(let n=0;n<b.length;n++)b[n].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(b){const n=this._runtimeAnimations;for(let i=0;i<n.length;i++)n[i].animation.enableBlending=!0,n[i].animation.blendingSpeed=b}disableBlending(){const b=this._runtimeAnimations;for(let n=0;n<b.length;n++)b[n].animation.enableBlending=!1}goToFrame(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._runtimeAnimations;if(i[0]){const n=i[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??i[0].currentFrame;const e=0===this.speedRatio?0:(b-this._frameToSyncFromJump)/n*1e3/this.speedRatio;this._manualJumpDelay=-e}for(let e=0;e<i.length;e++)i[e].goToFrame(b,n?this._weight:-1);this._goToFrame=b}get paused(){return this.KY}pause(){this.KY||(this.KY=!0)}restart(){this.KY=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(b||n){const V=this._scene._activeAnimatables.indexOf(this);if(V>-1){const Q=this._runtimeAnimations;for(let i=Q.length-1;i>=0;i--){const e=Q[i];b&&e.animation.name!=b||(n&&!n(e.target)||(e.dispose(),Q.splice(i,1)))}0==Q.length&&(i||this._scene._activeAnimatables.splice(V,1),e||this._raiseOnAnimationEnd())}}else{const b=this._scene._activeAnimatables.indexOf(this);if(b>-1){i||this._scene._activeAnimatables.splice(b,1);const n=this._runtimeAnimations;for(let b=0;b<n.length;b++)n[b].dispose();this._runtimeAnimations.length=0,e||this._raiseOnAnimationEnd()}}}async waitAsync(){return await new Promise((b=>{this.onAnimationEndObservable.add((()=>{b(this)}),void 0,void 0,this,!0)}))}_animate(b){if(this.KY)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=b),!0;if(null===this._localDelayOffset?(this._localDelayOffset=b,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=b-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this.speedRatio<0?-this._manualJumpDelay:this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight&&0===this._previousWeight)return!0;this._previousWeight=this._weight;let n=!1;const i=this._runtimeAnimations;let e;for(e=0;e<i.length;e++){const V=i[e].animate(b-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);n=n||V}if(this.animationStarted=n,!n){if(this.disposeOnEnd)for(e=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(e,1),e=0;e<i.length;e++)i[e].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return n}}function Z(b){if(0===b.totalWeight&&0===b.totalAdditiveWeight)return b.originalValue;let n=1;const i=L.TmpVectors.On[0],e=L.TmpVectors.On[1],V=L.TmpVectors.Quaternion[0];let Q=0;const U=b.animations[0],Y=b.originalValue;let B=1,mb=!1;if(b.totalWeight<1)B=1-b.totalWeight,Y.decompose(e,V,i);else{if(Q=1,n=b.totalWeight,B=U.weight/n,1==B){if(!b.totalAdditiveWeight)return U.currentValue;mb=!0}U.currentValue.decompose(e,V,i)}if(!mb){e.scaleInPlace(B),i.scaleInPlace(B),V.scaleInPlace(B);for(let U=Q;U<b.animations.length;U++){const Q=b.animations[U];if(0===Q.weight)continue;B=Q.weight/n;const Y=L.TmpVectors.On[2],mb=L.TmpVectors.On[3],N=L.TmpVectors.Quaternion[1];Q.currentValue.decompose(mb,N,Y),mb.scaleAndAddToRef(B,e),N.scaleAndAddToRef(L.Quaternion.Dot(V,N)>0?B:-B,V),Y.scaleAndAddToRef(B,i)}V.normalize()}for(let Z=0;Z<b.additiveAnimations.length;Z++){const n=b.additiveAnimations[Z];if(0===n.weight)continue;const Q=L.TmpVectors.On[2],U=L.TmpVectors.On[3],Y=L.TmpVectors.Quaternion[1];n.currentValue.decompose(U,Y,Q),U.multiplyToRef(e,U),L.On.LerpToRef(e,U,n.weight,e),V.multiplyToRef(Y,Y),L.Quaternion.SlerpToRef(V,Y,n.weight,V),Q.scaleAndAddToRef(n.weight,i)}const N=U?U._animationState.workValue:L.TmpVectors.Matrix[0].clone();return L.Matrix.ComposeToRef(e,V,i,N),N}function T(b,n){if(0===b.totalWeight&&0===b.totalAdditiveWeight)return n;const i=b.animations[0],e=b.originalValue;let V=n;if(0===b.totalWeight&&b.totalAdditiveWeight>0)V.L(e);else if(1===b.animations.length){if(L.Quaternion.SlerpToRef(e,i.currentValue,Math.min(1,b.totalWeight),V),0===b.totalAdditiveWeight)return V}else if(b.animations.length>1){let i,Q,U=1;if(b.totalWeight<1){const n=1-b.totalWeight;i=[],Q=[],i.push(e),Q.push(n)}else{if(2===b.animations.length&&(L.Quaternion.SlerpToRef(b.animations[0].currentValue,b.animations[1].currentValue,b.animations[1].weight/b.totalWeight,n),0===b.totalAdditiveWeight))return n;i=[],Q=[],U=b.totalWeight}for(let n=0;n<b.animations.length;n++){const e=b.animations[n];i.push(e.currentValue),Q.push(e.weight/U)}let Y=0;for(let b=0;b<i.length;)b?(Y+=Q[b],L.Quaternion.SlerpToRef(V,i[b],Q[b]/Y,V),b++):(L.Quaternion.SlerpToRef(i[b],i[b+1],Q[b+1]/(Q[b]+Q[b+1]),n),V=n,Y=Q[b]+Q[b+1],b+=2)}for(let Q=0;Q<b.additiveAnimations.length;Q++){const n=b.additiveAnimations[Q];0!==n.weight&&(V.multiplyToRef(n.currentValue,L.TmpVectors.Quaternion[0]),L.Quaternion.SlerpToRef(V,L.TmpVectors.Quaternion[0],n.weight,V))}return V}var z,K,I=i(12005);z=I.b,(K=Y.e)&&(K.prototype.copyAnimationRange=function(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;0===this.animations.length&&(this.animations.push(new e.c(this.name,"_matrix",b.animations[0].framePerSecond,e.c.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const U=b.animations[0].getRange(n);if(!U)return!1;const Y=U.from,L=U.to,B=b.animations[0].getKeys(),mb=b.length,N=b.getParent(),Z=this.getParent(),T=V&&N&&mb&&this.length&&mb!==this.length,z=T&&Z&&N?Z.length/N.length:1,K=V&&!Z&&Q&&(1!==Q.x||1!==Q.y||1!==Q.z),I=this.animations[0].getKeys();let O,u,d;for(let e=0,G=B.length;e<G;e++)O=B[e],O.frame>=Y&&O.frame<=L&&(V?(d=O.value.clone(),T?(u=d.getTranslation(),d.setTranslation(u.scaleInPlace(z))):K&&Q?(u=d.getTranslation(),d.setTranslation(u.multiplyInPlace(Q))):d=O.value):d=O.value,I.push({frame:O.frame+i,value:d}));return this.animations[0].createRange(n,Y+i,L+i),!0}),z&&(z.prototype._animate=function(b){if(!this.animationsEnabled)return;const n=mb.b.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=n}this.deltaTime=void 0!==b?b:this.useConstantAnimationDeltaTime?16:(n-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=n;const i=this._activeAnimatables;if(0===i.length)return;this._animationTime+=this.deltaTime;const V=this._animationTime;for(let e=0;e<i.length;e++){const b=i[e];!b._animate(V)&&b.disposeOnEnd&&e--}!function(b){if(b._registeredForLateAnimationBindings.length){for(let n=0;n<b._registeredForLateAnimationBindings.length;n++){const i=b._registeredForLateAnimationBindings.data[n];for(const b in i._lateAnimationHolders){const n=i._lateAnimationHolders[b],V=n.animations[0],Q=n.originalValue;if(void 0===Q||null===Q)continue;const U=e.c.AllowMatrixDecomposeForInterpolation&&Q.m;let Y=i[b];if(U)Y=Z(n);else if(void 0!==Q.w)Y=T(n,Y||L.Quaternion.Identity());else{let b=0,i=1;const U=V&&V._animationState.loopMode===e.c.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(n.totalWeight<1)Y=U?Q.clone?Q.clone():Q:V&&Q.scale?Q.scale(1-n.totalWeight):V?Q*(1-n.totalWeight):Q.clone?Q.clone():Q;else if(V){i=n.totalWeight;const e=V.weight/i;Y=1!==e?V.currentValue.scale?V.currentValue.scale(e):V.currentValue*e:V.currentValue,U&&(Y.addToRef?Y.addToRef(Q,Y):Y+=Q),b=1}for(let e=b;e<n.animations.length;e++){const b=n.animations[e],V=b.weight/i;V&&(b.currentValue.scaleAndAddToRef?b.currentValue.scaleAndAddToRef(V,Y):Y+=b.currentValue*V)}for(let e=0;e<n.additiveAnimations.length;e++){const b=n.additiveAnimations[e],i=b.weight;i&&(b.currentValue.scaleAndAddToRef?b.currentValue.scaleAndAddToRef(i,Y):Y+=b.currentValue*i)}}i[b]=Y}i._lateAnimationHolders={}}b._registeredForLateAnimationBindings.reset()}}(this)},z.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((b,n)=>b.playOrder-n.playOrder))},z.prototype.beginWeightedAnimation=function(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,V=arguments.length>4?arguments[4]:void 0,Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,U=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7?arguments[7]:void 0,L=arguments.length>8?arguments[8]:void 0,B=arguments.length>9?arguments[9]:void 0,mb=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const N=this.beginAnimation(b,n,i,V,Q,U,Y,!1,L,B,mb);return N.weight=e,N},z.prototype.beginAnimation=function(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,Q=arguments.length>5?arguments[5]:void 0,U=arguments.length>6?arguments[6]:void 0,Y=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],L=arguments.length>8?arguments[8]:void 0,B=arguments.length>9?arguments[9]:void 0,mb=arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(V<0){const b=n;n=i,i=b,V=-V}n>i&&(V=-V),Y&&this.stopAnimation(b,void 0,L),U||(U=new N(this,b,n,i,e,V,Q,void 0,B,mb));const Z=!L||L(b);if(b.animations&&Z&&U.appendAnimations(b,b.animations),b.getAnimatables){const mb=b.getAnimatables();for(let b=0;b<mb.length;b++)this.beginAnimation(mb[b],n,i,e,V,Q,U,Y,L,B)}return U.reset(),U},z.prototype.beginHierarchyAnimation=function(b,n,i,e,V){let Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,U=arguments.length>6?arguments[6]:void 0,Y=arguments.length>7?arguments[7]:void 0,L=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],B=arguments.length>9?arguments[9]:void 0,mb=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const N=b.getDescendants(n),Z=[];Z.push(this.beginAnimation(b,i,e,V,Q,U,Y,L,B,void 0,mb));for(const T of N)Z.push(this.beginAnimation(T,i,e,V,Q,U,Y,L,B,void 0,mb));return Z},z.prototype.beginDirectAnimation=function(b,n,i,e,V){let Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(Q<0){const b=i;i=e,e=b,Q=-Q}return i>e&&(Q=-Q),new N(this,b,i,e,V,Q,arguments.length>6?arguments[6]:void 0,n,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]&&arguments[8])},z.prototype.beginDirectHierarchyAnimation=function(b,n,i,e,V,Q,U,Y,L){let B=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const mb=b.getDescendants(n),N=[];N.push(this.beginDirectAnimation(b,i,e,V,Q,U,Y,L,B));for(const Z of mb)N.push(this.beginDirectAnimation(Z,i,e,V,Q,U,Y,L,B));return N},z.prototype.getAnimatableByTarget=function(b){for(let n=0;n<this._activeAnimatables.length;n++)if(this._activeAnimatables[n].target===b)return this._activeAnimatables[n];return null},z.prototype.getAllAnimatablesByTarget=function(b){const n=[];for(let i=0;i<this._activeAnimatables.length;i++)this._activeAnimatables[i].target===b&&n.push(this._activeAnimatables[i]);return n},z.prototype.stopAnimation=function(b,n,i){const e=this.getAllAnimatablesByTarget(b);for(const V of e)V.stop(n,i)},z.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let b=0;b<this._activeAnimatables.length;b++)this._activeAnimatables[b].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const b of this.animationGroups)b.stop()});class O{getClassName(){return"TargetedAnimation"}serialize(){const b={};return b.animation=this.animation.serialize(),b.targetId=this.target.id,b}}class u{get mask(){return this._mask}set mask(b){this._mask!==b&&(this._mask=b,this.syncWithMask(!0))}syncWithMask(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mask||b){this._numActiveAnimatables=0;for(let b=0;b<this._animatables.length;++b){const n=this._animatables[b];!this.mask||this.mask.disabled||this.mask.retainsTarget(n.target.name)?(this._numActiveAnimatables++,n.paused&&n.restart()):n.paused||n.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let b=0;b<this._animatables.length;++b){const n=this._animatables[b];this.mask.retainsTarget(n.target.name)||(n.stop(),this._animatables.splice(b,1),--b)}for(let b=0;b<this._targetedAnimations.length;b++){const n=this._targetedAnimations[b];this.mask.retainsTarget(n.target.name)||(this._targetedAnimations.splice(b,1),--b)}}}get from(){return this._from}set from(b){if(this._from!==b){this._from=b;for(let b=0;b<this._animatables.length;b++){this._animatables[b].fromFrame=this._from}}}get to(){return this._to}set to(b){if(this._to!==b){this._to=b;for(let b=0;b<this._animatables.length;b++){this._animatables[b].toFrame=this._to}}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(b){if(this._speedRatio!==b){this._speedRatio=b;for(let b=0;b<this._animatables.length;b++){this._animatables[b].speedRatio=this._speedRatio}}}get loopAnimation(){return this._loopAnimation}set loopAnimation(b){if(this._loopAnimation!==b){this._loopAnimation=b;for(let b=0;b<this._animatables.length;b++){this._animatables[b].loopAnimation=this._loopAnimation}}}get isAdditive(){return this._isAdditive}set isAdditive(b){if(this._isAdditive!==b){this._isAdditive=b;for(let b=0;b<this._animatables.length;b++){this._animatables[b].isAdditive=this._isAdditive}}}get weight(){return this._weight}set weight(b){this._weight!==b&&(this._weight=b,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(b){if(this._playOrder!==b&&(this._playOrder=b,this._animatables.length>0)){for(let b=0;b<this._animatables.length;b++)this._animatables[b].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(b){if(this._enableBlending!==b&&(this._enableBlending=b,null!==b))for(let n=0;n<this._targetedAnimations.length;++n)this._targetedAnimations[n].animation.enableBlending=b}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(b){if(this._blendingSpeed!==b&&(this._blendingSpeed=b,null!==b))for(let n=0;n<this._targetedAnimations.length;++n)this._targetedAnimations[n].animation.blendingSpeed=b}getLength(b,n){b=b??this._from;return((n=n??this._to)-b)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}static MergeAnimationGroups(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3?arguments[3]:void 0;if(0===b.length)return null;e=e??b[0].weight;let V=Number.MAX_VALUE,Q=-Number.MAX_VALUE;if(i)for(const Y of b)Y.from<V&&(V=Y.from),Y.to>Q&&(Q=Y.to);const U=new u(b[0].name+"_merged",b[0]._scene,e);for(const Y of b){i&&Y.normalize(V,Q);for(const b of Y.targetedAnimations)U.addTargetedAnimation(b.animation,b.target);n&&Y.dispose()}return U}constructor(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.name=b,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new V.e,this.onAnimationLoopObservable=new V.e,this.onAnimationGroupLoopObservable=new V.e,this.onAnimationGroupEndObservable=new V.e,this.onAnimationGroupPauseObservable=new V.e,this.onAnimationGroupPlayObservable=new V.e,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=n||Q.d.LastCreatedScene,this._weight=i,this._playOrder=e,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(b,n){const i=new O;i.animation=b,i.target=n;const e=b.getKeys();return this._from>e[0].frame&&(this._from=e[0].frame),this._to<e[e.length-1].frame&&(this._to=e[e.length-1].frame),null!==this._enableBlending&&(b.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(b.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(i),this._shouldStart=!0,i}removeTargetedAnimation(b){for(let n=this._targetedAnimations.length-1;n>-1;n--){this._targetedAnimations[n].animation===b&&this._targetedAnimations.splice(n,1)}}normalize(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==b&&(b=this._from),null==n&&(n=this._to);for(let i=0;i<this._targetedAnimations.length;i++){const e=this._targetedAnimations[i].animation.getKeys(),V=e[0],Q=e[e.length-1];if(V.frame>b){const n={frame:b,value:V.value,inTangent:V.inTangent,outTangent:V.outTangent,interpolation:V.interpolation};e.splice(0,0,n)}if(Q.frame<n){const b={frame:n,value:Q.value,inTangent:Q.inTangent,outTangent:Q.outTangent,interpolation:Q.interpolation};e.push(b)}}return this._from=b,this._to=n,this}_processLoop(b,n,i){b.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(n),this._animationLoopFlags[i]||(this._animationLoopFlags[i]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2?arguments[2]:void 0,e=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0;if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=b,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let Q=0;Q<this._targetedAnimations.length;Q++){const U=this._targetedAnimations[Q],Y=this._scene.beginDirectAnimation(U.target,[U.animation],void 0!==i?i:this._from,void 0!==e?e:this._to,b,n,void 0,void 0,void 0!==V?V:this._isAdditive);Y.weight=this._weight,Y.playOrder=this._playOrder,Y.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(U),this._checkAnimationGroupEnded(Y)},this._processLoop(Y,U,Q),this._animatables.push(Y)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=n,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let b=0;b<this._animatables.length;b++){this._animatables[b].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(b){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==b&&(this.loopAnimation=b),this.restart()):(this.stop(),this.start(b,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let b=0;b<this._animatables.length;b++){this._animatables[b].reset()}return this}restart(){if(!this._isStarted)return this;for(let b=0;b<this._animatables.length;b++){this._animatables[b].restart()}return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(){let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._isStarted)return this;const n=this._animatables.slice();for(let e=0;e<n.length;e++)n[e].stop(void 0,void 0,!0,b);let i=0;for(let e=0;e<this._scene._activeAnimatables.length;e++){const n=this._scene._activeAnimatables[e];n._runtimeAnimations.length>0?this._scene._activeAnimatables[i++]=n:b&&this._checkAnimationGroupEnded(n,b)}return this._scene._activeAnimatables.length=i,this._isStarted=!1,this}setWeightForAllAnimatables(b){for(let n=0;n<this._animatables.length;n++){this._animatables[n].weight=b}return this}syncAllAnimationsWith(b){for(let n=0;n<this._animatables.length;n++){this._animatables[n].syncWith(b)}return this}goToFrame(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._isStarted)return this;for(let i=0;i<this._animatables.length;i++){this._animatables[i].goToFrame(b,n)}return this}getCurrentFrame(){var b;return(null===(b=this.animatables[0])||void 0===b?void 0:b.masterFrame)||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const b=this._scene.animationGroups.indexOf(this);if(b>-1&&this._scene.animationGroups.splice(b,1),this._parentContainer){const b=this._parentContainer.animationGroups.indexOf(this);b>-1&&this._parentContainer.animationGroups.splice(b,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(b){let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const i=this._animatables.indexOf(b);i>-1&&this._animatables.splice(i,1),this._animatables.length===this._targetedAnimations.length-this._numActiveAnimatables&&(this._isStarted=!1,n||this.onAnimationGroupEndObservable.notifyObservers(this),this._animatables.length=0)}clone(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const e=new u(b||this.name,this._scene,this._weight,this._playOrder);e._from=this.from,e._to=this.to,e._speedRatio=this.speedRatio,e._loopAnimation=this.loopAnimation,e._isAdditive=this.isAdditive,e._enableBlending=this.enableBlending,e._blendingSpeed=this.blendingSpeed,e.metadata=this.metadata,e.mask=this.mask;for(const V of this._targetedAnimations)e.addTargetedAnimation(i?V.animation.clone():V.animation,n?n(V.target):V.target);return e}serialize(){const b={};b.name=this.name,b.from=this.from,b.to=this.to,b.speedRatio=this.speedRatio,b.loopAnimation=this.loopAnimation,b.isAdditive=this.isAdditive,b.weight=this.weight,b.playOrder=this.playOrder,b.enableBlending=this.enableBlending,b.blendingSpeed=this.blendingSpeed,b.targetedAnimations=[];for(let n=0;n<this.targetedAnimations.length;n++){const i=this.targetedAnimations[n];b.targetedAnimations[n]=i.serialize()}return U.d&&U.d.HasTags(this)&&(b.tags=U.d.GetTags(this)),this.metadata&&(b.metadata=this.metadata),b}static Parse(b,n){const i=new u(b.name,n,b.weight,b.playOrder);for(let V=0;V<b.targetedAnimations.length;V++){const Q=b.targetedAnimations[V],U=e.c.Parse(Q.animation),Y=Q.targetId;if("influence"===Q.animation.property){const b=n.getMorphTargetById(Y);b&&i.addTargetedAnimation(U,b)}else{const b=n.getNodeById(Y);null!=b&&i.addTargetedAnimation(U,b)}}return U.d&&U.d.AddTagsTo(i,b.tags),null!==b.from&&null!==b.to&&i.normalize(b.from,b.to),void 0!==b.speedRatio&&(i._speedRatio=b.speedRatio),void 0!==b.loopAnimation&&(i._loopAnimation=b.loopAnimation),void 0!==b.isAdditive&&(i._isAdditive=b.isAdditive),void 0!==b.weight&&(i._weight=b.weight),void 0!==b.playOrder&&(i._playOrder=b.playOrder),void 0!==b.enableBlending&&(i._enableBlending=b.enableBlending),void 0!==b.blendingSpeed&&(i._blendingSpeed=b.blendingSpeed),void 0!==b.metadata&&(i.metadata=b.metadata),i}static MakeAnimationAdditive(b,n,i){let V;V="object"===typeof n?n:{referenceFrame:n,range:i,cloneOriginalAnimationGroup:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let Q=b;V.cloneOriginalAnimationGroup&&(Q=b.clone(V.clonedAnimationGroupName||Q.name));const U=Q.targetedAnimations;for(let Y=0;Y<U.length;Y++){const b=U[Y];b.animation=e.c.MakeAnimationAdditive(b.animation,V)}if(Q.isAdditive=!0,V.clipKeys){let b=Number.MAX_VALUE,n=-Number.MAX_VALUE;const i=Q.targetedAnimations;for(let e=0;e<i.length;e++){const V=i[e].animation.getKeys();b>V[0].frame&&(b=V[0].frame),n<V[V.length-1].frame&&(n=V[V.length-1].frame)}Q._from=b,Q._to=n}return Q}static ClipKeys(b,n,i,e,V){const Q=b.clone(e||b.name);return u.ClipKeysInPlace(Q,n,i,V)}static ClipKeysInPlace(b,n,i,e){return u.ClipInPlace(b,n,i,e,!1)}static ClipFrames(b,n,i,e,V){const Q=b.clone(e||b.name);return u.ClipFramesInPlace(Q,n,i,V)}static ClipFramesInPlace(b,n,i,e){return u.ClipInPlace(b,n,i,e,!0)}static ClipInPlace(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Q=Number.MAX_VALUE,U=-Number.MAX_VALUE;const Y=b.targetedAnimations;for(let L=0;L<Y.length;L++){const b=Y[L],B=e?b.animation:b.animation.clone();V&&(B.createKeyForFrame(n),B.createKeyForFrame(i));const mb=B.getKeys(),N=[];let Z=Number.MAX_VALUE;for(let e=0;e<mb.length;e++){const b=mb[e];if(!V&&e>=n&&e<=i||V&&b.frame>=n&&b.frame<=i){const n={frame:b.frame,value:b.value.clone?b.value.clone():b.value,inTangent:b.inTangent,outTangent:b.outTangent,interpolation:b.interpolation,lockedTangent:b.lockedTangent};Z===Number.MAX_VALUE&&(Z=n.frame),n.frame-=Z,N.push(n)}}0!==N.length?(Q>N[0].frame&&(Q=N[0].frame),U<N[N.length-1].frame&&(U=N[N.length-1].frame),B.setKeys(N,!0),b.animation=B):(Y.splice(L,1),L--)}return b._from=Q,b._to=U,b}getClassName(){return"AnimationGroup"}toString(b){let n="Name: "+this.name;return n+=", type: "+this.getClassName(),b&&(n+=", from: "+this._from,n+=", to: "+this._to,n+=", isStarted: "+this._isStarted,n+=", speedRatio: "+this._speedRatio,n+=", targetedAnimations length: "+this._targetedAnimations.length,n+=", animatables length: "+this._animatables),n}}}}]);