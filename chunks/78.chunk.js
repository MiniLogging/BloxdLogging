"use strict";(self["80dd64vgxnn"]=self["80dd64vgxnn"]||[]).push([[78],{15753:(mm,o,u)=>{u.r(o),u.d(o,{AnimationGroup:()=>t,TargetedAnimation:()=>l});var f=u(13233),B=u(12556),O=u(12596),r=u(12771),w=u(14187),p=u(12740);class K{get currentFrame(){return this._currentFrame}get weight(){return this._weight}get currentValue(){return this._currentValue}get targetPath(){return this._targetPath}get target(){return this._currentActiveTarget}get isAdditive(){return this._host&&this._host.isAdditive}constructor(mm,o,u,B){if(this._events=new Array,this._currentFrame=0,this._originalValue=new Array,this._originalBlendValue=null,this._offsetsCache={},this._highLimitsCache={},this._stopped=!1,this._blendingFactor=0,this._currentValue=null,this._currentActiveTarget=null,this._directTarget=null,this._targetPath="",this._weight=1,this._absoluteFrameOffset=0,this._previousElapsedTime=0,this._yoyoDirection=1,this._previousAbsoluteFrame=0,this._targetIsArray=!1,this._coreRuntimeAnimation=null,this._animation=o,this._target=mm,this._scene=u,this._host=B,this._activeTargets=[],o._runtimeAnimations.push(this),this._animationState={key:0,repeatCount:0,loopMode:this._getCorrectLoopMode()},this._animation.dataType===f.d.ANIMATIONTYPE_MATRIX&&(this._animationState.workValue=p.Matrix.Zero()),this._keys=this._animation.getKeys(),this._minFrame=this._keys[0].frame,this._maxFrame=this._keys[this._keys.length-1].frame,this._minValue=this._keys[0].value,this._maxValue=this._keys[this._keys.length-1].value,0!==this._minFrame){const mm={frame:0,value:this._minValue};this._keys.splice(0,0,mm)}if(this._target instanceof Array){let mm=0;for(const o of this._target)this._preparePath(o,mm),this._getOriginalValues(mm),mm++;this._targetIsArray=!0}else this._preparePath(this._target),this._getOriginalValues(),this._targetIsArray=!1,this._directTarget=this._activeTargets[0];const O=o.getEvents();if(O&&O.length>0)for(const f of O)this._events.push(f._clone());this._enableBlending=mm&&mm.animationPropertiesOverride?mm.animationPropertiesOverride.enableBlending:this._animation.enableBlending}_preparePath(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const u=this._animation.targetPropertyPath;if(u.length>1){let f=mm;for(let mm=0;mm<u.length-1;mm++){const o=u[mm];if(f=f[o],void 0===f)throw new Error(`Invalid property (${o}) in property path (${u.join(".")})`)}this._targetPath=u[u.length-1],this._activeTargets[o]=f}else this._targetPath=u[0],this._activeTargets[o]=mm;if(void 0===this._activeTargets[o][this._targetPath])throw new Error(`Invalid property (${this._targetPath}) in property path (${u.join(".")})`)}get animation(){return this._animation}reset(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])if(this._target instanceof Array){let mm=0;for(const o of this._target)void 0!==this._originalValue[mm]&&this._setValue(o,this._activeTargets[mm],this._originalValue[mm],-1,mm),mm++}else void 0!==this._originalValue[0]&&this._setValue(this._target,this._directTarget,this._originalValue[0],-1,0);this._offsetsCache={},this._highLimitsCache={},this._currentFrame=0,this._blendingFactor=0;for(let mm=0;mm<this._events.length;mm++)this._events[mm].isDone=!1}isStopped(){return this._stopped}dispose(){const mm=this._animation.runtimeAnimations.indexOf(this);mm>-1&&this._animation.runtimeAnimations.splice(mm,1)}setValue(mm,o){if(this._targetIsArray)for(let u=0;u<this._target.length;u++){const f=this._target[u];this._setValue(f,this._activeTargets[u],mm,o,u)}else this._setValue(this._target,this._directTarget,mm,o,0)}_getOriginalValues(){let mm,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const u=this._activeTargets[o];mm=u.getLocalMatrix&&"_matrix"===this._targetPath?u.getLocalMatrix():u[this._targetPath],mm&&mm.clone?this._originalValue[o]=mm.clone():this._originalValue[o]=mm}_registerTargetForLateAnimationBinding(mm,o){const u=mm.target;this._scene._registeredForLateAnimationBindings.pushNoDuplicate(u),u._lateAnimationHolders||(u._lateAnimationHolders={}),u._lateAnimationHolders[mm.targetPath]||(u._lateAnimationHolders[mm.targetPath]={totalWeight:0,totalAdditiveWeight:0,animations:[],additiveAnimations:[],originalValue:o}),mm.isAdditive?(u._lateAnimationHolders[mm.targetPath].additiveAnimations.push(mm),u._lateAnimationHolders[mm.targetPath].totalAdditiveWeight+=mm.weight):(u._lateAnimationHolders[mm.targetPath].animations.push(mm),u._lateAnimationHolders[mm.targetPath].totalWeight+=mm.weight)}_setValue(mm,o,u,B,O){if(this._currentActiveTarget=o,this._weight=B,this._enableBlending&&this._blendingFactor<=1){if(!this._originalBlendValue){const mm=o[this._targetPath];mm.clone?this._originalBlendValue=mm.clone():this._originalBlendValue=mm}this._originalBlendValue.m?f.d.AllowMatrixDecomposeForInterpolation?this._currentValue?p.Matrix.DecomposeLerpToRef(this._originalBlendValue,u,this._blendingFactor,this._currentValue):this._currentValue=p.Matrix.DecomposeLerp(this._originalBlendValue,u,this._blendingFactor):this._currentValue?p.Matrix.LerpToRef(this._originalBlendValue,u,this._blendingFactor,this._currentValue):this._currentValue=p.Matrix.Lerp(this._originalBlendValue,u,this._blendingFactor):this._currentValue=f.d._UniversalLerp(this._originalBlendValue,u,this._blendingFactor);const B=mm&&mm.animationPropertiesOverride?mm.animationPropertiesOverride.blendingSpeed:this._animation.blendingSpeed;this._blendingFactor+=B}else this._currentValue?this._currentValue.p?this._currentValue.p(u):this._currentValue=u:null!==u&&void 0!==u&&u.clone?this._currentValue=u.clone():this._currentValue=u;-1!==B?this._registerTargetForLateAnimationBinding(this,this._originalValue[O]):this._animationState.loopMode===f.d.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT?this._currentValue.addToRef?this._currentValue.addToRef(this._originalValue[O],o[this._targetPath]):o[this._targetPath]=this._originalValue[O]+this._currentValue:o[this._targetPath]=this._currentValue,mm.cz&&mm.cz(this._animation.targetProperty)}_getCorrectLoopMode(){return this._target&&this._target.animationPropertiesOverride?this._target.animationPropertiesOverride.loopMode:this._animation.loopMode}goToFrame(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;const u=this._animation.getKeys();mm<u[0].frame?mm=u[0].frame:mm>u[u.length-1].frame&&(mm=u[u.length-1].frame);const f=this._events;if(f.length)for(let O=0;O<f.length;O++)f[O].onlyOnce||(f[O].isDone=f[O].frame<mm);this._currentFrame=mm;const B=this._animation._interpolate(mm,this._animationState);this.setValue(B,o)}_prepareForSpeedRatioChange(mm){const o=this._previousElapsedTime*(this._animation.framePerSecond*mm)/1e3;this._absoluteFrameOffset=this._previousAbsoluteFrame-o}animate(mm,o,u,B,O){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:-1;const w=this._animation,p=w.targetPropertyPath;if(!p||p.length<1)return this._stopped=!0,!1;let K,z=!0;const Y=this._events;let q=0;if(this._coreRuntimeAnimation)q=u-o,K=this._coreRuntimeAnimation.currentFrame,this._currentFrame=K,this._animationState.repeatCount=this._coreRuntimeAnimation._animationState.repeatCount,this._animationState.highLimitValue=this._coreRuntimeAnimation._animationState.highLimitValue,this._animationState.offsetValue=this._coreRuntimeAnimation._animationState.offsetValue;else{let r;(o<this._minFrame||o>this._maxFrame)&&(o=this._minFrame),(u<this._minFrame||u>this._maxFrame)&&(u=this._maxFrame),q=u-o;let p=mm*(w.framePerSecond*O)/1e3+this._absoluteFrameOffset,x=0,H=!1;const E=B&&this._animationState.loopMode===f.d.ANIMATIONLOOPMODE_YOYO;if(E){const mm=(p-o)/q,u=Math.sin(mm*Math.PI);p=Math.abs(u)*q+o;const f=u>=0?1:-1;this._yoyoDirection!==f&&(H=!0),this._yoyoDirection=f}if(this._previousElapsedTime=mm,this._previousAbsoluteFrame=p,!B&&u>=o&&(p>=q&&O>0||p<=0&&O<0))z=!1,x=w._getKeyValue(this._maxValue);else if(!B&&o>=u&&(p<=q&&O<0||p>=0&&O>0))z=!1,x=w._getKeyValue(this._minValue);else if(this._animationState.loopMode!==f.d.ANIMATIONLOOPMODE_CYCLE){const mm=u.toString()+o.toString();if(!this._offsetsCache[mm]){this._animationState.repeatCount=0,this._animationState.loopMode=f.d.ANIMATIONLOOPMODE_CYCLE;const B=w._interpolate(o,this._animationState),O=w._interpolate(u,this._animationState);switch(this._animationState.loopMode=this._getCorrectLoopMode(),w.dataType){case f.d.ANIMATIONTYPE_FLOAT:this._offsetsCache[mm]=O-B;break;case f.d.ANIMATIONTYPE_QUATERNION:case f.d.ANIMATIONTYPE_VECTOR3:case f.d.ANIMATIONTYPE_VECTOR2:case f.d.ANIMATIONTYPE_SIZE:case f.d.ANIMATIONTYPE_COLOR3:this._offsetsCache[mm]=O.Qo(B)}this._highLimitsCache[mm]=O}x=this._highLimitsCache[mm],r=this._offsetsCache[mm]}if(void 0===r)switch(w.dataType){case f.d.ANIMATIONTYPE_FLOAT:r=0;break;case f.d.ANIMATIONTYPE_QUATERNION:r=f.l;break;case f.d.ANIMATIONTYPE_VECTOR3:r=f.s;break;case f.d.ANIMATIONTYPE_VECTOR2:r=f.p;break;case f.d.ANIMATIONTYPE_SIZE:r=f.o;break;case f.d.ANIMATIONTYPE_COLOR3:r=f.e;break;case f.d.ANIMATIONTYPE_COLOR4:r=f.h}if(this._host&&this._host.syncRoot){const mm=this._host.syncRoot;K=o+q*((mm.masterFrame-mm.fromFrame)/(mm.toFrame-mm.fromFrame))}else K=p>0&&o>u||p<0&&o<u?z&&0!==q?u+p%q:o:z&&0!==q?o+p%q:u;if(!E&&(O>0&&this.currentFrame>K||O<0&&this.currentFrame<K)||E&&H){this._onLoop();for(let mm=0;mm<Y.length;mm++)Y[mm].onlyOnce||(Y[mm].isDone=!1);this._animationState.key=O>0?0:w.getKeys().length-1}this._currentFrame=K,this._animationState.repeatCount=0===q?0:p/q|0,this._animationState.highLimitValue=x,this._animationState.offsetValue=r}const x=w._interpolate(K,this._animationState);if(this.setValue(x,r),Y.length)for(let f=0;f<Y.length;f++)if(q>=0&&K>=Y[f].frame&&Y[f].frame>=o||q<0&&K<=Y[f].frame&&Y[f].frame<=o){const mm=Y[f];mm.isDone||(mm.onlyOnce&&(Y.splice(f,1),f--),mm.isDone=!0,mm.action(K))}return z||(this._stopped=!0),z}}var z=u(12581);class Y{get syncRoot(){return this._syncRoot}get masterFrame(){return 0===this._runtimeAnimations.length?0:this._runtimeAnimations[0].currentFrame}get weight(){return this._weight}set weight(mm){this._weight=-1!==mm?Math.min(Math.max(mm,0),1):-1}get speedRatio(){return this._speedRatio}set speedRatio(mm){for(let o=0;o<this._runtimeAnimations.length;o++){this._runtimeAnimations[o]._prepareForSpeedRatioChange(mm)}this._speedRatio=mm,null!==this._goToFrame&&this.goToFrame(this._goToFrame)}get elapsedTime(){return null===this._localDelayOffset?0:this._scene._animationTime-this._localDelayOffset}constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,w=arguments.length>6?arguments[6]:void 0,p=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0,z=arguments.length>9&&void 0!==arguments[9]&&arguments[9],Y=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0;this.target=o,this.fromFrame=u,this.toFrame=f,this.loopAnimation=O,this.onAnimationEnd=w,this.onAnimationLoop=K,this.isAdditive=z,this.playOrder=Y,this._localDelayOffset=null,this._pausedDelay=null,this._manualJumpDelay=null,this._runtimeAnimations=new Array,this.mK=!1,this._speedRatio=1,this._weight=-1,this._previousWeight=-1,this._syncRoot=null,this._frameToSyncFromJump=null,this._goToFrame=null,this.disposeOnEnd=!0,this.animationStarted=!1,this.onAnimationEndObservable=new B.d,this.onAnimationLoopObservable=new B.d,this._scene=mm,p&&this.appendAnimations(o,p),this._speedRatio=r,mm._activeAnimatables.push(this)}syncWith(mm){if(this._syncRoot=mm,mm){const mm=this._scene._activeAnimatables.indexOf(this);mm>-1&&(this._scene._activeAnimatables.splice(mm,1),this._scene._activeAnimatables.push(this))}return this}getAnimations(){return this._runtimeAnimations}appendAnimations(mm,o){for(let u=0;u<o.length;u++){const f=o[u],B=new K(mm,f,this._scene,this);B._onLoop=()=>{this.onAnimationLoopObservable.notifyObservers(this),this.onAnimationLoop&&this.onAnimationLoop()},this._runtimeAnimations.push(B)}}getAnimationByTargetProperty(mm){const o=this._runtimeAnimations;for(let u=0;u<o.length;u++)if(o[u].animation.targetProperty===mm)return o[u].animation;return null}getRuntimeAnimationByTargetProperty(mm){const o=this._runtimeAnimations;for(let u=0;u<o.length;u++)if(o[u].animation.targetProperty===mm)return o[u];return null}reset(){const mm=this._runtimeAnimations;for(let o=0;o<mm.length;o++)mm[o].reset(!0);this._localDelayOffset=null,this._pausedDelay=null}enableBlending(mm){const o=this._runtimeAnimations;for(let u=0;u<o.length;u++)o[u].animation.enableBlending=!0,o[u].animation.blendingSpeed=mm}disableBlending(){const mm=this._runtimeAnimations;for(let o=0;o<mm.length;o++)mm[o].animation.enableBlending=!1}goToFrame(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=this._runtimeAnimations;if(u[0]){const o=u[0].animation.framePerSecond;this._frameToSyncFromJump=this._frameToSyncFromJump??u[0].currentFrame;const f=0===this.speedRatio?0:(mm-this._frameToSyncFromJump)/o*1e3/this.speedRatio;this._manualJumpDelay=-f}for(let f=0;f<u.length;f++)u[f].goToFrame(mm,o?this._weight:-1);this._goToFrame=mm}get paused(){return this.mK}pause(){this.mK||(this.mK=!0)}restart(){this.mK=!1}_raiseOnAnimationEnd(){this.onAnimationEnd&&this.onAnimationEnd(),this.onAnimationEndObservable.notifyObservers(this)}stop(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(mm||o){const B=this._scene._activeAnimatables.indexOf(this);if(B>-1){const O=this._runtimeAnimations;for(let u=O.length-1;u>=0;u--){const f=O[u];mm&&f.animation.name!=mm||(o&&!o(f.target)||(f.dispose(),O.splice(u,1)))}0==O.length&&(u||this._scene._activeAnimatables.splice(B,1),f||this._raiseOnAnimationEnd())}}else{const mm=this._scene._activeAnimatables.indexOf(this);if(mm>-1){u||this._scene._activeAnimatables.splice(mm,1);const o=this._runtimeAnimations;for(let mm=0;mm<o.length;mm++)o[mm].dispose();this._runtimeAnimations.length=0,f||this._raiseOnAnimationEnd()}}}async waitAsync(){return await new Promise((mm=>{this.onAnimationEndObservable.add((()=>{mm(this)}),void 0,void 0,this,!0)}))}_animate(mm){if(this.mK)return this.animationStarted=!1,null===this._pausedDelay&&(this._pausedDelay=mm),!0;if(null===this._localDelayOffset?(this._localDelayOffset=mm,this._pausedDelay=null):null!==this._pausedDelay&&(this._localDelayOffset+=mm-this._pausedDelay,this._pausedDelay=null),null!==this._manualJumpDelay&&(this._localDelayOffset+=this.speedRatio<0?-this._manualJumpDelay:this._manualJumpDelay,this._manualJumpDelay=null,this._frameToSyncFromJump=null),this._goToFrame=null,0===this._weight&&0===this._previousWeight)return!0;this._previousWeight=this._weight;let o=!1;const u=this._runtimeAnimations;let f;for(f=0;f<u.length;f++){const B=u[f].animate(mm-this._localDelayOffset,this.fromFrame,this.toFrame,this.loopAnimation,this._speedRatio,this._weight);o=o||B}if(this.animationStarted=o,!o){if(this.disposeOnEnd)for(f=this._scene._activeAnimatables.indexOf(this),this._scene._activeAnimatables.splice(f,1),f=0;f<u.length;f++)u[f].dispose();this._raiseOnAnimationEnd(),this.disposeOnEnd&&(this.onAnimationEnd=null,this.onAnimationLoop=null,this.onAnimationLoopObservable.clear(),this.onAnimationEndObservable.clear())}return o}}function q(mm){if(0===mm.totalWeight&&0===mm.totalAdditiveWeight)return mm.originalValue;let o=1;const u=p.TmpVectors.lo[0],f=p.TmpVectors.lo[1],B=p.TmpVectors.Quaternion[0];let O=0;const r=mm.animations[0],w=mm.originalValue;let K=1,z=!1;if(mm.totalWeight<1)K=1-mm.totalWeight,w.decompose(f,B,u);else{if(O=1,o=mm.totalWeight,K=r.weight/o,1==K){if(!mm.totalAdditiveWeight)return r.currentValue;z=!0}r.currentValue.decompose(f,B,u)}if(!z){f.scaleInPlace(K),u.scaleInPlace(K),B.scaleInPlace(K);for(let r=O;r<mm.animations.length;r++){const O=mm.animations[r];if(0===O.weight)continue;K=O.weight/o;const w=p.TmpVectors.lo[2],z=p.TmpVectors.lo[3],Y=p.TmpVectors.Quaternion[1];O.currentValue.decompose(z,Y,w),z.scaleAndAddToRef(K,f),Y.scaleAndAddToRef(p.Quaternion.Dot(B,Y)>0?K:-K,B),w.scaleAndAddToRef(K,u)}B.normalize()}for(let q=0;q<mm.additiveAnimations.length;q++){const o=mm.additiveAnimations[q];if(0===o.weight)continue;const O=p.TmpVectors.lo[2],r=p.TmpVectors.lo[3],w=p.TmpVectors.Quaternion[1];o.currentValue.decompose(r,w,O),r.multiplyToRef(f,r),p.lo.LerpToRef(f,r,o.weight,f),B.multiplyToRef(w,w),p.Quaternion.SlerpToRef(B,w,o.weight,B),O.scaleAndAddToRef(o.weight,u)}const Y=r?r._animationState.workValue:p.TmpVectors.Matrix[0].clone();return p.Matrix.ComposeToRef(f,B,u,Y),Y}function x(mm,o){if(0===mm.totalWeight&&0===mm.totalAdditiveWeight)return o;const u=mm.animations[0],f=mm.originalValue;let B=o;if(0===mm.totalWeight&&mm.totalAdditiveWeight>0)B.p(f);else if(1===mm.animations.length){if(p.Quaternion.SlerpToRef(f,u.currentValue,Math.min(1,mm.totalWeight),B),0===mm.totalAdditiveWeight)return B}else if(mm.animations.length>1){let u,O,r=1;if(mm.totalWeight<1){const o=1-mm.totalWeight;u=[],O=[],u.push(f),O.push(o)}else{if(2===mm.animations.length&&(p.Quaternion.SlerpToRef(mm.animations[0].currentValue,mm.animations[1].currentValue,mm.animations[1].weight/mm.totalWeight,o),0===mm.totalAdditiveWeight))return o;u=[],O=[],r=mm.totalWeight}for(let o=0;o<mm.animations.length;o++){const f=mm.animations[o];u.push(f.currentValue),O.push(f.weight/r)}let w=0;for(let mm=0;mm<u.length;)mm?(w+=O[mm],p.Quaternion.SlerpToRef(B,u[mm],O[mm]/w,B),mm++):(p.Quaternion.SlerpToRef(u[mm],u[mm+1],O[mm+1]/(O[mm]+O[mm+1]),o),B=o,w=O[mm]+O[mm+1],mm+=2)}for(let O=0;O<mm.additiveAnimations.length;O++){const o=mm.additiveAnimations[O];0!==o.weight&&(B.multiplyToRef(o.currentValue,p.TmpVectors.Quaternion[0]),p.Quaternion.SlerpToRef(B,p.TmpVectors.Quaternion[0],o.weight,B))}return B}var H,E,M=u(12965);H=M.d,(E=w.e)&&(E.prototype.copyAnimationRange=function(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3],O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;0===this.animations.length&&(this.animations.push(new f.d(this.name,"_matrix",mm.animations[0].framePerSecond,f.d.ANIMATIONTYPE_MATRIX,0)),this.animations[0].setKeys([]));const r=mm.animations[0].getRange(o);if(!r)return!1;const w=r.from,p=r.to,K=mm.animations[0].getKeys(),z=mm.length,Y=mm.getParent(),q=this.getParent(),x=B&&Y&&z&&this.length&&z!==this.length,H=x&&q&&Y?q.length/Y.length:1,E=B&&!q&&O&&(1!==O.x||1!==O.y||1!==O.z),M=this.animations[0].getKeys();let l,t,Q;for(let f=0,b=K.length;f<b;f++)l=K[f],l.frame>=w&&l.frame<=p&&(B?(Q=l.value.clone(),x?(t=Q.getTranslation(),Q.setTranslation(t.scaleInPlace(H))):E&&O?(t=Q.getTranslation(),Q.setTranslation(t.multiplyInPlace(O))):Q=l.value):Q=l.value,M.push({frame:l.frame+u,value:Q}));return this.animations[0].createRange(o,w+u,p+u),!0}),H&&(H.prototype._animate=function(mm){if(!this.animationsEnabled)return;const o=z.b.Now;if(!this._animationTimeLast){if(this._pendingData.length>0)return;this._animationTimeLast=o}this.deltaTime=void 0!==mm?mm:this.useConstantAnimationDeltaTime?16:(o-this._animationTimeLast)*this.animationTimeScale,this._animationTimeLast=o;const u=this._activeAnimatables;if(0===u.length)return;this._animationTime+=this.deltaTime;const B=this._animationTime;for(let f=0;f<u.length;f++){const mm=u[f];!mm._animate(B)&&mm.disposeOnEnd&&f--}!function(mm){if(mm._registeredForLateAnimationBindings.length){for(let o=0;o<mm._registeredForLateAnimationBindings.length;o++){const u=mm._registeredForLateAnimationBindings.data[o];for(const mm in u._lateAnimationHolders){const o=u._lateAnimationHolders[mm],B=o.animations[0],O=o.originalValue;if(void 0===O||null===O)continue;const r=f.d.AllowMatrixDecomposeForInterpolation&&O.m;let w=u[mm];if(r)w=q(o);else if(void 0!==O.w)w=x(o,w||p.Quaternion.Identity());else{let mm=0,u=1;const r=B&&B._animationState.loopMode===f.d.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT;if(o.totalWeight<1)w=r?O.clone?O.clone():O:B&&O.scale?O.scale(1-o.totalWeight):B?O*(1-o.totalWeight):O.clone?O.clone():O;else if(B){u=o.totalWeight;const f=B.weight/u;w=1!==f?B.currentValue.scale?B.currentValue.scale(f):B.currentValue*f:B.currentValue,r&&(w.addToRef?w.addToRef(O,w):w+=O),mm=1}for(let f=mm;f<o.animations.length;f++){const mm=o.animations[f],B=mm.weight/u;B&&(mm.currentValue.scaleAndAddToRef?mm.currentValue.scaleAndAddToRef(B,w):w+=mm.currentValue*B)}for(let f=0;f<o.additiveAnimations.length;f++){const mm=o.additiveAnimations[f],u=mm.weight;u&&(mm.currentValue.scaleAndAddToRef?mm.currentValue.scaleAndAddToRef(u,w):w+=mm.currentValue*u)}}u[mm]=w}u._lateAnimationHolders={}}mm._registeredForLateAnimationBindings.reset()}}(this)},H.prototype.sortActiveAnimatables=function(){this._activeAnimatables.sort(((mm,o)=>mm.playOrder-o.playOrder))},H.prototype.beginWeightedAnimation=function(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,B=arguments.length>4?arguments[4]:void 0,O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6?arguments[6]:void 0,w=arguments.length>7?arguments[7]:void 0,p=arguments.length>8?arguments[8]:void 0,K=arguments.length>9?arguments[9]:void 0,z=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const Y=this.beginAnimation(mm,o,u,B,O,r,w,!1,p,K,z);return Y.weight=f,Y},H.prototype.beginAnimation=function(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,O=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,w=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],p=arguments.length>8?arguments[8]:void 0,K=arguments.length>9?arguments[9]:void 0,z=arguments.length>10&&void 0!==arguments[10]&&arguments[10];if(B<0){const mm=o;o=u,u=mm,B=-B}o>u&&(B=-B),w&&this.stopAnimation(mm,void 0,p),r||(r=new Y(this,mm,o,u,f,B,O,void 0,K,z));const q=!p||p(mm);if(mm.animations&&q&&r.appendAnimations(mm,mm.animations),mm.getAnimatables){const z=mm.getAnimatables();for(let mm=0;mm<z.length;mm++)this.beginAnimation(z[mm],o,u,f,B,O,r,w,p,K)}return r.reset(),r},H.prototype.beginHierarchyAnimation=function(mm,o,u,f,B){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6?arguments[6]:void 0,w=arguments.length>7?arguments[7]:void 0,p=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],K=arguments.length>9?arguments[9]:void 0,z=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const Y=mm.getDescendants(o),q=[];q.push(this.beginAnimation(mm,u,f,B,O,r,w,p,K,void 0,z));for(const x of Y)q.push(this.beginAnimation(x,u,f,B,O,r,w,p,K,void 0,z));return q},H.prototype.beginDirectAnimation=function(mm,o,u,f,B){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;if(O<0){const mm=u;u=f,f=mm,O=-O}return u>f&&(O=-O),new Y(this,mm,u,f,B,O,arguments.length>6?arguments[6]:void 0,o,arguments.length>7?arguments[7]:void 0,arguments.length>8&&void 0!==arguments[8]&&arguments[8])},H.prototype.beginDirectHierarchyAnimation=function(mm,o,u,f,B,O,r,w,p){let K=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const z=mm.getDescendants(o),Y=[];Y.push(this.beginDirectAnimation(mm,u,f,B,O,r,w,p,K));for(const q of z)Y.push(this.beginDirectAnimation(q,u,f,B,O,r,w,p,K));return Y},H.prototype.getAnimatableByTarget=function(mm){for(let o=0;o<this._activeAnimatables.length;o++)if(this._activeAnimatables[o].target===mm)return this._activeAnimatables[o];return null},H.prototype.getAllAnimatablesByTarget=function(mm){const o=[];for(let u=0;u<this._activeAnimatables.length;u++)this._activeAnimatables[u].target===mm&&o.push(this._activeAnimatables[u]);return o},H.prototype.stopAnimation=function(mm,o,u){const f=this.getAllAnimatablesByTarget(mm);for(const B of f)B.stop(o,u)},H.prototype.stopAllAnimations=function(){if(this._activeAnimatables){for(let mm=0;mm<this._activeAnimatables.length;mm++)this._activeAnimatables[mm].stop(void 0,void 0,!0);this._activeAnimatables.length=0}for(const mm of this.animationGroups)mm.stop()});class l{getClassName(){return"TargetedAnimation"}serialize(){const mm={};return mm.animation=this.animation.serialize(),mm.targetId=this.target.id,mm}}class t{get mask(){return this._mask}set mask(mm){this._mask!==mm&&(this._mask=mm,this.syncWithMask(!0))}syncWithMask(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mask||mm){this._numActiveAnimatables=0;for(let mm=0;mm<this._animatables.length;++mm){const o=this._animatables[mm];!this.mask||this.mask.disabled||this.mask.retainsTarget(o.target.name)?(this._numActiveAnimatables++,o.paused&&o.restart()):o.paused||o.pause()}}else this._numActiveAnimatables=this._targetedAnimations.length}removeUnmaskedAnimations(){if(this.mask&&!this.mask.disabled){for(let mm=0;mm<this._animatables.length;++mm){const o=this._animatables[mm];this.mask.retainsTarget(o.target.name)||(o.stop(),this._animatables.splice(mm,1),--mm)}for(let mm=0;mm<this._targetedAnimations.length;mm++){const o=this._targetedAnimations[mm];this.mask.retainsTarget(o.target.name)||(this._targetedAnimations.splice(mm,1),--mm)}}}get from(){return this._from}set from(mm){if(this._from!==mm){this._from=mm;for(let mm=0;mm<this._animatables.length;mm++){this._animatables[mm].fromFrame=this._from}}}get to(){return this._to}set to(mm){if(this._to!==mm){this._to=mm;for(let mm=0;mm<this._animatables.length;mm++){this._animatables[mm].toFrame=this._to}}}get isStarted(){return this._isStarted}get isPlaying(){return this._isStarted&&!this._isPaused}get speedRatio(){return this._speedRatio}set speedRatio(mm){if(this._speedRatio!==mm){this._speedRatio=mm;for(let mm=0;mm<this._animatables.length;mm++){this._animatables[mm].speedRatio=this._speedRatio}}}get loopAnimation(){return this._loopAnimation}set loopAnimation(mm){if(this._loopAnimation!==mm){this._loopAnimation=mm;for(let mm=0;mm<this._animatables.length;mm++){this._animatables[mm].loopAnimation=this._loopAnimation}}}get isAdditive(){return this._isAdditive}set isAdditive(mm){if(this._isAdditive!==mm){this._isAdditive=mm;for(let mm=0;mm<this._animatables.length;mm++){this._animatables[mm].isAdditive=this._isAdditive}}}get weight(){return this._weight}set weight(mm){this._weight!==mm&&(this._weight=mm,this.setWeightForAllAnimatables(this._weight))}get targetedAnimations(){return this._targetedAnimations}get animatables(){return this._animatables}get children(){return this._targetedAnimations}get playOrder(){return this._playOrder}set playOrder(mm){if(this._playOrder!==mm&&(this._playOrder=mm,this._animatables.length>0)){for(let mm=0;mm<this._animatables.length;mm++)this._animatables[mm].playOrder=this._playOrder;this._scene.sortActiveAnimatables()}}get enableBlending(){return this._enableBlending}set enableBlending(mm){if(this._enableBlending!==mm&&(this._enableBlending=mm,null!==mm))for(let o=0;o<this._targetedAnimations.length;++o)this._targetedAnimations[o].animation.enableBlending=mm}get blendingSpeed(){return this._blendingSpeed}set blendingSpeed(mm){if(this._blendingSpeed!==mm&&(this._blendingSpeed=mm,null!==mm))for(let o=0;o<this._targetedAnimations.length;++o)this._targetedAnimations[o].animation.blendingSpeed=mm}getLength(mm,o){mm=mm??this._from;return((o=o??this._to)-mm)/(this.targetedAnimations[0].animation.framePerSecond*this._speedRatio)}static MergeAnimationGroups(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;if(0===mm.length)return null;f=f??mm[0].weight;let B=Number.MAX_VALUE,O=-Number.MAX_VALUE;if(u)for(const w of mm)w.from<B&&(B=w.from),w.to>O&&(O=w.to);const r=new t(mm[0].name+"_merged",mm[0]._scene,f);for(const w of mm){u&&w.normalize(B,O);for(const mm of w.targetedAnimations)r.addTargetedAnimation(mm.animation,mm.target);o&&w.dispose()}return r}constructor(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.name=mm,this._targetedAnimations=new Array,this._animatables=new Array,this._from=Number.MAX_VALUE,this._to=-Number.MAX_VALUE,this._speedRatio=1,this._loopAnimation=!1,this._isAdditive=!1,this._weight=-1,this._playOrder=0,this._enableBlending=null,this._blendingSpeed=null,this._numActiveAnimatables=0,this._shouldStart=!0,this._parentContainer=null,this.onAnimationEndObservable=new B.d,this.onAnimationLoopObservable=new B.d,this.onAnimationGroupLoopObservable=new B.d,this.onAnimationGroupEndObservable=new B.d,this.onAnimationGroupPauseObservable=new B.d,this.onAnimationGroupPlayObservable=new B.d,this.metadata=null,this._mask=null,this._animationLoopFlags=[],this._scene=o||O.d.LastCreatedScene,this._weight=u,this._playOrder=f,this.uniqueId=this._scene.getUniqueId(),this._scene.addAnimationGroup(this)}addTargetedAnimation(mm,o){const u=new l;u.animation=mm,u.target=o;const f=mm.getKeys();return this._from>f[0].frame&&(this._from=f[0].frame),this._to<f[f.length-1].frame&&(this._to=f[f.length-1].frame),null!==this._enableBlending&&(mm.enableBlending=this._enableBlending),null!==this._blendingSpeed&&(mm.blendingSpeed=this._blendingSpeed),this._targetedAnimations.push(u),this._shouldStart=!0,u}removeTargetedAnimation(mm){for(let o=this._targetedAnimations.length-1;o>-1;o--){this._targetedAnimations[o].animation===mm&&this._targetedAnimations.splice(o,1)}}normalize(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;null==mm&&(mm=this._from),null==o&&(o=this._to);for(let u=0;u<this._targetedAnimations.length;u++){const f=this._targetedAnimations[u].animation.getKeys(),B=f[0],O=f[f.length-1];if(B.frame>mm){const o={frame:mm,value:B.value,inTangent:B.inTangent,outTangent:B.outTangent,interpolation:B.interpolation};f.splice(0,0,o)}if(O.frame<o){const mm={frame:o,value:O.value,inTangent:O.inTangent,outTangent:O.outTangent,interpolation:O.interpolation};f.push(mm)}}return this._from=mm,this._to=o,this}_processLoop(mm,o,u){mm.onAnimationLoop=()=>{this.onAnimationLoopObservable.notifyObservers(o),this._animationLoopFlags[u]||(this._animationLoopFlags[u]=!0,this._animationLoopCount++,this._animationLoopCount===this._numActiveAnimatables&&(this.onAnimationGroupLoopObservable.notifyObservers(this),this._animationLoopCount=0,this._animationLoopFlags.length=0))}}start(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0],o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,u=arguments.length>2?arguments[2]:void 0,f=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;if(this._isStarted||0===this._targetedAnimations.length)return this;this._loopAnimation=mm,this._shouldStart=!1,this._animationLoopCount=0,this._animationLoopFlags.length=0;for(let O=0;O<this._targetedAnimations.length;O++){const r=this._targetedAnimations[O],w=this._scene.beginDirectAnimation(r.target,[r.animation],void 0!==u?u:this._from,void 0!==f?f:this._to,mm,o,void 0,void 0,void 0!==B?B:this._isAdditive);w.weight=this._weight,w.playOrder=this._playOrder,w.onAnimationEnd=()=>{this.onAnimationEndObservable.notifyObservers(r),this._checkAnimationGroupEnded(w)},this._processLoop(w,r,O),this._animatables.push(w)}return this.syncWithMask(),this._scene.sortActiveAnimatables(),this._speedRatio=o,this._isStarted=!0,this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}pause(){if(!this._isStarted)return this;this._isPaused=!0;for(let mm=0;mm<this._animatables.length;mm++){this._animatables[mm].pause()}return this.onAnimationGroupPauseObservable.notifyObservers(this),this}play(mm){return this.isStarted&&this._animatables.length&&!this._shouldStart?(void 0!==mm&&(this.loopAnimation=mm),this.restart()):(this.stop(),this.start(mm,this._speedRatio)),this}reset(){if(!this._isStarted)return this.play(),this.goToFrame(0),this.stop(!0),this;for(let mm=0;mm<this._animatables.length;mm++){this._animatables[mm].reset()}return this}restart(){if(!this._isStarted)return this;for(let mm=0;mm<this._animatables.length;mm++){this._animatables[mm].restart()}return this.syncWithMask(),this._isPaused=!1,this.onAnimationGroupPlayObservable.notifyObservers(this),this}stop(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._isStarted)return this;const o=this._animatables.slice();for(let f=0;f<o.length;f++)o[f].stop(void 0,void 0,!0,mm);let u=0;for(let f=0;f<this._scene._activeAnimatables.length;f++){const o=this._scene._activeAnimatables[f];o._runtimeAnimations.length>0?this._scene._activeAnimatables[u++]=o:mm&&this._checkAnimationGroupEnded(o,mm)}return this._scene._activeAnimatables.length=u,this._isStarted=!1,this}setWeightForAllAnimatables(mm){for(let o=0;o<this._animatables.length;o++){this._animatables[o].weight=mm}return this}syncAllAnimationsWith(mm){for(let o=0;o<this._animatables.length;o++){this._animatables[o].syncWith(mm)}return this}goToFrame(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._isStarted)return this;for(let u=0;u<this._animatables.length;u++){this._animatables[u].goToFrame(mm,o)}return this}getCurrentFrame(){var mm;return(null===(mm=this.animatables[0])||void 0===mm?void 0:mm.masterFrame)||0}dispose(){this.isStarted&&this.stop(),this._targetedAnimations.length=0,this._animatables.length=0;const mm=this._scene.animationGroups.indexOf(this);if(mm>-1&&this._scene.animationGroups.splice(mm,1),this._parentContainer){const mm=this._parentContainer.animationGroups.indexOf(this);mm>-1&&this._parentContainer.animationGroups.splice(mm,1),this._parentContainer=null}this.onAnimationEndObservable.clear(),this.onAnimationGroupEndObservable.clear(),this.onAnimationGroupPauseObservable.clear(),this.onAnimationGroupPlayObservable.clear(),this.onAnimationLoopObservable.clear(),this.onAnimationGroupLoopObservable.clear()}_checkAnimationGroupEnded(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const u=this._animatables.indexOf(mm);u>-1&&this._animatables.splice(u,1),this._animatables.length===this._targetedAnimations.length-this._numActiveAnimatables&&(this._isStarted=!1,o||this.onAnimationGroupEndObservable.notifyObservers(this),this._animatables.length=0)}clone(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const f=new t(mm||this.name,this._scene,this._weight,this._playOrder);f._from=this.from,f._to=this.to,f._speedRatio=this.speedRatio,f._loopAnimation=this.loopAnimation,f._isAdditive=this.isAdditive,f._enableBlending=this.enableBlending,f._blendingSpeed=this.blendingSpeed,f.metadata=this.metadata,f.mask=this.mask;for(const B of this._targetedAnimations)f.addTargetedAnimation(u?B.animation.clone():B.animation,o?o(B.target):B.target);return f}serialize(){const mm={};mm.name=this.name,mm.from=this.from,mm.to=this.to,mm.speedRatio=this.speedRatio,mm.loopAnimation=this.loopAnimation,mm.isAdditive=this.isAdditive,mm.weight=this.weight,mm.playOrder=this.playOrder,mm.enableBlending=this.enableBlending,mm.blendingSpeed=this.blendingSpeed,mm.targetedAnimations=[];for(let o=0;o<this.targetedAnimations.length;o++){const u=this.targetedAnimations[o];mm.targetedAnimations[o]=u.serialize()}return r.e&&r.e.HasTags(this)&&(mm.tags=r.e.GetTags(this)),this.metadata&&(mm.metadata=this.metadata),mm}static Parse(mm,o){const u=new t(mm.name,o,mm.weight,mm.playOrder);for(let B=0;B<mm.targetedAnimations.length;B++){const O=mm.targetedAnimations[B],r=f.d.Parse(O.animation),w=O.targetId;if("influence"===O.animation.property){const mm=o.getMorphTargetById(w);mm&&u.addTargetedAnimation(r,mm)}else{const mm=o.getNodeById(w);null!=mm&&u.addTargetedAnimation(r,mm)}}return r.e&&r.e.AddTagsTo(u,mm.tags),null!==mm.from&&null!==mm.to&&u.normalize(mm.from,mm.to),void 0!==mm.speedRatio&&(u._speedRatio=mm.speedRatio),void 0!==mm.loopAnimation&&(u._loopAnimation=mm.loopAnimation),void 0!==mm.isAdditive&&(u._isAdditive=mm.isAdditive),void 0!==mm.weight&&(u._weight=mm.weight),void 0!==mm.playOrder&&(u._playOrder=mm.playOrder),void 0!==mm.enableBlending&&(u._enableBlending=mm.enableBlending),void 0!==mm.blendingSpeed&&(u._blendingSpeed=mm.blendingSpeed),void 0!==mm.metadata&&(u.metadata=mm.metadata),u}static MakeAnimationAdditive(mm,o,u){let B;B="object"===typeof o?o:{referenceFrame:o,range:u,cloneOriginalAnimationGroup:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let O=mm;B.cloneOriginalAnimationGroup&&(O=mm.clone(B.clonedAnimationGroupName||O.name));const r=O.targetedAnimations;for(let w=0;w<r.length;w++){const mm=r[w];mm.animation=f.d.MakeAnimationAdditive(mm.animation,B)}if(O.isAdditive=!0,B.clipKeys){let mm=Number.MAX_VALUE,o=-Number.MAX_VALUE;const u=O.targetedAnimations;for(let f=0;f<u.length;f++){const B=u[f].animation.getKeys();mm>B[0].frame&&(mm=B[0].frame),o<B[B.length-1].frame&&(o=B[B.length-1].frame)}O._from=mm,O._to=o}return O}static ClipKeys(mm,o,u,f,B){const O=mm.clone(f||mm.name);return t.ClipKeysInPlace(O,o,u,B)}static ClipKeysInPlace(mm,o,u,f){return t.ClipInPlace(mm,o,u,f,!1)}static ClipFrames(mm,o,u,f,B){const O=mm.clone(f||mm.name);return t.ClipFramesInPlace(O,o,u,B)}static ClipFramesInPlace(mm,o,u,f){return t.ClipInPlace(mm,o,u,f,!0)}static ClipInPlace(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=Number.MAX_VALUE,r=-Number.MAX_VALUE;const w=mm.targetedAnimations;for(let p=0;p<w.length;p++){const mm=w[p],K=f?mm.animation:mm.animation.clone();B&&(K.createKeyForFrame(o),K.createKeyForFrame(u));const z=K.getKeys(),Y=[];let q=Number.MAX_VALUE;for(let f=0;f<z.length;f++){const mm=z[f];if(!B&&f>=o&&f<=u||B&&mm.frame>=o&&mm.frame<=u){const o={frame:mm.frame,value:mm.value.clone?mm.value.clone():mm.value,inTangent:mm.inTangent,outTangent:mm.outTangent,interpolation:mm.interpolation,lockedTangent:mm.lockedTangent};q===Number.MAX_VALUE&&(q=o.frame),o.frame-=q,Y.push(o)}}0!==Y.length?(O>Y[0].frame&&(O=Y[0].frame),r<Y[Y.length-1].frame&&(r=Y[Y.length-1].frame),K.setKeys(Y,!0),mm.animation=K):(w.splice(p,1),p--)}return mm._from=O,mm._to=r,mm}getClassName(){return"AnimationGroup"}toString(mm){let o="Name: "+this.name;return o+=", type: "+this.getClassName(),mm&&(o+=", from: "+this._from,o+=", to: "+this._to,o+=", isStarted: "+this._isStarted,o+=", speedRatio: "+this._speedRatio,o+=", targetedAnimations length: "+this._targetedAnimations.length,o+=", animatables length: "+this._animatables),o}}}}]);