"use strict";(self["1xyrlsr8vb9"]=self["1xyrlsr8vb9"]||[]).push([[19],{12329:(I,O,C)=>{C.d(O,{c:()=>y,e:()=>S});var j=C(12333),K=C(12103),i=C(12340);class y{get p(){return this._isDisposed}constructor(I,O,C){let K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0,p=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,I&&I.nI?this._engine=I.nI().getEngine():this._engine=I,this._updatable=C,this._instanced=y,this._divisor=U||1,this._label=p,O instanceof j.b?(this._data=null,this._buffer=O):(this._data=O,this._buffer=null),this.byteStride=S?K:K*Float32Array.BYTES_PER_ELEMENT,i||this.create()}createVertexBuffer(I,O,C,j,K){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0;const U=i?O:O*Float32Array.BYTES_PER_ELEMENT,p=j?i?j:j*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new S(this._engine,this,I,this._updatable,!0,p,void 0===K?this._instanced:K,U,C,void 0,void 0,!0,this._divisor||y)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!I&&this._buffer||(I=I||this._data,I&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,I),this._data=I):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(I,this._label),this._data=I):this._buffer=this._engine.createVertexBuffer(I,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.tO>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.tO,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.tO,void 0,this._label));K.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(I){this.create(I)}updateDirectly(I,O,C){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,I,j?O:O*Float32Array.BYTES_PER_ELEMENT,C?C*this.byteStride:void 0),this._data=0===O&&void 0===C?I:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class S{get p(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(I){const O=0!=I;this._instanceDivisor=I,O!==this._instanced&&(this._instanced=O,this._computeHashCode())}get _maxVerticesCount(){const I=this.getData();return I?Array.isArray(I)?I.length/(this.byteStride/4)-this.byteOffset/4:(I.byteLength-this.byteOffset)/this.byteStride:0}constructor(I,O,C,j,K,U,p,N,Q,s){let Z=arguments.length>10&&void 0!==arguments[10]&&arguments[10],q=arguments.length>11&&void 0!==arguments[11]&&arguments[11],mI=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,E=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let h=!1;if(this.qO=I,"object"===typeof j&&null!==j?(h=j.updatable??!1,K=j.postponeInternalCreation,U=j.stride,p=j.instanced,N=j.offset,Q=j.size,s=j.type,Z=j.normalized??!1,q=j.useBytes??!1,mI=j.divisor??1,E=j.takeBufferOwnership??!1,this._label=j.label):h=!!j,O instanceof y?(this._buffer=O,this._ownsBuffer=E):(this._buffer=new y(I,O,h,U,K,p,q,mI,this._label),this._ownsBuffer=!0),this.uniqueId=S._Counter++,this._kind=C,void 0===s){const I=this.getData();this.type=I?S.GetDataType(I):S.FLOAT}else this.type=s;const r=(0,i.k)(this.type);q?(this._size=Q||(U?U/r:S.DeduceStride(C)),this.byteStride=U||this._buffer.byteStride||this._size*r,this.byteOffset=N||0):(this._size=Q||U||S.DeduceStride(C),this.byteStride=U?U*r:this._buffer.byteStride||this._size*r,this.byteOffset=(N||0)*r),this.normalized=Z,this._instanced=void 0!==p&&p,this._instanceDivisor=p?mI:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var I;null===(I=this._buffer)||void 0===I||I._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(I,O){const C=this.getData();return C?(0,i.g)(C,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,I,O):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,i.k)(this.type)}getOffset(){return this.byteOffset/(0,i.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,i.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(I){this._buffer.create(I),this._alignBuffer()}update(I){this._buffer.update(I),this._alignBuffer()}updateDirectly(I,O){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(I,O,void 0,C),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(I,O){(0,i.f)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,I,this.normalized,((I,C)=>{for(let j=0;j<this._size;j++)O(I[j],C+j)}))}_alignBuffer(){}static DeduceStride(I){switch(I){case S.UVKind:case S.UV2Kind:case S.UV3Kind:case S.UV4Kind:case S.UV5Kind:case S.UV6Kind:return 2;case S.NormalKind:case S.PositionKind:return 3;case S.ColorKind:case S.ColorInstanceKind:case S.MatricesIndicesKind:case S.MatricesIndicesExtraKind:case S.MatricesWeightsKind:case S.MatricesWeightsExtraKind:case S.TangentKind:return 4;default:throw new Error("Invalid kind '"+I+"'")}}static GetDataType(I){return I instanceof Int8Array?S.BYTE:I instanceof Uint8Array?S.UNSIGNED_BYTE:I instanceof Int16Array?S.SHORT:I instanceof Uint16Array?S.UNSIGNED_SHORT:I instanceof Int32Array?S.INT:I instanceof Uint32Array?S.UNSIGNED_INT:S.FLOAT}static GetTypeByteLength(I){return(0,i.k)(I)}static ForEach(I,O,C,j,K,y,S,U){(0,i.f)(I,O,C,j,K,y,S,((I,O)=>{for(let C=0;C<j;C++)U(I[C],O+C)}))}static GetFloatData(I,O,C,j,K,y,S,U){return(0,i.g)(I,O,C,j,K,y,S,U)}}S._Counter=0,S.BYTE=5120,S.UNSIGNED_BYTE=5121,S.SHORT=5122,S.UNSIGNED_SHORT=5123,S.INT=5124,S.UNSIGNED_INT=5125,S.FLOAT=5126,S.PositionKind="position",S.NormalKind="normal",S.TangentKind="tangent",S.UVKind="uv",S.UV2Kind="uv2",S.UV3Kind="uv3",S.UV4Kind="uv4",S.UV5Kind="uv5",S.UV6Kind="uv6",S.ColorKind="color",S.ColorInstanceKind="instanceColor",S.MatricesIndicesKind="matricesIndices",S.MatricesWeightsKind="matricesWeights",S.MatricesIndicesExtraKind="matricesIndicesExtra",S.MatricesWeightsExtraKind="matricesWeightsExtra"},12340:(I,O,C)=>{C.d(O,{b:()=>s,d:()=>Q,f:()=>U,g:()=>p,k:()=>y,m:()=>S,p:()=>N});var j=C(12103);function K(I,O,C,j){switch(O){case 5120:{let O=I.getInt8(C);return j&&(O=Math.max(O/127,-1)),O}case 5121:{let O=I.getUint8(C);return j&&(O/=255),O}case 5122:{let O=I.getInt16(C,!0);return j&&(O=Math.max(O/32767,-1)),O}case 5123:{let O=I.getUint16(C,!0);return j&&(O/=65535),O}case 5124:return I.getInt32(C,!0);case 5125:return I.getUint32(C,!0);case 5126:return I.getFloat32(C,!0);default:throw new Error(`Invalid component type ${O}`)}}function i(I,O,C,j,K){switch(O){case 5120:j&&(K=Math.round(127*K)),I.setInt8(C,K);break;case 5121:j&&(K=Math.round(255*K)),I.setUint8(C,K);break;case 5122:j&&(K=Math.round(32767*K)),I.setInt16(C,K,!0);break;case 5123:j&&(K=Math.round(65535*K)),I.setUint16(C,K,!0);break;case 5124:I.setInt32(C,K,!0);break;case 5125:I.setUint32(C,K,!0);break;case 5126:I.setFloat32(C,K,!0);break;default:throw new Error(`Invalid component type ${O}`)}}function y(I){switch(I){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${I}'`)}}function S(I){switch(I){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${I}'`)}}function U(I,O,C,j,S,U,p,N){const Q=new Array(j),s=new Array(j);if(I instanceof Array){let K=O/4;const i=C/4;for(let O=0;O<U;O+=j){for(let O=0;O<j;O++)Q[O]=s[O]=I[K+O];N(s,O);for(let O=0;O<j;O++)Q[O]!==s[O]&&(I[K+O]=s[O]);K+=i}}else{const Z=ArrayBuffer.isView(I)?new DataView(I.buffer,I.byteOffset,I.byteLength):new DataView(I),q=y(S);for(let I=0;I<U;I+=j){for(let I=0,C=O;I<j;I++,C+=q)Q[I]=s[I]=K(Z,S,C,p);N(s,I);for(let I=0,C=O;I<j;I++,C+=q)Q[I]!==s[I]&&i(Z,S,C,p,s[I]);O+=C}}}function p(I,O,C,K,i,S,p,N){const Q=O*y(C),s=p*O;if(5126!==C||i!==Q){const j=new Float32Array(s);return U(I,K,i,O,C,s,S,((I,C)=>{for(let K=0;K<O;K++)j[C+K]=I[K]})),j}if(!(I instanceof Array||I instanceof Float32Array)||0!==K||I.length!==s){if(I instanceof Array){const O=K/4;return I.slice(O,O+s)}if(I instanceof ArrayBuffer)return new Float32Array(I,K,s);{const O=I.byteOffset+K;return 0!==(3&O)&&(j.c.Warn("Float array must be aligned to 4-bytes border"),N=!0),N?new Float32Array(I.buffer.slice(O,O+s*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(I.buffer,O,s)}}return N?I.slice():I}function N(I,O,C,K,i,p,N,Q){const s=y(C),Z=S(C),q=N*O;if(Array.isArray(I)){if(0!==(3&K)||0!==(3&i))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const j=K/4,y=i/4;if(j+(N-1)*y+O>I.length)throw new Error("Last accessed index is out of bounds.");if(y<O)throw new Error("Data stride cannot be smaller than the component size.");if(y!==O){const j=new Z(q);return U(I,K,i,O,C,q,p,((I,C)=>{for(let K=0;K<O;K++)j[C+K]=I[K]})),j}return new Z(I.slice(j,j+q))}let mI,E=K;I instanceof ArrayBuffer?mI=I:(mI=I.buffer,E+=I.byteOffset);if(E+(N-1)*i+O*s>mI.byteLength)throw new Error("Last accessed byte is out of bounds.");const h=O*s;if(i<h)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(i!==h){const I=new Z(q);return U(mI,E,i,O,C,q,p,((C,j)=>{for(let K=0;K<O;K++)I[j+K]=C[K]})),I}return 1!==s&&0!==(E&s-1)&&(j.c.Warn("Array must be aligned to border of element size. Data will be copied."),Q=!0),Q?new Z(mI.slice(E,E+q*s)):new Z(mI,E,q)}function Q(I,O,C,K,i,S,p,N){const Q=O*y(C),s=p*O;if(N.length!==s)throw new Error("Output length is not valid");if(5126===C&&i===Q)if(I instanceof Array){const O=K/4;N.set(I,O)}else if(I instanceof ArrayBuffer){const O=new Float32Array(I,K,s);N.set(O)}else{const O=I.byteOffset+K;if(0!==(3&O))return j.c.Warn("Float array must be aligned to 4-bytes border"),void N.set(new Float32Array(I.buffer.slice(O,O+s*Float32Array.BYTES_PER_ELEMENT)));const C=new Float32Array(I.buffer,O,s);N.set(C)}else U(I,K,i,O,C,s,S,((I,C)=>{for(let j=0;j<O;j++)N[C+j]=I[j]}))}function s(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(I)){for(let K=0;K<O;K++)if(I[C+K]-j>65535)return!0;return!1}return 4===I.BYTES_PER_ELEMENT}},12333:(I,O,C)=>{C.d(O,{b:()=>j});class j{get underlyingResource(){return null}constructor(){this.references=0,this.tO=0,this.is32Bits=!1,this.uniqueId=j._Counter++}}j._Counter=0},12380:(I,O,C)=>{C.d(O,{d:()=>K});var j=C(12163);class K{static GetEffect(I){return void 0===I.getPipelineContext?I.effect:I}constructor(I){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=I.createDrawContext(),O&&(this.materialContext=I.createMaterialContext())}setEffect(I,O){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var j;(this.effect=I,void 0!==O&&(this.defines=O),C)&&(null===(j=this.drawContext)||void 0===j||j.reset())}dispose(){var I;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const I=this.effect;O?I.dispose():j.e.SetImmediate((()=>{I.getEngine().onEndFrameObservable.addOnce((()=>{I.dispose()}))})),this.effect=null}null===(I=this.drawContext)||void 0===I||I.dispose()}}},12456:(I,O,C)=>{C.d(O,{d:()=>K});var j=C(12310);class K{static GetPlanes(I){const O=[];for(let C=0;C<6;C++)O.push(new j.e(0,0,0,0));return K.GetPlanesToRef(I,O),O}static GetNearPlaneToRef(I,O){const C=I.m;O.normal.x=C[3]+C[2],O.normal.y=C[7]+C[6],O.normal.z=C[11]+C[10],O.d=C[15]+C[14],O.normalize()}static GetFarPlaneToRef(I,O){const C=I.m;O.normal.x=C[3]-C[2],O.normal.y=C[7]-C[6],O.normal.z=C[11]-C[10],O.d=C[15]-C[14],O.normalize()}static GetLeftPlaneToRef(I,O){const C=I.m;O.normal.x=C[3]+C[0],O.normal.y=C[7]+C[4],O.normal.z=C[11]+C[8],O.d=C[15]+C[12],O.normalize()}static GetRightPlaneToRef(I,O){const C=I.m;O.normal.x=C[3]-C[0],O.normal.y=C[7]-C[4],O.normal.z=C[11]-C[8],O.d=C[15]-C[12],O.normalize()}static GetTopPlaneToRef(I,O){const C=I.m;O.normal.x=C[3]-C[1],O.normal.y=C[7]-C[5],O.normal.z=C[11]-C[9],O.d=C[15]-C[13],O.normalize()}static GetBottomPlaneToRef(I,O){const C=I.m;O.normal.x=C[3]+C[1],O.normal.y=C[7]+C[5],O.normal.z=C[11]+C[9],O.d=C[15]+C[13],O.normalize()}static GetPlanesToRef(I,O){K.GetNearPlaneToRef(I,O[0]),K.GetFarPlaneToRef(I,O[1]),K.GetLeftPlaneToRef(I,O[2]),K.GetRightPlaneToRef(I,O[3]),K.GetTopPlaneToRef(I,O[4]),K.GetBottomPlaneToRef(I,O[5])}static IsPointInFrustum(I,O){for(let C=0;C<6;C++)if(O[C].dotCoordinate(I)<0)return!1;return!0}}},12465:(I,O,C)=>{C.d(O,{c:()=>K});var j=C(12118);class K{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(I,O){K.Enabled&&(this._current+=I,O&&this._fetchResult())}beginMonitoring(){K.Enabled&&(this._startMonitoringTime=j.c.Now)}endMonitoring(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!K.Enabled)return;I&&this.fetchNewFrame();const O=j.c.Now;this._current=O-this._startMonitoringTime,I&&this._fetchResult()}iS(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const I=j.c.Now;I-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=I,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}K.Enabled=!0},12354:(I,O,C)=>{C.d(O,{d:()=>K,e:()=>j});class j{constructor(I){this.length=0,this.data=new Array(I),this._id=j._GlobalId++}push(I){this.data[this.length++]=I,this.length>this.data.length&&(this.data.length*=2)}forEach(I){for(let O=0;O<this.length;O++)I(this.data[O])}sort(I){this.data.sort(I)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(I){if(0!==I.length){this.length+I.length>this.data.length&&(this.data.length=2*(this.length+I.length));for(let O=0;O<I.length;O++)this.data[this.length++]=(I.data||I)[O]}}indexOf(I){const O=this.data.indexOf(I);return O>=this.length?-1:O}contains(I){return-1!==this.indexOf(I)}}j._GlobalId=0;class K extends j{constructor(){super(...arguments),this._duplicateId=0}push(I){super.push(I),I.__smartArrayFlags||(I.__smartArrayFlags={}),I.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(I){return(!I.__smartArrayFlags||I.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(I),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(I){if(0!==I.length){this.length+I.length>this.data.length&&(this.data.length=2*(this.length+I.length));for(let O=0;O<I.length;O++){const C=(I.data||I)[O];this.pushNoDuplicate(C)}}}}},12327:(I,O,C)=>{C.d(O,{e:()=>i});var j=C(12329),K=C(12088);class i{constructor(I){this._vertexBuffers={},this.onBeforeRenderObservable=new K.c,this._scene=I}_prepareBuffers(){if(this._vertexBuffers[j.e.PositionKind])return;const I=[];I.push(1,1),I.push(-1,1),I.push(-1,-1),I.push(1,-1),this._vertexBuffers[j.e.PositionKind]=new j.e(this._scene.getEngine(),I,j.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const I=[];I.push(0),I.push(1),I.push(2),I.push(0),I.push(2),I.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(I)}_rebuild(){const I=this._vertexBuffers[j.e.PositionKind];I&&(I._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this._scene.activeCamera;return!!C&&(O=O||C._postProcesses.filter((I=>null!=I)),!(!O||0===O.length||!this._scene.postProcessesEnabled)&&(O[0].activate(C,I,null!==O&&void 0!==O),!0))}directRender(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:I.length;const S=this._scene.getEngine();for(let p=0;p<y;p++){var U;if(p<I.length-1)I[p+1].activate(this._scene.activeCamera||this._scene,null===O||void 0===O?void 0:O.texture);else O?S.bindFramebuffer(O,j,void 0,void 0,C,K):i||S.restoreDefaultFramebuffer(),null===(U=S._debugInsertMarker)||void 0===U||U.call(S,`post process ${I[p].name} output`);const y=I[p],N=y.apply();N&&(y.onBeforeRenderObservable.notifyObservers(N),this._prepareBuffers(),S.bindBuffers(this._vertexBuffers,this._indexBuffer,N),S.drawElementsType(0,0,6),y.onAfterRenderObservable.notifyObservers(N))}S.setDepthBuffer(!0),S.setDepthWrite(!0)}_finalizeFrame(I,O,C,j){let K=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i=this._scene.activeCamera;if(!i)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(j=j||i._postProcesses.filter((I=>null!=I))).length||!this._scene.postProcessesEnabled)return;const y=this._scene.getEngine();for(let U=0,p=j.length;U<p;U++){const N=j[U];var S;if(U<p-1)N._outputTexture=j[U+1].activate(i,null===O||void 0===O?void 0:O.texture);else O?(y.bindFramebuffer(O,C,void 0,void 0,K),N._outputTexture=O):(y.restoreDefaultFramebuffer(),N._outputTexture=null),null===(S=y._debugInsertMarker)||void 0===S||S.call(y,`post process ${j[U].name} output`);if(I)break;const Q=N.apply();Q&&(N.onBeforeRenderObservable.notifyObservers(Q),this._prepareBuffers(),y.bindBuffers(this._vertexBuffers,this._indexBuffer,Q),y.drawElementsType(0,0,6),N.onAfterRenderObservable.notifyObservers(Q))}y.setDepthBuffer(!0),y.setDepthWrite(!0),y.setAlphaMode(0)}dispose(){const I=this._vertexBuffers[j.e.PositionKind];I&&(I.dispose(),this._vertexBuffers[j.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12349:(I,O,C)=>{C.d(O,{c:()=>S});var j=C(12354),K=C(12272);class i{set opaqueSortCompareFn(I){this._opaqueSortCompareFn=I||i.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(I){this._alphaTestSortCompareFn=I||i.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(I){this._transparentSortCompareFn=I||i.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(I,O){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,K=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=I,this._opaqueSubMeshes=new j.e(256),this._transparentSubMeshes=new j.e(256),this._alphaTestSubMeshes=new j.e(256),this._depthOnlySubMeshes=new j.e(256),this._particleSystems=new j.e(256),this._spriteManagers=new j.e(256),this._empty=!0,this._edgesRenderers=new j.d(16),this._scene=O,this.opaqueSortCompareFn=C,this.alphaTestSortCompareFn=K,this.transparentSortCompareFn=i}render(I,O,C,j){if(I)return void I(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const K=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(K.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),K.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const i=K.getStencilBuffer();if(K.setStencilBuffer(!1),O&&this._renderSprites(),C&&this._renderParticles(j),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(K.setStencilBuffer(i),this._scene.useOrderIndependentTransparency){const I=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);I.length&&this._renderTransparent(I)}else this._renderTransparent(this._transparentSubMeshes);K.setAlphaMode(0)}if(K.setStencilBuffer(!1),this._edgesRenderers.length){for(let I=0;I<this._edgesRenderers.length;I++)this._edgesRenderers.data[I].render();K.setAlphaMode(0)}K.setStencilBuffer(i)}_renderOpaqueSorted(I){i._RenderSorted(I,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(I){i._RenderSorted(I,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(I){i._RenderSorted(I,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(I,O,C,j){let y,S=0;const U=C?C.globalPosition:i._ZeroVector;if(j)for(;S<I.length;S++)y=I.data[S],y._alphaIndex=y.getMesh().alphaIndex,y._distanceToCamera=K.mC.Distance(y.getBoundingInfo().boundingSphere.centerWorld,U);const p=I.length===I.data.length?I.data:I.data.slice(0,I.length);O&&p.sort(O);const N=p[0].getMesh().nI();for(S=0;S<p.length;S++)if(y=p[S],!N._activeMeshesFrozenButKeepClipping||y.isInFrustum(N._frustumPlanes)){if(j){const I=y.DI();if(I&&I.needDepthPrePass){const O=I.nI().getEngine();O.setColorWrite(!1),O.setAlphaMode(0),y.render(!1),O.setColorWrite(!0)}}y.render(j)}}static defaultTransparentSortCompare(I,O){return I._alphaIndex>O._alphaIndex?1:I._alphaIndex<O._alphaIndex?-1:i.backToFrontSortCompare(I,O)}static backToFrontSortCompare(I,O){return I._distanceToCamera<O._distanceToCamera?1:I._distanceToCamera>O._distanceToCamera?-1:0}static frontToBackSortCompare(I,O){return I._distanceToCamera<O._distanceToCamera?-1:I._distanceToCamera>O._distanceToCamera?1:0}static PainterSortCompare(I,O){const C=I.getMesh(),j=O.getMesh();return C.material&&j.material?C.material.uniqueId-j.material.uniqueId:C.uniqueId-j.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(I,O,C){void 0===O&&(O=I.getMesh()),void 0===C&&(C=I.DI()),null!==C&&void 0!==C&&(C.needAlphaBlendingForMesh(O)?this._transparentSubMeshes.push(I):C.needAlphaTestingForMesh(O)?(C.needDepthPrePass&&this._depthOnlySubMeshes.push(I),this._alphaTestSubMeshes.push(I)):(C.needDepthPrePass&&this._depthOnlySubMeshes.push(I),this._opaqueSubMeshes.push(I)),O._renderingGroup=this,O._edgesRenderer&&O.isEnabled()&&O.isVisible&&O._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(O._edgesRenderer),this._empty=!1)}dispatchSprites(I){this._spriteManagers.push(I),this._empty=!1}dispatchParticles(I){this._particleSystems.push(I),this._empty=!1}_renderParticles(I){if(0===this._particleSystems.length)return;const O=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let C=0;C<this._particleSystems.length;C++){const j=this._particleSystems.data[C];if(0===(O&&O.layerMask&j.layerMask))continue;const K=j.KO;K.position&&I&&-1===I.indexOf(K)||this._scene._activeParticles.addCount(j.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const I=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let O=0;O<this._spriteManagers.length;O++){const C=this._spriteManagers.data[O];0!==(I&&I.layerMask&C.layerMask)&&C.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}i._ZeroVector=K.mC.Zero();class y{}class S{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(I){I!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=I,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const I of this._scene.meshes)if(I.ZS)for(const O of I.ZS)O._wasDispatched=!1;if(this._scene.spriteManagers)for(const I of this._scene.spriteManagers)I._wasDispatched=!1;for(const I of this._scene.RQ)I._wasDispatched=!1}constructor(I){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new y,this._maintainStateBetweenFrames=!1,this._scene=I;for(let O=S.MIN_RENDERINGGROUPS;O<S.MAX_RENDERINGGROUPS;O++)this._autoClearDepthStencil[O]={sS:!0,depth:!0,SS:!0}}getRenderingGroup(I){const O=I||0;return this._prepareRenderingGroup(O),this._renderingGroups[O]}_clearDepthStencilBuffer(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,I,O),this._depthStencilBufferAlreadyCleaned=!0)}render(I,O,C,j){const K=this._renderingGroupInfo;if(K.hO=this._scene,K.camera=this._scene.activeCamera,K.renderingManager=this,this._scene.spriteManagers&&j)for(let i=0;i<this._scene.spriteManagers.length;i++){const I=this._scene.spriteManagers[i];this.dispatchSprites(I)}for(let i=S.MIN_RENDERINGGROUPS;i<S.MAX_RENDERINGGROUPS;i++){this._depthStencilBufferAlreadyCleaned=i===S.MIN_RENDERINGGROUPS;const y=this._renderingGroups[i];if(!y||y._empty)continue;const U=1<<i;if(K.renderingGroupId=i,this._scene.onBeforeRenderingGroupObservable.notifyObservers(K,U),S.AUTOCLEAR){const I=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(i):this._autoClearDepthStencil[i];I&&I.sS&&this._clearDepthStencilBuffer(I.depth,I.SS)}for(const I of this._scene._beforeRenderingGroupDrawStage)I.action(i);y.render(I,j,C,O);for(const I of this._scene._afterRenderingGroupDrawStage)I.action(i);this._scene.onAfterRenderingGroupObservable.notifyObservers(K,U)}}reset(){if(!this.maintainStateBetweenFrames)for(let I=S.MIN_RENDERINGGROUPS;I<S.MAX_RENDERINGGROUPS;I++){const O=this._renderingGroups[I];O&&O.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let I=S.MIN_RENDERINGGROUPS;I<S.MAX_RENDERINGGROUPS;I++){const O=this._renderingGroups[I];O&&O.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let I=S.MIN_RENDERINGGROUPS;I<S.MAX_RENDERINGGROUPS;I++){const O=this._renderingGroups[I];O&&O.dispose()}}_prepareRenderingGroup(I){void 0===this._renderingGroups[I]&&(this._renderingGroups[I]=new i(I,this._scene,this._customOpaqueSortCompareFn[I],this._customAlphaTestSortCompareFn[I],this._customTransparentSortCompareFn[I]))}dispatchSprites(I){this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatchSprites(I))}dispatchParticles(I){this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatchParticles(I))}dispatch(I,O,C){void 0===O&&(O=I.getMesh()),this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(O.renderingGroupId).dispatch(I,O,C))}setRenderingOrder(I){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[I]=O,this._customAlphaTestSortCompareFn[I]=C,this._customTransparentSortCompareFn[I]=j,this._renderingGroups[I]){const O=this._renderingGroups[I];O.opaqueSortCompareFn=this._customOpaqueSortCompareFn[I],O.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[I],O.transparentSortCompareFn=this._customTransparentSortCompareFn[I]}}setRenderingAutoClearDepthStencil(I,O){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[I]={sS:O,depth:C,SS:j}}getAutoClearDepthStencilSetup(I){return this._autoClearDepthStencil[I]}}S.MAX_RENDERINGGROUPS=4,S.MIN_RENDERINGGROUPS=0,S.AUTOCLEAR=!0}}]);