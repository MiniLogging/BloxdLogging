"use strict";(self.yg1iw12lizp=self.yg1iw12lizp||[]).push([[19],{12666:(L,U,x)=>{x.d(U,{d:()=>F,h:()=>a});var mL=x(12673),p=x(12406),G=x(12675);class F{get A(){return this._isDisposed}constructor(L,U,x){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,L&&L.PL?this._engine=L.PL().getEngine():this._engine=L,this._updatable=x,this._instanced=F,this._divisor=o||1,this._label=A,U instanceof mL.e?(this._data=null,this._buffer=U):(this._data=U,this._buffer=null),this.byteStride=a?p:p*Float32Array.BYTES_PER_ELEMENT,G||this.create()}createVertexBuffer(L,U,x,mL,p){let G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6?arguments[6]:void 0;const o=G?U:U*Float32Array.BYTES_PER_ELEMENT,A=mL?G?mL:mL*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new a(this._engine,this,L,this._updatable,!0,A,void 0===p?this._instanced:p,o,x,void 0,void 0,!0,this._divisor||F)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!L&&this._buffer||(L=L||this._data,L&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,L),this._data=L):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(L,this._label),this._data=L):this._buffer=this._engine.createVertexBuffer(L,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.ga>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.ga,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.ga,void 0,this._label));p.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(L){this.create(L)}updateDirectly(L,U,x){let mL=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,L,mL?U:U*Float32Array.BYTES_PER_ELEMENT,x?x*this.byteStride:void 0),this._data=0===U&&void 0===x?L:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class a{get A(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(L){const U=0!=L;this._instanceDivisor=L,U!==this._instanced&&(this._instanced=U,this._computeHashCode())}get _maxVerticesCount(){const L=this.getData();return L?Array.isArray(L)?L.length/(this.byteStride/4)-this.byteOffset/4:(L.byteLength-this.byteOffset)/this.byteStride:0}constructor(L,U,x,mL,p,o,A,r,h,b){let E=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Y=arguments.length>11&&void 0!==arguments[11]&&arguments[11],S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,V=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let H=!1;if(this.EU=L,"object"===typeof mL&&null!==mL?(H=mL.updatable??!1,p=mL.postponeInternalCreation,o=mL.stride,A=mL.instanced,r=mL.offset,h=mL.size,b=mL.type,E=mL.normalized??!1,Y=mL.useBytes??!1,S=mL.divisor??1,V=mL.takeBufferOwnership??!1,this._label=mL.label):H=!!mL,U instanceof F?(this._buffer=U,this._ownsBuffer=V):(this._buffer=new F(L,U,H,o,p,A,Y,S,this._label),this._ownsBuffer=!0),this.uniqueId=a._Counter++,this._kind=x,void 0===b){const L=this.getData();this.type=L?a.GetDataType(L):a.FLOAT}else this.type=b;const Q=(0,G.l)(this.type);Y?(this._size=h||(o?o/Q:a.DeduceStride(x)),this.byteStride=o||this._buffer.byteStride||this._size*Q,this.byteOffset=r||0):(this._size=h||o||a.DeduceStride(x),this.byteStride=o?o*Q:this._buffer.byteStride||this._size*Q,this.byteOffset=(r||0)*Q),this.normalized=E,this._instanced=void 0!==A&&A,this._instanceDivisor=A?S:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var L;null===(L=this._buffer)||void 0===L||L._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(L,U){const x=this.getData();return x?(0,G.k)(x,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,L,U):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,G.l)(this.type)}getOffset(){return this.byteOffset/(0,G.l)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,G.l)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(L){this._buffer.create(L),this._alignBuffer()}update(L){this._buffer.update(L),this._alignBuffer()}updateDirectly(L,U){let x=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(L,U,void 0,x),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(L,U){(0,G.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,L,this.normalized,((L,x)=>{for(let mL=0;mL<this._size;mL++)U(L[mL],x+mL)}))}_alignBuffer(){}static DeduceStride(L){switch(L){case a.UVKind:case a.UV2Kind:case a.UV3Kind:case a.UV4Kind:case a.UV5Kind:case a.UV6Kind:return 2;case a.NormalKind:case a.PositionKind:return 3;case a.ColorKind:case a.ColorInstanceKind:case a.MatricesIndicesKind:case a.MatricesIndicesExtraKind:case a.MatricesWeightsKind:case a.MatricesWeightsExtraKind:case a.TangentKind:return 4;default:throw new Error("Invalid kind '"+L+"'")}}static GetDataType(L){return L instanceof Int8Array?a.BYTE:L instanceof Uint8Array?a.UNSIGNED_BYTE:L instanceof Int16Array?a.SHORT:L instanceof Uint16Array?a.UNSIGNED_SHORT:L instanceof Int32Array?a.INT:L instanceof Uint32Array?a.UNSIGNED_INT:a.FLOAT}static GetTypeByteLength(L){return(0,G.l)(L)}static ForEach(L,U,x,mL,p,F,a,o){(0,G.h)(L,U,x,mL,p,F,a,((L,U)=>{for(let x=0;x<mL;x++)o(L[x],U+x)}))}static GetFloatData(L,U,x,mL,p,F,a,o){return(0,G.k)(L,U,x,mL,p,F,a,o)}}a._Counter=0,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="normal",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra"},12675:(L,U,x)=>{x.d(U,{c:()=>b,f:()=>h,h:()=>o,k:()=>A,l:()=>F,p:()=>a,t:()=>r});var mL=x(12406);function p(L,U,x,mL){switch(U){case 5120:{let U=L.getInt8(x);return mL&&(U=Math.max(U/127,-1)),U}case 5121:{let U=L.getUint8(x);return mL&&(U/=255),U}case 5122:{let U=L.getInt16(x,!0);return mL&&(U=Math.max(U/32767,-1)),U}case 5123:{let U=L.getUint16(x,!0);return mL&&(U/=65535),U}case 5124:return L.getInt32(x,!0);case 5125:return L.getUint32(x,!0);case 5126:return L.getFloat32(x,!0);default:throw new Error(`Invalid component type ${U}`)}}function G(L,U,x,mL,p){switch(U){case 5120:mL&&(p=Math.round(127*p)),L.setInt8(x,p);break;case 5121:mL&&(p=Math.round(255*p)),L.setUint8(x,p);break;case 5122:mL&&(p=Math.round(32767*p)),L.setInt16(x,p,!0);break;case 5123:mL&&(p=Math.round(65535*p)),L.setUint16(x,p,!0);break;case 5124:L.setInt32(x,p,!0);break;case 5125:L.setUint32(x,p,!0);break;case 5126:L.setFloat32(x,p,!0);break;default:throw new Error(`Invalid component type ${U}`)}}function F(L){switch(L){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${L}'`)}}function a(L){switch(L){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${L}'`)}}function o(L,U,x,mL,a,o,A,r){const h=new Array(mL),b=new Array(mL);if(L instanceof Array){let p=U/4;const G=x/4;for(let U=0;U<o;U+=mL){for(let U=0;U<mL;U++)h[U]=b[U]=L[p+U];r(b,U);for(let U=0;U<mL;U++)h[U]!==b[U]&&(L[p+U]=b[U]);p+=G}}else{const E=ArrayBuffer.isView(L)?new DataView(L.buffer,L.byteOffset,L.byteLength):new DataView(L),Y=F(a);for(let L=0;L<o;L+=mL){for(let L=0,x=U;L<mL;L++,x+=Y)h[L]=b[L]=p(E,a,x,A);r(b,L);for(let L=0,x=U;L<mL;L++,x+=Y)h[L]!==b[L]&&G(E,a,x,A,b[L]);U+=x}}}function A(L,U,x,p,G,a,A,r){const h=U*F(x),b=A*U;if(5126!==x||G!==h){const mL=new Float32Array(b);return o(L,p,G,U,x,b,a,((L,x)=>{for(let p=0;p<U;p++)mL[x+p]=L[p]})),mL}if(!(L instanceof Array||L instanceof Float32Array)||0!==p||L.length!==b){if(L instanceof Array){const U=p/4;return L.slice(U,U+b)}if(L instanceof ArrayBuffer)return new Float32Array(L,p,b);{const U=L.byteOffset+p;return 0!==(3&U)&&(mL.c.Warn("Float array must be aligned to 4-bytes border"),r=!0),r?new Float32Array(L.buffer.slice(U,U+b*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(L.buffer,U,b)}}return r?L.slice():L}function r(L,U,x,p,G,A,r,h){const b=F(x),E=a(x),Y=r*U;if(Array.isArray(L)){if(0!==(3&p)||0!==(3&G))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const mL=p/4,F=G/4;if(mL+(r-1)*F+U>L.length)throw new Error("Last accessed index is out of bounds.");if(F<U)throw new Error("Data stride cannot be smaller than the component size.");if(F!==U){const mL=new E(Y);return o(L,p,G,U,x,Y,A,((L,x)=>{for(let p=0;p<U;p++)mL[x+p]=L[p]})),mL}return new E(L.slice(mL,mL+Y))}let S,V=p;L instanceof ArrayBuffer?S=L:(S=L.buffer,V+=L.byteOffset);if(V+(r-1)*G+U*b>S.byteLength)throw new Error("Last accessed byte is out of bounds.");const H=U*b;if(G<H)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(G!==H){const L=new E(Y);return o(S,V,G,U,x,Y,A,((x,mL)=>{for(let p=0;p<U;p++)L[mL+p]=x[p]})),L}return 1!==b&&0!==(V&b-1)&&(mL.c.Warn("Array must be aligned to border of element size. Data will be copied."),h=!0),h?new E(S.slice(V,V+Y*b)):new E(S,V,Y)}function h(L,U,x,p,G,a,A,r){const h=U*F(x),b=A*U;if(r.length!==b)throw new Error("Output length is not valid");if(5126===x&&G===h)if(L instanceof Array){const U=p/4;r.set(L,U)}else if(L instanceof ArrayBuffer){const U=new Float32Array(L,p,b);r.set(U)}else{const U=L.byteOffset+p;if(0!==(3&U))return mL.c.Warn("Float array must be aligned to 4-bytes border"),void r.set(new Float32Array(L.buffer.slice(U,U+b*Float32Array.BYTES_PER_ELEMENT)));const x=new Float32Array(L.buffer,U,b);r.set(x)}else o(L,p,G,U,x,b,a,((L,x)=>{for(let mL=0;mL<U;mL++)r[x+mL]=L[mL]}))}function b(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(L)){for(let p=0;p<U;p++)if(L[x+p]-mL>65535)return!0;return!1}return 4===L.BYTES_PER_ELEMENT}},12673:(L,U,x)=>{x.d(U,{e:()=>mL});class mL{get underlyingResource(){return null}constructor(){this.references=0,this.ga=0,this.is32Bits=!1,this.uniqueId=mL._Counter++}}mL._Counter=0},12704:(L,U,x)=>{x.d(U,{e:()=>p});var mL=x(12475);class p{static GetEffect(L){return void 0===L.getPipelineContext?L.effect:L}constructor(L){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=L.createDrawContext(),U&&(this.materialContext=L.createMaterialContext())}setEffect(L,U){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var mL;(this.effect=L,void 0!==U&&(this.defines=U),x)&&(null===(mL=this.drawContext)||void 0===mL||mL.reset())}dispose(){var L;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const L=this.effect;U?L.dispose():mL.e.SetImmediate((()=>{L.getEngine().onEndFrameObservable.addOnce((()=>{L.dispose()}))})),this.effect=null}null===(L=this.drawContext)||void 0===L||L.dispose()}}},12788:(L,U,x)=>{x.d(U,{d:()=>p});var mL=x(12639);class p{static GetPlanes(L){const U=[];for(let x=0;x<6;x++)U.push(new mL.d(0,0,0,0));return p.GetPlanesToRef(L,U),U}static GetNearPlaneToRef(L,U){const x=L.m;U.normal.x=x[3]+x[2],U.normal.y=x[7]+x[6],U.normal.z=x[11]+x[10],U.d=x[15]+x[14],U.normalize()}static GetFarPlaneToRef(L,U){const x=L.m;U.normal.x=x[3]-x[2],U.normal.y=x[7]-x[6],U.normal.z=x[11]-x[10],U.d=x[15]-x[14],U.normalize()}static GetLeftPlaneToRef(L,U){const x=L.m;U.normal.x=x[3]+x[0],U.normal.y=x[7]+x[4],U.normal.z=x[11]+x[8],U.d=x[15]+x[12],U.normalize()}static GetRightPlaneToRef(L,U){const x=L.m;U.normal.x=x[3]-x[0],U.normal.y=x[7]-x[4],U.normal.z=x[11]-x[8],U.d=x[15]-x[12],U.normalize()}static GetTopPlaneToRef(L,U){const x=L.m;U.normal.x=x[3]-x[1],U.normal.y=x[7]-x[5],U.normal.z=x[11]-x[9],U.d=x[15]-x[13],U.normalize()}static GetBottomPlaneToRef(L,U){const x=L.m;U.normal.x=x[3]+x[1],U.normal.y=x[7]+x[5],U.normal.z=x[11]+x[9],U.d=x[15]+x[13],U.normalize()}static GetPlanesToRef(L,U){p.GetNearPlaneToRef(L,U[0]),p.GetFarPlaneToRef(L,U[1]),p.GetLeftPlaneToRef(L,U[2]),p.GetRightPlaneToRef(L,U[3]),p.GetTopPlaneToRef(L,U[4]),p.GetBottomPlaneToRef(L,U[5])}static IsPointInFrustum(L,U){for(let x=0;x<6;x++)if(U[x].dotCoordinate(L)<0)return!1;return!0}}},12796:(L,U,x)=>{x.d(U,{e:()=>p});var mL=x(12420);class p{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(L,U){p.Enabled&&(this._current+=L,U&&this._fetchResult())}beginMonitoring(){p.Enabled&&(this._startMonitoringTime=mL.e.Now)}endMonitoring(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!p.Enabled)return;L&&this.fetchNewFrame();const U=mL.e.Now;this._current=U-this._startMonitoringTime,L&&this._fetchResult()}aa(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const L=mL.e.Now;L-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=L,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}p.Enabled=!0},12684:(L,U,x)=>{x.d(U,{d:()=>p,h:()=>mL});class mL{constructor(L){this.length=0,this.data=new Array(L),this._id=mL._GlobalId++}push(L){this.data[this.length++]=L,this.length>this.data.length&&(this.data.length*=2)}forEach(L){for(let U=0;U<this.length;U++)L(this.data[U])}sort(L){this.data.sort(L)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(L){if(0!==L.length){this.length+L.length>this.data.length&&(this.data.length=2*(this.length+L.length));for(let U=0;U<L.length;U++)this.data[this.length++]=(L.data||L)[U]}}indexOf(L){const U=this.data.indexOf(L);return U>=this.length?-1:U}contains(L){return-1!==this.indexOf(L)}}mL._GlobalId=0;class p extends mL{constructor(){super(...arguments),this._duplicateId=0}push(L){super.push(L),L.__smartArrayFlags||(L.__smartArrayFlags={}),L.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(L){return(!L.__smartArrayFlags||L.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(L),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(L){if(0!==L.length){this.length+L.length>this.data.length&&(this.data.length=2*(this.length+L.length));for(let U=0;U<L.length;U++){const x=(L.data||L)[U];this.pushNoDuplicate(x)}}}}},12660:(L,U,x)=>{x.d(U,{c:()=>G});var mL=x(12666),p=x(12391);class G{constructor(L){this._vertexBuffers={},this.onBeforeRenderObservable=new p.c,this._scene=L}_prepareBuffers(){if(this._vertexBuffers[mL.h.PositionKind])return;const L=[];L.push(1,1),L.push(-1,1),L.push(-1,-1),L.push(1,-1),this._vertexBuffers[mL.h.PositionKind]=new mL.h(this._scene.getEngine(),L,mL.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const L=[];L.push(0),L.push(1),L.push(2),L.push(0),L.push(2),L.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(L)}_rebuild(){const L=this._vertexBuffers[mL.h.PositionKind];L&&(L._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const x=this._scene.activeCamera;return!!x&&(U=U||x._postProcesses.filter((L=>null!=L)),!(!U||0===U.length||!this._scene.postProcessesEnabled)&&(U[0].activate(x,L,null!==U&&void 0!==U),!0))}directRender(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:L.length;const a=this._scene.getEngine();for(let A=0;A<F;A++){var o;if(A<L.length-1)L[A+1].activate(this._scene.activeCamera||this._scene,null===U||void 0===U?void 0:U.texture);else U?a.bindFramebuffer(U,mL,void 0,void 0,x,p):G||a.restoreDefaultFramebuffer(),null===(o=a._debugInsertMarker)||void 0===o||o.call(a,`post process ${L[A].name} output`);const F=L[A],r=F.apply();r&&(F.onBeforeRenderObservable.notifyObservers(r),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,r),a.drawElementsType(0,0,6),F.onAfterRenderObservable.notifyObservers(r))}a.setDepthBuffer(!0),a.setDepthWrite(!0)}_finalizeFrame(L,U,x,mL){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const G=this._scene.activeCamera;if(!G)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(mL=mL||G._postProcesses.filter((L=>null!=L))).length||!this._scene.postProcessesEnabled)return;const F=this._scene.getEngine();for(let o=0,A=mL.length;o<A;o++){const r=mL[o];var a;if(o<A-1)r._outputTexture=mL[o+1].activate(G,null===U||void 0===U?void 0:U.texture);else U?(F.bindFramebuffer(U,x,void 0,void 0,p),r._outputTexture=U):(F.restoreDefaultFramebuffer(),r._outputTexture=null),null===(a=F._debugInsertMarker)||void 0===a||a.call(F,`post process ${mL[o].name} output`);if(L)break;const h=r.apply();h&&(r.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),F.bindBuffers(this._vertexBuffers,this._indexBuffer,h),F.drawElementsType(0,0,6),r.onAfterRenderObservable.notifyObservers(h))}F.setDepthBuffer(!0),F.setDepthWrite(!0),F.setAlphaMode(0)}dispose(){const L=this._vertexBuffers[mL.h.PositionKind];L&&(L.dispose(),this._vertexBuffers[mL.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12678:(L,U,x)=>{x.d(U,{c:()=>a});var mL=x(12684),p=x(12589);class G{set opaqueSortCompareFn(L){this._opaqueSortCompareFn=L||G.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(L){this._alphaTestSortCompareFn=L||G.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(L){this._transparentSortCompareFn=L||G.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(L,U){let x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=L,this._opaqueSubMeshes=new mL.h(256),this._transparentSubMeshes=new mL.h(256),this._alphaTestSubMeshes=new mL.h(256),this._depthOnlySubMeshes=new mL.h(256),this._particleSystems=new mL.h(256),this._spriteManagers=new mL.h(256),this._empty=!0,this._edgesRenderers=new mL.d(16),this._scene=U,this.opaqueSortCompareFn=x,this.alphaTestSortCompareFn=p,this.transparentSortCompareFn=G}render(L,U,x,mL){if(L)return void L(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const p=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(p.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),p.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const G=p.getStencilBuffer();if(p.setStencilBuffer(!1),U&&this._renderSprites(),x&&this._renderParticles(mL),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(p.setStencilBuffer(G),this._scene.useOrderIndependentTransparency){const L=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);L.length&&this._renderTransparent(L)}else this._renderTransparent(this._transparentSubMeshes);p.setAlphaMode(0)}if(p.setStencilBuffer(!1),this._edgesRenderers.length){for(let L=0;L<this._edgesRenderers.length;L++)this._edgesRenderers.data[L].render();p.setAlphaMode(0)}p.setStencilBuffer(G)}_renderOpaqueSorted(L){G._RenderSorted(L,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(L){G._RenderSorted(L,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(L){G._RenderSorted(L,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(L,U,x,mL){let F,a=0;const o=x?x.globalPosition:G._ZeroVector;if(mL)for(;a<L.length;a++)F=L.data[a],F._alphaIndex=F.getMesh().alphaIndex,F._distanceToCamera=p.YU.Distance(F.getBoundingInfo().boundingSphere.centerWorld,o);const A=L.length===L.data.length?L.data:L.data.slice(0,L.length);U&&A.sort(U);const r=A[0].getMesh().PL();for(a=0;a<A.length;a++)if(F=A[a],!r._activeMeshesFrozenButKeepClipping||F.isInFrustum(r._frustumPlanes)){if(mL){const L=F.ZL();if(L&&L.needDepthPrePass){const U=L.PL().getEngine();U.setColorWrite(!1),U.setAlphaMode(0),F.render(!1),U.setColorWrite(!0)}}F.render(mL)}}static defaultTransparentSortCompare(L,U){return L._alphaIndex>U._alphaIndex?1:L._alphaIndex<U._alphaIndex?-1:G.backToFrontSortCompare(L,U)}static backToFrontSortCompare(L,U){return L._distanceToCamera<U._distanceToCamera?1:L._distanceToCamera>U._distanceToCamera?-1:0}static frontToBackSortCompare(L,U){return L._distanceToCamera<U._distanceToCamera?-1:L._distanceToCamera>U._distanceToCamera?1:0}static PainterSortCompare(L,U){const x=L.getMesh(),mL=U.getMesh();return x.material&&mL.material?x.material.uniqueId-mL.material.uniqueId:x.uniqueId-mL.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(L,U,x){void 0===U&&(U=L.getMesh()),void 0===x&&(x=L.ZL()),null!==x&&void 0!==x&&(x.needAlphaBlendingForMesh(U)?this._transparentSubMeshes.push(L):x.needAlphaTestingForMesh(U)?(x.needDepthPrePass&&this._depthOnlySubMeshes.push(L),this._alphaTestSubMeshes.push(L)):(x.needDepthPrePass&&this._depthOnlySubMeshes.push(L),this._opaqueSubMeshes.push(L)),U._renderingGroup=this,U._edgesRenderer&&U.isEnabled()&&U.isVisible&&U._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(U._edgesRenderer),this._empty=!1)}dispatchSprites(L){this._spriteManagers.push(L),this._empty=!1}dispatchParticles(L){this._particleSystems.push(L),this._empty=!1}_renderParticles(L){if(0===this._particleSystems.length)return;const U=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let x=0;x<this._particleSystems.length;x++){const mL=this._particleSystems.data[x];if(0===(U&&U.layerMask&mL.layerMask))continue;const p=mL.mx;p.position&&L&&-1===L.indexOf(p)||this._scene._activeParticles.addCount(mL.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const L=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let U=0;U<this._spriteManagers.length;U++){const x=this._spriteManagers.data[U];0!==(L&&L.layerMask&x.layerMask)&&x.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}G._ZeroVector=p.YU.Zero();class F{}class a{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(L){L!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=L,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const L of this._scene.meshes)if(L.Sa)for(const U of L.Sa)U._wasDispatched=!1;if(this._scene.spriteManagers)for(const L of this._scene.spriteManagers)L._wasDispatched=!1;for(const L of this._scene.fE)L._wasDispatched=!1}constructor(L){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new F,this._maintainStateBetweenFrames=!1,this._scene=L;for(let U=a.MIN_RENDERINGGROUPS;U<a.MAX_RENDERINGGROUPS;U++)this._autoClearDepthStencil[U]={Ya:!0,depth:!0,Aa:!0}}getRenderingGroup(L){const U=L||0;return this._prepareRenderingGroup(U),this._renderingGroups[U]}_clearDepthStencilBuffer(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,L,U),this._depthStencilBufferAlreadyCleaned=!0)}render(L,U,x,mL){const p=this._renderingGroupInfo;if(p.VU=this._scene,p.camera=this._scene.activeCamera,p.renderingManager=this,this._scene.spriteManagers&&mL)for(let G=0;G<this._scene.spriteManagers.length;G++){const L=this._scene.spriteManagers[G];this.dispatchSprites(L)}for(let G=a.MIN_RENDERINGGROUPS;G<a.MAX_RENDERINGGROUPS;G++){this._depthStencilBufferAlreadyCleaned=G===a.MIN_RENDERINGGROUPS;const F=this._renderingGroups[G];if(!F||F._empty)continue;const o=1<<G;if(p.renderingGroupId=G,this._scene.onBeforeRenderingGroupObservable.notifyObservers(p,o),a.AUTOCLEAR){const L=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(G):this._autoClearDepthStencil[G];L&&L.Ya&&this._clearDepthStencilBuffer(L.depth,L.Aa)}for(const L of this._scene._beforeRenderingGroupDrawStage)L.action(G);F.render(L,mL,x,U);for(const L of this._scene._afterRenderingGroupDrawStage)L.action(G);this._scene.onAfterRenderingGroupObservable.notifyObservers(p,o)}}reset(){if(!this.maintainStateBetweenFrames)for(let L=a.MIN_RENDERINGGROUPS;L<a.MAX_RENDERINGGROUPS;L++){const U=this._renderingGroups[L];U&&U.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let L=a.MIN_RENDERINGGROUPS;L<a.MAX_RENDERINGGROUPS;L++){const U=this._renderingGroups[L];U&&U.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let L=a.MIN_RENDERINGGROUPS;L<a.MAX_RENDERINGGROUPS;L++){const U=this._renderingGroups[L];U&&U.dispose()}}_prepareRenderingGroup(L){void 0===this._renderingGroups[L]&&(this._renderingGroups[L]=new G(L,this._scene,this._customOpaqueSortCompareFn[L],this._customAlphaTestSortCompareFn[L],this._customTransparentSortCompareFn[L]))}dispatchSprites(L){this.maintainStateBetweenFrames&&L._wasDispatched||(L._wasDispatched=!0,this.getRenderingGroup(L.renderingGroupId).dispatchSprites(L))}dispatchParticles(L){this.maintainStateBetweenFrames&&L._wasDispatched||(L._wasDispatched=!0,this.getRenderingGroup(L.renderingGroupId).dispatchParticles(L))}dispatch(L,U,x){void 0===U&&(U=L.getMesh()),this.maintainStateBetweenFrames&&L._wasDispatched||(L._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatch(L,U,x))}setRenderingOrder(L){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,mL=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[L]=U,this._customAlphaTestSortCompareFn[L]=x,this._customTransparentSortCompareFn[L]=mL,this._renderingGroups[L]){const U=this._renderingGroups[L];U.opaqueSortCompareFn=this._customOpaqueSortCompareFn[L],U.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[L],U.transparentSortCompareFn=this._customTransparentSortCompareFn[L]}}setRenderingAutoClearDepthStencil(L,U){let x=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],mL=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[L]={Ya:U,depth:x,Aa:mL}}getAutoClearDepthStencilSetup(L){return this._autoClearDepthStencil[L]}}a.MAX_RENDERINGGROUPS=4,a.MIN_RENDERINGGROUPS=0,a.AUTOCLEAR=!0}}]);