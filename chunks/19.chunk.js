"use strict";(self.fwuvyyymhp8=self.fwuvyyymhp8||[]).push([[19],{12453:(N,U,V)=>{V.d(U,{d:()=>q,f:()=>i});var A=V(12462),t=V(12193),n=V(12466);class q{get S(){return this._isDisposed}constructor(N,U,V){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0,S=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,N&&N.YN?this._engine=N.YN().getEngine():this._engine=N,this._updatable=V,this._instanced=q,this._divisor=z||1,this._label=S,U instanceof A.d?(this._data=null,this._buffer=U):(this._data=U,this._buffer=null),this.byteStride=i?t:t*Float32Array.BYTES_PER_ELEMENT,n||this.create()}createVertexBuffer(N,U,V,A,t){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6?arguments[6]:void 0;const z=n?U:U*Float32Array.BYTES_PER_ELEMENT,S=A?n?A:A*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new i(this._engine,this,N,this._updatable,!0,S,void 0===t?this._instanced:t,z,V,void 0,void 0,!0,this._divisor||q)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!N&&this._buffer||(N=N||this._data,N&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,N),this._data=N):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(N,this._label),this._data=N):this._buffer=this._engine.createVertexBuffer(N,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.SV>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.SV,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.SV,void 0,this._label));t.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(N){this.create(N)}updateDirectly(N,U,V){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,N,A?U:U*Float32Array.BYTES_PER_ELEMENT,V?V*this.byteStride:void 0),this._data=0===U&&void 0===V?N:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class i{get S(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(N){const U=0!=N;this._instanceDivisor=N,U!==this._instanced&&(this._instanced=U,this._computeHashCode())}get _maxVerticesCount(){const N=this.getData();return N?Array.isArray(N)?N.length/(this.byteStride/4)-this.byteOffset/4:(N.byteLength-this.byteOffset)/this.byteStride:0}constructor(N,U,V,A,t,z,S,E,p,k){let B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],C=arguments.length>11&&void 0!==arguments[11]&&arguments[11],x=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,J=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let d=!1;if(this.BU=N,"object"===typeof A&&null!==A?(d=A.updatable??!1,t=A.postponeInternalCreation,z=A.stride,S=A.instanced,E=A.offset,p=A.size,k=A.type,B=A.normalized??!1,C=A.useBytes??!1,x=A.divisor??1,J=A.takeBufferOwnership??!1,this._label=A.label):d=!!A,U instanceof q?(this._buffer=U,this._ownsBuffer=J):(this._buffer=new q(N,U,d,z,t,S,C,x,this._label),this._ownsBuffer=!0),this.uniqueId=i._Counter++,this._kind=V,void 0===k){const N=this.getData();this.type=N?i.GetDataType(N):i.FLOAT}else this.type=k;const r=(0,n.m)(this.type);C?(this._size=p||(z?z/r:i.DeduceStride(V)),this.byteStride=z||this._buffer.byteStride||this._size*r,this.byteOffset=E||0):(this._size=p||z||i.DeduceStride(V),this.byteStride=z?z*r:this._buffer.byteStride||this._size*r,this.byteOffset=(E||0)*r),this.normalized=B,this._instanced=void 0!==S&&S,this._instanceDivisor=S?x:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var N;null===(N=this._buffer)||void 0===N||N._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(N,U){const V=this.getData();return V?(0,n.i)(V,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,N,U):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,n.m)(this.type)}getOffset(){return this.byteOffset/(0,n.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,n.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(N){this._buffer.create(N),this._alignBuffer()}update(N){this._buffer.update(N),this._alignBuffer()}updateDirectly(N,U){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(N,U,void 0,V),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(N,U){(0,n.f)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,N,this.normalized,((N,V)=>{for(let A=0;A<this._size;A++)U(N[A],V+A)}))}_alignBuffer(){}static DeduceStride(N){switch(N){case i.UVKind:case i.UV2Kind:case i.UV3Kind:case i.UV4Kind:case i.UV5Kind:case i.UV6Kind:return 2;case i.NormalKind:case i.PositionKind:return 3;case i.ColorKind:case i.ColorInstanceKind:case i.MatricesIndicesKind:case i.MatricesIndicesExtraKind:case i.MatricesWeightsKind:case i.MatricesWeightsExtraKind:case i.TangentKind:return 4;default:throw new Error("Invalid kind '"+N+"'")}}static GetDataType(N){return N instanceof Int8Array?i.BYTE:N instanceof Uint8Array?i.UNSIGNED_BYTE:N instanceof Int16Array?i.SHORT:N instanceof Uint16Array?i.UNSIGNED_SHORT:N instanceof Int32Array?i.INT:N instanceof Uint32Array?i.UNSIGNED_INT:i.FLOAT}static GetTypeByteLength(N){return(0,n.m)(N)}static ForEach(N,U,V,A,t,q,i,z){(0,n.f)(N,U,V,A,t,q,i,((N,U)=>{for(let V=0;V<A;V++)z(N[V],U+V)}))}static GetFloatData(N,U,V,A,t,q,i,z){return(0,n.i)(N,U,V,A,t,q,i,z)}}i._Counter=0,i.BYTE=5120,i.UNSIGNED_BYTE=5121,i.SHORT=5122,i.UNSIGNED_SHORT=5123,i.INT=5124,i.UNSIGNED_INT=5125,i.FLOAT=5126,i.PositionKind="position",i.NormalKind="normal",i.TangentKind="tangent",i.UVKind="uv",i.UV2Kind="uv2",i.UV3Kind="uv3",i.UV4Kind="uv4",i.UV5Kind="uv5",i.UV6Kind="uv6",i.ColorKind="color",i.ColorInstanceKind="instanceColor",i.MatricesIndicesKind="matricesIndices",i.MatricesWeightsKind="matricesWeights",i.MatricesIndicesExtraKind="matricesIndicesExtra",i.MatricesWeightsExtraKind="matricesWeightsExtra"},12466:(N,U,V)=>{V.d(U,{c:()=>k,e:()=>p,f:()=>z,i:()=>S,m:()=>q,p:()=>i,q:()=>E});var A=V(12193);function t(N,U,V,A){switch(U){case 5120:{let U=N.getInt8(V);return A&&(U=Math.max(U/127,-1)),U}case 5121:{let U=N.getUint8(V);return A&&(U/=255),U}case 5122:{let U=N.getInt16(V,!0);return A&&(U=Math.max(U/32767,-1)),U}case 5123:{let U=N.getUint16(V,!0);return A&&(U/=65535),U}case 5124:return N.getInt32(V,!0);case 5125:return N.getUint32(V,!0);case 5126:return N.getFloat32(V,!0);default:throw new Error(`Invalid component type ${U}`)}}function n(N,U,V,A,t){switch(U){case 5120:A&&(t=Math.round(127*t)),N.setInt8(V,t);break;case 5121:A&&(t=Math.round(255*t)),N.setUint8(V,t);break;case 5122:A&&(t=Math.round(32767*t)),N.setInt16(V,t,!0);break;case 5123:A&&(t=Math.round(65535*t)),N.setUint16(V,t,!0);break;case 5124:N.setInt32(V,t,!0);break;case 5125:N.setUint32(V,t,!0);break;case 5126:N.setFloat32(V,t,!0);break;default:throw new Error(`Invalid component type ${U}`)}}function q(N){switch(N){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${N}'`)}}function i(N){switch(N){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${N}'`)}}function z(N,U,V,A,i,z,S,E){const p=new Array(A),k=new Array(A);if(N instanceof Array){let t=U/4;const n=V/4;for(let U=0;U<z;U+=A){for(let U=0;U<A;U++)p[U]=k[U]=N[t+U];E(k,U);for(let U=0;U<A;U++)p[U]!==k[U]&&(N[t+U]=k[U]);t+=n}}else{const B=ArrayBuffer.isView(N)?new DataView(N.buffer,N.byteOffset,N.byteLength):new DataView(N),C=q(i);for(let N=0;N<z;N+=A){for(let N=0,V=U;N<A;N++,V+=C)p[N]=k[N]=t(B,i,V,S);E(k,N);for(let N=0,V=U;N<A;N++,V+=C)p[N]!==k[N]&&n(B,i,V,S,k[N]);U+=V}}}function S(N,U,V,t,n,i,S,E){const p=U*q(V),k=S*U;if(5126!==V||n!==p){const A=new Float32Array(k);return z(N,t,n,U,V,k,i,((N,V)=>{for(let t=0;t<U;t++)A[V+t]=N[t]})),A}if(!(N instanceof Array||N instanceof Float32Array)||0!==t||N.length!==k){if(N instanceof Array){const U=t/4;return N.slice(U,U+k)}if(N instanceof ArrayBuffer)return new Float32Array(N,t,k);{const U=N.byteOffset+t;return 0!==(3&U)&&(A.b.Warn("Float array must be aligned to 4-bytes border"),E=!0),E?new Float32Array(N.buffer.slice(U,U+k*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(N.buffer,U,k)}}return E?N.slice():N}function E(N,U,V,t,n,S,E,p){const k=q(V),B=i(V),C=E*U;if(Array.isArray(N)){if(0!==(3&t)||0!==(3&n))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const A=t/4,q=n/4;if(A+(E-1)*q+U>N.length)throw new Error("Last accessed index is out of bounds.");if(q<U)throw new Error("Data stride cannot be smaller than the component size.");if(q!==U){const A=new B(C);return z(N,t,n,U,V,C,S,((N,V)=>{for(let t=0;t<U;t++)A[V+t]=N[t]})),A}return new B(N.slice(A,A+C))}let x,J=t;N instanceof ArrayBuffer?x=N:(x=N.buffer,J+=N.byteOffset);if(J+(E-1)*n+U*k>x.byteLength)throw new Error("Last accessed byte is out of bounds.");const d=U*k;if(n<d)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(n!==d){const N=new B(C);return z(x,J,n,U,V,C,S,((V,A)=>{for(let t=0;t<U;t++)N[A+t]=V[t]})),N}return 1!==k&&0!==(J&k-1)&&(A.b.Warn("Array must be aligned to border of element size. Data will be copied."),p=!0),p?new B(x.slice(J,J+C*k)):new B(x,J,C)}function p(N,U,V,t,n,i,S,E){const p=U*q(V),k=S*U;if(E.length!==k)throw new Error("Output length is not valid");if(5126===V&&n===p)if(N instanceof Array){const U=t/4;E.set(N,U)}else if(N instanceof ArrayBuffer){const U=new Float32Array(N,t,k);E.set(U)}else{const U=N.byteOffset+t;if(0!==(3&U))return A.b.Warn("Float array must be aligned to 4-bytes border"),void E.set(new Float32Array(N.buffer.slice(U,U+k*Float32Array.BYTES_PER_ELEMENT)));const V=new Float32Array(N.buffer,U,k);E.set(V)}else z(N,t,n,U,V,k,i,((N,V)=>{for(let A=0;A<U;A++)E[V+A]=N[A]}))}function k(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(N)){for(let t=0;t<U;t++)if(N[V+t]-A>65535)return!0;return!1}return 4===N.BYTES_PER_ELEMENT}},12462:(N,U,V)=>{V.d(U,{d:()=>A});class A{get underlyingResource(){return null}constructor(){this.references=0,this.SV=0,this.is32Bits=!1,this.uniqueId=A._Counter++}}A._Counter=0},12500:(N,U,V)=>{V.d(U,{b:()=>t});var A=V(12264);class t{static GetEffect(N){return void 0===N.getPipelineContext?N.effect:N}constructor(N){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=N.createDrawContext(),U&&(this.materialContext=N.createMaterialContext())}setEffect(N,U){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var A;(this.effect=N,void 0!==U&&(this.defines=U),V)&&(null===(A=this.drawContext)||void 0===A||A.reset())}dispose(){var N;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const N=this.effect;U?N.dispose():A.c.SetImmediate((()=>{N.getEngine().onEndFrameObservable.addOnce((()=>{N.dispose()}))})),this.effect=null}null===(N=this.drawContext)||void 0===N||N.dispose()}}},12571:(N,U,V)=>{V.d(U,{b:()=>t});var A=V(12429);class t{static GetPlanes(N){const U=[];for(let V=0;V<6;V++)U.push(new A.d(0,0,0,0));return t.GetPlanesToRef(N,U),U}static GetNearPlaneToRef(N,U){const V=N.m;U.normal.x=V[3]+V[2],U.normal.y=V[7]+V[6],U.normal.z=V[11]+V[10],U.d=V[15]+V[14],U.normalize()}static GetFarPlaneToRef(N,U){const V=N.m;U.normal.x=V[3]-V[2],U.normal.y=V[7]-V[6],U.normal.z=V[11]-V[10],U.d=V[15]-V[14],U.normalize()}static GetLeftPlaneToRef(N,U){const V=N.m;U.normal.x=V[3]+V[0],U.normal.y=V[7]+V[4],U.normal.z=V[11]+V[8],U.d=V[15]+V[12],U.normalize()}static GetRightPlaneToRef(N,U){const V=N.m;U.normal.x=V[3]-V[0],U.normal.y=V[7]-V[4],U.normal.z=V[11]-V[8],U.d=V[15]-V[12],U.normalize()}static GetTopPlaneToRef(N,U){const V=N.m;U.normal.x=V[3]-V[1],U.normal.y=V[7]-V[5],U.normal.z=V[11]-V[9],U.d=V[15]-V[13],U.normalize()}static GetBottomPlaneToRef(N,U){const V=N.m;U.normal.x=V[3]+V[1],U.normal.y=V[7]+V[5],U.normal.z=V[11]+V[9],U.d=V[15]+V[13],U.normalize()}static GetPlanesToRef(N,U){t.GetNearPlaneToRef(N,U[0]),t.GetFarPlaneToRef(N,U[1]),t.GetLeftPlaneToRef(N,U[2]),t.GetRightPlaneToRef(N,U[3]),t.GetTopPlaneToRef(N,U[4]),t.GetBottomPlaneToRef(N,U[5])}static IsPointInFrustum(N,U){for(let V=0;V<6;V++)if(U[V].dotCoordinate(N)<0)return!1;return!0}}},12579:(N,U,V)=>{V.d(U,{d:()=>t});var A=V(12200);class t{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(N,U){t.Enabled&&(this._current+=N,U&&this._fetchResult())}beginMonitoring(){t.Enabled&&(this._startMonitoringTime=A.b.Now)}endMonitoring(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!t.Enabled)return;N&&this.fetchNewFrame();const U=A.b.Now;this._current=U-this._startMonitoringTime,N&&this._fetchResult()}eq(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const N=A.b.Now;N-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=N,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}t.Enabled=!0},12481:(N,U,V)=>{V.d(U,{d:()=>t,h:()=>A});class A{constructor(N){this.length=0,this.data=new Array(N),this._id=A._GlobalId++}push(N){this.data[this.length++]=N,this.length>this.data.length&&(this.data.length*=2)}forEach(N){for(let U=0;U<this.length;U++)N(this.data[U])}sort(N){this.data.sort(N)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(N){if(0!==N.length){this.length+N.length>this.data.length&&(this.data.length=2*(this.length+N.length));for(let U=0;U<N.length;U++)this.data[this.length++]=(N.data||N)[U]}}indexOf(N){const U=this.data.indexOf(N);return U>=this.length?-1:U}contains(N){return-1!==this.indexOf(N)}}A._GlobalId=0;class t extends A{constructor(){super(...arguments),this._duplicateId=0}push(N){super.push(N),N.__smartArrayFlags||(N.__smartArrayFlags={}),N.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(N){return(!N.__smartArrayFlags||N.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(N),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(N){if(0!==N.length){this.length+N.length>this.data.length&&(this.data.length=2*(this.length+N.length));for(let U=0;U<N.length;U++){const V=(N.data||N)[U];this.pushNoDuplicate(V)}}}}},12448:(N,U,V)=>{V.d(U,{c:()=>n});var A=V(12453),t=V(12182);class n{constructor(N){this._vertexBuffers={},this.onBeforeRenderObservable=new t.d,this._scene=N}_prepareBuffers(){if(this._vertexBuffers[A.f.PositionKind])return;const N=[];N.push(1,1),N.push(-1,1),N.push(-1,-1),N.push(1,-1),this._vertexBuffers[A.f.PositionKind]=new A.f(this._scene.getEngine(),N,A.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const N=[];N.push(0),N.push(1),N.push(2),N.push(0),N.push(2),N.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(N)}_rebuild(){const N=this._vertexBuffers[A.f.PositionKind];N&&(N._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=this._scene.activeCamera;return!!V&&(U=U||V._postProcesses.filter((N=>null!=N)),!(!U||0===U.length||!this._scene.postProcessesEnabled)&&(U[0].activate(V,N,null!==U&&void 0!==U),!0))}directRender(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:N.length;const i=this._scene.getEngine();for(let S=0;S<q;S++){var z;if(S<N.length-1)N[S+1].activate(this._scene.activeCamera||this._scene,null===U||void 0===U?void 0:U.texture);else U?i.bindFramebuffer(U,A,void 0,void 0,V,t):n||i.restoreDefaultFramebuffer(),null===(z=i._debugInsertMarker)||void 0===z||z.call(i,`post process ${N[S].name} output`);const q=N[S],E=q.apply();E&&(q.onBeforeRenderObservable.notifyObservers(E),this._prepareBuffers(),i.bindBuffers(this._vertexBuffers,this._indexBuffer,E),i.drawElementsType(0,0,6),q.onAfterRenderObservable.notifyObservers(E))}i.setDepthBuffer(!0),i.setDepthWrite(!0)}_finalizeFrame(N,U,V,A){let t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=this._scene.activeCamera;if(!n)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(A=A||n._postProcesses.filter((N=>null!=N))).length||!this._scene.postProcessesEnabled)return;const q=this._scene.getEngine();for(let z=0,S=A.length;z<S;z++){const E=A[z];var i;if(z<S-1)E._outputTexture=A[z+1].activate(n,null===U||void 0===U?void 0:U.texture);else U?(q.bindFramebuffer(U,V,void 0,void 0,t),E._outputTexture=U):(q.restoreDefaultFramebuffer(),E._outputTexture=null),null===(i=q._debugInsertMarker)||void 0===i||i.call(q,`post process ${A[z].name} output`);if(N)break;const p=E.apply();p&&(E.onBeforeRenderObservable.notifyObservers(p),this._prepareBuffers(),q.bindBuffers(this._vertexBuffers,this._indexBuffer,p),q.drawElementsType(0,0,6),E.onAfterRenderObservable.notifyObservers(p))}q.setDepthBuffer(!0),q.setDepthWrite(!0),q.setAlphaMode(0)}dispose(){const N=this._vertexBuffers[A.f.PositionKind];N&&(N.dispose(),this._vertexBuffers[A.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12474:(N,U,V)=>{V.d(U,{e:()=>i});var A=V(12481),t=V(12383);class n{set opaqueSortCompareFn(N){this._opaqueSortCompareFn=N||n.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(N){this._alphaTestSortCompareFn=N||n.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(N){this._transparentSortCompareFn=N||n.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(N,U){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=N,this._opaqueSubMeshes=new A.h(256),this._transparentSubMeshes=new A.h(256),this._alphaTestSubMeshes=new A.h(256),this._depthOnlySubMeshes=new A.h(256),this._particleSystems=new A.h(256),this._spriteManagers=new A.h(256),this._empty=!0,this._edgesRenderers=new A.d(16),this._scene=U,this.opaqueSortCompareFn=V,this.alphaTestSortCompareFn=t,this.transparentSortCompareFn=n}render(N,U,V,A){if(N)return void N(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const t=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(t.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),t.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const n=t.getStencilBuffer();if(t.setStencilBuffer(!1),U&&this._renderSprites(),V&&this._renderParticles(A),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(t.setStencilBuffer(n),this._scene.useOrderIndependentTransparency){const N=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);N.length&&this._renderTransparent(N)}else this._renderTransparent(this._transparentSubMeshes);t.setAlphaMode(0)}if(t.setStencilBuffer(!1),this._edgesRenderers.length){for(let N=0;N<this._edgesRenderers.length;N++)this._edgesRenderers.data[N].render();t.setAlphaMode(0)}t.setStencilBuffer(n)}_renderOpaqueSorted(N){n._RenderSorted(N,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(N){n._RenderSorted(N,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(N){n._RenderSorted(N,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(N,U,V,A){let q,i=0;const z=V?V.globalPosition:n._ZeroVector;if(A)for(;i<N.length;i++)q=N.data[i],q._alphaIndex=q.getMesh().alphaIndex,q._distanceToCamera=t.CU.Distance(q.getBoundingInfo().boundingSphere.centerWorld,z);const S=N.length===N.data.length?N.data:N.data.slice(0,N.length);U&&S.sort(U);const E=S[0].getMesh().YN();for(i=0;i<S.length;i++)if(q=S[i],!E._activeMeshesFrozenButKeepClipping||q.isInFrustum(E._frustumPlanes)){if(A){const N=q.IN();if(N&&N.needDepthPrePass){const U=N.YN().getEngine();U.setColorWrite(!1),U.setAlphaMode(0),q.render(!1),U.setColorWrite(!0)}}q.render(A)}}static defaultTransparentSortCompare(N,U){return N._alphaIndex>U._alphaIndex?1:N._alphaIndex<U._alphaIndex?-1:n.backToFrontSortCompare(N,U)}static backToFrontSortCompare(N,U){return N._distanceToCamera<U._distanceToCamera?1:N._distanceToCamera>U._distanceToCamera?-1:0}static frontToBackSortCompare(N,U){return N._distanceToCamera<U._distanceToCamera?-1:N._distanceToCamera>U._distanceToCamera?1:0}static PainterSortCompare(N,U){const V=N.getMesh(),A=U.getMesh();return V.material&&A.material?V.material.uniqueId-A.material.uniqueId:V.uniqueId-A.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(N,U,V){void 0===U&&(U=N.getMesh()),void 0===V&&(V=N.IN()),null!==V&&void 0!==V&&(V.needAlphaBlendingForMesh(U)?this._transparentSubMeshes.push(N):V.needAlphaTestingForMesh(U)?(V.needDepthPrePass&&this._depthOnlySubMeshes.push(N),this._alphaTestSubMeshes.push(N)):(V.needDepthPrePass&&this._depthOnlySubMeshes.push(N),this._opaqueSubMeshes.push(N)),U._renderingGroup=this,U._edgesRenderer&&U.isEnabled()&&U.isVisible&&U._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(U._edgesRenderer),this._empty=!1)}dispatchSprites(N){this._spriteManagers.push(N),this._empty=!1}dispatchParticles(N){this._particleSystems.push(N),this._empty=!1}_renderParticles(N){if(0===this._particleSystems.length)return;const U=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let V=0;V<this._particleSystems.length;V++){const A=this._particleSystems.data[V];if(0===(U&&U.layerMask&A.layerMask))continue;const t=A.AU;t.position&&N&&-1===N.indexOf(t)||this._scene._activeParticles.addCount(A.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const N=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let U=0;U<this._spriteManagers.length;U++){const V=this._spriteManagers.data[U];0!==(N&&N.layerMask&V.layerMask)&&V.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}n._ZeroVector=t.CU.Zero();class q{}class i{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(N){N!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=N,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const N of this._scene.meshes)if(N.Ei)for(const U of N.Ei)U._wasDispatched=!1;if(this._scene.spriteManagers)for(const N of this._scene.spriteManagers)N._wasDispatched=!1;for(const N of this._scene.yp)N._wasDispatched=!1}constructor(N){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new q,this._maintainStateBetweenFrames=!1,this._scene=N;for(let U=i.MIN_RENDERINGGROUPS;U<i.MAX_RENDERINGGROUPS;U++)this._autoClearDepthStencil[U]={Si:!0,depth:!0,ti:!0}}getRenderingGroup(N){const U=N||0;return this._prepareRenderingGroup(U),this._renderingGroups[U]}_clearDepthStencilBuffer(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,N,U),this._depthStencilBufferAlreadyCleaned=!0)}render(N,U,V,A){const t=this._renderingGroupInfo;if(t.JU=this._scene,t.camera=this._scene.activeCamera,t.renderingManager=this,this._scene.spriteManagers&&A)for(let n=0;n<this._scene.spriteManagers.length;n++){const N=this._scene.spriteManagers[n];this.dispatchSprites(N)}for(let n=i.MIN_RENDERINGGROUPS;n<i.MAX_RENDERINGGROUPS;n++){this._depthStencilBufferAlreadyCleaned=n===i.MIN_RENDERINGGROUPS;const q=this._renderingGroups[n];if(!q||q._empty)continue;const z=1<<n;if(t.renderingGroupId=n,this._scene.onBeforeRenderingGroupObservable.notifyObservers(t,z),i.AUTOCLEAR){const N=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(n):this._autoClearDepthStencil[n];N&&N.Si&&this._clearDepthStencilBuffer(N.depth,N.ti)}for(const N of this._scene._beforeRenderingGroupDrawStage)N.action(n);q.render(N,A,V,U);for(const N of this._scene._afterRenderingGroupDrawStage)N.action(n);this._scene.onAfterRenderingGroupObservable.notifyObservers(t,z)}}reset(){if(!this.maintainStateBetweenFrames)for(let N=i.MIN_RENDERINGGROUPS;N<i.MAX_RENDERINGGROUPS;N++){const U=this._renderingGroups[N];U&&U.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let N=i.MIN_RENDERINGGROUPS;N<i.MAX_RENDERINGGROUPS;N++){const U=this._renderingGroups[N];U&&U.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let N=i.MIN_RENDERINGGROUPS;N<i.MAX_RENDERINGGROUPS;N++){const U=this._renderingGroups[N];U&&U.dispose()}}_prepareRenderingGroup(N){void 0===this._renderingGroups[N]&&(this._renderingGroups[N]=new n(N,this._scene,this._customOpaqueSortCompareFn[N],this._customAlphaTestSortCompareFn[N],this._customTransparentSortCompareFn[N]))}dispatchSprites(N){this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(N.renderingGroupId).dispatchSprites(N))}dispatchParticles(N){this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(N.renderingGroupId).dispatchParticles(N))}dispatch(N,U,V){void 0===U&&(U=N.getMesh()),this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatch(N,U,V))}setRenderingOrder(N){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[N]=U,this._customAlphaTestSortCompareFn[N]=V,this._customTransparentSortCompareFn[N]=A,this._renderingGroups[N]){const U=this._renderingGroups[N];U.opaqueSortCompareFn=this._customOpaqueSortCompareFn[N],U.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[N],U.transparentSortCompareFn=this._customTransparentSortCompareFn[N]}}setRenderingAutoClearDepthStencil(N,U){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[N]={Si:U,depth:V,ti:A}}getAutoClearDepthStencilSetup(N){return this._autoClearDepthStencil[N]}}i.MAX_RENDERINGGROUPS=4,i.MIN_RENDERINGGROUPS=0,i.AUTOCLEAR=!0}}]);