"use strict";(self.c2c3ycupenc=self.c2c3ycupenc||[]).push([[19],{11750:(c,r,D)=>{D.d(r,{b:()=>u,d:()=>a});var W=D(11756),B=D(11509),t=D(11759);class u{get M(){return this._isDisposed}constructor(c,r,D){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7?arguments[7]:void 0,x=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,c&&c.yc?this._engine=c.yc().getEngine():this._engine=c,this._updatable=D,this._instanced=u,this._divisor=H||1,this._label=x,r instanceof W.e?(this._data=null,this._buffer=r):(this._data=r,this._buffer=null),this.byteStride=a?B:B*Float32Array.BYTES_PER_ELEMENT,t||this.create()}createVertexBuffer(c,r,D,W,B){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6?arguments[6]:void 0;const H=t?r:r*Float32Array.BYTES_PER_ELEMENT,x=W?t?W:W*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new a(this._engine,this,c,this._updatable,!0,x,void 0===B?this._instanced:B,H,D,void 0,void 0,!0,this._divisor||u)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!c&&this._buffer||(c=c||this._data,c&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,c),this._data=c):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(c,this._label),this._data=c):this._buffer=this._engine.createVertexBuffer(c,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.wD>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.wD,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.wD,void 0,this._label));B.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(c){this.create(c)}updateDirectly(c,r,D){let W=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,c,W?r:r*Float32Array.BYTES_PER_ELEMENT,D?D*this.byteStride:void 0),this._data=0===r&&void 0===D?c:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class a{get M(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(c){const r=0!=c;this._instanceDivisor=c,r!==this._instanced&&(this._instanced=r,this._computeHashCode())}get _maxVerticesCount(){const c=this.getData();return c?Array.isArray(c)?c.length/(this.byteStride/4)-this.byteOffset/4:(c.byteLength-this.byteOffset)/this.byteStride:0}constructor(c,r,D,W,B,H,x,M,E,m){let Y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]&&arguments[11],k=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,w=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let Z=!1;if(this.wr=c,"object"===typeof W&&null!==W?(Z=W.updatable??!1,B=W.postponeInternalCreation,H=W.stride,x=W.instanced,M=W.offset,E=W.size,m=W.type,Y=W.normalized??!1,v=W.useBytes??!1,k=W.divisor??1,w=W.takeBufferOwnership??!1,this._label=W.label):Z=!!W,r instanceof u?(this._buffer=r,this._ownsBuffer=w):(this._buffer=new u(c,r,Z,H,B,x,v,k,this._label),this._ownsBuffer=!0),this.uniqueId=a._Counter++,this._kind=D,void 0===m){const c=this.getData();this.type=c?a.GetDataType(c):a.FLOAT}else this.type=m;const J=(0,t.o)(this.type);v?(this._size=E||(H?H/J:a.DeduceStride(D)),this.byteStride=H||this._buffer.byteStride||this._size*J,this.byteOffset=M||0):(this._size=E||H||a.DeduceStride(D),this.byteStride=H?H*J:this._buffer.byteStride||this._size*J,this.byteOffset=(M||0)*J),this.normalized=Y,this._instanced=void 0!==x&&x,this._instanceDivisor=x?k:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var c;null===(c=this._buffer)||void 0===c||c._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(c,r){const D=this.getData();return D?(0,t.n)(D,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,c,r):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,t.o)(this.type)}getOffset(){return this.byteOffset/(0,t.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,t.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(c){this._buffer.create(c),this._alignBuffer()}update(c){this._buffer.update(c),this._alignBuffer()}updateDirectly(c,r){let D=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(c,r,void 0,D),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(c,r){(0,t.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,c,this.normalized,((c,D)=>{for(let W=0;W<this._size;W++)r(c[W],D+W)}))}_alignBuffer(){}static DeduceStride(c){switch(c){case a.UVKind:case a.UV2Kind:case a.UV3Kind:case a.UV4Kind:case a.UV5Kind:case a.UV6Kind:return 2;case a.NormalKind:case a.PositionKind:return 3;case a.ColorKind:case a.ColorInstanceKind:case a.MatricesIndicesKind:case a.MatricesIndicesExtraKind:case a.MatricesWeightsKind:case a.MatricesWeightsExtraKind:case a.TangentKind:return 4;default:throw new Error("Invalid kind '"+c+"'")}}static GetDataType(c){return c instanceof Int8Array?a.BYTE:c instanceof Uint8Array?a.UNSIGNED_BYTE:c instanceof Int16Array?a.SHORT:c instanceof Uint16Array?a.UNSIGNED_SHORT:c instanceof Int32Array?a.INT:c instanceof Uint32Array?a.UNSIGNED_INT:a.FLOAT}static GetTypeByteLength(c){return(0,t.o)(c)}static ForEach(c,r,D,W,B,u,a,H){(0,t.j)(c,r,D,W,B,u,a,((c,r)=>{for(let D=0;D<W;D++)H(c[D],r+D)}))}static GetFloatData(c,r,D,W,B,u,a,H){return(0,t.n)(c,r,D,W,B,u,a,H)}}a._Counter=0,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="normal",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra"},11759:(c,r,D)=>{D.d(r,{e:()=>m,h:()=>E,j:()=>H,n:()=>x,o:()=>u,r:()=>a,u:()=>M});var W=D(11509);function B(c,r,D,W){switch(r){case 5120:{let r=c.getInt8(D);return W&&(r=Math.max(r/127,-1)),r}case 5121:{let r=c.getUint8(D);return W&&(r/=255),r}case 5122:{let r=c.getInt16(D,!0);return W&&(r=Math.max(r/32767,-1)),r}case 5123:{let r=c.getUint16(D,!0);return W&&(r/=65535),r}case 5124:return c.getInt32(D,!0);case 5125:return c.getUint32(D,!0);case 5126:return c.getFloat32(D,!0);default:throw new Error(`Invalid component type ${r}`)}}function t(c,r,D,W,B){switch(r){case 5120:W&&(B=Math.round(127*B)),c.setInt8(D,B);break;case 5121:W&&(B=Math.round(255*B)),c.setUint8(D,B);break;case 5122:W&&(B=Math.round(32767*B)),c.setInt16(D,B,!0);break;case 5123:W&&(B=Math.round(65535*B)),c.setUint16(D,B,!0);break;case 5124:c.setInt32(D,B,!0);break;case 5125:c.setUint32(D,B,!0);break;case 5126:c.setFloat32(D,B,!0);break;default:throw new Error(`Invalid component type ${r}`)}}function u(c){switch(c){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${c}'`)}}function a(c){switch(c){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${c}'`)}}function H(c,r,D,W,a,H,x,M){const E=new Array(W),m=new Array(W);if(c instanceof Array){let B=r/4;const t=D/4;for(let r=0;r<H;r+=W){for(let r=0;r<W;r++)E[r]=m[r]=c[B+r];M(m,r);for(let r=0;r<W;r++)E[r]!==m[r]&&(c[B+r]=m[r]);B+=t}}else{const Y=ArrayBuffer.isView(c)?new DataView(c.buffer,c.byteOffset,c.byteLength):new DataView(c),v=u(a);for(let c=0;c<H;c+=W){for(let c=0,D=r;c<W;c++,D+=v)E[c]=m[c]=B(Y,a,D,x);M(m,c);for(let c=0,D=r;c<W;c++,D+=v)E[c]!==m[c]&&t(Y,a,D,x,m[c]);r+=D}}}function x(c,r,D,B,t,a,x,M){const E=r*u(D),m=x*r;if(5126!==D||t!==E){const W=new Float32Array(m);return H(c,B,t,r,D,m,a,((c,D)=>{for(let B=0;B<r;B++)W[D+B]=c[B]})),W}if(!(c instanceof Array||c instanceof Float32Array)||0!==B||c.length!==m){if(c instanceof Array){const r=B/4;return c.slice(r,r+m)}if(c instanceof ArrayBuffer)return new Float32Array(c,B,m);{const r=c.byteOffset+B;return 0!==(3&r)&&(W.e.Warn("Float array must be aligned to 4-bytes border"),M=!0),M?new Float32Array(c.buffer.slice(r,r+m*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(c.buffer,r,m)}}return M?c.slice():c}function M(c,r,D,B,t,x,M,E){const m=u(D),Y=a(D),v=M*r;if(Array.isArray(c)){if(0!==(3&B)||0!==(3&t))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const W=B/4,u=t/4;if(W+(M-1)*u+r>c.length)throw new Error("Last accessed index is out of bounds.");if(u<r)throw new Error("Data stride cannot be smaller than the component size.");if(u!==r){const W=new Y(v);return H(c,B,t,r,D,v,x,((c,D)=>{for(let B=0;B<r;B++)W[D+B]=c[B]})),W}return new Y(c.slice(W,W+v))}let k,w=B;c instanceof ArrayBuffer?k=c:(k=c.buffer,w+=c.byteOffset);if(w+(M-1)*t+r*m>k.byteLength)throw new Error("Last accessed byte is out of bounds.");const Z=r*m;if(t<Z)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(t!==Z){const c=new Y(v);return H(k,w,t,r,D,v,x,((D,W)=>{for(let B=0;B<r;B++)c[W+B]=D[B]})),c}return 1!==m&&0!==(w&m-1)&&(W.e.Warn("Array must be aligned to border of element size. Data will be copied."),E=!0),E?new Y(k.slice(w,w+v*m)):new Y(k,w,v)}function E(c,r,D,B,t,a,x,M){const E=r*u(D),m=x*r;if(M.length!==m)throw new Error("Output length is not valid");if(5126===D&&t===E)if(c instanceof Array){const r=B/4;M.set(c,r)}else if(c instanceof ArrayBuffer){const r=new Float32Array(c,B,m);M.set(r)}else{const r=c.byteOffset+B;if(0!==(3&r))return W.e.Warn("Float array must be aligned to 4-bytes border"),void M.set(new Float32Array(c.buffer.slice(r,r+m*Float32Array.BYTES_PER_ELEMENT)));const D=new Float32Array(c.buffer,r,m);M.set(D)}else H(c,B,t,r,D,m,a,((c,D)=>{for(let W=0;W<r;W++)M[D+W]=c[W]}))}function m(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(c)){for(let B=0;B<r;B++)if(c[D+B]-W>65535)return!0;return!1}return 4===c.BYTES_PER_ELEMENT}},11756:(c,r,D)=>{D.d(r,{e:()=>W});class W{get underlyingResource(){return null}constructor(){this.references=0,this.wD=0,this.is32Bits=!1,this.uniqueId=W._Counter++}}W._Counter=0},11782:(c,r,D)=>{D.d(r,{c:()=>B});var W=D(11581);class B{static GetEffect(c){return void 0===c.getPipelineContext?c.effect:c}constructor(c){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=c.createDrawContext(),r&&(this.materialContext=c.createMaterialContext())}setEffect(c,r){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var W;(this.effect=c,void 0!==r&&(this.defines=r),D)&&(null===(W=this.drawContext)||void 0===W||W.reset())}dispose(){var c;let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const c=this.effect;r?c.dispose():W.d.SetImmediate((()=>{c.getEngine().onEndFrameObservable.addOnce((()=>{c.dispose()}))})),this.effect=null}null===(c=this.drawContext)||void 0===c||c.dispose()}}},11894:(c,r,D)=>{D.d(r,{e:()=>B});var W=D(11729);class B{static GetPlanes(c){const r=[];for(let D=0;D<6;D++)r.push(new W.d(0,0,0,0));return B.GetPlanesToRef(c,r),r}static GetNearPlaneToRef(c,r){const D=c.m;r.normal.x=D[3]+D[2],r.normal.y=D[7]+D[6],r.normal.z=D[11]+D[10],r.d=D[15]+D[14],r.normalize()}static GetFarPlaneToRef(c,r){const D=c.m;r.normal.x=D[3]-D[2],r.normal.y=D[7]-D[6],r.normal.z=D[11]-D[10],r.d=D[15]-D[14],r.normalize()}static GetLeftPlaneToRef(c,r){const D=c.m;r.normal.x=D[3]+D[0],r.normal.y=D[7]+D[4],r.normal.z=D[11]+D[8],r.d=D[15]+D[12],r.normalize()}static GetRightPlaneToRef(c,r){const D=c.m;r.normal.x=D[3]-D[0],r.normal.y=D[7]-D[4],r.normal.z=D[11]-D[8],r.d=D[15]-D[12],r.normalize()}static GetTopPlaneToRef(c,r){const D=c.m;r.normal.x=D[3]-D[1],r.normal.y=D[7]-D[5],r.normal.z=D[11]-D[9],r.d=D[15]-D[13],r.normalize()}static GetBottomPlaneToRef(c,r){const D=c.m;r.normal.x=D[3]+D[1],r.normal.y=D[7]+D[5],r.normal.z=D[11]+D[9],r.d=D[15]+D[13],r.normalize()}static GetPlanesToRef(c,r){B.GetNearPlaneToRef(c,r[0]),B.GetFarPlaneToRef(c,r[1]),B.GetLeftPlaneToRef(c,r[2]),B.GetRightPlaneToRef(c,r[3]),B.GetTopPlaneToRef(c,r[4]),B.GetBottomPlaneToRef(c,r[5])}static IsPointInFrustum(c,r){for(let D=0;D<6;D++)if(r[D].dotCoordinate(c)<0)return!1;return!0}}},11902:(c,r,D)=>{D.d(r,{b:()=>B});var W=D(11517);class B{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(c,r){B.Enabled&&(this._current+=c,r&&this._fetchResult())}beginMonitoring(){B.Enabled&&(this._startMonitoringTime=W.e.Now)}endMonitoring(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!B.Enabled)return;c&&this.fetchNewFrame();const r=W.e.Now;this._current=r-this._startMonitoringTime,c&&this._fetchResult()}Da(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const c=W.e.Now;c-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=c,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}B.Enabled=!0},11766:(c,r,D)=>{D.d(r,{d:()=>B,e:()=>W});class W{constructor(c){this.length=0,this.data=new Array(c),this._id=W._GlobalId++}push(c){this.data[this.length++]=c,this.length>this.data.length&&(this.data.length*=2)}forEach(c){for(let r=0;r<this.length;r++)c(this.data[r])}sort(c){this.data.sort(c)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(c){if(0!==c.length){this.length+c.length>this.data.length&&(this.data.length=2*(this.length+c.length));for(let r=0;r<c.length;r++)this.data[this.length++]=(c.data||c)[r]}}indexOf(c){const r=this.data.indexOf(c);return r>=this.length?-1:r}contains(c){return-1!==this.indexOf(c)}}W._GlobalId=0;class B extends W{constructor(){super(...arguments),this._duplicateId=0}push(c){super.push(c),c.__smartArrayFlags||(c.__smartArrayFlags={}),c.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(c){return(!c.__smartArrayFlags||c.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(c),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(c){if(0!==c.length){this.length+c.length>this.data.length&&(this.data.length=2*(this.length+c.length));for(let r=0;r<c.length;r++){const D=(c.data||c)[r];this.pushNoDuplicate(D)}}}}},11744:(c,r,D)=>{D.d(r,{e:()=>t});var W=D(11750),B=D(11494);class t{constructor(c){this._vertexBuffers={},this.onBeforeRenderObservable=new B.c,this._scene=c}_prepareBuffers(){if(this._vertexBuffers[W.d.PositionKind])return;const c=[];c.push(1,1),c.push(-1,1),c.push(-1,-1),c.push(1,-1),this._vertexBuffers[W.d.PositionKind]=new W.d(this._scene.getEngine(),c,W.d.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const c=[];c.push(0),c.push(1),c.push(2),c.push(0),c.push(2),c.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(c)}_rebuild(){const c=this._vertexBuffers[W.d.PositionKind];c&&(c._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const D=this._scene.activeCamera;return!!D&&(r=r||D._postProcesses.filter((c=>null!=c)),!(!r||0===r.length||!this._scene.postProcessesEnabled)&&(r[0].activate(D,c,null!==r&&void 0!==r),!0))}directRender(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:c.length;const a=this._scene.getEngine();for(let x=0;x<u;x++){var H;if(x<c.length-1)c[x+1].activate(this._scene.activeCamera||this._scene,null===r||void 0===r?void 0:r.texture);else r?a.bindFramebuffer(r,W,void 0,void 0,D,B):t||a.restoreDefaultFramebuffer(),null===(H=a._debugInsertMarker)||void 0===H||H.call(a,`post process ${c[x].name} output`);const u=c[x],M=u.apply();M&&(u.onBeforeRenderObservable.notifyObservers(M),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,M),a.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(M))}a.setDepthBuffer(!0),a.setDepthWrite(!0)}_finalizeFrame(c,r,D,W){let B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const t=this._scene.activeCamera;if(!t)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(W=W||t._postProcesses.filter((c=>null!=c))).length||!this._scene.postProcessesEnabled)return;const u=this._scene.getEngine();for(let H=0,x=W.length;H<x;H++){const M=W[H];var a;if(H<x-1)M._outputTexture=W[H+1].activate(t,null===r||void 0===r?void 0:r.texture);else r?(u.bindFramebuffer(r,D,void 0,void 0,B),M._outputTexture=r):(u.restoreDefaultFramebuffer(),M._outputTexture=null),null===(a=u._debugInsertMarker)||void 0===a||a.call(u,`post process ${W[H].name} output`);if(c)break;const E=M.apply();E&&(M.onBeforeRenderObservable.notifyObservers(E),this._prepareBuffers(),u.bindBuffers(this._vertexBuffers,this._indexBuffer,E),u.drawElementsType(0,0,6),M.onAfterRenderObservable.notifyObservers(E))}u.setDepthBuffer(!0),u.setDepthWrite(!0),u.setAlphaMode(0)}dispose(){const c=this._vertexBuffers[W.d.PositionKind];c&&(c.dispose(),this._vertexBuffers[W.d.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11763:(c,r,D)=>{D.d(r,{e:()=>a});var W=D(11766),B=D(11683);class t{set opaqueSortCompareFn(c){this._opaqueSortCompareFn=c||t.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(c){this._alphaTestSortCompareFn=c||t.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(c){this._transparentSortCompareFn=c||t.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(c,r){let D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=c,this._opaqueSubMeshes=new W.e(256),this._transparentSubMeshes=new W.e(256),this._alphaTestSubMeshes=new W.e(256),this._depthOnlySubMeshes=new W.e(256),this._particleSystems=new W.e(256),this._spriteManagers=new W.e(256),this._empty=!0,this._edgesRenderers=new W.d(16),this._scene=r,this.opaqueSortCompareFn=D,this.alphaTestSortCompareFn=B,this.transparentSortCompareFn=t}render(c,r,D,W){if(c)return void c(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const B=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(B.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),B.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const t=B.getStencilBuffer();if(B.setStencilBuffer(!1),r&&this._renderSprites(),D&&this._renderParticles(W),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(B.setStencilBuffer(t),this._scene.useOrderIndependentTransparency){const c=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);c.length&&this._renderTransparent(c)}else this._renderTransparent(this._transparentSubMeshes);B.setAlphaMode(0)}if(B.setStencilBuffer(!1),this._edgesRenderers.length){for(let c=0;c<this._edgesRenderers.length;c++)this._edgesRenderers.data[c].render();B.setAlphaMode(0)}B.setStencilBuffer(t)}_renderOpaqueSorted(c){t._RenderSorted(c,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(c){t._RenderSorted(c,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(c){t._RenderSorted(c,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(c,r,D,W){let u,a=0;const H=D?D.globalPosition:t._ZeroVector;if(W)for(;a<c.length;a++)u=c.data[a],u._alphaIndex=u.getMesh().alphaIndex,u._distanceToCamera=B.Zr.Distance(u.getBoundingInfo().boundingSphere.centerWorld,H);const x=c.length===c.data.length?c.data:c.data.slice(0,c.length);r&&x.sort(r);const M=x[0].getMesh().yc();for(a=0;a<x.length;a++)if(u=x[a],!M._activeMeshesFrozenButKeepClipping||u.isInFrustum(M._frustumPlanes)){if(W){const c=u.Gc();if(c&&c.needDepthPrePass){const r=c.yc().getEngine();r.setColorWrite(!1),r.setAlphaMode(0),u.render(!1),r.setColorWrite(!0)}}u.render(W)}}static defaultTransparentSortCompare(c,r){return c._alphaIndex>r._alphaIndex?1:c._alphaIndex<r._alphaIndex?-1:t.backToFrontSortCompare(c,r)}static backToFrontSortCompare(c,r){return c._distanceToCamera<r._distanceToCamera?1:c._distanceToCamera>r._distanceToCamera?-1:0}static frontToBackSortCompare(c,r){return c._distanceToCamera<r._distanceToCamera?-1:c._distanceToCamera>r._distanceToCamera?1:0}static PainterSortCompare(c,r){const D=c.getMesh(),W=r.getMesh();return D.material&&W.material?D.material.uniqueId-W.material.uniqueId:D.uniqueId-W.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(c,r,D){void 0===r&&(r=c.getMesh()),void 0===D&&(D=c.Gc()),null!==D&&void 0!==D&&(D.needAlphaBlendingForMesh(r)?this._transparentSubMeshes.push(c):D.needAlphaTestingForMesh(r)?(D.needDepthPrePass&&this._depthOnlySubMeshes.push(c),this._alphaTestSubMeshes.push(c)):(D.needDepthPrePass&&this._depthOnlySubMeshes.push(c),this._opaqueSubMeshes.push(c)),r._renderingGroup=this,r._edgesRenderer&&r.isEnabled()&&r.isVisible&&r._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(r._edgesRenderer),this._empty=!1)}dispatchSprites(c){this._spriteManagers.push(c),this._empty=!1}dispatchParticles(c){this._particleSystems.push(c),this._empty=!1}_renderParticles(c){if(0===this._particleSystems.length)return;const r=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let D=0;D<this._particleSystems.length;D++){const W=this._particleSystems.data[D];if(0===(r&&r.layerMask&W.layerMask))continue;const B=W.tr;B.position&&c&&-1===c.indexOf(B)||this._scene._activeParticles.addCount(W.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const c=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let r=0;r<this._spriteManagers.length;r++){const D=this._spriteManagers.data[r];0!==(c&&c.layerMask&D.layerMask)&&D.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}t._ZeroVector=B.Zr.Zero();class u{}class a{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(c){c!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=c,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const c of this._scene.meshes)if(c.xa)for(const r of c.xa)r._wasDispatched=!1;if(this._scene.spriteManagers)for(const c of this._scene.spriteManagers)c._wasDispatched=!1;for(const c of this._scene.rm)c._wasDispatched=!1}constructor(c){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new u,this._maintainStateBetweenFrames=!1,this._scene=c;for(let r=a.MIN_RENDERINGGROUPS;r<a.MAX_RENDERINGGROUPS;r++)this._autoClearDepthStencil[r]={Ha:!0,depth:!0,stencil:!0}}getRenderingGroup(c){const r=c||0;return this._prepareRenderingGroup(r),this._renderingGroups[r]}_clearDepthStencilBuffer(){let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,c,r),this._depthStencilBufferAlreadyCleaned=!0)}render(c,r,D,W){const B=this._renderingGroupInfo;if(B.qr=this._scene,B.camera=this._scene.activeCamera,B.renderingManager=this,this._scene.spriteManagers&&W)for(let t=0;t<this._scene.spriteManagers.length;t++){const c=this._scene.spriteManagers[t];this.dispatchSprites(c)}for(let t=a.MIN_RENDERINGGROUPS;t<a.MAX_RENDERINGGROUPS;t++){this._depthStencilBufferAlreadyCleaned=t===a.MIN_RENDERINGGROUPS;const u=this._renderingGroups[t];if(!u||u._empty)continue;const H=1<<t;if(B.renderingGroupId=t,this._scene.onBeforeRenderingGroupObservable.notifyObservers(B,H),a.AUTOCLEAR){const c=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(t):this._autoClearDepthStencil[t];c&&c.Ha&&this._clearDepthStencilBuffer(c.depth,c.stencil)}for(const c of this._scene._beforeRenderingGroupDrawStage)c.action(t);u.render(c,W,D,r);for(const c of this._scene._afterRenderingGroupDrawStage)c.action(t);this._scene.onAfterRenderingGroupObservable.notifyObservers(B,H)}}reset(){if(!this.maintainStateBetweenFrames)for(let c=a.MIN_RENDERINGGROUPS;c<a.MAX_RENDERINGGROUPS;c++){const r=this._renderingGroups[c];r&&r.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let c=a.MIN_RENDERINGGROUPS;c<a.MAX_RENDERINGGROUPS;c++){const r=this._renderingGroups[c];r&&r.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let c=a.MIN_RENDERINGGROUPS;c<a.MAX_RENDERINGGROUPS;c++){const r=this._renderingGroups[c];r&&r.dispose()}}_prepareRenderingGroup(c){void 0===this._renderingGroups[c]&&(this._renderingGroups[c]=new t(c,this._scene,this._customOpaqueSortCompareFn[c],this._customAlphaTestSortCompareFn[c],this._customTransparentSortCompareFn[c]))}dispatchSprites(c){this.maintainStateBetweenFrames&&c._wasDispatched||(c._wasDispatched=!0,this.getRenderingGroup(c.renderingGroupId).dispatchSprites(c))}dispatchParticles(c){this.maintainStateBetweenFrames&&c._wasDispatched||(c._wasDispatched=!0,this.getRenderingGroup(c.renderingGroupId).dispatchParticles(c))}dispatch(c,r,D){void 0===r&&(r=c.getMesh()),this.maintainStateBetweenFrames&&c._wasDispatched||(c._wasDispatched=!0,this.getRenderingGroup(r.renderingGroupId).dispatch(c,r,D))}setRenderingOrder(c){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,D=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[c]=r,this._customAlphaTestSortCompareFn[c]=D,this._customTransparentSortCompareFn[c]=W,this._renderingGroups[c]){const r=this._renderingGroups[c];r.opaqueSortCompareFn=this._customOpaqueSortCompareFn[c],r.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[c],r.transparentSortCompareFn=this._customTransparentSortCompareFn[c]}}setRenderingAutoClearDepthStencil(c,r){let D=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],W=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[c]={Ha:r,depth:D,stencil:W}}getAutoClearDepthStencilSetup(c){return this._autoClearDepthStencil[c]}}a.MAX_RENDERINGGROUPS=4,a.MIN_RENDERINGGROUPS=0,a.AUTOCLEAR=!0}}]);