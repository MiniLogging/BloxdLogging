"use strict";(self["3nlrbof8msu"]=self["3nlrbof8msu"]||[]).push([[19],{12800:(t,b,Z)=>{Z.d(b,{d:()=>v,g:()=>h});var J=Z(12805),S=Z(12557),P=Z(12810);class v{get h(){return this._isDisposed}constructor(t,b,Z){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4],v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,t&&t.et?this._engine=t.et().getEngine():this._engine=t,this._updatable=Z,this._instanced=v,this._divisor=C||1,this._label=Y,b instanceof J.d?(this._data=null,this._buffer=b):(this._data=b,this._buffer=null),this.byteStride=h?S:S*Float32Array.BYTES_PER_ELEMENT,P||this.create()}createVertexBuffer(t,b,Z,J,S){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6?arguments[6]:void 0;const C=P?b:b*Float32Array.BYTES_PER_ELEMENT,Y=J?P?J:J*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new h(this._engine,this,t,this._updatable,!0,Y,void 0===S?this._instanced:S,C,Z,void 0,void 0,!0,this._divisor||v)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!t&&this._buffer||(t=t||this._data,t&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t,this._label),this._data=t):this._buffer=this._engine.createVertexBuffer(t,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.gZ>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.gZ,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.gZ,void 0,this._label));S.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(t){this.create(t)}updateDirectly(t,b,Z){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,J?b:b*Float32Array.BYTES_PER_ELEMENT,Z?Z*this.byteStride:void 0),this._data=0===b&&void 0===Z?t:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class h{get h(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(t){const b=0!=t;this._instanceDivisor=t,b!==this._instanced&&(this._instanced=b,this._computeHashCode())}get _maxVerticesCount(){const t=this.getData();return t?Array.isArray(t)?t.length/(this.byteStride/4)-this.byteOffset/4:(t.byteLength-this.byteOffset)/this.byteStride:0}constructor(t,b,Z,J,S,C,Y,g,I,r){let M=arguments.length>10&&void 0!==arguments[10]&&arguments[10],T=arguments.length>11&&void 0!==arguments[11]&&arguments[11],a=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,k=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let u=!1;if(this.ZZ=t,"object"===typeof J&&null!==J?(u=J.updatable??!1,S=J.postponeInternalCreation,C=J.stride,Y=J.instanced,g=J.offset,I=J.size,r=J.type,M=J.normalized??!1,T=J.useBytes??!1,a=J.divisor??1,k=J.takeBufferOwnership??!1,this._label=J.label):u=!!J,b instanceof v?(this._buffer=b,this._ownsBuffer=k):(this._buffer=new v(t,b,u,C,S,Y,T,a,this._label),this._ownsBuffer=!0),this.uniqueId=h._Counter++,this._kind=Z,void 0===r){const t=this.getData();this.type=t?h.GetDataType(t):h.FLOAT}else this.type=r;const l=(0,P.n)(this.type);T?(this._size=I||(C?C/l:h.DeduceStride(Z)),this.byteStride=C||this._buffer.byteStride||this._size*l,this.byteOffset=g||0):(this._size=I||C||h.DeduceStride(Z),this.byteStride=C?C*l:this._buffer.byteStride||this._size*l,this.byteOffset=(g||0)*l),this.normalized=M,this._instanced=void 0!==Y&&Y,this._instanceDivisor=Y?a:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var t;null===(t=this._buffer)||void 0===t||t._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(t,b){const Z=this.getData();return Z?(0,P.l)(Z,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,b):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,P.n)(this.type)}getOffset(){return this.byteOffset/(0,P.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,P.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(t){this._buffer.create(t),this._alignBuffer()}update(t){this._buffer.update(t),this._alignBuffer()}updateDirectly(t,b){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(t,b,void 0,Z),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(t,b){(0,P.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,((t,Z)=>{for(let J=0;J<this._size;J++)b(t[J],Z+J)}))}_alignBuffer(){}static DeduceStride(t){switch(t){case h.UVKind:case h.UV2Kind:case h.UV3Kind:case h.UV4Kind:case h.UV5Kind:case h.UV6Kind:return 2;case h.NormalKind:case h.PositionKind:return 3;case h.ColorKind:case h.ColorInstanceKind:case h.MatricesIndicesKind:case h.MatricesIndicesExtraKind:case h.MatricesWeightsKind:case h.MatricesWeightsExtraKind:case h.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static GetDataType(t){return t instanceof Int8Array?h.BYTE:t instanceof Uint8Array?h.UNSIGNED_BYTE:t instanceof Int16Array?h.SHORT:t instanceof Uint16Array?h.UNSIGNED_SHORT:t instanceof Int32Array?h.INT:t instanceof Uint32Array?h.UNSIGNED_INT:h.FLOAT}static GetTypeByteLength(t){return(0,P.n)(t)}static ForEach(t,b,Z,J,S,v,h,C){(0,P.h)(t,b,Z,J,S,v,h,((t,b)=>{for(let Z=0;Z<J;Z++)C(t[Z],b+Z)}))}static GetFloatData(t,b,Z,J,S,v,h,C){return(0,P.l)(t,b,Z,J,S,v,h,C)}}h._Counter=0,h.BYTE=5120,h.UNSIGNED_BYTE=5121,h.SHORT=5122,h.UNSIGNED_SHORT=5123,h.INT=5124,h.UNSIGNED_INT=5125,h.FLOAT=5126,h.PositionKind="position",h.NormalKind="normal",h.TangentKind="tangent",h.UVKind="uv",h.UV2Kind="uv2",h.UV3Kind="uv3",h.UV4Kind="uv4",h.UV5Kind="uv5",h.UV6Kind="uv6",h.ColorKind="color",h.ColorInstanceKind="instanceColor",h.MatricesIndicesKind="matricesIndices",h.MatricesWeightsKind="matricesWeights",h.MatricesIndicesExtraKind="matricesIndicesExtra",h.MatricesWeightsExtraKind="matricesWeightsExtra"},12810:(t,b,Z)=>{Z.d(b,{c:()=>r,f:()=>I,h:()=>C,l:()=>Y,n:()=>v,r:()=>h,t:()=>g});var J=Z(12557);function S(t,b,Z,J){switch(b){case 5120:{let b=t.getInt8(Z);return J&&(b=Math.max(b/127,-1)),b}case 5121:{let b=t.getUint8(Z);return J&&(b/=255),b}case 5122:{let b=t.getInt16(Z,!0);return J&&(b=Math.max(b/32767,-1)),b}case 5123:{let b=t.getUint16(Z,!0);return J&&(b/=65535),b}case 5124:return t.getInt32(Z,!0);case 5125:return t.getUint32(Z,!0);case 5126:return t.getFloat32(Z,!0);default:throw new Error(`Invalid component type ${b}`)}}function P(t,b,Z,J,S){switch(b){case 5120:J&&(S=Math.round(127*S)),t.setInt8(Z,S);break;case 5121:J&&(S=Math.round(255*S)),t.setUint8(Z,S);break;case 5122:J&&(S=Math.round(32767*S)),t.setInt16(Z,S,!0);break;case 5123:J&&(S=Math.round(65535*S)),t.setUint16(Z,S,!0);break;case 5124:t.setInt32(Z,S,!0);break;case 5125:t.setUint32(Z,S,!0);break;case 5126:t.setFloat32(Z,S,!0);break;default:throw new Error(`Invalid component type ${b}`)}}function v(t){switch(t){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${t}'`)}}function h(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${t}'`)}}function C(t,b,Z,J,h,C,Y,g){const I=new Array(J),r=new Array(J);if(t instanceof Array){let S=b/4;const P=Z/4;for(let b=0;b<C;b+=J){for(let b=0;b<J;b++)I[b]=r[b]=t[S+b];g(r,b);for(let b=0;b<J;b++)I[b]!==r[b]&&(t[S+b]=r[b]);S+=P}}else{const M=ArrayBuffer.isView(t)?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(t),T=v(h);for(let t=0;t<C;t+=J){for(let t=0,Z=b;t<J;t++,Z+=T)I[t]=r[t]=S(M,h,Z,Y);g(r,t);for(let t=0,Z=b;t<J;t++,Z+=T)I[t]!==r[t]&&P(M,h,Z,Y,r[t]);b+=Z}}}function Y(t,b,Z,S,P,h,Y,g){const I=b*v(Z),r=Y*b;if(5126!==Z||P!==I){const J=new Float32Array(r);return C(t,S,P,b,Z,r,h,((t,Z)=>{for(let S=0;S<b;S++)J[Z+S]=t[S]})),J}if(!(t instanceof Array||t instanceof Float32Array)||0!==S||t.length!==r){if(t instanceof Array){const b=S/4;return t.slice(b,b+r)}if(t instanceof ArrayBuffer)return new Float32Array(t,S,r);{const b=t.byteOffset+S;return 0!==(3&b)&&(J.c.Warn("Float array must be aligned to 4-bytes border"),g=!0),g?new Float32Array(t.buffer.slice(b,b+r*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(t.buffer,b,r)}}return g?t.slice():t}function g(t,b,Z,S,P,Y,g,I){const r=v(Z),M=h(Z),T=g*b;if(Array.isArray(t)){if(0!==(3&S)||0!==(3&P))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const J=S/4,v=P/4;if(J+(g-1)*v+b>t.length)throw new Error("Last accessed index is out of bounds.");if(v<b)throw new Error("Data stride cannot be smaller than the component size.");if(v!==b){const J=new M(T);return C(t,S,P,b,Z,T,Y,((t,Z)=>{for(let S=0;S<b;S++)J[Z+S]=t[S]})),J}return new M(t.slice(J,J+T))}let a,k=S;t instanceof ArrayBuffer?a=t:(a=t.buffer,k+=t.byteOffset);if(k+(g-1)*P+b*r>a.byteLength)throw new Error("Last accessed byte is out of bounds.");const u=b*r;if(P<u)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(P!==u){const t=new M(T);return C(a,k,P,b,Z,T,Y,((Z,J)=>{for(let S=0;S<b;S++)t[J+S]=Z[S]})),t}return 1!==r&&0!==(k&r-1)&&(J.c.Warn("Array must be aligned to border of element size. Data will be copied."),I=!0),I?new M(a.slice(k,k+T*r)):new M(a,k,T)}function I(t,b,Z,S,P,h,Y,g){const I=b*v(Z),r=Y*b;if(g.length!==r)throw new Error("Output length is not valid");if(5126===Z&&P===I)if(t instanceof Array){const b=S/4;g.set(t,b)}else if(t instanceof ArrayBuffer){const b=new Float32Array(t,S,r);g.set(b)}else{const b=t.byteOffset+S;if(0!==(3&b))return J.c.Warn("Float array must be aligned to 4-bytes border"),void g.set(new Float32Array(t.buffer.slice(b,b+r*Float32Array.BYTES_PER_ELEMENT)));const Z=new Float32Array(t.buffer,b,r);g.set(Z)}else C(t,S,P,b,Z,r,h,((t,Z)=>{for(let J=0;J<b;J++)g[Z+J]=t[J]}))}function r(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(t)){for(let S=0;S<b;S++)if(t[Z+S]-J>65535)return!0;return!1}return 4===t.BYTES_PER_ELEMENT}},12805:(t,b,Z)=>{Z.d(b,{d:()=>J});class J{get underlyingResource(){return null}constructor(){this.references=0,this.gZ=0,this.is32Bits=!1,this.uniqueId=J._Counter++}}J._Counter=0},12848:(t,b,Z)=>{Z.d(b,{e:()=>S});var J=Z(12621);class S{static GetEffect(t){return void 0===t.getPipelineContext?t.effect:t}constructor(t){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=t.createDrawContext(),b&&(this.materialContext=t.createMaterialContext())}setEffect(t,b){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var J;(this.effect=t,void 0!==b&&(this.defines=b),Z)&&(null===(J=this.drawContext)||void 0===J||J.reset())}dispose(){var t;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const t=this.effect;b?t.dispose():J.c.SetImmediate((()=>{t.getEngine().onEndFrameObservable.addOnce((()=>{t.dispose()}))})),this.effect=null}null===(t=this.drawContext)||void 0===t||t.dispose()}}},12939:(t,b,Z)=>{Z.d(b,{c:()=>S});var J=Z(12778);class S{static GetPlanes(t){const b=[];for(let Z=0;Z<6;Z++)b.push(new J.c(0,0,0,0));return S.GetPlanesToRef(t,b),b}static GetNearPlaneToRef(t,b){const Z=t.m;b.normal.x=Z[3]+Z[2],b.normal.y=Z[7]+Z[6],b.normal.z=Z[11]+Z[10],b.d=Z[15]+Z[14],b.normalize()}static GetFarPlaneToRef(t,b){const Z=t.m;b.normal.x=Z[3]-Z[2],b.normal.y=Z[7]-Z[6],b.normal.z=Z[11]-Z[10],b.d=Z[15]-Z[14],b.normalize()}static GetLeftPlaneToRef(t,b){const Z=t.m;b.normal.x=Z[3]+Z[0],b.normal.y=Z[7]+Z[4],b.normal.z=Z[11]+Z[8],b.d=Z[15]+Z[12],b.normalize()}static GetRightPlaneToRef(t,b){const Z=t.m;b.normal.x=Z[3]-Z[0],b.normal.y=Z[7]-Z[4],b.normal.z=Z[11]-Z[8],b.d=Z[15]-Z[12],b.normalize()}static GetTopPlaneToRef(t,b){const Z=t.m;b.normal.x=Z[3]-Z[1],b.normal.y=Z[7]-Z[5],b.normal.z=Z[11]-Z[9],b.d=Z[15]-Z[13],b.normalize()}static GetBottomPlaneToRef(t,b){const Z=t.m;b.normal.x=Z[3]+Z[1],b.normal.y=Z[7]+Z[5],b.normal.z=Z[11]+Z[9],b.d=Z[15]+Z[13],b.normalize()}static GetPlanesToRef(t,b){S.GetNearPlaneToRef(t,b[0]),S.GetFarPlaneToRef(t,b[1]),S.GetLeftPlaneToRef(t,b[2]),S.GetRightPlaneToRef(t,b[3]),S.GetTopPlaneToRef(t,b[4]),S.GetBottomPlaneToRef(t,b[5])}static IsPointInFrustum(t,b){for(let Z=0;Z<6;Z++)if(b[Z].dotCoordinate(t)<0)return!1;return!0}}},12946:(t,b,Z)=>{Z.d(b,{c:()=>S});var J=Z(12570);class S{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(t,b){S.Enabled&&(this._current+=t,b&&this._fetchResult())}beginMonitoring(){S.Enabled&&(this._startMonitoringTime=J.e.Now)}endMonitoring(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!S.Enabled)return;t&&this.fetchNewFrame();const b=J.e.Now;this._current=b-this._startMonitoringTime,t&&this._fetchResult()}ub(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const t=J.e.Now;t-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=t,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}S.Enabled=!0},12826:(t,b,Z)=>{Z.d(b,{d:()=>S,h:()=>J});class J{constructor(t){this.length=0,this.data=new Array(t),this._id=J._GlobalId++}push(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)}forEach(t){for(let b=0;b<this.length;b++)t(this.data[b])}sort(t){this.data.sort(t)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(let b=0;b<t.length;b++)this.data[this.length++]=(t.data||t)[b]}}indexOf(t){const b=this.data.indexOf(t);return b>=this.length?-1:b}contains(t){return-1!==this.indexOf(t)}}J._GlobalId=0;class S extends J{constructor(){super(...arguments),this._duplicateId=0}push(t){super.push(t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(t){return(!t.__smartArrayFlags||t.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(t),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(let b=0;b<t.length;b++){const Z=(t.data||t)[b];this.pushNoDuplicate(Z)}}}}},12792:(t,b,Z)=>{Z.d(b,{c:()=>P});var J=Z(12800),S=Z(12551);class P{constructor(t){this._vertexBuffers={},this.onBeforeRenderObservable=new S.d,this._scene=t}_prepareBuffers(){if(this._vertexBuffers[J.g.PositionKind])return;const t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[J.g.PositionKind]=new J.g(this._scene.getEngine(),t,J.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(t)}_rebuild(){const t=this._vertexBuffers[J.g.PositionKind];t&&(t._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this._scene.activeCamera;return!!Z&&(b=b||Z._postProcesses.filter((t=>null!=t)),!(!b||0===b.length||!this._scene.postProcessesEnabled)&&(b[0].activate(Z,t,null!==b&&void 0!==b),!0))}directRender(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],v=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.length;const h=this._scene.getEngine();for(let Y=0;Y<v;Y++){var C;if(Y<t.length-1)t[Y+1].activate(this._scene.activeCamera||this._scene,null===b||void 0===b?void 0:b.texture);else b?h.bindFramebuffer(b,J,void 0,void 0,Z,S):P||h.restoreDefaultFramebuffer(),null===(C=h._debugInsertMarker)||void 0===C||C.call(h,`post process ${t[Y].name} output`);const v=t[Y],g=v.apply();g&&(v.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),h.bindBuffers(this._vertexBuffers,this._indexBuffer,g),h.drawElementsType(0,0,6),v.onAfterRenderObservable.notifyObservers(g))}h.setDepthBuffer(!0),h.setDepthWrite(!0)}_finalizeFrame(t,b,Z,J){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const P=this._scene.activeCamera;if(!P)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(J=J||P._postProcesses.filter((t=>null!=t))).length||!this._scene.postProcessesEnabled)return;const v=this._scene.getEngine();for(let C=0,Y=J.length;C<Y;C++){const g=J[C];var h;if(C<Y-1)g._outputTexture=J[C+1].activate(P,null===b||void 0===b?void 0:b.texture);else b?(v.bindFramebuffer(b,Z,void 0,void 0,S),g._outputTexture=b):(v.restoreDefaultFramebuffer(),g._outputTexture=null),null===(h=v._debugInsertMarker)||void 0===h||h.call(v,`post process ${J[C].name} output`);if(t)break;const I=g.apply();I&&(g.onBeforeRenderObservable.notifyObservers(I),this._prepareBuffers(),v.bindBuffers(this._vertexBuffers,this._indexBuffer,I),v.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(I))}v.setDepthBuffer(!0),v.setDepthWrite(!0),v.setAlphaMode(0)}dispose(){const t=this._vertexBuffers[J.g.PositionKind];t&&(t.dispose(),this._vertexBuffers[J.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12818:(t,b,Z)=>{Z.d(b,{d:()=>h});var J=Z(12826),S=Z(12735);class P{set opaqueSortCompareFn(t){this._opaqueSortCompareFn=t||P.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(t){this._alphaTestSortCompareFn=t||P.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(t){this._transparentSortCompareFn=t||P.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(t,b){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=t,this._opaqueSubMeshes=new J.h(256),this._transparentSubMeshes=new J.h(256),this._alphaTestSubMeshes=new J.h(256),this._depthOnlySubMeshes=new J.h(256),this._particleSystems=new J.h(256),this._spriteManagers=new J.h(256),this._empty=!0,this._edgesRenderers=new J.d(16),this._scene=b,this.opaqueSortCompareFn=Z,this.alphaTestSortCompareFn=S,this.transparentSortCompareFn=P}render(t,b,Z,J){if(t)return void t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const S=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(S.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),S.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const P=S.getStencilBuffer();if(S.setStencilBuffer(!1),b&&this._renderSprites(),Z&&this._renderParticles(J),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(S.setStencilBuffer(P),this._scene.useOrderIndependentTransparency){const t=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);t.length&&this._renderTransparent(t)}else this._renderTransparent(this._transparentSubMeshes);S.setAlphaMode(0)}if(S.setStencilBuffer(!1),this._edgesRenderers.length){for(let t=0;t<this._edgesRenderers.length;t++)this._edgesRenderers.data[t].render();S.setAlphaMode(0)}S.setStencilBuffer(P)}_renderOpaqueSorted(t){P._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(t){P._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(t){P._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(t,b,Z,J){let v,h=0;const C=Z?Z.globalPosition:P._ZeroVector;if(J)for(;h<t.length;h++)v=t.data[h],v._alphaIndex=v.getMesh().alphaIndex,v._distanceToCamera=S.JZ.Distance(v.getBoundingInfo().boundingSphere.centerWorld,C);const Y=t.length===t.data.length?t.data:t.data.slice(0,t.length);b&&Y.sort(b);const g=Y[0].getMesh().et();for(h=0;h<Y.length;h++)if(v=Y[h],!g._activeMeshesFrozenButKeepClipping||v.isInFrustum(g._frustumPlanes)){if(J){const t=v.Kt();if(t&&t.needDepthPrePass){const b=t.et().getEngine();b.setColorWrite(!1),b.setAlphaMode(0),v.render(!1),b.setColorWrite(!0)}}v.render(J)}}static defaultTransparentSortCompare(t,b){return t._alphaIndex>b._alphaIndex?1:t._alphaIndex<b._alphaIndex?-1:P.backToFrontSortCompare(t,b)}static backToFrontSortCompare(t,b){return t._distanceToCamera<b._distanceToCamera?1:t._distanceToCamera>b._distanceToCamera?-1:0}static frontToBackSortCompare(t,b){return t._distanceToCamera<b._distanceToCamera?-1:t._distanceToCamera>b._distanceToCamera?1:0}static PainterSortCompare(t,b){const Z=t.getMesh(),J=b.getMesh();return Z.material&&J.material?Z.material.uniqueId-J.material.uniqueId:Z.uniqueId-J.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(t,b,Z){void 0===b&&(b=t.getMesh()),void 0===Z&&(Z=t.Kt()),null!==Z&&void 0!==Z&&(Z.needAlphaBlendingForMesh(b)?this._transparentSubMeshes.push(t):Z.needAlphaTestingForMesh(b)?(Z.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._alphaTestSubMeshes.push(t)):(Z.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._opaqueSubMeshes.push(t)),b._renderingGroup=this,b._edgesRenderer&&b.isEnabled()&&b.isVisible&&b._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(b._edgesRenderer),this._empty=!1)}dispatchSprites(t){this._spriteManagers.push(t),this._empty=!1}dispatchParticles(t){this._particleSystems.push(t),this._empty=!1}_renderParticles(t){if(0===this._particleSystems.length)return;const b=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let Z=0;Z<this._particleSystems.length;Z++){const J=this._particleSystems.data[Z];if(0===(b&&b.layerMask&J.layerMask))continue;const S=J.hb;S.position&&t&&-1===t.indexOf(S)||this._scene._activeParticles.addCount(J.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const t=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let b=0;b<this._spriteManagers.length;b++){const Z=this._spriteManagers.data[b];0!==(t&&t.layerMask&Z.layerMask)&&Z.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}P._ZeroVector=S.JZ.Zero();class v{}class h{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(t){t!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=t,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const t of this._scene.meshes)if(t.Wb)for(const b of t.Wb)b._wasDispatched=!1;if(this._scene.spriteManagers)for(const t of this._scene.spriteManagers)t._wasDispatched=!1;for(const t of this._scene.Lr)t._wasDispatched=!1}constructor(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new v,this._maintainStateBetweenFrames=!1,this._scene=t;for(let b=h.MIN_RENDERINGGROUPS;b<h.MAX_RENDERINGGROUPS;b++)this._autoClearDepthStencil[b]={eb:!0,depth:!0,Ub:!0}}getRenderingGroup(t){const b=t||0;return this._prepareRenderingGroup(b),this._renderingGroups[b]}_clearDepthStencilBuffer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,t,b),this._depthStencilBufferAlreadyCleaned=!0)}render(t,b,Z,J){const S=this._renderingGroupInfo;if(S.PZ=this._scene,S.camera=this._scene.activeCamera,S.renderingManager=this,this._scene.spriteManagers&&J)for(let P=0;P<this._scene.spriteManagers.length;P++){const t=this._scene.spriteManagers[P];this.dispatchSprites(t)}for(let P=h.MIN_RENDERINGGROUPS;P<h.MAX_RENDERINGGROUPS;P++){this._depthStencilBufferAlreadyCleaned=P===h.MIN_RENDERINGGROUPS;const v=this._renderingGroups[P];if(!v||v._empty)continue;const C=1<<P;if(S.renderingGroupId=P,this._scene.onBeforeRenderingGroupObservable.notifyObservers(S,C),h.AUTOCLEAR){const t=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(P):this._autoClearDepthStencil[P];t&&t.eb&&this._clearDepthStencilBuffer(t.depth,t.Ub)}for(const t of this._scene._beforeRenderingGroupDrawStage)t.action(P);v.render(t,J,Z,b);for(const t of this._scene._afterRenderingGroupDrawStage)t.action(P);this._scene.onAfterRenderingGroupObservable.notifyObservers(S,C)}}reset(){if(!this.maintainStateBetweenFrames)for(let t=h.MIN_RENDERINGGROUPS;t<h.MAX_RENDERINGGROUPS;t++){const b=this._renderingGroups[t];b&&b.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let t=h.MIN_RENDERINGGROUPS;t<h.MAX_RENDERINGGROUPS;t++){const b=this._renderingGroups[t];b&&b.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let t=h.MIN_RENDERINGGROUPS;t<h.MAX_RENDERINGGROUPS;t++){const b=this._renderingGroups[t];b&&b.dispose()}}_prepareRenderingGroup(t){void 0===this._renderingGroups[t]&&(this._renderingGroups[t]=new P(t,this._scene,this._customOpaqueSortCompareFn[t],this._customAlphaTestSortCompareFn[t],this._customTransparentSortCompareFn[t]))}dispatchSprites(t){this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatchSprites(t))}dispatchParticles(t){this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatchParticles(t))}dispatch(t,b,Z){void 0===b&&(b=t.getMesh()),this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatch(t,b,Z))}setRenderingOrder(t){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[t]=b,this._customAlphaTestSortCompareFn[t]=Z,this._customTransparentSortCompareFn[t]=J,this._renderingGroups[t]){const b=this._renderingGroups[t];b.opaqueSortCompareFn=this._customOpaqueSortCompareFn[t],b.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[t],b.transparentSortCompareFn=this._customTransparentSortCompareFn[t]}}setRenderingAutoClearDepthStencil(t,b){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[t]={eb:b,depth:Z,Ub:J}}getAutoClearDepthStencilSetup(t){return this._autoClearDepthStencil[t]}}h.MAX_RENDERINGGROUPS=4,h.MIN_RENDERINGGROUPS=0,h.AUTOCLEAR=!0}}]);