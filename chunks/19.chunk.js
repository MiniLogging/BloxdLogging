"use strict";(self.n4ygn1cq9vg=self.n4ygn1cq9vg||[]).push([[19],{12490:(e,d,v)=>{v.d(d,{e:()=>B,i:()=>X});var P=v(12497),p=v(12253),L=v(12499);class B{get W(){return this._isDisposed}constructor(e,d,v){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],z=arguments.length>7?arguments[7]:void 0,W=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,e&&e.Ae?this._engine=e.Ae().getEngine():this._engine=e,this._updatable=v,this._instanced=B,this._divisor=z||1,this._label=W,d instanceof P.d?(this._data=null,this._buffer=d):(this._data=d,this._buffer=null),this.byteStride=X?p:p*Float32Array.BYTES_PER_ELEMENT,L||this.create()}createVertexBuffer(e,d,v,P,p){let L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6?arguments[6]:void 0;const z=L?d:d*Float32Array.BYTES_PER_ELEMENT,W=P?L?P:P*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new X(this._engine,this,e,this._updatable,!0,W,void 0===p?this._instanced:p,z,v,void 0,void 0,!0,this._divisor||B)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!e&&this._buffer||(e=e||this._data,e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e,this._label),this._data=e):this._buffer=this._engine.createVertexBuffer(e,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Od>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Od,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Od,void 0,this._label));p.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(e){this.create(e)}updateDirectly(e,d,v){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,P?d:d*Float32Array.BYTES_PER_ELEMENT,v?v*this.byteStride:void 0),this._data=0===d&&void 0===v?e:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class X{get W(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(e){const d=0!=e;this._instanceDivisor=e,d!==this._instanced&&(this._instanced=d,this._computeHashCode())}get _maxVerticesCount(){const e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}constructor(e,d,v,P,p,z,W,V,k,g){let F=arguments.length>10&&void 0!==arguments[10]&&arguments[10],w=arguments.length>11&&void 0!==arguments[11]&&arguments[11],G=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,U=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let D=!1;if(this.Ad=e,"object"===typeof P&&null!==P?(D=P.updatable??!1,p=P.postponeInternalCreation,z=P.stride,W=P.instanced,V=P.offset,k=P.size,g=P.type,F=P.normalized??!1,w=P.useBytes??!1,G=P.divisor??1,U=P.takeBufferOwnership??!1,this._label=P.label):D=!!P,d instanceof B?(this._buffer=d,this._ownsBuffer=U):(this._buffer=new B(e,d,D,z,p,W,w,G,this._label),this._ownsBuffer=!0),this.uniqueId=X._Counter++,this._kind=v,void 0===g){const e=this.getData();this.type=e?X.GetDataType(e):X.FLOAT}else this.type=g;const C=(0,L.l)(this.type);w?(this._size=k||(z?z/C:X.DeduceStride(v)),this.byteStride=z||this._buffer.byteStride||this._size*C,this.byteOffset=V||0):(this._size=k||z||X.DeduceStride(v),this.byteStride=z?z*C:this._buffer.byteStride||this._size*C,this.byteOffset=(V||0)*C),this.normalized=F,this._instanced=void 0!==W&&W,this._instanceDivisor=W?G:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var e;null===(e=this._buffer)||void 0===e||e._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(e,d){const v=this.getData();return v?(0,L.k)(v,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,e,d):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,L.l)(this.type)}getOffset(){return this.byteOffset/(0,L.l)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,L.l)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(e){this._buffer.create(e),this._alignBuffer()}update(e){this._buffer.update(e),this._alignBuffer()}updateDirectly(e,d){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(e,d,void 0,v),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(e,d){(0,L.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,((e,v)=>{for(let P=0;P<this._size;P++)d(e[P],v+P)}))}_alignBuffer(){}static DeduceStride(e){switch(e){case X.UVKind:case X.UV2Kind:case X.UV3Kind:case X.UV4Kind:case X.UV5Kind:case X.UV6Kind:return 2;case X.NormalKind:case X.PositionKind:return 3;case X.ColorKind:case X.ColorInstanceKind:case X.MatricesIndicesKind:case X.MatricesIndicesExtraKind:case X.MatricesWeightsKind:case X.MatricesWeightsExtraKind:case X.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}}static GetDataType(e){return e instanceof Int8Array?X.BYTE:e instanceof Uint8Array?X.UNSIGNED_BYTE:e instanceof Int16Array?X.SHORT:e instanceof Uint16Array?X.UNSIGNED_SHORT:e instanceof Int32Array?X.INT:e instanceof Uint32Array?X.UNSIGNED_INT:X.FLOAT}static GetTypeByteLength(e){return(0,L.l)(e)}static ForEach(e,d,v,P,p,B,X,z){(0,L.j)(e,d,v,P,p,B,X,((e,d)=>{for(let v=0;v<P;v++)z(e[v],d+v)}))}static GetFloatData(e,d,v,P,p,B,X,z){return(0,L.k)(e,d,v,P,p,B,X,z)}}X._Counter=0,X.BYTE=5120,X.UNSIGNED_BYTE=5121,X.SHORT=5122,X.UNSIGNED_SHORT=5123,X.INT=5124,X.UNSIGNED_INT=5125,X.FLOAT=5126,X.PositionKind="position",X.NormalKind="normal",X.TangentKind="tangent",X.UVKind="uv",X.UV2Kind="uv2",X.UV3Kind="uv3",X.UV4Kind="uv4",X.UV5Kind="uv5",X.UV6Kind="uv6",X.ColorKind="color",X.ColorInstanceKind="instanceColor",X.MatricesIndicesKind="matricesIndices",X.MatricesWeightsKind="matricesWeights",X.MatricesIndicesExtraKind="matricesIndicesExtra",X.MatricesWeightsExtraKind="matricesWeightsExtra"},12499:(e,d,v)=>{v.d(d,{d:()=>g,g:()=>k,j:()=>z,k:()=>W,l:()=>B,o:()=>X,s:()=>V});var P=v(12253);function p(e,d,v,P){switch(d){case 5120:{let d=e.getInt8(v);return P&&(d=Math.max(d/127,-1)),d}case 5121:{let d=e.getUint8(v);return P&&(d/=255),d}case 5122:{let d=e.getInt16(v,!0);return P&&(d=Math.max(d/32767,-1)),d}case 5123:{let d=e.getUint16(v,!0);return P&&(d/=65535),d}case 5124:return e.getInt32(v,!0);case 5125:return e.getUint32(v,!0);case 5126:return e.getFloat32(v,!0);default:throw new Error(`Invalid component type ${d}`)}}function L(e,d,v,P,p){switch(d){case 5120:P&&(p=Math.round(127*p)),e.setInt8(v,p);break;case 5121:P&&(p=Math.round(255*p)),e.setUint8(v,p);break;case 5122:P&&(p=Math.round(32767*p)),e.setInt16(v,p,!0);break;case 5123:P&&(p=Math.round(65535*p)),e.setUint16(v,p,!0);break;case 5124:e.setInt32(v,p,!0);break;case 5125:e.setUint32(v,p,!0);break;case 5126:e.setFloat32(v,p,!0);break;default:throw new Error(`Invalid component type ${d}`)}}function B(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${e}'`)}}function X(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${e}'`)}}function z(e,d,v,P,X,z,W,V){const k=new Array(P),g=new Array(P);if(e instanceof Array){let p=d/4;const L=v/4;for(let d=0;d<z;d+=P){for(let d=0;d<P;d++)k[d]=g[d]=e[p+d];V(g,d);for(let d=0;d<P;d++)k[d]!==g[d]&&(e[p+d]=g[d]);p+=L}}else{const F=ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e),w=B(X);for(let e=0;e<z;e+=P){for(let e=0,v=d;e<P;e++,v+=w)k[e]=g[e]=p(F,X,v,W);V(g,e);for(let e=0,v=d;e<P;e++,v+=w)k[e]!==g[e]&&L(F,X,v,W,g[e]);d+=v}}}function W(e,d,v,p,L,X,W,V){const k=d*B(v),g=W*d;if(5126!==v||L!==k){const P=new Float32Array(g);return z(e,p,L,d,v,g,X,((e,v)=>{for(let p=0;p<d;p++)P[v+p]=e[p]})),P}if(!(e instanceof Array||e instanceof Float32Array)||0!==p||e.length!==g){if(e instanceof Array){const d=p/4;return e.slice(d,d+g)}if(e instanceof ArrayBuffer)return new Float32Array(e,p,g);{const d=e.byteOffset+p;return 0!==(3&d)&&(P.c.Warn("Float array must be aligned to 4-bytes border"),V=!0),V?new Float32Array(e.buffer.slice(d,d+g*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(e.buffer,d,g)}}return V?e.slice():e}function V(e,d,v,p,L,W,V,k){const g=B(v),F=X(v),w=V*d;if(Array.isArray(e)){if(0!==(3&p)||0!==(3&L))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const P=p/4,B=L/4;if(P+(V-1)*B+d>e.length)throw new Error("Last accessed index is out of bounds.");if(B<d)throw new Error("Data stride cannot be smaller than the component size.");if(B!==d){const P=new F(w);return z(e,p,L,d,v,w,W,((e,v)=>{for(let p=0;p<d;p++)P[v+p]=e[p]})),P}return new F(e.slice(P,P+w))}let G,U=p;e instanceof ArrayBuffer?G=e:(G=e.buffer,U+=e.byteOffset);if(U+(V-1)*L+d*g>G.byteLength)throw new Error("Last accessed byte is out of bounds.");const D=d*g;if(L<D)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(L!==D){const e=new F(w);return z(G,U,L,d,v,w,W,((v,P)=>{for(let p=0;p<d;p++)e[P+p]=v[p]})),e}return 1!==g&&0!==(U&g-1)&&(P.c.Warn("Array must be aligned to border of element size. Data will be copied."),k=!0),k?new F(G.slice(U,U+w*g)):new F(G,U,w)}function k(e,d,v,p,L,X,W,V){const k=d*B(v),g=W*d;if(V.length!==g)throw new Error("Output length is not valid");if(5126===v&&L===k)if(e instanceof Array){const d=p/4;V.set(e,d)}else if(e instanceof ArrayBuffer){const d=new Float32Array(e,p,g);V.set(d)}else{const d=e.byteOffset+p;if(0!==(3&d))return P.c.Warn("Float array must be aligned to 4-bytes border"),void V.set(new Float32Array(e.buffer.slice(d,d+g*Float32Array.BYTES_PER_ELEMENT)));const v=new Float32Array(e.buffer,d,g);V.set(v)}else z(e,p,L,d,v,g,X,((e,v)=>{for(let P=0;P<d;P++)V[v+P]=e[P]}))}function g(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(e)){for(let p=0;p<d;p++)if(e[v+p]-P>65535)return!0;return!1}return 4===e.BYTES_PER_ELEMENT}},12497:(e,d,v)=>{v.d(d,{d:()=>P});class P{get underlyingResource(){return null}constructor(){this.references=0,this.Od=0,this.is32Bits=!1,this.uniqueId=P._Counter++}}P._Counter=0},12540:(e,d,v)=>{v.d(d,{b:()=>p});var P=v(12314);class p{static GetEffect(e){return void 0===e.getPipelineContext?e.effect:e}constructor(e){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),d&&(this.materialContext=e.createMaterialContext())}setEffect(e,d){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var P;(this.effect=e,void 0!==d&&(this.defines=d),v)&&(null===(P=this.drawContext)||void 0===P||P.reset())}dispose(){var e;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const e=this.effect;d?e.dispose():P.e.SetImmediate((()=>{e.getEngine().onEndFrameObservable.addOnce((()=>{e.dispose()}))})),this.effect=null}null===(e=this.drawContext)||void 0===e||e.dispose()}}},12624:(e,d,v)=>{v.d(d,{b:()=>p});var P=v(12465);class p{static GetPlanes(e){const d=[];for(let v=0;v<6;v++)d.push(new P.d(0,0,0,0));return p.GetPlanesToRef(e,d),d}static GetNearPlaneToRef(e,d){const v=e.m;d.normal.x=v[3]+v[2],d.normal.y=v[7]+v[6],d.normal.z=v[11]+v[10],d.d=v[15]+v[14],d.normalize()}static GetFarPlaneToRef(e,d){const v=e.m;d.normal.x=v[3]-v[2],d.normal.y=v[7]-v[6],d.normal.z=v[11]-v[10],d.d=v[15]-v[14],d.normalize()}static GetLeftPlaneToRef(e,d){const v=e.m;d.normal.x=v[3]+v[0],d.normal.y=v[7]+v[4],d.normal.z=v[11]+v[8],d.d=v[15]+v[12],d.normalize()}static GetRightPlaneToRef(e,d){const v=e.m;d.normal.x=v[3]-v[0],d.normal.y=v[7]-v[4],d.normal.z=v[11]-v[8],d.d=v[15]-v[12],d.normalize()}static GetTopPlaneToRef(e,d){const v=e.m;d.normal.x=v[3]-v[1],d.normal.y=v[7]-v[5],d.normal.z=v[11]-v[9],d.d=v[15]-v[13],d.normalize()}static GetBottomPlaneToRef(e,d){const v=e.m;d.normal.x=v[3]+v[1],d.normal.y=v[7]+v[5],d.normal.z=v[11]+v[9],d.d=v[15]+v[13],d.normalize()}static GetPlanesToRef(e,d){p.GetNearPlaneToRef(e,d[0]),p.GetFarPlaneToRef(e,d[1]),p.GetLeftPlaneToRef(e,d[2]),p.GetRightPlaneToRef(e,d[3]),p.GetTopPlaneToRef(e,d[4]),p.GetBottomPlaneToRef(e,d[5])}static IsPointInFrustum(e,d){for(let v=0;v<6;v++)if(d[v].dotCoordinate(e)<0)return!1;return!0}}},12633:(e,d,v)=>{v.d(d,{e:()=>p});var P=v(12265);class p{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(e,d){p.Enabled&&(this._current+=e,d&&this._fetchResult())}beginMonitoring(){p.Enabled&&(this._startMonitoringTime=P.d.Now)}endMonitoring(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!p.Enabled)return;e&&this.fetchNewFrame();const d=P.d.Now;this._current=d-this._startMonitoringTime,e&&this._fetchResult()}gd(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const e=P.d.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}p.Enabled=!0},12512:(e,d,v)=>{v.d(d,{b:()=>p,d:()=>P});class P{constructor(e){this.length=0,this.data=new Array(e),this._id=P._GlobalId++}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}forEach(e){for(let d=0;d<this.length;d++)e(this.data[d])}sort(e){this.data.sort(e)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let d=0;d<e.length;d++)this.data[this.length++]=(e.data||e)[d]}}indexOf(e){const d=this.data.indexOf(e);return d>=this.length?-1:d}contains(e){return-1!==this.indexOf(e)}}P._GlobalId=0;class p extends P{constructor(){super(...arguments),this._duplicateId=0}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let d=0;d<e.length;d++){const v=(e.data||e)[d];this.pushNoDuplicate(v)}}}}},12482:(e,d,v)=>{v.d(d,{c:()=>L});var P=v(12490),p=v(12248);class L{constructor(e){this._vertexBuffers={},this.onBeforeRenderObservable=new p.d,this._scene=e}_prepareBuffers(){if(this._vertexBuffers[P.i.PositionKind])return;const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[P.i.PositionKind]=new P.i(this._scene.getEngine(),e,P.i.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}_rebuild(){const e=this._vertexBuffers[P.i.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=this._scene.activeCamera;return!!v&&(d=d||v._postProcesses.filter((e=>null!=e)),!(!d||0===d.length||!this._scene.postProcessesEnabled)&&(d[0].activate(v,e,null!==d&&void 0!==d),!0))}directRender(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.length;const X=this._scene.getEngine();for(let W=0;W<B;W++){var z;if(W<e.length-1)e[W+1].activate(this._scene.activeCamera||this._scene,null===d||void 0===d?void 0:d.texture);else d?X.bindFramebuffer(d,P,void 0,void 0,v,p):L||X.restoreDefaultFramebuffer(),null===(z=X._debugInsertMarker)||void 0===z||z.call(X,`post process ${e[W].name} output`);const B=e[W],V=B.apply();V&&(B.onBeforeRenderObservable.notifyObservers(V),this._prepareBuffers(),X.bindBuffers(this._vertexBuffers,this._indexBuffer,V),X.drawElementsType(0,0,6),B.onAfterRenderObservable.notifyObservers(V))}X.setDepthBuffer(!0),X.setDepthWrite(!0)}_finalizeFrame(e,d,v,P){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const L=this._scene.activeCamera;if(!L)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(P=P||L._postProcesses.filter((e=>null!=e))).length||!this._scene.postProcessesEnabled)return;const B=this._scene.getEngine();for(let z=0,W=P.length;z<W;z++){const V=P[z];var X;if(z<W-1)V._outputTexture=P[z+1].activate(L,null===d||void 0===d?void 0:d.texture);else d?(B.bindFramebuffer(d,v,void 0,void 0,p),V._outputTexture=d):(B.restoreDefaultFramebuffer(),V._outputTexture=null),null===(X=B._debugInsertMarker)||void 0===X||X.call(B,`post process ${P[z].name} output`);if(e)break;const k=V.apply();k&&(V.onBeforeRenderObservable.notifyObservers(k),this._prepareBuffers(),B.bindBuffers(this._vertexBuffers,this._indexBuffer,k),B.drawElementsType(0,0,6),V.onAfterRenderObservable.notifyObservers(k))}B.setDepthBuffer(!0),B.setDepthWrite(!0),B.setAlphaMode(0)}dispose(){const e=this._vertexBuffers[P.i.PositionKind];e&&(e.dispose(),this._vertexBuffers[P.i.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12503:(e,d,v)=>{v.d(d,{b:()=>X});var P=v(12512),p=v(12420);class L{set opaqueSortCompareFn(e){this._opaqueSortCompareFn=e||L.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(e){this._alphaTestSortCompareFn=e||L.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(e){this._transparentSortCompareFn=e||L.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(e,d){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=e,this._opaqueSubMeshes=new P.d(256),this._transparentSubMeshes=new P.d(256),this._alphaTestSubMeshes=new P.d(256),this._depthOnlySubMeshes=new P.d(256),this._particleSystems=new P.d(256),this._spriteManagers=new P.d(256),this._empty=!0,this._edgesRenderers=new P.b(16),this._scene=d,this.opaqueSortCompareFn=v,this.alphaTestSortCompareFn=p,this.transparentSortCompareFn=L}render(e,d,v,P){if(e)return void e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const p=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(p.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),p.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const L=p.getStencilBuffer();if(p.setStencilBuffer(!1),d&&this._renderSprites(),v&&this._renderParticles(P),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(p.setStencilBuffer(L),this._scene.useOrderIndependentTransparency){const e=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);e.length&&this._renderTransparent(e)}else this._renderTransparent(this._transparentSubMeshes);p.setAlphaMode(0)}if(p.setStencilBuffer(!1),this._edgesRenderers.length){for(let e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();p.setAlphaMode(0)}p.setStencilBuffer(L)}_renderOpaqueSorted(e){L._RenderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(e){L._RenderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(e){L._RenderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(e,d,v,P){let B,X=0;const z=v?v.globalPosition:L._ZeroVector;if(P)for(;X<e.length;X++)B=e.data[X],B._alphaIndex=B.getMesh().alphaIndex,B._distanceToCamera=p.mv.Distance(B.getBoundingInfo().boundingSphere.centerWorld,z);const W=e.length===e.data.length?e.data:e.data.slice(0,e.length);d&&W.sort(d);const V=W[0].getMesh().Ae();for(X=0;X<W.length;X++)if(B=W[X],!V._activeMeshesFrozenButKeepClipping||B.isInFrustum(V._frustumPlanes)){if(P){const e=B.Ne();if(e&&e.needDepthPrePass){const d=e.Ae().getEngine();d.setColorWrite(!1),d.setAlphaMode(0),B.render(!1),d.setColorWrite(!0)}}B.render(P)}}static defaultTransparentSortCompare(e,d){return e._alphaIndex>d._alphaIndex?1:e._alphaIndex<d._alphaIndex?-1:L.backToFrontSortCompare(e,d)}static backToFrontSortCompare(e,d){return e._distanceToCamera<d._distanceToCamera?1:e._distanceToCamera>d._distanceToCamera?-1:0}static frontToBackSortCompare(e,d){return e._distanceToCamera<d._distanceToCamera?-1:e._distanceToCamera>d._distanceToCamera?1:0}static PainterSortCompare(e,d){const v=e.getMesh(),P=d.getMesh();return v.material&&P.material?v.material.uniqueId-P.material.uniqueId:v.uniqueId-P.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(e,d,v){void 0===d&&(d=e.getMesh()),void 0===v&&(v=e.Ne()),null!==v&&void 0!==v&&(v.needAlphaBlendingForMesh(d)?this._transparentSubMeshes.push(e):v.needAlphaTestingForMesh(d)?(v.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(v.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),d._renderingGroup=this,d._edgesRenderer&&d.isEnabled()&&d.isVisible&&d._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(d._edgesRenderer),this._empty=!1)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}_renderParticles(e){if(0===this._particleSystems.length)return;const d=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let v=0;v<this._particleSystems.length;v++){const P=this._particleSystems.data[v];if(0===(d&&d.layerMask&P.layerMask))continue;const p=P.Pd;p.position&&e&&-1===e.indexOf(p)||this._scene._activeParticles.addCount(P.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let d=0;d<this._spriteManagers.length;d++){const v=this._spriteManagers.data[d];0!==(e&&e.layerMask&v.layerMask)&&v.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}L._ZeroVector=p.mv.Zero();class B{}class X{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const e of this._scene.meshes)if(e.Qd)for(const d of e.Qd)d._wasDispatched=!1;if(this._scene.spriteManagers)for(const e of this._scene.spriteManagers)e._wasDispatched=!1;for(const e of this._scene.sk)e._wasDispatched=!1}constructor(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new B,this._maintainStateBetweenFrames=!1,this._scene=e;for(let d=X.MIN_RENDERINGGROUPS;d<X.MAX_RENDERINGGROUPS;d++)this._autoClearDepthStencil[d]={od:!0,depth:!0,hd:!0}}getRenderingGroup(e){const d=e||0;return this._prepareRenderingGroup(d),this._renderingGroups[d]}_clearDepthStencilBuffer(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,d),this._depthStencilBufferAlreadyCleaned=!0)}render(e,d,v,P){const p=this._renderingGroupInfo;if(p.fd=this._scene,p.camera=this._scene.activeCamera,p.renderingManager=this,this._scene.spriteManagers&&P)for(let L=0;L<this._scene.spriteManagers.length;L++){const e=this._scene.spriteManagers[L];this.dispatchSprites(e)}for(let L=X.MIN_RENDERINGGROUPS;L<X.MAX_RENDERINGGROUPS;L++){this._depthStencilBufferAlreadyCleaned=L===X.MIN_RENDERINGGROUPS;const B=this._renderingGroups[L];if(!B||B._empty)continue;const z=1<<L;if(p.renderingGroupId=L,this._scene.onBeforeRenderingGroupObservable.notifyObservers(p,z),X.AUTOCLEAR){const e=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(L):this._autoClearDepthStencil[L];e&&e.od&&this._clearDepthStencilBuffer(e.depth,e.hd)}for(const e of this._scene._beforeRenderingGroupDrawStage)e.action(L);B.render(e,P,v,d);for(const e of this._scene._afterRenderingGroupDrawStage)e.action(L);this._scene.onAfterRenderingGroupObservable.notifyObservers(p,z)}}reset(){if(!this.maintainStateBetweenFrames)for(let e=X.MIN_RENDERINGGROUPS;e<X.MAX_RENDERINGGROUPS;e++){const d=this._renderingGroups[e];d&&d.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let e=X.MIN_RENDERINGGROUPS;e<X.MAX_RENDERINGGROUPS;e++){const d=this._renderingGroups[e];d&&d.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let e=X.MIN_RENDERINGGROUPS;e<X.MAX_RENDERINGGROUPS;e++){const d=this._renderingGroups[e];d&&d.dispose()}}_prepareRenderingGroup(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new L(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchSprites(e))}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchParticles(e))}dispatch(e,d,v){void 0===d&&(d=e.getMesh()),this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(d.renderingGroupId).dispatch(e,d,v))}setRenderingOrder(e){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[e]=d,this._customAlphaTestSortCompareFn[e]=v,this._customTransparentSortCompareFn[e]=P,this._renderingGroups[e]){const d=this._renderingGroups[e];d.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],d.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],d.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}setRenderingAutoClearDepthStencil(e,d){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[e]={od:d,depth:v,hd:P}}getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}}X.MAX_RENDERINGGROUPS=4,X.MIN_RENDERINGGROUPS=0,X.AUTOCLEAR=!0}}]);