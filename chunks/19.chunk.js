"use strict";(self.ex92n20nlz8=self.ex92n20nlz8||[]).push([[19],{12659:(I,g,b)=>{b.d(g,{d:()=>M,f:()=>J});var e=b(12667),c=b(12420),z=b(12670);class M{get Z(){return this._isDisposed}constructor(I,g,b){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],M=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],o=arguments.length>7?arguments[7]:void 0,n=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,I&&I.EI?this._engine=I.EI().getEngine():this._engine=I,this._updatable=b,this._instanced=M,this._divisor=o||1,this._label=n,g instanceof e.b?(this._data=null,this._buffer=g):(this._data=g,this._buffer=null),this.byteStride=J?c:c*Float32Array.BYTES_PER_ELEMENT,z||this.create()}createVertexBuffer(I,g,b,e,c){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6?arguments[6]:void 0;const o=z?g:g*Float32Array.BYTES_PER_ELEMENT,n=e?z?e:e*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new J(this._engine,this,I,this._updatable,!0,n,void 0===c?this._instanced:c,o,b,void 0,void 0,!0,this._divisor||M)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!I&&this._buffer||(I=I||this._data,I&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,I),this._data=I):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(I,this._label),this._data=I):this._buffer=this._engine.createVertexBuffer(I,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.He>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.He,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.He,void 0,this._label));c.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(I){this.create(I)}updateDirectly(I,g,b){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,I,e?g:g*Float32Array.BYTES_PER_ELEMENT,b?b*this.byteStride:void 0),this._data=0===g&&void 0===b?I:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class J{get Z(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(I){const g=0!=I;this._instanceDivisor=I,g!==this._instanced&&(this._instanced=g,this._computeHashCode())}get _maxVerticesCount(){const I=this.getData();return I?Array.isArray(I)?I.length/(this.byteStride/4)-this.byteOffset/4:(I.byteLength-this.byteOffset)/this.byteStride:0}constructor(I,g,b,e,c,o,n,G,D,p){let x=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Z=arguments.length>11&&void 0!==arguments[11]&&arguments[11],k=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,S=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let f=!1;if(this.kg=I,"object"===typeof e&&null!==e?(f=e.updatable??!1,c=e.postponeInternalCreation,o=e.stride,n=e.instanced,G=e.offset,D=e.size,p=e.type,x=e.normalized??!1,Z=e.useBytes??!1,k=e.divisor??1,S=e.takeBufferOwnership??!1,this._label=e.label):f=!!e,g instanceof M?(this._buffer=g,this._ownsBuffer=S):(this._buffer=new M(I,g,f,o,c,n,Z,k,this._label),this._ownsBuffer=!0),this.uniqueId=J._Counter++,this._kind=b,void 0===p){const I=this.getData();this.type=I?J.GetDataType(I):J.FLOAT}else this.type=p;const V=(0,z.o)(this.type);Z?(this._size=D||(o?o/V:J.DeduceStride(b)),this.byteStride=o||this._buffer.byteStride||this._size*V,this.byteOffset=G||0):(this._size=D||o||J.DeduceStride(b),this.byteStride=o?o*V:this._buffer.byteStride||this._size*V,this.byteOffset=(G||0)*V),this.normalized=x,this._instanced=void 0!==n&&n,this._instanceDivisor=n?k:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var I;null===(I=this._buffer)||void 0===I||I._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(I,g){const b=this.getData();return b?(0,z.k)(b,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,I,g):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,z.o)(this.type)}getOffset(){return this.byteOffset/(0,z.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,z.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(I){this._buffer.create(I),this._alignBuffer()}update(I){this._buffer.update(I),this._alignBuffer()}updateDirectly(I,g){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(I,g,void 0,b),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(I,g){(0,z.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,I,this.normalized,((I,b)=>{for(let e=0;e<this._size;e++)g(I[e],b+e)}))}_alignBuffer(){}static DeduceStride(I){switch(I){case J.UVKind:case J.UV2Kind:case J.UV3Kind:case J.UV4Kind:case J.UV5Kind:case J.UV6Kind:return 2;case J.NormalKind:case J.PositionKind:return 3;case J.ColorKind:case J.ColorInstanceKind:case J.MatricesIndicesKind:case J.MatricesIndicesExtraKind:case J.MatricesWeightsKind:case J.MatricesWeightsExtraKind:case J.TangentKind:return 4;default:throw new Error("Invalid kind '"+I+"'")}}static GetDataType(I){return I instanceof Int8Array?J.BYTE:I instanceof Uint8Array?J.UNSIGNED_BYTE:I instanceof Int16Array?J.SHORT:I instanceof Uint16Array?J.UNSIGNED_SHORT:I instanceof Int32Array?J.INT:I instanceof Uint32Array?J.UNSIGNED_INT:J.FLOAT}static GetTypeByteLength(I){return(0,z.o)(I)}static ForEach(I,g,b,e,c,M,J,o){(0,z.h)(I,g,b,e,c,M,J,((I,g)=>{for(let b=0;b<e;b++)o(I[b],g+b)}))}static GetFloatData(I,g,b,e,c,M,J,o){return(0,z.k)(I,g,b,e,c,M,J,o)}}J._Counter=0,J.BYTE=5120,J.UNSIGNED_BYTE=5121,J.SHORT=5122,J.UNSIGNED_SHORT=5123,J.INT=5124,J.UNSIGNED_INT=5125,J.FLOAT=5126,J.PositionKind="position",J.NormalKind="normal",J.TangentKind="tangent",J.UVKind="uv",J.UV2Kind="uv2",J.UV3Kind="uv3",J.UV4Kind="uv4",J.UV5Kind="uv5",J.UV6Kind="uv6",J.ColorKind="color",J.ColorInstanceKind="instanceColor",J.MatricesIndicesKind="matricesIndices",J.MatricesWeightsKind="matricesWeights",J.MatricesIndicesExtraKind="matricesIndicesExtra",J.MatricesWeightsExtraKind="matricesWeightsExtra"},12670:(I,g,b)=>{b.d(g,{d:()=>p,f:()=>D,h:()=>o,k:()=>n,o:()=>M,s:()=>J,v:()=>G});var e=b(12420);function c(I,g,b,e){switch(g){case 5120:{let g=I.getInt8(b);return e&&(g=Math.max(g/127,-1)),g}case 5121:{let g=I.getUint8(b);return e&&(g/=255),g}case 5122:{let g=I.getInt16(b,!0);return e&&(g=Math.max(g/32767,-1)),g}case 5123:{let g=I.getUint16(b,!0);return e&&(g/=65535),g}case 5124:return I.getInt32(b,!0);case 5125:return I.getUint32(b,!0);case 5126:return I.getFloat32(b,!0);default:throw new Error(`Invalid component type ${g}`)}}function z(I,g,b,e,c){switch(g){case 5120:e&&(c=Math.round(127*c)),I.setInt8(b,c);break;case 5121:e&&(c=Math.round(255*c)),I.setUint8(b,c);break;case 5122:e&&(c=Math.round(32767*c)),I.setInt16(b,c,!0);break;case 5123:e&&(c=Math.round(65535*c)),I.setUint16(b,c,!0);break;case 5124:I.setInt32(b,c,!0);break;case 5125:I.setUint32(b,c,!0);break;case 5126:I.setFloat32(b,c,!0);break;default:throw new Error(`Invalid component type ${g}`)}}function M(I){switch(I){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${I}'`)}}function J(I){switch(I){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${I}'`)}}function o(I,g,b,e,J,o,n,G){const D=new Array(e),p=new Array(e);if(I instanceof Array){let c=g/4;const z=b/4;for(let g=0;g<o;g+=e){for(let g=0;g<e;g++)D[g]=p[g]=I[c+g];G(p,g);for(let g=0;g<e;g++)D[g]!==p[g]&&(I[c+g]=p[g]);c+=z}}else{const x=ArrayBuffer.isView(I)?new DataView(I.buffer,I.byteOffset,I.byteLength):new DataView(I),Z=M(J);for(let I=0;I<o;I+=e){for(let I=0,b=g;I<e;I++,b+=Z)D[I]=p[I]=c(x,J,b,n);G(p,I);for(let I=0,b=g;I<e;I++,b+=Z)D[I]!==p[I]&&z(x,J,b,n,p[I]);g+=b}}}function n(I,g,b,c,z,J,n,G){const D=g*M(b),p=n*g;if(5126!==b||z!==D){const e=new Float32Array(p);return o(I,c,z,g,b,p,J,((I,b)=>{for(let c=0;c<g;c++)e[b+c]=I[c]})),e}if(!(I instanceof Array||I instanceof Float32Array)||0!==c||I.length!==p){if(I instanceof Array){const g=c/4;return I.slice(g,g+p)}if(I instanceof ArrayBuffer)return new Float32Array(I,c,p);{const g=I.byteOffset+c;return 0!==(3&g)&&(e.b.Warn("Float array must be aligned to 4-bytes border"),G=!0),G?new Float32Array(I.buffer.slice(g,g+p*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(I.buffer,g,p)}}return G?I.slice():I}function G(I,g,b,c,z,n,G,D){const p=M(b),x=J(b),Z=G*g;if(Array.isArray(I)){if(0!==(3&c)||0!==(3&z))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const e=c/4,M=z/4;if(e+(G-1)*M+g>I.length)throw new Error("Last accessed index is out of bounds.");if(M<g)throw new Error("Data stride cannot be smaller than the component size.");if(M!==g){const e=new x(Z);return o(I,c,z,g,b,Z,n,((I,b)=>{for(let c=0;c<g;c++)e[b+c]=I[c]})),e}return new x(I.slice(e,e+Z))}let k,S=c;I instanceof ArrayBuffer?k=I:(k=I.buffer,S+=I.byteOffset);if(S+(G-1)*z+g*p>k.byteLength)throw new Error("Last accessed byte is out of bounds.");const f=g*p;if(z<f)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(z!==f){const I=new x(Z);return o(k,S,z,g,b,Z,n,((b,e)=>{for(let c=0;c<g;c++)I[e+c]=b[c]})),I}return 1!==p&&0!==(S&p-1)&&(e.b.Warn("Array must be aligned to border of element size. Data will be copied."),D=!0),D?new x(k.slice(S,S+Z*p)):new x(k,S,Z)}function D(I,g,b,c,z,J,n,G){const D=g*M(b),p=n*g;if(G.length!==p)throw new Error("Output length is not valid");if(5126===b&&z===D)if(I instanceof Array){const g=c/4;G.set(I,g)}else if(I instanceof ArrayBuffer){const g=new Float32Array(I,c,p);G.set(g)}else{const g=I.byteOffset+c;if(0!==(3&g))return e.b.Warn("Float array must be aligned to 4-bytes border"),void G.set(new Float32Array(I.buffer.slice(g,g+p*Float32Array.BYTES_PER_ELEMENT)));const b=new Float32Array(I.buffer,g,p);G.set(b)}else o(I,c,z,g,b,p,J,((I,b)=>{for(let e=0;e<g;e++)G[b+e]=I[e]}))}function p(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(I)){for(let c=0;c<g;c++)if(I[b+c]-e>65535)return!0;return!1}return 4===I.BYTES_PER_ELEMENT}},12667:(I,g,b)=>{b.d(g,{b:()=>e});class e{get underlyingResource(){return null}constructor(){this.references=0,this.He=0,this.is32Bits=!1,this.uniqueId=e._Counter++}}e._Counter=0},12704:(I,g,b)=>{b.d(g,{e:()=>c});var e=b(12488);class c{static GetEffect(I){return void 0===I.getPipelineContext?I.effect:I}constructor(I){let g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=I.createDrawContext(),g&&(this.materialContext=I.createMaterialContext())}setEffect(I,g){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var e;(this.effect=I,void 0!==g&&(this.defines=g),b)&&(null===(e=this.drawContext)||void 0===e||e.reset())}dispose(){var I;let g=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const I=this.effect;g?I.dispose():e.d.SetImmediate((()=>{I.getEngine().onEndFrameObservable.addOnce((()=>{I.dispose()}))})),this.effect=null}null===(I=this.drawContext)||void 0===I||I.dispose()}}},12789:(I,g,b)=>{b.d(g,{d:()=>c});var e=b(12646);class c{static GetPlanes(I){const g=[];for(let b=0;b<6;b++)g.push(new e.b(0,0,0,0));return c.GetPlanesToRef(I,g),g}static GetNearPlaneToRef(I,g){const b=I.m;g.normal.x=b[3]+b[2],g.normal.y=b[7]+b[6],g.normal.z=b[11]+b[10],g.d=b[15]+b[14],g.normalize()}static GetFarPlaneToRef(I,g){const b=I.m;g.normal.x=b[3]-b[2],g.normal.y=b[7]-b[6],g.normal.z=b[11]-b[10],g.d=b[15]-b[14],g.normalize()}static GetLeftPlaneToRef(I,g){const b=I.m;g.normal.x=b[3]+b[0],g.normal.y=b[7]+b[4],g.normal.z=b[11]+b[8],g.d=b[15]+b[12],g.normalize()}static GetRightPlaneToRef(I,g){const b=I.m;g.normal.x=b[3]-b[0],g.normal.y=b[7]-b[4],g.normal.z=b[11]-b[8],g.d=b[15]-b[12],g.normalize()}static GetTopPlaneToRef(I,g){const b=I.m;g.normal.x=b[3]-b[1],g.normal.y=b[7]-b[5],g.normal.z=b[11]-b[9],g.d=b[15]-b[13],g.normalize()}static GetBottomPlaneToRef(I,g){const b=I.m;g.normal.x=b[3]+b[1],g.normal.y=b[7]+b[5],g.normal.z=b[11]+b[9],g.d=b[15]+b[13],g.normalize()}static GetPlanesToRef(I,g){c.GetNearPlaneToRef(I,g[0]),c.GetFarPlaneToRef(I,g[1]),c.GetLeftPlaneToRef(I,g[2]),c.GetRightPlaneToRef(I,g[3]),c.GetTopPlaneToRef(I,g[4]),c.GetBottomPlaneToRef(I,g[5])}static IsPointInFrustum(I,g){for(let b=0;b<6;b++)if(g[b].dotCoordinate(I)<0)return!1;return!0}}},12794:(I,g,b)=>{b.d(g,{d:()=>c});var e=b(12433);class c{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(I,g){c.Enabled&&(this._current+=I,g&&this._fetchResult())}beginMonitoring(){c.Enabled&&(this._startMonitoringTime=e.b.Now)}endMonitoring(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!c.Enabled)return;I&&this.fetchNewFrame();const g=e.b.Now;this._current=g-this._startMonitoringTime,I&&this._fetchResult()}Cg(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const I=e.b.Now;I-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=I,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}c.Enabled=!0},12682:(I,g,b)=>{b.d(g,{e:()=>c,i:()=>e});class e{constructor(I){this.length=0,this.data=new Array(I),this._id=e._GlobalId++}push(I){this.data[this.length++]=I,this.length>this.data.length&&(this.data.length*=2)}forEach(I){for(let g=0;g<this.length;g++)I(this.data[g])}sort(I){this.data.sort(I)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(I){if(0!==I.length){this.length+I.length>this.data.length&&(this.data.length=2*(this.length+I.length));for(let g=0;g<I.length;g++)this.data[this.length++]=(I.data||I)[g]}}indexOf(I){const g=this.data.indexOf(I);return g>=this.length?-1:g}contains(I){return-1!==this.indexOf(I)}}e._GlobalId=0;class c extends e{constructor(){super(...arguments),this._duplicateId=0}push(I){super.push(I),I.__smartArrayFlags||(I.__smartArrayFlags={}),I.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(I){return(!I.__smartArrayFlags||I.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(I),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(I){if(0!==I.length){this.length+I.length>this.data.length&&(this.data.length=2*(this.length+I.length));for(let g=0;g<I.length;g++){const b=(I.data||I)[g];this.pushNoDuplicate(b)}}}}},12656:(I,g,b)=>{b.d(g,{c:()=>z});var e=b(12659),c=b(12412);class z{constructor(I){this._vertexBuffers={},this.onBeforeRenderObservable=new c.c,this._scene=I}_prepareBuffers(){if(this._vertexBuffers[e.f.PositionKind])return;const I=[];I.push(1,1),I.push(-1,1),I.push(-1,-1),I.push(1,-1),this._vertexBuffers[e.f.PositionKind]=new e.f(this._scene.getEngine(),I,e.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const I=[];I.push(0),I.push(1),I.push(2),I.push(0),I.push(2),I.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(I)}_rebuild(){const I=this._vertexBuffers[e.f.PositionKind];I&&(I._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this._scene.activeCamera;return!!b&&(g=g||b._postProcesses.filter((I=>null!=I)),!(!g||0===g.length||!this._scene.postProcessesEnabled)&&(g[0].activate(b,I,null!==g&&void 0!==g),!0))}directRender(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]?arguments[6]:I.length;const J=this._scene.getEngine();for(let n=0;n<M;n++){var o;if(n<I.length-1)I[n+1].activate(this._scene.activeCamera||this._scene,null===g||void 0===g?void 0:g.texture);else g?J.bindFramebuffer(g,e,void 0,void 0,b,c):z||J.restoreDefaultFramebuffer(),null===(o=J._debugInsertMarker)||void 0===o||o.call(J,`post process ${I[n].name} output`);const M=I[n],G=M.apply();G&&(M.onBeforeRenderObservable.notifyObservers(G),this._prepareBuffers(),J.bindBuffers(this._vertexBuffers,this._indexBuffer,G),J.drawElementsType(0,0,6),M.onAfterRenderObservable.notifyObservers(G))}J.setDepthBuffer(!0),J.setDepthWrite(!0)}_finalizeFrame(I,g,b,e){let c=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const z=this._scene.activeCamera;if(!z)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(e=e||z._postProcesses.filter((I=>null!=I))).length||!this._scene.postProcessesEnabled)return;const M=this._scene.getEngine();for(let o=0,n=e.length;o<n;o++){const G=e[o];var J;if(o<n-1)G._outputTexture=e[o+1].activate(z,null===g||void 0===g?void 0:g.texture);else g?(M.bindFramebuffer(g,b,void 0,void 0,c),G._outputTexture=g):(M.restoreDefaultFramebuffer(),G._outputTexture=null),null===(J=M._debugInsertMarker)||void 0===J||J.call(M,`post process ${e[o].name} output`);if(I)break;const D=G.apply();D&&(G.onBeforeRenderObservable.notifyObservers(D),this._prepareBuffers(),M.bindBuffers(this._vertexBuffers,this._indexBuffer,D),M.drawElementsType(0,0,6),G.onAfterRenderObservable.notifyObservers(D))}M.setDepthBuffer(!0),M.setDepthWrite(!0),M.setAlphaMode(0)}dispose(){const I=this._vertexBuffers[e.f.PositionKind];I&&(I.dispose(),this._vertexBuffers[e.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12678:(I,g,b)=>{b.d(g,{d:()=>J});var e=b(12682),c=b(12590);class z{set opaqueSortCompareFn(I){this._opaqueSortCompareFn=I||z.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(I){this._alphaTestSortCompareFn=I||z.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(I){this._transparentSortCompareFn=I||z.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(I,g){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=I,this._opaqueSubMeshes=new e.i(256),this._transparentSubMeshes=new e.i(256),this._alphaTestSubMeshes=new e.i(256),this._depthOnlySubMeshes=new e.i(256),this._particleSystems=new e.i(256),this._spriteManagers=new e.i(256),this._empty=!0,this._edgesRenderers=new e.e(16),this._scene=g,this.opaqueSortCompareFn=b,this.alphaTestSortCompareFn=c,this.transparentSortCompareFn=z}render(I,g,b,e){if(I)return void I(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const c=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(c.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),c.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const z=c.getStencilBuffer();if(c.setStencilBuffer(!1),g&&this._renderSprites(),b&&this._renderParticles(e),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(c.setStencilBuffer(z),this._scene.useOrderIndependentTransparency){const I=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);I.length&&this._renderTransparent(I)}else this._renderTransparent(this._transparentSubMeshes);c.setAlphaMode(0)}if(c.setStencilBuffer(!1),this._edgesRenderers.length){for(let I=0;I<this._edgesRenderers.length;I++)this._edgesRenderers.data[I].render();c.setAlphaMode(0)}c.setStencilBuffer(z)}_renderOpaqueSorted(I){z._RenderSorted(I,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(I){z._RenderSorted(I,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(I){z._RenderSorted(I,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(I,g,b,e){let M,J=0;const o=b?b.globalPosition:z._ZeroVector;if(e)for(;J<I.length;J++)M=I.data[J],M._alphaIndex=M.getMesh().alphaIndex,M._distanceToCamera=c.Vg.Distance(M.getBoundingInfo().boundingSphere.centerWorld,o);const n=I.length===I.data.length?I.data:I.data.slice(0,I.length);g&&n.sort(g);const G=n[0].getMesh().EI();for(J=0;J<n.length;J++)if(M=n[J],!G._activeMeshesFrozenButKeepClipping||M.isInFrustum(G._frustumPlanes)){if(e){const I=M.hI();if(I&&I.needDepthPrePass){const g=I.EI().getEngine();g.setColorWrite(!1),g.setAlphaMode(0),M.render(!1),g.setColorWrite(!0)}}M.render(e)}}static defaultTransparentSortCompare(I,g){return I._alphaIndex>g._alphaIndex?1:I._alphaIndex<g._alphaIndex?-1:z.backToFrontSortCompare(I,g)}static backToFrontSortCompare(I,g){return I._distanceToCamera<g._distanceToCamera?1:I._distanceToCamera>g._distanceToCamera?-1:0}static frontToBackSortCompare(I,g){return I._distanceToCamera<g._distanceToCamera?-1:I._distanceToCamera>g._distanceToCamera?1:0}static PainterSortCompare(I,g){const b=I.getMesh(),e=g.getMesh();return b.material&&e.material?b.material.uniqueId-e.material.uniqueId:b.uniqueId-e.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(I,g,b){void 0===g&&(g=I.getMesh()),void 0===b&&(b=I.hI()),null!==b&&void 0!==b&&(b.needAlphaBlendingForMesh(g)?this._transparentSubMeshes.push(I):b.needAlphaTestingForMesh(g)?(b.needDepthPrePass&&this._depthOnlySubMeshes.push(I),this._alphaTestSubMeshes.push(I)):(b.needDepthPrePass&&this._depthOnlySubMeshes.push(I),this._opaqueSubMeshes.push(I)),g._renderingGroup=this,g._edgesRenderer&&g.isEnabled()&&g.isVisible&&g._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(g._edgesRenderer),this._empty=!1)}dispatchSprites(I){this._spriteManagers.push(I),this._empty=!1}dispatchParticles(I){this._particleSystems.push(I),this._empty=!1}_renderParticles(I){if(0===this._particleSystems.length)return;const g=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let b=0;b<this._particleSystems.length;b++){const e=this._particleSystems.data[b];if(0===(g&&g.layerMask&e.layerMask))continue;const c=e.cg;c.position&&I&&-1===I.indexOf(c)||this._scene._activeParticles.addCount(e.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const I=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let g=0;g<this._spriteManagers.length;g++){const b=this._spriteManagers.data[g];0!==(I&&I.layerMask&b.layerMask)&&b.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}z._ZeroVector=c.Vg.Zero();class M{}class J{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(I){I!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=I,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const I of this._scene.meshes)if(I.Ib)for(const g of I.Ib)g._wasDispatched=!1;if(this._scene.spriteManagers)for(const I of this._scene.spriteManagers)I._wasDispatched=!1;for(const I of this._scene.Ax)I._wasDispatched=!1}constructor(I){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new M,this._maintainStateBetweenFrames=!1,this._scene=I;for(let g=J.MIN_RENDERINGGROUPS;g<J.MAX_RENDERINGGROUPS;g++)this._autoClearDepthStencil[g]={Wg:!0,depth:!0,ig:!0}}getRenderingGroup(I){const g=I||0;return this._prepareRenderingGroup(g),this._renderingGroups[g]}_clearDepthStencilBuffer(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],g=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,I,g),this._depthStencilBufferAlreadyCleaned=!0)}render(I,g,b,e){const c=this._renderingGroupInfo;if(c.Xg=this._scene,c.camera=this._scene.activeCamera,c.renderingManager=this,this._scene.spriteManagers&&e)for(let z=0;z<this._scene.spriteManagers.length;z++){const I=this._scene.spriteManagers[z];this.dispatchSprites(I)}for(let z=J.MIN_RENDERINGGROUPS;z<J.MAX_RENDERINGGROUPS;z++){this._depthStencilBufferAlreadyCleaned=z===J.MIN_RENDERINGGROUPS;const M=this._renderingGroups[z];if(!M||M._empty)continue;const o=1<<z;if(c.renderingGroupId=z,this._scene.onBeforeRenderingGroupObservable.notifyObservers(c,o),J.AUTOCLEAR){const I=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(z):this._autoClearDepthStencil[z];I&&I.Wg&&this._clearDepthStencilBuffer(I.depth,I.ig)}for(const I of this._scene._beforeRenderingGroupDrawStage)I.action(z);M.render(I,e,b,g);for(const I of this._scene._afterRenderingGroupDrawStage)I.action(z);this._scene.onAfterRenderingGroupObservable.notifyObservers(c,o)}}reset(){if(!this.maintainStateBetweenFrames)for(let I=J.MIN_RENDERINGGROUPS;I<J.MAX_RENDERINGGROUPS;I++){const g=this._renderingGroups[I];g&&g.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let I=J.MIN_RENDERINGGROUPS;I<J.MAX_RENDERINGGROUPS;I++){const g=this._renderingGroups[I];g&&g.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let I=J.MIN_RENDERINGGROUPS;I<J.MAX_RENDERINGGROUPS;I++){const g=this._renderingGroups[I];g&&g.dispose()}}_prepareRenderingGroup(I){void 0===this._renderingGroups[I]&&(this._renderingGroups[I]=new z(I,this._scene,this._customOpaqueSortCompareFn[I],this._customAlphaTestSortCompareFn[I],this._customTransparentSortCompareFn[I]))}dispatchSprites(I){this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatchSprites(I))}dispatchParticles(I){this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatchParticles(I))}dispatch(I,g,b){void 0===g&&(g=I.getMesh()),this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(g.renderingGroupId).dispatch(I,g,b))}setRenderingOrder(I){let g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[I]=g,this._customAlphaTestSortCompareFn[I]=b,this._customTransparentSortCompareFn[I]=e,this._renderingGroups[I]){const g=this._renderingGroups[I];g.opaqueSortCompareFn=this._customOpaqueSortCompareFn[I],g.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[I],g.transparentSortCompareFn=this._customTransparentSortCompareFn[I]}}setRenderingAutoClearDepthStencil(I,g){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[I]={Wg:g,depth:b,ig:e}}getAutoClearDepthStencilSetup(I){return this._autoClearDepthStencil[I]}}J.MAX_RENDERINGGROUPS=4,J.MIN_RENDERINGGROUPS=0,J.AUTOCLEAR=!0}}]);