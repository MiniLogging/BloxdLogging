"use strict";(self.hmihoa2fs98=self.hmihoa2fs98||[]).push([[19],{11752:(b,d,P)=>{P.d(d,{b:()=>q,c:()=>C});var G=P(11759),W=P(11504),i=P(11765);class q{get L(){return this._isDisposed}constructor(b,d,P){let W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],C=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0,L=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,b&&b.Xb?this._engine=b.Xb().getEngine():this._engine=b,this._updatable=P,this._instanced=q,this._divisor=J||1,this._label=L,d instanceof G.b?(this._data=null,this._buffer=d):(this._data=d,this._buffer=null),this.byteStride=C?W:W*Float32Array.BYTES_PER_ELEMENT,i||this.create()}createVertexBuffer(b,d,P,G,W){let i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6?arguments[6]:void 0;const J=i?d:d*Float32Array.BYTES_PER_ELEMENT,L=G?i?G:G*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new C(this._engine,this,b,this._updatable,!0,L,void 0===W?this._instanced:W,J,P,void 0,void 0,!0,this._divisor||q)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!b&&this._buffer||(b=b||this._data,b&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b),this._data=b):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(b,this._label),this._data=b):this._buffer=this._engine.createVertexBuffer(b,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.vd>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.vd,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.vd,void 0,this._label));W.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(b){this.create(b)}updateDirectly(b,d,P){let G=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b,G?d:d*Float32Array.BYTES_PER_ELEMENT,P?P*this.byteStride:void 0),this._data=0===d&&void 0===P?b:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class C{get L(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(b){const d=0!=b;this._instanceDivisor=b,d!==this._instanced&&(this._instanced=d,this._computeHashCode())}get _maxVerticesCount(){const b=this.getData();return b?Array.isArray(b)?b.length/(this.byteStride/4)-this.byteOffset/4:(b.byteLength-this.byteOffset)/this.byteStride:0}constructor(b,d,P,G,W,J,L,x,Y,s){let E=arguments.length>10&&void 0!==arguments[10]&&arguments[10],w=arguments.length>11&&void 0!==arguments[11]&&arguments[11],t=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,r=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let B=!1;if(this.Md=b,"object"===typeof G&&null!==G?(B=G.updatable??!1,W=G.postponeInternalCreation,J=G.stride,L=G.instanced,x=G.offset,Y=G.size,s=G.type,E=G.normalized??!1,w=G.useBytes??!1,t=G.divisor??1,r=G.takeBufferOwnership??!1,this._label=G.label):B=!!G,d instanceof q?(this._buffer=d,this._ownsBuffer=r):(this._buffer=new q(b,d,B,J,W,L,w,t,this._label),this._ownsBuffer=!0),this.uniqueId=C._Counter++,this._kind=P,void 0===s){const b=this.getData();this.type=b?C.GetDataType(b):C.FLOAT}else this.type=s;const n=(0,i.m)(this.type);w?(this._size=Y||(J?J/n:C.DeduceStride(P)),this.byteStride=J||this._buffer.byteStride||this._size*n,this.byteOffset=x||0):(this._size=Y||J||C.DeduceStride(P),this.byteStride=J?J*n:this._buffer.byteStride||this._size*n,this.byteOffset=(x||0)*n),this.normalized=E,this._instanced=void 0!==L&&L,this._instanceDivisor=L?t:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var b;null===(b=this._buffer)||void 0===b||b._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(b,d){const P=this.getData();return P?(0,i.i)(P,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,b,d):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,i.m)(this.type)}getOffset(){return this.byteOffset/(0,i.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,i.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(b){this._buffer.create(b),this._alignBuffer()}update(b){this._buffer.update(b),this._alignBuffer()}updateDirectly(b,d){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(b,d,void 0,P),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(b,d){(0,i.f)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,b,this.normalized,((b,P)=>{for(let G=0;G<this._size;G++)d(b[G],P+G)}))}_alignBuffer(){}static DeduceStride(b){switch(b){case C.UVKind:case C.UV2Kind:case C.UV3Kind:case C.UV4Kind:case C.UV5Kind:case C.UV6Kind:return 2;case C.NormalKind:case C.PositionKind:return 3;case C.ColorKind:case C.ColorInstanceKind:case C.MatricesIndicesKind:case C.MatricesIndicesExtraKind:case C.MatricesWeightsKind:case C.MatricesWeightsExtraKind:case C.TangentKind:return 4;default:throw new Error("Invalid kind '"+b+"'")}}static GetDataType(b){return b instanceof Int8Array?C.BYTE:b instanceof Uint8Array?C.UNSIGNED_BYTE:b instanceof Int16Array?C.SHORT:b instanceof Uint16Array?C.UNSIGNED_SHORT:b instanceof Int32Array?C.INT:b instanceof Uint32Array?C.UNSIGNED_INT:C.FLOAT}static GetTypeByteLength(b){return(0,i.m)(b)}static ForEach(b,d,P,G,W,q,C,J){(0,i.f)(b,d,P,G,W,q,C,((b,d)=>{for(let P=0;P<G;P++)J(b[P],d+P)}))}static GetFloatData(b,d,P,G,W,q,C,J){return(0,i.i)(b,d,P,G,W,q,C,J)}}C._Counter=0,C.BYTE=5120,C.UNSIGNED_BYTE=5121,C.SHORT=5122,C.UNSIGNED_SHORT=5123,C.INT=5124,C.UNSIGNED_INT=5125,C.FLOAT=5126,C.PositionKind="position",C.NormalKind="normal",C.TangentKind="tangent",C.UVKind="uv",C.UV2Kind="uv2",C.UV3Kind="uv3",C.UV4Kind="uv4",C.UV5Kind="uv5",C.UV6Kind="uv6",C.ColorKind="color",C.ColorInstanceKind="instanceColor",C.MatricesIndicesKind="matricesIndices",C.MatricesWeightsKind="matricesWeights",C.MatricesIndicesExtraKind="matricesIndicesExtra",C.MatricesWeightsExtraKind="matricesWeightsExtra"},11765:(b,d,P)=>{P.d(d,{c:()=>s,d:()=>Y,f:()=>J,i:()=>L,m:()=>q,q:()=>C,r:()=>x});var G=P(11504);function W(b,d,P,G){switch(d){case 5120:{let d=b.getInt8(P);return G&&(d=Math.max(d/127,-1)),d}case 5121:{let d=b.getUint8(P);return G&&(d/=255),d}case 5122:{let d=b.getInt16(P,!0);return G&&(d=Math.max(d/32767,-1)),d}case 5123:{let d=b.getUint16(P,!0);return G&&(d/=65535),d}case 5124:return b.getInt32(P,!0);case 5125:return b.getUint32(P,!0);case 5126:return b.getFloat32(P,!0);default:throw new Error(`Invalid component type ${d}`)}}function i(b,d,P,G,W){switch(d){case 5120:G&&(W=Math.round(127*W)),b.setInt8(P,W);break;case 5121:G&&(W=Math.round(255*W)),b.setUint8(P,W);break;case 5122:G&&(W=Math.round(32767*W)),b.setInt16(P,W,!0);break;case 5123:G&&(W=Math.round(65535*W)),b.setUint16(P,W,!0);break;case 5124:b.setInt32(P,W,!0);break;case 5125:b.setUint32(P,W,!0);break;case 5126:b.setFloat32(P,W,!0);break;default:throw new Error(`Invalid component type ${d}`)}}function q(b){switch(b){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${b}'`)}}function C(b){switch(b){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${b}'`)}}function J(b,d,P,G,C,J,L,x){const Y=new Array(G),s=new Array(G);if(b instanceof Array){let W=d/4;const i=P/4;for(let d=0;d<J;d+=G){for(let d=0;d<G;d++)Y[d]=s[d]=b[W+d];x(s,d);for(let d=0;d<G;d++)Y[d]!==s[d]&&(b[W+d]=s[d]);W+=i}}else{const E=ArrayBuffer.isView(b)?new DataView(b.buffer,b.byteOffset,b.byteLength):new DataView(b),w=q(C);for(let b=0;b<J;b+=G){for(let b=0,P=d;b<G;b++,P+=w)Y[b]=s[b]=W(E,C,P,L);x(s,b);for(let b=0,P=d;b<G;b++,P+=w)Y[b]!==s[b]&&i(E,C,P,L,s[b]);d+=P}}}function L(b,d,P,W,i,C,L,x){const Y=d*q(P),s=L*d;if(5126!==P||i!==Y){const G=new Float32Array(s);return J(b,W,i,d,P,s,C,((b,P)=>{for(let W=0;W<d;W++)G[P+W]=b[W]})),G}if(!(b instanceof Array||b instanceof Float32Array)||0!==W||b.length!==s){if(b instanceof Array){const d=W/4;return b.slice(d,d+s)}if(b instanceof ArrayBuffer)return new Float32Array(b,W,s);{const d=b.byteOffset+W;return 0!==(3&d)&&(G.e.Warn("Float array must be aligned to 4-bytes border"),x=!0),x?new Float32Array(b.buffer.slice(d,d+s*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(b.buffer,d,s)}}return x?b.slice():b}function x(b,d,P,W,i,L,x,Y){const s=q(P),E=C(P),w=x*d;if(Array.isArray(b)){if(0!==(3&W)||0!==(3&i))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const G=W/4,q=i/4;if(G+(x-1)*q+d>b.length)throw new Error("Last accessed index is out of bounds.");if(q<d)throw new Error("Data stride cannot be smaller than the component size.");if(q!==d){const G=new E(w);return J(b,W,i,d,P,w,L,((b,P)=>{for(let W=0;W<d;W++)G[P+W]=b[W]})),G}return new E(b.slice(G,G+w))}let t,r=W;b instanceof ArrayBuffer?t=b:(t=b.buffer,r+=b.byteOffset);if(r+(x-1)*i+d*s>t.byteLength)throw new Error("Last accessed byte is out of bounds.");const B=d*s;if(i<B)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(i!==B){const b=new E(w);return J(t,r,i,d,P,w,L,((P,G)=>{for(let W=0;W<d;W++)b[G+W]=P[W]})),b}return 1!==s&&0!==(r&s-1)&&(G.e.Warn("Array must be aligned to border of element size. Data will be copied."),Y=!0),Y?new E(t.slice(r,r+w*s)):new E(t,r,w)}function Y(b,d,P,W,i,C,L,x){const Y=d*q(P),s=L*d;if(x.length!==s)throw new Error("Output length is not valid");if(5126===P&&i===Y)if(b instanceof Array){const d=W/4;x.set(b,d)}else if(b instanceof ArrayBuffer){const d=new Float32Array(b,W,s);x.set(d)}else{const d=b.byteOffset+W;if(0!==(3&d))return G.e.Warn("Float array must be aligned to 4-bytes border"),void x.set(new Float32Array(b.buffer.slice(d,d+s*Float32Array.BYTES_PER_ELEMENT)));const P=new Float32Array(b.buffer,d,s);x.set(P)}else J(b,W,i,d,P,s,C,((b,P)=>{for(let G=0;G<d;G++)x[P+G]=b[G]}))}function s(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(b)){for(let W=0;W<d;W++)if(b[P+W]-G>65535)return!0;return!1}return 4===b.BYTES_PER_ELEMENT}},11759:(b,d,P)=>{P.d(d,{b:()=>G});class G{get underlyingResource(){return null}constructor(){this.references=0,this.vd=0,this.is32Bits=!1,this.uniqueId=G._Counter++}}G._Counter=0},11798:(b,d,P)=>{P.d(d,{b:()=>W});var G=P(11569);class W{static GetEffect(b){return void 0===b.getPipelineContext?b.effect:b}constructor(b){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=b.createDrawContext(),d&&(this.materialContext=b.createMaterialContext())}setEffect(b,d){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var G;(this.effect=b,void 0!==d&&(this.defines=d),P)&&(null===(G=this.drawContext)||void 0===G||G.reset())}dispose(){var b;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const b=this.effect;d?b.dispose():G.c.SetImmediate((()=>{b.getEngine().onEndFrameObservable.addOnce((()=>{b.dispose()}))})),this.effect=null}null===(b=this.drawContext)||void 0===b||b.dispose()}}},11879:(b,d,P)=>{P.d(d,{e:()=>W});var G=P(11733);class W{static GetPlanes(b){const d=[];for(let P=0;P<6;P++)d.push(new G.d(0,0,0,0));return W.GetPlanesToRef(b,d),d}static GetNearPlaneToRef(b,d){const P=b.m;d.normal.x=P[3]+P[2],d.normal.y=P[7]+P[6],d.normal.z=P[11]+P[10],d.d=P[15]+P[14],d.normalize()}static GetFarPlaneToRef(b,d){const P=b.m;d.normal.x=P[3]-P[2],d.normal.y=P[7]-P[6],d.normal.z=P[11]-P[10],d.d=P[15]-P[14],d.normalize()}static GetLeftPlaneToRef(b,d){const P=b.m;d.normal.x=P[3]+P[0],d.normal.y=P[7]+P[4],d.normal.z=P[11]+P[8],d.d=P[15]+P[12],d.normalize()}static GetRightPlaneToRef(b,d){const P=b.m;d.normal.x=P[3]-P[0],d.normal.y=P[7]-P[4],d.normal.z=P[11]-P[8],d.d=P[15]-P[12],d.normalize()}static GetTopPlaneToRef(b,d){const P=b.m;d.normal.x=P[3]-P[1],d.normal.y=P[7]-P[5],d.normal.z=P[11]-P[9],d.d=P[15]-P[13],d.normalize()}static GetBottomPlaneToRef(b,d){const P=b.m;d.normal.x=P[3]+P[1],d.normal.y=P[7]+P[5],d.normal.z=P[11]+P[9],d.d=P[15]+P[13],d.normalize()}static GetPlanesToRef(b,d){W.GetNearPlaneToRef(b,d[0]),W.GetFarPlaneToRef(b,d[1]),W.GetLeftPlaneToRef(b,d[2]),W.GetRightPlaneToRef(b,d[3]),W.GetTopPlaneToRef(b,d[4]),W.GetBottomPlaneToRef(b,d[5])}static IsPointInFrustum(b,d){for(let P=0;P<6;P++)if(d[P].dotCoordinate(b)<0)return!1;return!0}}},11886:(b,d,P)=>{P.d(d,{c:()=>W});var G=P(11517);class W{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(b,d){W.Enabled&&(this._current+=b,d&&this._fetchResult())}beginMonitoring(){W.Enabled&&(this._startMonitoringTime=G.c.Now)}endMonitoring(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!W.Enabled)return;b&&this.fetchNewFrame();const d=G.c.Now;this._current=d-this._startMonitoringTime,b&&this._fetchResult()}td(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const b=G.c.Now;b-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=b,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}W.Enabled=!0},11781:(b,d,P)=>{P.d(d,{c:()=>W,d:()=>G});class G{constructor(b){this.length=0,this.data=new Array(b),this._id=G._GlobalId++}push(b){this.data[this.length++]=b,this.length>this.data.length&&(this.data.length*=2)}forEach(b){for(let d=0;d<this.length;d++)b(this.data[d])}sort(b){this.data.sort(b)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(let d=0;d<b.length;d++)this.data[this.length++]=(b.data||b)[d]}}indexOf(b){const d=this.data.indexOf(b);return d>=this.length?-1:d}contains(b){return-1!==this.indexOf(b)}}G._GlobalId=0;class W extends G{constructor(){super(...arguments),this._duplicateId=0}push(b){super.push(b),b.__smartArrayFlags||(b.__smartArrayFlags={}),b.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(b){return(!b.__smartArrayFlags||b.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(b),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(let d=0;d<b.length;d++){const P=(b.data||b)[d];this.pushNoDuplicate(P)}}}}},11746:(b,d,P)=>{P.d(d,{e:()=>i});var G=P(11752),W=P(11487);class i{constructor(b){this._vertexBuffers={},this.onBeforeRenderObservable=new W.d,this._scene=b}_prepareBuffers(){if(this._vertexBuffers[G.c.PositionKind])return;const b=[];b.push(1,1),b.push(-1,1),b.push(-1,-1),b.push(1,-1),this._vertexBuffers[G.c.PositionKind]=new G.c(this._scene.getEngine(),b,G.c.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const b=[];b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(b)}_rebuild(){const b=this._vertexBuffers[G.c.PositionKind];b&&(b._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=this._scene.activeCamera;return!!P&&(d=d||P._postProcesses.filter((b=>null!=b)),!(!d||0===d.length||!this._scene.postProcessesEnabled)&&(d[0].activate(P,b,null!==d&&void 0!==d),!0))}directRender(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,W=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:b.length;const C=this._scene.getEngine();for(let L=0;L<q;L++){var J;if(L<b.length-1)b[L+1].activate(this._scene.activeCamera||this._scene,null===d||void 0===d?void 0:d.texture);else d?C.bindFramebuffer(d,G,void 0,void 0,P,W):i||C.restoreDefaultFramebuffer(),null===(J=C._debugInsertMarker)||void 0===J||J.call(C,`post process ${b[L].name} output`);const q=b[L],x=q.apply();x&&(q.onBeforeRenderObservable.notifyObservers(x),this._prepareBuffers(),C.bindBuffers(this._vertexBuffers,this._indexBuffer,x),C.drawElementsType(0,0,6),q.onAfterRenderObservable.notifyObservers(x))}C.setDepthBuffer(!0),C.setDepthWrite(!0)}_finalizeFrame(b,d,P,G){let W=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const i=this._scene.activeCamera;if(!i)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(G=G||i._postProcesses.filter((b=>null!=b))).length||!this._scene.postProcessesEnabled)return;const q=this._scene.getEngine();for(let J=0,L=G.length;J<L;J++){const x=G[J];var C;if(J<L-1)x._outputTexture=G[J+1].activate(i,null===d||void 0===d?void 0:d.texture);else d?(q.bindFramebuffer(d,P,void 0,void 0,W),x._outputTexture=d):(q.restoreDefaultFramebuffer(),x._outputTexture=null),null===(C=q._debugInsertMarker)||void 0===C||C.call(q,`post process ${G[J].name} output`);if(b)break;const Y=x.apply();Y&&(x.onBeforeRenderObservable.notifyObservers(Y),this._prepareBuffers(),q.bindBuffers(this._vertexBuffers,this._indexBuffer,Y),q.drawElementsType(0,0,6),x.onAfterRenderObservable.notifyObservers(Y))}q.setDepthBuffer(!0),q.setDepthWrite(!0),q.setAlphaMode(0)}dispose(){const b=this._vertexBuffers[G.c.PositionKind];b&&(b.dispose(),this._vertexBuffers[G.c.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11773:(b,d,P)=>{P.d(d,{b:()=>C});var G=P(11781),W=P(11681);class i{set opaqueSortCompareFn(b){this._opaqueSortCompareFn=b||i.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(b){this._alphaTestSortCompareFn=b||i.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(b){this._transparentSortCompareFn=b||i.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(b,d){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,W=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=b,this._opaqueSubMeshes=new G.d(256),this._transparentSubMeshes=new G.d(256),this._alphaTestSubMeshes=new G.d(256),this._depthOnlySubMeshes=new G.d(256),this._particleSystems=new G.d(256),this._spriteManagers=new G.d(256),this._empty=!0,this._edgesRenderers=new G.c(16),this._scene=d,this.opaqueSortCompareFn=P,this.alphaTestSortCompareFn=W,this.transparentSortCompareFn=i}render(b,d,P,G){if(b)return void b(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const W=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(W.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),W.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const i=W.getStencilBuffer();if(W.setStencilBuffer(!1),d&&this._renderSprites(),P&&this._renderParticles(G),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(W.setStencilBuffer(i),this._scene.useOrderIndependentTransparency){const b=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);b.length&&this._renderTransparent(b)}else this._renderTransparent(this._transparentSubMeshes);W.setAlphaMode(0)}if(W.setStencilBuffer(!1),this._edgesRenderers.length){for(let b=0;b<this._edgesRenderers.length;b++)this._edgesRenderers.data[b].render();W.setAlphaMode(0)}W.setStencilBuffer(i)}_renderOpaqueSorted(b){i._RenderSorted(b,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(b){i._RenderSorted(b,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(b){i._RenderSorted(b,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(b,d,P,G){let q,C=0;const J=P?P.globalPosition:i._ZeroVector;if(G)for(;C<b.length;C++)q=b.data[C],q._alphaIndex=q.getMesh().alphaIndex,q._distanceToCamera=W.ed.Distance(q.getBoundingInfo().boundingSphere.centerWorld,J);const L=b.length===b.data.length?b.data:b.data.slice(0,b.length);d&&L.sort(d);const x=L[0].getMesh().Xb();for(C=0;C<L.length;C++)if(q=L[C],!x._activeMeshesFrozenButKeepClipping||q.isInFrustum(x._frustumPlanes)){if(G){const b=q.ab();if(b&&b.needDepthPrePass){const d=b.Xb().getEngine();d.setColorWrite(!1),d.setAlphaMode(0),q.render(!1),d.setColorWrite(!0)}}q.render(G)}}static defaultTransparentSortCompare(b,d){return b._alphaIndex>d._alphaIndex?1:b._alphaIndex<d._alphaIndex?-1:i.backToFrontSortCompare(b,d)}static backToFrontSortCompare(b,d){return b._distanceToCamera<d._distanceToCamera?1:b._distanceToCamera>d._distanceToCamera?-1:0}static frontToBackSortCompare(b,d){return b._distanceToCamera<d._distanceToCamera?-1:b._distanceToCamera>d._distanceToCamera?1:0}static PainterSortCompare(b,d){const P=b.getMesh(),G=d.getMesh();return P.material&&G.material?P.material.uniqueId-G.material.uniqueId:P.uniqueId-G.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(b,d,P){void 0===d&&(d=b.getMesh()),void 0===P&&(P=b.ab()),null!==P&&void 0!==P&&(P.needAlphaBlendingForMesh(d)?this._transparentSubMeshes.push(b):P.needAlphaTestingForMesh(d)?(P.needDepthPrePass&&this._depthOnlySubMeshes.push(b),this._alphaTestSubMeshes.push(b)):(P.needDepthPrePass&&this._depthOnlySubMeshes.push(b),this._opaqueSubMeshes.push(b)),d._renderingGroup=this,d._edgesRenderer&&d.isEnabled()&&d.isVisible&&d._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(d._edgesRenderer),this._empty=!1)}dispatchSprites(b){this._spriteManagers.push(b),this._empty=!1}dispatchParticles(b){this._particleSystems.push(b),this._empty=!1}_renderParticles(b){if(0===this._particleSystems.length)return;const d=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let P=0;P<this._particleSystems.length;P++){const G=this._particleSystems.data[P];if(0===(d&&d.layerMask&G.layerMask))continue;const W=G.qd;W.position&&b&&-1===b.indexOf(W)||this._scene._activeParticles.addCount(G.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const b=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let d=0;d<this._spriteManagers.length;d++){const P=this._spriteManagers.data[d];0!==(b&&b.layerMask&P.layerMask)&&P.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}i._ZeroVector=W.ed.Zero();class q{}class C{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(b){b!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=b,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const b of this._scene.meshes)if(b.ld)for(const d of b.ld)d._wasDispatched=!1;if(this._scene.spriteManagers)for(const b of this._scene.spriteManagers)b._wasDispatched=!1;for(const b of this._scene.kY)b._wasDispatched=!1}constructor(b){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new q,this._maintainStateBetweenFrames=!1,this._scene=b;for(let d=C.MIN_RENDERINGGROUPS;d<C.MAX_RENDERINGGROUPS;d++)this._autoClearDepthStencil[d]={pd:!0,depth:!0,stencil:!0}}getRenderingGroup(b){const d=b||0;return this._prepareRenderingGroup(d),this._renderingGroups[d]}_clearDepthStencilBuffer(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,b,d),this._depthStencilBufferAlreadyCleaned=!0)}render(b,d,P,G){const W=this._renderingGroupInfo;if(W.Hd=this._scene,W.camera=this._scene.activeCamera,W.renderingManager=this,this._scene.spriteManagers&&G)for(let i=0;i<this._scene.spriteManagers.length;i++){const b=this._scene.spriteManagers[i];this.dispatchSprites(b)}for(let i=C.MIN_RENDERINGGROUPS;i<C.MAX_RENDERINGGROUPS;i++){this._depthStencilBufferAlreadyCleaned=i===C.MIN_RENDERINGGROUPS;const q=this._renderingGroups[i];if(!q||q._empty)continue;const J=1<<i;if(W.renderingGroupId=i,this._scene.onBeforeRenderingGroupObservable.notifyObservers(W,J),C.AUTOCLEAR){const b=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(i):this._autoClearDepthStencil[i];b&&b.pd&&this._clearDepthStencilBuffer(b.depth,b.stencil)}for(const b of this._scene._beforeRenderingGroupDrawStage)b.action(i);q.render(b,G,P,d);for(const b of this._scene._afterRenderingGroupDrawStage)b.action(i);this._scene.onAfterRenderingGroupObservable.notifyObservers(W,J)}}reset(){if(!this.maintainStateBetweenFrames)for(let b=C.MIN_RENDERINGGROUPS;b<C.MAX_RENDERINGGROUPS;b++){const d=this._renderingGroups[b];d&&d.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let b=C.MIN_RENDERINGGROUPS;b<C.MAX_RENDERINGGROUPS;b++){const d=this._renderingGroups[b];d&&d.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let b=C.MIN_RENDERINGGROUPS;b<C.MAX_RENDERINGGROUPS;b++){const d=this._renderingGroups[b];d&&d.dispose()}}_prepareRenderingGroup(b){void 0===this._renderingGroups[b]&&(this._renderingGroups[b]=new i(b,this._scene,this._customOpaqueSortCompareFn[b],this._customAlphaTestSortCompareFn[b],this._customTransparentSortCompareFn[b]))}dispatchSprites(b){this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatchSprites(b))}dispatchParticles(b){this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatchParticles(b))}dispatch(b,d,P){void 0===d&&(d=b.getMesh()),this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(d.renderingGroupId).dispatch(b,d,P))}setRenderingOrder(b){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[b]=d,this._customAlphaTestSortCompareFn[b]=P,this._customTransparentSortCompareFn[b]=G,this._renderingGroups[b]){const d=this._renderingGroups[b];d.opaqueSortCompareFn=this._customOpaqueSortCompareFn[b],d.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[b],d.transparentSortCompareFn=this._customTransparentSortCompareFn[b]}}setRenderingAutoClearDepthStencil(b,d){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],G=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[b]={pd:d,depth:P,stencil:G}}getAutoClearDepthStencilSetup(b){return this._autoClearDepthStencil[b]}}C.MAX_RENDERINGGROUPS=4,C.MIN_RENDERINGGROUPS=0,C.AUTOCLEAR=!0}}]);