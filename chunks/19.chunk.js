"use strict";(self.i6szn8jgzh=self.i6szn8jgzh||[]).push([[19],{11842:(b,n,i)=>{i.d(n,{e:()=>U,g:()=>Y});var e=i(11847),V=i(11621),Q=i(11854);class U{get N(){return this._isDisposed}constructor(b,n,i){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],L=arguments.length>7?arguments[7]:void 0,B=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,b&&b.ab?this._engine=b.ab().getEngine():this._engine=b,this._updatable=i,this._instanced=U,this._divisor=L||1,this._label=B,n instanceof e.d?(this._data=null,this._buffer=n):(this._data=n,this._buffer=null),this.byteStride=Y?V:V*Float32Array.BYTES_PER_ELEMENT,Q||this.create()}createVertexBuffer(b,n,i,e,V){let Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6?arguments[6]:void 0;const L=Q?n:n*Float32Array.BYTES_PER_ELEMENT,B=e?Q?e:e*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Y(this._engine,this,b,this._updatable,!0,B,void 0===V?this._instanced:V,L,i,void 0,void 0,!0,this._divisor||U)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!b&&this._buffer||(b=b||this._data,b&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b),this._data=b):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(b,this._label),this._data=b):this._buffer=this._engine.createVertexBuffer(b,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Dn>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Dn,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Dn,void 0,this._label));V.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(b){this.create(b)}updateDirectly(b,n,i){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b,e?n:n*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===n&&void 0===i?b:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class Y{get N(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(b){const n=0!=b;this._instanceDivisor=b,n!==this._instanced&&(this._instanced=n,this._computeHashCode())}get _maxVerticesCount(){const b=this.getData();return b?Array.isArray(b)?b.length/(this.byteStride/4)-this.byteOffset/4:(b.byteLength-this.byteOffset)/this.byteStride:0}constructor(b,n,i,e,V,L,B,mb,N,Z){let T=arguments.length>10&&void 0!==arguments[10]&&arguments[10],z=arguments.length>11&&void 0!==arguments[11]&&arguments[11],K=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,I=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let O=!1;if(this.In=b,"object"===typeof e&&null!==e?(O=e.updatable??!1,V=e.postponeInternalCreation,L=e.stride,B=e.instanced,mb=e.offset,N=e.size,Z=e.type,T=e.normalized??!1,z=e.useBytes??!1,K=e.divisor??1,I=e.takeBufferOwnership??!1,this._label=e.label):O=!!e,n instanceof U?(this._buffer=n,this._ownsBuffer=I):(this._buffer=new U(b,n,O,L,V,B,z,K,this._label),this._ownsBuffer=!0),this.uniqueId=Y._Counter++,this._kind=i,void 0===Z){const b=this.getData();this.type=b?Y.GetDataType(b):Y.FLOAT}else this.type=Z;const u=(0,Q.r)(this.type);z?(this._size=N||(L?L/u:Y.DeduceStride(i)),this.byteStride=L||this._buffer.byteStride||this._size*u,this.byteOffset=mb||0):(this._size=N||L||Y.DeduceStride(i),this.byteStride=L?L*u:this._buffer.byteStride||this._size*u,this.byteOffset=(mb||0)*u),this.normalized=T,this._instanced=void 0!==B&&B,this._instanceDivisor=B?K:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var b;null===(b=this._buffer)||void 0===b||b._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(b,n){const i=this.getData();return i?(0,Q.n)(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,b,n):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,Q.r)(this.type)}getOffset(){return this.byteOffset/(0,Q.r)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,Q.r)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(b){this._buffer.create(b),this._alignBuffer()}update(b){this._buffer.update(b),this._alignBuffer()}updateDirectly(b,n){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(b,n,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(b,n){(0,Q.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,b,this.normalized,((b,i)=>{for(let e=0;e<this._size;e++)n(b[e],i+e)}))}_alignBuffer(){}static DeduceStride(b){switch(b){case Y.UVKind:case Y.UV2Kind:case Y.UV3Kind:case Y.UV4Kind:case Y.UV5Kind:case Y.UV6Kind:return 2;case Y.NormalKind:case Y.PositionKind:return 3;case Y.ColorKind:case Y.ColorInstanceKind:case Y.MatricesIndicesKind:case Y.MatricesIndicesExtraKind:case Y.MatricesWeightsKind:case Y.MatricesWeightsExtraKind:case Y.TangentKind:return 4;default:throw new Error("Invalid kind '"+b+"'")}}static GetDataType(b){return b instanceof Int8Array?Y.BYTE:b instanceof Uint8Array?Y.UNSIGNED_BYTE:b instanceof Int16Array?Y.SHORT:b instanceof Uint16Array?Y.UNSIGNED_SHORT:b instanceof Int32Array?Y.INT:b instanceof Uint32Array?Y.UNSIGNED_INT:Y.FLOAT}static GetTypeByteLength(b){return(0,Q.r)(b)}static ForEach(b,n,i,e,V,U,Y,L){(0,Q.j)(b,n,i,e,V,U,Y,((b,n)=>{for(let i=0;i<e;i++)L(b[i],n+i)}))}static GetFloatData(b,n,i,e,V,U,Y,L){return(0,Q.n)(b,n,i,e,V,U,Y,L)}}Y._Counter=0,Y.BYTE=5120,Y.UNSIGNED_BYTE=5121,Y.SHORT=5122,Y.UNSIGNED_SHORT=5123,Y.INT=5124,Y.UNSIGNED_INT=5125,Y.FLOAT=5126,Y.PositionKind="position",Y.NormalKind="normal",Y.TangentKind="tangent",Y.UVKind="uv",Y.UV2Kind="uv2",Y.UV3Kind="uv3",Y.UV4Kind="uv4",Y.UV5Kind="uv5",Y.UV6Kind="uv6",Y.ColorKind="color",Y.ColorInstanceKind="instanceColor",Y.MatricesIndicesKind="matricesIndices",Y.MatricesWeightsKind="matricesWeights",Y.MatricesIndicesExtraKind="matricesIndicesExtra",Y.MatricesWeightsExtraKind="matricesWeightsExtra"},11854:(b,n,i)=>{i.d(n,{c:()=>Z,f:()=>N,j:()=>L,n:()=>B,r:()=>U,s:()=>Y,t:()=>mb});var e=i(11621);function V(b,n,i,e){switch(n){case 5120:{let n=b.getInt8(i);return e&&(n=Math.max(n/127,-1)),n}case 5121:{let n=b.getUint8(i);return e&&(n/=255),n}case 5122:{let n=b.getInt16(i,!0);return e&&(n=Math.max(n/32767,-1)),n}case 5123:{let n=b.getUint16(i,!0);return e&&(n/=65535),n}case 5124:return b.getInt32(i,!0);case 5125:return b.getUint32(i,!0);case 5126:return b.getFloat32(i,!0);default:throw new Error(`Invalid component type ${n}`)}}function Q(b,n,i,e,V){switch(n){case 5120:e&&(V=Math.round(127*V)),b.setInt8(i,V);break;case 5121:e&&(V=Math.round(255*V)),b.setUint8(i,V);break;case 5122:e&&(V=Math.round(32767*V)),b.setInt16(i,V,!0);break;case 5123:e&&(V=Math.round(65535*V)),b.setUint16(i,V,!0);break;case 5124:b.setInt32(i,V,!0);break;case 5125:b.setUint32(i,V,!0);break;case 5126:b.setFloat32(i,V,!0);break;default:throw new Error(`Invalid component type ${n}`)}}function U(b){switch(b){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${b}'`)}}function Y(b){switch(b){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${b}'`)}}function L(b,n,i,e,Y,L,B,mb){const N=new Array(e),Z=new Array(e);if(b instanceof Array){let V=n/4;const Q=i/4;for(let n=0;n<L;n+=e){for(let n=0;n<e;n++)N[n]=Z[n]=b[V+n];mb(Z,n);for(let n=0;n<e;n++)N[n]!==Z[n]&&(b[V+n]=Z[n]);V+=Q}}else{const T=ArrayBuffer.isView(b)?new DataView(b.buffer,b.byteOffset,b.byteLength):new DataView(b),z=U(Y);for(let b=0;b<L;b+=e){for(let b=0,i=n;b<e;b++,i+=z)N[b]=Z[b]=V(T,Y,i,B);mb(Z,b);for(let b=0,i=n;b<e;b++,i+=z)N[b]!==Z[b]&&Q(T,Y,i,B,Z[b]);n+=i}}}function B(b,n,i,V,Q,Y,B,mb){const N=n*U(i),Z=B*n;if(5126!==i||Q!==N){const e=new Float32Array(Z);return L(b,V,Q,n,i,Z,Y,((b,i)=>{for(let V=0;V<n;V++)e[i+V]=b[V]})),e}if(!(b instanceof Array||b instanceof Float32Array)||0!==V||b.length!==Z){if(b instanceof Array){const n=V/4;return b.slice(n,n+Z)}if(b instanceof ArrayBuffer)return new Float32Array(b,V,Z);{const n=b.byteOffset+V;return 0!==(3&n)&&(e.b.Warn("Float array must be aligned to 4-bytes border"),mb=!0),mb?new Float32Array(b.buffer.slice(n,n+Z*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(b.buffer,n,Z)}}return mb?b.slice():b}function mb(b,n,i,V,Q,B,mb,N){const Z=U(i),T=Y(i),z=mb*n;if(Array.isArray(b)){if(0!==(3&V)||0!==(3&Q))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const e=V/4,U=Q/4;if(e+(mb-1)*U+n>b.length)throw new Error("Last accessed index is out of bounds.");if(U<n)throw new Error("Data stride cannot be smaller than the component size.");if(U!==n){const e=new T(z);return L(b,V,Q,n,i,z,B,((b,i)=>{for(let V=0;V<n;V++)e[i+V]=b[V]})),e}return new T(b.slice(e,e+z))}let K,I=V;b instanceof ArrayBuffer?K=b:(K=b.buffer,I+=b.byteOffset);if(I+(mb-1)*Q+n*Z>K.byteLength)throw new Error("Last accessed byte is out of bounds.");const O=n*Z;if(Q<O)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(Q!==O){const b=new T(z);return L(K,I,Q,n,i,z,B,((i,e)=>{for(let V=0;V<n;V++)b[e+V]=i[V]})),b}return 1!==Z&&0!==(I&Z-1)&&(e.b.Warn("Array must be aligned to border of element size. Data will be copied."),N=!0),N?new T(K.slice(I,I+z*Z)):new T(K,I,z)}function N(b,n,i,V,Q,Y,B,mb){const N=n*U(i),Z=B*n;if(mb.length!==Z)throw new Error("Output length is not valid");if(5126===i&&Q===N)if(b instanceof Array){const n=V/4;mb.set(b,n)}else if(b instanceof ArrayBuffer){const n=new Float32Array(b,V,Z);mb.set(n)}else{const n=b.byteOffset+V;if(0!==(3&n))return e.b.Warn("Float array must be aligned to 4-bytes border"),void mb.set(new Float32Array(b.buffer.slice(n,n+Z*Float32Array.BYTES_PER_ELEMENT)));const i=new Float32Array(b.buffer,n,Z);mb.set(i)}else L(b,V,Q,n,i,Z,Y,((b,i)=>{for(let e=0;e<n;e++)mb[i+e]=b[e]}))}function Z(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(b)){for(let V=0;V<n;V++)if(b[i+V]-e>65535)return!0;return!1}return 4===b.BYTES_PER_ELEMENT}},11847:(b,n,i)=>{i.d(n,{d:()=>e});class e{get underlyingResource(){return null}constructor(){this.references=0,this.Dn=0,this.is32Bits=!1,this.uniqueId=e._Counter++}}e._Counter=0},11883:(b,n,i)=>{i.d(n,{b:()=>V});var e=i(11674);class V{static GetEffect(b){return void 0===b.getPipelineContext?b.effect:b}constructor(b){let n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=b.createDrawContext(),n&&(this.materialContext=b.createMaterialContext())}setEffect(b,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var e;(this.effect=b,void 0!==n&&(this.defines=n),i)&&(null===(e=this.drawContext)||void 0===e||e.reset())}dispose(){var b;let n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const b=this.effect;n?b.dispose():e.e.SetImmediate((()=>{b.getEngine().onEndFrameObservable.addOnce((()=>{b.dispose()}))})),this.effect=null}null===(b=this.drawContext)||void 0===b||b.dispose()}}},11975:(b,n,i)=>{i.d(n,{c:()=>V});var e=i(11824);class V{static GetPlanes(b){const n=[];for(let i=0;i<6;i++)n.push(new e.c(0,0,0,0));return V.GetPlanesToRef(b,n),n}static GetNearPlaneToRef(b,n){const i=b.m;n.normal.x=i[3]+i[2],n.normal.y=i[7]+i[6],n.normal.z=i[11]+i[10],n.d=i[15]+i[14],n.normalize()}static GetFarPlaneToRef(b,n){const i=b.m;n.normal.x=i[3]-i[2],n.normal.y=i[7]-i[6],n.normal.z=i[11]-i[10],n.d=i[15]-i[14],n.normalize()}static GetLeftPlaneToRef(b,n){const i=b.m;n.normal.x=i[3]+i[0],n.normal.y=i[7]+i[4],n.normal.z=i[11]+i[8],n.d=i[15]+i[12],n.normalize()}static GetRightPlaneToRef(b,n){const i=b.m;n.normal.x=i[3]-i[0],n.normal.y=i[7]-i[4],n.normal.z=i[11]-i[8],n.d=i[15]-i[12],n.normalize()}static GetTopPlaneToRef(b,n){const i=b.m;n.normal.x=i[3]-i[1],n.normal.y=i[7]-i[5],n.normal.z=i[11]-i[9],n.d=i[15]-i[13],n.normalize()}static GetBottomPlaneToRef(b,n){const i=b.m;n.normal.x=i[3]+i[1],n.normal.y=i[7]+i[5],n.normal.z=i[11]+i[9],n.d=i[15]+i[13],n.normalize()}static GetPlanesToRef(b,n){V.GetNearPlaneToRef(b,n[0]),V.GetFarPlaneToRef(b,n[1]),V.GetLeftPlaneToRef(b,n[2]),V.GetRightPlaneToRef(b,n[3]),V.GetTopPlaneToRef(b,n[4]),V.GetBottomPlaneToRef(b,n[5])}static IsPointInFrustum(b,n){for(let i=0;i<6;i++)if(n[i].dotCoordinate(b)<0)return!1;return!0}}},11986:(b,n,i)=>{i.d(n,{e:()=>V});var e=i(11628);class V{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(b,n){V.Enabled&&(this._current+=b,n&&this._fetchResult())}beginMonitoring(){V.Enabled&&(this._startMonitoringTime=e.b.Now)}endMonitoring(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!V.Enabled)return;b&&this.fetchNewFrame();const n=e.b.Now;this._current=n-this._startMonitoringTime,b&&this._fetchResult()}ie(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const b=e.b.Now;b-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=b,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}V.Enabled=!0},11865:(b,n,i)=>{i.d(n,{d:()=>V,h:()=>e});class e{constructor(b){this.length=0,this.data=new Array(b),this._id=e._GlobalId++}push(b){this.data[this.length++]=b,this.length>this.data.length&&(this.data.length*=2)}forEach(b){for(let n=0;n<this.length;n++)b(this.data[n])}sort(b){this.data.sort(b)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(let n=0;n<b.length;n++)this.data[this.length++]=(b.data||b)[n]}}indexOf(b){const n=this.data.indexOf(b);return n>=this.length?-1:n}contains(b){return-1!==this.indexOf(b)}}e._GlobalId=0;class V extends e{constructor(){super(...arguments),this._duplicateId=0}push(b){super.push(b),b.__smartArrayFlags||(b.__smartArrayFlags={}),b.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(b){return(!b.__smartArrayFlags||b.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(b),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(let n=0;n<b.length;n++){const i=(b.data||b)[n];this.pushNoDuplicate(i)}}}}},11839:(b,n,i)=>{i.d(n,{b:()=>Q});var e=i(11842),V=i(11612);class Q{constructor(b){this._vertexBuffers={},this.onBeforeRenderObservable=new V.e,this._scene=b}_prepareBuffers(){if(this._vertexBuffers[e.g.PositionKind])return;const b=[];b.push(1,1),b.push(-1,1),b.push(-1,-1),b.push(1,-1),this._vertexBuffers[e.g.PositionKind]=new e.g(this._scene.getEngine(),b,e.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const b=[];b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(b)}_rebuild(){const b=this._vertexBuffers[e.g.PositionKind];b&&(b._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.activeCamera;return!!i&&(n=n||i._postProcesses.filter((b=>null!=b)),!(!n||0===n.length||!this._scene.postProcessesEnabled)&&(n[0].activate(i,b,null!==n&&void 0!==n),!0))}directRender(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:b.length;const Y=this._scene.getEngine();for(let B=0;B<U;B++){var L;if(B<b.length-1)b[B+1].activate(this._scene.activeCamera||this._scene,null===n||void 0===n?void 0:n.texture);else n?Y.bindFramebuffer(n,e,void 0,void 0,i,V):Q||Y.restoreDefaultFramebuffer(),null===(L=Y._debugInsertMarker)||void 0===L||L.call(Y,`post process ${b[B].name} output`);const U=b[B],mb=U.apply();mb&&(U.onBeforeRenderObservable.notifyObservers(mb),this._prepareBuffers(),Y.bindBuffers(this._vertexBuffers,this._indexBuffer,mb),Y.drawElementsType(0,0,6),U.onAfterRenderObservable.notifyObservers(mb))}Y.setDepthBuffer(!0),Y.setDepthWrite(!0)}_finalizeFrame(b,n,i,e){let V=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Q=this._scene.activeCamera;if(!Q)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(e=e||Q._postProcesses.filter((b=>null!=b))).length||!this._scene.postProcessesEnabled)return;const U=this._scene.getEngine();for(let L=0,B=e.length;L<B;L++){const mb=e[L];var Y;if(L<B-1)mb._outputTexture=e[L+1].activate(Q,null===n||void 0===n?void 0:n.texture);else n?(U.bindFramebuffer(n,i,void 0,void 0,V),mb._outputTexture=n):(U.restoreDefaultFramebuffer(),mb._outputTexture=null),null===(Y=U._debugInsertMarker)||void 0===Y||Y.call(U,`post process ${e[L].name} output`);if(b)break;const N=mb.apply();N&&(mb.onBeforeRenderObservable.notifyObservers(N),this._prepareBuffers(),U.bindBuffers(this._vertexBuffers,this._indexBuffer,N),U.drawElementsType(0,0,6),mb.onAfterRenderObservable.notifyObservers(N))}U.setDepthBuffer(!0),U.setDepthWrite(!0),U.setAlphaMode(0)}dispose(){const b=this._vertexBuffers[e.g.PositionKind];b&&(b.dispose(),this._vertexBuffers[e.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11863:(b,n,i)=>{i.d(n,{b:()=>Y});var e=i(11865),V=i(11778);class Q{set opaqueSortCompareFn(b){this._opaqueSortCompareFn=b||Q.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(b){this._alphaTestSortCompareFn=b||Q.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(b){this._transparentSortCompareFn=b||Q.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(b,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=b,this._opaqueSubMeshes=new e.h(256),this._transparentSubMeshes=new e.h(256),this._alphaTestSubMeshes=new e.h(256),this._depthOnlySubMeshes=new e.h(256),this._particleSystems=new e.h(256),this._spriteManagers=new e.h(256),this._empty=!0,this._edgesRenderers=new e.d(16),this._scene=n,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=V,this.transparentSortCompareFn=Q}render(b,n,i,e){if(b)return void b(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const V=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(V.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),V.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const Q=V.getStencilBuffer();if(V.setStencilBuffer(!1),n&&this._renderSprites(),i&&this._renderParticles(e),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(V.setStencilBuffer(Q),this._scene.useOrderIndependentTransparency){const b=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);b.length&&this._renderTransparent(b)}else this._renderTransparent(this._transparentSubMeshes);V.setAlphaMode(0)}if(V.setStencilBuffer(!1),this._edgesRenderers.length){for(let b=0;b<this._edgesRenderers.length;b++)this._edgesRenderers.data[b].render();V.setAlphaMode(0)}V.setStencilBuffer(Q)}_renderOpaqueSorted(b){Q._RenderSorted(b,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(b){Q._RenderSorted(b,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(b){Q._RenderSorted(b,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(b,n,i,e){let U,Y=0;const L=i?i.globalPosition:Q._ZeroVector;if(e)for(;Y<b.length;Y++)U=b.data[Y],U._alphaIndex=U.getMesh().alphaIndex,U._distanceToCamera=V.On.Distance(U.getBoundingInfo().boundingSphere.centerWorld,L);const B=b.length===b.data.length?b.data:b.data.slice(0,b.length);n&&B.sort(n);const mb=B[0].getMesh().ab();for(Y=0;Y<B.length;Y++)if(U=B[Y],!mb._activeMeshesFrozenButKeepClipping||U.isInFrustum(mb._frustumPlanes)){if(e){const b=U.Jb();if(b&&b.needDepthPrePass){const n=b.ab().getEngine();n.setColorWrite(!1),n.setAlphaMode(0),U.render(!1),n.setColorWrite(!0)}}U.render(e)}}static defaultTransparentSortCompare(b,n){return b._alphaIndex>n._alphaIndex?1:b._alphaIndex<n._alphaIndex?-1:Q.backToFrontSortCompare(b,n)}static backToFrontSortCompare(b,n){return b._distanceToCamera<n._distanceToCamera?1:b._distanceToCamera>n._distanceToCamera?-1:0}static frontToBackSortCompare(b,n){return b._distanceToCamera<n._distanceToCamera?-1:b._distanceToCamera>n._distanceToCamera?1:0}static PainterSortCompare(b,n){const i=b.getMesh(),e=n.getMesh();return i.material&&e.material?i.material.uniqueId-e.material.uniqueId:i.uniqueId-e.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(b,n,i){void 0===n&&(n=b.getMesh()),void 0===i&&(i=b.Jb()),null!==i&&void 0!==i&&(i.needAlphaBlendingForMesh(n)?this._transparentSubMeshes.push(b):i.needAlphaTestingForMesh(n)?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(b),this._alphaTestSubMeshes.push(b)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(b),this._opaqueSubMeshes.push(b)),n._renderingGroup=this,n._edgesRenderer&&n.isEnabled()&&n.isVisible&&n._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(n._edgesRenderer),this._empty=!1)}dispatchSprites(b){this._spriteManagers.push(b),this._empty=!1}dispatchParticles(b){this._particleSystems.push(b),this._empty=!1}_renderParticles(b){if(0===this._particleSystems.length)return;const n=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const e=this._particleSystems.data[i];if(0===(n&&n.layerMask&e.layerMask))continue;const V=e.Un;V.position&&b&&-1===b.indexOf(V)||this._scene._activeParticles.addCount(e.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const b=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let n=0;n<this._spriteManagers.length;n++){const i=this._spriteManagers.data[n];0!==(b&&b.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}Q._ZeroVector=V.On.Zero();class U{}class Y{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(b){b!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=b,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const b of this._scene.meshes)if(b.xe)for(const n of b.xe)n._wasDispatched=!1;if(this._scene.spriteManagers)for(const b of this._scene.spriteManagers)b._wasDispatched=!1;for(const b of this._scene.cN)b._wasDispatched=!1}constructor(b){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new U,this._maintainStateBetweenFrames=!1,this._scene=b;for(let n=Y.MIN_RENDERINGGROUPS;n<Y.MAX_RENDERINGGROUPS;n++)this._autoClearDepthStencil[n]={je:!0,depth:!0,stencil:!0}}getRenderingGroup(b){const n=b||0;return this._prepareRenderingGroup(n),this._renderingGroups[n]}_clearDepthStencilBuffer(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,b,n),this._depthStencilBufferAlreadyCleaned=!0)}render(b,n,i,e){const V=this._renderingGroupInfo;if(V.dn=this._scene,V.camera=this._scene.activeCamera,V.renderingManager=this,this._scene.spriteManagers&&e)for(let Q=0;Q<this._scene.spriteManagers.length;Q++){const b=this._scene.spriteManagers[Q];this.dispatchSprites(b)}for(let Q=Y.MIN_RENDERINGGROUPS;Q<Y.MAX_RENDERINGGROUPS;Q++){this._depthStencilBufferAlreadyCleaned=Q===Y.MIN_RENDERINGGROUPS;const U=this._renderingGroups[Q];if(!U||U._empty)continue;const L=1<<Q;if(V.renderingGroupId=Q,this._scene.onBeforeRenderingGroupObservable.notifyObservers(V,L),Y.AUTOCLEAR){const b=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(Q):this._autoClearDepthStencil[Q];b&&b.je&&this._clearDepthStencilBuffer(b.depth,b.stencil)}for(const b of this._scene._beforeRenderingGroupDrawStage)b.action(Q);U.render(b,e,i,n);for(const b of this._scene._afterRenderingGroupDrawStage)b.action(Q);this._scene.onAfterRenderingGroupObservable.notifyObservers(V,L)}}reset(){if(!this.maintainStateBetweenFrames)for(let b=Y.MIN_RENDERINGGROUPS;b<Y.MAX_RENDERINGGROUPS;b++){const n=this._renderingGroups[b];n&&n.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let b=Y.MIN_RENDERINGGROUPS;b<Y.MAX_RENDERINGGROUPS;b++){const n=this._renderingGroups[b];n&&n.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let b=Y.MIN_RENDERINGGROUPS;b<Y.MAX_RENDERINGGROUPS;b++){const n=this._renderingGroups[b];n&&n.dispose()}}_prepareRenderingGroup(b){void 0===this._renderingGroups[b]&&(this._renderingGroups[b]=new Q(b,this._scene,this._customOpaqueSortCompareFn[b],this._customAlphaTestSortCompareFn[b],this._customTransparentSortCompareFn[b]))}dispatchSprites(b){this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatchSprites(b))}dispatchParticles(b){this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatchParticles(b))}dispatch(b,n,i){void 0===n&&(n=b.getMesh()),this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(n.renderingGroupId).dispatch(b,n,i))}setRenderingOrder(b){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[b]=n,this._customAlphaTestSortCompareFn[b]=i,this._customTransparentSortCompareFn[b]=e,this._renderingGroups[b]){const n=this._renderingGroups[b];n.opaqueSortCompareFn=this._customOpaqueSortCompareFn[b],n.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[b],n.transparentSortCompareFn=this._customTransparentSortCompareFn[b]}}setRenderingAutoClearDepthStencil(b,n){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[b]={je:n,depth:i,stencil:e}}getAutoClearDepthStencilSetup(b){return this._autoClearDepthStencil[b]}}Y.MAX_RENDERINGGROUPS=4,Y.MIN_RENDERINGGROUPS=0,Y.AUTOCLEAR=!0}}]);