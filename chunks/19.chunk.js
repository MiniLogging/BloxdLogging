"use strict";(self.bjbkv7h3qsd=self.bjbkv7h3qsd||[]).push([[19],{11290:(G,A,j)=>{j.d(A,{e:()=>x,h:()=>s});var u=j(11297),k=j(11065),B=j(11299);class x{get H(){return this._isDisposed}constructor(G,A,j){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],x=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],O=arguments.length>7?arguments[7]:void 0,d=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,G&&G.gG?this._engine=G.gG().getEngine():this._engine=G,this._updatable=j,this._instanced=x,this._divisor=O||1,this._label=d,A instanceof u.b?(this._data=null,this._buffer=A):(this._data=A,this._buffer=null),this.byteStride=s?k:k*Float32Array.BYTES_PER_ELEMENT,B||this.create()}createVertexBuffer(G,A,j,u,k){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6?arguments[6]:void 0;const O=B?A:A*Float32Array.BYTES_PER_ELEMENT,d=u?B?u:u*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new s(this._engine,this,G,this._updatable,!0,d,void 0===k?this._instanced:k,O,j,void 0,void 0,!0,this._divisor||x)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!G&&this._buffer||(G=G||this._data,G&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,G),this._data=G):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(G,this._label),this._data=G):this._buffer=this._engine.createVertexBuffer(G,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.hj>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.hj,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.hj,void 0,this._label));k.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(G){this.create(G)}updateDirectly(G,A,j){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,G,u?A:A*Float32Array.BYTES_PER_ELEMENT,j?j*this.byteStride:void 0),this._data=0===A&&void 0===j?G:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class s{get H(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(G){const A=0!=G;this._instanceDivisor=G,A!==this._instanced&&(this._instanced=A,this._computeHashCode())}get _maxVerticesCount(){const G=this.getData();return G?Array.isArray(G)?G.length/(this.byteStride/4)-this.byteOffset/4:(G.byteLength-this.byteOffset)/this.byteStride:0}constructor(G,A,j,u,k,O,d,h,H,F){let R=arguments.length>10&&void 0!==arguments[10]&&arguments[10],U=arguments.length>11&&void 0!==arguments[11]&&arguments[11],S=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,C=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let t=!1;if(this.UA=G,"object"===typeof u&&null!==u?(t=u.updatable??!1,k=u.postponeInternalCreation,O=u.stride,d=u.instanced,h=u.offset,H=u.size,F=u.type,R=u.normalized??!1,U=u.useBytes??!1,S=u.divisor??1,C=u.takeBufferOwnership??!1,this._label=u.label):t=!!u,A instanceof x?(this._buffer=A,this._ownsBuffer=C):(this._buffer=new x(G,A,t,O,k,d,U,S,this._label),this._ownsBuffer=!0),this.uniqueId=s._Counter++,this._kind=j,void 0===F){const G=this.getData();this.type=G?s.GetDataType(G):s.FLOAT}else this.type=F;const Y=(0,B.p)(this.type);U?(this._size=H||(O?O/Y:s.DeduceStride(j)),this.byteStride=O||this._buffer.byteStride||this._size*Y,this.byteOffset=h||0):(this._size=H||O||s.DeduceStride(j),this.byteStride=O?O*Y:this._buffer.byteStride||this._size*Y,this.byteOffset=(h||0)*Y),this.normalized=R,this._instanced=void 0!==d&&d,this._instanceDivisor=d?S:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var G;null===(G=this._buffer)||void 0===G||G._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(G,A){const j=this.getData();return j?(0,B.l)(j,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,G,A):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,B.p)(this.type)}getOffset(){return this.byteOffset/(0,B.p)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,B.p)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(G){this._buffer.create(G),this._alignBuffer()}update(G){this._buffer.update(G),this._alignBuffer()}updateDirectly(G,A){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(G,A,void 0,j),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(G,A){(0,B.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,G,this.normalized,((G,j)=>{for(let u=0;u<this._size;u++)A(G[u],j+u)}))}_alignBuffer(){}static DeduceStride(G){switch(G){case s.UVKind:case s.UV2Kind:case s.UV3Kind:case s.UV4Kind:case s.UV5Kind:case s.UV6Kind:return 2;case s.NormalKind:case s.PositionKind:return 3;case s.ColorKind:case s.ColorInstanceKind:case s.MatricesIndicesKind:case s.MatricesIndicesExtraKind:case s.MatricesWeightsKind:case s.MatricesWeightsExtraKind:case s.TangentKind:return 4;default:throw new Error("Invalid kind '"+G+"'")}}static GetDataType(G){return G instanceof Int8Array?s.BYTE:G instanceof Uint8Array?s.UNSIGNED_BYTE:G instanceof Int16Array?s.SHORT:G instanceof Uint16Array?s.UNSIGNED_SHORT:G instanceof Int32Array?s.INT:G instanceof Uint32Array?s.UNSIGNED_INT:s.FLOAT}static GetTypeByteLength(G){return(0,B.p)(G)}static ForEach(G,A,j,u,k,x,s,O){(0,B.j)(G,A,j,u,k,x,s,((G,A)=>{for(let j=0;j<u;j++)O(G[j],A+j)}))}static GetFloatData(G,A,j,u,k,x,s,O){return(0,B.l)(G,A,j,u,k,x,s,O)}}s._Counter=0,s.BYTE=5120,s.UNSIGNED_BYTE=5121,s.SHORT=5122,s.UNSIGNED_SHORT=5123,s.INT=5124,s.UNSIGNED_INT=5125,s.FLOAT=5126,s.PositionKind="position",s.NormalKind="normal",s.TangentKind="tangent",s.UVKind="uv",s.UV2Kind="uv2",s.UV3Kind="uv3",s.UV4Kind="uv4",s.UV5Kind="uv5",s.UV6Kind="uv6",s.ColorKind="color",s.ColorInstanceKind="instanceColor",s.MatricesIndicesKind="matricesIndices",s.MatricesWeightsKind="matricesWeights",s.MatricesIndicesExtraKind="matricesIndicesExtra",s.MatricesWeightsExtraKind="matricesWeightsExtra"},11299:(G,A,j)=>{j.d(A,{d:()=>F,h:()=>H,j:()=>O,l:()=>d,p:()=>x,q:()=>s,t:()=>h});var u=j(11065);function k(G,A,j,u){switch(A){case 5120:{let A=G.getInt8(j);return u&&(A=Math.max(A/127,-1)),A}case 5121:{let A=G.getUint8(j);return u&&(A/=255),A}case 5122:{let A=G.getInt16(j,!0);return u&&(A=Math.max(A/32767,-1)),A}case 5123:{let A=G.getUint16(j,!0);return u&&(A/=65535),A}case 5124:return G.getInt32(j,!0);case 5125:return G.getUint32(j,!0);case 5126:return G.getFloat32(j,!0);default:throw new Error(`Invalid component type ${A}`)}}function B(G,A,j,u,k){switch(A){case 5120:u&&(k=Math.round(127*k)),G.setInt8(j,k);break;case 5121:u&&(k=Math.round(255*k)),G.setUint8(j,k);break;case 5122:u&&(k=Math.round(32767*k)),G.setInt16(j,k,!0);break;case 5123:u&&(k=Math.round(65535*k)),G.setUint16(j,k,!0);break;case 5124:G.setInt32(j,k,!0);break;case 5125:G.setUint32(j,k,!0);break;case 5126:G.setFloat32(j,k,!0);break;default:throw new Error(`Invalid component type ${A}`)}}function x(G){switch(G){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${G}'`)}}function s(G){switch(G){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${G}'`)}}function O(G,A,j,u,s,O,d,h){const H=new Array(u),F=new Array(u);if(G instanceof Array){let k=A/4;const B=j/4;for(let A=0;A<O;A+=u){for(let A=0;A<u;A++)H[A]=F[A]=G[k+A];h(F,A);for(let A=0;A<u;A++)H[A]!==F[A]&&(G[k+A]=F[A]);k+=B}}else{const R=ArrayBuffer.isView(G)?new DataView(G.buffer,G.byteOffset,G.byteLength):new DataView(G),U=x(s);for(let G=0;G<O;G+=u){for(let G=0,j=A;G<u;G++,j+=U)H[G]=F[G]=k(R,s,j,d);h(F,G);for(let G=0,j=A;G<u;G++,j+=U)H[G]!==F[G]&&B(R,s,j,d,F[G]);A+=j}}}function d(G,A,j,k,B,s,d,h){const H=A*x(j),F=d*A;if(5126!==j||B!==H){const u=new Float32Array(F);return O(G,k,B,A,j,F,s,((G,j)=>{for(let k=0;k<A;k++)u[j+k]=G[k]})),u}if(!(G instanceof Array||G instanceof Float32Array)||0!==k||G.length!==F){if(G instanceof Array){const A=k/4;return G.slice(A,A+F)}if(G instanceof ArrayBuffer)return new Float32Array(G,k,F);{const A=G.byteOffset+k;return 0!==(3&A)&&(u.e.Warn("Float array must be aligned to 4-bytes border"),h=!0),h?new Float32Array(G.buffer.slice(A,A+F*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(G.buffer,A,F)}}return h?G.slice():G}function h(G,A,j,k,B,d,h,H){const F=x(j),R=s(j),U=h*A;if(Array.isArray(G)){if(0!==(3&k)||0!==(3&B))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const u=k/4,x=B/4;if(u+(h-1)*x+A>G.length)throw new Error("Last accessed index is out of bounds.");if(x<A)throw new Error("Data stride cannot be smaller than the component size.");if(x!==A){const u=new R(U);return O(G,k,B,A,j,U,d,((G,j)=>{for(let k=0;k<A;k++)u[j+k]=G[k]})),u}return new R(G.slice(u,u+U))}let S,C=k;G instanceof ArrayBuffer?S=G:(S=G.buffer,C+=G.byteOffset);if(C+(h-1)*B+A*F>S.byteLength)throw new Error("Last accessed byte is out of bounds.");const t=A*F;if(B<t)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(B!==t){const G=new R(U);return O(S,C,B,A,j,U,d,((j,u)=>{for(let k=0;k<A;k++)G[u+k]=j[k]})),G}return 1!==F&&0!==(C&F-1)&&(u.e.Warn("Array must be aligned to border of element size. Data will be copied."),H=!0),H?new R(S.slice(C,C+U*F)):new R(S,C,U)}function H(G,A,j,k,B,s,d,h){const H=A*x(j),F=d*A;if(h.length!==F)throw new Error("Output length is not valid");if(5126===j&&B===H)if(G instanceof Array){const A=k/4;h.set(G,A)}else if(G instanceof ArrayBuffer){const A=new Float32Array(G,k,F);h.set(A)}else{const A=G.byteOffset+k;if(0!==(3&A))return u.e.Warn("Float array must be aligned to 4-bytes border"),void h.set(new Float32Array(G.buffer.slice(A,A+F*Float32Array.BYTES_PER_ELEMENT)));const j=new Float32Array(G.buffer,A,F);h.set(j)}else O(G,k,B,A,j,F,s,((G,j)=>{for(let u=0;u<A;u++)h[j+u]=G[u]}))}function F(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(G)){for(let k=0;k<A;k++)if(G[j+k]-u>65535)return!0;return!1}return 4===G.BYTES_PER_ELEMENT}},11297:(G,A,j)=>{j.d(A,{b:()=>u});class u{get underlyingResource(){return null}constructor(){this.references=0,this.hj=0,this.is32Bits=!1,this.uniqueId=u._Counter++}}u._Counter=0},11333:(G,A,j)=>{j.d(A,{c:()=>k});var u=j(11114);class k{static GetEffect(G){return void 0===G.getPipelineContext?G.effect:G}constructor(G){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=G.createDrawContext(),A&&(this.materialContext=G.createMaterialContext())}setEffect(G,A){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var u;(this.effect=G,void 0!==A&&(this.defines=A),j)&&(null===(u=this.drawContext)||void 0===u||u.reset())}dispose(){var G;let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const G=this.effect;A?G.dispose():u.d.SetImmediate((()=>{G.getEngine().onEndFrameObservable.addOnce((()=>{G.dispose()}))})),this.effect=null}null===(G=this.drawContext)||void 0===G||G.dispose()}}},11423:(G,A,j)=>{j.d(A,{b:()=>k});var u=j(11266);class k{static GetPlanes(G){const A=[];for(let j=0;j<6;j++)A.push(new u.c(0,0,0,0));return k.GetPlanesToRef(G,A),A}static GetNearPlaneToRef(G,A){const j=G.m;A.normal.x=j[3]+j[2],A.normal.y=j[7]+j[6],A.normal.z=j[11]+j[10],A.d=j[15]+j[14],A.normalize()}static GetFarPlaneToRef(G,A){const j=G.m;A.normal.x=j[3]-j[2],A.normal.y=j[7]-j[6],A.normal.z=j[11]-j[10],A.d=j[15]-j[14],A.normalize()}static GetLeftPlaneToRef(G,A){const j=G.m;A.normal.x=j[3]+j[0],A.normal.y=j[7]+j[4],A.normal.z=j[11]+j[8],A.d=j[15]+j[12],A.normalize()}static GetRightPlaneToRef(G,A){const j=G.m;A.normal.x=j[3]-j[0],A.normal.y=j[7]-j[4],A.normal.z=j[11]-j[8],A.d=j[15]-j[12],A.normalize()}static GetTopPlaneToRef(G,A){const j=G.m;A.normal.x=j[3]-j[1],A.normal.y=j[7]-j[5],A.normal.z=j[11]-j[9],A.d=j[15]-j[13],A.normalize()}static GetBottomPlaneToRef(G,A){const j=G.m;A.normal.x=j[3]+j[1],A.normal.y=j[7]+j[5],A.normal.z=j[11]+j[9],A.d=j[15]+j[13],A.normalize()}static GetPlanesToRef(G,A){k.GetNearPlaneToRef(G,A[0]),k.GetFarPlaneToRef(G,A[1]),k.GetLeftPlaneToRef(G,A[2]),k.GetRightPlaneToRef(G,A[3]),k.GetTopPlaneToRef(G,A[4]),k.GetBottomPlaneToRef(G,A[5])}static IsPointInFrustum(G,A){for(let j=0;j<6;j++)if(A[j].dotCoordinate(G)<0)return!1;return!0}}},11434:(G,A,j)=>{j.d(A,{e:()=>k});var u=j(11072);class k{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(G,A){k.Enabled&&(this._current+=G,A&&this._fetchResult())}beginMonitoring(){k.Enabled&&(this._startMonitoringTime=u.c.Now)}endMonitoring(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!k.Enabled)return;G&&this.fetchNewFrame();const A=u.c.Now;this._current=A-this._startMonitoringTime,G&&this._fetchResult()}us(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const G=u.c.Now;G-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=G,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}k.Enabled=!0},11310:(G,A,j)=>{j.d(A,{c:()=>k,d:()=>u});class u{constructor(G){this.length=0,this.data=new Array(G),this._id=u._GlobalId++}push(G){this.data[this.length++]=G,this.length>this.data.length&&(this.data.length*=2)}forEach(G){for(let A=0;A<this.length;A++)G(this.data[A])}sort(G){this.data.sort(G)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(G){if(0!==G.length){this.length+G.length>this.data.length&&(this.data.length=2*(this.length+G.length));for(let A=0;A<G.length;A++)this.data[this.length++]=(G.data||G)[A]}}indexOf(G){const A=this.data.indexOf(G);return A>=this.length?-1:A}contains(G){return-1!==this.indexOf(G)}}u._GlobalId=0;class k extends u{constructor(){super(...arguments),this._duplicateId=0}push(G){super.push(G),G.__smartArrayFlags||(G.__smartArrayFlags={}),G.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(G){return(!G.__smartArrayFlags||G.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(G),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(G){if(0!==G.length){this.length+G.length>this.data.length&&(this.data.length=2*(this.length+G.length));for(let A=0;A<G.length;A++){const j=(G.data||G)[A];this.pushNoDuplicate(j)}}}}},11285:(G,A,j)=>{j.d(A,{d:()=>B});var u=j(11290),k=j(11050);class B{constructor(G){this._vertexBuffers={},this.onBeforeRenderObservable=new k.b,this._scene=G}_prepareBuffers(){if(this._vertexBuffers[u.h.PositionKind])return;const G=[];G.push(1,1),G.push(-1,1),G.push(-1,-1),G.push(1,-1),this._vertexBuffers[u.h.PositionKind]=new u.h(this._scene.getEngine(),G,u.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const G=[];G.push(0),G.push(1),G.push(2),G.push(0),G.push(2),G.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(G)}_rebuild(){const G=this._vertexBuffers[u.h.PositionKind];G&&(G._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let G=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this._scene.activeCamera;return!!j&&(A=A||j._postProcesses.filter((G=>null!=G)),!(!A||0===A.length||!this._scene.postProcessesEnabled)&&(A[0].activate(j,G,null!==A&&void 0!==A),!0))}directRender(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]?arguments[6]:G.length;const s=this._scene.getEngine();for(let d=0;d<x;d++){var O;if(d<G.length-1)G[d+1].activate(this._scene.activeCamera||this._scene,null===A||void 0===A?void 0:A.texture);else A?s.bindFramebuffer(A,u,void 0,void 0,j,k):B||s.restoreDefaultFramebuffer(),null===(O=s._debugInsertMarker)||void 0===O||O.call(s,`post process ${G[d].name} output`);const x=G[d],h=x.apply();h&&(x.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),s.bindBuffers(this._vertexBuffers,this._indexBuffer,h),s.drawElementsType(0,0,6),x.onAfterRenderObservable.notifyObservers(h))}s.setDepthBuffer(!0),s.setDepthWrite(!0)}_finalizeFrame(G,A,j,u){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const B=this._scene.activeCamera;if(!B)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(u=u||B._postProcesses.filter((G=>null!=G))).length||!this._scene.postProcessesEnabled)return;const x=this._scene.getEngine();for(let O=0,d=u.length;O<d;O++){const h=u[O];var s;if(O<d-1)h._outputTexture=u[O+1].activate(B,null===A||void 0===A?void 0:A.texture);else A?(x.bindFramebuffer(A,j,void 0,void 0,k),h._outputTexture=A):(x.restoreDefaultFramebuffer(),h._outputTexture=null),null===(s=x._debugInsertMarker)||void 0===s||s.call(x,`post process ${u[O].name} output`);if(G)break;const H=h.apply();H&&(h.onBeforeRenderObservable.notifyObservers(H),this._prepareBuffers(),x.bindBuffers(this._vertexBuffers,this._indexBuffer,H),x.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(H))}x.setDepthBuffer(!0),x.setDepthWrite(!0),x.setAlphaMode(0)}dispose(){const G=this._vertexBuffers[u.h.PositionKind];G&&(G.dispose(),this._vertexBuffers[u.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11307:(G,A,j)=>{j.d(A,{b:()=>s});var u=j(11310),k=j(11218);class B{set opaqueSortCompareFn(G){this._opaqueSortCompareFn=G||B.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(G){this._alphaTestSortCompareFn=G||B.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(G){this._transparentSortCompareFn=G||B.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(G,A){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=G,this._opaqueSubMeshes=new u.d(256),this._transparentSubMeshes=new u.d(256),this._alphaTestSubMeshes=new u.d(256),this._depthOnlySubMeshes=new u.d(256),this._particleSystems=new u.d(256),this._spriteManagers=new u.d(256),this._empty=!0,this._edgesRenderers=new u.c(16),this._scene=A,this.opaqueSortCompareFn=j,this.alphaTestSortCompareFn=k,this.transparentSortCompareFn=B}render(G,A,j,u){if(G)return void G(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const k=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(k.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),k.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const B=k.getStencilBuffer();if(k.setStencilBuffer(!1),A&&this._renderSprites(),j&&this._renderParticles(u),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(k.setStencilBuffer(B),this._scene.useOrderIndependentTransparency){const G=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);G.length&&this._renderTransparent(G)}else this._renderTransparent(this._transparentSubMeshes);k.setAlphaMode(0)}if(k.setStencilBuffer(!1),this._edgesRenderers.length){for(let G=0;G<this._edgesRenderers.length;G++)this._edgesRenderers.data[G].render();k.setAlphaMode(0)}k.setStencilBuffer(B)}_renderOpaqueSorted(G){B._RenderSorted(G,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(G){B._RenderSorted(G,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(G){B._RenderSorted(G,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(G,A,j,u){let x,s=0;const O=j?j.globalPosition:B._ZeroVector;if(u)for(;s<G.length;s++)x=G.data[s],x._alphaIndex=x.getMesh().alphaIndex,x._distanceToCamera=k.SA.Distance(x.getBoundingInfo().boundingSphere.centerWorld,O);const d=G.length===G.data.length?G.data:G.data.slice(0,G.length);A&&d.sort(A);const h=d[0].getMesh().gG();for(s=0;s<d.length;s++)if(x=d[s],!h._activeMeshesFrozenButKeepClipping||x.isInFrustum(h._frustumPlanes)){if(u){const G=x.wG();if(G&&G.needDepthPrePass){const A=G.gG().getEngine();A.setColorWrite(!1),A.setAlphaMode(0),x.render(!1),A.setColorWrite(!0)}}x.render(u)}}static defaultTransparentSortCompare(G,A){return G._alphaIndex>A._alphaIndex?1:G._alphaIndex<A._alphaIndex?-1:B.backToFrontSortCompare(G,A)}static backToFrontSortCompare(G,A){return G._distanceToCamera<A._distanceToCamera?1:G._distanceToCamera>A._distanceToCamera?-1:0}static frontToBackSortCompare(G,A){return G._distanceToCamera<A._distanceToCamera?-1:G._distanceToCamera>A._distanceToCamera?1:0}static PainterSortCompare(G,A){const j=G.getMesh(),u=A.getMesh();return j.material&&u.material?j.material.uniqueId-u.material.uniqueId:j.uniqueId-u.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(G,A,j){void 0===A&&(A=G.getMesh()),void 0===j&&(j=G.wG()),null!==j&&void 0!==j&&(j.needAlphaBlendingForMesh(A)?this._transparentSubMeshes.push(G):j.needAlphaTestingForMesh(A)?(j.needDepthPrePass&&this._depthOnlySubMeshes.push(G),this._alphaTestSubMeshes.push(G)):(j.needDepthPrePass&&this._depthOnlySubMeshes.push(G),this._opaqueSubMeshes.push(G)),A._renderingGroup=this,A._edgesRenderer&&A.isEnabled()&&A.isVisible&&A._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(A._edgesRenderer),this._empty=!1)}dispatchSprites(G){this._spriteManagers.push(G),this._empty=!1}dispatchParticles(G){this._particleSystems.push(G),this._empty=!1}_renderParticles(G){if(0===this._particleSystems.length)return;const A=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let j=0;j<this._particleSystems.length;j++){const u=this._particleSystems.data[j];if(0===(A&&A.layerMask&u.layerMask))continue;const k=u.kA;k.position&&G&&-1===G.indexOf(k)||this._scene._activeParticles.addCount(u.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const G=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let A=0;A<this._spriteManagers.length;A++){const j=this._spriteManagers.data[A];0!==(G&&G.layerMask&j.layerMask)&&j.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}B._ZeroVector=k.SA.Zero();class x{}class s{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(G){G!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=G,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const G of this._scene.meshes)if(G.ds)for(const A of G.ds)A._wasDispatched=!1;if(this._scene.spriteManagers)for(const G of this._scene.spriteManagers)G._wasDispatched=!1;for(const G of this._scene.yF)G._wasDispatched=!1}constructor(G){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new x,this._maintainStateBetweenFrames=!1,this._scene=G;for(let A=s.MIN_RENDERINGGROUPS;A<s.MAX_RENDERINGGROUPS;A++)this._autoClearDepthStencil[A]={Os:!0,depth:!0,stencil:!0}}getRenderingGroup(G){const A=G||0;return this._prepareRenderingGroup(A),this._renderingGroups[A]}_clearDepthStencilBuffer(){let G=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,G,A),this._depthStencilBufferAlreadyCleaned=!0)}render(G,A,j,u){const k=this._renderingGroupInfo;if(k.tA=this._scene,k.camera=this._scene.activeCamera,k.renderingManager=this,this._scene.spriteManagers&&u)for(let B=0;B<this._scene.spriteManagers.length;B++){const G=this._scene.spriteManagers[B];this.dispatchSprites(G)}for(let B=s.MIN_RENDERINGGROUPS;B<s.MAX_RENDERINGGROUPS;B++){this._depthStencilBufferAlreadyCleaned=B===s.MIN_RENDERINGGROUPS;const x=this._renderingGroups[B];if(!x||x._empty)continue;const O=1<<B;if(k.renderingGroupId=B,this._scene.onBeforeRenderingGroupObservable.notifyObservers(k,O),s.AUTOCLEAR){const G=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(B):this._autoClearDepthStencil[B];G&&G.Os&&this._clearDepthStencilBuffer(G.depth,G.stencil)}for(const G of this._scene._beforeRenderingGroupDrawStage)G.action(B);x.render(G,u,j,A);for(const G of this._scene._afterRenderingGroupDrawStage)G.action(B);this._scene.onAfterRenderingGroupObservable.notifyObservers(k,O)}}reset(){if(!this.maintainStateBetweenFrames)for(let G=s.MIN_RENDERINGGROUPS;G<s.MAX_RENDERINGGROUPS;G++){const A=this._renderingGroups[G];A&&A.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let G=s.MIN_RENDERINGGROUPS;G<s.MAX_RENDERINGGROUPS;G++){const A=this._renderingGroups[G];A&&A.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let G=s.MIN_RENDERINGGROUPS;G<s.MAX_RENDERINGGROUPS;G++){const A=this._renderingGroups[G];A&&A.dispose()}}_prepareRenderingGroup(G){void 0===this._renderingGroups[G]&&(this._renderingGroups[G]=new B(G,this._scene,this._customOpaqueSortCompareFn[G],this._customAlphaTestSortCompareFn[G],this._customTransparentSortCompareFn[G]))}dispatchSprites(G){this.maintainStateBetweenFrames&&G._wasDispatched||(G._wasDispatched=!0,this.getRenderingGroup(G.renderingGroupId).dispatchSprites(G))}dispatchParticles(G){this.maintainStateBetweenFrames&&G._wasDispatched||(G._wasDispatched=!0,this.getRenderingGroup(G.renderingGroupId).dispatchParticles(G))}dispatch(G,A,j){void 0===A&&(A=G.getMesh()),this.maintainStateBetweenFrames&&G._wasDispatched||(G._wasDispatched=!0,this.getRenderingGroup(A.renderingGroupId).dispatch(G,A,j))}setRenderingOrder(G){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[G]=A,this._customAlphaTestSortCompareFn[G]=j,this._customTransparentSortCompareFn[G]=u,this._renderingGroups[G]){const A=this._renderingGroups[G];A.opaqueSortCompareFn=this._customOpaqueSortCompareFn[G],A.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[G],A.transparentSortCompareFn=this._customTransparentSortCompareFn[G]}}setRenderingAutoClearDepthStencil(G,A){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[G]={Os:A,depth:j,stencil:u}}getAutoClearDepthStencilSetup(G){return this._autoClearDepthStencil[G]}}s.MAX_RENDERINGGROUPS=4,s.MIN_RENDERINGGROUPS=0,s.AUTOCLEAR=!0}}]);