"use strict";(self.rsqbdnwe5e=self.rsqbdnwe5e||[]).push([[19],{12451:(N,p,T)=>{T.d(p,{e:()=>U,f:()=>X});var A=T(12454),a=T(12205),C=T(12459);class U{get X(){return this._isDisposed}constructor(N,p,T){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7?arguments[7]:void 0,e=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,N&&N.KN?this._engine=N.KN().getEngine():this._engine=N,this._updatable=T,this._instanced=U,this._divisor=y||1,this._label=e,p instanceof A.e?(this._data=null,this._buffer=p):(this._data=p,this._buffer=null),this.byteStride=X?a:a*Float32Array.BYTES_PER_ELEMENT,C||this.create()}createVertexBuffer(N,p,T,A,a){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6?arguments[6]:void 0;const y=C?p:p*Float32Array.BYTES_PER_ELEMENT,e=A?C?A:A*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new X(this._engine,this,N,this._updatable,!0,e,void 0===a?this._instanced:a,y,T,void 0,void 0,!0,this._divisor||U)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!N&&this._buffer||(N=N||this._data,N&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,N),this._data=N):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(N,this._label),this._data=N):this._buffer=this._engine.createVertexBuffer(N,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Kp>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Kp,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Kp,void 0,this._label));a.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(N){this.create(N)}updateDirectly(N,p,T){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,N,A?p:p*Float32Array.BYTES_PER_ELEMENT,T?T*this.byteStride:void 0),this._data=0===p&&void 0===T?N:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class X{get X(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(N){const p=0!=N;this._instanceDivisor=N,p!==this._instanced&&(this._instanced=p,this._computeHashCode())}get _maxVerticesCount(){const N=this.getData();return N?Array.isArray(N)?N.length/(this.byteStride/4)-this.byteOffset/4:(N.byteLength-this.byteOffset)/this.byteStride:0}constructor(N,p,T,A,a,y,e,H,M,b){let l=arguments.length>10&&void 0!==arguments[10]&&arguments[10],k=arguments.length>11&&void 0!==arguments[11]&&arguments[11],x=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,I=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let L=!1;if(this.kp=N,"object"===typeof A&&null!==A?(L=A.updatable??!1,a=A.postponeInternalCreation,y=A.stride,e=A.instanced,H=A.offset,M=A.size,b=A.type,l=A.normalized??!1,k=A.useBytes??!1,x=A.divisor??1,I=A.takeBufferOwnership??!1,this._label=A.label):L=!!A,p instanceof U?(this._buffer=p,this._ownsBuffer=I):(this._buffer=new U(N,p,L,y,a,e,k,x,this._label),this._ownsBuffer=!0),this.uniqueId=X._Counter++,this._kind=T,void 0===b){const N=this.getData();this.type=N?X.GetDataType(N):X.FLOAT}else this.type=b;const n=(0,C.j)(this.type);k?(this._size=M||(y?y/n:X.DeduceStride(T)),this.byteStride=y||this._buffer.byteStride||this._size*n,this.byteOffset=H||0):(this._size=M||y||X.DeduceStride(T),this.byteStride=y?y*n:this._buffer.byteStride||this._size*n,this.byteOffset=(H||0)*n),this.normalized=l,this._instanced=void 0!==e&&e,this._instanceDivisor=e?x:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var N;null===(N=this._buffer)||void 0===N||N._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(N,p){const T=this.getData();return T?(0,C.h)(T,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,N,p):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,C.j)(this.type)}getOffset(){return this.byteOffset/(0,C.j)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,C.j)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(N){this._buffer.create(N),this._alignBuffer()}update(N){this._buffer.update(N),this._alignBuffer()}updateDirectly(N,p){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(N,p,void 0,T),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(N,p){(0,C.e)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,N,this.normalized,((N,T)=>{for(let A=0;A<this._size;A++)p(N[A],T+A)}))}_alignBuffer(){}static DeduceStride(N){switch(N){case X.UVKind:case X.UV2Kind:case X.UV3Kind:case X.UV4Kind:case X.UV5Kind:case X.UV6Kind:return 2;case X.NormalKind:case X.PositionKind:return 3;case X.ColorKind:case X.ColorInstanceKind:case X.MatricesIndicesKind:case X.MatricesIndicesExtraKind:case X.MatricesWeightsKind:case X.MatricesWeightsExtraKind:case X.TangentKind:return 4;default:throw new Error("Invalid kind '"+N+"'")}}static GetDataType(N){return N instanceof Int8Array?X.BYTE:N instanceof Uint8Array?X.UNSIGNED_BYTE:N instanceof Int16Array?X.SHORT:N instanceof Uint16Array?X.UNSIGNED_SHORT:N instanceof Int32Array?X.INT:N instanceof Uint32Array?X.UNSIGNED_INT:X.FLOAT}static GetTypeByteLength(N){return(0,C.j)(N)}static ForEach(N,p,T,A,a,U,X,y){(0,C.e)(N,p,T,A,a,U,X,((N,p)=>{for(let T=0;T<A;T++)y(N[T],p+T)}))}static GetFloatData(N,p,T,A,a,U,X,y){return(0,C.h)(N,p,T,A,a,U,X,y)}}X._Counter=0,X.BYTE=5120,X.UNSIGNED_BYTE=5121,X.SHORT=5122,X.UNSIGNED_SHORT=5123,X.INT=5124,X.UNSIGNED_INT=5125,X.FLOAT=5126,X.PositionKind="position",X.NormalKind="normal",X.TangentKind="tangent",X.UVKind="uv",X.UV2Kind="uv2",X.UV3Kind="uv3",X.UV4Kind="uv4",X.UV5Kind="uv5",X.UV6Kind="uv6",X.ColorKind="color",X.ColorInstanceKind="instanceColor",X.MatricesIndicesKind="matricesIndices",X.MatricesWeightsKind="matricesWeights",X.MatricesIndicesExtraKind="matricesIndicesExtra",X.MatricesWeightsExtraKind="matricesWeightsExtra"},12459:(N,p,T)=>{T.d(p,{b:()=>b,c:()=>M,e:()=>y,h:()=>e,j:()=>U,k:()=>X,m:()=>H});var A=T(12205);function a(N,p,T,A){switch(p){case 5120:{let p=N.getInt8(T);return A&&(p=Math.max(p/127,-1)),p}case 5121:{let p=N.getUint8(T);return A&&(p/=255),p}case 5122:{let p=N.getInt16(T,!0);return A&&(p=Math.max(p/32767,-1)),p}case 5123:{let p=N.getUint16(T,!0);return A&&(p/=65535),p}case 5124:return N.getInt32(T,!0);case 5125:return N.getUint32(T,!0);case 5126:return N.getFloat32(T,!0);default:throw new Error(`Invalid component type ${p}`)}}function C(N,p,T,A,a){switch(p){case 5120:A&&(a=Math.round(127*a)),N.setInt8(T,a);break;case 5121:A&&(a=Math.round(255*a)),N.setUint8(T,a);break;case 5122:A&&(a=Math.round(32767*a)),N.setInt16(T,a,!0);break;case 5123:A&&(a=Math.round(65535*a)),N.setUint16(T,a,!0);break;case 5124:N.setInt32(T,a,!0);break;case 5125:N.setUint32(T,a,!0);break;case 5126:N.setFloat32(T,a,!0);break;default:throw new Error(`Invalid component type ${p}`)}}function U(N){switch(N){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${N}'`)}}function X(N){switch(N){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${N}'`)}}function y(N,p,T,A,X,y,e,H){const M=new Array(A),b=new Array(A);if(N instanceof Array){let a=p/4;const C=T/4;for(let p=0;p<y;p+=A){for(let p=0;p<A;p++)M[p]=b[p]=N[a+p];H(b,p);for(let p=0;p<A;p++)M[p]!==b[p]&&(N[a+p]=b[p]);a+=C}}else{const l=ArrayBuffer.isView(N)?new DataView(N.buffer,N.byteOffset,N.byteLength):new DataView(N),k=U(X);for(let N=0;N<y;N+=A){for(let N=0,T=p;N<A;N++,T+=k)M[N]=b[N]=a(l,X,T,e);H(b,N);for(let N=0,T=p;N<A;N++,T+=k)M[N]!==b[N]&&C(l,X,T,e,b[N]);p+=T}}}function e(N,p,T,a,C,X,e,H){const M=p*U(T),b=e*p;if(5126!==T||C!==M){const A=new Float32Array(b);return y(N,a,C,p,T,b,X,((N,T)=>{for(let a=0;a<p;a++)A[T+a]=N[a]})),A}if(!(N instanceof Array||N instanceof Float32Array)||0!==a||N.length!==b){if(N instanceof Array){const p=a/4;return N.slice(p,p+b)}if(N instanceof ArrayBuffer)return new Float32Array(N,a,b);{const p=N.byteOffset+a;return 0!==(3&p)&&(A.d.Warn("Float array must be aligned to 4-bytes border"),H=!0),H?new Float32Array(N.buffer.slice(p,p+b*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(N.buffer,p,b)}}return H?N.slice():N}function H(N,p,T,a,C,e,H,M){const b=U(T),l=X(T),k=H*p;if(Array.isArray(N)){if(0!==(3&a)||0!==(3&C))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const A=a/4,U=C/4;if(A+(H-1)*U+p>N.length)throw new Error("Last accessed index is out of bounds.");if(U<p)throw new Error("Data stride cannot be smaller than the component size.");if(U!==p){const A=new l(k);return y(N,a,C,p,T,k,e,((N,T)=>{for(let a=0;a<p;a++)A[T+a]=N[a]})),A}return new l(N.slice(A,A+k))}let x,I=a;N instanceof ArrayBuffer?x=N:(x=N.buffer,I+=N.byteOffset);if(I+(H-1)*C+p*b>x.byteLength)throw new Error("Last accessed byte is out of bounds.");const L=p*b;if(C<L)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(C!==L){const N=new l(k);return y(x,I,C,p,T,k,e,((T,A)=>{for(let a=0;a<p;a++)N[A+a]=T[a]})),N}return 1!==b&&0!==(I&b-1)&&(A.d.Warn("Array must be aligned to border of element size. Data will be copied."),M=!0),M?new l(x.slice(I,I+k*b)):new l(x,I,k)}function M(N,p,T,a,C,X,e,H){const M=p*U(T),b=e*p;if(H.length!==b)throw new Error("Output length is not valid");if(5126===T&&C===M)if(N instanceof Array){const p=a/4;H.set(N,p)}else if(N instanceof ArrayBuffer){const p=new Float32Array(N,a,b);H.set(p)}else{const p=N.byteOffset+a;if(0!==(3&p))return A.d.Warn("Float array must be aligned to 4-bytes border"),void H.set(new Float32Array(N.buffer.slice(p,p+b*Float32Array.BYTES_PER_ELEMENT)));const T=new Float32Array(N.buffer,p,b);H.set(T)}else y(N,a,C,p,T,b,X,((N,T)=>{for(let A=0;A<p;A++)H[T+A]=N[A]}))}function b(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(N)){for(let a=0;a<p;a++)if(N[T+a]-A>65535)return!0;return!1}return 4===N.BYTES_PER_ELEMENT}},12454:(N,p,T)=>{T.d(p,{e:()=>A});class A{get underlyingResource(){return null}constructor(){this.references=0,this.Kp=0,this.is32Bits=!1,this.uniqueId=A._Counter++}}A._Counter=0},12494:(N,p,T)=>{T.d(p,{c:()=>a});var A=T(12264);class a{static GetEffect(N){return void 0===N.getPipelineContext?N.effect:N}constructor(N){let p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=N.createDrawContext(),p&&(this.materialContext=N.createMaterialContext())}setEffect(N,p){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var A;(this.effect=N,void 0!==p&&(this.defines=p),T)&&(null===(A=this.drawContext)||void 0===A||A.reset())}dispose(){var N;let p=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const N=this.effect;p?N.dispose():A.d.SetImmediate((()=>{N.getEngine().onEndFrameObservable.addOnce((()=>{N.dispose()}))})),this.effect=null}null===(N=this.drawContext)||void 0===N||N.dispose()}}},12584:(N,p,T)=>{T.d(p,{b:()=>a});var A=T(12429);class a{static GetPlanes(N){const p=[];for(let T=0;T<6;T++)p.push(new A.b(0,0,0,0));return a.GetPlanesToRef(N,p),p}static GetNearPlaneToRef(N,p){const T=N.m;p.normal.x=T[3]+T[2],p.normal.y=T[7]+T[6],p.normal.z=T[11]+T[10],p.d=T[15]+T[14],p.normalize()}static GetFarPlaneToRef(N,p){const T=N.m;p.normal.x=T[3]-T[2],p.normal.y=T[7]-T[6],p.normal.z=T[11]-T[10],p.d=T[15]-T[14],p.normalize()}static GetLeftPlaneToRef(N,p){const T=N.m;p.normal.x=T[3]+T[0],p.normal.y=T[7]+T[4],p.normal.z=T[11]+T[8],p.d=T[15]+T[12],p.normalize()}static GetRightPlaneToRef(N,p){const T=N.m;p.normal.x=T[3]-T[0],p.normal.y=T[7]-T[4],p.normal.z=T[11]-T[8],p.d=T[15]-T[12],p.normalize()}static GetTopPlaneToRef(N,p){const T=N.m;p.normal.x=T[3]-T[1],p.normal.y=T[7]-T[5],p.normal.z=T[11]-T[9],p.d=T[15]-T[13],p.normalize()}static GetBottomPlaneToRef(N,p){const T=N.m;p.normal.x=T[3]+T[1],p.normal.y=T[7]+T[5],p.normal.z=T[11]+T[9],p.d=T[15]+T[13],p.normalize()}static GetPlanesToRef(N,p){a.GetNearPlaneToRef(N,p[0]),a.GetFarPlaneToRef(N,p[1]),a.GetLeftPlaneToRef(N,p[2]),a.GetRightPlaneToRef(N,p[3]),a.GetTopPlaneToRef(N,p[4]),a.GetBottomPlaneToRef(N,p[5])}static IsPointInFrustum(N,p){for(let T=0;T<6;T++)if(p[T].dotCoordinate(N)<0)return!1;return!0}}},12597:(N,p,T)=>{T.d(p,{c:()=>a});var A=T(12216);class a{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(N,p){a.Enabled&&(this._current+=N,p&&this._fetchResult())}beginMonitoring(){a.Enabled&&(this._startMonitoringTime=A.d.Now)}endMonitoring(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!a.Enabled)return;N&&this.fetchNewFrame();const p=A.d.Now;this._current=p-this._startMonitoringTime,N&&this._fetchResult()}tU(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const N=A.d.Now;N-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=N,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}a.Enabled=!0},12471:(N,p,T)=>{T.d(p,{b:()=>a,c:()=>A});class A{constructor(N){this.length=0,this.data=new Array(N),this._id=A._GlobalId++}push(N){this.data[this.length++]=N,this.length>this.data.length&&(this.data.length*=2)}forEach(N){for(let p=0;p<this.length;p++)N(this.data[p])}sort(N){this.data.sort(N)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(N){if(0!==N.length){this.length+N.length>this.data.length&&(this.data.length=2*(this.length+N.length));for(let p=0;p<N.length;p++)this.data[this.length++]=(N.data||N)[p]}}indexOf(N){const p=this.data.indexOf(N);return p>=this.length?-1:p}contains(N){return-1!==this.indexOf(N)}}A._GlobalId=0;class a extends A{constructor(){super(...arguments),this._duplicateId=0}push(N){super.push(N),N.__smartArrayFlags||(N.__smartArrayFlags={}),N.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(N){return(!N.__smartArrayFlags||N.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(N),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(N){if(0!==N.length){this.length+N.length>this.data.length&&(this.data.length=2*(this.length+N.length));for(let p=0;p<N.length;p++){const T=(N.data||N)[p];this.pushNoDuplicate(T)}}}}},12442:(N,p,T)=>{T.d(p,{d:()=>C});var A=T(12451),a=T(12194);class C{constructor(N){this._vertexBuffers={},this.onBeforeRenderObservable=new a.c,this._scene=N}_prepareBuffers(){if(this._vertexBuffers[A.f.PositionKind])return;const N=[];N.push(1,1),N.push(-1,1),N.push(-1,-1),N.push(1,-1),this._vertexBuffers[A.f.PositionKind]=new A.f(this._scene.getEngine(),N,A.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const N=[];N.push(0),N.push(1),N.push(2),N.push(0),N.push(2),N.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(N)}_rebuild(){const N=this._vertexBuffers[A.f.PositionKind];N&&(N._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let N=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=this._scene.activeCamera;return!!T&&(p=p||T._postProcesses.filter((N=>null!=N)),!(!p||0===p.length||!this._scene.postProcessesEnabled)&&(p[0].activate(T,N,null!==p&&void 0!==p),!0))}directRender(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:N.length;const X=this._scene.getEngine();for(let e=0;e<U;e++){var y;if(e<N.length-1)N[e+1].activate(this._scene.activeCamera||this._scene,null===p||void 0===p?void 0:p.texture);else p?X.bindFramebuffer(p,A,void 0,void 0,T,a):C||X.restoreDefaultFramebuffer(),null===(y=X._debugInsertMarker)||void 0===y||y.call(X,`post process ${N[e].name} output`);const U=N[e],H=U.apply();H&&(U.onBeforeRenderObservable.notifyObservers(H),this._prepareBuffers(),X.bindBuffers(this._vertexBuffers,this._indexBuffer,H),X.drawElementsType(0,0,6),U.onAfterRenderObservable.notifyObservers(H))}X.setDepthBuffer(!0),X.setDepthWrite(!0)}_finalizeFrame(N,p,T,A){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const C=this._scene.activeCamera;if(!C)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(A=A||C._postProcesses.filter((N=>null!=N))).length||!this._scene.postProcessesEnabled)return;const U=this._scene.getEngine();for(let y=0,e=A.length;y<e;y++){const H=A[y];var X;if(y<e-1)H._outputTexture=A[y+1].activate(C,null===p||void 0===p?void 0:p.texture);else p?(U.bindFramebuffer(p,T,void 0,void 0,a),H._outputTexture=p):(U.restoreDefaultFramebuffer(),H._outputTexture=null),null===(X=U._debugInsertMarker)||void 0===X||X.call(U,`post process ${A[y].name} output`);if(N)break;const M=H.apply();M&&(H.onBeforeRenderObservable.notifyObservers(M),this._prepareBuffers(),U.bindBuffers(this._vertexBuffers,this._indexBuffer,M),U.drawElementsType(0,0,6),H.onAfterRenderObservable.notifyObservers(M))}U.setDepthBuffer(!0),U.setDepthWrite(!0),U.setAlphaMode(0)}dispose(){const N=this._vertexBuffers[A.f.PositionKind];N&&(N.dispose(),this._vertexBuffers[A.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12466:(N,p,T)=>{T.d(p,{c:()=>X});var A=T(12471),a=T(12371);class C{set opaqueSortCompareFn(N){this._opaqueSortCompareFn=N||C.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(N){this._alphaTestSortCompareFn=N||C.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(N){this._transparentSortCompareFn=N||C.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(N,p){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=N,this._opaqueSubMeshes=new A.c(256),this._transparentSubMeshes=new A.c(256),this._alphaTestSubMeshes=new A.c(256),this._depthOnlySubMeshes=new A.c(256),this._particleSystems=new A.c(256),this._spriteManagers=new A.c(256),this._empty=!0,this._edgesRenderers=new A.b(16),this._scene=p,this.opaqueSortCompareFn=T,this.alphaTestSortCompareFn=a,this.transparentSortCompareFn=C}render(N,p,T,A){if(N)return void N(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const a=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(a.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),a.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const C=a.getStencilBuffer();if(a.setStencilBuffer(!1),p&&this._renderSprites(),T&&this._renderParticles(A),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(a.setStencilBuffer(C),this._scene.useOrderIndependentTransparency){const N=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);N.length&&this._renderTransparent(N)}else this._renderTransparent(this._transparentSubMeshes);a.setAlphaMode(0)}if(a.setStencilBuffer(!1),this._edgesRenderers.length){for(let N=0;N<this._edgesRenderers.length;N++)this._edgesRenderers.data[N].render();a.setAlphaMode(0)}a.setStencilBuffer(C)}_renderOpaqueSorted(N){C._RenderSorted(N,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(N){C._RenderSorted(N,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(N){C._RenderSorted(N,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(N,p,T,A){let U,X=0;const y=T?T.globalPosition:C._ZeroVector;if(A)for(;X<N.length;X++)U=N.data[X],U._alphaIndex=U.getMesh().alphaIndex,U._distanceToCamera=a.xp.Distance(U.getBoundingInfo().boundingSphere.centerWorld,y);const e=N.length===N.data.length?N.data:N.data.slice(0,N.length);p&&e.sort(p);const H=e[0].getMesh().KN();for(X=0;X<e.length;X++)if(U=e[X],!H._activeMeshesFrozenButKeepClipping||U.isInFrustum(H._frustumPlanes)){if(A){const N=U.qN();if(N&&N.needDepthPrePass){const p=N.KN().getEngine();p.setColorWrite(!1),p.setAlphaMode(0),U.render(!1),p.setColorWrite(!0)}}U.render(A)}}static defaultTransparentSortCompare(N,p){return N._alphaIndex>p._alphaIndex?1:N._alphaIndex<p._alphaIndex?-1:C.backToFrontSortCompare(N,p)}static backToFrontSortCompare(N,p){return N._distanceToCamera<p._distanceToCamera?1:N._distanceToCamera>p._distanceToCamera?-1:0}static frontToBackSortCompare(N,p){return N._distanceToCamera<p._distanceToCamera?-1:N._distanceToCamera>p._distanceToCamera?1:0}static PainterSortCompare(N,p){const T=N.getMesh(),A=p.getMesh();return T.material&&A.material?T.material.uniqueId-A.material.uniqueId:T.uniqueId-A.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(N,p,T){void 0===p&&(p=N.getMesh()),void 0===T&&(T=N.qN()),null!==T&&void 0!==T&&(T.needAlphaBlendingForMesh(p)?this._transparentSubMeshes.push(N):T.needAlphaTestingForMesh(p)?(T.needDepthPrePass&&this._depthOnlySubMeshes.push(N),this._alphaTestSubMeshes.push(N)):(T.needDepthPrePass&&this._depthOnlySubMeshes.push(N),this._opaqueSubMeshes.push(N)),p._renderingGroup=this,p._edgesRenderer&&p.isEnabled()&&p.isVisible&&p._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(p._edgesRenderer),this._empty=!1)}dispatchSprites(N){this._spriteManagers.push(N),this._empty=!1}dispatchParticles(N){this._particleSystems.push(N),this._empty=!1}_renderParticles(N){if(0===this._particleSystems.length)return;const p=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let T=0;T<this._particleSystems.length;T++){const A=this._particleSystems.data[T];if(0===(p&&p.layerMask&A.layerMask))continue;const a=A.Ap;a.position&&N&&-1===N.indexOf(a)||this._scene._activeParticles.addCount(A.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const N=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let p=0;p<this._spriteManagers.length;p++){const T=this._spriteManagers.data[p];0!==(N&&N.layerMask&T.layerMask)&&T.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}C._ZeroVector=a.xp.Zero();class U{}class X{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(N){N!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=N,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const N of this._scene.meshes)if(N.CX)for(const p of N.CX)p._wasDispatched=!1;if(this._scene.spriteManagers)for(const N of this._scene.spriteManagers)N._wasDispatched=!1;for(const N of this._scene.Ul)N._wasDispatched=!1}constructor(N){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new U,this._maintainStateBetweenFrames=!1,this._scene=N;for(let p=X.MIN_RENDERINGGROUPS;p<X.MAX_RENDERINGGROUPS;p++)this._autoClearDepthStencil[p]={aX:!0,depth:!0,sU:!0}}getRenderingGroup(N){const p=N||0;return this._prepareRenderingGroup(p),this._renderingGroups[p]}_clearDepthStencilBuffer(){let N=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],p=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,N,p),this._depthStencilBufferAlreadyCleaned=!0)}render(N,p,T,A){const a=this._renderingGroupInfo;if(a.Lp=this._scene,a.camera=this._scene.activeCamera,a.renderingManager=this,this._scene.spriteManagers&&A)for(let C=0;C<this._scene.spriteManagers.length;C++){const N=this._scene.spriteManagers[C];this.dispatchSprites(N)}for(let C=X.MIN_RENDERINGGROUPS;C<X.MAX_RENDERINGGROUPS;C++){this._depthStencilBufferAlreadyCleaned=C===X.MIN_RENDERINGGROUPS;const U=this._renderingGroups[C];if(!U||U._empty)continue;const y=1<<C;if(a.renderingGroupId=C,this._scene.onBeforeRenderingGroupObservable.notifyObservers(a,y),X.AUTOCLEAR){const N=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(C):this._autoClearDepthStencil[C];N&&N.aX&&this._clearDepthStencilBuffer(N.depth,N.sU)}for(const N of this._scene._beforeRenderingGroupDrawStage)N.action(C);U.render(N,A,T,p);for(const N of this._scene._afterRenderingGroupDrawStage)N.action(C);this._scene.onAfterRenderingGroupObservable.notifyObservers(a,y)}}reset(){if(!this.maintainStateBetweenFrames)for(let N=X.MIN_RENDERINGGROUPS;N<X.MAX_RENDERINGGROUPS;N++){const p=this._renderingGroups[N];p&&p.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let N=X.MIN_RENDERINGGROUPS;N<X.MAX_RENDERINGGROUPS;N++){const p=this._renderingGroups[N];p&&p.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let N=X.MIN_RENDERINGGROUPS;N<X.MAX_RENDERINGGROUPS;N++){const p=this._renderingGroups[N];p&&p.dispose()}}_prepareRenderingGroup(N){void 0===this._renderingGroups[N]&&(this._renderingGroups[N]=new C(N,this._scene,this._customOpaqueSortCompareFn[N],this._customAlphaTestSortCompareFn[N],this._customTransparentSortCompareFn[N]))}dispatchSprites(N){this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(N.renderingGroupId).dispatchSprites(N))}dispatchParticles(N){this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(N.renderingGroupId).dispatchParticles(N))}dispatch(N,p,T){void 0===p&&(p=N.getMesh()),this.maintainStateBetweenFrames&&N._wasDispatched||(N._wasDispatched=!0,this.getRenderingGroup(p.renderingGroupId).dispatch(N,p,T))}setRenderingOrder(N){let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[N]=p,this._customAlphaTestSortCompareFn[N]=T,this._customTransparentSortCompareFn[N]=A,this._renderingGroups[N]){const p=this._renderingGroups[N];p.opaqueSortCompareFn=this._customOpaqueSortCompareFn[N],p.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[N],p.transparentSortCompareFn=this._customTransparentSortCompareFn[N]}}setRenderingAutoClearDepthStencil(N,p){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[N]={aX:p,depth:T,sU:A}}getAutoClearDepthStencilSetup(N){return this._autoClearDepthStencil[N]}}X.MAX_RENDERINGGROUPS=4,X.MIN_RENDERINGGROUPS=0,X.AUTOCLEAR=!0}}]);