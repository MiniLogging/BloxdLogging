"use strict";(self.z22hkk7o33f=self.z22hkk7o33f||[]).push([[19],{12957:(U,G,C)=>{C.d(G,{d:()=>t,e:()=>E});var L=C(12966),X=C(12731),l=C(12969);class t{get t(){return this._isDisposed}constructor(U,G,C){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]&&arguments[6],K=arguments.length>7?arguments[7]:void 0,P=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,U&&U.wU?this._engine=U.wU().getEngine():this._engine=U,this._updatable=C,this._instanced=t,this._divisor=K||1,this._label=P,G instanceof L.c?(this._data=null,this._buffer=G):(this._data=G,this._buffer=null),this.byteStride=E?X:X*Float32Array.BYTES_PER_ELEMENT,l||this.create()}createVertexBuffer(U,G,C,L,X){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6?arguments[6]:void 0;const K=l?G:G*Float32Array.BYTES_PER_ELEMENT,P=L?l?L:L*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new E(this._engine,this,U,this._updatable,!0,P,void 0===X?this._instanced:X,K,C,void 0,void 0,!0,this._divisor||t)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!U&&this._buffer||(U=U||this._data,U&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,U),this._data=U):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(U,this._label),this._data=U):this._buffer=this._engine.createVertexBuffer(U,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.SG>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.SG,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.SG,void 0,this._label));X.d.Warn('Missing data for buffer "'.concat(this._label,'" ').concat(this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":"",". Buffer reconstruction failed.")),this._buffer=null}}update(U){this.create(U)}updateDirectly(U,G,C){let L=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,U,L?G:G*Float32Array.BYTES_PER_ELEMENT,C?C*this.byteStride:void 0),this._data=0===G&&void 0===C?U:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class E{get t(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(U){const G=0!=U;this._instanceDivisor=U,G!==this._instanced&&(this._instanced=G,this._computeHashCode())}get _maxVerticesCount(){const U=this.getData();return U?Array.isArray(U)?U.length/(this.byteStride/4)-this.byteOffset/4:(U.byteLength-this.byteOffset)/this.byteStride:0}constructor(U,G,C,L,X,K,P,O,T,D){let y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],V=arguments.length>11&&void 0!==arguments[11]&&arguments[11],p=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,I=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let H=!1;var x,h,N,b,o;(this.VG=U,"object"===typeof L&&null!==L)?(H=null!==(x=L.updatable)&&void 0!==x&&x,X=L.postponeInternalCreation,K=L.stride,P=L.instanced,O=L.offset,T=L.size,D=L.type,y=null!==(h=L.normalized)&&void 0!==h&&h,V=null!==(N=L.useBytes)&&void 0!==N&&N,p=null!==(b=L.divisor)&&void 0!==b?b:1,I=null!==(o=L.takeBufferOwnership)&&void 0!==o&&o,this._label=L.label):H=!!L;if(G instanceof t?(this._buffer=G,this._ownsBuffer=I):(this._buffer=new t(U,G,H,K,X,P,V,p,this._label),this._ownsBuffer=!0),this.uniqueId=E._Counter++,this._kind=C,void 0===D){const U=this.getData();this.type=U?E.GetDataType(U):E.FLOAT}else this.type=D;const w=(0,l.m)(this.type);V?(this._size=T||(K?K/w:E.DeduceStride(C)),this.byteStride=K||this._buffer.byteStride||this._size*w,this.byteOffset=O||0):(this._size=T||K||E.DeduceStride(C),this.byteStride=K?K*w:this._buffer.byteStride||this._size*w,this.byteOffset=(O||0)*w),this.normalized=y,this._instanced=void 0!==P&&P,this._instanceDivisor=P?p:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var U;null===(U=this._buffer)||void 0===U||U._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(U,G){const C=this.getData();return C?(0,l.k)(C,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,U,G):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,l.m)(this.type)}getOffset(){return this.byteOffset/(0,l.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,l.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(U){this._buffer.create(U),this._alignBuffer()}update(U){this._buffer.update(U),this._alignBuffer()}updateDirectly(U,G){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(U,G,void 0,C),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(U,G){(0,l.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,U,this.normalized,((U,C)=>{for(let L=0;L<this._size;L++)G(U[L],C+L)}))}_alignBuffer(){}static DeduceStride(U){switch(U){case E.UVKind:case E.UV2Kind:case E.UV3Kind:case E.UV4Kind:case E.UV5Kind:case E.UV6Kind:return 2;case E.NormalKind:case E.PositionKind:return 3;case E.ColorKind:case E.ColorInstanceKind:case E.MatricesIndicesKind:case E.MatricesIndicesExtraKind:case E.MatricesWeightsKind:case E.MatricesWeightsExtraKind:case E.TangentKind:return 4;default:throw new Error("Invalid kind '"+U+"'")}}static GetDataType(U){return U instanceof Int8Array?E.BYTE:U instanceof Uint8Array?E.UNSIGNED_BYTE:U instanceof Int16Array?E.SHORT:U instanceof Uint16Array?E.UNSIGNED_SHORT:U instanceof Int32Array?E.INT:U instanceof Uint32Array?E.UNSIGNED_INT:E.FLOAT}static GetTypeByteLength(U){return(0,l.m)(U)}static ForEach(U,G,C,L,X,t,E,K){(0,l.h)(U,G,C,L,X,t,E,((U,G)=>{for(let C=0;C<L;C++)K(U[C],G+C)}))}static GetFloatData(U,G,C,L,X,t,E,K){return(0,l.k)(U,G,C,L,X,t,E,K)}}E._Counter=0,E.BYTE=5120,E.UNSIGNED_BYTE=5121,E.SHORT=5122,E.UNSIGNED_SHORT=5123,E.INT=5124,E.UNSIGNED_INT=5125,E.FLOAT=5126,E.PositionKind="position",E.NormalKind="normal",E.TangentKind="tangent",E.UVKind="uv",E.UV2Kind="uv2",E.UV3Kind="uv3",E.UV4Kind="uv4",E.UV5Kind="uv5",E.UV6Kind="uv6",E.ColorKind="color",E.ColorInstanceKind="instanceColor",E.MatricesIndicesKind="matricesIndices",E.MatricesWeightsKind="matricesWeights",E.MatricesIndicesExtraKind="matricesIndicesExtra",E.MatricesWeightsExtraKind="matricesWeightsExtra"},12969:(U,G,C)=>{C.d(G,{b:()=>D,d:()=>T,h:()=>K,k:()=>P,m:()=>t,o:()=>E,q:()=>O});var L=C(12731);function X(U,G,C,L){switch(G){case 5120:{let G=U.getInt8(C);return L&&(G=Math.max(G/127,-1)),G}case 5121:{let G=U.getUint8(C);return L&&(G/=255),G}case 5122:{let G=U.getInt16(C,!0);return L&&(G=Math.max(G/32767,-1)),G}case 5123:{let G=U.getUint16(C,!0);return L&&(G/=65535),G}case 5124:return U.getInt32(C,!0);case 5125:return U.getUint32(C,!0);case 5126:return U.getFloat32(C,!0);default:throw new Error("Invalid component type ".concat(G))}}function l(U,G,C,L,X){switch(G){case 5120:L&&(X=Math.round(127*X)),U.setInt8(C,X);break;case 5121:L&&(X=Math.round(255*X)),U.setUint8(C,X);break;case 5122:L&&(X=Math.round(32767*X)),U.setInt16(C,X,!0);break;case 5123:L&&(X=Math.round(65535*X)),U.setUint16(C,X,!0);break;case 5124:U.setInt32(C,X,!0);break;case 5125:U.setUint32(C,X,!0);break;case 5126:U.setFloat32(C,X,!0);break;default:throw new Error("Invalid component type ".concat(G))}}function t(U){switch(U){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error("Invalid type '".concat(U,"'"))}}function E(U){switch(U){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("Invalid component type '".concat(U,"'"))}}function K(U,G,C,L,E,K,P,O){const T=new Array(L),D=new Array(L);if(U instanceof Array){let X=G/4;const l=C/4;for(let G=0;G<K;G+=L){for(let G=0;G<L;G++)T[G]=D[G]=U[X+G];O(D,G);for(let G=0;G<L;G++)T[G]!==D[G]&&(U[X+G]=D[G]);X+=l}}else{const y=ArrayBuffer.isView(U)?new DataView(U.buffer,U.byteOffset,U.byteLength):new DataView(U),V=t(E);for(let U=0;U<K;U+=L){for(let U=0,C=G;U<L;U++,C+=V)T[U]=D[U]=X(y,E,C,P);O(D,U);for(let U=0,C=G;U<L;U++,C+=V)T[U]!==D[U]&&l(y,E,C,P,D[U]);G+=C}}}function P(U,G,C,X,l,E,P,O){const T=G*t(C),D=P*G;if(5126!==C||l!==T){const L=new Float32Array(D);return K(U,X,l,G,C,D,E,((U,C)=>{for(let X=0;X<G;X++)L[C+X]=U[X]})),L}if(!(U instanceof Array||U instanceof Float32Array)||0!==X||U.length!==D){if(U instanceof Array){const G=X/4;return U.slice(G,G+D)}if(U instanceof ArrayBuffer)return new Float32Array(U,X,D);{const G=U.byteOffset+X;return 0!==(3&G)&&(L.d.Warn("Float array must be aligned to 4-bytes border"),O=!0),O?new Float32Array(U.buffer.slice(G,G+D*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(U.buffer,G,D)}}return O?U.slice():U}function O(U,G,C,X,l,P,O,T){const D=t(C),y=E(C),V=O*G;if(Array.isArray(U)){if(0!==(3&X)||0!==(3&l))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const L=X/4,t=l/4;if(L+(O-1)*t+G>U.length)throw new Error("Last accessed index is out of bounds.");if(t<G)throw new Error("Data stride cannot be smaller than the component size.");if(t!==G){const L=new y(V);return K(U,X,l,G,C,V,P,((U,C)=>{for(let X=0;X<G;X++)L[C+X]=U[X]})),L}return new y(U.slice(L,L+V))}let p,I=X;U instanceof ArrayBuffer?p=U:(p=U.buffer,I+=U.byteOffset);if(I+(O-1)*l+G*D>p.byteLength)throw new Error("Last accessed byte is out of bounds.");const H=G*D;if(l<H)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(l!==H){const U=new y(V);return K(p,I,l,G,C,V,P,((C,L)=>{for(let X=0;X<G;X++)U[L+X]=C[X]})),U}return 1!==D&&0!==(I&D-1)&&(L.d.Warn("Array must be aligned to border of element size. Data will be copied."),T=!0),T?new y(p.slice(I,I+V*D)):new y(p,I,V)}function T(U,G,C,X,l,E,P,O){const T=G*t(C),D=P*G;if(O.length!==D)throw new Error("Output length is not valid");if(5126===C&&l===T)if(U instanceof Array){const G=X/4;O.set(U,G)}else if(U instanceof ArrayBuffer){const G=new Float32Array(U,X,D);O.set(G)}else{const G=U.byteOffset+X;if(0!==(3&G))return L.d.Warn("Float array must be aligned to 4-bytes border"),void O.set(new Float32Array(U.buffer.slice(G,G+D*Float32Array.BYTES_PER_ELEMENT)));const C=new Float32Array(U.buffer,G,D);O.set(C)}else K(U,X,l,G,C,D,E,((U,C)=>{for(let L=0;L<G;L++)O[C+L]=U[L]}))}function D(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(U)){for(let X=0;X<G;X++)if(U[C+X]-L>65535)return!0;return!1}return 4===U.BYTES_PER_ELEMENT}},12966:(U,G,C)=>{C.d(G,{c:()=>L});class L{get underlyingResource(){return null}constructor(){this.references=0,this.SG=0,this.is32Bits=!1,this.uniqueId=L._Counter++}}L._Counter=0},13003:(U,G,C)=>{C.d(G,{e:()=>X});var L=C(12794);class X{static GetEffect(U){return void 0===U.getPipelineContext?U.effect:U}constructor(U){let G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=U.createDrawContext(),G&&(this.materialContext=U.createMaterialContext())}setEffect(U,G){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var L;(this.effect=U,void 0!==G&&(this.defines=G),C)&&(null===(L=this.drawContext)||void 0===L||L.reset())}dispose(){var U;let G=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const U=this.effect;G?U.dispose():L.b.SetImmediate((()=>{U.getEngine().onEndFrameObservable.addOnce((()=>{U.dispose()}))})),this.effect=null}null===(U=this.drawContext)||void 0===U||U.dispose()}}},13080:(U,G,C)=>{C.d(G,{e:()=>X});var L=C(12940);class X{static GetPlanes(U){const G=[];for(let C=0;C<6;C++)G.push(new L.b(0,0,0,0));return X.GetPlanesToRef(U,G),G}static GetNearPlaneToRef(U,G){const C=U.m;G.normal.x=C[3]+C[2],G.normal.y=C[7]+C[6],G.normal.z=C[11]+C[10],G.d=C[15]+C[14],G.normalize()}static GetFarPlaneToRef(U,G){const C=U.m;G.normal.x=C[3]-C[2],G.normal.y=C[7]-C[6],G.normal.z=C[11]-C[10],G.d=C[15]-C[14],G.normalize()}static GetLeftPlaneToRef(U,G){const C=U.m;G.normal.x=C[3]+C[0],G.normal.y=C[7]+C[4],G.normal.z=C[11]+C[8],G.d=C[15]+C[12],G.normalize()}static GetRightPlaneToRef(U,G){const C=U.m;G.normal.x=C[3]-C[0],G.normal.y=C[7]-C[4],G.normal.z=C[11]-C[8],G.d=C[15]-C[12],G.normalize()}static GetTopPlaneToRef(U,G){const C=U.m;G.normal.x=C[3]-C[1],G.normal.y=C[7]-C[5],G.normal.z=C[11]-C[9],G.d=C[15]-C[13],G.normalize()}static GetBottomPlaneToRef(U,G){const C=U.m;G.normal.x=C[3]+C[1],G.normal.y=C[7]+C[5],G.normal.z=C[11]+C[9],G.d=C[15]+C[13],G.normalize()}static GetPlanesToRef(U,G){X.GetNearPlaneToRef(U,G[0]),X.GetFarPlaneToRef(U,G[1]),X.GetLeftPlaneToRef(U,G[2]),X.GetRightPlaneToRef(U,G[3]),X.GetTopPlaneToRef(U,G[4]),X.GetBottomPlaneToRef(U,G[5])}static IsPointInFrustum(U,G){for(let C=0;C<6;C++)if(G[C].dotCoordinate(U)<0)return!1;return!0}}},13087:(U,G,C)=>{C.d(G,{b:()=>X});var L=C(12739);class X{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(U,G){X.Enabled&&(this._current+=U,G&&this._fetchResult())}beginMonitoring(){X.Enabled&&(this._startMonitoringTime=L.d.Now)}endMonitoring(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!X.Enabled)return;U&&this.fetchNewFrame();const G=L.d.Now;this._current=G-this._startMonitoringTime,U&&this._fetchResult()}qE(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const U=L.d.Now;U-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=U,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}X.Enabled=!0},12982:(U,G,C)=>{C.d(G,{c:()=>X,f:()=>L});class L{constructor(U){this.length=0,this.data=new Array(U),this._id=L._GlobalId++}push(U){this.data[this.length++]=U,this.length>this.data.length&&(this.data.length*=2)}forEach(U){for(let G=0;G<this.length;G++)U(this.data[G])}sort(U){this.data.sort(U)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(U){if(0!==U.length){this.length+U.length>this.data.length&&(this.data.length=2*(this.length+U.length));for(let G=0;G<U.length;G++)this.data[this.length++]=(U.data||U)[G]}}indexOf(U){const G=this.data.indexOf(U);return G>=this.length?-1:G}contains(U){return-1!==this.indexOf(U)}}L._GlobalId=0;class X extends L{constructor(){super(...arguments),this._duplicateId=0}push(U){super.push(U),U.__smartArrayFlags||(U.__smartArrayFlags={}),U.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(U){return(!U.__smartArrayFlags||U.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(U),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(U){if(0!==U.length){this.length+U.length>this.data.length&&(this.data.length=2*(this.length+U.length));for(let G=0;G<U.length;G++){const C=(U.data||U)[G];this.pushNoDuplicate(C)}}}}},12955:(U,G,C)=>{C.d(G,{b:()=>l});var L=C(12957),X=C(12721);class l{constructor(U){this._vertexBuffers={},this.onBeforeRenderObservable=new X.e,this._scene=U}_prepareBuffers(){if(this._vertexBuffers[L.e.PositionKind])return;const U=[];U.push(1,1),U.push(-1,1),U.push(-1,-1),U.push(1,-1),this._vertexBuffers[L.e.PositionKind]=new L.e(this._scene.getEngine(),U,L.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const U=[];U.push(0),U.push(1),U.push(2),U.push(0),U.push(2),U.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(U)}_rebuild(){const U=this._vertexBuffers[L.e.PositionKind];U&&(U._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this._scene.activeCamera;return!!C&&(G=G||C._postProcesses.filter((U=>null!=U)),!(!G||0===G.length||!this._scene.postProcessesEnabled)&&(G[0].activate(C,U,null!==G&&void 0!==G),!0))}directRender(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:U.length;const E=this._scene.getEngine();for(let P=0;P<t;P++){var K;if(P<U.length-1)U[P+1].activate(this._scene.activeCamera||this._scene,null===G||void 0===G?void 0:G.texture);else G?E.bindFramebuffer(G,L,void 0,void 0,C,X):l||E.restoreDefaultFramebuffer(),null===(K=E._debugInsertMarker)||void 0===K||K.call(E,"post process ".concat(U[P].name," output"));const t=U[P],O=t.apply();O&&(t.onBeforeRenderObservable.notifyObservers(O),this._prepareBuffers(),E.bindBuffers(this._vertexBuffers,this._indexBuffer,O),E.drawElementsType(0,0,6),t.onAfterRenderObservable.notifyObservers(O))}E.setDepthBuffer(!0),E.setDepthWrite(!0)}_finalizeFrame(U,G,C,L){let X=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const l=this._scene.activeCamera;if(!l)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(L=L||l._postProcesses.filter((U=>null!=U))).length||!this._scene.postProcessesEnabled)return;const t=this._scene.getEngine();for(let K=0,P=L.length;K<P;K++){const O=L[K];var E;if(K<P-1)O._outputTexture=L[K+1].activate(l,null===G||void 0===G?void 0:G.texture);else G?(t.bindFramebuffer(G,C,void 0,void 0,X),O._outputTexture=G):(t.restoreDefaultFramebuffer(),O._outputTexture=null),null===(E=t._debugInsertMarker)||void 0===E||E.call(t,"post process ".concat(L[K].name," output"));if(U)break;const T=O.apply();T&&(O.onBeforeRenderObservable.notifyObservers(T),this._prepareBuffers(),t.bindBuffers(this._vertexBuffers,this._indexBuffer,T),t.drawElementsType(0,0,6),O.onAfterRenderObservable.notifyObservers(T))}t.setDepthBuffer(!0),t.setDepthWrite(!0),t.setAlphaMode(0)}dispose(){const U=this._vertexBuffers[L.e.PositionKind];U&&(U.dispose(),this._vertexBuffers[L.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12973:(U,G,C)=>{C.d(G,{b:()=>E});var L=C(12982),X=C(12896);class l{set opaqueSortCompareFn(U){this._opaqueSortCompareFn=U||l.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(U){this._alphaTestSortCompareFn=U||l.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(U){this._transparentSortCompareFn=U||l.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(U,G){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=U,this._opaqueSubMeshes=new L.f(256),this._transparentSubMeshes=new L.f(256),this._alphaTestSubMeshes=new L.f(256),this._depthOnlySubMeshes=new L.f(256),this._particleSystems=new L.f(256),this._spriteManagers=new L.f(256),this._empty=!0,this._edgesRenderers=new L.c(16),this._scene=G,this.opaqueSortCompareFn=C,this.alphaTestSortCompareFn=X,this.transparentSortCompareFn=l}render(U,G,C,L){if(U)return void U(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const X=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(X.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),X.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const l=X.getStencilBuffer();if(X.setStencilBuffer(!1),G&&this._renderSprites(),C&&this._renderParticles(L),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(X.setStencilBuffer(l),this._scene.useOrderIndependentTransparency){const U=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);U.length&&this._renderTransparent(U)}else this._renderTransparent(this._transparentSubMeshes);X.setAlphaMode(0)}if(X.setStencilBuffer(!1),this._edgesRenderers.length){for(let U=0;U<this._edgesRenderers.length;U++)this._edgesRenderers.data[U].render();X.setAlphaMode(0)}X.setStencilBuffer(l)}_renderOpaqueSorted(U){l._RenderSorted(U,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(U){l._RenderSorted(U,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(U){l._RenderSorted(U,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(U,G,C,L){let t,E=0;const K=C?C.globalPosition:l._ZeroVector;if(L)for(;E<U.length;E++)t=U.data[E],t._alphaIndex=t.getMesh().alphaIndex,t._distanceToCamera=X.pG.Distance(t.getBoundingInfo().boundingSphere.centerWorld,K);const P=U.length===U.data.length?U.data:U.data.slice(0,U.length);G&&P.sort(G);const O=P[0].getMesh().wU();for(E=0;E<P.length;E++)if(t=P[E],!O._activeMeshesFrozenButKeepClipping||t.isInFrustum(O._frustumPlanes)){if(L){const U=t.QU();if(U&&U.needDepthPrePass){const G=U.wU().getEngine();G.setColorWrite(!1),G.setAlphaMode(0),t.render(!1),G.setColorWrite(!0)}}t.render(L)}}static defaultTransparentSortCompare(U,G){return U._alphaIndex>G._alphaIndex?1:U._alphaIndex<G._alphaIndex?-1:l.backToFrontSortCompare(U,G)}static backToFrontSortCompare(U,G){return U._distanceToCamera<G._distanceToCamera?1:U._distanceToCamera>G._distanceToCamera?-1:0}static frontToBackSortCompare(U,G){return U._distanceToCamera<G._distanceToCamera?-1:U._distanceToCamera>G._distanceToCamera?1:0}static PainterSortCompare(U,G){const C=U.getMesh(),L=G.getMesh();return C.material&&L.material?C.material.uniqueId-L.material.uniqueId:C.uniqueId-L.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(U,G,C){void 0===G&&(G=U.getMesh()),void 0===C&&(C=U.QU()),null!==C&&void 0!==C&&(C.needAlphaBlendingForMesh(G)?this._transparentSubMeshes.push(U):C.needAlphaTestingForMesh(G)?(C.needDepthPrePass&&this._depthOnlySubMeshes.push(U),this._alphaTestSubMeshes.push(U)):(C.needDepthPrePass&&this._depthOnlySubMeshes.push(U),this._opaqueSubMeshes.push(U)),G._renderingGroup=this,G._edgesRenderer&&G.isEnabled()&&G.isVisible&&G._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(G._edgesRenderer),this._empty=!1)}dispatchSprites(U){this._spriteManagers.push(U),this._empty=!1}dispatchParticles(U){this._particleSystems.push(U),this._empty=!1}_renderParticles(U){if(0===this._particleSystems.length)return;const G=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let C=0;C<this._particleSystems.length;C++){const L=this._particleSystems.data[C];if(0===(G&&G.layerMask&L.layerMask))continue;const X=L.LG;X.position&&U&&-1===U.indexOf(X)||this._scene._activeParticles.addCount(L.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const U=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let G=0;G<this._spriteManagers.length;G++){const C=this._spriteManagers.data[G];0!==(U&&U.layerMask&C.layerMask)&&C.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}l._ZeroVector=X.pG.Zero();class t{}class E{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(U){U!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=U,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const U of this._scene.meshes)if(U.zE)for(const G of U.zE)G._wasDispatched=!1;if(this._scene.spriteManagers)for(const U of this._scene.spriteManagers)U._wasDispatched=!1;for(const U of this._scene.SD)U._wasDispatched=!1}constructor(U){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new t,this._maintainStateBetweenFrames=!1,this._scene=U;for(let G=E.MIN_RENDERINGGROUPS;G<E.MAX_RENDERINGGROUPS;G++)this._autoClearDepthStencil[G]={ME:!0,depth:!0,kE:!0}}getRenderingGroup(U){const G=U||0;return this._prepareRenderingGroup(G),this._renderingGroups[G]}_clearDepthStencilBuffer(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],G=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,U,G),this._depthStencilBufferAlreadyCleaned=!0)}render(U,G,C,L){const X=this._renderingGroupInfo;if(X.HG=this._scene,X.camera=this._scene.activeCamera,X.renderingManager=this,this._scene.spriteManagers&&L)for(let l=0;l<this._scene.spriteManagers.length;l++){const U=this._scene.spriteManagers[l];this.dispatchSprites(U)}for(let l=E.MIN_RENDERINGGROUPS;l<E.MAX_RENDERINGGROUPS;l++){this._depthStencilBufferAlreadyCleaned=l===E.MIN_RENDERINGGROUPS;const t=this._renderingGroups[l];if(!t||t._empty)continue;const K=1<<l;if(X.renderingGroupId=l,this._scene.onBeforeRenderingGroupObservable.notifyObservers(X,K),E.AUTOCLEAR){const U=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(l):this._autoClearDepthStencil[l];U&&U.ME&&this._clearDepthStencilBuffer(U.depth,U.kE)}for(const U of this._scene._beforeRenderingGroupDrawStage)U.action(l);t.render(U,L,C,G);for(const U of this._scene._afterRenderingGroupDrawStage)U.action(l);this._scene.onAfterRenderingGroupObservable.notifyObservers(X,K)}}reset(){if(!this.maintainStateBetweenFrames)for(let U=E.MIN_RENDERINGGROUPS;U<E.MAX_RENDERINGGROUPS;U++){const G=this._renderingGroups[U];G&&G.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let U=E.MIN_RENDERINGGROUPS;U<E.MAX_RENDERINGGROUPS;U++){const G=this._renderingGroups[U];G&&G.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let U=E.MIN_RENDERINGGROUPS;U<E.MAX_RENDERINGGROUPS;U++){const G=this._renderingGroups[U];G&&G.dispose()}}_prepareRenderingGroup(U){void 0===this._renderingGroups[U]&&(this._renderingGroups[U]=new l(U,this._scene,this._customOpaqueSortCompareFn[U],this._customAlphaTestSortCompareFn[U],this._customTransparentSortCompareFn[U]))}dispatchSprites(U){this.maintainStateBetweenFrames&&U._wasDispatched||(U._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatchSprites(U))}dispatchParticles(U){this.maintainStateBetweenFrames&&U._wasDispatched||(U._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatchParticles(U))}dispatch(U,G,C){void 0===G&&(G=U.getMesh()),this.maintainStateBetweenFrames&&U._wasDispatched||(U._wasDispatched=!0,this.getRenderingGroup(G.renderingGroupId).dispatch(U,G,C))}setRenderingOrder(U){let G=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[U]=G,this._customAlphaTestSortCompareFn[U]=C,this._customTransparentSortCompareFn[U]=L,this._renderingGroups[U]){const G=this._renderingGroups[U];G.opaqueSortCompareFn=this._customOpaqueSortCompareFn[U],G.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[U],G.transparentSortCompareFn=this._customTransparentSortCompareFn[U]}}setRenderingAutoClearDepthStencil(U,G){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],L=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[U]={ME:G,depth:C,kE:L}}getAutoClearDepthStencilSetup(U){return this._autoClearDepthStencil[U]}}E.MAX_RENDERINGGROUPS=4,E.MIN_RENDERINGGROUPS=0,E.AUTOCLEAR=!0}}]);