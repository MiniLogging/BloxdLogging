"use strict";(self["9d4d30r2sf"]=self["9d4d30r2sf"]||[]).push([[19],{12577:(o,v,V)=>{V.d(v,{b:()=>Q,e:()=>U});var g=V(12583),E=V(12308),I=V(12585);class Q{get l(){return this._isDisposed}constructor(o,v,V){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7?arguments[7]:void 0,O=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,o&&o.Fo?this._engine=o.Fo().getEngine():this._engine=o,this._updatable=V,this._instanced=Q,this._divisor=n||1,this._label=O,v instanceof g.d?(this._data=null,this._buffer=v):(this._data=v,this._buffer=null),this.byteStride=U?E:E*Float32Array.BYTES_PER_ELEMENT,I||this.create()}createVertexBuffer(o,v,V,g,E){let I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6?arguments[6]:void 0;const n=I?v:v*Float32Array.BYTES_PER_ELEMENT,O=g?I?g:g*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new U(this._engine,this,o,this._updatable,!0,O,void 0===E?this._instanced:E,n,V,void 0,void 0,!0,this._divisor||Q)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!o&&this._buffer||(o=o||this._data,o&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,o),this._data=o):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(o,this._label),this._data=o):this._buffer=this._engine.createVertexBuffer(o,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.yv>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.yv,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.yv,void 0,this._label));E.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(o){this.create(o)}updateDirectly(o,v,V){let g=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,o,g?v:v*Float32Array.BYTES_PER_ELEMENT,V?V*this.byteStride:void 0),this._data=0===v&&void 0===V?o:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class U{get l(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(o){const v=0!=o;this._instanceDivisor=o,v!==this._instanced&&(this._instanced=v,this._computeHashCode())}get _maxVerticesCount(){const o=this.getData();return o?Array.isArray(o)?o.length/(this.byteStride/4)-this.byteOffset/4:(o.byteLength-this.byteOffset)/this.byteStride:0}constructor(o,v,V,g,E,n,O,h,x,f){let l=arguments.length>10&&void 0!==arguments[10]&&arguments[10],S=arguments.length>11&&void 0!==arguments[11]&&arguments[11],T=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,c=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let R=!1;if(this.Tv=o,"object"===typeof g&&null!==g?(R=g.updatable??!1,E=g.postponeInternalCreation,n=g.stride,O=g.instanced,h=g.offset,x=g.size,f=g.type,l=g.normalized??!1,S=g.useBytes??!1,T=g.divisor??1,c=g.takeBufferOwnership??!1,this._label=g.label):R=!!g,v instanceof Q?(this._buffer=v,this._ownsBuffer=c):(this._buffer=new Q(o,v,R,n,E,O,S,T,this._label),this._ownsBuffer=!0),this.uniqueId=U._Counter++,this._kind=V,void 0===f){const o=this.getData();this.type=o?U.GetDataType(o):U.FLOAT}else this.type=f;const j=(0,I.m)(this.type);S?(this._size=x||(n?n/j:U.DeduceStride(V)),this.byteStride=n||this._buffer.byteStride||this._size*j,this.byteOffset=h||0):(this._size=x||n||U.DeduceStride(V),this.byteStride=n?n*j:this._buffer.byteStride||this._size*j,this.byteOffset=(h||0)*j),this.normalized=l,this._instanced=void 0!==O&&O,this._instanceDivisor=O?T:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var o;null===(o=this._buffer)||void 0===o||o._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(o,v){const V=this.getData();return V?(0,I.k)(V,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,o,v):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,I.m)(this.type)}getOffset(){return this.byteOffset/(0,I.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,I.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(o){this._buffer.create(o),this._alignBuffer()}update(o){this._buffer.update(o),this._alignBuffer()}updateDirectly(o,v){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(o,v,void 0,V),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(o,v){(0,I.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,o,this.normalized,((o,V)=>{for(let g=0;g<this._size;g++)v(o[g],V+g)}))}_alignBuffer(){}static DeduceStride(o){switch(o){case U.UVKind:case U.UV2Kind:case U.UV3Kind:case U.UV4Kind:case U.UV5Kind:case U.UV6Kind:return 2;case U.NormalKind:case U.PositionKind:return 3;case U.ColorKind:case U.ColorInstanceKind:case U.MatricesIndicesKind:case U.MatricesIndicesExtraKind:case U.MatricesWeightsKind:case U.MatricesWeightsExtraKind:case U.TangentKind:return 4;default:throw new Error("Invalid kind '"+o+"'")}}static GetDataType(o){return o instanceof Int8Array?U.BYTE:o instanceof Uint8Array?U.UNSIGNED_BYTE:o instanceof Int16Array?U.SHORT:o instanceof Uint16Array?U.UNSIGNED_SHORT:o instanceof Int32Array?U.INT:o instanceof Uint32Array?U.UNSIGNED_INT:U.FLOAT}static GetTypeByteLength(o){return(0,I.m)(o)}static ForEach(o,v,V,g,E,Q,U,n){(0,I.g)(o,v,V,g,E,Q,U,((o,v)=>{for(let V=0;V<g;V++)n(o[V],v+V)}))}static GetFloatData(o,v,V,g,E,Q,U,n){return(0,I.k)(o,v,V,g,E,Q,U,n)}}U._Counter=0,U.BYTE=5120,U.UNSIGNED_BYTE=5121,U.SHORT=5122,U.UNSIGNED_SHORT=5123,U.INT=5124,U.UNSIGNED_INT=5125,U.FLOAT=5126,U.PositionKind="position",U.NormalKind="normal",U.TangentKind="tangent",U.UVKind="uv",U.UV2Kind="uv2",U.UV3Kind="uv3",U.UV4Kind="uv4",U.UV5Kind="uv5",U.UV6Kind="uv6",U.ColorKind="color",U.ColorInstanceKind="instanceColor",U.MatricesIndicesKind="matricesIndices",U.MatricesWeightsKind="matricesWeights",U.MatricesIndicesExtraKind="matricesIndicesExtra",U.MatricesWeightsExtraKind="matricesWeightsExtra"},12585:(o,v,V)=>{V.d(v,{d:()=>f,f:()=>x,g:()=>n,k:()=>O,m:()=>Q,q:()=>U,t:()=>h});var g=V(12308);function E(o,v,V,g){switch(v){case 5120:{let v=o.getInt8(V);return g&&(v=Math.max(v/127,-1)),v}case 5121:{let v=o.getUint8(V);return g&&(v/=255),v}case 5122:{let v=o.getInt16(V,!0);return g&&(v=Math.max(v/32767,-1)),v}case 5123:{let v=o.getUint16(V,!0);return g&&(v/=65535),v}case 5124:return o.getInt32(V,!0);case 5125:return o.getUint32(V,!0);case 5126:return o.getFloat32(V,!0);default:throw new Error(`Invalid component type ${v}`)}}function I(o,v,V,g,E){switch(v){case 5120:g&&(E=Math.round(127*E)),o.setInt8(V,E);break;case 5121:g&&(E=Math.round(255*E)),o.setUint8(V,E);break;case 5122:g&&(E=Math.round(32767*E)),o.setInt16(V,E,!0);break;case 5123:g&&(E=Math.round(65535*E)),o.setUint16(V,E,!0);break;case 5124:o.setInt32(V,E,!0);break;case 5125:o.setUint32(V,E,!0);break;case 5126:o.setFloat32(V,E,!0);break;default:throw new Error(`Invalid component type ${v}`)}}function Q(o){switch(o){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${o}'`)}}function U(o){switch(o){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${o}'`)}}function n(o,v,V,g,U,n,O,h){const x=new Array(g),f=new Array(g);if(o instanceof Array){let E=v/4;const I=V/4;for(let v=0;v<n;v+=g){for(let v=0;v<g;v++)x[v]=f[v]=o[E+v];h(f,v);for(let v=0;v<g;v++)x[v]!==f[v]&&(o[E+v]=f[v]);E+=I}}else{const l=ArrayBuffer.isView(o)?new DataView(o.buffer,o.byteOffset,o.byteLength):new DataView(o),S=Q(U);for(let o=0;o<n;o+=g){for(let o=0,V=v;o<g;o++,V+=S)x[o]=f[o]=E(l,U,V,O);h(f,o);for(let o=0,V=v;o<g;o++,V+=S)x[o]!==f[o]&&I(l,U,V,O,f[o]);v+=V}}}function O(o,v,V,E,I,U,O,h){const x=v*Q(V),f=O*v;if(5126!==V||I!==x){const g=new Float32Array(f);return n(o,E,I,v,V,f,U,((o,V)=>{for(let E=0;E<v;E++)g[V+E]=o[E]})),g}if(!(o instanceof Array||o instanceof Float32Array)||0!==E||o.length!==f){if(o instanceof Array){const v=E/4;return o.slice(v,v+f)}if(o instanceof ArrayBuffer)return new Float32Array(o,E,f);{const v=o.byteOffset+E;return 0!==(3&v)&&(g.b.Warn("Float array must be aligned to 4-bytes border"),h=!0),h?new Float32Array(o.buffer.slice(v,v+f*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(o.buffer,v,f)}}return h?o.slice():o}function h(o,v,V,E,I,O,h,x){const f=Q(V),l=U(V),S=h*v;if(Array.isArray(o)){if(0!==(3&E)||0!==(3&I))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const g=E/4,Q=I/4;if(g+(h-1)*Q+v>o.length)throw new Error("Last accessed index is out of bounds.");if(Q<v)throw new Error("Data stride cannot be smaller than the component size.");if(Q!==v){const g=new l(S);return n(o,E,I,v,V,S,O,((o,V)=>{for(let E=0;E<v;E++)g[V+E]=o[E]})),g}return new l(o.slice(g,g+S))}let T,c=E;o instanceof ArrayBuffer?T=o:(T=o.buffer,c+=o.byteOffset);if(c+(h-1)*I+v*f>T.byteLength)throw new Error("Last accessed byte is out of bounds.");const R=v*f;if(I<R)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(I!==R){const o=new l(S);return n(T,c,I,v,V,S,O,((V,g)=>{for(let E=0;E<v;E++)o[g+E]=V[E]})),o}return 1!==f&&0!==(c&f-1)&&(g.b.Warn("Array must be aligned to border of element size. Data will be copied."),x=!0),x?new l(T.slice(c,c+S*f)):new l(T,c,S)}function x(o,v,V,E,I,U,O,h){const x=v*Q(V),f=O*v;if(h.length!==f)throw new Error("Output length is not valid");if(5126===V&&I===x)if(o instanceof Array){const v=E/4;h.set(o,v)}else if(o instanceof ArrayBuffer){const v=new Float32Array(o,E,f);h.set(v)}else{const v=o.byteOffset+E;if(0!==(3&v))return g.b.Warn("Float array must be aligned to 4-bytes border"),void h.set(new Float32Array(o.buffer.slice(v,v+f*Float32Array.BYTES_PER_ELEMENT)));const V=new Float32Array(o.buffer,v,f);h.set(V)}else n(o,E,I,v,V,f,U,((o,V)=>{for(let g=0;g<v;g++)h[V+g]=o[g]}))}function f(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(o)){for(let E=0;E<v;E++)if(o[V+E]-g>65535)return!0;return!1}return 4===o.BYTES_PER_ELEMENT}},12583:(o,v,V)=>{V.d(v,{d:()=>g});class g{get underlyingResource(){return null}constructor(){this.references=0,this.yv=0,this.is32Bits=!1,this.uniqueId=g._Counter++}}g._Counter=0},12615:(o,v,V)=>{V.d(v,{c:()=>E});var g=V(12374);class E{static GetEffect(o){return void 0===o.getPipelineContext?o.effect:o}constructor(o){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=o.createDrawContext(),v&&(this.materialContext=o.createMaterialContext())}setEffect(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var g;(this.effect=o,void 0!==v&&(this.defines=v),V)&&(null===(g=this.drawContext)||void 0===g||g.reset())}dispose(){var o;let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const o=this.effect;v?o.dispose():g.b.SetImmediate((()=>{o.getEngine().onEndFrameObservable.addOnce((()=>{o.dispose()}))})),this.effect=null}null===(o=this.drawContext)||void 0===o||o.dispose()}}},12714:(o,v,V)=>{V.d(v,{b:()=>E});var g=V(12556);class E{static GetPlanes(o){const v=[];for(let V=0;V<6;V++)v.push(new g.c(0,0,0,0));return E.GetPlanesToRef(o,v),v}static GetNearPlaneToRef(o,v){const V=o.m;v.normal.x=V[3]+V[2],v.normal.y=V[7]+V[6],v.normal.z=V[11]+V[10],v.d=V[15]+V[14],v.normalize()}static GetFarPlaneToRef(o,v){const V=o.m;v.normal.x=V[3]-V[2],v.normal.y=V[7]-V[6],v.normal.z=V[11]-V[10],v.d=V[15]-V[14],v.normalize()}static GetLeftPlaneToRef(o,v){const V=o.m;v.normal.x=V[3]+V[0],v.normal.y=V[7]+V[4],v.normal.z=V[11]+V[8],v.d=V[15]+V[12],v.normalize()}static GetRightPlaneToRef(o,v){const V=o.m;v.normal.x=V[3]-V[0],v.normal.y=V[7]-V[4],v.normal.z=V[11]-V[8],v.d=V[15]-V[12],v.normalize()}static GetTopPlaneToRef(o,v){const V=o.m;v.normal.x=V[3]-V[1],v.normal.y=V[7]-V[5],v.normal.z=V[11]-V[9],v.d=V[15]-V[13],v.normalize()}static GetBottomPlaneToRef(o,v){const V=o.m;v.normal.x=V[3]+V[1],v.normal.y=V[7]+V[5],v.normal.z=V[11]+V[9],v.d=V[15]+V[13],v.normalize()}static GetPlanesToRef(o,v){E.GetNearPlaneToRef(o,v[0]),E.GetFarPlaneToRef(o,v[1]),E.GetLeftPlaneToRef(o,v[2]),E.GetRightPlaneToRef(o,v[3]),E.GetTopPlaneToRef(o,v[4]),E.GetBottomPlaneToRef(o,v[5])}static IsPointInFrustum(o,v){for(let V=0;V<6;V++)if(v[V].dotCoordinate(o)<0)return!1;return!0}}},12725:(o,v,V)=>{V.d(v,{e:()=>E});var g=V(12321);class E{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(o,v){E.Enabled&&(this._current+=o,v&&this._fetchResult())}beginMonitoring(){E.Enabled&&(this._startMonitoringTime=g.e.Now)}endMonitoring(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!E.Enabled)return;o&&this.fetchNewFrame();const v=g.e.Now;this._current=v-this._startMonitoringTime,o&&this._fetchResult()}fg(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const o=g.e.Now;o-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=o,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}E.Enabled=!0},12593:(o,v,V)=>{V.d(v,{c:()=>E,d:()=>g});class g{constructor(o){this.length=0,this.data=new Array(o),this._id=g._GlobalId++}push(o){this.data[this.length++]=o,this.length>this.data.length&&(this.data.length*=2)}forEach(o){for(let v=0;v<this.length;v++)o(this.data[v])}sort(o){this.data.sort(o)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(o){if(0!==o.length){this.length+o.length>this.data.length&&(this.data.length=2*(this.length+o.length));for(let v=0;v<o.length;v++)this.data[this.length++]=(o.data||o)[v]}}indexOf(o){const v=this.data.indexOf(o);return v>=this.length?-1:v}contains(o){return-1!==this.indexOf(o)}}g._GlobalId=0;class E extends g{constructor(){super(...arguments),this._duplicateId=0}push(o){super.push(o),o.__smartArrayFlags||(o.__smartArrayFlags={}),o.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(o){return(!o.__smartArrayFlags||o.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(o),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(o){if(0!==o.length){this.length+o.length>this.data.length&&(this.data.length=2*(this.length+o.length));for(let v=0;v<o.length;v++){const V=(o.data||o)[v];this.pushNoDuplicate(V)}}}}},12569:(o,v,V)=>{V.d(v,{b:()=>I});var g=V(12577),E=V(12297);class I{constructor(o){this._vertexBuffers={},this.onBeforeRenderObservable=new E.e,this._scene=o}_prepareBuffers(){if(this._vertexBuffers[g.e.PositionKind])return;const o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[g.e.PositionKind]=new g.e(this._scene.getEngine(),o,g.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const o=[];o.push(0),o.push(1),o.push(2),o.push(0),o.push(2),o.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(o)}_rebuild(){const o=this._vertexBuffers[g.e.PositionKind];o&&(o._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=this._scene.activeCamera;return!!V&&(v=v||V._postProcesses.filter((o=>null!=o)),!(!v||0===v.length||!this._scene.postProcessesEnabled)&&(v[0].activate(V,o,null!==v&&void 0!==v),!0))}directRender(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o.length;const U=this._scene.getEngine();for(let O=0;O<Q;O++){var n;if(O<o.length-1)o[O+1].activate(this._scene.activeCamera||this._scene,null===v||void 0===v?void 0:v.texture);else v?U.bindFramebuffer(v,g,void 0,void 0,V,E):I||U.restoreDefaultFramebuffer(),null===(n=U._debugInsertMarker)||void 0===n||n.call(U,`post process ${o[O].name} output`);const Q=o[O],h=Q.apply();h&&(Q.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),U.bindBuffers(this._vertexBuffers,this._indexBuffer,h),U.drawElementsType(0,0,6),Q.onAfterRenderObservable.notifyObservers(h))}U.setDepthBuffer(!0),U.setDepthWrite(!0)}_finalizeFrame(o,v,V,g){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const I=this._scene.activeCamera;if(!I)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(g=g||I._postProcesses.filter((o=>null!=o))).length||!this._scene.postProcessesEnabled)return;const Q=this._scene.getEngine();for(let n=0,O=g.length;n<O;n++){const h=g[n];var U;if(n<O-1)h._outputTexture=g[n+1].activate(I,null===v||void 0===v?void 0:v.texture);else v?(Q.bindFramebuffer(v,V,void 0,void 0,E),h._outputTexture=v):(Q.restoreDefaultFramebuffer(),h._outputTexture=null),null===(U=Q._debugInsertMarker)||void 0===U||U.call(Q,`post process ${g[n].name} output`);if(o)break;const x=h.apply();x&&(h.onBeforeRenderObservable.notifyObservers(x),this._prepareBuffers(),Q.bindBuffers(this._vertexBuffers,this._indexBuffer,x),Q.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(x))}Q.setDepthBuffer(!0),Q.setDepthWrite(!0),Q.setAlphaMode(0)}dispose(){const o=this._vertexBuffers[g.e.PositionKind];o&&(o.dispose(),this._vertexBuffers[g.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12588:(o,v,V)=>{V.d(v,{d:()=>U});var g=V(12593),E=V(12488);class I{set opaqueSortCompareFn(o){this._opaqueSortCompareFn=o||I.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(o){this._alphaTestSortCompareFn=o||I.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(o){this._transparentSortCompareFn=o||I.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(o,v){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=o,this._opaqueSubMeshes=new g.d(256),this._transparentSubMeshes=new g.d(256),this._alphaTestSubMeshes=new g.d(256),this._depthOnlySubMeshes=new g.d(256),this._particleSystems=new g.d(256),this._spriteManagers=new g.d(256),this._empty=!0,this._edgesRenderers=new g.c(16),this._scene=v,this.opaqueSortCompareFn=V,this.alphaTestSortCompareFn=E,this.transparentSortCompareFn=I}render(o,v,V,g){if(o)return void o(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const E=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(E.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),E.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const I=E.getStencilBuffer();if(E.setStencilBuffer(!1),v&&this._renderSprites(),V&&this._renderParticles(g),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(E.setStencilBuffer(I),this._scene.useOrderIndependentTransparency){const o=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);o.length&&this._renderTransparent(o)}else this._renderTransparent(this._transparentSubMeshes);E.setAlphaMode(0)}if(E.setStencilBuffer(!1),this._edgesRenderers.length){for(let o=0;o<this._edgesRenderers.length;o++)this._edgesRenderers.data[o].render();E.setAlphaMode(0)}E.setStencilBuffer(I)}_renderOpaqueSorted(o){I._RenderSorted(o,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(o){I._RenderSorted(o,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(o){I._RenderSorted(o,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(o,v,V,g){let Q,U=0;const n=V?V.globalPosition:I._ZeroVector;if(g)for(;U<o.length;U++)Q=o.data[U],Q._alphaIndex=Q.getMesh().alphaIndex,Q._distanceToCamera=E.cv.Distance(Q.getBoundingInfo().boundingSphere.centerWorld,n);const O=o.length===o.data.length?o.data:o.data.slice(0,o.length);v&&O.sort(v);const h=O[0].getMesh().Fo();for(U=0;U<O.length;U++)if(Q=O[U],!h._activeMeshesFrozenButKeepClipping||Q.isInFrustum(h._frustumPlanes)){if(g){const o=Q.yo();if(o&&o.needDepthPrePass){const v=o.Fo().getEngine();v.setColorWrite(!1),v.setAlphaMode(0),Q.render(!1),v.setColorWrite(!0)}}Q.render(g)}}static defaultTransparentSortCompare(o,v){return o._alphaIndex>v._alphaIndex?1:o._alphaIndex<v._alphaIndex?-1:I.backToFrontSortCompare(o,v)}static backToFrontSortCompare(o,v){return o._distanceToCamera<v._distanceToCamera?1:o._distanceToCamera>v._distanceToCamera?-1:0}static frontToBackSortCompare(o,v){return o._distanceToCamera<v._distanceToCamera?-1:o._distanceToCamera>v._distanceToCamera?1:0}static PainterSortCompare(o,v){const V=o.getMesh(),g=v.getMesh();return V.material&&g.material?V.material.uniqueId-g.material.uniqueId:V.uniqueId-g.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(o,v,V){void 0===v&&(v=o.getMesh()),void 0===V&&(V=o.yo()),null!==V&&void 0!==V&&(V.needAlphaBlendingForMesh(v)?this._transparentSubMeshes.push(o):V.needAlphaTestingForMesh(v)?(V.needDepthPrePass&&this._depthOnlySubMeshes.push(o),this._alphaTestSubMeshes.push(o)):(V.needDepthPrePass&&this._depthOnlySubMeshes.push(o),this._opaqueSubMeshes.push(o)),v._renderingGroup=this,v._edgesRenderer&&v.isEnabled()&&v.isVisible&&v._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(v._edgesRenderer),this._empty=!1)}dispatchSprites(o){this._spriteManagers.push(o),this._empty=!1}dispatchParticles(o){this._particleSystems.push(o),this._empty=!1}_renderParticles(o){if(0===this._particleSystems.length)return;const v=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let V=0;V<this._particleSystems.length;V++){const g=this._particleSystems.data[V];if(0===(v&&v.layerMask&g.layerMask))continue;const E=g.lo;E.position&&o&&-1===o.indexOf(E)||this._scene._activeParticles.addCount(g.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const o=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let v=0;v<this._spriteManagers.length;v++){const V=this._spriteManagers.data[v];0!==(o&&o.layerMask&V.layerMask)&&V.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}I._ZeroVector=E.cv.Zero();class Q{}class U{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(o){o!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=o,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const o of this._scene.meshes)if(o.wg)for(const v of o.wg)v._wasDispatched=!1;if(this._scene.spriteManagers)for(const o of this._scene.spriteManagers)o._wasDispatched=!1;for(const o of this._scene.Mf)o._wasDispatched=!1}constructor(o){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Q,this._maintainStateBetweenFrames=!1,this._scene=o;for(let v=U.MIN_RENDERINGGROUPS;v<U.MAX_RENDERINGGROUPS;v++)this._autoClearDepthStencil[v]={qg:!0,depth:!0,Rg:!0}}getRenderingGroup(o){const v=o||0;return this._prepareRenderingGroup(v),this._renderingGroups[v]}_clearDepthStencilBuffer(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,o,v),this._depthStencilBufferAlreadyCleaned=!0)}render(o,v,V,g){const E=this._renderingGroupInfo;if(E.jv=this._scene,E.camera=this._scene.activeCamera,E.renderingManager=this,this._scene.spriteManagers&&g)for(let I=0;I<this._scene.spriteManagers.length;I++){const o=this._scene.spriteManagers[I];this.dispatchSprites(o)}for(let I=U.MIN_RENDERINGGROUPS;I<U.MAX_RENDERINGGROUPS;I++){this._depthStencilBufferAlreadyCleaned=I===U.MIN_RENDERINGGROUPS;const Q=this._renderingGroups[I];if(!Q||Q._empty)continue;const n=1<<I;if(E.renderingGroupId=I,this._scene.onBeforeRenderingGroupObservable.notifyObservers(E,n),U.AUTOCLEAR){const o=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(I):this._autoClearDepthStencil[I];o&&o.qg&&this._clearDepthStencilBuffer(o.depth,o.Rg)}for(const o of this._scene._beforeRenderingGroupDrawStage)o.action(I);Q.render(o,g,V,v);for(const o of this._scene._afterRenderingGroupDrawStage)o.action(I);this._scene.onAfterRenderingGroupObservable.notifyObservers(E,n)}}reset(){if(!this.maintainStateBetweenFrames)for(let o=U.MIN_RENDERINGGROUPS;o<U.MAX_RENDERINGGROUPS;o++){const v=this._renderingGroups[o];v&&v.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let o=U.MIN_RENDERINGGROUPS;o<U.MAX_RENDERINGGROUPS;o++){const v=this._renderingGroups[o];v&&v.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let o=U.MIN_RENDERINGGROUPS;o<U.MAX_RENDERINGGROUPS;o++){const v=this._renderingGroups[o];v&&v.dispose()}}_prepareRenderingGroup(o){void 0===this._renderingGroups[o]&&(this._renderingGroups[o]=new I(o,this._scene,this._customOpaqueSortCompareFn[o],this._customAlphaTestSortCompareFn[o],this._customTransparentSortCompareFn[o]))}dispatchSprites(o){this.maintainStateBetweenFrames&&o._wasDispatched||(o._wasDispatched=!0,this.getRenderingGroup(o.renderingGroupId).dispatchSprites(o))}dispatchParticles(o){this.maintainStateBetweenFrames&&o._wasDispatched||(o._wasDispatched=!0,this.getRenderingGroup(o.renderingGroupId).dispatchParticles(o))}dispatch(o,v,V){void 0===v&&(v=o.getMesh()),this.maintainStateBetweenFrames&&o._wasDispatched||(o._wasDispatched=!0,this.getRenderingGroup(v.renderingGroupId).dispatch(o,v,V))}setRenderingOrder(o){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[o]=v,this._customAlphaTestSortCompareFn[o]=V,this._customTransparentSortCompareFn[o]=g,this._renderingGroups[o]){const v=this._renderingGroups[o];v.opaqueSortCompareFn=this._customOpaqueSortCompareFn[o],v.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[o],v.transparentSortCompareFn=this._customTransparentSortCompareFn[o]}}setRenderingAutoClearDepthStencil(o,v){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],g=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[o]={qg:v,depth:V,Rg:g}}getAutoClearDepthStencilSetup(o){return this._autoClearDepthStencil[o]}}U.MAX_RENDERINGGROUPS=4,U.MIN_RENDERINGGROUPS=0,U.AUTOCLEAR=!0}}]);