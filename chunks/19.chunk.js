"use strict";(self.zcqpiao938m=self.zcqpiao938m||[]).push([[19],{11905:(C,U,K)=>{K.d(U,{b:()=>A,d:()=>e});var m=K(11909),O=K(11679),X=K(11918);class A{get A(){return this._isDisposed}constructor(C,U,K){let O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,X=arguments.length>4&&void 0!==arguments[4]&&arguments[4],A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],e=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7?arguments[7]:void 0,z=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,C&&C.dC?this._engine=C.dC().getEngine():this._engine=C,this._updatable=K,this._instanced=A,this._divisor=t||1,this._label=z,U instanceof m.e?(this._data=null,this._buffer=U):(this._data=U,this._buffer=null),this.byteStride=e?O:O*Float32Array.BYTES_PER_ELEMENT,X||this.create()}createVertexBuffer(C,U,K,m,O){let X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6?arguments[6]:void 0;const t=X?U:U*Float32Array.BYTES_PER_ELEMENT,z=m?X?m:m*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new e(this._engine,this,C,this._updatable,!0,z,void 0===O?this._instanced:O,t,K,void 0,void 0,!0,this._divisor||A)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!C&&this._buffer||(C=C||this._data,C&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,C),this._data=C):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(C,this._label),this._data=C):this._buffer=this._engine.createVertexBuffer(C,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.ye>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.ye,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.ye,void 0,this._label));O.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(C){this.create(C)}updateDirectly(C,U,K){let m=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,C,m?U:U*Float32Array.BYTES_PER_ELEMENT,K?K*this.byteStride:void 0),this._data=0===U&&void 0===K?C:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class e{get A(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(C){const U=0!=C;this._instanceDivisor=C,U!==this._instanced&&(this._instanced=U,this._computeHashCode())}get _maxVerticesCount(){const C=this.getData();return C?Array.isArray(C)?C.length/(this.byteStride/4)-this.byteOffset/4:(C.byteLength-this.byteOffset)/this.byteStride:0}constructor(C,U,K,m,O,t,z,j,p,E){let u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]&&arguments[11],v=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,Q=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let V=!1;if(this.uU=C,"object"===typeof m&&null!==m?(V=m.updatable??!1,O=m.postponeInternalCreation,t=m.stride,z=m.instanced,j=m.offset,p=m.size,E=m.type,u=m.normalized??!1,b=m.useBytes??!1,v=m.divisor??1,Q=m.takeBufferOwnership??!1,this._label=m.label):V=!!m,U instanceof A?(this._buffer=U,this._ownsBuffer=Q):(this._buffer=new A(C,U,V,t,O,z,b,v,this._label),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=K,void 0===E){const C=this.getData();this.type=C?e.GetDataType(C):e.FLOAT}else this.type=E;const f=(0,X.n)(this.type);b?(this._size=p||(t?t/f:e.DeduceStride(K)),this.byteStride=t||this._buffer.byteStride||this._size*f,this.byteOffset=j||0):(this._size=p||t||e.DeduceStride(K),this.byteStride=t?t*f:this._buffer.byteStride||this._size*f,this.byteOffset=(j||0)*f),this.normalized=u,this._instanced=void 0!==z&&z,this._instanceDivisor=z?v:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var C;null===(C=this._buffer)||void 0===C||C._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(C,U){const K=this.getData();return K?(0,X.k)(K,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,C,U):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,X.n)(this.type)}getOffset(){return this.byteOffset/(0,X.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,X.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(C){this._buffer.create(C),this._alignBuffer()}update(C){this._buffer.update(C),this._alignBuffer()}updateDirectly(C,U){let K=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(C,U,void 0,K),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(C,U){(0,X.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,C,this.normalized,((C,K)=>{for(let m=0;m<this._size;m++)U(C[m],K+m)}))}_alignBuffer(){}static DeduceStride(C){switch(C){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.ColorInstanceKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+C+"'")}}static GetDataType(C){return C instanceof Int8Array?e.BYTE:C instanceof Uint8Array?e.UNSIGNED_BYTE:C instanceof Int16Array?e.SHORT:C instanceof Uint16Array?e.UNSIGNED_SHORT:C instanceof Int32Array?e.INT:C instanceof Uint32Array?e.UNSIGNED_INT:e.FLOAT}static GetTypeByteLength(C){return(0,X.n)(C)}static ForEach(C,U,K,m,O,A,e,t){(0,X.h)(C,U,K,m,O,A,e,((C,U)=>{for(let K=0;K<m;K++)t(C[K],U+K)}))}static GetFloatData(C,U,K,m,O,A,e,t){return(0,X.k)(C,U,K,m,O,A,e,t)}}e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra"},11918:(C,U,K)=>{K.d(U,{c:()=>E,g:()=>p,h:()=>t,k:()=>z,n:()=>A,r:()=>e,v:()=>j});var m=K(11679);function O(C,U,K,m){switch(U){case 5120:{let U=C.getInt8(K);return m&&(U=Math.max(U/127,-1)),U}case 5121:{let U=C.getUint8(K);return m&&(U/=255),U}case 5122:{let U=C.getInt16(K,!0);return m&&(U=Math.max(U/32767,-1)),U}case 5123:{let U=C.getUint16(K,!0);return m&&(U/=65535),U}case 5124:return C.getInt32(K,!0);case 5125:return C.getUint32(K,!0);case 5126:return C.getFloat32(K,!0);default:throw new Error(`Invalid component type ${U}`)}}function X(C,U,K,m,O){switch(U){case 5120:m&&(O=Math.round(127*O)),C.setInt8(K,O);break;case 5121:m&&(O=Math.round(255*O)),C.setUint8(K,O);break;case 5122:m&&(O=Math.round(32767*O)),C.setInt16(K,O,!0);break;case 5123:m&&(O=Math.round(65535*O)),C.setUint16(K,O,!0);break;case 5124:C.setInt32(K,O,!0);break;case 5125:C.setUint32(K,O,!0);break;case 5126:C.setFloat32(K,O,!0);break;default:throw new Error(`Invalid component type ${U}`)}}function A(C){switch(C){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${C}'`)}}function e(C){switch(C){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${C}'`)}}function t(C,U,K,m,e,t,z,j){const p=new Array(m),E=new Array(m);if(C instanceof Array){let O=U/4;const X=K/4;for(let U=0;U<t;U+=m){for(let U=0;U<m;U++)p[U]=E[U]=C[O+U];j(E,U);for(let U=0;U<m;U++)p[U]!==E[U]&&(C[O+U]=E[U]);O+=X}}else{const u=ArrayBuffer.isView(C)?new DataView(C.buffer,C.byteOffset,C.byteLength):new DataView(C),b=A(e);for(let C=0;C<t;C+=m){for(let C=0,K=U;C<m;C++,K+=b)p[C]=E[C]=O(u,e,K,z);j(E,C);for(let C=0,K=U;C<m;C++,K+=b)p[C]!==E[C]&&X(u,e,K,z,E[C]);U+=K}}}function z(C,U,K,O,X,e,z,j){const p=U*A(K),E=z*U;if(5126!==K||X!==p){const m=new Float32Array(E);return t(C,O,X,U,K,E,e,((C,K)=>{for(let O=0;O<U;O++)m[K+O]=C[O]})),m}if(!(C instanceof Array||C instanceof Float32Array)||0!==O||C.length!==E){if(C instanceof Array){const U=O/4;return C.slice(U,U+E)}if(C instanceof ArrayBuffer)return new Float32Array(C,O,E);{const U=C.byteOffset+O;return 0!==(3&U)&&(m.d.Warn("Float array must be aligned to 4-bytes border"),j=!0),j?new Float32Array(C.buffer.slice(U,U+E*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(C.buffer,U,E)}}return j?C.slice():C}function j(C,U,K,O,X,z,j,p){const E=A(K),u=e(K),b=j*U;if(Array.isArray(C)){if(0!==(3&O)||0!==(3&X))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const m=O/4,A=X/4;if(m+(j-1)*A+U>C.length)throw new Error("Last accessed index is out of bounds.");if(A<U)throw new Error("Data stride cannot be smaller than the component size.");if(A!==U){const m=new u(b);return t(C,O,X,U,K,b,z,((C,K)=>{for(let O=0;O<U;O++)m[K+O]=C[O]})),m}return new u(C.slice(m,m+b))}let v,Q=O;C instanceof ArrayBuffer?v=C:(v=C.buffer,Q+=C.byteOffset);if(Q+(j-1)*X+U*E>v.byteLength)throw new Error("Last accessed byte is out of bounds.");const V=U*E;if(X<V)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(X!==V){const C=new u(b);return t(v,Q,X,U,K,b,z,((K,m)=>{for(let O=0;O<U;O++)C[m+O]=K[O]})),C}return 1!==E&&0!==(Q&E-1)&&(m.d.Warn("Array must be aligned to border of element size. Data will be copied."),p=!0),p?new u(v.slice(Q,Q+b*E)):new u(v,Q,b)}function p(C,U,K,O,X,e,z,j){const p=U*A(K),E=z*U;if(j.length!==E)throw new Error("Output length is not valid");if(5126===K&&X===p)if(C instanceof Array){const U=O/4;j.set(C,U)}else if(C instanceof ArrayBuffer){const U=new Float32Array(C,O,E);j.set(U)}else{const U=C.byteOffset+O;if(0!==(3&U))return m.d.Warn("Float array must be aligned to 4-bytes border"),void j.set(new Float32Array(C.buffer.slice(U,U+E*Float32Array.BYTES_PER_ELEMENT)));const K=new Float32Array(C.buffer,U,E);j.set(K)}else t(C,O,X,U,K,E,e,((C,K)=>{for(let m=0;m<U;m++)j[K+m]=C[m]}))}function E(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(C)){for(let O=0;O<U;O++)if(C[K+O]-m>65535)return!0;return!1}return 4===C.BYTES_PER_ELEMENT}},11909:(C,U,K)=>{K.d(U,{e:()=>m});class m{get underlyingResource(){return null}constructor(){this.references=0,this.ye=0,this.is32Bits=!1,this.uniqueId=m._Counter++}}m._Counter=0},11947:(C,U,K)=>{K.d(U,{d:()=>O});var m=K(11733);class O{static GetEffect(C){return void 0===C.getPipelineContext?C.effect:C}constructor(C){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=C.createDrawContext(),U&&(this.materialContext=C.createMaterialContext())}setEffect(C,U){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var m;(this.effect=C,void 0!==U&&(this.defines=U),K)&&(null===(m=this.drawContext)||void 0===m||m.reset())}dispose(){var C;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const C=this.effect;U?C.dispose():m.b.SetImmediate((()=>{C.getEngine().onEndFrameObservable.addOnce((()=>{C.dispose()}))})),this.effect=null}null===(C=this.drawContext)||void 0===C||C.dispose()}}},12036:(C,U,K)=>{K.d(U,{c:()=>O});var m=K(11886);class O{static GetPlanes(C){const U=[];for(let K=0;K<6;K++)U.push(new m.b(0,0,0,0));return O.GetPlanesToRef(C,U),U}static GetNearPlaneToRef(C,U){const K=C.m;U.normal.x=K[3]+K[2],U.normal.y=K[7]+K[6],U.normal.z=K[11]+K[10],U.d=K[15]+K[14],U.normalize()}static GetFarPlaneToRef(C,U){const K=C.m;U.normal.x=K[3]-K[2],U.normal.y=K[7]-K[6],U.normal.z=K[11]-K[10],U.d=K[15]-K[14],U.normalize()}static GetLeftPlaneToRef(C,U){const K=C.m;U.normal.x=K[3]+K[0],U.normal.y=K[7]+K[4],U.normal.z=K[11]+K[8],U.d=K[15]+K[12],U.normalize()}static GetRightPlaneToRef(C,U){const K=C.m;U.normal.x=K[3]-K[0],U.normal.y=K[7]-K[4],U.normal.z=K[11]-K[8],U.d=K[15]-K[12],U.normalize()}static GetTopPlaneToRef(C,U){const K=C.m;U.normal.x=K[3]-K[1],U.normal.y=K[7]-K[5],U.normal.z=K[11]-K[9],U.d=K[15]-K[13],U.normalize()}static GetBottomPlaneToRef(C,U){const K=C.m;U.normal.x=K[3]+K[1],U.normal.y=K[7]+K[5],U.normal.z=K[11]+K[9],U.d=K[15]+K[13],U.normalize()}static GetPlanesToRef(C,U){O.GetNearPlaneToRef(C,U[0]),O.GetFarPlaneToRef(C,U[1]),O.GetLeftPlaneToRef(C,U[2]),O.GetRightPlaneToRef(C,U[3]),O.GetTopPlaneToRef(C,U[4]),O.GetBottomPlaneToRef(C,U[5])}static IsPointInFrustum(C,U){for(let K=0;K<6;K++)if(U[K].dotCoordinate(C)<0)return!1;return!0}}},12053:(C,U,K)=>{K.d(U,{d:()=>O});var m=K(11688);class O{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(C,U){O.Enabled&&(this._current+=C,U&&this._fetchResult())}beginMonitoring(){O.Enabled&&(this._startMonitoringTime=m.c.Now)}endMonitoring(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!O.Enabled)return;C&&this.fetchNewFrame();const U=m.c.Now;this._current=U-this._startMonitoringTime,C&&this._fetchResult()}sA(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const C=m.c.Now;C-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=C,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}O.Enabled=!0},11930:(C,U,K)=>{K.d(U,{b:()=>O,d:()=>m});class m{constructor(C){this.length=0,this.data=new Array(C),this._id=m._GlobalId++}push(C){this.data[this.length++]=C,this.length>this.data.length&&(this.data.length*=2)}forEach(C){for(let U=0;U<this.length;U++)C(this.data[U])}sort(C){this.data.sort(C)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(C){if(0!==C.length){this.length+C.length>this.data.length&&(this.data.length=2*(this.length+C.length));for(let U=0;U<C.length;U++)this.data[this.length++]=(C.data||C)[U]}}indexOf(C){const U=this.data.indexOf(C);return U>=this.length?-1:U}contains(C){return-1!==this.indexOf(C)}}m._GlobalId=0;class O extends m{constructor(){super(...arguments),this._duplicateId=0}push(C){super.push(C),C.__smartArrayFlags||(C.__smartArrayFlags={}),C.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(C){return(!C.__smartArrayFlags||C.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(C),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(C){if(0!==C.length){this.length+C.length>this.data.length&&(this.data.length=2*(this.length+C.length));for(let U=0;U<C.length;U++){const K=(C.data||C)[U];this.pushNoDuplicate(K)}}}}},11900:(C,U,K)=>{K.d(U,{c:()=>X});var m=K(11905),O=K(11663);class X{constructor(C){this._vertexBuffers={},this.onBeforeRenderObservable=new O.b,this._scene=C}_prepareBuffers(){if(this._vertexBuffers[m.d.PositionKind])return;const C=[];C.push(1,1),C.push(-1,1),C.push(-1,-1),C.push(1,-1),this._vertexBuffers[m.d.PositionKind]=new m.d(this._scene.getEngine(),C,m.d.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const C=[];C.push(0),C.push(1),C.push(2),C.push(0),C.push(2),C.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(C)}_rebuild(){const C=this._vertexBuffers[m.d.PositionKind];C&&(C._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const K=this._scene.activeCamera;return!!K&&(U=U||K._postProcesses.filter((C=>null!=C)),!(!U||0===U.length||!this._scene.postProcessesEnabled)&&(U[0].activate(K,C,null!==U&&void 0!==U),!0))}directRender(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]&&arguments[2],m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:C.length;const e=this._scene.getEngine();for(let z=0;z<A;z++){var t;if(z<C.length-1)C[z+1].activate(this._scene.activeCamera||this._scene,null===U||void 0===U?void 0:U.texture);else U?e.bindFramebuffer(U,m,void 0,void 0,K,O):X||e.restoreDefaultFramebuffer(),null===(t=e._debugInsertMarker)||void 0===t||t.call(e,`post process ${C[z].name} output`);const A=C[z],j=A.apply();j&&(A.onBeforeRenderObservable.notifyObservers(j),this._prepareBuffers(),e.bindBuffers(this._vertexBuffers,this._indexBuffer,j),e.drawElementsType(0,0,6),A.onAfterRenderObservable.notifyObservers(j))}e.setDepthBuffer(!0),e.setDepthWrite(!0)}_finalizeFrame(C,U,K,m){let O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const X=this._scene.activeCamera;if(!X)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(m=m||X._postProcesses.filter((C=>null!=C))).length||!this._scene.postProcessesEnabled)return;const A=this._scene.getEngine();for(let t=0,z=m.length;t<z;t++){const j=m[t];var e;if(t<z-1)j._outputTexture=m[t+1].activate(X,null===U||void 0===U?void 0:U.texture);else U?(A.bindFramebuffer(U,K,void 0,void 0,O),j._outputTexture=U):(A.restoreDefaultFramebuffer(),j._outputTexture=null),null===(e=A._debugInsertMarker)||void 0===e||e.call(A,`post process ${m[t].name} output`);if(C)break;const p=j.apply();p&&(j.onBeforeRenderObservable.notifyObservers(p),this._prepareBuffers(),A.bindBuffers(this._vertexBuffers,this._indexBuffer,p),A.drawElementsType(0,0,6),j.onAfterRenderObservable.notifyObservers(p))}A.setDepthBuffer(!0),A.setDepthWrite(!0),A.setAlphaMode(0)}dispose(){const C=this._vertexBuffers[m.d.PositionKind];C&&(C.dispose(),this._vertexBuffers[m.d.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11923:(C,U,K)=>{K.d(U,{b:()=>e});var m=K(11930),O=K(11827);class X{set opaqueSortCompareFn(C){this._opaqueSortCompareFn=C||X.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(C){this._alphaTestSortCompareFn=C||X.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(C){this._transparentSortCompareFn=C||X.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(C,U){let K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=C,this._opaqueSubMeshes=new m.d(256),this._transparentSubMeshes=new m.d(256),this._alphaTestSubMeshes=new m.d(256),this._depthOnlySubMeshes=new m.d(256),this._particleSystems=new m.d(256),this._spriteManagers=new m.d(256),this._empty=!0,this._edgesRenderers=new m.b(16),this._scene=U,this.opaqueSortCompareFn=K,this.alphaTestSortCompareFn=O,this.transparentSortCompareFn=X}render(C,U,K,m){if(C)return void C(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const O=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(O.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),O.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const X=O.getStencilBuffer();if(O.setStencilBuffer(!1),U&&this._renderSprites(),K&&this._renderParticles(m),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(O.setStencilBuffer(X),this._scene.useOrderIndependentTransparency){const C=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);C.length&&this._renderTransparent(C)}else this._renderTransparent(this._transparentSubMeshes);O.setAlphaMode(0)}if(O.setStencilBuffer(!1),this._edgesRenderers.length){for(let C=0;C<this._edgesRenderers.length;C++)this._edgesRenderers.data[C].render();O.setAlphaMode(0)}O.setStencilBuffer(X)}_renderOpaqueSorted(C){X._RenderSorted(C,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(C){X._RenderSorted(C,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(C){X._RenderSorted(C,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(C,U,K,m){let A,e=0;const t=K?K.globalPosition:X._ZeroVector;if(m)for(;e<C.length;e++)A=C.data[e],A._alphaIndex=A.getMesh().alphaIndex,A._distanceToCamera=O.bU.Distance(A.getBoundingInfo().boundingSphere.centerWorld,t);const z=C.length===C.data.length?C.data:C.data.slice(0,C.length);U&&z.sort(U);const j=z[0].getMesh().dC();for(e=0;e<z.length;e++)if(A=z[e],!j._activeMeshesFrozenButKeepClipping||A.isInFrustum(j._frustumPlanes)){if(m){const C=A.kC();if(C&&C.needDepthPrePass){const U=C.dC().getEngine();U.setColorWrite(!1),U.setAlphaMode(0),A.render(!1),U.setColorWrite(!0)}}A.render(m)}}static defaultTransparentSortCompare(C,U){return C._alphaIndex>U._alphaIndex?1:C._alphaIndex<U._alphaIndex?-1:X.backToFrontSortCompare(C,U)}static backToFrontSortCompare(C,U){return C._distanceToCamera<U._distanceToCamera?1:C._distanceToCamera>U._distanceToCamera?-1:0}static frontToBackSortCompare(C,U){return C._distanceToCamera<U._distanceToCamera?-1:C._distanceToCamera>U._distanceToCamera?1:0}static PainterSortCompare(C,U){const K=C.getMesh(),m=U.getMesh();return K.material&&m.material?K.material.uniqueId-m.material.uniqueId:K.uniqueId-m.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(C,U,K){void 0===U&&(U=C.getMesh()),void 0===K&&(K=C.kC()),null!==K&&void 0!==K&&(K.needAlphaBlendingForMesh(U)?this._transparentSubMeshes.push(C):K.needAlphaTestingForMesh(U)?(K.needDepthPrePass&&this._depthOnlySubMeshes.push(C),this._alphaTestSubMeshes.push(C)):(K.needDepthPrePass&&this._depthOnlySubMeshes.push(C),this._opaqueSubMeshes.push(C)),U._renderingGroup=this,U._edgesRenderer&&U.isEnabled()&&U.isVisible&&U._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(U._edgesRenderer),this._empty=!1)}dispatchSprites(C){this._spriteManagers.push(C),this._empty=!1}dispatchParticles(C){this._particleSystems.push(C),this._empty=!1}_renderParticles(C){if(0===this._particleSystems.length)return;const U=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let K=0;K<this._particleSystems.length;K++){const m=this._particleSystems.data[K];if(0===(U&&U.layerMask&m.layerMask))continue;const O=m.mU;O.position&&C&&-1===C.indexOf(O)||this._scene._activeParticles.addCount(m.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const C=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let U=0;U<this._spriteManagers.length;U++){const K=this._spriteManagers.data[U];0!==(C&&C.layerMask&K.layerMask)&&K.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}X._ZeroVector=O.bU.Zero();class A{}class e{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(C){C!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=C,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const C of this._scene.meshes)if(C.me)for(const U of C.me)U._wasDispatched=!1;if(this._scene.spriteManagers)for(const C of this._scene.spriteManagers)C._wasDispatched=!1;for(const C of this._scene.AE)C._wasDispatched=!1}constructor(C){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new A,this._maintainStateBetweenFrames=!1,this._scene=C;for(let U=e.MIN_RENDERINGGROUPS;U<e.MAX_RENDERINGGROUPS;U++)this._autoClearDepthStencil[U]={Ke:!0,depth:!0,stencil:!0}}getRenderingGroup(C){const U=C||0;return this._prepareRenderingGroup(U),this._renderingGroups[U]}_clearDepthStencilBuffer(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,C,U),this._depthStencilBufferAlreadyCleaned=!0)}render(C,U,K,m){const O=this._renderingGroupInfo;if(O.QU=this._scene,O.camera=this._scene.activeCamera,O.renderingManager=this,this._scene.spriteManagers&&m)for(let X=0;X<this._scene.spriteManagers.length;X++){const C=this._scene.spriteManagers[X];this.dispatchSprites(C)}for(let X=e.MIN_RENDERINGGROUPS;X<e.MAX_RENDERINGGROUPS;X++){this._depthStencilBufferAlreadyCleaned=X===e.MIN_RENDERINGGROUPS;const A=this._renderingGroups[X];if(!A||A._empty)continue;const t=1<<X;if(O.renderingGroupId=X,this._scene.onBeforeRenderingGroupObservable.notifyObservers(O,t),e.AUTOCLEAR){const C=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(X):this._autoClearDepthStencil[X];C&&C.Ke&&this._clearDepthStencilBuffer(C.depth,C.stencil)}for(const C of this._scene._beforeRenderingGroupDrawStage)C.action(X);A.render(C,m,K,U);for(const C of this._scene._afterRenderingGroupDrawStage)C.action(X);this._scene.onAfterRenderingGroupObservable.notifyObservers(O,t)}}reset(){if(!this.maintainStateBetweenFrames)for(let C=e.MIN_RENDERINGGROUPS;C<e.MAX_RENDERINGGROUPS;C++){const U=this._renderingGroups[C];U&&U.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let C=e.MIN_RENDERINGGROUPS;C<e.MAX_RENDERINGGROUPS;C++){const U=this._renderingGroups[C];U&&U.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let C=e.MIN_RENDERINGGROUPS;C<e.MAX_RENDERINGGROUPS;C++){const U=this._renderingGroups[C];U&&U.dispose()}}_prepareRenderingGroup(C){void 0===this._renderingGroups[C]&&(this._renderingGroups[C]=new X(C,this._scene,this._customOpaqueSortCompareFn[C],this._customAlphaTestSortCompareFn[C],this._customTransparentSortCompareFn[C]))}dispatchSprites(C){this.maintainStateBetweenFrames&&C._wasDispatched||(C._wasDispatched=!0,this.getRenderingGroup(C.renderingGroupId).dispatchSprites(C))}dispatchParticles(C){this.maintainStateBetweenFrames&&C._wasDispatched||(C._wasDispatched=!0,this.getRenderingGroup(C.renderingGroupId).dispatchParticles(C))}dispatch(C,U,K){void 0===U&&(U=C.getMesh()),this.maintainStateBetweenFrames&&C._wasDispatched||(C._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatch(C,U,K))}setRenderingOrder(C){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,K=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[C]=U,this._customAlphaTestSortCompareFn[C]=K,this._customTransparentSortCompareFn[C]=m,this._renderingGroups[C]){const U=this._renderingGroups[C];U.opaqueSortCompareFn=this._customOpaqueSortCompareFn[C],U.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[C],U.transparentSortCompareFn=this._customTransparentSortCompareFn[C]}}setRenderingAutoClearDepthStencil(C,U){let K=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],m=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[C]={Ke:U,depth:K,stencil:m}}getAutoClearDepthStencilSetup(C){return this._autoClearDepthStencil[C]}}e.MAX_RENDERINGGROUPS=4,e.MIN_RENDERINGGROUPS=0,e.AUTOCLEAR=!0}}]);