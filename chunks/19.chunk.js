"use strict";(self["2fwzcez286e"]=self["2fwzcez286e"]||[]).push([[19],{13047:(B,u,F)=>{F.d(u,{b:()=>G,f:()=>R});var Z=F(13055),V=F(12822),p=F(13064);class G{get G(){return this._isDisposed}constructor(B,u,F){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,B&&B.yB?this._engine=B.yB().getEngine():this._engine=B,this._updatable=F,this._instanced=G,this._divisor=e||1,this._label=s,u instanceof Z.d?(this._data=null,this._buffer=u):(this._data=u,this._buffer=null),this.byteStride=R?V:V*Float32Array.BYTES_PER_ELEMENT,p||this.create()}createVertexBuffer(B,u,F,Z,V){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6?arguments[6]:void 0;const e=p?u:u*Float32Array.BYTES_PER_ELEMENT,s=Z?p?Z:Z*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new R(this._engine,this,B,this._updatable,!0,s,void 0===V?this._instanced:V,e,F,void 0,void 0,!0,this._divisor||G)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!B&&this._buffer||(B=B||this._data,B&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,B),this._data=B):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(B,this._label),this._data=B):this._buffer=this._engine.createVertexBuffer(B,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.xu>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.xu,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.xu,void 0,this._label));V.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(B){this.create(B)}updateDirectly(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,B,Z?u:u*Float32Array.BYTES_PER_ELEMENT,F?F*this.byteStride:void 0),this._data=0===u&&void 0===F?B:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class R{get G(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(B){const u=0!=B;this._instanceDivisor=B,u!==this._instanced&&(this._instanced=u,this._computeHashCode())}get _maxVerticesCount(){const B=this.getData();return B?Array.isArray(B)?B.length/(this.byteStride/4)-this.byteOffset/4:(B.byteLength-this.byteOffset)/this.byteStride:0}constructor(B,u,F,Z,V,e,s,Y,Q,t){let v=arguments.length>10&&void 0!==arguments[10]&&arguments[10],D=arguments.length>11&&void 0!==arguments[11]&&arguments[11],L=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,q=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let W=!1;if(this.vu=B,"object"===typeof Z&&null!==Z?(W=Z.updatable??!1,V=Z.postponeInternalCreation,e=Z.stride,s=Z.instanced,Y=Z.offset,Q=Z.size,t=Z.type,v=Z.normalized??!1,D=Z.useBytes??!1,L=Z.divisor??1,q=Z.takeBufferOwnership??!1,this._label=Z.label):W=!!Z,u instanceof G?(this._buffer=u,this._ownsBuffer=q):(this._buffer=new G(B,u,W,e,V,s,D,L,this._label),this._ownsBuffer=!0),this.uniqueId=R._Counter++,this._kind=F,void 0===t){const B=this.getData();this.type=B?R.GetDataType(B):R.FLOAT}else this.type=t;const X=(0,p.k)(this.type);D?(this._size=Q||(e?e/X:R.DeduceStride(F)),this.byteStride=e||this._buffer.byteStride||this._size*X,this.byteOffset=Y||0):(this._size=Q||e||R.DeduceStride(F),this.byteStride=e?e*X:this._buffer.byteStride||this._size*X,this.byteOffset=(Y||0)*X),this.normalized=v,this._instanced=void 0!==s&&s,this._instanceDivisor=s?L:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var B;null===(B=this._buffer)||void 0===B||B._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(B,u){const F=this.getData();return F?(0,p.j)(F,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,B,u):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,p.k)(this.type)}getOffset(){return this.byteOffset/(0,p.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,p.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(B){this._buffer.create(B),this._alignBuffer()}update(B){this._buffer.update(B),this._alignBuffer()}updateDirectly(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(B,u,void 0,F),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(B,u){(0,p.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,B,this.normalized,((B,F)=>{for(let Z=0;Z<this._size;Z++)u(B[Z],F+Z)}))}_alignBuffer(){}static DeduceStride(B){switch(B){case R.UVKind:case R.UV2Kind:case R.UV3Kind:case R.UV4Kind:case R.UV5Kind:case R.UV6Kind:return 2;case R.NormalKind:case R.PositionKind:return 3;case R.ColorKind:case R.ColorInstanceKind:case R.MatricesIndicesKind:case R.MatricesIndicesExtraKind:case R.MatricesWeightsKind:case R.MatricesWeightsExtraKind:case R.TangentKind:return 4;default:throw new Error("Invalid kind '"+B+"'")}}static GetDataType(B){return B instanceof Int8Array?R.BYTE:B instanceof Uint8Array?R.UNSIGNED_BYTE:B instanceof Int16Array?R.SHORT:B instanceof Uint16Array?R.UNSIGNED_SHORT:B instanceof Int32Array?R.INT:B instanceof Uint32Array?R.UNSIGNED_INT:R.FLOAT}static GetTypeByteLength(B){return(0,p.k)(B)}static ForEach(B,u,F,Z,V,G,R,e){(0,p.h)(B,u,F,Z,V,G,R,((B,u)=>{for(let F=0;F<Z;F++)e(B[F],u+F)}))}static GetFloatData(B,u,F,Z,V,G,R,e){return(0,p.j)(B,u,F,Z,V,G,R,e)}}R._Counter=0,R.BYTE=5120,R.UNSIGNED_BYTE=5121,R.SHORT=5122,R.UNSIGNED_SHORT=5123,R.INT=5124,R.UNSIGNED_INT=5125,R.FLOAT=5126,R.PositionKind="position",R.NormalKind="normal",R.TangentKind="tangent",R.UVKind="uv",R.UV2Kind="uv2",R.UV3Kind="uv3",R.UV4Kind="uv4",R.UV5Kind="uv5",R.UV6Kind="uv6",R.ColorKind="color",R.ColorInstanceKind="instanceColor",R.MatricesIndicesKind="matricesIndices",R.MatricesWeightsKind="matricesWeights",R.MatricesIndicesExtraKind="matricesIndicesExtra",R.MatricesWeightsExtraKind="matricesWeightsExtra"},13064:(B,u,F)=>{F.d(u,{b:()=>t,f:()=>Q,h:()=>e,j:()=>s,k:()=>G,l:()=>R,p:()=>Y});var Z=F(12822);function V(B,u,F,Z){switch(u){case 5120:{let u=B.getInt8(F);return Z&&(u=Math.max(u/127,-1)),u}case 5121:{let u=B.getUint8(F);return Z&&(u/=255),u}case 5122:{let u=B.getInt16(F,!0);return Z&&(u=Math.max(u/32767,-1)),u}case 5123:{let u=B.getUint16(F,!0);return Z&&(u/=65535),u}case 5124:return B.getInt32(F,!0);case 5125:return B.getUint32(F,!0);case 5126:return B.getFloat32(F,!0);default:throw new Error(`Invalid component type ${u}`)}}function p(B,u,F,Z,V){switch(u){case 5120:Z&&(V=Math.round(127*V)),B.setInt8(F,V);break;case 5121:Z&&(V=Math.round(255*V)),B.setUint8(F,V);break;case 5122:Z&&(V=Math.round(32767*V)),B.setInt16(F,V,!0);break;case 5123:Z&&(V=Math.round(65535*V)),B.setUint16(F,V,!0);break;case 5124:B.setInt32(F,V,!0);break;case 5125:B.setUint32(F,V,!0);break;case 5126:B.setFloat32(F,V,!0);break;default:throw new Error(`Invalid component type ${u}`)}}function G(B){switch(B){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${B}'`)}}function R(B){switch(B){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${B}'`)}}function e(B,u,F,Z,R,e,s,Y){const Q=new Array(Z),t=new Array(Z);if(B instanceof Array){let V=u/4;const p=F/4;for(let u=0;u<e;u+=Z){for(let u=0;u<Z;u++)Q[u]=t[u]=B[V+u];Y(t,u);for(let u=0;u<Z;u++)Q[u]!==t[u]&&(B[V+u]=t[u]);V+=p}}else{const v=ArrayBuffer.isView(B)?new DataView(B.buffer,B.byteOffset,B.byteLength):new DataView(B),D=G(R);for(let B=0;B<e;B+=Z){for(let B=0,F=u;B<Z;B++,F+=D)Q[B]=t[B]=V(v,R,F,s);Y(t,B);for(let B=0,F=u;B<Z;B++,F+=D)Q[B]!==t[B]&&p(v,R,F,s,t[B]);u+=F}}}function s(B,u,F,V,p,R,s,Y){const Q=u*G(F),t=s*u;if(5126!==F||p!==Q){const Z=new Float32Array(t);return e(B,V,p,u,F,t,R,((B,F)=>{for(let V=0;V<u;V++)Z[F+V]=B[V]})),Z}if(!(B instanceof Array||B instanceof Float32Array)||0!==V||B.length!==t){if(B instanceof Array){const u=V/4;return B.slice(u,u+t)}if(B instanceof ArrayBuffer)return new Float32Array(B,V,t);{const u=B.byteOffset+V;return 0!==(3&u)&&(Z.d.Warn("Float array must be aligned to 4-bytes border"),Y=!0),Y?new Float32Array(B.buffer.slice(u,u+t*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(B.buffer,u,t)}}return Y?B.slice():B}function Y(B,u,F,V,p,s,Y,Q){const t=G(F),v=R(F),D=Y*u;if(Array.isArray(B)){if(0!==(3&V)||0!==(3&p))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const Z=V/4,G=p/4;if(Z+(Y-1)*G+u>B.length)throw new Error("Last accessed index is out of bounds.");if(G<u)throw new Error("Data stride cannot be smaller than the component size.");if(G!==u){const Z=new v(D);return e(B,V,p,u,F,D,s,((B,F)=>{for(let V=0;V<u;V++)Z[F+V]=B[V]})),Z}return new v(B.slice(Z,Z+D))}let L,q=V;B instanceof ArrayBuffer?L=B:(L=B.buffer,q+=B.byteOffset);if(q+(Y-1)*p+u*t>L.byteLength)throw new Error("Last accessed byte is out of bounds.");const W=u*t;if(p<W)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(p!==W){const B=new v(D);return e(L,q,p,u,F,D,s,((F,Z)=>{for(let V=0;V<u;V++)B[Z+V]=F[V]})),B}return 1!==t&&0!==(q&t-1)&&(Z.d.Warn("Array must be aligned to border of element size. Data will be copied."),Q=!0),Q?new v(L.slice(q,q+D*t)):new v(L,q,D)}function Q(B,u,F,V,p,R,s,Y){const Q=u*G(F),t=s*u;if(Y.length!==t)throw new Error("Output length is not valid");if(5126===F&&p===Q)if(B instanceof Array){const u=V/4;Y.set(B,u)}else if(B instanceof ArrayBuffer){const u=new Float32Array(B,V,t);Y.set(u)}else{const u=B.byteOffset+V;if(0!==(3&u))return Z.d.Warn("Float array must be aligned to 4-bytes border"),void Y.set(new Float32Array(B.buffer.slice(u,u+t*Float32Array.BYTES_PER_ELEMENT)));const F=new Float32Array(B.buffer,u,t);Y.set(F)}else e(B,V,p,u,F,t,R,((B,F)=>{for(let Z=0;Z<u;Z++)Y[F+Z]=B[Z]}))}function t(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(B)){for(let V=0;V<u;V++)if(B[F+V]-Z>65535)return!0;return!1}return 4===B.BYTES_PER_ELEMENT}},13055:(B,u,F)=>{F.d(u,{d:()=>Z});class Z{get underlyingResource(){return null}constructor(){this.references=0,this.xu=0,this.is32Bits=!1,this.uniqueId=Z._Counter++}}Z._Counter=0},13094:(B,u,F)=>{F.d(u,{b:()=>V});var Z=F(12882);class V{static GetEffect(B){return void 0===B.getPipelineContext?B.effect:B}constructor(B){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=B.createDrawContext(),u&&(this.materialContext=B.createMaterialContext())}setEffect(B,u){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var Z;(this.effect=B,void 0!==u&&(this.defines=u),F)&&(null===(Z=this.drawContext)||void 0===Z||Z.reset())}dispose(){var B;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const B=this.effect;u?B.dispose():Z.b.SetImmediate((()=>{B.getEngine().onEndFrameObservable.addOnce((()=>{B.dispose()}))})),this.effect=null}null===(B=this.drawContext)||void 0===B||B.dispose()}}},13194:(B,u,F)=>{F.d(u,{b:()=>V});var Z=F(13029);class V{static GetPlanes(B){const u=[];for(let F=0;F<6;F++)u.push(new Z.b(0,0,0,0));return V.GetPlanesToRef(B,u),u}static GetNearPlaneToRef(B,u){const F=B.m;u.normal.x=F[3]+F[2],u.normal.y=F[7]+F[6],u.normal.z=F[11]+F[10],u.d=F[15]+F[14],u.normalize()}static GetFarPlaneToRef(B,u){const F=B.m;u.normal.x=F[3]-F[2],u.normal.y=F[7]-F[6],u.normal.z=F[11]-F[10],u.d=F[15]-F[14],u.normalize()}static GetLeftPlaneToRef(B,u){const F=B.m;u.normal.x=F[3]+F[0],u.normal.y=F[7]+F[4],u.normal.z=F[11]+F[8],u.d=F[15]+F[12],u.normalize()}static GetRightPlaneToRef(B,u){const F=B.m;u.normal.x=F[3]-F[0],u.normal.y=F[7]-F[4],u.normal.z=F[11]-F[8],u.d=F[15]-F[12],u.normalize()}static GetTopPlaneToRef(B,u){const F=B.m;u.normal.x=F[3]-F[1],u.normal.y=F[7]-F[5],u.normal.z=F[11]-F[9],u.d=F[15]-F[13],u.normalize()}static GetBottomPlaneToRef(B,u){const F=B.m;u.normal.x=F[3]+F[1],u.normal.y=F[7]+F[5],u.normal.z=F[11]+F[9],u.d=F[15]+F[13],u.normalize()}static GetPlanesToRef(B,u){V.GetNearPlaneToRef(B,u[0]),V.GetFarPlaneToRef(B,u[1]),V.GetLeftPlaneToRef(B,u[2]),V.GetRightPlaneToRef(B,u[3]),V.GetTopPlaneToRef(B,u[4]),V.GetBottomPlaneToRef(B,u[5])}static IsPointInFrustum(B,u){for(let F=0;F<6;F++)if(u[F].dotCoordinate(B)<0)return!1;return!0}}},13202:(B,u,F)=>{F.d(u,{b:()=>V});var Z=F(12834);class V{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(B,u){V.Enabled&&(this._current+=B,u&&this._fetchResult())}beginMonitoring(){V.Enabled&&(this._startMonitoringTime=Z.b.Now)}endMonitoring(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!V.Enabled)return;B&&this.fetchNewFrame();const u=Z.b.Now;this._current=u-this._startMonitoringTime,B&&this._fetchResult()}pR(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const B=Z.b.Now;B-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=B,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}V.Enabled=!0},13072:(B,u,F)=>{F.d(u,{e:()=>V,h:()=>Z});class Z{constructor(B){this.length=0,this.data=new Array(B),this._id=Z._GlobalId++}push(B){this.data[this.length++]=B,this.length>this.data.length&&(this.data.length*=2)}forEach(B){for(let u=0;u<this.length;u++)B(this.data[u])}sort(B){this.data.sort(B)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(B){if(0!==B.length){this.length+B.length>this.data.length&&(this.data.length=2*(this.length+B.length));for(let u=0;u<B.length;u++)this.data[this.length++]=(B.data||B)[u]}}indexOf(B){const u=this.data.indexOf(B);return u>=this.length?-1:u}contains(B){return-1!==this.indexOf(B)}}Z._GlobalId=0;class V extends Z{constructor(){super(...arguments),this._duplicateId=0}push(B){super.push(B),B.__smartArrayFlags||(B.__smartArrayFlags={}),B.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(B){return(!B.__smartArrayFlags||B.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(B),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(B){if(0!==B.length){this.length+B.length>this.data.length&&(this.data.length=2*(this.length+B.length));for(let u=0;u<B.length;u++){const F=(B.data||B)[u];this.pushNoDuplicate(F)}}}}},13041:(B,u,F)=>{F.d(u,{b:()=>p});var Z=F(13047),V=F(12807);class p{constructor(B){this._vertexBuffers={},this.onBeforeRenderObservable=new V.b,this._scene=B}_prepareBuffers(){if(this._vertexBuffers[Z.f.PositionKind])return;const B=[];B.push(1,1),B.push(-1,1),B.push(-1,-1),B.push(1,-1),this._vertexBuffers[Z.f.PositionKind]=new Z.f(this._scene.getEngine(),B,Z.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const B=[];B.push(0),B.push(1),B.push(2),B.push(0),B.push(2),B.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(B)}_rebuild(){const B=this._vertexBuffers[Z.f.PositionKind];B&&(B._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=this._scene.activeCamera;return!!F&&(u=u||F._postProcesses.filter((B=>null!=B)),!(!u||0===u.length||!this._scene.postProcessesEnabled)&&(u[0].activate(F,B,null!==u&&void 0!==u),!0))}directRender(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.length;const R=this._scene.getEngine();for(let s=0;s<G;s++){var e;if(s<B.length-1)B[s+1].activate(this._scene.activeCamera||this._scene,null===u||void 0===u?void 0:u.texture);else u?R.bindFramebuffer(u,Z,void 0,void 0,F,V):p||R.restoreDefaultFramebuffer(),null===(e=R._debugInsertMarker)||void 0===e||e.call(R,`post process ${B[s].name} output`);const G=B[s],Y=G.apply();Y&&(G.onBeforeRenderObservable.notifyObservers(Y),this._prepareBuffers(),R.bindBuffers(this._vertexBuffers,this._indexBuffer,Y),R.drawElementsType(0,0,6),G.onAfterRenderObservable.notifyObservers(Y))}R.setDepthBuffer(!0),R.setDepthWrite(!0)}_finalizeFrame(B,u,F,Z){let V=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const p=this._scene.activeCamera;if(!p)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(Z=Z||p._postProcesses.filter((B=>null!=B))).length||!this._scene.postProcessesEnabled)return;const G=this._scene.getEngine();for(let e=0,s=Z.length;e<s;e++){const Y=Z[e];var R;if(e<s-1)Y._outputTexture=Z[e+1].activate(p,null===u||void 0===u?void 0:u.texture);else u?(G.bindFramebuffer(u,F,void 0,void 0,V),Y._outputTexture=u):(G.restoreDefaultFramebuffer(),Y._outputTexture=null),null===(R=G._debugInsertMarker)||void 0===R||R.call(G,`post process ${Z[e].name} output`);if(B)break;const Q=Y.apply();Q&&(Y.onBeforeRenderObservable.notifyObservers(Q),this._prepareBuffers(),G.bindBuffers(this._vertexBuffers,this._indexBuffer,Q),G.drawElementsType(0,0,6),Y.onAfterRenderObservable.notifyObservers(Q))}G.setDepthBuffer(!0),G.setDepthWrite(!0),G.setAlphaMode(0)}dispose(){const B=this._vertexBuffers[Z.f.PositionKind];B&&(B.dispose(),this._vertexBuffers[Z.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},13070:(B,u,F)=>{F.d(u,{c:()=>R});var Z=F(13072),V=F(12979);class p{set opaqueSortCompareFn(B){this._opaqueSortCompareFn=B||p.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(B){this._alphaTestSortCompareFn=B||p.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(B){this._transparentSortCompareFn=B||p.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=B,this._opaqueSubMeshes=new Z.h(256),this._transparentSubMeshes=new Z.h(256),this._alphaTestSubMeshes=new Z.h(256),this._depthOnlySubMeshes=new Z.h(256),this._particleSystems=new Z.h(256),this._spriteManagers=new Z.h(256),this._empty=!0,this._edgesRenderers=new Z.e(16),this._scene=u,this.opaqueSortCompareFn=F,this.alphaTestSortCompareFn=V,this.transparentSortCompareFn=p}render(B,u,F,Z){if(B)return void B(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const V=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(V.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),V.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const p=V.getStencilBuffer();if(V.setStencilBuffer(!1),u&&this._renderSprites(),F&&this._renderParticles(Z),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(V.setStencilBuffer(p),this._scene.useOrderIndependentTransparency){const B=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);B.length&&this._renderTransparent(B)}else this._renderTransparent(this._transparentSubMeshes);V.setAlphaMode(0)}if(V.setStencilBuffer(!1),this._edgesRenderers.length){for(let B=0;B<this._edgesRenderers.length;B++)this._edgesRenderers.data[B].render();V.setAlphaMode(0)}V.setStencilBuffer(p)}_renderOpaqueSorted(B){p._RenderSorted(B,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(B){p._RenderSorted(B,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(B){p._RenderSorted(B,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(B,u,F,Z){let G,R=0;const e=F?F.globalPosition:p._ZeroVector;if(Z)for(;R<B.length;R++)G=B.data[R],G._alphaIndex=G.getMesh().alphaIndex,G._distanceToCamera=V.Du.Distance(G.getBoundingInfo().boundingSphere.centerWorld,e);const s=B.length===B.data.length?B.data:B.data.slice(0,B.length);u&&s.sort(u);const Y=s[0].getMesh().yB();for(R=0;R<s.length;R++)if(G=s[R],!Y._activeMeshesFrozenButKeepClipping||G.isInFrustum(Y._frustumPlanes)){if(Z){const B=G.EB();if(B&&B.needDepthPrePass){const u=B.yB().getEngine();u.setColorWrite(!1),u.setAlphaMode(0),G.render(!1),u.setColorWrite(!0)}}G.render(Z)}}static defaultTransparentSortCompare(B,u){return B._alphaIndex>u._alphaIndex?1:B._alphaIndex<u._alphaIndex?-1:p.backToFrontSortCompare(B,u)}static backToFrontSortCompare(B,u){return B._distanceToCamera<u._distanceToCamera?1:B._distanceToCamera>u._distanceToCamera?-1:0}static frontToBackSortCompare(B,u){return B._distanceToCamera<u._distanceToCamera?-1:B._distanceToCamera>u._distanceToCamera?1:0}static PainterSortCompare(B,u){const F=B.getMesh(),Z=u.getMesh();return F.material&&Z.material?F.material.uniqueId-Z.material.uniqueId:F.uniqueId-Z.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(B,u,F){void 0===u&&(u=B.getMesh()),void 0===F&&(F=B.EB()),null!==F&&void 0!==F&&(F.needAlphaBlendingForMesh(u)?this._transparentSubMeshes.push(B):F.needAlphaTestingForMesh(u)?(F.needDepthPrePass&&this._depthOnlySubMeshes.push(B),this._alphaTestSubMeshes.push(B)):(F.needDepthPrePass&&this._depthOnlySubMeshes.push(B),this._opaqueSubMeshes.push(B)),u._renderingGroup=this,u._edgesRenderer&&u.isEnabled()&&u.isVisible&&u._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(u._edgesRenderer),this._empty=!1)}dispatchSprites(B){this._spriteManagers.push(B),this._empty=!1}dispatchParticles(B){this._particleSystems.push(B),this._empty=!1}_renderParticles(B){if(0===this._particleSystems.length)return;const u=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let F=0;F<this._particleSystems.length;F++){const Z=this._particleSystems.data[F];if(0===(u&&u.layerMask&Z.layerMask))continue;const V=Z.Zu;V.position&&B&&-1===B.indexOf(V)||this._scene._activeParticles.addCount(Z.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const B=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let u=0;u<this._spriteManagers.length;u++){const F=this._spriteManagers.data[u];0!==(B&&B.layerMask&F.layerMask)&&F.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}p._ZeroVector=V.Du.Zero();class G{}class R{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(B){B!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=B,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const B of this._scene.meshes)if(B.vR)for(const u of B.vR)u._wasDispatched=!1;if(this._scene.spriteManagers)for(const B of this._scene.spriteManagers)B._wasDispatched=!1;for(const B of this._scene.xt)B._wasDispatched=!1}constructor(B){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new G,this._maintainStateBetweenFrames=!1,this._scene=B;for(let u=R.MIN_RENDERINGGROUPS;u<R.MAX_RENDERINGGROUPS;u++)this._autoClearDepthStencil[u]={tR:!0,depth:!0,RR:!0}}getRenderingGroup(B){const u=B||0;return this._prepareRenderingGroup(u),this._renderingGroups[u]}_clearDepthStencilBuffer(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,B,u),this._depthStencilBufferAlreadyCleaned=!0)}render(B,u,F,Z){const V=this._renderingGroupInfo;if(V.qu=this._scene,V.camera=this._scene.activeCamera,V.renderingManager=this,this._scene.spriteManagers&&Z)for(let p=0;p<this._scene.spriteManagers.length;p++){const B=this._scene.spriteManagers[p];this.dispatchSprites(B)}for(let p=R.MIN_RENDERINGGROUPS;p<R.MAX_RENDERINGGROUPS;p++){this._depthStencilBufferAlreadyCleaned=p===R.MIN_RENDERINGGROUPS;const G=this._renderingGroups[p];if(!G||G._empty)continue;const e=1<<p;if(V.renderingGroupId=p,this._scene.onBeforeRenderingGroupObservable.notifyObservers(V,e),R.AUTOCLEAR){const B=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(p):this._autoClearDepthStencil[p];B&&B.tR&&this._clearDepthStencilBuffer(B.depth,B.RR)}for(const B of this._scene._beforeRenderingGroupDrawStage)B.action(p);G.render(B,Z,F,u);for(const B of this._scene._afterRenderingGroupDrawStage)B.action(p);this._scene.onAfterRenderingGroupObservable.notifyObservers(V,e)}}reset(){if(!this.maintainStateBetweenFrames)for(let B=R.MIN_RENDERINGGROUPS;B<R.MAX_RENDERINGGROUPS;B++){const u=this._renderingGroups[B];u&&u.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let B=R.MIN_RENDERINGGROUPS;B<R.MAX_RENDERINGGROUPS;B++){const u=this._renderingGroups[B];u&&u.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let B=R.MIN_RENDERINGGROUPS;B<R.MAX_RENDERINGGROUPS;B++){const u=this._renderingGroups[B];u&&u.dispose()}}_prepareRenderingGroup(B){void 0===this._renderingGroups[B]&&(this._renderingGroups[B]=new p(B,this._scene,this._customOpaqueSortCompareFn[B],this._customAlphaTestSortCompareFn[B],this._customTransparentSortCompareFn[B]))}dispatchSprites(B){this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(B.renderingGroupId).dispatchSprites(B))}dispatchParticles(B){this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(B.renderingGroupId).dispatchParticles(B))}dispatch(B,u,F){void 0===u&&(u=B.getMesh()),this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(u.renderingGroupId).dispatch(B,u,F))}setRenderingOrder(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[B]=u,this._customAlphaTestSortCompareFn[B]=F,this._customTransparentSortCompareFn[B]=Z,this._renderingGroups[B]){const u=this._renderingGroups[B];u.opaqueSortCompareFn=this._customOpaqueSortCompareFn[B],u.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[B],u.transparentSortCompareFn=this._customTransparentSortCompareFn[B]}}setRenderingAutoClearDepthStencil(B,u){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[B]={tR:u,depth:F,RR:Z}}getAutoClearDepthStencilSetup(B){return this._autoClearDepthStencil[B]}}R.MAX_RENDERINGGROUPS=4,R.MIN_RENDERINGGROUPS=0,R.AUTOCLEAR=!0}}]);