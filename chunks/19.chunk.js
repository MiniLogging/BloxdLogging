"use strict";(self.zy41qorie9=self.zy41qorie9||[]).push([[19],{12530:(Z,l,C)=>{C.d(l,{d:()=>K,h:()=>f});var B=C(12538),x=C(12263),b=C(12544);class K{get J(){return this._isDisposed}constructor(Z,l,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]&&arguments[4],K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,Z&&Z.cZ?this._engine=Z.cZ().getEngine():this._engine=Z,this._updatable=C,this._instanced=K,this._divisor=W||1,this._label=J,l instanceof B.b?(this._data=null,this._buffer=l):(this._data=l,this._buffer=null),this.byteStride=f?x:x*Float32Array.BYTES_PER_ELEMENT,b||this.create()}createVertexBuffer(Z,l,C,B,x){let b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6?arguments[6]:void 0;const W=b?l:l*Float32Array.BYTES_PER_ELEMENT,J=B?b?B:B*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new f(this._engine,this,Z,this._updatable,!0,J,void 0===x?this._instanced:x,W,C,void 0,void 0,!0,this._divisor||K)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!Z&&this._buffer||(Z=Z||this._data,Z&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z),this._data=Z):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(Z,this._label),this._data=Z):this._buffer=this._engine.createVertexBuffer(Z,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Ml>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Ml,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Ml,void 0,this._label));x.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(Z){this.create(Z)}updateDirectly(Z,l,C){let B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z,B?l:l*Float32Array.BYTES_PER_ELEMENT,C?C*this.byteStride:void 0),this._data=0===l&&void 0===C?Z:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class f{get J(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(Z){const l=0!=Z;this._instanceDivisor=Z,l!==this._instanced&&(this._instanced=l,this._computeHashCode())}get _maxVerticesCount(){const Z=this.getData();return Z?Array.isArray(Z)?Z.length/(this.byteStride/4)-this.byteOffset/4:(Z.byteLength-this.byteOffset)/this.byteStride:0}constructor(Z,l,C,B,x,W,J,d,E,G){let a=arguments.length>10&&void 0!==arguments[10]&&arguments[10],q=arguments.length>11&&void 0!==arguments[11]&&arguments[11],z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,Y=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let P=!1;if(this.al=Z,"object"===typeof B&&null!==B?(P=B.updatable??!1,x=B.postponeInternalCreation,W=B.stride,J=B.instanced,d=B.offset,E=B.size,G=B.type,a=B.normalized??!1,q=B.useBytes??!1,z=B.divisor??1,Y=B.takeBufferOwnership??!1,this._label=B.label):P=!!B,l instanceof K?(this._buffer=l,this._ownsBuffer=Y):(this._buffer=new K(Z,l,P,W,x,J,q,z,this._label),this._ownsBuffer=!0),this.uniqueId=f._Counter++,this._kind=C,void 0===G){const Z=this.getData();this.type=Z?f.GetDataType(Z):f.FLOAT}else this.type=G;const S=(0,b.m)(this.type);q?(this._size=E||(W?W/S:f.DeduceStride(C)),this.byteStride=W||this._buffer.byteStride||this._size*S,this.byteOffset=d||0):(this._size=E||W||f.DeduceStride(C),this.byteStride=W?W*S:this._buffer.byteStride||this._size*S,this.byteOffset=(d||0)*S),this.normalized=a,this._instanced=void 0!==J&&J,this._instanceDivisor=J?z:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var Z;null===(Z=this._buffer)||void 0===Z||Z._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(Z,l){const C=this.getData();return C?(0,b.k)(C,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,Z,l):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,b.m)(this.type)}getOffset(){return this.byteOffset/(0,b.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,b.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(Z){this._buffer.create(Z),this._alignBuffer()}update(Z){this._buffer.update(Z),this._alignBuffer()}updateDirectly(Z,l){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(Z,l,void 0,C),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(Z,l){(0,b.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,Z,this.normalized,((Z,C)=>{for(let B=0;B<this._size;B++)l(Z[B],C+B)}))}_alignBuffer(){}static DeduceStride(Z){switch(Z){case f.UVKind:case f.UV2Kind:case f.UV3Kind:case f.UV4Kind:case f.UV5Kind:case f.UV6Kind:return 2;case f.NormalKind:case f.PositionKind:return 3;case f.ColorKind:case f.ColorInstanceKind:case f.MatricesIndicesKind:case f.MatricesIndicesExtraKind:case f.MatricesWeightsKind:case f.MatricesWeightsExtraKind:case f.TangentKind:return 4;default:throw new Error("Invalid kind '"+Z+"'")}}static GetDataType(Z){return Z instanceof Int8Array?f.BYTE:Z instanceof Uint8Array?f.UNSIGNED_BYTE:Z instanceof Int16Array?f.SHORT:Z instanceof Uint16Array?f.UNSIGNED_SHORT:Z instanceof Int32Array?f.INT:Z instanceof Uint32Array?f.UNSIGNED_INT:f.FLOAT}static GetTypeByteLength(Z){return(0,b.m)(Z)}static ForEach(Z,l,C,B,x,K,f,W){(0,b.g)(Z,l,C,B,x,K,f,((Z,l)=>{for(let C=0;C<B;C++)W(Z[C],l+C)}))}static GetFloatData(Z,l,C,B,x,K,f,W){return(0,b.k)(Z,l,C,B,x,K,f,W)}}f._Counter=0,f.BYTE=5120,f.UNSIGNED_BYTE=5121,f.SHORT=5122,f.UNSIGNED_SHORT=5123,f.INT=5124,f.UNSIGNED_INT=5125,f.FLOAT=5126,f.PositionKind="position",f.NormalKind="normal",f.TangentKind="tangent",f.UVKind="uv",f.UV2Kind="uv2",f.UV3Kind="uv3",f.UV4Kind="uv4",f.UV5Kind="uv5",f.UV6Kind="uv6",f.ColorKind="color",f.ColorInstanceKind="instanceColor",f.MatricesIndicesKind="matricesIndices",f.MatricesWeightsKind="matricesWeights",f.MatricesIndicesExtraKind="matricesIndicesExtra",f.MatricesWeightsExtraKind="matricesWeightsExtra"},12544:(Z,l,C)=>{C.d(l,{b:()=>G,e:()=>E,g:()=>W,k:()=>J,m:()=>K,n:()=>f,p:()=>d});var B=C(12263);function x(Z,l,C,B){switch(l){case 5120:{let l=Z.getInt8(C);return B&&(l=Math.max(l/127,-1)),l}case 5121:{let l=Z.getUint8(C);return B&&(l/=255),l}case 5122:{let l=Z.getInt16(C,!0);return B&&(l=Math.max(l/32767,-1)),l}case 5123:{let l=Z.getUint16(C,!0);return B&&(l/=65535),l}case 5124:return Z.getInt32(C,!0);case 5125:return Z.getUint32(C,!0);case 5126:return Z.getFloat32(C,!0);default:throw new Error(`Invalid component type ${l}`)}}function b(Z,l,C,B,x){switch(l){case 5120:B&&(x=Math.round(127*x)),Z.setInt8(C,x);break;case 5121:B&&(x=Math.round(255*x)),Z.setUint8(C,x);break;case 5122:B&&(x=Math.round(32767*x)),Z.setInt16(C,x,!0);break;case 5123:B&&(x=Math.round(65535*x)),Z.setUint16(C,x,!0);break;case 5124:Z.setInt32(C,x,!0);break;case 5125:Z.setUint32(C,x,!0);break;case 5126:Z.setFloat32(C,x,!0);break;default:throw new Error(`Invalid component type ${l}`)}}function K(Z){switch(Z){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${Z}'`)}}function f(Z){switch(Z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${Z}'`)}}function W(Z,l,C,B,f,W,J,d){const E=new Array(B),G=new Array(B);if(Z instanceof Array){let x=l/4;const b=C/4;for(let l=0;l<W;l+=B){for(let l=0;l<B;l++)E[l]=G[l]=Z[x+l];d(G,l);for(let l=0;l<B;l++)E[l]!==G[l]&&(Z[x+l]=G[l]);x+=b}}else{const a=ArrayBuffer.isView(Z)?new DataView(Z.buffer,Z.byteOffset,Z.byteLength):new DataView(Z),q=K(f);for(let Z=0;Z<W;Z+=B){for(let Z=0,C=l;Z<B;Z++,C+=q)E[Z]=G[Z]=x(a,f,C,J);d(G,Z);for(let Z=0,C=l;Z<B;Z++,C+=q)E[Z]!==G[Z]&&b(a,f,C,J,G[Z]);l+=C}}}function J(Z,l,C,x,b,f,J,d){const E=l*K(C),G=J*l;if(5126!==C||b!==E){const B=new Float32Array(G);return W(Z,x,b,l,C,G,f,((Z,C)=>{for(let x=0;x<l;x++)B[C+x]=Z[x]})),B}if(!(Z instanceof Array||Z instanceof Float32Array)||0!==x||Z.length!==G){if(Z instanceof Array){const l=x/4;return Z.slice(l,l+G)}if(Z instanceof ArrayBuffer)return new Float32Array(Z,x,G);{const l=Z.byteOffset+x;return 0!==(3&l)&&(B.e.Warn("Float array must be aligned to 4-bytes border"),d=!0),d?new Float32Array(Z.buffer.slice(l,l+G*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(Z.buffer,l,G)}}return d?Z.slice():Z}function d(Z,l,C,x,b,J,d,E){const G=K(C),a=f(C),q=d*l;if(Array.isArray(Z)){if(0!==(3&x)||0!==(3&b))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const B=x/4,K=b/4;if(B+(d-1)*K+l>Z.length)throw new Error("Last accessed index is out of bounds.");if(K<l)throw new Error("Data stride cannot be smaller than the component size.");if(K!==l){const B=new a(q);return W(Z,x,b,l,C,q,J,((Z,C)=>{for(let x=0;x<l;x++)B[C+x]=Z[x]})),B}return new a(Z.slice(B,B+q))}let z,Y=x;Z instanceof ArrayBuffer?z=Z:(z=Z.buffer,Y+=Z.byteOffset);if(Y+(d-1)*b+l*G>z.byteLength)throw new Error("Last accessed byte is out of bounds.");const P=l*G;if(b<P)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(b!==P){const Z=new a(q);return W(z,Y,b,l,C,q,J,((C,B)=>{for(let x=0;x<l;x++)Z[B+x]=C[x]})),Z}return 1!==G&&0!==(Y&G-1)&&(B.e.Warn("Array must be aligned to border of element size. Data will be copied."),E=!0),E?new a(z.slice(Y,Y+q*G)):new a(z,Y,q)}function E(Z,l,C,x,b,f,J,d){const E=l*K(C),G=J*l;if(d.length!==G)throw new Error("Output length is not valid");if(5126===C&&b===E)if(Z instanceof Array){const l=x/4;d.set(Z,l)}else if(Z instanceof ArrayBuffer){const l=new Float32Array(Z,x,G);d.set(l)}else{const l=Z.byteOffset+x;if(0!==(3&l))return B.e.Warn("Float array must be aligned to 4-bytes border"),void d.set(new Float32Array(Z.buffer.slice(l,l+G*Float32Array.BYTES_PER_ELEMENT)));const C=new Float32Array(Z.buffer,l,G);d.set(C)}else W(Z,x,b,l,C,G,f,((Z,C)=>{for(let B=0;B<l;B++)d[C+B]=Z[B]}))}function G(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(Z)){for(let x=0;x<l;x++)if(Z[C+x]-B>65535)return!0;return!1}return 4===Z.BYTES_PER_ELEMENT}},12538:(Z,l,C)=>{C.d(l,{b:()=>B});class B{get underlyingResource(){return null}constructor(){this.references=0,this.Ml=0,this.is32Bits=!1,this.uniqueId=B._Counter++}}B._Counter=0},12578:(Z,l,C)=>{C.d(l,{d:()=>x});var B=C(12339);class x{static GetEffect(Z){return void 0===Z.getPipelineContext?Z.effect:Z}constructor(Z){let l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=Z.createDrawContext(),l&&(this.materialContext=Z.createMaterialContext())}setEffect(Z,l){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var B;(this.effect=Z,void 0!==l&&(this.defines=l),C)&&(null===(B=this.drawContext)||void 0===B||B.reset())}dispose(){var Z;let l=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const Z=this.effect;l?Z.dispose():B.c.SetImmediate((()=>{Z.getEngine().onEndFrameObservable.addOnce((()=>{Z.dispose()}))})),this.effect=null}null===(Z=this.drawContext)||void 0===Z||Z.dispose()}}},12672:(Z,l,C)=>{C.d(l,{b:()=>x});var B=C(12503);class x{static GetPlanes(Z){const l=[];for(let C=0;C<6;C++)l.push(new B.e(0,0,0,0));return x.GetPlanesToRef(Z,l),l}static GetNearPlaneToRef(Z,l){const C=Z.m;l.normal.x=C[3]+C[2],l.normal.y=C[7]+C[6],l.normal.z=C[11]+C[10],l.d=C[15]+C[14],l.normalize()}static GetFarPlaneToRef(Z,l){const C=Z.m;l.normal.x=C[3]-C[2],l.normal.y=C[7]-C[6],l.normal.z=C[11]-C[10],l.d=C[15]-C[14],l.normalize()}static GetLeftPlaneToRef(Z,l){const C=Z.m;l.normal.x=C[3]+C[0],l.normal.y=C[7]+C[4],l.normal.z=C[11]+C[8],l.d=C[15]+C[12],l.normalize()}static GetRightPlaneToRef(Z,l){const C=Z.m;l.normal.x=C[3]-C[0],l.normal.y=C[7]-C[4],l.normal.z=C[11]-C[8],l.d=C[15]-C[12],l.normalize()}static GetTopPlaneToRef(Z,l){const C=Z.m;l.normal.x=C[3]-C[1],l.normal.y=C[7]-C[5],l.normal.z=C[11]-C[9],l.d=C[15]-C[13],l.normalize()}static GetBottomPlaneToRef(Z,l){const C=Z.m;l.normal.x=C[3]+C[1],l.normal.y=C[7]+C[5],l.normal.z=C[11]+C[9],l.d=C[15]+C[13],l.normalize()}static GetPlanesToRef(Z,l){x.GetNearPlaneToRef(Z,l[0]),x.GetFarPlaneToRef(Z,l[1]),x.GetLeftPlaneToRef(Z,l[2]),x.GetRightPlaneToRef(Z,l[3]),x.GetTopPlaneToRef(Z,l[4]),x.GetBottomPlaneToRef(Z,l[5])}static IsPointInFrustum(Z,l){for(let C=0;C<6;C++)if(l[C].dotCoordinate(Z)<0)return!1;return!0}}},12684:(Z,l,C)=>{C.d(l,{c:()=>x});var B=C(12275);class x{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(Z,l){x.Enabled&&(this._current+=Z,l&&this._fetchResult())}beginMonitoring(){x.Enabled&&(this._startMonitoringTime=B.d.Now)}endMonitoring(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!x.Enabled)return;Z&&this.fetchNewFrame();const l=B.d.Now;this._current=l-this._startMonitoringTime,Z&&this._fetchResult()}Bb(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const Z=B.d.Now;Z-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=Z,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}x.Enabled=!0},12561:(Z,l,C)=>{C.d(l,{d:()=>x,g:()=>B});class B{constructor(Z){this.length=0,this.data=new Array(Z),this._id=B._GlobalId++}push(Z){this.data[this.length++]=Z,this.length>this.data.length&&(this.data.length*=2)}forEach(Z){for(let l=0;l<this.length;l++)Z(this.data[l])}sort(Z){this.data.sort(Z)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(let l=0;l<Z.length;l++)this.data[this.length++]=(Z.data||Z)[l]}}indexOf(Z){const l=this.data.indexOf(Z);return l>=this.length?-1:l}contains(Z){return-1!==this.indexOf(Z)}}B._GlobalId=0;class x extends B{constructor(){super(...arguments),this._duplicateId=0}push(Z){super.push(Z),Z.__smartArrayFlags||(Z.__smartArrayFlags={}),Z.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(Z){return(!Z.__smartArrayFlags||Z.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(Z),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(let l=0;l<Z.length;l++){const C=(Z.data||Z)[l];this.pushNoDuplicate(C)}}}}},12521:(Z,l,C)=>{C.d(l,{c:()=>b});var B=C(12530),x=C(12251);class b{constructor(Z){this._vertexBuffers={},this.onBeforeRenderObservable=new x.b,this._scene=Z}_prepareBuffers(){if(this._vertexBuffers[B.h.PositionKind])return;const Z=[];Z.push(1,1),Z.push(-1,1),Z.push(-1,-1),Z.push(1,-1),this._vertexBuffers[B.h.PositionKind]=new B.h(this._scene.getEngine(),Z,B.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const Z=[];Z.push(0),Z.push(1),Z.push(2),Z.push(0),Z.push(2),Z.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(Z)}_rebuild(){const Z=this._vertexBuffers[B.h.PositionKind];Z&&(Z._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this._scene.activeCamera;return!!C&&(l=l||C._postProcesses.filter((Z=>null!=Z)),!(!l||0===l.length||!this._scene.postProcessesEnabled)&&(l[0].activate(C,Z,null!==l&&void 0!==l),!0))}directRender(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Z.length;const f=this._scene.getEngine();for(let J=0;J<K;J++){var W;if(J<Z.length-1)Z[J+1].activate(this._scene.activeCamera||this._scene,null===l||void 0===l?void 0:l.texture);else l?f.bindFramebuffer(l,B,void 0,void 0,C,x):b||f.restoreDefaultFramebuffer(),null===(W=f._debugInsertMarker)||void 0===W||W.call(f,`post process ${Z[J].name} output`);const K=Z[J],d=K.apply();d&&(K.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),f.bindBuffers(this._vertexBuffers,this._indexBuffer,d),f.drawElementsType(0,0,6),K.onAfterRenderObservable.notifyObservers(d))}f.setDepthBuffer(!0),f.setDepthWrite(!0)}_finalizeFrame(Z,l,C,B){let x=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const b=this._scene.activeCamera;if(!b)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(B=B||b._postProcesses.filter((Z=>null!=Z))).length||!this._scene.postProcessesEnabled)return;const K=this._scene.getEngine();for(let W=0,J=B.length;W<J;W++){const d=B[W];var f;if(W<J-1)d._outputTexture=B[W+1].activate(b,null===l||void 0===l?void 0:l.texture);else l?(K.bindFramebuffer(l,C,void 0,void 0,x),d._outputTexture=l):(K.restoreDefaultFramebuffer(),d._outputTexture=null),null===(f=K._debugInsertMarker)||void 0===f||f.call(K,`post process ${B[W].name} output`);if(Z)break;const E=d.apply();E&&(d.onBeforeRenderObservable.notifyObservers(E),this._prepareBuffers(),K.bindBuffers(this._vertexBuffers,this._indexBuffer,E),K.drawElementsType(0,0,6),d.onAfterRenderObservable.notifyObservers(E))}K.setDepthBuffer(!0),K.setDepthWrite(!0),K.setAlphaMode(0)}dispose(){const Z=this._vertexBuffers[B.h.PositionKind];Z&&(Z.dispose(),this._vertexBuffers[B.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12553:(Z,l,C)=>{C.d(l,{c:()=>f});var B=C(12561),x=C(12442);class b{set opaqueSortCompareFn(Z){this._opaqueSortCompareFn=Z||b.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(Z){this._alphaTestSortCompareFn=Z||b.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(Z){this._transparentSortCompareFn=Z||b.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(Z,l){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=Z,this._opaqueSubMeshes=new B.g(256),this._transparentSubMeshes=new B.g(256),this._alphaTestSubMeshes=new B.g(256),this._depthOnlySubMeshes=new B.g(256),this._particleSystems=new B.g(256),this._spriteManagers=new B.g(256),this._empty=!0,this._edgesRenderers=new B.d(16),this._scene=l,this.opaqueSortCompareFn=C,this.alphaTestSortCompareFn=x,this.transparentSortCompareFn=b}render(Z,l,C,B){if(Z)return void Z(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const x=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(x.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),x.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const b=x.getStencilBuffer();if(x.setStencilBuffer(!1),l&&this._renderSprites(),C&&this._renderParticles(B),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(x.setStencilBuffer(b),this._scene.useOrderIndependentTransparency){const Z=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);Z.length&&this._renderTransparent(Z)}else this._renderTransparent(this._transparentSubMeshes);x.setAlphaMode(0)}if(x.setStencilBuffer(!1),this._edgesRenderers.length){for(let Z=0;Z<this._edgesRenderers.length;Z++)this._edgesRenderers.data[Z].render();x.setAlphaMode(0)}x.setStencilBuffer(b)}_renderOpaqueSorted(Z){b._RenderSorted(Z,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(Z){b._RenderSorted(Z,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(Z){b._RenderSorted(Z,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(Z,l,C,B){let K,f=0;const W=C?C.globalPosition:b._ZeroVector;if(B)for(;f<Z.length;f++)K=Z.data[f],K._alphaIndex=K.getMesh().alphaIndex,K._distanceToCamera=x.ql.Distance(K.getBoundingInfo().boundingSphere.centerWorld,W);const J=Z.length===Z.data.length?Z.data:Z.data.slice(0,Z.length);l&&J.sort(l);const d=J[0].getMesh().cZ();for(f=0;f<J.length;f++)if(K=J[f],!d._activeMeshesFrozenButKeepClipping||K.isInFrustum(d._frustumPlanes)){if(B){const Z=K.MZ();if(Z&&Z.needDepthPrePass){const l=Z.cZ().getEngine();l.setColorWrite(!1),l.setAlphaMode(0),K.render(!1),l.setColorWrite(!0)}}K.render(B)}}static defaultTransparentSortCompare(Z,l){return Z._alphaIndex>l._alphaIndex?1:Z._alphaIndex<l._alphaIndex?-1:b.backToFrontSortCompare(Z,l)}static backToFrontSortCompare(Z,l){return Z._distanceToCamera<l._distanceToCamera?1:Z._distanceToCamera>l._distanceToCamera?-1:0}static frontToBackSortCompare(Z,l){return Z._distanceToCamera<l._distanceToCamera?-1:Z._distanceToCamera>l._distanceToCamera?1:0}static PainterSortCompare(Z,l){const C=Z.getMesh(),B=l.getMesh();return C.material&&B.material?C.material.uniqueId-B.material.uniqueId:C.uniqueId-B.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(Z,l,C){void 0===l&&(l=Z.getMesh()),void 0===C&&(C=Z.MZ()),null!==C&&void 0!==C&&(C.needAlphaBlendingForMesh(l)?this._transparentSubMeshes.push(Z):C.needAlphaTestingForMesh(l)?(C.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._alphaTestSubMeshes.push(Z)):(C.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._opaqueSubMeshes.push(Z)),l._renderingGroup=this,l._edgesRenderer&&l.isEnabled()&&l.isVisible&&l._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(l._edgesRenderer),this._empty=!1)}dispatchSprites(Z){this._spriteManagers.push(Z),this._empty=!1}dispatchParticles(Z){this._particleSystems.push(Z),this._empty=!1}_renderParticles(Z){if(0===this._particleSystems.length)return;const l=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let C=0;C<this._particleSystems.length;C++){const B=this._particleSystems.data[C];if(0===(l&&l.layerMask&B.layerMask))continue;const x=B.Bl;x.position&&Z&&-1===Z.indexOf(x)||this._scene._activeParticles.addCount(B.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const Z=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let l=0;l<this._spriteManagers.length;l++){const C=this._spriteManagers.data[l];0!==(Z&&Z.layerMask&C.layerMask)&&C.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}b._ZeroVector=x.ql.Zero();class K{}class f{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(Z){Z!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=Z,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const Z of this._scene.meshes)if(Z.zb)for(const l of Z.zb)l._wasDispatched=!1;if(this._scene.spriteManagers)for(const Z of this._scene.spriteManagers)Z._wasDispatched=!1;for(const Z of this._scene.Ka)Z._wasDispatched=!1}constructor(Z){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new K,this._maintainStateBetweenFrames=!1,this._scene=Z;for(let l=f.MIN_RENDERINGGROUPS;l<f.MAX_RENDERINGGROUPS;l++)this._autoClearDepthStencil[l]={ab:!0,depth:!0,bb:!0}}getRenderingGroup(Z){const l=Z||0;return this._prepareRenderingGroup(l),this._renderingGroups[l]}_clearDepthStencilBuffer(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],l=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,Z,l),this._depthStencilBufferAlreadyCleaned=!0)}render(Z,l,C,B){const x=this._renderingGroupInfo;if(x.Yl=this._scene,x.camera=this._scene.activeCamera,x.renderingManager=this,this._scene.spriteManagers&&B)for(let b=0;b<this._scene.spriteManagers.length;b++){const Z=this._scene.spriteManagers[b];this.dispatchSprites(Z)}for(let b=f.MIN_RENDERINGGROUPS;b<f.MAX_RENDERINGGROUPS;b++){this._depthStencilBufferAlreadyCleaned=b===f.MIN_RENDERINGGROUPS;const K=this._renderingGroups[b];if(!K||K._empty)continue;const W=1<<b;if(x.renderingGroupId=b,this._scene.onBeforeRenderingGroupObservable.notifyObservers(x,W),f.AUTOCLEAR){const Z=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(b):this._autoClearDepthStencil[b];Z&&Z.ab&&this._clearDepthStencilBuffer(Z.depth,Z.bb)}for(const Z of this._scene._beforeRenderingGroupDrawStage)Z.action(b);K.render(Z,B,C,l);for(const Z of this._scene._afterRenderingGroupDrawStage)Z.action(b);this._scene.onAfterRenderingGroupObservable.notifyObservers(x,W)}}reset(){if(!this.maintainStateBetweenFrames)for(let Z=f.MIN_RENDERINGGROUPS;Z<f.MAX_RENDERINGGROUPS;Z++){const l=this._renderingGroups[Z];l&&l.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let Z=f.MIN_RENDERINGGROUPS;Z<f.MAX_RENDERINGGROUPS;Z++){const l=this._renderingGroups[Z];l&&l.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let Z=f.MIN_RENDERINGGROUPS;Z<f.MAX_RENDERINGGROUPS;Z++){const l=this._renderingGroups[Z];l&&l.dispose()}}_prepareRenderingGroup(Z){void 0===this._renderingGroups[Z]&&(this._renderingGroups[Z]=new b(Z,this._scene,this._customOpaqueSortCompareFn[Z],this._customAlphaTestSortCompareFn[Z],this._customTransparentSortCompareFn[Z]))}dispatchSprites(Z){this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatchSprites(Z))}dispatchParticles(Z){this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatchParticles(Z))}dispatch(Z,l,C){void 0===l&&(l=Z.getMesh()),this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(l.renderingGroupId).dispatch(Z,l,C))}setRenderingOrder(Z){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[Z]=l,this._customAlphaTestSortCompareFn[Z]=C,this._customTransparentSortCompareFn[Z]=B,this._renderingGroups[Z]){const l=this._renderingGroups[Z];l.opaqueSortCompareFn=this._customOpaqueSortCompareFn[Z],l.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[Z],l.transparentSortCompareFn=this._customTransparentSortCompareFn[Z]}}setRenderingAutoClearDepthStencil(Z,l){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],B=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[Z]={ab:l,depth:C,bb:B}}getAutoClearDepthStencilSetup(Z){return this._autoClearDepthStencil[Z]}}f.MAX_RENDERINGGROUPS=4,f.MIN_RENDERINGGROUPS=0,f.AUTOCLEAR=!0}}]);