"use strict";(self.g111kvdsqxc=self.g111kvdsqxc||[]).push([[19],{11366:(K,H,M)=>{M.d(H,{c:()=>y,d:()=>h});var q=M(11372),w=M(11112),u=M(11376);class y{get W(){return this._isDisposed}constructor(K,H,M){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,K&&K.sK?this._engine=K.sK().getEngine():this._engine=K,this._updatable=M,this._instanced=y,this._divisor=W||1,this._label=I,H instanceof q.c?(this._data=null,this._buffer=H):(this._data=H,this._buffer=null),this.byteStride=h?w:w*Float32Array.BYTES_PER_ELEMENT,u||this.create()}createVertexBuffer(K,H,M,q,w){let u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0;const W=u?H:H*Float32Array.BYTES_PER_ELEMENT,I=q?u?q:q*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new h(this._engine,this,K,this._updatable,!0,I,void 0===w?this._instanced:w,W,M,void 0,void 0,!0,this._divisor||y)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!K&&this._buffer||(K=K||this._data,K&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,K),this._data=K):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(K,this._label),this._data=K):this._buffer=this._engine.createVertexBuffer(K,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.kh>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.kh,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.kh,void 0,this._label));w.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(K){this.create(K)}updateDirectly(K,H,M){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,K,q?H:H*Float32Array.BYTES_PER_ELEMENT,M?M*this.byteStride:void 0),this._data=0===H&&void 0===M?K:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class h{get W(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(K){const H=0!=K;this._instanceDivisor=K,H!==this._instanced&&(this._instanced=H,this._computeHashCode())}get _maxVerticesCount(){const K=this.getData();return K?Array.isArray(K)?K.length/(this.byteStride/4)-this.byteOffset/4:(K.byteLength-this.byteOffset)/this.byteStride:0}constructor(K,H,M,q,w,W,I,f,z,G){let a=arguments.length>10&&void 0!==arguments[10]&&arguments[10],v=arguments.length>11&&void 0!==arguments[11]&&arguments[11],O=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,L=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let S=!1;if(this.vH=K,"object"===typeof q&&null!==q?(S=q.updatable??!1,w=q.postponeInternalCreation,W=q.stride,I=q.instanced,f=q.offset,z=q.size,G=q.type,a=q.normalized??!1,v=q.useBytes??!1,O=q.divisor??1,L=q.takeBufferOwnership??!1,this._label=q.label):S=!!q,H instanceof y?(this._buffer=H,this._ownsBuffer=L):(this._buffer=new y(K,H,S,W,w,I,v,O,this._label),this._ownsBuffer=!0),this.uniqueId=h._Counter++,this._kind=M,void 0===G){const K=this.getData();this.type=K?h.GetDataType(K):h.FLOAT}else this.type=G;const B=(0,u.j)(this.type);v?(this._size=z||(W?W/B:h.DeduceStride(M)),this.byteStride=W||this._buffer.byteStride||this._size*B,this.byteOffset=f||0):(this._size=z||W||h.DeduceStride(M),this.byteStride=W?W*B:this._buffer.byteStride||this._size*B,this.byteOffset=(f||0)*B),this.normalized=a,this._instanced=void 0!==I&&I,this._instanceDivisor=I?O:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var K;null===(K=this._buffer)||void 0===K||K._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(K,H){const M=this.getData();return M?(0,u.g)(M,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,K,H):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,u.j)(this.type)}getOffset(){return this.byteOffset/(0,u.j)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,u.j)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(K){this._buffer.create(K),this._alignBuffer()}update(K){this._buffer.update(K),this._alignBuffer()}updateDirectly(K,H){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(K,H,void 0,M),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(K,H){(0,u.f)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,K,this.normalized,((K,M)=>{for(let q=0;q<this._size;q++)H(K[q],M+q)}))}_alignBuffer(){}static DeduceStride(K){switch(K){case h.UVKind:case h.UV2Kind:case h.UV3Kind:case h.UV4Kind:case h.UV5Kind:case h.UV6Kind:return 2;case h.NormalKind:case h.PositionKind:return 3;case h.ColorKind:case h.ColorInstanceKind:case h.MatricesIndicesKind:case h.MatricesIndicesExtraKind:case h.MatricesWeightsKind:case h.MatricesWeightsExtraKind:case h.TangentKind:return 4;default:throw new Error("Invalid kind '"+K+"'")}}static GetDataType(K){return K instanceof Int8Array?h.BYTE:K instanceof Uint8Array?h.UNSIGNED_BYTE:K instanceof Int16Array?h.SHORT:K instanceof Uint16Array?h.UNSIGNED_SHORT:K instanceof Int32Array?h.INT:K instanceof Uint32Array?h.UNSIGNED_INT:h.FLOAT}static GetTypeByteLength(K){return(0,u.j)(K)}static ForEach(K,H,M,q,w,y,h,W){(0,u.f)(K,H,M,q,w,y,h,((K,H)=>{for(let M=0;M<q;M++)W(K[M],H+M)}))}static GetFloatData(K,H,M,q,w,y,h,W){return(0,u.g)(K,H,M,q,w,y,h,W)}}h._Counter=0,h.BYTE=5120,h.UNSIGNED_BYTE=5121,h.SHORT=5122,h.UNSIGNED_SHORT=5123,h.INT=5124,h.UNSIGNED_INT=5125,h.FLOAT=5126,h.PositionKind="position",h.NormalKind="normal",h.TangentKind="tangent",h.UVKind="uv",h.UV2Kind="uv2",h.UV3Kind="uv3",h.UV4Kind="uv4",h.UV5Kind="uv5",h.UV6Kind="uv6",h.ColorKind="color",h.ColorInstanceKind="instanceColor",h.MatricesIndicesKind="matricesIndices",h.MatricesWeightsKind="matricesWeights",h.MatricesIndicesExtraKind="matricesIndicesExtra",h.MatricesWeightsExtraKind="matricesWeightsExtra"},11376:(K,H,M)=>{M.d(H,{c:()=>G,e:()=>z,f:()=>W,g:()=>I,j:()=>y,m:()=>h,n:()=>f});var q=M(11112);function w(K,H,M,q){switch(H){case 5120:{let H=K.getInt8(M);return q&&(H=Math.max(H/127,-1)),H}case 5121:{let H=K.getUint8(M);return q&&(H/=255),H}case 5122:{let H=K.getInt16(M,!0);return q&&(H=Math.max(H/32767,-1)),H}case 5123:{let H=K.getUint16(M,!0);return q&&(H/=65535),H}case 5124:return K.getInt32(M,!0);case 5125:return K.getUint32(M,!0);case 5126:return K.getFloat32(M,!0);default:throw new Error(`Invalid component type ${H}`)}}function u(K,H,M,q,w){switch(H){case 5120:q&&(w=Math.round(127*w)),K.setInt8(M,w);break;case 5121:q&&(w=Math.round(255*w)),K.setUint8(M,w);break;case 5122:q&&(w=Math.round(32767*w)),K.setInt16(M,w,!0);break;case 5123:q&&(w=Math.round(65535*w)),K.setUint16(M,w,!0);break;case 5124:K.setInt32(M,w,!0);break;case 5125:K.setUint32(M,w,!0);break;case 5126:K.setFloat32(M,w,!0);break;default:throw new Error(`Invalid component type ${H}`)}}function y(K){switch(K){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${K}'`)}}function h(K){switch(K){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${K}'`)}}function W(K,H,M,q,h,W,I,f){const z=new Array(q),G=new Array(q);if(K instanceof Array){let w=H/4;const u=M/4;for(let H=0;H<W;H+=q){for(let H=0;H<q;H++)z[H]=G[H]=K[w+H];f(G,H);for(let H=0;H<q;H++)z[H]!==G[H]&&(K[w+H]=G[H]);w+=u}}else{const a=ArrayBuffer.isView(K)?new DataView(K.buffer,K.byteOffset,K.byteLength):new DataView(K),v=y(h);for(let K=0;K<W;K+=q){for(let K=0,M=H;K<q;K++,M+=v)z[K]=G[K]=w(a,h,M,I);f(G,K);for(let K=0,M=H;K<q;K++,M+=v)z[K]!==G[K]&&u(a,h,M,I,G[K]);H+=M}}}function I(K,H,M,w,u,h,I,f){const z=H*y(M),G=I*H;if(5126!==M||u!==z){const q=new Float32Array(G);return W(K,w,u,H,M,G,h,((K,M)=>{for(let w=0;w<H;w++)q[M+w]=K[w]})),q}if(!(K instanceof Array||K instanceof Float32Array)||0!==w||K.length!==G){if(K instanceof Array){const H=w/4;return K.slice(H,H+G)}if(K instanceof ArrayBuffer)return new Float32Array(K,w,G);{const H=K.byteOffset+w;return 0!==(3&H)&&(q.e.Warn("Float array must be aligned to 4-bytes border"),f=!0),f?new Float32Array(K.buffer.slice(H,H+G*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(K.buffer,H,G)}}return f?K.slice():K}function f(K,H,M,w,u,I,f,z){const G=y(M),a=h(M),v=f*H;if(Array.isArray(K)){if(0!==(3&w)||0!==(3&u))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const q=w/4,y=u/4;if(q+(f-1)*y+H>K.length)throw new Error("Last accessed index is out of bounds.");if(y<H)throw new Error("Data stride cannot be smaller than the component size.");if(y!==H){const q=new a(v);return W(K,w,u,H,M,v,I,((K,M)=>{for(let w=0;w<H;w++)q[M+w]=K[w]})),q}return new a(K.slice(q,q+v))}let O,L=w;K instanceof ArrayBuffer?O=K:(O=K.buffer,L+=K.byteOffset);if(L+(f-1)*u+H*G>O.byteLength)throw new Error("Last accessed byte is out of bounds.");const S=H*G;if(u<S)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(u!==S){const K=new a(v);return W(O,L,u,H,M,v,I,((M,q)=>{for(let w=0;w<H;w++)K[q+w]=M[w]})),K}return 1!==G&&0!==(L&G-1)&&(q.e.Warn("Array must be aligned to border of element size. Data will be copied."),z=!0),z?new a(O.slice(L,L+v*G)):new a(O,L,v)}function z(K,H,M,w,u,h,I,f){const z=H*y(M),G=I*H;if(f.length!==G)throw new Error("Output length is not valid");if(5126===M&&u===z)if(K instanceof Array){const H=w/4;f.set(K,H)}else if(K instanceof ArrayBuffer){const H=new Float32Array(K,w,G);f.set(H)}else{const H=K.byteOffset+w;if(0!==(3&H))return q.e.Warn("Float array must be aligned to 4-bytes border"),void f.set(new Float32Array(K.buffer.slice(H,H+G*Float32Array.BYTES_PER_ELEMENT)));const M=new Float32Array(K.buffer,H,G);f.set(M)}else W(K,w,u,H,M,G,h,((K,M)=>{for(let q=0;q<H;q++)f[M+q]=K[q]}))}function G(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(K)){for(let w=0;w<H;w++)if(K[M+w]-q>65535)return!0;return!1}return 4===K.BYTES_PER_ELEMENT}},11372:(K,H,M)=>{M.d(H,{c:()=>q});class q{get underlyingResource(){return null}constructor(){this.references=0,this.kh=0,this.is32Bits=!1,this.uniqueId=q._Counter++}}q._Counter=0},11403:(K,H,M)=>{M.d(H,{c:()=>w});var q=M(11176);class w{static GetEffect(K){return void 0===K.getPipelineContext?K.effect:K}constructor(K){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=K.createDrawContext(),H&&(this.materialContext=K.createMaterialContext())}setEffect(K,H){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var q;(this.effect=K,void 0!==H&&(this.defines=H),M)&&(null===(q=this.drawContext)||void 0===q||q.reset())}dispose(){var K;let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const K=this.effect;H?K.dispose():q.c.SetImmediate((()=>{K.getEngine().onEndFrameObservable.addOnce((()=>{K.dispose()}))})),this.effect=null}null===(K=this.drawContext)||void 0===K||K.dispose()}}},11493:(K,H,M)=>{M.d(H,{e:()=>w});var q=M(11334);class w{static GetPlanes(K){const H=[];for(let M=0;M<6;M++)H.push(new q.e(0,0,0,0));return w.GetPlanesToRef(K,H),H}static GetNearPlaneToRef(K,H){const M=K.m;H.normal.x=M[3]+M[2],H.normal.y=M[7]+M[6],H.normal.z=M[11]+M[10],H.d=M[15]+M[14],H.normalize()}static GetFarPlaneToRef(K,H){const M=K.m;H.normal.x=M[3]-M[2],H.normal.y=M[7]-M[6],H.normal.z=M[11]-M[10],H.d=M[15]-M[14],H.normalize()}static GetLeftPlaneToRef(K,H){const M=K.m;H.normal.x=M[3]+M[0],H.normal.y=M[7]+M[4],H.normal.z=M[11]+M[8],H.d=M[15]+M[12],H.normalize()}static GetRightPlaneToRef(K,H){const M=K.m;H.normal.x=M[3]-M[0],H.normal.y=M[7]-M[4],H.normal.z=M[11]-M[8],H.d=M[15]-M[12],H.normalize()}static GetTopPlaneToRef(K,H){const M=K.m;H.normal.x=M[3]-M[1],H.normal.y=M[7]-M[5],H.normal.z=M[11]-M[9],H.d=M[15]-M[13],H.normalize()}static GetBottomPlaneToRef(K,H){const M=K.m;H.normal.x=M[3]+M[1],H.normal.y=M[7]+M[5],H.normal.z=M[11]+M[9],H.d=M[15]+M[13],H.normalize()}static GetPlanesToRef(K,H){w.GetNearPlaneToRef(K,H[0]),w.GetFarPlaneToRef(K,H[1]),w.GetLeftPlaneToRef(K,H[2]),w.GetRightPlaneToRef(K,H[3]),w.GetTopPlaneToRef(K,H[4]),w.GetBottomPlaneToRef(K,H[5])}static IsPointInFrustum(K,H){for(let M=0;M<6;M++)if(H[M].dotCoordinate(K)<0)return!1;return!0}}},11498:(K,H,M)=>{M.d(H,{d:()=>w});var q=M(11125);class w{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(K,H){w.Enabled&&(this._current+=K,H&&this._fetchResult())}beginMonitoring(){w.Enabled&&(this._startMonitoringTime=q.d.Now)}endMonitoring(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!w.Enabled)return;K&&this.fetchNewFrame();const H=q.d.Now;this._current=H-this._startMonitoringTime,K&&this._fetchResult()}Kh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const K=q.d.Now;K-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=K,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}w.Enabled=!0},11388:(K,H,M)=>{M.d(H,{b:()=>w,e:()=>q});class q{constructor(K){this.length=0,this.data=new Array(K),this._id=q._GlobalId++}push(K){this.data[this.length++]=K,this.length>this.data.length&&(this.data.length*=2)}forEach(K){for(let H=0;H<this.length;H++)K(this.data[H])}sort(K){this.data.sort(K)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(K){if(0!==K.length){this.length+K.length>this.data.length&&(this.data.length=2*(this.length+K.length));for(let H=0;H<K.length;H++)this.data[this.length++]=(K.data||K)[H]}}indexOf(K){const H=this.data.indexOf(K);return H>=this.length?-1:H}contains(K){return-1!==this.indexOf(K)}}q._GlobalId=0;class w extends q{constructor(){super(...arguments),this._duplicateId=0}push(K){super.push(K),K.__smartArrayFlags||(K.__smartArrayFlags={}),K.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(K){return(!K.__smartArrayFlags||K.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(K),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(K){if(0!==K.length){this.length+K.length>this.data.length&&(this.data.length=2*(this.length+K.length));for(let H=0;H<K.length;H++){const M=(K.data||K)[H];this.pushNoDuplicate(M)}}}}},11358:(K,H,M)=>{M.d(H,{b:()=>u});var q=M(11366),w=M(11102);class u{constructor(K){this._vertexBuffers={},this.onBeforeRenderObservable=new w.d,this._scene=K}_prepareBuffers(){if(this._vertexBuffers[q.d.PositionKind])return;const K=[];K.push(1,1),K.push(-1,1),K.push(-1,-1),K.push(1,-1),this._vertexBuffers[q.d.PositionKind]=new q.d(this._scene.getEngine(),K,q.d.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const K=[];K.push(0),K.push(1),K.push(2),K.push(0),K.push(2),K.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(K)}_rebuild(){const K=this._vertexBuffers[q.d.PositionKind];K&&(K._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=this._scene.activeCamera;return!!M&&(H=H||M._postProcesses.filter((K=>null!=K)),!(!H||0===H.length||!this._scene.postProcessesEnabled)&&(H[0].activate(M,K,null!==H&&void 0!==H),!0))}directRender(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:K.length;const h=this._scene.getEngine();for(let I=0;I<y;I++){var W;if(I<K.length-1)K[I+1].activate(this._scene.activeCamera||this._scene,null===H||void 0===H?void 0:H.texture);else H?h.bindFramebuffer(H,q,void 0,void 0,M,w):u||h.restoreDefaultFramebuffer(),null===(W=h._debugInsertMarker)||void 0===W||W.call(h,`post process ${K[I].name} output`);const y=K[I],f=y.apply();f&&(y.onBeforeRenderObservable.notifyObservers(f),this._prepareBuffers(),h.bindBuffers(this._vertexBuffers,this._indexBuffer,f),h.drawElementsType(0,0,6),y.onAfterRenderObservable.notifyObservers(f))}h.setDepthBuffer(!0),h.setDepthWrite(!0)}_finalizeFrame(K,H,M,q){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const u=this._scene.activeCamera;if(!u)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(q=q||u._postProcesses.filter((K=>null!=K))).length||!this._scene.postProcessesEnabled)return;const y=this._scene.getEngine();for(let W=0,I=q.length;W<I;W++){const f=q[W];var h;if(W<I-1)f._outputTexture=q[W+1].activate(u,null===H||void 0===H?void 0:H.texture);else H?(y.bindFramebuffer(H,M,void 0,void 0,w),f._outputTexture=H):(y.restoreDefaultFramebuffer(),f._outputTexture=null),null===(h=y._debugInsertMarker)||void 0===h||h.call(y,`post process ${q[W].name} output`);if(K)break;const z=f.apply();z&&(f.onBeforeRenderObservable.notifyObservers(z),this._prepareBuffers(),y.bindBuffers(this._vertexBuffers,this._indexBuffer,z),y.drawElementsType(0,0,6),f.onAfterRenderObservable.notifyObservers(z))}y.setDepthBuffer(!0),y.setDepthWrite(!0),y.setAlphaMode(0)}dispose(){const K=this._vertexBuffers[q.d.PositionKind];K&&(K.dispose(),this._vertexBuffers[q.d.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11380:(K,H,M)=>{M.d(H,{c:()=>h});var q=M(11388),w=M(11290);class u{set opaqueSortCompareFn(K){this._opaqueSortCompareFn=K||u.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(K){this._alphaTestSortCompareFn=K||u.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(K){this._transparentSortCompareFn=K||u.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(K,H){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=K,this._opaqueSubMeshes=new q.e(256),this._transparentSubMeshes=new q.e(256),this._alphaTestSubMeshes=new q.e(256),this._depthOnlySubMeshes=new q.e(256),this._particleSystems=new q.e(256),this._spriteManagers=new q.e(256),this._empty=!0,this._edgesRenderers=new q.b(16),this._scene=H,this.opaqueSortCompareFn=M,this.alphaTestSortCompareFn=w,this.transparentSortCompareFn=u}render(K,H,M,q){if(K)return void K(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const w=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(w.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),w.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const u=w.getStencilBuffer();if(w.setStencilBuffer(!1),H&&this._renderSprites(),M&&this._renderParticles(q),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(w.setStencilBuffer(u),this._scene.useOrderIndependentTransparency){const K=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);K.length&&this._renderTransparent(K)}else this._renderTransparent(this._transparentSubMeshes);w.setAlphaMode(0)}if(w.setStencilBuffer(!1),this._edgesRenderers.length){for(let K=0;K<this._edgesRenderers.length;K++)this._edgesRenderers.data[K].render();w.setAlphaMode(0)}w.setStencilBuffer(u)}_renderOpaqueSorted(K){u._RenderSorted(K,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(K){u._RenderSorted(K,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(K){u._RenderSorted(K,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(K,H,M,q){let y,h=0;const W=M?M.globalPosition:u._ZeroVector;if(q)for(;h<K.length;h++)y=K.data[h],y._alphaIndex=y.getMesh().alphaIndex,y._distanceToCamera=w.OH.Distance(y.getBoundingInfo().boundingSphere.centerWorld,W);const I=K.length===K.data.length?K.data:K.data.slice(0,K.length);H&&I.sort(H);const f=I[0].getMesh().sK();for(h=0;h<I.length;h++)if(y=I[h],!f._activeMeshesFrozenButKeepClipping||y.isInFrustum(f._frustumPlanes)){if(q){const K=y.pK();if(K&&K.needDepthPrePass){const H=K.sK().getEngine();H.setColorWrite(!1),H.setAlphaMode(0),y.render(!1),H.setColorWrite(!0)}}y.render(q)}}static defaultTransparentSortCompare(K,H){return K._alphaIndex>H._alphaIndex?1:K._alphaIndex<H._alphaIndex?-1:u.backToFrontSortCompare(K,H)}static backToFrontSortCompare(K,H){return K._distanceToCamera<H._distanceToCamera?1:K._distanceToCamera>H._distanceToCamera?-1:0}static frontToBackSortCompare(K,H){return K._distanceToCamera<H._distanceToCamera?-1:K._distanceToCamera>H._distanceToCamera?1:0}static PainterSortCompare(K,H){const M=K.getMesh(),q=H.getMesh();return M.material&&q.material?M.material.uniqueId-q.material.uniqueId:M.uniqueId-q.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(K,H,M){void 0===H&&(H=K.getMesh()),void 0===M&&(M=K.pK()),null!==M&&void 0!==M&&(M.needAlphaBlendingForMesh(H)?this._transparentSubMeshes.push(K):M.needAlphaTestingForMesh(H)?(M.needDepthPrePass&&this._depthOnlySubMeshes.push(K),this._alphaTestSubMeshes.push(K)):(M.needDepthPrePass&&this._depthOnlySubMeshes.push(K),this._opaqueSubMeshes.push(K)),H._renderingGroup=this,H._edgesRenderer&&H.isEnabled()&&H.isVisible&&H._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(H._edgesRenderer),this._empty=!1)}dispatchSprites(K){this._spriteManagers.push(K),this._empty=!1}dispatchParticles(K){this._particleSystems.push(K),this._empty=!1}_renderParticles(K){if(0===this._particleSystems.length)return;const H=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let M=0;M<this._particleSystems.length;M++){const q=this._particleSystems.data[M];if(0===(H&&H.layerMask&q.layerMask))continue;const w=q.wH;w.position&&K&&-1===K.indexOf(w)||this._scene._activeParticles.addCount(q.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const K=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let H=0;H<this._spriteManagers.length;H++){const M=this._spriteManagers.data[H];0!==(K&&K.layerMask&M.layerMask)&&M.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}u._ZeroVector=w.OH.Zero();class y{}class h{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(K){K!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=K,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const K of this._scene.meshes)if(K.yh)for(const H of K.yh)H._wasDispatched=!1;if(this._scene.spriteManagers)for(const K of this._scene.spriteManagers)K._wasDispatched=!1;for(const K of this._scene.CG)K._wasDispatched=!1}constructor(K){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new y,this._maintainStateBetweenFrames=!1,this._scene=K;for(let H=h.MIN_RENDERINGGROUPS;H<h.MAX_RENDERINGGROUPS;H++)this._autoClearDepthStencil[H]={uh:!0,depth:!0,stencil:!0}}getRenderingGroup(K){const H=K||0;return this._prepareRenderingGroup(H),this._renderingGroups[H]}_clearDepthStencilBuffer(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,K,H),this._depthStencilBufferAlreadyCleaned=!0)}render(K,H,M,q){const w=this._renderingGroupInfo;if(w.SH=this._scene,w.camera=this._scene.activeCamera,w.renderingManager=this,this._scene.spriteManagers&&q)for(let u=0;u<this._scene.spriteManagers.length;u++){const K=this._scene.spriteManagers[u];this.dispatchSprites(K)}for(let u=h.MIN_RENDERINGGROUPS;u<h.MAX_RENDERINGGROUPS;u++){this._depthStencilBufferAlreadyCleaned=u===h.MIN_RENDERINGGROUPS;const y=this._renderingGroups[u];if(!y||y._empty)continue;const W=1<<u;if(w.renderingGroupId=u,this._scene.onBeforeRenderingGroupObservable.notifyObservers(w,W),h.AUTOCLEAR){const K=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(u):this._autoClearDepthStencil[u];K&&K.uh&&this._clearDepthStencilBuffer(K.depth,K.stencil)}for(const K of this._scene._beforeRenderingGroupDrawStage)K.action(u);y.render(K,q,M,H);for(const K of this._scene._afterRenderingGroupDrawStage)K.action(u);this._scene.onAfterRenderingGroupObservable.notifyObservers(w,W)}}reset(){if(!this.maintainStateBetweenFrames)for(let K=h.MIN_RENDERINGGROUPS;K<h.MAX_RENDERINGGROUPS;K++){const H=this._renderingGroups[K];H&&H.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let K=h.MIN_RENDERINGGROUPS;K<h.MAX_RENDERINGGROUPS;K++){const H=this._renderingGroups[K];H&&H.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let K=h.MIN_RENDERINGGROUPS;K<h.MAX_RENDERINGGROUPS;K++){const H=this._renderingGroups[K];H&&H.dispose()}}_prepareRenderingGroup(K){void 0===this._renderingGroups[K]&&(this._renderingGroups[K]=new u(K,this._scene,this._customOpaqueSortCompareFn[K],this._customAlphaTestSortCompareFn[K],this._customTransparentSortCompareFn[K]))}dispatchSprites(K){this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(K.renderingGroupId).dispatchSprites(K))}dispatchParticles(K){this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(K.renderingGroupId).dispatchParticles(K))}dispatch(K,H,M){void 0===H&&(H=K.getMesh()),this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatch(K,H,M))}setRenderingOrder(K){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[K]=H,this._customAlphaTestSortCompareFn[K]=M,this._customTransparentSortCompareFn[K]=q,this._renderingGroups[K]){const H=this._renderingGroups[K];H.opaqueSortCompareFn=this._customOpaqueSortCompareFn[K],H.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[K],H.transparentSortCompareFn=this._customTransparentSortCompareFn[K]}}setRenderingAutoClearDepthStencil(K,H){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[K]={uh:H,depth:M,stencil:q}}getAutoClearDepthStencilSetup(K){return this._autoClearDepthStencil[K]}}h.MAX_RENDERINGGROUPS=4,h.MIN_RENDERINGGROUPS=0,h.AUTOCLEAR=!0}}]);