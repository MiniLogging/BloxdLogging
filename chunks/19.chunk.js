"use strict";(self.qbp2s7qydk=self.qbp2s7qydk||[]).push([[19],{13043:(M,A,O)=>{O.d(A,{b:()=>X,c:()=>c});var S=O(13051),z=O(12783),Q=O(13059);class X{get T(){return this._isDisposed}constructor(M,A,O){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],j=arguments.length>7?arguments[7]:void 0,B=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,M&&M.HM?this._engine=M.HM().getEngine():this._engine=M,this._updatable=O,this._instanced=X,this._divisor=j||1,this._label=B,A instanceof S.c?(this._data=null,this._buffer=A):(this._data=A,this._buffer=null),this.byteStride=c?z:z*Float32Array.BYTES_PER_ELEMENT,Q||this.create()}createVertexBuffer(M,A,O,S,z){let Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6?arguments[6]:void 0;const j=Q?A:A*Float32Array.BYTES_PER_ELEMENT,B=S?Q?S:S*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new c(this._engine,this,M,this._updatable,!0,B,void 0===z?this._instanced:z,j,O,void 0,void 0,!0,this._divisor||X)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!M&&this._buffer||(M=M||this._data,M&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,M),this._data=M):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(M,this._label),this._data=M):this._buffer=this._engine.createVertexBuffer(M,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.wO>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.wO,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.wO,void 0,this._label));z.c.Warn('Missing data for buffer "'.concat(this._label,'" ').concat(this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":"",". Buffer reconstruction failed.")),this._buffer=null}}update(M){this.create(M)}updateDirectly(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,M,S?A:A*Float32Array.BYTES_PER_ELEMENT,O?O*this.byteStride:void 0),this._data=0===A&&void 0===O?M:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class c{get T(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(M){const A=0!=M;this._instanceDivisor=M,A!==this._instanced&&(this._instanced=A,this._computeHashCode())}get _maxVerticesCount(){const M=this.getData();return M?Array.isArray(M)?M.length/(this.byteStride/4)-this.byteOffset/4:(M.byteLength-this.byteOffset)/this.byteStride:0}constructor(M,A,O,S,z,j,B,g,e,T){let J=arguments.length>10&&void 0!==arguments[10]&&arguments[10],K=arguments.length>11&&void 0!==arguments[11]&&arguments[11],G=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,d=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let w=!1;var I,b,s,Y,E;(this.KA=M,"object"===typeof S&&null!==S)?(w=null!==(I=S.updatable)&&void 0!==I&&I,z=S.postponeInternalCreation,j=S.stride,B=S.instanced,g=S.offset,e=S.size,T=S.type,J=null!==(b=S.normalized)&&void 0!==b&&b,K=null!==(s=S.useBytes)&&void 0!==s&&s,G=null!==(Y=S.divisor)&&void 0!==Y?Y:1,d=null!==(E=S.takeBufferOwnership)&&void 0!==E&&E,this._label=S.label):w=!!S;if(A instanceof X?(this._buffer=A,this._ownsBuffer=d):(this._buffer=new X(M,A,w,j,z,B,K,G,this._label),this._ownsBuffer=!0),this.uniqueId=c._Counter++,this._kind=O,void 0===T){const M=this.getData();this.type=M?c.GetDataType(M):c.FLOAT}else this.type=T;const H=(0,Q.o)(this.type);K?(this._size=e||(j?j/H:c.DeduceStride(O)),this.byteStride=j||this._buffer.byteStride||this._size*H,this.byteOffset=g||0):(this._size=e||j||c.DeduceStride(O),this.byteStride=j?j*H:this._buffer.byteStride||this._size*H,this.byteOffset=(g||0)*H),this.normalized=J,this._instanced=void 0!==B&&B,this._instanceDivisor=B?G:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var M;null===(M=this._buffer)||void 0===M||M._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(M,A){const O=this.getData();return O?(0,Q.k)(O,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,M,A):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,Q.o)(this.type)}getOffset(){return this.byteOffset/(0,Q.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,Q.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(M){this._buffer.create(M),this._alignBuffer()}update(M){this._buffer.update(M),this._alignBuffer()}updateDirectly(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(M,A,void 0,O),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(M,A){(0,Q.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,M,this.normalized,((M,O)=>{for(let S=0;S<this._size;S++)A(M[S],O+S)}))}_alignBuffer(){}static DeduceStride(M){switch(M){case c.UVKind:case c.UV2Kind:case c.UV3Kind:case c.UV4Kind:case c.UV5Kind:case c.UV6Kind:return 2;case c.NormalKind:case c.PositionKind:return 3;case c.ColorKind:case c.ColorInstanceKind:case c.MatricesIndicesKind:case c.MatricesIndicesExtraKind:case c.MatricesWeightsKind:case c.MatricesWeightsExtraKind:case c.TangentKind:return 4;default:throw new Error("Invalid kind '"+M+"'")}}static GetDataType(M){return M instanceof Int8Array?c.BYTE:M instanceof Uint8Array?c.UNSIGNED_BYTE:M instanceof Int16Array?c.SHORT:M instanceof Uint16Array?c.UNSIGNED_SHORT:M instanceof Int32Array?c.INT:M instanceof Uint32Array?c.UNSIGNED_INT:c.FLOAT}static GetTypeByteLength(M){return(0,Q.o)(M)}static ForEach(M,A,O,S,z,X,c,j){(0,Q.g)(M,A,O,S,z,X,c,((M,A)=>{for(let O=0;O<S;O++)j(M[O],A+O)}))}static GetFloatData(M,A,O,S,z,X,c,j){return(0,Q.k)(M,A,O,S,z,X,c,j)}}c._Counter=0,c.BYTE=5120,c.UNSIGNED_BYTE=5121,c.SHORT=5122,c.UNSIGNED_SHORT=5123,c.INT=5124,c.UNSIGNED_INT=5125,c.FLOAT=5126,c.PositionKind="position",c.NormalKind="normal",c.TangentKind="tangent",c.UVKind="uv",c.UV2Kind="uv2",c.UV3Kind="uv3",c.UV4Kind="uv4",c.UV5Kind="uv5",c.UV6Kind="uv6",c.ColorKind="color",c.ColorInstanceKind="instanceColor",c.MatricesIndicesKind="matricesIndices",c.MatricesWeightsKind="matricesWeights",c.MatricesIndicesExtraKind="matricesIndicesExtra",c.MatricesWeightsExtraKind="matricesWeightsExtra"},13059:(M,A,O)=>{O.d(A,{b:()=>T,d:()=>e,g:()=>j,k:()=>B,o:()=>X,p:()=>c,t:()=>g});var S=O(12783);function z(M,A,O,S){switch(A){case 5120:{let A=M.getInt8(O);return S&&(A=Math.max(A/127,-1)),A}case 5121:{let A=M.getUint8(O);return S&&(A/=255),A}case 5122:{let A=M.getInt16(O,!0);return S&&(A=Math.max(A/32767,-1)),A}case 5123:{let A=M.getUint16(O,!0);return S&&(A/=65535),A}case 5124:return M.getInt32(O,!0);case 5125:return M.getUint32(O,!0);case 5126:return M.getFloat32(O,!0);default:throw new Error("Invalid component type ".concat(A))}}function Q(M,A,O,S,z){switch(A){case 5120:S&&(z=Math.round(127*z)),M.setInt8(O,z);break;case 5121:S&&(z=Math.round(255*z)),M.setUint8(O,z);break;case 5122:S&&(z=Math.round(32767*z)),M.setInt16(O,z,!0);break;case 5123:S&&(z=Math.round(65535*z)),M.setUint16(O,z,!0);break;case 5124:M.setInt32(O,z,!0);break;case 5125:M.setUint32(O,z,!0);break;case 5126:M.setFloat32(O,z,!0);break;default:throw new Error("Invalid component type ".concat(A))}}function X(M){switch(M){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error("Invalid type '".concat(M,"'"))}}function c(M){switch(M){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("Invalid component type '".concat(M,"'"))}}function j(M,A,O,S,c,j,B,g){const e=new Array(S),T=new Array(S);if(M instanceof Array){let z=A/4;const Q=O/4;for(let A=0;A<j;A+=S){for(let A=0;A<S;A++)e[A]=T[A]=M[z+A];g(T,A);for(let A=0;A<S;A++)e[A]!==T[A]&&(M[z+A]=T[A]);z+=Q}}else{const J=ArrayBuffer.isView(M)?new DataView(M.buffer,M.byteOffset,M.byteLength):new DataView(M),K=X(c);for(let M=0;M<j;M+=S){for(let M=0,O=A;M<S;M++,O+=K)e[M]=T[M]=z(J,c,O,B);g(T,M);for(let M=0,O=A;M<S;M++,O+=K)e[M]!==T[M]&&Q(J,c,O,B,T[M]);A+=O}}}function B(M,A,O,z,Q,c,B,g){const e=A*X(O),T=B*A;if(5126!==O||Q!==e){const S=new Float32Array(T);return j(M,z,Q,A,O,T,c,((M,O)=>{for(let z=0;z<A;z++)S[O+z]=M[z]})),S}if(!(M instanceof Array||M instanceof Float32Array)||0!==z||M.length!==T){if(M instanceof Array){const A=z/4;return M.slice(A,A+T)}if(M instanceof ArrayBuffer)return new Float32Array(M,z,T);{const A=M.byteOffset+z;return 0!==(3&A)&&(S.c.Warn("Float array must be aligned to 4-bytes border"),g=!0),g?new Float32Array(M.buffer.slice(A,A+T*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(M.buffer,A,T)}}return g?M.slice():M}function g(M,A,O,z,Q,B,g,e){const T=X(O),J=c(O),K=g*A;if(Array.isArray(M)){if(0!==(3&z)||0!==(3&Q))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const S=z/4,X=Q/4;if(S+(g-1)*X+A>M.length)throw new Error("Last accessed index is out of bounds.");if(X<A)throw new Error("Data stride cannot be smaller than the component size.");if(X!==A){const S=new J(K);return j(M,z,Q,A,O,K,B,((M,O)=>{for(let z=0;z<A;z++)S[O+z]=M[z]})),S}return new J(M.slice(S,S+K))}let G,d=z;M instanceof ArrayBuffer?G=M:(G=M.buffer,d+=M.byteOffset);if(d+(g-1)*Q+A*T>G.byteLength)throw new Error("Last accessed byte is out of bounds.");const w=A*T;if(Q<w)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(Q!==w){const M=new J(K);return j(G,d,Q,A,O,K,B,((O,S)=>{for(let z=0;z<A;z++)M[S+z]=O[z]})),M}return 1!==T&&0!==(d&T-1)&&(S.c.Warn("Array must be aligned to border of element size. Data will be copied."),e=!0),e?new J(G.slice(d,d+K*T)):new J(G,d,K)}function e(M,A,O,z,Q,c,B,g){const e=A*X(O),T=B*A;if(g.length!==T)throw new Error("Output length is not valid");if(5126===O&&Q===e)if(M instanceof Array){const A=z/4;g.set(M,A)}else if(M instanceof ArrayBuffer){const A=new Float32Array(M,z,T);g.set(A)}else{const A=M.byteOffset+z;if(0!==(3&A))return S.c.Warn("Float array must be aligned to 4-bytes border"),void g.set(new Float32Array(M.buffer.slice(A,A+T*Float32Array.BYTES_PER_ELEMENT)));const O=new Float32Array(M.buffer,A,T);g.set(O)}else j(M,z,Q,A,O,T,c,((M,O)=>{for(let S=0;S<A;S++)g[O+S]=M[S]}))}function T(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(M)){for(let z=0;z<A;z++)if(M[O+z]-S>65535)return!0;return!1}return 4===M.BYTES_PER_ELEMENT}},13051:(M,A,O)=>{O.d(A,{c:()=>S});class S{get underlyingResource(){return null}constructor(){this.references=0,this.wO=0,this.is32Bits=!1,this.uniqueId=S._Counter++}}S._Counter=0},13096:(M,A,O)=>{O.d(A,{c:()=>z});var S=O(12848);class z{static GetEffect(M){return void 0===M.getPipelineContext?M.effect:M}constructor(M){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=M.createDrawContext(),A&&(this.materialContext=M.createMaterialContext())}setEffect(M,A){let O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var S;(this.effect=M,void 0!==A&&(this.defines=A),O)&&(null===(S=this.drawContext)||void 0===S||S.reset())}dispose(){var M;let A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const M=this.effect;A?M.dispose():S.b.SetImmediate((()=>{M.getEngine().onEndFrameObservable.addOnce((()=>{M.dispose()}))})),this.effect=null}null===(M=this.drawContext)||void 0===M||M.dispose()}}},13183:(M,A,O)=>{O.d(A,{e:()=>z});var S=O(13019);class z{static GetPlanes(M){const A=[];for(let O=0;O<6;O++)A.push(new S.e(0,0,0,0));return z.GetPlanesToRef(M,A),A}static GetNearPlaneToRef(M,A){const O=M.m;A.normal.x=O[3]+O[2],A.normal.y=O[7]+O[6],A.normal.z=O[11]+O[10],A.d=O[15]+O[14],A.normalize()}static GetFarPlaneToRef(M,A){const O=M.m;A.normal.x=O[3]-O[2],A.normal.y=O[7]-O[6],A.normal.z=O[11]-O[10],A.d=O[15]-O[14],A.normalize()}static GetLeftPlaneToRef(M,A){const O=M.m;A.normal.x=O[3]+O[0],A.normal.y=O[7]+O[4],A.normal.z=O[11]+O[8],A.d=O[15]+O[12],A.normalize()}static GetRightPlaneToRef(M,A){const O=M.m;A.normal.x=O[3]-O[0],A.normal.y=O[7]-O[4],A.normal.z=O[11]-O[8],A.d=O[15]-O[12],A.normalize()}static GetTopPlaneToRef(M,A){const O=M.m;A.normal.x=O[3]-O[1],A.normal.y=O[7]-O[5],A.normal.z=O[11]-O[9],A.d=O[15]-O[13],A.normalize()}static GetBottomPlaneToRef(M,A){const O=M.m;A.normal.x=O[3]+O[1],A.normal.y=O[7]+O[5],A.normal.z=O[11]+O[9],A.d=O[15]+O[13],A.normalize()}static GetPlanesToRef(M,A){z.GetNearPlaneToRef(M,A[0]),z.GetFarPlaneToRef(M,A[1]),z.GetLeftPlaneToRef(M,A[2]),z.GetRightPlaneToRef(M,A[3]),z.GetTopPlaneToRef(M,A[4]),z.GetBottomPlaneToRef(M,A[5])}static IsPointInFrustum(M,A){for(let O=0;O<6;O++)if(A[O].dotCoordinate(M)<0)return!1;return!0}}},13192:(M,A,O)=>{O.d(A,{e:()=>z});var S=O(12793);class z{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(M,A){z.Enabled&&(this._current+=M,A&&this._fetchResult())}beginMonitoring(){z.Enabled&&(this._startMonitoringTime=S.d.Now)}endMonitoring(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!z.Enabled)return;M&&this.fetchNewFrame();const A=S.d.Now;this._current=A-this._startMonitoringTime,M&&this._fetchResult()}mc(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const M=S.d.Now;M-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=M,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}z.Enabled=!0},13075:(M,A,O)=>{O.d(A,{e:()=>z,f:()=>S});class S{constructor(M){this.length=0,this.data=new Array(M),this._id=S._GlobalId++}push(M){this.data[this.length++]=M,this.length>this.data.length&&(this.data.length*=2)}forEach(M){for(let A=0;A<this.length;A++)M(this.data[A])}sort(M){this.data.sort(M)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(M){if(0!==M.length){this.length+M.length>this.data.length&&(this.data.length=2*(this.length+M.length));for(let A=0;A<M.length;A++)this.data[this.length++]=(M.data||M)[A]}}indexOf(M){const A=this.data.indexOf(M);return A>=this.length?-1:A}contains(M){return-1!==this.indexOf(M)}}S._GlobalId=0;class z extends S{constructor(){super(...arguments),this._duplicateId=0}push(M){super.push(M),M.__smartArrayFlags||(M.__smartArrayFlags={}),M.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(M){return(!M.__smartArrayFlags||M.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(M),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(M){if(0!==M.length){this.length+M.length>this.data.length&&(this.data.length=2*(this.length+M.length));for(let A=0;A<M.length;A++){const O=(M.data||M)[A];this.pushNoDuplicate(O)}}}}},13035:(M,A,O)=>{O.d(A,{d:()=>Q});var S=O(13043),z=O(12776);class Q{constructor(M){this._vertexBuffers={},this.onBeforeRenderObservable=new z.c,this._scene=M}_prepareBuffers(){if(this._vertexBuffers[S.c.PositionKind])return;const M=[];M.push(1,1),M.push(-1,1),M.push(-1,-1),M.push(1,-1),this._vertexBuffers[S.c.PositionKind]=new S.c(this._scene.getEngine(),M,S.c.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const M=[];M.push(0),M.push(1),M.push(2),M.push(0),M.push(2),M.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(M)}_rebuild(){const M=this._vertexBuffers[S.c.PositionKind];M&&(M._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const O=this._scene.activeCamera;return!!O&&(A=A||O._postProcesses.filter((M=>null!=M)),!(!A||0===A.length||!this._scene.postProcessesEnabled)&&(A[0].activate(O,M,null!==A&&void 0!==A),!0))}directRender(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:M.length;const c=this._scene.getEngine();for(let B=0;B<X;B++){var j;if(B<M.length-1)M[B+1].activate(this._scene.activeCamera||this._scene,null===A||void 0===A?void 0:A.texture);else A?c.bindFramebuffer(A,S,void 0,void 0,O,z):Q||c.restoreDefaultFramebuffer(),null===(j=c._debugInsertMarker)||void 0===j||j.call(c,"post process ".concat(M[B].name," output"));const X=M[B],g=X.apply();g&&(X.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),c.bindBuffers(this._vertexBuffers,this._indexBuffer,g),c.drawElementsType(0,0,6),X.onAfterRenderObservable.notifyObservers(g))}c.setDepthBuffer(!0),c.setDepthWrite(!0)}_finalizeFrame(M,A,O,S){let z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Q=this._scene.activeCamera;if(!Q)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(S=S||Q._postProcesses.filter((M=>null!=M))).length||!this._scene.postProcessesEnabled)return;const X=this._scene.getEngine();for(let j=0,B=S.length;j<B;j++){const g=S[j];var c;if(j<B-1)g._outputTexture=S[j+1].activate(Q,null===A||void 0===A?void 0:A.texture);else A?(X.bindFramebuffer(A,O,void 0,void 0,z),g._outputTexture=A):(X.restoreDefaultFramebuffer(),g._outputTexture=null),null===(c=X._debugInsertMarker)||void 0===c||c.call(X,"post process ".concat(S[j].name," output"));if(M)break;const e=g.apply();e&&(g.onBeforeRenderObservable.notifyObservers(e),this._prepareBuffers(),X.bindBuffers(this._vertexBuffers,this._indexBuffer,e),X.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(e))}X.setDepthBuffer(!0),X.setDepthWrite(!0),X.setAlphaMode(0)}dispose(){const M=this._vertexBuffers[S.c.PositionKind];M&&(M.dispose(),this._vertexBuffers[S.c.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},13066:(M,A,O)=>{O.d(A,{d:()=>c});var S=O(13075),z=O(12970);class Q{set opaqueSortCompareFn(M){this._opaqueSortCompareFn=M||Q.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(M){this._alphaTestSortCompareFn=M||Q.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(M){this._transparentSortCompareFn=M||Q.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=M,this._opaqueSubMeshes=new S.f(256),this._transparentSubMeshes=new S.f(256),this._alphaTestSubMeshes=new S.f(256),this._depthOnlySubMeshes=new S.f(256),this._particleSystems=new S.f(256),this._spriteManagers=new S.f(256),this._empty=!0,this._edgesRenderers=new S.e(16),this._scene=A,this.opaqueSortCompareFn=O,this.alphaTestSortCompareFn=z,this.transparentSortCompareFn=Q}render(M,A,O,S){if(M)return void M(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const z=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(z.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),z.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const Q=z.getStencilBuffer();if(z.setStencilBuffer(!1),A&&this._renderSprites(),O&&this._renderParticles(S),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(z.setStencilBuffer(Q),this._scene.useOrderIndependentTransparency){const M=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);M.length&&this._renderTransparent(M)}else this._renderTransparent(this._transparentSubMeshes);z.setAlphaMode(0)}if(z.setStencilBuffer(!1),this._edgesRenderers.length){for(let M=0;M<this._edgesRenderers.length;M++)this._edgesRenderers.data[M].render();z.setAlphaMode(0)}z.setStencilBuffer(Q)}_renderOpaqueSorted(M){Q._RenderSorted(M,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(M){Q._RenderSorted(M,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(M){Q._RenderSorted(M,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(M,A,O,S){let X,c=0;const j=O?O.globalPosition:Q._ZeroVector;if(S)for(;c<M.length;c++)X=M.data[c],X._alphaIndex=X.getMesh().alphaIndex,X._distanceToCamera=z.GA.Distance(X.getBoundingInfo().boundingSphere.centerWorld,j);const B=M.length===M.data.length?M.data:M.data.slice(0,M.length);A&&B.sort(A);const g=B[0].getMesh().HM();for(c=0;c<B.length;c++)if(X=B[c],!g._activeMeshesFrozenButKeepClipping||X.isInFrustum(g._frustumPlanes)){if(S){const M=X.tM();if(M&&M.needDepthPrePass){const A=M.HM().getEngine();A.setColorWrite(!1),A.setAlphaMode(0),X.render(!1),A.setColorWrite(!0)}}X.render(S)}}static defaultTransparentSortCompare(M,A){return M._alphaIndex>A._alphaIndex?1:M._alphaIndex<A._alphaIndex?-1:Q.backToFrontSortCompare(M,A)}static backToFrontSortCompare(M,A){return M._distanceToCamera<A._distanceToCamera?1:M._distanceToCamera>A._distanceToCamera?-1:0}static frontToBackSortCompare(M,A){return M._distanceToCamera<A._distanceToCamera?-1:M._distanceToCamera>A._distanceToCamera?1:0}static PainterSortCompare(M,A){const O=M.getMesh(),S=A.getMesh();return O.material&&S.material?O.material.uniqueId-S.material.uniqueId:O.uniqueId-S.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(M,A,O){void 0===A&&(A=M.getMesh()),void 0===O&&(O=M.tM()),null!==O&&void 0!==O&&(O.needAlphaBlendingForMesh(A)?this._transparentSubMeshes.push(M):O.needAlphaTestingForMesh(A)?(O.needDepthPrePass&&this._depthOnlySubMeshes.push(M),this._alphaTestSubMeshes.push(M)):(O.needDepthPrePass&&this._depthOnlySubMeshes.push(M),this._opaqueSubMeshes.push(M)),A._renderingGroup=this,A._edgesRenderer&&A.isEnabled()&&A.isVisible&&A._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(A._edgesRenderer),this._empty=!1)}dispatchSprites(M){this._spriteManagers.push(M),this._empty=!1}dispatchParticles(M){this._particleSystems.push(M),this._empty=!1}_renderParticles(M){if(0===this._particleSystems.length)return;const A=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let O=0;O<this._particleSystems.length;O++){const S=this._particleSystems.data[O];if(0===(A&&A.layerMask&S.layerMask))continue;const z=S.SA;z.position&&M&&-1===M.indexOf(z)||this._scene._activeParticles.addCount(S.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const M=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let A=0;A<this._spriteManagers.length;A++){const O=this._spriteManagers.data[A];0!==(M&&M.layerMask&O.layerMask)&&O.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}Q._ZeroVector=z.GA.Zero();class X{}class c{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(M){M!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=M,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const M of this._scene.meshes)if(M.Bc)for(const A of M.Bc)A._wasDispatched=!1;if(this._scene.spriteManagers)for(const M of this._scene.spriteManagers)M._wasDispatched=!1;for(const M of this._scene.TJ)M._wasDispatched=!1}constructor(M){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new X,this._maintainStateBetweenFrames=!1,this._scene=M;for(let A=c.MIN_RENDERINGGROUPS;A<c.MAX_RENDERINGGROUPS;A++)this._autoClearDepthStencil[A]={jc:!0,depth:!0,Sc:!0}}getRenderingGroup(M){const A=M||0;return this._prepareRenderingGroup(A),this._renderingGroups[A]}_clearDepthStencilBuffer(){let M=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,M,A),this._depthStencilBufferAlreadyCleaned=!0)}render(M,A,O,S){const z=this._renderingGroupInfo;if(z.wA=this._scene,z.camera=this._scene.activeCamera,z.renderingManager=this,this._scene.spriteManagers&&S)for(let Q=0;Q<this._scene.spriteManagers.length;Q++){const M=this._scene.spriteManagers[Q];this.dispatchSprites(M)}for(let Q=c.MIN_RENDERINGGROUPS;Q<c.MAX_RENDERINGGROUPS;Q++){this._depthStencilBufferAlreadyCleaned=Q===c.MIN_RENDERINGGROUPS;const X=this._renderingGroups[Q];if(!X||X._empty)continue;const j=1<<Q;if(z.renderingGroupId=Q,this._scene.onBeforeRenderingGroupObservable.notifyObservers(z,j),c.AUTOCLEAR){const M=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(Q):this._autoClearDepthStencil[Q];M&&M.jc&&this._clearDepthStencilBuffer(M.depth,M.Sc)}for(const M of this._scene._beforeRenderingGroupDrawStage)M.action(Q);X.render(M,S,O,A);for(const M of this._scene._afterRenderingGroupDrawStage)M.action(Q);this._scene.onAfterRenderingGroupObservable.notifyObservers(z,j)}}reset(){if(!this.maintainStateBetweenFrames)for(let M=c.MIN_RENDERINGGROUPS;M<c.MAX_RENDERINGGROUPS;M++){const A=this._renderingGroups[M];A&&A.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let M=c.MIN_RENDERINGGROUPS;M<c.MAX_RENDERINGGROUPS;M++){const A=this._renderingGroups[M];A&&A.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let M=c.MIN_RENDERINGGROUPS;M<c.MAX_RENDERINGGROUPS;M++){const A=this._renderingGroups[M];A&&A.dispose()}}_prepareRenderingGroup(M){void 0===this._renderingGroups[M]&&(this._renderingGroups[M]=new Q(M,this._scene,this._customOpaqueSortCompareFn[M],this._customAlphaTestSortCompareFn[M],this._customTransparentSortCompareFn[M]))}dispatchSprites(M){this.maintainStateBetweenFrames&&M._wasDispatched||(M._wasDispatched=!0,this.getRenderingGroup(M.renderingGroupId).dispatchSprites(M))}dispatchParticles(M){this.maintainStateBetweenFrames&&M._wasDispatched||(M._wasDispatched=!0,this.getRenderingGroup(M.renderingGroupId).dispatchParticles(M))}dispatch(M,A,O){void 0===A&&(A=M.getMesh()),this.maintainStateBetweenFrames&&M._wasDispatched||(M._wasDispatched=!0,this.getRenderingGroup(A.renderingGroupId).dispatch(M,A,O))}setRenderingOrder(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[M]=A,this._customAlphaTestSortCompareFn[M]=O,this._customTransparentSortCompareFn[M]=S,this._renderingGroups[M]){const A=this._renderingGroups[M];A.opaqueSortCompareFn=this._customOpaqueSortCompareFn[M],A.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[M],A.transparentSortCompareFn=this._customTransparentSortCompareFn[M]}}setRenderingAutoClearDepthStencil(M,A){let O=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[M]={jc:A,depth:O,Sc:S}}getAutoClearDepthStencilSetup(M){return this._autoClearDepthStencil[M]}}c.MAX_RENDERINGGROUPS=4,c.MIN_RENDERINGGROUPS=0,c.AUTOCLEAR=!0}}]);