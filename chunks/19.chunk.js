"use strict";(self.wx5iyvo7rvn=self.wx5iyvo7rvn||[]).push([[19],{11213:(P,e,n)=>{n.d(e,{d:()=>k,g:()=>m});var H=n(11220),S=n(10988),p=n(11225);class k{get C(){return this._isDisposed}constructor(P,e,n){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,P&&P.BP?this._engine=P.BP().getEngine():this._engine=P,this._updatable=n,this._instanced=k,this._divisor=t||1,this._label=C,e instanceof H.e?(this._data=null,this._buffer=e):(this._data=e,this._buffer=null),this.byteStride=m?S:S*Float32Array.BYTES_PER_ELEMENT,p||this.create()}createVertexBuffer(P,e,n,H,S){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6?arguments[6]:void 0;const t=p?e:e*Float32Array.BYTES_PER_ELEMENT,C=H?p?H:H*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new m(this._engine,this,P,this._updatable,!0,C,void 0===S?this._instanced:S,t,n,void 0,void 0,!0,this._divisor||k)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!P&&this._buffer||(P=P||this._data,P&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,P),this._data=P):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(P,this._label),this._data=P):this._buffer=this._engine.createVertexBuffer(P,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.nn>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.nn,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.nn,void 0,this._label));S.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(P){this.create(P)}updateDirectly(P,e,n){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,P,H?e:e*Float32Array.BYTES_PER_ELEMENT,n?n*this.byteStride:void 0),this._data=0===e&&void 0===n?P:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class m{get C(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(P){const e=0!=P;this._instanceDivisor=P,e!==this._instanced&&(this._instanced=e,this._computeHashCode())}get _maxVerticesCount(){const P=this.getData();return P?Array.isArray(P)?P.length/(this.byteStride/4)-this.byteOffset/4:(P.byteLength-this.byteOffset)/this.byteStride:0}constructor(P,e,n,H,S,t,C,R,q,A){let F=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Y=arguments.length>11&&void 0!==arguments[11]&&arguments[11],j=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,z=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let w=!1;if(this.Je=P,"object"===typeof H&&null!==H?(w=H.updatable??!1,S=H.postponeInternalCreation,t=H.stride,C=H.instanced,R=H.offset,q=H.size,A=H.type,F=H.normalized??!1,Y=H.useBytes??!1,j=H.divisor??1,z=H.takeBufferOwnership??!1,this._label=H.label):w=!!H,e instanceof k?(this._buffer=e,this._ownsBuffer=z):(this._buffer=new k(P,e,w,t,S,C,Y,j,this._label),this._ownsBuffer=!0),this.uniqueId=m._Counter++,this._kind=n,void 0===A){const P=this.getData();this.type=P?m.GetDataType(P):m.FLOAT}else this.type=A;const J=(0,p.j)(this.type);Y?(this._size=q||(t?t/J:m.DeduceStride(n)),this.byteStride=t||this._buffer.byteStride||this._size*J,this.byteOffset=R||0):(this._size=q||t||m.DeduceStride(n),this.byteStride=t?t*J:this._buffer.byteStride||this._size*J,this.byteOffset=(R||0)*J),this.normalized=F,this._instanced=void 0!==C&&C,this._instanceDivisor=C?j:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var P;null===(P=this._buffer)||void 0===P||P._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(P,e){const n=this.getData();return n?(0,p.i)(n,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,P,e):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,p.j)(this.type)}getOffset(){return this.byteOffset/(0,p.j)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,p.j)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(P){this._buffer.create(P),this._alignBuffer()}update(P){this._buffer.update(P),this._alignBuffer()}updateDirectly(P,e){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(P,e,void 0,n),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(P,e){(0,p.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,P,this.normalized,((P,n)=>{for(let H=0;H<this._size;H++)e(P[H],n+H)}))}_alignBuffer(){}static DeduceStride(P){switch(P){case m.UVKind:case m.UV2Kind:case m.UV3Kind:case m.UV4Kind:case m.UV5Kind:case m.UV6Kind:return 2;case m.NormalKind:case m.PositionKind:return 3;case m.ColorKind:case m.ColorInstanceKind:case m.MatricesIndicesKind:case m.MatricesIndicesExtraKind:case m.MatricesWeightsKind:case m.MatricesWeightsExtraKind:case m.TangentKind:return 4;default:throw new Error("Invalid kind '"+P+"'")}}static GetDataType(P){return P instanceof Int8Array?m.BYTE:P instanceof Uint8Array?m.UNSIGNED_BYTE:P instanceof Int16Array?m.SHORT:P instanceof Uint16Array?m.UNSIGNED_SHORT:P instanceof Int32Array?m.INT:P instanceof Uint32Array?m.UNSIGNED_INT:m.FLOAT}static GetTypeByteLength(P){return(0,p.j)(P)}static ForEach(P,e,n,H,S,k,m,t){(0,p.h)(P,e,n,H,S,k,m,((P,e)=>{for(let n=0;n<H;n++)t(P[n],e+n)}))}static GetFloatData(P,e,n,H,S,k,m,t){return(0,p.i)(P,e,n,H,S,k,m,t)}}m._Counter=0,m.BYTE=5120,m.UNSIGNED_BYTE=5121,m.SHORT=5122,m.UNSIGNED_SHORT=5123,m.INT=5124,m.UNSIGNED_INT=5125,m.FLOAT=5126,m.PositionKind="position",m.NormalKind="normal",m.TangentKind="tangent",m.UVKind="uv",m.UV2Kind="uv2",m.UV3Kind="uv3",m.UV4Kind="uv4",m.UV5Kind="uv5",m.UV6Kind="uv6",m.ColorKind="color",m.ColorInstanceKind="instanceColor",m.MatricesIndicesKind="matricesIndices",m.MatricesWeightsKind="matricesWeights",m.MatricesIndicesExtraKind="matricesIndicesExtra",m.MatricesWeightsExtraKind="matricesWeightsExtra"},11225:(P,e,n)=>{n.d(e,{c:()=>A,d:()=>q,h:()=>t,i:()=>C,j:()=>k,k:()=>m,o:()=>R});var H=n(10988);function S(P,e,n,H){switch(e){case 5120:{let e=P.getInt8(n);return H&&(e=Math.max(e/127,-1)),e}case 5121:{let e=P.getUint8(n);return H&&(e/=255),e}case 5122:{let e=P.getInt16(n,!0);return H&&(e=Math.max(e/32767,-1)),e}case 5123:{let e=P.getUint16(n,!0);return H&&(e/=65535),e}case 5124:return P.getInt32(n,!0);case 5125:return P.getUint32(n,!0);case 5126:return P.getFloat32(n,!0);default:throw new Error(`Invalid component type ${e}`)}}function p(P,e,n,H,S){switch(e){case 5120:H&&(S=Math.round(127*S)),P.setInt8(n,S);break;case 5121:H&&(S=Math.round(255*S)),P.setUint8(n,S);break;case 5122:H&&(S=Math.round(32767*S)),P.setInt16(n,S,!0);break;case 5123:H&&(S=Math.round(65535*S)),P.setUint16(n,S,!0);break;case 5124:P.setInt32(n,S,!0);break;case 5125:P.setUint32(n,S,!0);break;case 5126:P.setFloat32(n,S,!0);break;default:throw new Error(`Invalid component type ${e}`)}}function k(P){switch(P){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${P}'`)}}function m(P){switch(P){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${P}'`)}}function t(P,e,n,H,m,t,C,R){const q=new Array(H),A=new Array(H);if(P instanceof Array){let S=e/4;const p=n/4;for(let e=0;e<t;e+=H){for(let e=0;e<H;e++)q[e]=A[e]=P[S+e];R(A,e);for(let e=0;e<H;e++)q[e]!==A[e]&&(P[S+e]=A[e]);S+=p}}else{const F=ArrayBuffer.isView(P)?new DataView(P.buffer,P.byteOffset,P.byteLength):new DataView(P),Y=k(m);for(let P=0;P<t;P+=H){for(let P=0,n=e;P<H;P++,n+=Y)q[P]=A[P]=S(F,m,n,C);R(A,P);for(let P=0,n=e;P<H;P++,n+=Y)q[P]!==A[P]&&p(F,m,n,C,A[P]);e+=n}}}function C(P,e,n,S,p,m,C,R){const q=e*k(n),A=C*e;if(5126!==n||p!==q){const H=new Float32Array(A);return t(P,S,p,e,n,A,m,((P,n)=>{for(let S=0;S<e;S++)H[n+S]=P[S]})),H}if(!(P instanceof Array||P instanceof Float32Array)||0!==S||P.length!==A){if(P instanceof Array){const e=S/4;return P.slice(e,e+A)}if(P instanceof ArrayBuffer)return new Float32Array(P,S,A);{const e=P.byteOffset+S;return 0!==(3&e)&&(H.c.Warn("Float array must be aligned to 4-bytes border"),R=!0),R?new Float32Array(P.buffer.slice(e,e+A*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(P.buffer,e,A)}}return R?P.slice():P}function R(P,e,n,S,p,C,R,q){const A=k(n),F=m(n),Y=R*e;if(Array.isArray(P)){if(0!==(3&S)||0!==(3&p))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const H=S/4,k=p/4;if(H+(R-1)*k+e>P.length)throw new Error("Last accessed index is out of bounds.");if(k<e)throw new Error("Data stride cannot be smaller than the component size.");if(k!==e){const H=new F(Y);return t(P,S,p,e,n,Y,C,((P,n)=>{for(let S=0;S<e;S++)H[n+S]=P[S]})),H}return new F(P.slice(H,H+Y))}let j,z=S;P instanceof ArrayBuffer?j=P:(j=P.buffer,z+=P.byteOffset);if(z+(R-1)*p+e*A>j.byteLength)throw new Error("Last accessed byte is out of bounds.");const w=e*A;if(p<w)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(p!==w){const P=new F(Y);return t(j,z,p,e,n,Y,C,((n,H)=>{for(let S=0;S<e;S++)P[H+S]=n[S]})),P}return 1!==A&&0!==(z&A-1)&&(H.c.Warn("Array must be aligned to border of element size. Data will be copied."),q=!0),q?new F(j.slice(z,z+Y*A)):new F(j,z,Y)}function q(P,e,n,S,p,m,C,R){const q=e*k(n),A=C*e;if(R.length!==A)throw new Error("Output length is not valid");if(5126===n&&p===q)if(P instanceof Array){const e=S/4;R.set(P,e)}else if(P instanceof ArrayBuffer){const e=new Float32Array(P,S,A);R.set(e)}else{const e=P.byteOffset+S;if(0!==(3&e))return H.c.Warn("Float array must be aligned to 4-bytes border"),void R.set(new Float32Array(P.buffer.slice(e,e+A*Float32Array.BYTES_PER_ELEMENT)));const n=new Float32Array(P.buffer,e,A);R.set(n)}else t(P,S,p,e,n,A,m,((P,n)=>{for(let H=0;H<e;H++)R[n+H]=P[H]}))}function A(P,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(P)){for(let S=0;S<e;S++)if(P[n+S]-H>65535)return!0;return!1}return 4===P.BYTES_PER_ELEMENT}},11220:(P,e,n)=>{n.d(e,{e:()=>H});class H{get underlyingResource(){return null}constructor(){this.references=0,this.nn=0,this.is32Bits=!1,this.uniqueId=H._Counter++}}H._Counter=0},11263:(P,e,n)=>{n.d(e,{d:()=>S});var H=n(11047);class S{static GetEffect(P){return void 0===P.getPipelineContext?P.effect:P}constructor(P){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=P.createDrawContext(),e&&(this.materialContext=P.createMaterialContext())}setEffect(P,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var H;(this.effect=P,void 0!==e&&(this.defines=e),n)&&(null===(H=this.drawContext)||void 0===H||H.reset())}dispose(){var P;let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const P=this.effect;e?P.dispose():H.c.SetImmediate((()=>{P.getEngine().onEndFrameObservable.addOnce((()=>{P.dispose()}))})),this.effect=null}null===(P=this.drawContext)||void 0===P||P.dispose()}}},11348:(P,e,n)=>{n.d(e,{e:()=>S});var H=n(11190);class S{static GetPlanes(P){const e=[];for(let n=0;n<6;n++)e.push(new H.c(0,0,0,0));return S.GetPlanesToRef(P,e),e}static GetNearPlaneToRef(P,e){const n=P.m;e.normal.x=n[3]+n[2],e.normal.y=n[7]+n[6],e.normal.z=n[11]+n[10],e.d=n[15]+n[14],e.normalize()}static GetFarPlaneToRef(P,e){const n=P.m;e.normal.x=n[3]-n[2],e.normal.y=n[7]-n[6],e.normal.z=n[11]-n[10],e.d=n[15]-n[14],e.normalize()}static GetLeftPlaneToRef(P,e){const n=P.m;e.normal.x=n[3]+n[0],e.normal.y=n[7]+n[4],e.normal.z=n[11]+n[8],e.d=n[15]+n[12],e.normalize()}static GetRightPlaneToRef(P,e){const n=P.m;e.normal.x=n[3]-n[0],e.normal.y=n[7]-n[4],e.normal.z=n[11]-n[8],e.d=n[15]-n[12],e.normalize()}static GetTopPlaneToRef(P,e){const n=P.m;e.normal.x=n[3]-n[1],e.normal.y=n[7]-n[5],e.normal.z=n[11]-n[9],e.d=n[15]-n[13],e.normalize()}static GetBottomPlaneToRef(P,e){const n=P.m;e.normal.x=n[3]+n[1],e.normal.y=n[7]+n[5],e.normal.z=n[11]+n[9],e.d=n[15]+n[13],e.normalize()}static GetPlanesToRef(P,e){S.GetNearPlaneToRef(P,e[0]),S.GetFarPlaneToRef(P,e[1]),S.GetLeftPlaneToRef(P,e[2]),S.GetRightPlaneToRef(P,e[3]),S.GetTopPlaneToRef(P,e[4]),S.GetBottomPlaneToRef(P,e[5])}static IsPointInFrustum(P,e){for(let n=0;n<6;n++)if(e[n].dotCoordinate(P)<0)return!1;return!0}}},11357:(P,e,n)=>{n.d(e,{e:()=>S});var H=n(11002);class S{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(P,e){S.Enabled&&(this._current+=P,e&&this._fetchResult())}beginMonitoring(){S.Enabled&&(this._startMonitoringTime=H.c.Now)}endMonitoring(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!S.Enabled)return;P&&this.fetchNewFrame();const e=H.c.Now;this._current=e-this._startMonitoringTime,P&&this._fetchResult()}Ve(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const P=H.c.Now;P-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=P,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}S.Enabled=!0},11239:(P,e,n)=>{n.d(e,{e:()=>S,f:()=>H});class H{constructor(P){this.length=0,this.data=new Array(P),this._id=H._GlobalId++}push(P){this.data[this.length++]=P,this.length>this.data.length&&(this.data.length*=2)}forEach(P){for(let e=0;e<this.length;e++)P(this.data[e])}sort(P){this.data.sort(P)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(P){if(0!==P.length){this.length+P.length>this.data.length&&(this.data.length=2*(this.length+P.length));for(let e=0;e<P.length;e++)this.data[this.length++]=(P.data||P)[e]}}indexOf(P){const e=this.data.indexOf(P);return e>=this.length?-1:e}contains(P){return-1!==this.indexOf(P)}}H._GlobalId=0;class S extends H{constructor(){super(...arguments),this._duplicateId=0}push(P){super.push(P),P.__smartArrayFlags||(P.__smartArrayFlags={}),P.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(P){return(!P.__smartArrayFlags||P.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(P),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(P){if(0!==P.length){this.length+P.length>this.data.length&&(this.data.length=2*(this.length+P.length));for(let e=0;e<P.length;e++){const n=(P.data||P)[e];this.pushNoDuplicate(n)}}}}},11207:(P,e,n)=>{n.d(e,{b:()=>p});var H=n(11213),S=n(10976);class p{constructor(P){this._vertexBuffers={},this.onBeforeRenderObservable=new S.b,this._scene=P}_prepareBuffers(){if(this._vertexBuffers[H.g.PositionKind])return;const P=[];P.push(1,1),P.push(-1,1),P.push(-1,-1),P.push(1,-1),this._vertexBuffers[H.g.PositionKind]=new H.g(this._scene.getEngine(),P,H.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const P=[];P.push(0),P.push(1),P.push(2),P.push(0),P.push(2),P.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(P)}_rebuild(){const P=this._vertexBuffers[H.g.PositionKind];P&&(P._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this._scene.activeCamera;return!!n&&(e=e||n._postProcesses.filter((P=>null!=P)),!(!e||0===e.length||!this._scene.postProcessesEnabled)&&(e[0].activate(n,P,null!==e&&void 0!==e),!0))}directRender(P){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:P.length;const m=this._scene.getEngine();for(let C=0;C<k;C++){var t;if(C<P.length-1)P[C+1].activate(this._scene.activeCamera||this._scene,null===e||void 0===e?void 0:e.texture);else e?m.bindFramebuffer(e,H,void 0,void 0,n,S):p||m.restoreDefaultFramebuffer(),null===(t=m._debugInsertMarker)||void 0===t||t.call(m,`post process ${P[C].name} output`);const k=P[C],R=k.apply();R&&(k.onBeforeRenderObservable.notifyObservers(R),this._prepareBuffers(),m.bindBuffers(this._vertexBuffers,this._indexBuffer,R),m.drawElementsType(0,0,6),k.onAfterRenderObservable.notifyObservers(R))}m.setDepthBuffer(!0),m.setDepthWrite(!0)}_finalizeFrame(P,e,n,H){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const p=this._scene.activeCamera;if(!p)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(H=H||p._postProcesses.filter((P=>null!=P))).length||!this._scene.postProcessesEnabled)return;const k=this._scene.getEngine();for(let t=0,C=H.length;t<C;t++){const R=H[t];var m;if(t<C-1)R._outputTexture=H[t+1].activate(p,null===e||void 0===e?void 0:e.texture);else e?(k.bindFramebuffer(e,n,void 0,void 0,S),R._outputTexture=e):(k.restoreDefaultFramebuffer(),R._outputTexture=null),null===(m=k._debugInsertMarker)||void 0===m||m.call(k,`post process ${H[t].name} output`);if(P)break;const q=R.apply();q&&(R.onBeforeRenderObservable.notifyObservers(q),this._prepareBuffers(),k.bindBuffers(this._vertexBuffers,this._indexBuffer,q),k.drawElementsType(0,0,6),R.onAfterRenderObservable.notifyObservers(q))}k.setDepthBuffer(!0),k.setDepthWrite(!0),k.setAlphaMode(0)}dispose(){const P=this._vertexBuffers[H.g.PositionKind];P&&(P.dispose(),this._vertexBuffers[H.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11233:(P,e,n)=>{n.d(e,{c:()=>m});var H=n(11239),S=n(11133);class p{set opaqueSortCompareFn(P){this._opaqueSortCompareFn=P||p.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(P){this._alphaTestSortCompareFn=P||p.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(P){this._transparentSortCompareFn=P||p.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(P,e){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=P,this._opaqueSubMeshes=new H.f(256),this._transparentSubMeshes=new H.f(256),this._alphaTestSubMeshes=new H.f(256),this._depthOnlySubMeshes=new H.f(256),this._particleSystems=new H.f(256),this._spriteManagers=new H.f(256),this._empty=!0,this._edgesRenderers=new H.e(16),this._scene=e,this.opaqueSortCompareFn=n,this.alphaTestSortCompareFn=S,this.transparentSortCompareFn=p}render(P,e,n,H){if(P)return void P(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const S=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(S.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),S.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const p=S.getStencilBuffer();if(S.setStencilBuffer(!1),e&&this._renderSprites(),n&&this._renderParticles(H),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(S.setStencilBuffer(p),this._scene.useOrderIndependentTransparency){const P=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);P.length&&this._renderTransparent(P)}else this._renderTransparent(this._transparentSubMeshes);S.setAlphaMode(0)}if(S.setStencilBuffer(!1),this._edgesRenderers.length){for(let P=0;P<this._edgesRenderers.length;P++)this._edgesRenderers.data[P].render();S.setAlphaMode(0)}S.setStencilBuffer(p)}_renderOpaqueSorted(P){p._RenderSorted(P,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(P){p._RenderSorted(P,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(P){p._RenderSorted(P,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(P,e,n,H){let k,m=0;const t=n?n.globalPosition:p._ZeroVector;if(H)for(;m<P.length;m++)k=P.data[m],k._alphaIndex=k.getMesh().alphaIndex,k._distanceToCamera=S.Ie.Distance(k.getBoundingInfo().boundingSphere.centerWorld,t);const C=P.length===P.data.length?P.data:P.data.slice(0,P.length);e&&C.sort(e);const R=C[0].getMesh().BP();for(m=0;m<C.length;m++)if(k=C[m],!R._activeMeshesFrozenButKeepClipping||k.isInFrustum(R._frustumPlanes)){if(H){const P=k.yP();if(P&&P.needDepthPrePass){const e=P.BP().getEngine();e.setColorWrite(!1),e.setAlphaMode(0),k.render(!1),e.setColorWrite(!0)}}k.render(H)}}static defaultTransparentSortCompare(P,e){return P._alphaIndex>e._alphaIndex?1:P._alphaIndex<e._alphaIndex?-1:p.backToFrontSortCompare(P,e)}static backToFrontSortCompare(P,e){return P._distanceToCamera<e._distanceToCamera?1:P._distanceToCamera>e._distanceToCamera?-1:0}static frontToBackSortCompare(P,e){return P._distanceToCamera<e._distanceToCamera?-1:P._distanceToCamera>e._distanceToCamera?1:0}static PainterSortCompare(P,e){const n=P.getMesh(),H=e.getMesh();return n.material&&H.material?n.material.uniqueId-H.material.uniqueId:n.uniqueId-H.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(P,e,n){void 0===e&&(e=P.getMesh()),void 0===n&&(n=P.yP()),null!==n&&void 0!==n&&(n.needAlphaBlendingForMesh(e)?this._transparentSubMeshes.push(P):n.needAlphaTestingForMesh(e)?(n.needDepthPrePass&&this._depthOnlySubMeshes.push(P),this._alphaTestSubMeshes.push(P)):(n.needDepthPrePass&&this._depthOnlySubMeshes.push(P),this._opaqueSubMeshes.push(P)),e._renderingGroup=this,e._edgesRenderer&&e.isEnabled()&&e.isVisible&&e._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(e._edgesRenderer),this._empty=!1)}dispatchSprites(P){this._spriteManagers.push(P),this._empty=!1}dispatchParticles(P){this._particleSystems.push(P),this._empty=!1}_renderParticles(P){if(0===this._particleSystems.length)return;const e=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let n=0;n<this._particleSystems.length;n++){const H=this._particleSystems.data[n];if(0===(e&&e.layerMask&H.layerMask))continue;const S=H.He;S.position&&P&&-1===P.indexOf(S)||this._scene._activeParticles.addCount(H.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const P=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let e=0;e<this._spriteManagers.length;e++){const n=this._spriteManagers.data[e];0!==(P&&P.layerMask&n.layerMask)&&n.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}p._ZeroVector=S.Ie.Zero();class k{}class m{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(P){P!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=P,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const P of this._scene.meshes)if(P.ye)for(const e of P.ye)e._wasDispatched=!1;if(this._scene.spriteManagers)for(const P of this._scene.spriteManagers)P._wasDispatched=!1;for(const P of this._scene.sq)P._wasDispatched=!1}constructor(P){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new k,this._maintainStateBetweenFrames=!1,this._scene=P;for(let e=m.MIN_RENDERINGGROUPS;e<m.MAX_RENDERINGGROUPS;e++)this._autoClearDepthStencil[e]={oe:!0,depth:!0,stencil:!0}}getRenderingGroup(P){const e=P||0;return this._prepareRenderingGroup(e),this._renderingGroups[e]}_clearDepthStencilBuffer(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,P,e),this._depthStencilBufferAlreadyCleaned=!0)}render(P,e,n,H){const S=this._renderingGroupInfo;if(S.Te=this._scene,S.camera=this._scene.activeCamera,S.renderingManager=this,this._scene.spriteManagers&&H)for(let p=0;p<this._scene.spriteManagers.length;p++){const P=this._scene.spriteManagers[p];this.dispatchSprites(P)}for(let p=m.MIN_RENDERINGGROUPS;p<m.MAX_RENDERINGGROUPS;p++){this._depthStencilBufferAlreadyCleaned=p===m.MIN_RENDERINGGROUPS;const k=this._renderingGroups[p];if(!k||k._empty)continue;const t=1<<p;if(S.renderingGroupId=p,this._scene.onBeforeRenderingGroupObservable.notifyObservers(S,t),m.AUTOCLEAR){const P=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(p):this._autoClearDepthStencil[p];P&&P.oe&&this._clearDepthStencilBuffer(P.depth,P.stencil)}for(const P of this._scene._beforeRenderingGroupDrawStage)P.action(p);k.render(P,H,n,e);for(const P of this._scene._afterRenderingGroupDrawStage)P.action(p);this._scene.onAfterRenderingGroupObservable.notifyObservers(S,t)}}reset(){if(!this.maintainStateBetweenFrames)for(let P=m.MIN_RENDERINGGROUPS;P<m.MAX_RENDERINGGROUPS;P++){const e=this._renderingGroups[P];e&&e.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let P=m.MIN_RENDERINGGROUPS;P<m.MAX_RENDERINGGROUPS;P++){const e=this._renderingGroups[P];e&&e.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let P=m.MIN_RENDERINGGROUPS;P<m.MAX_RENDERINGGROUPS;P++){const e=this._renderingGroups[P];e&&e.dispose()}}_prepareRenderingGroup(P){void 0===this._renderingGroups[P]&&(this._renderingGroups[P]=new p(P,this._scene,this._customOpaqueSortCompareFn[P],this._customAlphaTestSortCompareFn[P],this._customTransparentSortCompareFn[P]))}dispatchSprites(P){this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(P.renderingGroupId).dispatchSprites(P))}dispatchParticles(P){this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(P.renderingGroupId).dispatchParticles(P))}dispatch(P,e,n){void 0===e&&(e=P.getMesh()),this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatch(P,e,n))}setRenderingOrder(P){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[P]=e,this._customAlphaTestSortCompareFn[P]=n,this._customTransparentSortCompareFn[P]=H,this._renderingGroups[P]){const e=this._renderingGroups[P];e.opaqueSortCompareFn=this._customOpaqueSortCompareFn[P],e.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[P],e.transparentSortCompareFn=this._customTransparentSortCompareFn[P]}}setRenderingAutoClearDepthStencil(P,e){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[P]={oe:e,depth:n,stencil:H}}getAutoClearDepthStencilSetup(P){return this._autoClearDepthStencil[P]}}m.MAX_RENDERINGGROUPS=4,m.MIN_RENDERINGGROUPS=0,m.AUTOCLEAR=!0}}]);