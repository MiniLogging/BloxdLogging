"use strict";(self.v2pspxy442l=self.v2pspxy442l||[]).push([[19],{12506:(l,a,N)=>{N.d(a,{e:()=>Z,h:()=>w});var U=N(12514),c=N(12268),K=N(12520);class Z{get T(){return this._isDisposed}constructor(l,a,N){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,K=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],S=arguments.length>7?arguments[7]:void 0,T=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,l&&l.bl?this._engine=l.bl().getEngine():this._engine=l,this._updatable=N,this._instanced=Z,this._divisor=S||1,this._label=T,a instanceof U.d?(this._data=null,this._buffer=a):(this._data=a,this._buffer=null),this.byteStride=w?c:c*Float32Array.BYTES_PER_ELEMENT,K||this.create()}createVertexBuffer(l,a,N,U,c){let K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6?arguments[6]:void 0;const S=K?a:a*Float32Array.BYTES_PER_ELEMENT,T=U?K?U:U*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new w(this._engine,this,l,this._updatable,!0,T,void 0===c?this._instanced:c,S,N,void 0,void 0,!0,this._divisor||Z)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!l&&this._buffer||(l=l||this._data,l&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,l),this._data=l):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(l,this._label),this._data=l):this._buffer=this._engine.createVertexBuffer(l,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.kN>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.kN,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.kN,void 0,this._label));c.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(l){this.create(l)}updateDirectly(l,a,N){let U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,l,U?a:a*Float32Array.BYTES_PER_ELEMENT,N?N*this.byteStride:void 0),this._data=0===a&&void 0===N?l:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class w{get T(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(l){const a=0!=l;this._instanceDivisor=l,a!==this._instanced&&(this._instanced=a,this._computeHashCode())}get _maxVerticesCount(){const l=this.getData();return l?Array.isArray(l)?l.length/(this.byteStride/4)-this.byteOffset/4:(l.byteLength-this.byteOffset)/this.byteStride:0}constructor(l,a,N,U,c,S,T,J,n,y){let H=arguments.length>10&&void 0!==arguments[10]&&arguments[10],u=arguments.length>11&&void 0!==arguments[11]&&arguments[11],W=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,B=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let Y=!1;if(this.Ha=l,"object"===typeof U&&null!==U?(Y=U.updatable??!1,c=U.postponeInternalCreation,S=U.stride,T=U.instanced,J=U.offset,n=U.size,y=U.type,H=U.normalized??!1,u=U.useBytes??!1,W=U.divisor??1,B=U.takeBufferOwnership??!1,this._label=U.label):Y=!!U,a instanceof Z?(this._buffer=a,this._ownsBuffer=B):(this._buffer=new Z(l,a,Y,S,c,T,u,W,this._label),this._ownsBuffer=!0),this.uniqueId=w._Counter++,this._kind=N,void 0===y){const l=this.getData();this.type=l?w.GetDataType(l):w.FLOAT}else this.type=y;const C=(0,K.n)(this.type);u?(this._size=n||(S?S/C:w.DeduceStride(N)),this.byteStride=S||this._buffer.byteStride||this._size*C,this.byteOffset=J||0):(this._size=n||S||w.DeduceStride(N),this.byteStride=S?S*C:this._buffer.byteStride||this._size*C,this.byteOffset=(J||0)*C),this.normalized=H,this._instanced=void 0!==T&&T,this._instanceDivisor=T?W:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var l;null===(l=this._buffer)||void 0===l||l._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(l,a){const N=this.getData();return N?(0,K.m)(N,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,l,a):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,K.n)(this.type)}getOffset(){return this.byteOffset/(0,K.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,K.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(l){this._buffer.create(l),this._alignBuffer()}update(l){this._buffer.update(l),this._alignBuffer()}updateDirectly(l,a){let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(l,a,void 0,N),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(l,a){(0,K.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,l,this.normalized,((l,N)=>{for(let U=0;U<this._size;U++)a(l[U],N+U)}))}_alignBuffer(){}static DeduceStride(l){switch(l){case w.UVKind:case w.UV2Kind:case w.UV3Kind:case w.UV4Kind:case w.UV5Kind:case w.UV6Kind:return 2;case w.NormalKind:case w.PositionKind:return 3;case w.ColorKind:case w.ColorInstanceKind:case w.MatricesIndicesKind:case w.MatricesIndicesExtraKind:case w.MatricesWeightsKind:case w.MatricesWeightsExtraKind:case w.TangentKind:return 4;default:throw new Error("Invalid kind '"+l+"'")}}static GetDataType(l){return l instanceof Int8Array?w.BYTE:l instanceof Uint8Array?w.UNSIGNED_BYTE:l instanceof Int16Array?w.SHORT:l instanceof Uint16Array?w.UNSIGNED_SHORT:l instanceof Int32Array?w.INT:l instanceof Uint32Array?w.UNSIGNED_INT:w.FLOAT}static GetTypeByteLength(l){return(0,K.n)(l)}static ForEach(l,a,N,U,c,Z,w,S){(0,K.i)(l,a,N,U,c,Z,w,((l,a)=>{for(let N=0;N<U;N++)S(l[N],a+N)}))}static GetFloatData(l,a,N,U,c,Z,w,S){return(0,K.m)(l,a,N,U,c,Z,w,S)}}w._Counter=0,w.BYTE=5120,w.UNSIGNED_BYTE=5121,w.SHORT=5122,w.UNSIGNED_SHORT=5123,w.INT=5124,w.UNSIGNED_INT=5125,w.FLOAT=5126,w.PositionKind="position",w.NormalKind="normal",w.TangentKind="tangent",w.UVKind="uv",w.UV2Kind="uv2",w.UV3Kind="uv3",w.UV4Kind="uv4",w.UV5Kind="uv5",w.UV6Kind="uv6",w.ColorKind="color",w.ColorInstanceKind="instanceColor",w.MatricesIndicesKind="matricesIndices",w.MatricesWeightsKind="matricesWeights",w.MatricesIndicesExtraKind="matricesIndicesExtra",w.MatricesWeightsExtraKind="matricesWeightsExtra"},12520:(l,a,N)=>{N.d(a,{b:()=>y,e:()=>n,i:()=>S,m:()=>T,n:()=>Z,r:()=>w,v:()=>J});var U=N(12268);function c(l,a,N,U){switch(a){case 5120:{let a=l.getInt8(N);return U&&(a=Math.max(a/127,-1)),a}case 5121:{let a=l.getUint8(N);return U&&(a/=255),a}case 5122:{let a=l.getInt16(N,!0);return U&&(a=Math.max(a/32767,-1)),a}case 5123:{let a=l.getUint16(N,!0);return U&&(a/=65535),a}case 5124:return l.getInt32(N,!0);case 5125:return l.getUint32(N,!0);case 5126:return l.getFloat32(N,!0);default:throw new Error(`Invalid component type ${a}`)}}function K(l,a,N,U,c){switch(a){case 5120:U&&(c=Math.round(127*c)),l.setInt8(N,c);break;case 5121:U&&(c=Math.round(255*c)),l.setUint8(N,c);break;case 5122:U&&(c=Math.round(32767*c)),l.setInt16(N,c,!0);break;case 5123:U&&(c=Math.round(65535*c)),l.setUint16(N,c,!0);break;case 5124:l.setInt32(N,c,!0);break;case 5125:l.setUint32(N,c,!0);break;case 5126:l.setFloat32(N,c,!0);break;default:throw new Error(`Invalid component type ${a}`)}}function Z(l){switch(l){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${l}'`)}}function w(l){switch(l){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${l}'`)}}function S(l,a,N,U,w,S,T,J){const n=new Array(U),y=new Array(U);if(l instanceof Array){let c=a/4;const K=N/4;for(let a=0;a<S;a+=U){for(let a=0;a<U;a++)n[a]=y[a]=l[c+a];J(y,a);for(let a=0;a<U;a++)n[a]!==y[a]&&(l[c+a]=y[a]);c+=K}}else{const H=ArrayBuffer.isView(l)?new DataView(l.buffer,l.byteOffset,l.byteLength):new DataView(l),u=Z(w);for(let l=0;l<S;l+=U){for(let l=0,N=a;l<U;l++,N+=u)n[l]=y[l]=c(H,w,N,T);J(y,l);for(let l=0,N=a;l<U;l++,N+=u)n[l]!==y[l]&&K(H,w,N,T,y[l]);a+=N}}}function T(l,a,N,c,K,w,T,J){const n=a*Z(N),y=T*a;if(5126!==N||K!==n){const U=new Float32Array(y);return S(l,c,K,a,N,y,w,((l,N)=>{for(let c=0;c<a;c++)U[N+c]=l[c]})),U}if(!(l instanceof Array||l instanceof Float32Array)||0!==c||l.length!==y){if(l instanceof Array){const a=c/4;return l.slice(a,a+y)}if(l instanceof ArrayBuffer)return new Float32Array(l,c,y);{const a=l.byteOffset+c;return 0!==(3&a)&&(U.b.Warn("Float array must be aligned to 4-bytes border"),J=!0),J?new Float32Array(l.buffer.slice(a,a+y*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(l.buffer,a,y)}}return J?l.slice():l}function J(l,a,N,c,K,T,J,n){const y=Z(N),H=w(N),u=J*a;if(Array.isArray(l)){if(0!==(3&c)||0!==(3&K))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const U=c/4,Z=K/4;if(U+(J-1)*Z+a>l.length)throw new Error("Last accessed index is out of bounds.");if(Z<a)throw new Error("Data stride cannot be smaller than the component size.");if(Z!==a){const U=new H(u);return S(l,c,K,a,N,u,T,((l,N)=>{for(let c=0;c<a;c++)U[N+c]=l[c]})),U}return new H(l.slice(U,U+u))}let W,B=c;l instanceof ArrayBuffer?W=l:(W=l.buffer,B+=l.byteOffset);if(B+(J-1)*K+a*y>W.byteLength)throw new Error("Last accessed byte is out of bounds.");const Y=a*y;if(K<Y)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(K!==Y){const l=new H(u);return S(W,B,K,a,N,u,T,((N,U)=>{for(let c=0;c<a;c++)l[U+c]=N[c]})),l}return 1!==y&&0!==(B&y-1)&&(U.b.Warn("Array must be aligned to border of element size. Data will be copied."),n=!0),n?new H(W.slice(B,B+u*y)):new H(W,B,u)}function n(l,a,N,c,K,w,T,J){const n=a*Z(N),y=T*a;if(J.length!==y)throw new Error("Output length is not valid");if(5126===N&&K===n)if(l instanceof Array){const a=c/4;J.set(l,a)}else if(l instanceof ArrayBuffer){const a=new Float32Array(l,c,y);J.set(a)}else{const a=l.byteOffset+c;if(0!==(3&a))return U.b.Warn("Float array must be aligned to 4-bytes border"),void J.set(new Float32Array(l.buffer.slice(a,a+y*Float32Array.BYTES_PER_ELEMENT)));const N=new Float32Array(l.buffer,a,y);J.set(N)}else S(l,c,K,a,N,y,w,((l,N)=>{for(let U=0;U<a;U++)J[N+U]=l[U]}))}function y(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(l)){for(let c=0;c<a;c++)if(l[N+c]-U>65535)return!0;return!1}return 4===l.BYTES_PER_ELEMENT}},12514:(l,a,N)=>{N.d(a,{d:()=>U});class U{get underlyingResource(){return null}constructor(){this.references=0,this.kN=0,this.is32Bits=!1,this.uniqueId=U._Counter++}}U._Counter=0},12548:(l,a,N)=>{N.d(a,{d:()=>c});var U=N(12328);class c{static GetEffect(l){return void 0===l.getPipelineContext?l.effect:l}constructor(l){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=l.createDrawContext(),a&&(this.materialContext=l.createMaterialContext())}setEffect(l,a){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var U;(this.effect=l,void 0!==a&&(this.defines=a),N)&&(null===(U=this.drawContext)||void 0===U||U.reset())}dispose(){var l;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const l=this.effect;a?l.dispose():U.b.SetImmediate((()=>{l.getEngine().onEndFrameObservable.addOnce((()=>{l.dispose()}))})),this.effect=null}null===(l=this.drawContext)||void 0===l||l.dispose()}}},12639:(l,a,N)=>{N.d(a,{c:()=>c});var U=N(12483);class c{static GetPlanes(l){const a=[];for(let N=0;N<6;N++)a.push(new U.e(0,0,0,0));return c.GetPlanesToRef(l,a),a}static GetNearPlaneToRef(l,a){const N=l.m;a.normal.x=N[3]+N[2],a.normal.y=N[7]+N[6],a.normal.z=N[11]+N[10],a.d=N[15]+N[14],a.normalize()}static GetFarPlaneToRef(l,a){const N=l.m;a.normal.x=N[3]-N[2],a.normal.y=N[7]-N[6],a.normal.z=N[11]-N[10],a.d=N[15]-N[14],a.normalize()}static GetLeftPlaneToRef(l,a){const N=l.m;a.normal.x=N[3]+N[0],a.normal.y=N[7]+N[4],a.normal.z=N[11]+N[8],a.d=N[15]+N[12],a.normalize()}static GetRightPlaneToRef(l,a){const N=l.m;a.normal.x=N[3]-N[0],a.normal.y=N[7]-N[4],a.normal.z=N[11]-N[8],a.d=N[15]-N[12],a.normalize()}static GetTopPlaneToRef(l,a){const N=l.m;a.normal.x=N[3]-N[1],a.normal.y=N[7]-N[5],a.normal.z=N[11]-N[9],a.d=N[15]-N[13],a.normalize()}static GetBottomPlaneToRef(l,a){const N=l.m;a.normal.x=N[3]+N[1],a.normal.y=N[7]+N[5],a.normal.z=N[11]+N[9],a.d=N[15]+N[13],a.normalize()}static GetPlanesToRef(l,a){c.GetNearPlaneToRef(l,a[0]),c.GetFarPlaneToRef(l,a[1]),c.GetLeftPlaneToRef(l,a[2]),c.GetRightPlaneToRef(l,a[3]),c.GetTopPlaneToRef(l,a[4]),c.GetBottomPlaneToRef(l,a[5])}static IsPointInFrustum(l,a){for(let N=0;N<6;N++)if(a[N].dotCoordinate(l)<0)return!1;return!0}}},12655:(l,a,N)=>{N.d(a,{e:()=>c});var U=N(12283);class c{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(l,a){c.Enabled&&(this._current+=l,a&&this._fetchResult())}beginMonitoring(){c.Enabled&&(this._startMonitoringTime=U.d.Now)}endMonitoring(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!c.Enabled)return;l&&this.fetchNewFrame();const a=U.d.Now;this._current=a-this._startMonitoringTime,l&&this._fetchResult()}Sc(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const l=U.d.Now;l-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=l,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}c.Enabled=!0},12530:(l,a,N)=>{N.d(a,{e:()=>c,f:()=>U});class U{constructor(l){this.length=0,this.data=new Array(l),this._id=U._GlobalId++}push(l){this.data[this.length++]=l,this.length>this.data.length&&(this.data.length*=2)}forEach(l){for(let a=0;a<this.length;a++)l(this.data[a])}sort(l){this.data.sort(l)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(l){if(0!==l.length){this.length+l.length>this.data.length&&(this.data.length=2*(this.length+l.length));for(let a=0;a<l.length;a++)this.data[this.length++]=(l.data||l)[a]}}indexOf(l){const a=this.data.indexOf(l);return a>=this.length?-1:a}contains(l){return-1!==this.indexOf(l)}}U._GlobalId=0;class c extends U{constructor(){super(...arguments),this._duplicateId=0}push(l){super.push(l),l.__smartArrayFlags||(l.__smartArrayFlags={}),l.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(l){return(!l.__smartArrayFlags||l.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(l),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(l){if(0!==l.length){this.length+l.length>this.data.length&&(this.data.length=2*(this.length+l.length));for(let a=0;a<l.length;a++){const N=(l.data||l)[a];this.pushNoDuplicate(N)}}}}},12500:(l,a,N)=>{N.d(a,{b:()=>K});var U=N(12506),c=N(12260);class K{constructor(l){this._vertexBuffers={},this.onBeforeRenderObservable=new c.e,this._scene=l}_prepareBuffers(){if(this._vertexBuffers[U.h.PositionKind])return;const l=[];l.push(1,1),l.push(-1,1),l.push(-1,-1),l.push(1,-1),this._vertexBuffers[U.h.PositionKind]=new U.h(this._scene.getEngine(),l,U.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const l=[];l.push(0),l.push(1),l.push(2),l.push(0),l.push(2),l.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(l)}_rebuild(){const l=this._vertexBuffers[U.h.PositionKind];l&&(l._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const N=this._scene.activeCamera;return!!N&&(a=a||N._postProcesses.filter((l=>null!=l)),!(!a||0===a.length||!this._scene.postProcessesEnabled)&&(a[0].activate(N,l,null!==a&&void 0!==a),!0))}directRender(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:l.length;const w=this._scene.getEngine();for(let T=0;T<Z;T++){var S;if(T<l.length-1)l[T+1].activate(this._scene.activeCamera||this._scene,null===a||void 0===a?void 0:a.texture);else a?w.bindFramebuffer(a,U,void 0,void 0,N,c):K||w.restoreDefaultFramebuffer(),null===(S=w._debugInsertMarker)||void 0===S||S.call(w,`post process ${l[T].name} output`);const Z=l[T],J=Z.apply();J&&(Z.onBeforeRenderObservable.notifyObservers(J),this._prepareBuffers(),w.bindBuffers(this._vertexBuffers,this._indexBuffer,J),w.drawElementsType(0,0,6),Z.onAfterRenderObservable.notifyObservers(J))}w.setDepthBuffer(!0),w.setDepthWrite(!0)}_finalizeFrame(l,a,N,U){let c=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const K=this._scene.activeCamera;if(!K)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(U=U||K._postProcesses.filter((l=>null!=l))).length||!this._scene.postProcessesEnabled)return;const Z=this._scene.getEngine();for(let S=0,T=U.length;S<T;S++){const J=U[S];var w;if(S<T-1)J._outputTexture=U[S+1].activate(K,null===a||void 0===a?void 0:a.texture);else a?(Z.bindFramebuffer(a,N,void 0,void 0,c),J._outputTexture=a):(Z.restoreDefaultFramebuffer(),J._outputTexture=null),null===(w=Z._debugInsertMarker)||void 0===w||w.call(Z,`post process ${U[S].name} output`);if(l)break;const n=J.apply();n&&(J.onBeforeRenderObservable.notifyObservers(n),this._prepareBuffers(),Z.bindBuffers(this._vertexBuffers,this._indexBuffer,n),Z.drawElementsType(0,0,6),J.onAfterRenderObservable.notifyObservers(n))}Z.setDepthBuffer(!0),Z.setDepthWrite(!0),Z.setAlphaMode(0)}dispose(){const l=this._vertexBuffers[U.h.PositionKind];l&&(l.dispose(),this._vertexBuffers[U.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12524:(l,a,N)=>{N.d(a,{d:()=>w});var U=N(12530),c=N(12447);class K{set opaqueSortCompareFn(l){this._opaqueSortCompareFn=l||K.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(l){this._alphaTestSortCompareFn=l||K.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(l){this._transparentSortCompareFn=l||K.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(l,a){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=l,this._opaqueSubMeshes=new U.f(256),this._transparentSubMeshes=new U.f(256),this._alphaTestSubMeshes=new U.f(256),this._depthOnlySubMeshes=new U.f(256),this._particleSystems=new U.f(256),this._spriteManagers=new U.f(256),this._empty=!0,this._edgesRenderers=new U.e(16),this._scene=a,this.opaqueSortCompareFn=N,this.alphaTestSortCompareFn=c,this.transparentSortCompareFn=K}render(l,a,N,U){if(l)return void l(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const c=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(c.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),c.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const K=c.getStencilBuffer();if(c.setStencilBuffer(!1),a&&this._renderSprites(),N&&this._renderParticles(U),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(c.setStencilBuffer(K),this._scene.useOrderIndependentTransparency){const l=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);l.length&&this._renderTransparent(l)}else this._renderTransparent(this._transparentSubMeshes);c.setAlphaMode(0)}if(c.setStencilBuffer(!1),this._edgesRenderers.length){for(let l=0;l<this._edgesRenderers.length;l++)this._edgesRenderers.data[l].render();c.setAlphaMode(0)}c.setStencilBuffer(K)}_renderOpaqueSorted(l){K._RenderSorted(l,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(l){K._RenderSorted(l,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(l){K._RenderSorted(l,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(l,a,N,U){let Z,w=0;const S=N?N.globalPosition:K._ZeroVector;if(U)for(;w<l.length;w++)Z=l.data[w],Z._alphaIndex=Z.getMesh().alphaIndex,Z._distanceToCamera=c.ua.Distance(Z.getBoundingInfo().boundingSphere.centerWorld,S);const T=l.length===l.data.length?l.data:l.data.slice(0,l.length);a&&T.sort(a);const J=T[0].getMesh().bl();for(w=0;w<T.length;w++)if(Z=T[w],!J._activeMeshesFrozenButKeepClipping||Z.isInFrustum(J._frustumPlanes)){if(U){const l=Z.Rl();if(l&&l.needDepthPrePass){const a=l.bl().getEngine();a.setColorWrite(!1),a.setAlphaMode(0),Z.render(!1),a.setColorWrite(!0)}}Z.render(U)}}static defaultTransparentSortCompare(l,a){return l._alphaIndex>a._alphaIndex?1:l._alphaIndex<a._alphaIndex?-1:K.backToFrontSortCompare(l,a)}static backToFrontSortCompare(l,a){return l._distanceToCamera<a._distanceToCamera?1:l._distanceToCamera>a._distanceToCamera?-1:0}static frontToBackSortCompare(l,a){return l._distanceToCamera<a._distanceToCamera?-1:l._distanceToCamera>a._distanceToCamera?1:0}static PainterSortCompare(l,a){const N=l.getMesh(),U=a.getMesh();return N.material&&U.material?N.material.uniqueId-U.material.uniqueId:N.uniqueId-U.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(l,a,N){void 0===a&&(a=l.getMesh()),void 0===N&&(N=l.Rl()),null!==N&&void 0!==N&&(N.needAlphaBlendingForMesh(a)?this._transparentSubMeshes.push(l):N.needAlphaTestingForMesh(a)?(N.needDepthPrePass&&this._depthOnlySubMeshes.push(l),this._alphaTestSubMeshes.push(l)):(N.needDepthPrePass&&this._depthOnlySubMeshes.push(l),this._opaqueSubMeshes.push(l)),a._renderingGroup=this,a._edgesRenderer&&a.isEnabled()&&a.isVisible&&a._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(a._edgesRenderer),this._empty=!1)}dispatchSprites(l){this._spriteManagers.push(l),this._empty=!1}dispatchParticles(l){this._particleSystems.push(l),this._empty=!1}_renderParticles(l){if(0===this._particleSystems.length)return;const a=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let N=0;N<this._particleSystems.length;N++){const U=this._particleSystems.data[N];if(0===(a&&a.layerMask&U.layerMask))continue;const c=U.Ua;c.position&&l&&-1===l.indexOf(c)||this._scene._activeParticles.addCount(U.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const l=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let a=0;a<this._spriteManagers.length;a++){const N=this._spriteManagers.data[a];0!==(l&&l.layerMask&N.layerMask)&&N.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}K._ZeroVector=c.ua.Zero();class Z{}class w{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(l){l!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=l,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const l of this._scene.meshes)if(l.Wc)for(const a of l.Wc)a._wasDispatched=!1;if(this._scene.spriteManagers)for(const l of this._scene.spriteManagers)l._wasDispatched=!1;for(const l of this._scene.wy)l._wasDispatched=!1}constructor(l){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Z,this._maintainStateBetweenFrames=!1,this._scene=l;for(let a=w.MIN_RENDERINGGROUPS;a<w.MAX_RENDERINGGROUPS;a++)this._autoClearDepthStencil[a]={uc:!0,depth:!0,Jc:!0}}getRenderingGroup(l){const a=l||0;return this._prepareRenderingGroup(a),this._renderingGroups[a]}_clearDepthStencilBuffer(){let l=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,l,a),this._depthStencilBufferAlreadyCleaned=!0)}render(l,a,N,U){const c=this._renderingGroupInfo;if(c.Ba=this._scene,c.camera=this._scene.activeCamera,c.renderingManager=this,this._scene.spriteManagers&&U)for(let K=0;K<this._scene.spriteManagers.length;K++){const l=this._scene.spriteManagers[K];this.dispatchSprites(l)}for(let K=w.MIN_RENDERINGGROUPS;K<w.MAX_RENDERINGGROUPS;K++){this._depthStencilBufferAlreadyCleaned=K===w.MIN_RENDERINGGROUPS;const Z=this._renderingGroups[K];if(!Z||Z._empty)continue;const S=1<<K;if(c.renderingGroupId=K,this._scene.onBeforeRenderingGroupObservable.notifyObservers(c,S),w.AUTOCLEAR){const l=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(K):this._autoClearDepthStencil[K];l&&l.uc&&this._clearDepthStencilBuffer(l.depth,l.Jc)}for(const l of this._scene._beforeRenderingGroupDrawStage)l.action(K);Z.render(l,U,N,a);for(const l of this._scene._afterRenderingGroupDrawStage)l.action(K);this._scene.onAfterRenderingGroupObservable.notifyObservers(c,S)}}reset(){if(!this.maintainStateBetweenFrames)for(let l=w.MIN_RENDERINGGROUPS;l<w.MAX_RENDERINGGROUPS;l++){const a=this._renderingGroups[l];a&&a.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let l=w.MIN_RENDERINGGROUPS;l<w.MAX_RENDERINGGROUPS;l++){const a=this._renderingGroups[l];a&&a.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let l=w.MIN_RENDERINGGROUPS;l<w.MAX_RENDERINGGROUPS;l++){const a=this._renderingGroups[l];a&&a.dispose()}}_prepareRenderingGroup(l){void 0===this._renderingGroups[l]&&(this._renderingGroups[l]=new K(l,this._scene,this._customOpaqueSortCompareFn[l],this._customAlphaTestSortCompareFn[l],this._customTransparentSortCompareFn[l]))}dispatchSprites(l){this.maintainStateBetweenFrames&&l._wasDispatched||(l._wasDispatched=!0,this.getRenderingGroup(l.renderingGroupId).dispatchSprites(l))}dispatchParticles(l){this.maintainStateBetweenFrames&&l._wasDispatched||(l._wasDispatched=!0,this.getRenderingGroup(l.renderingGroupId).dispatchParticles(l))}dispatch(l,a,N){void 0===a&&(a=l.getMesh()),this.maintainStateBetweenFrames&&l._wasDispatched||(l._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatch(l,a,N))}setRenderingOrder(l){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[l]=a,this._customAlphaTestSortCompareFn[l]=N,this._customTransparentSortCompareFn[l]=U,this._renderingGroups[l]){const a=this._renderingGroups[l];a.opaqueSortCompareFn=this._customOpaqueSortCompareFn[l],a.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[l],a.transparentSortCompareFn=this._customTransparentSortCompareFn[l]}}setRenderingAutoClearDepthStencil(l,a){let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],U=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[l]={uc:a,depth:N,Jc:U}}getAutoClearDepthStencilSetup(l){return this._autoClearDepthStencil[l]}}w.MAX_RENDERINGGROUPS=4,w.MIN_RENDERINGGROUPS=0,w.AUTOCLEAR=!0}}]);