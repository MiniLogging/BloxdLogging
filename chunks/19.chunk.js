"use strict";(self.k9ivgwsw3f=self.k9ivgwsw3f||[]).push([[19],{12903:(Y,b,C)=>{C.d(b,{d:()=>E,e:()=>B});var R=C(12907),q=C(12669),A=C(12909);class E{get O(){return this._isDisposed}constructor(Y,b,C){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]&&arguments[4],E=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],g=arguments.length>7?arguments[7]:void 0,r=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,Y&&Y.uY?this._engine=Y.uY().getEngine():this._engine=Y,this._updatable=C,this._instanced=E,this._divisor=g||1,this._label=r,b instanceof R.d?(this._data=null,this._buffer=b):(this._data=b,this._buffer=null),this.byteStride=B?q:q*Float32Array.BYTES_PER_ELEMENT,A||this.create()}createVertexBuffer(Y,b,C,R,q){let A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6?arguments[6]:void 0;const g=A?b:b*Float32Array.BYTES_PER_ELEMENT,r=R?A?R:R*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new B(this._engine,this,Y,this._updatable,!0,r,void 0===q?this._instanced:q,g,C,void 0,void 0,!0,this._divisor||E)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!Y&&this._buffer||(Y=Y||this._data,Y&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Y),this._data=Y):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(Y,this._label),this._data=Y):this._buffer=this._engine.createVertexBuffer(Y,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.jC>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.jC,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.jC,void 0,this._label));q.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(Y){this.create(Y)}updateDirectly(Y,b,C){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Y,R?b:b*Float32Array.BYTES_PER_ELEMENT,C?C*this.byteStride:void 0),this._data=0===b&&void 0===C?Y:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class B{get O(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(Y){const b=0!=Y;this._instanceDivisor=Y,b!==this._instanced&&(this._instanced=b,this._computeHashCode())}get _maxVerticesCount(){const Y=this.getData();return Y?Array.isArray(Y)?Y.length/(this.byteStride/4)-this.byteOffset/4:(Y.byteLength-this.byteOffset)/this.byteStride:0}constructor(Y,b,C,R,q,g,r,O,F,y){let S=arguments.length>10&&void 0!==arguments[10]&&arguments[10],n=arguments.length>11&&void 0!==arguments[11]&&arguments[11],t=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,I=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let w=!1;if(this.qC=Y,"object"===typeof R&&null!==R?(w=R.updatable??!1,q=R.postponeInternalCreation,g=R.stride,r=R.instanced,O=R.offset,F=R.size,y=R.type,S=R.normalized??!1,n=R.useBytes??!1,t=R.divisor??1,I=R.takeBufferOwnership??!1,this._label=R.label):w=!!R,b instanceof E?(this._buffer=b,this._ownsBuffer=I):(this._buffer=new E(Y,b,w,g,q,r,n,t,this._label),this._ownsBuffer=!0),this.uniqueId=B._Counter++,this._kind=C,void 0===y){const Y=this.getData();this.type=Y?B.GetDataType(Y):B.FLOAT}else this.type=y;const Q=(0,A.n)(this.type);n?(this._size=F||(g?g/Q:B.DeduceStride(C)),this.byteStride=g||this._buffer.byteStride||this._size*Q,this.byteOffset=O||0):(this._size=F||g||B.DeduceStride(C),this.byteStride=g?g*Q:this._buffer.byteStride||this._size*Q,this.byteOffset=(O||0)*Q),this.normalized=S,this._instanced=void 0!==r&&r,this._instanceDivisor=r?t:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var Y;null===(Y=this._buffer)||void 0===Y||Y._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(Y,b){const C=this.getData();return C?(0,A.l)(C,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,Y,b):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,A.n)(this.type)}getOffset(){return this.byteOffset/(0,A.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,A.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(Y){this._buffer.create(Y),this._alignBuffer()}update(Y){this._buffer.update(Y),this._alignBuffer()}updateDirectly(Y,b){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(Y,b,void 0,C),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(Y,b){(0,A.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,Y,this.normalized,((Y,C)=>{for(let R=0;R<this._size;R++)b(Y[R],C+R)}))}_alignBuffer(){}static DeduceStride(Y){switch(Y){case B.UVKind:case B.UV2Kind:case B.UV3Kind:case B.UV4Kind:case B.UV5Kind:case B.UV6Kind:return 2;case B.NormalKind:case B.PositionKind:return 3;case B.ColorKind:case B.ColorInstanceKind:case B.MatricesIndicesKind:case B.MatricesIndicesExtraKind:case B.MatricesWeightsKind:case B.MatricesWeightsExtraKind:case B.TangentKind:return 4;default:throw new Error("Invalid kind '"+Y+"'")}}static GetDataType(Y){return Y instanceof Int8Array?B.BYTE:Y instanceof Uint8Array?B.UNSIGNED_BYTE:Y instanceof Int16Array?B.SHORT:Y instanceof Uint16Array?B.UNSIGNED_SHORT:Y instanceof Int32Array?B.INT:Y instanceof Uint32Array?B.UNSIGNED_INT:B.FLOAT}static GetTypeByteLength(Y){return(0,A.n)(Y)}static ForEach(Y,b,C,R,q,E,B,g){(0,A.h)(Y,b,C,R,q,E,B,((Y,b)=>{for(let C=0;C<R;C++)g(Y[C],b+C)}))}static GetFloatData(Y,b,C,R,q,E,B,g){return(0,A.l)(Y,b,C,R,q,E,B,g)}}B._Counter=0,B.BYTE=5120,B.UNSIGNED_BYTE=5121,B.SHORT=5122,B.UNSIGNED_SHORT=5123,B.INT=5124,B.UNSIGNED_INT=5125,B.FLOAT=5126,B.PositionKind="position",B.NormalKind="normal",B.TangentKind="tangent",B.UVKind="uv",B.UV2Kind="uv2",B.UV3Kind="uv3",B.UV4Kind="uv4",B.UV5Kind="uv5",B.UV6Kind="uv6",B.ColorKind="color",B.ColorInstanceKind="instanceColor",B.MatricesIndicesKind="matricesIndices",B.MatricesWeightsKind="matricesWeights",B.MatricesIndicesExtraKind="matricesIndicesExtra",B.MatricesWeightsExtraKind="matricesWeightsExtra"},12909:(Y,b,C)=>{C.d(b,{b:()=>y,d:()=>F,h:()=>g,l:()=>r,n:()=>E,p:()=>B,r:()=>O});var R=C(12669);function q(Y,b,C,R){switch(b){case 5120:{let b=Y.getInt8(C);return R&&(b=Math.max(b/127,-1)),b}case 5121:{let b=Y.getUint8(C);return R&&(b/=255),b}case 5122:{let b=Y.getInt16(C,!0);return R&&(b=Math.max(b/32767,-1)),b}case 5123:{let b=Y.getUint16(C,!0);return R&&(b/=65535),b}case 5124:return Y.getInt32(C,!0);case 5125:return Y.getUint32(C,!0);case 5126:return Y.getFloat32(C,!0);default:throw new Error(`Invalid component type ${b}`)}}function A(Y,b,C,R,q){switch(b){case 5120:R&&(q=Math.round(127*q)),Y.setInt8(C,q);break;case 5121:R&&(q=Math.round(255*q)),Y.setUint8(C,q);break;case 5122:R&&(q=Math.round(32767*q)),Y.setInt16(C,q,!0);break;case 5123:R&&(q=Math.round(65535*q)),Y.setUint16(C,q,!0);break;case 5124:Y.setInt32(C,q,!0);break;case 5125:Y.setUint32(C,q,!0);break;case 5126:Y.setFloat32(C,q,!0);break;default:throw new Error(`Invalid component type ${b}`)}}function E(Y){switch(Y){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${Y}'`)}}function B(Y){switch(Y){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${Y}'`)}}function g(Y,b,C,R,B,g,r,O){const F=new Array(R),y=new Array(R);if(Y instanceof Array){let q=b/4;const A=C/4;for(let b=0;b<g;b+=R){for(let b=0;b<R;b++)F[b]=y[b]=Y[q+b];O(y,b);for(let b=0;b<R;b++)F[b]!==y[b]&&(Y[q+b]=y[b]);q+=A}}else{const S=ArrayBuffer.isView(Y)?new DataView(Y.buffer,Y.byteOffset,Y.byteLength):new DataView(Y),n=E(B);for(let Y=0;Y<g;Y+=R){for(let Y=0,C=b;Y<R;Y++,C+=n)F[Y]=y[Y]=q(S,B,C,r);O(y,Y);for(let Y=0,C=b;Y<R;Y++,C+=n)F[Y]!==y[Y]&&A(S,B,C,r,y[Y]);b+=C}}}function r(Y,b,C,q,A,B,r,O){const F=b*E(C),y=r*b;if(5126!==C||A!==F){const R=new Float32Array(y);return g(Y,q,A,b,C,y,B,((Y,C)=>{for(let q=0;q<b;q++)R[C+q]=Y[q]})),R}if(!(Y instanceof Array||Y instanceof Float32Array)||0!==q||Y.length!==y){if(Y instanceof Array){const b=q/4;return Y.slice(b,b+y)}if(Y instanceof ArrayBuffer)return new Float32Array(Y,q,y);{const b=Y.byteOffset+q;return 0!==(3&b)&&(R.e.Warn("Float array must be aligned to 4-bytes border"),O=!0),O?new Float32Array(Y.buffer.slice(b,b+y*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(Y.buffer,b,y)}}return O?Y.slice():Y}function O(Y,b,C,q,A,r,O,F){const y=E(C),S=B(C),n=O*b;if(Array.isArray(Y)){if(0!==(3&q)||0!==(3&A))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const R=q/4,E=A/4;if(R+(O-1)*E+b>Y.length)throw new Error("Last accessed index is out of bounds.");if(E<b)throw new Error("Data stride cannot be smaller than the component size.");if(E!==b){const R=new S(n);return g(Y,q,A,b,C,n,r,((Y,C)=>{for(let q=0;q<b;q++)R[C+q]=Y[q]})),R}return new S(Y.slice(R,R+n))}let t,I=q;Y instanceof ArrayBuffer?t=Y:(t=Y.buffer,I+=Y.byteOffset);if(I+(O-1)*A+b*y>t.byteLength)throw new Error("Last accessed byte is out of bounds.");const w=b*y;if(A<w)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(A!==w){const Y=new S(n);return g(t,I,A,b,C,n,r,((C,R)=>{for(let q=0;q<b;q++)Y[R+q]=C[q]})),Y}return 1!==y&&0!==(I&y-1)&&(R.e.Warn("Array must be aligned to border of element size. Data will be copied."),F=!0),F?new S(t.slice(I,I+n*y)):new S(t,I,n)}function F(Y,b,C,q,A,B,r,O){const F=b*E(C),y=r*b;if(O.length!==y)throw new Error("Output length is not valid");if(5126===C&&A===F)if(Y instanceof Array){const b=q/4;O.set(Y,b)}else if(Y instanceof ArrayBuffer){const b=new Float32Array(Y,q,y);O.set(b)}else{const b=Y.byteOffset+q;if(0!==(3&b))return R.e.Warn("Float array must be aligned to 4-bytes border"),void O.set(new Float32Array(Y.buffer.slice(b,b+y*Float32Array.BYTES_PER_ELEMENT)));const C=new Float32Array(Y.buffer,b,y);O.set(C)}else g(Y,q,A,b,C,y,B,((Y,C)=>{for(let R=0;R<b;R++)O[C+R]=Y[R]}))}function y(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(Y)){for(let q=0;q<b;q++)if(Y[C+q]-R>65535)return!0;return!1}return 4===Y.BYTES_PER_ELEMENT}},12907:(Y,b,C)=>{C.d(b,{d:()=>R});class R{get underlyingResource(){return null}constructor(){this.references=0,this.jC=0,this.is32Bits=!1,this.uniqueId=R._Counter++}}R._Counter=0},12943:(Y,b,C)=>{C.d(b,{c:()=>q});var R=C(12726);class q{static GetEffect(Y){return void 0===Y.getPipelineContext?Y.effect:Y}constructor(Y){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=Y.createDrawContext(),b&&(this.materialContext=Y.createMaterialContext())}setEffect(Y,b){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var R;(this.effect=Y,void 0!==b&&(this.defines=b),C)&&(null===(R=this.drawContext)||void 0===R||R.reset())}dispose(){var Y;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const Y=this.effect;b?Y.dispose():R.d.SetImmediate((()=>{Y.getEngine().onEndFrameObservable.addOnce((()=>{Y.dispose()}))})),this.effect=null}null===(Y=this.drawContext)||void 0===Y||Y.dispose()}}},13038:(Y,b,C)=>{C.d(b,{c:()=>q});var R=C(12889);class q{static GetPlanes(Y){const b=[];for(let C=0;C<6;C++)b.push(new R.d(0,0,0,0));return q.GetPlanesToRef(Y,b),b}static GetNearPlaneToRef(Y,b){const C=Y.m;b.normal.x=C[3]+C[2],b.normal.y=C[7]+C[6],b.normal.z=C[11]+C[10],b.d=C[15]+C[14],b.normalize()}static GetFarPlaneToRef(Y,b){const C=Y.m;b.normal.x=C[3]-C[2],b.normal.y=C[7]-C[6],b.normal.z=C[11]-C[10],b.d=C[15]-C[14],b.normalize()}static GetLeftPlaneToRef(Y,b){const C=Y.m;b.normal.x=C[3]+C[0],b.normal.y=C[7]+C[4],b.normal.z=C[11]+C[8],b.d=C[15]+C[12],b.normalize()}static GetRightPlaneToRef(Y,b){const C=Y.m;b.normal.x=C[3]-C[0],b.normal.y=C[7]-C[4],b.normal.z=C[11]-C[8],b.d=C[15]-C[12],b.normalize()}static GetTopPlaneToRef(Y,b){const C=Y.m;b.normal.x=C[3]-C[1],b.normal.y=C[7]-C[5],b.normal.z=C[11]-C[9],b.d=C[15]-C[13],b.normalize()}static GetBottomPlaneToRef(Y,b){const C=Y.m;b.normal.x=C[3]+C[1],b.normal.y=C[7]+C[5],b.normal.z=C[11]+C[9],b.d=C[15]+C[13],b.normalize()}static GetPlanesToRef(Y,b){q.GetNearPlaneToRef(Y,b[0]),q.GetFarPlaneToRef(Y,b[1]),q.GetLeftPlaneToRef(Y,b[2]),q.GetRightPlaneToRef(Y,b[3]),q.GetTopPlaneToRef(Y,b[4]),q.GetBottomPlaneToRef(Y,b[5])}static IsPointInFrustum(Y,b){for(let C=0;C<6;C++)if(b[C].dotCoordinate(Y)<0)return!1;return!0}}},13050:(Y,b,C)=>{C.d(b,{d:()=>q});var R=C(12681);class q{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(Y,b){q.Enabled&&(this._current+=Y,b&&this._fetchResult())}beginMonitoring(){q.Enabled&&(this._startMonitoringTime=R.d.Now)}endMonitoring(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!q.Enabled)return;Y&&this.fetchNewFrame();const b=R.d.Now;this._current=b-this._startMonitoringTime,Y&&this._fetchResult()}yb(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const Y=R.d.Now;Y-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=Y,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}q.Enabled=!0},12919:(Y,b,C)=>{C.d(b,{e:()=>q,h:()=>R});class R{constructor(Y){this.length=0,this.data=new Array(Y),this._id=R._GlobalId++}push(Y){this.data[this.length++]=Y,this.length>this.data.length&&(this.data.length*=2)}forEach(Y){for(let b=0;b<this.length;b++)Y(this.data[b])}sort(Y){this.data.sort(Y)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(Y){if(0!==Y.length){this.length+Y.length>this.data.length&&(this.data.length=2*(this.length+Y.length));for(let b=0;b<Y.length;b++)this.data[this.length++]=(Y.data||Y)[b]}}indexOf(Y){const b=this.data.indexOf(Y);return b>=this.length?-1:b}contains(Y){return-1!==this.indexOf(Y)}}R._GlobalId=0;class q extends R{constructor(){super(...arguments),this._duplicateId=0}push(Y){super.push(Y),Y.__smartArrayFlags||(Y.__smartArrayFlags={}),Y.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(Y){return(!Y.__smartArrayFlags||Y.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(Y),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(Y){if(0!==Y.length){this.length+Y.length>this.data.length&&(this.data.length=2*(this.length+Y.length));for(let b=0;b<Y.length;b++){const C=(Y.data||Y)[b];this.pushNoDuplicate(C)}}}}},12901:(Y,b,C)=>{C.d(b,{d:()=>A});var R=C(12903),q=C(12652);class A{constructor(Y){this._vertexBuffers={},this.onBeforeRenderObservable=new q.d,this._scene=Y}_prepareBuffers(){if(this._vertexBuffers[R.e.PositionKind])return;const Y=[];Y.push(1,1),Y.push(-1,1),Y.push(-1,-1),Y.push(1,-1),this._vertexBuffers[R.e.PositionKind]=new R.e(this._scene.getEngine(),Y,R.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const Y=[];Y.push(0),Y.push(1),Y.push(2),Y.push(0),Y.push(2),Y.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(Y)}_rebuild(){const Y=this._vertexBuffers[R.e.PositionKind];Y&&(Y._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this._scene.activeCamera;return!!C&&(b=b||C._postProcesses.filter((Y=>null!=Y)),!(!b||0===b.length||!this._scene.postProcessesEnabled)&&(b[0].activate(C,Y,null!==b&&void 0!==b),!0))}directRender(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],E=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Y.length;const B=this._scene.getEngine();for(let r=0;r<E;r++){var g;if(r<Y.length-1)Y[r+1].activate(this._scene.activeCamera||this._scene,null===b||void 0===b?void 0:b.texture);else b?B.bindFramebuffer(b,R,void 0,void 0,C,q):A||B.restoreDefaultFramebuffer(),null===(g=B._debugInsertMarker)||void 0===g||g.call(B,`post process ${Y[r].name} output`);const E=Y[r],O=E.apply();O&&(E.onBeforeRenderObservable.notifyObservers(O),this._prepareBuffers(),B.bindBuffers(this._vertexBuffers,this._indexBuffer,O),B.drawElementsType(0,0,6),E.onAfterRenderObservable.notifyObservers(O))}B.setDepthBuffer(!0),B.setDepthWrite(!0)}_finalizeFrame(Y,b,C,R){let q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const A=this._scene.activeCamera;if(!A)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(R=R||A._postProcesses.filter((Y=>null!=Y))).length||!this._scene.postProcessesEnabled)return;const E=this._scene.getEngine();for(let g=0,r=R.length;g<r;g++){const O=R[g];var B;if(g<r-1)O._outputTexture=R[g+1].activate(A,null===b||void 0===b?void 0:b.texture);else b?(E.bindFramebuffer(b,C,void 0,void 0,q),O._outputTexture=b):(E.restoreDefaultFramebuffer(),O._outputTexture=null),null===(B=E._debugInsertMarker)||void 0===B||B.call(E,`post process ${R[g].name} output`);if(Y)break;const F=O.apply();F&&(O.onBeforeRenderObservable.notifyObservers(F),this._prepareBuffers(),E.bindBuffers(this._vertexBuffers,this._indexBuffer,F),E.drawElementsType(0,0,6),O.onAfterRenderObservable.notifyObservers(F))}E.setDepthBuffer(!0),E.setDepthWrite(!0),E.setAlphaMode(0)}dispose(){const Y=this._vertexBuffers[R.e.PositionKind];Y&&(Y.dispose(),this._vertexBuffers[R.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12914:(Y,b,C)=>{C.d(b,{e:()=>B});var R=C(12919),q=C(12831);class A{set opaqueSortCompareFn(Y){this._opaqueSortCompareFn=Y||A.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(Y){this._alphaTestSortCompareFn=Y||A.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(Y){this._transparentSortCompareFn=Y||A.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(Y,b){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=Y,this._opaqueSubMeshes=new R.h(256),this._transparentSubMeshes=new R.h(256),this._alphaTestSubMeshes=new R.h(256),this._depthOnlySubMeshes=new R.h(256),this._particleSystems=new R.h(256),this._spriteManagers=new R.h(256),this._empty=!0,this._edgesRenderers=new R.e(16),this._scene=b,this.opaqueSortCompareFn=C,this.alphaTestSortCompareFn=q,this.transparentSortCompareFn=A}render(Y,b,C,R){if(Y)return void Y(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const q=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(q.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),q.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const A=q.getStencilBuffer();if(q.setStencilBuffer(!1),b&&this._renderSprites(),C&&this._renderParticles(R),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(q.setStencilBuffer(A),this._scene.useOrderIndependentTransparency){const Y=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);Y.length&&this._renderTransparent(Y)}else this._renderTransparent(this._transparentSubMeshes);q.setAlphaMode(0)}if(q.setStencilBuffer(!1),this._edgesRenderers.length){for(let Y=0;Y<this._edgesRenderers.length;Y++)this._edgesRenderers.data[Y].render();q.setAlphaMode(0)}q.setStencilBuffer(A)}_renderOpaqueSorted(Y){A._RenderSorted(Y,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(Y){A._RenderSorted(Y,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(Y){A._RenderSorted(Y,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(Y,b,C,R){let E,B=0;const g=C?C.globalPosition:A._ZeroVector;if(R)for(;B<Y.length;B++)E=Y.data[B],E._alphaIndex=E.getMesh().alphaIndex,E._distanceToCamera=q.AC.Distance(E.getBoundingInfo().boundingSphere.centerWorld,g);const r=Y.length===Y.data.length?Y.data:Y.data.slice(0,Y.length);b&&r.sort(b);const O=r[0].getMesh().uY();for(B=0;B<r.length;B++)if(E=r[B],!O._activeMeshesFrozenButKeepClipping||E.isInFrustum(O._frustumPlanes)){if(R){const Y=E.GY();if(Y&&Y.needDepthPrePass){const b=Y.uY().getEngine();b.setColorWrite(!1),b.setAlphaMode(0),E.render(!1),b.setColorWrite(!0)}}E.render(R)}}static defaultTransparentSortCompare(Y,b){return Y._alphaIndex>b._alphaIndex?1:Y._alphaIndex<b._alphaIndex?-1:A.backToFrontSortCompare(Y,b)}static backToFrontSortCompare(Y,b){return Y._distanceToCamera<b._distanceToCamera?1:Y._distanceToCamera>b._distanceToCamera?-1:0}static frontToBackSortCompare(Y,b){return Y._distanceToCamera<b._distanceToCamera?-1:Y._distanceToCamera>b._distanceToCamera?1:0}static PainterSortCompare(Y,b){const C=Y.getMesh(),R=b.getMesh();return C.material&&R.material?C.material.uniqueId-R.material.uniqueId:C.uniqueId-R.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(Y,b,C){void 0===b&&(b=Y.getMesh()),void 0===C&&(C=Y.GY()),null!==C&&void 0!==C&&(C.needAlphaBlendingForMesh(b)?this._transparentSubMeshes.push(Y):C.needAlphaTestingForMesh(b)?(C.needDepthPrePass&&this._depthOnlySubMeshes.push(Y),this._alphaTestSubMeshes.push(Y)):(C.needDepthPrePass&&this._depthOnlySubMeshes.push(Y),this._opaqueSubMeshes.push(Y)),b._renderingGroup=this,b._edgesRenderer&&b.isEnabled()&&b.isVisible&&b._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(b._edgesRenderer),this._empty=!1)}dispatchSprites(Y){this._spriteManagers.push(Y),this._empty=!1}dispatchParticles(Y){this._particleSystems.push(Y),this._empty=!1}_renderParticles(Y){if(0===this._particleSystems.length)return;const b=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let C=0;C<this._particleSystems.length;C++){const R=this._particleSystems.data[C];if(0===(b&&b.layerMask&R.layerMask))continue;const q=R.Rb;q.position&&Y&&-1===Y.indexOf(q)||this._scene._activeParticles.addCount(R.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const Y=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let b=0;b<this._spriteManagers.length;b++){const C=this._spriteManagers.data[b];0!==(Y&&Y.layerMask&C.layerMask)&&C.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}A._ZeroVector=q.AC.Zero();class E{}class B{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(Y){Y!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=Y,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const Y of this._scene.meshes)if(Y.ub)for(const b of Y.ub)b._wasDispatched=!1;if(this._scene.spriteManagers)for(const Y of this._scene.spriteManagers)Y._wasDispatched=!1;for(const Y of this._scene.xy)Y._wasDispatched=!1}constructor(Y){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new E,this._maintainStateBetweenFrames=!1,this._scene=Y;for(let b=B.MIN_RENDERINGGROUPS;b<B.MAX_RENDERINGGROUPS;b++)this._autoClearDepthStencil[b]={Lb:!0,depth:!0,nb:!0}}getRenderingGroup(Y){const b=Y||0;return this._prepareRenderingGroup(b),this._renderingGroups[b]}_clearDepthStencilBuffer(){let Y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,Y,b),this._depthStencilBufferAlreadyCleaned=!0)}render(Y,b,C,R){const q=this._renderingGroupInfo;if(q.BC=this._scene,q.camera=this._scene.activeCamera,q.renderingManager=this,this._scene.spriteManagers&&R)for(let A=0;A<this._scene.spriteManagers.length;A++){const Y=this._scene.spriteManagers[A];this.dispatchSprites(Y)}for(let A=B.MIN_RENDERINGGROUPS;A<B.MAX_RENDERINGGROUPS;A++){this._depthStencilBufferAlreadyCleaned=A===B.MIN_RENDERINGGROUPS;const E=this._renderingGroups[A];if(!E||E._empty)continue;const g=1<<A;if(q.renderingGroupId=A,this._scene.onBeforeRenderingGroupObservable.notifyObservers(q,g),B.AUTOCLEAR){const Y=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(A):this._autoClearDepthStencil[A];Y&&Y.Lb&&this._clearDepthStencilBuffer(Y.depth,Y.nb)}for(const Y of this._scene._beforeRenderingGroupDrawStage)Y.action(A);E.render(Y,R,C,b);for(const Y of this._scene._afterRenderingGroupDrawStage)Y.action(A);this._scene.onAfterRenderingGroupObservable.notifyObservers(q,g)}}reset(){if(!this.maintainStateBetweenFrames)for(let Y=B.MIN_RENDERINGGROUPS;Y<B.MAX_RENDERINGGROUPS;Y++){const b=this._renderingGroups[Y];b&&b.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let Y=B.MIN_RENDERINGGROUPS;Y<B.MAX_RENDERINGGROUPS;Y++){const b=this._renderingGroups[Y];b&&b.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let Y=B.MIN_RENDERINGGROUPS;Y<B.MAX_RENDERINGGROUPS;Y++){const b=this._renderingGroups[Y];b&&b.dispose()}}_prepareRenderingGroup(Y){void 0===this._renderingGroups[Y]&&(this._renderingGroups[Y]=new A(Y,this._scene,this._customOpaqueSortCompareFn[Y],this._customAlphaTestSortCompareFn[Y],this._customTransparentSortCompareFn[Y]))}dispatchSprites(Y){this.maintainStateBetweenFrames&&Y._wasDispatched||(Y._wasDispatched=!0,this.getRenderingGroup(Y.renderingGroupId).dispatchSprites(Y))}dispatchParticles(Y){this.maintainStateBetweenFrames&&Y._wasDispatched||(Y._wasDispatched=!0,this.getRenderingGroup(Y.renderingGroupId).dispatchParticles(Y))}dispatch(Y,b,C){void 0===b&&(b=Y.getMesh()),this.maintainStateBetweenFrames&&Y._wasDispatched||(Y._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatch(Y,b,C))}setRenderingOrder(Y){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[Y]=b,this._customAlphaTestSortCompareFn[Y]=C,this._customTransparentSortCompareFn[Y]=R,this._renderingGroups[Y]){const b=this._renderingGroups[Y];b.opaqueSortCompareFn=this._customOpaqueSortCompareFn[Y],b.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[Y],b.transparentSortCompareFn=this._customTransparentSortCompareFn[Y]}}setRenderingAutoClearDepthStencil(Y,b){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[Y]={Lb:b,depth:C,nb:R}}getAutoClearDepthStencilSetup(Y){return this._autoClearDepthStencil[Y]}}B.MAX_RENDERINGGROUPS=4,B.MIN_RENDERINGGROUPS=0,B.AUTOCLEAR=!0}}]);