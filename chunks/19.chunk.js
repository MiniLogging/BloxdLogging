"use strict";(self.dwifukwnts=self.dwifukwnts||[]).push([[19],{11664:(U,X,b)=>{b.d(X,{d:()=>Q,h:()=>z});var F=b(11667),E=b(11408),w=b(11669);class Q{get R(){return this._isDisposed}constructor(U,X,b){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7?arguments[7]:void 0,p=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,U&&U.fU?this._engine=U.fU().getEngine():this._engine=U,this._updatable=b,this._instanced=Q,this._divisor=q||1,this._label=p,X instanceof F.c?(this._data=null,this._buffer=X):(this._data=X,this._buffer=null),this.byteStride=z?E:E*Float32Array.BYTES_PER_ELEMENT,w||this.create()}createVertexBuffer(U,X,b,F,E){let w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6?arguments[6]:void 0;const q=w?X:X*Float32Array.BYTES_PER_ELEMENT,p=F?w?F:F*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new z(this._engine,this,U,this._updatable,!0,p,void 0===E?this._instanced:E,q,b,void 0,void 0,!0,this._divisor||Q)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!U&&this._buffer||(U=U||this._data,U&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,U),this._data=U):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(U,this._label),this._data=U):this._buffer=this._engine.createVertexBuffer(U,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.tX>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.tX,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.tX,void 0,this._label));E.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(U){this.create(U)}updateDirectly(U,X,b){let F=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,U,F?X:X*Float32Array.BYTES_PER_ELEMENT,b?b*this.byteStride:void 0),this._data=0===X&&void 0===b?U:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class z{get R(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(U){const X=0!=U;this._instanceDivisor=U,X!==this._instanced&&(this._instanced=X,this._computeHashCode())}get _maxVerticesCount(){const U=this.getData();return U?Array.isArray(U)?U.length/(this.byteStride/4)-this.byteOffset/4:(U.byteLength-this.byteOffset)/this.byteStride:0}constructor(U,X,b,F,E,q,p,S,R,n){let a=arguments.length>10&&void 0!==arguments[10]&&arguments[10],J=arguments.length>11&&void 0!==arguments[11]&&arguments[11],m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,x=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let I=!1;if(this.aX=U,"object"===typeof F&&null!==F?(I=F.updatable??!1,E=F.postponeInternalCreation,q=F.stride,p=F.instanced,S=F.offset,R=F.size,n=F.type,a=F.normalized??!1,J=F.useBytes??!1,m=F.divisor??1,x=F.takeBufferOwnership??!1,this._label=F.label):I=!!F,X instanceof Q?(this._buffer=X,this._ownsBuffer=x):(this._buffer=new Q(U,X,I,q,E,p,J,m,this._label),this._ownsBuffer=!0),this.uniqueId=z._Counter++,this._kind=b,void 0===n){const U=this.getData();this.type=U?z.GetDataType(U):z.FLOAT}else this.type=n;const O=(0,w.n)(this.type);J?(this._size=R||(q?q/O:z.DeduceStride(b)),this.byteStride=q||this._buffer.byteStride||this._size*O,this.byteOffset=S||0):(this._size=R||q||z.DeduceStride(b),this.byteStride=q?q*O:this._buffer.byteStride||this._size*O,this.byteOffset=(S||0)*O),this.normalized=a,this._instanced=void 0!==p&&p,this._instanceDivisor=p?m:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var U;null===(U=this._buffer)||void 0===U||U._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(U,X){const b=this.getData();return b?(0,w.l)(b,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,U,X):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,w.n)(this.type)}getOffset(){return this.byteOffset/(0,w.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,w.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(U){this._buffer.create(U),this._alignBuffer()}update(U){this._buffer.update(U),this._alignBuffer()}updateDirectly(U,X){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(U,X,void 0,b),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(U,X){(0,w.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,U,this.normalized,((U,b)=>{for(let F=0;F<this._size;F++)X(U[F],b+F)}))}_alignBuffer(){}static DeduceStride(U){switch(U){case z.UVKind:case z.UV2Kind:case z.UV3Kind:case z.UV4Kind:case z.UV5Kind:case z.UV6Kind:return 2;case z.NormalKind:case z.PositionKind:return 3;case z.ColorKind:case z.ColorInstanceKind:case z.MatricesIndicesKind:case z.MatricesIndicesExtraKind:case z.MatricesWeightsKind:case z.MatricesWeightsExtraKind:case z.TangentKind:return 4;default:throw new Error("Invalid kind '"+U+"'")}}static GetDataType(U){return U instanceof Int8Array?z.BYTE:U instanceof Uint8Array?z.UNSIGNED_BYTE:U instanceof Int16Array?z.SHORT:U instanceof Uint16Array?z.UNSIGNED_SHORT:U instanceof Int32Array?z.INT:U instanceof Uint32Array?z.UNSIGNED_INT:z.FLOAT}static GetTypeByteLength(U){return(0,w.n)(U)}static ForEach(U,X,b,F,E,Q,z,q){(0,w.j)(U,X,b,F,E,Q,z,((U,X)=>{for(let b=0;b<F;b++)q(U[b],X+b)}))}static GetFloatData(U,X,b,F,E,Q,z,q){return(0,w.l)(U,X,b,F,E,Q,z,q)}}z._Counter=0,z.BYTE=5120,z.UNSIGNED_BYTE=5121,z.SHORT=5122,z.UNSIGNED_SHORT=5123,z.INT=5124,z.UNSIGNED_INT=5125,z.FLOAT=5126,z.PositionKind="position",z.NormalKind="normal",z.TangentKind="tangent",z.UVKind="uv",z.UV2Kind="uv2",z.UV3Kind="uv3",z.UV4Kind="uv4",z.UV5Kind="uv5",z.UV6Kind="uv6",z.ColorKind="color",z.ColorInstanceKind="instanceColor",z.MatricesIndicesKind="matricesIndices",z.MatricesWeightsKind="matricesWeights",z.MatricesIndicesExtraKind="matricesIndicesExtra",z.MatricesWeightsExtraKind="matricesWeightsExtra"},11669:(U,X,b)=>{b.d(X,{e:()=>n,g:()=>R,j:()=>q,l:()=>p,n:()=>Q,q:()=>z,s:()=>S});var F=b(11408);function E(U,X,b,F){switch(X){case 5120:{let X=U.getInt8(b);return F&&(X=Math.max(X/127,-1)),X}case 5121:{let X=U.getUint8(b);return F&&(X/=255),X}case 5122:{let X=U.getInt16(b,!0);return F&&(X=Math.max(X/32767,-1)),X}case 5123:{let X=U.getUint16(b,!0);return F&&(X/=65535),X}case 5124:return U.getInt32(b,!0);case 5125:return U.getUint32(b,!0);case 5126:return U.getFloat32(b,!0);default:throw new Error(`Invalid component type ${X}`)}}function w(U,X,b,F,E){switch(X){case 5120:F&&(E=Math.round(127*E)),U.setInt8(b,E);break;case 5121:F&&(E=Math.round(255*E)),U.setUint8(b,E);break;case 5122:F&&(E=Math.round(32767*E)),U.setInt16(b,E,!0);break;case 5123:F&&(E=Math.round(65535*E)),U.setUint16(b,E,!0);break;case 5124:U.setInt32(b,E,!0);break;case 5125:U.setUint32(b,E,!0);break;case 5126:U.setFloat32(b,E,!0);break;default:throw new Error(`Invalid component type ${X}`)}}function Q(U){switch(U){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${U}'`)}}function z(U){switch(U){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${U}'`)}}function q(U,X,b,F,z,q,p,S){const R=new Array(F),n=new Array(F);if(U instanceof Array){let E=X/4;const w=b/4;for(let X=0;X<q;X+=F){for(let X=0;X<F;X++)R[X]=n[X]=U[E+X];S(n,X);for(let X=0;X<F;X++)R[X]!==n[X]&&(U[E+X]=n[X]);E+=w}}else{const a=ArrayBuffer.isView(U)?new DataView(U.buffer,U.byteOffset,U.byteLength):new DataView(U),J=Q(z);for(let U=0;U<q;U+=F){for(let U=0,b=X;U<F;U++,b+=J)R[U]=n[U]=E(a,z,b,p);S(n,U);for(let U=0,b=X;U<F;U++,b+=J)R[U]!==n[U]&&w(a,z,b,p,n[U]);X+=b}}}function p(U,X,b,E,w,z,p,S){const R=X*Q(b),n=p*X;if(5126!==b||w!==R){const F=new Float32Array(n);return q(U,E,w,X,b,n,z,((U,b)=>{for(let E=0;E<X;E++)F[b+E]=U[E]})),F}if(!(U instanceof Array||U instanceof Float32Array)||0!==E||U.length!==n){if(U instanceof Array){const X=E/4;return U.slice(X,X+n)}if(U instanceof ArrayBuffer)return new Float32Array(U,E,n);{const X=U.byteOffset+E;return 0!==(3&X)&&(F.e.Warn("Float array must be aligned to 4-bytes border"),S=!0),S?new Float32Array(U.buffer.slice(X,X+n*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(U.buffer,X,n)}}return S?U.slice():U}function S(U,X,b,E,w,p,S,R){const n=Q(b),a=z(b),J=S*X;if(Array.isArray(U)){if(0!==(3&E)||0!==(3&w))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const F=E/4,Q=w/4;if(F+(S-1)*Q+X>U.length)throw new Error("Last accessed index is out of bounds.");if(Q<X)throw new Error("Data stride cannot be smaller than the component size.");if(Q!==X){const F=new a(J);return q(U,E,w,X,b,J,p,((U,b)=>{for(let E=0;E<X;E++)F[b+E]=U[E]})),F}return new a(U.slice(F,F+J))}let m,x=E;U instanceof ArrayBuffer?m=U:(m=U.buffer,x+=U.byteOffset);if(x+(S-1)*w+X*n>m.byteLength)throw new Error("Last accessed byte is out of bounds.");const I=X*n;if(w<I)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(w!==I){const U=new a(J);return q(m,x,w,X,b,J,p,((b,F)=>{for(let E=0;E<X;E++)U[F+E]=b[E]})),U}return 1!==n&&0!==(x&n-1)&&(F.e.Warn("Array must be aligned to border of element size. Data will be copied."),R=!0),R?new a(m.slice(x,x+J*n)):new a(m,x,J)}function R(U,X,b,E,w,z,p,S){const R=X*Q(b),n=p*X;if(S.length!==n)throw new Error("Output length is not valid");if(5126===b&&w===R)if(U instanceof Array){const X=E/4;S.set(U,X)}else if(U instanceof ArrayBuffer){const X=new Float32Array(U,E,n);S.set(X)}else{const X=U.byteOffset+E;if(0!==(3&X))return F.e.Warn("Float array must be aligned to 4-bytes border"),void S.set(new Float32Array(U.buffer.slice(X,X+n*Float32Array.BYTES_PER_ELEMENT)));const b=new Float32Array(U.buffer,X,n);S.set(b)}else q(U,E,w,X,b,n,z,((U,b)=>{for(let F=0;F<X;F++)S[b+F]=U[F]}))}function n(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(U)){for(let E=0;E<X;E++)if(U[b+E]-F>65535)return!0;return!1}return 4===U.BYTES_PER_ELEMENT}},11667:(U,X,b)=>{b.d(X,{c:()=>F});class F{get underlyingResource(){return null}constructor(){this.references=0,this.tX=0,this.is32Bits=!1,this.uniqueId=F._Counter++}}F._Counter=0},11707:(U,X,b)=>{b.d(X,{d:()=>E});var F=b(11481);class E{static GetEffect(U){return void 0===U.getPipelineContext?U.effect:U}constructor(U){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=U.createDrawContext(),X&&(this.materialContext=U.createMaterialContext())}setEffect(U,X){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var F;(this.effect=U,void 0!==X&&(this.defines=X),b)&&(null===(F=this.drawContext)||void 0===F||F.reset())}dispose(){var U;let X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const U=this.effect;X?U.dispose():F.c.SetImmediate((()=>{U.getEngine().onEndFrameObservable.addOnce((()=>{U.dispose()}))})),this.effect=null}null===(U=this.drawContext)||void 0===U||U.dispose()}}},11794:(U,X,b)=>{b.d(X,{b:()=>E});var F=b(11644);class E{static GetPlanes(U){const X=[];for(let b=0;b<6;b++)X.push(new F.c(0,0,0,0));return E.GetPlanesToRef(U,X),X}static GetNearPlaneToRef(U,X){const b=U.m;X.normal.x=b[3]+b[2],X.normal.y=b[7]+b[6],X.normal.z=b[11]+b[10],X.d=b[15]+b[14],X.normalize()}static GetFarPlaneToRef(U,X){const b=U.m;X.normal.x=b[3]-b[2],X.normal.y=b[7]-b[6],X.normal.z=b[11]-b[10],X.d=b[15]-b[14],X.normalize()}static GetLeftPlaneToRef(U,X){const b=U.m;X.normal.x=b[3]+b[0],X.normal.y=b[7]+b[4],X.normal.z=b[11]+b[8],X.d=b[15]+b[12],X.normalize()}static GetRightPlaneToRef(U,X){const b=U.m;X.normal.x=b[3]-b[0],X.normal.y=b[7]-b[4],X.normal.z=b[11]-b[8],X.d=b[15]-b[12],X.normalize()}static GetTopPlaneToRef(U,X){const b=U.m;X.normal.x=b[3]-b[1],X.normal.y=b[7]-b[5],X.normal.z=b[11]-b[9],X.d=b[15]-b[13],X.normalize()}static GetBottomPlaneToRef(U,X){const b=U.m;X.normal.x=b[3]+b[1],X.normal.y=b[7]+b[5],X.normal.z=b[11]+b[9],X.d=b[15]+b[13],X.normalize()}static GetPlanesToRef(U,X){E.GetNearPlaneToRef(U,X[0]),E.GetFarPlaneToRef(U,X[1]),E.GetLeftPlaneToRef(U,X[2]),E.GetRightPlaneToRef(U,X[3]),E.GetTopPlaneToRef(U,X[4]),E.GetBottomPlaneToRef(U,X[5])}static IsPointInFrustum(U,X){for(let b=0;b<6;b++)if(X[b].dotCoordinate(U)<0)return!1;return!0}}},11812:(U,X,b)=>{b.d(X,{e:()=>E});var F=b(11421);class E{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(U,X){E.Enabled&&(this._current+=U,X&&this._fetchResult())}beginMonitoring(){E.Enabled&&(this._startMonitoringTime=F.e.Now)}endMonitoring(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!E.Enabled)return;U&&this.fetchNewFrame();const X=F.e.Now;this._current=X-this._startMonitoringTime,U&&this._fetchResult()}Eb(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const U=F.e.Now;U-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=U,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}E.Enabled=!0},11679:(U,X,b)=>{b.d(X,{c:()=>E,d:()=>F});class F{constructor(U){this.length=0,this.data=new Array(U),this._id=F._GlobalId++}push(U){this.data[this.length++]=U,this.length>this.data.length&&(this.data.length*=2)}forEach(U){for(let X=0;X<this.length;X++)U(this.data[X])}sort(U){this.data.sort(U)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(U){if(0!==U.length){this.length+U.length>this.data.length&&(this.data.length=2*(this.length+U.length));for(let X=0;X<U.length;X++)this.data[this.length++]=(U.data||U)[X]}}indexOf(U){const X=this.data.indexOf(U);return X>=this.length?-1:X}contains(U){return-1!==this.indexOf(U)}}F._GlobalId=0;class E extends F{constructor(){super(...arguments),this._duplicateId=0}push(U){super.push(U),U.__smartArrayFlags||(U.__smartArrayFlags={}),U.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(U){return(!U.__smartArrayFlags||U.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(U),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(U){if(0!==U.length){this.length+U.length>this.data.length&&(this.data.length=2*(this.length+U.length));for(let X=0;X<U.length;X++){const b=(U.data||U)[X];this.pushNoDuplicate(b)}}}}},11660:(U,X,b)=>{b.d(X,{b:()=>w});var F=b(11664),E=b(11392);class w{constructor(U){this._vertexBuffers={},this.onBeforeRenderObservable=new E.e,this._scene=U}_prepareBuffers(){if(this._vertexBuffers[F.h.PositionKind])return;const U=[];U.push(1,1),U.push(-1,1),U.push(-1,-1),U.push(1,-1),this._vertexBuffers[F.h.PositionKind]=new F.h(this._scene.getEngine(),U,F.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const U=[];U.push(0),U.push(1),U.push(2),U.push(0),U.push(2),U.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(U)}_rebuild(){const U=this._vertexBuffers[F.h.PositionKind];U&&(U._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let U=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this._scene.activeCamera;return!!b&&(X=X||b._postProcesses.filter((U=>null!=U)),!(!X||0===X.length||!this._scene.postProcessesEnabled)&&(X[0].activate(b,U,null!==X&&void 0!==X),!0))}directRender(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:U.length;const z=this._scene.getEngine();for(let p=0;p<Q;p++){var q;if(p<U.length-1)U[p+1].activate(this._scene.activeCamera||this._scene,null===X||void 0===X?void 0:X.texture);else X?z.bindFramebuffer(X,F,void 0,void 0,b,E):w||z.restoreDefaultFramebuffer(),null===(q=z._debugInsertMarker)||void 0===q||q.call(z,`post process ${U[p].name} output`);const Q=U[p],S=Q.apply();S&&(Q.onBeforeRenderObservable.notifyObservers(S),this._prepareBuffers(),z.bindBuffers(this._vertexBuffers,this._indexBuffer,S),z.drawElementsType(0,0,6),Q.onAfterRenderObservable.notifyObservers(S))}z.setDepthBuffer(!0),z.setDepthWrite(!0)}_finalizeFrame(U,X,b,F){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const w=this._scene.activeCamera;if(!w)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(F=F||w._postProcesses.filter((U=>null!=U))).length||!this._scene.postProcessesEnabled)return;const Q=this._scene.getEngine();for(let q=0,p=F.length;q<p;q++){const S=F[q];var z;if(q<p-1)S._outputTexture=F[q+1].activate(w,null===X||void 0===X?void 0:X.texture);else X?(Q.bindFramebuffer(X,b,void 0,void 0,E),S._outputTexture=X):(Q.restoreDefaultFramebuffer(),S._outputTexture=null),null===(z=Q._debugInsertMarker)||void 0===z||z.call(Q,`post process ${F[q].name} output`);if(U)break;const R=S.apply();R&&(S.onBeforeRenderObservable.notifyObservers(R),this._prepareBuffers(),Q.bindBuffers(this._vertexBuffers,this._indexBuffer,R),Q.drawElementsType(0,0,6),S.onAfterRenderObservable.notifyObservers(R))}Q.setDepthBuffer(!0),Q.setDepthWrite(!0),Q.setAlphaMode(0)}dispose(){const U=this._vertexBuffers[F.h.PositionKind];U&&(U.dispose(),this._vertexBuffers[F.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11677:(U,X,b)=>{b.d(X,{b:()=>z});var F=b(11679),E=b(11593);class w{set opaqueSortCompareFn(U){this._opaqueSortCompareFn=U||w.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(U){this._alphaTestSortCompareFn=U||w.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(U){this._transparentSortCompareFn=U||w.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(U,X){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=U,this._opaqueSubMeshes=new F.d(256),this._transparentSubMeshes=new F.d(256),this._alphaTestSubMeshes=new F.d(256),this._depthOnlySubMeshes=new F.d(256),this._particleSystems=new F.d(256),this._spriteManagers=new F.d(256),this._empty=!0,this._edgesRenderers=new F.c(16),this._scene=X,this.opaqueSortCompareFn=b,this.alphaTestSortCompareFn=E,this.transparentSortCompareFn=w}render(U,X,b,F){if(U)return void U(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const E=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(E.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),E.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const w=E.getStencilBuffer();if(E.setStencilBuffer(!1),X&&this._renderSprites(),b&&this._renderParticles(F),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(E.setStencilBuffer(w),this._scene.useOrderIndependentTransparency){const U=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);U.length&&this._renderTransparent(U)}else this._renderTransparent(this._transparentSubMeshes);E.setAlphaMode(0)}if(E.setStencilBuffer(!1),this._edgesRenderers.length){for(let U=0;U<this._edgesRenderers.length;U++)this._edgesRenderers.data[U].render();E.setAlphaMode(0)}E.setStencilBuffer(w)}_renderOpaqueSorted(U){w._RenderSorted(U,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(U){w._RenderSorted(U,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(U){w._RenderSorted(U,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(U,X,b,F){let Q,z=0;const q=b?b.globalPosition:w._ZeroVector;if(F)for(;z<U.length;z++)Q=U.data[z],Q._alphaIndex=Q.getMesh().alphaIndex,Q._distanceToCamera=E.JX.Distance(Q.getBoundingInfo().boundingSphere.centerWorld,q);const p=U.length===U.data.length?U.data:U.data.slice(0,U.length);X&&p.sort(X);const S=p[0].getMesh().fU();for(z=0;z<p.length;z++)if(Q=p[z],!S._activeMeshesFrozenButKeepClipping||Q.isInFrustum(S._frustumPlanes)){if(F){const U=Q.yU();if(U&&U.needDepthPrePass){const X=U.fU().getEngine();X.setColorWrite(!1),X.setAlphaMode(0),Q.render(!1),X.setColorWrite(!0)}}Q.render(F)}}static defaultTransparentSortCompare(U,X){return U._alphaIndex>X._alphaIndex?1:U._alphaIndex<X._alphaIndex?-1:w.backToFrontSortCompare(U,X)}static backToFrontSortCompare(U,X){return U._distanceToCamera<X._distanceToCamera?1:U._distanceToCamera>X._distanceToCamera?-1:0}static frontToBackSortCompare(U,X){return U._distanceToCamera<X._distanceToCamera?-1:U._distanceToCamera>X._distanceToCamera?1:0}static PainterSortCompare(U,X){const b=U.getMesh(),F=X.getMesh();return b.material&&F.material?b.material.uniqueId-F.material.uniqueId:b.uniqueId-F.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(U,X,b){void 0===X&&(X=U.getMesh()),void 0===b&&(b=U.yU()),null!==b&&void 0!==b&&(b.needAlphaBlendingForMesh(X)?this._transparentSubMeshes.push(U):b.needAlphaTestingForMesh(X)?(b.needDepthPrePass&&this._depthOnlySubMeshes.push(U),this._alphaTestSubMeshes.push(U)):(b.needDepthPrePass&&this._depthOnlySubMeshes.push(U),this._opaqueSubMeshes.push(U)),X._renderingGroup=this,X._edgesRenderer&&X.isEnabled()&&X.isVisible&&X._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(X._edgesRenderer),this._empty=!1)}dispatchSprites(U){this._spriteManagers.push(U),this._empty=!1}dispatchParticles(U){this._particleSystems.push(U),this._empty=!1}_renderParticles(U){if(0===this._particleSystems.length)return;const X=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let b=0;b<this._particleSystems.length;b++){const F=this._particleSystems.data[b];if(0===(X&&X.layerMask&F.layerMask))continue;const E=F.FX;E.position&&U&&-1===U.indexOf(E)||this._scene._activeParticles.addCount(F.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const U=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let X=0;X<this._spriteManagers.length;X++){const b=this._spriteManagers.data[X];0!==(U&&U.layerMask&b.layerMask)&&b.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}w._ZeroVector=E.JX.Zero();class Q{}class z{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(U){U!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=U,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const U of this._scene.meshes)if(U.ab)for(const X of U.ab)X._wasDispatched=!1;if(this._scene.spriteManagers)for(const U of this._scene.spriteManagers)U._wasDispatched=!1;for(const U of this._scene.wn)U._wasDispatched=!1}constructor(U){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Q,this._maintainStateBetweenFrames=!1,this._scene=U;for(let X=z.MIN_RENDERINGGROUPS;X<z.MAX_RENDERINGGROUPS;X++)this._autoClearDepthStencil[X]={nb:!0,depth:!0,stencil:!0}}getRenderingGroup(U){const X=U||0;return this._prepareRenderingGroup(X),this._renderingGroups[X]}_clearDepthStencilBuffer(){let U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,U,X),this._depthStencilBufferAlreadyCleaned=!0)}render(U,X,b,F){const E=this._renderingGroupInfo;if(E.xX=this._scene,E.camera=this._scene.activeCamera,E.renderingManager=this,this._scene.spriteManagers&&F)for(let w=0;w<this._scene.spriteManagers.length;w++){const U=this._scene.spriteManagers[w];this.dispatchSprites(U)}for(let w=z.MIN_RENDERINGGROUPS;w<z.MAX_RENDERINGGROUPS;w++){this._depthStencilBufferAlreadyCleaned=w===z.MIN_RENDERINGGROUPS;const Q=this._renderingGroups[w];if(!Q||Q._empty)continue;const q=1<<w;if(E.renderingGroupId=w,this._scene.onBeforeRenderingGroupObservable.notifyObservers(E,q),z.AUTOCLEAR){const U=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(w):this._autoClearDepthStencil[w];U&&U.nb&&this._clearDepthStencilBuffer(U.depth,U.stencil)}for(const U of this._scene._beforeRenderingGroupDrawStage)U.action(w);Q.render(U,F,b,X);for(const U of this._scene._afterRenderingGroupDrawStage)U.action(w);this._scene.onAfterRenderingGroupObservable.notifyObservers(E,q)}}reset(){if(!this.maintainStateBetweenFrames)for(let U=z.MIN_RENDERINGGROUPS;U<z.MAX_RENDERINGGROUPS;U++){const X=this._renderingGroups[U];X&&X.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let U=z.MIN_RENDERINGGROUPS;U<z.MAX_RENDERINGGROUPS;U++){const X=this._renderingGroups[U];X&&X.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let U=z.MIN_RENDERINGGROUPS;U<z.MAX_RENDERINGGROUPS;U++){const X=this._renderingGroups[U];X&&X.dispose()}}_prepareRenderingGroup(U){void 0===this._renderingGroups[U]&&(this._renderingGroups[U]=new w(U,this._scene,this._customOpaqueSortCompareFn[U],this._customAlphaTestSortCompareFn[U],this._customTransparentSortCompareFn[U]))}dispatchSprites(U){this.maintainStateBetweenFrames&&U._wasDispatched||(U._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatchSprites(U))}dispatchParticles(U){this.maintainStateBetweenFrames&&U._wasDispatched||(U._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatchParticles(U))}dispatch(U,X,b){void 0===X&&(X=U.getMesh()),this.maintainStateBetweenFrames&&U._wasDispatched||(U._wasDispatched=!0,this.getRenderingGroup(X.renderingGroupId).dispatch(U,X,b))}setRenderingOrder(U){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,F=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[U]=X,this._customAlphaTestSortCompareFn[U]=b,this._customTransparentSortCompareFn[U]=F,this._renderingGroups[U]){const X=this._renderingGroups[U];X.opaqueSortCompareFn=this._customOpaqueSortCompareFn[U],X.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[U],X.transparentSortCompareFn=this._customTransparentSortCompareFn[U]}}setRenderingAutoClearDepthStencil(U,X){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],F=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[U]={nb:X,depth:b,stencil:F}}getAutoClearDepthStencilSetup(U){return this._autoClearDepthStencil[U]}}z.MAX_RENDERINGGROUPS=4,z.MIN_RENDERINGGROUPS=0,z.AUTOCLEAR=!0}}]);