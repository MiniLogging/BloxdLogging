"use strict";(self.r00gjvkwa6=self.r00gjvkwa6||[]).push([[19],{11378:(H,O,S)=>{S.d(O,{d:()=>G,h:()=>U});var t=S(11382),q=S(11151),p=S(11386);class G{get G(){return this._isDisposed}constructor(H,O,S){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]&&arguments[6],V=arguments.length>7?arguments[7]:void 0,w=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,H&&H.YH?this._engine=H.YH().getEngine():this._engine=H,this._updatable=S,this._instanced=G,this._divisor=V||1,this._label=w,O instanceof t.c?(this._data=null,this._buffer=O):(this._data=O,this._buffer=null),this.byteStride=U?q:q*Float32Array.BYTES_PER_ELEMENT,p||this.create()}createVertexBuffer(H,O,S,t,q){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6?arguments[6]:void 0;const V=p?O:O*Float32Array.BYTES_PER_ELEMENT,w=t?p?t:t*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new U(this._engine,this,H,this._updatable,!0,w,void 0===q?this._instanced:q,V,S,void 0,void 0,!0,this._divisor||G)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!H&&this._buffer||(H=H||this._data,H&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,H),this._data=H):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(H,this._label),this._data=H):this._buffer=this._engine.createVertexBuffer(H,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.wS>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.wS,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.wS,void 0,this._label));q.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(H){this.create(H)}updateDirectly(H,O,S){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,H,t?O:O*Float32Array.BYTES_PER_ELEMENT,S?S*this.byteStride:void 0),this._data=0===O&&void 0===S?H:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class U{get G(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(H){const O=0!=H;this._instanceDivisor=H,O!==this._instanced&&(this._instanced=O,this._computeHashCode())}get _maxVerticesCount(){const H=this.getData();return H?Array.isArray(H)?H.length/(this.byteStride/4)-this.byteOffset/4:(H.byteLength-this.byteOffset)/this.byteStride:0}constructor(H,O,S,t,q,V,w,o,h,a){let j=arguments.length>10&&void 0!==arguments[10]&&arguments[10],e=arguments.length>11&&void 0!==arguments[11]&&arguments[11],X=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,E=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let y=!1;if(this.jO=H,"object"===typeof t&&null!==t?(y=t.updatable??!1,q=t.postponeInternalCreation,V=t.stride,w=t.instanced,o=t.offset,h=t.size,a=t.type,j=t.normalized??!1,e=t.useBytes??!1,X=t.divisor??1,E=t.takeBufferOwnership??!1,this._label=t.label):y=!!t,O instanceof G?(this._buffer=O,this._ownsBuffer=E):(this._buffer=new G(H,O,y,V,q,w,e,X,this._label),this._ownsBuffer=!0),this.uniqueId=U._Counter++,this._kind=S,void 0===a){const H=this.getData();this.type=H?U.GetDataType(H):U.FLOAT}else this.type=a;const T=(0,p.o)(this.type);e?(this._size=h||(V?V/T:U.DeduceStride(S)),this.byteStride=V||this._buffer.byteStride||this._size*T,this.byteOffset=o||0):(this._size=h||V||U.DeduceStride(S),this.byteStride=V?V*T:this._buffer.byteStride||this._size*T,this.byteOffset=(o||0)*T),this.normalized=j,this._instanced=void 0!==w&&w,this._instanceDivisor=w?X:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var H;null===(H=this._buffer)||void 0===H||H._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(H,O){const S=this.getData();return S?(0,p.l)(S,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,H,O):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,p.o)(this.type)}getOffset(){return this.byteOffset/(0,p.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,p.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(H){this._buffer.create(H),this._alignBuffer()}update(H){this._buffer.update(H),this._alignBuffer()}updateDirectly(H,O){let S=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(H,O,void 0,S),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(H,O){(0,p.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,H,this.normalized,((H,S)=>{for(let t=0;t<this._size;t++)O(H[t],S+t)}))}_alignBuffer(){}static DeduceStride(H){switch(H){case U.UVKind:case U.UV2Kind:case U.UV3Kind:case U.UV4Kind:case U.UV5Kind:case U.UV6Kind:return 2;case U.NormalKind:case U.PositionKind:return 3;case U.ColorKind:case U.ColorInstanceKind:case U.MatricesIndicesKind:case U.MatricesIndicesExtraKind:case U.MatricesWeightsKind:case U.MatricesWeightsExtraKind:case U.TangentKind:return 4;default:throw new Error("Invalid kind '"+H+"'")}}static GetDataType(H){return H instanceof Int8Array?U.BYTE:H instanceof Uint8Array?U.UNSIGNED_BYTE:H instanceof Int16Array?U.SHORT:H instanceof Uint16Array?U.UNSIGNED_SHORT:H instanceof Int32Array?U.INT:H instanceof Uint32Array?U.UNSIGNED_INT:U.FLOAT}static GetTypeByteLength(H){return(0,p.o)(H)}static ForEach(H,O,S,t,q,G,U,V){(0,p.i)(H,O,S,t,q,G,U,((H,O)=>{for(let S=0;S<t;S++)V(H[S],O+S)}))}static GetFloatData(H,O,S,t,q,G,U,V){return(0,p.l)(H,O,S,t,q,G,U,V)}}U._Counter=0,U.BYTE=5120,U.UNSIGNED_BYTE=5121,U.SHORT=5122,U.UNSIGNED_SHORT=5123,U.INT=5124,U.UNSIGNED_INT=5125,U.FLOAT=5126,U.PositionKind="position",U.NormalKind="normal",U.TangentKind="tangent",U.UVKind="uv",U.UV2Kind="uv2",U.UV3Kind="uv3",U.UV4Kind="uv4",U.UV5Kind="uv5",U.UV6Kind="uv6",U.ColorKind="color",U.ColorInstanceKind="instanceColor",U.MatricesIndicesKind="matricesIndices",U.MatricesWeightsKind="matricesWeights",U.MatricesIndicesExtraKind="matricesIndicesExtra",U.MatricesWeightsExtraKind="matricesWeightsExtra"},11386:(H,O,S)=>{S.d(O,{e:()=>a,h:()=>h,i:()=>V,l:()=>w,o:()=>G,s:()=>U,u:()=>o});var t=S(11151);function q(H,O,S,t){switch(O){case 5120:{let O=H.getInt8(S);return t&&(O=Math.max(O/127,-1)),O}case 5121:{let O=H.getUint8(S);return t&&(O/=255),O}case 5122:{let O=H.getInt16(S,!0);return t&&(O=Math.max(O/32767,-1)),O}case 5123:{let O=H.getUint16(S,!0);return t&&(O/=65535),O}case 5124:return H.getInt32(S,!0);case 5125:return H.getUint32(S,!0);case 5126:return H.getFloat32(S,!0);default:throw new Error(`Invalid component type ${O}`)}}function p(H,O,S,t,q){switch(O){case 5120:t&&(q=Math.round(127*q)),H.setInt8(S,q);break;case 5121:t&&(q=Math.round(255*q)),H.setUint8(S,q);break;case 5122:t&&(q=Math.round(32767*q)),H.setInt16(S,q,!0);break;case 5123:t&&(q=Math.round(65535*q)),H.setUint16(S,q,!0);break;case 5124:H.setInt32(S,q,!0);break;case 5125:H.setUint32(S,q,!0);break;case 5126:H.setFloat32(S,q,!0);break;default:throw new Error(`Invalid component type ${O}`)}}function G(H){switch(H){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${H}'`)}}function U(H){switch(H){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${H}'`)}}function V(H,O,S,t,U,V,w,o){const h=new Array(t),a=new Array(t);if(H instanceof Array){let q=O/4;const p=S/4;for(let O=0;O<V;O+=t){for(let O=0;O<t;O++)h[O]=a[O]=H[q+O];o(a,O);for(let O=0;O<t;O++)h[O]!==a[O]&&(H[q+O]=a[O]);q+=p}}else{const j=ArrayBuffer.isView(H)?new DataView(H.buffer,H.byteOffset,H.byteLength):new DataView(H),e=G(U);for(let H=0;H<V;H+=t){for(let H=0,S=O;H<t;H++,S+=e)h[H]=a[H]=q(j,U,S,w);o(a,H);for(let H=0,S=O;H<t;H++,S+=e)h[H]!==a[H]&&p(j,U,S,w,a[H]);O+=S}}}function w(H,O,S,q,p,U,w,o){const h=O*G(S),a=w*O;if(5126!==S||p!==h){const t=new Float32Array(a);return V(H,q,p,O,S,a,U,((H,S)=>{for(let q=0;q<O;q++)t[S+q]=H[q]})),t}if(!(H instanceof Array||H instanceof Float32Array)||0!==q||H.length!==a){if(H instanceof Array){const O=q/4;return H.slice(O,O+a)}if(H instanceof ArrayBuffer)return new Float32Array(H,q,a);{const O=H.byteOffset+q;return 0!==(3&O)&&(t.b.Warn("Float array must be aligned to 4-bytes border"),o=!0),o?new Float32Array(H.buffer.slice(O,O+a*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(H.buffer,O,a)}}return o?H.slice():H}function o(H,O,S,q,p,w,o,h){const a=G(S),j=U(S),e=o*O;if(Array.isArray(H)){if(0!==(3&q)||0!==(3&p))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const t=q/4,G=p/4;if(t+(o-1)*G+O>H.length)throw new Error("Last accessed index is out of bounds.");if(G<O)throw new Error("Data stride cannot be smaller than the component size.");if(G!==O){const t=new j(e);return V(H,q,p,O,S,e,w,((H,S)=>{for(let q=0;q<O;q++)t[S+q]=H[q]})),t}return new j(H.slice(t,t+e))}let X,E=q;H instanceof ArrayBuffer?X=H:(X=H.buffer,E+=H.byteOffset);if(E+(o-1)*p+O*a>X.byteLength)throw new Error("Last accessed byte is out of bounds.");const y=O*a;if(p<y)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(p!==y){const H=new j(e);return V(X,E,p,O,S,e,w,((S,t)=>{for(let q=0;q<O;q++)H[t+q]=S[q]})),H}return 1!==a&&0!==(E&a-1)&&(t.b.Warn("Array must be aligned to border of element size. Data will be copied."),h=!0),h?new j(X.slice(E,E+e*a)):new j(X,E,e)}function h(H,O,S,q,p,U,w,o){const h=O*G(S),a=w*O;if(o.length!==a)throw new Error("Output length is not valid");if(5126===S&&p===h)if(H instanceof Array){const O=q/4;o.set(H,O)}else if(H instanceof ArrayBuffer){const O=new Float32Array(H,q,a);o.set(O)}else{const O=H.byteOffset+q;if(0!==(3&O))return t.b.Warn("Float array must be aligned to 4-bytes border"),void o.set(new Float32Array(H.buffer.slice(O,O+a*Float32Array.BYTES_PER_ELEMENT)));const S=new Float32Array(H.buffer,O,a);o.set(S)}else V(H,q,p,O,S,a,U,((H,S)=>{for(let t=0;t<O;t++)o[S+t]=H[t]}))}function a(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(H)){for(let q=0;q<O;q++)if(H[S+q]-t>65535)return!0;return!1}return 4===H.BYTES_PER_ELEMENT}},11382:(H,O,S)=>{S.d(O,{c:()=>t});class t{get underlyingResource(){return null}constructor(){this.references=0,this.wS=0,this.is32Bits=!1,this.uniqueId=t._Counter++}}t._Counter=0},11422:(H,O,S)=>{S.d(O,{e:()=>q});var t=S(11205);class q{static GetEffect(H){return void 0===H.getPipelineContext?H.effect:H}constructor(H){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=H.createDrawContext(),O&&(this.materialContext=H.createMaterialContext())}setEffect(H,O){let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var t;(this.effect=H,void 0!==O&&(this.defines=O),S)&&(null===(t=this.drawContext)||void 0===t||t.reset())}dispose(){var H;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const H=this.effect;O?H.dispose():t.b.SetImmediate((()=>{H.getEngine().onEndFrameObservable.addOnce((()=>{H.dispose()}))})),this.effect=null}null===(H=this.drawContext)||void 0===H||H.dispose()}}},11518:(H,O,S)=>{S.d(O,{c:()=>q});var t=S(11360);class q{static GetPlanes(H){const O=[];for(let S=0;S<6;S++)O.push(new t.b(0,0,0,0));return q.GetPlanesToRef(H,O),O}static GetNearPlaneToRef(H,O){const S=H.m;O.normal.x=S[3]+S[2],O.normal.y=S[7]+S[6],O.normal.z=S[11]+S[10],O.d=S[15]+S[14],O.normalize()}static GetFarPlaneToRef(H,O){const S=H.m;O.normal.x=S[3]-S[2],O.normal.y=S[7]-S[6],O.normal.z=S[11]-S[10],O.d=S[15]-S[14],O.normalize()}static GetLeftPlaneToRef(H,O){const S=H.m;O.normal.x=S[3]+S[0],O.normal.y=S[7]+S[4],O.normal.z=S[11]+S[8],O.d=S[15]+S[12],O.normalize()}static GetRightPlaneToRef(H,O){const S=H.m;O.normal.x=S[3]-S[0],O.normal.y=S[7]-S[4],O.normal.z=S[11]-S[8],O.d=S[15]-S[12],O.normalize()}static GetTopPlaneToRef(H,O){const S=H.m;O.normal.x=S[3]-S[1],O.normal.y=S[7]-S[5],O.normal.z=S[11]-S[9],O.d=S[15]-S[13],O.normalize()}static GetBottomPlaneToRef(H,O){const S=H.m;O.normal.x=S[3]+S[1],O.normal.y=S[7]+S[5],O.normal.z=S[11]+S[9],O.d=S[15]+S[13],O.normalize()}static GetPlanesToRef(H,O){q.GetNearPlaneToRef(H,O[0]),q.GetFarPlaneToRef(H,O[1]),q.GetLeftPlaneToRef(H,O[2]),q.GetRightPlaneToRef(H,O[3]),q.GetTopPlaneToRef(H,O[4]),q.GetBottomPlaneToRef(H,O[5])}static IsPointInFrustum(H,O){for(let S=0;S<6;S++)if(O[S].dotCoordinate(H)<0)return!1;return!0}}},11530:(H,O,S)=>{S.d(O,{b:()=>q});var t=S(11162);class q{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(H,O){q.Enabled&&(this._current+=H,O&&this._fetchResult())}beginMonitoring(){q.Enabled&&(this._startMonitoringTime=t.d.Now)}endMonitoring(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!q.Enabled)return;H&&this.fetchNewFrame();const O=t.d.Now;this._current=O-this._startMonitoringTime,H&&this._fetchResult()}dp(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const H=t.d.Now;H-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=H,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}q.Enabled=!0},11398:(H,O,S)=>{S.d(O,{e:()=>q,i:()=>t});class t{constructor(H){this.length=0,this.data=new Array(H),this._id=t._GlobalId++}push(H){this.data[this.length++]=H,this.length>this.data.length&&(this.data.length*=2)}forEach(H){for(let O=0;O<this.length;O++)H(this.data[O])}sort(H){this.data.sort(H)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(H){if(0!==H.length){this.length+H.length>this.data.length&&(this.data.length=2*(this.length+H.length));for(let O=0;O<H.length;O++)this.data[this.length++]=(H.data||H)[O]}}indexOf(H){const O=this.data.indexOf(H);return O>=this.length?-1:O}contains(H){return-1!==this.indexOf(H)}}t._GlobalId=0;class q extends t{constructor(){super(...arguments),this._duplicateId=0}push(H){super.push(H),H.__smartArrayFlags||(H.__smartArrayFlags={}),H.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(H){return(!H.__smartArrayFlags||H.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(H),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(H){if(0!==H.length){this.length+H.length>this.data.length&&(this.data.length=2*(this.length+H.length));for(let O=0;O<H.length;O++){const S=(H.data||H)[O];this.pushNoDuplicate(S)}}}}},11375:(H,O,S)=>{S.d(O,{e:()=>p});var t=S(11378),q=S(11140);class p{constructor(H){this._vertexBuffers={},this.onBeforeRenderObservable=new q.b,this._scene=H}_prepareBuffers(){if(this._vertexBuffers[t.h.PositionKind])return;const H=[];H.push(1,1),H.push(-1,1),H.push(-1,-1),H.push(1,-1),this._vertexBuffers[t.h.PositionKind]=new t.h(this._scene.getEngine(),H,t.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const H=[];H.push(0),H.push(1),H.push(2),H.push(0),H.push(2),H.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(H)}_rebuild(){const H=this._vertexBuffers[t.h.PositionKind];H&&(H._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const S=this._scene.activeCamera;return!!S&&(O=O||S._postProcesses.filter((H=>null!=H)),!(!O||0===O.length||!this._scene.postProcessesEnabled)&&(O[0].activate(S,H,null!==O&&void 0!==O),!0))}directRender(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:H.length;const U=this._scene.getEngine();for(let w=0;w<G;w++){var V;if(w<H.length-1)H[w+1].activate(this._scene.activeCamera||this._scene,null===O||void 0===O?void 0:O.texture);else O?U.bindFramebuffer(O,t,void 0,void 0,S,q):p||U.restoreDefaultFramebuffer(),null===(V=U._debugInsertMarker)||void 0===V||V.call(U,`post process ${H[w].name} output`);const G=H[w],o=G.apply();o&&(G.onBeforeRenderObservable.notifyObservers(o),this._prepareBuffers(),U.bindBuffers(this._vertexBuffers,this._indexBuffer,o),U.drawElementsType(0,0,6),G.onAfterRenderObservable.notifyObservers(o))}U.setDepthBuffer(!0),U.setDepthWrite(!0)}_finalizeFrame(H,O,S,t){let q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const p=this._scene.activeCamera;if(!p)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(t=t||p._postProcesses.filter((H=>null!=H))).length||!this._scene.postProcessesEnabled)return;const G=this._scene.getEngine();for(let V=0,w=t.length;V<w;V++){const o=t[V];var U;if(V<w-1)o._outputTexture=t[V+1].activate(p,null===O||void 0===O?void 0:O.texture);else O?(G.bindFramebuffer(O,S,void 0,void 0,q),o._outputTexture=O):(G.restoreDefaultFramebuffer(),o._outputTexture=null),null===(U=G._debugInsertMarker)||void 0===U||U.call(G,`post process ${t[V].name} output`);if(H)break;const h=o.apply();h&&(o.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),G.bindBuffers(this._vertexBuffers,this._indexBuffer,h),G.drawElementsType(0,0,6),o.onAfterRenderObservable.notifyObservers(h))}G.setDepthBuffer(!0),G.setDepthWrite(!0),G.setAlphaMode(0)}dispose(){const H=this._vertexBuffers[t.h.PositionKind];H&&(H.dispose(),this._vertexBuffers[t.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11393:(H,O,S)=>{S.d(O,{e:()=>U});var t=S(11398),q=S(11301);class p{set opaqueSortCompareFn(H){this._opaqueSortCompareFn=H||p.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(H){this._alphaTestSortCompareFn=H||p.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(H){this._transparentSortCompareFn=H||p.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(H,O){let S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=H,this._opaqueSubMeshes=new t.i(256),this._transparentSubMeshes=new t.i(256),this._alphaTestSubMeshes=new t.i(256),this._depthOnlySubMeshes=new t.i(256),this._particleSystems=new t.i(256),this._spriteManagers=new t.i(256),this._empty=!0,this._edgesRenderers=new t.e(16),this._scene=O,this.opaqueSortCompareFn=S,this.alphaTestSortCompareFn=q,this.transparentSortCompareFn=p}render(H,O,S,t){if(H)return void H(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const q=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(q.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),q.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const p=q.getStencilBuffer();if(q.setStencilBuffer(!1),O&&this._renderSprites(),S&&this._renderParticles(t),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(q.setStencilBuffer(p),this._scene.useOrderIndependentTransparency){const H=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);H.length&&this._renderTransparent(H)}else this._renderTransparent(this._transparentSubMeshes);q.setAlphaMode(0)}if(q.setStencilBuffer(!1),this._edgesRenderers.length){for(let H=0;H<this._edgesRenderers.length;H++)this._edgesRenderers.data[H].render();q.setAlphaMode(0)}q.setStencilBuffer(p)}_renderOpaqueSorted(H){p._RenderSorted(H,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(H){p._RenderSorted(H,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(H){p._RenderSorted(H,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(H,O,S,t){let G,U=0;const V=S?S.globalPosition:p._ZeroVector;if(t)for(;U<H.length;U++)G=H.data[U],G._alphaIndex=G.getMesh().alphaIndex,G._distanceToCamera=q.eO.Distance(G.getBoundingInfo().boundingSphere.centerWorld,V);const w=H.length===H.data.length?H.data:H.data.slice(0,H.length);O&&w.sort(O);const o=w[0].getMesh().YH();for(U=0;U<w.length;U++)if(G=w[U],!o._activeMeshesFrozenButKeepClipping||G.isInFrustum(o._frustumPlanes)){if(t){const H=G.AH();if(H&&H.needDepthPrePass){const O=H.YH().getEngine();O.setColorWrite(!1),O.setAlphaMode(0),G.render(!1),O.setColorWrite(!0)}}G.render(t)}}static defaultTransparentSortCompare(H,O){return H._alphaIndex>O._alphaIndex?1:H._alphaIndex<O._alphaIndex?-1:p.backToFrontSortCompare(H,O)}static backToFrontSortCompare(H,O){return H._distanceToCamera<O._distanceToCamera?1:H._distanceToCamera>O._distanceToCamera?-1:0}static frontToBackSortCompare(H,O){return H._distanceToCamera<O._distanceToCamera?-1:H._distanceToCamera>O._distanceToCamera?1:0}static PainterSortCompare(H,O){const S=H.getMesh(),t=O.getMesh();return S.material&&t.material?S.material.uniqueId-t.material.uniqueId:S.uniqueId-t.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(H,O,S){void 0===O&&(O=H.getMesh()),void 0===S&&(S=H.AH()),null!==S&&void 0!==S&&(S.needAlphaBlendingForMesh(O)?this._transparentSubMeshes.push(H):S.needAlphaTestingForMesh(O)?(S.needDepthPrePass&&this._depthOnlySubMeshes.push(H),this._alphaTestSubMeshes.push(H)):(S.needDepthPrePass&&this._depthOnlySubMeshes.push(H),this._opaqueSubMeshes.push(H)),O._renderingGroup=this,O._edgesRenderer&&O.isEnabled()&&O.isVisible&&O._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(O._edgesRenderer),this._empty=!1)}dispatchSprites(H){this._spriteManagers.push(H),this._empty=!1}dispatchParticles(H){this._particleSystems.push(H),this._empty=!1}_renderParticles(H){if(0===this._particleSystems.length)return;const O=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let S=0;S<this._particleSystems.length;S++){const t=this._particleSystems.data[S];if(0===(O&&O.layerMask&t.layerMask))continue;const q=t.tO;q.position&&H&&-1===H.indexOf(q)||this._scene._activeParticles.addCount(t.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const H=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let O=0;O<this._spriteManagers.length;O++){const S=this._spriteManagers.data[O];0!==(H&&H.layerMask&S.layerMask)&&S.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}p._ZeroVector=q.eO.Zero();class G{}class U{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(H){H!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=H,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const H of this._scene.meshes)if(H.qU)for(const O of H.qU)O._wasDispatched=!1;if(this._scene.spriteManagers)for(const H of this._scene.spriteManagers)H._wasDispatched=!1;for(const H of this._scene.ha)H._wasDispatched=!1}constructor(H){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new G,this._maintainStateBetweenFrames=!1,this._scene=H;for(let O=U.MIN_RENDERINGGROUPS;O<U.MAX_RENDERINGGROUPS;O++)this._autoClearDepthStencil[O]={tU:!0,depth:!0,stencil:!0}}getRenderingGroup(H){const O=H||0;return this._prepareRenderingGroup(O),this._renderingGroups[O]}_clearDepthStencilBuffer(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,H,O),this._depthStencilBufferAlreadyCleaned=!0)}render(H,O,S,t){const q=this._renderingGroupInfo;if(q.EO=this._scene,q.camera=this._scene.activeCamera,q.renderingManager=this,this._scene.spriteManagers&&t)for(let p=0;p<this._scene.spriteManagers.length;p++){const H=this._scene.spriteManagers[p];this.dispatchSprites(H)}for(let p=U.MIN_RENDERINGGROUPS;p<U.MAX_RENDERINGGROUPS;p++){this._depthStencilBufferAlreadyCleaned=p===U.MIN_RENDERINGGROUPS;const G=this._renderingGroups[p];if(!G||G._empty)continue;const V=1<<p;if(q.renderingGroupId=p,this._scene.onBeforeRenderingGroupObservable.notifyObservers(q,V),U.AUTOCLEAR){const H=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(p):this._autoClearDepthStencil[p];H&&H.tU&&this._clearDepthStencilBuffer(H.depth,H.stencil)}for(const H of this._scene._beforeRenderingGroupDrawStage)H.action(p);G.render(H,t,S,O);for(const H of this._scene._afterRenderingGroupDrawStage)H.action(p);this._scene.onAfterRenderingGroupObservable.notifyObservers(q,V)}}reset(){if(!this.maintainStateBetweenFrames)for(let H=U.MIN_RENDERINGGROUPS;H<U.MAX_RENDERINGGROUPS;H++){const O=this._renderingGroups[H];O&&O.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let H=U.MIN_RENDERINGGROUPS;H<U.MAX_RENDERINGGROUPS;H++){const O=this._renderingGroups[H];O&&O.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let H=U.MIN_RENDERINGGROUPS;H<U.MAX_RENDERINGGROUPS;H++){const O=this._renderingGroups[H];O&&O.dispose()}}_prepareRenderingGroup(H){void 0===this._renderingGroups[H]&&(this._renderingGroups[H]=new p(H,this._scene,this._customOpaqueSortCompareFn[H],this._customAlphaTestSortCompareFn[H],this._customTransparentSortCompareFn[H]))}dispatchSprites(H){this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatchSprites(H))}dispatchParticles(H){this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatchParticles(H))}dispatch(H,O,S){void 0===O&&(O=H.getMesh()),this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(O.renderingGroupId).dispatch(H,O,S))}setRenderingOrder(H){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,S=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[H]=O,this._customAlphaTestSortCompareFn[H]=S,this._customTransparentSortCompareFn[H]=t,this._renderingGroups[H]){const O=this._renderingGroups[H];O.opaqueSortCompareFn=this._customOpaqueSortCompareFn[H],O.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[H],O.transparentSortCompareFn=this._customTransparentSortCompareFn[H]}}setRenderingAutoClearDepthStencil(H,O){let S=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[H]={tU:O,depth:S,stencil:t}}getAutoClearDepthStencilSetup(H){return this._autoClearDepthStencil[H]}}U.MAX_RENDERINGGROUPS=4,U.MIN_RENDERINGGROUPS=0,U.AUTOCLEAR=!0}}]);