"use strict";(self["1kjc9ee3uyt"]=self["1kjc9ee3uyt"]||[]).push([[19],{11748:(w,E,G)=>{G.d(E,{d:()=>y,g:()=>x});var P=G(11754),h=G(11518),B=G(11760);class y{get O(){return this._isDisposed}constructor(w,E,G){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]&&arguments[4],y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],x=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,w&&w.Ww?this._engine=w.Ww().getEngine():this._engine=w,this._updatable=G,this._instanced=y,this._divisor=U||1,this._label=l,E instanceof P.b?(this._data=null,this._buffer=E):(this._data=E,this._buffer=null),this.byteStride=x?h:h*Float32Array.BYTES_PER_ELEMENT,B||this.create()}createVertexBuffer(w,E,G,P,h){let B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0;const U=B?E:E*Float32Array.BYTES_PER_ELEMENT,l=P?B?P:P*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new x(this._engine,this,w,this._updatable,!0,l,void 0===h?this._instanced:h,U,G,void 0,void 0,!0,this._divisor||y)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!w&&this._buffer||(w=w||this._data,w&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,w),this._data=w):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(w,this._label),this._data=w):this._buffer=this._engine.createVertexBuffer(w,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Cx>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Cx,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Cx,void 0,this._label));h.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(w){this.create(w)}updateDirectly(w,E,G){let P=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,w,P?E:E*Float32Array.BYTES_PER_ELEMENT,G?G*this.byteStride:void 0),this._data=0===E&&void 0===G?w:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class x{get O(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(w){const E=0!=w;this._instanceDivisor=w,E!==this._instanced&&(this._instanced=E,this._computeHashCode())}get _maxVerticesCount(){const w=this.getData();return w?Array.isArray(w)?w.length/(this.byteStride/4)-this.byteOffset/4:(w.byteLength-this.byteOffset)/this.byteStride:0}constructor(w,E,G,P,h,U,l,i,O,u){let V=arguments.length>10&&void 0!==arguments[10]&&arguments[10],a=arguments.length>11&&void 0!==arguments[11]&&arguments[11],Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,c=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let Z=!1;if(this.aE=w,"object"===typeof P&&null!==P?(Z=P.updatable??!1,h=P.postponeInternalCreation,U=P.stride,l=P.instanced,i=P.offset,O=P.size,u=P.type,V=P.normalized??!1,a=P.useBytes??!1,Q=P.divisor??1,c=P.takeBufferOwnership??!1,this._label=P.label):Z=!!P,E instanceof y?(this._buffer=E,this._ownsBuffer=c):(this._buffer=new y(w,E,Z,U,h,l,a,Q,this._label),this._ownsBuffer=!0),this.uniqueId=x._Counter++,this._kind=G,void 0===u){const w=this.getData();this.type=w?x.GetDataType(w):x.FLOAT}else this.type=u;const J=(0,B.m)(this.type);a?(this._size=O||(U?U/J:x.DeduceStride(G)),this.byteStride=U||this._buffer.byteStride||this._size*J,this.byteOffset=i||0):(this._size=O||U||x.DeduceStride(G),this.byteStride=U?U*J:this._buffer.byteStride||this._size*J,this.byteOffset=(i||0)*J),this.normalized=V,this._instanced=void 0!==l&&l,this._instanceDivisor=l?Q:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var w;null===(w=this._buffer)||void 0===w||w._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(w,E){const G=this.getData();return G?(0,B.k)(G,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,w,E):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,B.m)(this.type)}getOffset(){return this.byteOffset/(0,B.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,B.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(w){this._buffer.create(w),this._alignBuffer()}update(w){this._buffer.update(w),this._alignBuffer()}updateDirectly(w,E){let G=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(w,E,void 0,G),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(w,E){(0,B.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,w,this.normalized,((w,G)=>{for(let P=0;P<this._size;P++)E(w[P],G+P)}))}_alignBuffer(){}static DeduceStride(w){switch(w){case x.UVKind:case x.UV2Kind:case x.UV3Kind:case x.UV4Kind:case x.UV5Kind:case x.UV6Kind:return 2;case x.NormalKind:case x.PositionKind:return 3;case x.ColorKind:case x.ColorInstanceKind:case x.MatricesIndicesKind:case x.MatricesIndicesExtraKind:case x.MatricesWeightsKind:case x.MatricesWeightsExtraKind:case x.TangentKind:return 4;default:throw new Error("Invalid kind '"+w+"'")}}static GetDataType(w){return w instanceof Int8Array?x.BYTE:w instanceof Uint8Array?x.UNSIGNED_BYTE:w instanceof Int16Array?x.SHORT:w instanceof Uint16Array?x.UNSIGNED_SHORT:w instanceof Int32Array?x.INT:w instanceof Uint32Array?x.UNSIGNED_INT:x.FLOAT}static GetTypeByteLength(w){return(0,B.m)(w)}static ForEach(w,E,G,P,h,y,x,U){(0,B.j)(w,E,G,P,h,y,x,((w,E)=>{for(let G=0;G<P;G++)U(w[G],E+G)}))}static GetFloatData(w,E,G,P,h,y,x,U){return(0,B.k)(w,E,G,P,h,y,x,U)}}x._Counter=0,x.BYTE=5120,x.UNSIGNED_BYTE=5121,x.SHORT=5122,x.UNSIGNED_SHORT=5123,x.INT=5124,x.UNSIGNED_INT=5125,x.FLOAT=5126,x.PositionKind="position",x.NormalKind="normal",x.TangentKind="tangent",x.UVKind="uv",x.UV2Kind="uv2",x.UV3Kind="uv3",x.UV4Kind="uv4",x.UV5Kind="uv5",x.UV6Kind="uv6",x.ColorKind="color",x.ColorInstanceKind="instanceColor",x.MatricesIndicesKind="matricesIndices",x.MatricesWeightsKind="matricesWeights",x.MatricesIndicesExtraKind="matricesIndicesExtra",x.MatricesWeightsExtraKind="matricesWeightsExtra"},11760:(w,E,G)=>{G.d(E,{d:()=>u,h:()=>O,j:()=>U,k:()=>l,m:()=>y,p:()=>x,r:()=>i});var P=G(11518);function h(w,E,G,P){switch(E){case 5120:{let E=w.getInt8(G);return P&&(E=Math.max(E/127,-1)),E}case 5121:{let E=w.getUint8(G);return P&&(E/=255),E}case 5122:{let E=w.getInt16(G,!0);return P&&(E=Math.max(E/32767,-1)),E}case 5123:{let E=w.getUint16(G,!0);return P&&(E/=65535),E}case 5124:return w.getInt32(G,!0);case 5125:return w.getUint32(G,!0);case 5126:return w.getFloat32(G,!0);default:throw new Error(`Invalid component type ${E}`)}}function B(w,E,G,P,h){switch(E){case 5120:P&&(h=Math.round(127*h)),w.setInt8(G,h);break;case 5121:P&&(h=Math.round(255*h)),w.setUint8(G,h);break;case 5122:P&&(h=Math.round(32767*h)),w.setInt16(G,h,!0);break;case 5123:P&&(h=Math.round(65535*h)),w.setUint16(G,h,!0);break;case 5124:w.setInt32(G,h,!0);break;case 5125:w.setUint32(G,h,!0);break;case 5126:w.setFloat32(G,h,!0);break;default:throw new Error(`Invalid component type ${E}`)}}function y(w){switch(w){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${w}'`)}}function x(w){switch(w){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${w}'`)}}function U(w,E,G,P,x,U,l,i){const O=new Array(P),u=new Array(P);if(w instanceof Array){let h=E/4;const B=G/4;for(let E=0;E<U;E+=P){for(let E=0;E<P;E++)O[E]=u[E]=w[h+E];i(u,E);for(let E=0;E<P;E++)O[E]!==u[E]&&(w[h+E]=u[E]);h+=B}}else{const V=ArrayBuffer.isView(w)?new DataView(w.buffer,w.byteOffset,w.byteLength):new DataView(w),a=y(x);for(let w=0;w<U;w+=P){for(let w=0,G=E;w<P;w++,G+=a)O[w]=u[w]=h(V,x,G,l);i(u,w);for(let w=0,G=E;w<P;w++,G+=a)O[w]!==u[w]&&B(V,x,G,l,u[w]);E+=G}}}function l(w,E,G,h,B,x,l,i){const O=E*y(G),u=l*E;if(5126!==G||B!==O){const P=new Float32Array(u);return U(w,h,B,E,G,u,x,((w,G)=>{for(let h=0;h<E;h++)P[G+h]=w[h]})),P}if(!(w instanceof Array||w instanceof Float32Array)||0!==h||w.length!==u){if(w instanceof Array){const E=h/4;return w.slice(E,E+u)}if(w instanceof ArrayBuffer)return new Float32Array(w,h,u);{const E=w.byteOffset+h;return 0!==(3&E)&&(P.e.Warn("Float array must be aligned to 4-bytes border"),i=!0),i?new Float32Array(w.buffer.slice(E,E+u*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(w.buffer,E,u)}}return i?w.slice():w}function i(w,E,G,h,B,l,i,O){const u=y(G),V=x(G),a=i*E;if(Array.isArray(w)){if(0!==(3&h)||0!==(3&B))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const P=h/4,y=B/4;if(P+(i-1)*y+E>w.length)throw new Error("Last accessed index is out of bounds.");if(y<E)throw new Error("Data stride cannot be smaller than the component size.");if(y!==E){const P=new V(a);return U(w,h,B,E,G,a,l,((w,G)=>{for(let h=0;h<E;h++)P[G+h]=w[h]})),P}return new V(w.slice(P,P+a))}let Q,c=h;w instanceof ArrayBuffer?Q=w:(Q=w.buffer,c+=w.byteOffset);if(c+(i-1)*B+E*u>Q.byteLength)throw new Error("Last accessed byte is out of bounds.");const Z=E*u;if(B<Z)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(B!==Z){const w=new V(a);return U(Q,c,B,E,G,a,l,((G,P)=>{for(let h=0;h<E;h++)w[P+h]=G[h]})),w}return 1!==u&&0!==(c&u-1)&&(P.e.Warn("Array must be aligned to border of element size. Data will be copied."),O=!0),O?new V(Q.slice(c,c+a*u)):new V(Q,c,a)}function O(w,E,G,h,B,x,l,i){const O=E*y(G),u=l*E;if(i.length!==u)throw new Error("Output length is not valid");if(5126===G&&B===O)if(w instanceof Array){const E=h/4;i.set(w,E)}else if(w instanceof ArrayBuffer){const E=new Float32Array(w,h,u);i.set(E)}else{const E=w.byteOffset+h;if(0!==(3&E))return P.e.Warn("Float array must be aligned to 4-bytes border"),void i.set(new Float32Array(w.buffer.slice(E,E+u*Float32Array.BYTES_PER_ELEMENT)));const G=new Float32Array(w.buffer,E,u);i.set(G)}else U(w,h,B,E,G,u,x,((w,G)=>{for(let P=0;P<E;P++)i[G+P]=w[P]}))}function u(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(w)){for(let h=0;h<E;h++)if(w[G+h]-P>65535)return!0;return!1}return 4===w.BYTES_PER_ELEMENT}},11754:(w,E,G)=>{G.d(E,{b:()=>P});class P{get underlyingResource(){return null}constructor(){this.references=0,this.Cx=0,this.is32Bits=!1,this.uniqueId=P._Counter++}}P._Counter=0},11787:(w,E,G)=>{G.d(E,{c:()=>h});var P=G(11576);class h{static GetEffect(w){return void 0===w.getPipelineContext?w.effect:w}constructor(w){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=w.createDrawContext(),E&&(this.materialContext=w.createMaterialContext())}setEffect(w,E){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var P;(this.effect=w,void 0!==E&&(this.defines=E),G)&&(null===(P=this.drawContext)||void 0===P||P.reset())}dispose(){var w;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const w=this.effect;E?w.dispose():P.e.SetImmediate((()=>{w.getEngine().onEndFrameObservable.addOnce((()=>{w.dispose()}))})),this.effect=null}null===(w=this.drawContext)||void 0===w||w.dispose()}}},11872:(w,E,G)=>{G.d(E,{b:()=>h});var P=G(11722);class h{static GetPlanes(w){const E=[];for(let G=0;G<6;G++)E.push(new P.d(0,0,0,0));return h.GetPlanesToRef(w,E),E}static GetNearPlaneToRef(w,E){const G=w.m;E.normal.x=G[3]+G[2],E.normal.y=G[7]+G[6],E.normal.z=G[11]+G[10],E.d=G[15]+G[14],E.normalize()}static GetFarPlaneToRef(w,E){const G=w.m;E.normal.x=G[3]-G[2],E.normal.y=G[7]-G[6],E.normal.z=G[11]-G[10],E.d=G[15]-G[14],E.normalize()}static GetLeftPlaneToRef(w,E){const G=w.m;E.normal.x=G[3]+G[0],E.normal.y=G[7]+G[4],E.normal.z=G[11]+G[8],E.d=G[15]+G[12],E.normalize()}static GetRightPlaneToRef(w,E){const G=w.m;E.normal.x=G[3]-G[0],E.normal.y=G[7]-G[4],E.normal.z=G[11]-G[8],E.d=G[15]-G[12],E.normalize()}static GetTopPlaneToRef(w,E){const G=w.m;E.normal.x=G[3]-G[1],E.normal.y=G[7]-G[5],E.normal.z=G[11]-G[9],E.d=G[15]-G[13],E.normalize()}static GetBottomPlaneToRef(w,E){const G=w.m;E.normal.x=G[3]+G[1],E.normal.y=G[7]+G[5],E.normal.z=G[11]+G[9],E.d=G[15]+G[13],E.normalize()}static GetPlanesToRef(w,E){h.GetNearPlaneToRef(w,E[0]),h.GetFarPlaneToRef(w,E[1]),h.GetLeftPlaneToRef(w,E[2]),h.GetRightPlaneToRef(w,E[3]),h.GetTopPlaneToRef(w,E[4]),h.GetBottomPlaneToRef(w,E[5])}static IsPointInFrustum(w,E){for(let G=0;G<6;G++)if(E[G].dotCoordinate(w)<0)return!1;return!0}}},11879:(w,E,G)=>{G.d(E,{c:()=>h});var P=G(11528);class h{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(w,E){h.Enabled&&(this._current+=w,E&&this._fetchResult())}beginMonitoring(){h.Enabled&&(this._startMonitoringTime=P.c.Now)}endMonitoring(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!h.Enabled)return;w&&this.fetchNewFrame();const E=P.c.Now;this._current=E-this._startMonitoringTime,w&&this._fetchResult()}Kh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const w=P.c.Now;w-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=w,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}h.Enabled=!0},11771:(w,E,G)=>{G.d(E,{b:()=>h,d:()=>P});class P{constructor(w){this.length=0,this.data=new Array(w),this._id=P._GlobalId++}push(w){this.data[this.length++]=w,this.length>this.data.length&&(this.data.length*=2)}forEach(w){for(let E=0;E<this.length;E++)w(this.data[E])}sort(w){this.data.sort(w)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(w){if(0!==w.length){this.length+w.length>this.data.length&&(this.data.length=2*(this.length+w.length));for(let E=0;E<w.length;E++)this.data[this.length++]=(w.data||w)[E]}}indexOf(w){const E=this.data.indexOf(w);return E>=this.length?-1:E}contains(w){return-1!==this.indexOf(w)}}P._GlobalId=0;class h extends P{constructor(){super(...arguments),this._duplicateId=0}push(w){super.push(w),w.__smartArrayFlags||(w.__smartArrayFlags={}),w.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(w){return(!w.__smartArrayFlags||w.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(w),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(w){if(0!==w.length){this.length+w.length>this.data.length&&(this.data.length=2*(this.length+w.length));for(let E=0;E<w.length;E++){const G=(w.data||w)[E];this.pushNoDuplicate(G)}}}}},11740:(w,E,G)=>{G.d(E,{d:()=>B});var P=G(11748),h=G(11504);class B{constructor(w){this._vertexBuffers={},this.onBeforeRenderObservable=new h.d,this._scene=w}_prepareBuffers(){if(this._vertexBuffers[P.g.PositionKind])return;const w=[];w.push(1,1),w.push(-1,1),w.push(-1,-1),w.push(1,-1),this._vertexBuffers[P.g.PositionKind]=new P.g(this._scene.getEngine(),w,P.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const w=[];w.push(0),w.push(1),w.push(2),w.push(0),w.push(2),w.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(w)}_rebuild(){const w=this._vertexBuffers[P.g.PositionKind];w&&(w._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const G=this._scene.activeCamera;return!!G&&(E=E||G._postProcesses.filter((w=>null!=w)),!(!E||0===E.length||!this._scene.postProcessesEnabled)&&(E[0].activate(G,w,null!==E&&void 0!==E),!0))}directRender(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2&&void 0!==arguments[2]&&arguments[2],P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:w.length;const x=this._scene.getEngine();for(let l=0;l<y;l++){var U;if(l<w.length-1)w[l+1].activate(this._scene.activeCamera||this._scene,null===E||void 0===E?void 0:E.texture);else E?x.bindFramebuffer(E,P,void 0,void 0,G,h):B||x.restoreDefaultFramebuffer(),null===(U=x._debugInsertMarker)||void 0===U||U.call(x,`post process ${w[l].name} output`);const y=w[l],i=y.apply();i&&(y.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),x.bindBuffers(this._vertexBuffers,this._indexBuffer,i),x.drawElementsType(0,0,6),y.onAfterRenderObservable.notifyObservers(i))}x.setDepthBuffer(!0),x.setDepthWrite(!0)}_finalizeFrame(w,E,G,P){let h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const B=this._scene.activeCamera;if(!B)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(P=P||B._postProcesses.filter((w=>null!=w))).length||!this._scene.postProcessesEnabled)return;const y=this._scene.getEngine();for(let U=0,l=P.length;U<l;U++){const i=P[U];var x;if(U<l-1)i._outputTexture=P[U+1].activate(B,null===E||void 0===E?void 0:E.texture);else E?(y.bindFramebuffer(E,G,void 0,void 0,h),i._outputTexture=E):(y.restoreDefaultFramebuffer(),i._outputTexture=null),null===(x=y._debugInsertMarker)||void 0===x||x.call(y,`post process ${P[U].name} output`);if(w)break;const O=i.apply();O&&(i.onBeforeRenderObservable.notifyObservers(O),this._prepareBuffers(),y.bindBuffers(this._vertexBuffers,this._indexBuffer,O),y.drawElementsType(0,0,6),i.onAfterRenderObservable.notifyObservers(O))}y.setDepthBuffer(!0),y.setDepthWrite(!0),y.setAlphaMode(0)}dispose(){const w=this._vertexBuffers[P.g.PositionKind];w&&(w.dispose(),this._vertexBuffers[P.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11766:(w,E,G)=>{G.d(E,{b:()=>x});var P=G(11771),h=G(11679);class B{set opaqueSortCompareFn(w){this._opaqueSortCompareFn=w||B.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(w){this._alphaTestSortCompareFn=w||B.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(w){this._transparentSortCompareFn=w||B.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(w,E){let G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=w,this._opaqueSubMeshes=new P.d(256),this._transparentSubMeshes=new P.d(256),this._alphaTestSubMeshes=new P.d(256),this._depthOnlySubMeshes=new P.d(256),this._particleSystems=new P.d(256),this._spriteManagers=new P.d(256),this._empty=!0,this._edgesRenderers=new P.b(16),this._scene=E,this.opaqueSortCompareFn=G,this.alphaTestSortCompareFn=h,this.transparentSortCompareFn=B}render(w,E,G,P){if(w)return void w(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const h=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(h.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),h.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const B=h.getStencilBuffer();if(h.setStencilBuffer(!1),E&&this._renderSprites(),G&&this._renderParticles(P),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(h.setStencilBuffer(B),this._scene.useOrderIndependentTransparency){const w=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);w.length&&this._renderTransparent(w)}else this._renderTransparent(this._transparentSubMeshes);h.setAlphaMode(0)}if(h.setStencilBuffer(!1),this._edgesRenderers.length){for(let w=0;w<this._edgesRenderers.length;w++)this._edgesRenderers.data[w].render();h.setAlphaMode(0)}h.setStencilBuffer(B)}_renderOpaqueSorted(w){B._RenderSorted(w,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(w){B._RenderSorted(w,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(w){B._RenderSorted(w,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(w,E,G,P){let y,x=0;const U=G?G.globalPosition:B._ZeroVector;if(P)for(;x<w.length;x++)y=w.data[x],y._alphaIndex=y.getMesh().alphaIndex,y._distanceToCamera=h.QE.Distance(y.getBoundingInfo().boundingSphere.centerWorld,U);const l=w.length===w.data.length?w.data:w.data.slice(0,w.length);E&&l.sort(E);const i=l[0].getMesh().Ww();for(x=0;x<l.length;x++)if(y=l[x],!i._activeMeshesFrozenButKeepClipping||y.isInFrustum(i._frustumPlanes)){if(P){const w=y.Mw();if(w&&w.needDepthPrePass){const E=w.Ww().getEngine();E.setColorWrite(!1),E.setAlphaMode(0),y.render(!1),E.setColorWrite(!0)}}y.render(P)}}static defaultTransparentSortCompare(w,E){return w._alphaIndex>E._alphaIndex?1:w._alphaIndex<E._alphaIndex?-1:B.backToFrontSortCompare(w,E)}static backToFrontSortCompare(w,E){return w._distanceToCamera<E._distanceToCamera?1:w._distanceToCamera>E._distanceToCamera?-1:0}static frontToBackSortCompare(w,E){return w._distanceToCamera<E._distanceToCamera?-1:w._distanceToCamera>E._distanceToCamera?1:0}static PainterSortCompare(w,E){const G=w.getMesh(),P=E.getMesh();return G.material&&P.material?G.material.uniqueId-P.material.uniqueId:G.uniqueId-P.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(w,E,G){void 0===E&&(E=w.getMesh()),void 0===G&&(G=w.Mw()),null!==G&&void 0!==G&&(G.needAlphaBlendingForMesh(E)?this._transparentSubMeshes.push(w):G.needAlphaTestingForMesh(E)?(G.needDepthPrePass&&this._depthOnlySubMeshes.push(w),this._alphaTestSubMeshes.push(w)):(G.needDepthPrePass&&this._depthOnlySubMeshes.push(w),this._opaqueSubMeshes.push(w)),E._renderingGroup=this,E._edgesRenderer&&E.isEnabled()&&E.isVisible&&E._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(E._edgesRenderer),this._empty=!1)}dispatchSprites(w){this._spriteManagers.push(w),this._empty=!1}dispatchParticles(w){this._particleSystems.push(w),this._empty=!1}_renderParticles(w){if(0===this._particleSystems.length)return;const E=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let G=0;G<this._particleSystems.length;G++){const P=this._particleSystems.data[G];if(0===(E&&E.layerMask&P.layerMask))continue;const h=P.hE;h.position&&w&&-1===w.indexOf(h)||this._scene._activeParticles.addCount(P.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const w=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let E=0;E<this._spriteManagers.length;E++){const G=this._spriteManagers.data[E];0!==(w&&w.layerMask&G.layerMask)&&G.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}B._ZeroVector=h.QE.Zero();class y{}class x{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(w){w!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=w,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const w of this._scene.meshes)if(w.Dh)for(const E of w.Dh)E._wasDispatched=!1;if(this._scene.spriteManagers)for(const w of this._scene.spriteManagers)w._wasDispatched=!1;for(const w of this._scene.Pu)w._wasDispatched=!1}constructor(w){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new y,this._maintainStateBetweenFrames=!1,this._scene=w;for(let E=x.MIN_RENDERINGGROUPS;E<x.MAX_RENDERINGGROUPS;E++)this._autoClearDepthStencil[E]={Nh:!0,depth:!0,stencil:!0}}getRenderingGroup(w){const E=w||0;return this._prepareRenderingGroup(E),this._renderingGroups[E]}_clearDepthStencilBuffer(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,w,E),this._depthStencilBufferAlreadyCleaned=!0)}render(w,E,G,P){const h=this._renderingGroupInfo;if(h.ZE=this._scene,h.camera=this._scene.activeCamera,h.renderingManager=this,this._scene.spriteManagers&&P)for(let B=0;B<this._scene.spriteManagers.length;B++){const w=this._scene.spriteManagers[B];this.dispatchSprites(w)}for(let B=x.MIN_RENDERINGGROUPS;B<x.MAX_RENDERINGGROUPS;B++){this._depthStencilBufferAlreadyCleaned=B===x.MIN_RENDERINGGROUPS;const y=this._renderingGroups[B];if(!y||y._empty)continue;const U=1<<B;if(h.renderingGroupId=B,this._scene.onBeforeRenderingGroupObservable.notifyObservers(h,U),x.AUTOCLEAR){const w=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(B):this._autoClearDepthStencil[B];w&&w.Nh&&this._clearDepthStencilBuffer(w.depth,w.stencil)}for(const w of this._scene._beforeRenderingGroupDrawStage)w.action(B);y.render(w,P,G,E);for(const w of this._scene._afterRenderingGroupDrawStage)w.action(B);this._scene.onAfterRenderingGroupObservable.notifyObservers(h,U)}}reset(){if(!this.maintainStateBetweenFrames)for(let w=x.MIN_RENDERINGGROUPS;w<x.MAX_RENDERINGGROUPS;w++){const E=this._renderingGroups[w];E&&E.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let w=x.MIN_RENDERINGGROUPS;w<x.MAX_RENDERINGGROUPS;w++){const E=this._renderingGroups[w];E&&E.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let w=x.MIN_RENDERINGGROUPS;w<x.MAX_RENDERINGGROUPS;w++){const E=this._renderingGroups[w];E&&E.dispose()}}_prepareRenderingGroup(w){void 0===this._renderingGroups[w]&&(this._renderingGroups[w]=new B(w,this._scene,this._customOpaqueSortCompareFn[w],this._customAlphaTestSortCompareFn[w],this._customTransparentSortCompareFn[w]))}dispatchSprites(w){this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(w.renderingGroupId).dispatchSprites(w))}dispatchParticles(w){this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(w.renderingGroupId).dispatchParticles(w))}dispatch(w,E,G){void 0===E&&(E=w.getMesh()),this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatch(w,E,G))}setRenderingOrder(w){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,G=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,P=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[w]=E,this._customAlphaTestSortCompareFn[w]=G,this._customTransparentSortCompareFn[w]=P,this._renderingGroups[w]){const E=this._renderingGroups[w];E.opaqueSortCompareFn=this._customOpaqueSortCompareFn[w],E.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[w],E.transparentSortCompareFn=this._customTransparentSortCompareFn[w]}}setRenderingAutoClearDepthStencil(w,E){let G=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],P=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[w]={Nh:E,depth:G,stencil:P}}getAutoClearDepthStencilSetup(w){return this._autoClearDepthStencil[w]}}x.MAX_RENDERINGGROUPS=4,x.MIN_RENDERINGGROUPS=0,x.AUTOCLEAR=!0}}]);