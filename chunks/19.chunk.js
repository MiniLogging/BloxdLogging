"use strict";(self["9x1utqq1axc"]=self["9x1utqq1axc"]||[]).push([[19],{12400:(y,c,A)=>{A.d(c,{c:()=>p,e:()=>W});var l=A(12408),w=A(12161),N=A(12410);class p{get I(){return this._isDisposed}constructor(y,c,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],W=arguments.length>6&&void 0!==arguments[6]&&arguments[6],h=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,y&&y.mc?this._engine=y.mc().getEngine():this._engine=y,this._updatable=A,this._instanced=p,this._divisor=h||1,this._label=I,c instanceof l.c?(this._data=null,this._buffer=c):(this._data=c,this._buffer=null),this.byteStride=W?w:w*Float32Array.BYTES_PER_ELEMENT,N||this.create()}createVertexBuffer(y,c,A,l,w){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6?arguments[6]:void 0;const h=N?c:c*Float32Array.BYTES_PER_ELEMENT,I=l?N?l:l*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new W(this._engine,this,y,this._updatable,!0,I,void 0===w?this._instanced:w,h,A,void 0,void 0,!0,this._divisor||p)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!y&&this._buffer||(y=y||this._data,y&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,y),this._data=y):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(y,this._label),this._data=y):this._buffer=this._engine.createVertexBuffer(y,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.PA>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.PA,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.PA,void 0,this._label));w.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(y){this.create(y)}updateDirectly(y,c,A){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,y,l?c:c*Float32Array.BYTES_PER_ELEMENT,A?A*this.byteStride:void 0),this._data=0===c&&void 0===A?y:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class W{get I(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(y){const c=0!=y;this._instanceDivisor=y,c!==this._instanced&&(this._instanced=c,this._computeHashCode())}get _maxVerticesCount(){const y=this.getData();return y?Array.isArray(y)?y.length/(this.byteStride/4)-this.byteOffset/4:(y.byteLength-this.byteOffset)/this.byteStride:0}constructor(y,c,A,l,w,h,I,q,o,O){let L=arguments.length>10&&void 0!==arguments[10]&&arguments[10],i=arguments.length>11&&void 0!==arguments[11]&&arguments[11],H=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,P=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let D=!1;if(this.Uc=y,"object"===typeof l&&null!==l?(D=l.updatable??!1,w=l.postponeInternalCreation,h=l.stride,I=l.instanced,q=l.offset,o=l.size,O=l.type,L=l.normalized??!1,i=l.useBytes??!1,H=l.divisor??1,P=l.takeBufferOwnership??!1,this._label=l.label):D=!!l,c instanceof p?(this._buffer=c,this._ownsBuffer=P):(this._buffer=new p(y,c,D,h,w,I,i,H,this._label),this._ownsBuffer=!0),this.uniqueId=W._Counter++,this._kind=A,void 0===O){const y=this.getData();this.type=y?W.GetDataType(y):W.FLOAT}else this.type=O;const t=(0,N.t)(this.type);i?(this._size=o||(h?h/t:W.DeduceStride(A)),this.byteStride=h||this._buffer.byteStride||this._size*t,this.byteOffset=q||0):(this._size=o||h||W.DeduceStride(A),this.byteStride=h?h*t:this._buffer.byteStride||this._size*t,this.byteOffset=(q||0)*t),this.normalized=L,this._instanced=void 0!==I&&I,this._instanceDivisor=I?H:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var y;null===(y=this._buffer)||void 0===y||y._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(y,c){const A=this.getData();return A?(0,N.p)(A,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,y,c):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,N.t)(this.type)}getOffset(){return this.byteOffset/(0,N.t)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,N.t)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(y){this._buffer.create(y),this._alignBuffer()}update(y){this._buffer.update(y),this._alignBuffer()}updateDirectly(y,c){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(y,c,void 0,A),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(y,c){(0,N.m)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,y,this.normalized,((y,A)=>{for(let l=0;l<this._size;l++)c(y[l],A+l)}))}_alignBuffer(){}static DeduceStride(y){switch(y){case W.UVKind:case W.UV2Kind:case W.UV3Kind:case W.UV4Kind:case W.UV5Kind:case W.UV6Kind:return 2;case W.NormalKind:case W.PositionKind:return 3;case W.ColorKind:case W.ColorInstanceKind:case W.MatricesIndicesKind:case W.MatricesIndicesExtraKind:case W.MatricesWeightsKind:case W.MatricesWeightsExtraKind:case W.TangentKind:return 4;default:throw new Error("Invalid kind '"+y+"'")}}static GetDataType(y){return y instanceof Int8Array?W.BYTE:y instanceof Uint8Array?W.UNSIGNED_BYTE:y instanceof Int16Array?W.SHORT:y instanceof Uint16Array?W.UNSIGNED_SHORT:y instanceof Int32Array?W.INT:y instanceof Uint32Array?W.UNSIGNED_INT:W.FLOAT}static GetTypeByteLength(y){return(0,N.t)(y)}static ForEach(y,c,A,l,w,p,W,h){(0,N.m)(y,c,A,l,w,p,W,((y,c)=>{for(let A=0;A<l;A++)h(y[A],c+A)}))}static GetFloatData(y,c,A,l,w,p,W,h){return(0,N.p)(y,c,A,l,w,p,W,h)}}W._Counter=0,W.BYTE=5120,W.UNSIGNED_BYTE=5121,W.SHORT=5122,W.UNSIGNED_SHORT=5123,W.INT=5124,W.UNSIGNED_INT=5125,W.FLOAT=5126,W.PositionKind="position",W.NormalKind="normal",W.TangentKind="tangent",W.UVKind="uv",W.UV2Kind="uv2",W.UV3Kind="uv3",W.UV4Kind="uv4",W.UV5Kind="uv5",W.UV6Kind="uv6",W.ColorKind="color",W.ColorInstanceKind="instanceColor",W.MatricesIndicesKind="matricesIndices",W.MatricesWeightsKind="matricesWeights",W.MatricesIndicesExtraKind="matricesIndicesExtra",W.MatricesWeightsExtraKind="matricesWeightsExtra"},12410:(y,c,A)=>{A.d(c,{e:()=>O,i:()=>o,m:()=>h,p:()=>I,t:()=>p,v:()=>W,y:()=>q});var l=A(12161);function w(y,c,A,l){switch(c){case 5120:{let c=y.getInt8(A);return l&&(c=Math.max(c/127,-1)),c}case 5121:{let c=y.getUint8(A);return l&&(c/=255),c}case 5122:{let c=y.getInt16(A,!0);return l&&(c=Math.max(c/32767,-1)),c}case 5123:{let c=y.getUint16(A,!0);return l&&(c/=65535),c}case 5124:return y.getInt32(A,!0);case 5125:return y.getUint32(A,!0);case 5126:return y.getFloat32(A,!0);default:throw new Error(`Invalid component type ${c}`)}}function N(y,c,A,l,w){switch(c){case 5120:l&&(w=Math.round(127*w)),y.setInt8(A,w);break;case 5121:l&&(w=Math.round(255*w)),y.setUint8(A,w);break;case 5122:l&&(w=Math.round(32767*w)),y.setInt16(A,w,!0);break;case 5123:l&&(w=Math.round(65535*w)),y.setUint16(A,w,!0);break;case 5124:y.setInt32(A,w,!0);break;case 5125:y.setUint32(A,w,!0);break;case 5126:y.setFloat32(A,w,!0);break;default:throw new Error(`Invalid component type ${c}`)}}function p(y){switch(y){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${y}'`)}}function W(y){switch(y){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${y}'`)}}function h(y,c,A,l,W,h,I,q){const o=new Array(l),O=new Array(l);if(y instanceof Array){let w=c/4;const N=A/4;for(let c=0;c<h;c+=l){for(let c=0;c<l;c++)o[c]=O[c]=y[w+c];q(O,c);for(let c=0;c<l;c++)o[c]!==O[c]&&(y[w+c]=O[c]);w+=N}}else{const L=ArrayBuffer.isView(y)?new DataView(y.buffer,y.byteOffset,y.byteLength):new DataView(y),i=p(W);for(let y=0;y<h;y+=l){for(let y=0,A=c;y<l;y++,A+=i)o[y]=O[y]=w(L,W,A,I);q(O,y);for(let y=0,A=c;y<l;y++,A+=i)o[y]!==O[y]&&N(L,W,A,I,O[y]);c+=A}}}function I(y,c,A,w,N,W,I,q){const o=c*p(A),O=I*c;if(5126!==A||N!==o){const l=new Float32Array(O);return h(y,w,N,c,A,O,W,((y,A)=>{for(let w=0;w<c;w++)l[A+w]=y[w]})),l}if(!(y instanceof Array||y instanceof Float32Array)||0!==w||y.length!==O){if(y instanceof Array){const c=w/4;return y.slice(c,c+O)}if(y instanceof ArrayBuffer)return new Float32Array(y,w,O);{const c=y.byteOffset+w;return 0!==(3&c)&&(l.c.Warn("Float array must be aligned to 4-bytes border"),q=!0),q?new Float32Array(y.buffer.slice(c,c+O*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(y.buffer,c,O)}}return q?y.slice():y}function q(y,c,A,w,N,I,q,o){const O=p(A),L=W(A),i=q*c;if(Array.isArray(y)){if(0!==(3&w)||0!==(3&N))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const l=w/4,p=N/4;if(l+(q-1)*p+c>y.length)throw new Error("Last accessed index is out of bounds.");if(p<c)throw new Error("Data stride cannot be smaller than the component size.");if(p!==c){const l=new L(i);return h(y,w,N,c,A,i,I,((y,A)=>{for(let w=0;w<c;w++)l[A+w]=y[w]})),l}return new L(y.slice(l,l+i))}let H,P=w;y instanceof ArrayBuffer?H=y:(H=y.buffer,P+=y.byteOffset);if(P+(q-1)*N+c*O>H.byteLength)throw new Error("Last accessed byte is out of bounds.");const D=c*O;if(N<D)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(N!==D){const y=new L(i);return h(H,P,N,c,A,i,I,((A,l)=>{for(let w=0;w<c;w++)y[l+w]=A[w]})),y}return 1!==O&&0!==(P&O-1)&&(l.c.Warn("Array must be aligned to border of element size. Data will be copied."),o=!0),o?new L(H.slice(P,P+i*O)):new L(H,P,i)}function o(y,c,A,w,N,W,I,q){const o=c*p(A),O=I*c;if(q.length!==O)throw new Error("Output length is not valid");if(5126===A&&N===o)if(y instanceof Array){const c=w/4;q.set(y,c)}else if(y instanceof ArrayBuffer){const c=new Float32Array(y,w,O);q.set(c)}else{const c=y.byteOffset+w;if(0!==(3&c))return l.c.Warn("Float array must be aligned to 4-bytes border"),void q.set(new Float32Array(y.buffer.slice(c,c+O*Float32Array.BYTES_PER_ELEMENT)));const A=new Float32Array(y.buffer,c,O);q.set(A)}else h(y,w,N,c,A,O,W,((y,A)=>{for(let l=0;l<c;l++)q[A+l]=y[l]}))}function O(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(y)){for(let w=0;w<c;w++)if(y[A+w]-l>65535)return!0;return!1}return 4===y.BYTES_PER_ELEMENT}},12408:(y,c,A)=>{A.d(c,{c:()=>l});class l{get underlyingResource(){return null}constructor(){this.references=0,this.PA=0,this.is32Bits=!1,this.uniqueId=l._Counter++}}l._Counter=0},12448:(y,c,A)=>{A.d(c,{d:()=>w});var l=A(12212);class w{static GetEffect(y){return void 0===y.getPipelineContext?y.effect:y}constructor(y){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=y.createDrawContext(),c&&(this.materialContext=y.createMaterialContext())}setEffect(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var l;(this.effect=y,void 0!==c&&(this.defines=c),A)&&(null===(l=this.drawContext)||void 0===l||l.reset())}dispose(){var y;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const y=this.effect;c?y.dispose():l.c.SetImmediate((()=>{y.getEngine().onEndFrameObservable.addOnce((()=>{y.dispose()}))})),this.effect=null}null===(y=this.drawContext)||void 0===y||y.dispose()}}},12525:(y,c,A)=>{A.d(c,{e:()=>w});var l=A(12384);class w{static GetPlanes(y){const c=[];for(let A=0;A<6;A++)c.push(new l.c(0,0,0,0));return w.GetPlanesToRef(y,c),c}static GetNearPlaneToRef(y,c){const A=y.m;c.normal.x=A[3]+A[2],c.normal.y=A[7]+A[6],c.normal.z=A[11]+A[10],c.d=A[15]+A[14],c.normalize()}static GetFarPlaneToRef(y,c){const A=y.m;c.normal.x=A[3]-A[2],c.normal.y=A[7]-A[6],c.normal.z=A[11]-A[10],c.d=A[15]-A[14],c.normalize()}static GetLeftPlaneToRef(y,c){const A=y.m;c.normal.x=A[3]+A[0],c.normal.y=A[7]+A[4],c.normal.z=A[11]+A[8],c.d=A[15]+A[12],c.normalize()}static GetRightPlaneToRef(y,c){const A=y.m;c.normal.x=A[3]-A[0],c.normal.y=A[7]-A[4],c.normal.z=A[11]-A[8],c.d=A[15]-A[12],c.normalize()}static GetTopPlaneToRef(y,c){const A=y.m;c.normal.x=A[3]-A[1],c.normal.y=A[7]-A[5],c.normal.z=A[11]-A[9],c.d=A[15]-A[13],c.normalize()}static GetBottomPlaneToRef(y,c){const A=y.m;c.normal.x=A[3]+A[1],c.normal.y=A[7]+A[5],c.normal.z=A[11]+A[9],c.d=A[15]+A[13],c.normalize()}static GetPlanesToRef(y,c){w.GetNearPlaneToRef(y,c[0]),w.GetFarPlaneToRef(y,c[1]),w.GetLeftPlaneToRef(y,c[2]),w.GetRightPlaneToRef(y,c[3]),w.GetTopPlaneToRef(y,c[4]),w.GetBottomPlaneToRef(y,c[5])}static IsPointInFrustum(y,c){for(let A=0;A<6;A++)if(c[A].dotCoordinate(y)<0)return!1;return!0}}},12536:(y,c,A)=>{A.d(c,{d:()=>w});var l=A(12171);class w{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(y,c){w.Enabled&&(this._current+=y,c&&this._fetchResult())}beginMonitoring(){w.Enabled&&(this._startMonitoringTime=l.d.Now)}endMonitoring(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!w.Enabled)return;y&&this.fetchNewFrame();const c=l.d.Now;this._current=c-this._startMonitoringTime,y&&this._fetchResult()}Tc(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const y=l.d.Now;y-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=y,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}w.Enabled=!0},12419:(y,c,A)=>{A.d(c,{d:()=>w,f:()=>l});class l{constructor(y){this.length=0,this.data=new Array(y),this._id=l._GlobalId++}push(y){this.data[this.length++]=y,this.length>this.data.length&&(this.data.length*=2)}forEach(y){for(let c=0;c<this.length;c++)y(this.data[c])}sort(y){this.data.sort(y)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(y){if(0!==y.length){this.length+y.length>this.data.length&&(this.data.length=2*(this.length+y.length));for(let c=0;c<y.length;c++)this.data[this.length++]=(y.data||y)[c]}}indexOf(y){const c=this.data.indexOf(y);return c>=this.length?-1:c}contains(y){return-1!==this.indexOf(y)}}l._GlobalId=0;class w extends l{constructor(){super(...arguments),this._duplicateId=0}push(y){super.push(y),y.__smartArrayFlags||(y.__smartArrayFlags={}),y.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(y){return(!y.__smartArrayFlags||y.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(y),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(y){if(0!==y.length){this.length+y.length>this.data.length&&(this.data.length=2*(this.length+y.length));for(let c=0;c<y.length;c++){const A=(y.data||y)[c];this.pushNoDuplicate(A)}}}}},12396:(y,c,A)=>{A.d(c,{c:()=>N});var l=A(12400),w=A(12153);class N{constructor(y){this._vertexBuffers={},this.onBeforeRenderObservable=new w.d,this._scene=y}_prepareBuffers(){if(this._vertexBuffers[l.e.PositionKind])return;const y=[];y.push(1,1),y.push(-1,1),y.push(-1,-1),y.push(1,-1),this._vertexBuffers[l.e.PositionKind]=new l.e(this._scene.getEngine(),y,l.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const y=[];y.push(0),y.push(1),y.push(2),y.push(0),y.push(2),y.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(y)}_rebuild(){const y=this._vertexBuffers[l.e.PositionKind];y&&(y._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=this._scene.activeCamera;return!!A&&(c=c||A._postProcesses.filter((y=>null!=y)),!(!c||0===c.length||!this._scene.postProcessesEnabled)&&(c[0].activate(A,y,null!==c&&void 0!==c),!0))}directRender(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:y.length;const W=this._scene.getEngine();for(let I=0;I<p;I++){var h;if(I<y.length-1)y[I+1].activate(this._scene.activeCamera||this._scene,null===c||void 0===c?void 0:c.texture);else c?W.bindFramebuffer(c,l,void 0,void 0,A,w):N||W.restoreDefaultFramebuffer(),null===(h=W._debugInsertMarker)||void 0===h||h.call(W,`post process ${y[I].name} output`);const p=y[I],q=p.apply();q&&(p.onBeforeRenderObservable.notifyObservers(q),this._prepareBuffers(),W.bindBuffers(this._vertexBuffers,this._indexBuffer,q),W.drawElementsType(0,0,6),p.onAfterRenderObservable.notifyObservers(q))}W.setDepthBuffer(!0),W.setDepthWrite(!0)}_finalizeFrame(y,c,A,l){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const N=this._scene.activeCamera;if(!N)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(l=l||N._postProcesses.filter((y=>null!=y))).length||!this._scene.postProcessesEnabled)return;const p=this._scene.getEngine();for(let h=0,I=l.length;h<I;h++){const q=l[h];var W;if(h<I-1)q._outputTexture=l[h+1].activate(N,null===c||void 0===c?void 0:c.texture);else c?(p.bindFramebuffer(c,A,void 0,void 0,w),q._outputTexture=c):(p.restoreDefaultFramebuffer(),q._outputTexture=null),null===(W=p._debugInsertMarker)||void 0===W||W.call(p,`post process ${l[h].name} output`);if(y)break;const o=q.apply();o&&(q.onBeforeRenderObservable.notifyObservers(o),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,o),p.drawElementsType(0,0,6),q.onAfterRenderObservable.notifyObservers(o))}p.setDepthBuffer(!0),p.setDepthWrite(!0),p.setAlphaMode(0)}dispose(){const y=this._vertexBuffers[l.e.PositionKind];y&&(y.dispose(),this._vertexBuffers[l.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12413:(y,c,A)=>{A.d(c,{d:()=>W});var l=A(12419),w=A(12325);class N{set opaqueSortCompareFn(y){this._opaqueSortCompareFn=y||N.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(y){this._alphaTestSortCompareFn=y||N.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(y){this._transparentSortCompareFn=y||N.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(y,c){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=y,this._opaqueSubMeshes=new l.f(256),this._transparentSubMeshes=new l.f(256),this._alphaTestSubMeshes=new l.f(256),this._depthOnlySubMeshes=new l.f(256),this._particleSystems=new l.f(256),this._spriteManagers=new l.f(256),this._empty=!0,this._edgesRenderers=new l.d(16),this._scene=c,this.opaqueSortCompareFn=A,this.alphaTestSortCompareFn=w,this.transparentSortCompareFn=N}render(y,c,A,l){if(y)return void y(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const w=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(w.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),w.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const N=w.getStencilBuffer();if(w.setStencilBuffer(!1),c&&this._renderSprites(),A&&this._renderParticles(l),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(w.setStencilBuffer(N),this._scene.useOrderIndependentTransparency){const y=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);y.length&&this._renderTransparent(y)}else this._renderTransparent(this._transparentSubMeshes);w.setAlphaMode(0)}if(w.setStencilBuffer(!1),this._edgesRenderers.length){for(let y=0;y<this._edgesRenderers.length;y++)this._edgesRenderers.data[y].render();w.setAlphaMode(0)}w.setStencilBuffer(N)}_renderOpaqueSorted(y){N._RenderSorted(y,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(y){N._RenderSorted(y,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(y){N._RenderSorted(y,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(y,c,A,l){let p,W=0;const h=A?A.globalPosition:N._ZeroVector;if(l)for(;W<y.length;W++)p=y.data[W],p._alphaIndex=p.getMesh().alphaIndex,p._distanceToCamera=w.gc.Distance(p.getBoundingInfo().boundingSphere.centerWorld,h);const I=y.length===y.data.length?y.data:y.data.slice(0,y.length);c&&I.sort(c);const q=I[0].getMesh().mc();for(W=0;W<I.length;W++)if(p=I[W],!q._activeMeshesFrozenButKeepClipping||p.isInFrustum(q._frustumPlanes)){if(l){const y=p.ey();if(y&&y.needDepthPrePass){const c=y.mc().getEngine();c.setColorWrite(!1),c.setAlphaMode(0),p.render(!1),c.setColorWrite(!0)}}p.render(l)}}static defaultTransparentSortCompare(y,c){return y._alphaIndex>c._alphaIndex?1:y._alphaIndex<c._alphaIndex?-1:N.backToFrontSortCompare(y,c)}static backToFrontSortCompare(y,c){return y._distanceToCamera<c._distanceToCamera?1:y._distanceToCamera>c._distanceToCamera?-1:0}static frontToBackSortCompare(y,c){return y._distanceToCamera<c._distanceToCamera?-1:y._distanceToCamera>c._distanceToCamera?1:0}static PainterSortCompare(y,c){const A=y.getMesh(),l=c.getMesh();return A.material&&l.material?A.material.uniqueId-l.material.uniqueId:A.uniqueId-l.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(y,c,A){void 0===c&&(c=y.getMesh()),void 0===A&&(A=y.ey()),null!==A&&void 0!==A&&(A.needAlphaBlendingForMesh(c)?this._transparentSubMeshes.push(y):A.needAlphaTestingForMesh(c)?(A.needDepthPrePass&&this._depthOnlySubMeshes.push(y),this._alphaTestSubMeshes.push(y)):(A.needDepthPrePass&&this._depthOnlySubMeshes.push(y),this._opaqueSubMeshes.push(y)),c._renderingGroup=this,c._edgesRenderer&&c.isEnabled()&&c.isVisible&&c._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(c._edgesRenderer),this._empty=!1)}dispatchSprites(y){this._spriteManagers.push(y),this._empty=!1}dispatchParticles(y){this._particleSystems.push(y),this._empty=!1}_renderParticles(y){if(0===this._particleSystems.length)return;const c=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let A=0;A<this._particleSystems.length;A++){const l=this._particleSystems.data[A];if(0===(c&&c.layerMask&l.layerMask))continue;const w=l.Ic;w.position&&y&&-1===y.indexOf(w)||this._scene._activeParticles.addCount(l.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const y=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let c=0;c<this._spriteManagers.length;c++){const A=this._spriteManagers.data[c];0!==(y&&y.layerMask&A.layerMask)&&A.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}N._ZeroVector=w.gc.Zero();class p{}class W{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(y){y!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=y,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const y of this._scene.meshes)if(y.jc)for(const c of y.jc)c._wasDispatched=!1;if(this._scene.spriteManagers)for(const y of this._scene.spriteManagers)y._wasDispatched=!1;for(const y of this._scene.MO)y._wasDispatched=!1}constructor(y){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new p,this._maintainStateBetweenFrames=!1,this._scene=y;for(let c=W.MIN_RENDERINGGROUPS;c<W.MAX_RENDERINGGROUPS;c++)this._autoClearDepthStencil[c]={Gc:!0,depth:!0,Sc:!0}}getRenderingGroup(y){const c=y||0;return this._prepareRenderingGroup(c),this._renderingGroups[c]}_clearDepthStencilBuffer(){let y=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,y,c),this._depthStencilBufferAlreadyCleaned=!0)}render(y,c,A,l){const w=this._renderingGroupInfo;if(w.Fc=this._scene,w.camera=this._scene.activeCamera,w.renderingManager=this,this._scene.spriteManagers&&l)for(let N=0;N<this._scene.spriteManagers.length;N++){const y=this._scene.spriteManagers[N];this.dispatchSprites(y)}for(let N=W.MIN_RENDERINGGROUPS;N<W.MAX_RENDERINGGROUPS;N++){this._depthStencilBufferAlreadyCleaned=N===W.MIN_RENDERINGGROUPS;const p=this._renderingGroups[N];if(!p||p._empty)continue;const h=1<<N;if(w.renderingGroupId=N,this._scene.onBeforeRenderingGroupObservable.notifyObservers(w,h),W.AUTOCLEAR){const y=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(N):this._autoClearDepthStencil[N];y&&y.Gc&&this._clearDepthStencilBuffer(y.depth,y.Sc)}for(const y of this._scene._beforeRenderingGroupDrawStage)y.action(N);p.render(y,l,A,c);for(const y of this._scene._afterRenderingGroupDrawStage)y.action(N);this._scene.onAfterRenderingGroupObservable.notifyObservers(w,h)}}reset(){if(!this.maintainStateBetweenFrames)for(let y=W.MIN_RENDERINGGROUPS;y<W.MAX_RENDERINGGROUPS;y++){const c=this._renderingGroups[y];c&&c.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let y=W.MIN_RENDERINGGROUPS;y<W.MAX_RENDERINGGROUPS;y++){const c=this._renderingGroups[y];c&&c.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let y=W.MIN_RENDERINGGROUPS;y<W.MAX_RENDERINGGROUPS;y++){const c=this._renderingGroups[y];c&&c.dispose()}}_prepareRenderingGroup(y){void 0===this._renderingGroups[y]&&(this._renderingGroups[y]=new N(y,this._scene,this._customOpaqueSortCompareFn[y],this._customAlphaTestSortCompareFn[y],this._customTransparentSortCompareFn[y]))}dispatchSprites(y){this.maintainStateBetweenFrames&&y._wasDispatched||(y._wasDispatched=!0,this.getRenderingGroup(y.renderingGroupId).dispatchSprites(y))}dispatchParticles(y){this.maintainStateBetweenFrames&&y._wasDispatched||(y._wasDispatched=!0,this.getRenderingGroup(y.renderingGroupId).dispatchParticles(y))}dispatch(y,c,A){void 0===c&&(c=y.getMesh()),this.maintainStateBetweenFrames&&y._wasDispatched||(y._wasDispatched=!0,this.getRenderingGroup(c.renderingGroupId).dispatch(y,c,A))}setRenderingOrder(y){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[y]=c,this._customAlphaTestSortCompareFn[y]=A,this._customTransparentSortCompareFn[y]=l,this._renderingGroups[y]){const c=this._renderingGroups[y];c.opaqueSortCompareFn=this._customOpaqueSortCompareFn[y],c.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[y],c.transparentSortCompareFn=this._customTransparentSortCompareFn[y]}}setRenderingAutoClearDepthStencil(y,c){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[y]={Gc:c,depth:A,Sc:l}}getAutoClearDepthStencilSetup(y){return this._autoClearDepthStencil[y]}}W.MAX_RENDERINGGROUPS=4,W.MIN_RENDERINGGROUPS=0,W.AUTOCLEAR=!0}}]);