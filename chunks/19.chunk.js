"use strict";(self["5dou0t7wntc"]=self["5dou0t7wntc"]||[]).push([[19],{11793:(K,O,F)=>{F.d(O,{b:()=>q,d:()=>J});var f=F(11800),r=F(11534),l=F(11805);class q{get M(){return this._isDisposed}constructor(K,O,F){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7?arguments[7]:void 0,E=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,K&&K.HK?this._engine=K.HK().getEngine():this._engine=K,this._updatable=F,this._instanced=q,this._divisor=c||1,this._label=E,O instanceof f.b?(this._data=null,this._buffer=O):(this._data=O,this._buffer=null),this.byteStride=J?r:r*Float32Array.BYTES_PER_ELEMENT,l||this.create()}createVertexBuffer(K,O,F,f,r){let l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6?arguments[6]:void 0;const c=l?O:O*Float32Array.BYTES_PER_ELEMENT,E=f?l?f:f*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new J(this._engine,this,K,this._updatable,!0,E,void 0===r?this._instanced:r,c,F,void 0,void 0,!0,this._divisor||q)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!K&&this._buffer||(K=K||this._data,K&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,K),this._data=K):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(K,this._label),this._data=K):this._buffer=this._engine.createVertexBuffer(K,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.VO>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.VO,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.VO,void 0,this._label));r.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(K){this.create(K)}updateDirectly(K,O,F){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,K,f?O:O*Float32Array.BYTES_PER_ELEMENT,F?F*this.byteStride:void 0),this._data=0===O&&void 0===F?K:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class J{get M(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(K){const O=0!=K;this._instanceDivisor=K,O!==this._instanced&&(this._instanced=O,this._computeHashCode())}get _maxVerticesCount(){const K=this.getData();return K?Array.isArray(K)?K.length/(this.byteStride/4)-this.byteOffset/4:(K.byteLength-this.byteOffset)/this.byteStride:0}constructor(K,O,F,f,r,c,E,M,t,j){let X=arguments.length>10&&void 0!==arguments[10]&&arguments[10],u=arguments.length>11&&void 0!==arguments[11]&&arguments[11],T=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,o=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let k=!1;if(this.uO=K,"object"===typeof f&&null!==f?(k=f.updatable??!1,r=f.postponeInternalCreation,c=f.stride,E=f.instanced,M=f.offset,t=f.size,j=f.type,X=f.normalized??!1,u=f.useBytes??!1,T=f.divisor??1,o=f.takeBufferOwnership??!1,this._label=f.label):k=!!f,O instanceof q?(this._buffer=O,this._ownsBuffer=o):(this._buffer=new q(K,O,k,c,r,E,u,T,this._label),this._ownsBuffer=!0),this.uniqueId=J._Counter++,this._kind=F,void 0===j){const K=this.getData();this.type=K?J.GetDataType(K):J.FLOAT}else this.type=j;const N=(0,l.q)(this.type);u?(this._size=t||(c?c/N:J.DeduceStride(F)),this.byteStride=c||this._buffer.byteStride||this._size*N,this.byteOffset=M||0):(this._size=t||c||J.DeduceStride(F),this.byteStride=c?c*N:this._buffer.byteStride||this._size*N,this.byteOffset=(M||0)*N),this.normalized=X,this._instanced=void 0!==E&&E,this._instanceDivisor=E?T:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var K;null===(K=this._buffer)||void 0===K||K._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(K,O){const F=this.getData();return F?(0,l.o)(F,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,K,O):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,l.q)(this.type)}getOffset(){return this.byteOffset/(0,l.q)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,l.q)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(K){this._buffer.create(K),this._alignBuffer()}update(K){this._buffer.update(K),this._alignBuffer()}updateDirectly(K,O){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(K,O,void 0,F),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(K,O){(0,l.k)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,K,this.normalized,((K,F)=>{for(let f=0;f<this._size;f++)O(K[f],F+f)}))}_alignBuffer(){}static DeduceStride(K){switch(K){case J.UVKind:case J.UV2Kind:case J.UV3Kind:case J.UV4Kind:case J.UV5Kind:case J.UV6Kind:return 2;case J.NormalKind:case J.PositionKind:return 3;case J.ColorKind:case J.ColorInstanceKind:case J.MatricesIndicesKind:case J.MatricesIndicesExtraKind:case J.MatricesWeightsKind:case J.MatricesWeightsExtraKind:case J.TangentKind:return 4;default:throw new Error("Invalid kind '"+K+"'")}}static GetDataType(K){return K instanceof Int8Array?J.BYTE:K instanceof Uint8Array?J.UNSIGNED_BYTE:K instanceof Int16Array?J.SHORT:K instanceof Uint16Array?J.UNSIGNED_SHORT:K instanceof Int32Array?J.INT:K instanceof Uint32Array?J.UNSIGNED_INT:J.FLOAT}static GetTypeByteLength(K){return(0,l.q)(K)}static ForEach(K,O,F,f,r,q,J,c){(0,l.k)(K,O,F,f,r,q,J,((K,O)=>{for(let F=0;F<f;F++)c(K[F],O+F)}))}static GetFloatData(K,O,F,f,r,q,J,c){return(0,l.o)(K,O,F,f,r,q,J,c)}}J._Counter=0,J.BYTE=5120,J.UNSIGNED_BYTE=5121,J.SHORT=5122,J.UNSIGNED_SHORT=5123,J.INT=5124,J.UNSIGNED_INT=5125,J.FLOAT=5126,J.PositionKind="position",J.NormalKind="normal",J.TangentKind="tangent",J.UVKind="uv",J.UV2Kind="uv2",J.UV3Kind="uv3",J.UV4Kind="uv4",J.UV5Kind="uv5",J.UV6Kind="uv6",J.ColorKind="color",J.ColorInstanceKind="instanceColor",J.MatricesIndicesKind="matricesIndices",J.MatricesWeightsKind="matricesWeights",J.MatricesIndicesExtraKind="matricesIndicesExtra",J.MatricesWeightsExtraKind="matricesWeightsExtra"},11805:(K,O,F)=>{F.d(O,{d:()=>j,g:()=>t,k:()=>c,o:()=>E,q:()=>q,s:()=>J,t:()=>M});var f=F(11534);function r(K,O,F,f){switch(O){case 5120:{let O=K.getInt8(F);return f&&(O=Math.max(O/127,-1)),O}case 5121:{let O=K.getUint8(F);return f&&(O/=255),O}case 5122:{let O=K.getInt16(F,!0);return f&&(O=Math.max(O/32767,-1)),O}case 5123:{let O=K.getUint16(F,!0);return f&&(O/=65535),O}case 5124:return K.getInt32(F,!0);case 5125:return K.getUint32(F,!0);case 5126:return K.getFloat32(F,!0);default:throw new Error(`Invalid component type ${O}`)}}function l(K,O,F,f,r){switch(O){case 5120:f&&(r=Math.round(127*r)),K.setInt8(F,r);break;case 5121:f&&(r=Math.round(255*r)),K.setUint8(F,r);break;case 5122:f&&(r=Math.round(32767*r)),K.setInt16(F,r,!0);break;case 5123:f&&(r=Math.round(65535*r)),K.setUint16(F,r,!0);break;case 5124:K.setInt32(F,r,!0);break;case 5125:K.setUint32(F,r,!0);break;case 5126:K.setFloat32(F,r,!0);break;default:throw new Error(`Invalid component type ${O}`)}}function q(K){switch(K){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${K}'`)}}function J(K){switch(K){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${K}'`)}}function c(K,O,F,f,J,c,E,M){const t=new Array(f),j=new Array(f);if(K instanceof Array){let r=O/4;const l=F/4;for(let O=0;O<c;O+=f){for(let O=0;O<f;O++)t[O]=j[O]=K[r+O];M(j,O);for(let O=0;O<f;O++)t[O]!==j[O]&&(K[r+O]=j[O]);r+=l}}else{const X=ArrayBuffer.isView(K)?new DataView(K.buffer,K.byteOffset,K.byteLength):new DataView(K),u=q(J);for(let K=0;K<c;K+=f){for(let K=0,F=O;K<f;K++,F+=u)t[K]=j[K]=r(X,J,F,E);M(j,K);for(let K=0,F=O;K<f;K++,F+=u)t[K]!==j[K]&&l(X,J,F,E,j[K]);O+=F}}}function E(K,O,F,r,l,J,E,M){const t=O*q(F),j=E*O;if(5126!==F||l!==t){const f=new Float32Array(j);return c(K,r,l,O,F,j,J,((K,F)=>{for(let r=0;r<O;r++)f[F+r]=K[r]})),f}if(!(K instanceof Array||K instanceof Float32Array)||0!==r||K.length!==j){if(K instanceof Array){const O=r/4;return K.slice(O,O+j)}if(K instanceof ArrayBuffer)return new Float32Array(K,r,j);{const O=K.byteOffset+r;return 0!==(3&O)&&(f.c.Warn("Float array must be aligned to 4-bytes border"),M=!0),M?new Float32Array(K.buffer.slice(O,O+j*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(K.buffer,O,j)}}return M?K.slice():K}function M(K,O,F,r,l,E,M,t){const j=q(F),X=J(F),u=M*O;if(Array.isArray(K)){if(0!==(3&r)||0!==(3&l))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const f=r/4,q=l/4;if(f+(M-1)*q+O>K.length)throw new Error("Last accessed index is out of bounds.");if(q<O)throw new Error("Data stride cannot be smaller than the component size.");if(q!==O){const f=new X(u);return c(K,r,l,O,F,u,E,((K,F)=>{for(let r=0;r<O;r++)f[F+r]=K[r]})),f}return new X(K.slice(f,f+u))}let T,o=r;K instanceof ArrayBuffer?T=K:(T=K.buffer,o+=K.byteOffset);if(o+(M-1)*l+O*j>T.byteLength)throw new Error("Last accessed byte is out of bounds.");const k=O*j;if(l<k)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(l!==k){const K=new X(u);return c(T,o,l,O,F,u,E,((F,f)=>{for(let r=0;r<O;r++)K[f+r]=F[r]})),K}return 1!==j&&0!==(o&j-1)&&(f.c.Warn("Array must be aligned to border of element size. Data will be copied."),t=!0),t?new X(T.slice(o,o+u*j)):new X(T,o,u)}function t(K,O,F,r,l,J,E,M){const t=O*q(F),j=E*O;if(M.length!==j)throw new Error("Output length is not valid");if(5126===F&&l===t)if(K instanceof Array){const O=r/4;M.set(K,O)}else if(K instanceof ArrayBuffer){const O=new Float32Array(K,r,j);M.set(O)}else{const O=K.byteOffset+r;if(0!==(3&O))return f.c.Warn("Float array must be aligned to 4-bytes border"),void M.set(new Float32Array(K.buffer.slice(O,O+j*Float32Array.BYTES_PER_ELEMENT)));const F=new Float32Array(K.buffer,O,j);M.set(F)}else c(K,r,l,O,F,j,J,((K,F)=>{for(let f=0;f<O;f++)M[F+f]=K[f]}))}function j(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(K)){for(let r=0;r<O;r++)if(K[F+r]-f>65535)return!0;return!1}return 4===K.BYTES_PER_ELEMENT}},11800:(K,O,F)=>{F.d(O,{b:()=>f});class f{get underlyingResource(){return null}constructor(){this.references=0,this.VO=0,this.is32Bits=!1,this.uniqueId=f._Counter++}}f._Counter=0},11846:(K,O,F)=>{F.d(O,{c:()=>r});var f=F(11588);class r{static GetEffect(K){return void 0===K.getPipelineContext?K.effect:K}constructor(K){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=K.createDrawContext(),O&&(this.materialContext=K.createMaterialContext())}setEffect(K,O){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var f;(this.effect=K,void 0!==O&&(this.defines=O),F)&&(null===(f=this.drawContext)||void 0===f||f.reset())}dispose(){var K;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const K=this.effect;O?K.dispose():f.c.SetImmediate((()=>{K.getEngine().onEndFrameObservable.addOnce((()=>{K.dispose()}))})),this.effect=null}null===(K=this.drawContext)||void 0===K||K.dispose()}}},11933:(K,O,F)=>{F.d(O,{e:()=>r});var f=F(11773);class r{static GetPlanes(K){const O=[];for(let F=0;F<6;F++)O.push(new f.b(0,0,0,0));return r.GetPlanesToRef(K,O),O}static GetNearPlaneToRef(K,O){const F=K.m;O.normal.x=F[3]+F[2],O.normal.y=F[7]+F[6],O.normal.z=F[11]+F[10],O.d=F[15]+F[14],O.normalize()}static GetFarPlaneToRef(K,O){const F=K.m;O.normal.x=F[3]-F[2],O.normal.y=F[7]-F[6],O.normal.z=F[11]-F[10],O.d=F[15]-F[14],O.normalize()}static GetLeftPlaneToRef(K,O){const F=K.m;O.normal.x=F[3]+F[0],O.normal.y=F[7]+F[4],O.normal.z=F[11]+F[8],O.d=F[15]+F[12],O.normalize()}static GetRightPlaneToRef(K,O){const F=K.m;O.normal.x=F[3]-F[0],O.normal.y=F[7]-F[4],O.normal.z=F[11]-F[8],O.d=F[15]-F[12],O.normalize()}static GetTopPlaneToRef(K,O){const F=K.m;O.normal.x=F[3]-F[1],O.normal.y=F[7]-F[5],O.normal.z=F[11]-F[9],O.d=F[15]-F[13],O.normalize()}static GetBottomPlaneToRef(K,O){const F=K.m;O.normal.x=F[3]+F[1],O.normal.y=F[7]+F[5],O.normal.z=F[11]+F[9],O.d=F[15]+F[13],O.normalize()}static GetPlanesToRef(K,O){r.GetNearPlaneToRef(K,O[0]),r.GetFarPlaneToRef(K,O[1]),r.GetLeftPlaneToRef(K,O[2]),r.GetRightPlaneToRef(K,O[3]),r.GetTopPlaneToRef(K,O[4]),r.GetBottomPlaneToRef(K,O[5])}static IsPointInFrustum(K,O){for(let F=0;F<6;F++)if(O[F].dotCoordinate(K)<0)return!1;return!0}}},11945:(K,O,F)=>{F.d(O,{d:()=>r});var f=F(11541);class r{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(K,O){r.Enabled&&(this._current+=K,O&&this._fetchResult())}beginMonitoring(){r.Enabled&&(this._startMonitoringTime=f.e.Now)}endMonitoring(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!r.Enabled)return;K&&this.fetchNewFrame();const O=f.e.Now;this._current=O-this._startMonitoringTime,K&&this._fetchResult()}Hf(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const K=f.e.Now;K-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=K,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}r.Enabled=!0},11816:(K,O,F)=>{F.d(O,{b:()=>r,e:()=>f});class f{constructor(K){this.length=0,this.data=new Array(K),this._id=f._GlobalId++}push(K){this.data[this.length++]=K,this.length>this.data.length&&(this.data.length*=2)}forEach(K){for(let O=0;O<this.length;O++)K(this.data[O])}sort(K){this.data.sort(K)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(K){if(0!==K.length){this.length+K.length>this.data.length&&(this.data.length=2*(this.length+K.length));for(let O=0;O<K.length;O++)this.data[this.length++]=(K.data||K)[O]}}indexOf(K){const O=this.data.indexOf(K);return O>=this.length?-1:O}contains(K){return-1!==this.indexOf(K)}}f._GlobalId=0;class r extends f{constructor(){super(...arguments),this._duplicateId=0}push(K){super.push(K),K.__smartArrayFlags||(K.__smartArrayFlags={}),K.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(K){return(!K.__smartArrayFlags||K.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(K),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(K){if(0!==K.length){this.length+K.length>this.data.length&&(this.data.length=2*(this.length+K.length));for(let O=0;O<K.length;O++){const F=(K.data||K)[O];this.pushNoDuplicate(F)}}}}},11785:(K,O,F)=>{F.d(O,{c:()=>l});var f=F(11793),r=F(11523);class l{constructor(K){this._vertexBuffers={},this.onBeforeRenderObservable=new r.c,this._scene=K}_prepareBuffers(){if(this._vertexBuffers[f.d.PositionKind])return;const K=[];K.push(1,1),K.push(-1,1),K.push(-1,-1),K.push(1,-1),this._vertexBuffers[f.d.PositionKind]=new f.d(this._scene.getEngine(),K,f.d.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const K=[];K.push(0),K.push(1),K.push(2),K.push(0),K.push(2),K.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(K)}_rebuild(){const K=this._vertexBuffers[f.d.PositionKind];K&&(K._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=this._scene.activeCamera;return!!F&&(O=O||F._postProcesses.filter((K=>null!=K)),!(!O||0===O.length||!this._scene.postProcessesEnabled)&&(O[0].activate(F,K,null!==O&&void 0!==O),!0))}directRender(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:K.length;const J=this._scene.getEngine();for(let E=0;E<q;E++){var c;if(E<K.length-1)K[E+1].activate(this._scene.activeCamera||this._scene,null===O||void 0===O?void 0:O.texture);else O?J.bindFramebuffer(O,f,void 0,void 0,F,r):l||J.restoreDefaultFramebuffer(),null===(c=J._debugInsertMarker)||void 0===c||c.call(J,`post process ${K[E].name} output`);const q=K[E],M=q.apply();M&&(q.onBeforeRenderObservable.notifyObservers(M),this._prepareBuffers(),J.bindBuffers(this._vertexBuffers,this._indexBuffer,M),J.drawElementsType(0,0,6),q.onAfterRenderObservable.notifyObservers(M))}J.setDepthBuffer(!0),J.setDepthWrite(!0)}_finalizeFrame(K,O,F,f){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const l=this._scene.activeCamera;if(!l)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(f=f||l._postProcesses.filter((K=>null!=K))).length||!this._scene.postProcessesEnabled)return;const q=this._scene.getEngine();for(let c=0,E=f.length;c<E;c++){const M=f[c];var J;if(c<E-1)M._outputTexture=f[c+1].activate(l,null===O||void 0===O?void 0:O.texture);else O?(q.bindFramebuffer(O,F,void 0,void 0,r),M._outputTexture=O):(q.restoreDefaultFramebuffer(),M._outputTexture=null),null===(J=q._debugInsertMarker)||void 0===J||J.call(q,`post process ${f[c].name} output`);if(K)break;const t=M.apply();t&&(M.onBeforeRenderObservable.notifyObservers(t),this._prepareBuffers(),q.bindBuffers(this._vertexBuffers,this._indexBuffer,t),q.drawElementsType(0,0,6),M.onAfterRenderObservable.notifyObservers(t))}q.setDepthBuffer(!0),q.setDepthWrite(!0),q.setAlphaMode(0)}dispose(){const K=this._vertexBuffers[f.d.PositionKind];K&&(K.dispose(),this._vertexBuffers[f.d.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11810:(K,O,F)=>{F.d(O,{e:()=>J});var f=F(11816),r=F(11713);class l{set opaqueSortCompareFn(K){this._opaqueSortCompareFn=K||l.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(K){this._alphaTestSortCompareFn=K||l.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(K){this._transparentSortCompareFn=K||l.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(K,O){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=K,this._opaqueSubMeshes=new f.e(256),this._transparentSubMeshes=new f.e(256),this._alphaTestSubMeshes=new f.e(256),this._depthOnlySubMeshes=new f.e(256),this._particleSystems=new f.e(256),this._spriteManagers=new f.e(256),this._empty=!0,this._edgesRenderers=new f.b(16),this._scene=O,this.opaqueSortCompareFn=F,this.alphaTestSortCompareFn=r,this.transparentSortCompareFn=l}render(K,O,F,f){if(K)return void K(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const r=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(r.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),r.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const l=r.getStencilBuffer();if(r.setStencilBuffer(!1),O&&this._renderSprites(),F&&this._renderParticles(f),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(r.setStencilBuffer(l),this._scene.useOrderIndependentTransparency){const K=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);K.length&&this._renderTransparent(K)}else this._renderTransparent(this._transparentSubMeshes);r.setAlphaMode(0)}if(r.setStencilBuffer(!1),this._edgesRenderers.length){for(let K=0;K<this._edgesRenderers.length;K++)this._edgesRenderers.data[K].render();r.setAlphaMode(0)}r.setStencilBuffer(l)}_renderOpaqueSorted(K){l._RenderSorted(K,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(K){l._RenderSorted(K,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(K){l._RenderSorted(K,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(K,O,F,f){let q,J=0;const c=F?F.globalPosition:l._ZeroVector;if(f)for(;J<K.length;J++)q=K.data[J],q._alphaIndex=q.getMesh().alphaIndex,q._distanceToCamera=r.TO.Distance(q.getBoundingInfo().boundingSphere.centerWorld,c);const E=K.length===K.data.length?K.data:K.data.slice(0,K.length);O&&E.sort(O);const M=E[0].getMesh().HK();for(J=0;J<E.length;J++)if(q=E[J],!M._activeMeshesFrozenButKeepClipping||q.isInFrustum(M._frustumPlanes)){if(f){const K=q.VK();if(K&&K.needDepthPrePass){const O=K.HK().getEngine();O.setColorWrite(!1),O.setAlphaMode(0),q.render(!1),O.setColorWrite(!0)}}q.render(f)}}static defaultTransparentSortCompare(K,O){return K._alphaIndex>O._alphaIndex?1:K._alphaIndex<O._alphaIndex?-1:l.backToFrontSortCompare(K,O)}static backToFrontSortCompare(K,O){return K._distanceToCamera<O._distanceToCamera?1:K._distanceToCamera>O._distanceToCamera?-1:0}static frontToBackSortCompare(K,O){return K._distanceToCamera<O._distanceToCamera?-1:K._distanceToCamera>O._distanceToCamera?1:0}static PainterSortCompare(K,O){const F=K.getMesh(),f=O.getMesh();return F.material&&f.material?F.material.uniqueId-f.material.uniqueId:F.uniqueId-f.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(K,O,F){void 0===O&&(O=K.getMesh()),void 0===F&&(F=K.VK()),null!==F&&void 0!==F&&(F.needAlphaBlendingForMesh(O)?this._transparentSubMeshes.push(K):F.needAlphaTestingForMesh(O)?(F.needDepthPrePass&&this._depthOnlySubMeshes.push(K),this._alphaTestSubMeshes.push(K)):(F.needDepthPrePass&&this._depthOnlySubMeshes.push(K),this._opaqueSubMeshes.push(K)),O._renderingGroup=this,O._edgesRenderer&&O.isEnabled()&&O.isVisible&&O._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(O._edgesRenderer),this._empty=!1)}dispatchSprites(K){this._spriteManagers.push(K),this._empty=!1}dispatchParticles(K){this._particleSystems.push(K),this._empty=!1}_renderParticles(K){if(0===this._particleSystems.length)return;const O=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let F=0;F<this._particleSystems.length;F++){const f=this._particleSystems.data[F];if(0===(O&&O.layerMask&f.layerMask))continue;const r=f.rO;r.position&&K&&-1===K.indexOf(r)||this._scene._activeParticles.addCount(f.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const K=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let O=0;O<this._spriteManagers.length;O++){const F=this._spriteManagers.data[O];0!==(K&&K.layerMask&F.layerMask)&&F.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}l._ZeroVector=r.TO.Zero();class q{}class J{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(K){K!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=K,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const K of this._scene.meshes)if(K.Df)for(const O of K.Df)O._wasDispatched=!1;if(this._scene.spriteManagers)for(const K of this._scene.spriteManagers)K._wasDispatched=!1;for(const K of this._scene.pj)K._wasDispatched=!1}constructor(K){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new q,this._maintainStateBetweenFrames=!1,this._scene=K;for(let O=J.MIN_RENDERINGGROUPS;O<J.MAX_RENDERINGGROUPS;O++)this._autoClearDepthStencil[O]={Cf:!0,depth:!0,stencil:!0}}getRenderingGroup(K){const O=K||0;return this._prepareRenderingGroup(O),this._renderingGroups[O]}_clearDepthStencilBuffer(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,K,O),this._depthStencilBufferAlreadyCleaned=!0)}render(K,O,F,f){const r=this._renderingGroupInfo;if(r.kO=this._scene,r.camera=this._scene.activeCamera,r.renderingManager=this,this._scene.spriteManagers&&f)for(let l=0;l<this._scene.spriteManagers.length;l++){const K=this._scene.spriteManagers[l];this.dispatchSprites(K)}for(let l=J.MIN_RENDERINGGROUPS;l<J.MAX_RENDERINGGROUPS;l++){this._depthStencilBufferAlreadyCleaned=l===J.MIN_RENDERINGGROUPS;const q=this._renderingGroups[l];if(!q||q._empty)continue;const c=1<<l;if(r.renderingGroupId=l,this._scene.onBeforeRenderingGroupObservable.notifyObservers(r,c),J.AUTOCLEAR){const K=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(l):this._autoClearDepthStencil[l];K&&K.Cf&&this._clearDepthStencilBuffer(K.depth,K.stencil)}for(const K of this._scene._beforeRenderingGroupDrawStage)K.action(l);q.render(K,f,F,O);for(const K of this._scene._afterRenderingGroupDrawStage)K.action(l);this._scene.onAfterRenderingGroupObservable.notifyObservers(r,c)}}reset(){if(!this.maintainStateBetweenFrames)for(let K=J.MIN_RENDERINGGROUPS;K<J.MAX_RENDERINGGROUPS;K++){const O=this._renderingGroups[K];O&&O.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let K=J.MIN_RENDERINGGROUPS;K<J.MAX_RENDERINGGROUPS;K++){const O=this._renderingGroups[K];O&&O.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let K=J.MIN_RENDERINGGROUPS;K<J.MAX_RENDERINGGROUPS;K++){const O=this._renderingGroups[K];O&&O.dispose()}}_prepareRenderingGroup(K){void 0===this._renderingGroups[K]&&(this._renderingGroups[K]=new l(K,this._scene,this._customOpaqueSortCompareFn[K],this._customAlphaTestSortCompareFn[K],this._customTransparentSortCompareFn[K]))}dispatchSprites(K){this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(K.renderingGroupId).dispatchSprites(K))}dispatchParticles(K){this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(K.renderingGroupId).dispatchParticles(K))}dispatch(K,O,F){void 0===O&&(O=K.getMesh()),this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(O.renderingGroupId).dispatch(K,O,F))}setRenderingOrder(K){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[K]=O,this._customAlphaTestSortCompareFn[K]=F,this._customTransparentSortCompareFn[K]=f,this._renderingGroups[K]){const O=this._renderingGroups[K];O.opaqueSortCompareFn=this._customOpaqueSortCompareFn[K],O.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[K],O.transparentSortCompareFn=this._customTransparentSortCompareFn[K]}}setRenderingAutoClearDepthStencil(K,O){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[K]={Cf:O,depth:F,stencil:f}}getAutoClearDepthStencilSetup(K){return this._autoClearDepthStencil[K]}}J.MAX_RENDERINGGROUPS=4,J.MIN_RENDERINGGROUPS=0,J.AUTOCLEAR=!0}}]);