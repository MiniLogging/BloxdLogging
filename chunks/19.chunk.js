"use strict";(self.kdlk57exiqh=self.kdlk57exiqh||[]).push([[19],{12314:(i,x,e)=>{e.d(x,{d:()=>Y,f:()=>J});var j=e(12318),E=e(12072),a=e(12320);class Y{get M(){return this._isDisposed}constructor(i,x,e){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7?arguments[7]:void 0,b=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,i&&i.wi?this._engine=i.wi().getEngine():this._engine=i,this._updatable=e,this._instanced=Y,this._divisor=u||1,this._label=b,x instanceof j.b?(this._data=null,this._buffer=x):(this._data=x,this._buffer=null),this.byteStride=J?E:E*Float32Array.BYTES_PER_ELEMENT,a||this.create()}createVertexBuffer(i,x,e,j,E){let a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6?arguments[6]:void 0;const u=a?x:x*Float32Array.BYTES_PER_ELEMENT,b=j?a?j:j*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new J(this._engine,this,i,this._updatable,!0,b,void 0===E?this._instanced:E,u,e,void 0,void 0,!0,this._divisor||Y)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!i&&this._buffer||(i=i||this._data,i&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,i),this._data=i):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(i,this._label),this._data=i):this._buffer=this._engine.createVertexBuffer(i,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Ue>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Ue,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Ue,void 0,this._label));E.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(i){this.create(i)}updateDirectly(i,x,e){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,i,j?x:x*Float32Array.BYTES_PER_ELEMENT,e?e*this.byteStride:void 0),this._data=0===x&&void 0===e?i:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class J{get M(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(i){const x=0!=i;this._instanceDivisor=i,x!==this._instanced&&(this._instanced=x,this._computeHashCode())}get _maxVerticesCount(){const i=this.getData();return i?Array.isArray(i)?i.length/(this.byteStride/4)-this.byteOffset/4:(i.byteLength-this.byteOffset)/this.byteStride:0}constructor(i,x,e,j,E,u,b,g,A,K){let L=arguments.length>10&&void 0!==arguments[10]&&arguments[10],o=arguments.length>11&&void 0!==arguments[11]&&arguments[11],M=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,z=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let T=!1;if(this.tx=i,"object"===typeof j&&null!==j?(T=j.updatable??!1,E=j.postponeInternalCreation,u=j.stride,b=j.instanced,g=j.offset,A=j.size,K=j.type,L=j.normalized??!1,o=j.useBytes??!1,M=j.divisor??1,z=j.takeBufferOwnership??!1,this._label=j.label):T=!!j,x instanceof Y?(this._buffer=x,this._ownsBuffer=z):(this._buffer=new Y(i,x,T,u,E,b,o,M,this._label),this._ownsBuffer=!0),this.uniqueId=J._Counter++,this._kind=e,void 0===K){const i=this.getData();this.type=i?J.GetDataType(i):J.FLOAT}else this.type=K;const Q=(0,a.m)(this.type);o?(this._size=A||(u?u/Q:J.DeduceStride(e)),this.byteStride=u||this._buffer.byteStride||this._size*Q,this.byteOffset=g||0):(this._size=A||u||J.DeduceStride(e),this.byteStride=u?u*Q:this._buffer.byteStride||this._size*Q,this.byteOffset=(g||0)*Q),this.normalized=L,this._instanced=void 0!==b&&b,this._instanceDivisor=b?M:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var i;null===(i=this._buffer)||void 0===i||i._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(i,x){const e=this.getData();return e?(0,a.k)(e,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,i,x):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,a.m)(this.type)}getOffset(){return this.byteOffset/(0,a.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,a.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(i){this._buffer.create(i),this._alignBuffer()}update(i){this._buffer.update(i),this._alignBuffer()}updateDirectly(i,x){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(i,x,void 0,e),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(i,x){(0,a.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,i,this.normalized,((i,e)=>{for(let j=0;j<this._size;j++)x(i[j],e+j)}))}_alignBuffer(){}static DeduceStride(i){switch(i){case J.UVKind:case J.UV2Kind:case J.UV3Kind:case J.UV4Kind:case J.UV5Kind:case J.UV6Kind:return 2;case J.NormalKind:case J.PositionKind:return 3;case J.ColorKind:case J.ColorInstanceKind:case J.MatricesIndicesKind:case J.MatricesIndicesExtraKind:case J.MatricesWeightsKind:case J.MatricesWeightsExtraKind:case J.TangentKind:return 4;default:throw new Error("Invalid kind '"+i+"'")}}static GetDataType(i){return i instanceof Int8Array?J.BYTE:i instanceof Uint8Array?J.UNSIGNED_BYTE:i instanceof Int16Array?J.SHORT:i instanceof Uint16Array?J.UNSIGNED_SHORT:i instanceof Int32Array?J.INT:i instanceof Uint32Array?J.UNSIGNED_INT:J.FLOAT}static GetTypeByteLength(i){return(0,a.m)(i)}static ForEach(i,x,e,j,E,Y,J,u){(0,a.j)(i,x,e,j,E,Y,J,((i,x)=>{for(let e=0;e<j;e++)u(i[e],x+e)}))}static GetFloatData(i,x,e,j,E,Y,J,u){return(0,a.k)(i,x,e,j,E,Y,J,u)}}J._Counter=0,J.BYTE=5120,J.UNSIGNED_BYTE=5121,J.SHORT=5122,J.UNSIGNED_SHORT=5123,J.INT=5124,J.UNSIGNED_INT=5125,J.FLOAT=5126,J.PositionKind="position",J.NormalKind="normal",J.TangentKind="tangent",J.UVKind="uv",J.UV2Kind="uv2",J.UV3Kind="uv3",J.UV4Kind="uv4",J.UV5Kind="uv5",J.UV6Kind="uv6",J.ColorKind="color",J.ColorInstanceKind="instanceColor",J.MatricesIndicesKind="matricesIndices",J.MatricesWeightsKind="matricesWeights",J.MatricesIndicesExtraKind="matricesIndicesExtra",J.MatricesWeightsExtraKind="matricesWeightsExtra"},12320:(i,x,e)=>{e.d(x,{e:()=>K,h:()=>A,j:()=>u,k:()=>b,m:()=>Y,q:()=>J,u:()=>g});var j=e(12072);function E(i,x,e,j){switch(x){case 5120:{let x=i.getInt8(e);return j&&(x=Math.max(x/127,-1)),x}case 5121:{let x=i.getUint8(e);return j&&(x/=255),x}case 5122:{let x=i.getInt16(e,!0);return j&&(x=Math.max(x/32767,-1)),x}case 5123:{let x=i.getUint16(e,!0);return j&&(x/=65535),x}case 5124:return i.getInt32(e,!0);case 5125:return i.getUint32(e,!0);case 5126:return i.getFloat32(e,!0);default:throw new Error(`Invalid component type ${x}`)}}function a(i,x,e,j,E){switch(x){case 5120:j&&(E=Math.round(127*E)),i.setInt8(e,E);break;case 5121:j&&(E=Math.round(255*E)),i.setUint8(e,E);break;case 5122:j&&(E=Math.round(32767*E)),i.setInt16(e,E,!0);break;case 5123:j&&(E=Math.round(65535*E)),i.setUint16(e,E,!0);break;case 5124:i.setInt32(e,E,!0);break;case 5125:i.setUint32(e,E,!0);break;case 5126:i.setFloat32(e,E,!0);break;default:throw new Error(`Invalid component type ${x}`)}}function Y(i){switch(i){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${i}'`)}}function J(i){switch(i){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${i}'`)}}function u(i,x,e,j,J,u,b,g){const A=new Array(j),K=new Array(j);if(i instanceof Array){let E=x/4;const a=e/4;for(let x=0;x<u;x+=j){for(let x=0;x<j;x++)A[x]=K[x]=i[E+x];g(K,x);for(let x=0;x<j;x++)A[x]!==K[x]&&(i[E+x]=K[x]);E+=a}}else{const L=ArrayBuffer.isView(i)?new DataView(i.buffer,i.byteOffset,i.byteLength):new DataView(i),o=Y(J);for(let i=0;i<u;i+=j){for(let i=0,e=x;i<j;i++,e+=o)A[i]=K[i]=E(L,J,e,b);g(K,i);for(let i=0,e=x;i<j;i++,e+=o)A[i]!==K[i]&&a(L,J,e,b,K[i]);x+=e}}}function b(i,x,e,E,a,J,b,g){const A=x*Y(e),K=b*x;if(5126!==e||a!==A){const j=new Float32Array(K);return u(i,E,a,x,e,K,J,((i,e)=>{for(let E=0;E<x;E++)j[e+E]=i[E]})),j}if(!(i instanceof Array||i instanceof Float32Array)||0!==E||i.length!==K){if(i instanceof Array){const x=E/4;return i.slice(x,x+K)}if(i instanceof ArrayBuffer)return new Float32Array(i,E,K);{const x=i.byteOffset+E;return 0!==(3&x)&&(j.c.Warn("Float array must be aligned to 4-bytes border"),g=!0),g?new Float32Array(i.buffer.slice(x,x+K*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(i.buffer,x,K)}}return g?i.slice():i}function g(i,x,e,E,a,b,g,A){const K=Y(e),L=J(e),o=g*x;if(Array.isArray(i)){if(0!==(3&E)||0!==(3&a))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const j=E/4,Y=a/4;if(j+(g-1)*Y+x>i.length)throw new Error("Last accessed index is out of bounds.");if(Y<x)throw new Error("Data stride cannot be smaller than the component size.");if(Y!==x){const j=new L(o);return u(i,E,a,x,e,o,b,((i,e)=>{for(let E=0;E<x;E++)j[e+E]=i[E]})),j}return new L(i.slice(j,j+o))}let M,z=E;i instanceof ArrayBuffer?M=i:(M=i.buffer,z+=i.byteOffset);if(z+(g-1)*a+x*K>M.byteLength)throw new Error("Last accessed byte is out of bounds.");const T=x*K;if(a<T)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(a!==T){const i=new L(o);return u(M,z,a,x,e,o,b,((e,j)=>{for(let E=0;E<x;E++)i[j+E]=e[E]})),i}return 1!==K&&0!==(z&K-1)&&(j.c.Warn("Array must be aligned to border of element size. Data will be copied."),A=!0),A?new L(M.slice(z,z+o*K)):new L(M,z,o)}function A(i,x,e,E,a,J,b,g){const A=x*Y(e),K=b*x;if(g.length!==K)throw new Error("Output length is not valid");if(5126===e&&a===A)if(i instanceof Array){const x=E/4;g.set(i,x)}else if(i instanceof ArrayBuffer){const x=new Float32Array(i,E,K);g.set(x)}else{const x=i.byteOffset+E;if(0!==(3&x))return j.c.Warn("Float array must be aligned to 4-bytes border"),void g.set(new Float32Array(i.buffer.slice(x,x+K*Float32Array.BYTES_PER_ELEMENT)));const e=new Float32Array(i.buffer,x,K);g.set(e)}else u(i,E,a,x,e,K,J,((i,e)=>{for(let j=0;j<x;j++)g[e+j]=i[j]}))}function K(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(i)){for(let E=0;E<x;E++)if(i[e+E]-j>65535)return!0;return!1}return 4===i.BYTES_PER_ELEMENT}},12318:(i,x,e)=>{e.d(x,{b:()=>j});class j{get underlyingResource(){return null}constructor(){this.references=0,this.Ue=0,this.is32Bits=!1,this.uniqueId=j._Counter++}}j._Counter=0},12353:(i,x,e)=>{e.d(x,{e:()=>E});var j=e(12142);class E{static GetEffect(i){return void 0===i.getPipelineContext?i.effect:i}constructor(i){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=i.createDrawContext(),x&&(this.materialContext=i.createMaterialContext())}setEffect(i,x){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var j;(this.effect=i,void 0!==x&&(this.defines=x),e)&&(null===(j=this.drawContext)||void 0===j||j.reset())}dispose(){var i;let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const i=this.effect;x?i.dispose():j.b.SetImmediate((()=>{i.getEngine().onEndFrameObservable.addOnce((()=>{i.dispose()}))})),this.effect=null}null===(i=this.drawContext)||void 0===i||i.dispose()}}},12425:(i,x,e)=>{e.d(x,{d:()=>E});var j=e(12295);class E{static GetPlanes(i){const x=[];for(let e=0;e<6;e++)x.push(new j.e(0,0,0,0));return E.GetPlanesToRef(i,x),x}static GetNearPlaneToRef(i,x){const e=i.m;x.normal.x=e[3]+e[2],x.normal.y=e[7]+e[6],x.normal.z=e[11]+e[10],x.d=e[15]+e[14],x.normalize()}static GetFarPlaneToRef(i,x){const e=i.m;x.normal.x=e[3]-e[2],x.normal.y=e[7]-e[6],x.normal.z=e[11]-e[10],x.d=e[15]-e[14],x.normalize()}static GetLeftPlaneToRef(i,x){const e=i.m;x.normal.x=e[3]+e[0],x.normal.y=e[7]+e[4],x.normal.z=e[11]+e[8],x.d=e[15]+e[12],x.normalize()}static GetRightPlaneToRef(i,x){const e=i.m;x.normal.x=e[3]-e[0],x.normal.y=e[7]-e[4],x.normal.z=e[11]-e[8],x.d=e[15]-e[12],x.normalize()}static GetTopPlaneToRef(i,x){const e=i.m;x.normal.x=e[3]-e[1],x.normal.y=e[7]-e[5],x.normal.z=e[11]-e[9],x.d=e[15]-e[13],x.normalize()}static GetBottomPlaneToRef(i,x){const e=i.m;x.normal.x=e[3]+e[1],x.normal.y=e[7]+e[5],x.normal.z=e[11]+e[9],x.d=e[15]+e[13],x.normalize()}static GetPlanesToRef(i,x){E.GetNearPlaneToRef(i,x[0]),E.GetFarPlaneToRef(i,x[1]),E.GetLeftPlaneToRef(i,x[2]),E.GetRightPlaneToRef(i,x[3]),E.GetTopPlaneToRef(i,x[4]),E.GetBottomPlaneToRef(i,x[5])}static IsPointInFrustum(i,x){for(let e=0;e<6;e++)if(x[e].dotCoordinate(i)<0)return!1;return!0}}},12434:(i,x,e)=>{e.d(x,{c:()=>E});var j=e(12089);class E{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(i,x){E.Enabled&&(this._current+=i,x&&this._fetchResult())}beginMonitoring(){E.Enabled&&(this._startMonitoringTime=j.e.Now)}endMonitoring(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!E.Enabled)return;i&&this.fetchNewFrame();const x=j.e.Now;this._current=x-this._startMonitoringTime,i&&this._fetchResult()}ze(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const i=j.e.Now;i-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=i,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}E.Enabled=!0},12334:(i,x,e)=>{e.d(x,{b:()=>E,e:()=>j});class j{constructor(i){this.length=0,this.data=new Array(i),this._id=j._GlobalId++}push(i){this.data[this.length++]=i,this.length>this.data.length&&(this.data.length*=2)}forEach(i){for(let x=0;x<this.length;x++)i(this.data[x])}sort(i){this.data.sort(i)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(i){if(0!==i.length){this.length+i.length>this.data.length&&(this.data.length=2*(this.length+i.length));for(let x=0;x<i.length;x++)this.data[this.length++]=(i.data||i)[x]}}indexOf(i){const x=this.data.indexOf(i);return x>=this.length?-1:x}contains(i){return-1!==this.indexOf(i)}}j._GlobalId=0;class E extends j{constructor(){super(...arguments),this._duplicateId=0}push(i){super.push(i),i.__smartArrayFlags||(i.__smartArrayFlags={}),i.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(i){return(!i.__smartArrayFlags||i.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(i),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(i){if(0!==i.length){this.length+i.length>this.data.length&&(this.data.length=2*(this.length+i.length));for(let x=0;x<i.length;x++){const e=(i.data||i)[x];this.pushNoDuplicate(e)}}}}},12309:(i,x,e)=>{e.d(x,{b:()=>a});var j=e(12314),E=e(12065);class a{constructor(i){this._vertexBuffers={},this.onBeforeRenderObservable=new E.b,this._scene=i}_prepareBuffers(){if(this._vertexBuffers[j.f.PositionKind])return;const i=[];i.push(1,1),i.push(-1,1),i.push(-1,-1),i.push(1,-1),this._vertexBuffers[j.f.PositionKind]=new j.f(this._scene.getEngine(),i,j.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const i=[];i.push(0),i.push(1),i.push(2),i.push(0),i.push(2),i.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(i)}_rebuild(){const i=this._vertexBuffers[j.f.PositionKind];i&&(i._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this._scene.activeCamera;return!!e&&(x=x||e._postProcesses.filter((i=>null!=i)),!(!x||0===x.length||!this._scene.postProcessesEnabled)&&(x[0].activate(e,i,null!==x&&void 0!==x),!0))}directRender(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:i.length;const J=this._scene.getEngine();for(let b=0;b<Y;b++){var u;if(b<i.length-1)i[b+1].activate(this._scene.activeCamera||this._scene,null===x||void 0===x?void 0:x.texture);else x?J.bindFramebuffer(x,j,void 0,void 0,e,E):a||J.restoreDefaultFramebuffer(),null===(u=J._debugInsertMarker)||void 0===u||u.call(J,`post process ${i[b].name} output`);const Y=i[b],g=Y.apply();g&&(Y.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),J.bindBuffers(this._vertexBuffers,this._indexBuffer,g),J.drawElementsType(0,0,6),Y.onAfterRenderObservable.notifyObservers(g))}J.setDepthBuffer(!0),J.setDepthWrite(!0)}_finalizeFrame(i,x,e,j){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const a=this._scene.activeCamera;if(!a)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(j=j||a._postProcesses.filter((i=>null!=i))).length||!this._scene.postProcessesEnabled)return;const Y=this._scene.getEngine();for(let u=0,b=j.length;u<b;u++){const g=j[u];var J;if(u<b-1)g._outputTexture=j[u+1].activate(a,null===x||void 0===x?void 0:x.texture);else x?(Y.bindFramebuffer(x,e,void 0,void 0,E),g._outputTexture=x):(Y.restoreDefaultFramebuffer(),g._outputTexture=null),null===(J=Y._debugInsertMarker)||void 0===J||J.call(Y,`post process ${j[u].name} output`);if(i)break;const A=g.apply();A&&(g.onBeforeRenderObservable.notifyObservers(A),this._prepareBuffers(),Y.bindBuffers(this._vertexBuffers,this._indexBuffer,A),Y.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(A))}Y.setDepthBuffer(!0),Y.setDepthWrite(!0),Y.setAlphaMode(0)}dispose(){const i=this._vertexBuffers[j.f.PositionKind];i&&(i.dispose(),this._vertexBuffers[j.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12327:(i,x,e)=>{e.d(x,{b:()=>J});var j=e(12334),E=e(12250);class a{set opaqueSortCompareFn(i){this._opaqueSortCompareFn=i||a.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(i){this._alphaTestSortCompareFn=i||a.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(i){this._transparentSortCompareFn=i||a.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(i,x){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=i,this._opaqueSubMeshes=new j.e(256),this._transparentSubMeshes=new j.e(256),this._alphaTestSubMeshes=new j.e(256),this._depthOnlySubMeshes=new j.e(256),this._particleSystems=new j.e(256),this._spriteManagers=new j.e(256),this._empty=!0,this._edgesRenderers=new j.b(16),this._scene=x,this.opaqueSortCompareFn=e,this.alphaTestSortCompareFn=E,this.transparentSortCompareFn=a}render(i,x,e,j){if(i)return void i(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const E=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(E.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),E.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const a=E.getStencilBuffer();if(E.setStencilBuffer(!1),x&&this._renderSprites(),e&&this._renderParticles(j),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(E.setStencilBuffer(a),this._scene.useOrderIndependentTransparency){const i=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);i.length&&this._renderTransparent(i)}else this._renderTransparent(this._transparentSubMeshes);E.setAlphaMode(0)}if(E.setStencilBuffer(!1),this._edgesRenderers.length){for(let i=0;i<this._edgesRenderers.length;i++)this._edgesRenderers.data[i].render();E.setAlphaMode(0)}E.setStencilBuffer(a)}_renderOpaqueSorted(i){a._RenderSorted(i,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(i){a._RenderSorted(i,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(i){a._RenderSorted(i,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(i,x,e,j){let Y,J=0;const u=e?e.globalPosition:a._ZeroVector;if(j)for(;J<i.length;J++)Y=i.data[J],Y._alphaIndex=Y.getMesh().alphaIndex,Y._distanceToCamera=E.KJ.Distance(Y.getBoundingInfo().boundingSphere.centerWorld,u);const b=i.length===i.data.length?i.data:i.data.slice(0,i.length);x&&b.sort(x);const g=b[0].getMesh().wi();for(J=0;J<b.length;J++)if(Y=b[J],!g._activeMeshesFrozenButKeepClipping||Y.isInFrustum(g._frustumPlanes)){if(j){const i=Y.di();if(i&&i.needDepthPrePass){const x=i.wi().getEngine();x.setColorWrite(!1),x.setAlphaMode(0),Y.render(!1),x.setColorWrite(!0)}}Y.render(j)}}static defaultTransparentSortCompare(i,x){return i._alphaIndex>x._alphaIndex?1:i._alphaIndex<x._alphaIndex?-1:a.backToFrontSortCompare(i,x)}static backToFrontSortCompare(i,x){return i._distanceToCamera<x._distanceToCamera?1:i._distanceToCamera>x._distanceToCamera?-1:0}static frontToBackSortCompare(i,x){return i._distanceToCamera<x._distanceToCamera?-1:i._distanceToCamera>x._distanceToCamera?1:0}static PainterSortCompare(i,x){const e=i.getMesh(),j=x.getMesh();return e.material&&j.material?e.material.uniqueId-j.material.uniqueId:e.uniqueId-j.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(i,x,e){void 0===x&&(x=i.getMesh()),void 0===e&&(e=i.di()),null!==e&&void 0!==e&&(e.needAlphaBlendingForMesh(x)?this._transparentSubMeshes.push(i):e.needAlphaTestingForMesh(x)?(e.needDepthPrePass&&this._depthOnlySubMeshes.push(i),this._alphaTestSubMeshes.push(i)):(e.needDepthPrePass&&this._depthOnlySubMeshes.push(i),this._opaqueSubMeshes.push(i)),x._renderingGroup=this,x._edgesRenderer&&x.isEnabled()&&x.isVisible&&x._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(x._edgesRenderer),this._empty=!1)}dispatchSprites(i){this._spriteManagers.push(i),this._empty=!1}dispatchParticles(i){this._particleSystems.push(i),this._empty=!1}_renderParticles(i){if(0===this._particleSystems.length)return;const x=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let e=0;e<this._particleSystems.length;e++){const j=this._particleSystems.data[e];if(0===(x&&x.layerMask&j.layerMask))continue;const E=j.Yx;E.position&&i&&-1===i.indexOf(E)||this._scene._activeParticles.addCount(j.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const i=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let x=0;x<this._spriteManagers.length;x++){const e=this._spriteManagers.data[x];0!==(i&&i.layerMask&e.layerMask)&&e.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}a._ZeroVector=E.KJ.Zero();class Y{}class J{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(i){i!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=i,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const i of this._scene.meshes)if(i.ne)for(const x of i.ne)x._wasDispatched=!1;if(this._scene.spriteManagers)for(const i of this._scene.spriteManagers)i._wasDispatched=!1;for(const i of this._scene.iL)i._wasDispatched=!1}constructor(i){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Y,this._maintainStateBetweenFrames=!1,this._scene=i;for(let x=J.MIN_RENDERINGGROUPS;x<J.MAX_RENDERINGGROUPS;x++)this._autoClearDepthStencil[x]={Xe:!0,depth:!0,Ve:!0}}getRenderingGroup(i){const x=i||0;return this._prepareRenderingGroup(x),this._renderingGroups[x]}_clearDepthStencilBuffer(){let i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,i,x),this._depthStencilBufferAlreadyCleaned=!0)}render(i,x,e,j){const E=this._renderingGroupInfo;if(E.LJ=this._scene,E.camera=this._scene.activeCamera,E.renderingManager=this,this._scene.spriteManagers&&j)for(let a=0;a<this._scene.spriteManagers.length;a++){const i=this._scene.spriteManagers[a];this.dispatchSprites(i)}for(let a=J.MIN_RENDERINGGROUPS;a<J.MAX_RENDERINGGROUPS;a++){this._depthStencilBufferAlreadyCleaned=a===J.MIN_RENDERINGGROUPS;const Y=this._renderingGroups[a];if(!Y||Y._empty)continue;const u=1<<a;if(E.renderingGroupId=a,this._scene.onBeforeRenderingGroupObservable.notifyObservers(E,u),J.AUTOCLEAR){const i=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(a):this._autoClearDepthStencil[a];i&&i.Xe&&this._clearDepthStencilBuffer(i.depth,i.Ve)}for(const i of this._scene._beforeRenderingGroupDrawStage)i.action(a);Y.render(i,j,e,x);for(const i of this._scene._afterRenderingGroupDrawStage)i.action(a);this._scene.onAfterRenderingGroupObservable.notifyObservers(E,u)}}reset(){if(!this.maintainStateBetweenFrames)for(let i=J.MIN_RENDERINGGROUPS;i<J.MAX_RENDERINGGROUPS;i++){const x=this._renderingGroups[i];x&&x.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let i=J.MIN_RENDERINGGROUPS;i<J.MAX_RENDERINGGROUPS;i++){const x=this._renderingGroups[i];x&&x.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let i=J.MIN_RENDERINGGROUPS;i<J.MAX_RENDERINGGROUPS;i++){const x=this._renderingGroups[i];x&&x.dispose()}}_prepareRenderingGroup(i){void 0===this._renderingGroups[i]&&(this._renderingGroups[i]=new a(i,this._scene,this._customOpaqueSortCompareFn[i],this._customAlphaTestSortCompareFn[i],this._customTransparentSortCompareFn[i]))}dispatchSprites(i){this.maintainStateBetweenFrames&&i._wasDispatched||(i._wasDispatched=!0,this.getRenderingGroup(i.renderingGroupId).dispatchSprites(i))}dispatchParticles(i){this.maintainStateBetweenFrames&&i._wasDispatched||(i._wasDispatched=!0,this.getRenderingGroup(i.renderingGroupId).dispatchParticles(i))}dispatch(i,x,e){void 0===x&&(x=i.getMesh()),this.maintainStateBetweenFrames&&i._wasDispatched||(i._wasDispatched=!0,this.getRenderingGroup(x.renderingGroupId).dispatch(i,x,e))}setRenderingOrder(i){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[i]=x,this._customAlphaTestSortCompareFn[i]=e,this._customTransparentSortCompareFn[i]=j,this._renderingGroups[i]){const x=this._renderingGroups[i];x.opaqueSortCompareFn=this._customOpaqueSortCompareFn[i],x.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[i],x.transparentSortCompareFn=this._customTransparentSortCompareFn[i]}}setRenderingAutoClearDepthStencil(i,x){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[i]={Xe:x,depth:e,Ve:j}}getAutoClearDepthStencilSetup(i){return this._autoClearDepthStencil[i]}}J.MAX_RENDERINGGROUPS=4,J.MIN_RENDERINGGROUPS=0,J.AUTOCLEAR=!0}}]);