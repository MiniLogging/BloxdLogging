"use strict";(self.ra6kpa9z1sg=self.ra6kpa9z1sg||[]).push([[19],{12847:(p,b,M)=>{M.d(b,{d:()=>y,f:()=>P});var h=M(12852),Q=M(12622),mp=M(12860);class y{get S(){return this._isDisposed}constructor(p,b,M){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,mp=arguments.length>4&&void 0!==arguments[4]&&arguments[4],y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,p&&p.upp?this._engine=p.upp().getEngine():this._engine=p,this._updatable=M,this._instanced=y,this._divisor=w||1,this._label=t,b instanceof h.c?(this._data=null,this._buffer=b):(this._data=b,this._buffer=null),this.byteStride=P?Q:Q*Float32Array.BYTES_PER_ELEMENT,mp||this.create()}createVertexBuffer(p,b,M,h,Q){let mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6?arguments[6]:void 0;const w=mp?b:b*Float32Array.BYTES_PER_ELEMENT,t=h?mp?h:h*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new P(this._engine,this,p,this._updatable,!0,t,void 0===Q?this._instanced:Q,w,M,void 0,void 0,!0,this._divisor||y)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!p&&this._buffer||(p=p||this._data,p&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,p),this._data=p):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(p,this._label),this._data=p):this._buffer=this._engine.createVertexBuffer(p,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.XM>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.XM,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.XM,void 0,this._label));Q.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(p){this.create(p)}updateDirectly(p,b,M){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,p,h?b:b*Float32Array.BYTES_PER_ELEMENT,M?M*this.byteStride:void 0),this._data=0===b&&void 0===M?p:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class P{get S(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(p){const b=0!=p;this._instanceDivisor=p,b!==this._instanced&&(this._instanced=b,this._computeHashCode())}get _maxVerticesCount(){const p=this.getData();return p?Array.isArray(p)?p.length/(this.byteStride/4)-this.byteOffset/4:(p.byteLength-this.byteOffset)/this.byteStride:0}constructor(p,b,M,h,Q,w,t,z,x,S){let X=arguments.length>10&&void 0!==arguments[10]&&arguments[10],c=arguments.length>11&&void 0!==arguments[11]&&arguments[11],J=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,g=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let f=!1;if(this.hM=p,"object"===typeof h&&null!==h?(f=h.updatable??!1,Q=h.postponeInternalCreation,w=h.stride,t=h.instanced,z=h.offset,x=h.size,S=h.type,X=h.normalized??!1,c=h.useBytes??!1,J=h.divisor??1,g=h.takeBufferOwnership??!1,this._label=h.label):f=!!h,b instanceof y?(this._buffer=b,this._ownsBuffer=g):(this._buffer=new y(p,b,f,w,Q,t,c,J,this._label),this._ownsBuffer=!0),this.uniqueId=P._Counter++,this._kind=M,void 0===S){const p=this.getData();this.type=p?P.GetDataType(p):P.FLOAT}else this.type=S;const Y=(0,mp.l)(this.type);c?(this._size=x||(w?w/Y:P.DeduceStride(M)),this.byteStride=w||this._buffer.byteStride||this._size*Y,this.byteOffset=z||0):(this._size=x||w||P.DeduceStride(M),this.byteStride=w?w*Y:this._buffer.byteStride||this._size*Y,this.byteOffset=(z||0)*Y),this.normalized=X,this._instanced=void 0!==t&&t,this._instanceDivisor=t?J:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var p;null===(p=this._buffer)||void 0===p||p._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(p,b){const M=this.getData();return M?(0,mp.i)(M,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,p,b):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,mp.l)(this.type)}getOffset(){return this.byteOffset/(0,mp.l)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,mp.l)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(p){this._buffer.create(p),this._alignBuffer()}update(p){this._buffer.update(p),this._alignBuffer()}updateDirectly(p,b){let M=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(p,b,void 0,M),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(p,b){(0,mp.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,p,this.normalized,((p,M)=>{for(let h=0;h<this._size;h++)b(p[h],M+h)}))}_alignBuffer(){}static DeduceStride(p){switch(p){case P.UVKind:case P.UV2Kind:case P.UV3Kind:case P.UV4Kind:case P.UV5Kind:case P.UV6Kind:return 2;case P.NormalKind:case P.PositionKind:return 3;case P.ColorKind:case P.ColorInstanceKind:case P.MatricesIndicesKind:case P.MatricesIndicesExtraKind:case P.MatricesWeightsKind:case P.MatricesWeightsExtraKind:case P.TangentKind:return 4;default:throw new Error("Invalid kind '"+p+"'")}}static GetDataType(p){return p instanceof Int8Array?P.BYTE:p instanceof Uint8Array?P.UNSIGNED_BYTE:p instanceof Int16Array?P.SHORT:p instanceof Uint16Array?P.UNSIGNED_SHORT:p instanceof Int32Array?P.INT:p instanceof Uint32Array?P.UNSIGNED_INT:P.FLOAT}static GetTypeByteLength(p){return(0,mp.l)(p)}static ForEach(p,b,M,h,Q,y,P,w){(0,mp.h)(p,b,M,h,Q,y,P,((p,b)=>{for(let M=0;M<h;M++)w(p[M],b+M)}))}static GetFloatData(p,b,M,h,Q,y,P,w){return(0,mp.i)(p,b,M,h,Q,y,P,w)}}P._Counter=0,P.BYTE=5120,P.UNSIGNED_BYTE=5121,P.SHORT=5122,P.UNSIGNED_SHORT=5123,P.INT=5124,P.UNSIGNED_INT=5125,P.FLOAT=5126,P.PositionKind="position",P.NormalKind="normal",P.TangentKind="tangent",P.UVKind="uv",P.UV2Kind="uv2",P.UV3Kind="uv3",P.UV4Kind="uv4",P.UV5Kind="uv5",P.UV6Kind="uv6",P.ColorKind="color",P.ColorInstanceKind="instanceColor",P.MatricesIndicesKind="matricesIndices",P.MatricesWeightsKind="matricesWeights",P.MatricesIndicesExtraKind="matricesIndicesExtra",P.MatricesWeightsExtraKind="matricesWeightsExtra"},12860:(p,b,M)=>{M.d(b,{b:()=>S,d:()=>x,h:()=>w,i:()=>t,l:()=>y,n:()=>P,o:()=>z});var h=M(12622);function Q(p,b,M,h){switch(b){case 5120:{let b=p.getInt8(M);return h&&(b=Math.max(b/127,-1)),b}case 5121:{let b=p.getUint8(M);return h&&(b/=255),b}case 5122:{let b=p.getInt16(M,!0);return h&&(b=Math.max(b/32767,-1)),b}case 5123:{let b=p.getUint16(M,!0);return h&&(b/=65535),b}case 5124:return p.getInt32(M,!0);case 5125:return p.getUint32(M,!0);case 5126:return p.getFloat32(M,!0);default:throw new Error(`Invalid component type ${b}`)}}function mp(p,b,M,h,Q){switch(b){case 5120:h&&(Q=Math.round(127*Q)),p.setInt8(M,Q);break;case 5121:h&&(Q=Math.round(255*Q)),p.setUint8(M,Q);break;case 5122:h&&(Q=Math.round(32767*Q)),p.setInt16(M,Q,!0);break;case 5123:h&&(Q=Math.round(65535*Q)),p.setUint16(M,Q,!0);break;case 5124:p.setInt32(M,Q,!0);break;case 5125:p.setUint32(M,Q,!0);break;case 5126:p.setFloat32(M,Q,!0);break;default:throw new Error(`Invalid component type ${b}`)}}function y(p){switch(p){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${p}'`)}}function P(p){switch(p){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${p}'`)}}function w(p,b,M,h,P,w,t,z){const x=new Array(h),S=new Array(h);if(p instanceof Array){let Q=b/4;const mp=M/4;for(let b=0;b<w;b+=h){for(let b=0;b<h;b++)x[b]=S[b]=p[Q+b];z(S,b);for(let b=0;b<h;b++)x[b]!==S[b]&&(p[Q+b]=S[b]);Q+=mp}}else{const X=ArrayBuffer.isView(p)?new DataView(p.buffer,p.byteOffset,p.byteLength):new DataView(p),c=y(P);for(let p=0;p<w;p+=h){for(let p=0,M=b;p<h;p++,M+=c)x[p]=S[p]=Q(X,P,M,t);z(S,p);for(let p=0,M=b;p<h;p++,M+=c)x[p]!==S[p]&&mp(X,P,M,t,S[p]);b+=M}}}function t(p,b,M,Q,mp,P,t,z){const x=b*y(M),S=t*b;if(5126!==M||mp!==x){const h=new Float32Array(S);return w(p,Q,mp,b,M,S,P,((p,M)=>{for(let Q=0;Q<b;Q++)h[M+Q]=p[Q]})),h}if(!(p instanceof Array||p instanceof Float32Array)||0!==Q||p.length!==S){if(p instanceof Array){const b=Q/4;return p.slice(b,b+S)}if(p instanceof ArrayBuffer)return new Float32Array(p,Q,S);{const b=p.byteOffset+Q;return 0!==(3&b)&&(h.d.Warn("Float array must be aligned to 4-bytes border"),z=!0),z?new Float32Array(p.buffer.slice(b,b+S*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(p.buffer,b,S)}}return z?p.slice():p}function z(p,b,M,Q,mp,t,z,x){const S=y(M),X=P(M),c=z*b;if(Array.isArray(p)){if(0!==(3&Q)||0!==(3&mp))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const h=Q/4,y=mp/4;if(h+(z-1)*y+b>p.length)throw new Error("Last accessed index is out of bounds.");if(y<b)throw new Error("Data stride cannot be smaller than the component size.");if(y!==b){const h=new X(c);return w(p,Q,mp,b,M,c,t,((p,M)=>{for(let Q=0;Q<b;Q++)h[M+Q]=p[Q]})),h}return new X(p.slice(h,h+c))}let J,g=Q;p instanceof ArrayBuffer?J=p:(J=p.buffer,g+=p.byteOffset);if(g+(z-1)*mp+b*S>J.byteLength)throw new Error("Last accessed byte is out of bounds.");const f=b*S;if(mp<f)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(mp!==f){const p=new X(c);return w(J,g,mp,b,M,c,t,((M,h)=>{for(let Q=0;Q<b;Q++)p[h+Q]=M[Q]})),p}return 1!==S&&0!==(g&S-1)&&(h.d.Warn("Array must be aligned to border of element size. Data will be copied."),x=!0),x?new X(J.slice(g,g+c*S)):new X(J,g,c)}function x(p,b,M,Q,mp,P,t,z){const x=b*y(M),S=t*b;if(z.length!==S)throw new Error("Output length is not valid");if(5126===M&&mp===x)if(p instanceof Array){const b=Q/4;z.set(p,b)}else if(p instanceof ArrayBuffer){const b=new Float32Array(p,Q,S);z.set(b)}else{const b=p.byteOffset+Q;if(0!==(3&b))return h.d.Warn("Float array must be aligned to 4-bytes border"),void z.set(new Float32Array(p.buffer.slice(b,b+S*Float32Array.BYTES_PER_ELEMENT)));const M=new Float32Array(p.buffer,b,S);z.set(M)}else w(p,Q,mp,b,M,S,P,((p,M)=>{for(let h=0;h<b;h++)z[M+h]=p[h]}))}function S(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(p)){for(let Q=0;Q<b;Q++)if(p[M+Q]-h>65535)return!0;return!1}return 4===p.BYTES_PER_ELEMENT}},12852:(p,b,M)=>{M.d(b,{c:()=>h});class h{get underlyingResource(){return null}constructor(){this.references=0,this.XM=0,this.is32Bits=!1,this.uniqueId=h._Counter++}}h._Counter=0},12888:(p,b,M)=>{M.d(b,{c:()=>Q});var h=M(12680);class Q{static GetEffect(p){return void 0===p.getPipelineContext?p.effect:p}constructor(p){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=p.createDrawContext(),b&&(this.materialContext=p.createMaterialContext())}setEffect(p,b){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var h;(this.effect=p,void 0!==b&&(this.defines=b),M)&&(null===(h=this.drawContext)||void 0===h||h.reset())}dispose(){var p;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const p=this.effect;b?p.dispose():h.e.SetImmediate((()=>{p.getEngine().onEndFrameObservable.addOnce((()=>{p.dispose()}))})),this.effect=null}null===(p=this.drawContext)||void 0===p||p.dispose()}}},12982:(p,b,M)=>{M.d(b,{d:()=>Q});var h=M(12829);class Q{static GetPlanes(p){const b=[];for(let M=0;M<6;M++)b.push(new h.e(0,0,0,0));return Q.GetPlanesToRef(p,b),b}static GetNearPlaneToRef(p,b){const M=p.m;b.normal.x=M[3]+M[2],b.normal.y=M[7]+M[6],b.normal.z=M[11]+M[10],b.d=M[15]+M[14],b.normalize()}static GetFarPlaneToRef(p,b){const M=p.m;b.normal.x=M[3]-M[2],b.normal.y=M[7]-M[6],b.normal.z=M[11]-M[10],b.d=M[15]-M[14],b.normalize()}static GetLeftPlaneToRef(p,b){const M=p.m;b.normal.x=M[3]+M[0],b.normal.y=M[7]+M[4],b.normal.z=M[11]+M[8],b.d=M[15]+M[12],b.normalize()}static GetRightPlaneToRef(p,b){const M=p.m;b.normal.x=M[3]-M[0],b.normal.y=M[7]-M[4],b.normal.z=M[11]-M[8],b.d=M[15]-M[12],b.normalize()}static GetTopPlaneToRef(p,b){const M=p.m;b.normal.x=M[3]-M[1],b.normal.y=M[7]-M[5],b.normal.z=M[11]-M[9],b.d=M[15]-M[13],b.normalize()}static GetBottomPlaneToRef(p,b){const M=p.m;b.normal.x=M[3]+M[1],b.normal.y=M[7]+M[5],b.normal.z=M[11]+M[9],b.d=M[15]+M[13],b.normalize()}static GetPlanesToRef(p,b){Q.GetNearPlaneToRef(p,b[0]),Q.GetFarPlaneToRef(p,b[1]),Q.GetLeftPlaneToRef(p,b[2]),Q.GetRightPlaneToRef(p,b[3]),Q.GetTopPlaneToRef(p,b[4]),Q.GetBottomPlaneToRef(p,b[5])}static IsPointInFrustum(p,b){for(let M=0;M<6;M++)if(b[M].dotCoordinate(p)<0)return!1;return!0}}},12989:(p,b,M)=>{M.d(b,{b:()=>Q});var h=M(12630);class Q{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(p,b){Q.Enabled&&(this._current+=p,b&&this._fetchResult())}beginMonitoring(){Q.Enabled&&(this._startMonitoringTime=h.d.Now)}endMonitoring(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!Q.Enabled)return;p&&this.fetchNewFrame();const b=h.d.Now;this._current=b-this._startMonitoringTime,p&&this._fetchResult()}Sb(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const p=h.d.Now;p-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=p,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}Q.Enabled=!0},12867:(p,b,M)=>{M.d(b,{b:()=>Q,d:()=>h});class h{constructor(p){this.length=0,this.data=new Array(p),this._id=h._GlobalId++}push(p){this.data[this.length++]=p,this.length>this.data.length&&(this.data.length*=2)}forEach(p){for(let b=0;b<this.length;b++)p(this.data[b])}sort(p){this.data.sort(p)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(p){if(0!==p.length){this.length+p.length>this.data.length&&(this.data.length=2*(this.length+p.length));for(let b=0;b<p.length;b++)this.data[this.length++]=(p.data||p)[b]}}indexOf(p){const b=this.data.indexOf(p);return b>=this.length?-1:b}contains(p){return-1!==this.indexOf(p)}}h._GlobalId=0;class Q extends h{constructor(){super(...arguments),this._duplicateId=0}push(p){super.push(p),p.__smartArrayFlags||(p.__smartArrayFlags={}),p.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(p){return(!p.__smartArrayFlags||p.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(p),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(p){if(0!==p.length){this.length+p.length>this.data.length&&(this.data.length=2*(this.length+p.length));for(let b=0;b<p.length;b++){const M=(p.data||p)[b];this.pushNoDuplicate(M)}}}}},12844:(p,b,M)=>{M.d(b,{b:()=>mp});var h=M(12847),Q=M(12617);class mp{constructor(p){this._vertexBuffers={},this.onBeforeRenderObservable=new Q.d,this._scene=p}_prepareBuffers(){if(this._vertexBuffers[h.f.PositionKind])return;const p=[];p.push(1,1),p.push(-1,1),p.push(-1,-1),p.push(1,-1),this._vertexBuffers[h.f.PositionKind]=new h.f(this._scene.getEngine(),p,h.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const p=[];p.push(0),p.push(1),p.push(2),p.push(0),p.push(2),p.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(p)}_rebuild(){const p=this._vertexBuffers[h.f.PositionKind];p&&(p._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let p=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const M=this._scene.activeCamera;return!!M&&(b=b||M._postProcesses.filter((p=>null!=p)),!(!b||0===b.length||!this._scene.postProcessesEnabled)&&(b[0].activate(M,p,null!==b&&void 0!==b),!0))}directRender(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,mp=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:p.length;const P=this._scene.getEngine();for(let t=0;t<y;t++){var w;if(t<p.length-1)p[t+1].activate(this._scene.activeCamera||this._scene,null===b||void 0===b?void 0:b.texture);else b?P.bindFramebuffer(b,h,void 0,void 0,M,Q):mp||P.restoreDefaultFramebuffer(),null===(w=P._debugInsertMarker)||void 0===w||w.call(P,`post process ${p[t].name} output`);const y=p[t],z=y.apply();z&&(y.onBeforeRenderObservable.notifyObservers(z),this._prepareBuffers(),P.bindBuffers(this._vertexBuffers,this._indexBuffer,z),P.drawElementsType(0,0,6),y.onAfterRenderObservable.notifyObservers(z))}P.setDepthBuffer(!0),P.setDepthWrite(!0)}_finalizeFrame(p,b,M,h){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const mp=this._scene.activeCamera;if(!mp)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(h=h||mp._postProcesses.filter((p=>null!=p))).length||!this._scene.postProcessesEnabled)return;const y=this._scene.getEngine();for(let w=0,t=h.length;w<t;w++){const z=h[w];var P;if(w<t-1)z._outputTexture=h[w+1].activate(mp,null===b||void 0===b?void 0:b.texture);else b?(y.bindFramebuffer(b,M,void 0,void 0,Q),z._outputTexture=b):(y.restoreDefaultFramebuffer(),z._outputTexture=null),null===(P=y._debugInsertMarker)||void 0===P||P.call(y,`post process ${h[w].name} output`);if(p)break;const x=z.apply();x&&(z.onBeforeRenderObservable.notifyObservers(x),this._prepareBuffers(),y.bindBuffers(this._vertexBuffers,this._indexBuffer,x),y.drawElementsType(0,0,6),z.onAfterRenderObservable.notifyObservers(x))}y.setDepthBuffer(!0),y.setDepthWrite(!0),y.setAlphaMode(0)}dispose(){const p=this._vertexBuffers[h.f.PositionKind];p&&(p.dispose(),this._vertexBuffers[h.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12864:(p,b,M)=>{M.d(b,{c:()=>P});var h=M(12867),Q=M(12777);class mp{set opaqueSortCompareFn(p){this._opaqueSortCompareFn=p||mp.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(p){this._alphaTestSortCompareFn=p||mp.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(p){this._transparentSortCompareFn=p||mp.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(p,b){let M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,mp=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=p,this._opaqueSubMeshes=new h.d(256),this._transparentSubMeshes=new h.d(256),this._alphaTestSubMeshes=new h.d(256),this._depthOnlySubMeshes=new h.d(256),this._particleSystems=new h.d(256),this._spriteManagers=new h.d(256),this._empty=!0,this._edgesRenderers=new h.b(16),this._scene=b,this.opaqueSortCompareFn=M,this.alphaTestSortCompareFn=Q,this.transparentSortCompareFn=mp}render(p,b,M,h){if(p)return void p(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const Q=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(Q.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),Q.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const mp=Q.getStencilBuffer();if(Q.setStencilBuffer(!1),b&&this._renderSprites(),M&&this._renderParticles(h),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(Q.setStencilBuffer(mp),this._scene.useOrderIndependentTransparency){const p=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);p.length&&this._renderTransparent(p)}else this._renderTransparent(this._transparentSubMeshes);Q.setAlphaMode(0)}if(Q.setStencilBuffer(!1),this._edgesRenderers.length){for(let p=0;p<this._edgesRenderers.length;p++)this._edgesRenderers.data[p].render();Q.setAlphaMode(0)}Q.setStencilBuffer(mp)}_renderOpaqueSorted(p){mp._RenderSorted(p,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(p){mp._RenderSorted(p,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(p){mp._RenderSorted(p,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(p,b,M,h){let y,P=0;const w=M?M.globalPosition:mp._ZeroVector;if(h)for(;P<p.length;P++)y=p.data[P],y._alphaIndex=y.getMesh().alphaIndex,y._distanceToCamera=Q.QM.Distance(y.getBoundingInfo().boundingSphere.centerWorld,w);const t=p.length===p.data.length?p.data:p.data.slice(0,p.length);b&&t.sort(b);const z=t[0].getMesh().upp();for(P=0;P<t.length;P++)if(y=t[P],!z._activeMeshesFrozenButKeepClipping||y.isInFrustum(z._frustumPlanes)){if(h){const p=y.Tp();if(p&&p.needDepthPrePass){const b=p.upp().getEngine();b.setColorWrite(!1),b.setAlphaMode(0),y.render(!1),b.setColorWrite(!0)}}y.render(h)}}static defaultTransparentSortCompare(p,b){return p._alphaIndex>b._alphaIndex?1:p._alphaIndex<b._alphaIndex?-1:mp.backToFrontSortCompare(p,b)}static backToFrontSortCompare(p,b){return p._distanceToCamera<b._distanceToCamera?1:p._distanceToCamera>b._distanceToCamera?-1:0}static frontToBackSortCompare(p,b){return p._distanceToCamera<b._distanceToCamera?-1:p._distanceToCamera>b._distanceToCamera?1:0}static PainterSortCompare(p,b){const M=p.getMesh(),h=b.getMesh();return M.material&&h.material?M.material.uniqueId-h.material.uniqueId:M.uniqueId-h.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(p,b,M){void 0===b&&(b=p.getMesh()),void 0===M&&(M=p.Tp()),null!==M&&void 0!==M&&(M.needAlphaBlendingForMesh(b)?this._transparentSubMeshes.push(p):M.needAlphaTestingForMesh(b)?(M.needDepthPrePass&&this._depthOnlySubMeshes.push(p),this._alphaTestSubMeshes.push(p)):(M.needDepthPrePass&&this._depthOnlySubMeshes.push(p),this._opaqueSubMeshes.push(p)),b._renderingGroup=this,b._edgesRenderer&&b.isEnabled()&&b.isVisible&&b._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(b._edgesRenderer),this._empty=!1)}dispatchSprites(p){this._spriteManagers.push(p),this._empty=!1}dispatchParticles(p){this._particleSystems.push(p),this._empty=!1}_renderParticles(p){if(0===this._particleSystems.length)return;const b=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let M=0;M<this._particleSystems.length;M++){const h=this._particleSystems.data[M];if(0===(b&&b.layerMask&h.layerMask))continue;const Q=h.hb;Q.position&&p&&-1===p.indexOf(Q)||this._scene._activeParticles.addCount(h.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const p=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let b=0;b<this._spriteManagers.length;b++){const M=this._spriteManagers.data[b];0!==(p&&p.layerMask&M.layerMask)&&M.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}mp._ZeroVector=Q.QM.Zero();class y{}class P{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(p){p!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=p,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const p of this._scene.meshes)if(p.Lb)for(const b of p.Lb)b._wasDispatched=!1;if(this._scene.spriteManagers)for(const p of this._scene.spriteManagers)p._wasDispatched=!1;for(const p of this._scene.LX)p._wasDispatched=!1}constructor(p){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new y,this._maintainStateBetweenFrames=!1,this._scene=p;for(let b=P.MIN_RENDERINGGROUPS;b<P.MAX_RENDERINGGROUPS;b++)this._autoClearDepthStencil[b]={ab:!0,depth:!0,cb:!0}}getRenderingGroup(p){const b=p||0;return this._prepareRenderingGroup(b),this._renderingGroups[b]}_clearDepthStencilBuffer(){let p=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,p,b),this._depthStencilBufferAlreadyCleaned=!0)}render(p,b,M,h){const Q=this._renderingGroupInfo;if(Q.yM=this._scene,Q.camera=this._scene.activeCamera,Q.renderingManager=this,this._scene.spriteManagers&&h)for(let mp=0;mp<this._scene.spriteManagers.length;mp++){const p=this._scene.spriteManagers[mp];this.dispatchSprites(p)}for(let mp=P.MIN_RENDERINGGROUPS;mp<P.MAX_RENDERINGGROUPS;mp++){this._depthStencilBufferAlreadyCleaned=mp===P.MIN_RENDERINGGROUPS;const y=this._renderingGroups[mp];if(!y||y._empty)continue;const w=1<<mp;if(Q.renderingGroupId=mp,this._scene.onBeforeRenderingGroupObservable.notifyObservers(Q,w),P.AUTOCLEAR){const p=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(mp):this._autoClearDepthStencil[mp];p&&p.ab&&this._clearDepthStencilBuffer(p.depth,p.cb)}for(const p of this._scene._beforeRenderingGroupDrawStage)p.action(mp);y.render(p,h,M,b);for(const p of this._scene._afterRenderingGroupDrawStage)p.action(mp);this._scene.onAfterRenderingGroupObservable.notifyObservers(Q,w)}}reset(){if(!this.maintainStateBetweenFrames)for(let p=P.MIN_RENDERINGGROUPS;p<P.MAX_RENDERINGGROUPS;p++){const b=this._renderingGroups[p];b&&b.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let p=P.MIN_RENDERINGGROUPS;p<P.MAX_RENDERINGGROUPS;p++){const b=this._renderingGroups[p];b&&b.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let p=P.MIN_RENDERINGGROUPS;p<P.MAX_RENDERINGGROUPS;p++){const b=this._renderingGroups[p];b&&b.dispose()}}_prepareRenderingGroup(p){void 0===this._renderingGroups[p]&&(this._renderingGroups[p]=new mp(p,this._scene,this._customOpaqueSortCompareFn[p],this._customAlphaTestSortCompareFn[p],this._customTransparentSortCompareFn[p]))}dispatchSprites(p){this.maintainStateBetweenFrames&&p._wasDispatched||(p._wasDispatched=!0,this.getRenderingGroup(p.renderingGroupId).dispatchSprites(p))}dispatchParticles(p){this.maintainStateBetweenFrames&&p._wasDispatched||(p._wasDispatched=!0,this.getRenderingGroup(p.renderingGroupId).dispatchParticles(p))}dispatch(p,b,M){void 0===b&&(b=p.getMesh()),this.maintainStateBetweenFrames&&p._wasDispatched||(p._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatch(p,b,M))}setRenderingOrder(p){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,M=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[p]=b,this._customAlphaTestSortCompareFn[p]=M,this._customTransparentSortCompareFn[p]=h,this._renderingGroups[p]){const b=this._renderingGroups[p];b.opaqueSortCompareFn=this._customOpaqueSortCompareFn[p],b.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[p],b.transparentSortCompareFn=this._customTransparentSortCompareFn[p]}}setRenderingAutoClearDepthStencil(p,b){let M=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[p]={ab:b,depth:M,cb:h}}getAutoClearDepthStencilSetup(p){return this._autoClearDepthStencil[p]}}P.MAX_RENDERINGGROUPS=4,P.MIN_RENDERINGGROUPS=0,P.AUTOCLEAR=!0}}]);