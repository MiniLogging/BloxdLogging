"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[19],{11259:(o,H,n)=>{n.d(H,{c:()=>O,d:()=>Y});var E=n(11268),k=n(11038),g=n(11276);class O{get l(){return this._isDisposed}constructor(o,H,n){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=arguments.length>4&&void 0!==arguments[4]&&arguments[4],O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],y=arguments.length>7?arguments[7]:void 0,S=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,o&&o.bo?this._engine=o.bo().getEngine():this._engine=o,this._updatable=n,this._instanced=O,this._divisor=y||1,this._label=S,H instanceof E.c?(this._data=null,this._buffer=H):(this._data=H,this._buffer=null),this.byteStride=Y?k:k*Float32Array.BYTES_PER_ELEMENT,g||this.create()}createVertexBuffer(o,H,n,E,k){let g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6?arguments[6]:void 0;const y=g?H:H*Float32Array.BYTES_PER_ELEMENT,S=E?g?E:E*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Y(this._engine,this,o,this._updatable,!0,S,void 0===k?this._instanced:k,y,n,void 0,void 0,!0,this._divisor||O)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!o&&this._buffer||(o=o||this._data,o&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,o),this._data=o):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(o,this._label),this._data=o):this._buffer=this._engine.createVertexBuffer(o,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.xn>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.xn,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.xn,void 0,this._label));k.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(o){this.create(o)}updateDirectly(o,H,n){let E=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,o,E?H:H*Float32Array.BYTES_PER_ELEMENT,n?n*this.byteStride:void 0),this._data=0===H&&void 0===n?o:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class Y{get l(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(o){const H=0!=o;this._instanceDivisor=o,H!==this._instanced&&(this._instanced=H,this._computeHashCode())}get _maxVerticesCount(){const o=this.getData();return o?Array.isArray(o)?o.length/(this.byteStride/4)-this.byteOffset/4:(o.byteLength-this.byteOffset)/this.byteStride:0}constructor(o,H,n,E,k,y,S,G,c,A){let l=arguments.length>10&&void 0!==arguments[10]&&arguments[10],x=arguments.length>11&&void 0!==arguments[11]&&arguments[11],z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,V=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let J=!1;if(this.lH=o,"object"===typeof E&&null!==E?(J=E.updatable??!1,k=E.postponeInternalCreation,y=E.stride,S=E.instanced,G=E.offset,c=E.size,A=E.type,l=E.normalized??!1,x=E.useBytes??!1,z=E.divisor??1,V=E.takeBufferOwnership??!1,this._label=E.label):J=!!E,H instanceof O?(this._buffer=H,this._ownsBuffer=V):(this._buffer=new O(o,H,J,y,k,S,x,z,this._label),this._ownsBuffer=!0),this.uniqueId=Y._Counter++,this._kind=n,void 0===A){const o=this.getData();this.type=o?Y.GetDataType(o):Y.FLOAT}else this.type=A;const N=(0,g.k)(this.type);x?(this._size=c||(y?y/N:Y.DeduceStride(n)),this.byteStride=y||this._buffer.byteStride||this._size*N,this.byteOffset=G||0):(this._size=c||y||Y.DeduceStride(n),this.byteStride=y?y*N:this._buffer.byteStride||this._size*N,this.byteOffset=(G||0)*N),this.normalized=l,this._instanced=void 0!==S&&S,this._instanceDivisor=S?z:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var o;null===(o=this._buffer)||void 0===o||o._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(o,H){const n=this.getData();return n?(0,g.g)(n,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,o,H):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,g.k)(this.type)}getOffset(){return this.byteOffset/(0,g.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,g.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(o){this._buffer.create(o),this._alignBuffer()}update(o){this._buffer.update(o),this._alignBuffer()}updateDirectly(o,H){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(o,H,void 0,n),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(o,H){(0,g.e)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,o,this.normalized,((o,n)=>{for(let E=0;E<this._size;E++)H(o[E],n+E)}))}_alignBuffer(){}static DeduceStride(o){switch(o){case Y.UVKind:case Y.UV2Kind:case Y.UV3Kind:case Y.UV4Kind:case Y.UV5Kind:case Y.UV6Kind:return 2;case Y.NormalKind:case Y.PositionKind:return 3;case Y.ColorKind:case Y.ColorInstanceKind:case Y.MatricesIndicesKind:case Y.MatricesIndicesExtraKind:case Y.MatricesWeightsKind:case Y.MatricesWeightsExtraKind:case Y.TangentKind:return 4;default:throw new Error("Invalid kind '"+o+"'")}}static GetDataType(o){return o instanceof Int8Array?Y.BYTE:o instanceof Uint8Array?Y.UNSIGNED_BYTE:o instanceof Int16Array?Y.SHORT:o instanceof Uint16Array?Y.UNSIGNED_SHORT:o instanceof Int32Array?Y.INT:o instanceof Uint32Array?Y.UNSIGNED_INT:Y.FLOAT}static GetTypeByteLength(o){return(0,g.k)(o)}static ForEach(o,H,n,E,k,O,Y,y){(0,g.e)(o,H,n,E,k,O,Y,((o,H)=>{for(let n=0;n<E;n++)y(o[n],H+n)}))}static GetFloatData(o,H,n,E,k,O,Y,y){return(0,g.g)(o,H,n,E,k,O,Y,y)}}Y._Counter=0,Y.BYTE=5120,Y.UNSIGNED_BYTE=5121,Y.SHORT=5122,Y.UNSIGNED_SHORT=5123,Y.INT=5124,Y.UNSIGNED_INT=5125,Y.FLOAT=5126,Y.PositionKind="position",Y.NormalKind="normal",Y.TangentKind="tangent",Y.UVKind="uv",Y.UV2Kind="uv2",Y.UV3Kind="uv3",Y.UV4Kind="uv4",Y.UV5Kind="uv5",Y.UV6Kind="uv6",Y.ColorKind="color",Y.ColorInstanceKind="instanceColor",Y.MatricesIndicesKind="matricesIndices",Y.MatricesWeightsKind="matricesWeights",Y.MatricesIndicesExtraKind="matricesIndicesExtra",Y.MatricesWeightsExtraKind="matricesWeightsExtra"},11276:(o,H,n)=>{n.d(H,{c:()=>A,d:()=>c,e:()=>y,g:()=>S,k:()=>O,n:()=>Y,q:()=>G});var E=n(11038);function k(o,H,n,E){switch(H){case 5120:{let H=o.getInt8(n);return E&&(H=Math.max(H/127,-1)),H}case 5121:{let H=o.getUint8(n);return E&&(H/=255),H}case 5122:{let H=o.getInt16(n,!0);return E&&(H=Math.max(H/32767,-1)),H}case 5123:{let H=o.getUint16(n,!0);return E&&(H/=65535),H}case 5124:return o.getInt32(n,!0);case 5125:return o.getUint32(n,!0);case 5126:return o.getFloat32(n,!0);default:throw new Error(`Invalid component type ${H}`)}}function g(o,H,n,E,k){switch(H){case 5120:E&&(k=Math.round(127*k)),o.setInt8(n,k);break;case 5121:E&&(k=Math.round(255*k)),o.setUint8(n,k);break;case 5122:E&&(k=Math.round(32767*k)),o.setInt16(n,k,!0);break;case 5123:E&&(k=Math.round(65535*k)),o.setUint16(n,k,!0);break;case 5124:o.setInt32(n,k,!0);break;case 5125:o.setUint32(n,k,!0);break;case 5126:o.setFloat32(n,k,!0);break;default:throw new Error(`Invalid component type ${H}`)}}function O(o){switch(o){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${o}'`)}}function Y(o){switch(o){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${o}'`)}}function y(o,H,n,E,Y,y,S,G){const c=new Array(E),A=new Array(E);if(o instanceof Array){let k=H/4;const g=n/4;for(let H=0;H<y;H+=E){for(let H=0;H<E;H++)c[H]=A[H]=o[k+H];G(A,H);for(let H=0;H<E;H++)c[H]!==A[H]&&(o[k+H]=A[H]);k+=g}}else{const l=ArrayBuffer.isView(o)?new DataView(o.buffer,o.byteOffset,o.byteLength):new DataView(o),x=O(Y);for(let o=0;o<y;o+=E){for(let o=0,n=H;o<E;o++,n+=x)c[o]=A[o]=k(l,Y,n,S);G(A,o);for(let o=0,n=H;o<E;o++,n+=x)c[o]!==A[o]&&g(l,Y,n,S,A[o]);H+=n}}}function S(o,H,n,k,g,Y,S,G){const c=H*O(n),A=S*H;if(5126!==n||g!==c){const E=new Float32Array(A);return y(o,k,g,H,n,A,Y,((o,n)=>{for(let k=0;k<H;k++)E[n+k]=o[k]})),E}if(!(o instanceof Array||o instanceof Float32Array)||0!==k||o.length!==A){if(o instanceof Array){const H=k/4;return o.slice(H,H+A)}if(o instanceof ArrayBuffer)return new Float32Array(o,k,A);{const H=o.byteOffset+k;return 0!==(3&H)&&(E.d.Warn("Float array must be aligned to 4-bytes border"),G=!0),G?new Float32Array(o.buffer.slice(H,H+A*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(o.buffer,H,A)}}return G?o.slice():o}function G(o,H,n,k,g,S,G,c){const A=O(n),l=Y(n),x=G*H;if(Array.isArray(o)){if(0!==(3&k)||0!==(3&g))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const E=k/4,O=g/4;if(E+(G-1)*O+H>o.length)throw new Error("Last accessed index is out of bounds.");if(O<H)throw new Error("Data stride cannot be smaller than the component size.");if(O!==H){const E=new l(x);return y(o,k,g,H,n,x,S,((o,n)=>{for(let k=0;k<H;k++)E[n+k]=o[k]})),E}return new l(o.slice(E,E+x))}let z,V=k;o instanceof ArrayBuffer?z=o:(z=o.buffer,V+=o.byteOffset);if(V+(G-1)*g+H*A>z.byteLength)throw new Error("Last accessed byte is out of bounds.");const J=H*A;if(g<J)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(g!==J){const o=new l(x);return y(z,V,g,H,n,x,S,((n,E)=>{for(let k=0;k<H;k++)o[E+k]=n[k]})),o}return 1!==A&&0!==(V&A-1)&&(E.d.Warn("Array must be aligned to border of element size. Data will be copied."),c=!0),c?new l(z.slice(V,V+x*A)):new l(z,V,x)}function c(o,H,n,k,g,Y,S,G){const c=H*O(n),A=S*H;if(G.length!==A)throw new Error("Output length is not valid");if(5126===n&&g===c)if(o instanceof Array){const H=k/4;G.set(o,H)}else if(o instanceof ArrayBuffer){const H=new Float32Array(o,k,A);G.set(H)}else{const H=o.byteOffset+k;if(0!==(3&H))return E.d.Warn("Float array must be aligned to 4-bytes border"),void G.set(new Float32Array(o.buffer.slice(H,H+A*Float32Array.BYTES_PER_ELEMENT)));const n=new Float32Array(o.buffer,H,A);G.set(n)}else y(o,k,g,H,n,A,Y,((o,n)=>{for(let E=0;E<H;E++)G[n+E]=o[E]}))}function A(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(o)){for(let k=0;k<H;k++)if(o[n+k]-E>65535)return!0;return!1}return 4===o.BYTES_PER_ELEMENT}},11268:(o,H,n)=>{n.d(H,{c:()=>E});class E{get underlyingResource(){return null}constructor(){this.references=0,this.xn=0,this.is32Bits=!1,this.uniqueId=E._Counter++}}E._Counter=0},11310:(o,H,n)=>{n.d(H,{c:()=>k});var E=n(11088);class k{static GetEffect(o){return void 0===o.getPipelineContext?o.effect:o}constructor(o){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=o.createDrawContext(),H&&(this.materialContext=o.createMaterialContext())}setEffect(o,H){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var E;(this.effect=o,void 0!==H&&(this.defines=H),n)&&(null===(E=this.drawContext)||void 0===E||E.reset())}dispose(){var o;let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const o=this.effect;H?o.dispose():E.c.SetImmediate((()=>{o.getEngine().onEndFrameObservable.addOnce((()=>{o.dispose()}))})),this.effect=null}null===(o=this.drawContext)||void 0===o||o.dispose()}}},11401:(o,H,n)=>{n.d(H,{e:()=>k});var E=n(11242);class k{static GetPlanes(o){const H=[];for(let n=0;n<6;n++)H.push(new E.c(0,0,0,0));return k.GetPlanesToRef(o,H),H}static GetNearPlaneToRef(o,H){const n=o.m;H.normal.x=n[3]+n[2],H.normal.y=n[7]+n[6],H.normal.z=n[11]+n[10],H.d=n[15]+n[14],H.normalize()}static GetFarPlaneToRef(o,H){const n=o.m;H.normal.x=n[3]-n[2],H.normal.y=n[7]-n[6],H.normal.z=n[11]-n[10],H.d=n[15]-n[14],H.normalize()}static GetLeftPlaneToRef(o,H){const n=o.m;H.normal.x=n[3]+n[0],H.normal.y=n[7]+n[4],H.normal.z=n[11]+n[8],H.d=n[15]+n[12],H.normalize()}static GetRightPlaneToRef(o,H){const n=o.m;H.normal.x=n[3]-n[0],H.normal.y=n[7]-n[4],H.normal.z=n[11]-n[8],H.d=n[15]-n[12],H.normalize()}static GetTopPlaneToRef(o,H){const n=o.m;H.normal.x=n[3]-n[1],H.normal.y=n[7]-n[5],H.normal.z=n[11]-n[9],H.d=n[15]-n[13],H.normalize()}static GetBottomPlaneToRef(o,H){const n=o.m;H.normal.x=n[3]+n[1],H.normal.y=n[7]+n[5],H.normal.z=n[11]+n[9],H.d=n[15]+n[13],H.normalize()}static GetPlanesToRef(o,H){k.GetNearPlaneToRef(o,H[0]),k.GetFarPlaneToRef(o,H[1]),k.GetLeftPlaneToRef(o,H[2]),k.GetRightPlaneToRef(o,H[3]),k.GetTopPlaneToRef(o,H[4]),k.GetBottomPlaneToRef(o,H[5])}static IsPointInFrustum(o,H){for(let n=0;n<6;n++)if(H[n].dotCoordinate(o)<0)return!1;return!0}}},11412:(o,H,n)=>{n.d(H,{e:()=>k});var E=n(11042);class k{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(o,H){k.Enabled&&(this._current+=o,H&&this._fetchResult())}beginMonitoring(){k.Enabled&&(this._startMonitoringTime=E.b.Now)}endMonitoring(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!k.Enabled)return;o&&this.fetchNewFrame();const H=E.b.Now;this._current=H-this._startMonitoringTime,o&&this._fetchResult()}gg(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const o=E.b.Now;o-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=o,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}k.Enabled=!0},11289:(o,H,n)=>{n.d(H,{b:()=>k,c:()=>E});class E{constructor(o){this.length=0,this.data=new Array(o),this._id=E._GlobalId++}push(o){this.data[this.length++]=o,this.length>this.data.length&&(this.data.length*=2)}forEach(o){for(let H=0;H<this.length;H++)o(this.data[H])}sort(o){this.data.sort(o)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(o){if(0!==o.length){this.length+o.length>this.data.length&&(this.data.length=2*(this.length+o.length));for(let H=0;H<o.length;H++)this.data[this.length++]=(o.data||o)[H]}}indexOf(o){const H=this.data.indexOf(o);return H>=this.length?-1:H}contains(o){return-1!==this.indexOf(o)}}E._GlobalId=0;class k extends E{constructor(){super(...arguments),this._duplicateId=0}push(o){super.push(o),o.__smartArrayFlags||(o.__smartArrayFlags={}),o.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(o){return(!o.__smartArrayFlags||o.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(o),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(o){if(0!==o.length){this.length+o.length>this.data.length&&(this.data.length=2*(this.length+o.length));for(let H=0;H<o.length;H++){const n=(o.data||o)[H];this.pushNoDuplicate(n)}}}}},11257:(o,H,n)=>{n.d(H,{d:()=>g});var E=n(11259),k=n(11026);class g{constructor(o){this._vertexBuffers={},this.onBeforeRenderObservable=new k.d,this._scene=o}_prepareBuffers(){if(this._vertexBuffers[E.d.PositionKind])return;const o=[];o.push(1,1),o.push(-1,1),o.push(-1,-1),o.push(1,-1),this._vertexBuffers[E.d.PositionKind]=new E.d(this._scene.getEngine(),o,E.d.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const o=[];o.push(0),o.push(1),o.push(2),o.push(0),o.push(2),o.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(o)}_rebuild(){const o=this._vertexBuffers[E.d.PositionKind];o&&(o._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const n=this._scene.activeCamera;return!!n&&(H=H||n._postProcesses.filter((o=>null!=o)),!(!H||0===H.length||!this._scene.postProcessesEnabled)&&(H[0].activate(n,o,null!==H&&void 0!==H),!0))}directRender(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],O=arguments.length>6&&void 0!==arguments[6]?arguments[6]:o.length;const Y=this._scene.getEngine();for(let S=0;S<O;S++){var y;if(S<o.length-1)o[S+1].activate(this._scene.activeCamera||this._scene,null===H||void 0===H?void 0:H.texture);else H?Y.bindFramebuffer(H,E,void 0,void 0,n,k):g||Y.restoreDefaultFramebuffer(),null===(y=Y._debugInsertMarker)||void 0===y||y.call(Y,`post process ${o[S].name} output`);const O=o[S],G=O.apply();G&&(O.onBeforeRenderObservable.notifyObservers(G),this._prepareBuffers(),Y.bindBuffers(this._vertexBuffers,this._indexBuffer,G),Y.drawElementsType(0,0,6),O.onAfterRenderObservable.notifyObservers(G))}Y.setDepthBuffer(!0),Y.setDepthWrite(!0)}_finalizeFrame(o,H,n,E){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const g=this._scene.activeCamera;if(!g)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(E=E||g._postProcesses.filter((o=>null!=o))).length||!this._scene.postProcessesEnabled)return;const O=this._scene.getEngine();for(let y=0,S=E.length;y<S;y++){const G=E[y];var Y;if(y<S-1)G._outputTexture=E[y+1].activate(g,null===H||void 0===H?void 0:H.texture);else H?(O.bindFramebuffer(H,n,void 0,void 0,k),G._outputTexture=H):(O.restoreDefaultFramebuffer(),G._outputTexture=null),null===(Y=O._debugInsertMarker)||void 0===Y||Y.call(O,`post process ${E[y].name} output`);if(o)break;const c=G.apply();c&&(G.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),O.bindBuffers(this._vertexBuffers,this._indexBuffer,c),O.drawElementsType(0,0,6),G.onAfterRenderObservable.notifyObservers(c))}O.setDepthBuffer(!0),O.setDepthWrite(!0),O.setAlphaMode(0)}dispose(){const o=this._vertexBuffers[E.d.PositionKind];o&&(o.dispose(),this._vertexBuffers[E.d.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11285:(o,H,n)=>{n.d(H,{d:()=>Y});var E=n(11289),k=n(11189);class g{set opaqueSortCompareFn(o){this._opaqueSortCompareFn=o||g.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(o){this._alphaTestSortCompareFn=o||g.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(o){this._transparentSortCompareFn=o||g.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(o,H){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=o,this._opaqueSubMeshes=new E.c(256),this._transparentSubMeshes=new E.c(256),this._alphaTestSubMeshes=new E.c(256),this._depthOnlySubMeshes=new E.c(256),this._particleSystems=new E.c(256),this._spriteManagers=new E.c(256),this._empty=!0,this._edgesRenderers=new E.b(16),this._scene=H,this.opaqueSortCompareFn=n,this.alphaTestSortCompareFn=k,this.transparentSortCompareFn=g}render(o,H,n,E){if(o)return void o(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const k=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(k.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),k.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const g=k.getStencilBuffer();if(k.setStencilBuffer(!1),H&&this._renderSprites(),n&&this._renderParticles(E),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(k.setStencilBuffer(g),this._scene.useOrderIndependentTransparency){const o=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);o.length&&this._renderTransparent(o)}else this._renderTransparent(this._transparentSubMeshes);k.setAlphaMode(0)}if(k.setStencilBuffer(!1),this._edgesRenderers.length){for(let o=0;o<this._edgesRenderers.length;o++)this._edgesRenderers.data[o].render();k.setAlphaMode(0)}k.setStencilBuffer(g)}_renderOpaqueSorted(o){g._RenderSorted(o,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(o){g._RenderSorted(o,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(o){g._RenderSorted(o,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(o,H,n,E){let O,Y=0;const y=n?n.globalPosition:g._ZeroVector;if(E)for(;Y<o.length;Y++)O=o.data[Y],O._alphaIndex=O.getMesh().alphaIndex,O._distanceToCamera=k.xH.Distance(O.getBoundingInfo().boundingSphere.centerWorld,y);const S=o.length===o.data.length?o.data:o.data.slice(0,o.length);H&&S.sort(H);const G=S[0].getMesh().bo();for(Y=0;Y<S.length;Y++)if(O=S[Y],!G._activeMeshesFrozenButKeepClipping||O.isInFrustum(G._frustumPlanes)){if(E){const o=O.Co();if(o&&o.needDepthPrePass){const H=o.bo().getEngine();H.setColorWrite(!1),H.setAlphaMode(0),O.render(!1),H.setColorWrite(!0)}}O.render(E)}}static defaultTransparentSortCompare(o,H){return o._alphaIndex>H._alphaIndex?1:o._alphaIndex<H._alphaIndex?-1:g.backToFrontSortCompare(o,H)}static backToFrontSortCompare(o,H){return o._distanceToCamera<H._distanceToCamera?1:o._distanceToCamera>H._distanceToCamera?-1:0}static frontToBackSortCompare(o,H){return o._distanceToCamera<H._distanceToCamera?-1:o._distanceToCamera>H._distanceToCamera?1:0}static PainterSortCompare(o,H){const n=o.getMesh(),E=H.getMesh();return n.material&&E.material?n.material.uniqueId-E.material.uniqueId:n.uniqueId-E.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(o,H,n){void 0===H&&(H=o.getMesh()),void 0===n&&(n=o.Co()),null!==n&&void 0!==n&&(n.needAlphaBlendingForMesh(H)?this._transparentSubMeshes.push(o):n.needAlphaTestingForMesh(H)?(n.needDepthPrePass&&this._depthOnlySubMeshes.push(o),this._alphaTestSubMeshes.push(o)):(n.needDepthPrePass&&this._depthOnlySubMeshes.push(o),this._opaqueSubMeshes.push(o)),H._renderingGroup=this,H._edgesRenderer&&H.isEnabled()&&H.isVisible&&H._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(H._edgesRenderer),this._empty=!1)}dispatchSprites(o){this._spriteManagers.push(o),this._empty=!1}dispatchParticles(o){this._particleSystems.push(o),this._empty=!1}_renderParticles(o){if(0===this._particleSystems.length)return;const H=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let n=0;n<this._particleSystems.length;n++){const E=this._particleSystems.data[n];if(0===(H&&H.layerMask&E.layerMask))continue;const k=E.i;k.position&&o&&-1===o.indexOf(k)||this._scene._activeParticles.addCount(E.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const o=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let H=0;H<this._spriteManagers.length;H++){const n=this._spriteManagers.data[H];0!==(o&&o.layerMask&n.layerMask)&&n.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}g._ZeroVector=k.xH.Zero();class O{}class Y{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(o){o!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=o,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const o of this._scene.meshes)if(o.jg)for(const H of o.jg)H._wasDispatched=!1;if(this._scene.spriteManagers)for(const o of this._scene.spriteManagers)o._wasDispatched=!1;for(const o of this._scene.jA)o._wasDispatched=!1}constructor(o){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new O,this._maintainStateBetweenFrames=!1,this._scene=o;for(let H=Y.MIN_RENDERINGGROUPS;H<Y.MAX_RENDERINGGROUPS;H++)this._autoClearDepthStencil[H]={Qg:!0,depth:!0,stencil:!0}}getRenderingGroup(o){const H=o||0;return this._prepareRenderingGroup(H),this._renderingGroups[H]}_clearDepthStencilBuffer(){let o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,o,H),this._depthStencilBufferAlreadyCleaned=!0)}render(o,H,n,E){const k=this._renderingGroupInfo;if(k.VH=this._scene,k.camera=this._scene.activeCamera,k.renderingManager=this,this._scene.spriteManagers&&E)for(let g=0;g<this._scene.spriteManagers.length;g++){const o=this._scene.spriteManagers[g];this.dispatchSprites(o)}for(let g=Y.MIN_RENDERINGGROUPS;g<Y.MAX_RENDERINGGROUPS;g++){this._depthStencilBufferAlreadyCleaned=g===Y.MIN_RENDERINGGROUPS;const O=this._renderingGroups[g];if(!O||O._empty)continue;const y=1<<g;if(k.renderingGroupId=g,this._scene.onBeforeRenderingGroupObservable.notifyObservers(k,y),Y.AUTOCLEAR){const o=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(g):this._autoClearDepthStencil[g];o&&o.Qg&&this._clearDepthStencilBuffer(o.depth,o.stencil)}for(const o of this._scene._beforeRenderingGroupDrawStage)o.action(g);O.render(o,E,n,H);for(const o of this._scene._afterRenderingGroupDrawStage)o.action(g);this._scene.onAfterRenderingGroupObservable.notifyObservers(k,y)}}reset(){if(!this.maintainStateBetweenFrames)for(let o=Y.MIN_RENDERINGGROUPS;o<Y.MAX_RENDERINGGROUPS;o++){const H=this._renderingGroups[o];H&&H.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let o=Y.MIN_RENDERINGGROUPS;o<Y.MAX_RENDERINGGROUPS;o++){const H=this._renderingGroups[o];H&&H.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let o=Y.MIN_RENDERINGGROUPS;o<Y.MAX_RENDERINGGROUPS;o++){const H=this._renderingGroups[o];H&&H.dispose()}}_prepareRenderingGroup(o){void 0===this._renderingGroups[o]&&(this._renderingGroups[o]=new g(o,this._scene,this._customOpaqueSortCompareFn[o],this._customAlphaTestSortCompareFn[o],this._customTransparentSortCompareFn[o]))}dispatchSprites(o){this.maintainStateBetweenFrames&&o._wasDispatched||(o._wasDispatched=!0,this.getRenderingGroup(o.renderingGroupId).dispatchSprites(o))}dispatchParticles(o){this.maintainStateBetweenFrames&&o._wasDispatched||(o._wasDispatched=!0,this.getRenderingGroup(o.renderingGroupId).dispatchParticles(o))}dispatch(o,H,n){void 0===H&&(H=o.getMesh()),this.maintainStateBetweenFrames&&o._wasDispatched||(o._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatch(o,H,n))}setRenderingOrder(o){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[o]=H,this._customAlphaTestSortCompareFn[o]=n,this._customTransparentSortCompareFn[o]=E,this._renderingGroups[o]){const H=this._renderingGroups[o];H.opaqueSortCompareFn=this._customOpaqueSortCompareFn[o],H.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[o],H.transparentSortCompareFn=this._customTransparentSortCompareFn[o]}}setRenderingAutoClearDepthStencil(o,H){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],E=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[o]={Qg:H,depth:n,stencil:E}}getAutoClearDepthStencilSetup(o){return this._autoClearDepthStencil[o]}}Y.MAX_RENDERINGGROUPS=4,Y.MIN_RENDERINGGROUPS=0,Y.AUTOCLEAR=!0}}]);