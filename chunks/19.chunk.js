"use strict";(self.ufnpnb83drd=self.ufnpnb83drd||[]).push([[19],{12407:(E,U,g)=>{g.d(U,{d:()=>S,f:()=>u});var N=g(12410),L=g(12186),D=g(12418);class S{get C(){return this._isDisposed}constructor(E,U,g){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,D=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,E&&E.tE?this._engine=E.tE().getEngine():this._engine=E,this._updatable=g,this._instanced=S,this._divisor=s||1,this._label=C,U instanceof N.d?(this._data=null,this._buffer=U):(this._data=U,this._buffer=null),this.byteStride=u?L:L*Float32Array.BYTES_PER_ELEMENT,D||this.create()}createVertexBuffer(E,U,g,N,L){let D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6?arguments[6]:void 0;const s=D?U:U*Float32Array.BYTES_PER_ELEMENT,C=N?D?N:N*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new u(this._engine,this,E,this._updatable,!0,C,void 0===L?this._instanced:L,s,g,void 0,void 0,!0,this._divisor||S)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!E&&this._buffer||(E=E||this._data,E&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,E),this._data=E):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(E,this._label),this._data=E):this._buffer=this._engine.createVertexBuffer(E,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.aU>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.aU,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.aU,void 0,this._label));L.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(E){this.create(E)}updateDirectly(E,U,g){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,E,N?U:U*Float32Array.BYTES_PER_ELEMENT,g?g*this.byteStride:void 0),this._data=0===U&&void 0===g?E:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class u{get C(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(E){const U=0!=E;this._instanceDivisor=E,U!==this._instanced&&(this._instanced=U,this._computeHashCode())}get _maxVerticesCount(){const E=this.getData();return E?Array.isArray(E)?E.length/(this.byteStride/4)-this.byteOffset/4:(E.byteLength-this.byteOffset)/this.byteStride:0}constructor(E,U,g,N,L,s,C,B,P,F){let f=arguments.length>10&&void 0!==arguments[10]&&arguments[10],d=arguments.length>11&&void 0!==arguments[11]&&arguments[11],I=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,y=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let h=!1;if(this.fU=E,"object"===typeof N&&null!==N?(h=N.updatable??!1,L=N.postponeInternalCreation,s=N.stride,C=N.instanced,B=N.offset,P=N.size,F=N.type,f=N.normalized??!1,d=N.useBytes??!1,I=N.divisor??1,y=N.takeBufferOwnership??!1,this._label=N.label):h=!!N,U instanceof S?(this._buffer=U,this._ownsBuffer=y):(this._buffer=new S(E,U,h,s,L,C,d,I,this._label),this._ownsBuffer=!0),this.uniqueId=u._Counter++,this._kind=g,void 0===F){const E=this.getData();this.type=E?u.GetDataType(E):u.FLOAT}else this.type=F;const V=(0,D.k)(this.type);d?(this._size=P||(s?s/V:u.DeduceStride(g)),this.byteStride=s||this._buffer.byteStride||this._size*V,this.byteOffset=B||0):(this._size=P||s||u.DeduceStride(g),this.byteStride=s?s*V:this._buffer.byteStride||this._size*V,this.byteOffset=(B||0)*V),this.normalized=f,this._instanced=void 0!==C&&C,this._instanceDivisor=C?I:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var E;null===(E=this._buffer)||void 0===E||E._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(E,U){const g=this.getData();return g?(0,D.h)(g,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,E,U):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,D.k)(this.type)}getOffset(){return this.byteOffset/(0,D.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,D.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(E){this._buffer.create(E),this._alignBuffer()}update(E){this._buffer.update(E),this._alignBuffer()}updateDirectly(E,U){let g=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(E,U,void 0,g),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(E,U){(0,D.d)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,E,this.normalized,((E,g)=>{for(let N=0;N<this._size;N++)U(E[N],g+N)}))}_alignBuffer(){}static DeduceStride(E){switch(E){case u.UVKind:case u.UV2Kind:case u.UV3Kind:case u.UV4Kind:case u.UV5Kind:case u.UV6Kind:return 2;case u.NormalKind:case u.PositionKind:return 3;case u.ColorKind:case u.ColorInstanceKind:case u.MatricesIndicesKind:case u.MatricesIndicesExtraKind:case u.MatricesWeightsKind:case u.MatricesWeightsExtraKind:case u.TangentKind:return 4;default:throw new Error("Invalid kind '"+E+"'")}}static GetDataType(E){return E instanceof Int8Array?u.BYTE:E instanceof Uint8Array?u.UNSIGNED_BYTE:E instanceof Int16Array?u.SHORT:E instanceof Uint16Array?u.UNSIGNED_SHORT:E instanceof Int32Array?u.INT:E instanceof Uint32Array?u.UNSIGNED_INT:u.FLOAT}static GetTypeByteLength(E){return(0,D.k)(E)}static ForEach(E,U,g,N,L,S,u,s){(0,D.d)(E,U,g,N,L,S,u,((E,U)=>{for(let g=0;g<N;g++)s(E[g],U+g)}))}static GetFloatData(E,U,g,N,L,S,u,s){return(0,D.h)(E,U,g,N,L,S,u,s)}}u._Counter=0,u.BYTE=5120,u.UNSIGNED_BYTE=5121,u.SHORT=5122,u.UNSIGNED_SHORT=5123,u.INT=5124,u.UNSIGNED_INT=5125,u.FLOAT=5126,u.PositionKind="position",u.NormalKind="normal",u.TangentKind="tangent",u.UVKind="uv",u.UV2Kind="uv2",u.UV3Kind="uv3",u.UV4Kind="uv4",u.UV5Kind="uv5",u.UV6Kind="uv6",u.ColorKind="color",u.ColorInstanceKind="instanceColor",u.MatricesIndicesKind="matricesIndices",u.MatricesWeightsKind="matricesWeights",u.MatricesIndicesExtraKind="matricesIndicesExtra",u.MatricesWeightsExtraKind="matricesWeightsExtra"},12418:(E,U,g)=>{g.d(U,{b:()=>F,c:()=>P,d:()=>s,h:()=>C,k:()=>S,n:()=>u,r:()=>B});var N=g(12186);function L(E,U,g,N){switch(U){case 5120:{let U=E.getInt8(g);return N&&(U=Math.max(U/127,-1)),U}case 5121:{let U=E.getUint8(g);return N&&(U/=255),U}case 5122:{let U=E.getInt16(g,!0);return N&&(U=Math.max(U/32767,-1)),U}case 5123:{let U=E.getUint16(g,!0);return N&&(U/=65535),U}case 5124:return E.getInt32(g,!0);case 5125:return E.getUint32(g,!0);case 5126:return E.getFloat32(g,!0);default:throw new Error(`Invalid component type ${U}`)}}function D(E,U,g,N,L){switch(U){case 5120:N&&(L=Math.round(127*L)),E.setInt8(g,L);break;case 5121:N&&(L=Math.round(255*L)),E.setUint8(g,L);break;case 5122:N&&(L=Math.round(32767*L)),E.setInt16(g,L,!0);break;case 5123:N&&(L=Math.round(65535*L)),E.setUint16(g,L,!0);break;case 5124:E.setInt32(g,L,!0);break;case 5125:E.setUint32(g,L,!0);break;case 5126:E.setFloat32(g,L,!0);break;default:throw new Error(`Invalid component type ${U}`)}}function S(E){switch(E){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${E}'`)}}function u(E){switch(E){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${E}'`)}}function s(E,U,g,N,u,s,C,B){const P=new Array(N),F=new Array(N);if(E instanceof Array){let L=U/4;const D=g/4;for(let U=0;U<s;U+=N){for(let U=0;U<N;U++)P[U]=F[U]=E[L+U];B(F,U);for(let U=0;U<N;U++)P[U]!==F[U]&&(E[L+U]=F[U]);L+=D}}else{const f=ArrayBuffer.isView(E)?new DataView(E.buffer,E.byteOffset,E.byteLength):new DataView(E),d=S(u);for(let E=0;E<s;E+=N){for(let E=0,g=U;E<N;E++,g+=d)P[E]=F[E]=L(f,u,g,C);B(F,E);for(let E=0,g=U;E<N;E++,g+=d)P[E]!==F[E]&&D(f,u,g,C,F[E]);U+=g}}}function C(E,U,g,L,D,u,C,B){const P=U*S(g),F=C*U;if(5126!==g||D!==P){const N=new Float32Array(F);return s(E,L,D,U,g,F,u,((E,g)=>{for(let L=0;L<U;L++)N[g+L]=E[L]})),N}if(!(E instanceof Array||E instanceof Float32Array)||0!==L||E.length!==F){if(E instanceof Array){const U=L/4;return E.slice(U,U+F)}if(E instanceof ArrayBuffer)return new Float32Array(E,L,F);{const U=E.byteOffset+L;return 0!==(3&U)&&(N.d.Warn("Float array must be aligned to 4-bytes border"),B=!0),B?new Float32Array(E.buffer.slice(U,U+F*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(E.buffer,U,F)}}return B?E.slice():E}function B(E,U,g,L,D,C,B,P){const F=S(g),f=u(g),d=B*U;if(Array.isArray(E)){if(0!==(3&L)||0!==(3&D))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const N=L/4,S=D/4;if(N+(B-1)*S+U>E.length)throw new Error("Last accessed index is out of bounds.");if(S<U)throw new Error("Data stride cannot be smaller than the component size.");if(S!==U){const N=new f(d);return s(E,L,D,U,g,d,C,((E,g)=>{for(let L=0;L<U;L++)N[g+L]=E[L]})),N}return new f(E.slice(N,N+d))}let I,y=L;E instanceof ArrayBuffer?I=E:(I=E.buffer,y+=E.byteOffset);if(y+(B-1)*D+U*F>I.byteLength)throw new Error("Last accessed byte is out of bounds.");const h=U*F;if(D<h)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(D!==h){const E=new f(d);return s(I,y,D,U,g,d,C,((g,N)=>{for(let L=0;L<U;L++)E[N+L]=g[L]})),E}return 1!==F&&0!==(y&F-1)&&(N.d.Warn("Array must be aligned to border of element size. Data will be copied."),P=!0),P?new f(I.slice(y,y+d*F)):new f(I,y,d)}function P(E,U,g,L,D,u,C,B){const P=U*S(g),F=C*U;if(B.length!==F)throw new Error("Output length is not valid");if(5126===g&&D===P)if(E instanceof Array){const U=L/4;B.set(E,U)}else if(E instanceof ArrayBuffer){const U=new Float32Array(E,L,F);B.set(U)}else{const U=E.byteOffset+L;if(0!==(3&U))return N.d.Warn("Float array must be aligned to 4-bytes border"),void B.set(new Float32Array(E.buffer.slice(U,U+F*Float32Array.BYTES_PER_ELEMENT)));const g=new Float32Array(E.buffer,U,F);B.set(g)}else s(E,L,D,U,g,F,u,((E,g)=>{for(let N=0;N<U;N++)B[g+N]=E[N]}))}function F(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(E)){for(let L=0;L<U;L++)if(E[g+L]-N>65535)return!0;return!1}return 4===E.BYTES_PER_ELEMENT}},12410:(E,U,g)=>{g.d(U,{d:()=>N});class N{get underlyingResource(){return null}constructor(){this.references=0,this.aU=0,this.is32Bits=!1,this.uniqueId=N._Counter++}}N._Counter=0},12450:(E,U,g)=>{g.d(U,{c:()=>L});var N=g(12234);class L{static GetEffect(E){return void 0===E.getPipelineContext?E.effect:E}constructor(E){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=E.createDrawContext(),U&&(this.materialContext=E.createMaterialContext())}setEffect(E,U){let g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var N;(this.effect=E,void 0!==U&&(this.defines=U),g)&&(null===(N=this.drawContext)||void 0===N||N.reset())}dispose(){var E;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const E=this.effect;U?E.dispose():N.c.SetImmediate((()=>{E.getEngine().onEndFrameObservable.addOnce((()=>{E.dispose()}))})),this.effect=null}null===(E=this.drawContext)||void 0===E||E.dispose()}}},12534:(E,U,g)=>{g.d(U,{c:()=>L});var N=g(12382);class L{static GetPlanes(E){const U=[];for(let g=0;g<6;g++)U.push(new N.c(0,0,0,0));return L.GetPlanesToRef(E,U),U}static GetNearPlaneToRef(E,U){const g=E.m;U.normal.x=g[3]+g[2],U.normal.y=g[7]+g[6],U.normal.z=g[11]+g[10],U.d=g[15]+g[14],U.normalize()}static GetFarPlaneToRef(E,U){const g=E.m;U.normal.x=g[3]-g[2],U.normal.y=g[7]-g[6],U.normal.z=g[11]-g[10],U.d=g[15]-g[14],U.normalize()}static GetLeftPlaneToRef(E,U){const g=E.m;U.normal.x=g[3]+g[0],U.normal.y=g[7]+g[4],U.normal.z=g[11]+g[8],U.d=g[15]+g[12],U.normalize()}static GetRightPlaneToRef(E,U){const g=E.m;U.normal.x=g[3]-g[0],U.normal.y=g[7]-g[4],U.normal.z=g[11]-g[8],U.d=g[15]-g[12],U.normalize()}static GetTopPlaneToRef(E,U){const g=E.m;U.normal.x=g[3]-g[1],U.normal.y=g[7]-g[5],U.normal.z=g[11]-g[9],U.d=g[15]-g[13],U.normalize()}static GetBottomPlaneToRef(E,U){const g=E.m;U.normal.x=g[3]+g[1],U.normal.y=g[7]+g[5],U.normal.z=g[11]+g[9],U.d=g[15]+g[13],U.normalize()}static GetPlanesToRef(E,U){L.GetNearPlaneToRef(E,U[0]),L.GetFarPlaneToRef(E,U[1]),L.GetLeftPlaneToRef(E,U[2]),L.GetRightPlaneToRef(E,U[3]),L.GetTopPlaneToRef(E,U[4]),L.GetBottomPlaneToRef(E,U[5])}static IsPointInFrustum(E,U){for(let g=0;g<6;g++)if(U[g].dotCoordinate(E)<0)return!1;return!0}}},12551:(E,U,g)=>{g.d(U,{e:()=>L});var N=g(12197);class L{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(E,U){L.Enabled&&(this._current+=E,U&&this._fetchResult())}beginMonitoring(){L.Enabled&&(this._startMonitoringTime=N.b.Now)}endMonitoring(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!L.Enabled)return;E&&this.fetchNewFrame();const U=N.b.Now;this._current=U-this._startMonitoringTime,E&&this._fetchResult()}Ig(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const E=N.b.Now;E-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=E,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}L.Enabled=!0},12422:(E,U,g)=>{g.d(U,{c:()=>L,e:()=>N});class N{constructor(E){this.length=0,this.data=new Array(E),this._id=N._GlobalId++}push(E){this.data[this.length++]=E,this.length>this.data.length&&(this.data.length*=2)}forEach(E){for(let U=0;U<this.length;U++)E(this.data[U])}sort(E){this.data.sort(E)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(E){if(0!==E.length){this.length+E.length>this.data.length&&(this.data.length=2*(this.length+E.length));for(let U=0;U<E.length;U++)this.data[this.length++]=(E.data||E)[U]}}indexOf(E){const U=this.data.indexOf(E);return U>=this.length?-1:U}contains(E){return-1!==this.indexOf(E)}}N._GlobalId=0;class L extends N{constructor(){super(...arguments),this._duplicateId=0}push(E){super.push(E),E.__smartArrayFlags||(E.__smartArrayFlags={}),E.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(E){return(!E.__smartArrayFlags||E.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(E),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(E){if(0!==E.length){this.length+E.length>this.data.length&&(this.data.length=2*(this.length+E.length));for(let U=0;U<E.length;U++){const g=(E.data||E)[U];this.pushNoDuplicate(g)}}}}},12399:(E,U,g)=>{g.d(U,{c:()=>D});var N=g(12407),L=g(12174);class D{constructor(E){this._vertexBuffers={},this.onBeforeRenderObservable=new L.b,this._scene=E}_prepareBuffers(){if(this._vertexBuffers[N.f.PositionKind])return;const E=[];E.push(1,1),E.push(-1,1),E.push(-1,-1),E.push(1,-1),this._vertexBuffers[N.f.PositionKind]=new N.f(this._scene.getEngine(),E,N.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const E=[];E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(E)}_rebuild(){const E=this._vertexBuffers[N.f.PositionKind];E&&(E._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const g=this._scene.activeCamera;return!!g&&(U=U||g._postProcesses.filter((E=>null!=E)),!(!U||0===U.length||!this._scene.postProcessesEnabled)&&(U[0].activate(g,E,null!==U&&void 0!==U),!0))}directRender(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:E.length;const u=this._scene.getEngine();for(let C=0;C<S;C++){var s;if(C<E.length-1)E[C+1].activate(this._scene.activeCamera||this._scene,null===U||void 0===U?void 0:U.texture);else U?u.bindFramebuffer(U,N,void 0,void 0,g,L):D||u.restoreDefaultFramebuffer(),null===(s=u._debugInsertMarker)||void 0===s||s.call(u,`post process ${E[C].name} output`);const S=E[C],B=S.apply();B&&(S.onBeforeRenderObservable.notifyObservers(B),this._prepareBuffers(),u.bindBuffers(this._vertexBuffers,this._indexBuffer,B),u.drawElementsType(0,0,6),S.onAfterRenderObservable.notifyObservers(B))}u.setDepthBuffer(!0),u.setDepthWrite(!0)}_finalizeFrame(E,U,g,N){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const D=this._scene.activeCamera;if(!D)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(N=N||D._postProcesses.filter((E=>null!=E))).length||!this._scene.postProcessesEnabled)return;const S=this._scene.getEngine();for(let s=0,C=N.length;s<C;s++){const B=N[s];var u;if(s<C-1)B._outputTexture=N[s+1].activate(D,null===U||void 0===U?void 0:U.texture);else U?(S.bindFramebuffer(U,g,void 0,void 0,L),B._outputTexture=U):(S.restoreDefaultFramebuffer(),B._outputTexture=null),null===(u=S._debugInsertMarker)||void 0===u||u.call(S,`post process ${N[s].name} output`);if(E)break;const P=B.apply();P&&(B.onBeforeRenderObservable.notifyObservers(P),this._prepareBuffers(),S.bindBuffers(this._vertexBuffers,this._indexBuffer,P),S.drawElementsType(0,0,6),B.onAfterRenderObservable.notifyObservers(P))}S.setDepthBuffer(!0),S.setDepthWrite(!0),S.setAlphaMode(0)}dispose(){const E=this._vertexBuffers[N.f.PositionKind];E&&(E.dispose(),this._vertexBuffers[N.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12420:(E,U,g)=>{g.d(U,{d:()=>u});var N=g(12422),L=g(12334);class D{set opaqueSortCompareFn(E){this._opaqueSortCompareFn=E||D.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(E){this._alphaTestSortCompareFn=E||D.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(E){this._transparentSortCompareFn=E||D.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(E,U){let g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=E,this._opaqueSubMeshes=new N.e(256),this._transparentSubMeshes=new N.e(256),this._alphaTestSubMeshes=new N.e(256),this._depthOnlySubMeshes=new N.e(256),this._particleSystems=new N.e(256),this._spriteManagers=new N.e(256),this._empty=!0,this._edgesRenderers=new N.c(16),this._scene=U,this.opaqueSortCompareFn=g,this.alphaTestSortCompareFn=L,this.transparentSortCompareFn=D}render(E,U,g,N){if(E)return void E(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const L=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(L.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),L.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const D=L.getStencilBuffer();if(L.setStencilBuffer(!1),U&&this._renderSprites(),g&&this._renderParticles(N),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(L.setStencilBuffer(D),this._scene.useOrderIndependentTransparency){const E=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);E.length&&this._renderTransparent(E)}else this._renderTransparent(this._transparentSubMeshes);L.setAlphaMode(0)}if(L.setStencilBuffer(!1),this._edgesRenderers.length){for(let E=0;E<this._edgesRenderers.length;E++)this._edgesRenderers.data[E].render();L.setAlphaMode(0)}L.setStencilBuffer(D)}_renderOpaqueSorted(E){D._RenderSorted(E,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(E){D._RenderSorted(E,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(E){D._RenderSorted(E,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(E,U,g,N){let S,u=0;const s=g?g.globalPosition:D._ZeroVector;if(N)for(;u<E.length;u++)S=E.data[u],S._alphaIndex=S.getMesh().alphaIndex,S._distanceToCamera=L.dU.Distance(S.getBoundingInfo().boundingSphere.centerWorld,s);const C=E.length===E.data.length?E.data:E.data.slice(0,E.length);U&&C.sort(U);const B=C[0].getMesh().tE();for(u=0;u<C.length;u++)if(S=C[u],!B._activeMeshesFrozenButKeepClipping||S.isInFrustum(B._frustumPlanes)){if(N){const E=S.aE();if(E&&E.needDepthPrePass){const U=E.tE().getEngine();U.setColorWrite(!1),U.setAlphaMode(0),S.render(!1),U.setColorWrite(!0)}}S.render(N)}}static defaultTransparentSortCompare(E,U){return E._alphaIndex>U._alphaIndex?1:E._alphaIndex<U._alphaIndex?-1:D.backToFrontSortCompare(E,U)}static backToFrontSortCompare(E,U){return E._distanceToCamera<U._distanceToCamera?1:E._distanceToCamera>U._distanceToCamera?-1:0}static frontToBackSortCompare(E,U){return E._distanceToCamera<U._distanceToCamera?-1:E._distanceToCamera>U._distanceToCamera?1:0}static PainterSortCompare(E,U){const g=E.getMesh(),N=U.getMesh();return g.material&&N.material?g.material.uniqueId-N.material.uniqueId:g.uniqueId-N.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(E,U,g){void 0===U&&(U=E.getMesh()),void 0===g&&(g=E.aE()),null!==g&&void 0!==g&&(g.needAlphaBlendingForMesh(U)?this._transparentSubMeshes.push(E):g.needAlphaTestingForMesh(U)?(g.needDepthPrePass&&this._depthOnlySubMeshes.push(E),this._alphaTestSubMeshes.push(E)):(g.needDepthPrePass&&this._depthOnlySubMeshes.push(E),this._opaqueSubMeshes.push(E)),U._renderingGroup=this,U._edgesRenderer&&U.isEnabled()&&U.isVisible&&U._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(U._edgesRenderer),this._empty=!1)}dispatchSprites(E){this._spriteManagers.push(E),this._empty=!1}dispatchParticles(E){this._particleSystems.push(E),this._empty=!1}_renderParticles(E){if(0===this._particleSystems.length)return;const U=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let g=0;g<this._particleSystems.length;g++){const N=this._particleSystems.data[g];if(0===(U&&U.layerMask&N.layerMask))continue;const L=N.NU;L.position&&E&&-1===E.indexOf(L)||this._scene._activeParticles.addCount(N.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const E=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let U=0;U<this._spriteManagers.length;U++){const g=this._spriteManagers.data[U];0!==(E&&E.layerMask&g.layerMask)&&g.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}D._ZeroVector=L.dU.Zero();class S{}class u{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(E){E!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=E,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const E of this._scene.meshes)if(E.Wg)for(const U of E.Wg)U._wasDispatched=!1;if(this._scene.spriteManagers)for(const E of this._scene.spriteManagers)E._wasDispatched=!1;for(const E of this._scene.RP)E._wasDispatched=!1}constructor(E){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new S,this._maintainStateBetweenFrames=!1,this._scene=E;for(let U=u.MIN_RENDERINGGROUPS;U<u.MAX_RENDERINGGROUPS;U++)this._autoClearDepthStencil[U]={Mg:!0,depth:!0,Vg:!0}}getRenderingGroup(E){const U=E||0;return this._prepareRenderingGroup(U),this._renderingGroups[U]}_clearDepthStencilBuffer(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,E,U),this._depthStencilBufferAlreadyCleaned=!0)}render(E,U,g,N){const L=this._renderingGroupInfo;if(L.yU=this._scene,L.camera=this._scene.activeCamera,L.renderingManager=this,this._scene.spriteManagers&&N)for(let D=0;D<this._scene.spriteManagers.length;D++){const E=this._scene.spriteManagers[D];this.dispatchSprites(E)}for(let D=u.MIN_RENDERINGGROUPS;D<u.MAX_RENDERINGGROUPS;D++){this._depthStencilBufferAlreadyCleaned=D===u.MIN_RENDERINGGROUPS;const S=this._renderingGroups[D];if(!S||S._empty)continue;const s=1<<D;if(L.renderingGroupId=D,this._scene.onBeforeRenderingGroupObservable.notifyObservers(L,s),u.AUTOCLEAR){const E=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(D):this._autoClearDepthStencil[D];E&&E.Mg&&this._clearDepthStencilBuffer(E.depth,E.Vg)}for(const E of this._scene._beforeRenderingGroupDrawStage)E.action(D);S.render(E,N,g,U);for(const E of this._scene._afterRenderingGroupDrawStage)E.action(D);this._scene.onAfterRenderingGroupObservable.notifyObservers(L,s)}}reset(){if(!this.maintainStateBetweenFrames)for(let E=u.MIN_RENDERINGGROUPS;E<u.MAX_RENDERINGGROUPS;E++){const U=this._renderingGroups[E];U&&U.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let E=u.MIN_RENDERINGGROUPS;E<u.MAX_RENDERINGGROUPS;E++){const U=this._renderingGroups[E];U&&U.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let E=u.MIN_RENDERINGGROUPS;E<u.MAX_RENDERINGGROUPS;E++){const U=this._renderingGroups[E];U&&U.dispose()}}_prepareRenderingGroup(E){void 0===this._renderingGroups[E]&&(this._renderingGroups[E]=new D(E,this._scene,this._customOpaqueSortCompareFn[E],this._customAlphaTestSortCompareFn[E],this._customTransparentSortCompareFn[E]))}dispatchSprites(E){this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatchSprites(E))}dispatchParticles(E){this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatchParticles(E))}dispatch(E,U,g){void 0===U&&(U=E.getMesh()),this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatch(E,U,g))}setRenderingOrder(E){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[E]=U,this._customAlphaTestSortCompareFn[E]=g,this._customTransparentSortCompareFn[E]=N,this._renderingGroups[E]){const U=this._renderingGroups[E];U.opaqueSortCompareFn=this._customOpaqueSortCompareFn[E],U.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[E],U.transparentSortCompareFn=this._customTransparentSortCompareFn[E]}}setRenderingAutoClearDepthStencil(E,U){let g=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[E]={Mg:U,depth:g,Vg:N}}getAutoClearDepthStencilSetup(E){return this._autoClearDepthStencil[E]}}u.MAX_RENDERINGGROUPS=4,u.MIN_RENDERINGGROUPS=0,u.AUTOCLEAR=!0}}]);