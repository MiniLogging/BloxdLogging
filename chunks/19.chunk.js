"use strict";(self.h66iwo8dvgq=self.h66iwo8dvgq||[]).push([[19],{11912:(b,X,P)=>{P.d(X,{c:()=>N,g:()=>a});var Q=P(11916),S=P(11700),d=P(11918);class N{get Y(){return this._isDisposed}constructor(b,X,P){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7?arguments[7]:void 0,w=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,b&&b.Ab?this._engine=b.Ab().getEngine():this._engine=b,this._updatable=P,this._instanced=N,this._divisor=u||1,this._label=w,X instanceof Q.c?(this._data=null,this._buffer=X):(this._data=X,this._buffer=null),this.byteStride=a?S:S*Float32Array.BYTES_PER_ELEMENT,d||this.create()}createVertexBuffer(b,X,P,Q,S){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6?arguments[6]:void 0;const u=d?X:X*Float32Array.BYTES_PER_ELEMENT,w=Q?d?Q:Q*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new a(this._engine,this,b,this._updatable,!0,w,void 0===S?this._instanced:S,u,P,void 0,void 0,!0,this._divisor||N)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!b&&this._buffer||(b=b||this._data,b&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b),this._data=b):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(b,this._label),this._data=b):this._buffer=this._engine.createVertexBuffer(b,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.zX>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.zX,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.zX,void 0,this._label));S.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(b){this.create(b)}updateDirectly(b,X,P){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,b,Q?X:X*Float32Array.BYTES_PER_ELEMENT,P?P*this.byteStride:void 0),this._data=0===X&&void 0===P?b:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class a{get Y(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(b){const X=0!=b;this._instanceDivisor=b,X!==this._instanced&&(this._instanced=X,this._computeHashCode())}get _maxVerticesCount(){const b=this.getData();return b?Array.isArray(b)?b.length/(this.byteStride/4)-this.byteOffset/4:(b.byteLength-this.byteOffset)/this.byteStride:0}constructor(b,X,P,Q,S,u,w,f,O,e){let Y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],D=arguments.length>11&&void 0!==arguments[11]&&arguments[11],E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,t=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let B=!1;if(this.EX=b,"object"===typeof Q&&null!==Q?(B=Q.updatable??!1,S=Q.postponeInternalCreation,u=Q.stride,w=Q.instanced,f=Q.offset,O=Q.size,e=Q.type,Y=Q.normalized??!1,D=Q.useBytes??!1,E=Q.divisor??1,t=Q.takeBufferOwnership??!1,this._label=Q.label):B=!!Q,X instanceof N?(this._buffer=X,this._ownsBuffer=t):(this._buffer=new N(b,X,B,u,S,w,D,E,this._label),this._ownsBuffer=!0),this.uniqueId=a._Counter++,this._kind=P,void 0===e){const b=this.getData();this.type=b?a.GetDataType(b):a.FLOAT}else this.type=e;const W=(0,d.o)(this.type);D?(this._size=O||(u?u/W:a.DeduceStride(P)),this.byteStride=u||this._buffer.byteStride||this._size*W,this.byteOffset=f||0):(this._size=O||u||a.DeduceStride(P),this.byteStride=u?u*W:this._buffer.byteStride||this._size*W,this.byteOffset=(f||0)*W),this.normalized=Y,this._instanced=void 0!==w&&w,this._instanceDivisor=w?E:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var b;null===(b=this._buffer)||void 0===b||b._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(b,X){const P=this.getData();return P?(0,d.k)(P,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,b,X):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,d.o)(this.type)}getOffset(){return this.byteOffset/(0,d.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,d.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(b){this._buffer.create(b),this._alignBuffer()}update(b){this._buffer.update(b),this._alignBuffer()}updateDirectly(b,X){let P=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(b,X,void 0,P),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(b,X){(0,d.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,b,this.normalized,((b,P)=>{for(let Q=0;Q<this._size;Q++)X(b[Q],P+Q)}))}_alignBuffer(){}static DeduceStride(b){switch(b){case a.UVKind:case a.UV2Kind:case a.UV3Kind:case a.UV4Kind:case a.UV5Kind:case a.UV6Kind:return 2;case a.NormalKind:case a.PositionKind:return 3;case a.ColorKind:case a.ColorInstanceKind:case a.MatricesIndicesKind:case a.MatricesIndicesExtraKind:case a.MatricesWeightsKind:case a.MatricesWeightsExtraKind:case a.TangentKind:return 4;default:throw new Error("Invalid kind '"+b+"'")}}static GetDataType(b){return b instanceof Int8Array?a.BYTE:b instanceof Uint8Array?a.UNSIGNED_BYTE:b instanceof Int16Array?a.SHORT:b instanceof Uint16Array?a.UNSIGNED_SHORT:b instanceof Int32Array?a.INT:b instanceof Uint32Array?a.UNSIGNED_INT:a.FLOAT}static GetTypeByteLength(b){return(0,d.o)(b)}static ForEach(b,X,P,Q,S,N,a,u){(0,d.j)(b,X,P,Q,S,N,a,((b,X)=>{for(let P=0;P<Q;P++)u(b[P],X+P)}))}static GetFloatData(b,X,P,Q,S,N,a,u){return(0,d.k)(b,X,P,Q,S,N,a,u)}}a._Counter=0,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="normal",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra"},11918:(b,X,P)=>{P.d(X,{c:()=>e,f:()=>O,j:()=>u,k:()=>w,o:()=>N,r:()=>a,v:()=>f});var Q=P(11700);function S(b,X,P,Q){switch(X){case 5120:{let X=b.getInt8(P);return Q&&(X=Math.max(X/127,-1)),X}case 5121:{let X=b.getUint8(P);return Q&&(X/=255),X}case 5122:{let X=b.getInt16(P,!0);return Q&&(X=Math.max(X/32767,-1)),X}case 5123:{let X=b.getUint16(P,!0);return Q&&(X/=65535),X}case 5124:return b.getInt32(P,!0);case 5125:return b.getUint32(P,!0);case 5126:return b.getFloat32(P,!0);default:throw new Error(`Invalid component type ${X}`)}}function d(b,X,P,Q,S){switch(X){case 5120:Q&&(S=Math.round(127*S)),b.setInt8(P,S);break;case 5121:Q&&(S=Math.round(255*S)),b.setUint8(P,S);break;case 5122:Q&&(S=Math.round(32767*S)),b.setInt16(P,S,!0);break;case 5123:Q&&(S=Math.round(65535*S)),b.setUint16(P,S,!0);break;case 5124:b.setInt32(P,S,!0);break;case 5125:b.setUint32(P,S,!0);break;case 5126:b.setFloat32(P,S,!0);break;default:throw new Error(`Invalid component type ${X}`)}}function N(b){switch(b){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${b}'`)}}function a(b){switch(b){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${b}'`)}}function u(b,X,P,Q,a,u,w,f){const O=new Array(Q),e=new Array(Q);if(b instanceof Array){let S=X/4;const d=P/4;for(let X=0;X<u;X+=Q){for(let X=0;X<Q;X++)O[X]=e[X]=b[S+X];f(e,X);for(let X=0;X<Q;X++)O[X]!==e[X]&&(b[S+X]=e[X]);S+=d}}else{const Y=ArrayBuffer.isView(b)?new DataView(b.buffer,b.byteOffset,b.byteLength):new DataView(b),D=N(a);for(let b=0;b<u;b+=Q){for(let b=0,P=X;b<Q;b++,P+=D)O[b]=e[b]=S(Y,a,P,w);f(e,b);for(let b=0,P=X;b<Q;b++,P+=D)O[b]!==e[b]&&d(Y,a,P,w,e[b]);X+=P}}}function w(b,X,P,S,d,a,w,f){const O=X*N(P),e=w*X;if(5126!==P||d!==O){const Q=new Float32Array(e);return u(b,S,d,X,P,e,a,((b,P)=>{for(let S=0;S<X;S++)Q[P+S]=b[S]})),Q}if(!(b instanceof Array||b instanceof Float32Array)||0!==S||b.length!==e){if(b instanceof Array){const X=S/4;return b.slice(X,X+e)}if(b instanceof ArrayBuffer)return new Float32Array(b,S,e);{const X=b.byteOffset+S;return 0!==(3&X)&&(Q.b.Warn("Float array must be aligned to 4-bytes border"),f=!0),f?new Float32Array(b.buffer.slice(X,X+e*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(b.buffer,X,e)}}return f?b.slice():b}function f(b,X,P,S,d,w,f,O){const e=N(P),Y=a(P),D=f*X;if(Array.isArray(b)){if(0!==(3&S)||0!==(3&d))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const Q=S/4,N=d/4;if(Q+(f-1)*N+X>b.length)throw new Error("Last accessed index is out of bounds.");if(N<X)throw new Error("Data stride cannot be smaller than the component size.");if(N!==X){const Q=new Y(D);return u(b,S,d,X,P,D,w,((b,P)=>{for(let S=0;S<X;S++)Q[P+S]=b[S]})),Q}return new Y(b.slice(Q,Q+D))}let E,t=S;b instanceof ArrayBuffer?E=b:(E=b.buffer,t+=b.byteOffset);if(t+(f-1)*d+X*e>E.byteLength)throw new Error("Last accessed byte is out of bounds.");const B=X*e;if(d<B)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(d!==B){const b=new Y(D);return u(E,t,d,X,P,D,w,((P,Q)=>{for(let S=0;S<X;S++)b[Q+S]=P[S]})),b}return 1!==e&&0!==(t&e-1)&&(Q.b.Warn("Array must be aligned to border of element size. Data will be copied."),O=!0),O?new Y(E.slice(t,t+D*e)):new Y(E,t,D)}function O(b,X,P,S,d,a,w,f){const O=X*N(P),e=w*X;if(f.length!==e)throw new Error("Output length is not valid");if(5126===P&&d===O)if(b instanceof Array){const X=S/4;f.set(b,X)}else if(b instanceof ArrayBuffer){const X=new Float32Array(b,S,e);f.set(X)}else{const X=b.byteOffset+S;if(0!==(3&X))return Q.b.Warn("Float array must be aligned to 4-bytes border"),void f.set(new Float32Array(b.buffer.slice(X,X+e*Float32Array.BYTES_PER_ELEMENT)));const P=new Float32Array(b.buffer,X,e);f.set(P)}else u(b,S,d,X,P,e,a,((b,P)=>{for(let Q=0;Q<X;Q++)f[P+Q]=b[Q]}))}function e(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(b)){for(let S=0;S<X;S++)if(b[P+S]-Q>65535)return!0;return!1}return 4===b.BYTES_PER_ELEMENT}},11916:(b,X,P)=>{P.d(X,{c:()=>Q});class Q{get underlyingResource(){return null}constructor(){this.references=0,this.zX=0,this.is32Bits=!1,this.uniqueId=Q._Counter++}}Q._Counter=0},11959:(b,X,P)=>{P.d(X,{b:()=>S});var Q=P(11755);class S{static GetEffect(b){return void 0===b.getPipelineContext?b.effect:b}constructor(b){let X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=b.createDrawContext(),X&&(this.materialContext=b.createMaterialContext())}setEffect(b,X){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var Q;(this.effect=b,void 0!==X&&(this.defines=X),P)&&(null===(Q=this.drawContext)||void 0===Q||Q.reset())}dispose(){var b;let X=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const b=this.effect;X?b.dispose():Q.b.SetImmediate((()=>{b.getEngine().onEndFrameObservable.addOnce((()=>{b.dispose()}))})),this.effect=null}null===(b=this.drawContext)||void 0===b||b.dispose()}}},12051:(b,X,P)=>{P.d(X,{c:()=>S});var Q=P(11887);class S{static GetPlanes(b){const X=[];for(let P=0;P<6;P++)X.push(new Q.c(0,0,0,0));return S.GetPlanesToRef(b,X),X}static GetNearPlaneToRef(b,X){const P=b.m;X.normal.x=P[3]+P[2],X.normal.y=P[7]+P[6],X.normal.z=P[11]+P[10],X.d=P[15]+P[14],X.normalize()}static GetFarPlaneToRef(b,X){const P=b.m;X.normal.x=P[3]-P[2],X.normal.y=P[7]-P[6],X.normal.z=P[11]-P[10],X.d=P[15]-P[14],X.normalize()}static GetLeftPlaneToRef(b,X){const P=b.m;X.normal.x=P[3]+P[0],X.normal.y=P[7]+P[4],X.normal.z=P[11]+P[8],X.d=P[15]+P[12],X.normalize()}static GetRightPlaneToRef(b,X){const P=b.m;X.normal.x=P[3]-P[0],X.normal.y=P[7]-P[4],X.normal.z=P[11]-P[8],X.d=P[15]-P[12],X.normalize()}static GetTopPlaneToRef(b,X){const P=b.m;X.normal.x=P[3]-P[1],X.normal.y=P[7]-P[5],X.normal.z=P[11]-P[9],X.d=P[15]-P[13],X.normalize()}static GetBottomPlaneToRef(b,X){const P=b.m;X.normal.x=P[3]+P[1],X.normal.y=P[7]+P[5],X.normal.z=P[11]+P[9],X.d=P[15]+P[13],X.normalize()}static GetPlanesToRef(b,X){S.GetNearPlaneToRef(b,X[0]),S.GetFarPlaneToRef(b,X[1]),S.GetLeftPlaneToRef(b,X[2]),S.GetRightPlaneToRef(b,X[3]),S.GetTopPlaneToRef(b,X[4]),S.GetBottomPlaneToRef(b,X[5])}static IsPointInFrustum(b,X){for(let P=0;P<6;P++)if(X[P].dotCoordinate(b)<0)return!1;return!0}}},12066:(b,X,P)=>{P.d(X,{c:()=>S});var Q=P(11713);class S{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(b,X){S.Enabled&&(this._current+=b,X&&this._fetchResult())}beginMonitoring(){S.Enabled&&(this._startMonitoringTime=Q.e.Now)}endMonitoring(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!S.Enabled)return;b&&this.fetchNewFrame();const X=Q.e.Now;this._current=X-this._startMonitoringTime,b&&this._fetchResult()}dd(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const b=Q.e.Now;b-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=b,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}S.Enabled=!0},11934:(b,X,P)=>{P.d(X,{e:()=>S,h:()=>Q});class Q{constructor(b){this.length=0,this.data=new Array(b),this._id=Q._GlobalId++}push(b){this.data[this.length++]=b,this.length>this.data.length&&(this.data.length*=2)}forEach(b){for(let X=0;X<this.length;X++)b(this.data[X])}sort(b){this.data.sort(b)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(let X=0;X<b.length;X++)this.data[this.length++]=(b.data||b)[X]}}indexOf(b){const X=this.data.indexOf(b);return X>=this.length?-1:X}contains(b){return-1!==this.indexOf(b)}}Q._GlobalId=0;class S extends Q{constructor(){super(...arguments),this._duplicateId=0}push(b){super.push(b),b.__smartArrayFlags||(b.__smartArrayFlags={}),b.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(b){return(!b.__smartArrayFlags||b.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(b),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(b){if(0!==b.length){this.length+b.length>this.data.length&&(this.data.length=2*(this.length+b.length));for(let X=0;X<b.length;X++){const P=(b.data||b)[X];this.pushNoDuplicate(P)}}}}},11908:(b,X,P)=>{P.d(X,{e:()=>d});var Q=P(11912),S=P(11694);class d{constructor(b){this._vertexBuffers={},this.onBeforeRenderObservable=new S.d,this._scene=b}_prepareBuffers(){if(this._vertexBuffers[Q.g.PositionKind])return;const b=[];b.push(1,1),b.push(-1,1),b.push(-1,-1),b.push(1,-1),this._vertexBuffers[Q.g.PositionKind]=new Q.g(this._scene.getEngine(),b,Q.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const b=[];b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(b)}_rebuild(){const b=this._vertexBuffers[Q.g.PositionKind];b&&(b._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const P=this._scene.activeCamera;return!!P&&(X=X||P._postProcesses.filter((b=>null!=b)),!(!X||0===X.length||!this._scene.postProcessesEnabled)&&(X[0].activate(P,b,null!==X&&void 0!==X),!0))}directRender(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,S=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:b.length;const a=this._scene.getEngine();for(let w=0;w<N;w++){var u;if(w<b.length-1)b[w+1].activate(this._scene.activeCamera||this._scene,null===X||void 0===X?void 0:X.texture);else X?a.bindFramebuffer(X,Q,void 0,void 0,P,S):d||a.restoreDefaultFramebuffer(),null===(u=a._debugInsertMarker)||void 0===u||u.call(a,`post process ${b[w].name} output`);const N=b[w],f=N.apply();f&&(N.onBeforeRenderObservable.notifyObservers(f),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,f),a.drawElementsType(0,0,6),N.onAfterRenderObservable.notifyObservers(f))}a.setDepthBuffer(!0),a.setDepthWrite(!0)}_finalizeFrame(b,X,P,Q){let S=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=this._scene.activeCamera;if(!d)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(Q=Q||d._postProcesses.filter((b=>null!=b))).length||!this._scene.postProcessesEnabled)return;const N=this._scene.getEngine();for(let u=0,w=Q.length;u<w;u++){const f=Q[u];var a;if(u<w-1)f._outputTexture=Q[u+1].activate(d,null===X||void 0===X?void 0:X.texture);else X?(N.bindFramebuffer(X,P,void 0,void 0,S),f._outputTexture=X):(N.restoreDefaultFramebuffer(),f._outputTexture=null),null===(a=N._debugInsertMarker)||void 0===a||a.call(N,`post process ${Q[u].name} output`);if(b)break;const O=f.apply();O&&(f.onBeforeRenderObservable.notifyObservers(O),this._prepareBuffers(),N.bindBuffers(this._vertexBuffers,this._indexBuffer,O),N.drawElementsType(0,0,6),f.onAfterRenderObservable.notifyObservers(O))}N.setDepthBuffer(!0),N.setDepthWrite(!0),N.setAlphaMode(0)}dispose(){const b=this._vertexBuffers[Q.g.PositionKind];b&&(b.dispose(),this._vertexBuffers[Q.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11926:(b,X,P)=>{P.d(X,{d:()=>a});var Q=P(11934),S=P(11834);class d{set opaqueSortCompareFn(b){this._opaqueSortCompareFn=b||d.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(b){this._alphaTestSortCompareFn=b||d.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(b){this._transparentSortCompareFn=b||d.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(b,X){let P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=b,this._opaqueSubMeshes=new Q.h(256),this._transparentSubMeshes=new Q.h(256),this._alphaTestSubMeshes=new Q.h(256),this._depthOnlySubMeshes=new Q.h(256),this._particleSystems=new Q.h(256),this._spriteManagers=new Q.h(256),this._empty=!0,this._edgesRenderers=new Q.e(16),this._scene=X,this.opaqueSortCompareFn=P,this.alphaTestSortCompareFn=S,this.transparentSortCompareFn=d}render(b,X,P,Q){if(b)return void b(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const S=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(S.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),S.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const d=S.getStencilBuffer();if(S.setStencilBuffer(!1),X&&this._renderSprites(),P&&this._renderParticles(Q),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(S.setStencilBuffer(d),this._scene.useOrderIndependentTransparency){const b=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);b.length&&this._renderTransparent(b)}else this._renderTransparent(this._transparentSubMeshes);S.setAlphaMode(0)}if(S.setStencilBuffer(!1),this._edgesRenderers.length){for(let b=0;b<this._edgesRenderers.length;b++)this._edgesRenderers.data[b].render();S.setAlphaMode(0)}S.setStencilBuffer(d)}_renderOpaqueSorted(b){d._RenderSorted(b,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(b){d._RenderSorted(b,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(b){d._RenderSorted(b,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(b,X,P,Q){let N,a=0;const u=P?P.globalPosition:d._ZeroVector;if(Q)for(;a<b.length;a++)N=b.data[a],N._alphaIndex=N.getMesh().alphaIndex,N._distanceToCamera=S.tX.Distance(N.getBoundingInfo().boundingSphere.centerWorld,u);const w=b.length===b.data.length?b.data:b.data.slice(0,b.length);X&&w.sort(X);const f=w[0].getMesh().Ab();for(a=0;a<w.length;a++)if(N=w[a],!f._activeMeshesFrozenButKeepClipping||N.isInFrustum(f._frustumPlanes)){if(Q){const b=N.zb();if(b&&b.needDepthPrePass){const X=b.Ab().getEngine();X.setColorWrite(!1),X.setAlphaMode(0),N.render(!1),X.setColorWrite(!0)}}N.render(Q)}}static defaultTransparentSortCompare(b,X){return b._alphaIndex>X._alphaIndex?1:b._alphaIndex<X._alphaIndex?-1:d.backToFrontSortCompare(b,X)}static backToFrontSortCompare(b,X){return b._distanceToCamera<X._distanceToCamera?1:b._distanceToCamera>X._distanceToCamera?-1:0}static frontToBackSortCompare(b,X){return b._distanceToCamera<X._distanceToCamera?-1:b._distanceToCamera>X._distanceToCamera?1:0}static PainterSortCompare(b,X){const P=b.getMesh(),Q=X.getMesh();return P.material&&Q.material?P.material.uniqueId-Q.material.uniqueId:P.uniqueId-Q.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(b,X,P){void 0===X&&(X=b.getMesh()),void 0===P&&(P=b.zb()),null!==P&&void 0!==P&&(P.needAlphaBlendingForMesh(X)?this._transparentSubMeshes.push(b):P.needAlphaTestingForMesh(X)?(P.needDepthPrePass&&this._depthOnlySubMeshes.push(b),this._alphaTestSubMeshes.push(b)):(P.needDepthPrePass&&this._depthOnlySubMeshes.push(b),this._opaqueSubMeshes.push(b)),X._renderingGroup=this,X._edgesRenderer&&X.isEnabled()&&X.isVisible&&X._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(X._edgesRenderer),this._empty=!1)}dispatchSprites(b){this._spriteManagers.push(b),this._empty=!1}dispatchParticles(b){this._particleSystems.push(b),this._empty=!1}_renderParticles(b){if(0===this._particleSystems.length)return;const X=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let P=0;P<this._particleSystems.length;P++){const Q=this._particleSystems.data[P];if(0===(X&&X.layerMask&Q.layerMask))continue;const S=Q.dX;S.position&&b&&-1===b.indexOf(S)||this._scene._activeParticles.addCount(Q.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const b=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let X=0;X<this._spriteManagers.length;X++){const P=this._spriteManagers.data[X];0!==(b&&b.layerMask&P.layerMask)&&P.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}d._ZeroVector=S.tX.Zero();class N{}class a{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(b){b!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=b,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const b of this._scene.meshes)if(b.hd)for(const X of b.hd)X._wasDispatched=!1;if(this._scene.spriteManagers)for(const b of this._scene.spriteManagers)b._wasDispatched=!1;for(const b of this._scene.Oe)b._wasDispatched=!1}constructor(b){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new N,this._maintainStateBetweenFrames=!1,this._scene=b;for(let X=a.MIN_RENDERINGGROUPS;X<a.MAX_RENDERINGGROUPS;X++)this._autoClearDepthStencil[X]={nd:!0,depth:!0,stencil:!0}}getRenderingGroup(b){const X=b||0;return this._prepareRenderingGroup(X),this._renderingGroups[X]}_clearDepthStencilBuffer(){let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],X=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,b,X),this._depthStencilBufferAlreadyCleaned=!0)}render(b,X,P,Q){const S=this._renderingGroupInfo;if(S.WX=this._scene,S.camera=this._scene.activeCamera,S.renderingManager=this,this._scene.spriteManagers&&Q)for(let d=0;d<this._scene.spriteManagers.length;d++){const b=this._scene.spriteManagers[d];this.dispatchSprites(b)}for(let d=a.MIN_RENDERINGGROUPS;d<a.MAX_RENDERINGGROUPS;d++){this._depthStencilBufferAlreadyCleaned=d===a.MIN_RENDERINGGROUPS;const N=this._renderingGroups[d];if(!N||N._empty)continue;const u=1<<d;if(S.renderingGroupId=d,this._scene.onBeforeRenderingGroupObservable.notifyObservers(S,u),a.AUTOCLEAR){const b=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(d):this._autoClearDepthStencil[d];b&&b.nd&&this._clearDepthStencilBuffer(b.depth,b.stencil)}for(const b of this._scene._beforeRenderingGroupDrawStage)b.action(d);N.render(b,Q,P,X);for(const b of this._scene._afterRenderingGroupDrawStage)b.action(d);this._scene.onAfterRenderingGroupObservable.notifyObservers(S,u)}}reset(){if(!this.maintainStateBetweenFrames)for(let b=a.MIN_RENDERINGGROUPS;b<a.MAX_RENDERINGGROUPS;b++){const X=this._renderingGroups[b];X&&X.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let b=a.MIN_RENDERINGGROUPS;b<a.MAX_RENDERINGGROUPS;b++){const X=this._renderingGroups[b];X&&X.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let b=a.MIN_RENDERINGGROUPS;b<a.MAX_RENDERINGGROUPS;b++){const X=this._renderingGroups[b];X&&X.dispose()}}_prepareRenderingGroup(b){void 0===this._renderingGroups[b]&&(this._renderingGroups[b]=new d(b,this._scene,this._customOpaqueSortCompareFn[b],this._customAlphaTestSortCompareFn[b],this._customTransparentSortCompareFn[b]))}dispatchSprites(b){this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatchSprites(b))}dispatchParticles(b){this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatchParticles(b))}dispatch(b,X,P){void 0===X&&(X=b.getMesh()),this.maintainStateBetweenFrames&&b._wasDispatched||(b._wasDispatched=!0,this.getRenderingGroup(X.renderingGroupId).dispatch(b,X,P))}setRenderingOrder(b){let X=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,P=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[b]=X,this._customAlphaTestSortCompareFn[b]=P,this._customTransparentSortCompareFn[b]=Q,this._renderingGroups[b]){const X=this._renderingGroups[b];X.opaqueSortCompareFn=this._customOpaqueSortCompareFn[b],X.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[b],X.transparentSortCompareFn=this._customTransparentSortCompareFn[b]}}setRenderingAutoClearDepthStencil(b,X){let P=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[b]={nd:X,depth:P,stencil:Q}}getAutoClearDepthStencilSetup(b){return this._autoClearDepthStencil[b]}}a.MAX_RENDERINGGROUPS=4,a.MIN_RENDERINGGROUPS=0,a.AUTOCLEAR=!0}}]);