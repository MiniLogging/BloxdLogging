"use strict";(self.n52dyox90qa=self.n52dyox90qa||[]).push([[19],{11894:(E,t,z)=>{z.d(t,{b:()=>u,f:()=>p});var A=z(11899),X=z(11640),R=z(11907);class u{get C(){return this._isDisposed}constructor(E,t,z){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,R=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0,Z=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,E&&E.lE?this._engine=E.lE().getEngine():this._engine=E,this._updatable=z,this._instanced=u,this._divisor=C||1,this._label=Z,t instanceof A.e?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=p?X:X*Float32Array.BYTES_PER_ELEMENT,R||this.create()}createVertexBuffer(E,t,z,A,X){let R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6?arguments[6]:void 0;const C=R?t:t*Float32Array.BYTES_PER_ELEMENT,Z=A?R?A:A*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new p(this._engine,this,E,this._updatable,!0,Z,void 0===X?this._instanced:X,C,z,void 0,void 0,!0,this._divisor||u)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!E&&this._buffer||(E=E||this._data,E&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,E),this._data=E):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(E,this._label),this._data=E):this._buffer=this._engine.createVertexBuffer(E,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.wt>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.wt,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.wt,void 0,this._label));X.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(E){this.create(E)}updateDirectly(E,t,z){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,E,A?t:t*Float32Array.BYTES_PER_ELEMENT,z?z*this.byteStride:void 0),this._data=0===t&&void 0===z?E:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class p{get C(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(E){const t=0!=E;this._instanceDivisor=E,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}get _maxVerticesCount(){const E=this.getData();return E?Array.isArray(E)?E.length/(this.byteStride/4)-this.byteOffset/4:(E.byteLength-this.byteOffset)/this.byteStride:0}constructor(E,t,z,A,X,C,Z,H,h,d){let y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]&&arguments[11],c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,a=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let L=!1;if(this.ct=E,"object"===typeof A&&null!==A?(L=A.updatable??!1,X=A.postponeInternalCreation,C=A.stride,Z=A.instanced,H=A.offset,h=A.size,d=A.type,y=A.normalized??!1,O=A.useBytes??!1,c=A.divisor??1,a=A.takeBufferOwnership??!1,this._label=A.label):L=!!A,t instanceof u?(this._buffer=t,this._ownsBuffer=a):(this._buffer=new u(E,t,L,C,X,Z,O,c,this._label),this._ownsBuffer=!0),this.uniqueId=p._Counter++,this._kind=z,void 0===d){const E=this.getData();this.type=E?p.GetDataType(E):p.FLOAT}else this.type=d;const mE=(0,R.m)(this.type);O?(this._size=h||(C?C/mE:p.DeduceStride(z)),this.byteStride=C||this._buffer.byteStride||this._size*mE,this.byteOffset=H||0):(this._size=h||C||p.DeduceStride(z),this.byteStride=C?C*mE:this._buffer.byteStride||this._size*mE,this.byteOffset=(H||0)*mE),this.normalized=y,this._instanced=void 0!==Z&&Z,this._instanceDivisor=Z?c:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var E;null===(E=this._buffer)||void 0===E||E._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(E,t){const z=this.getData();return z?(0,R.i)(z,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,E,t):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,R.m)(this.type)}getOffset(){return this.byteOffset/(0,R.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,R.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(E){this._buffer.create(E),this._alignBuffer()}update(E){this._buffer.update(E),this._alignBuffer()}updateDirectly(E,t){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(E,t,void 0,z),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(E,t){(0,R.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,E,this.normalized,((E,z)=>{for(let A=0;A<this._size;A++)t(E[A],z+A)}))}_alignBuffer(){}static DeduceStride(E){switch(E){case p.UVKind:case p.UV2Kind:case p.UV3Kind:case p.UV4Kind:case p.UV5Kind:case p.UV6Kind:return 2;case p.NormalKind:case p.PositionKind:return 3;case p.ColorKind:case p.ColorInstanceKind:case p.MatricesIndicesKind:case p.MatricesIndicesExtraKind:case p.MatricesWeightsKind:case p.MatricesWeightsExtraKind:case p.TangentKind:return 4;default:throw new Error("Invalid kind '"+E+"'")}}static GetDataType(E){return E instanceof Int8Array?p.BYTE:E instanceof Uint8Array?p.UNSIGNED_BYTE:E instanceof Int16Array?p.SHORT:E instanceof Uint16Array?p.UNSIGNED_SHORT:E instanceof Int32Array?p.INT:E instanceof Uint32Array?p.UNSIGNED_INT:p.FLOAT}static GetTypeByteLength(E){return(0,R.m)(E)}static ForEach(E,t,z,A,X,u,p,C){(0,R.h)(E,t,z,A,X,u,p,((E,t)=>{for(let z=0;z<A;z++)C(E[z],t+z)}))}static GetFloatData(E,t,z,A,X,u,p,C){return(0,R.i)(E,t,z,A,X,u,p,C)}}p._Counter=0,p.BYTE=5120,p.UNSIGNED_BYTE=5121,p.SHORT=5122,p.UNSIGNED_SHORT=5123,p.INT=5124,p.UNSIGNED_INT=5125,p.FLOAT=5126,p.PositionKind="position",p.NormalKind="normal",p.TangentKind="tangent",p.UVKind="uv",p.UV2Kind="uv2",p.UV3Kind="uv3",p.UV4Kind="uv4",p.UV5Kind="uv5",p.UV6Kind="uv6",p.ColorKind="color",p.ColorInstanceKind="instanceColor",p.MatricesIndicesKind="matricesIndices",p.MatricesWeightsKind="matricesWeights",p.MatricesIndicesExtraKind="matricesIndicesExtra",p.MatricesWeightsExtraKind="matricesWeightsExtra"},11907:(E,t,z)=>{z.d(t,{b:()=>d,f:()=>h,h:()=>C,i:()=>Z,m:()=>u,p:()=>p,s:()=>H});var A=z(11640);function X(E,t,z,A){switch(t){case 5120:{let t=E.getInt8(z);return A&&(t=Math.max(t/127,-1)),t}case 5121:{let t=E.getUint8(z);return A&&(t/=255),t}case 5122:{let t=E.getInt16(z,!0);return A&&(t=Math.max(t/32767,-1)),t}case 5123:{let t=E.getUint16(z,!0);return A&&(t/=65535),t}case 5124:return E.getInt32(z,!0);case 5125:return E.getUint32(z,!0);case 5126:return E.getFloat32(z,!0);default:throw new Error(`Invalid component type ${t}`)}}function R(E,t,z,A,X){switch(t){case 5120:A&&(X=Math.round(127*X)),E.setInt8(z,X);break;case 5121:A&&(X=Math.round(255*X)),E.setUint8(z,X);break;case 5122:A&&(X=Math.round(32767*X)),E.setInt16(z,X,!0);break;case 5123:A&&(X=Math.round(65535*X)),E.setUint16(z,X,!0);break;case 5124:E.setInt32(z,X,!0);break;case 5125:E.setUint32(z,X,!0);break;case 5126:E.setFloat32(z,X,!0);break;default:throw new Error(`Invalid component type ${t}`)}}function u(E){switch(E){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${E}'`)}}function p(E){switch(E){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${E}'`)}}function C(E,t,z,A,p,C,Z,H){const h=new Array(A),d=new Array(A);if(E instanceof Array){let X=t/4;const R=z/4;for(let t=0;t<C;t+=A){for(let t=0;t<A;t++)h[t]=d[t]=E[X+t];H(d,t);for(let t=0;t<A;t++)h[t]!==d[t]&&(E[X+t]=d[t]);X+=R}}else{const y=ArrayBuffer.isView(E)?new DataView(E.buffer,E.byteOffset,E.byteLength):new DataView(E),O=u(p);for(let E=0;E<C;E+=A){for(let E=0,z=t;E<A;E++,z+=O)h[E]=d[E]=X(y,p,z,Z);H(d,E);for(let E=0,z=t;E<A;E++,z+=O)h[E]!==d[E]&&R(y,p,z,Z,d[E]);t+=z}}}function Z(E,t,z,X,R,p,Z,H){const h=t*u(z),d=Z*t;if(5126!==z||R!==h){const A=new Float32Array(d);return C(E,X,R,t,z,d,p,((E,z)=>{for(let X=0;X<t;X++)A[z+X]=E[X]})),A}if(!(E instanceof Array||E instanceof Float32Array)||0!==X||E.length!==d){if(E instanceof Array){const t=X/4;return E.slice(t,t+d)}if(E instanceof ArrayBuffer)return new Float32Array(E,X,d);{const t=E.byteOffset+X;return 0!==(3&t)&&(A.d.Warn("Float array must be aligned to 4-bytes border"),H=!0),H?new Float32Array(E.buffer.slice(t,t+d*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(E.buffer,t,d)}}return H?E.slice():E}function H(E,t,z,X,R,Z,H,h){const d=u(z),y=p(z),O=H*t;if(Array.isArray(E)){if(0!==(3&X)||0!==(3&R))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const A=X/4,u=R/4;if(A+(H-1)*u+t>E.length)throw new Error("Last accessed index is out of bounds.");if(u<t)throw new Error("Data stride cannot be smaller than the component size.");if(u!==t){const A=new y(O);return C(E,X,R,t,z,O,Z,((E,z)=>{for(let X=0;X<t;X++)A[z+X]=E[X]})),A}return new y(E.slice(A,A+O))}let c,a=X;E instanceof ArrayBuffer?c=E:(c=E.buffer,a+=E.byteOffset);if(a+(H-1)*R+t*d>c.byteLength)throw new Error("Last accessed byte is out of bounds.");const L=t*d;if(R<L)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(R!==L){const E=new y(O);return C(c,a,R,t,z,O,Z,((z,A)=>{for(let X=0;X<t;X++)E[A+X]=z[X]})),E}return 1!==d&&0!==(a&d-1)&&(A.d.Warn("Array must be aligned to border of element size. Data will be copied."),h=!0),h?new y(c.slice(a,a+O*d)):new y(c,a,O)}function h(E,t,z,X,R,p,Z,H){const h=t*u(z),d=Z*t;if(H.length!==d)throw new Error("Output length is not valid");if(5126===z&&R===h)if(E instanceof Array){const t=X/4;H.set(E,t)}else if(E instanceof ArrayBuffer){const t=new Float32Array(E,X,d);H.set(t)}else{const t=E.byteOffset+X;if(0!==(3&t))return A.d.Warn("Float array must be aligned to 4-bytes border"),void H.set(new Float32Array(E.buffer.slice(t,t+d*Float32Array.BYTES_PER_ELEMENT)));const z=new Float32Array(E.buffer,t,d);H.set(z)}else C(E,X,R,t,z,d,p,((E,z)=>{for(let A=0;A<t;A++)H[z+A]=E[A]}))}function d(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(E)){for(let X=0;X<t;X++)if(E[z+X]-A>65535)return!0;return!1}return 4===E.BYTES_PER_ELEMENT}},11899:(E,t,z)=>{z.d(t,{e:()=>A});class A{get underlyingResource(){return null}constructor(){this.references=0,this.wt=0,this.is32Bits=!1,this.uniqueId=A._Counter++}}A._Counter=0},11951:(E,t,z)=>{z.d(t,{b:()=>X});var A=z(11707);class X{static GetEffect(E){return void 0===E.getPipelineContext?E.effect:E}constructor(E){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=E.createDrawContext(),t&&(this.materialContext=E.createMaterialContext())}setEffect(E,t){let z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var A;(this.effect=E,void 0!==t&&(this.defines=t),z)&&(null===(A=this.drawContext)||void 0===A||A.reset())}dispose(){var E;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const E=this.effect;t?E.dispose():A.c.SetImmediate((()=>{E.getEngine().onEndFrameObservable.addOnce((()=>{E.dispose()}))})),this.effect=null}null===(E=this.drawContext)||void 0===E||E.dispose()}}},12020:(E,t,z)=>{z.d(t,{b:()=>X});var A=z(11861);class X{static GetPlanes(E){const t=[];for(let z=0;z<6;z++)t.push(new A.d(0,0,0,0));return X.GetPlanesToRef(E,t),t}static GetNearPlaneToRef(E,t){const z=E.m;t.normal.x=z[3]+z[2],t.normal.y=z[7]+z[6],t.normal.z=z[11]+z[10],t.d=z[15]+z[14],t.normalize()}static GetFarPlaneToRef(E,t){const z=E.m;t.normal.x=z[3]-z[2],t.normal.y=z[7]-z[6],t.normal.z=z[11]-z[10],t.d=z[15]-z[14],t.normalize()}static GetLeftPlaneToRef(E,t){const z=E.m;t.normal.x=z[3]+z[0],t.normal.y=z[7]+z[4],t.normal.z=z[11]+z[8],t.d=z[15]+z[12],t.normalize()}static GetRightPlaneToRef(E,t){const z=E.m;t.normal.x=z[3]-z[0],t.normal.y=z[7]-z[4],t.normal.z=z[11]-z[8],t.d=z[15]-z[12],t.normalize()}static GetTopPlaneToRef(E,t){const z=E.m;t.normal.x=z[3]-z[1],t.normal.y=z[7]-z[5],t.normal.z=z[11]-z[9],t.d=z[15]-z[13],t.normalize()}static GetBottomPlaneToRef(E,t){const z=E.m;t.normal.x=z[3]+z[1],t.normal.y=z[7]+z[5],t.normal.z=z[11]+z[9],t.d=z[15]+z[13],t.normalize()}static GetPlanesToRef(E,t){X.GetNearPlaneToRef(E,t[0]),X.GetFarPlaneToRef(E,t[1]),X.GetLeftPlaneToRef(E,t[2]),X.GetRightPlaneToRef(E,t[3]),X.GetTopPlaneToRef(E,t[4]),X.GetBottomPlaneToRef(E,t[5])}static IsPointInFrustum(E,t){for(let z=0;z<6;z++)if(t[z].dotCoordinate(E)<0)return!1;return!0}}},12032:(E,t,z)=>{z.d(t,{c:()=>X});var A=z(11649);class X{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(E,t){X.Enabled&&(this._current+=E,t&&this._fetchResult())}beginMonitoring(){X.Enabled&&(this._startMonitoringTime=A.c.Now)}endMonitoring(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!X.Enabled)return;E&&this.fetchNewFrame();const t=A.c.Now;this._current=t-this._startMonitoringTime,E&&this._fetchResult()}nz(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const E=A.c.Now;E-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=E,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}X.Enabled=!0},11920:(E,t,z)=>{z.d(t,{e:()=>X,i:()=>A});class A{constructor(E){this.length=0,this.data=new Array(E),this._id=A._GlobalId++}push(E){this.data[this.length++]=E,this.length>this.data.length&&(this.data.length*=2)}forEach(E){for(let t=0;t<this.length;t++)E(this.data[t])}sort(E){this.data.sort(E)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(E){if(0!==E.length){this.length+E.length>this.data.length&&(this.data.length=2*(this.length+E.length));for(let t=0;t<E.length;t++)this.data[this.length++]=(E.data||E)[t]}}indexOf(E){const t=this.data.indexOf(E);return t>=this.length?-1:t}contains(E){return-1!==this.indexOf(E)}}A._GlobalId=0;class X extends A{constructor(){super(...arguments),this._duplicateId=0}push(E){super.push(E),E.__smartArrayFlags||(E.__smartArrayFlags={}),E.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(E){return(!E.__smartArrayFlags||E.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(E),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(E){if(0!==E.length){this.length+E.length>this.data.length&&(this.data.length=2*(this.length+E.length));for(let t=0;t<E.length;t++){const z=(E.data||E)[t];this.pushNoDuplicate(z)}}}}},11885:(E,t,z)=>{z.d(t,{c:()=>R});var A=z(11894),X=z(11632);class R{constructor(E){this._vertexBuffers={},this.onBeforeRenderObservable=new X.b,this._scene=E}_prepareBuffers(){if(this._vertexBuffers[A.f.PositionKind])return;const E=[];E.push(1,1),E.push(-1,1),E.push(-1,-1),E.push(1,-1),this._vertexBuffers[A.f.PositionKind]=new A.f(this._scene.getEngine(),E,A.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const E=[];E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(E)}_rebuild(){const E=this._vertexBuffers[A.f.PositionKind];E&&(E._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const z=this._scene.activeCamera;return!!z&&(t=t||z._postProcesses.filter((E=>null!=E)),!(!t||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(z,E,null!==t&&void 0!==t),!0))}directRender(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,R=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:E.length;const p=this._scene.getEngine();for(let Z=0;Z<u;Z++){var C;if(Z<E.length-1)E[Z+1].activate(this._scene.activeCamera||this._scene,null===t||void 0===t?void 0:t.texture);else t?p.bindFramebuffer(t,A,void 0,void 0,z,X):R||p.restoreDefaultFramebuffer(),null===(C=p._debugInsertMarker)||void 0===C||C.call(p,`post process ${E[Z].name} output`);const u=E[Z],H=u.apply();H&&(u.onBeforeRenderObservable.notifyObservers(H),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,H),p.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(H))}p.setDepthBuffer(!0),p.setDepthWrite(!0)}_finalizeFrame(E,t,z,A){let X=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const R=this._scene.activeCamera;if(!R)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(A=A||R._postProcesses.filter((E=>null!=E))).length||!this._scene.postProcessesEnabled)return;const u=this._scene.getEngine();for(let C=0,Z=A.length;C<Z;C++){const H=A[C];var p;if(C<Z-1)H._outputTexture=A[C+1].activate(R,null===t||void 0===t?void 0:t.texture);else t?(u.bindFramebuffer(t,z,void 0,void 0,X),H._outputTexture=t):(u.restoreDefaultFramebuffer(),H._outputTexture=null),null===(p=u._debugInsertMarker)||void 0===p||p.call(u,`post process ${A[C].name} output`);if(E)break;const h=H.apply();h&&(H.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),u.bindBuffers(this._vertexBuffers,this._indexBuffer,h),u.drawElementsType(0,0,6),H.onAfterRenderObservable.notifyObservers(h))}u.setDepthBuffer(!0),u.setDepthWrite(!0),u.setAlphaMode(0)}dispose(){const E=this._vertexBuffers[A.f.PositionKind];E&&(E.dispose(),this._vertexBuffers[A.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11912:(E,t,z)=>{z.d(t,{b:()=>p});var A=z(11920),X=z(11812);class R{set opaqueSortCompareFn(E){this._opaqueSortCompareFn=E||R.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(E){this._alphaTestSortCompareFn=E||R.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(E){this._transparentSortCompareFn=E||R.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(E,t){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,R=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=E,this._opaqueSubMeshes=new A.i(256),this._transparentSubMeshes=new A.i(256),this._alphaTestSubMeshes=new A.i(256),this._depthOnlySubMeshes=new A.i(256),this._particleSystems=new A.i(256),this._spriteManagers=new A.i(256),this._empty=!0,this._edgesRenderers=new A.e(16),this._scene=t,this.opaqueSortCompareFn=z,this.alphaTestSortCompareFn=X,this.transparentSortCompareFn=R}render(E,t,z,A){if(E)return void E(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const X=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(X.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),X.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const R=X.getStencilBuffer();if(X.setStencilBuffer(!1),t&&this._renderSprites(),z&&this._renderParticles(A),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(X.setStencilBuffer(R),this._scene.useOrderIndependentTransparency){const E=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);E.length&&this._renderTransparent(E)}else this._renderTransparent(this._transparentSubMeshes);X.setAlphaMode(0)}if(X.setStencilBuffer(!1),this._edgesRenderers.length){for(let E=0;E<this._edgesRenderers.length;E++)this._edgesRenderers.data[E].render();X.setAlphaMode(0)}X.setStencilBuffer(R)}_renderOpaqueSorted(E){R._RenderSorted(E,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(E){R._RenderSorted(E,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(E){R._RenderSorted(E,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(E,t,z,A){let u,p=0;const C=z?z.globalPosition:R._ZeroVector;if(A)for(;p<E.length;p++)u=E.data[p],u._alphaIndex=u.getMesh().alphaIndex,u._distanceToCamera=X.Lt.Distance(u.getBoundingInfo().boundingSphere.centerWorld,C);const Z=E.length===E.data.length?E.data:E.data.slice(0,E.length);t&&Z.sort(t);const H=Z[0].getMesh().lE();for(p=0;p<Z.length;p++)if(u=Z[p],!H._activeMeshesFrozenButKeepClipping||u.isInFrustum(H._frustumPlanes)){if(A){const E=u.oE();if(E&&E.needDepthPrePass){const t=E.lE().getEngine();t.setColorWrite(!1),t.setAlphaMode(0),u.render(!1),t.setColorWrite(!0)}}u.render(A)}}static defaultTransparentSortCompare(E,t){return E._alphaIndex>t._alphaIndex?1:E._alphaIndex<t._alphaIndex?-1:R.backToFrontSortCompare(E,t)}static backToFrontSortCompare(E,t){return E._distanceToCamera<t._distanceToCamera?1:E._distanceToCamera>t._distanceToCamera?-1:0}static frontToBackSortCompare(E,t){return E._distanceToCamera<t._distanceToCamera?-1:E._distanceToCamera>t._distanceToCamera?1:0}static PainterSortCompare(E,t){const z=E.getMesh(),A=t.getMesh();return z.material&&A.material?z.material.uniqueId-A.material.uniqueId:z.uniqueId-A.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(E,t,z){void 0===t&&(t=E.getMesh()),void 0===z&&(z=E.oE()),null!==z&&void 0!==z&&(z.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(E):z.needAlphaTestingForMesh(t)?(z.needDepthPrePass&&this._depthOnlySubMeshes.push(E),this._alphaTestSubMeshes.push(E)):(z.needDepthPrePass&&this._depthOnlySubMeshes.push(E),this._opaqueSubMeshes.push(E)),t._renderingGroup=this,t._edgesRenderer&&t.isEnabled()&&t.isVisible&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}dispatchSprites(E){this._spriteManagers.push(E),this._empty=!1}dispatchParticles(E){this._particleSystems.push(E),this._empty=!1}_renderParticles(E){if(0===this._particleSystems.length)return;const t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let z=0;z<this._particleSystems.length;z++){const A=this._particleSystems.data[z];if(0===(t&&t.layerMask&A.layerMask))continue;const X=A.Xt;X.position&&E&&-1===E.indexOf(X)||this._scene._activeParticles.addCount(A.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const E=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){const z=this._spriteManagers.data[t];0!==(E&&E.layerMask&z.layerMask)&&z.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}R._ZeroVector=X.Lt.Zero();class u{}class p{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(E){E!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=E,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const E of this._scene.meshes)if(E.Rp)for(const t of E.Rp)t._wasDispatched=!1;if(this._scene.spriteManagers)for(const E of this._scene.spriteManagers)E._wasDispatched=!1;for(const E of this._scene.Kd)E._wasDispatched=!1}constructor(E){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new u,this._maintainStateBetweenFrames=!1,this._scene=E;for(let t=p.MIN_RENDERINGGROUPS;t<p.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={Xp:!0,depth:!0,stencil:!0}}getRenderingGroup(E){const t=E||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}_clearDepthStencilBuffer(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,E,t),this._depthStencilBufferAlreadyCleaned=!0)}render(E,t,z,A){const X=this._renderingGroupInfo;if(X.It=this._scene,X.camera=this._scene.activeCamera,X.renderingManager=this,this._scene.spriteManagers&&A)for(let R=0;R<this._scene.spriteManagers.length;R++){const E=this._scene.spriteManagers[R];this.dispatchSprites(E)}for(let R=p.MIN_RENDERINGGROUPS;R<p.MAX_RENDERINGGROUPS;R++){this._depthStencilBufferAlreadyCleaned=R===p.MIN_RENDERINGGROUPS;const u=this._renderingGroups[R];if(!u||u._empty)continue;const C=1<<R;if(X.renderingGroupId=R,this._scene.onBeforeRenderingGroupObservable.notifyObservers(X,C),p.AUTOCLEAR){const E=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(R):this._autoClearDepthStencil[R];E&&E.Xp&&this._clearDepthStencilBuffer(E.depth,E.stencil)}for(const E of this._scene._beforeRenderingGroupDrawStage)E.action(R);u.render(E,A,z,t);for(const E of this._scene._afterRenderingGroupDrawStage)E.action(R);this._scene.onAfterRenderingGroupObservable.notifyObservers(X,C)}}reset(){if(!this.maintainStateBetweenFrames)for(let E=p.MIN_RENDERINGGROUPS;E<p.MAX_RENDERINGGROUPS;E++){const t=this._renderingGroups[E];t&&t.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let E=p.MIN_RENDERINGGROUPS;E<p.MAX_RENDERINGGROUPS;E++){const t=this._renderingGroups[E];t&&t.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let E=p.MIN_RENDERINGGROUPS;E<p.MAX_RENDERINGGROUPS;E++){const t=this._renderingGroups[E];t&&t.dispose()}}_prepareRenderingGroup(E){void 0===this._renderingGroups[E]&&(this._renderingGroups[E]=new R(E,this._scene,this._customOpaqueSortCompareFn[E],this._customAlphaTestSortCompareFn[E],this._customTransparentSortCompareFn[E]))}dispatchSprites(E){this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatchSprites(E))}dispatchParticles(E){this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatchParticles(E))}dispatch(E,t,z){void 0===t&&(t=E.getMesh()),this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatch(E,t,z))}setRenderingOrder(E){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[E]=t,this._customAlphaTestSortCompareFn[E]=z,this._customTransparentSortCompareFn[E]=A,this._renderingGroups[E]){const t=this._renderingGroups[E];t.opaqueSortCompareFn=this._customOpaqueSortCompareFn[E],t.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[E],t.transparentSortCompareFn=this._customTransparentSortCompareFn[E]}}setRenderingAutoClearDepthStencil(E,t){let z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[E]={Xp:t,depth:z,stencil:A}}getAutoClearDepthStencilSetup(E){return this._autoClearDepthStencil[E]}}p.MAX_RENDERINGGROUPS=4,p.MIN_RENDERINGGROUPS=0,p.AUTOCLEAR=!0}}]);