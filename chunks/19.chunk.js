"use strict";(self.h6ljd275xwr=self.h6ljd275xwr||[]).push([[19],{11360:(n,y,H)=>{H.d(y,{d:()=>k,g:()=>i});var o=H(11367),G=H(11114),h=H(11375);class k{get A(){return this._isDisposed}constructor(n,y,H){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],k=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7?arguments[7]:void 0,V=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,n&&n.pn?this._engine=n.pn().getEngine():this._engine=n,this._updatable=H,this._instanced=k,this._divisor=B||1,this._label=V,y instanceof o.e?(this._data=null,this._buffer=y):(this._data=y,this._buffer=null),this.byteStride=i?G:G*Float32Array.BYTES_PER_ELEMENT,h||this.create()}createVertexBuffer(n,y,H,o,G){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6?arguments[6]:void 0;const B=h?y:y*Float32Array.BYTES_PER_ELEMENT,V=o?h?o:o*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new i(this._engine,this,n,this._updatable,!0,V,void 0===G?this._instanced:G,B,H,void 0,void 0,!0,this._divisor||k)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!n&&this._buffer||(n=n||this._data,n&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,n),this._data=n):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(n,this._label),this._data=n):this._buffer=this._engine.createVertexBuffer(n,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.ji>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.ji,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.ji,void 0,this._label));G.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(n){this.create(n)}updateDirectly(n,y,H){let o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,n,o?y:y*Float32Array.BYTES_PER_ELEMENT,H?H*this.byteStride:void 0),this._data=0===y&&void 0===H?n:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class i{get A(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(n){const y=0!=n;this._instanceDivisor=n,y!==this._instanced&&(this._instanced=y,this._computeHashCode())}get _maxVerticesCount(){const n=this.getData();return n?Array.isArray(n)?n.length/(this.byteStride/4)-this.byteOffset/4:(n.byteLength-this.byteOffset)/this.byteStride:0}constructor(n,y,H,o,G,B,V,q,b,A){let U=arguments.length>10&&void 0!==arguments[10]&&arguments[10],T=arguments.length>11&&void 0!==arguments[11]&&arguments[11],W=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,z=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let Q=!1;if(this.Wy=n,"object"===typeof o&&null!==o?(Q=o.updatable??!1,G=o.postponeInternalCreation,B=o.stride,V=o.instanced,q=o.offset,b=o.size,A=o.type,U=o.normalized??!1,T=o.useBytes??!1,W=o.divisor??1,z=o.takeBufferOwnership??!1,this._label=o.label):Q=!!o,y instanceof k?(this._buffer=y,this._ownsBuffer=z):(this._buffer=new k(n,y,Q,B,G,V,T,W,this._label),this._ownsBuffer=!0),this.uniqueId=i._Counter++,this._kind=H,void 0===A){const n=this.getData();this.type=n?i.GetDataType(n):i.FLOAT}else this.type=A;const l=(0,h.o)(this.type);T?(this._size=b||(B?B/l:i.DeduceStride(H)),this.byteStride=B||this._buffer.byteStride||this._size*l,this.byteOffset=q||0):(this._size=b||B||i.DeduceStride(H),this.byteStride=B?B*l:this._buffer.byteStride||this._size*l,this.byteOffset=(q||0)*l),this.normalized=U,this._instanced=void 0!==V&&V,this._instanceDivisor=V?W:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var n;null===(n=this._buffer)||void 0===n||n._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(n,y){const H=this.getData();return H?(0,h.k)(H,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,n,y):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,h.o)(this.type)}getOffset(){return this.byteOffset/(0,h.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,h.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(n){this._buffer.create(n),this._alignBuffer()}update(n){this._buffer.update(n),this._alignBuffer()}updateDirectly(n,y){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(n,y,void 0,H),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(n,y){(0,h.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,n,this.normalized,((n,H)=>{for(let o=0;o<this._size;o++)y(n[o],H+o)}))}_alignBuffer(){}static DeduceStride(n){switch(n){case i.UVKind:case i.UV2Kind:case i.UV3Kind:case i.UV4Kind:case i.UV5Kind:case i.UV6Kind:return 2;case i.NormalKind:case i.PositionKind:return 3;case i.ColorKind:case i.ColorInstanceKind:case i.MatricesIndicesKind:case i.MatricesIndicesExtraKind:case i.MatricesWeightsKind:case i.MatricesWeightsExtraKind:case i.TangentKind:return 4;default:throw new Error("Invalid kind '"+n+"'")}}static GetDataType(n){return n instanceof Int8Array?i.BYTE:n instanceof Uint8Array?i.UNSIGNED_BYTE:n instanceof Int16Array?i.SHORT:n instanceof Uint16Array?i.UNSIGNED_SHORT:n instanceof Int32Array?i.INT:n instanceof Uint32Array?i.UNSIGNED_INT:i.FLOAT}static GetTypeByteLength(n){return(0,h.o)(n)}static ForEach(n,y,H,o,G,k,i,B){(0,h.g)(n,y,H,o,G,k,i,((n,y)=>{for(let H=0;H<o;H++)B(n[H],y+H)}))}static GetFloatData(n,y,H,o,G,k,i,B){return(0,h.k)(n,y,H,o,G,k,i,B)}}i._Counter=0,i.BYTE=5120,i.UNSIGNED_BYTE=5121,i.SHORT=5122,i.UNSIGNED_SHORT=5123,i.INT=5124,i.UNSIGNED_INT=5125,i.FLOAT=5126,i.PositionKind="position",i.NormalKind="normal",i.TangentKind="tangent",i.UVKind="uv",i.UV2Kind="uv2",i.UV3Kind="uv3",i.UV4Kind="uv4",i.UV5Kind="uv5",i.UV6Kind="uv6",i.ColorKind="color",i.ColorInstanceKind="instanceColor",i.MatricesIndicesKind="matricesIndices",i.MatricesWeightsKind="matricesWeights",i.MatricesIndicesExtraKind="matricesIndicesExtra",i.MatricesWeightsExtraKind="matricesWeightsExtra"},11375:(n,y,H)=>{H.d(y,{c:()=>A,d:()=>b,g:()=>B,k:()=>V,o:()=>k,r:()=>i,u:()=>q});var o=H(11114);function G(n,y,H,o){switch(y){case 5120:{let y=n.getInt8(H);return o&&(y=Math.max(y/127,-1)),y}case 5121:{let y=n.getUint8(H);return o&&(y/=255),y}case 5122:{let y=n.getInt16(H,!0);return o&&(y=Math.max(y/32767,-1)),y}case 5123:{let y=n.getUint16(H,!0);return o&&(y/=65535),y}case 5124:return n.getInt32(H,!0);case 5125:return n.getUint32(H,!0);case 5126:return n.getFloat32(H,!0);default:throw new Error(`Invalid component type ${y}`)}}function h(n,y,H,o,G){switch(y){case 5120:o&&(G=Math.round(127*G)),n.setInt8(H,G);break;case 5121:o&&(G=Math.round(255*G)),n.setUint8(H,G);break;case 5122:o&&(G=Math.round(32767*G)),n.setInt16(H,G,!0);break;case 5123:o&&(G=Math.round(65535*G)),n.setUint16(H,G,!0);break;case 5124:n.setInt32(H,G,!0);break;case 5125:n.setUint32(H,G,!0);break;case 5126:n.setFloat32(H,G,!0);break;default:throw new Error(`Invalid component type ${y}`)}}function k(n){switch(n){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${n}'`)}}function i(n){switch(n){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${n}'`)}}function B(n,y,H,o,i,B,V,q){const b=new Array(o),A=new Array(o);if(n instanceof Array){let G=y/4;const h=H/4;for(let y=0;y<B;y+=o){for(let y=0;y<o;y++)b[y]=A[y]=n[G+y];q(A,y);for(let y=0;y<o;y++)b[y]!==A[y]&&(n[G+y]=A[y]);G+=h}}else{const U=ArrayBuffer.isView(n)?new DataView(n.buffer,n.byteOffset,n.byteLength):new DataView(n),T=k(i);for(let n=0;n<B;n+=o){for(let n=0,H=y;n<o;n++,H+=T)b[n]=A[n]=G(U,i,H,V);q(A,n);for(let n=0,H=y;n<o;n++,H+=T)b[n]!==A[n]&&h(U,i,H,V,A[n]);y+=H}}}function V(n,y,H,G,h,i,V,q){const b=y*k(H),A=V*y;if(5126!==H||h!==b){const o=new Float32Array(A);return B(n,G,h,y,H,A,i,((n,H)=>{for(let G=0;G<y;G++)o[H+G]=n[G]})),o}if(!(n instanceof Array||n instanceof Float32Array)||0!==G||n.length!==A){if(n instanceof Array){const y=G/4;return n.slice(y,y+A)}if(n instanceof ArrayBuffer)return new Float32Array(n,G,A);{const y=n.byteOffset+G;return 0!==(3&y)&&(o.d.Warn("Float array must be aligned to 4-bytes border"),q=!0),q?new Float32Array(n.buffer.slice(y,y+A*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(n.buffer,y,A)}}return q?n.slice():n}function q(n,y,H,G,h,V,q,b){const A=k(H),U=i(H),T=q*y;if(Array.isArray(n)){if(0!==(3&G)||0!==(3&h))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const o=G/4,k=h/4;if(o+(q-1)*k+y>n.length)throw new Error("Last accessed index is out of bounds.");if(k<y)throw new Error("Data stride cannot be smaller than the component size.");if(k!==y){const o=new U(T);return B(n,G,h,y,H,T,V,((n,H)=>{for(let G=0;G<y;G++)o[H+G]=n[G]})),o}return new U(n.slice(o,o+T))}let W,z=G;n instanceof ArrayBuffer?W=n:(W=n.buffer,z+=n.byteOffset);if(z+(q-1)*h+y*A>W.byteLength)throw new Error("Last accessed byte is out of bounds.");const Q=y*A;if(h<Q)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(h!==Q){const n=new U(T);return B(W,z,h,y,H,T,V,((H,o)=>{for(let G=0;G<y;G++)n[o+G]=H[G]})),n}return 1!==A&&0!==(z&A-1)&&(o.d.Warn("Array must be aligned to border of element size. Data will be copied."),b=!0),b?new U(W.slice(z,z+T*A)):new U(W,z,T)}function b(n,y,H,G,h,i,V,q){const b=y*k(H),A=V*y;if(q.length!==A)throw new Error("Output length is not valid");if(5126===H&&h===b)if(n instanceof Array){const y=G/4;q.set(n,y)}else if(n instanceof ArrayBuffer){const y=new Float32Array(n,G,A);q.set(y)}else{const y=n.byteOffset+G;if(0!==(3&y))return o.d.Warn("Float array must be aligned to 4-bytes border"),void q.set(new Float32Array(n.buffer.slice(y,y+A*Float32Array.BYTES_PER_ELEMENT)));const H=new Float32Array(n.buffer,y,A);q.set(H)}else B(n,G,h,y,H,A,i,((n,H)=>{for(let o=0;o<y;o++)q[H+o]=n[o]}))}function A(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(n)){for(let G=0;G<y;G++)if(n[H+G]-o>65535)return!0;return!1}return 4===n.BYTES_PER_ELEMENT}},11367:(n,y,H)=>{H.d(y,{e:()=>o});class o{get underlyingResource(){return null}constructor(){this.references=0,this.ji=0,this.is32Bits=!1,this.uniqueId=o._Counter++}}o._Counter=0},11425:(n,y,H)=>{H.d(y,{b:()=>G});var o=H(11185);class G{static GetEffect(n){return void 0===n.getPipelineContext?n.effect:n}constructor(n){let y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=n.createDrawContext(),y&&(this.materialContext=n.createMaterialContext())}setEffect(n,y){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var o;(this.effect=n,void 0!==y&&(this.defines=y),H)&&(null===(o=this.drawContext)||void 0===o||o.reset())}dispose(){var n;let y=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const n=this.effect;y?n.dispose():o.c.SetImmediate((()=>{n.getEngine().onEndFrameObservable.addOnce((()=>{n.dispose()}))})),this.effect=null}null===(n=this.drawContext)||void 0===n||n.dispose()}}},11518:(n,y,H)=>{H.d(y,{c:()=>G});var o=H(11342);class G{static GetPlanes(n){const y=[];for(let H=0;H<6;H++)y.push(new o.b(0,0,0,0));return G.GetPlanesToRef(n,y),y}static GetNearPlaneToRef(n,y){const H=n.m;y.normal.x=H[3]+H[2],y.normal.y=H[7]+H[6],y.normal.z=H[11]+H[10],y.d=H[15]+H[14],y.normalize()}static GetFarPlaneToRef(n,y){const H=n.m;y.normal.x=H[3]-H[2],y.normal.y=H[7]-H[6],y.normal.z=H[11]-H[10],y.d=H[15]-H[14],y.normalize()}static GetLeftPlaneToRef(n,y){const H=n.m;y.normal.x=H[3]+H[0],y.normal.y=H[7]+H[4],y.normal.z=H[11]+H[8],y.d=H[15]+H[12],y.normalize()}static GetRightPlaneToRef(n,y){const H=n.m;y.normal.x=H[3]-H[0],y.normal.y=H[7]-H[4],y.normal.z=H[11]-H[8],y.d=H[15]-H[12],y.normalize()}static GetTopPlaneToRef(n,y){const H=n.m;y.normal.x=H[3]-H[1],y.normal.y=H[7]-H[5],y.normal.z=H[11]-H[9],y.d=H[15]-H[13],y.normalize()}static GetBottomPlaneToRef(n,y){const H=n.m;y.normal.x=H[3]+H[1],y.normal.y=H[7]+H[5],y.normal.z=H[11]+H[9],y.d=H[15]+H[13],y.normalize()}static GetPlanesToRef(n,y){G.GetNearPlaneToRef(n,y[0]),G.GetFarPlaneToRef(n,y[1]),G.GetLeftPlaneToRef(n,y[2]),G.GetRightPlaneToRef(n,y[3]),G.GetTopPlaneToRef(n,y[4]),G.GetBottomPlaneToRef(n,y[5])}static IsPointInFrustum(n,y){for(let H=0;H<6;H++)if(y[H].dotCoordinate(n)<0)return!1;return!0}}},11534:(n,y,H)=>{H.d(y,{e:()=>G});var o=H(11125);class G{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(n,y){G.Enabled&&(this._current+=n,y&&this._fetchResult())}beginMonitoring(){G.Enabled&&(this._startMonitoringTime=o.d.Now)}endMonitoring(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!G.Enabled)return;n&&this.fetchNewFrame();const y=o.d.Now;this._current=y-this._startMonitoringTime,n&&this._fetchResult()}Eh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const n=o.d.Now;n-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=n,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}G.Enabled=!0},11390:(n,y,H)=>{H.d(y,{b:()=>G,f:()=>o});class o{constructor(n){this.length=0,this.data=new Array(n),this._id=o._GlobalId++}push(n){this.data[this.length++]=n,this.length>this.data.length&&(this.data.length*=2)}forEach(n){for(let y=0;y<this.length;y++)n(this.data[y])}sort(n){this.data.sort(n)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(n){if(0!==n.length){this.length+n.length>this.data.length&&(this.data.length=2*(this.length+n.length));for(let y=0;y<n.length;y++)this.data[this.length++]=(n.data||n)[y]}}indexOf(n){const y=this.data.indexOf(n);return y>=this.length?-1:y}contains(n){return-1!==this.indexOf(n)}}o._GlobalId=0;class G extends o{constructor(){super(...arguments),this._duplicateId=0}push(n){super.push(n),n.__smartArrayFlags||(n.__smartArrayFlags={}),n.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(n){return(!n.__smartArrayFlags||n.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(n),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(n){if(0!==n.length){this.length+n.length>this.data.length&&(this.data.length=2*(this.length+n.length));for(let y=0;y<n.length;y++){const H=(n.data||n)[y];this.pushNoDuplicate(H)}}}}},11358:(n,y,H)=>{H.d(y,{c:()=>h});var o=H(11360),G=H(11099);class h{constructor(n){this._vertexBuffers={},this.onBeforeRenderObservable=new G.c,this._scene=n}_prepareBuffers(){if(this._vertexBuffers[o.g.PositionKind])return;const n=[];n.push(1,1),n.push(-1,1),n.push(-1,-1),n.push(1,-1),this._vertexBuffers[o.g.PositionKind]=new o.g(this._scene.getEngine(),n,o.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const n=[];n.push(0),n.push(1),n.push(2),n.push(0),n.push(2),n.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(n)}_rebuild(){const n=this._vertexBuffers[o.g.PositionKind];n&&(n._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this._scene.activeCamera;return!!H&&(y=y||H._postProcesses.filter((n=>null!=n)),!(!y||0===y.length||!this._scene.postProcessesEnabled)&&(y[0].activate(H,n,null!==y&&void 0!==y),!0))}directRender(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:n.length;const i=this._scene.getEngine();for(let V=0;V<k;V++){var B;if(V<n.length-1)n[V+1].activate(this._scene.activeCamera||this._scene,null===y||void 0===y?void 0:y.texture);else y?i.bindFramebuffer(y,o,void 0,void 0,H,G):h||i.restoreDefaultFramebuffer(),null===(B=i._debugInsertMarker)||void 0===B||B.call(i,`post process ${n[V].name} output`);const k=n[V],q=k.apply();q&&(k.onBeforeRenderObservable.notifyObservers(q),this._prepareBuffers(),i.bindBuffers(this._vertexBuffers,this._indexBuffer,q),i.drawElementsType(0,0,6),k.onAfterRenderObservable.notifyObservers(q))}i.setDepthBuffer(!0),i.setDepthWrite(!0)}_finalizeFrame(n,y,H,o){let G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const h=this._scene.activeCamera;if(!h)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(o=o||h._postProcesses.filter((n=>null!=n))).length||!this._scene.postProcessesEnabled)return;const k=this._scene.getEngine();for(let B=0,V=o.length;B<V;B++){const q=o[B];var i;if(B<V-1)q._outputTexture=o[B+1].activate(h,null===y||void 0===y?void 0:y.texture);else y?(k.bindFramebuffer(y,H,void 0,void 0,G),q._outputTexture=y):(k.restoreDefaultFramebuffer(),q._outputTexture=null),null===(i=k._debugInsertMarker)||void 0===i||i.call(k,`post process ${o[B].name} output`);if(n)break;const b=q.apply();b&&(q.onBeforeRenderObservable.notifyObservers(b),this._prepareBuffers(),k.bindBuffers(this._vertexBuffers,this._indexBuffer,b),k.drawElementsType(0,0,6),q.onAfterRenderObservable.notifyObservers(b))}k.setDepthBuffer(!0),k.setDepthWrite(!0),k.setAlphaMode(0)}dispose(){const n=this._vertexBuffers[o.g.PositionKind];n&&(n.dispose(),this._vertexBuffers[o.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11384:(n,y,H)=>{H.d(y,{e:()=>i});var o=H(11390),G=H(11288);class h{set opaqueSortCompareFn(n){this._opaqueSortCompareFn=n||h.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(n){this._alphaTestSortCompareFn=n||h.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(n){this._transparentSortCompareFn=n||h.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(n,y){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=n,this._opaqueSubMeshes=new o.f(256),this._transparentSubMeshes=new o.f(256),this._alphaTestSubMeshes=new o.f(256),this._depthOnlySubMeshes=new o.f(256),this._particleSystems=new o.f(256),this._spriteManagers=new o.f(256),this._empty=!0,this._edgesRenderers=new o.b(16),this._scene=y,this.opaqueSortCompareFn=H,this.alphaTestSortCompareFn=G,this.transparentSortCompareFn=h}render(n,y,H,o){if(n)return void n(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const G=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(G.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),G.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const h=G.getStencilBuffer();if(G.setStencilBuffer(!1),y&&this._renderSprites(),H&&this._renderParticles(o),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(G.setStencilBuffer(h),this._scene.useOrderIndependentTransparency){const n=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);n.length&&this._renderTransparent(n)}else this._renderTransparent(this._transparentSubMeshes);G.setAlphaMode(0)}if(G.setStencilBuffer(!1),this._edgesRenderers.length){for(let n=0;n<this._edgesRenderers.length;n++)this._edgesRenderers.data[n].render();G.setAlphaMode(0)}G.setStencilBuffer(h)}_renderOpaqueSorted(n){h._RenderSorted(n,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(n){h._RenderSorted(n,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(n){h._RenderSorted(n,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(n,y,H,o){let k,i=0;const B=H?H.globalPosition:h._ZeroVector;if(o)for(;i<n.length;i++)k=n.data[i],k._alphaIndex=k.getMesh().alphaIndex,k._distanceToCamera=G.zy.Distance(k.getBoundingInfo().boundingSphere.centerWorld,B);const V=n.length===n.data.length?n.data:n.data.slice(0,n.length);y&&V.sort(y);const q=V[0].getMesh().pn();for(i=0;i<V.length;i++)if(k=V[i],!q._activeMeshesFrozenButKeepClipping||k.isInFrustum(q._frustumPlanes)){if(o){const n=k.Sn();if(n&&n.needDepthPrePass){const y=n.pn().getEngine();y.setColorWrite(!1),y.setAlphaMode(0),k.render(!1),y.setColorWrite(!0)}}k.render(o)}}static defaultTransparentSortCompare(n,y){return n._alphaIndex>y._alphaIndex?1:n._alphaIndex<y._alphaIndex?-1:h.backToFrontSortCompare(n,y)}static backToFrontSortCompare(n,y){return n._distanceToCamera<y._distanceToCamera?1:n._distanceToCamera>y._distanceToCamera?-1:0}static frontToBackSortCompare(n,y){return n._distanceToCamera<y._distanceToCamera?-1:n._distanceToCamera>y._distanceToCamera?1:0}static PainterSortCompare(n,y){const H=n.getMesh(),o=y.getMesh();return H.material&&o.material?H.material.uniqueId-o.material.uniqueId:H.uniqueId-o.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(n,y,H){void 0===y&&(y=n.getMesh()),void 0===H&&(H=n.Sn()),null!==H&&void 0!==H&&(H.needAlphaBlendingForMesh(y)?this._transparentSubMeshes.push(n):H.needAlphaTestingForMesh(y)?(H.needDepthPrePass&&this._depthOnlySubMeshes.push(n),this._alphaTestSubMeshes.push(n)):(H.needDepthPrePass&&this._depthOnlySubMeshes.push(n),this._opaqueSubMeshes.push(n)),y._renderingGroup=this,y._edgesRenderer&&y.isEnabled()&&y.isVisible&&y._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(y._edgesRenderer),this._empty=!1)}dispatchSprites(n){this._spriteManagers.push(n),this._empty=!1}dispatchParticles(n){this._particleSystems.push(n),this._empty=!1}_renderParticles(n){if(0===this._particleSystems.length)return;const y=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let H=0;H<this._particleSystems.length;H++){const o=this._particleSystems.data[H];if(0===(y&&y.layerMask&o.layerMask))continue;const G=o.hy;G.position&&n&&-1===n.indexOf(G)||this._scene._activeParticles.addCount(o.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const n=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let y=0;y<this._spriteManagers.length;y++){const H=this._spriteManagers.data[y];0!==(n&&n.layerMask&H.layerMask)&&H.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}h._ZeroVector=G.zy.Zero();class k{}class i{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(n){n!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=n,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const n of this._scene.meshes)if(n.Lh)for(const y of n.Lh)y._wasDispatched=!1;if(this._scene.spriteManagers)for(const n of this._scene.spriteManagers)n._wasDispatched=!1;for(const n of this._scene.NA)n._wasDispatched=!1}constructor(n){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new k,this._maintainStateBetweenFrames=!1,this._scene=n;for(let y=i.MIN_RENDERINGGROUPS;y<i.MAX_RENDERINGGROUPS;y++)this._autoClearDepthStencil[y]={Dh:!0,depth:!0,stencil:!0}}getRenderingGroup(n){const y=n||0;return this._prepareRenderingGroup(y),this._renderingGroups[y]}_clearDepthStencilBuffer(){let n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],y=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,n,y),this._depthStencilBufferAlreadyCleaned=!0)}render(n,y,H,o){const G=this._renderingGroupInfo;if(G.ly=this._scene,G.camera=this._scene.activeCamera,G.renderingManager=this,this._scene.spriteManagers&&o)for(let h=0;h<this._scene.spriteManagers.length;h++){const n=this._scene.spriteManagers[h];this.dispatchSprites(n)}for(let h=i.MIN_RENDERINGGROUPS;h<i.MAX_RENDERINGGROUPS;h++){this._depthStencilBufferAlreadyCleaned=h===i.MIN_RENDERINGGROUPS;const k=this._renderingGroups[h];if(!k||k._empty)continue;const B=1<<h;if(G.renderingGroupId=h,this._scene.onBeforeRenderingGroupObservable.notifyObservers(G,B),i.AUTOCLEAR){const n=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(h):this._autoClearDepthStencil[h];n&&n.Dh&&this._clearDepthStencilBuffer(n.depth,n.stencil)}for(const n of this._scene._beforeRenderingGroupDrawStage)n.action(h);k.render(n,o,H,y);for(const n of this._scene._afterRenderingGroupDrawStage)n.action(h);this._scene.onAfterRenderingGroupObservable.notifyObservers(G,B)}}reset(){if(!this.maintainStateBetweenFrames)for(let n=i.MIN_RENDERINGGROUPS;n<i.MAX_RENDERINGGROUPS;n++){const y=this._renderingGroups[n];y&&y.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let n=i.MIN_RENDERINGGROUPS;n<i.MAX_RENDERINGGROUPS;n++){const y=this._renderingGroups[n];y&&y.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let n=i.MIN_RENDERINGGROUPS;n<i.MAX_RENDERINGGROUPS;n++){const y=this._renderingGroups[n];y&&y.dispose()}}_prepareRenderingGroup(n){void 0===this._renderingGroups[n]&&(this._renderingGroups[n]=new h(n,this._scene,this._customOpaqueSortCompareFn[n],this._customAlphaTestSortCompareFn[n],this._customTransparentSortCompareFn[n]))}dispatchSprites(n){this.maintainStateBetweenFrames&&n._wasDispatched||(n._wasDispatched=!0,this.getRenderingGroup(n.renderingGroupId).dispatchSprites(n))}dispatchParticles(n){this.maintainStateBetweenFrames&&n._wasDispatched||(n._wasDispatched=!0,this.getRenderingGroup(n.renderingGroupId).dispatchParticles(n))}dispatch(n,y,H){void 0===y&&(y=n.getMesh()),this.maintainStateBetweenFrames&&n._wasDispatched||(n._wasDispatched=!0,this.getRenderingGroup(y.renderingGroupId).dispatch(n,y,H))}setRenderingOrder(n){let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[n]=y,this._customAlphaTestSortCompareFn[n]=H,this._customTransparentSortCompareFn[n]=o,this._renderingGroups[n]){const y=this._renderingGroups[n];y.opaqueSortCompareFn=this._customOpaqueSortCompareFn[n],y.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[n],y.transparentSortCompareFn=this._customTransparentSortCompareFn[n]}}setRenderingAutoClearDepthStencil(n,y){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[n]={Dh:y,depth:H,stencil:o}}getAutoClearDepthStencilSetup(n){return this._autoClearDepthStencil[n]}}i.MAX_RENDERINGGROUPS=4,i.MIN_RENDERINGGROUPS=0,i.AUTOCLEAR=!0}}]);