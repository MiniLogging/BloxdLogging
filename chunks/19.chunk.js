"use strict";(self.vfdo5lmva5i=self.vfdo5lmva5i||[]).push([[19],{11780:(w,o,H)=>{H.d(o,{d:()=>D,e:()=>t});var h=H(11785),E=H(11551),e=H(11794);class D{get A(){return this._isDisposed}constructor(w,o,H){let E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,e=arguments.length>4&&void 0!==arguments[4]&&arguments[4],D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0,L=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,w&&w.Ow?this._engine=w.Ow().getEngine():this._engine=w,this._updatable=H,this._instanced=D,this._divisor=X||1,this._label=L,o instanceof h.b?(this._data=null,this._buffer=o):(this._data=o,this._buffer=null),this.byteStride=t?E:E*Float32Array.BYTES_PER_ELEMENT,e||this.create()}createVertexBuffer(w,o,H,h,E){let e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6?arguments[6]:void 0;const X=e?o:o*Float32Array.BYTES_PER_ELEMENT,L=h?e?h:h*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new t(this._engine,this,w,this._updatable,!0,L,void 0===E?this._instanced:E,X,H,void 0,void 0,!0,this._divisor||D)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!w&&this._buffer||(w=w||this._data,w&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,w),this._data=w):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(w,this._label),this._data=w):this._buffer=this._engine.createVertexBuffer(w,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.no>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.no,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.no,void 0,this._label));E.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(w){this.create(w)}updateDirectly(w,o,H){let h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,w,h?o:o*Float32Array.BYTES_PER_ELEMENT,H?H*this.byteStride:void 0),this._data=0===o&&void 0===H?w:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class t{get A(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(w){const o=0!=w;this._instanceDivisor=w,o!==this._instanced&&(this._instanced=o,this._computeHashCode())}get _maxVerticesCount(){const w=this.getData();return w?Array.isArray(w)?w.length/(this.byteStride/4)-this.byteOffset/4:(w.byteLength-this.byteOffset)/this.byteStride:0}constructor(w,o,H,h,E,X,L,A,y,z){let C=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Q=arguments.length>11&&void 0!==arguments[11]&&arguments[11],M=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,i=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let s=!1;if(this.Mo=w,"object"===typeof h&&null!==h?(s=h.updatable??!1,E=h.postponeInternalCreation,X=h.stride,L=h.instanced,A=h.offset,y=h.size,z=h.type,C=h.normalized??!1,Q=h.useBytes??!1,M=h.divisor??1,i=h.takeBufferOwnership??!1,this._label=h.label):s=!!h,o instanceof D?(this._buffer=o,this._ownsBuffer=i):(this._buffer=new D(w,o,s,X,E,L,Q,M,this._label),this._ownsBuffer=!0),this.uniqueId=t._Counter++,this._kind=H,void 0===z){const w=this.getData();this.type=w?t.GetDataType(w):t.FLOAT}else this.type=z;const V=(0,e.m)(this.type);Q?(this._size=y||(X?X/V:t.DeduceStride(H)),this.byteStride=X||this._buffer.byteStride||this._size*V,this.byteOffset=A||0):(this._size=y||X||t.DeduceStride(H),this.byteStride=X?X*V:this._buffer.byteStride||this._size*V,this.byteOffset=(A||0)*V),this.normalized=C,this._instanced=void 0!==L&&L,this._instanceDivisor=L?M:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var w;null===(w=this._buffer)||void 0===w||w._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(w,o){const H=this.getData();return H?(0,e.l)(H,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,w,o):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,e.m)(this.type)}getOffset(){return this.byteOffset/(0,e.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,e.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(w){this._buffer.create(w),this._alignBuffer()}update(w){this._buffer.update(w),this._alignBuffer()}updateDirectly(w,o){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(w,o,void 0,H),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(w,o){(0,e.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,w,this.normalized,((w,H)=>{for(let h=0;h<this._size;h++)o(w[h],H+h)}))}_alignBuffer(){}static DeduceStride(w){switch(w){case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:return 2;case t.NormalKind:case t.PositionKind:return 3;case t.ColorKind:case t.ColorInstanceKind:case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:case t.TangentKind:return 4;default:throw new Error("Invalid kind '"+w+"'")}}static GetDataType(w){return w instanceof Int8Array?t.BYTE:w instanceof Uint8Array?t.UNSIGNED_BYTE:w instanceof Int16Array?t.SHORT:w instanceof Uint16Array?t.UNSIGNED_SHORT:w instanceof Int32Array?t.INT:w instanceof Uint32Array?t.UNSIGNED_INT:t.FLOAT}static GetTypeByteLength(w){return(0,e.m)(w)}static ForEach(w,o,H,h,E,D,t,X){(0,e.i)(w,o,H,h,E,D,t,((w,o)=>{for(let H=0;H<h;H++)X(w[H],o+H)}))}static GetFloatData(w,o,H,h,E,D,t,X){return(0,e.l)(w,o,H,h,E,D,t,X)}}t._Counter=0,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.PositionKind="position",t.NormalKind="normal",t.TangentKind="tangent",t.UVKind="uv",t.UV2Kind="uv2",t.UV3Kind="uv3",t.UV4Kind="uv4",t.UV5Kind="uv5",t.UV6Kind="uv6",t.ColorKind="color",t.ColorInstanceKind="instanceColor",t.MatricesIndicesKind="matricesIndices",t.MatricesWeightsKind="matricesWeights",t.MatricesIndicesExtraKind="matricesIndicesExtra",t.MatricesWeightsExtraKind="matricesWeightsExtra"},11794:(w,o,H)=>{H.d(o,{c:()=>z,f:()=>y,i:()=>X,l:()=>L,m:()=>D,q:()=>t,t:()=>A});var h=H(11551);function E(w,o,H,h){switch(o){case 5120:{let o=w.getInt8(H);return h&&(o=Math.max(o/127,-1)),o}case 5121:{let o=w.getUint8(H);return h&&(o/=255),o}case 5122:{let o=w.getInt16(H,!0);return h&&(o=Math.max(o/32767,-1)),o}case 5123:{let o=w.getUint16(H,!0);return h&&(o/=65535),o}case 5124:return w.getInt32(H,!0);case 5125:return w.getUint32(H,!0);case 5126:return w.getFloat32(H,!0);default:throw new Error(`Invalid component type ${o}`)}}function e(w,o,H,h,E){switch(o){case 5120:h&&(E=Math.round(127*E)),w.setInt8(H,E);break;case 5121:h&&(E=Math.round(255*E)),w.setUint8(H,E);break;case 5122:h&&(E=Math.round(32767*E)),w.setInt16(H,E,!0);break;case 5123:h&&(E=Math.round(65535*E)),w.setUint16(H,E,!0);break;case 5124:w.setInt32(H,E,!0);break;case 5125:w.setUint32(H,E,!0);break;case 5126:w.setFloat32(H,E,!0);break;default:throw new Error(`Invalid component type ${o}`)}}function D(w){switch(w){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${w}'`)}}function t(w){switch(w){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${w}'`)}}function X(w,o,H,h,t,X,L,A){const y=new Array(h),z=new Array(h);if(w instanceof Array){let E=o/4;const e=H/4;for(let o=0;o<X;o+=h){for(let o=0;o<h;o++)y[o]=z[o]=w[E+o];A(z,o);for(let o=0;o<h;o++)y[o]!==z[o]&&(w[E+o]=z[o]);E+=e}}else{const C=ArrayBuffer.isView(w)?new DataView(w.buffer,w.byteOffset,w.byteLength):new DataView(w),Q=D(t);for(let w=0;w<X;w+=h){for(let w=0,H=o;w<h;w++,H+=Q)y[w]=z[w]=E(C,t,H,L);A(z,w);for(let w=0,H=o;w<h;w++,H+=Q)y[w]!==z[w]&&e(C,t,H,L,z[w]);o+=H}}}function L(w,o,H,E,e,t,L,A){const y=o*D(H),z=L*o;if(5126!==H||e!==y){const h=new Float32Array(z);return X(w,E,e,o,H,z,t,((w,H)=>{for(let E=0;E<o;E++)h[H+E]=w[E]})),h}if(!(w instanceof Array||w instanceof Float32Array)||0!==E||w.length!==z){if(w instanceof Array){const o=E/4;return w.slice(o,o+z)}if(w instanceof ArrayBuffer)return new Float32Array(w,E,z);{const o=w.byteOffset+E;return 0!==(3&o)&&(h.d.Warn("Float array must be aligned to 4-bytes border"),A=!0),A?new Float32Array(w.buffer.slice(o,o+z*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(w.buffer,o,z)}}return A?w.slice():w}function A(w,o,H,E,e,L,A,y){const z=D(H),C=t(H),Q=A*o;if(Array.isArray(w)){if(0!==(3&E)||0!==(3&e))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const h=E/4,D=e/4;if(h+(A-1)*D+o>w.length)throw new Error("Last accessed index is out of bounds.");if(D<o)throw new Error("Data stride cannot be smaller than the component size.");if(D!==o){const h=new C(Q);return X(w,E,e,o,H,Q,L,((w,H)=>{for(let E=0;E<o;E++)h[H+E]=w[E]})),h}return new C(w.slice(h,h+Q))}let M,i=E;w instanceof ArrayBuffer?M=w:(M=w.buffer,i+=w.byteOffset);if(i+(A-1)*e+o*z>M.byteLength)throw new Error("Last accessed byte is out of bounds.");const s=o*z;if(e<s)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(e!==s){const w=new C(Q);return X(M,i,e,o,H,Q,L,((H,h)=>{for(let E=0;E<o;E++)w[h+E]=H[E]})),w}return 1!==z&&0!==(i&z-1)&&(h.d.Warn("Array must be aligned to border of element size. Data will be copied."),y=!0),y?new C(M.slice(i,i+Q*z)):new C(M,i,Q)}function y(w,o,H,E,e,t,L,A){const y=o*D(H),z=L*o;if(A.length!==z)throw new Error("Output length is not valid");if(5126===H&&e===y)if(w instanceof Array){const o=E/4;A.set(w,o)}else if(w instanceof ArrayBuffer){const o=new Float32Array(w,E,z);A.set(o)}else{const o=w.byteOffset+E;if(0!==(3&o))return h.d.Warn("Float array must be aligned to 4-bytes border"),void A.set(new Float32Array(w.buffer.slice(o,o+z*Float32Array.BYTES_PER_ELEMENT)));const H=new Float32Array(w.buffer,o,z);A.set(H)}else X(w,E,e,o,H,z,t,((w,H)=>{for(let h=0;h<o;h++)A[H+h]=w[h]}))}function z(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(w)){for(let E=0;E<o;E++)if(w[H+E]-h>65535)return!0;return!1}return 4===w.BYTES_PER_ELEMENT}},11785:(w,o,H)=>{H.d(o,{b:()=>h});class h{get underlyingResource(){return null}constructor(){this.references=0,this.no=0,this.is32Bits=!1,this.uniqueId=h._Counter++}}h._Counter=0},11831:(w,o,H)=>{H.d(o,{e:()=>E});var h=H(11606);class E{static GetEffect(w){return void 0===w.getPipelineContext?w.effect:w}constructor(w){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=w.createDrawContext(),o&&(this.materialContext=w.createMaterialContext())}setEffect(w,o){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var h;(this.effect=w,void 0!==o&&(this.defines=o),H)&&(null===(h=this.drawContext)||void 0===h||h.reset())}dispose(){var w;let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const w=this.effect;o?w.dispose():h.d.SetImmediate((()=>{w.getEngine().onEndFrameObservable.addOnce((()=>{w.dispose()}))})),this.effect=null}null===(w=this.drawContext)||void 0===w||w.dispose()}}},11917:(w,o,H)=>{H.d(o,{c:()=>E});var h=H(11766);class E{static GetPlanes(w){const o=[];for(let H=0;H<6;H++)o.push(new h.c(0,0,0,0));return E.GetPlanesToRef(w,o),o}static GetNearPlaneToRef(w,o){const H=w.m;o.normal.x=H[3]+H[2],o.normal.y=H[7]+H[6],o.normal.z=H[11]+H[10],o.d=H[15]+H[14],o.normalize()}static GetFarPlaneToRef(w,o){const H=w.m;o.normal.x=H[3]-H[2],o.normal.y=H[7]-H[6],o.normal.z=H[11]-H[10],o.d=H[15]-H[14],o.normalize()}static GetLeftPlaneToRef(w,o){const H=w.m;o.normal.x=H[3]+H[0],o.normal.y=H[7]+H[4],o.normal.z=H[11]+H[8],o.d=H[15]+H[12],o.normalize()}static GetRightPlaneToRef(w,o){const H=w.m;o.normal.x=H[3]-H[0],o.normal.y=H[7]-H[4],o.normal.z=H[11]-H[8],o.d=H[15]-H[12],o.normalize()}static GetTopPlaneToRef(w,o){const H=w.m;o.normal.x=H[3]-H[1],o.normal.y=H[7]-H[5],o.normal.z=H[11]-H[9],o.d=H[15]-H[13],o.normalize()}static GetBottomPlaneToRef(w,o){const H=w.m;o.normal.x=H[3]+H[1],o.normal.y=H[7]+H[5],o.normal.z=H[11]+H[9],o.d=H[15]+H[13],o.normalize()}static GetPlanesToRef(w,o){E.GetNearPlaneToRef(w,o[0]),E.GetFarPlaneToRef(w,o[1]),E.GetLeftPlaneToRef(w,o[2]),E.GetRightPlaneToRef(w,o[3]),E.GetTopPlaneToRef(w,o[4]),E.GetBottomPlaneToRef(w,o[5])}static IsPointInFrustum(w,o){for(let H=0;H<6;H++)if(o[H].dotCoordinate(w)<0)return!1;return!0}}},11929:(w,o,H)=>{H.d(o,{e:()=>E});var h=H(11560);class E{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(w,o){E.Enabled&&(this._current+=w,o&&this._fetchResult())}beginMonitoring(){E.Enabled&&(this._startMonitoringTime=h.c.Now)}endMonitoring(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!E.Enabled)return;w&&this.fetchNewFrame();const o=h.c.Now;this._current=o-this._startMonitoringTime,w&&this._fetchResult()}xh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const w=h.c.Now;w-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=w,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}E.Enabled=!0},11807:(w,o,H)=>{H.d(o,{e:()=>E,f:()=>h});class h{constructor(w){this.length=0,this.data=new Array(w),this._id=h._GlobalId++}push(w){this.data[this.length++]=w,this.length>this.data.length&&(this.data.length*=2)}forEach(w){for(let o=0;o<this.length;o++)w(this.data[o])}sort(w){this.data.sort(w)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(w){if(0!==w.length){this.length+w.length>this.data.length&&(this.data.length=2*(this.length+w.length));for(let o=0;o<w.length;o++)this.data[this.length++]=(w.data||w)[o]}}indexOf(w){const o=this.data.indexOf(w);return o>=this.length?-1:o}contains(w){return-1!==this.indexOf(w)}}h._GlobalId=0;class E extends h{constructor(){super(...arguments),this._duplicateId=0}push(w){super.push(w),w.__smartArrayFlags||(w.__smartArrayFlags={}),w.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(w){return(!w.__smartArrayFlags||w.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(w),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(w){if(0!==w.length){this.length+w.length>this.data.length&&(this.data.length=2*(this.length+w.length));for(let o=0;o<w.length;o++){const H=(w.data||w)[o];this.pushNoDuplicate(H)}}}}},11777:(w,o,H)=>{H.d(o,{c:()=>e});var h=H(11780),E=H(11540);class e{constructor(w){this._vertexBuffers={},this.onBeforeRenderObservable=new E.b,this._scene=w}_prepareBuffers(){if(this._vertexBuffers[h.e.PositionKind])return;const w=[];w.push(1,1),w.push(-1,1),w.push(-1,-1),w.push(1,-1),this._vertexBuffers[h.e.PositionKind]=new h.e(this._scene.getEngine(),w,h.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const w=[];w.push(0),w.push(1),w.push(2),w.push(0),w.push(2),w.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(w)}_rebuild(){const w=this._vertexBuffers[h.e.PositionKind];w&&(w._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let w=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this._scene.activeCamera;return!!H&&(o=o||H._postProcesses.filter((w=>null!=w)),!(!o||0===o.length||!this._scene.postProcessesEnabled)&&(o[0].activate(H,w,null!==o&&void 0!==o),!0))}directRender(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5],D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:w.length;const t=this._scene.getEngine();for(let L=0;L<D;L++){var X;if(L<w.length-1)w[L+1].activate(this._scene.activeCamera||this._scene,null===o||void 0===o?void 0:o.texture);else o?t.bindFramebuffer(o,h,void 0,void 0,H,E):e||t.restoreDefaultFramebuffer(),null===(X=t._debugInsertMarker)||void 0===X||X.call(t,`post process ${w[L].name} output`);const D=w[L],A=D.apply();A&&(D.onBeforeRenderObservable.notifyObservers(A),this._prepareBuffers(),t.bindBuffers(this._vertexBuffers,this._indexBuffer,A),t.drawElementsType(0,0,6),D.onAfterRenderObservable.notifyObservers(A))}t.setDepthBuffer(!0),t.setDepthWrite(!0)}_finalizeFrame(w,o,H,h){let E=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const e=this._scene.activeCamera;if(!e)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(h=h||e._postProcesses.filter((w=>null!=w))).length||!this._scene.postProcessesEnabled)return;const D=this._scene.getEngine();for(let X=0,L=h.length;X<L;X++){const A=h[X];var t;if(X<L-1)A._outputTexture=h[X+1].activate(e,null===o||void 0===o?void 0:o.texture);else o?(D.bindFramebuffer(o,H,void 0,void 0,E),A._outputTexture=o):(D.restoreDefaultFramebuffer(),A._outputTexture=null),null===(t=D._debugInsertMarker)||void 0===t||t.call(D,`post process ${h[X].name} output`);if(w)break;const y=A.apply();y&&(A.onBeforeRenderObservable.notifyObservers(y),this._prepareBuffers(),D.bindBuffers(this._vertexBuffers,this._indexBuffer,y),D.drawElementsType(0,0,6),A.onAfterRenderObservable.notifyObservers(y))}D.setDepthBuffer(!0),D.setDepthWrite(!0),D.setAlphaMode(0)}dispose(){const w=this._vertexBuffers[h.e.PositionKind];w&&(w.dispose(),this._vertexBuffers[h.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11802:(w,o,H)=>{H.d(o,{d:()=>t});var h=H(11807),E=H(11720);class e{set opaqueSortCompareFn(w){this._opaqueSortCompareFn=w||e.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(w){this._alphaTestSortCompareFn=w||e.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(w){this._transparentSortCompareFn=w||e.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(w,o){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,E=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=w,this._opaqueSubMeshes=new h.f(256),this._transparentSubMeshes=new h.f(256),this._alphaTestSubMeshes=new h.f(256),this._depthOnlySubMeshes=new h.f(256),this._particleSystems=new h.f(256),this._spriteManagers=new h.f(256),this._empty=!0,this._edgesRenderers=new h.e(16),this._scene=o,this.opaqueSortCompareFn=H,this.alphaTestSortCompareFn=E,this.transparentSortCompareFn=e}render(w,o,H,h){if(w)return void w(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const E=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(E.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),E.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const e=E.getStencilBuffer();if(E.setStencilBuffer(!1),o&&this._renderSprites(),H&&this._renderParticles(h),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(E.setStencilBuffer(e),this._scene.useOrderIndependentTransparency){const w=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);w.length&&this._renderTransparent(w)}else this._renderTransparent(this._transparentSubMeshes);E.setAlphaMode(0)}if(E.setStencilBuffer(!1),this._edgesRenderers.length){for(let w=0;w<this._edgesRenderers.length;w++)this._edgesRenderers.data[w].render();E.setAlphaMode(0)}E.setStencilBuffer(e)}_renderOpaqueSorted(w){e._RenderSorted(w,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(w){e._RenderSorted(w,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(w){e._RenderSorted(w,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(w,o,H,h){let D,t=0;const X=H?H.globalPosition:e._ZeroVector;if(h)for(;t<w.length;t++)D=w.data[t],D._alphaIndex=D.getMesh().alphaIndex,D._distanceToCamera=E.io.Distance(D.getBoundingInfo().boundingSphere.centerWorld,X);const L=w.length===w.data.length?w.data:w.data.slice(0,w.length);o&&L.sort(o);const A=L[0].getMesh().Ow();for(t=0;t<L.length;t++)if(D=L[t],!A._activeMeshesFrozenButKeepClipping||D.isInFrustum(A._frustumPlanes)){if(h){const w=D.jw();if(w&&w.needDepthPrePass){const o=w.Ow().getEngine();o.setColorWrite(!1),o.setAlphaMode(0),D.render(!1),o.setColorWrite(!0)}}D.render(h)}}static defaultTransparentSortCompare(w,o){return w._alphaIndex>o._alphaIndex?1:w._alphaIndex<o._alphaIndex?-1:e.backToFrontSortCompare(w,o)}static backToFrontSortCompare(w,o){return w._distanceToCamera<o._distanceToCamera?1:w._distanceToCamera>o._distanceToCamera?-1:0}static frontToBackSortCompare(w,o){return w._distanceToCamera<o._distanceToCamera?-1:w._distanceToCamera>o._distanceToCamera?1:0}static PainterSortCompare(w,o){const H=w.getMesh(),h=o.getMesh();return H.material&&h.material?H.material.uniqueId-h.material.uniqueId:H.uniqueId-h.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(w,o,H){void 0===o&&(o=w.getMesh()),void 0===H&&(H=w.jw()),null!==H&&void 0!==H&&(H.needAlphaBlendingForMesh(o)?this._transparentSubMeshes.push(w):H.needAlphaTestingForMesh(o)?(H.needDepthPrePass&&this._depthOnlySubMeshes.push(w),this._alphaTestSubMeshes.push(w)):(H.needDepthPrePass&&this._depthOnlySubMeshes.push(w),this._opaqueSubMeshes.push(w)),o._renderingGroup=this,o._edgesRenderer&&o.isEnabled()&&o.isVisible&&o._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(o._edgesRenderer),this._empty=!1)}dispatchSprites(w){this._spriteManagers.push(w),this._empty=!1}dispatchParticles(w){this._particleSystems.push(w),this._empty=!1}_renderParticles(w){if(0===this._particleSystems.length)return;const o=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let H=0;H<this._particleSystems.length;H++){const h=this._particleSystems.data[H];if(0===(o&&o.layerMask&h.layerMask))continue;const E=h.Eo;E.position&&w&&-1===w.indexOf(E)||this._scene._activeParticles.addCount(h.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const w=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let o=0;o<this._spriteManagers.length;o++){const H=this._spriteManagers.data[o];0!==(w&&w.layerMask&H.layerMask)&&H.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}e._ZeroVector=E.io.Zero();class D{}class t{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(w){w!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=w,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const w of this._scene.meshes)if(w.Le)for(const o of w.Le)o._wasDispatched=!1;if(this._scene.spriteManagers)for(const w of this._scene.spriteManagers)w._wasDispatched=!1;for(const w of this._scene.Ez)w._wasDispatched=!1}constructor(w){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new D,this._maintainStateBetweenFrames=!1,this._scene=w;for(let o=t.MIN_RENDERINGGROUPS;o<t.MAX_RENDERINGGROUPS;o++)this._autoClearDepthStencil[o]={Xe:!0,depth:!0,stencil:!0}}getRenderingGroup(w){const o=w||0;return this._prepareRenderingGroup(o),this._renderingGroups[o]}_clearDepthStencilBuffer(){let w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,w,o),this._depthStencilBufferAlreadyCleaned=!0)}render(w,o,H,h){const E=this._renderingGroupInfo;if(E.Vo=this._scene,E.camera=this._scene.activeCamera,E.renderingManager=this,this._scene.spriteManagers&&h)for(let e=0;e<this._scene.spriteManagers.length;e++){const w=this._scene.spriteManagers[e];this.dispatchSprites(w)}for(let e=t.MIN_RENDERINGGROUPS;e<t.MAX_RENDERINGGROUPS;e++){this._depthStencilBufferAlreadyCleaned=e===t.MIN_RENDERINGGROUPS;const D=this._renderingGroups[e];if(!D||D._empty)continue;const X=1<<e;if(E.renderingGroupId=e,this._scene.onBeforeRenderingGroupObservable.notifyObservers(E,X),t.AUTOCLEAR){const w=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(e):this._autoClearDepthStencil[e];w&&w.Xe&&this._clearDepthStencilBuffer(w.depth,w.stencil)}for(const w of this._scene._beforeRenderingGroupDrawStage)w.action(e);D.render(w,h,H,o);for(const w of this._scene._afterRenderingGroupDrawStage)w.action(e);this._scene.onAfterRenderingGroupObservable.notifyObservers(E,X)}}reset(){if(!this.maintainStateBetweenFrames)for(let w=t.MIN_RENDERINGGROUPS;w<t.MAX_RENDERINGGROUPS;w++){const o=this._renderingGroups[w];o&&o.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let w=t.MIN_RENDERINGGROUPS;w<t.MAX_RENDERINGGROUPS;w++){const o=this._renderingGroups[w];o&&o.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let w=t.MIN_RENDERINGGROUPS;w<t.MAX_RENDERINGGROUPS;w++){const o=this._renderingGroups[w];o&&o.dispose()}}_prepareRenderingGroup(w){void 0===this._renderingGroups[w]&&(this._renderingGroups[w]=new e(w,this._scene,this._customOpaqueSortCompareFn[w],this._customAlphaTestSortCompareFn[w],this._customTransparentSortCompareFn[w]))}dispatchSprites(w){this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(w.renderingGroupId).dispatchSprites(w))}dispatchParticles(w){this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(w.renderingGroupId).dispatchParticles(w))}dispatch(w,o,H){void 0===o&&(o=w.getMesh()),this.maintainStateBetweenFrames&&w._wasDispatched||(w._wasDispatched=!0,this.getRenderingGroup(o.renderingGroupId).dispatch(w,o,H))}setRenderingOrder(w){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[w]=o,this._customAlphaTestSortCompareFn[w]=H,this._customTransparentSortCompareFn[w]=h,this._renderingGroups[w]){const o=this._renderingGroups[w];o.opaqueSortCompareFn=this._customOpaqueSortCompareFn[w],o.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[w],o.transparentSortCompareFn=this._customTransparentSortCompareFn[w]}}setRenderingAutoClearDepthStencil(w,o){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[w]={Xe:o,depth:H,stencil:h}}getAutoClearDepthStencilSetup(w){return this._autoClearDepthStencil[w]}}t.MAX_RENDERINGGROUPS=4,t.MIN_RENDERINGGROUPS=0,t.AUTOCLEAR=!0}}]);