"use strict";(self["80dd64vgxnn"]=self["80dd64vgxnn"]||[]).push([[19],{12809:(mm,o,u)=>{u.d(o,{c:()=>r,f:()=>w});var f=u(12818),B=u(12565),O=u(12824);class r{get q(){return this._isDisposed}constructor(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,mm&&mm.Pm?this._engine=mm.Pm().getEngine():this._engine=mm,this._updatable=u,this._instanced=r,this._divisor=p||1,this._label=K,o instanceof f.b?(this._data=null,this._buffer=o):(this._data=o,this._buffer=null),this.byteStride=w?B:B*Float32Array.BYTES_PER_ELEMENT,O||this.create()}createVertexBuffer(mm,o,u,f,B){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6?arguments[6]:void 0;const p=O?o:o*Float32Array.BYTES_PER_ELEMENT,K=f?O?f:f*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new w(this._engine,this,mm,this._updatable,!0,K,void 0===B?this._instanced:B,p,u,void 0,void 0,!0,this._divisor||r)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!mm&&this._buffer||(mm=mm||this._data,mm&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,mm),this._data=mm):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(mm,this._label),this._data=mm):this._buffer=this._engine.createVertexBuffer(mm,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Mp>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Mp,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Mp,void 0,this._label));B.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(mm){this.create(mm)}updateDirectly(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,mm,f?o:o*Float32Array.BYTES_PER_ELEMENT,u?u*this.byteStride:void 0),this._data=0===o&&void 0===u?mm:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class w{get q(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(mm){const o=0!=mm;this._instanceDivisor=mm,o!==this._instanced&&(this._instanced=o,this._computeHashCode())}get _maxVerticesCount(){const mm=this.getData();return mm?Array.isArray(mm)?mm.length/(this.byteStride/4)-this.byteOffset/4:(mm.byteLength-this.byteOffset)/this.byteStride:0}constructor(mm,o,u,f,B,p,K,z,Y,q){let x=arguments.length>10&&void 0!==arguments[10]&&arguments[10],H=arguments.length>11&&void 0!==arguments[11]&&arguments[11],E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,M=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let l=!1;if(this.Mo=mm,"object"===typeof f&&null!==f?(l=f.updatable??!1,B=f.postponeInternalCreation,p=f.stride,K=f.instanced,z=f.offset,Y=f.size,q=f.type,x=f.normalized??!1,H=f.useBytes??!1,E=f.divisor??1,M=f.takeBufferOwnership??!1,this._label=f.label):l=!!f,o instanceof r?(this._buffer=o,this._ownsBuffer=M):(this._buffer=new r(mm,o,l,p,B,K,H,E,this._label),this._ownsBuffer=!0),this.uniqueId=w._Counter++,this._kind=u,void 0===q){const mm=this.getData();this.type=mm?w.GetDataType(mm):w.FLOAT}else this.type=q;const t=(0,O.k)(this.type);H?(this._size=Y||(p?p/t:w.DeduceStride(u)),this.byteStride=p||this._buffer.byteStride||this._size*t,this.byteOffset=z||0):(this._size=Y||p||w.DeduceStride(u),this.byteStride=p?p*t:this._buffer.byteStride||this._size*t,this.byteOffset=(z||0)*t),this.normalized=x,this._instanced=void 0!==K&&K,this._instanceDivisor=K?E:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var mm;null===(mm=this._buffer)||void 0===mm||mm._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(mm,o){const u=this.getData();return u?(0,O.g)(u,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,mm,o):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,O.k)(this.type)}getOffset(){return this.byteOffset/(0,O.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,O.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(mm){this._buffer.create(mm),this._alignBuffer()}update(mm){this._buffer.update(mm),this._alignBuffer()}updateDirectly(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(mm,o,void 0,u),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(mm,o){(0,O.f)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,mm,this.normalized,((mm,u)=>{for(let f=0;f<this._size;f++)o(mm[f],u+f)}))}_alignBuffer(){}static DeduceStride(mm){switch(mm){case w.UVKind:case w.UV2Kind:case w.UV3Kind:case w.UV4Kind:case w.UV5Kind:case w.UV6Kind:return 2;case w.NormalKind:case w.PositionKind:return 3;case w.ColorKind:case w.ColorInstanceKind:case w.MatricesIndicesKind:case w.MatricesIndicesExtraKind:case w.MatricesWeightsKind:case w.MatricesWeightsExtraKind:case w.TangentKind:return 4;default:throw new Error("Invalid kind '"+mm+"'")}}static GetDataType(mm){return mm instanceof Int8Array?w.BYTE:mm instanceof Uint8Array?w.UNSIGNED_BYTE:mm instanceof Int16Array?w.SHORT:mm instanceof Uint16Array?w.UNSIGNED_SHORT:mm instanceof Int32Array?w.INT:mm instanceof Uint32Array?w.UNSIGNED_INT:w.FLOAT}static GetTypeByteLength(mm){return(0,O.k)(mm)}static ForEach(mm,o,u,f,B,r,w,p){(0,O.f)(mm,o,u,f,B,r,w,((mm,o)=>{for(let u=0;u<f;u++)p(mm[u],o+u)}))}static GetFloatData(mm,o,u,f,B,r,w,p){return(0,O.g)(mm,o,u,f,B,r,w,p)}}w._Counter=0,w.BYTE=5120,w.UNSIGNED_BYTE=5121,w.SHORT=5122,w.UNSIGNED_SHORT=5123,w.INT=5124,w.UNSIGNED_INT=5125,w.FLOAT=5126,w.PositionKind="position",w.NormalKind="normal",w.TangentKind="tangent",w.UVKind="uv",w.UV2Kind="uv2",w.UV3Kind="uv3",w.UV4Kind="uv4",w.UV5Kind="uv5",w.UV6Kind="uv6",w.ColorKind="color",w.ColorInstanceKind="instanceColor",w.MatricesIndicesKind="matricesIndices",w.MatricesWeightsKind="matricesWeights",w.MatricesIndicesExtraKind="matricesIndicesExtra",w.MatricesWeightsExtraKind="matricesWeightsExtra"},12824:(mm,o,u)=>{u.d(o,{c:()=>q,e:()=>Y,f:()=>p,g:()=>K,k:()=>r,l:()=>w,n:()=>z});var f=u(12565);function B(mm,o,u,f){switch(o){case 5120:{let o=mm.getInt8(u);return f&&(o=Math.max(o/127,-1)),o}case 5121:{let o=mm.getUint8(u);return f&&(o/=255),o}case 5122:{let o=mm.getInt16(u,!0);return f&&(o=Math.max(o/32767,-1)),o}case 5123:{let o=mm.getUint16(u,!0);return f&&(o/=65535),o}case 5124:return mm.getInt32(u,!0);case 5125:return mm.getUint32(u,!0);case 5126:return mm.getFloat32(u,!0);default:throw new Error(`Invalid component type ${o}`)}}function O(mm,o,u,f,B){switch(o){case 5120:f&&(B=Math.round(127*B)),mm.setInt8(u,B);break;case 5121:f&&(B=Math.round(255*B)),mm.setUint8(u,B);break;case 5122:f&&(B=Math.round(32767*B)),mm.setInt16(u,B,!0);break;case 5123:f&&(B=Math.round(65535*B)),mm.setUint16(u,B,!0);break;case 5124:mm.setInt32(u,B,!0);break;case 5125:mm.setUint32(u,B,!0);break;case 5126:mm.setFloat32(u,B,!0);break;default:throw new Error(`Invalid component type ${o}`)}}function r(mm){switch(mm){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${mm}'`)}}function w(mm){switch(mm){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${mm}'`)}}function p(mm,o,u,f,w,p,K,z){const Y=new Array(f),q=new Array(f);if(mm instanceof Array){let B=o/4;const O=u/4;for(let o=0;o<p;o+=f){for(let o=0;o<f;o++)Y[o]=q[o]=mm[B+o];z(q,o);for(let o=0;o<f;o++)Y[o]!==q[o]&&(mm[B+o]=q[o]);B+=O}}else{const x=ArrayBuffer.isView(mm)?new DataView(mm.buffer,mm.byteOffset,mm.byteLength):new DataView(mm),H=r(w);for(let mm=0;mm<p;mm+=f){for(let mm=0,u=o;mm<f;mm++,u+=H)Y[mm]=q[mm]=B(x,w,u,K);z(q,mm);for(let mm=0,u=o;mm<f;mm++,u+=H)Y[mm]!==q[mm]&&O(x,w,u,K,q[mm]);o+=u}}}function K(mm,o,u,B,O,w,K,z){const Y=o*r(u),q=K*o;if(5126!==u||O!==Y){const f=new Float32Array(q);return p(mm,B,O,o,u,q,w,((mm,u)=>{for(let B=0;B<o;B++)f[u+B]=mm[B]})),f}if(!(mm instanceof Array||mm instanceof Float32Array)||0!==B||mm.length!==q){if(mm instanceof Array){const o=B/4;return mm.slice(o,o+q)}if(mm instanceof ArrayBuffer)return new Float32Array(mm,B,q);{const o=mm.byteOffset+B;return 0!==(3&o)&&(f.e.Warn("Float array must be aligned to 4-bytes border"),z=!0),z?new Float32Array(mm.buffer.slice(o,o+q*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(mm.buffer,o,q)}}return z?mm.slice():mm}function z(mm,o,u,B,O,K,z,Y){const q=r(u),x=w(u),H=z*o;if(Array.isArray(mm)){if(0!==(3&B)||0!==(3&O))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const f=B/4,r=O/4;if(f+(z-1)*r+o>mm.length)throw new Error("Last accessed index is out of bounds.");if(r<o)throw new Error("Data stride cannot be smaller than the component size.");if(r!==o){const f=new x(H);return p(mm,B,O,o,u,H,K,((mm,u)=>{for(let B=0;B<o;B++)f[u+B]=mm[B]})),f}return new x(mm.slice(f,f+H))}let E,M=B;mm instanceof ArrayBuffer?E=mm:(E=mm.buffer,M+=mm.byteOffset);if(M+(z-1)*O+o*q>E.byteLength)throw new Error("Last accessed byte is out of bounds.");const l=o*q;if(O<l)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(O!==l){const mm=new x(H);return p(E,M,O,o,u,H,K,((u,f)=>{for(let B=0;B<o;B++)mm[f+B]=u[B]})),mm}return 1!==q&&0!==(M&q-1)&&(f.e.Warn("Array must be aligned to border of element size. Data will be copied."),Y=!0),Y?new x(E.slice(M,M+H*q)):new x(E,M,H)}function Y(mm,o,u,B,O,w,K,z){const Y=o*r(u),q=K*o;if(z.length!==q)throw new Error("Output length is not valid");if(5126===u&&O===Y)if(mm instanceof Array){const o=B/4;z.set(mm,o)}else if(mm instanceof ArrayBuffer){const o=new Float32Array(mm,B,q);z.set(o)}else{const o=mm.byteOffset+B;if(0!==(3&o))return f.e.Warn("Float array must be aligned to 4-bytes border"),void z.set(new Float32Array(mm.buffer.slice(o,o+q*Float32Array.BYTES_PER_ELEMENT)));const u=new Float32Array(mm.buffer,o,q);z.set(u)}else p(mm,B,O,o,u,q,w,((mm,u)=>{for(let f=0;f<o;f++)z[u+f]=mm[f]}))}function q(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(mm)){for(let B=0;B<o;B++)if(mm[u+B]-f>65535)return!0;return!1}return 4===mm.BYTES_PER_ELEMENT}},12818:(mm,o,u)=>{u.d(o,{b:()=>f});class f{get underlyingResource(){return null}constructor(){this.references=0,this.Mp=0,this.is32Bits=!1,this.uniqueId=f._Counter++}}f._Counter=0},12855:(mm,o,u)=>{u.d(o,{c:()=>B});var f=u(12634);class B{static GetEffect(mm){return void 0===mm.getPipelineContext?mm.effect:mm}constructor(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=mm.createDrawContext(),o&&(this.materialContext=mm.createMaterialContext())}setEffect(mm,o){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var f;(this.effect=mm,void 0!==o&&(this.defines=o),u)&&(null===(f=this.drawContext)||void 0===f||f.reset())}dispose(){var mm;let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const mm=this.effect;o?mm.dispose():f.c.SetImmediate((()=>{mm.getEngine().onEndFrameObservable.addOnce((()=>{mm.dispose()}))})),this.effect=null}null===(mm=this.drawContext)||void 0===mm||mm.dispose()}}},12926:(mm,o,u)=>{u.d(o,{c:()=>B});var f=u(12783);class B{static GetPlanes(mm){const o=[];for(let u=0;u<6;u++)o.push(new f.c(0,0,0,0));return B.GetPlanesToRef(mm,o),o}static GetNearPlaneToRef(mm,o){const u=mm.m;o.normal.x=u[3]+u[2],o.normal.y=u[7]+u[6],o.normal.z=u[11]+u[10],o.d=u[15]+u[14],o.normalize()}static GetFarPlaneToRef(mm,o){const u=mm.m;o.normal.x=u[3]-u[2],o.normal.y=u[7]-u[6],o.normal.z=u[11]-u[10],o.d=u[15]-u[14],o.normalize()}static GetLeftPlaneToRef(mm,o){const u=mm.m;o.normal.x=u[3]+u[0],o.normal.y=u[7]+u[4],o.normal.z=u[11]+u[8],o.d=u[15]+u[12],o.normalize()}static GetRightPlaneToRef(mm,o){const u=mm.m;o.normal.x=u[3]-u[0],o.normal.y=u[7]-u[4],o.normal.z=u[11]-u[8],o.d=u[15]-u[12],o.normalize()}static GetTopPlaneToRef(mm,o){const u=mm.m;o.normal.x=u[3]-u[1],o.normal.y=u[7]-u[5],o.normal.z=u[11]-u[9],o.d=u[15]-u[13],o.normalize()}static GetBottomPlaneToRef(mm,o){const u=mm.m;o.normal.x=u[3]+u[1],o.normal.y=u[7]+u[5],o.normal.z=u[11]+u[9],o.d=u[15]+u[13],o.normalize()}static GetPlanesToRef(mm,o){B.GetNearPlaneToRef(mm,o[0]),B.GetFarPlaneToRef(mm,o[1]),B.GetLeftPlaneToRef(mm,o[2]),B.GetRightPlaneToRef(mm,o[3]),B.GetTopPlaneToRef(mm,o[4]),B.GetBottomPlaneToRef(mm,o[5])}static IsPointInFrustum(mm,o){for(let u=0;u<6;u++)if(o[u].dotCoordinate(mm)<0)return!1;return!0}}},12940:(mm,o,u)=>{u.d(o,{e:()=>B});var f=u(12581);class B{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(mm,o){B.Enabled&&(this._current+=mm,o&&this._fetchResult())}beginMonitoring(){B.Enabled&&(this._startMonitoringTime=f.b.Now)}endMonitoring(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!B.Enabled)return;mm&&this.fetchNewFrame();const o=f.b.Now;this._current=o-this._startMonitoringTime,mm&&this._fetchResult()}bf(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const mm=f.b.Now;mm-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=mm,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}B.Enabled=!0},12832:(mm,o,u)=>{u.d(o,{d:()=>B,h:()=>f});class f{constructor(mm){this.length=0,this.data=new Array(mm),this._id=f._GlobalId++}push(mm){this.data[this.length++]=mm,this.length>this.data.length&&(this.data.length*=2)}forEach(mm){for(let o=0;o<this.length;o++)mm(this.data[o])}sort(mm){this.data.sort(mm)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(mm){if(0!==mm.length){this.length+mm.length>this.data.length&&(this.data.length=2*(this.length+mm.length));for(let o=0;o<mm.length;o++)this.data[this.length++]=(mm.data||mm)[o]}}indexOf(mm){const o=this.data.indexOf(mm);return o>=this.length?-1:o}contains(mm){return-1!==this.indexOf(mm)}}f._GlobalId=0;class B extends f{constructor(){super(...arguments),this._duplicateId=0}push(mm){super.push(mm),mm.__smartArrayFlags||(mm.__smartArrayFlags={}),mm.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(mm){return(!mm.__smartArrayFlags||mm.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(mm),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(mm){if(0!==mm.length){this.length+mm.length>this.data.length&&(this.data.length=2*(this.length+mm.length));for(let o=0;o<mm.length;o++){const u=(mm.data||mm)[o];this.pushNoDuplicate(u)}}}}},12804:(mm,o,u)=>{u.d(o,{b:()=>O});var f=u(12809),B=u(12556);class O{constructor(mm){this._vertexBuffers={},this.onBeforeRenderObservable=new B.d,this._scene=mm}_prepareBuffers(){if(this._vertexBuffers[f.f.PositionKind])return;const mm=[];mm.push(1,1),mm.push(-1,1),mm.push(-1,-1),mm.push(1,-1),this._vertexBuffers[f.f.PositionKind]=new f.f(this._scene.getEngine(),mm,f.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const mm=[];mm.push(0),mm.push(1),mm.push(2),mm.push(0),mm.push(2),mm.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(mm)}_rebuild(){const mm=this._vertexBuffers[f.f.PositionKind];mm&&(mm._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const u=this._scene.activeCamera;return!!u&&(o=o||u._postProcesses.filter((mm=>null!=mm)),!(!o||0===o.length||!this._scene.postProcessesEnabled)&&(o[0].activate(u,mm,null!==o&&void 0!==o),!0))}directRender(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]?arguments[6]:mm.length;const w=this._scene.getEngine();for(let K=0;K<r;K++){var p;if(K<mm.length-1)mm[K+1].activate(this._scene.activeCamera||this._scene,null===o||void 0===o?void 0:o.texture);else o?w.bindFramebuffer(o,f,void 0,void 0,u,B):O||w.restoreDefaultFramebuffer(),null===(p=w._debugInsertMarker)||void 0===p||p.call(w,`post process ${mm[K].name} output`);const r=mm[K],z=r.apply();z&&(r.onBeforeRenderObservable.notifyObservers(z),this._prepareBuffers(),w.bindBuffers(this._vertexBuffers,this._indexBuffer,z),w.drawElementsType(0,0,6),r.onAfterRenderObservable.notifyObservers(z))}w.setDepthBuffer(!0),w.setDepthWrite(!0)}_finalizeFrame(mm,o,u,f){let B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const O=this._scene.activeCamera;if(!O)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(f=f||O._postProcesses.filter((mm=>null!=mm))).length||!this._scene.postProcessesEnabled)return;const r=this._scene.getEngine();for(let p=0,K=f.length;p<K;p++){const z=f[p];var w;if(p<K-1)z._outputTexture=f[p+1].activate(O,null===o||void 0===o?void 0:o.texture);else o?(r.bindFramebuffer(o,u,void 0,void 0,B),z._outputTexture=o):(r.restoreDefaultFramebuffer(),z._outputTexture=null),null===(w=r._debugInsertMarker)||void 0===w||w.call(r,`post process ${f[p].name} output`);if(mm)break;const Y=z.apply();Y&&(z.onBeforeRenderObservable.notifyObservers(Y),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,Y),r.drawElementsType(0,0,6),z.onAfterRenderObservable.notifyObservers(Y))}r.setDepthBuffer(!0),r.setDepthWrite(!0),r.setAlphaMode(0)}dispose(){const mm=this._vertexBuffers[f.f.PositionKind];mm&&(mm.dispose(),this._vertexBuffers[f.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12830:(mm,o,u)=>{u.d(o,{c:()=>w});var f=u(12832),B=u(12740);class O{set opaqueSortCompareFn(mm){this._opaqueSortCompareFn=mm||O.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(mm){this._alphaTestSortCompareFn=mm||O.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(mm){this._transparentSortCompareFn=mm||O.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=mm,this._opaqueSubMeshes=new f.h(256),this._transparentSubMeshes=new f.h(256),this._alphaTestSubMeshes=new f.h(256),this._depthOnlySubMeshes=new f.h(256),this._particleSystems=new f.h(256),this._spriteManagers=new f.h(256),this._empty=!0,this._edgesRenderers=new f.d(16),this._scene=o,this.opaqueSortCompareFn=u,this.alphaTestSortCompareFn=B,this.transparentSortCompareFn=O}render(mm,o,u,f){if(mm)return void mm(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const B=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(B.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),B.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const O=B.getStencilBuffer();if(B.setStencilBuffer(!1),o&&this._renderSprites(),u&&this._renderParticles(f),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(B.setStencilBuffer(O),this._scene.useOrderIndependentTransparency){const mm=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);mm.length&&this._renderTransparent(mm)}else this._renderTransparent(this._transparentSubMeshes);B.setAlphaMode(0)}if(B.setStencilBuffer(!1),this._edgesRenderers.length){for(let mm=0;mm<this._edgesRenderers.length;mm++)this._edgesRenderers.data[mm].render();B.setAlphaMode(0)}B.setStencilBuffer(O)}_renderOpaqueSorted(mm){O._RenderSorted(mm,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(mm){O._RenderSorted(mm,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(mm){O._RenderSorted(mm,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(mm,o,u,f){let r,w=0;const p=u?u.globalPosition:O._ZeroVector;if(f)for(;w<mm.length;w++)r=mm.data[w],r._alphaIndex=r.getMesh().alphaIndex,r._distanceToCamera=B.lo.Distance(r.getBoundingInfo().boundingSphere.centerWorld,p);const K=mm.length===mm.data.length?mm.data:mm.data.slice(0,mm.length);o&&K.sort(o);const z=K[0].getMesh().Pm();for(w=0;w<K.length;w++)if(r=K[w],!z._activeMeshesFrozenButKeepClipping||r.isInFrustum(z._frustumPlanes)){if(f){const mm=r.Gm();if(mm&&mm.needDepthPrePass){const o=mm.Pm().getEngine();o.setColorWrite(!1),o.setAlphaMode(0),r.render(!1),o.setColorWrite(!0)}}r.render(f)}}static defaultTransparentSortCompare(mm,o){return mm._alphaIndex>o._alphaIndex?1:mm._alphaIndex<o._alphaIndex?-1:O.backToFrontSortCompare(mm,o)}static backToFrontSortCompare(mm,o){return mm._distanceToCamera<o._distanceToCamera?1:mm._distanceToCamera>o._distanceToCamera?-1:0}static frontToBackSortCompare(mm,o){return mm._distanceToCamera<o._distanceToCamera?-1:mm._distanceToCamera>o._distanceToCamera?1:0}static PainterSortCompare(mm,o){const u=mm.getMesh(),f=o.getMesh();return u.material&&f.material?u.material.uniqueId-f.material.uniqueId:u.uniqueId-f.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(mm,o,u){void 0===o&&(o=mm.getMesh()),void 0===u&&(u=mm.Gm()),null!==u&&void 0!==u&&(u.needAlphaBlendingForMesh(o)?this._transparentSubMeshes.push(mm):u.needAlphaTestingForMesh(o)?(u.needDepthPrePass&&this._depthOnlySubMeshes.push(mm),this._alphaTestSubMeshes.push(mm)):(u.needDepthPrePass&&this._depthOnlySubMeshes.push(mm),this._opaqueSubMeshes.push(mm)),o._renderingGroup=this,o._edgesRenderer&&o.isEnabled()&&o.isVisible&&o._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(o._edgesRenderer),this._empty=!1)}dispatchSprites(mm){this._spriteManagers.push(mm),this._empty=!1}dispatchParticles(mm){this._particleSystems.push(mm),this._empty=!1}_renderParticles(mm){if(0===this._particleSystems.length)return;const o=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let u=0;u<this._particleSystems.length;u++){const f=this._particleSystems.data[u];if(0===(o&&o.layerMask&f.layerMask))continue;const B=f.ro;B.position&&mm&&-1===mm.indexOf(B)||this._scene._activeParticles.addCount(f.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const mm=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let o=0;o<this._spriteManagers.length;o++){const u=this._spriteManagers.data[o];0!==(mm&&mm.layerMask&u.layerMask)&&u.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}O._ZeroVector=B.lo.Zero();class r{}class w{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(mm){mm!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=mm,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const mm of this._scene.meshes)if(mm.kf)for(const o of mm.kf)o._wasDispatched=!1;if(this._scene.spriteManagers)for(const mm of this._scene.spriteManagers)mm._wasDispatched=!1;for(const mm of this._scene.kq)mm._wasDispatched=!1}constructor(mm){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new r,this._maintainStateBetweenFrames=!1,this._scene=mm;for(let o=w.MIN_RENDERINGGROUPS;o<w.MAX_RENDERINGGROUPS;o++)this._autoClearDepthStencil[o]={Gf:!0,depth:!0,Nf:!0}}getRenderingGroup(mm){const o=mm||0;return this._prepareRenderingGroup(o),this._renderingGroups[o]}_clearDepthStencilBuffer(){let mm=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,mm,o),this._depthStencilBufferAlreadyCleaned=!0)}render(mm,o,u,f){const B=this._renderingGroupInfo;if(B.bo=this._scene,B.camera=this._scene.activeCamera,B.renderingManager=this,this._scene.spriteManagers&&f)for(let O=0;O<this._scene.spriteManagers.length;O++){const mm=this._scene.spriteManagers[O];this.dispatchSprites(mm)}for(let O=w.MIN_RENDERINGGROUPS;O<w.MAX_RENDERINGGROUPS;O++){this._depthStencilBufferAlreadyCleaned=O===w.MIN_RENDERINGGROUPS;const r=this._renderingGroups[O];if(!r||r._empty)continue;const p=1<<O;if(B.renderingGroupId=O,this._scene.onBeforeRenderingGroupObservable.notifyObservers(B,p),w.AUTOCLEAR){const mm=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(O):this._autoClearDepthStencil[O];mm&&mm.Gf&&this._clearDepthStencilBuffer(mm.depth,mm.Nf)}for(const mm of this._scene._beforeRenderingGroupDrawStage)mm.action(O);r.render(mm,f,u,o);for(const mm of this._scene._afterRenderingGroupDrawStage)mm.action(O);this._scene.onAfterRenderingGroupObservable.notifyObservers(B,p)}}reset(){if(!this.maintainStateBetweenFrames)for(let mm=w.MIN_RENDERINGGROUPS;mm<w.MAX_RENDERINGGROUPS;mm++){const o=this._renderingGroups[mm];o&&o.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let mm=w.MIN_RENDERINGGROUPS;mm<w.MAX_RENDERINGGROUPS;mm++){const o=this._renderingGroups[mm];o&&o.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let mm=w.MIN_RENDERINGGROUPS;mm<w.MAX_RENDERINGGROUPS;mm++){const o=this._renderingGroups[mm];o&&o.dispose()}}_prepareRenderingGroup(mm){void 0===this._renderingGroups[mm]&&(this._renderingGroups[mm]=new O(mm,this._scene,this._customOpaqueSortCompareFn[mm],this._customAlphaTestSortCompareFn[mm],this._customTransparentSortCompareFn[mm]))}dispatchSprites(mm){this.maintainStateBetweenFrames&&mm._wasDispatched||(mm._wasDispatched=!0,this.getRenderingGroup(mm.renderingGroupId).dispatchSprites(mm))}dispatchParticles(mm){this.maintainStateBetweenFrames&&mm._wasDispatched||(mm._wasDispatched=!0,this.getRenderingGroup(mm.renderingGroupId).dispatchParticles(mm))}dispatch(mm,o,u){void 0===o&&(o=mm.getMesh()),this.maintainStateBetweenFrames&&mm._wasDispatched||(mm._wasDispatched=!0,this.getRenderingGroup(o.renderingGroupId).dispatch(mm,o,u))}setRenderingOrder(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[mm]=o,this._customAlphaTestSortCompareFn[mm]=u,this._customTransparentSortCompareFn[mm]=f,this._renderingGroups[mm]){const o=this._renderingGroups[mm];o.opaqueSortCompareFn=this._customOpaqueSortCompareFn[mm],o.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[mm],o.transparentSortCompareFn=this._customTransparentSortCompareFn[mm]}}setRenderingAutoClearDepthStencil(mm,o){let u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[mm]={Gf:o,depth:u,Nf:f}}getAutoClearDepthStencilSetup(mm){return this._autoClearDepthStencil[mm]}}w.MAX_RENDERINGGROUPS=4,w.MIN_RENDERINGGROUPS=0,w.AUTOCLEAR=!0}}]);