"use strict";(self["9s4i8ue3jq"]=self["9s4i8ue3jq"]||[]).push([[19],{12882:(a,c,o)=>{o.d(c,{d:()=>i,g:()=>p});var s=o(12891),q=o(12649),t=o(12894);class i{get L(){return this._isDisposed}constructor(a,c,o){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7?arguments[7]:void 0,T=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,a&&a.Za?this._engine=a.Za().getEngine():this._engine=a,this._updatable=o,this._instanced=i,this._divisor=G||1,this._label=T,c instanceof s.c?(this._data=null,this._buffer=c):(this._data=c,this._buffer=null),this.byteStride=p?q:q*Float32Array.BYTES_PER_ELEMENT,t||this.create()}createVertexBuffer(a,c,o,s,q){let t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6?arguments[6]:void 0;const G=t?c:c*Float32Array.BYTES_PER_ELEMENT,T=s?t?s:s*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new p(this._engine,this,a,this._updatable,!0,T,void 0===q?this._instanced:q,G,o,void 0,void 0,!0,this._divisor||i)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!a&&this._buffer||(a=a||this._data,a&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,a),this._data=a):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(a,this._label),this._data=a):this._buffer=this._engine.createVertexBuffer(a,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.zp>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.zp,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.zp,void 0,this._label));q.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(a){this.create(a)}updateDirectly(a,c,o){let s=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,a,s?c:c*Float32Array.BYTES_PER_ELEMENT,o?o*this.byteStride:void 0),this._data=0===c&&void 0===o?a:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class p{get L(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(a){const c=0!=a;this._instanceDivisor=a,c!==this._instanced&&(this._instanced=c,this._computeHashCode())}get _maxVerticesCount(){const a=this.getData();return a?Array.isArray(a)?a.length/(this.byteStride/4)-this.byteOffset/4:(a.byteLength-this.byteOffset)/this.byteStride:0}constructor(a,c,o,s,q,G,T,C,j,L){let e=arguments.length>10&&void 0!==arguments[10]&&arguments[10],g=arguments.length>11&&void 0!==arguments[11]&&arguments[11],M=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,N=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let y=!1;if(this.mo=a,"object"===typeof s&&null!==s?(y=s.updatable??!1,q=s.postponeInternalCreation,G=s.stride,T=s.instanced,C=s.offset,j=s.size,L=s.type,e=s.normalized??!1,g=s.useBytes??!1,M=s.divisor??1,N=s.takeBufferOwnership??!1,this._label=s.label):y=!!s,c instanceof i?(this._buffer=c,this._ownsBuffer=N):(this._buffer=new i(a,c,y,G,q,T,g,M,this._label),this._ownsBuffer=!0),this.uniqueId=p._Counter++,this._kind=o,void 0===L){const a=this.getData();this.type=a?p.GetDataType(a):p.FLOAT}else this.type=L;const k=(0,t.q)(this.type);g?(this._size=j||(G?G/k:p.DeduceStride(o)),this.byteStride=G||this._buffer.byteStride||this._size*k,this.byteOffset=C||0):(this._size=j||G||p.DeduceStride(o),this.byteStride=G?G*k:this._buffer.byteStride||this._size*k,this.byteOffset=(C||0)*k),this.normalized=e,this._instanced=void 0!==T&&T,this._instanceDivisor=T?M:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var a;null===(a=this._buffer)||void 0===a||a._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(a,c){const o=this.getData();return o?(0,t.m)(o,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,a,c):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,t.q)(this.type)}getOffset(){return this.byteOffset/(0,t.q)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,t.q)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(a){this._buffer.create(a),this._alignBuffer()}update(a){this._buffer.update(a),this._alignBuffer()}updateDirectly(a,c){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(a,c,void 0,o),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(a,c){(0,t.k)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,a,this.normalized,((a,o)=>{for(let s=0;s<this._size;s++)c(a[s],o+s)}))}_alignBuffer(){}static DeduceStride(a){switch(a){case p.UVKind:case p.UV2Kind:case p.UV3Kind:case p.UV4Kind:case p.UV5Kind:case p.UV6Kind:return 2;case p.NormalKind:case p.PositionKind:return 3;case p.ColorKind:case p.ColorInstanceKind:case p.MatricesIndicesKind:case p.MatricesIndicesExtraKind:case p.MatricesWeightsKind:case p.MatricesWeightsExtraKind:case p.TangentKind:return 4;default:throw new Error("Invalid kind '"+a+"'")}}static GetDataType(a){return a instanceof Int8Array?p.BYTE:a instanceof Uint8Array?p.UNSIGNED_BYTE:a instanceof Int16Array?p.SHORT:a instanceof Uint16Array?p.UNSIGNED_SHORT:a instanceof Int32Array?p.INT:a instanceof Uint32Array?p.UNSIGNED_INT:p.FLOAT}static GetTypeByteLength(a){return(0,t.q)(a)}static ForEach(a,c,o,s,q,i,p,G){(0,t.k)(a,c,o,s,q,i,p,((a,c)=>{for(let o=0;o<s;o++)G(a[o],c+o)}))}static GetFloatData(a,c,o,s,q,i,p,G){return(0,t.m)(a,c,o,s,q,i,p,G)}}p._Counter=0,p.BYTE=5120,p.UNSIGNED_BYTE=5121,p.SHORT=5122,p.UNSIGNED_SHORT=5123,p.INT=5124,p.UNSIGNED_INT=5125,p.FLOAT=5126,p.PositionKind="position",p.NormalKind="normal",p.TangentKind="tangent",p.UVKind="uv",p.UV2Kind="uv2",p.UV3Kind="uv3",p.UV4Kind="uv4",p.UV5Kind="uv5",p.UV6Kind="uv6",p.ColorKind="color",p.ColorInstanceKind="instanceColor",p.MatricesIndicesKind="matricesIndices",p.MatricesWeightsKind="matricesWeights",p.MatricesIndicesExtraKind="matricesIndicesExtra",p.MatricesWeightsExtraKind="matricesWeightsExtra"},12894:(a,c,o)=>{o.d(c,{c:()=>L,g:()=>j,k:()=>G,m:()=>T,q:()=>i,u:()=>p,x:()=>C});var s=o(12649);function q(a,c,o,s){switch(c){case 5120:{let c=a.getInt8(o);return s&&(c=Math.max(c/127,-1)),c}case 5121:{let c=a.getUint8(o);return s&&(c/=255),c}case 5122:{let c=a.getInt16(o,!0);return s&&(c=Math.max(c/32767,-1)),c}case 5123:{let c=a.getUint16(o,!0);return s&&(c/=65535),c}case 5124:return a.getInt32(o,!0);case 5125:return a.getUint32(o,!0);case 5126:return a.getFloat32(o,!0);default:throw new Error(`Invalid component type ${c}`)}}function t(a,c,o,s,q){switch(c){case 5120:s&&(q=Math.round(127*q)),a.setInt8(o,q);break;case 5121:s&&(q=Math.round(255*q)),a.setUint8(o,q);break;case 5122:s&&(q=Math.round(32767*q)),a.setInt16(o,q,!0);break;case 5123:s&&(q=Math.round(65535*q)),a.setUint16(o,q,!0);break;case 5124:a.setInt32(o,q,!0);break;case 5125:a.setUint32(o,q,!0);break;case 5126:a.setFloat32(o,q,!0);break;default:throw new Error(`Invalid component type ${c}`)}}function i(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${a}'`)}}function p(a){switch(a){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${a}'`)}}function G(a,c,o,s,p,G,T,C){const j=new Array(s),L=new Array(s);if(a instanceof Array){let q=c/4;const t=o/4;for(let c=0;c<G;c+=s){for(let c=0;c<s;c++)j[c]=L[c]=a[q+c];C(L,c);for(let c=0;c<s;c++)j[c]!==L[c]&&(a[q+c]=L[c]);q+=t}}else{const e=ArrayBuffer.isView(a)?new DataView(a.buffer,a.byteOffset,a.byteLength):new DataView(a),g=i(p);for(let a=0;a<G;a+=s){for(let a=0,o=c;a<s;a++,o+=g)j[a]=L[a]=q(e,p,o,T);C(L,a);for(let a=0,o=c;a<s;a++,o+=g)j[a]!==L[a]&&t(e,p,o,T,L[a]);c+=o}}}function T(a,c,o,q,t,p,T,C){const j=c*i(o),L=T*c;if(5126!==o||t!==j){const s=new Float32Array(L);return G(a,q,t,c,o,L,p,((a,o)=>{for(let q=0;q<c;q++)s[o+q]=a[q]})),s}if(!(a instanceof Array||a instanceof Float32Array)||0!==q||a.length!==L){if(a instanceof Array){const c=q/4;return a.slice(c,c+L)}if(a instanceof ArrayBuffer)return new Float32Array(a,q,L);{const c=a.byteOffset+q;return 0!==(3&c)&&(s.c.Warn("Float array must be aligned to 4-bytes border"),C=!0),C?new Float32Array(a.buffer.slice(c,c+L*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(a.buffer,c,L)}}return C?a.slice():a}function C(a,c,o,q,t,T,C,j){const L=i(o),e=p(o),g=C*c;if(Array.isArray(a)){if(0!==(3&q)||0!==(3&t))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const s=q/4,i=t/4;if(s+(C-1)*i+c>a.length)throw new Error("Last accessed index is out of bounds.");if(i<c)throw new Error("Data stride cannot be smaller than the component size.");if(i!==c){const s=new e(g);return G(a,q,t,c,o,g,T,((a,o)=>{for(let q=0;q<c;q++)s[o+q]=a[q]})),s}return new e(a.slice(s,s+g))}let M,N=q;a instanceof ArrayBuffer?M=a:(M=a.buffer,N+=a.byteOffset);if(N+(C-1)*t+c*L>M.byteLength)throw new Error("Last accessed byte is out of bounds.");const y=c*L;if(t<y)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(t!==y){const a=new e(g);return G(M,N,t,c,o,g,T,((o,s)=>{for(let q=0;q<c;q++)a[s+q]=o[q]})),a}return 1!==L&&0!==(N&L-1)&&(s.c.Warn("Array must be aligned to border of element size. Data will be copied."),j=!0),j?new e(M.slice(N,N+g*L)):new e(M,N,g)}function j(a,c,o,q,t,p,T,C){const j=c*i(o),L=T*c;if(C.length!==L)throw new Error("Output length is not valid");if(5126===o&&t===j)if(a instanceof Array){const c=q/4;C.set(a,c)}else if(a instanceof ArrayBuffer){const c=new Float32Array(a,q,L);C.set(c)}else{const c=a.byteOffset+q;if(0!==(3&c))return s.c.Warn("Float array must be aligned to 4-bytes border"),void C.set(new Float32Array(a.buffer.slice(c,c+L*Float32Array.BYTES_PER_ELEMENT)));const o=new Float32Array(a.buffer,c,L);C.set(o)}else G(a,q,t,c,o,L,p,((a,o)=>{for(let s=0;s<c;s++)C[o+s]=a[s]}))}function L(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(a)){for(let q=0;q<c;q++)if(a[o+q]-s>65535)return!0;return!1}return 4===a.BYTES_PER_ELEMENT}},12891:(a,c,o)=>{o.d(c,{c:()=>s});class s{get underlyingResource(){return null}constructor(){this.references=0,this.zp=0,this.is32Bits=!1,this.uniqueId=s._Counter++}}s._Counter=0},12925:(a,c,o)=>{o.d(c,{e:()=>q});var s=o(12712);class q{static GetEffect(a){return void 0===a.getPipelineContext?a.effect:a}constructor(a){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=a.createDrawContext(),c&&(this.materialContext=a.createMaterialContext())}setEffect(a,c){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var s;(this.effect=a,void 0!==c&&(this.defines=c),o)&&(null===(s=this.drawContext)||void 0===s||s.reset())}dispose(){var a;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const a=this.effect;c?a.dispose():s.d.SetImmediate((()=>{a.getEngine().onEndFrameObservable.addOnce((()=>{a.dispose()}))})),this.effect=null}null===(a=this.drawContext)||void 0===a||a.dispose()}}},13012:(a,c,o)=>{o.d(c,{d:()=>q});var s=o(12862);class q{static GetPlanes(a){const c=[];for(let o=0;o<6;o++)c.push(new s.e(0,0,0,0));return q.GetPlanesToRef(a,c),c}static GetNearPlaneToRef(a,c){const o=a.m;c.normal.x=o[3]+o[2],c.normal.y=o[7]+o[6],c.normal.z=o[11]+o[10],c.d=o[15]+o[14],c.normalize()}static GetFarPlaneToRef(a,c){const o=a.m;c.normal.x=o[3]-o[2],c.normal.y=o[7]-o[6],c.normal.z=o[11]-o[10],c.d=o[15]-o[14],c.normalize()}static GetLeftPlaneToRef(a,c){const o=a.m;c.normal.x=o[3]+o[0],c.normal.y=o[7]+o[4],c.normal.z=o[11]+o[8],c.d=o[15]+o[12],c.normalize()}static GetRightPlaneToRef(a,c){const o=a.m;c.normal.x=o[3]-o[0],c.normal.y=o[7]-o[4],c.normal.z=o[11]-o[8],c.d=o[15]-o[12],c.normalize()}static GetTopPlaneToRef(a,c){const o=a.m;c.normal.x=o[3]-o[1],c.normal.y=o[7]-o[5],c.normal.z=o[11]-o[9],c.d=o[15]-o[13],c.normalize()}static GetBottomPlaneToRef(a,c){const o=a.m;c.normal.x=o[3]+o[1],c.normal.y=o[7]+o[5],c.normal.z=o[11]+o[9],c.d=o[15]+o[13],c.normalize()}static GetPlanesToRef(a,c){q.GetNearPlaneToRef(a,c[0]),q.GetFarPlaneToRef(a,c[1]),q.GetLeftPlaneToRef(a,c[2]),q.GetRightPlaneToRef(a,c[3]),q.GetTopPlaneToRef(a,c[4]),q.GetBottomPlaneToRef(a,c[5])}static IsPointInFrustum(a,c){for(let o=0;o<6;o++)if(c[o].dotCoordinate(a)<0)return!1;return!0}}},13023:(a,c,o)=>{o.d(c,{c:()=>q});var s=o(12661);class q{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(a,c){q.Enabled&&(this._current+=a,c&&this._fetchResult())}beginMonitoring(){q.Enabled&&(this._startMonitoringTime=s.b.Now)}endMonitoring(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!q.Enabled)return;a&&this.fetchNewFrame();const c=s.b.Now;this._current=c-this._startMonitoringTime,a&&this._fetchResult()}ec(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const a=s.b.Now;a-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=a,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}q.Enabled=!0},12901:(a,c,o)=>{o.d(c,{b:()=>q,d:()=>s});class s{constructor(a){this.length=0,this.data=new Array(a),this._id=s._GlobalId++}push(a){this.data[this.length++]=a,this.length>this.data.length&&(this.data.length*=2)}forEach(a){for(let c=0;c<this.length;c++)a(this.data[c])}sort(a){this.data.sort(a)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(let c=0;c<a.length;c++)this.data[this.length++]=(a.data||a)[c]}}indexOf(a){const c=this.data.indexOf(a);return c>=this.length?-1:c}contains(a){return-1!==this.indexOf(a)}}s._GlobalId=0;class q extends s{constructor(){super(...arguments),this._duplicateId=0}push(a){super.push(a),a.__smartArrayFlags||(a.__smartArrayFlags={}),a.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(a){return(!a.__smartArrayFlags||a.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(a),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(let c=0;c<a.length;c++){const o=(a.data||a)[c];this.pushNoDuplicate(o)}}}}},12876:(a,c,o)=>{o.d(c,{b:()=>t});var s=o(12882),q=o(12639);class t{constructor(a){this._vertexBuffers={},this.onBeforeRenderObservable=new q.d,this._scene=a}_prepareBuffers(){if(this._vertexBuffers[s.g.PositionKind])return;const a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1),this._vertexBuffers[s.g.PositionKind]=new s.g(this._scene.getEngine(),a,s.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(a)}_rebuild(){const a=this._vertexBuffers[s.g.PositionKind];a&&(a._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this._scene.activeCamera;return!!o&&(c=c||o._postProcesses.filter((a=>null!=a)),!(!c||0===c.length||!this._scene.postProcessesEnabled)&&(c[0].activate(o,a,null!==c&&void 0!==c),!0))}directRender(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,t=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.length;const p=this._scene.getEngine();for(let T=0;T<i;T++){var G;if(T<a.length-1)a[T+1].activate(this._scene.activeCamera||this._scene,null===c||void 0===c?void 0:c.texture);else c?p.bindFramebuffer(c,s,void 0,void 0,o,q):t||p.restoreDefaultFramebuffer(),null===(G=p._debugInsertMarker)||void 0===G||G.call(p,`post process ${a[T].name} output`);const i=a[T],C=i.apply();C&&(i.onBeforeRenderObservable.notifyObservers(C),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,C),p.drawElementsType(0,0,6),i.onAfterRenderObservable.notifyObservers(C))}p.setDepthBuffer(!0),p.setDepthWrite(!0)}_finalizeFrame(a,c,o,s){let q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const t=this._scene.activeCamera;if(!t)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(s=s||t._postProcesses.filter((a=>null!=a))).length||!this._scene.postProcessesEnabled)return;const i=this._scene.getEngine();for(let G=0,T=s.length;G<T;G++){const C=s[G];var p;if(G<T-1)C._outputTexture=s[G+1].activate(t,null===c||void 0===c?void 0:c.texture);else c?(i.bindFramebuffer(c,o,void 0,void 0,q),C._outputTexture=c):(i.restoreDefaultFramebuffer(),C._outputTexture=null),null===(p=i._debugInsertMarker)||void 0===p||p.call(i,`post process ${s[G].name} output`);if(a)break;const j=C.apply();j&&(C.onBeforeRenderObservable.notifyObservers(j),this._prepareBuffers(),i.bindBuffers(this._vertexBuffers,this._indexBuffer,j),i.drawElementsType(0,0,6),C.onAfterRenderObservable.notifyObservers(j))}i.setDepthBuffer(!0),i.setDepthWrite(!0),i.setAlphaMode(0)}dispose(){const a=this._vertexBuffers[s.g.PositionKind];a&&(a.dispose(),this._vertexBuffers[s.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12896:(a,c,o)=>{o.d(c,{b:()=>p});var s=o(12901),q=o(12810);class t{set opaqueSortCompareFn(a){this._opaqueSortCompareFn=a||t.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(a){this._alphaTestSortCompareFn=a||t.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(a){this._transparentSortCompareFn=a||t.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(a,c){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=a,this._opaqueSubMeshes=new s.d(256),this._transparentSubMeshes=new s.d(256),this._alphaTestSubMeshes=new s.d(256),this._depthOnlySubMeshes=new s.d(256),this._particleSystems=new s.d(256),this._spriteManagers=new s.d(256),this._empty=!0,this._edgesRenderers=new s.b(16),this._scene=c,this.opaqueSortCompareFn=o,this.alphaTestSortCompareFn=q,this.transparentSortCompareFn=t}render(a,c,o,s){if(a)return void a(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const q=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(q.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),q.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const t=q.getStencilBuffer();if(q.setStencilBuffer(!1),c&&this._renderSprites(),o&&this._renderParticles(s),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(q.setStencilBuffer(t),this._scene.useOrderIndependentTransparency){const a=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);a.length&&this._renderTransparent(a)}else this._renderTransparent(this._transparentSubMeshes);q.setAlphaMode(0)}if(q.setStencilBuffer(!1),this._edgesRenderers.length){for(let a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();q.setAlphaMode(0)}q.setStencilBuffer(t)}_renderOpaqueSorted(a){t._RenderSorted(a,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(a){t._RenderSorted(a,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(a){t._RenderSorted(a,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(a,c,o,s){let i,p=0;const G=o?o.globalPosition:t._ZeroVector;if(s)for(;p<a.length;p++)i=a.data[p],i._alphaIndex=i.getMesh().alphaIndex,i._distanceToCamera=q.Hc.Distance(i.getBoundingInfo().boundingSphere.centerWorld,G);const T=a.length===a.data.length?a.data:a.data.slice(0,a.length);c&&T.sort(c);const C=T[0].getMesh().Za();for(p=0;p<T.length;p++)if(i=T[p],!C._activeMeshesFrozenButKeepClipping||i.isInFrustum(C._frustumPlanes)){if(s){const a=i.Ba();if(a&&a.needDepthPrePass){const c=a.Za().getEngine();c.setColorWrite(!1),c.setAlphaMode(0),i.render(!1),c.setColorWrite(!0)}}i.render(s)}}static defaultTransparentSortCompare(a,c){return a._alphaIndex>c._alphaIndex?1:a._alphaIndex<c._alphaIndex?-1:t.backToFrontSortCompare(a,c)}static backToFrontSortCompare(a,c){return a._distanceToCamera<c._distanceToCamera?1:a._distanceToCamera>c._distanceToCamera?-1:0}static frontToBackSortCompare(a,c){return a._distanceToCamera<c._distanceToCamera?-1:a._distanceToCamera>c._distanceToCamera?1:0}static PainterSortCompare(a,c){const o=a.getMesh(),s=c.getMesh();return o.material&&s.material?o.material.uniqueId-s.material.uniqueId:o.uniqueId-s.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(a,c,o){void 0===c&&(c=a.getMesh()),void 0===o&&(o=a.Ba()),null!==o&&void 0!==o&&(o.needAlphaBlendingForMesh(c)?this._transparentSubMeshes.push(a):o.needAlphaTestingForMesh(c)?(o.needDepthPrePass&&this._depthOnlySubMeshes.push(a),this._alphaTestSubMeshes.push(a)):(o.needDepthPrePass&&this._depthOnlySubMeshes.push(a),this._opaqueSubMeshes.push(a)),c._renderingGroup=this,c._edgesRenderer&&c.isEnabled()&&c.isVisible&&c._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(c._edgesRenderer),this._empty=!1)}dispatchSprites(a){this._spriteManagers.push(a),this._empty=!1}dispatchParticles(a){this._particleSystems.push(a),this._empty=!1}_renderParticles(a){if(0===this._particleSystems.length)return;const c=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let o=0;o<this._particleSystems.length;o++){const s=this._particleSystems.data[o];if(0===(c&&c.layerMask&s.layerMask))continue;const q=s.sc;q.position&&a&&-1===a.indexOf(q)||this._scene._activeParticles.addCount(s.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const a=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let c=0;c<this._spriteManagers.length;c++){const o=this._spriteManagers.data[c];0!==(a&&a.layerMask&o.layerMask)&&o.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}t._ZeroVector=q.Hc.Zero();class i{}class p{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(a){a!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=a,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const a of this._scene.meshes)if(a.wc)for(const c of a.wc)c._wasDispatched=!1;if(this._scene.spriteManagers)for(const a of this._scene.spriteManagers)a._wasDispatched=!1;for(const a of this._scene.IL)a._wasDispatched=!1}constructor(a){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new i,this._maintainStateBetweenFrames=!1,this._scene=a;for(let c=p.MIN_RENDERINGGROUPS;c<p.MAX_RENDERINGGROUPS;c++)this._autoClearDepthStencil[c]={Jc:!0,depth:!0,Nc:!0}}getRenderingGroup(a){const c=a||0;return this._prepareRenderingGroup(c),this._renderingGroups[c]}_clearDepthStencilBuffer(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,a,c),this._depthStencilBufferAlreadyCleaned=!0)}render(a,c,o,s){const q=this._renderingGroupInfo;if(q.ao=this._scene,q.camera=this._scene.activeCamera,q.renderingManager=this,this._scene.spriteManagers&&s)for(let t=0;t<this._scene.spriteManagers.length;t++){const a=this._scene.spriteManagers[t];this.dispatchSprites(a)}for(let t=p.MIN_RENDERINGGROUPS;t<p.MAX_RENDERINGGROUPS;t++){this._depthStencilBufferAlreadyCleaned=t===p.MIN_RENDERINGGROUPS;const i=this._renderingGroups[t];if(!i||i._empty)continue;const G=1<<t;if(q.renderingGroupId=t,this._scene.onBeforeRenderingGroupObservable.notifyObservers(q,G),p.AUTOCLEAR){const a=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(t):this._autoClearDepthStencil[t];a&&a.Jc&&this._clearDepthStencilBuffer(a.depth,a.Nc)}for(const a of this._scene._beforeRenderingGroupDrawStage)a.action(t);i.render(a,s,o,c);for(const a of this._scene._afterRenderingGroupDrawStage)a.action(t);this._scene.onAfterRenderingGroupObservable.notifyObservers(q,G)}}reset(){if(!this.maintainStateBetweenFrames)for(let a=p.MIN_RENDERINGGROUPS;a<p.MAX_RENDERINGGROUPS;a++){const c=this._renderingGroups[a];c&&c.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let a=p.MIN_RENDERINGGROUPS;a<p.MAX_RENDERINGGROUPS;a++){const c=this._renderingGroups[a];c&&c.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let a=p.MIN_RENDERINGGROUPS;a<p.MAX_RENDERINGGROUPS;a++){const c=this._renderingGroups[a];c&&c.dispose()}}_prepareRenderingGroup(a){void 0===this._renderingGroups[a]&&(this._renderingGroups[a]=new t(a,this._scene,this._customOpaqueSortCompareFn[a],this._customAlphaTestSortCompareFn[a],this._customTransparentSortCompareFn[a]))}dispatchSprites(a){this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatchSprites(a))}dispatchParticles(a){this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatchParticles(a))}dispatch(a,c,o){void 0===c&&(c=a.getMesh()),this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(c.renderingGroupId).dispatch(a,c,o))}setRenderingOrder(a){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[a]=c,this._customAlphaTestSortCompareFn[a]=o,this._customTransparentSortCompareFn[a]=s,this._renderingGroups[a]){const c=this._renderingGroups[a];c.opaqueSortCompareFn=this._customOpaqueSortCompareFn[a],c.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[a],c.transparentSortCompareFn=this._customTransparentSortCompareFn[a]}}setRenderingAutoClearDepthStencil(a,c){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[a]={Jc:c,depth:o,Nc:s}}getAutoClearDepthStencilSetup(a){return this._autoClearDepthStencil[a]}}p.MAX_RENDERINGGROUPS=4,p.MIN_RENDERINGGROUPS=0,p.AUTOCLEAR=!0}}]);