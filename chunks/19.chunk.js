"use strict";(self.a14qw1h7fq=self.a14qw1h7fq||[]).push([[19],{11262:(R,J,B)=>{B.d(J,{d:()=>N,h:()=>r});var Q=B(11268),h=B(11043),y=B(11272);class N{get D(){return this._isDisposed}constructor(R,J,B){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7?arguments[7]:void 0,e=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,R&&R.IR?this._engine=R.IR().getEngine():this._engine=R,this._updatable=B,this._instanced=N,this._divisor=q||1,this._label=e,J instanceof Q.e?(this._data=null,this._buffer=J):(this._data=J,this._buffer=null),this.byteStride=r?h:h*Float32Array.BYTES_PER_ELEMENT,y||this.create()}createVertexBuffer(R,J,B,Q,h){let y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6?arguments[6]:void 0;const q=y?J:J*Float32Array.BYTES_PER_ELEMENT,e=Q?y?Q:Q*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new r(this._engine,this,R,this._updatable,!0,e,void 0===h?this._instanced:h,q,B,void 0,void 0,!0,this._divisor||N)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!R&&this._buffer||(R=R||this._data,R&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,R),this._data=R):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(R,this._label),this._data=R):this._buffer=this._engine.createVertexBuffer(R,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.cr>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.cr,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.cr,void 0,this._label));h.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(R){this.create(R)}updateDirectly(R,J,B){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,R,Q?J:J*Float32Array.BYTES_PER_ELEMENT,B?B*this.byteStride:void 0),this._data=0===J&&void 0===B?R:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class r{get D(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(R){const J=0!=R;this._instanceDivisor=R,J!==this._instanced&&(this._instanced=J,this._computeHashCode())}get _maxVerticesCount(){const R=this.getData();return R?Array.isArray(R)?R.length/(this.byteStride/4)-this.byteOffset/4:(R.byteLength-this.byteOffset)/this.byteStride:0}constructor(R,J,B,Q,h,q,e,D,l,E){let O=arguments.length>10&&void 0!==arguments[10]&&arguments[10],n=arguments.length>11&&void 0!==arguments[11]&&arguments[11],P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,A=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let u=!1;if(this.OJ=R,"object"===typeof Q&&null!==Q?(u=Q.updatable??!1,h=Q.postponeInternalCreation,q=Q.stride,e=Q.instanced,D=Q.offset,l=Q.size,E=Q.type,O=Q.normalized??!1,n=Q.useBytes??!1,P=Q.divisor??1,A=Q.takeBufferOwnership??!1,this._label=Q.label):u=!!Q,J instanceof N?(this._buffer=J,this._ownsBuffer=A):(this._buffer=new N(R,J,u,q,h,e,n,P,this._label),this._ownsBuffer=!0),this.uniqueId=r._Counter++,this._kind=B,void 0===E){const R=this.getData();this.type=R?r.GetDataType(R):r.FLOAT}else this.type=E;const S=(0,y.p)(this.type);n?(this._size=l||(q?q/S:r.DeduceStride(B)),this.byteStride=q||this._buffer.byteStride||this._size*S,this.byteOffset=D||0):(this._size=l||q||r.DeduceStride(B),this.byteStride=q?q*S:this._buffer.byteStride||this._size*S,this.byteOffset=(D||0)*S),this.normalized=O,this._instanced=void 0!==e&&e,this._instanceDivisor=e?P:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var R;null===(R=this._buffer)||void 0===R||R._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(R,J){const B=this.getData();return B?(0,y.n)(B,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,R,J):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,y.p)(this.type)}getOffset(){return this.byteOffset/(0,y.p)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,y.p)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(R){this._buffer.create(R),this._alignBuffer()}update(R){this._buffer.update(R),this._alignBuffer()}updateDirectly(R,J){let B=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(R,J,void 0,B),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(R,J){(0,y.l)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,R,this.normalized,((R,B)=>{for(let Q=0;Q<this._size;Q++)J(R[Q],B+Q)}))}_alignBuffer(){}static DeduceStride(R){switch(R){case r.UVKind:case r.UV2Kind:case r.UV3Kind:case r.UV4Kind:case r.UV5Kind:case r.UV6Kind:return 2;case r.NormalKind:case r.PositionKind:return 3;case r.ColorKind:case r.ColorInstanceKind:case r.MatricesIndicesKind:case r.MatricesIndicesExtraKind:case r.MatricesWeightsKind:case r.MatricesWeightsExtraKind:case r.TangentKind:return 4;default:throw new Error("Invalid kind '"+R+"'")}}static GetDataType(R){return R instanceof Int8Array?r.BYTE:R instanceof Uint8Array?r.UNSIGNED_BYTE:R instanceof Int16Array?r.SHORT:R instanceof Uint16Array?r.UNSIGNED_SHORT:R instanceof Int32Array?r.INT:R instanceof Uint32Array?r.UNSIGNED_INT:r.FLOAT}static GetTypeByteLength(R){return(0,y.p)(R)}static ForEach(R,J,B,Q,h,N,r,q){(0,y.l)(R,J,B,Q,h,N,r,((R,J)=>{for(let B=0;B<Q;B++)q(R[B],J+B)}))}static GetFloatData(R,J,B,Q,h,N,r,q){return(0,y.n)(R,J,B,Q,h,N,r,q)}}r._Counter=0,r.BYTE=5120,r.UNSIGNED_BYTE=5121,r.SHORT=5122,r.UNSIGNED_SHORT=5123,r.INT=5124,r.UNSIGNED_INT=5125,r.FLOAT=5126,r.PositionKind="position",r.NormalKind="normal",r.TangentKind="tangent",r.UVKind="uv",r.UV2Kind="uv2",r.UV3Kind="uv3",r.UV4Kind="uv4",r.UV5Kind="uv5",r.UV6Kind="uv6",r.ColorKind="color",r.ColorInstanceKind="instanceColor",r.MatricesIndicesKind="matricesIndices",r.MatricesWeightsKind="matricesWeights",r.MatricesIndicesExtraKind="matricesIndicesExtra",r.MatricesWeightsExtraKind="matricesWeightsExtra"},11272:(R,J,B)=>{B.d(J,{e:()=>E,h:()=>l,l:()=>q,n:()=>e,p:()=>N,t:()=>r,u:()=>D});var Q=B(11043);function h(R,J,B,Q){switch(J){case 5120:{let J=R.getInt8(B);return Q&&(J=Math.max(J/127,-1)),J}case 5121:{let J=R.getUint8(B);return Q&&(J/=255),J}case 5122:{let J=R.getInt16(B,!0);return Q&&(J=Math.max(J/32767,-1)),J}case 5123:{let J=R.getUint16(B,!0);return Q&&(J/=65535),J}case 5124:return R.getInt32(B,!0);case 5125:return R.getUint32(B,!0);case 5126:return R.getFloat32(B,!0);default:throw new Error(`Invalid component type ${J}`)}}function y(R,J,B,Q,h){switch(J){case 5120:Q&&(h=Math.round(127*h)),R.setInt8(B,h);break;case 5121:Q&&(h=Math.round(255*h)),R.setUint8(B,h);break;case 5122:Q&&(h=Math.round(32767*h)),R.setInt16(B,h,!0);break;case 5123:Q&&(h=Math.round(65535*h)),R.setUint16(B,h,!0);break;case 5124:R.setInt32(B,h,!0);break;case 5125:R.setUint32(B,h,!0);break;case 5126:R.setFloat32(B,h,!0);break;default:throw new Error(`Invalid component type ${J}`)}}function N(R){switch(R){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${R}'`)}}function r(R){switch(R){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${R}'`)}}function q(R,J,B,Q,r,q,e,D){const l=new Array(Q),E=new Array(Q);if(R instanceof Array){let h=J/4;const y=B/4;for(let J=0;J<q;J+=Q){for(let J=0;J<Q;J++)l[J]=E[J]=R[h+J];D(E,J);for(let J=0;J<Q;J++)l[J]!==E[J]&&(R[h+J]=E[J]);h+=y}}else{const O=ArrayBuffer.isView(R)?new DataView(R.buffer,R.byteOffset,R.byteLength):new DataView(R),n=N(r);for(let R=0;R<q;R+=Q){for(let R=0,B=J;R<Q;R++,B+=n)l[R]=E[R]=h(O,r,B,e);D(E,R);for(let R=0,B=J;R<Q;R++,B+=n)l[R]!==E[R]&&y(O,r,B,e,E[R]);J+=B}}}function e(R,J,B,h,y,r,e,D){const l=J*N(B),E=e*J;if(5126!==B||y!==l){const Q=new Float32Array(E);return q(R,h,y,J,B,E,r,((R,B)=>{for(let h=0;h<J;h++)Q[B+h]=R[h]})),Q}if(!(R instanceof Array||R instanceof Float32Array)||0!==h||R.length!==E){if(R instanceof Array){const J=h/4;return R.slice(J,J+E)}if(R instanceof ArrayBuffer)return new Float32Array(R,h,E);{const J=R.byteOffset+h;return 0!==(3&J)&&(Q.d.Warn("Float array must be aligned to 4-bytes border"),D=!0),D?new Float32Array(R.buffer.slice(J,J+E*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(R.buffer,J,E)}}return D?R.slice():R}function D(R,J,B,h,y,e,D,l){const E=N(B),O=r(B),n=D*J;if(Array.isArray(R)){if(0!==(3&h)||0!==(3&y))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const Q=h/4,N=y/4;if(Q+(D-1)*N+J>R.length)throw new Error("Last accessed index is out of bounds.");if(N<J)throw new Error("Data stride cannot be smaller than the component size.");if(N!==J){const Q=new O(n);return q(R,h,y,J,B,n,e,((R,B)=>{for(let h=0;h<J;h++)Q[B+h]=R[h]})),Q}return new O(R.slice(Q,Q+n))}let P,A=h;R instanceof ArrayBuffer?P=R:(P=R.buffer,A+=R.byteOffset);if(A+(D-1)*y+J*E>P.byteLength)throw new Error("Last accessed byte is out of bounds.");const u=J*E;if(y<u)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(y!==u){const R=new O(n);return q(P,A,y,J,B,n,e,((B,Q)=>{for(let h=0;h<J;h++)R[Q+h]=B[h]})),R}return 1!==E&&0!==(A&E-1)&&(Q.d.Warn("Array must be aligned to border of element size. Data will be copied."),l=!0),l?new O(P.slice(A,A+n*E)):new O(P,A,n)}function l(R,J,B,h,y,r,e,D){const l=J*N(B),E=e*J;if(D.length!==E)throw new Error("Output length is not valid");if(5126===B&&y===l)if(R instanceof Array){const J=h/4;D.set(R,J)}else if(R instanceof ArrayBuffer){const J=new Float32Array(R,h,E);D.set(J)}else{const J=R.byteOffset+h;if(0!==(3&J))return Q.d.Warn("Float array must be aligned to 4-bytes border"),void D.set(new Float32Array(R.buffer.slice(J,J+E*Float32Array.BYTES_PER_ELEMENT)));const B=new Float32Array(R.buffer,J,E);D.set(B)}else q(R,h,y,J,B,E,r,((R,B)=>{for(let Q=0;Q<J;Q++)D[B+Q]=R[Q]}))}function E(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(R)){for(let h=0;h<J;h++)if(R[B+h]-Q>65535)return!0;return!1}return 4===R.BYTES_PER_ELEMENT}},11268:(R,J,B)=>{B.d(J,{e:()=>Q});class Q{get underlyingResource(){return null}constructor(){this.references=0,this.cr=0,this.is32Bits=!1,this.uniqueId=Q._Counter++}}Q._Counter=0},11301:(R,J,B)=>{B.d(J,{c:()=>h});var Q=B(11090);class h{static GetEffect(R){return void 0===R.getPipelineContext?R.effect:R}constructor(R){let J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=R.createDrawContext(),J&&(this.materialContext=R.createMaterialContext())}setEffect(R,J){let B=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var Q;(this.effect=R,void 0!==J&&(this.defines=J),B)&&(null===(Q=this.drawContext)||void 0===Q||Q.reset())}dispose(){var R;let J=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const R=this.effect;J?R.dispose():Q.d.SetImmediate((()=>{R.getEngine().onEndFrameObservable.addOnce((()=>{R.dispose()}))})),this.effect=null}null===(R=this.drawContext)||void 0===R||R.dispose()}}},11384:(R,J,B)=>{B.d(J,{e:()=>h});var Q=B(11232);class h{static GetPlanes(R){const J=[];for(let B=0;B<6;B++)J.push(new Q.b(0,0,0,0));return h.GetPlanesToRef(R,J),J}static GetNearPlaneToRef(R,J){const B=R.m;J.normal.x=B[3]+B[2],J.normal.y=B[7]+B[6],J.normal.z=B[11]+B[10],J.d=B[15]+B[14],J.normalize()}static GetFarPlaneToRef(R,J){const B=R.m;J.normal.x=B[3]-B[2],J.normal.y=B[7]-B[6],J.normal.z=B[11]-B[10],J.d=B[15]-B[14],J.normalize()}static GetLeftPlaneToRef(R,J){const B=R.m;J.normal.x=B[3]+B[0],J.normal.y=B[7]+B[4],J.normal.z=B[11]+B[8],J.d=B[15]+B[12],J.normalize()}static GetRightPlaneToRef(R,J){const B=R.m;J.normal.x=B[3]-B[0],J.normal.y=B[7]-B[4],J.normal.z=B[11]-B[8],J.d=B[15]-B[12],J.normalize()}static GetTopPlaneToRef(R,J){const B=R.m;J.normal.x=B[3]-B[1],J.normal.y=B[7]-B[5],J.normal.z=B[11]-B[9],J.d=B[15]-B[13],J.normalize()}static GetBottomPlaneToRef(R,J){const B=R.m;J.normal.x=B[3]+B[1],J.normal.y=B[7]+B[5],J.normal.z=B[11]+B[9],J.d=B[15]+B[13],J.normalize()}static GetPlanesToRef(R,J){h.GetNearPlaneToRef(R,J[0]),h.GetFarPlaneToRef(R,J[1]),h.GetLeftPlaneToRef(R,J[2]),h.GetRightPlaneToRef(R,J[3]),h.GetTopPlaneToRef(R,J[4]),h.GetBottomPlaneToRef(R,J[5])}static IsPointInFrustum(R,J){for(let B=0;B<6;B++)if(J[B].dotCoordinate(R)<0)return!1;return!0}}},11399:(R,J,B)=>{B.d(J,{b:()=>h});var Q=B(11047);class h{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(R,J){h.Enabled&&(this._current+=R,J&&this._fetchResult())}beginMonitoring(){h.Enabled&&(this._startMonitoringTime=Q.c.Now)}endMonitoring(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!h.Enabled)return;R&&this.fetchNewFrame();const J=Q.c.Now;this._current=J-this._startMonitoringTime,R&&this._fetchResult()}qh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const R=Q.c.Now;R-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=R,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}h.Enabled=!0},11283:(R,J,B)=>{B.d(J,{b:()=>h,e:()=>Q});class Q{constructor(R){this.length=0,this.data=new Array(R),this._id=Q._GlobalId++}push(R){this.data[this.length++]=R,this.length>this.data.length&&(this.data.length*=2)}forEach(R){for(let J=0;J<this.length;J++)R(this.data[J])}sort(R){this.data.sort(R)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(R){if(0!==R.length){this.length+R.length>this.data.length&&(this.data.length=2*(this.length+R.length));for(let J=0;J<R.length;J++)this.data[this.length++]=(R.data||R)[J]}}indexOf(R){const J=this.data.indexOf(R);return J>=this.length?-1:J}contains(R){return-1!==this.indexOf(R)}}Q._GlobalId=0;class h extends Q{constructor(){super(...arguments),this._duplicateId=0}push(R){super.push(R),R.__smartArrayFlags||(R.__smartArrayFlags={}),R.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(R){return(!R.__smartArrayFlags||R.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(R),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(R){if(0!==R.length){this.length+R.length>this.data.length&&(this.data.length=2*(this.length+R.length));for(let J=0;J<R.length;J++){const B=(R.data||R)[J];this.pushNoDuplicate(B)}}}}},11256:(R,J,B)=>{B.d(J,{b:()=>y});var Q=B(11262),h=B(11032);class y{constructor(R){this._vertexBuffers={},this.onBeforeRenderObservable=new h.e,this._scene=R}_prepareBuffers(){if(this._vertexBuffers[Q.h.PositionKind])return;const R=[];R.push(1,1),R.push(-1,1),R.push(-1,-1),R.push(1,-1),this._vertexBuffers[Q.h.PositionKind]=new Q.h(this._scene.getEngine(),R,Q.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const R=[];R.push(0),R.push(1),R.push(2),R.push(0),R.push(2),R.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(R)}_rebuild(){const R=this._vertexBuffers[Q.h.PositionKind];R&&(R._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let R=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const B=this._scene.activeCamera;return!!B&&(J=J||B._postProcesses.filter((R=>null!=R)),!(!J||0===J.length||!this._scene.postProcessesEnabled)&&(J[0].activate(B,R,null!==J&&void 0!==J),!0))}directRender(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],N=arguments.length>6&&void 0!==arguments[6]?arguments[6]:R.length;const r=this._scene.getEngine();for(let e=0;e<N;e++){var q;if(e<R.length-1)R[e+1].activate(this._scene.activeCamera||this._scene,null===J||void 0===J?void 0:J.texture);else J?r.bindFramebuffer(J,Q,void 0,void 0,B,h):y||r.restoreDefaultFramebuffer(),null===(q=r._debugInsertMarker)||void 0===q||q.call(r,`post process ${R[e].name} output`);const N=R[e],D=N.apply();D&&(N.onBeforeRenderObservable.notifyObservers(D),this._prepareBuffers(),r.bindBuffers(this._vertexBuffers,this._indexBuffer,D),r.drawElementsType(0,0,6),N.onAfterRenderObservable.notifyObservers(D))}r.setDepthBuffer(!0),r.setDepthWrite(!0)}_finalizeFrame(R,J,B,Q){let h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const y=this._scene.activeCamera;if(!y)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(Q=Q||y._postProcesses.filter((R=>null!=R))).length||!this._scene.postProcessesEnabled)return;const N=this._scene.getEngine();for(let q=0,e=Q.length;q<e;q++){const D=Q[q];var r;if(q<e-1)D._outputTexture=Q[q+1].activate(y,null===J||void 0===J?void 0:J.texture);else J?(N.bindFramebuffer(J,B,void 0,void 0,h),D._outputTexture=J):(N.restoreDefaultFramebuffer(),D._outputTexture=null),null===(r=N._debugInsertMarker)||void 0===r||r.call(N,`post process ${Q[q].name} output`);if(R)break;const l=D.apply();l&&(D.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),N.bindBuffers(this._vertexBuffers,this._indexBuffer,l),N.drawElementsType(0,0,6),D.onAfterRenderObservable.notifyObservers(l))}N.setDepthBuffer(!0),N.setDepthWrite(!0),N.setAlphaMode(0)}dispose(){const R=this._vertexBuffers[Q.h.PositionKind];R&&(R.dispose(),this._vertexBuffers[Q.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11278:(R,J,B)=>{B.d(J,{b:()=>r});var Q=B(11283),h=B(11186);class y{set opaqueSortCompareFn(R){this._opaqueSortCompareFn=R||y.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(R){this._alphaTestSortCompareFn=R||y.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(R){this._transparentSortCompareFn=R||y.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(R,J){let B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=R,this._opaqueSubMeshes=new Q.e(256),this._transparentSubMeshes=new Q.e(256),this._alphaTestSubMeshes=new Q.e(256),this._depthOnlySubMeshes=new Q.e(256),this._particleSystems=new Q.e(256),this._spriteManagers=new Q.e(256),this._empty=!0,this._edgesRenderers=new Q.b(16),this._scene=J,this.opaqueSortCompareFn=B,this.alphaTestSortCompareFn=h,this.transparentSortCompareFn=y}render(R,J,B,Q){if(R)return void R(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const h=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(h.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),h.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const y=h.getStencilBuffer();if(h.setStencilBuffer(!1),J&&this._renderSprites(),B&&this._renderParticles(Q),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(h.setStencilBuffer(y),this._scene.useOrderIndependentTransparency){const R=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);R.length&&this._renderTransparent(R)}else this._renderTransparent(this._transparentSubMeshes);h.setAlphaMode(0)}if(h.setStencilBuffer(!1),this._edgesRenderers.length){for(let R=0;R<this._edgesRenderers.length;R++)this._edgesRenderers.data[R].render();h.setAlphaMode(0)}h.setStencilBuffer(y)}_renderOpaqueSorted(R){y._RenderSorted(R,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(R){y._RenderSorted(R,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(R){y._RenderSorted(R,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(R,J,B,Q){let N,r=0;const q=B?B.globalPosition:y._ZeroVector;if(Q)for(;r<R.length;r++)N=R.data[r],N._alphaIndex=N.getMesh().alphaIndex,N._distanceToCamera=h.nJ.Distance(N.getBoundingInfo().boundingSphere.centerWorld,q);const e=R.length===R.data.length?R.data:R.data.slice(0,R.length);J&&e.sort(J);const D=e[0].getMesh().IR();for(r=0;r<e.length;r++)if(N=e[r],!D._activeMeshesFrozenButKeepClipping||N.isInFrustum(D._frustumPlanes)){if(Q){const R=N.YR();if(R&&R.needDepthPrePass){const J=R.IR().getEngine();J.setColorWrite(!1),J.setAlphaMode(0),N.render(!1),J.setColorWrite(!0)}}N.render(Q)}}static defaultTransparentSortCompare(R,J){return R._alphaIndex>J._alphaIndex?1:R._alphaIndex<J._alphaIndex?-1:y.backToFrontSortCompare(R,J)}static backToFrontSortCompare(R,J){return R._distanceToCamera<J._distanceToCamera?1:R._distanceToCamera>J._distanceToCamera?-1:0}static frontToBackSortCompare(R,J){return R._distanceToCamera<J._distanceToCamera?-1:R._distanceToCamera>J._distanceToCamera?1:0}static PainterSortCompare(R,J){const B=R.getMesh(),Q=J.getMesh();return B.material&&Q.material?B.material.uniqueId-Q.material.uniqueId:B.uniqueId-Q.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(R,J,B){void 0===J&&(J=R.getMesh()),void 0===B&&(B=R.YR()),null!==B&&void 0!==B&&(B.needAlphaBlendingForMesh(J)?this._transparentSubMeshes.push(R):B.needAlphaTestingForMesh(J)?(B.needDepthPrePass&&this._depthOnlySubMeshes.push(R),this._alphaTestSubMeshes.push(R)):(B.needDepthPrePass&&this._depthOnlySubMeshes.push(R),this._opaqueSubMeshes.push(R)),J._renderingGroup=this,J._edgesRenderer&&J.isEnabled()&&J.isVisible&&J._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(J._edgesRenderer),this._empty=!1)}dispatchSprites(R){this._spriteManagers.push(R),this._empty=!1}dispatchParticles(R){this._particleSystems.push(R),this._empty=!1}_renderParticles(R){if(0===this._particleSystems.length)return;const J=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let B=0;B<this._particleSystems.length;B++){const Q=this._particleSystems.data[B];if(0===(J&&J.layerMask&Q.layerMask))continue;const h=Q.QJ;h.position&&R&&-1===R.indexOf(h)||this._scene._activeParticles.addCount(Q.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const R=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let J=0;J<this._spriteManagers.length;J++){const B=this._spriteManagers.data[J];0!==(R&&R.layerMask&B.layerMask)&&B.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}y._ZeroVector=h.nJ.Zero();class N{}class r{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(R){R!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=R,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const R of this._scene.meshes)if(R.Fh)for(const J of R.Fh)J._wasDispatched=!1;if(this._scene.spriteManagers)for(const R of this._scene.spriteManagers)R._wasDispatched=!1;for(const R of this._scene.OE)R._wasDispatched=!1}constructor(R){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new N,this._maintainStateBetweenFrames=!1,this._scene=R;for(let J=r.MIN_RENDERINGGROUPS;J<r.MAX_RENDERINGGROUPS;J++)this._autoClearDepthStencil[J]={gh:!0,depth:!0,stencil:!0}}getRenderingGroup(R){const J=R||0;return this._prepareRenderingGroup(J),this._renderingGroups[J]}_clearDepthStencilBuffer(){let R=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],J=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,R,J),this._depthStencilBufferAlreadyCleaned=!0)}render(R,J,B,Q){const h=this._renderingGroupInfo;if(h.AJ=this._scene,h.camera=this._scene.activeCamera,h.renderingManager=this,this._scene.spriteManagers&&Q)for(let y=0;y<this._scene.spriteManagers.length;y++){const R=this._scene.spriteManagers[y];this.dispatchSprites(R)}for(let y=r.MIN_RENDERINGGROUPS;y<r.MAX_RENDERINGGROUPS;y++){this._depthStencilBufferAlreadyCleaned=y===r.MIN_RENDERINGGROUPS;const N=this._renderingGroups[y];if(!N||N._empty)continue;const q=1<<y;if(h.renderingGroupId=y,this._scene.onBeforeRenderingGroupObservable.notifyObservers(h,q),r.AUTOCLEAR){const R=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(y):this._autoClearDepthStencil[y];R&&R.gh&&this._clearDepthStencilBuffer(R.depth,R.stencil)}for(const R of this._scene._beforeRenderingGroupDrawStage)R.action(y);N.render(R,Q,B,J);for(const R of this._scene._afterRenderingGroupDrawStage)R.action(y);this._scene.onAfterRenderingGroupObservable.notifyObservers(h,q)}}reset(){if(!this.maintainStateBetweenFrames)for(let R=r.MIN_RENDERINGGROUPS;R<r.MAX_RENDERINGGROUPS;R++){const J=this._renderingGroups[R];J&&J.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let R=r.MIN_RENDERINGGROUPS;R<r.MAX_RENDERINGGROUPS;R++){const J=this._renderingGroups[R];J&&J.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let R=r.MIN_RENDERINGGROUPS;R<r.MAX_RENDERINGGROUPS;R++){const J=this._renderingGroups[R];J&&J.dispose()}}_prepareRenderingGroup(R){void 0===this._renderingGroups[R]&&(this._renderingGroups[R]=new y(R,this._scene,this._customOpaqueSortCompareFn[R],this._customAlphaTestSortCompareFn[R],this._customTransparentSortCompareFn[R]))}dispatchSprites(R){this.maintainStateBetweenFrames&&R._wasDispatched||(R._wasDispatched=!0,this.getRenderingGroup(R.renderingGroupId).dispatchSprites(R))}dispatchParticles(R){this.maintainStateBetweenFrames&&R._wasDispatched||(R._wasDispatched=!0,this.getRenderingGroup(R.renderingGroupId).dispatchParticles(R))}dispatch(R,J,B){void 0===J&&(J=R.getMesh()),this.maintainStateBetweenFrames&&R._wasDispatched||(R._wasDispatched=!0,this.getRenderingGroup(J.renderingGroupId).dispatch(R,J,B))}setRenderingOrder(R){let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,B=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[R]=J,this._customAlphaTestSortCompareFn[R]=B,this._customTransparentSortCompareFn[R]=Q,this._renderingGroups[R]){const J=this._renderingGroups[R];J.opaqueSortCompareFn=this._customOpaqueSortCompareFn[R],J.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[R],J.transparentSortCompareFn=this._customTransparentSortCompareFn[R]}}setRenderingAutoClearDepthStencil(R,J){let B=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[R]={gh:J,depth:B,stencil:Q}}getAutoClearDepthStencilSetup(R){return this._autoClearDepthStencil[R]}}r.MAX_RENDERINGGROUPS=4,r.MIN_RENDERINGGROUPS=0,r.AUTOCLEAR=!0}}]);