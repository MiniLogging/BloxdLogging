"use strict";(self.gpkvekif0vo=self.gpkvekif0vo||[]).push([[19],{12470:(a,O,i)=>{i.d(O,{b:()=>q,c:()=>Q});var H=i(12477),b=i(12209),G=i(12482);class q{get h(){return this._isDisposed}constructor(a,O,i){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]&&arguments[4],q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,a&&a.Ua?this._engine=a.Ua().getEngine():this._engine=a,this._updatable=i,this._instanced=q,this._divisor=k||1,this._label=I,O instanceof H.c?(this._data=null,this._buffer=O):(this._data=O,this._buffer=null),this.byteStride=Q?b:b*Float32Array.BYTES_PER_ELEMENT,G||this.create()}createVertexBuffer(a,O,i,H,b){let G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6?arguments[6]:void 0;const k=G?O:O*Float32Array.BYTES_PER_ELEMENT,I=H?G?H:H*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new Q(this._engine,this,a,this._updatable,!0,I,void 0===b?this._instanced:b,k,i,void 0,void 0,!0,this._divisor||q)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!a&&this._buffer||(a=a||this._data,a&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,a),this._data=a):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(a,this._label),this._data=a):this._buffer=this._engine.createVertexBuffer(a,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Zi>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Zi,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Zi,void 0,this._label));b.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(a){this.create(a)}updateDirectly(a,O,i){let H=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,a,H?O:O*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===O&&void 0===i?a:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class Q{get h(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(a){const O=0!=a;this._instanceDivisor=a,O!==this._instanced&&(this._instanced=O,this._computeHashCode())}get _maxVerticesCount(){const a=this.getData();return a?Array.isArray(a)?a.length/(this.byteStride/4)-this.byteOffset/4:(a.byteLength-this.byteOffset)/this.byteStride:0}constructor(a,O,i,H,b,k,I,P,e,h){let j=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Z=arguments.length>11&&void 0!==arguments[11]&&arguments[11],F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,r=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let J=!1;if(this.jO=a,"object"===typeof H&&null!==H?(J=H.updatable??!1,b=H.postponeInternalCreation,k=H.stride,I=H.instanced,P=H.offset,e=H.size,h=H.type,j=H.normalized??!1,Z=H.useBytes??!1,F=H.divisor??1,r=H.takeBufferOwnership??!1,this._label=H.label):J=!!H,O instanceof q?(this._buffer=O,this._ownsBuffer=r):(this._buffer=new q(a,O,J,k,b,I,Z,F,this._label),this._ownsBuffer=!0),this.uniqueId=Q._Counter++,this._kind=i,void 0===h){const a=this.getData();this.type=a?Q.GetDataType(a):Q.FLOAT}else this.type=h;const ma=(0,G.l)(this.type);Z?(this._size=e||(k?k/ma:Q.DeduceStride(i)),this.byteStride=k||this._buffer.byteStride||this._size*ma,this.byteOffset=P||0):(this._size=e||k||Q.DeduceStride(i),this.byteStride=k?k*ma:this._buffer.byteStride||this._size*ma,this.byteOffset=(P||0)*ma),this.normalized=j,this._instanced=void 0!==I&&I,this._instanceDivisor=I?F:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var a;null===(a=this._buffer)||void 0===a||a._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(a,O){const i=this.getData();return i?(0,G.j)(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,a,O):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,G.l)(this.type)}getOffset(){return this.byteOffset/(0,G.l)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,G.l)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(a){this._buffer.create(a),this._alignBuffer()}update(a){this._buffer.update(a),this._alignBuffer()}updateDirectly(a,O){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(a,O,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(a,O){(0,G.f)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,a,this.normalized,((a,i)=>{for(let H=0;H<this._size;H++)O(a[H],i+H)}))}_alignBuffer(){}static DeduceStride(a){switch(a){case Q.UVKind:case Q.UV2Kind:case Q.UV3Kind:case Q.UV4Kind:case Q.UV5Kind:case Q.UV6Kind:return 2;case Q.NormalKind:case Q.PositionKind:return 3;case Q.ColorKind:case Q.ColorInstanceKind:case Q.MatricesIndicesKind:case Q.MatricesIndicesExtraKind:case Q.MatricesWeightsKind:case Q.MatricesWeightsExtraKind:case Q.TangentKind:return 4;default:throw new Error("Invalid kind '"+a+"'")}}static GetDataType(a){return a instanceof Int8Array?Q.BYTE:a instanceof Uint8Array?Q.UNSIGNED_BYTE:a instanceof Int16Array?Q.SHORT:a instanceof Uint16Array?Q.UNSIGNED_SHORT:a instanceof Int32Array?Q.INT:a instanceof Uint32Array?Q.UNSIGNED_INT:Q.FLOAT}static GetTypeByteLength(a){return(0,G.l)(a)}static ForEach(a,O,i,H,b,q,Q,k){(0,G.f)(a,O,i,H,b,q,Q,((a,O)=>{for(let i=0;i<H;i++)k(a[i],O+i)}))}static GetFloatData(a,O,i,H,b,q,Q,k){return(0,G.j)(a,O,i,H,b,q,Q,k)}}Q._Counter=0,Q.BYTE=5120,Q.UNSIGNED_BYTE=5121,Q.SHORT=5122,Q.UNSIGNED_SHORT=5123,Q.INT=5124,Q.UNSIGNED_INT=5125,Q.FLOAT=5126,Q.PositionKind="position",Q.NormalKind="normal",Q.TangentKind="tangent",Q.UVKind="uv",Q.UV2Kind="uv2",Q.UV3Kind="uv3",Q.UV4Kind="uv4",Q.UV5Kind="uv5",Q.UV6Kind="uv6",Q.ColorKind="color",Q.ColorInstanceKind="instanceColor",Q.MatricesIndicesKind="matricesIndices",Q.MatricesWeightsKind="matricesWeights",Q.MatricesIndicesExtraKind="matricesIndicesExtra",Q.MatricesWeightsExtraKind="matricesWeightsExtra"},12482:(a,O,i)=>{i.d(O,{b:()=>h,d:()=>e,f:()=>k,j:()=>I,l:()=>q,m:()=>Q,n:()=>P});var H=i(12209);function b(a,O,i,H){switch(O){case 5120:{let O=a.getInt8(i);return H&&(O=Math.max(O/127,-1)),O}case 5121:{let O=a.getUint8(i);return H&&(O/=255),O}case 5122:{let O=a.getInt16(i,!0);return H&&(O=Math.max(O/32767,-1)),O}case 5123:{let O=a.getUint16(i,!0);return H&&(O/=65535),O}case 5124:return a.getInt32(i,!0);case 5125:return a.getUint32(i,!0);case 5126:return a.getFloat32(i,!0);default:throw new Error(`Invalid component type ${O}`)}}function G(a,O,i,H,b){switch(O){case 5120:H&&(b=Math.round(127*b)),a.setInt8(i,b);break;case 5121:H&&(b=Math.round(255*b)),a.setUint8(i,b);break;case 5122:H&&(b=Math.round(32767*b)),a.setInt16(i,b,!0);break;case 5123:H&&(b=Math.round(65535*b)),a.setUint16(i,b,!0);break;case 5124:a.setInt32(i,b,!0);break;case 5125:a.setUint32(i,b,!0);break;case 5126:a.setFloat32(i,b,!0);break;default:throw new Error(`Invalid component type ${O}`)}}function q(a){switch(a){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${a}'`)}}function Q(a){switch(a){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${a}'`)}}function k(a,O,i,H,Q,k,I,P){const e=new Array(H),h=new Array(H);if(a instanceof Array){let b=O/4;const G=i/4;for(let O=0;O<k;O+=H){for(let O=0;O<H;O++)e[O]=h[O]=a[b+O];P(h,O);for(let O=0;O<H;O++)e[O]!==h[O]&&(a[b+O]=h[O]);b+=G}}else{const j=ArrayBuffer.isView(a)?new DataView(a.buffer,a.byteOffset,a.byteLength):new DataView(a),Z=q(Q);for(let a=0;a<k;a+=H){for(let a=0,i=O;a<H;a++,i+=Z)e[a]=h[a]=b(j,Q,i,I);P(h,a);for(let a=0,i=O;a<H;a++,i+=Z)e[a]!==h[a]&&G(j,Q,i,I,h[a]);O+=i}}}function I(a,O,i,b,G,Q,I,P){const e=O*q(i),h=I*O;if(5126!==i||G!==e){const H=new Float32Array(h);return k(a,b,G,O,i,h,Q,((a,i)=>{for(let b=0;b<O;b++)H[i+b]=a[b]})),H}if(!(a instanceof Array||a instanceof Float32Array)||0!==b||a.length!==h){if(a instanceof Array){const O=b/4;return a.slice(O,O+h)}if(a instanceof ArrayBuffer)return new Float32Array(a,b,h);{const O=a.byteOffset+b;return 0!==(3&O)&&(H.c.Warn("Float array must be aligned to 4-bytes border"),P=!0),P?new Float32Array(a.buffer.slice(O,O+h*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(a.buffer,O,h)}}return P?a.slice():a}function P(a,O,i,b,G,I,P,e){const h=q(i),j=Q(i),Z=P*O;if(Array.isArray(a)){if(0!==(3&b)||0!==(3&G))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const H=b/4,q=G/4;if(H+(P-1)*q+O>a.length)throw new Error("Last accessed index is out of bounds.");if(q<O)throw new Error("Data stride cannot be smaller than the component size.");if(q!==O){const H=new j(Z);return k(a,b,G,O,i,Z,I,((a,i)=>{for(let b=0;b<O;b++)H[i+b]=a[b]})),H}return new j(a.slice(H,H+Z))}let F,r=b;a instanceof ArrayBuffer?F=a:(F=a.buffer,r+=a.byteOffset);if(r+(P-1)*G+O*h>F.byteLength)throw new Error("Last accessed byte is out of bounds.");const J=O*h;if(G<J)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(G!==J){const a=new j(Z);return k(F,r,G,O,i,Z,I,((i,H)=>{for(let b=0;b<O;b++)a[H+b]=i[b]})),a}return 1!==h&&0!==(r&h-1)&&(H.c.Warn("Array must be aligned to border of element size. Data will be copied."),e=!0),e?new j(F.slice(r,r+Z*h)):new j(F,r,Z)}function e(a,O,i,b,G,Q,I,P){const e=O*q(i),h=I*O;if(P.length!==h)throw new Error("Output length is not valid");if(5126===i&&G===e)if(a instanceof Array){const O=b/4;P.set(a,O)}else if(a instanceof ArrayBuffer){const O=new Float32Array(a,b,h);P.set(O)}else{const O=a.byteOffset+b;if(0!==(3&O))return H.c.Warn("Float array must be aligned to 4-bytes border"),void P.set(new Float32Array(a.buffer.slice(O,O+h*Float32Array.BYTES_PER_ELEMENT)));const i=new Float32Array(a.buffer,O,h);P.set(i)}else k(a,b,G,O,i,h,Q,((a,i)=>{for(let H=0;H<O;H++)P[i+H]=a[H]}))}function h(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(a)){for(let b=0;b<O;b++)if(a[i+b]-H>65535)return!0;return!1}return 4===a.BYTES_PER_ELEMENT}},12477:(a,O,i)=>{i.d(O,{c:()=>H});class H{get underlyingResource(){return null}constructor(){this.references=0,this.Zi=0,this.is32Bits=!1,this.uniqueId=H._Counter++}}H._Counter=0},12518:(a,O,i)=>{i.d(O,{e:()=>b});var H=i(12265);class b{static GetEffect(a){return void 0===a.getPipelineContext?a.effect:a}constructor(a){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=a.createDrawContext(),O&&(this.materialContext=a.createMaterialContext())}setEffect(a,O){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var H;(this.effect=a,void 0!==O&&(this.defines=O),i)&&(null===(H=this.drawContext)||void 0===H||H.reset())}dispose(){var a;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const a=this.effect;O?a.dispose():H.b.SetImmediate((()=>{a.getEngine().onEndFrameObservable.addOnce((()=>{a.dispose()}))})),this.effect=null}null===(a=this.drawContext)||void 0===a||a.dispose()}}},12610:(a,O,i)=>{i.d(O,{c:()=>b});var H=i(12441);class b{static GetPlanes(a){const O=[];for(let i=0;i<6;i++)O.push(new H.c(0,0,0,0));return b.GetPlanesToRef(a,O),O}static GetNearPlaneToRef(a,O){const i=a.m;O.normal.x=i[3]+i[2],O.normal.y=i[7]+i[6],O.normal.z=i[11]+i[10],O.d=i[15]+i[14],O.normalize()}static GetFarPlaneToRef(a,O){const i=a.m;O.normal.x=i[3]-i[2],O.normal.y=i[7]-i[6],O.normal.z=i[11]-i[10],O.d=i[15]-i[14],O.normalize()}static GetLeftPlaneToRef(a,O){const i=a.m;O.normal.x=i[3]+i[0],O.normal.y=i[7]+i[4],O.normal.z=i[11]+i[8],O.d=i[15]+i[12],O.normalize()}static GetRightPlaneToRef(a,O){const i=a.m;O.normal.x=i[3]-i[0],O.normal.y=i[7]-i[4],O.normal.z=i[11]-i[8],O.d=i[15]-i[12],O.normalize()}static GetTopPlaneToRef(a,O){const i=a.m;O.normal.x=i[3]-i[1],O.normal.y=i[7]-i[5],O.normal.z=i[11]-i[9],O.d=i[15]-i[13],O.normalize()}static GetBottomPlaneToRef(a,O){const i=a.m;O.normal.x=i[3]+i[1],O.normal.y=i[7]+i[5],O.normal.z=i[11]+i[9],O.d=i[15]+i[13],O.normalize()}static GetPlanesToRef(a,O){b.GetNearPlaneToRef(a,O[0]),b.GetFarPlaneToRef(a,O[1]),b.GetLeftPlaneToRef(a,O[2]),b.GetRightPlaneToRef(a,O[3]),b.GetTopPlaneToRef(a,O[4]),b.GetBottomPlaneToRef(a,O[5])}static IsPointInFrustum(a,O){for(let i=0;i<6;i++)if(O[i].dotCoordinate(a)<0)return!1;return!0}}},12622:(a,O,i)=>{i.d(O,{d:()=>b});var H=i(12218);class b{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(a,O){b.Enabled&&(this._current+=a,O&&this._fetchResult())}beginMonitoring(){b.Enabled&&(this._startMonitoringTime=H.c.Now)}endMonitoring(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!b.Enabled)return;a&&this.fetchNewFrame();const O=H.c.Now;this._current=O-this._startMonitoringTime,a&&this._fetchResult()}Ib(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const a=H.c.Now;a-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=a,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}b.Enabled=!0},12492:(a,O,i)=>{i.d(O,{e:()=>b,f:()=>H});class H{constructor(a){this.length=0,this.data=new Array(a),this._id=H._GlobalId++}push(a){this.data[this.length++]=a,this.length>this.data.length&&(this.data.length*=2)}forEach(a){for(let O=0;O<this.length;O++)a(this.data[O])}sort(a){this.data.sort(a)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(let O=0;O<a.length;O++)this.data[this.length++]=(a.data||a)[O]}}indexOf(a){const O=this.data.indexOf(a);return O>=this.length?-1:O}contains(a){return-1!==this.indexOf(a)}}H._GlobalId=0;class b extends H{constructor(){super(...arguments),this._duplicateId=0}push(a){super.push(a),a.__smartArrayFlags||(a.__smartArrayFlags={}),a.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(a){return(!a.__smartArrayFlags||a.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(a),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(a){if(0!==a.length){this.length+a.length>this.data.length&&(this.data.length=2*(this.length+a.length));for(let O=0;O<a.length;O++){const i=(a.data||a)[O];this.pushNoDuplicate(i)}}}}},12461:(a,O,i)=>{i.d(O,{c:()=>G});var H=i(12470),b=i(12193);class G{constructor(a){this._vertexBuffers={},this.onBeforeRenderObservable=new b.e,this._scene=a}_prepareBuffers(){if(this._vertexBuffers[H.c.PositionKind])return;const a=[];a.push(1,1),a.push(-1,1),a.push(-1,-1),a.push(1,-1),this._vertexBuffers[H.c.PositionKind]=new H.c(this._scene.getEngine(),a,H.c.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const a=[];a.push(0),a.push(1),a.push(2),a.push(0),a.push(2),a.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(a)}_rebuild(){const a=this._vertexBuffers[H.c.PositionKind];a&&(a._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.activeCamera;return!!i&&(O=O||i._postProcesses.filter((a=>null!=a)),!(!O||0===O.length||!this._scene.postProcessesEnabled)&&(O[0].activate(i,a,null!==O&&void 0!==O),!0))}directRender(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,b=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,G=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:a.length;const Q=this._scene.getEngine();for(let I=0;I<q;I++){var k;if(I<a.length-1)a[I+1].activate(this._scene.activeCamera||this._scene,null===O||void 0===O?void 0:O.texture);else O?Q.bindFramebuffer(O,H,void 0,void 0,i,b):G||Q.restoreDefaultFramebuffer(),null===(k=Q._debugInsertMarker)||void 0===k||k.call(Q,`post process ${a[I].name} output`);const q=a[I],P=q.apply();P&&(q.onBeforeRenderObservable.notifyObservers(P),this._prepareBuffers(),Q.bindBuffers(this._vertexBuffers,this._indexBuffer,P),Q.drawElementsType(0,0,6),q.onAfterRenderObservable.notifyObservers(P))}Q.setDepthBuffer(!0),Q.setDepthWrite(!0)}_finalizeFrame(a,O,i,H){let b=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const G=this._scene.activeCamera;if(!G)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(H=H||G._postProcesses.filter((a=>null!=a))).length||!this._scene.postProcessesEnabled)return;const q=this._scene.getEngine();for(let k=0,I=H.length;k<I;k++){const P=H[k];var Q;if(k<I-1)P._outputTexture=H[k+1].activate(G,null===O||void 0===O?void 0:O.texture);else O?(q.bindFramebuffer(O,i,void 0,void 0,b),P._outputTexture=O):(q.restoreDefaultFramebuffer(),P._outputTexture=null),null===(Q=q._debugInsertMarker)||void 0===Q||Q.call(q,`post process ${H[k].name} output`);if(a)break;const e=P.apply();e&&(P.onBeforeRenderObservable.notifyObservers(e),this._prepareBuffers(),q.bindBuffers(this._vertexBuffers,this._indexBuffer,e),q.drawElementsType(0,0,6),P.onAfterRenderObservable.notifyObservers(e))}q.setDepthBuffer(!0),q.setDepthWrite(!0),q.setAlphaMode(0)}dispose(){const a=this._vertexBuffers[H.c.PositionKind];a&&(a.dispose(),this._vertexBuffers[H.c.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12487:(a,O,i)=>{i.d(O,{b:()=>Q});var H=i(12492),b=i(12395);class G{set opaqueSortCompareFn(a){this._opaqueSortCompareFn=a||G.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(a){this._alphaTestSortCompareFn=a||G.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(a){this._transparentSortCompareFn=a||G.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(a,O){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=a,this._opaqueSubMeshes=new H.f(256),this._transparentSubMeshes=new H.f(256),this._alphaTestSubMeshes=new H.f(256),this._depthOnlySubMeshes=new H.f(256),this._particleSystems=new H.f(256),this._spriteManagers=new H.f(256),this._empty=!0,this._edgesRenderers=new H.e(16),this._scene=O,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=b,this.transparentSortCompareFn=G}render(a,O,i,H){if(a)return void a(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const b=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(b.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),b.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const G=b.getStencilBuffer();if(b.setStencilBuffer(!1),O&&this._renderSprites(),i&&this._renderParticles(H),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(b.setStencilBuffer(G),this._scene.useOrderIndependentTransparency){const a=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);a.length&&this._renderTransparent(a)}else this._renderTransparent(this._transparentSubMeshes);b.setAlphaMode(0)}if(b.setStencilBuffer(!1),this._edgesRenderers.length){for(let a=0;a<this._edgesRenderers.length;a++)this._edgesRenderers.data[a].render();b.setAlphaMode(0)}b.setStencilBuffer(G)}_renderOpaqueSorted(a){G._RenderSorted(a,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(a){G._RenderSorted(a,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(a){G._RenderSorted(a,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(a,O,i,H){let q,Q=0;const k=i?i.globalPosition:G._ZeroVector;if(H)for(;Q<a.length;Q++)q=a.data[Q],q._alphaIndex=q.getMesh().alphaIndex,q._distanceToCamera=b.ZO.Distance(q.getBoundingInfo().boundingSphere.centerWorld,k);const I=a.length===a.data.length?a.data:a.data.slice(0,a.length);O&&I.sort(O);const P=I[0].getMesh().Ua();for(Q=0;Q<I.length;Q++)if(q=I[Q],!P._activeMeshesFrozenButKeepClipping||q.isInFrustum(P._frustumPlanes)){if(H){const a=q.ua();if(a&&a.needDepthPrePass){const O=a.Ua().getEngine();O.setColorWrite(!1),O.setAlphaMode(0),q.render(!1),O.setColorWrite(!0)}}q.render(H)}}static defaultTransparentSortCompare(a,O){return a._alphaIndex>O._alphaIndex?1:a._alphaIndex<O._alphaIndex?-1:G.backToFrontSortCompare(a,O)}static backToFrontSortCompare(a,O){return a._distanceToCamera<O._distanceToCamera?1:a._distanceToCamera>O._distanceToCamera?-1:0}static frontToBackSortCompare(a,O){return a._distanceToCamera<O._distanceToCamera?-1:a._distanceToCamera>O._distanceToCamera?1:0}static PainterSortCompare(a,O){const i=a.getMesh(),H=O.getMesh();return i.material&&H.material?i.material.uniqueId-H.material.uniqueId:i.uniqueId-H.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(a,O,i){void 0===O&&(O=a.getMesh()),void 0===i&&(i=a.ua()),null!==i&&void 0!==i&&(i.needAlphaBlendingForMesh(O)?this._transparentSubMeshes.push(a):i.needAlphaTestingForMesh(O)?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(a),this._alphaTestSubMeshes.push(a)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(a),this._opaqueSubMeshes.push(a)),O._renderingGroup=this,O._edgesRenderer&&O.isEnabled()&&O.isVisible&&O._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(O._edgesRenderer),this._empty=!1)}dispatchSprites(a){this._spriteManagers.push(a),this._empty=!1}dispatchParticles(a){this._particleSystems.push(a),this._empty=!1}_renderParticles(a){if(0===this._particleSystems.length)return;const O=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const H=this._particleSystems.data[i];if(0===(O&&O.layerMask&H.layerMask))continue;const b=H.HO;b.position&&a&&-1===a.indexOf(b)||this._scene._activeParticles.addCount(H.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const a=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let O=0;O<this._spriteManagers.length;O++){const i=this._spriteManagers.data[O];0!==(a&&a.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}G._ZeroVector=b.ZO.Zero();class q{}class Q{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(a){a!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=a,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const a of this._scene.meshes)if(a.Mb)for(const O of a.Mb)O._wasDispatched=!1;if(this._scene.spriteManagers)for(const a of this._scene.spriteManagers)a._wasDispatched=!1;for(const a of this._scene.Eh)a._wasDispatched=!1}constructor(a){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new q,this._maintainStateBetweenFrames=!1,this._scene=a;for(let O=Q.MIN_RENDERINGGROUPS;O<Q.MAX_RENDERINGGROUPS;O++)this._autoClearDepthStencil[O]={Jb:!0,depth:!0,hb:!0}}getRenderingGroup(a){const O=a||0;return this._prepareRenderingGroup(O),this._renderingGroups[O]}_clearDepthStencilBuffer(){let a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,a,O),this._depthStencilBufferAlreadyCleaned=!0)}render(a,O,i,H){const b=this._renderingGroupInfo;if(b.rO=this._scene,b.camera=this._scene.activeCamera,b.renderingManager=this,this._scene.spriteManagers&&H)for(let G=0;G<this._scene.spriteManagers.length;G++){const a=this._scene.spriteManagers[G];this.dispatchSprites(a)}for(let G=Q.MIN_RENDERINGGROUPS;G<Q.MAX_RENDERINGGROUPS;G++){this._depthStencilBufferAlreadyCleaned=G===Q.MIN_RENDERINGGROUPS;const q=this._renderingGroups[G];if(!q||q._empty)continue;const k=1<<G;if(b.renderingGroupId=G,this._scene.onBeforeRenderingGroupObservable.notifyObservers(b,k),Q.AUTOCLEAR){const a=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(G):this._autoClearDepthStencil[G];a&&a.Jb&&this._clearDepthStencilBuffer(a.depth,a.hb)}for(const a of this._scene._beforeRenderingGroupDrawStage)a.action(G);q.render(a,H,i,O);for(const a of this._scene._afterRenderingGroupDrawStage)a.action(G);this._scene.onAfterRenderingGroupObservable.notifyObservers(b,k)}}reset(){if(!this.maintainStateBetweenFrames)for(let a=Q.MIN_RENDERINGGROUPS;a<Q.MAX_RENDERINGGROUPS;a++){const O=this._renderingGroups[a];O&&O.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let a=Q.MIN_RENDERINGGROUPS;a<Q.MAX_RENDERINGGROUPS;a++){const O=this._renderingGroups[a];O&&O.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let a=Q.MIN_RENDERINGGROUPS;a<Q.MAX_RENDERINGGROUPS;a++){const O=this._renderingGroups[a];O&&O.dispose()}}_prepareRenderingGroup(a){void 0===this._renderingGroups[a]&&(this._renderingGroups[a]=new G(a,this._scene,this._customOpaqueSortCompareFn[a],this._customAlphaTestSortCompareFn[a],this._customTransparentSortCompareFn[a]))}dispatchSprites(a){this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatchSprites(a))}dispatchParticles(a){this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatchParticles(a))}dispatch(a,O,i){void 0===O&&(O=a.getMesh()),this.maintainStateBetweenFrames&&a._wasDispatched||(a._wasDispatched=!0,this.getRenderingGroup(O.renderingGroupId).dispatch(a,O,i))}setRenderingOrder(a){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,H=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[a]=O,this._customAlphaTestSortCompareFn[a]=i,this._customTransparentSortCompareFn[a]=H,this._renderingGroups[a]){const O=this._renderingGroups[a];O.opaqueSortCompareFn=this._customOpaqueSortCompareFn[a],O.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[a],O.transparentSortCompareFn=this._customTransparentSortCompareFn[a]}}setRenderingAutoClearDepthStencil(a,O){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],H=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[a]={Jb:O,depth:i,hb:H}}getAutoClearDepthStencilSetup(a){return this._autoClearDepthStencil[a]}}Q.MAX_RENDERINGGROUPS=4,Q.MIN_RENDERINGGROUPS=0,Q.AUTOCLEAR=!0}}]);