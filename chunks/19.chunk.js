"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[19],{11265:(Z,x,F)=>{F.d(x,{e:()=>Y,f:()=>j});var u=F(11267),G=F(11012),f=F(11271);class Y{get J(){return this._isDisposed}constructor(Z,x,F){let G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],d=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,Z&&Z.KZ?this._engine=Z.KZ().getEngine():this._engine=Z,this._updatable=F,this._instanced=Y,this._divisor=d||1,this._label=t,x instanceof u.d?(this._data=null,this._buffer=x):(this._data=x,this._buffer=null),this.byteStride=j?G:G*Float32Array.BYTES_PER_ELEMENT,f||this.create()}createVertexBuffer(Z,x,F,u,G){let f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6?arguments[6]:void 0;const d=f?x:x*Float32Array.BYTES_PER_ELEMENT,t=u?f?u:u*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new j(this._engine,this,Z,this._updatable,!0,t,void 0===G?this._instanced:G,d,F,void 0,void 0,!0,this._divisor||Y)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!Z&&this._buffer||(Z=Z||this._data,Z&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z),this._data=Z):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(Z,this._label),this._data=Z):this._buffer=this._engine.createVertexBuffer(Z,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Kx>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Kx,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Kx,void 0,this._label));G.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(Z){this.create(Z)}updateDirectly(Z,x,F){let u=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z,u?x:x*Float32Array.BYTES_PER_ELEMENT,F?F*this.byteStride:void 0),this._data=0===x&&void 0===F?Z:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class j{get J(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(Z){const x=0!=Z;this._instanceDivisor=Z,x!==this._instanced&&(this._instanced=x,this._computeHashCode())}get _maxVerticesCount(){const Z=this.getData();return Z?Array.isArray(Z)?Z.length/(this.byteStride/4)-this.byteOffset/4:(Z.byteLength-this.byteOffset)/this.byteStride:0}constructor(Z,x,F,u,G,d,t,o,c,s){let J=arguments.length>10&&void 0!==arguments[10]&&arguments[10],p=arguments.length>11&&void 0!==arguments[11]&&arguments[11],U=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,k=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let M=!1;if(this.Ux=Z,"object"===typeof u&&null!==u?(M=u.updatable??!1,G=u.postponeInternalCreation,d=u.stride,t=u.instanced,o=u.offset,c=u.size,s=u.type,J=u.normalized??!1,p=u.useBytes??!1,U=u.divisor??1,k=u.takeBufferOwnership??!1,this._label=u.label):M=!!u,x instanceof Y?(this._buffer=x,this._ownsBuffer=k):(this._buffer=new Y(Z,x,M,d,G,t,p,U,this._label),this._ownsBuffer=!0),this.uniqueId=j._Counter++,this._kind=F,void 0===s){const Z=this.getData();this.type=Z?j.GetDataType(Z):j.FLOAT}else this.type=s;const m=(0,f.m)(this.type);p?(this._size=c||(d?d/m:j.DeduceStride(F)),this.byteStride=d||this._buffer.byteStride||this._size*m,this.byteOffset=o||0):(this._size=c||d||j.DeduceStride(F),this.byteStride=d?d*m:this._buffer.byteStride||this._size*m,this.byteOffset=(o||0)*m),this.normalized=J,this._instanced=void 0!==t&&t,this._instanceDivisor=t?U:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var Z;null===(Z=this._buffer)||void 0===Z||Z._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(Z,x){const F=this.getData();return F?(0,f.i)(F,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,Z,x):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,f.m)(this.type)}getOffset(){return this.byteOffset/(0,f.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,f.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(Z){this._buffer.create(Z),this._alignBuffer()}update(Z){this._buffer.update(Z),this._alignBuffer()}updateDirectly(Z,x){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(Z,x,void 0,F),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(Z,x){(0,f.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,Z,this.normalized,((Z,F)=>{for(let u=0;u<this._size;u++)x(Z[u],F+u)}))}_alignBuffer(){}static DeduceStride(Z){switch(Z){case j.UVKind:case j.UV2Kind:case j.UV3Kind:case j.UV4Kind:case j.UV5Kind:case j.UV6Kind:return 2;case j.NormalKind:case j.PositionKind:return 3;case j.ColorKind:case j.ColorInstanceKind:case j.MatricesIndicesKind:case j.MatricesIndicesExtraKind:case j.MatricesWeightsKind:case j.MatricesWeightsExtraKind:case j.TangentKind:return 4;default:throw new Error("Invalid kind '"+Z+"'")}}static GetDataType(Z){return Z instanceof Int8Array?j.BYTE:Z instanceof Uint8Array?j.UNSIGNED_BYTE:Z instanceof Int16Array?j.SHORT:Z instanceof Uint16Array?j.UNSIGNED_SHORT:Z instanceof Int32Array?j.INT:Z instanceof Uint32Array?j.UNSIGNED_INT:j.FLOAT}static GetTypeByteLength(Z){return(0,f.m)(Z)}static ForEach(Z,x,F,u,G,Y,j,d){(0,f.h)(Z,x,F,u,G,Y,j,((Z,x)=>{for(let F=0;F<u;F++)d(Z[F],x+F)}))}static GetFloatData(Z,x,F,u,G,Y,j,d){return(0,f.i)(Z,x,F,u,G,Y,j,d)}}j._Counter=0,j.BYTE=5120,j.UNSIGNED_BYTE=5121,j.SHORT=5122,j.UNSIGNED_SHORT=5123,j.INT=5124,j.UNSIGNED_INT=5125,j.FLOAT=5126,j.PositionKind="position",j.NormalKind="normal",j.TangentKind="tangent",j.UVKind="uv",j.UV2Kind="uv2",j.UV3Kind="uv3",j.UV4Kind="uv4",j.UV5Kind="uv5",j.UV6Kind="uv6",j.ColorKind="color",j.ColorInstanceKind="instanceColor",j.MatricesIndicesKind="matricesIndices",j.MatricesWeightsKind="matricesWeights",j.MatricesIndicesExtraKind="matricesIndicesExtra",j.MatricesWeightsExtraKind="matricesWeightsExtra"},11271:(Z,x,F)=>{F.d(x,{c:()=>s,e:()=>c,h:()=>d,i:()=>t,m:()=>Y,n:()=>j,q:()=>o});var u=F(11012);function G(Z,x,F,u){switch(x){case 5120:{let x=Z.getInt8(F);return u&&(x=Math.max(x/127,-1)),x}case 5121:{let x=Z.getUint8(F);return u&&(x/=255),x}case 5122:{let x=Z.getInt16(F,!0);return u&&(x=Math.max(x/32767,-1)),x}case 5123:{let x=Z.getUint16(F,!0);return u&&(x/=65535),x}case 5124:return Z.getInt32(F,!0);case 5125:return Z.getUint32(F,!0);case 5126:return Z.getFloat32(F,!0);default:throw new Error(`Invalid component type ${x}`)}}function f(Z,x,F,u,G){switch(x){case 5120:u&&(G=Math.round(127*G)),Z.setInt8(F,G);break;case 5121:u&&(G=Math.round(255*G)),Z.setUint8(F,G);break;case 5122:u&&(G=Math.round(32767*G)),Z.setInt16(F,G,!0);break;case 5123:u&&(G=Math.round(65535*G)),Z.setUint16(F,G,!0);break;case 5124:Z.setInt32(F,G,!0);break;case 5125:Z.setUint32(F,G,!0);break;case 5126:Z.setFloat32(F,G,!0);break;default:throw new Error(`Invalid component type ${x}`)}}function Y(Z){switch(Z){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${Z}'`)}}function j(Z){switch(Z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${Z}'`)}}function d(Z,x,F,u,j,d,t,o){const c=new Array(u),s=new Array(u);if(Z instanceof Array){let G=x/4;const f=F/4;for(let x=0;x<d;x+=u){for(let x=0;x<u;x++)c[x]=s[x]=Z[G+x];o(s,x);for(let x=0;x<u;x++)c[x]!==s[x]&&(Z[G+x]=s[x]);G+=f}}else{const J=ArrayBuffer.isView(Z)?new DataView(Z.buffer,Z.byteOffset,Z.byteLength):new DataView(Z),p=Y(j);for(let Z=0;Z<d;Z+=u){for(let Z=0,F=x;Z<u;Z++,F+=p)c[Z]=s[Z]=G(J,j,F,t);o(s,Z);for(let Z=0,F=x;Z<u;Z++,F+=p)c[Z]!==s[Z]&&f(J,j,F,t,s[Z]);x+=F}}}function t(Z,x,F,G,f,j,t,o){const c=x*Y(F),s=t*x;if(5126!==F||f!==c){const u=new Float32Array(s);return d(Z,G,f,x,F,s,j,((Z,F)=>{for(let G=0;G<x;G++)u[F+G]=Z[G]})),u}if(!(Z instanceof Array||Z instanceof Float32Array)||0!==G||Z.length!==s){if(Z instanceof Array){const x=G/4;return Z.slice(x,x+s)}if(Z instanceof ArrayBuffer)return new Float32Array(Z,G,s);{const x=Z.byteOffset+G;return 0!==(3&x)&&(u.d.Warn("Float array must be aligned to 4-bytes border"),o=!0),o?new Float32Array(Z.buffer.slice(x,x+s*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(Z.buffer,x,s)}}return o?Z.slice():Z}function o(Z,x,F,G,f,t,o,c){const s=Y(F),J=j(F),p=o*x;if(Array.isArray(Z)){if(0!==(3&G)||0!==(3&f))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const u=G/4,Y=f/4;if(u+(o-1)*Y+x>Z.length)throw new Error("Last accessed index is out of bounds.");if(Y<x)throw new Error("Data stride cannot be smaller than the component size.");if(Y!==x){const u=new J(p);return d(Z,G,f,x,F,p,t,((Z,F)=>{for(let G=0;G<x;G++)u[F+G]=Z[G]})),u}return new J(Z.slice(u,u+p))}let U,k=G;Z instanceof ArrayBuffer?U=Z:(U=Z.buffer,k+=Z.byteOffset);if(k+(o-1)*f+x*s>U.byteLength)throw new Error("Last accessed byte is out of bounds.");const M=x*s;if(f<M)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(f!==M){const Z=new J(p);return d(U,k,f,x,F,p,t,((F,u)=>{for(let G=0;G<x;G++)Z[u+G]=F[G]})),Z}return 1!==s&&0!==(k&s-1)&&(u.d.Warn("Array must be aligned to border of element size. Data will be copied."),c=!0),c?new J(U.slice(k,k+p*s)):new J(U,k,p)}function c(Z,x,F,G,f,j,t,o){const c=x*Y(F),s=t*x;if(o.length!==s)throw new Error("Output length is not valid");if(5126===F&&f===c)if(Z instanceof Array){const x=G/4;o.set(Z,x)}else if(Z instanceof ArrayBuffer){const x=new Float32Array(Z,G,s);o.set(x)}else{const x=Z.byteOffset+G;if(0!==(3&x))return u.d.Warn("Float array must be aligned to 4-bytes border"),void o.set(new Float32Array(Z.buffer.slice(x,x+s*Float32Array.BYTES_PER_ELEMENT)));const F=new Float32Array(Z.buffer,x,s);o.set(F)}else d(Z,G,f,x,F,s,j,((Z,F)=>{for(let u=0;u<x;u++)o[F+u]=Z[u]}))}function s(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(Z)){for(let G=0;G<x;G++)if(Z[F+G]-u>65535)return!0;return!1}return 4===Z.BYTES_PER_ELEMENT}},11267:(Z,x,F)=>{F.d(x,{d:()=>u});class u{get underlyingResource(){return null}constructor(){this.references=0,this.Kx=0,this.is32Bits=!1,this.uniqueId=u._Counter++}}u._Counter=0},11306:(Z,x,F)=>{F.d(x,{b:()=>G});var u=F(11072);class G{static GetEffect(Z){return void 0===Z.getPipelineContext?Z.effect:Z}constructor(Z){let x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=Z.createDrawContext(),x&&(this.materialContext=Z.createMaterialContext())}setEffect(Z,x){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var u;(this.effect=Z,void 0!==x&&(this.defines=x),F)&&(null===(u=this.drawContext)||void 0===u||u.reset())}dispose(){var Z;let x=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const Z=this.effect;x?Z.dispose():u.d.SetImmediate((()=>{Z.getEngine().onEndFrameObservable.addOnce((()=>{Z.dispose()}))})),this.effect=null}null===(Z=this.drawContext)||void 0===Z||Z.dispose()}}},11416:(Z,x,F)=>{F.d(x,{e:()=>G});var u=F(11238);class G{static GetPlanes(Z){const x=[];for(let F=0;F<6;F++)x.push(new u.d(0,0,0,0));return G.GetPlanesToRef(Z,x),x}static GetNearPlaneToRef(Z,x){const F=Z.m;x.normal.x=F[3]+F[2],x.normal.y=F[7]+F[6],x.normal.z=F[11]+F[10],x.d=F[15]+F[14],x.normalize()}static GetFarPlaneToRef(Z,x){const F=Z.m;x.normal.x=F[3]-F[2],x.normal.y=F[7]-F[6],x.normal.z=F[11]-F[10],x.d=F[15]-F[14],x.normalize()}static GetLeftPlaneToRef(Z,x){const F=Z.m;x.normal.x=F[3]+F[0],x.normal.y=F[7]+F[4],x.normal.z=F[11]+F[8],x.d=F[15]+F[12],x.normalize()}static GetRightPlaneToRef(Z,x){const F=Z.m;x.normal.x=F[3]-F[0],x.normal.y=F[7]-F[4],x.normal.z=F[11]-F[8],x.d=F[15]-F[12],x.normalize()}static GetTopPlaneToRef(Z,x){const F=Z.m;x.normal.x=F[3]-F[1],x.normal.y=F[7]-F[5],x.normal.z=F[11]-F[9],x.d=F[15]-F[13],x.normalize()}static GetBottomPlaneToRef(Z,x){const F=Z.m;x.normal.x=F[3]+F[1],x.normal.y=F[7]+F[5],x.normal.z=F[11]+F[9],x.d=F[15]+F[13],x.normalize()}static GetPlanesToRef(Z,x){G.GetNearPlaneToRef(Z,x[0]),G.GetFarPlaneToRef(Z,x[1]),G.GetLeftPlaneToRef(Z,x[2]),G.GetRightPlaneToRef(Z,x[3]),G.GetTopPlaneToRef(Z,x[4]),G.GetBottomPlaneToRef(Z,x[5])}static IsPointInFrustum(Z,x){for(let F=0;F<6;F++)if(x[F].dotCoordinate(Z)<0)return!1;return!0}}},11427:(Z,x,F)=>{F.d(x,{d:()=>G});var u=F(11022);class G{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(Z,x){G.Enabled&&(this._current+=Z,x&&this._fetchResult())}beginMonitoring(){G.Enabled&&(this._startMonitoringTime=u.e.Now)}endMonitoring(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!G.Enabled)return;Z&&this.fetchNewFrame();const x=u.e.Now;this._current=x-this._startMonitoringTime,Z&&this._fetchResult()}pf(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const Z=u.e.Now;Z-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=Z,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}G.Enabled=!0},11285:(Z,x,F)=>{F.d(x,{b:()=>G,d:()=>u});class u{constructor(Z){this.length=0,this.data=new Array(Z),this._id=u._GlobalId++}push(Z){this.data[this.length++]=Z,this.length>this.data.length&&(this.data.length*=2)}forEach(Z){for(let x=0;x<this.length;x++)Z(this.data[x])}sort(Z){this.data.sort(Z)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(let x=0;x<Z.length;x++)this.data[this.length++]=(Z.data||Z)[x]}}indexOf(Z){const x=this.data.indexOf(Z);return x>=this.length?-1:x}contains(Z){return-1!==this.indexOf(Z)}}u._GlobalId=0;class G extends u{constructor(){super(...arguments),this._duplicateId=0}push(Z){super.push(Z),Z.__smartArrayFlags||(Z.__smartArrayFlags={}),Z.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(Z){return(!Z.__smartArrayFlags||Z.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(Z),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(let x=0;x<Z.length;x++){const F=(Z.data||Z)[x];this.pushNoDuplicate(F)}}}}},11258:(Z,x,F)=>{F.d(x,{e:()=>f});var u=F(11265),G=F(11e3);class f{constructor(Z){this._vertexBuffers={},this.onBeforeRenderObservable=new G.b,this._scene=Z}_prepareBuffers(){if(this._vertexBuffers[u.f.PositionKind])return;const Z=[];Z.push(1,1),Z.push(-1,1),Z.push(-1,-1),Z.push(1,-1),this._vertexBuffers[u.f.PositionKind]=new u.f(this._scene.getEngine(),Z,u.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const Z=[];Z.push(0),Z.push(1),Z.push(2),Z.push(0),Z.push(2),Z.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(Z)}_rebuild(){const Z=this._vertexBuffers[u.f.PositionKind];Z&&(Z._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const F=this._scene.activeCamera;return!!F&&(x=x||F._postProcesses.filter((Z=>null!=Z)),!(!x||0===x.length||!this._scene.postProcessesEnabled)&&(x[0].activate(F,Z,null!==x&&void 0!==x),!0))}directRender(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,G=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Z.length;const j=this._scene.getEngine();for(let t=0;t<Y;t++){var d;if(t<Z.length-1)Z[t+1].activate(this._scene.activeCamera||this._scene,null===x||void 0===x?void 0:x.texture);else x?j.bindFramebuffer(x,u,void 0,void 0,F,G):f||j.restoreDefaultFramebuffer(),null===(d=j._debugInsertMarker)||void 0===d||d.call(j,`post process ${Z[t].name} output`);const Y=Z[t],o=Y.apply();o&&(Y.onBeforeRenderObservable.notifyObservers(o),this._prepareBuffers(),j.bindBuffers(this._vertexBuffers,this._indexBuffer,o),j.drawElementsType(0,0,6),Y.onAfterRenderObservable.notifyObservers(o))}j.setDepthBuffer(!0),j.setDepthWrite(!0)}_finalizeFrame(Z,x,F,u){let G=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const f=this._scene.activeCamera;if(!f)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(u=u||f._postProcesses.filter((Z=>null!=Z))).length||!this._scene.postProcessesEnabled)return;const Y=this._scene.getEngine();for(let d=0,t=u.length;d<t;d++){const o=u[d];var j;if(d<t-1)o._outputTexture=u[d+1].activate(f,null===x||void 0===x?void 0:x.texture);else x?(Y.bindFramebuffer(x,F,void 0,void 0,G),o._outputTexture=x):(Y.restoreDefaultFramebuffer(),o._outputTexture=null),null===(j=Y._debugInsertMarker)||void 0===j||j.call(Y,`post process ${u[d].name} output`);if(Z)break;const c=o.apply();c&&(o.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),Y.bindBuffers(this._vertexBuffers,this._indexBuffer,c),Y.drawElementsType(0,0,6),o.onAfterRenderObservable.notifyObservers(c))}Y.setDepthBuffer(!0),Y.setDepthWrite(!0),Y.setAlphaMode(0)}dispose(){const Z=this._vertexBuffers[u.f.PositionKind];Z&&(Z.dispose(),this._vertexBuffers[u.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11276:(Z,x,F)=>{F.d(x,{d:()=>j});var u=F(11285),G=F(11179);class f{set opaqueSortCompareFn(Z){this._opaqueSortCompareFn=Z||f.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(Z){this._alphaTestSortCompareFn=Z||f.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(Z){this._transparentSortCompareFn=Z||f.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(Z,x){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,G=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=Z,this._opaqueSubMeshes=new u.d(256),this._transparentSubMeshes=new u.d(256),this._alphaTestSubMeshes=new u.d(256),this._depthOnlySubMeshes=new u.d(256),this._particleSystems=new u.d(256),this._spriteManagers=new u.d(256),this._empty=!0,this._edgesRenderers=new u.b(16),this._scene=x,this.opaqueSortCompareFn=F,this.alphaTestSortCompareFn=G,this.transparentSortCompareFn=f}render(Z,x,F,u){if(Z)return void Z(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const G=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(G.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),G.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const f=G.getStencilBuffer();if(G.setStencilBuffer(!1),x&&this._renderSprites(),F&&this._renderParticles(u),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(G.setStencilBuffer(f),this._scene.useOrderIndependentTransparency){const Z=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);Z.length&&this._renderTransparent(Z)}else this._renderTransparent(this._transparentSubMeshes);G.setAlphaMode(0)}if(G.setStencilBuffer(!1),this._edgesRenderers.length){for(let Z=0;Z<this._edgesRenderers.length;Z++)this._edgesRenderers.data[Z].render();G.setAlphaMode(0)}G.setStencilBuffer(f)}_renderOpaqueSorted(Z){f._RenderSorted(Z,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(Z){f._RenderSorted(Z,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(Z){f._RenderSorted(Z,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(Z,x,F,u){let Y,j=0;const d=F?F.globalPosition:f._ZeroVector;if(u)for(;j<Z.length;j++)Y=Z.data[j],Y._alphaIndex=Y.getMesh().alphaIndex,Y._distanceToCamera=G.kx.Distance(Y.getBoundingInfo().boundingSphere.centerWorld,d);const t=Z.length===Z.data.length?Z.data:Z.data.slice(0,Z.length);x&&t.sort(x);const o=t[0].getMesh().KZ();for(j=0;j<t.length;j++)if(Y=t[j],!o._activeMeshesFrozenButKeepClipping||Y.isInFrustum(o._frustumPlanes)){if(u){const Z=Y.TZ();if(Z&&Z.needDepthPrePass){const x=Z.KZ().getEngine();x.setColorWrite(!1),x.setAlphaMode(0),Y.render(!1),x.setColorWrite(!0)}}Y.render(u)}}static defaultTransparentSortCompare(Z,x){return Z._alphaIndex>x._alphaIndex?1:Z._alphaIndex<x._alphaIndex?-1:f.backToFrontSortCompare(Z,x)}static backToFrontSortCompare(Z,x){return Z._distanceToCamera<x._distanceToCamera?1:Z._distanceToCamera>x._distanceToCamera?-1:0}static frontToBackSortCompare(Z,x){return Z._distanceToCamera<x._distanceToCamera?-1:Z._distanceToCamera>x._distanceToCamera?1:0}static PainterSortCompare(Z,x){const F=Z.getMesh(),u=x.getMesh();return F.material&&u.material?F.material.uniqueId-u.material.uniqueId:F.uniqueId-u.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(Z,x,F){void 0===x&&(x=Z.getMesh()),void 0===F&&(F=Z.TZ()),null!==F&&void 0!==F&&(F.needAlphaBlendingForMesh(x)?this._transparentSubMeshes.push(Z):F.needAlphaTestingForMesh(x)?(F.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._alphaTestSubMeshes.push(Z)):(F.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._opaqueSubMeshes.push(Z)),x._renderingGroup=this,x._edgesRenderer&&x.isEnabled()&&x.isVisible&&x._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(x._edgesRenderer),this._empty=!1)}dispatchSprites(Z){this._spriteManagers.push(Z),this._empty=!1}dispatchParticles(Z){this._particleSystems.push(Z),this._empty=!1}_renderParticles(Z){if(0===this._particleSystems.length)return;const x=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let F=0;F<this._particleSystems.length;F++){const u=this._particleSystems.data[F];if(0===(x&&x.layerMask&u.layerMask))continue;const G=u.i;G.position&&Z&&-1===Z.indexOf(G)||this._scene._activeParticles.addCount(u.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const Z=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let x=0;x<this._spriteManagers.length;x++){const F=this._spriteManagers.data[x];0!==(Z&&Z.layerMask&F.layerMask)&&F.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}f._ZeroVector=G.kx.Zero();class Y{}class j{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(Z){Z!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=Z,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const Z of this._scene.meshes)if(Z.bf)for(const x of Z.bf)x._wasDispatched=!1;if(this._scene.spriteManagers)for(const Z of this._scene.spriteManagers)Z._wasDispatched=!1;for(const Z of this._scene.Vs)Z._wasDispatched=!1}constructor(Z){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Y,this._maintainStateBetweenFrames=!1,this._scene=Z;for(let x=j.MIN_RENDERINGGROUPS;x<j.MAX_RENDERINGGROUPS;x++)this._autoClearDepthStencil[x]={ef:!0,depth:!0,stencil:!0}}getRenderingGroup(Z){const x=Z||0;return this._prepareRenderingGroup(x),this._renderingGroups[x]}_clearDepthStencilBuffer(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],x=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,Z,x),this._depthStencilBufferAlreadyCleaned=!0)}render(Z,x,F,u){const G=this._renderingGroupInfo;if(G.mx=this._scene,G.camera=this._scene.activeCamera,G.renderingManager=this,this._scene.spriteManagers&&u)for(let f=0;f<this._scene.spriteManagers.length;f++){const Z=this._scene.spriteManagers[f];this.dispatchSprites(Z)}for(let f=j.MIN_RENDERINGGROUPS;f<j.MAX_RENDERINGGROUPS;f++){this._depthStencilBufferAlreadyCleaned=f===j.MIN_RENDERINGGROUPS;const Y=this._renderingGroups[f];if(!Y||Y._empty)continue;const d=1<<f;if(G.renderingGroupId=f,this._scene.onBeforeRenderingGroupObservable.notifyObservers(G,d),j.AUTOCLEAR){const Z=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(f):this._autoClearDepthStencil[f];Z&&Z.ef&&this._clearDepthStencilBuffer(Z.depth,Z.stencil)}for(const Z of this._scene._beforeRenderingGroupDrawStage)Z.action(f);Y.render(Z,u,F,x);for(const Z of this._scene._afterRenderingGroupDrawStage)Z.action(f);this._scene.onAfterRenderingGroupObservable.notifyObservers(G,d)}}reset(){if(!this.maintainStateBetweenFrames)for(let Z=j.MIN_RENDERINGGROUPS;Z<j.MAX_RENDERINGGROUPS;Z++){const x=this._renderingGroups[Z];x&&x.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let Z=j.MIN_RENDERINGGROUPS;Z<j.MAX_RENDERINGGROUPS;Z++){const x=this._renderingGroups[Z];x&&x.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let Z=j.MIN_RENDERINGGROUPS;Z<j.MAX_RENDERINGGROUPS;Z++){const x=this._renderingGroups[Z];x&&x.dispose()}}_prepareRenderingGroup(Z){void 0===this._renderingGroups[Z]&&(this._renderingGroups[Z]=new f(Z,this._scene,this._customOpaqueSortCompareFn[Z],this._customAlphaTestSortCompareFn[Z],this._customTransparentSortCompareFn[Z]))}dispatchSprites(Z){this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatchSprites(Z))}dispatchParticles(Z){this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatchParticles(Z))}dispatch(Z,x,F){void 0===x&&(x=Z.getMesh()),this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(x.renderingGroupId).dispatch(Z,x,F))}setRenderingOrder(Z){let x=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[Z]=x,this._customAlphaTestSortCompareFn[Z]=F,this._customTransparentSortCompareFn[Z]=u,this._renderingGroups[Z]){const x=this._renderingGroups[Z];x.opaqueSortCompareFn=this._customOpaqueSortCompareFn[Z],x.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[Z],x.transparentSortCompareFn=this._customTransparentSortCompareFn[Z]}}setRenderingAutoClearDepthStencil(Z,x){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[Z]={ef:x,depth:F,stencil:u}}getAutoClearDepthStencilSetup(Z){return this._autoClearDepthStencil[Z]}}j.MAX_RENDERINGGROUPS=4,j.MIN_RENDERINGGROUPS=0,j.AUTOCLEAR=!0}}]);