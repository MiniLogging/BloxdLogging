"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[19],{11172:(q,S,b)=>{b.d(S,{b:()=>U,f:()=>g});var z=b(11181),C=b(10943),v=b(11187);class U{get V(){return this._isDisposed}constructor(q,S,b){let C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=arguments.length>4&&void 0!==arguments[4]&&arguments[4],U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7?arguments[7]:void 0,I=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,q&&q.Tq?this._engine=q.Tq().getEngine():this._engine=q,this._updatable=b,this._instanced=U,this._divisor=r||1,this._label=I,S instanceof z.d?(this._data=null,this._buffer=S):(this._data=S,this._buffer=null),this.byteStride=g?C:C*Float32Array.BYTES_PER_ELEMENT,v||this.create()}createVertexBuffer(q,S,b,z,C){let v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6?arguments[6]:void 0;const r=v?S:S*Float32Array.BYTES_PER_ELEMENT,I=z?v?z:z*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new g(this._engine,this,q,this._updatable,!0,I,void 0===C?this._instanced:C,r,b,void 0,void 0,!0,this._divisor||U)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!q&&this._buffer||(q=q||this._data,q&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,q),this._data=q):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(q,this._label),this._data=q):this._buffer=this._engine.createVertexBuffer(q,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.WS>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.WS,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.WS,void 0,this._label));C.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(q){this.create(q)}updateDirectly(q,S,b){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,q,z?S:S*Float32Array.BYTES_PER_ELEMENT,b?b*this.byteStride:void 0),this._data=0===S&&void 0===b?q:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class g{get V(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(q){const S=0!=q;this._instanceDivisor=q,S!==this._instanced&&(this._instanced=S,this._computeHashCode())}get _maxVerticesCount(){const q=this.getData();return q?Array.isArray(q)?q.length/(this.byteStride/4)-this.byteOffset/4:(q.byteLength-this.byteOffset)/this.byteStride:0}constructor(q,S,b,z,C,r,I,V,l,y){let R=arguments.length>10&&void 0!==arguments[10]&&arguments[10],G=arguments.length>11&&void 0!==arguments[11]&&arguments[11],Z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,H=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let Q=!1;if(this.lS=q,"object"===typeof z&&null!==z?(Q=z.updatable??!1,C=z.postponeInternalCreation,r=z.stride,I=z.instanced,V=z.offset,l=z.size,y=z.type,R=z.normalized??!1,G=z.useBytes??!1,Z=z.divisor??1,H=z.takeBufferOwnership??!1,this._label=z.label):Q=!!z,S instanceof U?(this._buffer=S,this._ownsBuffer=H):(this._buffer=new U(q,S,Q,r,C,I,G,Z,this._label),this._ownsBuffer=!0),this.uniqueId=g._Counter++,this._kind=b,void 0===y){const q=this.getData();this.type=q?g.GetDataType(q):g.FLOAT}else this.type=y;const k=(0,v.m)(this.type);G?(this._size=l||(r?r/k:g.DeduceStride(b)),this.byteStride=r||this._buffer.byteStride||this._size*k,this.byteOffset=V||0):(this._size=l||r||g.DeduceStride(b),this.byteStride=r?r*k:this._buffer.byteStride||this._size*k,this.byteOffset=(V||0)*k),this.normalized=R,this._instanced=void 0!==I&&I,this._instanceDivisor=I?Z:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var q;null===(q=this._buffer)||void 0===q||q._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(q,S){const b=this.getData();return b?(0,v.i)(b,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,q,S):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,v.m)(this.type)}getOffset(){return this.byteOffset/(0,v.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,v.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(q){this._buffer.create(q),this._alignBuffer()}update(q){this._buffer.update(q),this._alignBuffer()}updateDirectly(q,S){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(q,S,void 0,b),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(q,S){(0,v.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,q,this.normalized,((q,b)=>{for(let z=0;z<this._size;z++)S(q[z],b+z)}))}_alignBuffer(){}static DeduceStride(q){switch(q){case g.UVKind:case g.UV2Kind:case g.UV3Kind:case g.UV4Kind:case g.UV5Kind:case g.UV6Kind:return 2;case g.NormalKind:case g.PositionKind:return 3;case g.ColorKind:case g.ColorInstanceKind:case g.MatricesIndicesKind:case g.MatricesIndicesExtraKind:case g.MatricesWeightsKind:case g.MatricesWeightsExtraKind:case g.TangentKind:return 4;default:throw new Error("Invalid kind '"+q+"'")}}static GetDataType(q){return q instanceof Int8Array?g.BYTE:q instanceof Uint8Array?g.UNSIGNED_BYTE:q instanceof Int16Array?g.SHORT:q instanceof Uint16Array?g.UNSIGNED_SHORT:q instanceof Int32Array?g.INT:q instanceof Uint32Array?g.UNSIGNED_INT:g.FLOAT}static GetTypeByteLength(q){return(0,v.m)(q)}static ForEach(q,S,b,z,C,U,g,r){(0,v.h)(q,S,b,z,C,U,g,((q,S)=>{for(let b=0;b<z;b++)r(q[b],S+b)}))}static GetFloatData(q,S,b,z,C,U,g,r){return(0,v.i)(q,S,b,z,C,U,g,r)}}g._Counter=0,g.BYTE=5120,g.UNSIGNED_BYTE=5121,g.SHORT=5122,g.UNSIGNED_SHORT=5123,g.INT=5124,g.UNSIGNED_INT=5125,g.FLOAT=5126,g.PositionKind="position",g.NormalKind="normal",g.TangentKind="tangent",g.UVKind="uv",g.UV2Kind="uv2",g.UV3Kind="uv3",g.UV4Kind="uv4",g.UV5Kind="uv5",g.UV6Kind="uv6",g.ColorKind="color",g.ColorInstanceKind="instanceColor",g.MatricesIndicesKind="matricesIndices",g.MatricesWeightsKind="matricesWeights",g.MatricesIndicesExtraKind="matricesIndicesExtra",g.MatricesWeightsExtraKind="matricesWeightsExtra"},11187:(q,S,b)=>{b.d(S,{c:()=>y,e:()=>l,h:()=>r,i:()=>I,m:()=>U,p:()=>g,r:()=>V});var z=b(10943);function C(q,S,b,z){switch(S){case 5120:{let S=q.getInt8(b);return z&&(S=Math.max(S/127,-1)),S}case 5121:{let S=q.getUint8(b);return z&&(S/=255),S}case 5122:{let S=q.getInt16(b,!0);return z&&(S=Math.max(S/32767,-1)),S}case 5123:{let S=q.getUint16(b,!0);return z&&(S/=65535),S}case 5124:return q.getInt32(b,!0);case 5125:return q.getUint32(b,!0);case 5126:return q.getFloat32(b,!0);default:throw new Error(`Invalid component type ${S}`)}}function v(q,S,b,z,C){switch(S){case 5120:z&&(C=Math.round(127*C)),q.setInt8(b,C);break;case 5121:z&&(C=Math.round(255*C)),q.setUint8(b,C);break;case 5122:z&&(C=Math.round(32767*C)),q.setInt16(b,C,!0);break;case 5123:z&&(C=Math.round(65535*C)),q.setUint16(b,C,!0);break;case 5124:q.setInt32(b,C,!0);break;case 5125:q.setUint32(b,C,!0);break;case 5126:q.setFloat32(b,C,!0);break;default:throw new Error(`Invalid component type ${S}`)}}function U(q){switch(q){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${q}'`)}}function g(q){switch(q){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${q}'`)}}function r(q,S,b,z,g,r,I,V){const l=new Array(z),y=new Array(z);if(q instanceof Array){let C=S/4;const v=b/4;for(let S=0;S<r;S+=z){for(let S=0;S<z;S++)l[S]=y[S]=q[C+S];V(y,S);for(let S=0;S<z;S++)l[S]!==y[S]&&(q[C+S]=y[S]);C+=v}}else{const R=ArrayBuffer.isView(q)?new DataView(q.buffer,q.byteOffset,q.byteLength):new DataView(q),G=U(g);for(let q=0;q<r;q+=z){for(let q=0,b=S;q<z;q++,b+=G)l[q]=y[q]=C(R,g,b,I);V(y,q);for(let q=0,b=S;q<z;q++,b+=G)l[q]!==y[q]&&v(R,g,b,I,y[q]);S+=b}}}function I(q,S,b,C,v,g,I,V){const l=S*U(b),y=I*S;if(5126!==b||v!==l){const z=new Float32Array(y);return r(q,C,v,S,b,y,g,((q,b)=>{for(let C=0;C<S;C++)z[b+C]=q[C]})),z}if(!(q instanceof Array||q instanceof Float32Array)||0!==C||q.length!==y){if(q instanceof Array){const S=C/4;return q.slice(S,S+y)}if(q instanceof ArrayBuffer)return new Float32Array(q,C,y);{const S=q.byteOffset+C;return 0!==(3&S)&&(z.b.Warn("Float array must be aligned to 4-bytes border"),V=!0),V?new Float32Array(q.buffer.slice(S,S+y*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(q.buffer,S,y)}}return V?q.slice():q}function V(q,S,b,C,v,I,V,l){const y=U(b),R=g(b),G=V*S;if(Array.isArray(q)){if(0!==(3&C)||0!==(3&v))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const z=C/4,U=v/4;if(z+(V-1)*U+S>q.length)throw new Error("Last accessed index is out of bounds.");if(U<S)throw new Error("Data stride cannot be smaller than the component size.");if(U!==S){const z=new R(G);return r(q,C,v,S,b,G,I,((q,b)=>{for(let C=0;C<S;C++)z[b+C]=q[C]})),z}return new R(q.slice(z,z+G))}let Z,H=C;q instanceof ArrayBuffer?Z=q:(Z=q.buffer,H+=q.byteOffset);if(H+(V-1)*v+S*y>Z.byteLength)throw new Error("Last accessed byte is out of bounds.");const Q=S*y;if(v<Q)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(v!==Q){const q=new R(G);return r(Z,H,v,S,b,G,I,((b,z)=>{for(let C=0;C<S;C++)q[z+C]=b[C]})),q}return 1!==y&&0!==(H&y-1)&&(z.b.Warn("Array must be aligned to border of element size. Data will be copied."),l=!0),l?new R(Z.slice(H,H+G*y)):new R(Z,H,G)}function l(q,S,b,C,v,g,I,V){const l=S*U(b),y=I*S;if(V.length!==y)throw new Error("Output length is not valid");if(5126===b&&v===l)if(q instanceof Array){const S=C/4;V.set(q,S)}else if(q instanceof ArrayBuffer){const S=new Float32Array(q,C,y);V.set(S)}else{const S=q.byteOffset+C;if(0!==(3&S))return z.b.Warn("Float array must be aligned to 4-bytes border"),void V.set(new Float32Array(q.buffer.slice(S,S+y*Float32Array.BYTES_PER_ELEMENT)));const b=new Float32Array(q.buffer,S,y);V.set(b)}else r(q,C,v,S,b,y,g,((q,b)=>{for(let z=0;z<S;z++)V[b+z]=q[z]}))}function y(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(q)){for(let C=0;C<S;C++)if(q[b+C]-z>65535)return!0;return!1}return 4===q.BYTES_PER_ELEMENT}},11181:(q,S,b)=>{b.d(S,{d:()=>z});class z{get underlyingResource(){return null}constructor(){this.references=0,this.WS=0,this.is32Bits=!1,this.uniqueId=z._Counter++}}z._Counter=0},11220:(q,S,b)=>{b.d(S,{e:()=>C});var z=b(11e3);class C{static GetEffect(q){return void 0===q.getPipelineContext?q.effect:q}constructor(q){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=q.createDrawContext(),S&&(this.materialContext=q.createMaterialContext())}setEffect(q,S){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var z;(this.effect=q,void 0!==S&&(this.defines=S),b)&&(null===(z=this.drawContext)||void 0===z||z.reset())}dispose(){var q;let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const q=this.effect;S?q.dispose():z.e.SetImmediate((()=>{q.getEngine().onEndFrameObservable.addOnce((()=>{q.dispose()}))})),this.effect=null}null===(q=this.drawContext)||void 0===q||q.dispose()}}},11312:(q,S,b)=>{b.d(S,{c:()=>C});var z=b(11153);class C{static GetPlanes(q){const S=[];for(let b=0;b<6;b++)S.push(new z.e(0,0,0,0));return C.GetPlanesToRef(q,S),S}static GetNearPlaneToRef(q,S){const b=q.m;S.normal.x=b[3]+b[2],S.normal.y=b[7]+b[6],S.normal.z=b[11]+b[10],S.d=b[15]+b[14],S.normalize()}static GetFarPlaneToRef(q,S){const b=q.m;S.normal.x=b[3]-b[2],S.normal.y=b[7]-b[6],S.normal.z=b[11]-b[10],S.d=b[15]-b[14],S.normalize()}static GetLeftPlaneToRef(q,S){const b=q.m;S.normal.x=b[3]+b[0],S.normal.y=b[7]+b[4],S.normal.z=b[11]+b[8],S.d=b[15]+b[12],S.normalize()}static GetRightPlaneToRef(q,S){const b=q.m;S.normal.x=b[3]-b[0],S.normal.y=b[7]-b[4],S.normal.z=b[11]-b[8],S.d=b[15]-b[12],S.normalize()}static GetTopPlaneToRef(q,S){const b=q.m;S.normal.x=b[3]-b[1],S.normal.y=b[7]-b[5],S.normal.z=b[11]-b[9],S.d=b[15]-b[13],S.normalize()}static GetBottomPlaneToRef(q,S){const b=q.m;S.normal.x=b[3]+b[1],S.normal.y=b[7]+b[5],S.normal.z=b[11]+b[9],S.d=b[15]+b[13],S.normalize()}static GetPlanesToRef(q,S){C.GetNearPlaneToRef(q,S[0]),C.GetFarPlaneToRef(q,S[1]),C.GetLeftPlaneToRef(q,S[2]),C.GetRightPlaneToRef(q,S[3]),C.GetTopPlaneToRef(q,S[4]),C.GetBottomPlaneToRef(q,S[5])}static IsPointInFrustum(q,S){for(let b=0;b<6;b++)if(S[b].dotCoordinate(q)<0)return!1;return!0}}},11321:(q,S,b)=>{b.d(S,{b:()=>C});var z=b(10957);class C{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(q,S){C.Enabled&&(this._current+=q,S&&this._fetchResult())}beginMonitoring(){C.Enabled&&(this._startMonitoringTime=z.e.Now)}endMonitoring(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!C.Enabled)return;q&&this.fetchNewFrame();const S=z.e.Now;this._current=S-this._startMonitoringTime,q&&this._fetchResult()}Ub(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const q=z.e.Now;q-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=q,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}C.Enabled=!0},11200:(q,S,b)=>{b.d(S,{c:()=>C,g:()=>z});class z{constructor(q){this.length=0,this.data=new Array(q),this._id=z._GlobalId++}push(q){this.data[this.length++]=q,this.length>this.data.length&&(this.data.length*=2)}forEach(q){for(let S=0;S<this.length;S++)q(this.data[S])}sort(q){this.data.sort(q)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(q){if(0!==q.length){this.length+q.length>this.data.length&&(this.data.length=2*(this.length+q.length));for(let S=0;S<q.length;S++)this.data[this.length++]=(q.data||q)[S]}}indexOf(q){const S=this.data.indexOf(q);return S>=this.length?-1:S}contains(q){return-1!==this.indexOf(q)}}z._GlobalId=0;class C extends z{constructor(){super(...arguments),this._duplicateId=0}push(q){super.push(q),q.__smartArrayFlags||(q.__smartArrayFlags={}),q.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(q){return(!q.__smartArrayFlags||q.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(q),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(q){if(0!==q.length){this.length+q.length>this.data.length&&(this.data.length=2*(this.length+q.length));for(let S=0;S<q.length;S++){const b=(q.data||q)[S];this.pushNoDuplicate(b)}}}}},11168:(q,S,b)=>{b.d(S,{d:()=>v});var z=b(11172),C=b(10929);class v{constructor(q){this._vertexBuffers={},this.onBeforeRenderObservable=new C.d,this._scene=q}_prepareBuffers(){if(this._vertexBuffers[z.f.PositionKind])return;const q=[];q.push(1,1),q.push(-1,1),q.push(-1,-1),q.push(1,-1),this._vertexBuffers[z.f.PositionKind]=new z.f(this._scene.getEngine(),q,z.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const q=[];q.push(0),q.push(1),q.push(2),q.push(0),q.push(2),q.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(q)}_rebuild(){const q=this._vertexBuffers[z.f.PositionKind];q&&(q._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const b=this._scene.activeCamera;return!!b&&(S=S||b._postProcesses.filter((q=>null!=q)),!(!S||0===S.length||!this._scene.postProcessesEnabled)&&(S[0].activate(b,q,null!==S&&void 0!==S),!0))}directRender(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,v=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:q.length;const g=this._scene.getEngine();for(let I=0;I<U;I++){var r;if(I<q.length-1)q[I+1].activate(this._scene.activeCamera||this._scene,null===S||void 0===S?void 0:S.texture);else S?g.bindFramebuffer(S,z,void 0,void 0,b,C):v||g.restoreDefaultFramebuffer(),null===(r=g._debugInsertMarker)||void 0===r||r.call(g,`post process ${q[I].name} output`);const U=q[I],V=U.apply();V&&(U.onBeforeRenderObservable.notifyObservers(V),this._prepareBuffers(),g.bindBuffers(this._vertexBuffers,this._indexBuffer,V),g.drawElementsType(0,0,6),U.onAfterRenderObservable.notifyObservers(V))}g.setDepthBuffer(!0),g.setDepthWrite(!0)}_finalizeFrame(q,S,b,z){let C=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const v=this._scene.activeCamera;if(!v)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(z=z||v._postProcesses.filter((q=>null!=q))).length||!this._scene.postProcessesEnabled)return;const U=this._scene.getEngine();for(let r=0,I=z.length;r<I;r++){const V=z[r];var g;if(r<I-1)V._outputTexture=z[r+1].activate(v,null===S||void 0===S?void 0:S.texture);else S?(U.bindFramebuffer(S,b,void 0,void 0,C),V._outputTexture=S):(U.restoreDefaultFramebuffer(),V._outputTexture=null),null===(g=U._debugInsertMarker)||void 0===g||g.call(U,`post process ${z[r].name} output`);if(q)break;const l=V.apply();l&&(V.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),U.bindBuffers(this._vertexBuffers,this._indexBuffer,l),U.drawElementsType(0,0,6),V.onAfterRenderObservable.notifyObservers(l))}U.setDepthBuffer(!0),U.setDepthWrite(!0),U.setAlphaMode(0)}dispose(){const q=this._vertexBuffers[z.f.PositionKind];q&&(q.dispose(),this._vertexBuffers[z.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11196:(q,S,b)=>{b.d(S,{d:()=>g});var z=b(11200),C=b(11103);class v{set opaqueSortCompareFn(q){this._opaqueSortCompareFn=q||v.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(q){this._alphaTestSortCompareFn=q||v.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(q){this._transparentSortCompareFn=q||v.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(q,S){let b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=q,this._opaqueSubMeshes=new z.g(256),this._transparentSubMeshes=new z.g(256),this._alphaTestSubMeshes=new z.g(256),this._depthOnlySubMeshes=new z.g(256),this._particleSystems=new z.g(256),this._spriteManagers=new z.g(256),this._empty=!0,this._edgesRenderers=new z.c(16),this._scene=S,this.opaqueSortCompareFn=b,this.alphaTestSortCompareFn=C,this.transparentSortCompareFn=v}render(q,S,b,z){if(q)return void q(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const C=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(C.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),C.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const v=C.getStencilBuffer();if(C.setStencilBuffer(!1),S&&this._renderSprites(),b&&this._renderParticles(z),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(C.setStencilBuffer(v),this._scene.useOrderIndependentTransparency){const q=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);q.length&&this._renderTransparent(q)}else this._renderTransparent(this._transparentSubMeshes);C.setAlphaMode(0)}if(C.setStencilBuffer(!1),this._edgesRenderers.length){for(let q=0;q<this._edgesRenderers.length;q++)this._edgesRenderers.data[q].render();C.setAlphaMode(0)}C.setStencilBuffer(v)}_renderOpaqueSorted(q){v._RenderSorted(q,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(q){v._RenderSorted(q,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(q){v._RenderSorted(q,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(q,S,b,z){let U,g=0;const r=b?b.globalPosition:v._ZeroVector;if(z)for(;g<q.length;g++)U=q.data[g],U._alphaIndex=U.getMesh().alphaIndex,U._distanceToCamera=C.yS.Distance(U.getBoundingInfo().boundingSphere.centerWorld,r);const I=q.length===q.data.length?q.data:q.data.slice(0,q.length);S&&I.sort(S);const V=I[0].getMesh().Tq();for(g=0;g<I.length;g++)if(U=I[g],!V._activeMeshesFrozenButKeepClipping||U.isInFrustum(V._frustumPlanes)){if(z){const q=U.Dq();if(q&&q.needDepthPrePass){const S=q.Tq().getEngine();S.setColorWrite(!1),S.setAlphaMode(0),U.render(!1),S.setColorWrite(!0)}}U.render(z)}}static defaultTransparentSortCompare(q,S){return q._alphaIndex>S._alphaIndex?1:q._alphaIndex<S._alphaIndex?-1:v.backToFrontSortCompare(q,S)}static backToFrontSortCompare(q,S){return q._distanceToCamera<S._distanceToCamera?1:q._distanceToCamera>S._distanceToCamera?-1:0}static frontToBackSortCompare(q,S){return q._distanceToCamera<S._distanceToCamera?-1:q._distanceToCamera>S._distanceToCamera?1:0}static PainterSortCompare(q,S){const b=q.getMesh(),z=S.getMesh();return b.material&&z.material?b.material.uniqueId-z.material.uniqueId:b.uniqueId-z.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(q,S,b){void 0===S&&(S=q.getMesh()),void 0===b&&(b=q.Dq()),null!==b&&void 0!==b&&(b.needAlphaBlendingForMesh(S)?this._transparentSubMeshes.push(q):b.needAlphaTestingForMesh(S)?(b.needDepthPrePass&&this._depthOnlySubMeshes.push(q),this._alphaTestSubMeshes.push(q)):(b.needDepthPrePass&&this._depthOnlySubMeshes.push(q),this._opaqueSubMeshes.push(q)),S._renderingGroup=this,S._edgesRenderer&&S.isEnabled()&&S.isVisible&&S._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(S._edgesRenderer),this._empty=!1)}dispatchSprites(q){this._spriteManagers.push(q),this._empty=!1}dispatchParticles(q){this._particleSystems.push(q),this._empty=!1}_renderParticles(q){if(0===this._particleSystems.length)return;const S=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let b=0;b<this._particleSystems.length;b++){const z=this._particleSystems.data[b];if(0===(S&&S.layerMask&z.layerMask))continue;const C=z.j;C.position&&q&&-1===q.indexOf(C)||this._scene._activeParticles.addCount(z.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const q=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let S=0;S<this._spriteManagers.length;S++){const b=this._spriteManagers.data[S];0!==(q&&q.layerMask&b.layerMask)&&b.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}v._ZeroVector=C.yS.Zero();class U{}class g{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(q){q!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=q,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const q of this._scene.meshes)if(q.Gb)for(const S of q.Gb)S._wasDispatched=!1;if(this._scene.spriteManagers)for(const q of this._scene.spriteManagers)q._wasDispatched=!1;for(const q of this._scene.Gy)q._wasDispatched=!1}constructor(q){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new U,this._maintainStateBetweenFrames=!1,this._scene=q;for(let S=g.MIN_RENDERINGGROUPS;S<g.MAX_RENDERINGGROUPS;S++)this._autoClearDepthStencil[S]={Rb:!0,depth:!0,stencil:!0}}getRenderingGroup(q){const S=q||0;return this._prepareRenderingGroup(S),this._renderingGroups[S]}_clearDepthStencilBuffer(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,q,S),this._depthStencilBufferAlreadyCleaned=!0)}render(q,S,b,z){const C=this._renderingGroupInfo;if(C.GS=this._scene,C.camera=this._scene.activeCamera,C.renderingManager=this,this._scene.spriteManagers&&z)for(let v=0;v<this._scene.spriteManagers.length;v++){const q=this._scene.spriteManagers[v];this.dispatchSprites(q)}for(let v=g.MIN_RENDERINGGROUPS;v<g.MAX_RENDERINGGROUPS;v++){this._depthStencilBufferAlreadyCleaned=v===g.MIN_RENDERINGGROUPS;const U=this._renderingGroups[v];if(!U||U._empty)continue;const r=1<<v;if(C.renderingGroupId=v,this._scene.onBeforeRenderingGroupObservable.notifyObservers(C,r),g.AUTOCLEAR){const q=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(v):this._autoClearDepthStencil[v];q&&q.Rb&&this._clearDepthStencilBuffer(q.depth,q.stencil)}for(const q of this._scene._beforeRenderingGroupDrawStage)q.action(v);U.render(q,z,b,S);for(const q of this._scene._afterRenderingGroupDrawStage)q.action(v);this._scene.onAfterRenderingGroupObservable.notifyObservers(C,r)}}reset(){if(!this.maintainStateBetweenFrames)for(let q=g.MIN_RENDERINGGROUPS;q<g.MAX_RENDERINGGROUPS;q++){const S=this._renderingGroups[q];S&&S.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let q=g.MIN_RENDERINGGROUPS;q<g.MAX_RENDERINGGROUPS;q++){const S=this._renderingGroups[q];S&&S.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let q=g.MIN_RENDERINGGROUPS;q<g.MAX_RENDERINGGROUPS;q++){const S=this._renderingGroups[q];S&&S.dispose()}}_prepareRenderingGroup(q){void 0===this._renderingGroups[q]&&(this._renderingGroups[q]=new v(q,this._scene,this._customOpaqueSortCompareFn[q],this._customAlphaTestSortCompareFn[q],this._customTransparentSortCompareFn[q]))}dispatchSprites(q){this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatchSprites(q))}dispatchParticles(q){this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatchParticles(q))}dispatch(q,S,b){void 0===S&&(S=q.getMesh()),this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(S.renderingGroupId).dispatch(q,S,b))}setRenderingOrder(q){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[q]=S,this._customAlphaTestSortCompareFn[q]=b,this._customTransparentSortCompareFn[q]=z,this._renderingGroups[q]){const S=this._renderingGroups[q];S.opaqueSortCompareFn=this._customOpaqueSortCompareFn[q],S.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[q],S.transparentSortCompareFn=this._customTransparentSortCompareFn[q]}}setRenderingAutoClearDepthStencil(q,S){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[q]={Rb:S,depth:b,stencil:z}}getAutoClearDepthStencilSetup(q){return this._autoClearDepthStencil[q]}}g.MAX_RENDERINGGROUPS=4,g.MIN_RENDERINGGROUPS=0,g.AUTOCLEAR=!0}}]);