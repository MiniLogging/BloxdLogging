"use strict";(self.ksd6jhs1yr=self.ksd6jhs1yr||[]).push([[19],{12471:(C,c,d)=>{d.d(c,{d:()=>V,g:()=>R});var b=d(12477),X=d(12233),P=d(12483);class V{get Z(){return this._isDisposed}constructor(C,c,d){let X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,P=arguments.length>4&&void 0!==arguments[4]&&arguments[4],V=arguments.length>5&&void 0!==arguments[5]&&arguments[5],R=arguments.length>6&&void 0!==arguments[6]&&arguments[6],p=arguments.length>7?arguments[7]:void 0,j=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,C&&C.NC?this._engine=C.NC().getEngine():this._engine=C,this._updatable=d,this._instanced=V,this._divisor=p||1,this._label=j,c instanceof b.b?(this._data=null,this._buffer=c):(this._data=c,this._buffer=null),this.byteStride=R?X:X*Float32Array.BYTES_PER_ELEMENT,P||this.create()}createVertexBuffer(C,c,d,b,X){let P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6?arguments[6]:void 0;const p=P?c:c*Float32Array.BYTES_PER_ELEMENT,j=b?P?b:b*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new R(this._engine,this,C,this._updatable,!0,j,void 0===X?this._instanced:X,p,d,void 0,void 0,!0,this._divisor||V)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!C&&this._buffer||(C=C||this._data,C&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,C),this._data=C):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(C,this._label),this._data=C):this._buffer=this._engine.createVertexBuffer(C,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.wX>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.wX,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.wX,void 0,this._label));X.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(C){this.create(C)}updateDirectly(C,c,d){let b=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,C,b?c:c*Float32Array.BYTES_PER_ELEMENT,d?d*this.byteStride:void 0),this._data=0===c&&void 0===d?C:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class R{get Z(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(C){const c=0!=C;this._instanceDivisor=C,c!==this._instanced&&(this._instanced=c,this._computeHashCode())}get _maxVerticesCount(){const C=this.getData();return C?Array.isArray(C)?C.length/(this.byteStride/4)-this.byteOffset/4:(C.byteLength-this.byteOffset)/this.byteStride:0}constructor(C,c,d,b,X,p,j,g,k,Z){let U=arguments.length>10&&void 0!==arguments[10]&&arguments[10],A=arguments.length>11&&void 0!==arguments[11]&&arguments[11],u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,q=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let B=!1;if(this.Gc=C,"object"===typeof b&&null!==b?(B=b.updatable??!1,X=b.postponeInternalCreation,p=b.stride,j=b.instanced,g=b.offset,k=b.size,Z=b.type,U=b.normalized??!1,A=b.useBytes??!1,u=b.divisor??1,q=b.takeBufferOwnership??!1,this._label=b.label):B=!!b,c instanceof V?(this._buffer=c,this._ownsBuffer=q):(this._buffer=new V(C,c,B,p,X,j,A,u,this._label),this._ownsBuffer=!0),this.uniqueId=R._Counter++,this._kind=d,void 0===Z){const C=this.getData();this.type=C?R.GetDataType(C):R.FLOAT}else this.type=Z;const t=(0,P.p)(this.type);A?(this._size=k||(p?p/t:R.DeduceStride(d)),this.byteStride=p||this._buffer.byteStride||this._size*t,this.byteOffset=g||0):(this._size=k||p||R.DeduceStride(d),this.byteStride=p?p*t:this._buffer.byteStride||this._size*t,this.byteOffset=(g||0)*t),this.normalized=U,this._instanced=void 0!==j&&j,this._instanceDivisor=j?u:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var C;null===(C=this._buffer)||void 0===C||C._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(C,c){const d=this.getData();return d?(0,P.l)(d,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,C,c):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,P.p)(this.type)}getOffset(){return this.byteOffset/(0,P.p)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,P.p)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(C){this._buffer.create(C),this._alignBuffer()}update(C){this._buffer.update(C),this._alignBuffer()}updateDirectly(C,c){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(C,c,void 0,d),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(C,c){(0,P.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,C,this.normalized,((C,d)=>{for(let b=0;b<this._size;b++)c(C[b],d+b)}))}_alignBuffer(){}static DeduceStride(C){switch(C){case R.UVKind:case R.UV2Kind:case R.UV3Kind:case R.UV4Kind:case R.UV5Kind:case R.UV6Kind:return 2;case R.NormalKind:case R.PositionKind:return 3;case R.ColorKind:case R.ColorInstanceKind:case R.MatricesIndicesKind:case R.MatricesIndicesExtraKind:case R.MatricesWeightsKind:case R.MatricesWeightsExtraKind:case R.TangentKind:return 4;default:throw new Error("Invalid kind '"+C+"'")}}static GetDataType(C){return C instanceof Int8Array?R.BYTE:C instanceof Uint8Array?R.UNSIGNED_BYTE:C instanceof Int16Array?R.SHORT:C instanceof Uint16Array?R.UNSIGNED_SHORT:C instanceof Int32Array?R.INT:C instanceof Uint32Array?R.UNSIGNED_INT:R.FLOAT}static GetTypeByteLength(C){return(0,P.p)(C)}static ForEach(C,c,d,b,X,V,R,p){(0,P.h)(C,c,d,b,X,V,R,((C,c)=>{for(let d=0;d<b;d++)p(C[d],c+d)}))}static GetFloatData(C,c,d,b,X,V,R,p){return(0,P.l)(C,c,d,b,X,V,R,p)}}R._Counter=0,R.BYTE=5120,R.UNSIGNED_BYTE=5121,R.SHORT=5122,R.UNSIGNED_SHORT=5123,R.INT=5124,R.UNSIGNED_INT=5125,R.FLOAT=5126,R.PositionKind="position",R.NormalKind="normal",R.TangentKind="tangent",R.UVKind="uv",R.UV2Kind="uv2",R.UV3Kind="uv3",R.UV4Kind="uv4",R.UV5Kind="uv5",R.UV6Kind="uv6",R.ColorKind="color",R.ColorInstanceKind="instanceColor",R.MatricesIndicesKind="matricesIndices",R.MatricesWeightsKind="matricesWeights",R.MatricesIndicesExtraKind="matricesIndicesExtra",R.MatricesWeightsExtraKind="matricesWeightsExtra"},12483:(C,c,d)=>{d.d(c,{d:()=>Z,e:()=>k,h:()=>p,l:()=>j,p:()=>V,r:()=>R,v:()=>g});var b=d(12233);function X(C,c,d,b){switch(c){case 5120:{let c=C.getInt8(d);return b&&(c=Math.max(c/127,-1)),c}case 5121:{let c=C.getUint8(d);return b&&(c/=255),c}case 5122:{let c=C.getInt16(d,!0);return b&&(c=Math.max(c/32767,-1)),c}case 5123:{let c=C.getUint16(d,!0);return b&&(c/=65535),c}case 5124:return C.getInt32(d,!0);case 5125:return C.getUint32(d,!0);case 5126:return C.getFloat32(d,!0);default:throw new Error(`Invalid component type ${c}`)}}function P(C,c,d,b,X){switch(c){case 5120:b&&(X=Math.round(127*X)),C.setInt8(d,X);break;case 5121:b&&(X=Math.round(255*X)),C.setUint8(d,X);break;case 5122:b&&(X=Math.round(32767*X)),C.setInt16(d,X,!0);break;case 5123:b&&(X=Math.round(65535*X)),C.setUint16(d,X,!0);break;case 5124:C.setInt32(d,X,!0);break;case 5125:C.setUint32(d,X,!0);break;case 5126:C.setFloat32(d,X,!0);break;default:throw new Error(`Invalid component type ${c}`)}}function V(C){switch(C){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${C}'`)}}function R(C){switch(C){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${C}'`)}}function p(C,c,d,b,R,p,j,g){const k=new Array(b),Z=new Array(b);if(C instanceof Array){let X=c/4;const P=d/4;for(let c=0;c<p;c+=b){for(let c=0;c<b;c++)k[c]=Z[c]=C[X+c];g(Z,c);for(let c=0;c<b;c++)k[c]!==Z[c]&&(C[X+c]=Z[c]);X+=P}}else{const U=ArrayBuffer.isView(C)?new DataView(C.buffer,C.byteOffset,C.byteLength):new DataView(C),A=V(R);for(let C=0;C<p;C+=b){for(let C=0,d=c;C<b;C++,d+=A)k[C]=Z[C]=X(U,R,d,j);g(Z,C);for(let C=0,d=c;C<b;C++,d+=A)k[C]!==Z[C]&&P(U,R,d,j,Z[C]);c+=d}}}function j(C,c,d,X,P,R,j,g){const k=c*V(d),Z=j*c;if(5126!==d||P!==k){const b=new Float32Array(Z);return p(C,X,P,c,d,Z,R,((C,d)=>{for(let X=0;X<c;X++)b[d+X]=C[X]})),b}if(!(C instanceof Array||C instanceof Float32Array)||0!==X||C.length!==Z){if(C instanceof Array){const c=X/4;return C.slice(c,c+Z)}if(C instanceof ArrayBuffer)return new Float32Array(C,X,Z);{const c=C.byteOffset+X;return 0!==(3&c)&&(b.d.Warn("Float array must be aligned to 4-bytes border"),g=!0),g?new Float32Array(C.buffer.slice(c,c+Z*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(C.buffer,c,Z)}}return g?C.slice():C}function g(C,c,d,X,P,j,g,k){const Z=V(d),U=R(d),A=g*c;if(Array.isArray(C)){if(0!==(3&X)||0!==(3&P))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const b=X/4,V=P/4;if(b+(g-1)*V+c>C.length)throw new Error("Last accessed index is out of bounds.");if(V<c)throw new Error("Data stride cannot be smaller than the component size.");if(V!==c){const b=new U(A);return p(C,X,P,c,d,A,j,((C,d)=>{for(let X=0;X<c;X++)b[d+X]=C[X]})),b}return new U(C.slice(b,b+A))}let u,q=X;C instanceof ArrayBuffer?u=C:(u=C.buffer,q+=C.byteOffset);if(q+(g-1)*P+c*Z>u.byteLength)throw new Error("Last accessed byte is out of bounds.");const B=c*Z;if(P<B)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(P!==B){const C=new U(A);return p(u,q,P,c,d,A,j,((d,b)=>{for(let X=0;X<c;X++)C[b+X]=d[X]})),C}return 1!==Z&&0!==(q&Z-1)&&(b.d.Warn("Array must be aligned to border of element size. Data will be copied."),k=!0),k?new U(u.slice(q,q+A*Z)):new U(u,q,A)}function k(C,c,d,X,P,R,j,g){const k=c*V(d),Z=j*c;if(g.length!==Z)throw new Error("Output length is not valid");if(5126===d&&P===k)if(C instanceof Array){const c=X/4;g.set(C,c)}else if(C instanceof ArrayBuffer){const c=new Float32Array(C,X,Z);g.set(c)}else{const c=C.byteOffset+X;if(0!==(3&c))return b.d.Warn("Float array must be aligned to 4-bytes border"),void g.set(new Float32Array(C.buffer.slice(c,c+Z*Float32Array.BYTES_PER_ELEMENT)));const d=new Float32Array(C.buffer,c,Z);g.set(d)}else p(C,X,P,c,d,Z,R,((C,d)=>{for(let b=0;b<c;b++)g[d+b]=C[b]}))}function Z(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(C)){for(let X=0;X<c;X++)if(C[d+X]-b>65535)return!0;return!1}return 4===C.BYTES_PER_ELEMENT}},12477:(C,c,d)=>{d.d(c,{b:()=>b});class b{get underlyingResource(){return null}constructor(){this.references=0,this.wX=0,this.is32Bits=!1,this.uniqueId=b._Counter++}}b._Counter=0},12514:(C,c,d)=>{d.d(c,{b:()=>X});var b=d(12281);class X{static GetEffect(C){return void 0===C.getPipelineContext?C.effect:C}constructor(C){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=C.createDrawContext(),c&&(this.materialContext=C.createMaterialContext())}setEffect(C,c){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var b;(this.effect=C,void 0!==c&&(this.defines=c),d)&&(null===(b=this.drawContext)||void 0===b||b.reset())}dispose(){var C;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const C=this.effect;c?C.dispose():b.d.SetImmediate((()=>{C.getEngine().onEndFrameObservable.addOnce((()=>{C.dispose()}))})),this.effect=null}null===(C=this.drawContext)||void 0===C||C.dispose()}}},12610:(C,c,d)=>{d.d(c,{c:()=>X});var b=d(12442);class X{static GetPlanes(C){const c=[];for(let d=0;d<6;d++)c.push(new b.c(0,0,0,0));return X.GetPlanesToRef(C,c),c}static GetNearPlaneToRef(C,c){const d=C.m;c.normal.x=d[3]+d[2],c.normal.y=d[7]+d[6],c.normal.z=d[11]+d[10],c.d=d[15]+d[14],c.normalize()}static GetFarPlaneToRef(C,c){const d=C.m;c.normal.x=d[3]-d[2],c.normal.y=d[7]-d[6],c.normal.z=d[11]-d[10],c.d=d[15]-d[14],c.normalize()}static GetLeftPlaneToRef(C,c){const d=C.m;c.normal.x=d[3]+d[0],c.normal.y=d[7]+d[4],c.normal.z=d[11]+d[8],c.d=d[15]+d[12],c.normalize()}static GetRightPlaneToRef(C,c){const d=C.m;c.normal.x=d[3]-d[0],c.normal.y=d[7]-d[4],c.normal.z=d[11]-d[8],c.d=d[15]-d[12],c.normalize()}static GetTopPlaneToRef(C,c){const d=C.m;c.normal.x=d[3]-d[1],c.normal.y=d[7]-d[5],c.normal.z=d[11]-d[9],c.d=d[15]-d[13],c.normalize()}static GetBottomPlaneToRef(C,c){const d=C.m;c.normal.x=d[3]+d[1],c.normal.y=d[7]+d[5],c.normal.z=d[11]+d[9],c.d=d[15]+d[13],c.normalize()}static GetPlanesToRef(C,c){X.GetNearPlaneToRef(C,c[0]),X.GetFarPlaneToRef(C,c[1]),X.GetLeftPlaneToRef(C,c[2]),X.GetRightPlaneToRef(C,c[3]),X.GetTopPlaneToRef(C,c[4]),X.GetBottomPlaneToRef(C,c[5])}static IsPointInFrustum(C,c){for(let d=0;d<6;d++)if(c[d].dotCoordinate(C)<0)return!1;return!0}}},12617:(C,c,d)=>{d.d(c,{b:()=>X});var b=d(12241);class X{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(C,c){X.Enabled&&(this._current+=C,c&&this._fetchResult())}beginMonitoring(){X.Enabled&&(this._startMonitoringTime=b.e.Now)}endMonitoring(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!X.Enabled)return;C&&this.fetchNewFrame();const c=b.e.Now;this._current=c-this._startMonitoringTime,C&&this._fetchResult()}Zc(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const C=b.e.Now;C-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=C,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}X.Enabled=!0},12496:(C,c,d)=>{d.d(c,{e:()=>X,f:()=>b});class b{constructor(C){this.length=0,this.data=new Array(C),this._id=b._GlobalId++}push(C){this.data[this.length++]=C,this.length>this.data.length&&(this.data.length*=2)}forEach(C){for(let c=0;c<this.length;c++)C(this.data[c])}sort(C){this.data.sort(C)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(C){if(0!==C.length){this.length+C.length>this.data.length&&(this.data.length=2*(this.length+C.length));for(let c=0;c<C.length;c++)this.data[this.length++]=(C.data||C)[c]}}indexOf(C){const c=this.data.indexOf(C);return c>=this.length?-1:c}contains(C){return-1!==this.indexOf(C)}}b._GlobalId=0;class X extends b{constructor(){super(...arguments),this._duplicateId=0}push(C){super.push(C),C.__smartArrayFlags||(C.__smartArrayFlags={}),C.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(C){return(!C.__smartArrayFlags||C.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(C),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(C){if(0!==C.length){this.length+C.length>this.data.length&&(this.data.length=2*(this.length+C.length));for(let c=0;c<C.length;c++){const d=(C.data||C)[c];this.pushNoDuplicate(d)}}}}},12462:(C,c,d)=>{d.d(c,{e:()=>P});var b=d(12471),X=d(12221);class P{constructor(C){this._vertexBuffers={},this.onBeforeRenderObservable=new X.b,this._scene=C}_prepareBuffers(){if(this._vertexBuffers[b.g.PositionKind])return;const C=[];C.push(1,1),C.push(-1,1),C.push(-1,-1),C.push(1,-1),this._vertexBuffers[b.g.PositionKind]=new b.g(this._scene.getEngine(),C,b.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const C=[];C.push(0),C.push(1),C.push(2),C.push(0),C.push(2),C.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(C)}_rebuild(){const C=this._vertexBuffers[b.g.PositionKind];C&&(C._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let C=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=this._scene.activeCamera;return!!d&&(c=c||d._postProcesses.filter((C=>null!=C)),!(!c||0===c.length||!this._scene.postProcessesEnabled)&&(c[0].activate(d,C,null!==c&&void 0!==c),!0))}directRender(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:C.length;const R=this._scene.getEngine();for(let j=0;j<V;j++){var p;if(j<C.length-1)C[j+1].activate(this._scene.activeCamera||this._scene,null===c||void 0===c?void 0:c.texture);else c?R.bindFramebuffer(c,b,void 0,void 0,d,X):P||R.restoreDefaultFramebuffer(),null===(p=R._debugInsertMarker)||void 0===p||p.call(R,`post process ${C[j].name} output`);const V=C[j],g=V.apply();g&&(V.onBeforeRenderObservable.notifyObservers(g),this._prepareBuffers(),R.bindBuffers(this._vertexBuffers,this._indexBuffer,g),R.drawElementsType(0,0,6),V.onAfterRenderObservable.notifyObservers(g))}R.setDepthBuffer(!0),R.setDepthWrite(!0)}_finalizeFrame(C,c,d,b){let X=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const P=this._scene.activeCamera;if(!P)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(b=b||P._postProcesses.filter((C=>null!=C))).length||!this._scene.postProcessesEnabled)return;const V=this._scene.getEngine();for(let p=0,j=b.length;p<j;p++){const g=b[p];var R;if(p<j-1)g._outputTexture=b[p+1].activate(P,null===c||void 0===c?void 0:c.texture);else c?(V.bindFramebuffer(c,d,void 0,void 0,X),g._outputTexture=c):(V.restoreDefaultFramebuffer(),g._outputTexture=null),null===(R=V._debugInsertMarker)||void 0===R||R.call(V,`post process ${b[p].name} output`);if(C)break;const k=g.apply();k&&(g.onBeforeRenderObservable.notifyObservers(k),this._prepareBuffers(),V.bindBuffers(this._vertexBuffers,this._indexBuffer,k),V.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(k))}V.setDepthBuffer(!0),V.setDepthWrite(!0),V.setAlphaMode(0)}dispose(){const C=this._vertexBuffers[b.g.PositionKind];C&&(C.dispose(),this._vertexBuffers[b.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12489:(C,c,d)=>{d.d(c,{c:()=>R});var b=d(12496),X=d(12403);class P{set opaqueSortCompareFn(C){this._opaqueSortCompareFn=C||P.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(C){this._alphaTestSortCompareFn=C||P.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(C){this._transparentSortCompareFn=C||P.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(C,c){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,X=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,P=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=C,this._opaqueSubMeshes=new b.f(256),this._transparentSubMeshes=new b.f(256),this._alphaTestSubMeshes=new b.f(256),this._depthOnlySubMeshes=new b.f(256),this._particleSystems=new b.f(256),this._spriteManagers=new b.f(256),this._empty=!0,this._edgesRenderers=new b.e(16),this._scene=c,this.opaqueSortCompareFn=d,this.alphaTestSortCompareFn=X,this.transparentSortCompareFn=P}render(C,c,d,b){if(C)return void C(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const X=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(X.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),X.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const P=X.getStencilBuffer();if(X.setStencilBuffer(!1),c&&this._renderSprites(),d&&this._renderParticles(b),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(X.setStencilBuffer(P),this._scene.useOrderIndependentTransparency){const C=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);C.length&&this._renderTransparent(C)}else this._renderTransparent(this._transparentSubMeshes);X.setAlphaMode(0)}if(X.setStencilBuffer(!1),this._edgesRenderers.length){for(let C=0;C<this._edgesRenderers.length;C++)this._edgesRenderers.data[C].render();X.setAlphaMode(0)}X.setStencilBuffer(P)}_renderOpaqueSorted(C){P._RenderSorted(C,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(C){P._RenderSorted(C,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(C){P._RenderSorted(C,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(C,c,d,b){let V,R=0;const p=d?d.globalPosition:P._ZeroVector;if(b)for(;R<C.length;R++)V=C.data[R],V._alphaIndex=V.getMesh().alphaIndex,V._distanceToCamera=X.dd.Distance(V.getBoundingInfo().boundingSphere.centerWorld,p);const j=C.length===C.data.length?C.data:C.data.slice(0,C.length);c&&j.sort(c);const g=j[0].getMesh().NC();for(R=0;R<j.length;R++)if(V=j[R],!g._activeMeshesFrozenButKeepClipping||V.isInFrustum(g._frustumPlanes)){if(b){const C=V.yC();if(C&&C.needDepthPrePass){const c=C.NC().getEngine();c.setColorWrite(!1),c.setAlphaMode(0),V.render(!1),c.setColorWrite(!0)}}V.render(b)}}static defaultTransparentSortCompare(C,c){return C._alphaIndex>c._alphaIndex?1:C._alphaIndex<c._alphaIndex?-1:P.backToFrontSortCompare(C,c)}static backToFrontSortCompare(C,c){return C._distanceToCamera<c._distanceToCamera?1:C._distanceToCamera>c._distanceToCamera?-1:0}static frontToBackSortCompare(C,c){return C._distanceToCamera<c._distanceToCamera?-1:C._distanceToCamera>c._distanceToCamera?1:0}static PainterSortCompare(C,c){const d=C.getMesh(),b=c.getMesh();return d.material&&b.material?d.material.uniqueId-b.material.uniqueId:d.uniqueId-b.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(C,c,d){void 0===c&&(c=C.getMesh()),void 0===d&&(d=C.yC()),null!==d&&void 0!==d&&(d.needAlphaBlendingForMesh(c)?this._transparentSubMeshes.push(C):d.needAlphaTestingForMesh(c)?(d.needDepthPrePass&&this._depthOnlySubMeshes.push(C),this._alphaTestSubMeshes.push(C)):(d.needDepthPrePass&&this._depthOnlySubMeshes.push(C),this._opaqueSubMeshes.push(C)),c._renderingGroup=this,c._edgesRenderer&&c.isEnabled()&&c.isVisible&&c._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(c._edgesRenderer),this._empty=!1)}dispatchSprites(C){this._spriteManagers.push(C),this._empty=!1}dispatchParticles(C){this._particleSystems.push(C),this._empty=!1}_renderParticles(C){if(0===this._particleSystems.length)return;const c=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let d=0;d<this._particleSystems.length;d++){const b=this._particleSystems.data[d];if(0===(c&&c.layerMask&b.layerMask))continue;const X=b.bc;X.position&&C&&-1===C.indexOf(X)||this._scene._activeParticles.addCount(b.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const C=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let c=0;c<this._spriteManagers.length;c++){const d=this._spriteManagers.data[c];0!==(C&&C.layerMask&d.layerMask)&&d.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}P._ZeroVector=X.dd.Zero();class V{}class R{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(C){C!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=C,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const C of this._scene.meshes)if(C.Nc)for(const c of C.Nc)c._wasDispatched=!1;if(this._scene.spriteManagers)for(const C of this._scene.spriteManagers)C._wasDispatched=!1;for(const C of this._scene.LU)C._wasDispatched=!1}constructor(C){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new V,this._maintainStateBetweenFrames=!1,this._scene=C;for(let c=R.MIN_RENDERINGGROUPS;c<R.MAX_RENDERINGGROUPS;c++)this._autoClearDepthStencil[c]={Wc:!0,depth:!0,uc:!0}}getRenderingGroup(C){const c=C||0;return this._prepareRenderingGroup(c),this._renderingGroups[c]}_clearDepthStencilBuffer(){let C=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,C,c),this._depthStencilBufferAlreadyCleaned=!0)}render(C,c,d,b){const X=this._renderingGroupInfo;if(X.Pd=this._scene,X.camera=this._scene.activeCamera,X.renderingManager=this,this._scene.spriteManagers&&b)for(let P=0;P<this._scene.spriteManagers.length;P++){const C=this._scene.spriteManagers[P];this.dispatchSprites(C)}for(let P=R.MIN_RENDERINGGROUPS;P<R.MAX_RENDERINGGROUPS;P++){this._depthStencilBufferAlreadyCleaned=P===R.MIN_RENDERINGGROUPS;const V=this._renderingGroups[P];if(!V||V._empty)continue;const p=1<<P;if(X.renderingGroupId=P,this._scene.onBeforeRenderingGroupObservable.notifyObservers(X,p),R.AUTOCLEAR){const C=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(P):this._autoClearDepthStencil[P];C&&C.Wc&&this._clearDepthStencilBuffer(C.depth,C.uc)}for(const C of this._scene._beforeRenderingGroupDrawStage)C.action(P);V.render(C,b,d,c);for(const C of this._scene._afterRenderingGroupDrawStage)C.action(P);this._scene.onAfterRenderingGroupObservable.notifyObservers(X,p)}}reset(){if(!this.maintainStateBetweenFrames)for(let C=R.MIN_RENDERINGGROUPS;C<R.MAX_RENDERINGGROUPS;C++){const c=this._renderingGroups[C];c&&c.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let C=R.MIN_RENDERINGGROUPS;C<R.MAX_RENDERINGGROUPS;C++){const c=this._renderingGroups[C];c&&c.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let C=R.MIN_RENDERINGGROUPS;C<R.MAX_RENDERINGGROUPS;C++){const c=this._renderingGroups[C];c&&c.dispose()}}_prepareRenderingGroup(C){void 0===this._renderingGroups[C]&&(this._renderingGroups[C]=new P(C,this._scene,this._customOpaqueSortCompareFn[C],this._customAlphaTestSortCompareFn[C],this._customTransparentSortCompareFn[C]))}dispatchSprites(C){this.maintainStateBetweenFrames&&C._wasDispatched||(C._wasDispatched=!0,this.getRenderingGroup(C.renderingGroupId).dispatchSprites(C))}dispatchParticles(C){this.maintainStateBetweenFrames&&C._wasDispatched||(C._wasDispatched=!0,this.getRenderingGroup(C.renderingGroupId).dispatchParticles(C))}dispatch(C,c,d){void 0===c&&(c=C.getMesh()),this.maintainStateBetweenFrames&&C._wasDispatched||(C._wasDispatched=!0,this.getRenderingGroup(c.renderingGroupId).dispatch(C,c,d))}setRenderingOrder(C){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[C]=c,this._customAlphaTestSortCompareFn[C]=d,this._customTransparentSortCompareFn[C]=b,this._renderingGroups[C]){const c=this._renderingGroups[C];c.opaqueSortCompareFn=this._customOpaqueSortCompareFn[C],c.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[C],c.transparentSortCompareFn=this._customTransparentSortCompareFn[C]}}setRenderingAutoClearDepthStencil(C,c){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],b=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[C]={Wc:c,depth:d,uc:b}}getAutoClearDepthStencilSetup(C){return this._autoClearDepthStencil[C]}}R.MAX_RENDERINGGROUPS=4,R.MIN_RENDERINGGROUPS=0,R.AUTOCLEAR=!0}}]);