"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[19],{11270:(B,I,C)=>{C.d(I,{d:()=>f,g:()=>L});var M=C(11275),x=C(11027),y=C(11284);class f{get R(){return this._isDisposed}constructor(B,I,C){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7?arguments[7]:void 0,g=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,B&&B.rB?this._engine=B.rB().getEngine():this._engine=B,this._updatable=C,this._instanced=f,this._divisor=e||1,this._label=g,I instanceof M.c?(this._data=null,this._buffer=I):(this._data=I,this._buffer=null),this.byteStride=L?x:x*Float32Array.BYTES_PER_ELEMENT,y||this.create()}createVertexBuffer(B,I,C,M,x){let y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6?arguments[6]:void 0;const e=y?I:I*Float32Array.BYTES_PER_ELEMENT,g=M?y?M:M*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new L(this._engine,this,B,this._updatable,!0,g,void 0===x?this._instanced:x,e,C,void 0,void 0,!0,this._divisor||f)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!B&&this._buffer||(B=B||this._data,B&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,B),this._data=B):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(B,this._label),this._data=B):this._buffer=this._engine.createVertexBuffer(B,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.nI>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.nI,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.nI,void 0,this._label));x.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(B){this.create(B)}updateDirectly(B,I,C){let M=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,B,M?I:I*Float32Array.BYTES_PER_ELEMENT,C?C*this.byteStride:void 0),this._data=0===I&&void 0===C?B:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class L{get R(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(B){const I=0!=B;this._instanceDivisor=B,I!==this._instanced&&(this._instanced=I,this._computeHashCode())}get _maxVerticesCount(){const B=this.getData();return B?Array.isArray(B)?B.length/(this.byteStride/4)-this.byteOffset/4:(B.byteLength-this.byteOffset)/this.byteStride:0}constructor(B,I,C,M,x,e,g,N,R,H){let F=arguments.length>10&&void 0!==arguments[10]&&arguments[10],k=arguments.length>11&&void 0!==arguments[11]&&arguments[11],q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,S=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let o=!1;if(this.RI=B,"object"===typeof M&&null!==M?(o=M.updatable??!1,x=M.postponeInternalCreation,e=M.stride,g=M.instanced,N=M.offset,R=M.size,H=M.type,F=M.normalized??!1,k=M.useBytes??!1,q=M.divisor??1,S=M.takeBufferOwnership??!1,this._label=M.label):o=!!M,I instanceof f?(this._buffer=I,this._ownsBuffer=S):(this._buffer=new f(B,I,o,e,x,g,k,q,this._label),this._ownsBuffer=!0),this.uniqueId=L._Counter++,this._kind=C,void 0===H){const B=this.getData();this.type=B?L.GetDataType(B):L.FLOAT}else this.type=H;const U=(0,y.j)(this.type);k?(this._size=R||(e?e/U:L.DeduceStride(C)),this.byteStride=e||this._buffer.byteStride||this._size*U,this.byteOffset=N||0):(this._size=R||e||L.DeduceStride(C),this.byteStride=e?e*U:this._buffer.byteStride||this._size*U,this.byteOffset=(N||0)*U),this.normalized=F,this._instanced=void 0!==g&&g,this._instanceDivisor=g?q:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var B;null===(B=this._buffer)||void 0===B||B._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(B,I){const C=this.getData();return C?(0,y.i)(C,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,B,I):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,y.j)(this.type)}getOffset(){return this.byteOffset/(0,y.j)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,y.j)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(B){this._buffer.create(B),this._alignBuffer()}update(B){this._buffer.update(B),this._alignBuffer()}updateDirectly(B,I){let C=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(B,I,void 0,C),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(B,I){(0,y.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,B,this.normalized,((B,C)=>{for(let M=0;M<this._size;M++)I(B[M],C+M)}))}_alignBuffer(){}static DeduceStride(B){switch(B){case L.UVKind:case L.UV2Kind:case L.UV3Kind:case L.UV4Kind:case L.UV5Kind:case L.UV6Kind:return 2;case L.NormalKind:case L.PositionKind:return 3;case L.ColorKind:case L.ColorInstanceKind:case L.MatricesIndicesKind:case L.MatricesIndicesExtraKind:case L.MatricesWeightsKind:case L.MatricesWeightsExtraKind:case L.TangentKind:return 4;default:throw new Error("Invalid kind '"+B+"'")}}static GetDataType(B){return B instanceof Int8Array?L.BYTE:B instanceof Uint8Array?L.UNSIGNED_BYTE:B instanceof Int16Array?L.SHORT:B instanceof Uint16Array?L.UNSIGNED_SHORT:B instanceof Int32Array?L.INT:B instanceof Uint32Array?L.UNSIGNED_INT:L.FLOAT}static GetTypeByteLength(B){return(0,y.j)(B)}static ForEach(B,I,C,M,x,f,L,e){(0,y.g)(B,I,C,M,x,f,L,((B,I)=>{for(let C=0;C<M;C++)e(B[C],I+C)}))}static GetFloatData(B,I,C,M,x,f,L,e){return(0,y.i)(B,I,C,M,x,f,L,e)}}L._Counter=0,L.BYTE=5120,L.UNSIGNED_BYTE=5121,L.SHORT=5122,L.UNSIGNED_SHORT=5123,L.INT=5124,L.UNSIGNED_INT=5125,L.FLOAT=5126,L.PositionKind="position",L.NormalKind="normal",L.TangentKind="tangent",L.UVKind="uv",L.UV2Kind="uv2",L.UV3Kind="uv3",L.UV4Kind="uv4",L.UV5Kind="uv5",L.UV6Kind="uv6",L.ColorKind="color",L.ColorInstanceKind="instanceColor",L.MatricesIndicesKind="matricesIndices",L.MatricesWeightsKind="matricesWeights",L.MatricesIndicesExtraKind="matricesIndicesExtra",L.MatricesWeightsExtraKind="matricesWeightsExtra"},11284:(B,I,C)=>{C.d(I,{c:()=>H,d:()=>R,g:()=>e,i:()=>g,j:()=>f,n:()=>L,o:()=>N});var M=C(11027);function x(B,I,C,M){switch(I){case 5120:{let I=B.getInt8(C);return M&&(I=Math.max(I/127,-1)),I}case 5121:{let I=B.getUint8(C);return M&&(I/=255),I}case 5122:{let I=B.getInt16(C,!0);return M&&(I=Math.max(I/32767,-1)),I}case 5123:{let I=B.getUint16(C,!0);return M&&(I/=65535),I}case 5124:return B.getInt32(C,!0);case 5125:return B.getUint32(C,!0);case 5126:return B.getFloat32(C,!0);default:throw new Error(`Invalid component type ${I}`)}}function y(B,I,C,M,x){switch(I){case 5120:M&&(x=Math.round(127*x)),B.setInt8(C,x);break;case 5121:M&&(x=Math.round(255*x)),B.setUint8(C,x);break;case 5122:M&&(x=Math.round(32767*x)),B.setInt16(C,x,!0);break;case 5123:M&&(x=Math.round(65535*x)),B.setUint16(C,x,!0);break;case 5124:B.setInt32(C,x,!0);break;case 5125:B.setUint32(C,x,!0);break;case 5126:B.setFloat32(C,x,!0);break;default:throw new Error(`Invalid component type ${I}`)}}function f(B){switch(B){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${B}'`)}}function L(B){switch(B){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${B}'`)}}function e(B,I,C,M,L,e,g,N){const R=new Array(M),H=new Array(M);if(B instanceof Array){let x=I/4;const y=C/4;for(let I=0;I<e;I+=M){for(let I=0;I<M;I++)R[I]=H[I]=B[x+I];N(H,I);for(let I=0;I<M;I++)R[I]!==H[I]&&(B[x+I]=H[I]);x+=y}}else{const F=ArrayBuffer.isView(B)?new DataView(B.buffer,B.byteOffset,B.byteLength):new DataView(B),k=f(L);for(let B=0;B<e;B+=M){for(let B=0,C=I;B<M;B++,C+=k)R[B]=H[B]=x(F,L,C,g);N(H,B);for(let B=0,C=I;B<M;B++,C+=k)R[B]!==H[B]&&y(F,L,C,g,H[B]);I+=C}}}function g(B,I,C,x,y,L,g,N){const R=I*f(C),H=g*I;if(5126!==C||y!==R){const M=new Float32Array(H);return e(B,x,y,I,C,H,L,((B,C)=>{for(let x=0;x<I;x++)M[C+x]=B[x]})),M}if(!(B instanceof Array||B instanceof Float32Array)||0!==x||B.length!==H){if(B instanceof Array){const I=x/4;return B.slice(I,I+H)}if(B instanceof ArrayBuffer)return new Float32Array(B,x,H);{const I=B.byteOffset+x;return 0!==(3&I)&&(M.b.Warn("Float array must be aligned to 4-bytes border"),N=!0),N?new Float32Array(B.buffer.slice(I,I+H*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(B.buffer,I,H)}}return N?B.slice():B}function N(B,I,C,x,y,g,N,R){const H=f(C),F=L(C),k=N*I;if(Array.isArray(B)){if(0!==(3&x)||0!==(3&y))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const M=x/4,f=y/4;if(M+(N-1)*f+I>B.length)throw new Error("Last accessed index is out of bounds.");if(f<I)throw new Error("Data stride cannot be smaller than the component size.");if(f!==I){const M=new F(k);return e(B,x,y,I,C,k,g,((B,C)=>{for(let x=0;x<I;x++)M[C+x]=B[x]})),M}return new F(B.slice(M,M+k))}let q,S=x;B instanceof ArrayBuffer?q=B:(q=B.buffer,S+=B.byteOffset);if(S+(N-1)*y+I*H>q.byteLength)throw new Error("Last accessed byte is out of bounds.");const o=I*H;if(y<o)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(y!==o){const B=new F(k);return e(q,S,y,I,C,k,g,((C,M)=>{for(let x=0;x<I;x++)B[M+x]=C[x]})),B}return 1!==H&&0!==(S&H-1)&&(M.b.Warn("Array must be aligned to border of element size. Data will be copied."),R=!0),R?new F(q.slice(S,S+k*H)):new F(q,S,k)}function R(B,I,C,x,y,L,g,N){const R=I*f(C),H=g*I;if(N.length!==H)throw new Error("Output length is not valid");if(5126===C&&y===R)if(B instanceof Array){const I=x/4;N.set(B,I)}else if(B instanceof ArrayBuffer){const I=new Float32Array(B,x,H);N.set(I)}else{const I=B.byteOffset+x;if(0!==(3&I))return M.b.Warn("Float array must be aligned to 4-bytes border"),void N.set(new Float32Array(B.buffer.slice(I,I+H*Float32Array.BYTES_PER_ELEMENT)));const C=new Float32Array(B.buffer,I,H);N.set(C)}else e(B,x,y,I,C,H,L,((B,C)=>{for(let M=0;M<I;M++)N[C+M]=B[M]}))}function H(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(B)){for(let x=0;x<I;x++)if(B[C+x]-M>65535)return!0;return!1}return 4===B.BYTES_PER_ELEMENT}},11275:(B,I,C)=>{C.d(I,{c:()=>M});class M{get underlyingResource(){return null}constructor(){this.references=0,this.nI=0,this.is32Bits=!1,this.uniqueId=M._Counter++}}M._Counter=0},11313:(B,I,C)=>{C.d(I,{b:()=>x});var M=C(11091);class x{static GetEffect(B){return void 0===B.getPipelineContext?B.effect:B}constructor(B){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=B.createDrawContext(),I&&(this.materialContext=B.createMaterialContext())}setEffect(B,I){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var M;(this.effect=B,void 0!==I&&(this.defines=I),C)&&(null===(M=this.drawContext)||void 0===M||M.reset())}dispose(){var B;let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const B=this.effect;I?B.dispose():M.e.SetImmediate((()=>{B.getEngine().onEndFrameObservable.addOnce((()=>{B.dispose()}))})),this.effect=null}null===(B=this.drawContext)||void 0===B||B.dispose()}}},11402:(B,I,C)=>{C.d(I,{c:()=>x});var M=C(11242);class x{static GetPlanes(B){const I=[];for(let C=0;C<6;C++)I.push(new M.d(0,0,0,0));return x.GetPlanesToRef(B,I),I}static GetNearPlaneToRef(B,I){const C=B.m;I.normal.x=C[3]+C[2],I.normal.y=C[7]+C[6],I.normal.z=C[11]+C[10],I.d=C[15]+C[14],I.normalize()}static GetFarPlaneToRef(B,I){const C=B.m;I.normal.x=C[3]-C[2],I.normal.y=C[7]-C[6],I.normal.z=C[11]-C[10],I.d=C[15]-C[14],I.normalize()}static GetLeftPlaneToRef(B,I){const C=B.m;I.normal.x=C[3]+C[0],I.normal.y=C[7]+C[4],I.normal.z=C[11]+C[8],I.d=C[15]+C[12],I.normalize()}static GetRightPlaneToRef(B,I){const C=B.m;I.normal.x=C[3]-C[0],I.normal.y=C[7]-C[4],I.normal.z=C[11]-C[8],I.d=C[15]-C[12],I.normalize()}static GetTopPlaneToRef(B,I){const C=B.m;I.normal.x=C[3]-C[1],I.normal.y=C[7]-C[5],I.normal.z=C[11]-C[9],I.d=C[15]-C[13],I.normalize()}static GetBottomPlaneToRef(B,I){const C=B.m;I.normal.x=C[3]+C[1],I.normal.y=C[7]+C[5],I.normal.z=C[11]+C[9],I.d=C[15]+C[13],I.normalize()}static GetPlanesToRef(B,I){x.GetNearPlaneToRef(B,I[0]),x.GetFarPlaneToRef(B,I[1]),x.GetLeftPlaneToRef(B,I[2]),x.GetRightPlaneToRef(B,I[3]),x.GetTopPlaneToRef(B,I[4]),x.GetBottomPlaneToRef(B,I[5])}static IsPointInFrustum(B,I){for(let C=0;C<6;C++)if(I[C].dotCoordinate(B)<0)return!1;return!0}}},11417:(B,I,C)=>{C.d(I,{b:()=>x});var M=C(11034);class x{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(B,I){x.Enabled&&(this._current+=B,I&&this._fetchResult())}beginMonitoring(){x.Enabled&&(this._startMonitoringTime=M.c.Now)}endMonitoring(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!x.Enabled)return;B&&this.fetchNewFrame();const I=M.c.Now;this._current=I-this._startMonitoringTime,B&&this._fetchResult()}ny(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const B=M.c.Now;B-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=B,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}x.Enabled=!0},11291:(B,I,C)=>{C.d(I,{b:()=>x,f:()=>M});class M{constructor(B){this.length=0,this.data=new Array(B),this._id=M._GlobalId++}push(B){this.data[this.length++]=B,this.length>this.data.length&&(this.data.length*=2)}forEach(B){for(let I=0;I<this.length;I++)B(this.data[I])}sort(B){this.data.sort(B)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(B){if(0!==B.length){this.length+B.length>this.data.length&&(this.data.length=2*(this.length+B.length));for(let I=0;I<B.length;I++)this.data[this.length++]=(B.data||B)[I]}}indexOf(B){const I=this.data.indexOf(B);return I>=this.length?-1:I}contains(B){return-1!==this.indexOf(B)}}M._GlobalId=0;class x extends M{constructor(){super(...arguments),this._duplicateId=0}push(B){super.push(B),B.__smartArrayFlags||(B.__smartArrayFlags={}),B.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(B){return(!B.__smartArrayFlags||B.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(B),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(B){if(0!==B.length){this.length+B.length>this.data.length&&(this.data.length=2*(this.length+B.length));for(let I=0;I<B.length;I++){const C=(B.data||B)[I];this.pushNoDuplicate(C)}}}}},11261:(B,I,C)=>{C.d(I,{e:()=>y});var M=C(11270),x=C(11022);class y{constructor(B){this._vertexBuffers={},this.onBeforeRenderObservable=new x.e,this._scene=B}_prepareBuffers(){if(this._vertexBuffers[M.g.PositionKind])return;const B=[];B.push(1,1),B.push(-1,1),B.push(-1,-1),B.push(1,-1),this._vertexBuffers[M.g.PositionKind]=new M.g(this._scene.getEngine(),B,M.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const B=[];B.push(0),B.push(1),B.push(2),B.push(0),B.push(2),B.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(B)}_rebuild(){const B=this._vertexBuffers[M.g.PositionKind];B&&(B._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const C=this._scene.activeCamera;return!!C&&(I=I||C._postProcesses.filter((B=>null!=B)),!(!I||0===I.length||!this._scene.postProcessesEnabled)&&(I[0].activate(C,B,null!==I&&void 0!==I),!0))}directRender(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]&&arguments[2],M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,x=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.length;const L=this._scene.getEngine();for(let g=0;g<f;g++){var e;if(g<B.length-1)B[g+1].activate(this._scene.activeCamera||this._scene,null===I||void 0===I?void 0:I.texture);else I?L.bindFramebuffer(I,M,void 0,void 0,C,x):y||L.restoreDefaultFramebuffer(),null===(e=L._debugInsertMarker)||void 0===e||e.call(L,`post process ${B[g].name} output`);const f=B[g],N=f.apply();N&&(f.onBeforeRenderObservable.notifyObservers(N),this._prepareBuffers(),L.bindBuffers(this._vertexBuffers,this._indexBuffer,N),L.drawElementsType(0,0,6),f.onAfterRenderObservable.notifyObservers(N))}L.setDepthBuffer(!0),L.setDepthWrite(!0)}_finalizeFrame(B,I,C,M){let x=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const y=this._scene.activeCamera;if(!y)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(M=M||y._postProcesses.filter((B=>null!=B))).length||!this._scene.postProcessesEnabled)return;const f=this._scene.getEngine();for(let e=0,g=M.length;e<g;e++){const N=M[e];var L;if(e<g-1)N._outputTexture=M[e+1].activate(y,null===I||void 0===I?void 0:I.texture);else I?(f.bindFramebuffer(I,C,void 0,void 0,x),N._outputTexture=I):(f.restoreDefaultFramebuffer(),N._outputTexture=null),null===(L=f._debugInsertMarker)||void 0===L||L.call(f,`post process ${M[e].name} output`);if(B)break;const R=N.apply();R&&(N.onBeforeRenderObservable.notifyObservers(R),this._prepareBuffers(),f.bindBuffers(this._vertexBuffers,this._indexBuffer,R),f.drawElementsType(0,0,6),N.onAfterRenderObservable.notifyObservers(R))}f.setDepthBuffer(!0),f.setDepthWrite(!0),f.setAlphaMode(0)}dispose(){const B=this._vertexBuffers[M.g.PositionKind];B&&(B.dispose(),this._vertexBuffers[M.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11289:(B,I,C)=>{C.d(I,{d:()=>L});var M=C(11291),x=C(11194);class y{set opaqueSortCompareFn(B){this._opaqueSortCompareFn=B||y.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(B){this._alphaTestSortCompareFn=B||y.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(B){this._transparentSortCompareFn=B||y.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(B,I){let C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=B,this._opaqueSubMeshes=new M.f(256),this._transparentSubMeshes=new M.f(256),this._alphaTestSubMeshes=new M.f(256),this._depthOnlySubMeshes=new M.f(256),this._particleSystems=new M.f(256),this._spriteManagers=new M.f(256),this._empty=!0,this._edgesRenderers=new M.b(16),this._scene=I,this.opaqueSortCompareFn=C,this.alphaTestSortCompareFn=x,this.transparentSortCompareFn=y}render(B,I,C,M){if(B)return void B(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const x=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(x.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),x.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const y=x.getStencilBuffer();if(x.setStencilBuffer(!1),I&&this._renderSprites(),C&&this._renderParticles(M),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(x.setStencilBuffer(y),this._scene.useOrderIndependentTransparency){const B=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);B.length&&this._renderTransparent(B)}else this._renderTransparent(this._transparentSubMeshes);x.setAlphaMode(0)}if(x.setStencilBuffer(!1),this._edgesRenderers.length){for(let B=0;B<this._edgesRenderers.length;B++)this._edgesRenderers.data[B].render();x.setAlphaMode(0)}x.setStencilBuffer(y)}_renderOpaqueSorted(B){y._RenderSorted(B,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(B){y._RenderSorted(B,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(B){y._RenderSorted(B,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(B,I,C,M){let f,L=0;const e=C?C.globalPosition:y._ZeroVector;if(M)for(;L<B.length;L++)f=B.data[L],f._alphaIndex=f.getMesh().alphaIndex,f._distanceToCamera=x.HI.Distance(f.getBoundingInfo().boundingSphere.centerWorld,e);const g=B.length===B.data.length?B.data:B.data.slice(0,B.length);I&&g.sort(I);const N=g[0].getMesh().rB();for(L=0;L<g.length;L++)if(f=g[L],!N._activeMeshesFrozenButKeepClipping||f.isInFrustum(N._frustumPlanes)){if(M){const B=f.lB();if(B&&B.needDepthPrePass){const I=B.rB().getEngine();I.setColorWrite(!1),I.setAlphaMode(0),f.render(!1),I.setColorWrite(!0)}}f.render(M)}}static defaultTransparentSortCompare(B,I){return B._alphaIndex>I._alphaIndex?1:B._alphaIndex<I._alphaIndex?-1:y.backToFrontSortCompare(B,I)}static backToFrontSortCompare(B,I){return B._distanceToCamera<I._distanceToCamera?1:B._distanceToCamera>I._distanceToCamera?-1:0}static frontToBackSortCompare(B,I){return B._distanceToCamera<I._distanceToCamera?-1:B._distanceToCamera>I._distanceToCamera?1:0}static PainterSortCompare(B,I){const C=B.getMesh(),M=I.getMesh();return C.material&&M.material?C.material.uniqueId-M.material.uniqueId:C.uniqueId-M.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(B,I,C){void 0===I&&(I=B.getMesh()),void 0===C&&(C=B.lB()),null!==C&&void 0!==C&&(C.needAlphaBlendingForMesh(I)?this._transparentSubMeshes.push(B):C.needAlphaTestingForMesh(I)?(C.needDepthPrePass&&this._depthOnlySubMeshes.push(B),this._alphaTestSubMeshes.push(B)):(C.needDepthPrePass&&this._depthOnlySubMeshes.push(B),this._opaqueSubMeshes.push(B)),I._renderingGroup=this,I._edgesRenderer&&I.isEnabled()&&I.isVisible&&I._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(I._edgesRenderer),this._empty=!1)}dispatchSprites(B){this._spriteManagers.push(B),this._empty=!1}dispatchParticles(B){this._particleSystems.push(B),this._empty=!1}_renderParticles(B){if(0===this._particleSystems.length)return;const I=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let C=0;C<this._particleSystems.length;C++){const M=this._particleSystems.data[C];if(0===(I&&I.layerMask&M.layerMask))continue;const x=M.j;x.position&&B&&-1===B.indexOf(x)||this._scene._activeParticles.addCount(M.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const B=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let I=0;I<this._spriteManagers.length;I++){const C=this._spriteManagers.data[I];0!==(B&&B.layerMask&C.layerMask)&&C.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}y._ZeroVector=x.HI.Zero();class f{}class L{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(B){B!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=B,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const B of this._scene.meshes)if(B.cf)for(const I of B.cf)I._wasDispatched=!1;if(this._scene.spriteManagers)for(const B of this._scene.spriteManagers)B._wasDispatched=!1;for(const B of this._scene.oH)B._wasDispatched=!1}constructor(B){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new f,this._maintainStateBetweenFrames=!1,this._scene=B;for(let I=L.MIN_RENDERINGGROUPS;I<L.MAX_RENDERINGGROUPS;I++)this._autoClearDepthStencil[I]={Gf:!0,depth:!0,stencil:!0}}getRenderingGroup(B){const I=B||0;return this._prepareRenderingGroup(I),this._renderingGroups[I]}_clearDepthStencilBuffer(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,B,I),this._depthStencilBufferAlreadyCleaned=!0)}render(B,I,C,M){const x=this._renderingGroupInfo;if(x.kI=this._scene,x.camera=this._scene.activeCamera,x.renderingManager=this,this._scene.spriteManagers&&M)for(let y=0;y<this._scene.spriteManagers.length;y++){const B=this._scene.spriteManagers[y];this.dispatchSprites(B)}for(let y=L.MIN_RENDERINGGROUPS;y<L.MAX_RENDERINGGROUPS;y++){this._depthStencilBufferAlreadyCleaned=y===L.MIN_RENDERINGGROUPS;const f=this._renderingGroups[y];if(!f||f._empty)continue;const e=1<<y;if(x.renderingGroupId=y,this._scene.onBeforeRenderingGroupObservable.notifyObservers(x,e),L.AUTOCLEAR){const B=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(y):this._autoClearDepthStencil[y];B&&B.Gf&&this._clearDepthStencilBuffer(B.depth,B.stencil)}for(const B of this._scene._beforeRenderingGroupDrawStage)B.action(y);f.render(B,M,C,I);for(const B of this._scene._afterRenderingGroupDrawStage)B.action(y);this._scene.onAfterRenderingGroupObservable.notifyObservers(x,e)}}reset(){if(!this.maintainStateBetweenFrames)for(let B=L.MIN_RENDERINGGROUPS;B<L.MAX_RENDERINGGROUPS;B++){const I=this._renderingGroups[B];I&&I.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let B=L.MIN_RENDERINGGROUPS;B<L.MAX_RENDERINGGROUPS;B++){const I=this._renderingGroups[B];I&&I.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let B=L.MIN_RENDERINGGROUPS;B<L.MAX_RENDERINGGROUPS;B++){const I=this._renderingGroups[B];I&&I.dispose()}}_prepareRenderingGroup(B){void 0===this._renderingGroups[B]&&(this._renderingGroups[B]=new y(B,this._scene,this._customOpaqueSortCompareFn[B],this._customAlphaTestSortCompareFn[B],this._customTransparentSortCompareFn[B]))}dispatchSprites(B){this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(B.renderingGroupId).dispatchSprites(B))}dispatchParticles(B){this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(B.renderingGroupId).dispatchParticles(B))}dispatch(B,I,C){void 0===I&&(I=B.getMesh()),this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatch(B,I,C))}setRenderingOrder(B){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,C=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[B]=I,this._customAlphaTestSortCompareFn[B]=C,this._customTransparentSortCompareFn[B]=M,this._renderingGroups[B]){const I=this._renderingGroups[B];I.opaqueSortCompareFn=this._customOpaqueSortCompareFn[B],I.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[B],I.transparentSortCompareFn=this._customTransparentSortCompareFn[B]}}setRenderingAutoClearDepthStencil(B,I){let C=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],M=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[B]={Gf:I,depth:C,stencil:M}}getAutoClearDepthStencilSetup(B){return this._autoClearDepthStencil[B]}}L.MAX_RENDERINGGROUPS=4,L.MIN_RENDERINGGROUPS=0,L.AUTOCLEAR=!0}}]);