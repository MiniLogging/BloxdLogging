"use strict";(self.uji65st81d=self.uji65st81d||[]).push([[19],{12481:(V,h,mV)=>{mV.d(h,{e:()=>A,i:()=>k});var t=mV(12487),L=mV(12264),N=mV(12495);class A{get A(){return this._isDisposed}constructor(V,h,mV){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],A=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,V&&V.DV?this._engine=V.DV().getEngine():this._engine=V,this._updatable=mV,this._instanced=A,this._divisor=C||1,this._label=K,h instanceof t.d?(this._data=null,this._buffer=h):(this._data=h,this._buffer=null),this.byteStride=k?L:L*Float32Array.BYTES_PER_ELEMENT,N||this.create()}createVertexBuffer(V,h,mV,t,L){let N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6?arguments[6]:void 0;const C=N?h:h*Float32Array.BYTES_PER_ELEMENT,K=t?N?t:t*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new k(this._engine,this,V,this._updatable,!0,K,void 0===L?this._instanced:L,C,mV,void 0,void 0,!0,this._divisor||A)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!V&&this._buffer||(V=V||this._data,V&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,V),this._data=V):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(V,this._label),this._data=V):this._buffer=this._engine.createVertexBuffer(V,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.jm>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.jm,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.jm,void 0,this._label));L.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(V){this.create(V)}updateDirectly(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,V,t?h:h*Float32Array.BYTES_PER_ELEMENT,mV?mV*this.byteStride:void 0),this._data=0===h&&void 0===mV?V:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class k{get A(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(V){const h=0!=V;this._instanceDivisor=V,h!==this._instanced&&(this._instanced=h,this._computeHashCode())}get _maxVerticesCount(){const V=this.getData();return V?Array.isArray(V)?V.length/(this.byteStride/4)-this.byteOffset/4:(V.byteLength-this.byteOffset)/this.byteStride:0}constructor(V,h,mV,t,L,C,K,o,n,q){let x=arguments.length>10&&void 0!==arguments[10]&&arguments[10],R=arguments.length>11&&void 0!==arguments[11]&&arguments[11],d=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,s=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let M=!1;if(this.dh=V,"object"===typeof t&&null!==t?(M=t.updatable??!1,L=t.postponeInternalCreation,C=t.stride,K=t.instanced,o=t.offset,n=t.size,q=t.type,x=t.normalized??!1,R=t.useBytes??!1,d=t.divisor??1,s=t.takeBufferOwnership??!1,this._label=t.label):M=!!t,h instanceof A?(this._buffer=h,this._ownsBuffer=s):(this._buffer=new A(V,h,M,C,L,K,R,d,this._label),this._ownsBuffer=!0),this.uniqueId=k._Counter++,this._kind=mV,void 0===q){const V=this.getData();this.type=V?k.GetDataType(V):k.FLOAT}else this.type=q;const c=(0,N.h)(this.type);R?(this._size=n||(C?C/c:k.DeduceStride(mV)),this.byteStride=C||this._buffer.byteStride||this._size*c,this.byteOffset=o||0):(this._size=n||C||k.DeduceStride(mV),this.byteStride=C?C*c:this._buffer.byteStride||this._size*c,this.byteOffset=(o||0)*c),this.normalized=x,this._instanced=void 0!==K&&K,this._instanceDivisor=K?d:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var V;null===(V=this._buffer)||void 0===V||V._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(V,h){const mV=this.getData();return mV?(0,N.f)(mV,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,V,h):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,N.h)(this.type)}getOffset(){return this.byteOffset/(0,N.h)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,N.h)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(V){this._buffer.create(V),this._alignBuffer()}update(V){this._buffer.update(V),this._alignBuffer()}updateDirectly(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(V,h,void 0,mV),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(V,h){(0,N.e)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,V,this.normalized,((V,mV)=>{for(let t=0;t<this._size;t++)h(V[t],mV+t)}))}_alignBuffer(){}static DeduceStride(V){switch(V){case k.UVKind:case k.UV2Kind:case k.UV3Kind:case k.UV4Kind:case k.UV5Kind:case k.UV6Kind:return 2;case k.NormalKind:case k.PositionKind:return 3;case k.ColorKind:case k.ColorInstanceKind:case k.MatricesIndicesKind:case k.MatricesIndicesExtraKind:case k.MatricesWeightsKind:case k.MatricesWeightsExtraKind:case k.TangentKind:return 4;default:throw new Error("Invalid kind '"+V+"'")}}static GetDataType(V){return V instanceof Int8Array?k.BYTE:V instanceof Uint8Array?k.UNSIGNED_BYTE:V instanceof Int16Array?k.SHORT:V instanceof Uint16Array?k.UNSIGNED_SHORT:V instanceof Int32Array?k.INT:V instanceof Uint32Array?k.UNSIGNED_INT:k.FLOAT}static GetTypeByteLength(V){return(0,N.h)(V)}static ForEach(V,h,mV,t,L,A,k,C){(0,N.e)(V,h,mV,t,L,A,k,((V,h)=>{for(let mV=0;mV<t;mV++)C(V[mV],h+mV)}))}static GetFloatData(V,h,mV,t,L,A,k,C){return(0,N.f)(V,h,mV,t,L,A,k,C)}}k._Counter=0,k.BYTE=5120,k.UNSIGNED_BYTE=5121,k.SHORT=5122,k.UNSIGNED_SHORT=5123,k.INT=5124,k.UNSIGNED_INT=5125,k.FLOAT=5126,k.PositionKind="position",k.NormalKind="normal",k.TangentKind="tangent",k.UVKind="uv",k.UV2Kind="uv2",k.UV3Kind="uv3",k.UV4Kind="uv4",k.UV5Kind="uv5",k.UV6Kind="uv6",k.ColorKind="color",k.ColorInstanceKind="instanceColor",k.MatricesIndicesKind="matricesIndices",k.MatricesWeightsKind="matricesWeights",k.MatricesIndicesExtraKind="matricesIndicesExtra",k.MatricesWeightsExtraKind="matricesWeightsExtra"},12495:(V,h,mV)=>{mV.d(h,{b:()=>q,d:()=>n,e:()=>C,f:()=>K,h:()=>A,l:()=>k,n:()=>o});var t=mV(12264);function L(V,h,mV,t){switch(h){case 5120:{let h=V.getInt8(mV);return t&&(h=Math.max(h/127,-1)),h}case 5121:{let h=V.getUint8(mV);return t&&(h/=255),h}case 5122:{let h=V.getInt16(mV,!0);return t&&(h=Math.max(h/32767,-1)),h}case 5123:{let h=V.getUint16(mV,!0);return t&&(h/=65535),h}case 5124:return V.getInt32(mV,!0);case 5125:return V.getUint32(mV,!0);case 5126:return V.getFloat32(mV,!0);default:throw new Error(`Invalid component type ${h}`)}}function N(V,h,mV,t,L){switch(h){case 5120:t&&(L=Math.round(127*L)),V.setInt8(mV,L);break;case 5121:t&&(L=Math.round(255*L)),V.setUint8(mV,L);break;case 5122:t&&(L=Math.round(32767*L)),V.setInt16(mV,L,!0);break;case 5123:t&&(L=Math.round(65535*L)),V.setUint16(mV,L,!0);break;case 5124:V.setInt32(mV,L,!0);break;case 5125:V.setUint32(mV,L,!0);break;case 5126:V.setFloat32(mV,L,!0);break;default:throw new Error(`Invalid component type ${h}`)}}function A(V){switch(V){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${V}'`)}}function k(V){switch(V){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${V}'`)}}function C(V,h,mV,t,k,C,K,o){const n=new Array(t),q=new Array(t);if(V instanceof Array){let L=h/4;const N=mV/4;for(let h=0;h<C;h+=t){for(let h=0;h<t;h++)n[h]=q[h]=V[L+h];o(q,h);for(let h=0;h<t;h++)n[h]!==q[h]&&(V[L+h]=q[h]);L+=N}}else{const x=ArrayBuffer.isView(V)?new DataView(V.buffer,V.byteOffset,V.byteLength):new DataView(V),R=A(k);for(let V=0;V<C;V+=t){for(let V=0,mV=h;V<t;V++,mV+=R)n[V]=q[V]=L(x,k,mV,K);o(q,V);for(let V=0,mV=h;V<t;V++,mV+=R)n[V]!==q[V]&&N(x,k,mV,K,q[V]);h+=mV}}}function K(V,h,mV,L,N,k,K,o){const n=h*A(mV),q=K*h;if(5126!==mV||N!==n){const t=new Float32Array(q);return C(V,L,N,h,mV,q,k,((V,mV)=>{for(let L=0;L<h;L++)t[mV+L]=V[L]})),t}if(!(V instanceof Array||V instanceof Float32Array)||0!==L||V.length!==q){if(V instanceof Array){const h=L/4;return V.slice(h,h+q)}if(V instanceof ArrayBuffer)return new Float32Array(V,L,q);{const h=V.byteOffset+L;return 0!==(3&h)&&(t.e.Warn("Float array must be aligned to 4-bytes border"),o=!0),o?new Float32Array(V.buffer.slice(h,h+q*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(V.buffer,h,q)}}return o?V.slice():V}function o(V,h,mV,L,N,K,o,n){const q=A(mV),x=k(mV),R=o*h;if(Array.isArray(V)){if(0!==(3&L)||0!==(3&N))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const t=L/4,A=N/4;if(t+(o-1)*A+h>V.length)throw new Error("Last accessed index is out of bounds.");if(A<h)throw new Error("Data stride cannot be smaller than the component size.");if(A!==h){const t=new x(R);return C(V,L,N,h,mV,R,K,((V,mV)=>{for(let L=0;L<h;L++)t[mV+L]=V[L]})),t}return new x(V.slice(t,t+R))}let d,s=L;V instanceof ArrayBuffer?d=V:(d=V.buffer,s+=V.byteOffset);if(s+(o-1)*N+h*q>d.byteLength)throw new Error("Last accessed byte is out of bounds.");const M=h*q;if(N<M)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(N!==M){const V=new x(R);return C(d,s,N,h,mV,R,K,((mV,t)=>{for(let L=0;L<h;L++)V[t+L]=mV[L]})),V}return 1!==q&&0!==(s&q-1)&&(t.e.Warn("Array must be aligned to border of element size. Data will be copied."),n=!0),n?new x(d.slice(s,s+R*q)):new x(d,s,R)}function n(V,h,mV,L,N,k,K,o){const n=h*A(mV),q=K*h;if(o.length!==q)throw new Error("Output length is not valid");if(5126===mV&&N===n)if(V instanceof Array){const h=L/4;o.set(V,h)}else if(V instanceof ArrayBuffer){const h=new Float32Array(V,L,q);o.set(h)}else{const h=V.byteOffset+L;if(0!==(3&h))return t.e.Warn("Float array must be aligned to 4-bytes border"),void o.set(new Float32Array(V.buffer.slice(h,h+q*Float32Array.BYTES_PER_ELEMENT)));const mV=new Float32Array(V.buffer,h,q);o.set(mV)}else C(V,L,N,h,mV,q,k,((V,mV)=>{for(let t=0;t<h;t++)o[mV+t]=V[t]}))}function q(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(V)){for(let L=0;L<h;L++)if(V[mV+L]-t>65535)return!0;return!1}return 4===V.BYTES_PER_ELEMENT}},12487:(V,h,mV)=>{mV.d(h,{d:()=>t});class t{get underlyingResource(){return null}constructor(){this.references=0,this.jm=0,this.is32Bits=!1,this.uniqueId=t._Counter++}}t._Counter=0},12532:(V,h,mV)=>{mV.d(h,{e:()=>L});var t=mV(12322);class L{static GetEffect(V){return void 0===V.getPipelineContext?V.effect:V}constructor(V){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=V.createDrawContext(),h&&(this.materialContext=V.createMaterialContext())}setEffect(V,h){let mV=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var t;(this.effect=V,void 0!==h&&(this.defines=h),mV)&&(null===(t=this.drawContext)||void 0===t||t.reset())}dispose(){var V;let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const V=this.effect;h?V.dispose():t.b.SetImmediate((()=>{V.getEngine().onEndFrameObservable.addOnce((()=>{V.dispose()}))})),this.effect=null}null===(V=this.drawContext)||void 0===V||V.dispose()}}},12612:(V,h,mV)=>{mV.d(h,{e:()=>L});var t=mV(12458);class L{static GetPlanes(V){const h=[];for(let mV=0;mV<6;mV++)h.push(new t.b(0,0,0,0));return L.GetPlanesToRef(V,h),h}static GetNearPlaneToRef(V,h){const mV=V.m;h.normal.x=mV[3]+mV[2],h.normal.y=mV[7]+mV[6],h.normal.z=mV[11]+mV[10],h.d=mV[15]+mV[14],h.normalize()}static GetFarPlaneToRef(V,h){const mV=V.m;h.normal.x=mV[3]-mV[2],h.normal.y=mV[7]-mV[6],h.normal.z=mV[11]-mV[10],h.d=mV[15]-mV[14],h.normalize()}static GetLeftPlaneToRef(V,h){const mV=V.m;h.normal.x=mV[3]+mV[0],h.normal.y=mV[7]+mV[4],h.normal.z=mV[11]+mV[8],h.d=mV[15]+mV[12],h.normalize()}static GetRightPlaneToRef(V,h){const mV=V.m;h.normal.x=mV[3]-mV[0],h.normal.y=mV[7]-mV[4],h.normal.z=mV[11]-mV[8],h.d=mV[15]-mV[12],h.normalize()}static GetTopPlaneToRef(V,h){const mV=V.m;h.normal.x=mV[3]-mV[1],h.normal.y=mV[7]-mV[5],h.normal.z=mV[11]-mV[9],h.d=mV[15]-mV[13],h.normalize()}static GetBottomPlaneToRef(V,h){const mV=V.m;h.normal.x=mV[3]+mV[1],h.normal.y=mV[7]+mV[5],h.normal.z=mV[11]+mV[9],h.d=mV[15]+mV[13],h.normalize()}static GetPlanesToRef(V,h){L.GetNearPlaneToRef(V,h[0]),L.GetFarPlaneToRef(V,h[1]),L.GetLeftPlaneToRef(V,h[2]),L.GetRightPlaneToRef(V,h[3]),L.GetTopPlaneToRef(V,h[4]),L.GetBottomPlaneToRef(V,h[5])}static IsPointInFrustum(V,h){for(let mV=0;mV<6;mV++)if(h[mV].dotCoordinate(V)<0)return!1;return!0}}},12623:(V,h,mV)=>{mV.d(h,{c:()=>L});var t=mV(12280);class L{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(V,h){L.Enabled&&(this._current+=V,h&&this._fetchResult())}beginMonitoring(){L.Enabled&&(this._startMonitoringTime=t.e.Now)}endMonitoring(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!L.Enabled)return;V&&this.fetchNewFrame();const h=t.e.Now;this._current=h-this._startMonitoringTime,V&&this._fetchResult()}gt(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const V=t.e.Now;V-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=V,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}L.Enabled=!0},12507:(V,h,mV)=>{mV.d(h,{c:()=>L,g:()=>t});class t{constructor(V){this.length=0,this.data=new Array(V),this._id=t._GlobalId++}push(V){this.data[this.length++]=V,this.length>this.data.length&&(this.data.length*=2)}forEach(V){for(let h=0;h<this.length;h++)V(this.data[h])}sort(V){this.data.sort(V)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(V){if(0!==V.length){this.length+V.length>this.data.length&&(this.data.length=2*(this.length+V.length));for(let h=0;h<V.length;h++)this.data[this.length++]=(V.data||V)[h]}}indexOf(V){const h=this.data.indexOf(V);return h>=this.length?-1:h}contains(V){return-1!==this.indexOf(V)}}t._GlobalId=0;class L extends t{constructor(){super(...arguments),this._duplicateId=0}push(V){super.push(V),V.__smartArrayFlags||(V.__smartArrayFlags={}),V.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(V){return(!V.__smartArrayFlags||V.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(V),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(V){if(0!==V.length){this.length+V.length>this.data.length&&(this.data.length=2*(this.length+V.length));for(let h=0;h<V.length;h++){const mV=(V.data||V)[h];this.pushNoDuplicate(mV)}}}}},12476:(V,h,mV)=>{mV.d(h,{b:()=>N});var t=mV(12481),L=mV(12258);class N{constructor(V){this._vertexBuffers={},this.onBeforeRenderObservable=new L.d,this._scene=V}_prepareBuffers(){if(this._vertexBuffers[t.i.PositionKind])return;const V=[];V.push(1,1),V.push(-1,1),V.push(-1,-1),V.push(1,-1),this._vertexBuffers[t.i.PositionKind]=new t.i(this._scene.getEngine(),V,t.i.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const V=[];V.push(0),V.push(1),V.push(2),V.push(0),V.push(2),V.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(V)}_rebuild(){const V=this._vertexBuffers[t.i.PositionKind];V&&(V._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const mV=this._scene.activeCamera;return!!mV&&(h=h||mV._postProcesses.filter((V=>null!=V)),!(!h||0===h.length||!this._scene.postProcessesEnabled)&&(h[0].activate(mV,V,null!==h&&void 0!==h),!0))}directRender(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,N=arguments.length>5&&void 0!==arguments[5]&&arguments[5],A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:V.length;const k=this._scene.getEngine();for(let K=0;K<A;K++){var C;if(K<V.length-1)V[K+1].activate(this._scene.activeCamera||this._scene,null===h||void 0===h?void 0:h.texture);else h?k.bindFramebuffer(h,t,void 0,void 0,mV,L):N||k.restoreDefaultFramebuffer(),null===(C=k._debugInsertMarker)||void 0===C||C.call(k,`post process ${V[K].name} output`);const A=V[K],o=A.apply();o&&(A.onBeforeRenderObservable.notifyObservers(o),this._prepareBuffers(),k.bindBuffers(this._vertexBuffers,this._indexBuffer,o),k.drawElementsType(0,0,6),A.onAfterRenderObservable.notifyObservers(o))}k.setDepthBuffer(!0),k.setDepthWrite(!0)}_finalizeFrame(V,h,mV,t){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const N=this._scene.activeCamera;if(!N)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(t=t||N._postProcesses.filter((V=>null!=V))).length||!this._scene.postProcessesEnabled)return;const A=this._scene.getEngine();for(let C=0,K=t.length;C<K;C++){const o=t[C];var k;if(C<K-1)o._outputTexture=t[C+1].activate(N,null===h||void 0===h?void 0:h.texture);else h?(A.bindFramebuffer(h,mV,void 0,void 0,L),o._outputTexture=h):(A.restoreDefaultFramebuffer(),o._outputTexture=null),null===(k=A._debugInsertMarker)||void 0===k||k.call(A,`post process ${t[C].name} output`);if(V)break;const n=o.apply();n&&(o.onBeforeRenderObservable.notifyObservers(n),this._prepareBuffers(),A.bindBuffers(this._vertexBuffers,this._indexBuffer,n),A.drawElementsType(0,0,6),o.onAfterRenderObservable.notifyObservers(n))}A.setDepthBuffer(!0),A.setDepthWrite(!0),A.setAlphaMode(0)}dispose(){const V=this._vertexBuffers[t.i.PositionKind];V&&(V.dispose(),this._vertexBuffers[t.i.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12499:(V,h,mV)=>{mV.d(h,{d:()=>k});var t=mV(12507),L=mV(12422);class N{set opaqueSortCompareFn(V){this._opaqueSortCompareFn=V||N.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(V){this._alphaTestSortCompareFn=V||N.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(V){this._transparentSortCompareFn=V||N.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=V,this._opaqueSubMeshes=new t.g(256),this._transparentSubMeshes=new t.g(256),this._alphaTestSubMeshes=new t.g(256),this._depthOnlySubMeshes=new t.g(256),this._particleSystems=new t.g(256),this._spriteManagers=new t.g(256),this._empty=!0,this._edgesRenderers=new t.c(16),this._scene=h,this.opaqueSortCompareFn=mV,this.alphaTestSortCompareFn=L,this.transparentSortCompareFn=N}render(V,h,mV,t){if(V)return void V(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const L=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(L.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),L.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const N=L.getStencilBuffer();if(L.setStencilBuffer(!1),h&&this._renderSprites(),mV&&this._renderParticles(t),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(L.setStencilBuffer(N),this._scene.useOrderIndependentTransparency){const V=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);V.length&&this._renderTransparent(V)}else this._renderTransparent(this._transparentSubMeshes);L.setAlphaMode(0)}if(L.setStencilBuffer(!1),this._edgesRenderers.length){for(let V=0;V<this._edgesRenderers.length;V++)this._edgesRenderers.data[V].render();L.setAlphaMode(0)}L.setStencilBuffer(N)}_renderOpaqueSorted(V){N._RenderSorted(V,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(V){N._RenderSorted(V,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(V){N._RenderSorted(V,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(V,h,mV,t){let A,k=0;const C=mV?mV.globalPosition:N._ZeroVector;if(t)for(;k<V.length;k++)A=V.data[k],A._alphaIndex=A.getMesh().alphaIndex,A._distanceToCamera=L.sh.Distance(A.getBoundingInfo().boundingSphere.centerWorld,C);const K=V.length===V.data.length?V.data:V.data.slice(0,V.length);h&&K.sort(h);const o=K[0].getMesh().DV();for(k=0;k<K.length;k++)if(A=K[k],!o._activeMeshesFrozenButKeepClipping||A.isInFrustum(o._frustumPlanes)){if(t){const V=A.ZV();if(V&&V.needDepthPrePass){const h=V.DV().getEngine();h.setColorWrite(!1),h.setAlphaMode(0),A.render(!1),h.setColorWrite(!0)}}A.render(t)}}static defaultTransparentSortCompare(V,h){return V._alphaIndex>h._alphaIndex?1:V._alphaIndex<h._alphaIndex?-1:N.backToFrontSortCompare(V,h)}static backToFrontSortCompare(V,h){return V._distanceToCamera<h._distanceToCamera?1:V._distanceToCamera>h._distanceToCamera?-1:0}static frontToBackSortCompare(V,h){return V._distanceToCamera<h._distanceToCamera?-1:V._distanceToCamera>h._distanceToCamera?1:0}static PainterSortCompare(V,h){const mV=V.getMesh(),t=h.getMesh();return mV.material&&t.material?mV.material.uniqueId-t.material.uniqueId:mV.uniqueId-t.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(V,h,mV){void 0===h&&(h=V.getMesh()),void 0===mV&&(mV=V.ZV()),null!==mV&&void 0!==mV&&(mV.needAlphaBlendingForMesh(h)?this._transparentSubMeshes.push(V):mV.needAlphaTestingForMesh(h)?(mV.needDepthPrePass&&this._depthOnlySubMeshes.push(V),this._alphaTestSubMeshes.push(V)):(mV.needDepthPrePass&&this._depthOnlySubMeshes.push(V),this._opaqueSubMeshes.push(V)),h._renderingGroup=this,h._edgesRenderer&&h.isEnabled()&&h.isVisible&&h._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(h._edgesRenderer),this._empty=!1)}dispatchSprites(V){this._spriteManagers.push(V),this._empty=!1}dispatchParticles(V){this._particleSystems.push(V),this._empty=!1}_renderParticles(V){if(0===this._particleSystems.length)return;const h=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let mV=0;mV<this._particleSystems.length;mV++){const t=this._particleSystems.data[mV];if(0===(h&&h.layerMask&t.layerMask))continue;const L=t.Lh;L.position&&V&&-1===V.indexOf(L)||this._scene._activeParticles.addCount(t.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const V=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let h=0;h<this._spriteManagers.length;h++){const mV=this._spriteManagers.data[h];0!==(V&&V.layerMask&mV.layerMask)&&mV.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}N._ZeroVector=L.sh.Zero();class A{}class k{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(V){V!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=V,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const V of this._scene.meshes)if(V.dk)for(const h of V.dk)h._wasDispatched=!1;if(this._scene.spriteManagers)for(const V of this._scene.spriteManagers)V._wasDispatched=!1;for(const V of this._scene.Lq)V._wasDispatched=!1}constructor(V){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new A,this._maintainStateBetweenFrames=!1,this._scene=V;for(let h=k.MIN_RENDERINGGROUPS;h<k.MAX_RENDERINGGROUPS;h++)this._autoClearDepthStencil[h]={Rk:!0,depth:!0,Ck:!0}}getRenderingGroup(V){const h=V||0;return this._prepareRenderingGroup(h),this._renderingGroups[h]}_clearDepthStencilBuffer(){let V=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,V,h),this._depthStencilBufferAlreadyCleaned=!0)}render(V,h,mV,t){const L=this._renderingGroupInfo;if(L.zh=this._scene,L.camera=this._scene.activeCamera,L.renderingManager=this,this._scene.spriteManagers&&t)for(let N=0;N<this._scene.spriteManagers.length;N++){const V=this._scene.spriteManagers[N];this.dispatchSprites(V)}for(let N=k.MIN_RENDERINGGROUPS;N<k.MAX_RENDERINGGROUPS;N++){this._depthStencilBufferAlreadyCleaned=N===k.MIN_RENDERINGGROUPS;const A=this._renderingGroups[N];if(!A||A._empty)continue;const C=1<<N;if(L.renderingGroupId=N,this._scene.onBeforeRenderingGroupObservable.notifyObservers(L,C),k.AUTOCLEAR){const V=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(N):this._autoClearDepthStencil[N];V&&V.Rk&&this._clearDepthStencilBuffer(V.depth,V.Ck)}for(const V of this._scene._beforeRenderingGroupDrawStage)V.action(N);A.render(V,t,mV,h);for(const V of this._scene._afterRenderingGroupDrawStage)V.action(N);this._scene.onAfterRenderingGroupObservable.notifyObservers(L,C)}}reset(){if(!this.maintainStateBetweenFrames)for(let V=k.MIN_RENDERINGGROUPS;V<k.MAX_RENDERINGGROUPS;V++){const h=this._renderingGroups[V];h&&h.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let V=k.MIN_RENDERINGGROUPS;V<k.MAX_RENDERINGGROUPS;V++){const h=this._renderingGroups[V];h&&h.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let V=k.MIN_RENDERINGGROUPS;V<k.MAX_RENDERINGGROUPS;V++){const h=this._renderingGroups[V];h&&h.dispose()}}_prepareRenderingGroup(V){void 0===this._renderingGroups[V]&&(this._renderingGroups[V]=new N(V,this._scene,this._customOpaqueSortCompareFn[V],this._customAlphaTestSortCompareFn[V],this._customTransparentSortCompareFn[V]))}dispatchSprites(V){this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatchSprites(V))}dispatchParticles(V){this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatchParticles(V))}dispatch(V,h,mV){void 0===h&&(h=V.getMesh()),this.maintainStateBetweenFrames&&V._wasDispatched||(V._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatch(V,h,mV))}setRenderingOrder(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[V]=h,this._customAlphaTestSortCompareFn[V]=mV,this._customTransparentSortCompareFn[V]=t,this._renderingGroups[V]){const h=this._renderingGroups[V];h.opaqueSortCompareFn=this._customOpaqueSortCompareFn[V],h.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[V],h.transparentSortCompareFn=this._customTransparentSortCompareFn[V]}}setRenderingAutoClearDepthStencil(V,h){let mV=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],t=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[V]={Rk:h,depth:mV,Ck:t}}getAutoClearDepthStencilSetup(V){return this._autoClearDepthStencil[V]}}k.MAX_RENDERINGGROUPS=4,k.MIN_RENDERINGGROUPS=0,k.AUTOCLEAR=!0}}]);