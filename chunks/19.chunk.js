"use strict";(self.lfntwv94xlc=self.lfntwv94xlc||[]).push([[19],{11410:(m,S,h)=>{h.d(S,{b:()=>u,f:()=>b});var l=h(11414),M=h(11173),O=h(11419);class u{get u(){return this._isDisposed}constructor(m,S,h){let M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]&&arguments[6],q=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,m&&m.sm?this._engine=m.sm().getEngine():this._engine=m,this._updatable=h,this._instanced=u,this._divisor=q||1,this._label=Y,S instanceof l.e?(this._data=null,this._buffer=S):(this._data=S,this._buffer=null),this.byteStride=b?M:M*Float32Array.BYTES_PER_ELEMENT,O||this.create()}createVertexBuffer(m,S,h,l,M){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6?arguments[6]:void 0;const q=O?S:S*Float32Array.BYTES_PER_ELEMENT,Y=l?O?l:l*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new b(this._engine,this,m,this._updatable,!0,Y,void 0===M?this._instanced:M,q,h,void 0,void 0,!0,this._divisor||u)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!m&&this._buffer||(m=m||this._data,m&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,m),this._data=m):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(m,this._label),this._data=m):this._buffer=this._engine.createVertexBuffer(m,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.KS>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.KS,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.KS,void 0,this._label));M.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(m){this.create(m)}updateDirectly(m,S,h){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,m,l?S:S*Float32Array.BYTES_PER_ELEMENT,h?h*this.byteStride:void 0),this._data=0===S&&void 0===h?m:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class b{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(m){const S=0!=m;this._instanceDivisor=m,S!==this._instanced&&(this._instanced=S,this._computeHashCode())}get _maxVerticesCount(){const m=this.getData();return m?Array.isArray(m)?m.length/(this.byteStride/4)-this.byteOffset/4:(m.byteLength-this.byteOffset)/this.byteStride:0}constructor(m,S,h,l,M,q,Y,V,I,Z){let C=arguments.length>10&&void 0!==arguments[10]&&arguments[10],B=arguments.length>11&&void 0!==arguments[11]&&arguments[11],D=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,E=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let n=!1;if(this.ES=m,"object"===typeof l&&null!==l?(n=l.updatable??!1,M=l.postponeInternalCreation,q=l.stride,Y=l.instanced,V=l.offset,I=l.size,Z=l.type,C=l.normalized??!1,B=l.useBytes??!1,D=l.divisor??1,E=l.takeBufferOwnership??!1,this._label=l.label):n=!!l,S instanceof u?(this._buffer=S,this._ownsBuffer=E):(this._buffer=new u(m,S,n,q,M,Y,B,D,this._label),this._ownsBuffer=!0),this.uniqueId=b._Counter++,this._kind=h,void 0===Z){const m=this.getData();this.type=m?b.GetDataType(m):b.FLOAT}else this.type=Z;const L=(0,O.n)(this.type);B?(this._size=I||(q?q/L:b.DeduceStride(h)),this.byteStride=q||this._buffer.byteStride||this._size*L,this.byteOffset=V||0):(this._size=I||q||b.DeduceStride(h),this.byteStride=q?q*L:this._buffer.byteStride||this._size*L,this.byteOffset=(V||0)*L),this.normalized=C,this._instanced=void 0!==Y&&Y,this._instanceDivisor=Y?D:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var m;null===(m=this._buffer)||void 0===m||m._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(m,S){const h=this.getData();return h?(0,O.k)(h,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,m,S):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,O.n)(this.type)}getOffset(){return this.byteOffset/(0,O.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,O.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(m){this._buffer.create(m),this._alignBuffer()}update(m){this._buffer.update(m),this._alignBuffer()}updateDirectly(m,S){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(m,S,void 0,h),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(m,S){(0,O.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,m,this.normalized,((m,h)=>{for(let l=0;l<this._size;l++)S(m[l],h+l)}))}_alignBuffer(){}static DeduceStride(m){switch(m){case b.UVKind:case b.UV2Kind:case b.UV3Kind:case b.UV4Kind:case b.UV5Kind:case b.UV6Kind:return 2;case b.NormalKind:case b.PositionKind:return 3;case b.ColorKind:case b.ColorInstanceKind:case b.MatricesIndicesKind:case b.MatricesIndicesExtraKind:case b.MatricesWeightsKind:case b.MatricesWeightsExtraKind:case b.TangentKind:return 4;default:throw new Error("Invalid kind '"+m+"'")}}static GetDataType(m){return m instanceof Int8Array?b.BYTE:m instanceof Uint8Array?b.UNSIGNED_BYTE:m instanceof Int16Array?b.SHORT:m instanceof Uint16Array?b.UNSIGNED_SHORT:m instanceof Int32Array?b.INT:m instanceof Uint32Array?b.UNSIGNED_INT:b.FLOAT}static GetTypeByteLength(m){return(0,O.n)(m)}static ForEach(m,S,h,l,M,u,b,q){(0,O.h)(m,S,h,l,M,u,b,((m,S)=>{for(let h=0;h<l;h++)q(m[h],S+h)}))}static GetFloatData(m,S,h,l,M,u,b,q){return(0,O.k)(m,S,h,l,M,u,b,q)}}b._Counter=0,b.BYTE=5120,b.UNSIGNED_BYTE=5121,b.SHORT=5122,b.UNSIGNED_SHORT=5123,b.INT=5124,b.UNSIGNED_INT=5125,b.FLOAT=5126,b.PositionKind="position",b.NormalKind="normal",b.TangentKind="tangent",b.UVKind="uv",b.UV2Kind="uv2",b.UV3Kind="uv3",b.UV4Kind="uv4",b.UV5Kind="uv5",b.UV6Kind="uv6",b.ColorKind="color",b.ColorInstanceKind="instanceColor",b.MatricesIndicesKind="matricesIndices",b.MatricesWeightsKind="matricesWeights",b.MatricesIndicesExtraKind="matricesIndicesExtra",b.MatricesWeightsExtraKind="matricesWeightsExtra"},11419:(m,S,h)=>{h.d(S,{b:()=>Z,f:()=>I,h:()=>q,k:()=>Y,n:()=>u,r:()=>b,u:()=>V});var l=h(11173);function M(m,S,h,l){switch(S){case 5120:{let S=m.getInt8(h);return l&&(S=Math.max(S/127,-1)),S}case 5121:{let S=m.getUint8(h);return l&&(S/=255),S}case 5122:{let S=m.getInt16(h,!0);return l&&(S=Math.max(S/32767,-1)),S}case 5123:{let S=m.getUint16(h,!0);return l&&(S/=65535),S}case 5124:return m.getInt32(h,!0);case 5125:return m.getUint32(h,!0);case 5126:return m.getFloat32(h,!0);default:throw new Error(`Invalid component type ${S}`)}}function O(m,S,h,l,M){switch(S){case 5120:l&&(M=Math.round(127*M)),m.setInt8(h,M);break;case 5121:l&&(M=Math.round(255*M)),m.setUint8(h,M);break;case 5122:l&&(M=Math.round(32767*M)),m.setInt16(h,M,!0);break;case 5123:l&&(M=Math.round(65535*M)),m.setUint16(h,M,!0);break;case 5124:m.setInt32(h,M,!0);break;case 5125:m.setUint32(h,M,!0);break;case 5126:m.setFloat32(h,M,!0);break;default:throw new Error(`Invalid component type ${S}`)}}function u(m){switch(m){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${m}'`)}}function b(m){switch(m){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${m}'`)}}function q(m,S,h,l,b,q,Y,V){const I=new Array(l),Z=new Array(l);if(m instanceof Array){let M=S/4;const O=h/4;for(let S=0;S<q;S+=l){for(let S=0;S<l;S++)I[S]=Z[S]=m[M+S];V(Z,S);for(let S=0;S<l;S++)I[S]!==Z[S]&&(m[M+S]=Z[S]);M+=O}}else{const C=ArrayBuffer.isView(m)?new DataView(m.buffer,m.byteOffset,m.byteLength):new DataView(m),B=u(b);for(let m=0;m<q;m+=l){for(let m=0,h=S;m<l;m++,h+=B)I[m]=Z[m]=M(C,b,h,Y);V(Z,m);for(let m=0,h=S;m<l;m++,h+=B)I[m]!==Z[m]&&O(C,b,h,Y,Z[m]);S+=h}}}function Y(m,S,h,M,O,b,Y,V){const I=S*u(h),Z=Y*S;if(5126!==h||O!==I){const l=new Float32Array(Z);return q(m,M,O,S,h,Z,b,((m,h)=>{for(let M=0;M<S;M++)l[h+M]=m[M]})),l}if(!(m instanceof Array||m instanceof Float32Array)||0!==M||m.length!==Z){if(m instanceof Array){const S=M/4;return m.slice(S,S+Z)}if(m instanceof ArrayBuffer)return new Float32Array(m,M,Z);{const S=m.byteOffset+M;return 0!==(3&S)&&(l.e.Warn("Float array must be aligned to 4-bytes border"),V=!0),V?new Float32Array(m.buffer.slice(S,S+Z*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(m.buffer,S,Z)}}return V?m.slice():m}function V(m,S,h,M,O,Y,V,I){const Z=u(h),C=b(h),B=V*S;if(Array.isArray(m)){if(0!==(3&M)||0!==(3&O))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const l=M/4,u=O/4;if(l+(V-1)*u+S>m.length)throw new Error("Last accessed index is out of bounds.");if(u<S)throw new Error("Data stride cannot be smaller than the component size.");if(u!==S){const l=new C(B);return q(m,M,O,S,h,B,Y,((m,h)=>{for(let M=0;M<S;M++)l[h+M]=m[M]})),l}return new C(m.slice(l,l+B))}let D,E=M;m instanceof ArrayBuffer?D=m:(D=m.buffer,E+=m.byteOffset);if(E+(V-1)*O+S*Z>D.byteLength)throw new Error("Last accessed byte is out of bounds.");const n=S*Z;if(O<n)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(O!==n){const m=new C(B);return q(D,E,O,S,h,B,Y,((h,l)=>{for(let M=0;M<S;M++)m[l+M]=h[M]})),m}return 1!==Z&&0!==(E&Z-1)&&(l.e.Warn("Array must be aligned to border of element size. Data will be copied."),I=!0),I?new C(D.slice(E,E+B*Z)):new C(D,E,B)}function I(m,S,h,M,O,b,Y,V){const I=S*u(h),Z=Y*S;if(V.length!==Z)throw new Error("Output length is not valid");if(5126===h&&O===I)if(m instanceof Array){const S=M/4;V.set(m,S)}else if(m instanceof ArrayBuffer){const S=new Float32Array(m,M,Z);V.set(S)}else{const S=m.byteOffset+M;if(0!==(3&S))return l.e.Warn("Float array must be aligned to 4-bytes border"),void V.set(new Float32Array(m.buffer.slice(S,S+Z*Float32Array.BYTES_PER_ELEMENT)));const h=new Float32Array(m.buffer,S,Z);V.set(h)}else q(m,M,O,S,h,Z,b,((m,h)=>{for(let l=0;l<S;l++)V[h+l]=m[l]}))}function Z(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(m)){for(let M=0;M<S;M++)if(m[h+M]-l>65535)return!0;return!1}return 4===m.BYTES_PER_ELEMENT}},11414:(m,S,h)=>{h.d(S,{e:()=>l});class l{get underlyingResource(){return null}constructor(){this.references=0,this.KS=0,this.is32Bits=!1,this.uniqueId=l._Counter++}}l._Counter=0},11450:(m,S,h)=>{h.d(S,{e:()=>M});var l=h(11226);class M{static GetEffect(m){return void 0===m.getPipelineContext?m.effect:m}constructor(m){let S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=m.createDrawContext(),S&&(this.materialContext=m.createMaterialContext())}setEffect(m,S){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var l;(this.effect=m,void 0!==S&&(this.defines=S),h)&&(null===(l=this.drawContext)||void 0===l||l.reset())}dispose(){var m;let S=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const m=this.effect;S?m.dispose():l.c.SetImmediate((()=>{m.getEngine().onEndFrameObservable.addOnce((()=>{m.dispose()}))})),this.effect=null}null===(m=this.drawContext)||void 0===m||m.dispose()}}},11534:(m,S,h)=>{h.d(S,{c:()=>M});var l=h(11392);class M{static GetPlanes(m){const S=[];for(let h=0;h<6;h++)S.push(new l.e(0,0,0,0));return M.GetPlanesToRef(m,S),S}static GetNearPlaneToRef(m,S){const h=m.m;S.normal.x=h[3]+h[2],S.normal.y=h[7]+h[6],S.normal.z=h[11]+h[10],S.d=h[15]+h[14],S.normalize()}static GetFarPlaneToRef(m,S){const h=m.m;S.normal.x=h[3]-h[2],S.normal.y=h[7]-h[6],S.normal.z=h[11]-h[10],S.d=h[15]-h[14],S.normalize()}static GetLeftPlaneToRef(m,S){const h=m.m;S.normal.x=h[3]+h[0],S.normal.y=h[7]+h[4],S.normal.z=h[11]+h[8],S.d=h[15]+h[12],S.normalize()}static GetRightPlaneToRef(m,S){const h=m.m;S.normal.x=h[3]-h[0],S.normal.y=h[7]-h[4],S.normal.z=h[11]-h[8],S.d=h[15]-h[12],S.normalize()}static GetTopPlaneToRef(m,S){const h=m.m;S.normal.x=h[3]-h[1],S.normal.y=h[7]-h[5],S.normal.z=h[11]-h[9],S.d=h[15]-h[13],S.normalize()}static GetBottomPlaneToRef(m,S){const h=m.m;S.normal.x=h[3]+h[1],S.normal.y=h[7]+h[5],S.normal.z=h[11]+h[9],S.d=h[15]+h[13],S.normalize()}static GetPlanesToRef(m,S){M.GetNearPlaneToRef(m,S[0]),M.GetFarPlaneToRef(m,S[1]),M.GetLeftPlaneToRef(m,S[2]),M.GetRightPlaneToRef(m,S[3]),M.GetTopPlaneToRef(m,S[4]),M.GetBottomPlaneToRef(m,S[5])}static IsPointInFrustum(m,S){for(let h=0;h<6;h++)if(S[h].dotCoordinate(m)<0)return!1;return!0}}},11547:(m,S,h)=>{h.d(S,{e:()=>M});var l=h(11183);class M{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(m,S){M.Enabled&&(this._current+=m,S&&this._fetchResult())}beginMonitoring(){M.Enabled&&(this._startMonitoringTime=l.b.Now)}endMonitoring(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!M.Enabled)return;m&&this.fetchNewFrame();const S=l.b.Now;this._current=S-this._startMonitoringTime,m&&this._fetchResult()}xh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const m=l.b.Now;m-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=m,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}M.Enabled=!0},11434:(m,S,h)=>{h.d(S,{e:()=>M,g:()=>l});class l{constructor(m){this.length=0,this.data=new Array(m),this._id=l._GlobalId++}push(m){this.data[this.length++]=m,this.length>this.data.length&&(this.data.length*=2)}forEach(m){for(let S=0;S<this.length;S++)m(this.data[S])}sort(m){this.data.sort(m)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(m){if(0!==m.length){this.length+m.length>this.data.length&&(this.data.length=2*(this.length+m.length));for(let S=0;S<m.length;S++)this.data[this.length++]=(m.data||m)[S]}}indexOf(m){const S=this.data.indexOf(m);return S>=this.length?-1:S}contains(m){return-1!==this.indexOf(m)}}l._GlobalId=0;class M extends l{constructor(){super(...arguments),this._duplicateId=0}push(m){super.push(m),m.__smartArrayFlags||(m.__smartArrayFlags={}),m.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(m){return(!m.__smartArrayFlags||m.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(m),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(m){if(0!==m.length){this.length+m.length>this.data.length&&(this.data.length=2*(this.length+m.length));for(let S=0;S<m.length;S++){const h=(m.data||m)[S];this.pushNoDuplicate(h)}}}}},11401:(m,S,h)=>{h.d(S,{b:()=>O});var l=h(11410),M=h(11161);class O{constructor(m){this._vertexBuffers={},this.onBeforeRenderObservable=new M.e,this._scene=m}_prepareBuffers(){if(this._vertexBuffers[l.f.PositionKind])return;const m=[];m.push(1,1),m.push(-1,1),m.push(-1,-1),m.push(1,-1),this._vertexBuffers[l.f.PositionKind]=new l.f(this._scene.getEngine(),m,l.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const m=[];m.push(0),m.push(1),m.push(2),m.push(0),m.push(2),m.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(m)}_rebuild(){const m=this._vertexBuffers[l.f.PositionKind];m&&(m._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let m=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=this._scene.activeCamera;return!!h&&(S=S||h._postProcesses.filter((m=>null!=m)),!(!S||0===S.length||!this._scene.postProcessesEnabled)&&(S[0].activate(h,m,null!==S&&void 0!==S),!0))}directRender(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,M=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:m.length;const b=this._scene.getEngine();for(let Y=0;Y<u;Y++){var q;if(Y<m.length-1)m[Y+1].activate(this._scene.activeCamera||this._scene,null===S||void 0===S?void 0:S.texture);else S?b.bindFramebuffer(S,l,void 0,void 0,h,M):O||b.restoreDefaultFramebuffer(),null===(q=b._debugInsertMarker)||void 0===q||q.call(b,`post process ${m[Y].name} output`);const u=m[Y],V=u.apply();V&&(u.onBeforeRenderObservable.notifyObservers(V),this._prepareBuffers(),b.bindBuffers(this._vertexBuffers,this._indexBuffer,V),b.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(V))}b.setDepthBuffer(!0),b.setDepthWrite(!0)}_finalizeFrame(m,S,h,l){let M=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const O=this._scene.activeCamera;if(!O)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(l=l||O._postProcesses.filter((m=>null!=m))).length||!this._scene.postProcessesEnabled)return;const u=this._scene.getEngine();for(let q=0,Y=l.length;q<Y;q++){const V=l[q];var b;if(q<Y-1)V._outputTexture=l[q+1].activate(O,null===S||void 0===S?void 0:S.texture);else S?(u.bindFramebuffer(S,h,void 0,void 0,M),V._outputTexture=S):(u.restoreDefaultFramebuffer(),V._outputTexture=null),null===(b=u._debugInsertMarker)||void 0===b||b.call(u,`post process ${l[q].name} output`);if(m)break;const I=V.apply();I&&(V.onBeforeRenderObservable.notifyObservers(I),this._prepareBuffers(),u.bindBuffers(this._vertexBuffers,this._indexBuffer,I),u.drawElementsType(0,0,6),V.onAfterRenderObservable.notifyObservers(I))}u.setDepthBuffer(!0),u.setDepthWrite(!0),u.setAlphaMode(0)}dispose(){const m=this._vertexBuffers[l.f.PositionKind];m&&(m.dispose(),this._vertexBuffers[l.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11426:(m,S,h)=>{h.d(S,{b:()=>b});var l=h(11434),M=h(11347);class O{set opaqueSortCompareFn(m){this._opaqueSortCompareFn=m||O.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(m){this._alphaTestSortCompareFn=m||O.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(m){this._transparentSortCompareFn=m||O.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(m,S){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,M=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=m,this._opaqueSubMeshes=new l.g(256),this._transparentSubMeshes=new l.g(256),this._alphaTestSubMeshes=new l.g(256),this._depthOnlySubMeshes=new l.g(256),this._particleSystems=new l.g(256),this._spriteManagers=new l.g(256),this._empty=!0,this._edgesRenderers=new l.e(16),this._scene=S,this.opaqueSortCompareFn=h,this.alphaTestSortCompareFn=M,this.transparentSortCompareFn=O}render(m,S,h,l){if(m)return void m(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const M=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(M.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),M.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const O=M.getStencilBuffer();if(M.setStencilBuffer(!1),S&&this._renderSprites(),h&&this._renderParticles(l),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(M.setStencilBuffer(O),this._scene.useOrderIndependentTransparency){const m=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);m.length&&this._renderTransparent(m)}else this._renderTransparent(this._transparentSubMeshes);M.setAlphaMode(0)}if(M.setStencilBuffer(!1),this._edgesRenderers.length){for(let m=0;m<this._edgesRenderers.length;m++)this._edgesRenderers.data[m].render();M.setAlphaMode(0)}M.setStencilBuffer(O)}_renderOpaqueSorted(m){O._RenderSorted(m,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(m){O._RenderSorted(m,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(m){O._RenderSorted(m,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(m,S,h,l){let u,b=0;const q=h?h.globalPosition:O._ZeroVector;if(l)for(;b<m.length;b++)u=m.data[b],u._alphaIndex=u.getMesh().alphaIndex,u._distanceToCamera=M.nS.Distance(u.getBoundingInfo().boundingSphere.centerWorld,q);const Y=m.length===m.data.length?m.data:m.data.slice(0,m.length);S&&Y.sort(S);const V=Y[0].getMesh().sm();for(b=0;b<Y.length;b++)if(u=Y[b],!V._activeMeshesFrozenButKeepClipping||u.isInFrustum(V._frustumPlanes)){if(l){const m=u.jm();if(m&&m.needDepthPrePass){const S=m.sm().getEngine();S.setColorWrite(!1),S.setAlphaMode(0),u.render(!1),S.setColorWrite(!0)}}u.render(l)}}static defaultTransparentSortCompare(m,S){return m._alphaIndex>S._alphaIndex?1:m._alphaIndex<S._alphaIndex?-1:O.backToFrontSortCompare(m,S)}static backToFrontSortCompare(m,S){return m._distanceToCamera<S._distanceToCamera?1:m._distanceToCamera>S._distanceToCamera?-1:0}static frontToBackSortCompare(m,S){return m._distanceToCamera<S._distanceToCamera?-1:m._distanceToCamera>S._distanceToCamera?1:0}static PainterSortCompare(m,S){const h=m.getMesh(),l=S.getMesh();return h.material&&l.material?h.material.uniqueId-l.material.uniqueId:h.uniqueId-l.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(m,S,h){void 0===S&&(S=m.getMesh()),void 0===h&&(h=m.jm()),null!==h&&void 0!==h&&(h.needAlphaBlendingForMesh(S)?this._transparentSubMeshes.push(m):h.needAlphaTestingForMesh(S)?(h.needDepthPrePass&&this._depthOnlySubMeshes.push(m),this._alphaTestSubMeshes.push(m)):(h.needDepthPrePass&&this._depthOnlySubMeshes.push(m),this._opaqueSubMeshes.push(m)),S._renderingGroup=this,S._edgesRenderer&&S.isEnabled()&&S.isVisible&&S._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(S._edgesRenderer),this._empty=!1)}dispatchSprites(m){this._spriteManagers.push(m),this._empty=!1}dispatchParticles(m){this._particleSystems.push(m),this._empty=!1}_renderParticles(m){if(0===this._particleSystems.length)return;const S=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let h=0;h<this._particleSystems.length;h++){const l=this._particleSystems.data[h];if(0===(S&&S.layerMask&l.layerMask))continue;const M=l.uS;M.position&&m&&-1===m.indexOf(M)||this._scene._activeParticles.addCount(l.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const m=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let S=0;S<this._spriteManagers.length;S++){const h=this._spriteManagers.data[S];0!==(m&&m.layerMask&h.layerMask)&&h.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}O._ZeroVector=M.nS.Zero();class u{}class b{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(m){m!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=m,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const m of this._scene.meshes)if(m.CM)for(const S of m.CM)S._wasDispatched=!1;if(this._scene.spriteManagers)for(const m of this._scene.spriteManagers)m._wasDispatched=!1;for(const m of this._scene.UZ)m._wasDispatched=!1}constructor(m){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new u,this._maintainStateBetweenFrames=!1,this._scene=m;for(let S=b.MIN_RENDERINGGROUPS;S<b.MAX_RENDERINGGROUPS;S++)this._autoClearDepthStencil[S]={Ah:!0,depth:!0,stencil:!0}}getRenderingGroup(m){const S=m||0;return this._prepareRenderingGroup(S),this._renderingGroups[S]}_clearDepthStencilBuffer(){let m=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],S=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,m,S),this._depthStencilBufferAlreadyCleaned=!0)}render(m,S,h,l){const M=this._renderingGroupInfo;if(M.US=this._scene,M.camera=this._scene.activeCamera,M.renderingManager=this,this._scene.spriteManagers&&l)for(let O=0;O<this._scene.spriteManagers.length;O++){const m=this._scene.spriteManagers[O];this.dispatchSprites(m)}for(let O=b.MIN_RENDERINGGROUPS;O<b.MAX_RENDERINGGROUPS;O++){this._depthStencilBufferAlreadyCleaned=O===b.MIN_RENDERINGGROUPS;const u=this._renderingGroups[O];if(!u||u._empty)continue;const q=1<<O;if(M.renderingGroupId=O,this._scene.onBeforeRenderingGroupObservable.notifyObservers(M,q),b.AUTOCLEAR){const m=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(O):this._autoClearDepthStencil[O];m&&m.Ah&&this._clearDepthStencilBuffer(m.depth,m.stencil)}for(const m of this._scene._beforeRenderingGroupDrawStage)m.action(O);u.render(m,l,h,S);for(const m of this._scene._afterRenderingGroupDrawStage)m.action(O);this._scene.onAfterRenderingGroupObservable.notifyObservers(M,q)}}reset(){if(!this.maintainStateBetweenFrames)for(let m=b.MIN_RENDERINGGROUPS;m<b.MAX_RENDERINGGROUPS;m++){const S=this._renderingGroups[m];S&&S.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let m=b.MIN_RENDERINGGROUPS;m<b.MAX_RENDERINGGROUPS;m++){const S=this._renderingGroups[m];S&&S.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let m=b.MIN_RENDERINGGROUPS;m<b.MAX_RENDERINGGROUPS;m++){const S=this._renderingGroups[m];S&&S.dispose()}}_prepareRenderingGroup(m){void 0===this._renderingGroups[m]&&(this._renderingGroups[m]=new O(m,this._scene,this._customOpaqueSortCompareFn[m],this._customAlphaTestSortCompareFn[m],this._customTransparentSortCompareFn[m]))}dispatchSprites(m){this.maintainStateBetweenFrames&&m._wasDispatched||(m._wasDispatched=!0,this.getRenderingGroup(m.renderingGroupId).dispatchSprites(m))}dispatchParticles(m){this.maintainStateBetweenFrames&&m._wasDispatched||(m._wasDispatched=!0,this.getRenderingGroup(m.renderingGroupId).dispatchParticles(m))}dispatch(m,S,h){void 0===S&&(S=m.getMesh()),this.maintainStateBetweenFrames&&m._wasDispatched||(m._wasDispatched=!0,this.getRenderingGroup(S.renderingGroupId).dispatch(m,S,h))}setRenderingOrder(m){let S=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[m]=S,this._customAlphaTestSortCompareFn[m]=h,this._customTransparentSortCompareFn[m]=l,this._renderingGroups[m]){const S=this._renderingGroups[m];S.opaqueSortCompareFn=this._customOpaqueSortCompareFn[m],S.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[m],S.transparentSortCompareFn=this._customTransparentSortCompareFn[m]}}setRenderingAutoClearDepthStencil(m,S){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],l=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[m]={Ah:S,depth:h,stencil:l}}getAutoClearDepthStencilSetup(m){return this._autoClearDepthStencil[m]}}b.MAX_RENDERINGGROUPS=4,b.MIN_RENDERINGGROUPS=0,b.AUTOCLEAR=!0}}]);