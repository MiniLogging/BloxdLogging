"use strict";(self.irtrrknfyfo=self.irtrrknfyfo||[]).push([[19],{11442:(B,E,v)=>{v.d(E,{d:()=>c,e:()=>S});var z=v(11445),o=v(11213),q=v(11453);class c{get P(){return this._isDisposed}constructor(B,E,v){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]&&arguments[6],x=arguments.length>7?arguments[7]:void 0,D=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,B&&B.rB?this._engine=B.rB().getEngine():this._engine=B,this._updatable=v,this._instanced=c,this._divisor=x||1,this._label=D,E instanceof z.c?(this._data=null,this._buffer=E):(this._data=E,this._buffer=null),this.byteStride=S?o:o*Float32Array.BYTES_PER_ELEMENT,q||this.create()}createVertexBuffer(B,E,v,z,o){let q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6?arguments[6]:void 0;const x=q?E:E*Float32Array.BYTES_PER_ELEMENT,D=z?q?z:z*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new S(this._engine,this,B,this._updatable,!0,D,void 0===o?this._instanced:o,x,v,void 0,void 0,!0,this._divisor||c)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!B&&this._buffer||(B=B||this._data,B&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,B),this._data=B):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(B,this._label),this._data=B):this._buffer=this._engine.createVertexBuffer(B,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Gv>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Gv,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Gv,void 0,this._label));o.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(B){this.create(B)}updateDirectly(B,E,v){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,B,z?E:E*Float32Array.BYTES_PER_ELEMENT,v?v*this.byteStride:void 0),this._data=0===E&&void 0===v?B:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class S{get P(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(B){const E=0!=B;this._instanceDivisor=B,E!==this._instanced&&(this._instanced=E,this._computeHashCode())}get _maxVerticesCount(){const B=this.getData();return B?Array.isArray(B)?B.length/(this.byteStride/4)-this.byteOffset/4:(B.byteLength-this.byteOffset)/this.byteStride:0}constructor(B,E,v,z,o,x,D,h,y,Q){let P=arguments.length>10&&void 0!==arguments[10]&&arguments[10],G=arguments.length>11&&void 0!==arguments[11]&&arguments[11],Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,a=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let m=!1;if(this.PE=B,"object"===typeof z&&null!==z?(m=z.updatable??!1,o=z.postponeInternalCreation,x=z.stride,D=z.instanced,h=z.offset,y=z.size,Q=z.type,P=z.normalized??!1,G=z.useBytes??!1,Y=z.divisor??1,a=z.takeBufferOwnership??!1,this._label=z.label):m=!!z,E instanceof c?(this._buffer=E,this._ownsBuffer=a):(this._buffer=new c(B,E,m,x,o,D,G,Y,this._label),this._ownsBuffer=!0),this.uniqueId=S._Counter++,this._kind=v,void 0===Q){const B=this.getData();this.type=B?S.GetDataType(B):S.FLOAT}else this.type=Q;const g=(0,q.k)(this.type);G?(this._size=y||(x?x/g:S.DeduceStride(v)),this.byteStride=x||this._buffer.byteStride||this._size*g,this.byteOffset=h||0):(this._size=y||x||S.DeduceStride(v),this.byteStride=x?x*g:this._buffer.byteStride||this._size*g,this.byteOffset=(h||0)*g),this.normalized=P,this._instanced=void 0!==D&&D,this._instanceDivisor=D?Y:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var B;null===(B=this._buffer)||void 0===B||B._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(B,E){const v=this.getData();return v?(0,q.j)(v,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,B,E):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,q.k)(this.type)}getOffset(){return this.byteOffset/(0,q.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,q.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(B){this._buffer.create(B),this._alignBuffer()}update(B){this._buffer.update(B),this._alignBuffer()}updateDirectly(B,E){let v=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(B,E,void 0,v),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(B,E){(0,q.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,B,this.normalized,((B,v)=>{for(let z=0;z<this._size;z++)E(B[z],v+z)}))}_alignBuffer(){}static DeduceStride(B){switch(B){case S.UVKind:case S.UV2Kind:case S.UV3Kind:case S.UV4Kind:case S.UV5Kind:case S.UV6Kind:return 2;case S.NormalKind:case S.PositionKind:return 3;case S.ColorKind:case S.ColorInstanceKind:case S.MatricesIndicesKind:case S.MatricesIndicesExtraKind:case S.MatricesWeightsKind:case S.MatricesWeightsExtraKind:case S.TangentKind:return 4;default:throw new Error("Invalid kind '"+B+"'")}}static GetDataType(B){return B instanceof Int8Array?S.BYTE:B instanceof Uint8Array?S.UNSIGNED_BYTE:B instanceof Int16Array?S.SHORT:B instanceof Uint16Array?S.UNSIGNED_SHORT:B instanceof Int32Array?S.INT:B instanceof Uint32Array?S.UNSIGNED_INT:S.FLOAT}static GetTypeByteLength(B){return(0,q.k)(B)}static ForEach(B,E,v,z,o,c,S,x){(0,q.i)(B,E,v,z,o,c,S,((B,E)=>{for(let v=0;v<z;v++)x(B[v],E+v)}))}static GetFloatData(B,E,v,z,o,c,S,x){return(0,q.j)(B,E,v,z,o,c,S,x)}}S._Counter=0,S.BYTE=5120,S.UNSIGNED_BYTE=5121,S.SHORT=5122,S.UNSIGNED_SHORT=5123,S.INT=5124,S.UNSIGNED_INT=5125,S.FLOAT=5126,S.PositionKind="position",S.NormalKind="normal",S.TangentKind="tangent",S.UVKind="uv",S.UV2Kind="uv2",S.UV3Kind="uv3",S.UV4Kind="uv4",S.UV5Kind="uv5",S.UV6Kind="uv6",S.ColorKind="color",S.ColorInstanceKind="instanceColor",S.MatricesIndicesKind="matricesIndices",S.MatricesWeightsKind="matricesWeights",S.MatricesIndicesExtraKind="matricesIndicesExtra",S.MatricesWeightsExtraKind="matricesWeightsExtra"},11453:(B,E,v)=>{v.d(E,{c:()=>Q,f:()=>y,i:()=>x,j:()=>D,k:()=>c,o:()=>S,r:()=>h});var z=v(11213);function o(B,E,v,z){switch(E){case 5120:{let E=B.getInt8(v);return z&&(E=Math.max(E/127,-1)),E}case 5121:{let E=B.getUint8(v);return z&&(E/=255),E}case 5122:{let E=B.getInt16(v,!0);return z&&(E=Math.max(E/32767,-1)),E}case 5123:{let E=B.getUint16(v,!0);return z&&(E/=65535),E}case 5124:return B.getInt32(v,!0);case 5125:return B.getUint32(v,!0);case 5126:return B.getFloat32(v,!0);default:throw new Error(`Invalid component type ${E}`)}}function q(B,E,v,z,o){switch(E){case 5120:z&&(o=Math.round(127*o)),B.setInt8(v,o);break;case 5121:z&&(o=Math.round(255*o)),B.setUint8(v,o);break;case 5122:z&&(o=Math.round(32767*o)),B.setInt16(v,o,!0);break;case 5123:z&&(o=Math.round(65535*o)),B.setUint16(v,o,!0);break;case 5124:B.setInt32(v,o,!0);break;case 5125:B.setUint32(v,o,!0);break;case 5126:B.setFloat32(v,o,!0);break;default:throw new Error(`Invalid component type ${E}`)}}function c(B){switch(B){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${B}'`)}}function S(B){switch(B){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${B}'`)}}function x(B,E,v,z,S,x,D,h){const y=new Array(z),Q=new Array(z);if(B instanceof Array){let o=E/4;const q=v/4;for(let E=0;E<x;E+=z){for(let E=0;E<z;E++)y[E]=Q[E]=B[o+E];h(Q,E);for(let E=0;E<z;E++)y[E]!==Q[E]&&(B[o+E]=Q[E]);o+=q}}else{const P=ArrayBuffer.isView(B)?new DataView(B.buffer,B.byteOffset,B.byteLength):new DataView(B),G=c(S);for(let B=0;B<x;B+=z){for(let B=0,v=E;B<z;B++,v+=G)y[B]=Q[B]=o(P,S,v,D);h(Q,B);for(let B=0,v=E;B<z;B++,v+=G)y[B]!==Q[B]&&q(P,S,v,D,Q[B]);E+=v}}}function D(B,E,v,o,q,S,D,h){const y=E*c(v),Q=D*E;if(5126!==v||q!==y){const z=new Float32Array(Q);return x(B,o,q,E,v,Q,S,((B,v)=>{for(let o=0;o<E;o++)z[v+o]=B[o]})),z}if(!(B instanceof Array||B instanceof Float32Array)||0!==o||B.length!==Q){if(B instanceof Array){const E=o/4;return B.slice(E,E+Q)}if(B instanceof ArrayBuffer)return new Float32Array(B,o,Q);{const E=B.byteOffset+o;return 0!==(3&E)&&(z.c.Warn("Float array must be aligned to 4-bytes border"),h=!0),h?new Float32Array(B.buffer.slice(E,E+Q*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(B.buffer,E,Q)}}return h?B.slice():B}function h(B,E,v,o,q,D,h,y){const Q=c(v),P=S(v),G=h*E;if(Array.isArray(B)){if(0!==(3&o)||0!==(3&q))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const z=o/4,c=q/4;if(z+(h-1)*c+E>B.length)throw new Error("Last accessed index is out of bounds.");if(c<E)throw new Error("Data stride cannot be smaller than the component size.");if(c!==E){const z=new P(G);return x(B,o,q,E,v,G,D,((B,v)=>{for(let o=0;o<E;o++)z[v+o]=B[o]})),z}return new P(B.slice(z,z+G))}let Y,a=o;B instanceof ArrayBuffer?Y=B:(Y=B.buffer,a+=B.byteOffset);if(a+(h-1)*q+E*Q>Y.byteLength)throw new Error("Last accessed byte is out of bounds.");const m=E*Q;if(q<m)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(q!==m){const B=new P(G);return x(Y,a,q,E,v,G,D,((v,z)=>{for(let o=0;o<E;o++)B[z+o]=v[o]})),B}return 1!==Q&&0!==(a&Q-1)&&(z.c.Warn("Array must be aligned to border of element size. Data will be copied."),y=!0),y?new P(Y.slice(a,a+G*Q)):new P(Y,a,G)}function y(B,E,v,o,q,S,D,h){const y=E*c(v),Q=D*E;if(h.length!==Q)throw new Error("Output length is not valid");if(5126===v&&q===y)if(B instanceof Array){const E=o/4;h.set(B,E)}else if(B instanceof ArrayBuffer){const E=new Float32Array(B,o,Q);h.set(E)}else{const E=B.byteOffset+o;if(0!==(3&E))return z.c.Warn("Float array must be aligned to 4-bytes border"),void h.set(new Float32Array(B.buffer.slice(E,E+Q*Float32Array.BYTES_PER_ELEMENT)));const v=new Float32Array(B.buffer,E,Q);h.set(v)}else x(B,o,q,E,v,Q,S,((B,v)=>{for(let z=0;z<E;z++)h[v+z]=B[z]}))}function Q(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(B)){for(let o=0;o<E;o++)if(B[v+o]-z>65535)return!0;return!1}return 4===B.BYTES_PER_ELEMENT}},11445:(B,E,v)=>{v.d(E,{c:()=>z});class z{get underlyingResource(){return null}constructor(){this.references=0,this.Gv=0,this.is32Bits=!1,this.uniqueId=z._Counter++}}z._Counter=0},11480:(B,E,v)=>{v.d(E,{b:()=>o});var z=v(11278);class o{static GetEffect(B){return void 0===B.getPipelineContext?B.effect:B}constructor(B){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=B.createDrawContext(),E&&(this.materialContext=B.createMaterialContext())}setEffect(B,E){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var z;(this.effect=B,void 0!==E&&(this.defines=E),v)&&(null===(z=this.drawContext)||void 0===z||z.reset())}dispose(){var B;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const B=this.effect;E?B.dispose():z.c.SetImmediate((()=>{B.getEngine().onEndFrameObservable.addOnce((()=>{B.dispose()}))})),this.effect=null}null===(B=this.drawContext)||void 0===B||B.dispose()}}},11571:(B,E,v)=>{v.d(E,{d:()=>o});var z=v(11420);class o{static GetPlanes(B){const E=[];for(let v=0;v<6;v++)E.push(new z.d(0,0,0,0));return o.GetPlanesToRef(B,E),E}static GetNearPlaneToRef(B,E){const v=B.m;E.normal.x=v[3]+v[2],E.normal.y=v[7]+v[6],E.normal.z=v[11]+v[10],E.d=v[15]+v[14],E.normalize()}static GetFarPlaneToRef(B,E){const v=B.m;E.normal.x=v[3]-v[2],E.normal.y=v[7]-v[6],E.normal.z=v[11]-v[10],E.d=v[15]-v[14],E.normalize()}static GetLeftPlaneToRef(B,E){const v=B.m;E.normal.x=v[3]+v[0],E.normal.y=v[7]+v[4],E.normal.z=v[11]+v[8],E.d=v[15]+v[12],E.normalize()}static GetRightPlaneToRef(B,E){const v=B.m;E.normal.x=v[3]-v[0],E.normal.y=v[7]-v[4],E.normal.z=v[11]-v[8],E.d=v[15]-v[12],E.normalize()}static GetTopPlaneToRef(B,E){const v=B.m;E.normal.x=v[3]-v[1],E.normal.y=v[7]-v[5],E.normal.z=v[11]-v[9],E.d=v[15]-v[13],E.normalize()}static GetBottomPlaneToRef(B,E){const v=B.m;E.normal.x=v[3]+v[1],E.normal.y=v[7]+v[5],E.normal.z=v[11]+v[9],E.d=v[15]+v[13],E.normalize()}static GetPlanesToRef(B,E){o.GetNearPlaneToRef(B,E[0]),o.GetFarPlaneToRef(B,E[1]),o.GetLeftPlaneToRef(B,E[2]),o.GetRightPlaneToRef(B,E[3]),o.GetTopPlaneToRef(B,E[4]),o.GetBottomPlaneToRef(B,E[5])}static IsPointInFrustum(B,E){for(let v=0;v<6;v++)if(E[v].dotCoordinate(B)<0)return!1;return!0}}},11583:(B,E,v)=>{v.d(E,{b:()=>o});var z=v(11230);class o{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(B,E){o.Enabled&&(this._current+=B,E&&this._fetchResult())}beginMonitoring(){o.Enabled&&(this._startMonitoringTime=z.e.Now)}endMonitoring(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!o.Enabled)return;B&&this.fetchNewFrame();const E=z.e.Now;this._current=E-this._startMonitoringTime,B&&this._fetchResult()}qq(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const B=z.e.Now;B-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=B,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}o.Enabled=!0},11460:(B,E,v)=>{v.d(E,{b:()=>o,c:()=>z});class z{constructor(B){this.length=0,this.data=new Array(B),this._id=z._GlobalId++}push(B){this.data[this.length++]=B,this.length>this.data.length&&(this.data.length*=2)}forEach(B){for(let E=0;E<this.length;E++)B(this.data[E])}sort(B){this.data.sort(B)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(B){if(0!==B.length){this.length+B.length>this.data.length&&(this.data.length=2*(this.length+B.length));for(let E=0;E<B.length;E++)this.data[this.length++]=(B.data||B)[E]}}indexOf(B){const E=this.data.indexOf(B);return E>=this.length?-1:E}contains(B){return-1!==this.indexOf(B)}}z._GlobalId=0;class o extends z{constructor(){super(...arguments),this._duplicateId=0}push(B){super.push(B),B.__smartArrayFlags||(B.__smartArrayFlags={}),B.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(B){return(!B.__smartArrayFlags||B.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(B),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(B){if(0!==B.length){this.length+B.length>this.data.length&&(this.data.length=2*(this.length+B.length));for(let E=0;E<B.length;E++){const v=(B.data||B)[E];this.pushNoDuplicate(v)}}}}},11436:(B,E,v)=>{v.d(E,{b:()=>q});var z=v(11442),o=v(11202);class q{constructor(B){this._vertexBuffers={},this.onBeforeRenderObservable=new o.e,this._scene=B}_prepareBuffers(){if(this._vertexBuffers[z.e.PositionKind])return;const B=[];B.push(1,1),B.push(-1,1),B.push(-1,-1),B.push(1,-1),this._vertexBuffers[z.e.PositionKind]=new z.e(this._scene.getEngine(),B,z.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const B=[];B.push(0),B.push(1),B.push(2),B.push(0),B.push(2),B.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(B)}_rebuild(){const B=this._vertexBuffers[z.e.PositionKind];B&&(B._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const v=this._scene.activeCamera;return!!v&&(E=E||v._postProcesses.filter((B=>null!=B)),!(!E||0===E.length||!this._scene.postProcessesEnabled)&&(E[0].activate(v,B,null!==E&&void 0!==E),!0))}directRender(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:B.length;const S=this._scene.getEngine();for(let D=0;D<c;D++){var x;if(D<B.length-1)B[D+1].activate(this._scene.activeCamera||this._scene,null===E||void 0===E?void 0:E.texture);else E?S.bindFramebuffer(E,z,void 0,void 0,v,o):q||S.restoreDefaultFramebuffer(),null===(x=S._debugInsertMarker)||void 0===x||x.call(S,`post process ${B[D].name} output`);const c=B[D],h=c.apply();h&&(c.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),S.bindBuffers(this._vertexBuffers,this._indexBuffer,h),S.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(h))}S.setDepthBuffer(!0),S.setDepthWrite(!0)}_finalizeFrame(B,E,v,z){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const q=this._scene.activeCamera;if(!q)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(z=z||q._postProcesses.filter((B=>null!=B))).length||!this._scene.postProcessesEnabled)return;const c=this._scene.getEngine();for(let x=0,D=z.length;x<D;x++){const h=z[x];var S;if(x<D-1)h._outputTexture=z[x+1].activate(q,null===E||void 0===E?void 0:E.texture);else E?(c.bindFramebuffer(E,v,void 0,void 0,o),h._outputTexture=E):(c.restoreDefaultFramebuffer(),h._outputTexture=null),null===(S=c._debugInsertMarker)||void 0===S||S.call(c,`post process ${z[x].name} output`);if(B)break;const y=h.apply();y&&(h.onBeforeRenderObservable.notifyObservers(y),this._prepareBuffers(),c.bindBuffers(this._vertexBuffers,this._indexBuffer,y),c.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(y))}c.setDepthBuffer(!0),c.setDepthWrite(!0),c.setAlphaMode(0)}dispose(){const B=this._vertexBuffers[z.e.PositionKind];B&&(B.dispose(),this._vertexBuffers[z.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11458:(B,E,v)=>{v.d(E,{e:()=>S});var z=v(11460),o=v(11380);class q{set opaqueSortCompareFn(B){this._opaqueSortCompareFn=B||q.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(B){this._alphaTestSortCompareFn=B||q.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(B){this._transparentSortCompareFn=B||q.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(B,E){let v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=B,this._opaqueSubMeshes=new z.c(256),this._transparentSubMeshes=new z.c(256),this._alphaTestSubMeshes=new z.c(256),this._depthOnlySubMeshes=new z.c(256),this._particleSystems=new z.c(256),this._spriteManagers=new z.c(256),this._empty=!0,this._edgesRenderers=new z.b(16),this._scene=E,this.opaqueSortCompareFn=v,this.alphaTestSortCompareFn=o,this.transparentSortCompareFn=q}render(B,E,v,z){if(B)return void B(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const o=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(o.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),o.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const q=o.getStencilBuffer();if(o.setStencilBuffer(!1),E&&this._renderSprites(),v&&this._renderParticles(z),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(o.setStencilBuffer(q),this._scene.useOrderIndependentTransparency){const B=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);B.length&&this._renderTransparent(B)}else this._renderTransparent(this._transparentSubMeshes);o.setAlphaMode(0)}if(o.setStencilBuffer(!1),this._edgesRenderers.length){for(let B=0;B<this._edgesRenderers.length;B++)this._edgesRenderers.data[B].render();o.setAlphaMode(0)}o.setStencilBuffer(q)}_renderOpaqueSorted(B){q._RenderSorted(B,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(B){q._RenderSorted(B,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(B){q._RenderSorted(B,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(B,E,v,z){let c,S=0;const x=v?v.globalPosition:q._ZeroVector;if(z)for(;S<B.length;S++)c=B.data[S],c._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=o.GE.Distance(c.getBoundingInfo().boundingSphere.centerWorld,x);const D=B.length===B.data.length?B.data:B.data.slice(0,B.length);E&&D.sort(E);const h=D[0].getMesh().rB();for(S=0;S<D.length;S++)if(c=D[S],!h._activeMeshesFrozenButKeepClipping||c.isInFrustum(h._frustumPlanes)){if(z){const B=c.HB();if(B&&B.needDepthPrePass){const E=B.rB().getEngine();E.setColorWrite(!1),E.setAlphaMode(0),c.render(!1),E.setColorWrite(!0)}}c.render(z)}}static defaultTransparentSortCompare(B,E){return B._alphaIndex>E._alphaIndex?1:B._alphaIndex<E._alphaIndex?-1:q.backToFrontSortCompare(B,E)}static backToFrontSortCompare(B,E){return B._distanceToCamera<E._distanceToCamera?1:B._distanceToCamera>E._distanceToCamera?-1:0}static frontToBackSortCompare(B,E){return B._distanceToCamera<E._distanceToCamera?-1:B._distanceToCamera>E._distanceToCamera?1:0}static PainterSortCompare(B,E){const v=B.getMesh(),z=E.getMesh();return v.material&&z.material?v.material.uniqueId-z.material.uniqueId:v.uniqueId-z.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(B,E,v){void 0===E&&(E=B.getMesh()),void 0===v&&(v=B.HB()),null!==v&&void 0!==v&&(v.needAlphaBlendingForMesh(E)?this._transparentSubMeshes.push(B):v.needAlphaTestingForMesh(E)?(v.needDepthPrePass&&this._depthOnlySubMeshes.push(B),this._alphaTestSubMeshes.push(B)):(v.needDepthPrePass&&this._depthOnlySubMeshes.push(B),this._opaqueSubMeshes.push(B)),E._renderingGroup=this,E._edgesRenderer&&E.isEnabled()&&E.isVisible&&E._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(E._edgesRenderer),this._empty=!1)}dispatchSprites(B){this._spriteManagers.push(B),this._empty=!1}dispatchParticles(B){this._particleSystems.push(B),this._empty=!1}_renderParticles(B){if(0===this._particleSystems.length)return;const E=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let v=0;v<this._particleSystems.length;v++){const z=this._particleSystems.data[v];if(0===(E&&E.layerMask&z.layerMask))continue;const o=z.zE;o.position&&B&&-1===B.indexOf(o)||this._scene._activeParticles.addCount(z.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const B=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let E=0;E<this._spriteManagers.length;E++){const v=this._spriteManagers.data[E];0!==(B&&B.layerMask&v.layerMask)&&v.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}q._ZeroVector=o.GE.Zero();class c{}class S{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(B){B!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=B,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const B of this._scene.meshes)if(B.qc)for(const E of B.qc)E._wasDispatched=!1;if(this._scene.spriteManagers)for(const B of this._scene.spriteManagers)B._wasDispatched=!1;for(const B of this._scene.bQ)B._wasDispatched=!1}constructor(B){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new c,this._maintainStateBetweenFrames=!1,this._scene=B;for(let E=S.MIN_RENDERINGGROUPS;E<S.MAX_RENDERINGGROUPS;E++)this._autoClearDepthStencil[E]={oc:!0,depth:!0,stencil:!0}}getRenderingGroup(B){const E=B||0;return this._prepareRenderingGroup(E),this._renderingGroups[E]}_clearDepthStencilBuffer(){let B=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,B,E),this._depthStencilBufferAlreadyCleaned=!0)}render(B,E,v,z){const o=this._renderingGroupInfo;if(o.aE=this._scene,o.camera=this._scene.activeCamera,o.renderingManager=this,this._scene.spriteManagers&&z)for(let q=0;q<this._scene.spriteManagers.length;q++){const B=this._scene.spriteManagers[q];this.dispatchSprites(B)}for(let q=S.MIN_RENDERINGGROUPS;q<S.MAX_RENDERINGGROUPS;q++){this._depthStencilBufferAlreadyCleaned=q===S.MIN_RENDERINGGROUPS;const c=this._renderingGroups[q];if(!c||c._empty)continue;const x=1<<q;if(o.renderingGroupId=q,this._scene.onBeforeRenderingGroupObservable.notifyObservers(o,x),S.AUTOCLEAR){const B=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(q):this._autoClearDepthStencil[q];B&&B.oc&&this._clearDepthStencilBuffer(B.depth,B.stencil)}for(const B of this._scene._beforeRenderingGroupDrawStage)B.action(q);c.render(B,z,v,E);for(const B of this._scene._afterRenderingGroupDrawStage)B.action(q);this._scene.onAfterRenderingGroupObservable.notifyObservers(o,x)}}reset(){if(!this.maintainStateBetweenFrames)for(let B=S.MIN_RENDERINGGROUPS;B<S.MAX_RENDERINGGROUPS;B++){const E=this._renderingGroups[B];E&&E.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let B=S.MIN_RENDERINGGROUPS;B<S.MAX_RENDERINGGROUPS;B++){const E=this._renderingGroups[B];E&&E.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let B=S.MIN_RENDERINGGROUPS;B<S.MAX_RENDERINGGROUPS;B++){const E=this._renderingGroups[B];E&&E.dispose()}}_prepareRenderingGroup(B){void 0===this._renderingGroups[B]&&(this._renderingGroups[B]=new q(B,this._scene,this._customOpaqueSortCompareFn[B],this._customAlphaTestSortCompareFn[B],this._customTransparentSortCompareFn[B]))}dispatchSprites(B){this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(B.renderingGroupId).dispatchSprites(B))}dispatchParticles(B){this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(B.renderingGroupId).dispatchParticles(B))}dispatch(B,E,v){void 0===E&&(E=B.getMesh()),this.maintainStateBetweenFrames&&B._wasDispatched||(B._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatch(B,E,v))}setRenderingOrder(B){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,v=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[B]=E,this._customAlphaTestSortCompareFn[B]=v,this._customTransparentSortCompareFn[B]=z,this._renderingGroups[B]){const E=this._renderingGroups[B];E.opaqueSortCompareFn=this._customOpaqueSortCompareFn[B],E.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[B],E.transparentSortCompareFn=this._customTransparentSortCompareFn[B]}}setRenderingAutoClearDepthStencil(B,E){let v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[B]={oc:E,depth:v,stencil:z}}getAutoClearDepthStencilSetup(B){return this._autoClearDepthStencil[B]}}S.MAX_RENDERINGGROUPS=4,S.MIN_RENDERINGGROUPS=0,S.AUTOCLEAR=!0}}]);