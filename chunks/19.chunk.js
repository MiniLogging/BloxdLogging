"use strict";(self.nyfa010khv=self.nyfa010khv||[]).push([[19],{12208:(L,r,p)=>{p.d(r,{b:()=>j,e:()=>z});var J=p(12210),i=p(11975),n=p(12215);class j{get P(){return this._isDisposed}constructor(L,r,p){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],z=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7?arguments[7]:void 0,C=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,L&&L.FL?this._engine=L.FL().getEngine():this._engine=L,this._updatable=p,this._instanced=j,this._divisor=G||1,this._label=C,r instanceof J.b?(this._data=null,this._buffer=r):(this._data=r,this._buffer=null),this.byteStride=z?i:i*Float32Array.BYTES_PER_ELEMENT,n||this.create()}createVertexBuffer(L,r,p,J,i){let n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6?arguments[6]:void 0;const G=n?r:r*Float32Array.BYTES_PER_ELEMENT,C=J?n?J:J*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new z(this._engine,this,L,this._updatable,!0,C,void 0===i?this._instanced:i,G,p,void 0,void 0,!0,this._divisor||j)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!L&&this._buffer||(L=L||this._data,L&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,L),this._data=L):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(L,this._label),this._data=L):this._buffer=this._engine.createVertexBuffer(L,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Mr>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Mr,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Mr,void 0,this._label));i.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(L){this.create(L)}updateDirectly(L,r,p){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,L,J?r:r*Float32Array.BYTES_PER_ELEMENT,p?p*this.byteStride:void 0),this._data=0===r&&void 0===p?L:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class z{get P(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(L){const r=0!=L;this._instanceDivisor=L,r!==this._instanced&&(this._instanced=r,this._computeHashCode())}get _maxVerticesCount(){const L=this.getData();return L?Array.isArray(L)?L.length/(this.byteStride/4)-this.byteOffset/4:(L.byteLength-this.byteOffset)/this.byteStride:0}constructor(L,r,p,J,i,G,C,t,E,x){let w=arguments.length>10&&void 0!==arguments[10]&&arguments[10],g=arguments.length>11&&void 0!==arguments[11]&&arguments[11],b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,c=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let P=!1;if(this.gr=L,"object"===typeof J&&null!==J?(P=J.updatable??!1,i=J.postponeInternalCreation,G=J.stride,C=J.instanced,t=J.offset,E=J.size,x=J.type,w=J.normalized??!1,g=J.useBytes??!1,b=J.divisor??1,c=J.takeBufferOwnership??!1,this._label=J.label):P=!!J,r instanceof j?(this._buffer=r,this._ownsBuffer=c):(this._buffer=new j(L,r,P,G,i,C,g,b,this._label),this._ownsBuffer=!0),this.uniqueId=z._Counter++,this._kind=p,void 0===x){const L=this.getData();this.type=L?z.GetDataType(L):z.FLOAT}else this.type=x;const O=(0,n.p)(this.type);g?(this._size=E||(G?G/O:z.DeduceStride(p)),this.byteStride=G||this._buffer.byteStride||this._size*O,this.byteOffset=t||0):(this._size=E||G||z.DeduceStride(p),this.byteStride=G?G*O:this._buffer.byteStride||this._size*O,this.byteOffset=(t||0)*O),this.normalized=w,this._instanced=void 0!==C&&C,this._instanceDivisor=C?b:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var L;null===(L=this._buffer)||void 0===L||L._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(L,r){const p=this.getData();return p?(0,n.m)(p,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,L,r):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,n.p)(this.type)}getOffset(){return this.byteOffset/(0,n.p)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,n.p)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(L){this._buffer.create(L),this._alignBuffer()}update(L){this._buffer.update(L),this._alignBuffer()}updateDirectly(L,r){let p=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(L,r,void 0,p),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(L,r){(0,n.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,L,this.normalized,((L,p)=>{for(let J=0;J<this._size;J++)r(L[J],p+J)}))}_alignBuffer(){}static DeduceStride(L){switch(L){case z.UVKind:case z.UV2Kind:case z.UV3Kind:case z.UV4Kind:case z.UV5Kind:case z.UV6Kind:return 2;case z.NormalKind:case z.PositionKind:return 3;case z.ColorKind:case z.ColorInstanceKind:case z.MatricesIndicesKind:case z.MatricesIndicesExtraKind:case z.MatricesWeightsKind:case z.MatricesWeightsExtraKind:case z.TangentKind:return 4;default:throw new Error("Invalid kind '"+L+"'")}}static GetDataType(L){return L instanceof Int8Array?z.BYTE:L instanceof Uint8Array?z.UNSIGNED_BYTE:L instanceof Int16Array?z.SHORT:L instanceof Uint16Array?z.UNSIGNED_SHORT:L instanceof Int32Array?z.INT:L instanceof Uint32Array?z.UNSIGNED_INT:z.FLOAT}static GetTypeByteLength(L){return(0,n.p)(L)}static ForEach(L,r,p,J,i,j,z,G){(0,n.i)(L,r,p,J,i,j,z,((L,r)=>{for(let p=0;p<J;p++)G(L[p],r+p)}))}static GetFloatData(L,r,p,J,i,j,z,G){return(0,n.m)(L,r,p,J,i,j,z,G)}}z._Counter=0,z.BYTE=5120,z.UNSIGNED_BYTE=5121,z.SHORT=5122,z.UNSIGNED_SHORT=5123,z.INT=5124,z.UNSIGNED_INT=5125,z.FLOAT=5126,z.PositionKind="position",z.NormalKind="normal",z.TangentKind="tangent",z.UVKind="uv",z.UV2Kind="uv2",z.UV3Kind="uv3",z.UV4Kind="uv4",z.UV5Kind="uv5",z.UV6Kind="uv6",z.ColorKind="color",z.ColorInstanceKind="instanceColor",z.MatricesIndicesKind="matricesIndices",z.MatricesWeightsKind="matricesWeights",z.MatricesIndicesExtraKind="matricesIndicesExtra",z.MatricesWeightsExtraKind="matricesWeightsExtra"},12215:(L,r,p)=>{p.d(r,{b:()=>x,e:()=>E,i:()=>G,m:()=>C,p:()=>j,s:()=>z,w:()=>t});var J=p(11975);function i(L,r,p,J){switch(r){case 5120:{let r=L.getInt8(p);return J&&(r=Math.max(r/127,-1)),r}case 5121:{let r=L.getUint8(p);return J&&(r/=255),r}case 5122:{let r=L.getInt16(p,!0);return J&&(r=Math.max(r/32767,-1)),r}case 5123:{let r=L.getUint16(p,!0);return J&&(r/=65535),r}case 5124:return L.getInt32(p,!0);case 5125:return L.getUint32(p,!0);case 5126:return L.getFloat32(p,!0);default:throw new Error(`Invalid component type ${r}`)}}function n(L,r,p,J,i){switch(r){case 5120:J&&(i=Math.round(127*i)),L.setInt8(p,i);break;case 5121:J&&(i=Math.round(255*i)),L.setUint8(p,i);break;case 5122:J&&(i=Math.round(32767*i)),L.setInt16(p,i,!0);break;case 5123:J&&(i=Math.round(65535*i)),L.setUint16(p,i,!0);break;case 5124:L.setInt32(p,i,!0);break;case 5125:L.setUint32(p,i,!0);break;case 5126:L.setFloat32(p,i,!0);break;default:throw new Error(`Invalid component type ${r}`)}}function j(L){switch(L){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${L}'`)}}function z(L){switch(L){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${L}'`)}}function G(L,r,p,J,z,G,C,t){const E=new Array(J),x=new Array(J);if(L instanceof Array){let i=r/4;const n=p/4;for(let r=0;r<G;r+=J){for(let r=0;r<J;r++)E[r]=x[r]=L[i+r];t(x,r);for(let r=0;r<J;r++)E[r]!==x[r]&&(L[i+r]=x[r]);i+=n}}else{const w=ArrayBuffer.isView(L)?new DataView(L.buffer,L.byteOffset,L.byteLength):new DataView(L),g=j(z);for(let L=0;L<G;L+=J){for(let L=0,p=r;L<J;L++,p+=g)E[L]=x[L]=i(w,z,p,C);t(x,L);for(let L=0,p=r;L<J;L++,p+=g)E[L]!==x[L]&&n(w,z,p,C,x[L]);r+=p}}}function C(L,r,p,i,n,z,C,t){const E=r*j(p),x=C*r;if(5126!==p||n!==E){const J=new Float32Array(x);return G(L,i,n,r,p,x,z,((L,p)=>{for(let i=0;i<r;i++)J[p+i]=L[i]})),J}if(!(L instanceof Array||L instanceof Float32Array)||0!==i||L.length!==x){if(L instanceof Array){const r=i/4;return L.slice(r,r+x)}if(L instanceof ArrayBuffer)return new Float32Array(L,i,x);{const r=L.byteOffset+i;return 0!==(3&r)&&(J.d.Warn("Float array must be aligned to 4-bytes border"),t=!0),t?new Float32Array(L.buffer.slice(r,r+x*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(L.buffer,r,x)}}return t?L.slice():L}function t(L,r,p,i,n,C,t,E){const x=j(p),w=z(p),g=t*r;if(Array.isArray(L)){if(0!==(3&i)||0!==(3&n))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const J=i/4,j=n/4;if(J+(t-1)*j+r>L.length)throw new Error("Last accessed index is out of bounds.");if(j<r)throw new Error("Data stride cannot be smaller than the component size.");if(j!==r){const J=new w(g);return G(L,i,n,r,p,g,C,((L,p)=>{for(let i=0;i<r;i++)J[p+i]=L[i]})),J}return new w(L.slice(J,J+g))}let b,c=i;L instanceof ArrayBuffer?b=L:(b=L.buffer,c+=L.byteOffset);if(c+(t-1)*n+r*x>b.byteLength)throw new Error("Last accessed byte is out of bounds.");const P=r*x;if(n<P)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(n!==P){const L=new w(g);return G(b,c,n,r,p,g,C,((p,J)=>{for(let i=0;i<r;i++)L[J+i]=p[i]})),L}return 1!==x&&0!==(c&x-1)&&(J.d.Warn("Array must be aligned to border of element size. Data will be copied."),E=!0),E?new w(b.slice(c,c+g*x)):new w(b,c,g)}function E(L,r,p,i,n,z,C,t){const E=r*j(p),x=C*r;if(t.length!==x)throw new Error("Output length is not valid");if(5126===p&&n===E)if(L instanceof Array){const r=i/4;t.set(L,r)}else if(L instanceof ArrayBuffer){const r=new Float32Array(L,i,x);t.set(r)}else{const r=L.byteOffset+i;if(0!==(3&r))return J.d.Warn("Float array must be aligned to 4-bytes border"),void t.set(new Float32Array(L.buffer.slice(r,r+x*Float32Array.BYTES_PER_ELEMENT)));const p=new Float32Array(L.buffer,r,x);t.set(p)}else G(L,i,n,r,p,x,z,((L,p)=>{for(let J=0;J<r;J++)t[p+J]=L[J]}))}function x(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(L)){for(let i=0;i<r;i++)if(L[p+i]-J>65535)return!0;return!1}return 4===L.BYTES_PER_ELEMENT}},12210:(L,r,p)=>{p.d(r,{b:()=>J});class J{get underlyingResource(){return null}constructor(){this.references=0,this.Mr=0,this.is32Bits=!1,this.uniqueId=J._Counter++}}J._Counter=0},12247:(L,r,p)=>{p.d(r,{d:()=>i});var J=p(12032);class i{static GetEffect(L){return void 0===L.getPipelineContext?L.effect:L}constructor(L){let r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=L.createDrawContext(),r&&(this.materialContext=L.createMaterialContext())}setEffect(L,r){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var J;(this.effect=L,void 0!==r&&(this.defines=r),p)&&(null===(J=this.drawContext)||void 0===J||J.reset())}dispose(){var L;let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const L=this.effect;r?L.dispose():J.d.SetImmediate((()=>{L.getEngine().onEndFrameObservable.addOnce((()=>{L.dispose()}))})),this.effect=null}null===(L=this.drawContext)||void 0===L||L.dispose()}}},12314:(L,r,p)=>{p.d(r,{d:()=>i});var J=p(12179);class i{static GetPlanes(L){const r=[];for(let p=0;p<6;p++)r.push(new J.c(0,0,0,0));return i.GetPlanesToRef(L,r),r}static GetNearPlaneToRef(L,r){const p=L.m;r.normal.x=p[3]+p[2],r.normal.y=p[7]+p[6],r.normal.z=p[11]+p[10],r.d=p[15]+p[14],r.normalize()}static GetFarPlaneToRef(L,r){const p=L.m;r.normal.x=p[3]-p[2],r.normal.y=p[7]-p[6],r.normal.z=p[11]-p[10],r.d=p[15]-p[14],r.normalize()}static GetLeftPlaneToRef(L,r){const p=L.m;r.normal.x=p[3]+p[0],r.normal.y=p[7]+p[4],r.normal.z=p[11]+p[8],r.d=p[15]+p[12],r.normalize()}static GetRightPlaneToRef(L,r){const p=L.m;r.normal.x=p[3]-p[0],r.normal.y=p[7]-p[4],r.normal.z=p[11]-p[8],r.d=p[15]-p[12],r.normalize()}static GetTopPlaneToRef(L,r){const p=L.m;r.normal.x=p[3]-p[1],r.normal.y=p[7]-p[5],r.normal.z=p[11]-p[9],r.d=p[15]-p[13],r.normalize()}static GetBottomPlaneToRef(L,r){const p=L.m;r.normal.x=p[3]+p[1],r.normal.y=p[7]+p[5],r.normal.z=p[11]+p[9],r.d=p[15]+p[13],r.normalize()}static GetPlanesToRef(L,r){i.GetNearPlaneToRef(L,r[0]),i.GetFarPlaneToRef(L,r[1]),i.GetLeftPlaneToRef(L,r[2]),i.GetRightPlaneToRef(L,r[3]),i.GetTopPlaneToRef(L,r[4]),i.GetBottomPlaneToRef(L,r[5])}static IsPointInFrustum(L,r){for(let p=0;p<6;p++)if(r[p].dotCoordinate(L)<0)return!1;return!0}}},12328:(L,r,p)=>{p.d(r,{c:()=>i});var J=p(11988);class i{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(L,r){i.Enabled&&(this._current+=L,r&&this._fetchResult())}beginMonitoring(){i.Enabled&&(this._startMonitoringTime=J.d.Now)}endMonitoring(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!i.Enabled)return;L&&this.fetchNewFrame();const r=J.d.Now;this._current=r-this._startMonitoringTime,L&&this._fetchResult()}ni(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const L=J.d.Now;L-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=L,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}i.Enabled=!0},12223:(L,r,p)=>{p.d(r,{e:()=>i,g:()=>J});class J{constructor(L){this.length=0,this.data=new Array(L),this._id=J._GlobalId++}push(L){this.data[this.length++]=L,this.length>this.data.length&&(this.data.length*=2)}forEach(L){for(let r=0;r<this.length;r++)L(this.data[r])}sort(L){this.data.sort(L)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(L){if(0!==L.length){this.length+L.length>this.data.length&&(this.data.length=2*(this.length+L.length));for(let r=0;r<L.length;r++)this.data[this.length++]=(L.data||L)[r]}}indexOf(L){const r=this.data.indexOf(L);return r>=this.length?-1:r}contains(L){return-1!==this.indexOf(L)}}J._GlobalId=0;class i extends J{constructor(){super(...arguments),this._duplicateId=0}push(L){super.push(L),L.__smartArrayFlags||(L.__smartArrayFlags={}),L.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(L){return(!L.__smartArrayFlags||L.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(L),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(L){if(0!==L.length){this.length+L.length>this.data.length&&(this.data.length=2*(this.length+L.length));for(let r=0;r<L.length;r++){const p=(L.data||L)[r];this.pushNoDuplicate(p)}}}}},12199:(L,r,p)=>{p.d(r,{c:()=>n});var J=p(12208),i=p(11964);class n{constructor(L){this._vertexBuffers={},this.onBeforeRenderObservable=new i.c,this._scene=L}_prepareBuffers(){if(this._vertexBuffers[J.e.PositionKind])return;const L=[];L.push(1,1),L.push(-1,1),L.push(-1,-1),L.push(1,-1),this._vertexBuffers[J.e.PositionKind]=new J.e(this._scene.getEngine(),L,J.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const L=[];L.push(0),L.push(1),L.push(2),L.push(0),L.push(2),L.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(L)}_rebuild(){const L=this._vertexBuffers[J.e.PositionKind];L&&(L._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let L=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const p=this._scene.activeCamera;return!!p&&(r=r||p._postProcesses.filter((L=>null!=L)),!(!r||0===r.length||!this._scene.postProcessesEnabled)&&(r[0].activate(p,L,null!==r&&void 0!==r),!0))}directRender(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]?arguments[6]:L.length;const z=this._scene.getEngine();for(let C=0;C<j;C++){var G;if(C<L.length-1)L[C+1].activate(this._scene.activeCamera||this._scene,null===r||void 0===r?void 0:r.texture);else r?z.bindFramebuffer(r,J,void 0,void 0,p,i):n||z.restoreDefaultFramebuffer(),null===(G=z._debugInsertMarker)||void 0===G||G.call(z,`post process ${L[C].name} output`);const j=L[C],t=j.apply();t&&(j.onBeforeRenderObservable.notifyObservers(t),this._prepareBuffers(),z.bindBuffers(this._vertexBuffers,this._indexBuffer,t),z.drawElementsType(0,0,6),j.onAfterRenderObservable.notifyObservers(t))}z.setDepthBuffer(!0),z.setDepthWrite(!0)}_finalizeFrame(L,r,p,J){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const n=this._scene.activeCamera;if(!n)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(J=J||n._postProcesses.filter((L=>null!=L))).length||!this._scene.postProcessesEnabled)return;const j=this._scene.getEngine();for(let G=0,C=J.length;G<C;G++){const t=J[G];var z;if(G<C-1)t._outputTexture=J[G+1].activate(n,null===r||void 0===r?void 0:r.texture);else r?(j.bindFramebuffer(r,p,void 0,void 0,i),t._outputTexture=r):(j.restoreDefaultFramebuffer(),t._outputTexture=null),null===(z=j._debugInsertMarker)||void 0===z||z.call(j,`post process ${J[G].name} output`);if(L)break;const E=t.apply();E&&(t.onBeforeRenderObservable.notifyObservers(E),this._prepareBuffers(),j.bindBuffers(this._vertexBuffers,this._indexBuffer,E),j.drawElementsType(0,0,6),t.onAfterRenderObservable.notifyObservers(E))}j.setDepthBuffer(!0),j.setDepthWrite(!0),j.setAlphaMode(0)}dispose(){const L=this._vertexBuffers[J.e.PositionKind];L&&(L.dispose(),this._vertexBuffers[J.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12221:(L,r,p)=>{p.d(r,{c:()=>z});var J=p(12223),i=p(12136);class n{set opaqueSortCompareFn(L){this._opaqueSortCompareFn=L||n.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(L){this._alphaTestSortCompareFn=L||n.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(L){this._transparentSortCompareFn=L||n.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(L,r){let p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=L,this._opaqueSubMeshes=new J.g(256),this._transparentSubMeshes=new J.g(256),this._alphaTestSubMeshes=new J.g(256),this._depthOnlySubMeshes=new J.g(256),this._particleSystems=new J.g(256),this._spriteManagers=new J.g(256),this._empty=!0,this._edgesRenderers=new J.e(16),this._scene=r,this.opaqueSortCompareFn=p,this.alphaTestSortCompareFn=i,this.transparentSortCompareFn=n}render(L,r,p,J){if(L)return void L(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const i=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(i.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),i.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const n=i.getStencilBuffer();if(i.setStencilBuffer(!1),r&&this._renderSprites(),p&&this._renderParticles(J),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(i.setStencilBuffer(n),this._scene.useOrderIndependentTransparency){const L=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);L.length&&this._renderTransparent(L)}else this._renderTransparent(this._transparentSubMeshes);i.setAlphaMode(0)}if(i.setStencilBuffer(!1),this._edgesRenderers.length){for(let L=0;L<this._edgesRenderers.length;L++)this._edgesRenderers.data[L].render();i.setAlphaMode(0)}i.setStencilBuffer(n)}_renderOpaqueSorted(L){n._RenderSorted(L,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(L){n._RenderSorted(L,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(L){n._RenderSorted(L,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(L,r,p,J){let j,z=0;const G=p?p.globalPosition:n._ZeroVector;if(J)for(;z<L.length;z++)j=L.data[z],j._alphaIndex=j.getMesh().alphaIndex,j._distanceToCamera=i.cr.Distance(j.getBoundingInfo().boundingSphere.centerWorld,G);const C=L.length===L.data.length?L.data:L.data.slice(0,L.length);r&&C.sort(r);const t=C[0].getMesh().FL();for(z=0;z<C.length;z++)if(j=C[z],!t._activeMeshesFrozenButKeepClipping||j.isInFrustum(t._frustumPlanes)){if(J){const L=j.lL();if(L&&L.needDepthPrePass){const r=L.FL().getEngine();r.setColorWrite(!1),r.setAlphaMode(0),j.render(!1),r.setColorWrite(!0)}}j.render(J)}}static defaultTransparentSortCompare(L,r){return L._alphaIndex>r._alphaIndex?1:L._alphaIndex<r._alphaIndex?-1:n.backToFrontSortCompare(L,r)}static backToFrontSortCompare(L,r){return L._distanceToCamera<r._distanceToCamera?1:L._distanceToCamera>r._distanceToCamera?-1:0}static frontToBackSortCompare(L,r){return L._distanceToCamera<r._distanceToCamera?-1:L._distanceToCamera>r._distanceToCamera?1:0}static PainterSortCompare(L,r){const p=L.getMesh(),J=r.getMesh();return p.material&&J.material?p.material.uniqueId-J.material.uniqueId:p.uniqueId-J.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(L,r,p){void 0===r&&(r=L.getMesh()),void 0===p&&(p=L.lL()),null!==p&&void 0!==p&&(p.needAlphaBlendingForMesh(r)?this._transparentSubMeshes.push(L):p.needAlphaTestingForMesh(r)?(p.needDepthPrePass&&this._depthOnlySubMeshes.push(L),this._alphaTestSubMeshes.push(L)):(p.needDepthPrePass&&this._depthOnlySubMeshes.push(L),this._opaqueSubMeshes.push(L)),r._renderingGroup=this,r._edgesRenderer&&r.isEnabled()&&r.isVisible&&r._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(r._edgesRenderer),this._empty=!1)}dispatchSprites(L){this._spriteManagers.push(L),this._empty=!1}dispatchParticles(L){this._particleSystems.push(L),this._empty=!1}_renderParticles(L){if(0===this._particleSystems.length)return;const r=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let p=0;p<this._particleSystems.length;p++){const J=this._particleSystems.data[p];if(0===(r&&r.layerMask&J.layerMask))continue;const i=J.Jr;i.position&&L&&-1===L.indexOf(i)||this._scene._activeParticles.addCount(J.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const L=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let r=0;r<this._spriteManagers.length;r++){const p=this._spriteManagers.data[r];0!==(L&&L.layerMask&p.layerMask)&&p.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}n._ZeroVector=i.cr.Zero();class j{}class z{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(L){L!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=L,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const L of this._scene.meshes)if(L.ln)for(const r of L.ln)r._wasDispatched=!1;if(this._scene.spriteManagers)for(const L of this._scene.spriteManagers)L._wasDispatched=!1;for(const L of this._scene.SE)L._wasDispatched=!1}constructor(L){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new j,this._maintainStateBetweenFrames=!1,this._scene=L;for(let r=z.MIN_RENDERINGGROUPS;r<z.MAX_RENDERINGGROUPS;r++)this._autoClearDepthStencil[r]={en:!0,depth:!0,ti:!0}}getRenderingGroup(L){const r=L||0;return this._prepareRenderingGroup(r),this._renderingGroups[r]}_clearDepthStencilBuffer(){let L=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,L,r),this._depthStencilBufferAlreadyCleaned=!0)}render(L,r,p,J){const i=this._renderingGroupInfo;if(i.Or=this._scene,i.camera=this._scene.activeCamera,i.renderingManager=this,this._scene.spriteManagers&&J)for(let n=0;n<this._scene.spriteManagers.length;n++){const L=this._scene.spriteManagers[n];this.dispatchSprites(L)}for(let n=z.MIN_RENDERINGGROUPS;n<z.MAX_RENDERINGGROUPS;n++){this._depthStencilBufferAlreadyCleaned=n===z.MIN_RENDERINGGROUPS;const j=this._renderingGroups[n];if(!j||j._empty)continue;const G=1<<n;if(i.renderingGroupId=n,this._scene.onBeforeRenderingGroupObservable.notifyObservers(i,G),z.AUTOCLEAR){const L=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(n):this._autoClearDepthStencil[n];L&&L.en&&this._clearDepthStencilBuffer(L.depth,L.ti)}for(const L of this._scene._beforeRenderingGroupDrawStage)L.action(n);j.render(L,J,p,r);for(const L of this._scene._afterRenderingGroupDrawStage)L.action(n);this._scene.onAfterRenderingGroupObservable.notifyObservers(i,G)}}reset(){if(!this.maintainStateBetweenFrames)for(let L=z.MIN_RENDERINGGROUPS;L<z.MAX_RENDERINGGROUPS;L++){const r=this._renderingGroups[L];r&&r.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let L=z.MIN_RENDERINGGROUPS;L<z.MAX_RENDERINGGROUPS;L++){const r=this._renderingGroups[L];r&&r.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let L=z.MIN_RENDERINGGROUPS;L<z.MAX_RENDERINGGROUPS;L++){const r=this._renderingGroups[L];r&&r.dispose()}}_prepareRenderingGroup(L){void 0===this._renderingGroups[L]&&(this._renderingGroups[L]=new n(L,this._scene,this._customOpaqueSortCompareFn[L],this._customAlphaTestSortCompareFn[L],this._customTransparentSortCompareFn[L]))}dispatchSprites(L){this.maintainStateBetweenFrames&&L._wasDispatched||(L._wasDispatched=!0,this.getRenderingGroup(L.renderingGroupId).dispatchSprites(L))}dispatchParticles(L){this.maintainStateBetweenFrames&&L._wasDispatched||(L._wasDispatched=!0,this.getRenderingGroup(L.renderingGroupId).dispatchParticles(L))}dispatch(L,r,p){void 0===r&&(r=L.getMesh()),this.maintainStateBetweenFrames&&L._wasDispatched||(L._wasDispatched=!0,this.getRenderingGroup(r.renderingGroupId).dispatch(L,r,p))}setRenderingOrder(L){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,p=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[L]=r,this._customAlphaTestSortCompareFn[L]=p,this._customTransparentSortCompareFn[L]=J,this._renderingGroups[L]){const r=this._renderingGroups[L];r.opaqueSortCompareFn=this._customOpaqueSortCompareFn[L],r.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[L],r.transparentSortCompareFn=this._customTransparentSortCompareFn[L]}}setRenderingAutoClearDepthStencil(L,r){let p=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[L]={en:r,depth:p,ti:J}}getAutoClearDepthStencilSetup(L){return this._autoClearDepthStencil[L]}}z.MAX_RENDERINGGROUPS=4,z.MIN_RENDERINGGROUPS=0,z.AUTOCLEAR=!0}}]);