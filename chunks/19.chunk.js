"use strict";(self.ipz2em9uj1g=self.ipz2em9uj1g||[]).push([[19],{12660:(r,O,W)=>{W.d(O,{e:()=>T,i:()=>h});var q=W(12664),Q=W(12453),C=W(12672);class T{get J(){return this._isDisposed}constructor(r,O,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],T=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]&&arguments[6],J=arguments.length>7?arguments[7]:void 0,mr=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,r&&r.Dr?this._engine=r.Dr().getEngine():this._engine=r,this._updatable=W,this._instanced=T,this._divisor=J||1,this._label=mr,O instanceof q.e?(this._data=null,this._buffer=O):(this._data=O,this._buffer=null),this.byteStride=h?Q:Q*Float32Array.BYTES_PER_ELEMENT,C||this.create()}createVertexBuffer(r,O,W,q,Q){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6?arguments[6]:void 0;const J=C?O:O*Float32Array.BYTES_PER_ELEMENT,mr=q?C?q:q*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new h(this._engine,this,r,this._updatable,!0,mr,void 0===Q?this._instanced:Q,J,W,void 0,void 0,!0,this._divisor||T)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!r&&this._buffer||(r=r||this._data,r&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,r),this._data=r):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(r,this._label),this._data=r):this._buffer=this._engine.createVertexBuffer(r,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.iO>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.iO,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.iO,void 0,this._label));Q.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(r){this.create(r)}updateDirectly(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,r,q?O:O*Float32Array.BYTES_PER_ELEMENT,W?W*this.byteStride:void 0),this._data=0===O&&void 0===W?r:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class h{get J(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(r){const O=0!=r;this._instanceDivisor=r,O!==this._instanced&&(this._instanced=O,this._computeHashCode())}get _maxVerticesCount(){const r=this.getData();return r?Array.isArray(r)?r.length/(this.byteStride/4)-this.byteOffset/4:(r.byteLength-this.byteOffset)/this.byteStride:0}constructor(r,O,W,q,Q,J,mr,d,v,g){let K=arguments.length>10&&void 0!==arguments[10]&&arguments[10],U=arguments.length>11&&void 0!==arguments[11]&&arguments[11],P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,b=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let e=!1;if(this.bO=r,"object"===typeof q&&null!==q?(e=q.updatable??!1,Q=q.postponeInternalCreation,J=q.stride,mr=q.instanced,d=q.offset,v=q.size,g=q.type,K=q.normalized??!1,U=q.useBytes??!1,P=q.divisor??1,b=q.takeBufferOwnership??!1,this._label=q.label):e=!!q,O instanceof T?(this._buffer=O,this._ownsBuffer=b):(this._buffer=new T(r,O,e,J,Q,mr,U,P,this._label),this._ownsBuffer=!0),this.uniqueId=h._Counter++,this._kind=W,void 0===g){const r=this.getData();this.type=r?h.GetDataType(r):h.FLOAT}else this.type=g;const Y=(0,C.n)(this.type);U?(this._size=v||(J?J/Y:h.DeduceStride(W)),this.byteStride=J||this._buffer.byteStride||this._size*Y,this.byteOffset=d||0):(this._size=v||J||h.DeduceStride(W),this.byteStride=J?J*Y:this._buffer.byteStride||this._size*Y,this.byteOffset=(d||0)*Y),this.normalized=K,this._instanced=void 0!==mr&&mr,this._instanceDivisor=mr?P:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var r;null===(r=this._buffer)||void 0===r||r._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(r,O){const W=this.getData();return W?(0,C.m)(W,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,r,O):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,C.n)(this.type)}getOffset(){return this.byteOffset/(0,C.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,C.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(r){this._buffer.create(r),this._alignBuffer()}update(r){this._buffer.update(r),this._alignBuffer()}updateDirectly(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(r,O,void 0,W),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(r,O){(0,C.k)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,r,this.normalized,((r,W)=>{for(let q=0;q<this._size;q++)O(r[q],W+q)}))}_alignBuffer(){}static DeduceStride(r){switch(r){case h.UVKind:case h.UV2Kind:case h.UV3Kind:case h.UV4Kind:case h.UV5Kind:case h.UV6Kind:return 2;case h.NormalKind:case h.PositionKind:return 3;case h.ColorKind:case h.ColorInstanceKind:case h.MatricesIndicesKind:case h.MatricesIndicesExtraKind:case h.MatricesWeightsKind:case h.MatricesWeightsExtraKind:case h.TangentKind:return 4;default:throw new Error("Invalid kind '"+r+"'")}}static GetDataType(r){return r instanceof Int8Array?h.BYTE:r instanceof Uint8Array?h.UNSIGNED_BYTE:r instanceof Int16Array?h.SHORT:r instanceof Uint16Array?h.UNSIGNED_SHORT:r instanceof Int32Array?h.INT:r instanceof Uint32Array?h.UNSIGNED_INT:h.FLOAT}static GetTypeByteLength(r){return(0,C.n)(r)}static ForEach(r,O,W,q,Q,T,h,J){(0,C.k)(r,O,W,q,Q,T,h,((r,O)=>{for(let W=0;W<q;W++)J(r[W],O+W)}))}static GetFloatData(r,O,W,q,Q,T,h,J){return(0,C.m)(r,O,W,q,Q,T,h,J)}}h._Counter=0,h.BYTE=5120,h.UNSIGNED_BYTE=5121,h.SHORT=5122,h.UNSIGNED_SHORT=5123,h.INT=5124,h.UNSIGNED_INT=5125,h.FLOAT=5126,h.PositionKind="position",h.NormalKind="normal",h.TangentKind="tangent",h.UVKind="uv",h.UV2Kind="uv2",h.UV3Kind="uv3",h.UV4Kind="uv4",h.UV5Kind="uv5",h.UV6Kind="uv6",h.ColorKind="color",h.ColorInstanceKind="instanceColor",h.MatricesIndicesKind="matricesIndices",h.MatricesWeightsKind="matricesWeights",h.MatricesIndicesExtraKind="matricesIndicesExtra",h.MatricesWeightsExtraKind="matricesWeightsExtra"},12672:(r,O,W)=>{W.d(O,{d:()=>g,g:()=>v,k:()=>J,m:()=>mr,n:()=>T,q:()=>h,s:()=>d});var q=W(12453);function Q(r,O,W,q){switch(O){case 5120:{let O=r.getInt8(W);return q&&(O=Math.max(O/127,-1)),O}case 5121:{let O=r.getUint8(W);return q&&(O/=255),O}case 5122:{let O=r.getInt16(W,!0);return q&&(O=Math.max(O/32767,-1)),O}case 5123:{let O=r.getUint16(W,!0);return q&&(O/=65535),O}case 5124:return r.getInt32(W,!0);case 5125:return r.getUint32(W,!0);case 5126:return r.getFloat32(W,!0);default:throw new Error(`Invalid component type ${O}`)}}function C(r,O,W,q,Q){switch(O){case 5120:q&&(Q=Math.round(127*Q)),r.setInt8(W,Q);break;case 5121:q&&(Q=Math.round(255*Q)),r.setUint8(W,Q);break;case 5122:q&&(Q=Math.round(32767*Q)),r.setInt16(W,Q,!0);break;case 5123:q&&(Q=Math.round(65535*Q)),r.setUint16(W,Q,!0);break;case 5124:r.setInt32(W,Q,!0);break;case 5125:r.setUint32(W,Q,!0);break;case 5126:r.setFloat32(W,Q,!0);break;default:throw new Error(`Invalid component type ${O}`)}}function T(r){switch(r){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${r}'`)}}function h(r){switch(r){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${r}'`)}}function J(r,O,W,q,h,J,mr,d){const v=new Array(q),g=new Array(q);if(r instanceof Array){let Q=O/4;const C=W/4;for(let O=0;O<J;O+=q){for(let O=0;O<q;O++)v[O]=g[O]=r[Q+O];d(g,O);for(let O=0;O<q;O++)v[O]!==g[O]&&(r[Q+O]=g[O]);Q+=C}}else{const K=ArrayBuffer.isView(r)?new DataView(r.buffer,r.byteOffset,r.byteLength):new DataView(r),U=T(h);for(let r=0;r<J;r+=q){for(let r=0,W=O;r<q;r++,W+=U)v[r]=g[r]=Q(K,h,W,mr);d(g,r);for(let r=0,W=O;r<q;r++,W+=U)v[r]!==g[r]&&C(K,h,W,mr,g[r]);O+=W}}}function mr(r,O,W,Q,C,h,mr,d){const v=O*T(W),g=mr*O;if(5126!==W||C!==v){const q=new Float32Array(g);return J(r,Q,C,O,W,g,h,((r,W)=>{for(let Q=0;Q<O;Q++)q[W+Q]=r[Q]})),q}if(!(r instanceof Array||r instanceof Float32Array)||0!==Q||r.length!==g){if(r instanceof Array){const O=Q/4;return r.slice(O,O+g)}if(r instanceof ArrayBuffer)return new Float32Array(r,Q,g);{const O=r.byteOffset+Q;return 0!==(3&O)&&(q.b.Warn("Float array must be aligned to 4-bytes border"),d=!0),d?new Float32Array(r.buffer.slice(O,O+g*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(r.buffer,O,g)}}return d?r.slice():r}function d(r,O,W,Q,C,mr,d,v){const g=T(W),K=h(W),U=d*O;if(Array.isArray(r)){if(0!==(3&Q)||0!==(3&C))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const q=Q/4,T=C/4;if(q+(d-1)*T+O>r.length)throw new Error("Last accessed index is out of bounds.");if(T<O)throw new Error("Data stride cannot be smaller than the component size.");if(T!==O){const q=new K(U);return J(r,Q,C,O,W,U,mr,((r,W)=>{for(let Q=0;Q<O;Q++)q[W+Q]=r[Q]})),q}return new K(r.slice(q,q+U))}let P,b=Q;r instanceof ArrayBuffer?P=r:(P=r.buffer,b+=r.byteOffset);if(b+(d-1)*C+O*g>P.byteLength)throw new Error("Last accessed byte is out of bounds.");const e=O*g;if(C<e)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(C!==e){const r=new K(U);return J(P,b,C,O,W,U,mr,((W,q)=>{for(let Q=0;Q<O;Q++)r[q+Q]=W[Q]})),r}return 1!==g&&0!==(b&g-1)&&(q.b.Warn("Array must be aligned to border of element size. Data will be copied."),v=!0),v?new K(P.slice(b,b+U*g)):new K(P,b,U)}function v(r,O,W,Q,C,h,mr,d){const v=O*T(W),g=mr*O;if(d.length!==g)throw new Error("Output length is not valid");if(5126===W&&C===v)if(r instanceof Array){const O=Q/4;d.set(r,O)}else if(r instanceof ArrayBuffer){const O=new Float32Array(r,Q,g);d.set(O)}else{const O=r.byteOffset+Q;if(0!==(3&O))return q.b.Warn("Float array must be aligned to 4-bytes border"),void d.set(new Float32Array(r.buffer.slice(O,O+g*Float32Array.BYTES_PER_ELEMENT)));const W=new Float32Array(r.buffer,O,g);d.set(W)}else J(r,Q,C,O,W,g,h,((r,W)=>{for(let q=0;q<O;q++)d[W+q]=r[q]}))}function g(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(r)){for(let Q=0;Q<O;Q++)if(r[W+Q]-q>65535)return!0;return!1}return 4===r.BYTES_PER_ELEMENT}},12664:(r,O,W)=>{W.d(O,{e:()=>q});class q{get underlyingResource(){return null}constructor(){this.references=0,this.iO=0,this.is32Bits=!1,this.uniqueId=q._Counter++}}q._Counter=0},12707:(r,O,W)=>{W.d(O,{d:()=>Q});var q=W(12509);class Q{static GetEffect(r){return void 0===r.getPipelineContext?r.effect:r}constructor(r){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=r.createDrawContext(),O&&(this.materialContext=r.createMaterialContext())}setEffect(r,O){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var q;(this.effect=r,void 0!==O&&(this.defines=O),W)&&(null===(q=this.drawContext)||void 0===q||q.reset())}dispose(){var r;let O=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const r=this.effect;O?r.dispose():q.c.SetImmediate((()=>{r.getEngine().onEndFrameObservable.addOnce((()=>{r.dispose()}))})),this.effect=null}null===(r=this.drawContext)||void 0===r||r.dispose()}}},12782:(r,O,W)=>{W.d(O,{e:()=>Q});var q=W(12637);class Q{static GetPlanes(r){const O=[];for(let W=0;W<6;W++)O.push(new q.c(0,0,0,0));return Q.GetPlanesToRef(r,O),O}static GetNearPlaneToRef(r,O){const W=r.m;O.normal.x=W[3]+W[2],O.normal.y=W[7]+W[6],O.normal.z=W[11]+W[10],O.d=W[15]+W[14],O.normalize()}static GetFarPlaneToRef(r,O){const W=r.m;O.normal.x=W[3]-W[2],O.normal.y=W[7]-W[6],O.normal.z=W[11]-W[10],O.d=W[15]-W[14],O.normalize()}static GetLeftPlaneToRef(r,O){const W=r.m;O.normal.x=W[3]+W[0],O.normal.y=W[7]+W[4],O.normal.z=W[11]+W[8],O.d=W[15]+W[12],O.normalize()}static GetRightPlaneToRef(r,O){const W=r.m;O.normal.x=W[3]-W[0],O.normal.y=W[7]-W[4],O.normal.z=W[11]-W[8],O.d=W[15]-W[12],O.normalize()}static GetTopPlaneToRef(r,O){const W=r.m;O.normal.x=W[3]-W[1],O.normal.y=W[7]-W[5],O.normal.z=W[11]-W[9],O.d=W[15]-W[13],O.normalize()}static GetBottomPlaneToRef(r,O){const W=r.m;O.normal.x=W[3]+W[1],O.normal.y=W[7]+W[5],O.normal.z=W[11]+W[9],O.d=W[15]+W[13],O.normalize()}static GetPlanesToRef(r,O){Q.GetNearPlaneToRef(r,O[0]),Q.GetFarPlaneToRef(r,O[1]),Q.GetLeftPlaneToRef(r,O[2]),Q.GetRightPlaneToRef(r,O[3]),Q.GetTopPlaneToRef(r,O[4]),Q.GetBottomPlaneToRef(r,O[5])}static IsPointInFrustum(r,O){for(let W=0;W<6;W++)if(O[W].dotCoordinate(r)<0)return!1;return!0}}},12788:(r,O,W)=>{W.d(O,{c:()=>Q});var q=W(12465);class Q{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(r,O){Q.Enabled&&(this._current+=r,O&&this._fetchResult())}beginMonitoring(){Q.Enabled&&(this._startMonitoringTime=q.e.Now)}endMonitoring(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!Q.Enabled)return;r&&this.fetchNewFrame();const O=q.e.Now;this._current=O-this._startMonitoringTime,r&&this._fetchResult()}Qh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const r=q.e.Now;r-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=r,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}Q.Enabled=!0},12677:(r,O,W)=>{W.d(O,{b:()=>Q,f:()=>q});class q{constructor(r){this.length=0,this.data=new Array(r),this._id=q._GlobalId++}push(r){this.data[this.length++]=r,this.length>this.data.length&&(this.data.length*=2)}forEach(r){for(let O=0;O<this.length;O++)r(this.data[O])}sort(r){this.data.sort(r)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(r){if(0!==r.length){this.length+r.length>this.data.length&&(this.data.length=2*(this.length+r.length));for(let O=0;O<r.length;O++)this.data[this.length++]=(r.data||r)[O]}}indexOf(r){const O=this.data.indexOf(r);return O>=this.length?-1:O}contains(r){return-1!==this.indexOf(r)}}q._GlobalId=0;class Q extends q{constructor(){super(...arguments),this._duplicateId=0}push(r){super.push(r),r.__smartArrayFlags||(r.__smartArrayFlags={}),r.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(r){return(!r.__smartArrayFlags||r.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(r),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(r){if(0!==r.length){this.length+r.length>this.data.length&&(this.data.length=2*(this.length+r.length));for(let O=0;O<r.length;O++){const W=(r.data||r)[O];this.pushNoDuplicate(W)}}}}},12657:(r,O,W)=>{W.d(O,{c:()=>C});var q=W(12660),Q=W(12435);class C{constructor(r){this._vertexBuffers={},this.onBeforeRenderObservable=new Q.d,this._scene=r}_prepareBuffers(){if(this._vertexBuffers[q.i.PositionKind])return;const r=[];r.push(1,1),r.push(-1,1),r.push(-1,-1),r.push(1,-1),this._vertexBuffers[q.i.PositionKind]=new q.i(this._scene.getEngine(),r,q.i.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const r=[];r.push(0),r.push(1),r.push(2),r.push(0),r.push(2),r.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(r)}_rebuild(){const r=this._vertexBuffers[q.i.PositionKind];r&&(r._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const W=this._scene.activeCamera;return!!W&&(O=O||W._postProcesses.filter((r=>null!=r)),!(!O||0===O.length||!this._scene.postProcessesEnabled)&&(O[0].activate(W,r,null!==O&&void 0!==O),!0))}directRender(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:r.length;const h=this._scene.getEngine();for(let mr=0;mr<T;mr++){var J;if(mr<r.length-1)r[mr+1].activate(this._scene.activeCamera||this._scene,null===O||void 0===O?void 0:O.texture);else O?h.bindFramebuffer(O,q,void 0,void 0,W,Q):C||h.restoreDefaultFramebuffer(),null===(J=h._debugInsertMarker)||void 0===J||J.call(h,`post process ${r[mr].name} output`);const T=r[mr],d=T.apply();d&&(T.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),h.bindBuffers(this._vertexBuffers,this._indexBuffer,d),h.drawElementsType(0,0,6),T.onAfterRenderObservable.notifyObservers(d))}h.setDepthBuffer(!0),h.setDepthWrite(!0)}_finalizeFrame(r,O,W,q){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const C=this._scene.activeCamera;if(!C)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(q=q||C._postProcesses.filter((r=>null!=r))).length||!this._scene.postProcessesEnabled)return;const T=this._scene.getEngine();for(let J=0,mr=q.length;J<mr;J++){const d=q[J];var h;if(J<mr-1)d._outputTexture=q[J+1].activate(C,null===O||void 0===O?void 0:O.texture);else O?(T.bindFramebuffer(O,W,void 0,void 0,Q),d._outputTexture=O):(T.restoreDefaultFramebuffer(),d._outputTexture=null),null===(h=T._debugInsertMarker)||void 0===h||h.call(T,`post process ${q[J].name} output`);if(r)break;const v=d.apply();v&&(d.onBeforeRenderObservable.notifyObservers(v),this._prepareBuffers(),T.bindBuffers(this._vertexBuffers,this._indexBuffer,v),T.drawElementsType(0,0,6),d.onAfterRenderObservable.notifyObservers(v))}T.setDepthBuffer(!0),T.setDepthWrite(!0),T.setAlphaMode(0)}dispose(){const r=this._vertexBuffers[q.i.PositionKind];r&&(r.dispose(),this._vertexBuffers[q.i.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12675:(r,O,W)=>{W.d(O,{d:()=>h});var q=W(12677),Q=W(12591);class C{set opaqueSortCompareFn(r){this._opaqueSortCompareFn=r||C.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(r){this._alphaTestSortCompareFn=r||C.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(r){this._transparentSortCompareFn=r||C.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=r,this._opaqueSubMeshes=new q.f(256),this._transparentSubMeshes=new q.f(256),this._alphaTestSubMeshes=new q.f(256),this._depthOnlySubMeshes=new q.f(256),this._particleSystems=new q.f(256),this._spriteManagers=new q.f(256),this._empty=!0,this._edgesRenderers=new q.b(16),this._scene=O,this.opaqueSortCompareFn=W,this.alphaTestSortCompareFn=Q,this.transparentSortCompareFn=C}render(r,O,W,q){if(r)return void r(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const Q=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(Q.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),Q.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const C=Q.getStencilBuffer();if(Q.setStencilBuffer(!1),O&&this._renderSprites(),W&&this._renderParticles(q),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(Q.setStencilBuffer(C),this._scene.useOrderIndependentTransparency){const r=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);r.length&&this._renderTransparent(r)}else this._renderTransparent(this._transparentSubMeshes);Q.setAlphaMode(0)}if(Q.setStencilBuffer(!1),this._edgesRenderers.length){for(let r=0;r<this._edgesRenderers.length;r++)this._edgesRenderers.data[r].render();Q.setAlphaMode(0)}Q.setStencilBuffer(C)}_renderOpaqueSorted(r){C._RenderSorted(r,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(r){C._RenderSorted(r,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(r){C._RenderSorted(r,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(r,O,W,q){let T,h=0;const J=W?W.globalPosition:C._ZeroVector;if(q)for(;h<r.length;h++)T=r.data[h],T._alphaIndex=T.getMesh().alphaIndex,T._distanceToCamera=Q.eO.Distance(T.getBoundingInfo().boundingSphere.centerWorld,J);const mr=r.length===r.data.length?r.data:r.data.slice(0,r.length);O&&mr.sort(O);const d=mr[0].getMesh().Dr();for(h=0;h<mr.length;h++)if(T=mr[h],!d._activeMeshesFrozenButKeepClipping||T.isInFrustum(d._frustumPlanes)){if(q){const r=T.ar();if(r&&r.needDepthPrePass){const O=r.Dr().getEngine();O.setColorWrite(!1),O.setAlphaMode(0),T.render(!1),O.setColorWrite(!0)}}T.render(q)}}static defaultTransparentSortCompare(r,O){return r._alphaIndex>O._alphaIndex?1:r._alphaIndex<O._alphaIndex?-1:C.backToFrontSortCompare(r,O)}static backToFrontSortCompare(r,O){return r._distanceToCamera<O._distanceToCamera?1:r._distanceToCamera>O._distanceToCamera?-1:0}static frontToBackSortCompare(r,O){return r._distanceToCamera<O._distanceToCamera?-1:r._distanceToCamera>O._distanceToCamera?1:0}static PainterSortCompare(r,O){const W=r.getMesh(),q=O.getMesh();return W.material&&q.material?W.material.uniqueId-q.material.uniqueId:W.uniqueId-q.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(r,O,W){void 0===O&&(O=r.getMesh()),void 0===W&&(W=r.ar()),null!==W&&void 0!==W&&(W.needAlphaBlendingForMesh(O)?this._transparentSubMeshes.push(r):W.needAlphaTestingForMesh(O)?(W.needDepthPrePass&&this._depthOnlySubMeshes.push(r),this._alphaTestSubMeshes.push(r)):(W.needDepthPrePass&&this._depthOnlySubMeshes.push(r),this._opaqueSubMeshes.push(r)),O._renderingGroup=this,O._edgesRenderer&&O.isEnabled()&&O.isVisible&&O._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(O._edgesRenderer),this._empty=!1)}dispatchSprites(r){this._spriteManagers.push(r),this._empty=!1}dispatchParticles(r){this._particleSystems.push(r),this._empty=!1}_renderParticles(r){if(0===this._particleSystems.length)return;const O=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let W=0;W<this._particleSystems.length;W++){const q=this._particleSystems.data[W];if(0===(O&&O.layerMask&q.layerMask))continue;const Q=q.TO;Q.position&&r&&-1===r.indexOf(Q)||this._scene._activeParticles.addCount(q.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const r=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let O=0;O<this._spriteManagers.length;O++){const W=this._spriteManagers.data[O];0!==(r&&r.layerMask&W.layerMask)&&W.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}C._ZeroVector=Q.eO.Zero();class T{}class h{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(r){r!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=r,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const r of this._scene.meshes)if(r.eh)for(const O of r.eh)O._wasDispatched=!1;if(this._scene.spriteManagers)for(const r of this._scene.spriteManagers)r._wasDispatched=!1;for(const r of this._scene.qK)r._wasDispatched=!1}constructor(r){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new T,this._maintainStateBetweenFrames=!1,this._scene=r;for(let O=h.MIN_RENDERINGGROUPS;O<h.MAX_RENDERINGGROUPS;O++)this._autoClearDepthStencil[O]={bh:!0,depth:!0,dh:!0}}getRenderingGroup(r){const O=r||0;return this._prepareRenderingGroup(O),this._renderingGroups[O]}_clearDepthStencilBuffer(){let r=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,r,O),this._depthStencilBufferAlreadyCleaned=!0)}render(r,O,W,q){const Q=this._renderingGroupInfo;if(Q.GO=this._scene,Q.camera=this._scene.activeCamera,Q.renderingManager=this,this._scene.spriteManagers&&q)for(let C=0;C<this._scene.spriteManagers.length;C++){const r=this._scene.spriteManagers[C];this.dispatchSprites(r)}for(let C=h.MIN_RENDERINGGROUPS;C<h.MAX_RENDERINGGROUPS;C++){this._depthStencilBufferAlreadyCleaned=C===h.MIN_RENDERINGGROUPS;const T=this._renderingGroups[C];if(!T||T._empty)continue;const J=1<<C;if(Q.renderingGroupId=C,this._scene.onBeforeRenderingGroupObservable.notifyObservers(Q,J),h.AUTOCLEAR){const r=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(C):this._autoClearDepthStencil[C];r&&r.bh&&this._clearDepthStencilBuffer(r.depth,r.dh)}for(const r of this._scene._beforeRenderingGroupDrawStage)r.action(C);T.render(r,q,W,O);for(const r of this._scene._afterRenderingGroupDrawStage)r.action(C);this._scene.onAfterRenderingGroupObservable.notifyObservers(Q,J)}}reset(){if(!this.maintainStateBetweenFrames)for(let r=h.MIN_RENDERINGGROUPS;r<h.MAX_RENDERINGGROUPS;r++){const O=this._renderingGroups[r];O&&O.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let r=h.MIN_RENDERINGGROUPS;r<h.MAX_RENDERINGGROUPS;r++){const O=this._renderingGroups[r];O&&O.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let r=h.MIN_RENDERINGGROUPS;r<h.MAX_RENDERINGGROUPS;r++){const O=this._renderingGroups[r];O&&O.dispose()}}_prepareRenderingGroup(r){void 0===this._renderingGroups[r]&&(this._renderingGroups[r]=new C(r,this._scene,this._customOpaqueSortCompareFn[r],this._customAlphaTestSortCompareFn[r],this._customTransparentSortCompareFn[r]))}dispatchSprites(r){this.maintainStateBetweenFrames&&r._wasDispatched||(r._wasDispatched=!0,this.getRenderingGroup(r.renderingGroupId).dispatchSprites(r))}dispatchParticles(r){this.maintainStateBetweenFrames&&r._wasDispatched||(r._wasDispatched=!0,this.getRenderingGroup(r.renderingGroupId).dispatchParticles(r))}dispatch(r,O,W){void 0===O&&(O=r.getMesh()),this.maintainStateBetweenFrames&&r._wasDispatched||(r._wasDispatched=!0,this.getRenderingGroup(O.renderingGroupId).dispatch(r,O,W))}setRenderingOrder(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[r]=O,this._customAlphaTestSortCompareFn[r]=W,this._customTransparentSortCompareFn[r]=q,this._renderingGroups[r]){const O=this._renderingGroups[r];O.opaqueSortCompareFn=this._customOpaqueSortCompareFn[r],O.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[r],O.transparentSortCompareFn=this._customTransparentSortCompareFn[r]}}setRenderingAutoClearDepthStencil(r,O){let W=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[r]={bh:O,depth:W,dh:q}}getAutoClearDepthStencilSetup(r){return this._autoClearDepthStencil[r]}}h.MAX_RENDERINGGROUPS=4,h.MIN_RENDERINGGROUPS=0,h.AUTOCLEAR=!0}}]);