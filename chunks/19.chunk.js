"use strict";(self["7c63p8lin4r"]=self["7c63p8lin4r"]||[]).push([[19],{13e3:(z,u,U)=>{U.d(u,{e:()=>g,g:()=>w});var J=U(13002),v=U(12760),f=U(13004);class g{get S(){return this._isDisposed}constructor(z,u,U){let v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,f=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7?arguments[7]:void 0,R=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,z&&z.Vz?this._engine=z.Vz().getEngine():this._engine=z,this._updatable=U,this._instanced=g,this._divisor=P||1,this._label=R,u instanceof J.e?(this._data=null,this._buffer=u):(this._data=u,this._buffer=null),this.byteStride=w?v:v*Float32Array.BYTES_PER_ELEMENT,f||this.create()}createVertexBuffer(z,u,U,J,v){let f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6?arguments[6]:void 0;const P=f?u:u*Float32Array.BYTES_PER_ELEMENT,R=J?f?J:J*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new w(this._engine,this,z,this._updatable,!0,R,void 0===v?this._instanced:v,P,U,void 0,void 0,!0,this._divisor||g)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!z&&this._buffer||(z=z||this._data,z&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,z),this._data=z):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(z,this._label),this._data=z):this._buffer=this._engine.createVertexBuffer(z,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.MU>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.MU,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.MU,void 0,this._label));v.d.Warn('Missing data for buffer "'.concat(this._label,'" ').concat(this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":"",". Buffer reconstruction failed.")),this._buffer=null}}update(z){this.create(z)}updateDirectly(z,u,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,z,J?u:u*Float32Array.BYTES_PER_ELEMENT,U?U*this.byteStride:void 0),this._data=0===u&&void 0===U?z:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class w{get S(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(z){const u=0!=z;this._instanceDivisor=z,u!==this._instanced&&(this._instanced=u,this._computeHashCode())}get _maxVerticesCount(){const z=this.getData();return z?Array.isArray(z)?z.length/(this.byteStride/4)-this.byteOffset/4:(z.byteLength-this.byteOffset)/this.byteStride:0}constructor(z,u,U,J,v,P,R,S,d,mz){let Z=arguments.length>10&&void 0!==arguments[10]&&arguments[10],A=arguments.length>11&&void 0!==arguments[11]&&arguments[11],E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,C=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let r=!1;var M,T,X,h,t;(this.Au=z,"object"===typeof J&&null!==J)?(r=null!==(M=J.updatable)&&void 0!==M&&M,v=J.postponeInternalCreation,P=J.stride,R=J.instanced,S=J.offset,d=J.size,mz=J.type,Z=null!==(T=J.normalized)&&void 0!==T&&T,A=null!==(X=J.useBytes)&&void 0!==X&&X,E=null!==(h=J.divisor)&&void 0!==h?h:1,C=null!==(t=J.takeBufferOwnership)&&void 0!==t&&t,this._label=J.label):r=!!J;if(u instanceof g?(this._buffer=u,this._ownsBuffer=C):(this._buffer=new g(z,u,r,P,v,R,A,E,this._label),this._ownsBuffer=!0),this.uniqueId=w._Counter++,this._kind=U,void 0===mz){const z=this.getData();this.type=z?w.GetDataType(z):w.FLOAT}else this.type=mz;const V=(0,f.l)(this.type);A?(this._size=d||(P?P/V:w.DeduceStride(U)),this.byteStride=P||this._buffer.byteStride||this._size*V,this.byteOffset=S||0):(this._size=d||P||w.DeduceStride(U),this.byteStride=P?P*V:this._buffer.byteStride||this._size*V,this.byteOffset=(S||0)*V),this.normalized=Z,this._instanced=void 0!==R&&R,this._instanceDivisor=R?E:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var z;null===(z=this._buffer)||void 0===z||z._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(z,u){const U=this.getData();return U?(0,f.k)(U,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,z,u):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,f.l)(this.type)}getOffset(){return this.byteOffset/(0,f.l)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,f.l)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(z){this._buffer.create(z),this._alignBuffer()}update(z){this._buffer.update(z),this._alignBuffer()}updateDirectly(z,u){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(z,u,void 0,U),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(z,u){(0,f.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,z,this.normalized,((z,U)=>{for(let J=0;J<this._size;J++)u(z[J],U+J)}))}_alignBuffer(){}static DeduceStride(z){switch(z){case w.UVKind:case w.UV2Kind:case w.UV3Kind:case w.UV4Kind:case w.UV5Kind:case w.UV6Kind:return 2;case w.NormalKind:case w.PositionKind:return 3;case w.ColorKind:case w.ColorInstanceKind:case w.MatricesIndicesKind:case w.MatricesIndicesExtraKind:case w.MatricesWeightsKind:case w.MatricesWeightsExtraKind:case w.TangentKind:return 4;default:throw new Error("Invalid kind '"+z+"'")}}static GetDataType(z){return z instanceof Int8Array?w.BYTE:z instanceof Uint8Array?w.UNSIGNED_BYTE:z instanceof Int16Array?w.SHORT:z instanceof Uint16Array?w.UNSIGNED_SHORT:z instanceof Int32Array?w.INT:z instanceof Uint32Array?w.UNSIGNED_INT:w.FLOAT}static GetTypeByteLength(z){return(0,f.l)(z)}static ForEach(z,u,U,J,v,g,w,P){(0,f.j)(z,u,U,J,v,g,w,((z,u)=>{for(let U=0;U<J;U++)P(z[U],u+U)}))}static GetFloatData(z,u,U,J,v,g,w,P){return(0,f.k)(z,u,U,J,v,g,w,P)}}w._Counter=0,w.BYTE=5120,w.UNSIGNED_BYTE=5121,w.SHORT=5122,w.UNSIGNED_SHORT=5123,w.INT=5124,w.UNSIGNED_INT=5125,w.FLOAT=5126,w.PositionKind="position",w.NormalKind="normal",w.TangentKind="tangent",w.UVKind="uv",w.UV2Kind="uv2",w.UV3Kind="uv3",w.UV4Kind="uv4",w.UV5Kind="uv5",w.UV6Kind="uv6",w.ColorKind="color",w.ColorInstanceKind="instanceColor",w.MatricesIndicesKind="matricesIndices",w.MatricesWeightsKind="matricesWeights",w.MatricesIndicesExtraKind="matricesIndicesExtra",w.MatricesWeightsExtraKind="matricesWeightsExtra"},13004:(z,u,U)=>{U.d(u,{b:()=>mz,f:()=>d,j:()=>P,k:()=>R,l:()=>g,p:()=>w,t:()=>S});var J=U(12760);function v(z,u,U,J){switch(u){case 5120:{let u=z.getInt8(U);return J&&(u=Math.max(u/127,-1)),u}case 5121:{let u=z.getUint8(U);return J&&(u/=255),u}case 5122:{let u=z.getInt16(U,!0);return J&&(u=Math.max(u/32767,-1)),u}case 5123:{let u=z.getUint16(U,!0);return J&&(u/=65535),u}case 5124:return z.getInt32(U,!0);case 5125:return z.getUint32(U,!0);case 5126:return z.getFloat32(U,!0);default:throw new Error("Invalid component type ".concat(u))}}function f(z,u,U,J,v){switch(u){case 5120:J&&(v=Math.round(127*v)),z.setInt8(U,v);break;case 5121:J&&(v=Math.round(255*v)),z.setUint8(U,v);break;case 5122:J&&(v=Math.round(32767*v)),z.setInt16(U,v,!0);break;case 5123:J&&(v=Math.round(65535*v)),z.setUint16(U,v,!0);break;case 5124:z.setInt32(U,v,!0);break;case 5125:z.setUint32(U,v,!0);break;case 5126:z.setFloat32(U,v,!0);break;default:throw new Error("Invalid component type ".concat(u))}}function g(z){switch(z){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error("Invalid type '".concat(z,"'"))}}function w(z){switch(z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error("Invalid component type '".concat(z,"'"))}}function P(z,u,U,J,w,P,R,S){const d=new Array(J),mz=new Array(J);if(z instanceof Array){let v=u/4;const f=U/4;for(let u=0;u<P;u+=J){for(let u=0;u<J;u++)d[u]=mz[u]=z[v+u];S(mz,u);for(let u=0;u<J;u++)d[u]!==mz[u]&&(z[v+u]=mz[u]);v+=f}}else{const Z=ArrayBuffer.isView(z)?new DataView(z.buffer,z.byteOffset,z.byteLength):new DataView(z),A=g(w);for(let z=0;z<P;z+=J){for(let z=0,U=u;z<J;z++,U+=A)d[z]=mz[z]=v(Z,w,U,R);S(mz,z);for(let z=0,U=u;z<J;z++,U+=A)d[z]!==mz[z]&&f(Z,w,U,R,mz[z]);u+=U}}}function R(z,u,U,v,f,w,R,S){const d=u*g(U),mz=R*u;if(5126!==U||f!==d){const J=new Float32Array(mz);return P(z,v,f,u,U,mz,w,((z,U)=>{for(let v=0;v<u;v++)J[U+v]=z[v]})),J}if(!(z instanceof Array||z instanceof Float32Array)||0!==v||z.length!==mz){if(z instanceof Array){const u=v/4;return z.slice(u,u+mz)}if(z instanceof ArrayBuffer)return new Float32Array(z,v,mz);{const u=z.byteOffset+v;return 0!==(3&u)&&(J.d.Warn("Float array must be aligned to 4-bytes border"),S=!0),S?new Float32Array(z.buffer.slice(u,u+mz*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(z.buffer,u,mz)}}return S?z.slice():z}function S(z,u,U,v,f,R,S,d){const mz=g(U),Z=w(U),A=S*u;if(Array.isArray(z)){if(0!==(3&v)||0!==(3&f))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const J=v/4,g=f/4;if(J+(S-1)*g+u>z.length)throw new Error("Last accessed index is out of bounds.");if(g<u)throw new Error("Data stride cannot be smaller than the component size.");if(g!==u){const J=new Z(A);return P(z,v,f,u,U,A,R,((z,U)=>{for(let v=0;v<u;v++)J[U+v]=z[v]})),J}return new Z(z.slice(J,J+A))}let E,C=v;z instanceof ArrayBuffer?E=z:(E=z.buffer,C+=z.byteOffset);if(C+(S-1)*f+u*mz>E.byteLength)throw new Error("Last accessed byte is out of bounds.");const r=u*mz;if(f<r)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(f!==r){const z=new Z(A);return P(E,C,f,u,U,A,R,((U,J)=>{for(let v=0;v<u;v++)z[J+v]=U[v]})),z}return 1!==mz&&0!==(C&mz-1)&&(J.d.Warn("Array must be aligned to border of element size. Data will be copied."),d=!0),d?new Z(E.slice(C,C+A*mz)):new Z(E,C,A)}function d(z,u,U,v,f,w,R,S){const d=u*g(U),mz=R*u;if(S.length!==mz)throw new Error("Output length is not valid");if(5126===U&&f===d)if(z instanceof Array){const u=v/4;S.set(z,u)}else if(z instanceof ArrayBuffer){const u=new Float32Array(z,v,mz);S.set(u)}else{const u=z.byteOffset+v;if(0!==(3&u))return J.d.Warn("Float array must be aligned to 4-bytes border"),void S.set(new Float32Array(z.buffer.slice(u,u+mz*Float32Array.BYTES_PER_ELEMENT)));const U=new Float32Array(z.buffer,u,mz);S.set(U)}else P(z,v,f,u,U,mz,w,((z,U)=>{for(let J=0;J<u;J++)S[U+J]=z[J]}))}function mz(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(z)){for(let v=0;v<u;v++)if(z[U+v]-J>65535)return!0;return!1}return 4===z.BYTES_PER_ELEMENT}},13002:(z,u,U)=>{U.d(u,{e:()=>J});class J{get underlyingResource(){return null}constructor(){this.references=0,this.MU=0,this.is32Bits=!1,this.uniqueId=J._Counter++}}J._Counter=0},13035:(z,u,U)=>{U.d(u,{d:()=>v});var J=U(12825);class v{static GetEffect(z){return void 0===z.getPipelineContext?z.effect:z}constructor(z){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=z.createDrawContext(),u&&(this.materialContext=z.createMaterialContext())}setEffect(z,u){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var J;(this.effect=z,void 0!==u&&(this.defines=u),U)&&(null===(J=this.drawContext)||void 0===J||J.reset())}dispose(){var z;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const z=this.effect;u?z.dispose():J.b.SetImmediate((()=>{z.getEngine().onEndFrameObservable.addOnce((()=>{z.dispose()}))})),this.effect=null}null===(z=this.drawContext)||void 0===z||z.dispose()}}},13128:(z,u,U)=>{U.d(u,{d:()=>v});var J=U(12976);class v{static GetPlanes(z){const u=[];for(let U=0;U<6;U++)u.push(new J.d(0,0,0,0));return v.GetPlanesToRef(z,u),u}static GetNearPlaneToRef(z,u){const U=z.m;u.normal.x=U[3]+U[2],u.normal.y=U[7]+U[6],u.normal.z=U[11]+U[10],u.d=U[15]+U[14],u.normalize()}static GetFarPlaneToRef(z,u){const U=z.m;u.normal.x=U[3]-U[2],u.normal.y=U[7]-U[6],u.normal.z=U[11]-U[10],u.d=U[15]-U[14],u.normalize()}static GetLeftPlaneToRef(z,u){const U=z.m;u.normal.x=U[3]+U[0],u.normal.y=U[7]+U[4],u.normal.z=U[11]+U[8],u.d=U[15]+U[12],u.normalize()}static GetRightPlaneToRef(z,u){const U=z.m;u.normal.x=U[3]-U[0],u.normal.y=U[7]-U[4],u.normal.z=U[11]-U[8],u.d=U[15]-U[12],u.normalize()}static GetTopPlaneToRef(z,u){const U=z.m;u.normal.x=U[3]-U[1],u.normal.y=U[7]-U[5],u.normal.z=U[11]-U[9],u.d=U[15]-U[13],u.normalize()}static GetBottomPlaneToRef(z,u){const U=z.m;u.normal.x=U[3]+U[1],u.normal.y=U[7]+U[5],u.normal.z=U[11]+U[9],u.d=U[15]+U[13],u.normalize()}static GetPlanesToRef(z,u){v.GetNearPlaneToRef(z,u[0]),v.GetFarPlaneToRef(z,u[1]),v.GetLeftPlaneToRef(z,u[2]),v.GetRightPlaneToRef(z,u[3]),v.GetTopPlaneToRef(z,u[4]),v.GetBottomPlaneToRef(z,u[5])}static IsPointInFrustum(z,u){for(let U=0;U<6;U++)if(u[U].dotCoordinate(z)<0)return!1;return!0}}},13141:(z,u,U)=>{U.d(u,{e:()=>v});var J=U(12777);class v{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(z,u){v.Enabled&&(this._current+=z,u&&this._fetchResult())}beginMonitoring(){v.Enabled&&(this._startMonitoringTime=J.e.Now)}endMonitoring(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!v.Enabled)return;z&&this.fetchNewFrame();const u=J.e.Now;this._current=u-this._startMonitoringTime,z&&this._fetchResult()}Tf(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const z=J.e.Now;z-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=z,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}v.Enabled=!0},13014:(z,u,U)=>{U.d(u,{c:()=>v,f:()=>J});class J{constructor(z){this.length=0,this.data=new Array(z),this._id=J._GlobalId++}push(z){this.data[this.length++]=z,this.length>this.data.length&&(this.data.length*=2)}forEach(z){for(let u=0;u<this.length;u++)z(this.data[u])}sort(z){this.data.sort(z)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(z){if(0!==z.length){this.length+z.length>this.data.length&&(this.data.length=2*(this.length+z.length));for(let u=0;u<z.length;u++)this.data[this.length++]=(z.data||z)[u]}}indexOf(z){const u=this.data.indexOf(z);return u>=this.length?-1:u}contains(z){return-1!==this.indexOf(z)}}J._GlobalId=0;class v extends J{constructor(){super(...arguments),this._duplicateId=0}push(z){super.push(z),z.__smartArrayFlags||(z.__smartArrayFlags={}),z.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(z){return(!z.__smartArrayFlags||z.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(z),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(z){if(0!==z.length){this.length+z.length>this.data.length&&(this.data.length=2*(this.length+z.length));for(let u=0;u<z.length;u++){const U=(z.data||z)[u];this.pushNoDuplicate(U)}}}}},12994:(z,u,U)=>{U.d(u,{c:()=>f});var J=U(13e3),v=U(12756);class f{constructor(z){this._vertexBuffers={},this.onBeforeRenderObservable=new v.e,this._scene=z}_prepareBuffers(){if(this._vertexBuffers[J.g.PositionKind])return;const z=[];z.push(1,1),z.push(-1,1),z.push(-1,-1),z.push(1,-1),this._vertexBuffers[J.g.PositionKind]=new J.g(this._scene.getEngine(),z,J.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const z=[];z.push(0),z.push(1),z.push(2),z.push(0),z.push(2),z.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(z)}_rebuild(){const z=this._vertexBuffers[J.g.PositionKind];z&&(z._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=this._scene.activeCamera;return!!U&&(u=u||U._postProcesses.filter((z=>null!=z)),!(!u||0===u.length||!this._scene.postProcessesEnabled)&&(u[0].activate(U,z,null!==u&&void 0!==u),!0))}directRender(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,v=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z.length;const w=this._scene.getEngine();for(let R=0;R<g;R++){var P;if(R<z.length-1)z[R+1].activate(this._scene.activeCamera||this._scene,null===u||void 0===u?void 0:u.texture);else u?w.bindFramebuffer(u,J,void 0,void 0,U,v):f||w.restoreDefaultFramebuffer(),null===(P=w._debugInsertMarker)||void 0===P||P.call(w,"post process ".concat(z[R].name," output"));const g=z[R],S=g.apply();S&&(g.onBeforeRenderObservable.notifyObservers(S),this._prepareBuffers(),w.bindBuffers(this._vertexBuffers,this._indexBuffer,S),w.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(S))}w.setDepthBuffer(!0),w.setDepthWrite(!0)}_finalizeFrame(z,u,U,J){let v=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const f=this._scene.activeCamera;if(!f)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(J=J||f._postProcesses.filter((z=>null!=z))).length||!this._scene.postProcessesEnabled)return;const g=this._scene.getEngine();for(let P=0,R=J.length;P<R;P++){const S=J[P];var w;if(P<R-1)S._outputTexture=J[P+1].activate(f,null===u||void 0===u?void 0:u.texture);else u?(g.bindFramebuffer(u,U,void 0,void 0,v),S._outputTexture=u):(g.restoreDefaultFramebuffer(),S._outputTexture=null),null===(w=g._debugInsertMarker)||void 0===w||w.call(g,"post process ".concat(J[P].name," output"));if(z)break;const d=S.apply();d&&(S.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),g.bindBuffers(this._vertexBuffers,this._indexBuffer,d),g.drawElementsType(0,0,6),S.onAfterRenderObservable.notifyObservers(d))}g.setDepthBuffer(!0),g.setDepthWrite(!0),g.setAlphaMode(0)}dispose(){const z=this._vertexBuffers[J.g.PositionKind];z&&(z.dispose(),this._vertexBuffers[J.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},13008:(z,u,U)=>{U.d(u,{d:()=>w});var J=U(13014),v=U(12914);class f{set opaqueSortCompareFn(z){this._opaqueSortCompareFn=z||f.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(z){this._alphaTestSortCompareFn=z||f.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(z){this._transparentSortCompareFn=z||f.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(z,u){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=z,this._opaqueSubMeshes=new J.f(256),this._transparentSubMeshes=new J.f(256),this._alphaTestSubMeshes=new J.f(256),this._depthOnlySubMeshes=new J.f(256),this._particleSystems=new J.f(256),this._spriteManagers=new J.f(256),this._empty=!0,this._edgesRenderers=new J.c(16),this._scene=u,this.opaqueSortCompareFn=U,this.alphaTestSortCompareFn=v,this.transparentSortCompareFn=f}render(z,u,U,J){if(z)return void z(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const v=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(v.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),v.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const f=v.getStencilBuffer();if(v.setStencilBuffer(!1),u&&this._renderSprites(),U&&this._renderParticles(J),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(v.setStencilBuffer(f),this._scene.useOrderIndependentTransparency){const z=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);z.length&&this._renderTransparent(z)}else this._renderTransparent(this._transparentSubMeshes);v.setAlphaMode(0)}if(v.setStencilBuffer(!1),this._edgesRenderers.length){for(let z=0;z<this._edgesRenderers.length;z++)this._edgesRenderers.data[z].render();v.setAlphaMode(0)}v.setStencilBuffer(f)}_renderOpaqueSorted(z){f._RenderSorted(z,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(z){f._RenderSorted(z,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(z){f._RenderSorted(z,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(z,u,U,J){let g,w=0;const P=U?U.globalPosition:f._ZeroVector;if(J)for(;w<z.length;w++)g=z.data[w],g._alphaIndex=g.getMesh().alphaIndex,g._distanceToCamera=v.Eu.Distance(g.getBoundingInfo().boundingSphere.centerWorld,P);const R=z.length===z.data.length?z.data:z.data.slice(0,z.length);u&&R.sort(u);const S=R[0].getMesh().Vz();for(w=0;w<R.length;w++)if(g=R[w],!S._activeMeshesFrozenButKeepClipping||g.isInFrustum(S._frustumPlanes)){if(J){const z=g.jz();if(z&&z.needDepthPrePass){const u=z.Vz().getEngine();u.setColorWrite(!1),u.setAlphaMode(0),g.render(!1),u.setColorWrite(!0)}}g.render(J)}}static defaultTransparentSortCompare(z,u){return z._alphaIndex>u._alphaIndex?1:z._alphaIndex<u._alphaIndex?-1:f.backToFrontSortCompare(z,u)}static backToFrontSortCompare(z,u){return z._distanceToCamera<u._distanceToCamera?1:z._distanceToCamera>u._distanceToCamera?-1:0}static frontToBackSortCompare(z,u){return z._distanceToCamera<u._distanceToCamera?-1:z._distanceToCamera>u._distanceToCamera?1:0}static PainterSortCompare(z,u){const U=z.getMesh(),J=u.getMesh();return U.material&&J.material?U.material.uniqueId-J.material.uniqueId:U.uniqueId-J.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(z,u,U){void 0===u&&(u=z.getMesh()),void 0===U&&(U=z.jz()),null!==U&&void 0!==U&&(U.needAlphaBlendingForMesh(u)?this._transparentSubMeshes.push(z):U.needAlphaTestingForMesh(u)?(U.needDepthPrePass&&this._depthOnlySubMeshes.push(z),this._alphaTestSubMeshes.push(z)):(U.needDepthPrePass&&this._depthOnlySubMeshes.push(z),this._opaqueSubMeshes.push(z)),u._renderingGroup=this,u._edgesRenderer&&u.isEnabled()&&u.isVisible&&u._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(u._edgesRenderer),this._empty=!1)}dispatchSprites(z){this._spriteManagers.push(z),this._empty=!1}dispatchParticles(z){this._particleSystems.push(z),this._empty=!1}_renderParticles(z){if(0===this._particleSystems.length)return;const u=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let U=0;U<this._particleSystems.length;U++){const J=this._particleSystems.data[U];if(0===(u&&u.layerMask&J.layerMask))continue;const v=J.vu;v.position&&z&&-1===z.indexOf(v)||this._scene._activeParticles.addCount(J.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const z=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let u=0;u<this._spriteManagers.length;u++){const U=this._spriteManagers.data[u];0!==(z&&z.layerMask&U.layerMask)&&U.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}f._ZeroVector=v.Eu.Zero();class g{}class w{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(z){z!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=z,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const z of this._scene.meshes)if(z.cf)for(const u of z.cf)u._wasDispatched=!1;if(this._scene.spriteManagers)for(const z of this._scene.spriteManagers)z._wasDispatched=!1;for(const z of this._scene.mA)z._wasDispatched=!1}constructor(z){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new g,this._maintainStateBetweenFrames=!1,this._scene=z;for(let u=w.MIN_RENDERINGGROUPS;u<w.MAX_RENDERINGGROUPS;u++)this._autoClearDepthStencil[u]={Df:!0,depth:!0,tf:!0}}getRenderingGroup(z){const u=z||0;return this._prepareRenderingGroup(u),this._renderingGroups[u]}_clearDepthStencilBuffer(){let z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,z,u),this._depthStencilBufferAlreadyCleaned=!0)}render(z,u,U,J){const v=this._renderingGroupInfo;if(v.ru=this._scene,v.camera=this._scene.activeCamera,v.renderingManager=this,this._scene.spriteManagers&&J)for(let f=0;f<this._scene.spriteManagers.length;f++){const z=this._scene.spriteManagers[f];this.dispatchSprites(z)}for(let f=w.MIN_RENDERINGGROUPS;f<w.MAX_RENDERINGGROUPS;f++){this._depthStencilBufferAlreadyCleaned=f===w.MIN_RENDERINGGROUPS;const g=this._renderingGroups[f];if(!g||g._empty)continue;const P=1<<f;if(v.renderingGroupId=f,this._scene.onBeforeRenderingGroupObservable.notifyObservers(v,P),w.AUTOCLEAR){const z=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(f):this._autoClearDepthStencil[f];z&&z.Df&&this._clearDepthStencilBuffer(z.depth,z.tf)}for(const z of this._scene._beforeRenderingGroupDrawStage)z.action(f);g.render(z,J,U,u);for(const z of this._scene._afterRenderingGroupDrawStage)z.action(f);this._scene.onAfterRenderingGroupObservable.notifyObservers(v,P)}}reset(){if(!this.maintainStateBetweenFrames)for(let z=w.MIN_RENDERINGGROUPS;z<w.MAX_RENDERINGGROUPS;z++){const u=this._renderingGroups[z];u&&u.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let z=w.MIN_RENDERINGGROUPS;z<w.MAX_RENDERINGGROUPS;z++){const u=this._renderingGroups[z];u&&u.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let z=w.MIN_RENDERINGGROUPS;z<w.MAX_RENDERINGGROUPS;z++){const u=this._renderingGroups[z];u&&u.dispose()}}_prepareRenderingGroup(z){void 0===this._renderingGroups[z]&&(this._renderingGroups[z]=new f(z,this._scene,this._customOpaqueSortCompareFn[z],this._customAlphaTestSortCompareFn[z],this._customTransparentSortCompareFn[z]))}dispatchSprites(z){this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(z.renderingGroupId).dispatchSprites(z))}dispatchParticles(z){this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(z.renderingGroupId).dispatchParticles(z))}dispatch(z,u,U){void 0===u&&(u=z.getMesh()),this.maintainStateBetweenFrames&&z._wasDispatched||(z._wasDispatched=!0,this.getRenderingGroup(u.renderingGroupId).dispatch(z,u,U))}setRenderingOrder(z){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[z]=u,this._customAlphaTestSortCompareFn[z]=U,this._customTransparentSortCompareFn[z]=J,this._renderingGroups[z]){const u=this._renderingGroups[z];u.opaqueSortCompareFn=this._customOpaqueSortCompareFn[z],u.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[z],u.transparentSortCompareFn=this._customTransparentSortCompareFn[z]}}setRenderingAutoClearDepthStencil(z,u){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[z]={Df:u,depth:U,tf:J}}getAutoClearDepthStencilSetup(z){return this._autoClearDepthStencil[z]}}w.MAX_RENDERINGGROUPS=4,w.MIN_RENDERINGGROUPS=0,w.AUTOCLEAR=!0}}]);