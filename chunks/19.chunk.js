"use strict";(self.u4k1rqylno=self.u4k1rqylno||[]).push([[19],{11818:(e,E,H)=>{H.d(E,{c:()=>P,g:()=>M});var N=H(11822),u=H(11548),z=H(11824);class P{get A(){return this._isDisposed}constructor(e,E,H){let u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],P=arguments.length>5&&void 0!==arguments[5]&&arguments[5],M=arguments.length>6&&void 0!==arguments[6]&&arguments[6],D=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,e&&e.fe?this._engine=e.fe().getEngine():this._engine=e,this._updatable=H,this._instanced=P,this._divisor=D||1,this._label=A,E instanceof N.b?(this._data=null,this._buffer=E):(this._data=E,this._buffer=null),this.byteStride=M?u:u*Float32Array.BYTES_PER_ELEMENT,z||this.create()}createVertexBuffer(e,E,H,N,u){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6?arguments[6]:void 0;const D=z?E:E*Float32Array.BYTES_PER_ELEMENT,A=N?z?N:N*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new M(this._engine,this,e,this._updatable,!0,A,void 0===u?this._instanced:u,D,H,void 0,void 0,!0,this._divisor||P)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!e&&this._buffer||(e=e||this._data,e&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e),this._data=e):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(e,this._label),this._data=e):this._buffer=this._engine.createVertexBuffer(e,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.fM>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.fM,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.fM,void 0,this._label));u.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(e){this.create(e)}updateDirectly(e,E,H){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,e,N?E:E*Float32Array.BYTES_PER_ELEMENT,H?H*this.byteStride:void 0),this._data=0===E&&void 0===H?e:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class M{get A(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(e){const E=0!=e;this._instanceDivisor=e,E!==this._instanced&&(this._instanced=E,this._computeHashCode())}get _maxVerticesCount(){const e=this.getData();return e?Array.isArray(e)?e.length/(this.byteStride/4)-this.byteOffset/4:(e.byteLength-this.byteOffset)/this.byteStride:0}constructor(e,E,H,N,u,D,A,C,i,V){let U=arguments.length>10&&void 0!==arguments[10]&&arguments[10],j=arguments.length>11&&void 0!==arguments[11]&&arguments[11],F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,h=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let S=!1;if(this.UE=e,"object"===typeof N&&null!==N?(S=N.updatable??!1,u=N.postponeInternalCreation,D=N.stride,A=N.instanced,C=N.offset,i=N.size,V=N.type,U=N.normalized??!1,j=N.useBytes??!1,F=N.divisor??1,h=N.takeBufferOwnership??!1,this._label=N.label):S=!!N,E instanceof P?(this._buffer=E,this._ownsBuffer=h):(this._buffer=new P(e,E,S,D,u,A,j,F,this._label),this._ownsBuffer=!0),this.uniqueId=M._Counter++,this._kind=H,void 0===V){const e=this.getData();this.type=e?M.GetDataType(e):M.FLOAT}else this.type=V;const X=(0,z.m)(this.type);j?(this._size=i||(D?D/X:M.DeduceStride(H)),this.byteStride=D||this._buffer.byteStride||this._size*X,this.byteOffset=C||0):(this._size=i||D||M.DeduceStride(H),this.byteStride=D?D*X:this._buffer.byteStride||this._size*X,this.byteOffset=(C||0)*X),this.normalized=U,this._instanced=void 0!==A&&A,this._instanceDivisor=A?F:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var e;null===(e=this._buffer)||void 0===e||e._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(e,E){const H=this.getData();return H?(0,z.j)(H,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,e,E):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,z.m)(this.type)}getOffset(){return this.byteOffset/(0,z.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,z.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(e){this._buffer.create(e),this._alignBuffer()}update(e){this._buffer.update(e),this._alignBuffer()}updateDirectly(e,E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(e,E,void 0,H),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(e,E){(0,z.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,e,this.normalized,((e,H)=>{for(let N=0;N<this._size;N++)E(e[N],H+N)}))}_alignBuffer(){}static DeduceStride(e){switch(e){case M.UVKind:case M.UV2Kind:case M.UV3Kind:case M.UV4Kind:case M.UV5Kind:case M.UV6Kind:return 2;case M.NormalKind:case M.PositionKind:return 3;case M.ColorKind:case M.ColorInstanceKind:case M.MatricesIndicesKind:case M.MatricesIndicesExtraKind:case M.MatricesWeightsKind:case M.MatricesWeightsExtraKind:case M.TangentKind:return 4;default:throw new Error("Invalid kind '"+e+"'")}}static GetDataType(e){return e instanceof Int8Array?M.BYTE:e instanceof Uint8Array?M.UNSIGNED_BYTE:e instanceof Int16Array?M.SHORT:e instanceof Uint16Array?M.UNSIGNED_SHORT:e instanceof Int32Array?M.INT:e instanceof Uint32Array?M.UNSIGNED_INT:M.FLOAT}static GetTypeByteLength(e){return(0,z.m)(e)}static ForEach(e,E,H,N,u,P,M,D){(0,z.i)(e,E,H,N,u,P,M,((e,E)=>{for(let H=0;H<N;H++)D(e[H],E+H)}))}static GetFloatData(e,E,H,N,u,P,M,D){return(0,z.j)(e,E,H,N,u,P,M,D)}}M._Counter=0,M.BYTE=5120,M.UNSIGNED_BYTE=5121,M.SHORT=5122,M.UNSIGNED_SHORT=5123,M.INT=5124,M.UNSIGNED_INT=5125,M.FLOAT=5126,M.PositionKind="position",M.NormalKind="normal",M.TangentKind="tangent",M.UVKind="uv",M.UV2Kind="uv2",M.UV3Kind="uv3",M.UV4Kind="uv4",M.UV5Kind="uv5",M.UV6Kind="uv6",M.ColorKind="color",M.ColorInstanceKind="instanceColor",M.MatricesIndicesKind="matricesIndices",M.MatricesWeightsKind="matricesWeights",M.MatricesIndicesExtraKind="matricesIndicesExtra",M.MatricesWeightsExtraKind="matricesWeightsExtra"},11824:(e,E,H)=>{H.d(E,{d:()=>V,e:()=>i,i:()=>D,j:()=>A,m:()=>P,o:()=>M,s:()=>C});var N=H(11548);function u(e,E,H,N){switch(E){case 5120:{let E=e.getInt8(H);return N&&(E=Math.max(E/127,-1)),E}case 5121:{let E=e.getUint8(H);return N&&(E/=255),E}case 5122:{let E=e.getInt16(H,!0);return N&&(E=Math.max(E/32767,-1)),E}case 5123:{let E=e.getUint16(H,!0);return N&&(E/=65535),E}case 5124:return e.getInt32(H,!0);case 5125:return e.getUint32(H,!0);case 5126:return e.getFloat32(H,!0);default:throw new Error(`Invalid component type ${E}`)}}function z(e,E,H,N,u){switch(E){case 5120:N&&(u=Math.round(127*u)),e.setInt8(H,u);break;case 5121:N&&(u=Math.round(255*u)),e.setUint8(H,u);break;case 5122:N&&(u=Math.round(32767*u)),e.setInt16(H,u,!0);break;case 5123:N&&(u=Math.round(65535*u)),e.setUint16(H,u,!0);break;case 5124:e.setInt32(H,u,!0);break;case 5125:e.setUint32(H,u,!0);break;case 5126:e.setFloat32(H,u,!0);break;default:throw new Error(`Invalid component type ${E}`)}}function P(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${e}'`)}}function M(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${e}'`)}}function D(e,E,H,N,M,D,A,C){const i=new Array(N),V=new Array(N);if(e instanceof Array){let u=E/4;const z=H/4;for(let E=0;E<D;E+=N){for(let E=0;E<N;E++)i[E]=V[E]=e[u+E];C(V,E);for(let E=0;E<N;E++)i[E]!==V[E]&&(e[u+E]=V[E]);u+=z}}else{const U=ArrayBuffer.isView(e)?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(e),j=P(M);for(let e=0;e<D;e+=N){for(let e=0,H=E;e<N;e++,H+=j)i[e]=V[e]=u(U,M,H,A);C(V,e);for(let e=0,H=E;e<N;e++,H+=j)i[e]!==V[e]&&z(U,M,H,A,V[e]);E+=H}}}function A(e,E,H,u,z,M,A,C){const i=E*P(H),V=A*E;if(5126!==H||z!==i){const N=new Float32Array(V);return D(e,u,z,E,H,V,M,((e,H)=>{for(let u=0;u<E;u++)N[H+u]=e[u]})),N}if(!(e instanceof Array||e instanceof Float32Array)||0!==u||e.length!==V){if(e instanceof Array){const E=u/4;return e.slice(E,E+V)}if(e instanceof ArrayBuffer)return new Float32Array(e,u,V);{const E=e.byteOffset+u;return 0!==(3&E)&&(N.d.Warn("Float array must be aligned to 4-bytes border"),C=!0),C?new Float32Array(e.buffer.slice(E,E+V*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(e.buffer,E,V)}}return C?e.slice():e}function C(e,E,H,u,z,A,C,i){const V=P(H),U=M(H),j=C*E;if(Array.isArray(e)){if(0!==(3&u)||0!==(3&z))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const N=u/4,P=z/4;if(N+(C-1)*P+E>e.length)throw new Error("Last accessed index is out of bounds.");if(P<E)throw new Error("Data stride cannot be smaller than the component size.");if(P!==E){const N=new U(j);return D(e,u,z,E,H,j,A,((e,H)=>{for(let u=0;u<E;u++)N[H+u]=e[u]})),N}return new U(e.slice(N,N+j))}let F,h=u;e instanceof ArrayBuffer?F=e:(F=e.buffer,h+=e.byteOffset);if(h+(C-1)*z+E*V>F.byteLength)throw new Error("Last accessed byte is out of bounds.");const S=E*V;if(z<S)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(z!==S){const e=new U(j);return D(F,h,z,E,H,j,A,((H,N)=>{for(let u=0;u<E;u++)e[N+u]=H[u]})),e}return 1!==V&&0!==(h&V-1)&&(N.d.Warn("Array must be aligned to border of element size. Data will be copied."),i=!0),i?new U(F.slice(h,h+j*V)):new U(F,h,j)}function i(e,E,H,u,z,M,A,C){const i=E*P(H),V=A*E;if(C.length!==V)throw new Error("Output length is not valid");if(5126===H&&z===i)if(e instanceof Array){const E=u/4;C.set(e,E)}else if(e instanceof ArrayBuffer){const E=new Float32Array(e,u,V);C.set(E)}else{const E=e.byteOffset+u;if(0!==(3&E))return N.d.Warn("Float array must be aligned to 4-bytes border"),void C.set(new Float32Array(e.buffer.slice(E,E+V*Float32Array.BYTES_PER_ELEMENT)));const H=new Float32Array(e.buffer,E,V);C.set(H)}else D(e,u,z,E,H,V,M,((e,H)=>{for(let N=0;N<E;N++)C[H+N]=e[N]}))}function V(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(e)){for(let u=0;u<E;u++)if(e[H+u]-N>65535)return!0;return!1}return 4===e.BYTES_PER_ELEMENT}},11822:(e,E,H)=>{H.d(E,{b:()=>N});class N{get underlyingResource(){return null}constructor(){this.references=0,this.fM=0,this.is32Bits=!1,this.uniqueId=N._Counter++}}N._Counter=0},11851:(e,E,H)=>{H.d(E,{d:()=>u});var N=H(11611);class u{static GetEffect(e){return void 0===e.getPipelineContext?e.effect:e}constructor(e){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=e.createDrawContext(),E&&(this.materialContext=e.createMaterialContext())}setEffect(e,E){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var N;(this.effect=e,void 0!==E&&(this.defines=E),H)&&(null===(N=this.drawContext)||void 0===N||N.reset())}dispose(){var e;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const e=this.effect;E?e.dispose():N.e.SetImmediate((()=>{e.getEngine().onEndFrameObservable.addOnce((()=>{e.dispose()}))})),this.effect=null}null===(e=this.drawContext)||void 0===e||e.dispose()}}},11937:(e,E,H)=>{H.d(E,{d:()=>u});var N=H(11796);class u{static GetPlanes(e){const E=[];for(let H=0;H<6;H++)E.push(new N.b(0,0,0,0));return u.GetPlanesToRef(e,E),E}static GetNearPlaneToRef(e,E){const H=e.m;E.normal.x=H[3]+H[2],E.normal.y=H[7]+H[6],E.normal.z=H[11]+H[10],E.d=H[15]+H[14],E.normalize()}static GetFarPlaneToRef(e,E){const H=e.m;E.normal.x=H[3]-H[2],E.normal.y=H[7]-H[6],E.normal.z=H[11]-H[10],E.d=H[15]-H[14],E.normalize()}static GetLeftPlaneToRef(e,E){const H=e.m;E.normal.x=H[3]+H[0],E.normal.y=H[7]+H[4],E.normal.z=H[11]+H[8],E.d=H[15]+H[12],E.normalize()}static GetRightPlaneToRef(e,E){const H=e.m;E.normal.x=H[3]-H[0],E.normal.y=H[7]-H[4],E.normal.z=H[11]-H[8],E.d=H[15]-H[12],E.normalize()}static GetTopPlaneToRef(e,E){const H=e.m;E.normal.x=H[3]-H[1],E.normal.y=H[7]-H[5],E.normal.z=H[11]-H[9],E.d=H[15]-H[13],E.normalize()}static GetBottomPlaneToRef(e,E){const H=e.m;E.normal.x=H[3]+H[1],E.normal.y=H[7]+H[5],E.normal.z=H[11]+H[9],E.d=H[15]+H[13],E.normalize()}static GetPlanesToRef(e,E){u.GetNearPlaneToRef(e,E[0]),u.GetFarPlaneToRef(e,E[1]),u.GetLeftPlaneToRef(e,E[2]),u.GetRightPlaneToRef(e,E[3]),u.GetTopPlaneToRef(e,E[4]),u.GetBottomPlaneToRef(e,E[5])}static IsPointInFrustum(e,E){for(let H=0;H<6;H++)if(E[H].dotCoordinate(e)<0)return!1;return!0}}},11944:(e,E,H)=>{H.d(E,{b:()=>u});var N=H(11559);class u{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(e,E){u.Enabled&&(this._current+=e,E&&this._fetchResult())}beginMonitoring(){u.Enabled&&(this._startMonitoringTime=N.d.Now)}endMonitoring(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!u.Enabled)return;e&&this.fetchNewFrame();const E=N.d.Now;this._current=E-this._startMonitoringTime,e&&this._fetchResult()}qP(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const e=N.d.Now;e-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=e,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}u.Enabled=!0},11831:(e,E,H)=>{H.d(E,{c:()=>u,f:()=>N});class N{constructor(e){this.length=0,this.data=new Array(e),this._id=N._GlobalId++}push(e){this.data[this.length++]=e,this.length>this.data.length&&(this.data.length*=2)}forEach(e){for(let E=0;E<this.length;E++)e(this.data[E])}sort(e){this.data.sort(e)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let E=0;E<e.length;E++)this.data[this.length++]=(e.data||e)[E]}}indexOf(e){const E=this.data.indexOf(e);return E>=this.length?-1:E}contains(e){return-1!==this.indexOf(e)}}N._GlobalId=0;class u extends N{constructor(){super(...arguments),this._duplicateId=0}push(e){super.push(e),e.__smartArrayFlags||(e.__smartArrayFlags={}),e.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(e){return(!e.__smartArrayFlags||e.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(e),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(e){if(0!==e.length){this.length+e.length>this.data.length&&(this.data.length=2*(this.length+e.length));for(let E=0;E<e.length;E++){const H=(e.data||e)[E];this.pushNoDuplicate(H)}}}}},11810:(e,E,H)=>{H.d(E,{d:()=>z});var N=H(11818),u=H(11541);class z{constructor(e){this._vertexBuffers={},this.onBeforeRenderObservable=new u.d,this._scene=e}_prepareBuffers(){if(this._vertexBuffers[N.g.PositionKind])return;const e=[];e.push(1,1),e.push(-1,1),e.push(-1,-1),e.push(1,-1),this._vertexBuffers[N.g.PositionKind]=new N.g(this._scene.getEngine(),e,N.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const e=[];e.push(0),e.push(1),e.push(2),e.push(0),e.push(2),e.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(e)}_rebuild(){const e=this._vertexBuffers[N.g.PositionKind];e&&(e._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const H=this._scene.activeCamera;return!!H&&(E=E||H._postProcesses.filter((e=>null!=e)),!(!E||0===E.length||!this._scene.postProcessesEnabled)&&(E[0].activate(H,e,null!==E&&void 0!==E),!0))}directRender(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],P=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.length;const M=this._scene.getEngine();for(let A=0;A<P;A++){var D;if(A<e.length-1)e[A+1].activate(this._scene.activeCamera||this._scene,null===E||void 0===E?void 0:E.texture);else E?M.bindFramebuffer(E,N,void 0,void 0,H,u):z||M.restoreDefaultFramebuffer(),null===(D=M._debugInsertMarker)||void 0===D||D.call(M,`post process ${e[A].name} output`);const P=e[A],C=P.apply();C&&(P.onBeforeRenderObservable.notifyObservers(C),this._prepareBuffers(),M.bindBuffers(this._vertexBuffers,this._indexBuffer,C),M.drawElementsType(0,0,6),P.onAfterRenderObservable.notifyObservers(C))}M.setDepthBuffer(!0),M.setDepthWrite(!0)}_finalizeFrame(e,E,H,N){let u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const z=this._scene.activeCamera;if(!z)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(N=N||z._postProcesses.filter((e=>null!=e))).length||!this._scene.postProcessesEnabled)return;const P=this._scene.getEngine();for(let D=0,A=N.length;D<A;D++){const C=N[D];var M;if(D<A-1)C._outputTexture=N[D+1].activate(z,null===E||void 0===E?void 0:E.texture);else E?(P.bindFramebuffer(E,H,void 0,void 0,u),C._outputTexture=E):(P.restoreDefaultFramebuffer(),C._outputTexture=null),null===(M=P._debugInsertMarker)||void 0===M||M.call(P,`post process ${N[D].name} output`);if(e)break;const i=C.apply();i&&(C.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),P.bindBuffers(this._vertexBuffers,this._indexBuffer,i),P.drawElementsType(0,0,6),C.onAfterRenderObservable.notifyObservers(i))}P.setDepthBuffer(!0),P.setDepthWrite(!0),P.setAlphaMode(0)}dispose(){const e=this._vertexBuffers[N.g.PositionKind];e&&(e.dispose(),this._vertexBuffers[N.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11828:(e,E,H)=>{H.d(E,{c:()=>M});var N=H(11831),u=H(11738);class z{set opaqueSortCompareFn(e){this._opaqueSortCompareFn=e||z.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(e){this._alphaTestSortCompareFn=e||z.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(e){this._transparentSortCompareFn=e||z.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(e,E){let H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=e,this._opaqueSubMeshes=new N.f(256),this._transparentSubMeshes=new N.f(256),this._alphaTestSubMeshes=new N.f(256),this._depthOnlySubMeshes=new N.f(256),this._particleSystems=new N.f(256),this._spriteManagers=new N.f(256),this._empty=!0,this._edgesRenderers=new N.c(16),this._scene=E,this.opaqueSortCompareFn=H,this.alphaTestSortCompareFn=u,this.transparentSortCompareFn=z}render(e,E,H,N){if(e)return void e(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const u=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(u.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),u.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const z=u.getStencilBuffer();if(u.setStencilBuffer(!1),E&&this._renderSprites(),H&&this._renderParticles(N),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(u.setStencilBuffer(z),this._scene.useOrderIndependentTransparency){const e=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);e.length&&this._renderTransparent(e)}else this._renderTransparent(this._transparentSubMeshes);u.setAlphaMode(0)}if(u.setStencilBuffer(!1),this._edgesRenderers.length){for(let e=0;e<this._edgesRenderers.length;e++)this._edgesRenderers.data[e].render();u.setAlphaMode(0)}u.setStencilBuffer(z)}_renderOpaqueSorted(e){z._RenderSorted(e,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(e){z._RenderSorted(e,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(e){z._RenderSorted(e,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(e,E,H,N){let P,M=0;const D=H?H.globalPosition:z._ZeroVector;if(N)for(;M<e.length;M++)P=e.data[M],P._alphaIndex=P.getMesh().alphaIndex,P._distanceToCamera=u.jE.Distance(P.getBoundingInfo().boundingSphere.centerWorld,D);const A=e.length===e.data.length?e.data:e.data.slice(0,e.length);E&&A.sort(E);const C=A[0].getMesh().fe();for(M=0;M<A.length;M++)if(P=A[M],!C._activeMeshesFrozenButKeepClipping||P.isInFrustum(C._frustumPlanes)){if(N){const e=P.Te();if(e&&e.needDepthPrePass){const E=e.fe().getEngine();E.setColorWrite(!1),E.setAlphaMode(0),P.render(!1),E.setColorWrite(!0)}}P.render(N)}}static defaultTransparentSortCompare(e,E){return e._alphaIndex>E._alphaIndex?1:e._alphaIndex<E._alphaIndex?-1:z.backToFrontSortCompare(e,E)}static backToFrontSortCompare(e,E){return e._distanceToCamera<E._distanceToCamera?1:e._distanceToCamera>E._distanceToCamera?-1:0}static frontToBackSortCompare(e,E){return e._distanceToCamera<E._distanceToCamera?-1:e._distanceToCamera>E._distanceToCamera?1:0}static PainterSortCompare(e,E){const H=e.getMesh(),N=E.getMesh();return H.material&&N.material?H.material.uniqueId-N.material.uniqueId:H.uniqueId-N.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(e,E,H){void 0===E&&(E=e.getMesh()),void 0===H&&(H=e.Te()),null!==H&&void 0!==H&&(H.needAlphaBlendingForMesh(E)?this._transparentSubMeshes.push(e):H.needAlphaTestingForMesh(E)?(H.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._alphaTestSubMeshes.push(e)):(H.needDepthPrePass&&this._depthOnlySubMeshes.push(e),this._opaqueSubMeshes.push(e)),E._renderingGroup=this,E._edgesRenderer&&E.isEnabled()&&E.isVisible&&E._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(E._edgesRenderer),this._empty=!1)}dispatchSprites(e){this._spriteManagers.push(e),this._empty=!1}dispatchParticles(e){this._particleSystems.push(e),this._empty=!1}_renderParticles(e){if(0===this._particleSystems.length)return;const E=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let H=0;H<this._particleSystems.length;H++){const N=this._particleSystems.data[H];if(0===(E&&E.layerMask&N.layerMask))continue;const u=N.NE;u.position&&e&&-1===e.indexOf(u)||this._scene._activeParticles.addCount(N.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const e=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let E=0;E<this._spriteManagers.length;E++){const H=this._spriteManagers.data[E];0!==(e&&e.layerMask&H.layerMask)&&H.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}z._ZeroVector=u.jE.Zero();class P{}class M{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(e){e!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=e,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const e of this._scene.meshes)if(e.NM)for(const E of e.NM)E._wasDispatched=!1;if(this._scene.spriteManagers)for(const e of this._scene.spriteManagers)e._wasDispatched=!1;for(const e of this._scene.Ii)e._wasDispatched=!1}constructor(e){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new P,this._maintainStateBetweenFrames=!1,this._scene=e;for(let E=M.MIN_RENDERINGGROUPS;E<M.MAX_RENDERINGGROUPS;E++)this._autoClearDepthStencil[E]={HM:!0,depth:!0,nP:!0}}getRenderingGroup(e){const E=e||0;return this._prepareRenderingGroup(E),this._renderingGroups[E]}_clearDepthStencilBuffer(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,e,E),this._depthStencilBufferAlreadyCleaned=!0)}render(e,E,H,N){const u=this._renderingGroupInfo;if(u.hE=this._scene,u.camera=this._scene.activeCamera,u.renderingManager=this,this._scene.spriteManagers&&N)for(let z=0;z<this._scene.spriteManagers.length;z++){const e=this._scene.spriteManagers[z];this.dispatchSprites(e)}for(let z=M.MIN_RENDERINGGROUPS;z<M.MAX_RENDERINGGROUPS;z++){this._depthStencilBufferAlreadyCleaned=z===M.MIN_RENDERINGGROUPS;const P=this._renderingGroups[z];if(!P||P._empty)continue;const D=1<<z;if(u.renderingGroupId=z,this._scene.onBeforeRenderingGroupObservable.notifyObservers(u,D),M.AUTOCLEAR){const e=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(z):this._autoClearDepthStencil[z];e&&e.HM&&this._clearDepthStencilBuffer(e.depth,e.nP)}for(const e of this._scene._beforeRenderingGroupDrawStage)e.action(z);P.render(e,N,H,E);for(const e of this._scene._afterRenderingGroupDrawStage)e.action(z);this._scene.onAfterRenderingGroupObservable.notifyObservers(u,D)}}reset(){if(!this.maintainStateBetweenFrames)for(let e=M.MIN_RENDERINGGROUPS;e<M.MAX_RENDERINGGROUPS;e++){const E=this._renderingGroups[e];E&&E.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let e=M.MIN_RENDERINGGROUPS;e<M.MAX_RENDERINGGROUPS;e++){const E=this._renderingGroups[e];E&&E.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let e=M.MIN_RENDERINGGROUPS;e<M.MAX_RENDERINGGROUPS;e++){const E=this._renderingGroups[e];E&&E.dispose()}}_prepareRenderingGroup(e){void 0===this._renderingGroups[e]&&(this._renderingGroups[e]=new z(e,this._scene,this._customOpaqueSortCompareFn[e],this._customAlphaTestSortCompareFn[e],this._customTransparentSortCompareFn[e]))}dispatchSprites(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchSprites(e))}dispatchParticles(e){this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(e.renderingGroupId).dispatchParticles(e))}dispatch(e,E,H){void 0===E&&(E=e.getMesh()),this.maintainStateBetweenFrames&&e._wasDispatched||(e._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatch(e,E,H))}setRenderingOrder(e){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,H=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[e]=E,this._customAlphaTestSortCompareFn[e]=H,this._customTransparentSortCompareFn[e]=N,this._renderingGroups[e]){const E=this._renderingGroups[e];E.opaqueSortCompareFn=this._customOpaqueSortCompareFn[e],E.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[e],E.transparentSortCompareFn=this._customTransparentSortCompareFn[e]}}setRenderingAutoClearDepthStencil(e,E){let H=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[e]={HM:E,depth:H,nP:N}}getAutoClearDepthStencilSetup(e){return this._autoClearDepthStencil[e]}}M.MAX_RENDERINGGROUPS=4,M.MIN_RENDERINGGROUPS=0,M.AUTOCLEAR=!0}}]);