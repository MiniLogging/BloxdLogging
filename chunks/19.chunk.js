"use strict";(self.fjf2z1c8il8=self.fjf2z1c8il8||[]).push([[19],{12526:(g,i,a)=>{a.d(i,{c:()=>b,g:()=>k});var n=a(12531),L=a(12292),d=a(12534);class b{get p(){return this._isDisposed}constructor(g,i,a){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4&&void 0!==arguments[4]&&arguments[4],b=arguments.length>5&&void 0!==arguments[5]&&arguments[5],k=arguments.length>6&&void 0!==arguments[6]&&arguments[6],e=arguments.length>7?arguments[7]:void 0,N=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,g&&g.Pg?this._engine=g.Pg().getEngine():this._engine=g,this._updatable=a,this._instanced=b,this._divisor=e||1,this._label=N,i instanceof n.d?(this._data=null,this._buffer=i):(this._data=i,this._buffer=null),this.byteStride=k?L:L*Float32Array.BYTES_PER_ELEMENT,d||this.create()}createVertexBuffer(g,i,a,n,L){let d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6?arguments[6]:void 0;const e=d?i:i*Float32Array.BYTES_PER_ELEMENT,N=n?d?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new k(this._engine,this,g,this._updatable,!0,N,void 0===L?this._instanced:L,e,a,void 0,void 0,!0,this._divisor||b)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!g&&this._buffer||(g=g||this._data,g&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,g),this._data=g):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(g,this._label),this._data=g):this._buffer=this._engine.createVertexBuffer(g,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Hk>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Hk,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Hk,void 0,this._label));L.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(g){this.create(g)}updateDirectly(g,i,a){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,g,n?i:i*Float32Array.BYTES_PER_ELEMENT,a?a*this.byteStride:void 0),this._data=0===i&&void 0===a?g:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class k{get p(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(g){const i=0!=g;this._instanceDivisor=g,i!==this._instanced&&(this._instanced=i,this._computeHashCode())}get _maxVerticesCount(){const g=this.getData();return g?Array.isArray(g)?g.length/(this.byteStride/4)-this.byteOffset/4:(g.byteLength-this.byteOffset)/this.byteStride:0}constructor(g,i,a,n,L,e,N,F,I,j){let y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],B=arguments.length>11&&void 0!==arguments[11]&&arguments[11],c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,D=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let p=!1;if(this.yi=g,"object"===typeof n&&null!==n?(p=n.updatable??!1,L=n.postponeInternalCreation,e=n.stride,N=n.instanced,F=n.offset,I=n.size,j=n.type,y=n.normalized??!1,B=n.useBytes??!1,c=n.divisor??1,D=n.takeBufferOwnership??!1,this._label=n.label):p=!!n,i instanceof b?(this._buffer=i,this._ownsBuffer=D):(this._buffer=new b(g,i,p,e,L,N,B,c,this._label),this._ownsBuffer=!0),this.uniqueId=k._Counter++,this._kind=a,void 0===j){const g=this.getData();this.type=g?k.GetDataType(g):k.FLOAT}else this.type=j;const R=(0,d.r)(this.type);B?(this._size=I||(e?e/R:k.DeduceStride(a)),this.byteStride=e||this._buffer.byteStride||this._size*R,this.byteOffset=F||0):(this._size=I||e||k.DeduceStride(a),this.byteStride=e?e*R:this._buffer.byteStride||this._size*R,this.byteOffset=(F||0)*R),this.normalized=y,this._instanced=void 0!==N&&N,this._instanceDivisor=N?c:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var g;null===(g=this._buffer)||void 0===g||g._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(g,i){const a=this.getData();return a?(0,d.n)(a,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,g,i):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,d.r)(this.type)}getOffset(){return this.byteOffset/(0,d.r)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,d.r)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(g){this._buffer.create(g),this._alignBuffer()}update(g){this._buffer.update(g),this._alignBuffer()}updateDirectly(g,i){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(g,i,void 0,a),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(g,i){(0,d.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,g,this.normalized,((g,a)=>{for(let n=0;n<this._size;n++)i(g[n],a+n)}))}_alignBuffer(){}static DeduceStride(g){switch(g){case k.UVKind:case k.UV2Kind:case k.UV3Kind:case k.UV4Kind:case k.UV5Kind:case k.UV6Kind:return 2;case k.NormalKind:case k.PositionKind:return 3;case k.ColorKind:case k.ColorInstanceKind:case k.MatricesIndicesKind:case k.MatricesIndicesExtraKind:case k.MatricesWeightsKind:case k.MatricesWeightsExtraKind:case k.TangentKind:return 4;default:throw new Error("Invalid kind '"+g+"'")}}static GetDataType(g){return g instanceof Int8Array?k.BYTE:g instanceof Uint8Array?k.UNSIGNED_BYTE:g instanceof Int16Array?k.SHORT:g instanceof Uint16Array?k.UNSIGNED_SHORT:g instanceof Int32Array?k.INT:g instanceof Uint32Array?k.UNSIGNED_INT:k.FLOAT}static GetTypeByteLength(g){return(0,d.r)(g)}static ForEach(g,i,a,n,L,b,k,e){(0,d.j)(g,i,a,n,L,b,k,((g,i)=>{for(let a=0;a<n;a++)e(g[a],i+a)}))}static GetFloatData(g,i,a,n,L,b,k,e){return(0,d.n)(g,i,a,n,L,b,k,e)}}k._Counter=0,k.BYTE=5120,k.UNSIGNED_BYTE=5121,k.SHORT=5122,k.UNSIGNED_SHORT=5123,k.INT=5124,k.UNSIGNED_INT=5125,k.FLOAT=5126,k.PositionKind="position",k.NormalKind="normal",k.TangentKind="tangent",k.UVKind="uv",k.UV2Kind="uv2",k.UV3Kind="uv3",k.UV4Kind="uv4",k.UV5Kind="uv5",k.UV6Kind="uv6",k.ColorKind="color",k.ColorInstanceKind="instanceColor",k.MatricesIndicesKind="matricesIndices",k.MatricesWeightsKind="matricesWeights",k.MatricesIndicesExtraKind="matricesIndicesExtra",k.MatricesWeightsExtraKind="matricesWeightsExtra"},12534:(g,i,a)=>{a.d(i,{e:()=>j,h:()=>I,j:()=>e,n:()=>N,r:()=>b,s:()=>k,t:()=>F});var n=a(12292);function L(g,i,a,n){switch(i){case 5120:{let i=g.getInt8(a);return n&&(i=Math.max(i/127,-1)),i}case 5121:{let i=g.getUint8(a);return n&&(i/=255),i}case 5122:{let i=g.getInt16(a,!0);return n&&(i=Math.max(i/32767,-1)),i}case 5123:{let i=g.getUint16(a,!0);return n&&(i/=65535),i}case 5124:return g.getInt32(a,!0);case 5125:return g.getUint32(a,!0);case 5126:return g.getFloat32(a,!0);default:throw new Error(`Invalid component type ${i}`)}}function d(g,i,a,n,L){switch(i){case 5120:n&&(L=Math.round(127*L)),g.setInt8(a,L);break;case 5121:n&&(L=Math.round(255*L)),g.setUint8(a,L);break;case 5122:n&&(L=Math.round(32767*L)),g.setInt16(a,L,!0);break;case 5123:n&&(L=Math.round(65535*L)),g.setUint16(a,L,!0);break;case 5124:g.setInt32(a,L,!0);break;case 5125:g.setUint32(a,L,!0);break;case 5126:g.setFloat32(a,L,!0);break;default:throw new Error(`Invalid component type ${i}`)}}function b(g){switch(g){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${g}'`)}}function k(g){switch(g){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${g}'`)}}function e(g,i,a,n,k,e,N,F){const I=new Array(n),j=new Array(n);if(g instanceof Array){let L=i/4;const d=a/4;for(let i=0;i<e;i+=n){for(let i=0;i<n;i++)I[i]=j[i]=g[L+i];F(j,i);for(let i=0;i<n;i++)I[i]!==j[i]&&(g[L+i]=j[i]);L+=d}}else{const y=ArrayBuffer.isView(g)?new DataView(g.buffer,g.byteOffset,g.byteLength):new DataView(g),B=b(k);for(let g=0;g<e;g+=n){for(let g=0,a=i;g<n;g++,a+=B)I[g]=j[g]=L(y,k,a,N);F(j,g);for(let g=0,a=i;g<n;g++,a+=B)I[g]!==j[g]&&d(y,k,a,N,j[g]);i+=a}}}function N(g,i,a,L,d,k,N,F){const I=i*b(a),j=N*i;if(5126!==a||d!==I){const n=new Float32Array(j);return e(g,L,d,i,a,j,k,((g,a)=>{for(let L=0;L<i;L++)n[a+L]=g[L]})),n}if(!(g instanceof Array||g instanceof Float32Array)||0!==L||g.length!==j){if(g instanceof Array){const i=L/4;return g.slice(i,i+j)}if(g instanceof ArrayBuffer)return new Float32Array(g,L,j);{const i=g.byteOffset+L;return 0!==(3&i)&&(n.b.Warn("Float array must be aligned to 4-bytes border"),F=!0),F?new Float32Array(g.buffer.slice(i,i+j*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(g.buffer,i,j)}}return F?g.slice():g}function F(g,i,a,L,d,N,F,I){const j=b(a),y=k(a),B=F*i;if(Array.isArray(g)){if(0!==(3&L)||0!==(3&d))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const n=L/4,b=d/4;if(n+(F-1)*b+i>g.length)throw new Error("Last accessed index is out of bounds.");if(b<i)throw new Error("Data stride cannot be smaller than the component size.");if(b!==i){const n=new y(B);return e(g,L,d,i,a,B,N,((g,a)=>{for(let L=0;L<i;L++)n[a+L]=g[L]})),n}return new y(g.slice(n,n+B))}let c,D=L;g instanceof ArrayBuffer?c=g:(c=g.buffer,D+=g.byteOffset);if(D+(F-1)*d+i*j>c.byteLength)throw new Error("Last accessed byte is out of bounds.");const p=i*j;if(d<p)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(d!==p){const g=new y(B);return e(c,D,d,i,a,B,N,((a,n)=>{for(let L=0;L<i;L++)g[n+L]=a[L]})),g}return 1!==j&&0!==(D&j-1)&&(n.b.Warn("Array must be aligned to border of element size. Data will be copied."),I=!0),I?new y(c.slice(D,D+B*j)):new y(c,D,B)}function I(g,i,a,L,d,k,N,F){const I=i*b(a),j=N*i;if(F.length!==j)throw new Error("Output length is not valid");if(5126===a&&d===I)if(g instanceof Array){const i=L/4;F.set(g,i)}else if(g instanceof ArrayBuffer){const i=new Float32Array(g,L,j);F.set(i)}else{const i=g.byteOffset+L;if(0!==(3&i))return n.b.Warn("Float array must be aligned to 4-bytes border"),void F.set(new Float32Array(g.buffer.slice(i,i+j*Float32Array.BYTES_PER_ELEMENT)));const a=new Float32Array(g.buffer,i,j);F.set(a)}else e(g,L,d,i,a,j,k,((g,a)=>{for(let n=0;n<i;n++)F[a+n]=g[n]}))}function j(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(g)){for(let L=0;L<i;L++)if(g[a+L]-n>65535)return!0;return!1}return 4===g.BYTES_PER_ELEMENT}},12531:(g,i,a)=>{a.d(i,{d:()=>n});class n{get underlyingResource(){return null}constructor(){this.references=0,this.Hk=0,this.is32Bits=!1,this.uniqueId=n._Counter++}}n._Counter=0},12564:(g,i,a)=>{a.d(i,{c:()=>L});var n=a(12352);class L{static GetEffect(g){return void 0===g.getPipelineContext?g.effect:g}constructor(g){let i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=g.createDrawContext(),i&&(this.materialContext=g.createMaterialContext())}setEffect(g,i){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n;(this.effect=g,void 0!==i&&(this.defines=i),a)&&(null===(n=this.drawContext)||void 0===n||n.reset())}dispose(){var g;let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const g=this.effect;i?g.dispose():n.c.SetImmediate((()=>{g.getEngine().onEndFrameObservable.addOnce((()=>{g.dispose()}))})),this.effect=null}null===(g=this.drawContext)||void 0===g||g.dispose()}}},12662:(g,i,a)=>{a.d(i,{c:()=>L});var n=a(12498);class L{static GetPlanes(g){const i=[];for(let a=0;a<6;a++)i.push(new n.b(0,0,0,0));return L.GetPlanesToRef(g,i),i}static GetNearPlaneToRef(g,i){const a=g.m;i.normal.x=a[3]+a[2],i.normal.y=a[7]+a[6],i.normal.z=a[11]+a[10],i.d=a[15]+a[14],i.normalize()}static GetFarPlaneToRef(g,i){const a=g.m;i.normal.x=a[3]-a[2],i.normal.y=a[7]-a[6],i.normal.z=a[11]-a[10],i.d=a[15]-a[14],i.normalize()}static GetLeftPlaneToRef(g,i){const a=g.m;i.normal.x=a[3]+a[0],i.normal.y=a[7]+a[4],i.normal.z=a[11]+a[8],i.d=a[15]+a[12],i.normalize()}static GetRightPlaneToRef(g,i){const a=g.m;i.normal.x=a[3]-a[0],i.normal.y=a[7]-a[4],i.normal.z=a[11]-a[8],i.d=a[15]-a[12],i.normalize()}static GetTopPlaneToRef(g,i){const a=g.m;i.normal.x=a[3]-a[1],i.normal.y=a[7]-a[5],i.normal.z=a[11]-a[9],i.d=a[15]-a[13],i.normalize()}static GetBottomPlaneToRef(g,i){const a=g.m;i.normal.x=a[3]+a[1],i.normal.y=a[7]+a[5],i.normal.z=a[11]+a[9],i.d=a[15]+a[13],i.normalize()}static GetPlanesToRef(g,i){L.GetNearPlaneToRef(g,i[0]),L.GetFarPlaneToRef(g,i[1]),L.GetLeftPlaneToRef(g,i[2]),L.GetRightPlaneToRef(g,i[3]),L.GetTopPlaneToRef(g,i[4]),L.GetBottomPlaneToRef(g,i[5])}static IsPointInFrustum(g,i){for(let a=0;a<6;a++)if(i[a].dotCoordinate(g)<0)return!1;return!0}}},12678:(g,i,a)=>{a.d(i,{b:()=>L});var n=a(12301);class L{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(g,i){L.Enabled&&(this._current+=g,i&&this._fetchResult())}beginMonitoring(){L.Enabled&&(this._startMonitoringTime=n.c.Now)}endMonitoring(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!L.Enabled)return;g&&this.fetchNewFrame();const i=n.c.Now;this._current=i-this._startMonitoringTime,g&&this._fetchResult()}Ld(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const g=n.c.Now;g-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=g,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}L.Enabled=!0},12541:(g,i,a)=>{a.d(i,{d:()=>L,g:()=>n});class n{constructor(g){this.length=0,this.data=new Array(g),this._id=n._GlobalId++}push(g){this.data[this.length++]=g,this.length>this.data.length&&(this.data.length*=2)}forEach(g){for(let i=0;i<this.length;i++)g(this.data[i])}sort(g){this.data.sort(g)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(g){if(0!==g.length){this.length+g.length>this.data.length&&(this.data.length=2*(this.length+g.length));for(let i=0;i<g.length;i++)this.data[this.length++]=(g.data||g)[i]}}indexOf(g){const i=this.data.indexOf(g);return i>=this.length?-1:i}contains(g){return-1!==this.indexOf(g)}}n._GlobalId=0;class L extends n{constructor(){super(...arguments),this._duplicateId=0}push(g){super.push(g),g.__smartArrayFlags||(g.__smartArrayFlags={}),g.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(g){return(!g.__smartArrayFlags||g.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(g),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(g){if(0!==g.length){this.length+g.length>this.data.length&&(this.data.length=2*(this.length+g.length));for(let i=0;i<g.length;i++){const a=(g.data||g)[i];this.pushNoDuplicate(a)}}}}},12517:(g,i,a)=>{a.d(i,{c:()=>d});var n=a(12526),L=a(12286);class d{constructor(g){this._vertexBuffers={},this.onBeforeRenderObservable=new L.b,this._scene=g}_prepareBuffers(){if(this._vertexBuffers[n.g.PositionKind])return;const g=[];g.push(1,1),g.push(-1,1),g.push(-1,-1),g.push(1,-1),this._vertexBuffers[n.g.PositionKind]=new n.g(this._scene.getEngine(),g,n.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const g=[];g.push(0),g.push(1),g.push(2),g.push(0),g.push(2),g.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(g)}_rebuild(){const g=this._vertexBuffers[n.g.PositionKind];g&&(g._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=this._scene.activeCamera;return!!a&&(i=i||a._postProcesses.filter((g=>null!=g)),!(!i||0===i.length||!this._scene.postProcessesEnabled)&&(i[0].activate(a,g,null!==i&&void 0!==i),!0))}directRender(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],b=arguments.length>6&&void 0!==arguments[6]?arguments[6]:g.length;const k=this._scene.getEngine();for(let N=0;N<b;N++){var e;if(N<g.length-1)g[N+1].activate(this._scene.activeCamera||this._scene,null===i||void 0===i?void 0:i.texture);else i?k.bindFramebuffer(i,n,void 0,void 0,a,L):d||k.restoreDefaultFramebuffer(),null===(e=k._debugInsertMarker)||void 0===e||e.call(k,`post process ${g[N].name} output`);const b=g[N],F=b.apply();F&&(b.onBeforeRenderObservable.notifyObservers(F),this._prepareBuffers(),k.bindBuffers(this._vertexBuffers,this._indexBuffer,F),k.drawElementsType(0,0,6),b.onAfterRenderObservable.notifyObservers(F))}k.setDepthBuffer(!0),k.setDepthWrite(!0)}_finalizeFrame(g,i,a,n){let L=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const d=this._scene.activeCamera;if(!d)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(n=n||d._postProcesses.filter((g=>null!=g))).length||!this._scene.postProcessesEnabled)return;const b=this._scene.getEngine();for(let e=0,N=n.length;e<N;e++){const F=n[e];var k;if(e<N-1)F._outputTexture=n[e+1].activate(d,null===i||void 0===i?void 0:i.texture);else i?(b.bindFramebuffer(i,a,void 0,void 0,L),F._outputTexture=i):(b.restoreDefaultFramebuffer(),F._outputTexture=null),null===(k=b._debugInsertMarker)||void 0===k||k.call(b,`post process ${n[e].name} output`);if(g)break;const I=F.apply();I&&(F.onBeforeRenderObservable.notifyObservers(I),this._prepareBuffers(),b.bindBuffers(this._vertexBuffers,this._indexBuffer,I),b.drawElementsType(0,0,6),F.onAfterRenderObservable.notifyObservers(I))}b.setDepthBuffer(!0),b.setDepthWrite(!0),b.setAlphaMode(0)}dispose(){const g=this._vertexBuffers[n.g.PositionKind];g&&(g.dispose(),this._vertexBuffers[n.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12537:(g,i,a)=>{a.d(i,{c:()=>k});var n=a(12541),L=a(12452);class d{set opaqueSortCompareFn(g){this._opaqueSortCompareFn=g||d.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(g){this._alphaTestSortCompareFn=g||d.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(g){this._transparentSortCompareFn=g||d.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(g,i){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=g,this._opaqueSubMeshes=new n.g(256),this._transparentSubMeshes=new n.g(256),this._alphaTestSubMeshes=new n.g(256),this._depthOnlySubMeshes=new n.g(256),this._particleSystems=new n.g(256),this._spriteManagers=new n.g(256),this._empty=!0,this._edgesRenderers=new n.d(16),this._scene=i,this.opaqueSortCompareFn=a,this.alphaTestSortCompareFn=L,this.transparentSortCompareFn=d}render(g,i,a,n){if(g)return void g(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const L=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(L.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),L.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const d=L.getStencilBuffer();if(L.setStencilBuffer(!1),i&&this._renderSprites(),a&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(L.setStencilBuffer(d),this._scene.useOrderIndependentTransparency){const g=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);g.length&&this._renderTransparent(g)}else this._renderTransparent(this._transparentSubMeshes);L.setAlphaMode(0)}if(L.setStencilBuffer(!1),this._edgesRenderers.length){for(let g=0;g<this._edgesRenderers.length;g++)this._edgesRenderers.data[g].render();L.setAlphaMode(0)}L.setStencilBuffer(d)}_renderOpaqueSorted(g){d._RenderSorted(g,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(g){d._RenderSorted(g,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(g){d._RenderSorted(g,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(g,i,a,n){let b,k=0;const e=a?a.globalPosition:d._ZeroVector;if(n)for(;k<g.length;k++)b=g.data[k],b._alphaIndex=b.getMesh().alphaIndex,b._distanceToCamera=L.Bi.Distance(b.getBoundingInfo().boundingSphere.centerWorld,e);const N=g.length===g.data.length?g.data:g.data.slice(0,g.length);i&&N.sort(i);const F=N[0].getMesh().Pg();for(k=0;k<N.length;k++)if(b=N[k],!F._activeMeshesFrozenButKeepClipping||b.isInFrustum(F._frustumPlanes)){if(n){const g=b.wg();if(g&&g.needDepthPrePass){const i=g.Pg().getEngine();i.setColorWrite(!1),i.setAlphaMode(0),b.render(!1),i.setColorWrite(!0)}}b.render(n)}}static defaultTransparentSortCompare(g,i){return g._alphaIndex>i._alphaIndex?1:g._alphaIndex<i._alphaIndex?-1:d.backToFrontSortCompare(g,i)}static backToFrontSortCompare(g,i){return g._distanceToCamera<i._distanceToCamera?1:g._distanceToCamera>i._distanceToCamera?-1:0}static frontToBackSortCompare(g,i){return g._distanceToCamera<i._distanceToCamera?-1:g._distanceToCamera>i._distanceToCamera?1:0}static PainterSortCompare(g,i){const a=g.getMesh(),n=i.getMesh();return a.material&&n.material?a.material.uniqueId-n.material.uniqueId:a.uniqueId-n.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(g,i,a){void 0===i&&(i=g.getMesh()),void 0===a&&(a=g.wg()),null!==a&&void 0!==a&&(a.needAlphaBlendingForMesh(i)?this._transparentSubMeshes.push(g):a.needAlphaTestingForMesh(i)?(a.needDepthPrePass&&this._depthOnlySubMeshes.push(g),this._alphaTestSubMeshes.push(g)):(a.needDepthPrePass&&this._depthOnlySubMeshes.push(g),this._opaqueSubMeshes.push(g)),i._renderingGroup=this,i._edgesRenderer&&i.isEnabled()&&i.isVisible&&i._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(i._edgesRenderer),this._empty=!1)}dispatchSprites(g){this._spriteManagers.push(g),this._empty=!1}dispatchParticles(g){this._particleSystems.push(g),this._empty=!1}_renderParticles(g){if(0===this._particleSystems.length)return;const i=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let a=0;a<this._particleSystems.length;a++){const n=this._particleSystems.data[a];if(0===(i&&i.layerMask&n.layerMask))continue;const L=n.ni;L.position&&g&&-1===g.indexOf(L)||this._scene._activeParticles.addCount(n.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const g=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._spriteManagers.length;i++){const a=this._spriteManagers.data[i];0!==(g&&g.layerMask&a.layerMask)&&a.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}d._ZeroVector=L.Bi.Zero();class b{}class k{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(g){g!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=g,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const g of this._scene.meshes)if(g.Yd)for(const i of g.Yd)i._wasDispatched=!1;if(this._scene.spriteManagers)for(const g of this._scene.spriteManagers)g._wasDispatched=!1;for(const g of this._scene.Wj)g._wasDispatched=!1}constructor(g){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new b,this._maintainStateBetweenFrames=!1,this._scene=g;for(let i=k.MIN_RENDERINGGROUPS;i<k.MAX_RENDERINGGROUPS;i++)this._autoClearDepthStencil[i]={Pd:!0,depth:!0,bd:!0}}getRenderingGroup(g){const i=g||0;return this._prepareRenderingGroup(i),this._renderingGroups[i]}_clearDepthStencilBuffer(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,g,i),this._depthStencilBufferAlreadyCleaned=!0)}render(g,i,a,n){const L=this._renderingGroupInfo;if(L.Di=this._scene,L.camera=this._scene.activeCamera,L.renderingManager=this,this._scene.spriteManagers&&n)for(let d=0;d<this._scene.spriteManagers.length;d++){const g=this._scene.spriteManagers[d];this.dispatchSprites(g)}for(let d=k.MIN_RENDERINGGROUPS;d<k.MAX_RENDERINGGROUPS;d++){this._depthStencilBufferAlreadyCleaned=d===k.MIN_RENDERINGGROUPS;const b=this._renderingGroups[d];if(!b||b._empty)continue;const e=1<<d;if(L.renderingGroupId=d,this._scene.onBeforeRenderingGroupObservable.notifyObservers(L,e),k.AUTOCLEAR){const g=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(d):this._autoClearDepthStencil[d];g&&g.Pd&&this._clearDepthStencilBuffer(g.depth,g.bd)}for(const g of this._scene._beforeRenderingGroupDrawStage)g.action(d);b.render(g,n,a,i);for(const g of this._scene._afterRenderingGroupDrawStage)g.action(d);this._scene.onAfterRenderingGroupObservable.notifyObservers(L,e)}}reset(){if(!this.maintainStateBetweenFrames)for(let g=k.MIN_RENDERINGGROUPS;g<k.MAX_RENDERINGGROUPS;g++){const i=this._renderingGroups[g];i&&i.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let g=k.MIN_RENDERINGGROUPS;g<k.MAX_RENDERINGGROUPS;g++){const i=this._renderingGroups[g];i&&i.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let g=k.MIN_RENDERINGGROUPS;g<k.MAX_RENDERINGGROUPS;g++){const i=this._renderingGroups[g];i&&i.dispose()}}_prepareRenderingGroup(g){void 0===this._renderingGroups[g]&&(this._renderingGroups[g]=new d(g,this._scene,this._customOpaqueSortCompareFn[g],this._customAlphaTestSortCompareFn[g],this._customTransparentSortCompareFn[g]))}dispatchSprites(g){this.maintainStateBetweenFrames&&g._wasDispatched||(g._wasDispatched=!0,this.getRenderingGroup(g.renderingGroupId).dispatchSprites(g))}dispatchParticles(g){this.maintainStateBetweenFrames&&g._wasDispatched||(g._wasDispatched=!0,this.getRenderingGroup(g.renderingGroupId).dispatchParticles(g))}dispatch(g,i,a){void 0===i&&(i=g.getMesh()),this.maintainStateBetweenFrames&&g._wasDispatched||(g._wasDispatched=!0,this.getRenderingGroup(i.renderingGroupId).dispatch(g,i,a))}setRenderingOrder(g){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[g]=i,this._customAlphaTestSortCompareFn[g]=a,this._customTransparentSortCompareFn[g]=n,this._renderingGroups[g]){const i=this._renderingGroups[g];i.opaqueSortCompareFn=this._customOpaqueSortCompareFn[g],i.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[g],i.transparentSortCompareFn=this._customTransparentSortCompareFn[g]}}setRenderingAutoClearDepthStencil(g,i){let a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[g]={Pd:i,depth:a,bd:n}}getAutoClearDepthStencilSetup(g){return this._autoClearDepthStencil[g]}}k.MAX_RENDERINGGROUPS=4,k.MIN_RENDERINGGROUPS=0,k.AUTOCLEAR=!0}}]);