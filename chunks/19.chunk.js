"use strict";(self.vb3rpbgyozo=self.vb3rpbgyozo||[]).push([[19],{12821:(q,I,l)=>{l.d(I,{b:()=>c,c:()=>a});var w=l(12828),t=l(12591),O=l(12830);class c{get Z(){return this._isDisposed}constructor(q,I,l){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,O=arguments.length>4&&void 0!==arguments[4]&&arguments[4],c=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7?arguments[7]:void 0,s=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,q&&q.Wq?this._engine=q.Wq().getEngine():this._engine=q,this._updatable=l,this._instanced=c,this._divisor=F||1,this._label=s,I instanceof w.b?(this._data=null,this._buffer=I):(this._data=I,this._buffer=null),this.byteStride=a?t:t*Float32Array.BYTES_PER_ELEMENT,O||this.create()}createVertexBuffer(q,I,l,w,t){let O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6?arguments[6]:void 0;const F=O?I:I*Float32Array.BYTES_PER_ELEMENT,s=w?O?w:w*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new a(this._engine,this,q,this._updatable,!0,s,void 0===t?this._instanced:t,F,l,void 0,void 0,!0,this._divisor||c)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!q&&this._buffer||(q=q||this._data,q&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,q),this._data=q):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(q,this._label),this._data=q):this._buffer=this._engine.createVertexBuffer(q,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Zl>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Zl,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Zl,void 0,this._label));t.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(q){this.create(q)}updateDirectly(q,I,l){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,q,w?I:I*Float32Array.BYTES_PER_ELEMENT,l?l*this.byteStride:void 0),this._data=0===I&&void 0===l?q:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class a{get Z(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(q){const I=0!=q;this._instanceDivisor=q,I!==this._instanced&&(this._instanced=I,this._computeHashCode())}get _maxVerticesCount(){const q=this.getData();return q?Array.isArray(q)?q.length/(this.byteStride/4)-this.byteOffset/4:(q.byteLength-this.byteOffset)/this.byteStride:0}constructor(q,I,l,w,t,F,s,Z,r,x){let o=arguments.length>10&&void 0!==arguments[10]&&arguments[10],d=arguments.length>11&&void 0!==arguments[11]&&arguments[11],T=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,V=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let U=!1;if(this.oI=q,"object"===typeof w&&null!==w?(U=w.updatable??!1,t=w.postponeInternalCreation,F=w.stride,s=w.instanced,Z=w.offset,r=w.size,x=w.type,o=w.normalized??!1,d=w.useBytes??!1,T=w.divisor??1,V=w.takeBufferOwnership??!1,this._label=w.label):U=!!w,I instanceof c?(this._buffer=I,this._ownsBuffer=V):(this._buffer=new c(q,I,U,F,t,s,d,T,this._label),this._ownsBuffer=!0),this.uniqueId=a._Counter++,this._kind=l,void 0===x){const q=this.getData();this.type=q?a.GetDataType(q):a.FLOAT}else this.type=x;const B=(0,O.k)(this.type);d?(this._size=r||(F?F/B:a.DeduceStride(l)),this.byteStride=F||this._buffer.byteStride||this._size*B,this.byteOffset=Z||0):(this._size=r||F||a.DeduceStride(l),this.byteStride=F?F*B:this._buffer.byteStride||this._size*B,this.byteOffset=(Z||0)*B),this.normalized=o,this._instanced=void 0!==s&&s,this._instanceDivisor=s?T:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var q;null===(q=this._buffer)||void 0===q||q._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(q,I){const l=this.getData();return l?(0,O.j)(l,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,q,I):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,O.k)(this.type)}getOffset(){return this.byteOffset/(0,O.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,O.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(q){this._buffer.create(q),this._alignBuffer()}update(q){this._buffer.update(q),this._alignBuffer()}updateDirectly(q,I){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(q,I,void 0,l),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(q,I){(0,O.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,q,this.normalized,((q,l)=>{for(let w=0;w<this._size;w++)I(q[w],l+w)}))}_alignBuffer(){}static DeduceStride(q){switch(q){case a.UVKind:case a.UV2Kind:case a.UV3Kind:case a.UV4Kind:case a.UV5Kind:case a.UV6Kind:return 2;case a.NormalKind:case a.PositionKind:return 3;case a.ColorKind:case a.ColorInstanceKind:case a.MatricesIndicesKind:case a.MatricesIndicesExtraKind:case a.MatricesWeightsKind:case a.MatricesWeightsExtraKind:case a.TangentKind:return 4;default:throw new Error("Invalid kind '"+q+"'")}}static GetDataType(q){return q instanceof Int8Array?a.BYTE:q instanceof Uint8Array?a.UNSIGNED_BYTE:q instanceof Int16Array?a.SHORT:q instanceof Uint16Array?a.UNSIGNED_SHORT:q instanceof Int32Array?a.INT:q instanceof Uint32Array?a.UNSIGNED_INT:a.FLOAT}static GetTypeByteLength(q){return(0,O.k)(q)}static ForEach(q,I,l,w,t,c,a,F){(0,O.h)(q,I,l,w,t,c,a,((q,I)=>{for(let l=0;l<w;l++)F(q[l],I+l)}))}static GetFloatData(q,I,l,w,t,c,a,F){return(0,O.j)(q,I,l,w,t,c,a,F)}}a._Counter=0,a.BYTE=5120,a.UNSIGNED_BYTE=5121,a.SHORT=5122,a.UNSIGNED_SHORT=5123,a.INT=5124,a.UNSIGNED_INT=5125,a.FLOAT=5126,a.PositionKind="position",a.NormalKind="normal",a.TangentKind="tangent",a.UVKind="uv",a.UV2Kind="uv2",a.UV3Kind="uv3",a.UV4Kind="uv4",a.UV5Kind="uv5",a.UV6Kind="uv6",a.ColorKind="color",a.ColorInstanceKind="instanceColor",a.MatricesIndicesKind="matricesIndices",a.MatricesWeightsKind="matricesWeights",a.MatricesIndicesExtraKind="matricesIndicesExtra",a.MatricesWeightsExtraKind="matricesWeightsExtra"},12830:(q,I,l)=>{l.d(I,{d:()=>x,e:()=>r,h:()=>F,j:()=>s,k:()=>c,l:()=>a,o:()=>Z});var w=l(12591);function t(q,I,l,w){switch(I){case 5120:{let I=q.getInt8(l);return w&&(I=Math.max(I/127,-1)),I}case 5121:{let I=q.getUint8(l);return w&&(I/=255),I}case 5122:{let I=q.getInt16(l,!0);return w&&(I=Math.max(I/32767,-1)),I}case 5123:{let I=q.getUint16(l,!0);return w&&(I/=65535),I}case 5124:return q.getInt32(l,!0);case 5125:return q.getUint32(l,!0);case 5126:return q.getFloat32(l,!0);default:throw new Error(`Invalid component type ${I}`)}}function O(q,I,l,w,t){switch(I){case 5120:w&&(t=Math.round(127*t)),q.setInt8(l,t);break;case 5121:w&&(t=Math.round(255*t)),q.setUint8(l,t);break;case 5122:w&&(t=Math.round(32767*t)),q.setInt16(l,t,!0);break;case 5123:w&&(t=Math.round(65535*t)),q.setUint16(l,t,!0);break;case 5124:q.setInt32(l,t,!0);break;case 5125:q.setUint32(l,t,!0);break;case 5126:q.setFloat32(l,t,!0);break;default:throw new Error(`Invalid component type ${I}`)}}function c(q){switch(q){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${q}'`)}}function a(q){switch(q){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${q}'`)}}function F(q,I,l,w,a,F,s,Z){const r=new Array(w),x=new Array(w);if(q instanceof Array){let t=I/4;const O=l/4;for(let I=0;I<F;I+=w){for(let I=0;I<w;I++)r[I]=x[I]=q[t+I];Z(x,I);for(let I=0;I<w;I++)r[I]!==x[I]&&(q[t+I]=x[I]);t+=O}}else{const o=ArrayBuffer.isView(q)?new DataView(q.buffer,q.byteOffset,q.byteLength):new DataView(q),d=c(a);for(let q=0;q<F;q+=w){for(let q=0,l=I;q<w;q++,l+=d)r[q]=x[q]=t(o,a,l,s);Z(x,q);for(let q=0,l=I;q<w;q++,l+=d)r[q]!==x[q]&&O(o,a,l,s,x[q]);I+=l}}}function s(q,I,l,t,O,a,s,Z){const r=I*c(l),x=s*I;if(5126!==l||O!==r){const w=new Float32Array(x);return F(q,t,O,I,l,x,a,((q,l)=>{for(let t=0;t<I;t++)w[l+t]=q[t]})),w}if(!(q instanceof Array||q instanceof Float32Array)||0!==t||q.length!==x){if(q instanceof Array){const I=t/4;return q.slice(I,I+x)}if(q instanceof ArrayBuffer)return new Float32Array(q,t,x);{const I=q.byteOffset+t;return 0!==(3&I)&&(w.b.Warn("Float array must be aligned to 4-bytes border"),Z=!0),Z?new Float32Array(q.buffer.slice(I,I+x*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(q.buffer,I,x)}}return Z?q.slice():q}function Z(q,I,l,t,O,s,Z,r){const x=c(l),o=a(l),d=Z*I;if(Array.isArray(q)){if(0!==(3&t)||0!==(3&O))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const w=t/4,c=O/4;if(w+(Z-1)*c+I>q.length)throw new Error("Last accessed index is out of bounds.");if(c<I)throw new Error("Data stride cannot be smaller than the component size.");if(c!==I){const w=new o(d);return F(q,t,O,I,l,d,s,((q,l)=>{for(let t=0;t<I;t++)w[l+t]=q[t]})),w}return new o(q.slice(w,w+d))}let T,V=t;q instanceof ArrayBuffer?T=q:(T=q.buffer,V+=q.byteOffset);if(V+(Z-1)*O+I*x>T.byteLength)throw new Error("Last accessed byte is out of bounds.");const U=I*x;if(O<U)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(O!==U){const q=new o(d);return F(T,V,O,I,l,d,s,((l,w)=>{for(let t=0;t<I;t++)q[w+t]=l[t]})),q}return 1!==x&&0!==(V&x-1)&&(w.b.Warn("Array must be aligned to border of element size. Data will be copied."),r=!0),r?new o(T.slice(V,V+d*x)):new o(T,V,d)}function r(q,I,l,t,O,a,s,Z){const r=I*c(l),x=s*I;if(Z.length!==x)throw new Error("Output length is not valid");if(5126===l&&O===r)if(q instanceof Array){const I=t/4;Z.set(q,I)}else if(q instanceof ArrayBuffer){const I=new Float32Array(q,t,x);Z.set(I)}else{const I=q.byteOffset+t;if(0!==(3&I))return w.b.Warn("Float array must be aligned to 4-bytes border"),void Z.set(new Float32Array(q.buffer.slice(I,I+x*Float32Array.BYTES_PER_ELEMENT)));const l=new Float32Array(q.buffer,I,x);Z.set(l)}else F(q,t,O,I,l,x,a,((q,l)=>{for(let w=0;w<I;w++)Z[l+w]=q[w]}))}function x(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(q)){for(let t=0;t<I;t++)if(q[l+t]-w>65535)return!0;return!1}return 4===q.BYTES_PER_ELEMENT}},12828:(q,I,l)=>{l.d(I,{b:()=>w});class w{get underlyingResource(){return null}constructor(){this.references=0,this.Zl=0,this.is32Bits=!1,this.uniqueId=w._Counter++}}w._Counter=0},12865:(q,I,l)=>{l.d(I,{e:()=>t});var w=l(12647);class t{static GetEffect(q){return void 0===q.getPipelineContext?q.effect:q}constructor(q){let I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=q.createDrawContext(),I&&(this.materialContext=q.createMaterialContext())}setEffect(q,I){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var w;(this.effect=q,void 0!==I&&(this.defines=I),l)&&(null===(w=this.drawContext)||void 0===w||w.reset())}dispose(){var q;let I=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const q=this.effect;I?q.dispose():w.c.SetImmediate((()=>{q.getEngine().onEndFrameObservable.addOnce((()=>{q.dispose()}))})),this.effect=null}null===(q=this.drawContext)||void 0===q||q.dispose()}}},12958:(q,I,l)=>{l.d(I,{e:()=>t});var w=l(12794);class t{static GetPlanes(q){const I=[];for(let l=0;l<6;l++)I.push(new w.c(0,0,0,0));return t.GetPlanesToRef(q,I),I}static GetNearPlaneToRef(q,I){const l=q.m;I.normal.x=l[3]+l[2],I.normal.y=l[7]+l[6],I.normal.z=l[11]+l[10],I.d=l[15]+l[14],I.normalize()}static GetFarPlaneToRef(q,I){const l=q.m;I.normal.x=l[3]-l[2],I.normal.y=l[7]-l[6],I.normal.z=l[11]-l[10],I.d=l[15]-l[14],I.normalize()}static GetLeftPlaneToRef(q,I){const l=q.m;I.normal.x=l[3]+l[0],I.normal.y=l[7]+l[4],I.normal.z=l[11]+l[8],I.d=l[15]+l[12],I.normalize()}static GetRightPlaneToRef(q,I){const l=q.m;I.normal.x=l[3]-l[0],I.normal.y=l[7]-l[4],I.normal.z=l[11]-l[8],I.d=l[15]-l[12],I.normalize()}static GetTopPlaneToRef(q,I){const l=q.m;I.normal.x=l[3]-l[1],I.normal.y=l[7]-l[5],I.normal.z=l[11]-l[9],I.d=l[15]-l[13],I.normalize()}static GetBottomPlaneToRef(q,I){const l=q.m;I.normal.x=l[3]+l[1],I.normal.y=l[7]+l[5],I.normal.z=l[11]+l[9],I.d=l[15]+l[13],I.normalize()}static GetPlanesToRef(q,I){t.GetNearPlaneToRef(q,I[0]),t.GetFarPlaneToRef(q,I[1]),t.GetLeftPlaneToRef(q,I[2]),t.GetRightPlaneToRef(q,I[3]),t.GetTopPlaneToRef(q,I[4]),t.GetBottomPlaneToRef(q,I[5])}static IsPointInFrustum(q,I){for(let l=0;l<6;l++)if(I[l].dotCoordinate(q)<0)return!1;return!0}}},12970:(q,I,l)=>{l.d(I,{b:()=>t});var w=l(12601);class t{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(q,I){t.Enabled&&(this._current+=q,I&&this._fetchResult())}beginMonitoring(){t.Enabled&&(this._startMonitoringTime=w.e.Now)}endMonitoring(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!t.Enabled)return;q&&this.fetchNewFrame();const I=w.e.Now;this._current=I-this._startMonitoringTime,q&&this._fetchResult()}wc(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const q=w.e.Now;q-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=q,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}t.Enabled=!0},12839:(q,I,l)=>{l.d(I,{d:()=>t,h:()=>w});class w{constructor(q){this.length=0,this.data=new Array(q),this._id=w._GlobalId++}push(q){this.data[this.length++]=q,this.length>this.data.length&&(this.data.length*=2)}forEach(q){for(let I=0;I<this.length;I++)q(this.data[I])}sort(q){this.data.sort(q)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(q){if(0!==q.length){this.length+q.length>this.data.length&&(this.data.length=2*(this.length+q.length));for(let I=0;I<q.length;I++)this.data[this.length++]=(q.data||q)[I]}}indexOf(q){const I=this.data.indexOf(q);return I>=this.length?-1:I}contains(q){return-1!==this.indexOf(q)}}w._GlobalId=0;class t extends w{constructor(){super(...arguments),this._duplicateId=0}push(q){super.push(q),q.__smartArrayFlags||(q.__smartArrayFlags={}),q.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(q){return(!q.__smartArrayFlags||q.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(q),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(q){if(0!==q.length){this.length+q.length>this.data.length&&(this.data.length=2*(this.length+q.length));for(let I=0;I<q.length;I++){const l=(q.data||q)[I];this.pushNoDuplicate(l)}}}}},12812:(q,I,l)=>{l.d(I,{c:()=>O});var w=l(12821),t=l(12573);class O{constructor(q){this._vertexBuffers={},this.onBeforeRenderObservable=new t.d,this._scene=q}_prepareBuffers(){if(this._vertexBuffers[w.c.PositionKind])return;const q=[];q.push(1,1),q.push(-1,1),q.push(-1,-1),q.push(1,-1),this._vertexBuffers[w.c.PositionKind]=new w.c(this._scene.getEngine(),q,w.c.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const q=[];q.push(0),q.push(1),q.push(2),q.push(0),q.push(2),q.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(q)}_rebuild(){const q=this._vertexBuffers[w.c.PositionKind];q&&(q._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=this._scene.activeCamera;return!!l&&(I=I||l._postProcesses.filter((q=>null!=q)),!(!I||0===I.length||!this._scene.postProcessesEnabled)&&(I[0].activate(l,q,null!==I&&void 0!==I),!0))}directRender(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,O=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:q.length;const a=this._scene.getEngine();for(let s=0;s<c;s++){var F;if(s<q.length-1)q[s+1].activate(this._scene.activeCamera||this._scene,null===I||void 0===I?void 0:I.texture);else I?a.bindFramebuffer(I,w,void 0,void 0,l,t):O||a.restoreDefaultFramebuffer(),null===(F=a._debugInsertMarker)||void 0===F||F.call(a,`post process ${q[s].name} output`);const c=q[s],Z=c.apply();Z&&(c.onBeforeRenderObservable.notifyObservers(Z),this._prepareBuffers(),a.bindBuffers(this._vertexBuffers,this._indexBuffer,Z),a.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(Z))}a.setDepthBuffer(!0),a.setDepthWrite(!0)}_finalizeFrame(q,I,l,w){let t=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const O=this._scene.activeCamera;if(!O)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(w=w||O._postProcesses.filter((q=>null!=q))).length||!this._scene.postProcessesEnabled)return;const c=this._scene.getEngine();for(let F=0,s=w.length;F<s;F++){const Z=w[F];var a;if(F<s-1)Z._outputTexture=w[F+1].activate(O,null===I||void 0===I?void 0:I.texture);else I?(c.bindFramebuffer(I,l,void 0,void 0,t),Z._outputTexture=I):(c.restoreDefaultFramebuffer(),Z._outputTexture=null),null===(a=c._debugInsertMarker)||void 0===a||a.call(c,`post process ${w[F].name} output`);if(q)break;const r=Z.apply();r&&(Z.onBeforeRenderObservable.notifyObservers(r),this._prepareBuffers(),c.bindBuffers(this._vertexBuffers,this._indexBuffer,r),c.drawElementsType(0,0,6),Z.onAfterRenderObservable.notifyObservers(r))}c.setDepthBuffer(!0),c.setDepthWrite(!0),c.setAlphaMode(0)}dispose(){const q=this._vertexBuffers[w.c.PositionKind];q&&(q.dispose(),this._vertexBuffers[w.c.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12837:(q,I,l)=>{l.d(I,{b:()=>a});var w=l(12839),t=l(12747);class O{set opaqueSortCompareFn(q){this._opaqueSortCompareFn=q||O.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(q){this._alphaTestSortCompareFn=q||O.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(q){this._transparentSortCompareFn=q||O.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(q,I){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=q,this._opaqueSubMeshes=new w.h(256),this._transparentSubMeshes=new w.h(256),this._alphaTestSubMeshes=new w.h(256),this._depthOnlySubMeshes=new w.h(256),this._particleSystems=new w.h(256),this._spriteManagers=new w.h(256),this._empty=!0,this._edgesRenderers=new w.d(16),this._scene=I,this.opaqueSortCompareFn=l,this.alphaTestSortCompareFn=t,this.transparentSortCompareFn=O}render(q,I,l,w){if(q)return void q(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const t=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(t.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),t.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const O=t.getStencilBuffer();if(t.setStencilBuffer(!1),I&&this._renderSprites(),l&&this._renderParticles(w),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(t.setStencilBuffer(O),this._scene.useOrderIndependentTransparency){const q=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);q.length&&this._renderTransparent(q)}else this._renderTransparent(this._transparentSubMeshes);t.setAlphaMode(0)}if(t.setStencilBuffer(!1),this._edgesRenderers.length){for(let q=0;q<this._edgesRenderers.length;q++)this._edgesRenderers.data[q].render();t.setAlphaMode(0)}t.setStencilBuffer(O)}_renderOpaqueSorted(q){O._RenderSorted(q,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(q){O._RenderSorted(q,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(q){O._RenderSorted(q,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(q,I,l,w){let c,a=0;const F=l?l.globalPosition:O._ZeroVector;if(w)for(;a<q.length;a++)c=q.data[a],c._alphaIndex=c.getMesh().alphaIndex,c._distanceToCamera=t.dI.Distance(c.getBoundingInfo().boundingSphere.centerWorld,F);const s=q.length===q.data.length?q.data:q.data.slice(0,q.length);I&&s.sort(I);const Z=s[0].getMesh().Wq();for(a=0;a<s.length;a++)if(c=s[a],!Z._activeMeshesFrozenButKeepClipping||c.isInFrustum(Z._frustumPlanes)){if(w){const q=c.Lq();if(q&&q.needDepthPrePass){const I=q.Wq().getEngine();I.setColorWrite(!1),I.setAlphaMode(0),c.render(!1),I.setColorWrite(!0)}}c.render(w)}}static defaultTransparentSortCompare(q,I){return q._alphaIndex>I._alphaIndex?1:q._alphaIndex<I._alphaIndex?-1:O.backToFrontSortCompare(q,I)}static backToFrontSortCompare(q,I){return q._distanceToCamera<I._distanceToCamera?1:q._distanceToCamera>I._distanceToCamera?-1:0}static frontToBackSortCompare(q,I){return q._distanceToCamera<I._distanceToCamera?-1:q._distanceToCamera>I._distanceToCamera?1:0}static PainterSortCompare(q,I){const l=q.getMesh(),w=I.getMesh();return l.material&&w.material?l.material.uniqueId-w.material.uniqueId:l.uniqueId-w.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(q,I,l){void 0===I&&(I=q.getMesh()),void 0===l&&(l=q.Lq()),null!==l&&void 0!==l&&(l.needAlphaBlendingForMesh(I)?this._transparentSubMeshes.push(q):l.needAlphaTestingForMesh(I)?(l.needDepthPrePass&&this._depthOnlySubMeshes.push(q),this._alphaTestSubMeshes.push(q)):(l.needDepthPrePass&&this._depthOnlySubMeshes.push(q),this._opaqueSubMeshes.push(q)),I._renderingGroup=this,I._edgesRenderer&&I.isEnabled()&&I.isVisible&&I._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(I._edgesRenderer),this._empty=!1)}dispatchSprites(q){this._spriteManagers.push(q),this._empty=!1}dispatchParticles(q){this._particleSystems.push(q),this._empty=!1}_renderParticles(q){if(0===this._particleSystems.length)return;const I=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let l=0;l<this._particleSystems.length;l++){const w=this._particleSystems.data[l];if(0===(I&&I.layerMask&w.layerMask))continue;const t=w.wI;t.position&&q&&-1===q.indexOf(t)||this._scene._activeParticles.addCount(w.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const q=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let I=0;I<this._spriteManagers.length;I++){const l=this._spriteManagers.data[I];0!==(q&&q.layerMask&l.layerMask)&&l.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}O._ZeroVector=t.dI.Zero();class c{}class a{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(q){q!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=q,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const q of this._scene.meshes)if(q.Tc)for(const I of q.Tc)I._wasDispatched=!1;if(this._scene.spriteManagers)for(const q of this._scene.spriteManagers)q._wasDispatched=!1;for(const q of this._scene.Kx)q._wasDispatched=!1}constructor(q){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new c,this._maintainStateBetweenFrames=!1,this._scene=q;for(let I=a.MIN_RENDERINGGROUPS;I<a.MAX_RENDERINGGROUPS;I++)this._autoClearDepthStencil[I]={dc:!0,depth:!0,cc:!0}}getRenderingGroup(q){const I=q||0;return this._prepareRenderingGroup(I),this._renderingGroups[I]}_clearDepthStencilBuffer(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],I=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,q,I),this._depthStencilBufferAlreadyCleaned=!0)}render(q,I,l,w){const t=this._renderingGroupInfo;if(t.VI=this._scene,t.camera=this._scene.activeCamera,t.renderingManager=this,this._scene.spriteManagers&&w)for(let O=0;O<this._scene.spriteManagers.length;O++){const q=this._scene.spriteManagers[O];this.dispatchSprites(q)}for(let O=a.MIN_RENDERINGGROUPS;O<a.MAX_RENDERINGGROUPS;O++){this._depthStencilBufferAlreadyCleaned=O===a.MIN_RENDERINGGROUPS;const c=this._renderingGroups[O];if(!c||c._empty)continue;const F=1<<O;if(t.renderingGroupId=O,this._scene.onBeforeRenderingGroupObservable.notifyObservers(t,F),a.AUTOCLEAR){const q=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(O):this._autoClearDepthStencil[O];q&&q.dc&&this._clearDepthStencilBuffer(q.depth,q.cc)}for(const q of this._scene._beforeRenderingGroupDrawStage)q.action(O);c.render(q,w,l,I);for(const q of this._scene._afterRenderingGroupDrawStage)q.action(O);this._scene.onAfterRenderingGroupObservable.notifyObservers(t,F)}}reset(){if(!this.maintainStateBetweenFrames)for(let q=a.MIN_RENDERINGGROUPS;q<a.MAX_RENDERINGGROUPS;q++){const I=this._renderingGroups[q];I&&I.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let q=a.MIN_RENDERINGGROUPS;q<a.MAX_RENDERINGGROUPS;q++){const I=this._renderingGroups[q];I&&I.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let q=a.MIN_RENDERINGGROUPS;q<a.MAX_RENDERINGGROUPS;q++){const I=this._renderingGroups[q];I&&I.dispose()}}_prepareRenderingGroup(q){void 0===this._renderingGroups[q]&&(this._renderingGroups[q]=new O(q,this._scene,this._customOpaqueSortCompareFn[q],this._customAlphaTestSortCompareFn[q],this._customTransparentSortCompareFn[q]))}dispatchSprites(q){this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatchSprites(q))}dispatchParticles(q){this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatchParticles(q))}dispatch(q,I,l){void 0===I&&(I=q.getMesh()),this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatch(q,I,l))}setRenderingOrder(q){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[q]=I,this._customAlphaTestSortCompareFn[q]=l,this._customTransparentSortCompareFn[q]=w,this._renderingGroups[q]){const I=this._renderingGroups[q];I.opaqueSortCompareFn=this._customOpaqueSortCompareFn[q],I.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[q],I.transparentSortCompareFn=this._customTransparentSortCompareFn[q]}}setRenderingAutoClearDepthStencil(q,I){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[q]={dc:I,depth:l,cc:w}}getAutoClearDepthStencilSetup(q){return this._autoClearDepthStencil[q]}}a.MAX_RENDERINGGROUPS=4,a.MIN_RENDERINGGROUPS=0,a.AUTOCLEAR=!0}}]);