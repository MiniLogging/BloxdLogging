"use strict";(self["686i8587bmi"]=self["686i8587bmi"]||[]).push([[19],{12835:(h,d,T)=>{T.d(d,{e:()=>n,g:()=>X});var Y=T(12843),y=T(12596),C=T(12850);class n{get U(){return this._isDisposed}constructor(h,d,T){let y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7?arguments[7]:void 0,U=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,h&&h.Eh?this._engine=h.Eh().getEngine():this._engine=h,this._updatable=T,this._instanced=n,this._divisor=F||1,this._label=U,d instanceof Y.d?(this._data=null,this._buffer=d):(this._data=d,this._buffer=null),this.byteStride=X?y:y*Float32Array.BYTES_PER_ELEMENT,C||this.create()}createVertexBuffer(h,d,T,Y,y){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6?arguments[6]:void 0;const F=C?d:d*Float32Array.BYTES_PER_ELEMENT,U=Y?C?Y:Y*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new X(this._engine,this,h,this._updatable,!0,U,void 0===y?this._instanced:y,F,T,void 0,void 0,!0,this._divisor||n)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!h&&this._buffer||(h=h||this._data,h&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h),this._data=h):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(h,this._label),this._data=h):this._buffer=this._engine.createVertexBuffer(h,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.BX>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.BX,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.BX,void 0,this._label));y.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(h){this.create(h)}updateDirectly(h,d,T){let Y=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h,Y?d:d*Float32Array.BYTES_PER_ELEMENT,T?T*this.byteStride:void 0),this._data=0===d&&void 0===T?h:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class X{get U(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(h){const d=0!=h;this._instanceDivisor=h,d!==this._instanced&&(this._instanced=d,this._computeHashCode())}get _maxVerticesCount(){const h=this.getData();return h?Array.isArray(h)?h.length/(this.byteStride/4)-this.byteOffset/4:(h.byteLength-this.byteOffset)/this.byteStride:0}constructor(h,d,T,Y,y,F,U,Z,S,r){let c=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]&&arguments[11],f=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,J=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let W=!1;if(this.Hd=h,"object"===typeof Y&&null!==Y?(W=Y.updatable??!1,y=Y.postponeInternalCreation,F=Y.stride,U=Y.instanced,Z=Y.offset,S=Y.size,r=Y.type,c=Y.normalized??!1,O=Y.useBytes??!1,f=Y.divisor??1,J=Y.takeBufferOwnership??!1,this._label=Y.label):W=!!Y,d instanceof n?(this._buffer=d,this._ownsBuffer=J):(this._buffer=new n(h,d,W,F,y,U,O,f,this._label),this._ownsBuffer=!0),this.uniqueId=X._Counter++,this._kind=T,void 0===r){const h=this.getData();this.type=h?X.GetDataType(h):X.FLOAT}else this.type=r;const L=(0,C.q)(this.type);O?(this._size=S||(F?F/L:X.DeduceStride(T)),this.byteStride=F||this._buffer.byteStride||this._size*L,this.byteOffset=Z||0):(this._size=S||F||X.DeduceStride(T),this.byteStride=F?F*L:this._buffer.byteStride||this._size*L,this.byteOffset=(Z||0)*L),this.normalized=c,this._instanced=void 0!==U&&U,this._instanceDivisor=U?f:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var h;null===(h=this._buffer)||void 0===h||h._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(h,d){const T=this.getData();return T?(0,C.m)(T,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,h,d):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,C.q)(this.type)}getOffset(){return this.byteOffset/(0,C.q)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,C.q)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(h){this._buffer.create(h),this._alignBuffer()}update(h){this._buffer.update(h),this._alignBuffer()}updateDirectly(h,d){let T=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(h,d,void 0,T),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(h,d){(0,C.k)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,h,this.normalized,((h,T)=>{for(let Y=0;Y<this._size;Y++)d(h[Y],T+Y)}))}_alignBuffer(){}static DeduceStride(h){switch(h){case X.UVKind:case X.UV2Kind:case X.UV3Kind:case X.UV4Kind:case X.UV5Kind:case X.UV6Kind:return 2;case X.NormalKind:case X.PositionKind:return 3;case X.ColorKind:case X.ColorInstanceKind:case X.MatricesIndicesKind:case X.MatricesIndicesExtraKind:case X.MatricesWeightsKind:case X.MatricesWeightsExtraKind:case X.TangentKind:return 4;default:throw new Error("Invalid kind '"+h+"'")}}static GetDataType(h){return h instanceof Int8Array?X.BYTE:h instanceof Uint8Array?X.UNSIGNED_BYTE:h instanceof Int16Array?X.SHORT:h instanceof Uint16Array?X.UNSIGNED_SHORT:h instanceof Int32Array?X.INT:h instanceof Uint32Array?X.UNSIGNED_INT:X.FLOAT}static GetTypeByteLength(h){return(0,C.q)(h)}static ForEach(h,d,T,Y,y,n,X,F){(0,C.k)(h,d,T,Y,y,n,X,((h,d)=>{for(let T=0;T<Y;T++)F(h[T],d+T)}))}static GetFloatData(h,d,T,Y,y,n,X,F){return(0,C.m)(h,d,T,Y,y,n,X,F)}}X._Counter=0,X.BYTE=5120,X.UNSIGNED_BYTE=5121,X.SHORT=5122,X.UNSIGNED_SHORT=5123,X.INT=5124,X.UNSIGNED_INT=5125,X.FLOAT=5126,X.PositionKind="position",X.NormalKind="normal",X.TangentKind="tangent",X.UVKind="uv",X.UV2Kind="uv2",X.UV3Kind="uv3",X.UV4Kind="uv4",X.UV5Kind="uv5",X.UV6Kind="uv6",X.ColorKind="color",X.ColorInstanceKind="instanceColor",X.MatricesIndicesKind="matricesIndices",X.MatricesWeightsKind="matricesWeights",X.MatricesIndicesExtraKind="matricesIndicesExtra",X.MatricesWeightsExtraKind="matricesWeightsExtra"},12850:(h,d,T)=>{T.d(d,{d:()=>r,g:()=>S,k:()=>F,m:()=>U,q:()=>n,s:()=>X,v:()=>Z});var Y=T(12596);function y(h,d,T,Y){switch(d){case 5120:{let d=h.getInt8(T);return Y&&(d=Math.max(d/127,-1)),d}case 5121:{let d=h.getUint8(T);return Y&&(d/=255),d}case 5122:{let d=h.getInt16(T,!0);return Y&&(d=Math.max(d/32767,-1)),d}case 5123:{let d=h.getUint16(T,!0);return Y&&(d/=65535),d}case 5124:return h.getInt32(T,!0);case 5125:return h.getUint32(T,!0);case 5126:return h.getFloat32(T,!0);default:throw new Error(`Invalid component type ${d}`)}}function C(h,d,T,Y,y){switch(d){case 5120:Y&&(y=Math.round(127*y)),h.setInt8(T,y);break;case 5121:Y&&(y=Math.round(255*y)),h.setUint8(T,y);break;case 5122:Y&&(y=Math.round(32767*y)),h.setInt16(T,y,!0);break;case 5123:Y&&(y=Math.round(65535*y)),h.setUint16(T,y,!0);break;case 5124:h.setInt32(T,y,!0);break;case 5125:h.setUint32(T,y,!0);break;case 5126:h.setFloat32(T,y,!0);break;default:throw new Error(`Invalid component type ${d}`)}}function n(h){switch(h){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${h}'`)}}function X(h){switch(h){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${h}'`)}}function F(h,d,T,Y,X,F,U,Z){const S=new Array(Y),r=new Array(Y);if(h instanceof Array){let y=d/4;const C=T/4;for(let d=0;d<F;d+=Y){for(let d=0;d<Y;d++)S[d]=r[d]=h[y+d];Z(r,d);for(let d=0;d<Y;d++)S[d]!==r[d]&&(h[y+d]=r[d]);y+=C}}else{const c=ArrayBuffer.isView(h)?new DataView(h.buffer,h.byteOffset,h.byteLength):new DataView(h),O=n(X);for(let h=0;h<F;h+=Y){for(let h=0,T=d;h<Y;h++,T+=O)S[h]=r[h]=y(c,X,T,U);Z(r,h);for(let h=0,T=d;h<Y;h++,T+=O)S[h]!==r[h]&&C(c,X,T,U,r[h]);d+=T}}}function U(h,d,T,y,C,X,U,Z){const S=d*n(T),r=U*d;if(5126!==T||C!==S){const Y=new Float32Array(r);return F(h,y,C,d,T,r,X,((h,T)=>{for(let y=0;y<d;y++)Y[T+y]=h[y]})),Y}if(!(h instanceof Array||h instanceof Float32Array)||0!==y||h.length!==r){if(h instanceof Array){const d=y/4;return h.slice(d,d+r)}if(h instanceof ArrayBuffer)return new Float32Array(h,y,r);{const d=h.byteOffset+y;return 0!==(3&d)&&(Y.c.Warn("Float array must be aligned to 4-bytes border"),Z=!0),Z?new Float32Array(h.buffer.slice(d,d+r*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(h.buffer,d,r)}}return Z?h.slice():h}function Z(h,d,T,y,C,U,Z,S){const r=n(T),c=X(T),O=Z*d;if(Array.isArray(h)){if(0!==(3&y)||0!==(3&C))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const Y=y/4,n=C/4;if(Y+(Z-1)*n+d>h.length)throw new Error("Last accessed index is out of bounds.");if(n<d)throw new Error("Data stride cannot be smaller than the component size.");if(n!==d){const Y=new c(O);return F(h,y,C,d,T,O,U,((h,T)=>{for(let y=0;y<d;y++)Y[T+y]=h[y]})),Y}return new c(h.slice(Y,Y+O))}let f,J=y;h instanceof ArrayBuffer?f=h:(f=h.buffer,J+=h.byteOffset);if(J+(Z-1)*C+d*r>f.byteLength)throw new Error("Last accessed byte is out of bounds.");const W=d*r;if(C<W)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(C!==W){const h=new c(O);return F(f,J,C,d,T,O,U,((T,Y)=>{for(let y=0;y<d;y++)h[Y+y]=T[y]})),h}return 1!==r&&0!==(J&r-1)&&(Y.c.Warn("Array must be aligned to border of element size. Data will be copied."),S=!0),S?new c(f.slice(J,J+O*r)):new c(f,J,O)}function S(h,d,T,y,C,X,U,Z){const S=d*n(T),r=U*d;if(Z.length!==r)throw new Error("Output length is not valid");if(5126===T&&C===S)if(h instanceof Array){const d=y/4;Z.set(h,d)}else if(h instanceof ArrayBuffer){const d=new Float32Array(h,y,r);Z.set(d)}else{const d=h.byteOffset+y;if(0!==(3&d))return Y.c.Warn("Float array must be aligned to 4-bytes border"),void Z.set(new Float32Array(h.buffer.slice(d,d+r*Float32Array.BYTES_PER_ELEMENT)));const T=new Float32Array(h.buffer,d,r);Z.set(T)}else F(h,y,C,d,T,r,X,((h,T)=>{for(let Y=0;Y<d;Y++)Z[T+Y]=h[Y]}))}function r(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(h)){for(let y=0;y<d;y++)if(h[T+y]-Y>65535)return!0;return!1}return 4===h.BYTES_PER_ELEMENT}},12843:(h,d,T)=>{T.d(d,{d:()=>Y});class Y{get underlyingResource(){return null}constructor(){this.references=0,this.BX=0,this.is32Bits=!1,this.uniqueId=Y._Counter++}}Y._Counter=0},12875:(h,d,T)=>{T.d(d,{d:()=>y});var Y=T(12651);class y{static GetEffect(h){return void 0===h.getPipelineContext?h.effect:h}constructor(h){let d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=h.createDrawContext(),d&&(this.materialContext=h.createMaterialContext())}setEffect(h,d){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var Y;(this.effect=h,void 0!==d&&(this.defines=d),T)&&(null===(Y=this.drawContext)||void 0===Y||Y.reset())}dispose(){var h;let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const h=this.effect;d?h.dispose():Y.c.SetImmediate((()=>{h.getEngine().onEndFrameObservable.addOnce((()=>{h.dispose()}))})),this.effect=null}null===(h=this.drawContext)||void 0===h||h.dispose()}}},12955:(h,d,T)=>{T.d(d,{b:()=>y});var Y=T(12814);class y{static GetPlanes(h){const d=[];for(let T=0;T<6;T++)d.push(new Y.d(0,0,0,0));return y.GetPlanesToRef(h,d),d}static GetNearPlaneToRef(h,d){const T=h.m;d.normal.x=T[3]+T[2],d.normal.y=T[7]+T[6],d.normal.z=T[11]+T[10],d.d=T[15]+T[14],d.normalize()}static GetFarPlaneToRef(h,d){const T=h.m;d.normal.x=T[3]-T[2],d.normal.y=T[7]-T[6],d.normal.z=T[11]-T[10],d.d=T[15]-T[14],d.normalize()}static GetLeftPlaneToRef(h,d){const T=h.m;d.normal.x=T[3]+T[0],d.normal.y=T[7]+T[4],d.normal.z=T[11]+T[8],d.d=T[15]+T[12],d.normalize()}static GetRightPlaneToRef(h,d){const T=h.m;d.normal.x=T[3]-T[0],d.normal.y=T[7]-T[4],d.normal.z=T[11]-T[8],d.d=T[15]-T[12],d.normalize()}static GetTopPlaneToRef(h,d){const T=h.m;d.normal.x=T[3]-T[1],d.normal.y=T[7]-T[5],d.normal.z=T[11]-T[9],d.d=T[15]-T[13],d.normalize()}static GetBottomPlaneToRef(h,d){const T=h.m;d.normal.x=T[3]+T[1],d.normal.y=T[7]+T[5],d.normal.z=T[11]+T[9],d.d=T[15]+T[13],d.normalize()}static GetPlanesToRef(h,d){y.GetNearPlaneToRef(h,d[0]),y.GetFarPlaneToRef(h,d[1]),y.GetLeftPlaneToRef(h,d[2]),y.GetRightPlaneToRef(h,d[3]),y.GetTopPlaneToRef(h,d[4]),y.GetBottomPlaneToRef(h,d[5])}static IsPointInFrustum(h,d){for(let T=0;T<6;T++)if(d[T].dotCoordinate(h)<0)return!1;return!0}}},12966:(h,d,T)=>{T.d(d,{d:()=>y});var Y=T(12609);class y{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(h,d){y.Enabled&&(this._current+=h,d&&this._fetchResult())}beginMonitoring(){y.Enabled&&(this._startMonitoringTime=Y.b.Now)}endMonitoring(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!y.Enabled)return;h&&this.fetchNewFrame();const d=Y.b.Now;this._current=d-this._startMonitoringTime,h&&this._fetchResult()}sd(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const h=Y.b.Now;h-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=h,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}y.Enabled=!0},12858:(h,d,T)=>{T.d(d,{d:()=>y,h:()=>Y});class Y{constructor(h){this.length=0,this.data=new Array(h),this._id=Y._GlobalId++}push(h){this.data[this.length++]=h,this.length>this.data.length&&(this.data.length*=2)}forEach(h){for(let d=0;d<this.length;d++)h(this.data[d])}sort(h){this.data.sort(h)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(h){if(0!==h.length){this.length+h.length>this.data.length&&(this.data.length=2*(this.length+h.length));for(let d=0;d<h.length;d++)this.data[this.length++]=(h.data||h)[d]}}indexOf(h){const d=this.data.indexOf(h);return d>=this.length?-1:d}contains(h){return-1!==this.indexOf(h)}}Y._GlobalId=0;class y extends Y{constructor(){super(...arguments),this._duplicateId=0}push(h){super.push(h),h.__smartArrayFlags||(h.__smartArrayFlags={}),h.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(h){return(!h.__smartArrayFlags||h.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(h),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(h){if(0!==h.length){this.length+h.length>this.data.length&&(this.data.length=2*(this.length+h.length));for(let d=0;d<h.length;d++){const T=(h.data||h)[d];this.pushNoDuplicate(T)}}}}},12831:(h,d,T)=>{T.d(d,{e:()=>C});var Y=T(12835),y=T(12583);class C{constructor(h){this._vertexBuffers={},this.onBeforeRenderObservable=new y.e,this._scene=h}_prepareBuffers(){if(this._vertexBuffers[Y.g.PositionKind])return;const h=[];h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),this._vertexBuffers[Y.g.PositionKind]=new Y.g(this._scene.getEngine(),h,Y.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const h=[];h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(h)}_rebuild(){const h=this._vertexBuffers[Y.g.PositionKind];h&&(h._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const T=this._scene.activeCamera;return!!T&&(d=d||T._postProcesses.filter((h=>null!=h)),!(!d||0===d.length||!this._scene.postProcessesEnabled)&&(d[0].activate(T,h,null!==d&&void 0!==d),!0))}directRender(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:h.length;const X=this._scene.getEngine();for(let U=0;U<n;U++){var F;if(U<h.length-1)h[U+1].activate(this._scene.activeCamera||this._scene,null===d||void 0===d?void 0:d.texture);else d?X.bindFramebuffer(d,Y,void 0,void 0,T,y):C||X.restoreDefaultFramebuffer(),null===(F=X._debugInsertMarker)||void 0===F||F.call(X,`post process ${h[U].name} output`);const n=h[U],Z=n.apply();Z&&(n.onBeforeRenderObservable.notifyObservers(Z),this._prepareBuffers(),X.bindBuffers(this._vertexBuffers,this._indexBuffer,Z),X.drawElementsType(0,0,6),n.onAfterRenderObservable.notifyObservers(Z))}X.setDepthBuffer(!0),X.setDepthWrite(!0)}_finalizeFrame(h,d,T,Y){let y=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const C=this._scene.activeCamera;if(!C)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(Y=Y||C._postProcesses.filter((h=>null!=h))).length||!this._scene.postProcessesEnabled)return;const n=this._scene.getEngine();for(let F=0,U=Y.length;F<U;F++){const Z=Y[F];var X;if(F<U-1)Z._outputTexture=Y[F+1].activate(C,null===d||void 0===d?void 0:d.texture);else d?(n.bindFramebuffer(d,T,void 0,void 0,y),Z._outputTexture=d):(n.restoreDefaultFramebuffer(),Z._outputTexture=null),null===(X=n._debugInsertMarker)||void 0===X||X.call(n,`post process ${Y[F].name} output`);if(h)break;const S=Z.apply();S&&(Z.onBeforeRenderObservable.notifyObservers(S),this._prepareBuffers(),n.bindBuffers(this._vertexBuffers,this._indexBuffer,S),n.drawElementsType(0,0,6),Z.onAfterRenderObservable.notifyObservers(S))}n.setDepthBuffer(!0),n.setDepthWrite(!0),n.setAlphaMode(0)}dispose(){const h=this._vertexBuffers[Y.g.PositionKind];h&&(h.dispose(),this._vertexBuffers[Y.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12854:(h,d,T)=>{T.d(d,{d:()=>X});var Y=T(12858),y=T(12765);class C{set opaqueSortCompareFn(h){this._opaqueSortCompareFn=h||C.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(h){this._alphaTestSortCompareFn=h||C.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(h){this._transparentSortCompareFn=h||C.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(h,d){let T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=h,this._opaqueSubMeshes=new Y.h(256),this._transparentSubMeshes=new Y.h(256),this._alphaTestSubMeshes=new Y.h(256),this._depthOnlySubMeshes=new Y.h(256),this._particleSystems=new Y.h(256),this._spriteManagers=new Y.h(256),this._empty=!0,this._edgesRenderers=new Y.d(16),this._scene=d,this.opaqueSortCompareFn=T,this.alphaTestSortCompareFn=y,this.transparentSortCompareFn=C}render(h,d,T,Y){if(h)return void h(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const y=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(y.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),y.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const C=y.getStencilBuffer();if(y.setStencilBuffer(!1),d&&this._renderSprites(),T&&this._renderParticles(Y),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(y.setStencilBuffer(C),this._scene.useOrderIndependentTransparency){const h=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);h.length&&this._renderTransparent(h)}else this._renderTransparent(this._transparentSubMeshes);y.setAlphaMode(0)}if(y.setStencilBuffer(!1),this._edgesRenderers.length){for(let h=0;h<this._edgesRenderers.length;h++)this._edgesRenderers.data[h].render();y.setAlphaMode(0)}y.setStencilBuffer(C)}_renderOpaqueSorted(h){C._RenderSorted(h,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(h){C._RenderSorted(h,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(h){C._RenderSorted(h,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(h,d,T,Y){let n,X=0;const F=T?T.globalPosition:C._ZeroVector;if(Y)for(;X<h.length;X++)n=h.data[X],n._alphaIndex=n.getMesh().alphaIndex,n._distanceToCamera=y.pd.Distance(n.getBoundingInfo().boundingSphere.centerWorld,F);const U=h.length===h.data.length?h.data:h.data.slice(0,h.length);d&&U.sort(d);const Z=U[0].getMesh().Eh();for(X=0;X<U.length;X++)if(n=U[X],!Z._activeMeshesFrozenButKeepClipping||n.isInFrustum(Z._frustumPlanes)){if(Y){const h=n.jh();if(h&&h.needDepthPrePass){const d=h.Eh().getEngine();d.setColorWrite(!1),d.setAlphaMode(0),n.render(!1),d.setColorWrite(!0)}}n.render(Y)}}static defaultTransparentSortCompare(h,d){return h._alphaIndex>d._alphaIndex?1:h._alphaIndex<d._alphaIndex?-1:C.backToFrontSortCompare(h,d)}static backToFrontSortCompare(h,d){return h._distanceToCamera<d._distanceToCamera?1:h._distanceToCamera>d._distanceToCamera?-1:0}static frontToBackSortCompare(h,d){return h._distanceToCamera<d._distanceToCamera?-1:h._distanceToCamera>d._distanceToCamera?1:0}static PainterSortCompare(h,d){const T=h.getMesh(),Y=d.getMesh();return T.material&&Y.material?T.material.uniqueId-Y.material.uniqueId:T.uniqueId-Y.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(h,d,T){void 0===d&&(d=h.getMesh()),void 0===T&&(T=h.jh()),null!==T&&void 0!==T&&(T.needAlphaBlendingForMesh(d)?this._transparentSubMeshes.push(h):T.needAlphaTestingForMesh(d)?(T.needDepthPrePass&&this._depthOnlySubMeshes.push(h),this._alphaTestSubMeshes.push(h)):(T.needDepthPrePass&&this._depthOnlySubMeshes.push(h),this._opaqueSubMeshes.push(h)),d._renderingGroup=this,d._edgesRenderer&&d.isEnabled()&&d.isVisible&&d._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(d._edgesRenderer),this._empty=!1)}dispatchSprites(h){this._spriteManagers.push(h),this._empty=!1}dispatchParticles(h){this._particleSystems.push(h),this._empty=!1}_renderParticles(h){if(0===this._particleSystems.length)return;const d=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let T=0;T<this._particleSystems.length;T++){const Y=this._particleSystems.data[T];if(0===(d&&d.layerMask&Y.layerMask))continue;const y=Y.nd;y.position&&h&&-1===h.indexOf(y)||this._scene._activeParticles.addCount(Y.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const h=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let d=0;d<this._spriteManagers.length;d++){const T=this._spriteManagers.data[d];0!==(h&&h.layerMask&T.layerMask)&&T.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}C._ZeroVector=y.pd.Zero();class n{}class X{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(h){h!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=h,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const h of this._scene.meshes)if(h.ld)for(const d of h.ld)d._wasDispatched=!1;if(this._scene.spriteManagers)for(const h of this._scene.spriteManagers)h._wasDispatched=!1;for(const h of this._scene.Fr)h._wasDispatched=!1}constructor(h){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new n,this._maintainStateBetweenFrames=!1,this._scene=h;for(let d=X.MIN_RENDERINGGROUPS;d<X.MAX_RENDERINGGROUPS;d++)this._autoClearDepthStencil[d]={Kd:!0,depth:!0,xd:!0}}getRenderingGroup(h){const d=h||0;return this._prepareRenderingGroup(d),this._renderingGroups[d]}_clearDepthStencilBuffer(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],d=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,h,d),this._depthStencilBufferAlreadyCleaned=!0)}render(h,d,T,Y){const y=this._renderingGroupInfo;if(y.qd=this._scene,y.camera=this._scene.activeCamera,y.renderingManager=this,this._scene.spriteManagers&&Y)for(let C=0;C<this._scene.spriteManagers.length;C++){const h=this._scene.spriteManagers[C];this.dispatchSprites(h)}for(let C=X.MIN_RENDERINGGROUPS;C<X.MAX_RENDERINGGROUPS;C++){this._depthStencilBufferAlreadyCleaned=C===X.MIN_RENDERINGGROUPS;const n=this._renderingGroups[C];if(!n||n._empty)continue;const F=1<<C;if(y.renderingGroupId=C,this._scene.onBeforeRenderingGroupObservable.notifyObservers(y,F),X.AUTOCLEAR){const h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(C):this._autoClearDepthStencil[C];h&&h.Kd&&this._clearDepthStencilBuffer(h.depth,h.xd)}for(const h of this._scene._beforeRenderingGroupDrawStage)h.action(C);n.render(h,Y,T,d);for(const h of this._scene._afterRenderingGroupDrawStage)h.action(C);this._scene.onAfterRenderingGroupObservable.notifyObservers(y,F)}}reset(){if(!this.maintainStateBetweenFrames)for(let h=X.MIN_RENDERINGGROUPS;h<X.MAX_RENDERINGGROUPS;h++){const d=this._renderingGroups[h];d&&d.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let h=X.MIN_RENDERINGGROUPS;h<X.MAX_RENDERINGGROUPS;h++){const d=this._renderingGroups[h];d&&d.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let h=X.MIN_RENDERINGGROUPS;h<X.MAX_RENDERINGGROUPS;h++){const d=this._renderingGroups[h];d&&d.dispose()}}_prepareRenderingGroup(h){void 0===this._renderingGroups[h]&&(this._renderingGroups[h]=new C(h,this._scene,this._customOpaqueSortCompareFn[h],this._customAlphaTestSortCompareFn[h],this._customTransparentSortCompareFn[h]))}dispatchSprites(h){this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatchSprites(h))}dispatchParticles(h){this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatchParticles(h))}dispatch(h,d,T){void 0===d&&(d=h.getMesh()),this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(d.renderingGroupId).dispatch(h,d,T))}setRenderingOrder(h){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,T=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Y=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[h]=d,this._customAlphaTestSortCompareFn[h]=T,this._customTransparentSortCompareFn[h]=Y,this._renderingGroups[h]){const d=this._renderingGroups[h];d.opaqueSortCompareFn=this._customOpaqueSortCompareFn[h],d.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[h],d.transparentSortCompareFn=this._customTransparentSortCompareFn[h]}}setRenderingAutoClearDepthStencil(h,d){let T=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Y=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[h]={Kd:d,depth:T,xd:Y}}getAutoClearDepthStencilSetup(h){return this._autoClearDepthStencil[h]}}X.MAX_RENDERINGGROUPS=4,X.MIN_RENDERINGGROUPS=0,X.AUTOCLEAR=!0}}]);