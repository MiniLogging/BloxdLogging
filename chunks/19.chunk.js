"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[19],{11250:(g,w,q)=>{q.d(w,{e:()=>S,h:()=>i});var R=q(11256),o=q(11011),r=q(11262);class S{get L(){return this._isDisposed}constructor(g,w,q){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],T=arguments.length>7?arguments[7]:void 0,z=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,g&&g.Ng?this._engine=g.Ng().getEngine():this._engine=g,this._updatable=q,this._instanced=S,this._divisor=T||1,this._label=z,w instanceof R.b?(this._data=null,this._buffer=w):(this._data=w,this._buffer=null),this.byteStride=i?o:o*Float32Array.BYTES_PER_ELEMENT,r||this.create()}createVertexBuffer(g,w,q,R,o){let r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6?arguments[6]:void 0;const T=r?w:w*Float32Array.BYTES_PER_ELEMENT,z=R?r?R:R*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new i(this._engine,this,g,this._updatable,!0,z,void 0===o?this._instanced:o,T,q,void 0,void 0,!0,this._divisor||S)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!g&&this._buffer||(g=g||this._data,g&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,g),this._data=g):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(g,this._label),this._data=g):this._buffer=this._engine.createVertexBuffer(g,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Di>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Di,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Di,void 0,this._label));o.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(g){this.create(g)}updateDirectly(g,w,q){let R=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,g,R?w:w*Float32Array.BYTES_PER_ELEMENT,q?q*this.byteStride:void 0),this._data=0===w&&void 0===q?g:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class i{get L(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(g){const w=0!=g;this._instanceDivisor=g,w!==this._instanced&&(this._instanced=w,this._computeHashCode())}get _maxVerticesCount(){const g=this.getData();return g?Array.isArray(g)?g.length/(this.byteStride/4)-this.byteOffset/4:(g.byteLength-this.byteOffset)/this.byteStride:0}constructor(g,w,q,R,o,T,z,t,m,e){let y=arguments.length>10&&void 0!==arguments[10]&&arguments[10],L=arguments.length>11&&void 0!==arguments[11]&&arguments[11],A=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,l=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let J=!1;if(this.mw=g,"object"===typeof R&&null!==R?(J=R.updatable??!1,o=R.postponeInternalCreation,T=R.stride,z=R.instanced,t=R.offset,m=R.size,e=R.type,y=R.normalized??!1,L=R.useBytes??!1,A=R.divisor??1,l=R.takeBufferOwnership??!1,this._label=R.label):J=!!R,w instanceof S?(this._buffer=w,this._ownsBuffer=l):(this._buffer=new S(g,w,J,T,o,z,L,A,this._label),this._ownsBuffer=!0),this.uniqueId=i._Counter++,this._kind=q,void 0===e){const g=this.getData();this.type=g?i.GetDataType(g):i.FLOAT}else this.type=e;const x=(0,r.j)(this.type);L?(this._size=m||(T?T/x:i.DeduceStride(q)),this.byteStride=T||this._buffer.byteStride||this._size*x,this.byteOffset=t||0):(this._size=m||T||i.DeduceStride(q),this.byteStride=T?T*x:this._buffer.byteStride||this._size*x,this.byteOffset=(t||0)*x),this.normalized=y,this._instanced=void 0!==z&&z,this._instanceDivisor=z?A:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var g;null===(g=this._buffer)||void 0===g||g._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(g,w){const q=this.getData();return q?(0,r.g)(q,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,g,w):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,r.j)(this.type)}getOffset(){return this.byteOffset/(0,r.j)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,r.j)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(g){this._buffer.create(g),this._alignBuffer()}update(g){this._buffer.update(g),this._alignBuffer()}updateDirectly(g,w){let q=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(g,w,void 0,q),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(g,w){(0,r.f)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,g,this.normalized,((g,q)=>{for(let R=0;R<this._size;R++)w(g[R],q+R)}))}_alignBuffer(){}static DeduceStride(g){switch(g){case i.UVKind:case i.UV2Kind:case i.UV3Kind:case i.UV4Kind:case i.UV5Kind:case i.UV6Kind:return 2;case i.NormalKind:case i.PositionKind:return 3;case i.ColorKind:case i.ColorInstanceKind:case i.MatricesIndicesKind:case i.MatricesIndicesExtraKind:case i.MatricesWeightsKind:case i.MatricesWeightsExtraKind:case i.TangentKind:return 4;default:throw new Error("Invalid kind '"+g+"'")}}static GetDataType(g){return g instanceof Int8Array?i.BYTE:g instanceof Uint8Array?i.UNSIGNED_BYTE:g instanceof Int16Array?i.SHORT:g instanceof Uint16Array?i.UNSIGNED_SHORT:g instanceof Int32Array?i.INT:g instanceof Uint32Array?i.UNSIGNED_INT:i.FLOAT}static GetTypeByteLength(g){return(0,r.j)(g)}static ForEach(g,w,q,R,o,S,i,T){(0,r.f)(g,w,q,R,o,S,i,((g,w)=>{for(let q=0;q<R;q++)T(g[q],w+q)}))}static GetFloatData(g,w,q,R,o,S,i,T){return(0,r.g)(g,w,q,R,o,S,i,T)}}i._Counter=0,i.BYTE=5120,i.UNSIGNED_BYTE=5121,i.SHORT=5122,i.UNSIGNED_SHORT=5123,i.INT=5124,i.UNSIGNED_INT=5125,i.FLOAT=5126,i.PositionKind="position",i.NormalKind="normal",i.TangentKind="tangent",i.UVKind="uv",i.UV2Kind="uv2",i.UV3Kind="uv3",i.UV4Kind="uv4",i.UV5Kind="uv5",i.UV6Kind="uv6",i.ColorKind="color",i.ColorInstanceKind="instanceColor",i.MatricesIndicesKind="matricesIndices",i.MatricesWeightsKind="matricesWeights",i.MatricesIndicesExtraKind="matricesIndicesExtra",i.MatricesWeightsExtraKind="matricesWeightsExtra"},11262:(g,w,q)=>{q.d(w,{b:()=>e,d:()=>m,f:()=>T,g:()=>z,j:()=>S,m:()=>i,o:()=>t});var R=q(11011);function o(g,w,q,R){switch(w){case 5120:{let w=g.getInt8(q);return R&&(w=Math.max(w/127,-1)),w}case 5121:{let w=g.getUint8(q);return R&&(w/=255),w}case 5122:{let w=g.getInt16(q,!0);return R&&(w=Math.max(w/32767,-1)),w}case 5123:{let w=g.getUint16(q,!0);return R&&(w/=65535),w}case 5124:return g.getInt32(q,!0);case 5125:return g.getUint32(q,!0);case 5126:return g.getFloat32(q,!0);default:throw new Error(`Invalid component type ${w}`)}}function r(g,w,q,R,o){switch(w){case 5120:R&&(o=Math.round(127*o)),g.setInt8(q,o);break;case 5121:R&&(o=Math.round(255*o)),g.setUint8(q,o);break;case 5122:R&&(o=Math.round(32767*o)),g.setInt16(q,o,!0);break;case 5123:R&&(o=Math.round(65535*o)),g.setUint16(q,o,!0);break;case 5124:g.setInt32(q,o,!0);break;case 5125:g.setUint32(q,o,!0);break;case 5126:g.setFloat32(q,o,!0);break;default:throw new Error(`Invalid component type ${w}`)}}function S(g){switch(g){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${g}'`)}}function i(g){switch(g){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${g}'`)}}function T(g,w,q,R,i,T,z,t){const m=new Array(R),e=new Array(R);if(g instanceof Array){let o=w/4;const r=q/4;for(let w=0;w<T;w+=R){for(let w=0;w<R;w++)m[w]=e[w]=g[o+w];t(e,w);for(let w=0;w<R;w++)m[w]!==e[w]&&(g[o+w]=e[w]);o+=r}}else{const y=ArrayBuffer.isView(g)?new DataView(g.buffer,g.byteOffset,g.byteLength):new DataView(g),L=S(i);for(let g=0;g<T;g+=R){for(let g=0,q=w;g<R;g++,q+=L)m[g]=e[g]=o(y,i,q,z);t(e,g);for(let g=0,q=w;g<R;g++,q+=L)m[g]!==e[g]&&r(y,i,q,z,e[g]);w+=q}}}function z(g,w,q,o,r,i,z,t){const m=w*S(q),e=z*w;if(5126!==q||r!==m){const R=new Float32Array(e);return T(g,o,r,w,q,e,i,((g,q)=>{for(let o=0;o<w;o++)R[q+o]=g[o]})),R}if(!(g instanceof Array||g instanceof Float32Array)||0!==o||g.length!==e){if(g instanceof Array){const w=o/4;return g.slice(w,w+e)}if(g instanceof ArrayBuffer)return new Float32Array(g,o,e);{const w=g.byteOffset+o;return 0!==(3&w)&&(R.d.Warn("Float array must be aligned to 4-bytes border"),t=!0),t?new Float32Array(g.buffer.slice(w,w+e*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(g.buffer,w,e)}}return t?g.slice():g}function t(g,w,q,o,r,z,t,m){const e=S(q),y=i(q),L=t*w;if(Array.isArray(g)){if(0!==(3&o)||0!==(3&r))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const R=o/4,S=r/4;if(R+(t-1)*S+w>g.length)throw new Error("Last accessed index is out of bounds.");if(S<w)throw new Error("Data stride cannot be smaller than the component size.");if(S!==w){const R=new y(L);return T(g,o,r,w,q,L,z,((g,q)=>{for(let o=0;o<w;o++)R[q+o]=g[o]})),R}return new y(g.slice(R,R+L))}let A,l=o;g instanceof ArrayBuffer?A=g:(A=g.buffer,l+=g.byteOffset);if(l+(t-1)*r+w*e>A.byteLength)throw new Error("Last accessed byte is out of bounds.");const J=w*e;if(r<J)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(r!==J){const g=new y(L);return T(A,l,r,w,q,L,z,((q,R)=>{for(let o=0;o<w;o++)g[R+o]=q[o]})),g}return 1!==e&&0!==(l&e-1)&&(R.d.Warn("Array must be aligned to border of element size. Data will be copied."),m=!0),m?new y(A.slice(l,l+L*e)):new y(A,l,L)}function m(g,w,q,o,r,i,z,t){const m=w*S(q),e=z*w;if(t.length!==e)throw new Error("Output length is not valid");if(5126===q&&r===m)if(g instanceof Array){const w=o/4;t.set(g,w)}else if(g instanceof ArrayBuffer){const w=new Float32Array(g,o,e);t.set(w)}else{const w=g.byteOffset+o;if(0!==(3&w))return R.d.Warn("Float array must be aligned to 4-bytes border"),void t.set(new Float32Array(g.buffer.slice(w,w+e*Float32Array.BYTES_PER_ELEMENT)));const q=new Float32Array(g.buffer,w,e);t.set(q)}else T(g,o,r,w,q,e,i,((g,q)=>{for(let R=0;R<w;R++)t[q+R]=g[R]}))}function e(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(g)){for(let o=0;o<w;o++)if(g[q+o]-R>65535)return!0;return!1}return 4===g.BYTES_PER_ELEMENT}},11256:(g,w,q)=>{q.d(w,{b:()=>R});class R{get underlyingResource(){return null}constructor(){this.references=0,this.Di=0,this.is32Bits=!1,this.uniqueId=R._Counter++}}R._Counter=0},11284:(g,w,q)=>{q.d(w,{e:()=>o});var R=q(11071);class o{static GetEffect(g){return void 0===g.getPipelineContext?g.effect:g}constructor(g){let w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=g.createDrawContext(),w&&(this.materialContext=g.createMaterialContext())}setEffect(g,w){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var R;(this.effect=g,void 0!==w&&(this.defines=w),q)&&(null===(R=this.drawContext)||void 0===R||R.reset())}dispose(){var g;let w=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const g=this.effect;w?g.dispose():R.e.SetImmediate((()=>{g.getEngine().onEndFrameObservable.addOnce((()=>{g.dispose()}))})),this.effect=null}null===(g=this.drawContext)||void 0===g||g.dispose()}}},11363:(g,w,q)=>{q.d(w,{b:()=>o});var R=q(11238);class o{static GetPlanes(g){const w=[];for(let q=0;q<6;q++)w.push(new R.d(0,0,0,0));return o.GetPlanesToRef(g,w),w}static GetNearPlaneToRef(g,w){const q=g.m;w.Lw.x=q[3]+q[2],w.Lw.y=q[7]+q[6],w.Lw.z=q[11]+q[10],w.d=q[15]+q[14],w.normalize()}static GetFarPlaneToRef(g,w){const q=g.m;w.Lw.x=q[3]-q[2],w.Lw.y=q[7]-q[6],w.Lw.z=q[11]-q[10],w.d=q[15]-q[14],w.normalize()}static GetLeftPlaneToRef(g,w){const q=g.m;w.Lw.x=q[3]+q[0],w.Lw.y=q[7]+q[4],w.Lw.z=q[11]+q[8],w.d=q[15]+q[12],w.normalize()}static GetRightPlaneToRef(g,w){const q=g.m;w.Lw.x=q[3]-q[0],w.Lw.y=q[7]-q[4],w.Lw.z=q[11]-q[8],w.d=q[15]-q[12],w.normalize()}static GetTopPlaneToRef(g,w){const q=g.m;w.Lw.x=q[3]-q[1],w.Lw.y=q[7]-q[5],w.Lw.z=q[11]-q[9],w.d=q[15]-q[13],w.normalize()}static GetBottomPlaneToRef(g,w){const q=g.m;w.Lw.x=q[3]+q[1],w.Lw.y=q[7]+q[5],w.Lw.z=q[11]+q[9],w.d=q[15]+q[13],w.normalize()}static GetPlanesToRef(g,w){o.GetNearPlaneToRef(g,w[0]),o.GetFarPlaneToRef(g,w[1]),o.GetLeftPlaneToRef(g,w[2]),o.GetRightPlaneToRef(g,w[3]),o.GetTopPlaneToRef(g,w[4]),o.GetBottomPlaneToRef(g,w[5])}static IsPointInFrustum(g,w){for(let q=0;q<6;q++)if(w[q].dotCoordinate(g)<0)return!1;return!0}}},11374:(g,w,q)=>{q.d(w,{c:()=>o});var R=q(11023);class o{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(g,w){o.Enabled&&(this._current+=g,w&&this._fetchResult())}beginMonitoring(){o.Enabled&&(this._startMonitoringTime=R.e.Now)}endMonitoring(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!o.Enabled)return;g&&this.fetchNewFrame();const w=R.e.Now;this._current=w-this._startMonitoringTime,g&&this._fetchResult()}nS(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const g=R.e.Now;g-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=g,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}o.Enabled=!0},11270:(g,w,q)=>{q.d(w,{c:()=>o,e:()=>R});class R{constructor(g){this.length=0,this.data=new Array(g),this._id=R._GlobalId++}push(g){this.data[this.length++]=g,this.length>this.data.length&&(this.data.length*=2)}forEach(g){for(let w=0;w<this.length;w++)g(this.data[w])}sort(g){this.data.sort(g)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(g){if(0!==g.length){this.length+g.length>this.data.length&&(this.data.length=2*(this.length+g.length));for(let w=0;w<g.length;w++)this.data[this.length++]=(g.data||g)[w]}}indexOf(g){const w=this.data.indexOf(g);return w>=this.length?-1:w}contains(g){return-1!==this.indexOf(g)}}R._GlobalId=0;class o extends R{constructor(){super(...arguments),this._duplicateId=0}push(g){super.push(g),g.__smartArrayFlags||(g.__smartArrayFlags={}),g.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(g){return(!g.__smartArrayFlags||g.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(g),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(g){if(0!==g.length){this.length+g.length>this.data.length&&(this.data.length=2*(this.length+g.length));for(let w=0;w<g.length;w++){const q=(g.data||g)[w];this.pushNoDuplicate(q)}}}}},11248:(g,w,q)=>{q.d(w,{e:()=>r});var R=q(11250),o=q(10998);class r{constructor(g){this._vertexBuffers={},this.onBeforeRenderObservable=new o.b,this._scene=g}_prepareBuffers(){if(this._vertexBuffers[R.h.PositionKind])return;const g=[];g.push(1,1),g.push(-1,1),g.push(-1,-1),g.push(1,-1),this._vertexBuffers[R.h.PositionKind]=new R.h(this._scene.getEngine(),g,R.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const g=[];g.push(0),g.push(1),g.push(2),g.push(0),g.push(2),g.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(g)}_rebuild(){const g=this._vertexBuffers[R.h.PositionKind];g&&(g._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const q=this._scene.activeCamera;return!!q&&(w=w||q._postProcesses.filter((g=>null!=g)),!(!w||0===w.length||!this._scene.postProcessesEnabled)&&(w[0].activate(q,g,null!==w&&void 0!==w),!0))}directRender(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=arguments.length>6&&void 0!==arguments[6]?arguments[6]:g.length;const i=this._scene.getEngine();for(let z=0;z<S;z++){var T;if(z<g.length-1)g[z+1].activate(this._scene.activeCamera||this._scene,null===w||void 0===w?void 0:w.texture);else w?i.bindFramebuffer(w,R,void 0,void 0,q,o):r||i.restoreDefaultFramebuffer(),null===(T=i._debugInsertMarker)||void 0===T||T.call(i,`post process ${g[z].name} output`);const S=g[z],t=S.apply();t&&(S.onBeforeRenderObservable.notifyObservers(t),this._prepareBuffers(),i.bindBuffers(this._vertexBuffers,this._indexBuffer,t),i.drawElementsType(0,0,6),S.onAfterRenderObservable.notifyObservers(t))}i.setDepthBuffer(!0),i.setDepthWrite(!0)}_finalizeFrame(g,w,q,R){let o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const r=this._scene.activeCamera;if(!r)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(R=R||r._postProcesses.filter((g=>null!=g))).length||!this._scene.postProcessesEnabled)return;const S=this._scene.getEngine();for(let T=0,z=R.length;T<z;T++){const t=R[T];var i;if(T<z-1)t._outputTexture=R[T+1].activate(r,null===w||void 0===w?void 0:w.texture);else w?(S.bindFramebuffer(w,q,void 0,void 0,o),t._outputTexture=w):(S.restoreDefaultFramebuffer(),t._outputTexture=null),null===(i=S._debugInsertMarker)||void 0===i||i.call(S,`post process ${R[T].name} output`);if(g)break;const m=t.apply();m&&(t.onBeforeRenderObservable.notifyObservers(m),this._prepareBuffers(),S.bindBuffers(this._vertexBuffers,this._indexBuffer,m),S.drawElementsType(0,0,6),t.onAfterRenderObservable.notifyObservers(m))}S.setDepthBuffer(!0),S.setDepthWrite(!0),S.setAlphaMode(0)}dispose(){const g=this._vertexBuffers[R.h.PositionKind];g&&(g.dispose(),this._vertexBuffers[R.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11268:(g,w,q)=>{q.d(w,{b:()=>i});var R=q(11270),o=q(11180);class r{set opaqueSortCompareFn(g){this._opaqueSortCompareFn=g||r.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(g){this._alphaTestSortCompareFn=g||r.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(g){this._transparentSortCompareFn=g||r.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(g,w){let q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=g,this._opaqueSubMeshes=new R.e(256),this._transparentSubMeshes=new R.e(256),this._alphaTestSubMeshes=new R.e(256),this._depthOnlySubMeshes=new R.e(256),this._particleSystems=new R.e(256),this._spriteManagers=new R.e(256),this._empty=!0,this._edgesRenderers=new R.c(16),this._scene=w,this.opaqueSortCompareFn=q,this.alphaTestSortCompareFn=o,this.transparentSortCompareFn=r}render(g,w,q,R){if(g)return void g(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const o=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(o.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),o.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const r=o.getStencilBuffer();if(o.setStencilBuffer(!1),w&&this._renderSprites(),q&&this._renderParticles(R),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(o.setStencilBuffer(r),this._scene.useOrderIndependentTransparency){const g=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);g.length&&this._renderTransparent(g)}else this._renderTransparent(this._transparentSubMeshes);o.setAlphaMode(0)}if(o.setStencilBuffer(!1),this._edgesRenderers.length){for(let g=0;g<this._edgesRenderers.length;g++)this._edgesRenderers.data[g].render();o.setAlphaMode(0)}o.setStencilBuffer(r)}_renderOpaqueSorted(g){r._RenderSorted(g,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(g){r._RenderSorted(g,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(g){r._RenderSorted(g,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(g,w,q,R){let S,i=0;const T=q?q.globalPosition:r._ZeroVector;if(R)for(;i<g.length;i++)S=g.data[i],S._alphaIndex=S.getMesh().alphaIndex,S._distanceToCamera=o.ew.Distance(S.getBoundingInfo().boundingSphere.centerWorld,T);const z=g.length===g.data.length?g.data:g.data.slice(0,g.length);w&&z.sort(w);const t=z[0].getMesh().Ng();for(i=0;i<z.length;i++)if(S=z[i],!t._activeMeshesFrozenButKeepClipping||S.isInFrustum(t._frustumPlanes)){if(R){const g=S.bg();if(g&&g.needDepthPrePass){const w=g.Ng().getEngine();w.setColorWrite(!1),w.setAlphaMode(0),S.render(!1),w.setColorWrite(!0)}}S.render(R)}}static defaultTransparentSortCompare(g,w){return g._alphaIndex>w._alphaIndex?1:g._alphaIndex<w._alphaIndex?-1:r.backToFrontSortCompare(g,w)}static backToFrontSortCompare(g,w){return g._distanceToCamera<w._distanceToCamera?1:g._distanceToCamera>w._distanceToCamera?-1:0}static frontToBackSortCompare(g,w){return g._distanceToCamera<w._distanceToCamera?-1:g._distanceToCamera>w._distanceToCamera?1:0}static PainterSortCompare(g,w){const q=g.getMesh(),R=w.getMesh();return q.material&&R.material?q.material.uniqueId-R.material.uniqueId:q.uniqueId-R.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(g,w,q){void 0===w&&(w=g.getMesh()),void 0===q&&(q=g.bg()),null!==q&&void 0!==q&&(q.needAlphaBlendingForMesh(w)?this._transparentSubMeshes.push(g):q.needAlphaTestingForMesh(w)?(q.needDepthPrePass&&this._depthOnlySubMeshes.push(g),this._alphaTestSubMeshes.push(g)):(q.needDepthPrePass&&this._depthOnlySubMeshes.push(g),this._opaqueSubMeshes.push(g)),w._renderingGroup=this,w._edgesRenderer&&w.isEnabled()&&w.isVisible&&w._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(w._edgesRenderer),this._empty=!1)}dispatchSprites(g){this._spriteManagers.push(g),this._empty=!1}dispatchParticles(g){this._particleSystems.push(g),this._empty=!1}_renderParticles(g){if(0===this._particleSystems.length)return;const w=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let q=0;q<this._particleSystems.length;q++){const R=this._particleSystems.data[q];if(0===(w&&w.layerMask&R.layerMask))continue;const o=R.k;o.position&&g&&-1===g.indexOf(o)||this._scene._activeParticles.addCount(R.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const g=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let w=0;w<this._spriteManagers.length;w++){const q=this._spriteManagers.data[w];0!==(g&&g.layerMask&q.layerMask)&&q.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}r._ZeroVector=o.ew.Zero();class S{}class i{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(g){g!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=g,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const g of this._scene.meshes)if(g.wi)for(const w of g.wi)w._wasDispatched=!1;if(this._scene.spriteManagers)for(const g of this._scene.spriteManagers)g._wasDispatched=!1;for(const g of this._scene.Ym)g._wasDispatched=!1}constructor(g){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new S,this._maintainStateBetweenFrames=!1,this._scene=g;for(let w=i.MIN_RENDERINGGROUPS;w<i.MAX_RENDERINGGROUPS;w++)this._autoClearDepthStencil[w]={gi:!0,depth:!0,stencil:!0}}getRenderingGroup(g){const w=g||0;return this._prepareRenderingGroup(w),this._renderingGroups[w]}_clearDepthStencilBuffer(){let g=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],w=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,g,w),this._depthStencilBufferAlreadyCleaned=!0)}render(g,w,q,R){const o=this._renderingGroupInfo;if(o.Aw=this._scene,o.camera=this._scene.activeCamera,o.renderingManager=this,this._scene.spriteManagers&&R)for(let r=0;r<this._scene.spriteManagers.length;r++){const g=this._scene.spriteManagers[r];this.dispatchSprites(g)}for(let r=i.MIN_RENDERINGGROUPS;r<i.MAX_RENDERINGGROUPS;r++){this._depthStencilBufferAlreadyCleaned=r===i.MIN_RENDERINGGROUPS;const S=this._renderingGroups[r];if(!S||S._empty)continue;const T=1<<r;if(o.renderingGroupId=r,this._scene.onBeforeRenderingGroupObservable.notifyObservers(o,T),i.AUTOCLEAR){const g=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(r):this._autoClearDepthStencil[r];g&&g.gi&&this._clearDepthStencilBuffer(g.depth,g.stencil)}for(const g of this._scene._beforeRenderingGroupDrawStage)g.action(r);S.render(g,R,q,w);for(const g of this._scene._afterRenderingGroupDrawStage)g.action(r);this._scene.onAfterRenderingGroupObservable.notifyObservers(o,T)}}reset(){if(!this.maintainStateBetweenFrames)for(let g=i.MIN_RENDERINGGROUPS;g<i.MAX_RENDERINGGROUPS;g++){const w=this._renderingGroups[g];w&&w.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let g=i.MIN_RENDERINGGROUPS;g<i.MAX_RENDERINGGROUPS;g++){const w=this._renderingGroups[g];w&&w.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let g=i.MIN_RENDERINGGROUPS;g<i.MAX_RENDERINGGROUPS;g++){const w=this._renderingGroups[g];w&&w.dispose()}}_prepareRenderingGroup(g){void 0===this._renderingGroups[g]&&(this._renderingGroups[g]=new r(g,this._scene,this._customOpaqueSortCompareFn[g],this._customAlphaTestSortCompareFn[g],this._customTransparentSortCompareFn[g]))}dispatchSprites(g){this.maintainStateBetweenFrames&&g._wasDispatched||(g._wasDispatched=!0,this.getRenderingGroup(g.renderingGroupId).dispatchSprites(g))}dispatchParticles(g){this.maintainStateBetweenFrames&&g._wasDispatched||(g._wasDispatched=!0,this.getRenderingGroup(g.renderingGroupId).dispatchParticles(g))}dispatch(g,w,q){void 0===w&&(w=g.getMesh()),this.maintainStateBetweenFrames&&g._wasDispatched||(g._wasDispatched=!0,this.getRenderingGroup(w.renderingGroupId).dispatch(g,w,q))}setRenderingOrder(g){let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,q=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,R=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[g]=w,this._customAlphaTestSortCompareFn[g]=q,this._customTransparentSortCompareFn[g]=R,this._renderingGroups[g]){const w=this._renderingGroups[g];w.opaqueSortCompareFn=this._customOpaqueSortCompareFn[g],w.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[g],w.transparentSortCompareFn=this._customTransparentSortCompareFn[g]}}setRenderingAutoClearDepthStencil(g,w){let q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],R=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[g]={gi:w,depth:q,stencil:R}}getAutoClearDepthStencilSetup(g){return this._autoClearDepthStencil[g]}}i.MAX_RENDERINGGROUPS=4,i.MIN_RENDERINGGROUPS=0,i.AUTOCLEAR=!0}}]);