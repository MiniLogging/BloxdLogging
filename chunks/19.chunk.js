"use strict";(self.hwpa2z1pqte=self.hwpa2z1pqte||[]).push([[19],{12984:(h,R,l)=>{l.d(R,{e:()=>U,g:()=>F});var j=l(12988),a=l(12711),D=l(12990);class U{get mh(){return this._isDisposed}constructor(h,R,l){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,D=arguments.length>4&&void 0!==arguments[4]&&arguments[4],U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0,mh=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,h&&h.yh?this._engine=h.yh().getEngine():this._engine=h,this._updatable=l,this._instanced=U,this._divisor=w||1,this._label=mh,R instanceof j.b?(this._data=null,this._buffer=R):(this._data=R,this._buffer=null),this.byteStride=F?a:a*Float32Array.BYTES_PER_ELEMENT,D||this.create()}createVertexBuffer(h,R,l,j,a){let D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6?arguments[6]:void 0;const w=D?R:R*Float32Array.BYTES_PER_ELEMENT,mh=j?D?j:j*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new F(this._engine,this,h,this._updatable,!0,mh,void 0===a?this._instanced:a,w,l,void 0,void 0,!0,this._divisor||U)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!h&&this._buffer||(h=h||this._data,h&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h),this._data=h):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(h,this._label),this._data=h):this._buffer=this._engine.createVertexBuffer(h,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.tl>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.tl,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.tl,void 0,this._label));a.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(h){this.create(h)}updateDirectly(h,R,l){let j=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h,j?R:R*Float32Array.BYTES_PER_ELEMENT,l?l*this.byteStride:void 0),this._data=0===R&&void 0===l?h:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class F{get mh(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(h){const R=0!=h;this._instanceDivisor=h,R!==this._instanced&&(this._instanced=R,this._computeHashCode())}get _maxVerticesCount(){const h=this.getData();return h?Array.isArray(h)?h.length/(this.byteStride/4)-this.byteOffset/4:(h.byteLength-this.byteOffset)/this.byteStride:0}constructor(h,R,l,j,a,w,mh,u,c,J){let q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],Q=arguments.length>11&&void 0!==arguments[11]&&arguments[11],Y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,s=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let t=!1;if(this.sR=h,"object"===typeof j&&null!==j?(t=j.updatable??!1,a=j.postponeInternalCreation,w=j.stride,mh=j.instanced,u=j.offset,c=j.size,J=j.type,q=j.normalized??!1,Q=j.useBytes??!1,Y=j.divisor??1,s=j.takeBufferOwnership??!1,this._label=j.label):t=!!j,R instanceof U?(this._buffer=R,this._ownsBuffer=s):(this._buffer=new U(h,R,t,w,a,mh,Q,Y,this._label),this._ownsBuffer=!0),this.uniqueId=F._Counter++,this._kind=l,void 0===J){const h=this.getData();this.type=h?F.GetDataType(h):F.FLOAT}else this.type=J;const f=(0,D.m)(this.type);Q?(this._size=c||(w?w/f:F.DeduceStride(l)),this.byteStride=w||this._buffer.byteStride||this._size*f,this.byteOffset=u||0):(this._size=c||w||F.DeduceStride(l),this.byteStride=w?w*f:this._buffer.byteStride||this._size*f,this.byteOffset=(u||0)*f),this.normalized=q,this._instanced=void 0!==mh&&mh,this._instanceDivisor=mh?Y:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var h;null===(h=this._buffer)||void 0===h||h._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(h,R){const l=this.getData();return l?(0,D.l)(l,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,h,R):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,D.m)(this.type)}getOffset(){return this.byteOffset/(0,D.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,D.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(h){this._buffer.create(h),this._alignBuffer()}update(h){this._buffer.update(h),this._alignBuffer()}updateDirectly(h,R){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(h,R,void 0,l),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(h,R){(0,D.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,h,this.normalized,((h,l)=>{for(let j=0;j<this._size;j++)R(h[j],l+j)}))}_alignBuffer(){}static DeduceStride(h){switch(h){case F.UVKind:case F.UV2Kind:case F.UV3Kind:case F.UV4Kind:case F.UV5Kind:case F.UV6Kind:return 2;case F.NormalKind:case F.PositionKind:return 3;case F.ColorKind:case F.ColorInstanceKind:case F.MatricesIndicesKind:case F.MatricesIndicesExtraKind:case F.MatricesWeightsKind:case F.MatricesWeightsExtraKind:case F.TangentKind:return 4;default:throw new Error("Invalid kind '"+h+"'")}}static GetDataType(h){return h instanceof Int8Array?F.BYTE:h instanceof Uint8Array?F.UNSIGNED_BYTE:h instanceof Int16Array?F.SHORT:h instanceof Uint16Array?F.UNSIGNED_SHORT:h instanceof Int32Array?F.INT:h instanceof Uint32Array?F.UNSIGNED_INT:F.FLOAT}static GetTypeByteLength(h){return(0,D.m)(h)}static ForEach(h,R,l,j,a,U,F,w){(0,D.i)(h,R,l,j,a,U,F,((h,R)=>{for(let l=0;l<j;l++)w(h[l],R+l)}))}static GetFloatData(h,R,l,j,a,U,F,w){return(0,D.l)(h,R,l,j,a,U,F,w)}}F._Counter=0,F.BYTE=5120,F.UNSIGNED_BYTE=5121,F.SHORT=5122,F.UNSIGNED_SHORT=5123,F.INT=5124,F.UNSIGNED_INT=5125,F.FLOAT=5126,F.PositionKind="position",F.NormalKind="normal",F.TangentKind="tangent",F.UVKind="uv",F.UV2Kind="uv2",F.UV3Kind="uv3",F.UV4Kind="uv4",F.UV5Kind="uv5",F.UV6Kind="uv6",F.ColorKind="color",F.ColorInstanceKind="instanceColor",F.MatricesIndicesKind="matricesIndices",F.MatricesWeightsKind="matricesWeights",F.MatricesIndicesExtraKind="matricesIndicesExtra",F.MatricesWeightsExtraKind="matricesWeightsExtra"},12990:(h,R,l)=>{l.d(R,{d:()=>J,g:()=>c,i:()=>w,l:()=>mh,m:()=>U,o:()=>F,r:()=>u});var j=l(12711);function a(h,R,l,j){switch(R){case 5120:{let R=h.getInt8(l);return j&&(R=Math.max(R/127,-1)),R}case 5121:{let R=h.getUint8(l);return j&&(R/=255),R}case 5122:{let R=h.getInt16(l,!0);return j&&(R=Math.max(R/32767,-1)),R}case 5123:{let R=h.getUint16(l,!0);return j&&(R/=65535),R}case 5124:return h.getInt32(l,!0);case 5125:return h.getUint32(l,!0);case 5126:return h.getFloat32(l,!0);default:throw new Error(`Invalid component type ${R}`)}}function D(h,R,l,j,a){switch(R){case 5120:j&&(a=Math.round(127*a)),h.setInt8(l,a);break;case 5121:j&&(a=Math.round(255*a)),h.setUint8(l,a);break;case 5122:j&&(a=Math.round(32767*a)),h.setInt16(l,a,!0);break;case 5123:j&&(a=Math.round(65535*a)),h.setUint16(l,a,!0);break;case 5124:h.setInt32(l,a,!0);break;case 5125:h.setUint32(l,a,!0);break;case 5126:h.setFloat32(l,a,!0);break;default:throw new Error(`Invalid component type ${R}`)}}function U(h){switch(h){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${h}'`)}}function F(h){switch(h){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${h}'`)}}function w(h,R,l,j,F,w,mh,u){const c=new Array(j),J=new Array(j);if(h instanceof Array){let a=R/4;const D=l/4;for(let R=0;R<w;R+=j){for(let R=0;R<j;R++)c[R]=J[R]=h[a+R];u(J,R);for(let R=0;R<j;R++)c[R]!==J[R]&&(h[a+R]=J[R]);a+=D}}else{const q=ArrayBuffer.isView(h)?new DataView(h.buffer,h.byteOffset,h.byteLength):new DataView(h),Q=U(F);for(let h=0;h<w;h+=j){for(let h=0,l=R;h<j;h++,l+=Q)c[h]=J[h]=a(q,F,l,mh);u(J,h);for(let h=0,l=R;h<j;h++,l+=Q)c[h]!==J[h]&&D(q,F,l,mh,J[h]);R+=l}}}function mh(h,R,l,a,D,F,mh,u){const c=R*U(l),J=mh*R;if(5126!==l||D!==c){const j=new Float32Array(J);return w(h,a,D,R,l,J,F,((h,l)=>{for(let a=0;a<R;a++)j[l+a]=h[a]})),j}if(!(h instanceof Array||h instanceof Float32Array)||0!==a||h.length!==J){if(h instanceof Array){const R=a/4;return h.slice(R,R+J)}if(h instanceof ArrayBuffer)return new Float32Array(h,a,J);{const R=h.byteOffset+a;return 0!==(3&R)&&(j.c.Warn("Float array must be aligned to 4-bytes border"),u=!0),u?new Float32Array(h.buffer.slice(R,R+J*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(h.buffer,R,J)}}return u?h.slice():h}function u(h,R,l,a,D,mh,u,c){const J=U(l),q=F(l),Q=u*R;if(Array.isArray(h)){if(0!==(3&a)||0!==(3&D))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const j=a/4,U=D/4;if(j+(u-1)*U+R>h.length)throw new Error("Last accessed index is out of bounds.");if(U<R)throw new Error("Data stride cannot be smaller than the component size.");if(U!==R){const j=new q(Q);return w(h,a,D,R,l,Q,mh,((h,l)=>{for(let a=0;a<R;a++)j[l+a]=h[a]})),j}return new q(h.slice(j,j+Q))}let Y,s=a;h instanceof ArrayBuffer?Y=h:(Y=h.buffer,s+=h.byteOffset);if(s+(u-1)*D+R*J>Y.byteLength)throw new Error("Last accessed byte is out of bounds.");const t=R*J;if(D<t)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(D!==t){const h=new q(Q);return w(Y,s,D,R,l,Q,mh,((l,j)=>{for(let a=0;a<R;a++)h[j+a]=l[a]})),h}return 1!==J&&0!==(s&J-1)&&(j.c.Warn("Array must be aligned to border of element size. Data will be copied."),c=!0),c?new q(Y.slice(s,s+Q*J)):new q(Y,s,Q)}function c(h,R,l,a,D,F,mh,u){const c=R*U(l),J=mh*R;if(u.length!==J)throw new Error("Output length is not valid");if(5126===l&&D===c)if(h instanceof Array){const R=a/4;u.set(h,R)}else if(h instanceof ArrayBuffer){const R=new Float32Array(h,a,J);u.set(R)}else{const R=h.byteOffset+a;if(0!==(3&R))return j.c.Warn("Float array must be aligned to 4-bytes border"),void u.set(new Float32Array(h.buffer.slice(R,R+J*Float32Array.BYTES_PER_ELEMENT)));const l=new Float32Array(h.buffer,R,J);u.set(l)}else w(h,a,D,R,l,J,F,((h,l)=>{for(let j=0;j<R;j++)u[l+j]=h[j]}))}function J(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(h)){for(let a=0;a<R;a++)if(h[l+a]-j>65535)return!0;return!1}return 4===h.BYTES_PER_ELEMENT}},12988:(h,R,l)=>{l.d(R,{b:()=>j});class j{get underlyingResource(){return null}constructor(){this.references=0,this.tl=0,this.is32Bits=!1,this.uniqueId=j._Counter++}}j._Counter=0},13016:(h,R,l)=>{l.d(R,{c:()=>a});var j=l(12790);class a{static GetEffect(h){return void 0===h.getPipelineContext?h.effect:h}constructor(h){let R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=h.createDrawContext(),R&&(this.materialContext=h.createMaterialContext())}setEffect(h,R){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var j;(this.effect=h,void 0!==R&&(this.defines=R),l)&&(null===(j=this.drawContext)||void 0===j||j.reset())}dispose(){var h;let R=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const h=this.effect;R?h.dispose():j.b.SetImmediate((()=>{h.getEngine().onEndFrameObservable.addOnce((()=>{h.dispose()}))})),this.effect=null}null===(h=this.drawContext)||void 0===h||h.dispose()}}},13092:(h,R,l)=>{l.d(R,{e:()=>a});var j=l(12960);class a{static GetPlanes(h){const R=[];for(let l=0;l<6;l++)R.push(new j.d(0,0,0,0));return a.GetPlanesToRef(h,R),R}static GetNearPlaneToRef(h,R){const l=h.m;R.normal.x=l[3]+l[2],R.normal.y=l[7]+l[6],R.normal.z=l[11]+l[10],R.d=l[15]+l[14],R.normalize()}static GetFarPlaneToRef(h,R){const l=h.m;R.normal.x=l[3]-l[2],R.normal.y=l[7]-l[6],R.normal.z=l[11]-l[10],R.d=l[15]-l[14],R.normalize()}static GetLeftPlaneToRef(h,R){const l=h.m;R.normal.x=l[3]+l[0],R.normal.y=l[7]+l[4],R.normal.z=l[11]+l[8],R.d=l[15]+l[12],R.normalize()}static GetRightPlaneToRef(h,R){const l=h.m;R.normal.x=l[3]-l[0],R.normal.y=l[7]-l[4],R.normal.z=l[11]-l[8],R.d=l[15]-l[12],R.normalize()}static GetTopPlaneToRef(h,R){const l=h.m;R.normal.x=l[3]-l[1],R.normal.y=l[7]-l[5],R.normal.z=l[11]-l[9],R.d=l[15]-l[13],R.normalize()}static GetBottomPlaneToRef(h,R){const l=h.m;R.normal.x=l[3]+l[1],R.normal.y=l[7]+l[5],R.normal.z=l[11]+l[9],R.d=l[15]+l[13],R.normalize()}static GetPlanesToRef(h,R){a.GetNearPlaneToRef(h,R[0]),a.GetFarPlaneToRef(h,R[1]),a.GetLeftPlaneToRef(h,R[2]),a.GetRightPlaneToRef(h,R[3]),a.GetTopPlaneToRef(h,R[4]),a.GetBottomPlaneToRef(h,R[5])}static IsPointInFrustum(h,R){for(let l=0;l<6;l++)if(R[l].dotCoordinate(h)<0)return!1;return!0}}},13108:(h,R,l)=>{l.d(R,{d:()=>a});var j=l(12724);class a{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(h,R){a.Enabled&&(this._current+=h,R&&this._fetchResult())}beginMonitoring(){a.Enabled&&(this._startMonitoringTime=j.e.Now)}endMonitoring(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!a.Enabled)return;h&&this.fetchNewFrame();const R=j.e.Now;this._current=R-this._startMonitoringTime,h&&this._fetchResult()}wF(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const h=j.e.Now;h-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=h,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}a.Enabled=!0},12995:(h,R,l)=>{l.d(R,{e:()=>a,g:()=>j});class j{constructor(h){this.length=0,this.data=new Array(h),this._id=j._GlobalId++}push(h){this.data[this.length++]=h,this.length>this.data.length&&(this.data.length*=2)}forEach(h){for(let R=0;R<this.length;R++)h(this.data[R])}sort(h){this.data.sort(h)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(h){if(0!==h.length){this.length+h.length>this.data.length&&(this.data.length=2*(this.length+h.length));for(let R=0;R<h.length;R++)this.data[this.length++]=(h.data||h)[R]}}indexOf(h){const R=this.data.indexOf(h);return R>=this.length?-1:R}contains(h){return-1!==this.indexOf(h)}}j._GlobalId=0;class a extends j{constructor(){super(...arguments),this._duplicateId=0}push(h){super.push(h),h.__smartArrayFlags||(h.__smartArrayFlags={}),h.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(h){return(!h.__smartArrayFlags||h.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(h),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(h){if(0!==h.length){this.length+h.length>this.data.length&&(this.data.length=2*(this.length+h.length));for(let R=0;R<h.length;R++){const l=(h.data||h)[R];this.pushNoDuplicate(l)}}}}},12980:(h,R,l)=>{l.d(R,{e:()=>D});var j=l(12984),a=l(12696);class D{constructor(h){this._vertexBuffers={},this.onBeforeRenderObservable=new a.d,this._scene=h}_prepareBuffers(){if(this._vertexBuffers[j.g.PositionKind])return;const h=[];h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),this._vertexBuffers[j.g.PositionKind]=new j.g(this._scene.getEngine(),h,j.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const h=[];h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(h)}_rebuild(){const h=this._vertexBuffers[j.g.PositionKind];h&&(h._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const l=this._scene.activeCamera;return!!l&&(R=R||l._postProcesses.filter((h=>null!=h)),!(!R||0===R.length||!this._scene.postProcessesEnabled)&&(R[0].activate(l,h,null!==R&&void 0!==R),!0))}directRender(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,D=arguments.length>5&&void 0!==arguments[5]&&arguments[5],U=arguments.length>6&&void 0!==arguments[6]?arguments[6]:h.length;const F=this._scene.getEngine();for(let mh=0;mh<U;mh++){var w;if(mh<h.length-1)h[mh+1].activate(this._scene.activeCamera||this._scene,null===R||void 0===R?void 0:R.texture);else R?F.bindFramebuffer(R,j,void 0,void 0,l,a):D||F.restoreDefaultFramebuffer(),null===(w=F._debugInsertMarker)||void 0===w||w.call(F,`post process ${h[mh].name} output`);const U=h[mh],u=U.apply();u&&(U.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),F.bindBuffers(this._vertexBuffers,this._indexBuffer,u),F.drawElementsType(0,0,6),U.onAfterRenderObservable.notifyObservers(u))}F.setDepthBuffer(!0),F.setDepthWrite(!0)}_finalizeFrame(h,R,l,j){let a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const D=this._scene.activeCamera;if(!D)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(j=j||D._postProcesses.filter((h=>null!=h))).length||!this._scene.postProcessesEnabled)return;const U=this._scene.getEngine();for(let w=0,mh=j.length;w<mh;w++){const u=j[w];var F;if(w<mh-1)u._outputTexture=j[w+1].activate(D,null===R||void 0===R?void 0:R.texture);else R?(U.bindFramebuffer(R,l,void 0,void 0,a),u._outputTexture=R):(U.restoreDefaultFramebuffer(),u._outputTexture=null),null===(F=U._debugInsertMarker)||void 0===F||F.call(U,`post process ${j[w].name} output`);if(h)break;const c=u.apply();c&&(u.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),U.bindBuffers(this._vertexBuffers,this._indexBuffer,c),U.drawElementsType(0,0,6),u.onAfterRenderObservable.notifyObservers(c))}U.setDepthBuffer(!0),U.setDepthWrite(!0),U.setAlphaMode(0)}dispose(){const h=this._vertexBuffers[j.g.PositionKind];h&&(h.dispose(),this._vertexBuffers[j.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12993:(h,R,l)=>{l.d(R,{d:()=>F});var j=l(12995),a=l(12900);class D{set opaqueSortCompareFn(h){this._opaqueSortCompareFn=h||D.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(h){this._alphaTestSortCompareFn=h||D.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(h){this._transparentSortCompareFn=h||D.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(h,R){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,D=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=h,this._opaqueSubMeshes=new j.g(256),this._transparentSubMeshes=new j.g(256),this._alphaTestSubMeshes=new j.g(256),this._depthOnlySubMeshes=new j.g(256),this._particleSystems=new j.g(256),this._spriteManagers=new j.g(256),this._empty=!0,this._edgesRenderers=new j.e(16),this._scene=R,this.opaqueSortCompareFn=l,this.alphaTestSortCompareFn=a,this.transparentSortCompareFn=D}render(h,R,l,j){if(h)return void h(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const a=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(a.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),a.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const D=a.getStencilBuffer();if(a.setStencilBuffer(!1),R&&this._renderSprites(),l&&this._renderParticles(j),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(a.setStencilBuffer(D),this._scene.useOrderIndependentTransparency){const h=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);h.length&&this._renderTransparent(h)}else this._renderTransparent(this._transparentSubMeshes);a.setAlphaMode(0)}if(a.setStencilBuffer(!1),this._edgesRenderers.length){for(let h=0;h<this._edgesRenderers.length;h++)this._edgesRenderers.data[h].render();a.setAlphaMode(0)}a.setStencilBuffer(D)}_renderOpaqueSorted(h){D._RenderSorted(h,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(h){D._RenderSorted(h,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(h){D._RenderSorted(h,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(h,R,l,j){let U,F=0;const w=l?l.globalPosition:D._ZeroVector;if(j)for(;F<h.length;F++)U=h.data[F],U._alphaIndex=U.getMesh().alphaIndex,U._distanceToCamera=a.tR.Distance(U.getBoundingInfo().boundingSphere.centerWorld,w);const mh=h.length===h.data.length?h.data:h.data.slice(0,h.length);R&&mh.sort(R);const u=mh[0].getMesh().yh();for(F=0;F<mh.length;F++)if(U=mh[F],!u._activeMeshesFrozenButKeepClipping||U.isInFrustum(u._frustumPlanes)){if(j){const h=U.Hh();if(h&&h.needDepthPrePass){const R=h.yh().getEngine();R.setColorWrite(!1),R.setAlphaMode(0),U.render(!1),R.setColorWrite(!0)}}U.render(j)}}static defaultTransparentSortCompare(h,R){return h._alphaIndex>R._alphaIndex?1:h._alphaIndex<R._alphaIndex?-1:D.backToFrontSortCompare(h,R)}static backToFrontSortCompare(h,R){return h._distanceToCamera<R._distanceToCamera?1:h._distanceToCamera>R._distanceToCamera?-1:0}static frontToBackSortCompare(h,R){return h._distanceToCamera<R._distanceToCamera?-1:h._distanceToCamera>R._distanceToCamera?1:0}static PainterSortCompare(h,R){const l=h.getMesh(),j=R.getMesh();return l.material&&j.material?l.material.uniqueId-j.material.uniqueId:l.uniqueId-j.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(h,R,l){void 0===R&&(R=h.getMesh()),void 0===l&&(l=h.Hh()),null!==l&&void 0!==l&&(l.needAlphaBlendingForMesh(R)?this._transparentSubMeshes.push(h):l.needAlphaTestingForMesh(R)?(l.needDepthPrePass&&this._depthOnlySubMeshes.push(h),this._alphaTestSubMeshes.push(h)):(l.needDepthPrePass&&this._depthOnlySubMeshes.push(h),this._opaqueSubMeshes.push(h)),R._renderingGroup=this,R._edgesRenderer&&R.isEnabled()&&R.isVisible&&R._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(R._edgesRenderer),this._empty=!1)}dispatchSprites(h){this._spriteManagers.push(h),this._empty=!1}dispatchParticles(h){this._particleSystems.push(h),this._empty=!1}_renderParticles(h){if(0===this._particleSystems.length)return;const R=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let l=0;l<this._particleSystems.length;l++){const j=this._particleSystems.data[l];if(0===(R&&R.layerMask&j.layerMask))continue;const a=j.UR;a.position&&h&&-1===h.indexOf(a)||this._scene._activeParticles.addCount(j.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const h=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let R=0;R<this._spriteManagers.length;R++){const l=this._spriteManagers.data[R];0!==(h&&h.layerMask&l.layerMask)&&l.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}D._ZeroVector=a.tR.Zero();class U{}class F{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(h){h!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=h,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const h of this._scene.meshes)if(h.YF)for(const R of h.YF)R._wasDispatched=!1;if(this._scene.spriteManagers)for(const h of this._scene.spriteManagers)h._wasDispatched=!1;for(const h of this._scene.SJ)h._wasDispatched=!1}constructor(h){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new U,this._maintainStateBetweenFrames=!1,this._scene=h;for(let R=F.MIN_RENDERINGGROUPS;R<F.MAX_RENDERINGGROUPS;R++)this._autoClearDepthStencil[R]={QF:!0,depth:!0,uF:!0}}getRenderingGroup(h){const R=h||0;return this._prepareRenderingGroup(R),this._renderingGroups[R]}_clearDepthStencilBuffer(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],R=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,h,R),this._depthStencilBufferAlreadyCleaned=!0)}render(h,R,l,j){const a=this._renderingGroupInfo;if(a.TR=this._scene,a.camera=this._scene.activeCamera,a.renderingManager=this,this._scene.spriteManagers&&j)for(let D=0;D<this._scene.spriteManagers.length;D++){const h=this._scene.spriteManagers[D];this.dispatchSprites(h)}for(let D=F.MIN_RENDERINGGROUPS;D<F.MAX_RENDERINGGROUPS;D++){this._depthStencilBufferAlreadyCleaned=D===F.MIN_RENDERINGGROUPS;const U=this._renderingGroups[D];if(!U||U._empty)continue;const w=1<<D;if(a.renderingGroupId=D,this._scene.onBeforeRenderingGroupObservable.notifyObservers(a,w),F.AUTOCLEAR){const h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(D):this._autoClearDepthStencil[D];h&&h.QF&&this._clearDepthStencilBuffer(h.depth,h.uF)}for(const h of this._scene._beforeRenderingGroupDrawStage)h.action(D);U.render(h,j,l,R);for(const h of this._scene._afterRenderingGroupDrawStage)h.action(D);this._scene.onAfterRenderingGroupObservable.notifyObservers(a,w)}}reset(){if(!this.maintainStateBetweenFrames)for(let h=F.MIN_RENDERINGGROUPS;h<F.MAX_RENDERINGGROUPS;h++){const R=this._renderingGroups[h];R&&R.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let h=F.MIN_RENDERINGGROUPS;h<F.MAX_RENDERINGGROUPS;h++){const R=this._renderingGroups[h];R&&R.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let h=F.MIN_RENDERINGGROUPS;h<F.MAX_RENDERINGGROUPS;h++){const R=this._renderingGroups[h];R&&R.dispose()}}_prepareRenderingGroup(h){void 0===this._renderingGroups[h]&&(this._renderingGroups[h]=new D(h,this._scene,this._customOpaqueSortCompareFn[h],this._customAlphaTestSortCompareFn[h],this._customTransparentSortCompareFn[h]))}dispatchSprites(h){this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatchSprites(h))}dispatchParticles(h){this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatchParticles(h))}dispatch(h,R,l){void 0===R&&(R=h.getMesh()),this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(R.renderingGroupId).dispatch(h,R,l))}setRenderingOrder(h){let R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[h]=R,this._customAlphaTestSortCompareFn[h]=l,this._customTransparentSortCompareFn[h]=j,this._renderingGroups[h]){const R=this._renderingGroups[h];R.opaqueSortCompareFn=this._customOpaqueSortCompareFn[h],R.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[h],R.transparentSortCompareFn=this._customTransparentSortCompareFn[h]}}setRenderingAutoClearDepthStencil(h,R){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],j=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[h]={QF:R,depth:l,uF:j}}getAutoClearDepthStencilSetup(h){return this._autoClearDepthStencil[h]}}F.MAX_RENDERINGGROUPS=4,F.MIN_RENDERINGGROUPS=0,F.AUTOCLEAR=!0}}]);