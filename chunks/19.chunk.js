"use strict";(self.ozi0exxand9=self.ozi0exxand9||[]).push([[19],{11494:(f,v,Z)=>{Z.d(v,{e:()=>l,g:()=>e});var V=Z(11498),h=Z(11247),J=Z(11503);class l{get C(){return this._isDisposed}constructor(f,v,Z){let h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,J=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],e=arguments.length>6&&void 0!==arguments[6]&&arguments[6],C=arguments.length>7?arguments[7]:void 0,H=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,f&&f.Yf?this._engine=f.Yf().getEngine():this._engine=f,this._updatable=Z,this._instanced=l,this._divisor=C||1,this._label=H,v instanceof V.c?(this._data=null,this._buffer=v):(this._data=v,this._buffer=null),this.byteStride=e?h:h*Float32Array.BYTES_PER_ELEMENT,J||this.create()}createVertexBuffer(f,v,Z,V,h){let J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6?arguments[6]:void 0;const C=J?v:v*Float32Array.BYTES_PER_ELEMENT,H=V?J?V:V*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new e(this._engine,this,f,this._updatable,!0,H,void 0===h?this._instanced:h,C,Z,void 0,void 0,!0,this._divisor||l)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!f&&this._buffer||(f=f||this._data,f&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,f),this._data=f):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(f,this._label),this._data=f):this._buffer=this._engine.createVertexBuffer(f,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Ne>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Ne,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Ne,void 0,this._label));h.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(f){this.create(f)}updateDirectly(f,v,Z){let V=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,f,V?v:v*Float32Array.BYTES_PER_ELEMENT,Z?Z*this.byteStride:void 0),this._data=0===v&&void 0===Z?f:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class e{get C(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(f){const v=0!=f;this._instanceDivisor=f,v!==this._instanced&&(this._instanced=v,this._computeHashCode())}get _maxVerticesCount(){const f=this.getData();return f?Array.isArray(f)?f.length/(this.byteStride/4)-this.byteOffset/4:(f.byteLength-this.byteOffset)/this.byteStride:0}constructor(f,v,Z,V,h,C,H,O,u,W){let a=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]&&arguments[11],X=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,F=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let U=!1;if(this.bv=f,"object"===typeof V&&null!==V?(U=V.updatable??!1,h=V.postponeInternalCreation,C=V.stride,H=V.instanced,O=V.offset,u=V.size,W=V.type,a=V.normalized??!1,b=V.useBytes??!1,X=V.divisor??1,F=V.takeBufferOwnership??!1,this._label=V.label):U=!!V,v instanceof l?(this._buffer=v,this._ownsBuffer=F):(this._buffer=new l(f,v,U,C,h,H,b,X,this._label),this._ownsBuffer=!0),this.uniqueId=e._Counter++,this._kind=Z,void 0===W){const f=this.getData();this.type=f?e.GetDataType(f):e.FLOAT}else this.type=W;const K=(0,J.m)(this.type);b?(this._size=u||(C?C/K:e.DeduceStride(Z)),this.byteStride=C||this._buffer.byteStride||this._size*K,this.byteOffset=O||0):(this._size=u||C||e.DeduceStride(Z),this.byteStride=C?C*K:this._buffer.byteStride||this._size*K,this.byteOffset=(O||0)*K),this.normalized=a,this._instanced=void 0!==H&&H,this._instanceDivisor=H?X:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var f;null===(f=this._buffer)||void 0===f||f._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(f,v){const Z=this.getData();return Z?(0,J.i)(Z,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,f,v):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,J.m)(this.type)}getOffset(){return this.byteOffset/(0,J.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,J.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(f){this._buffer.create(f),this._alignBuffer()}update(f){this._buffer.update(f),this._alignBuffer()}updateDirectly(f,v){let Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(f,v,void 0,Z),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(f,v){(0,J.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,f,this.normalized,((f,Z)=>{for(let V=0;V<this._size;V++)v(f[V],Z+V)}))}_alignBuffer(){}static DeduceStride(f){switch(f){case e.UVKind:case e.UV2Kind:case e.UV3Kind:case e.UV4Kind:case e.UV5Kind:case e.UV6Kind:return 2;case e.NormalKind:case e.PositionKind:return 3;case e.ColorKind:case e.ColorInstanceKind:case e.MatricesIndicesKind:case e.MatricesIndicesExtraKind:case e.MatricesWeightsKind:case e.MatricesWeightsExtraKind:case e.TangentKind:return 4;default:throw new Error("Invalid kind '"+f+"'")}}static GetDataType(f){return f instanceof Int8Array?e.BYTE:f instanceof Uint8Array?e.UNSIGNED_BYTE:f instanceof Int16Array?e.SHORT:f instanceof Uint16Array?e.UNSIGNED_SHORT:f instanceof Int32Array?e.INT:f instanceof Uint32Array?e.UNSIGNED_INT:e.FLOAT}static GetTypeByteLength(f){return(0,J.m)(f)}static ForEach(f,v,Z,V,h,l,e,C){(0,J.g)(f,v,Z,V,h,l,e,((f,v)=>{for(let Z=0;Z<V;Z++)C(f[Z],v+Z)}))}static GetFloatData(f,v,Z,V,h,l,e,C){return(0,J.i)(f,v,Z,V,h,l,e,C)}}e._Counter=0,e.BYTE=5120,e.UNSIGNED_BYTE=5121,e.SHORT=5122,e.UNSIGNED_SHORT=5123,e.INT=5124,e.UNSIGNED_INT=5125,e.FLOAT=5126,e.PositionKind="position",e.NormalKind="normal",e.TangentKind="tangent",e.UVKind="uv",e.UV2Kind="uv2",e.UV3Kind="uv3",e.UV4Kind="uv4",e.UV5Kind="uv5",e.UV6Kind="uv6",e.ColorKind="color",e.ColorInstanceKind="instanceColor",e.MatricesIndicesKind="matricesIndices",e.MatricesWeightsKind="matricesWeights",e.MatricesIndicesExtraKind="matricesIndicesExtra",e.MatricesWeightsExtraKind="matricesWeightsExtra"},11503:(f,v,Z)=>{Z.d(v,{e:()=>W,f:()=>u,g:()=>C,i:()=>H,m:()=>l,q:()=>e,s:()=>O});var V=Z(11247);function h(f,v,Z,V){switch(v){case 5120:{let v=f.getInt8(Z);return V&&(v=Math.max(v/127,-1)),v}case 5121:{let v=f.getUint8(Z);return V&&(v/=255),v}case 5122:{let v=f.getInt16(Z,!0);return V&&(v=Math.max(v/32767,-1)),v}case 5123:{let v=f.getUint16(Z,!0);return V&&(v/=65535),v}case 5124:return f.getInt32(Z,!0);case 5125:return f.getUint32(Z,!0);case 5126:return f.getFloat32(Z,!0);default:throw new Error(`Invalid component type ${v}`)}}function J(f,v,Z,V,h){switch(v){case 5120:V&&(h=Math.round(127*h)),f.setInt8(Z,h);break;case 5121:V&&(h=Math.round(255*h)),f.setUint8(Z,h);break;case 5122:V&&(h=Math.round(32767*h)),f.setInt16(Z,h,!0);break;case 5123:V&&(h=Math.round(65535*h)),f.setUint16(Z,h,!0);break;case 5124:f.setInt32(Z,h,!0);break;case 5125:f.setUint32(Z,h,!0);break;case 5126:f.setFloat32(Z,h,!0);break;default:throw new Error(`Invalid component type ${v}`)}}function l(f){switch(f){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${f}'`)}}function e(f){switch(f){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${f}'`)}}function C(f,v,Z,V,e,C,H,O){const u=new Array(V),W=new Array(V);if(f instanceof Array){let h=v/4;const J=Z/4;for(let v=0;v<C;v+=V){for(let v=0;v<V;v++)u[v]=W[v]=f[h+v];O(W,v);for(let v=0;v<V;v++)u[v]!==W[v]&&(f[h+v]=W[v]);h+=J}}else{const a=ArrayBuffer.isView(f)?new DataView(f.buffer,f.byteOffset,f.byteLength):new DataView(f),b=l(e);for(let f=0;f<C;f+=V){for(let f=0,Z=v;f<V;f++,Z+=b)u[f]=W[f]=h(a,e,Z,H);O(W,f);for(let f=0,Z=v;f<V;f++,Z+=b)u[f]!==W[f]&&J(a,e,Z,H,W[f]);v+=Z}}}function H(f,v,Z,h,J,e,H,O){const u=v*l(Z),W=H*v;if(5126!==Z||J!==u){const V=new Float32Array(W);return C(f,h,J,v,Z,W,e,((f,Z)=>{for(let h=0;h<v;h++)V[Z+h]=f[h]})),V}if(!(f instanceof Array||f instanceof Float32Array)||0!==h||f.length!==W){if(f instanceof Array){const v=h/4;return f.slice(v,v+W)}if(f instanceof ArrayBuffer)return new Float32Array(f,h,W);{const v=f.byteOffset+h;return 0!==(3&v)&&(V.e.Warn("Float array must be aligned to 4-bytes border"),O=!0),O?new Float32Array(f.buffer.slice(v,v+W*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(f.buffer,v,W)}}return O?f.slice():f}function O(f,v,Z,h,J,H,O,u){const W=l(Z),a=e(Z),b=O*v;if(Array.isArray(f)){if(0!==(3&h)||0!==(3&J))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const V=h/4,l=J/4;if(V+(O-1)*l+v>f.length)throw new Error("Last accessed index is out of bounds.");if(l<v)throw new Error("Data stride cannot be smaller than the component size.");if(l!==v){const V=new a(b);return C(f,h,J,v,Z,b,H,((f,Z)=>{for(let h=0;h<v;h++)V[Z+h]=f[h]})),V}return new a(f.slice(V,V+b))}let X,F=h;f instanceof ArrayBuffer?X=f:(X=f.buffer,F+=f.byteOffset);if(F+(O-1)*J+v*W>X.byteLength)throw new Error("Last accessed byte is out of bounds.");const U=v*W;if(J<U)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(J!==U){const f=new a(b);return C(X,F,J,v,Z,b,H,((Z,V)=>{for(let h=0;h<v;h++)f[V+h]=Z[h]})),f}return 1!==W&&0!==(F&W-1)&&(V.e.Warn("Array must be aligned to border of element size. Data will be copied."),u=!0),u?new a(X.slice(F,F+b*W)):new a(X,F,b)}function u(f,v,Z,h,J,e,H,O){const u=v*l(Z),W=H*v;if(O.length!==W)throw new Error("Output length is not valid");if(5126===Z&&J===u)if(f instanceof Array){const v=h/4;O.set(f,v)}else if(f instanceof ArrayBuffer){const v=new Float32Array(f,h,W);O.set(v)}else{const v=f.byteOffset+h;if(0!==(3&v))return V.e.Warn("Float array must be aligned to 4-bytes border"),void O.set(new Float32Array(f.buffer.slice(v,v+W*Float32Array.BYTES_PER_ELEMENT)));const Z=new Float32Array(f.buffer,v,W);O.set(Z)}else C(f,h,J,v,Z,W,e,((f,Z)=>{for(let V=0;V<v;V++)O[Z+V]=f[V]}))}function W(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(f)){for(let h=0;h<v;h++)if(f[Z+h]-V>65535)return!0;return!1}return 4===f.BYTES_PER_ELEMENT}},11498:(f,v,Z)=>{Z.d(v,{c:()=>V});class V{get underlyingResource(){return null}constructor(){this.references=0,this.Ne=0,this.is32Bits=!1,this.uniqueId=V._Counter++}}V._Counter=0},11534:(f,v,Z)=>{Z.d(v,{d:()=>h});var V=Z(11316);class h{static GetEffect(f){return void 0===f.getPipelineContext?f.effect:f}constructor(f){let v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=f.createDrawContext(),v&&(this.materialContext=f.createMaterialContext())}setEffect(f,v){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var V;(this.effect=f,void 0!==v&&(this.defines=v),Z)&&(null===(V=this.drawContext)||void 0===V||V.reset())}dispose(){var f;let v=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const f=this.effect;v?f.dispose():V.d.SetImmediate((()=>{f.getEngine().onEndFrameObservable.addOnce((()=>{f.dispose()}))})),this.effect=null}null===(f=this.drawContext)||void 0===f||f.dispose()}}},11605:(f,v,Z)=>{Z.d(v,{e:()=>h});var V=Z(11478);class h{static GetPlanes(f){const v=[];for(let Z=0;Z<6;Z++)v.push(new V.e(0,0,0,0));return h.GetPlanesToRef(f,v),v}static GetNearPlaneToRef(f,v){const Z=f.m;v.normal.x=Z[3]+Z[2],v.normal.y=Z[7]+Z[6],v.normal.z=Z[11]+Z[10],v.d=Z[15]+Z[14],v.normalize()}static GetFarPlaneToRef(f,v){const Z=f.m;v.normal.x=Z[3]-Z[2],v.normal.y=Z[7]-Z[6],v.normal.z=Z[11]-Z[10],v.d=Z[15]-Z[14],v.normalize()}static GetLeftPlaneToRef(f,v){const Z=f.m;v.normal.x=Z[3]+Z[0],v.normal.y=Z[7]+Z[4],v.normal.z=Z[11]+Z[8],v.d=Z[15]+Z[12],v.normalize()}static GetRightPlaneToRef(f,v){const Z=f.m;v.normal.x=Z[3]-Z[0],v.normal.y=Z[7]-Z[4],v.normal.z=Z[11]-Z[8],v.d=Z[15]-Z[12],v.normalize()}static GetTopPlaneToRef(f,v){const Z=f.m;v.normal.x=Z[3]-Z[1],v.normal.y=Z[7]-Z[5],v.normal.z=Z[11]-Z[9],v.d=Z[15]-Z[13],v.normalize()}static GetBottomPlaneToRef(f,v){const Z=f.m;v.normal.x=Z[3]+Z[1],v.normal.y=Z[7]+Z[5],v.normal.z=Z[11]+Z[9],v.d=Z[15]+Z[13],v.normalize()}static GetPlanesToRef(f,v){h.GetNearPlaneToRef(f,v[0]),h.GetFarPlaneToRef(f,v[1]),h.GetLeftPlaneToRef(f,v[2]),h.GetRightPlaneToRef(f,v[3]),h.GetTopPlaneToRef(f,v[4]),h.GetBottomPlaneToRef(f,v[5])}static IsPointInFrustum(f,v){for(let Z=0;Z<6;Z++)if(v[Z].dotCoordinate(f)<0)return!1;return!0}}},11614:(f,v,Z)=>{Z.d(v,{d:()=>h});var V=Z(11254);class h{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(f,v){h.Enabled&&(this._current+=f,v&&this._fetchResult())}beginMonitoring(){h.Enabled&&(this._startMonitoringTime=V.b.Now)}endMonitoring(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!h.Enabled)return;f&&this.fetchNewFrame();const v=V.b.Now;this._current=v-this._startMonitoringTime,f&&this._fetchResult()}ah(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const f=V.b.Now;f-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=f,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}h.Enabled=!0},11513:(f,v,Z)=>{Z.d(v,{d:()=>h,f:()=>V});class V{constructor(f){this.length=0,this.data=new Array(f),this._id=V._GlobalId++}push(f){this.data[this.length++]=f,this.length>this.data.length&&(this.data.length*=2)}forEach(f){for(let v=0;v<this.length;v++)f(this.data[v])}sort(f){this.data.sort(f)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(f){if(0!==f.length){this.length+f.length>this.data.length&&(this.data.length=2*(this.length+f.length));for(let v=0;v<f.length;v++)this.data[this.length++]=(f.data||f)[v]}}indexOf(f){const v=this.data.indexOf(f);return v>=this.length?-1:v}contains(f){return-1!==this.indexOf(f)}}V._GlobalId=0;class h extends V{constructor(){super(...arguments),this._duplicateId=0}push(f){super.push(f),f.__smartArrayFlags||(f.__smartArrayFlags={}),f.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(f){return(!f.__smartArrayFlags||f.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(f),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(f){if(0!==f.length){this.length+f.length>this.data.length&&(this.data.length=2*(this.length+f.length));for(let v=0;v<f.length;v++){const Z=(f.data||f)[v];this.pushNoDuplicate(Z)}}}}},11491:(f,v,Z)=>{Z.d(v,{c:()=>J});var V=Z(11494),h=Z(11235);class J{constructor(f){this._vertexBuffers={},this.onBeforeRenderObservable=new h.c,this._scene=f}_prepareBuffers(){if(this._vertexBuffers[V.g.PositionKind])return;const f=[];f.push(1,1),f.push(-1,1),f.push(-1,-1),f.push(1,-1),this._vertexBuffers[V.g.PositionKind]=new V.g(this._scene.getEngine(),f,V.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const f=[];f.push(0),f.push(1),f.push(2),f.push(0),f.push(2),f.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(f)}_rebuild(){const f=this._vertexBuffers[V.g.PositionKind];f&&(f._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Z=this._scene.activeCamera;return!!Z&&(v=v||Z._postProcesses.filter((f=>null!=f)),!(!v||0===v.length||!this._scene.postProcessesEnabled)&&(v[0].activate(Z,f,null!==v&&void 0!==v),!0))}directRender(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,J=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:f.length;const e=this._scene.getEngine();for(let H=0;H<l;H++){var C;if(H<f.length-1)f[H+1].activate(this._scene.activeCamera||this._scene,null===v||void 0===v?void 0:v.texture);else v?e.bindFramebuffer(v,V,void 0,void 0,Z,h):J||e.restoreDefaultFramebuffer(),null===(C=e._debugInsertMarker)||void 0===C||C.call(e,`post process ${f[H].name} output`);const l=f[H],O=l.apply();O&&(l.onBeforeRenderObservable.notifyObservers(O),this._prepareBuffers(),e.bindBuffers(this._vertexBuffers,this._indexBuffer,O),e.drawElementsType(0,0,6),l.onAfterRenderObservable.notifyObservers(O))}e.setDepthBuffer(!0),e.setDepthWrite(!0)}_finalizeFrame(f,v,Z,V){let h=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const J=this._scene.activeCamera;if(!J)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(V=V||J._postProcesses.filter((f=>null!=f))).length||!this._scene.postProcessesEnabled)return;const l=this._scene.getEngine();for(let C=0,H=V.length;C<H;C++){const O=V[C];var e;if(C<H-1)O._outputTexture=V[C+1].activate(J,null===v||void 0===v?void 0:v.texture);else v?(l.bindFramebuffer(v,Z,void 0,void 0,h),O._outputTexture=v):(l.restoreDefaultFramebuffer(),O._outputTexture=null),null===(e=l._debugInsertMarker)||void 0===e||e.call(l,`post process ${V[C].name} output`);if(f)break;const u=O.apply();u&&(O.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,u),l.drawElementsType(0,0,6),O.onAfterRenderObservable.notifyObservers(u))}l.setDepthBuffer(!0),l.setDepthWrite(!0),l.setAlphaMode(0)}dispose(){const f=this._vertexBuffers[V.g.PositionKind];f&&(f.dispose(),this._vertexBuffers[V.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11506:(f,v,Z)=>{Z.d(v,{c:()=>e});var V=Z(11513),h=Z(11421);class J{set opaqueSortCompareFn(f){this._opaqueSortCompareFn=f||J.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(f){this._alphaTestSortCompareFn=f||J.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(f){this._transparentSortCompareFn=f||J.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(f,v){let Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,J=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=f,this._opaqueSubMeshes=new V.f(256),this._transparentSubMeshes=new V.f(256),this._alphaTestSubMeshes=new V.f(256),this._depthOnlySubMeshes=new V.f(256),this._particleSystems=new V.f(256),this._spriteManagers=new V.f(256),this._empty=!0,this._edgesRenderers=new V.d(16),this._scene=v,this.opaqueSortCompareFn=Z,this.alphaTestSortCompareFn=h,this.transparentSortCompareFn=J}render(f,v,Z,V){if(f)return void f(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const h=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(h.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),h.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const J=h.getStencilBuffer();if(h.setStencilBuffer(!1),v&&this._renderSprites(),Z&&this._renderParticles(V),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(h.setStencilBuffer(J),this._scene.useOrderIndependentTransparency){const f=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);f.length&&this._renderTransparent(f)}else this._renderTransparent(this._transparentSubMeshes);h.setAlphaMode(0)}if(h.setStencilBuffer(!1),this._edgesRenderers.length){for(let f=0;f<this._edgesRenderers.length;f++)this._edgesRenderers.data[f].render();h.setAlphaMode(0)}h.setStencilBuffer(J)}_renderOpaqueSorted(f){J._RenderSorted(f,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(f){J._RenderSorted(f,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(f){J._RenderSorted(f,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(f,v,Z,V){let l,e=0;const C=Z?Z.globalPosition:J._ZeroVector;if(V)for(;e<f.length;e++)l=f.data[e],l._alphaIndex=l.getMesh().alphaIndex,l._distanceToCamera=h.Xv.Distance(l.getBoundingInfo().boundingSphere.centerWorld,C);const H=f.length===f.data.length?f.data:f.data.slice(0,f.length);v&&H.sort(v);const O=H[0].getMesh().Yf();for(e=0;e<H.length;e++)if(l=H[e],!O._activeMeshesFrozenButKeepClipping||l.isInFrustum(O._frustumPlanes)){if(V){const f=l.Ef();if(f&&f.needDepthPrePass){const v=f.Yf().getEngine();v.setColorWrite(!1),v.setAlphaMode(0),l.render(!1),v.setColorWrite(!0)}}l.render(V)}}static defaultTransparentSortCompare(f,v){return f._alphaIndex>v._alphaIndex?1:f._alphaIndex<v._alphaIndex?-1:J.backToFrontSortCompare(f,v)}static backToFrontSortCompare(f,v){return f._distanceToCamera<v._distanceToCamera?1:f._distanceToCamera>v._distanceToCamera?-1:0}static frontToBackSortCompare(f,v){return f._distanceToCamera<v._distanceToCamera?-1:f._distanceToCamera>v._distanceToCamera?1:0}static PainterSortCompare(f,v){const Z=f.getMesh(),V=v.getMesh();return Z.material&&V.material?Z.material.uniqueId-V.material.uniqueId:Z.uniqueId-V.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(f,v,Z){void 0===v&&(v=f.getMesh()),void 0===Z&&(Z=f.Ef()),null!==Z&&void 0!==Z&&(Z.needAlphaBlendingForMesh(v)?this._transparentSubMeshes.push(f):Z.needAlphaTestingForMesh(v)?(Z.needDepthPrePass&&this._depthOnlySubMeshes.push(f),this._alphaTestSubMeshes.push(f)):(Z.needDepthPrePass&&this._depthOnlySubMeshes.push(f),this._opaqueSubMeshes.push(f)),v._renderingGroup=this,v._edgesRenderer&&v.isEnabled()&&v.isVisible&&v._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(v._edgesRenderer),this._empty=!1)}dispatchSprites(f){this._spriteManagers.push(f),this._empty=!1}dispatchParticles(f){this._particleSystems.push(f),this._empty=!1}_renderParticles(f){if(0===this._particleSystems.length)return;const v=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let Z=0;Z<this._particleSystems.length;Z++){const V=this._particleSystems.data[Z];if(0===(v&&v.layerMask&V.layerMask))continue;const h=V.hv;h.position&&f&&-1===f.indexOf(h)||this._scene._activeParticles.addCount(V.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const f=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let v=0;v<this._spriteManagers.length;v++){const Z=this._spriteManagers.data[v];0!==(f&&f.layerMask&Z.layerMask)&&Z.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}J._ZeroVector=h.Xv.Zero();class l{}class e{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(f){f!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=f,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const f of this._scene.meshes)if(f.Bh)for(const v of f.Bh)v._wasDispatched=!1;if(this._scene.spriteManagers)for(const f of this._scene.spriteManagers)f._wasDispatched=!1;for(const f of this._scene.fW)f._wasDispatched=!1}constructor(f){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new l,this._maintainStateBetweenFrames=!1,this._scene=f;for(let v=e.MIN_RENDERINGGROUPS;v<e.MAX_RENDERINGGROUPS;v++)this._autoClearDepthStencil[v]={Th:!0,depth:!0,stencil:!0}}getRenderingGroup(f){const v=f||0;return this._prepareRenderingGroup(v),this._renderingGroups[v]}_clearDepthStencilBuffer(){let f=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],v=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,f,v),this._depthStencilBufferAlreadyCleaned=!0)}render(f,v,Z,V){const h=this._renderingGroupInfo;if(h.Uv=this._scene,h.camera=this._scene.activeCamera,h.renderingManager=this,this._scene.spriteManagers&&V)for(let J=0;J<this._scene.spriteManagers.length;J++){const f=this._scene.spriteManagers[J];this.dispatchSprites(f)}for(let J=e.MIN_RENDERINGGROUPS;J<e.MAX_RENDERINGGROUPS;J++){this._depthStencilBufferAlreadyCleaned=J===e.MIN_RENDERINGGROUPS;const l=this._renderingGroups[J];if(!l||l._empty)continue;const C=1<<J;if(h.renderingGroupId=J,this._scene.onBeforeRenderingGroupObservable.notifyObservers(h,C),e.AUTOCLEAR){const f=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(J):this._autoClearDepthStencil[J];f&&f.Th&&this._clearDepthStencilBuffer(f.depth,f.stencil)}for(const f of this._scene._beforeRenderingGroupDrawStage)f.action(J);l.render(f,V,Z,v);for(const f of this._scene._afterRenderingGroupDrawStage)f.action(J);this._scene.onAfterRenderingGroupObservable.notifyObservers(h,C)}}reset(){if(!this.maintainStateBetweenFrames)for(let f=e.MIN_RENDERINGGROUPS;f<e.MAX_RENDERINGGROUPS;f++){const v=this._renderingGroups[f];v&&v.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let f=e.MIN_RENDERINGGROUPS;f<e.MAX_RENDERINGGROUPS;f++){const v=this._renderingGroups[f];v&&v.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let f=e.MIN_RENDERINGGROUPS;f<e.MAX_RENDERINGGROUPS;f++){const v=this._renderingGroups[f];v&&v.dispose()}}_prepareRenderingGroup(f){void 0===this._renderingGroups[f]&&(this._renderingGroups[f]=new J(f,this._scene,this._customOpaqueSortCompareFn[f],this._customAlphaTestSortCompareFn[f],this._customTransparentSortCompareFn[f]))}dispatchSprites(f){this.maintainStateBetweenFrames&&f._wasDispatched||(f._wasDispatched=!0,this.getRenderingGroup(f.renderingGroupId).dispatchSprites(f))}dispatchParticles(f){this.maintainStateBetweenFrames&&f._wasDispatched||(f._wasDispatched=!0,this.getRenderingGroup(f.renderingGroupId).dispatchParticles(f))}dispatch(f,v,Z){void 0===v&&(v=f.getMesh()),this.maintainStateBetweenFrames&&f._wasDispatched||(f._wasDispatched=!0,this.getRenderingGroup(v.renderingGroupId).dispatch(f,v,Z))}setRenderingOrder(f){let v=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[f]=v,this._customAlphaTestSortCompareFn[f]=Z,this._customTransparentSortCompareFn[f]=V,this._renderingGroups[f]){const v=this._renderingGroups[f];v.opaqueSortCompareFn=this._customOpaqueSortCompareFn[f],v.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[f],v.transparentSortCompareFn=this._customTransparentSortCompareFn[f]}}setRenderingAutoClearDepthStencil(f,v){let Z=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],V=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[f]={Th:v,depth:Z,stencil:V}}getAutoClearDepthStencilSetup(f){return this._autoClearDepthStencil[f]}}e.MAX_RENDERINGGROUPS=4,e.MIN_RENDERINGGROUPS=0,e.AUTOCLEAR=!0}}]);