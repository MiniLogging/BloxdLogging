"use strict";(self.ynu1yiqvs98=self.ynu1yiqvs98||[]).push([[19],{11197:(I,E,j)=>{j.d(E,{c:()=>h,e:()=>t});var e=j(11202),w=j(10974),z=j(11210);class h{get Z(){return this._isDisposed}constructor(I,E,j){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],t=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0,R=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,I&&I.GI?this._engine=I.GI().getEngine():this._engine=I,this._updatable=j,this._instanced=h,this._divisor=U||1,this._label=R,E instanceof e.b?(this._data=null,this._buffer=E):(this._data=E,this._buffer=null),this.byteStride=t?w:w*Float32Array.BYTES_PER_ELEMENT,z||this.create()}createVertexBuffer(I,E,j,e,w){let z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6?arguments[6]:void 0;const U=z?E:E*Float32Array.BYTES_PER_ELEMENT,R=e?z?e:e*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new t(this._engine,this,I,this._updatable,!0,R,void 0===w?this._instanced:w,U,j,void 0,void 0,!0,this._divisor||h)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!I&&this._buffer||(I=I||this._data,I&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,I),this._data=I):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(I,this._label),this._data=I):this._buffer=this._engine.createVertexBuffer(I,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Pj>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Pj,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Pj,void 0,this._label));w.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(I){this.create(I)}updateDirectly(I,E,j){let e=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,I,e?E:E*Float32Array.BYTES_PER_ELEMENT,j?j*this.byteStride:void 0),this._data=0===E&&void 0===j?I:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class t{get Z(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(I){const E=0!=I;this._instanceDivisor=I,E!==this._instanced&&(this._instanced=E,this._computeHashCode())}get _maxVerticesCount(){const I=this.getData();return I?Array.isArray(I)?I.length/(this.byteStride/4)-this.byteOffset/4:(I.byteLength-this.byteOffset)/this.byteStride:0}constructor(I,E,j,e,w,U,R,P,o,Z){let c=arguments.length>10&&void 0!==arguments[10]&&arguments[10],K=arguments.length>11&&void 0!==arguments[11]&&arguments[11],L=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,F=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let C=!1;if(this.KE=I,"object"===typeof e&&null!==e?(C=e.updatable??!1,w=e.postponeInternalCreation,U=e.stride,R=e.instanced,P=e.offset,o=e.size,Z=e.type,c=e.normalized??!1,K=e.useBytes??!1,L=e.divisor??1,F=e.takeBufferOwnership??!1,this._label=e.label):C=!!e,E instanceof h?(this._buffer=E,this._ownsBuffer=F):(this._buffer=new h(I,E,C,U,w,R,K,L,this._label),this._ownsBuffer=!0),this.uniqueId=t._Counter++,this._kind=j,void 0===Z){const I=this.getData();this.type=I?t.GetDataType(I):t.FLOAT}else this.type=Z;const X=(0,z.l)(this.type);K?(this._size=o||(U?U/X:t.DeduceStride(j)),this.byteStride=U||this._buffer.byteStride||this._size*X,this.byteOffset=P||0):(this._size=o||U||t.DeduceStride(j),this.byteStride=U?U*X:this._buffer.byteStride||this._size*X,this.byteOffset=(P||0)*X),this.normalized=c,this._instanced=void 0!==R&&R,this._instanceDivisor=R?L:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var I;null===(I=this._buffer)||void 0===I||I._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(I,E){const j=this.getData();return j?(0,z.h)(j,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,I,E):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,z.l)(this.type)}getOffset(){return this.byteOffset/(0,z.l)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,z.l)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(I){this._buffer.create(I),this._alignBuffer()}update(I){this._buffer.update(I),this._alignBuffer()}updateDirectly(I,E){let j=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(I,E,void 0,j),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(I,E){(0,z.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,I,this.normalized,((I,j)=>{for(let e=0;e<this._size;e++)E(I[e],j+e)}))}_alignBuffer(){}static DeduceStride(I){switch(I){case t.UVKind:case t.UV2Kind:case t.UV3Kind:case t.UV4Kind:case t.UV5Kind:case t.UV6Kind:return 2;case t.NormalKind:case t.PositionKind:return 3;case t.ColorKind:case t.ColorInstanceKind:case t.MatricesIndicesKind:case t.MatricesIndicesExtraKind:case t.MatricesWeightsKind:case t.MatricesWeightsExtraKind:case t.TangentKind:return 4;default:throw new Error("Invalid kind '"+I+"'")}}static GetDataType(I){return I instanceof Int8Array?t.BYTE:I instanceof Uint8Array?t.UNSIGNED_BYTE:I instanceof Int16Array?t.SHORT:I instanceof Uint16Array?t.UNSIGNED_SHORT:I instanceof Int32Array?t.INT:I instanceof Uint32Array?t.UNSIGNED_INT:t.FLOAT}static GetTypeByteLength(I){return(0,z.l)(I)}static ForEach(I,E,j,e,w,h,t,U){(0,z.g)(I,E,j,e,w,h,t,((I,E)=>{for(let j=0;j<e;j++)U(I[j],E+j)}))}static GetFloatData(I,E,j,e,w,h,t,U){return(0,z.h)(I,E,j,e,w,h,t,U)}}t._Counter=0,t.BYTE=5120,t.UNSIGNED_BYTE=5121,t.SHORT=5122,t.UNSIGNED_SHORT=5123,t.INT=5124,t.UNSIGNED_INT=5125,t.FLOAT=5126,t.PositionKind="position",t.NormalKind="normal",t.TangentKind="tangent",t.UVKind="uv",t.UV2Kind="uv2",t.UV3Kind="uv3",t.UV4Kind="uv4",t.UV5Kind="uv5",t.UV6Kind="uv6",t.ColorKind="color",t.ColorInstanceKind="instanceColor",t.MatricesIndicesKind="matricesIndices",t.MatricesWeightsKind="matricesWeights",t.MatricesIndicesExtraKind="matricesIndicesExtra",t.MatricesWeightsExtraKind="matricesWeightsExtra"},11210:(I,E,j)=>{j.d(E,{c:()=>Z,d:()=>o,g:()=>U,h:()=>R,l:()=>h,o:()=>t,s:()=>P});var e=j(10974);function w(I,E,j,e){switch(E){case 5120:{let E=I.getInt8(j);return e&&(E=Math.max(E/127,-1)),E}case 5121:{let E=I.getUint8(j);return e&&(E/=255),E}case 5122:{let E=I.getInt16(j,!0);return e&&(E=Math.max(E/32767,-1)),E}case 5123:{let E=I.getUint16(j,!0);return e&&(E/=65535),E}case 5124:return I.getInt32(j,!0);case 5125:return I.getUint32(j,!0);case 5126:return I.getFloat32(j,!0);default:throw new Error(`Invalid component type ${E}`)}}function z(I,E,j,e,w){switch(E){case 5120:e&&(w=Math.round(127*w)),I.setInt8(j,w);break;case 5121:e&&(w=Math.round(255*w)),I.setUint8(j,w);break;case 5122:e&&(w=Math.round(32767*w)),I.setInt16(j,w,!0);break;case 5123:e&&(w=Math.round(65535*w)),I.setUint16(j,w,!0);break;case 5124:I.setInt32(j,w,!0);break;case 5125:I.setUint32(j,w,!0);break;case 5126:I.setFloat32(j,w,!0);break;default:throw new Error(`Invalid component type ${E}`)}}function h(I){switch(I){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${I}'`)}}function t(I){switch(I){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${I}'`)}}function U(I,E,j,e,t,U,R,P){const o=new Array(e),Z=new Array(e);if(I instanceof Array){let w=E/4;const z=j/4;for(let E=0;E<U;E+=e){for(let E=0;E<e;E++)o[E]=Z[E]=I[w+E];P(Z,E);for(let E=0;E<e;E++)o[E]!==Z[E]&&(I[w+E]=Z[E]);w+=z}}else{const c=ArrayBuffer.isView(I)?new DataView(I.buffer,I.byteOffset,I.byteLength):new DataView(I),K=h(t);for(let I=0;I<U;I+=e){for(let I=0,j=E;I<e;I++,j+=K)o[I]=Z[I]=w(c,t,j,R);P(Z,I);for(let I=0,j=E;I<e;I++,j+=K)o[I]!==Z[I]&&z(c,t,j,R,Z[I]);E+=j}}}function R(I,E,j,w,z,t,R,P){const o=E*h(j),Z=R*E;if(5126!==j||z!==o){const e=new Float32Array(Z);return U(I,w,z,E,j,Z,t,((I,j)=>{for(let w=0;w<E;w++)e[j+w]=I[w]})),e}if(!(I instanceof Array||I instanceof Float32Array)||0!==w||I.length!==Z){if(I instanceof Array){const E=w/4;return I.slice(E,E+Z)}if(I instanceof ArrayBuffer)return new Float32Array(I,w,Z);{const E=I.byteOffset+w;return 0!==(3&E)&&(e.b.Warn("Float array must be aligned to 4-bytes border"),P=!0),P?new Float32Array(I.buffer.slice(E,E+Z*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(I.buffer,E,Z)}}return P?I.slice():I}function P(I,E,j,w,z,R,P,o){const Z=h(j),c=t(j),K=P*E;if(Array.isArray(I)){if(0!==(3&w)||0!==(3&z))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const e=w/4,h=z/4;if(e+(P-1)*h+E>I.length)throw new Error("Last accessed index is out of bounds.");if(h<E)throw new Error("Data stride cannot be smaller than the component size.");if(h!==E){const e=new c(K);return U(I,w,z,E,j,K,R,((I,j)=>{for(let w=0;w<E;w++)e[j+w]=I[w]})),e}return new c(I.slice(e,e+K))}let L,F=w;I instanceof ArrayBuffer?L=I:(L=I.buffer,F+=I.byteOffset);if(F+(P-1)*z+E*Z>L.byteLength)throw new Error("Last accessed byte is out of bounds.");const C=E*Z;if(z<C)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(z!==C){const I=new c(K);return U(L,F,z,E,j,K,R,((j,e)=>{for(let w=0;w<E;w++)I[e+w]=j[w]})),I}return 1!==Z&&0!==(F&Z-1)&&(e.b.Warn("Array must be aligned to border of element size. Data will be copied."),o=!0),o?new c(L.slice(F,F+K*Z)):new c(L,F,K)}function o(I,E,j,w,z,t,R,P){const o=E*h(j),Z=R*E;if(P.length!==Z)throw new Error("Output length is not valid");if(5126===j&&z===o)if(I instanceof Array){const E=w/4;P.set(I,E)}else if(I instanceof ArrayBuffer){const E=new Float32Array(I,w,Z);P.set(E)}else{const E=I.byteOffset+w;if(0!==(3&E))return e.b.Warn("Float array must be aligned to 4-bytes border"),void P.set(new Float32Array(I.buffer.slice(E,E+Z*Float32Array.BYTES_PER_ELEMENT)));const j=new Float32Array(I.buffer,E,Z);P.set(j)}else U(I,w,z,E,j,Z,t,((I,j)=>{for(let e=0;e<E;e++)P[j+e]=I[e]}))}function Z(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(I)){for(let w=0;w<E;w++)if(I[j+w]-e>65535)return!0;return!1}return 4===I.BYTES_PER_ELEMENT}},11202:(I,E,j)=>{j.d(E,{b:()=>e});class e{get underlyingResource(){return null}constructor(){this.references=0,this.Pj=0,this.is32Bits=!1,this.uniqueId=e._Counter++}}e._Counter=0},11246:(I,E,j)=>{j.d(E,{e:()=>w});var e=j(11031);class w{static GetEffect(I){return void 0===I.getPipelineContext?I.effect:I}constructor(I){let E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=I.createDrawContext(),E&&(this.materialContext=I.createMaterialContext())}setEffect(I,E){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var e;(this.effect=I,void 0!==E&&(this.defines=E),j)&&(null===(e=this.drawContext)||void 0===e||e.reset())}dispose(){var I;let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const I=this.effect;E?I.dispose():e.b.SetImmediate((()=>{I.getEngine().onEndFrameObservable.addOnce((()=>{I.dispose()}))})),this.effect=null}null===(I=this.drawContext)||void 0===I||I.dispose()}}},11328:(I,E,j)=>{j.d(E,{d:()=>w});var e=j(11167);class w{static GetPlanes(I){const E=[];for(let j=0;j<6;j++)E.push(new e.b(0,0,0,0));return w.GetPlanesToRef(I,E),E}static GetNearPlaneToRef(I,E){const j=I.m;E.normal.x=j[3]+j[2],E.normal.y=j[7]+j[6],E.normal.z=j[11]+j[10],E.d=j[15]+j[14],E.normalize()}static GetFarPlaneToRef(I,E){const j=I.m;E.normal.x=j[3]-j[2],E.normal.y=j[7]-j[6],E.normal.z=j[11]-j[10],E.d=j[15]-j[14],E.normalize()}static GetLeftPlaneToRef(I,E){const j=I.m;E.normal.x=j[3]+j[0],E.normal.y=j[7]+j[4],E.normal.z=j[11]+j[8],E.d=j[15]+j[12],E.normalize()}static GetRightPlaneToRef(I,E){const j=I.m;E.normal.x=j[3]-j[0],E.normal.y=j[7]-j[4],E.normal.z=j[11]-j[8],E.d=j[15]-j[12],E.normalize()}static GetTopPlaneToRef(I,E){const j=I.m;E.normal.x=j[3]-j[1],E.normal.y=j[7]-j[5],E.normal.z=j[11]-j[9],E.d=j[15]-j[13],E.normalize()}static GetBottomPlaneToRef(I,E){const j=I.m;E.normal.x=j[3]+j[1],E.normal.y=j[7]+j[5],E.normal.z=j[11]+j[9],E.d=j[15]+j[13],E.normalize()}static GetPlanesToRef(I,E){w.GetNearPlaneToRef(I,E[0]),w.GetFarPlaneToRef(I,E[1]),w.GetLeftPlaneToRef(I,E[2]),w.GetRightPlaneToRef(I,E[3]),w.GetTopPlaneToRef(I,E[4]),w.GetBottomPlaneToRef(I,E[5])}static IsPointInFrustum(I,E){for(let j=0;j<6;j++)if(E[j].dotCoordinate(I)<0)return!1;return!0}}},11343:(I,E,j)=>{j.d(E,{e:()=>w});var e=j(10983);class w{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(I,E){w.Enabled&&(this._current+=I,E&&this._fetchResult())}beginMonitoring(){w.Enabled&&(this._startMonitoringTime=e.e.Now)}endMonitoring(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!w.Enabled)return;I&&this.fetchNewFrame();const E=e.e.Now;this._current=E-this._startMonitoringTime,I&&this._fetchResult()}Ze(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const I=e.e.Now;I-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=I,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}w.Enabled=!0},11222:(I,E,j)=>{j.d(E,{e:()=>w,f:()=>e});class e{constructor(I){this.length=0,this.data=new Array(I),this._id=e._GlobalId++}push(I){this.data[this.length++]=I,this.length>this.data.length&&(this.data.length*=2)}forEach(I){for(let E=0;E<this.length;E++)I(this.data[E])}sort(I){this.data.sort(I)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(I){if(0!==I.length){this.length+I.length>this.data.length&&(this.data.length=2*(this.length+I.length));for(let E=0;E<I.length;E++)this.data[this.length++]=(I.data||I)[E]}}indexOf(I){const E=this.data.indexOf(I);return E>=this.length?-1:E}contains(I){return-1!==this.indexOf(I)}}e._GlobalId=0;class w extends e{constructor(){super(...arguments),this._duplicateId=0}push(I){super.push(I),I.__smartArrayFlags||(I.__smartArrayFlags={}),I.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(I){return(!I.__smartArrayFlags||I.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(I),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(I){if(0!==I.length){this.length+I.length>this.data.length&&(this.data.length=2*(this.length+I.length));for(let E=0;E<I.length;E++){const j=(I.data||I)[E];this.pushNoDuplicate(j)}}}}},11189:(I,E,j)=>{j.d(E,{b:()=>z});var e=j(11197),w=j(10960);class z{constructor(I){this._vertexBuffers={},this.onBeforeRenderObservable=new w.e,this._scene=I}_prepareBuffers(){if(this._vertexBuffers[e.e.PositionKind])return;const I=[];I.push(1,1),I.push(-1,1),I.push(-1,-1),I.push(1,-1),this._vertexBuffers[e.e.PositionKind]=new e.e(this._scene.getEngine(),I,e.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const I=[];I.push(0),I.push(1),I.push(2),I.push(0),I.push(2),I.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(I)}_rebuild(){const I=this._vertexBuffers[e.e.PositionKind];I&&(I._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let I=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const j=this._scene.activeCamera;return!!j&&(E=E||j._postProcesses.filter((I=>null!=I)),!(!E||0===E.length||!this._scene.postProcessesEnabled)&&(E[0].activate(j,I,null!==E&&void 0!==E),!0))}directRender(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,w=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],h=arguments.length>6&&void 0!==arguments[6]?arguments[6]:I.length;const t=this._scene.getEngine();for(let R=0;R<h;R++){var U;if(R<I.length-1)I[R+1].activate(this._scene.activeCamera||this._scene,null===E||void 0===E?void 0:E.texture);else E?t.bindFramebuffer(E,e,void 0,void 0,j,w):z||t.restoreDefaultFramebuffer(),null===(U=t._debugInsertMarker)||void 0===U||U.call(t,`post process ${I[R].name} output`);const h=I[R],P=h.apply();P&&(h.onBeforeRenderObservable.notifyObservers(P),this._prepareBuffers(),t.bindBuffers(this._vertexBuffers,this._indexBuffer,P),t.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(P))}t.setDepthBuffer(!0),t.setDepthWrite(!0)}_finalizeFrame(I,E,j,e){let w=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const z=this._scene.activeCamera;if(!z)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(e=e||z._postProcesses.filter((I=>null!=I))).length||!this._scene.postProcessesEnabled)return;const h=this._scene.getEngine();for(let U=0,R=e.length;U<R;U++){const P=e[U];var t;if(U<R-1)P._outputTexture=e[U+1].activate(z,null===E||void 0===E?void 0:E.texture);else E?(h.bindFramebuffer(E,j,void 0,void 0,w),P._outputTexture=E):(h.restoreDefaultFramebuffer(),P._outputTexture=null),null===(t=h._debugInsertMarker)||void 0===t||t.call(h,`post process ${e[U].name} output`);if(I)break;const o=P.apply();o&&(P.onBeforeRenderObservable.notifyObservers(o),this._prepareBuffers(),h.bindBuffers(this._vertexBuffers,this._indexBuffer,o),h.drawElementsType(0,0,6),P.onAfterRenderObservable.notifyObservers(o))}h.setDepthBuffer(!0),h.setDepthWrite(!0),h.setAlphaMode(0)}dispose(){const I=this._vertexBuffers[e.e.PositionKind];I&&(I.dispose(),this._vertexBuffers[e.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11219:(I,E,j)=>{j.d(E,{c:()=>t});var e=j(11222),w=j(11117);class z{set opaqueSortCompareFn(I){this._opaqueSortCompareFn=I||z.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(I){this._alphaTestSortCompareFn=I||z.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(I){this._transparentSortCompareFn=I||z.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(I,E){let j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=I,this._opaqueSubMeshes=new e.f(256),this._transparentSubMeshes=new e.f(256),this._alphaTestSubMeshes=new e.f(256),this._depthOnlySubMeshes=new e.f(256),this._particleSystems=new e.f(256),this._spriteManagers=new e.f(256),this._empty=!0,this._edgesRenderers=new e.e(16),this._scene=E,this.opaqueSortCompareFn=j,this.alphaTestSortCompareFn=w,this.transparentSortCompareFn=z}render(I,E,j,e){if(I)return void I(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const w=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(w.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),w.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const z=w.getStencilBuffer();if(w.setStencilBuffer(!1),E&&this._renderSprites(),j&&this._renderParticles(e),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(w.setStencilBuffer(z),this._scene.useOrderIndependentTransparency){const I=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);I.length&&this._renderTransparent(I)}else this._renderTransparent(this._transparentSubMeshes);w.setAlphaMode(0)}if(w.setStencilBuffer(!1),this._edgesRenderers.length){for(let I=0;I<this._edgesRenderers.length;I++)this._edgesRenderers.data[I].render();w.setAlphaMode(0)}w.setStencilBuffer(z)}_renderOpaqueSorted(I){z._RenderSorted(I,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(I){z._RenderSorted(I,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(I){z._RenderSorted(I,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(I,E,j,e){let h,t=0;const U=j?j.globalPosition:z._ZeroVector;if(e)for(;t<I.length;t++)h=I.data[t],h._alphaIndex=h.getMesh().alphaIndex,h._distanceToCamera=w.LE.Distance(h.getBoundingInfo().boundingSphere.centerWorld,U);const R=I.length===I.data.length?I.data:I.data.slice(0,I.length);E&&R.sort(E);const P=R[0].getMesh().GI();for(t=0;t<R.length;t++)if(h=R[t],!P._activeMeshesFrozenButKeepClipping||h.isInFrustum(P._frustumPlanes)){if(e){const I=h.TI();if(I&&I.needDepthPrePass){const E=I.GI().getEngine();E.setColorWrite(!1),E.setAlphaMode(0),h.render(!1),E.setColorWrite(!0)}}h.render(e)}}static defaultTransparentSortCompare(I,E){return I._alphaIndex>E._alphaIndex?1:I._alphaIndex<E._alphaIndex?-1:z.backToFrontSortCompare(I,E)}static backToFrontSortCompare(I,E){return I._distanceToCamera<E._distanceToCamera?1:I._distanceToCamera>E._distanceToCamera?-1:0}static frontToBackSortCompare(I,E){return I._distanceToCamera<E._distanceToCamera?-1:I._distanceToCamera>E._distanceToCamera?1:0}static PainterSortCompare(I,E){const j=I.getMesh(),e=E.getMesh();return j.material&&e.material?j.material.uniqueId-e.material.uniqueId:j.uniqueId-e.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(I,E,j){void 0===E&&(E=I.getMesh()),void 0===j&&(j=I.TI()),null!==j&&void 0!==j&&(j.needAlphaBlendingForMesh(E)?this._transparentSubMeshes.push(I):j.needAlphaTestingForMesh(E)?(j.needDepthPrePass&&this._depthOnlySubMeshes.push(I),this._alphaTestSubMeshes.push(I)):(j.needDepthPrePass&&this._depthOnlySubMeshes.push(I),this._opaqueSubMeshes.push(I)),E._renderingGroup=this,E._edgesRenderer&&E.isEnabled()&&E.isVisible&&E._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(E._edgesRenderer),this._empty=!1)}dispatchSprites(I){this._spriteManagers.push(I),this._empty=!1}dispatchParticles(I){this._particleSystems.push(I),this._empty=!1}_renderParticles(I){if(0===this._particleSystems.length)return;const E=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let j=0;j<this._particleSystems.length;j++){const e=this._particleSystems.data[j];if(0===(E&&E.layerMask&e.layerMask))continue;const w=e.wE;w.position&&I&&-1===I.indexOf(w)||this._scene._activeParticles.addCount(e.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const I=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let E=0;E<this._spriteManagers.length;E++){const j=this._spriteManagers.data[E];0!==(I&&I.layerMask&j.layerMask)&&j.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}z._ZeroVector=w.LE.Zero();class h{}class t{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(I){I!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=I,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const I of this._scene.meshes)if(I.ie)for(const E of I.ie)E._wasDispatched=!1;if(this._scene.spriteManagers)for(const I of this._scene.spriteManagers)I._wasDispatched=!1;for(const I of this._scene.hZ)I._wasDispatched=!1}constructor(I){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new h,this._maintainStateBetweenFrames=!1,this._scene=I;for(let E=t.MIN_RENDERINGGROUPS;E<t.MAX_RENDERINGGROUPS;E++)this._autoClearDepthStencil[E]={le:!0,depth:!0,stencil:!0}}getRenderingGroup(I){const E=I||0;return this._prepareRenderingGroup(E),this._renderingGroups[E]}_clearDepthStencilBuffer(){let I=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],E=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,I,E),this._depthStencilBufferAlreadyCleaned=!0)}render(I,E,j,e){const w=this._renderingGroupInfo;if(w.CE=this._scene,w.camera=this._scene.activeCamera,w.renderingManager=this,this._scene.spriteManagers&&e)for(let z=0;z<this._scene.spriteManagers.length;z++){const I=this._scene.spriteManagers[z];this.dispatchSprites(I)}for(let z=t.MIN_RENDERINGGROUPS;z<t.MAX_RENDERINGGROUPS;z++){this._depthStencilBufferAlreadyCleaned=z===t.MIN_RENDERINGGROUPS;const h=this._renderingGroups[z];if(!h||h._empty)continue;const U=1<<z;if(w.renderingGroupId=z,this._scene.onBeforeRenderingGroupObservable.notifyObservers(w,U),t.AUTOCLEAR){const I=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(z):this._autoClearDepthStencil[z];I&&I.le&&this._clearDepthStencilBuffer(I.depth,I.stencil)}for(const I of this._scene._beforeRenderingGroupDrawStage)I.action(z);h.render(I,e,j,E);for(const I of this._scene._afterRenderingGroupDrawStage)I.action(z);this._scene.onAfterRenderingGroupObservable.notifyObservers(w,U)}}reset(){if(!this.maintainStateBetweenFrames)for(let I=t.MIN_RENDERINGGROUPS;I<t.MAX_RENDERINGGROUPS;I++){const E=this._renderingGroups[I];E&&E.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let I=t.MIN_RENDERINGGROUPS;I<t.MAX_RENDERINGGROUPS;I++){const E=this._renderingGroups[I];E&&E.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let I=t.MIN_RENDERINGGROUPS;I<t.MAX_RENDERINGGROUPS;I++){const E=this._renderingGroups[I];E&&E.dispose()}}_prepareRenderingGroup(I){void 0===this._renderingGroups[I]&&(this._renderingGroups[I]=new z(I,this._scene,this._customOpaqueSortCompareFn[I],this._customAlphaTestSortCompareFn[I],this._customTransparentSortCompareFn[I]))}dispatchSprites(I){this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatchSprites(I))}dispatchParticles(I){this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(I.renderingGroupId).dispatchParticles(I))}dispatch(I,E,j){void 0===E&&(E=I.getMesh()),this.maintainStateBetweenFrames&&I._wasDispatched||(I._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatch(I,E,j))}setRenderingOrder(I){let E=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,j=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[I]=E,this._customAlphaTestSortCompareFn[I]=j,this._customTransparentSortCompareFn[I]=e,this._renderingGroups[I]){const E=this._renderingGroups[I];E.opaqueSortCompareFn=this._customOpaqueSortCompareFn[I],E.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[I],E.transparentSortCompareFn=this._customTransparentSortCompareFn[I]}}setRenderingAutoClearDepthStencil(I,E){let j=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[I]={le:E,depth:j,stencil:e}}getAutoClearDepthStencilSetup(I){return this._autoClearDepthStencil[I]}}t.MAX_RENDERINGGROUPS=4,t.MIN_RENDERINGGROUPS=0,t.AUTOCLEAR=!0}}]);