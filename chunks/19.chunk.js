"use strict";(self["3b8bnhi4gzj"]=self["3b8bnhi4gzj"]||[]).push([[19],{11805:(Z,h,V)=>{V.d(h,{b:()=>K,f:()=>d});var v=V(11813),A=V(11580),H=V(11822);class K{get K(){return this._isDisposed}constructor(Z,h,V){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,H=arguments.length>4&&void 0!==arguments[4]&&arguments[4],K=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=arguments.length>6&&void 0!==arguments[6]&&arguments[6],a=arguments.length>7?arguments[7]:void 0,n=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,Z&&Z.CZ?this._engine=Z.CZ().getEngine():this._engine=Z,this._updatable=V,this._instanced=K,this._divisor=a||1,this._label=n,h instanceof v.d?(this._data=null,this._buffer=h):(this._data=h,this._buffer=null),this.byteStride=d?A:A*Float32Array.BYTES_PER_ELEMENT,H||this.create()}createVertexBuffer(Z,h,V,v,A){let H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6?arguments[6]:void 0;const a=H?h:h*Float32Array.BYTES_PER_ELEMENT,n=v?H?v:v*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new d(this._engine,this,Z,this._updatable,!0,n,void 0===A?this._instanced:A,a,V,void 0,void 0,!0,this._divisor||K)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!Z&&this._buffer||(Z=Z||this._data,Z&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z),this._data=Z):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(Z,this._label),this._data=Z):this._buffer=this._engine.createVertexBuffer(Z,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Th>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Th,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Th,void 0,this._label));A.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(Z){this.create(Z)}updateDirectly(Z,h,V){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,Z,v?h:h*Float32Array.BYTES_PER_ELEMENT,V?V*this.byteStride:void 0),this._data=0===h&&void 0===V?Z:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class d{get K(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(Z){const h=0!=Z;this._instanceDivisor=Z,h!==this._instanced&&(this._instanced=h,this._computeHashCode())}get _maxVerticesCount(){const Z=this.getData();return Z?Array.isArray(Z)?Z.length/(this.byteStride/4)-this.byteOffset/4:(Z.byteLength-this.byteOffset)/this.byteStride:0}constructor(Z,h,V,v,A,a,n,x,N,D){let k=arguments.length>10&&void 0!==arguments[10]&&arguments[10],u=arguments.length>11&&void 0!==arguments[11]&&arguments[11],F=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,b=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let o=!1;if(this.Ph=Z,"object"===typeof v&&null!==v?(o=v.updatable??!1,A=v.postponeInternalCreation,a=v.stride,n=v.instanced,x=v.offset,N=v.size,D=v.type,k=v.normalized??!1,u=v.useBytes??!1,F=v.divisor??1,b=v.takeBufferOwnership??!1,this._label=v.label):o=!!v,h instanceof K?(this._buffer=h,this._ownsBuffer=b):(this._buffer=new K(Z,h,o,a,A,n,u,F,this._label),this._ownsBuffer=!0),this.uniqueId=d._Counter++,this._kind=V,void 0===D){const Z=this.getData();this.type=Z?d.GetDataType(Z):d.FLOAT}else this.type=D;const q=(0,H.k)(this.type);u?(this._size=N||(a?a/q:d.DeduceStride(V)),this.byteStride=a||this._buffer.byteStride||this._size*q,this.byteOffset=x||0):(this._size=N||a||d.DeduceStride(V),this.byteStride=a?a*q:this._buffer.byteStride||this._size*q,this.byteOffset=(x||0)*q),this.normalized=k,this._instanced=void 0!==n&&n,this._instanceDivisor=n?F:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var Z;null===(Z=this._buffer)||void 0===Z||Z._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(Z,h){const V=this.getData();return V?(0,H.h)(V,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,Z,h):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,H.k)(this.type)}getOffset(){return this.byteOffset/(0,H.k)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,H.k)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(Z){this._buffer.create(Z),this._alignBuffer()}update(Z){this._buffer.update(Z),this._alignBuffer()}updateDirectly(Z,h){let V=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(Z,h,void 0,V),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(Z,h){(0,H.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,Z,this.normalized,((Z,V)=>{for(let v=0;v<this._size;v++)h(Z[v],V+v)}))}_alignBuffer(){}static DeduceStride(Z){switch(Z){case d.UVKind:case d.UV2Kind:case d.UV3Kind:case d.UV4Kind:case d.UV5Kind:case d.UV6Kind:return 2;case d.NormalKind:case d.PositionKind:return 3;case d.ColorKind:case d.ColorInstanceKind:case d.MatricesIndicesKind:case d.MatricesIndicesExtraKind:case d.MatricesWeightsKind:case d.MatricesWeightsExtraKind:case d.TangentKind:return 4;default:throw new Error("Invalid kind '"+Z+"'")}}static GetDataType(Z){return Z instanceof Int8Array?d.BYTE:Z instanceof Uint8Array?d.UNSIGNED_BYTE:Z instanceof Int16Array?d.SHORT:Z instanceof Uint16Array?d.UNSIGNED_SHORT:Z instanceof Int32Array?d.INT:Z instanceof Uint32Array?d.UNSIGNED_INT:d.FLOAT}static GetTypeByteLength(Z){return(0,H.k)(Z)}static ForEach(Z,h,V,v,A,K,d,a){(0,H.g)(Z,h,V,v,A,K,d,((Z,h)=>{for(let V=0;V<v;V++)a(Z[V],h+V)}))}static GetFloatData(Z,h,V,v,A,K,d,a){return(0,H.h)(Z,h,V,v,A,K,d,a)}}d._Counter=0,d.BYTE=5120,d.UNSIGNED_BYTE=5121,d.SHORT=5122,d.UNSIGNED_SHORT=5123,d.INT=5124,d.UNSIGNED_INT=5125,d.FLOAT=5126,d.PositionKind="position",d.NormalKind="normal",d.TangentKind="tangent",d.UVKind="uv",d.UV2Kind="uv2",d.UV3Kind="uv3",d.UV4Kind="uv4",d.UV5Kind="uv5",d.UV6Kind="uv6",d.ColorKind="color",d.ColorInstanceKind="instanceColor",d.MatricesIndicesKind="matricesIndices",d.MatricesWeightsKind="matricesWeights",d.MatricesIndicesExtraKind="matricesIndicesExtra",d.MatricesWeightsExtraKind="matricesWeightsExtra"},11822:(Z,h,V)=>{V.d(h,{b:()=>D,f:()=>N,g:()=>a,h:()=>n,k:()=>K,o:()=>d,r:()=>x});var v=V(11580);function A(Z,h,V,v){switch(h){case 5120:{let h=Z.getInt8(V);return v&&(h=Math.max(h/127,-1)),h}case 5121:{let h=Z.getUint8(V);return v&&(h/=255),h}case 5122:{let h=Z.getInt16(V,!0);return v&&(h=Math.max(h/32767,-1)),h}case 5123:{let h=Z.getUint16(V,!0);return v&&(h/=65535),h}case 5124:return Z.getInt32(V,!0);case 5125:return Z.getUint32(V,!0);case 5126:return Z.getFloat32(V,!0);default:throw new Error(`Invalid component type ${h}`)}}function H(Z,h,V,v,A){switch(h){case 5120:v&&(A=Math.round(127*A)),Z.setInt8(V,A);break;case 5121:v&&(A=Math.round(255*A)),Z.setUint8(V,A);break;case 5122:v&&(A=Math.round(32767*A)),Z.setInt16(V,A,!0);break;case 5123:v&&(A=Math.round(65535*A)),Z.setUint16(V,A,!0);break;case 5124:Z.setInt32(V,A,!0);break;case 5125:Z.setUint32(V,A,!0);break;case 5126:Z.setFloat32(V,A,!0);break;default:throw new Error(`Invalid component type ${h}`)}}function K(Z){switch(Z){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${Z}'`)}}function d(Z){switch(Z){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${Z}'`)}}function a(Z,h,V,v,d,a,n,x){const N=new Array(v),D=new Array(v);if(Z instanceof Array){let A=h/4;const H=V/4;for(let h=0;h<a;h+=v){for(let h=0;h<v;h++)N[h]=D[h]=Z[A+h];x(D,h);for(let h=0;h<v;h++)N[h]!==D[h]&&(Z[A+h]=D[h]);A+=H}}else{const k=ArrayBuffer.isView(Z)?new DataView(Z.buffer,Z.byteOffset,Z.byteLength):new DataView(Z),u=K(d);for(let Z=0;Z<a;Z+=v){for(let Z=0,V=h;Z<v;Z++,V+=u)N[Z]=D[Z]=A(k,d,V,n);x(D,Z);for(let Z=0,V=h;Z<v;Z++,V+=u)N[Z]!==D[Z]&&H(k,d,V,n,D[Z]);h+=V}}}function n(Z,h,V,A,H,d,n,x){const N=h*K(V),D=n*h;if(5126!==V||H!==N){const v=new Float32Array(D);return a(Z,A,H,h,V,D,d,((Z,V)=>{for(let A=0;A<h;A++)v[V+A]=Z[A]})),v}if(!(Z instanceof Array||Z instanceof Float32Array)||0!==A||Z.length!==D){if(Z instanceof Array){const h=A/4;return Z.slice(h,h+D)}if(Z instanceof ArrayBuffer)return new Float32Array(Z,A,D);{const h=Z.byteOffset+A;return 0!==(3&h)&&(v.b.Warn("Float array must be aligned to 4-bytes border"),x=!0),x?new Float32Array(Z.buffer.slice(h,h+D*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(Z.buffer,h,D)}}return x?Z.slice():Z}function x(Z,h,V,A,H,n,x,N){const D=K(V),k=d(V),u=x*h;if(Array.isArray(Z)){if(0!==(3&A)||0!==(3&H))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const v=A/4,K=H/4;if(v+(x-1)*K+h>Z.length)throw new Error("Last accessed index is out of bounds.");if(K<h)throw new Error("Data stride cannot be smaller than the component size.");if(K!==h){const v=new k(u);return a(Z,A,H,h,V,u,n,((Z,V)=>{for(let A=0;A<h;A++)v[V+A]=Z[A]})),v}return new k(Z.slice(v,v+u))}let F,b=A;Z instanceof ArrayBuffer?F=Z:(F=Z.buffer,b+=Z.byteOffset);if(b+(x-1)*H+h*D>F.byteLength)throw new Error("Last accessed byte is out of bounds.");const o=h*D;if(H<o)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(H!==o){const Z=new k(u);return a(F,b,H,h,V,u,n,((V,v)=>{for(let A=0;A<h;A++)Z[v+A]=V[A]})),Z}return 1!==D&&0!==(b&D-1)&&(v.b.Warn("Array must be aligned to border of element size. Data will be copied."),N=!0),N?new k(F.slice(b,b+u*D)):new k(F,b,u)}function N(Z,h,V,A,H,d,n,x){const N=h*K(V),D=n*h;if(x.length!==D)throw new Error("Output length is not valid");if(5126===V&&H===N)if(Z instanceof Array){const h=A/4;x.set(Z,h)}else if(Z instanceof ArrayBuffer){const h=new Float32Array(Z,A,D);x.set(h)}else{const h=Z.byteOffset+A;if(0!==(3&h))return v.b.Warn("Float array must be aligned to 4-bytes border"),void x.set(new Float32Array(Z.buffer.slice(h,h+D*Float32Array.BYTES_PER_ELEMENT)));const V=new Float32Array(Z.buffer,h,D);x.set(V)}else a(Z,A,H,h,V,D,d,((Z,V)=>{for(let v=0;v<h;v++)x[V+v]=Z[v]}))}function D(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(Z)){for(let A=0;A<h;A++)if(Z[V+A]-v>65535)return!0;return!1}return 4===Z.BYTES_PER_ELEMENT}},11813:(Z,h,V)=>{V.d(h,{d:()=>v});class v{get underlyingResource(){return null}constructor(){this.references=0,this.Th=0,this.is32Bits=!1,this.uniqueId=v._Counter++}}v._Counter=0},11860:(Z,h,V)=>{V.d(h,{e:()=>A});var v=V(11633);class A{static GetEffect(Z){return void 0===Z.getPipelineContext?Z.effect:Z}constructor(Z){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=Z.createDrawContext(),h&&(this.materialContext=Z.createMaterialContext())}setEffect(Z,h){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var v;(this.effect=Z,void 0!==h&&(this.defines=h),V)&&(null===(v=this.drawContext)||void 0===v||v.reset())}dispose(){var Z;let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const Z=this.effect;h?Z.dispose():v.e.SetImmediate((()=>{Z.getEngine().onEndFrameObservable.addOnce((()=>{Z.dispose()}))})),this.effect=null}null===(Z=this.drawContext)||void 0===Z||Z.dispose()}}},11945:(Z,h,V)=>{V.d(h,{c:()=>A});var v=V(11790);class A{static GetPlanes(Z){const h=[];for(let V=0;V<6;V++)h.push(new v.c(0,0,0,0));return A.GetPlanesToRef(Z,h),h}static GetNearPlaneToRef(Z,h){const V=Z.m;h.normal.x=V[3]+V[2],h.normal.y=V[7]+V[6],h.normal.z=V[11]+V[10],h.d=V[15]+V[14],h.normalize()}static GetFarPlaneToRef(Z,h){const V=Z.m;h.normal.x=V[3]-V[2],h.normal.y=V[7]-V[6],h.normal.z=V[11]-V[10],h.d=V[15]-V[14],h.normalize()}static GetLeftPlaneToRef(Z,h){const V=Z.m;h.normal.x=V[3]+V[0],h.normal.y=V[7]+V[4],h.normal.z=V[11]+V[8],h.d=V[15]+V[12],h.normalize()}static GetRightPlaneToRef(Z,h){const V=Z.m;h.normal.x=V[3]-V[0],h.normal.y=V[7]-V[4],h.normal.z=V[11]-V[8],h.d=V[15]-V[12],h.normalize()}static GetTopPlaneToRef(Z,h){const V=Z.m;h.normal.x=V[3]-V[1],h.normal.y=V[7]-V[5],h.normal.z=V[11]-V[9],h.d=V[15]-V[13],h.normalize()}static GetBottomPlaneToRef(Z,h){const V=Z.m;h.normal.x=V[3]+V[1],h.normal.y=V[7]+V[5],h.normal.z=V[11]+V[9],h.d=V[15]+V[13],h.normalize()}static GetPlanesToRef(Z,h){A.GetNearPlaneToRef(Z,h[0]),A.GetFarPlaneToRef(Z,h[1]),A.GetLeftPlaneToRef(Z,h[2]),A.GetRightPlaneToRef(Z,h[3]),A.GetTopPlaneToRef(Z,h[4]),A.GetBottomPlaneToRef(Z,h[5])}static IsPointInFrustum(Z,h){for(let V=0;V<6;V++)if(h[V].dotCoordinate(Z)<0)return!1;return!0}}},11962:(Z,h,V)=>{V.d(h,{d:()=>A});var v=V(11588);class A{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(Z,h){A.Enabled&&(this._current+=Z,h&&this._fetchResult())}beginMonitoring(){A.Enabled&&(this._startMonitoringTime=v.e.Now)}endMonitoring(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!A.Enabled)return;Z&&this.fetchNewFrame();const h=v.e.Now;this._current=h-this._startMonitoringTime,Z&&this._fetchResult()}Xh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const Z=v.e.Now;Z-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=Z,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}A.Enabled=!0},11833:(Z,h,V)=>{V.d(h,{d:()=>A,h:()=>v});class v{constructor(Z){this.length=0,this.data=new Array(Z),this._id=v._GlobalId++}push(Z){this.data[this.length++]=Z,this.length>this.data.length&&(this.data.length*=2)}forEach(Z){for(let h=0;h<this.length;h++)Z(this.data[h])}sort(Z){this.data.sort(Z)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(let h=0;h<Z.length;h++)this.data[this.length++]=(Z.data||Z)[h]}}indexOf(Z){const h=this.data.indexOf(Z);return h>=this.length?-1:h}contains(Z){return-1!==this.indexOf(Z)}}v._GlobalId=0;class A extends v{constructor(){super(...arguments),this._duplicateId=0}push(Z){super.push(Z),Z.__smartArrayFlags||(Z.__smartArrayFlags={}),Z.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(Z){return(!Z.__smartArrayFlags||Z.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(Z),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(Z){if(0!==Z.length){this.length+Z.length>this.data.length&&(this.data.length=2*(this.length+Z.length));for(let h=0;h<Z.length;h++){const V=(Z.data||Z)[h];this.pushNoDuplicate(V)}}}}},11803:(Z,h,V)=>{V.d(h,{c:()=>H});var v=V(11805),A=V(11566);class H{constructor(Z){this._vertexBuffers={},this.onBeforeRenderObservable=new A.b,this._scene=Z}_prepareBuffers(){if(this._vertexBuffers[v.f.PositionKind])return;const Z=[];Z.push(1,1),Z.push(-1,1),Z.push(-1,-1),Z.push(1,-1),this._vertexBuffers[v.f.PositionKind]=new v.f(this._scene.getEngine(),Z,v.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const Z=[];Z.push(0),Z.push(1),Z.push(2),Z.push(0),Z.push(2),Z.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(Z)}_rebuild(){const Z=this._vertexBuffers[v.f.PositionKind];Z&&(Z._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let Z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const V=this._scene.activeCamera;return!!V&&(h=h||V._postProcesses.filter((Z=>null!=Z)),!(!h||0===h.length||!this._scene.postProcessesEnabled)&&(h[0].activate(V,Z,null!==h&&void 0!==h),!0))}directRender(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,H=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Z.length;const d=this._scene.getEngine();for(let n=0;n<K;n++){var a;if(n<Z.length-1)Z[n+1].activate(this._scene.activeCamera||this._scene,null===h||void 0===h?void 0:h.texture);else h?d.bindFramebuffer(h,v,void 0,void 0,V,A):H||d.restoreDefaultFramebuffer(),null===(a=d._debugInsertMarker)||void 0===a||a.call(d,`post process ${Z[n].name} output`);const K=Z[n],x=K.apply();x&&(K.onBeforeRenderObservable.notifyObservers(x),this._prepareBuffers(),d.bindBuffers(this._vertexBuffers,this._indexBuffer,x),d.drawElementsType(0,0,6),K.onAfterRenderObservable.notifyObservers(x))}d.setDepthBuffer(!0),d.setDepthWrite(!0)}_finalizeFrame(Z,h,V,v){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const H=this._scene.activeCamera;if(!H)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(v=v||H._postProcesses.filter((Z=>null!=Z))).length||!this._scene.postProcessesEnabled)return;const K=this._scene.getEngine();for(let a=0,n=v.length;a<n;a++){const x=v[a];var d;if(a<n-1)x._outputTexture=v[a+1].activate(H,null===h||void 0===h?void 0:h.texture);else h?(K.bindFramebuffer(h,V,void 0,void 0,A),x._outputTexture=h):(K.restoreDefaultFramebuffer(),x._outputTexture=null),null===(d=K._debugInsertMarker)||void 0===d||d.call(K,`post process ${v[a].name} output`);if(Z)break;const N=x.apply();N&&(x.onBeforeRenderObservable.notifyObservers(N),this._prepareBuffers(),K.bindBuffers(this._vertexBuffers,this._indexBuffer,N),K.drawElementsType(0,0,6),x.onAfterRenderObservable.notifyObservers(N))}K.setDepthBuffer(!0),K.setDepthWrite(!0),K.setAlphaMode(0)}dispose(){const Z=this._vertexBuffers[v.f.PositionKind];Z&&(Z.dispose(),this._vertexBuffers[v.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11825:(Z,h,V)=>{V.d(h,{c:()=>d});var v=V(11833),A=V(11729);class H{set opaqueSortCompareFn(Z){this._opaqueSortCompareFn=Z||H.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(Z){this._alphaTestSortCompareFn=Z||H.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(Z){this._transparentSortCompareFn=Z||H.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(Z,h){let V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,H=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=Z,this._opaqueSubMeshes=new v.h(256),this._transparentSubMeshes=new v.h(256),this._alphaTestSubMeshes=new v.h(256),this._depthOnlySubMeshes=new v.h(256),this._particleSystems=new v.h(256),this._spriteManagers=new v.h(256),this._empty=!0,this._edgesRenderers=new v.d(16),this._scene=h,this.opaqueSortCompareFn=V,this.alphaTestSortCompareFn=A,this.transparentSortCompareFn=H}render(Z,h,V,v){if(Z)return void Z(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const A=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(A.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),A.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const H=A.getStencilBuffer();if(A.setStencilBuffer(!1),h&&this._renderSprites(),V&&this._renderParticles(v),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(A.setStencilBuffer(H),this._scene.useOrderIndependentTransparency){const Z=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);Z.length&&this._renderTransparent(Z)}else this._renderTransparent(this._transparentSubMeshes);A.setAlphaMode(0)}if(A.setStencilBuffer(!1),this._edgesRenderers.length){for(let Z=0;Z<this._edgesRenderers.length;Z++)this._edgesRenderers.data[Z].render();A.setAlphaMode(0)}A.setStencilBuffer(H)}_renderOpaqueSorted(Z){H._RenderSorted(Z,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(Z){H._RenderSorted(Z,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(Z){H._RenderSorted(Z,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(Z,h,V,v){let K,d=0;const a=V?V.globalPosition:H._ZeroVector;if(v)for(;d<Z.length;d++)K=Z.data[d],K._alphaIndex=K.getMesh().alphaIndex,K._distanceToCamera=A.Ch.Distance(K.getBoundingInfo().boundingSphere.centerWorld,a);const n=Z.length===Z.data.length?Z.data:Z.data.slice(0,Z.length);h&&n.sort(h);const x=n[0].getMesh().CZ();for(d=0;d<n.length;d++)if(K=n[d],!x._activeMeshesFrozenButKeepClipping||K.isInFrustum(x._frustumPlanes)){if(v){const Z=K.eZ();if(Z&&Z.needDepthPrePass){const h=Z.CZ().getEngine();h.setColorWrite(!1),h.setAlphaMode(0),K.render(!1),h.setColorWrite(!0)}}K.render(v)}}static defaultTransparentSortCompare(Z,h){return Z._alphaIndex>h._alphaIndex?1:Z._alphaIndex<h._alphaIndex?-1:H.backToFrontSortCompare(Z,h)}static backToFrontSortCompare(Z,h){return Z._distanceToCamera<h._distanceToCamera?1:Z._distanceToCamera>h._distanceToCamera?-1:0}static frontToBackSortCompare(Z,h){return Z._distanceToCamera<h._distanceToCamera?-1:Z._distanceToCamera>h._distanceToCamera?1:0}static PainterSortCompare(Z,h){const V=Z.getMesh(),v=h.getMesh();return V.material&&v.material?V.material.uniqueId-v.material.uniqueId:V.uniqueId-v.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(Z,h,V){void 0===h&&(h=Z.getMesh()),void 0===V&&(V=Z.eZ()),null!==V&&void 0!==V&&(V.needAlphaBlendingForMesh(h)?this._transparentSubMeshes.push(Z):V.needAlphaTestingForMesh(h)?(V.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._alphaTestSubMeshes.push(Z)):(V.needDepthPrePass&&this._depthOnlySubMeshes.push(Z),this._opaqueSubMeshes.push(Z)),h._renderingGroup=this,h._edgesRenderer&&h.isEnabled()&&h.isVisible&&h._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(h._edgesRenderer),this._empty=!1)}dispatchSprites(Z){this._spriteManagers.push(Z),this._empty=!1}dispatchParticles(Z){this._particleSystems.push(Z),this._empty=!1}_renderParticles(Z){if(0===this._particleSystems.length)return;const h=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let V=0;V<this._particleSystems.length;V++){const v=this._particleSystems.data[V];if(0===(h&&h.layerMask&v.layerMask))continue;const A=v.Ah;A.position&&Z&&-1===Z.indexOf(A)||this._scene._activeParticles.addCount(v.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const Z=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let h=0;h<this._spriteManagers.length;h++){const V=this._spriteManagers.data[h];0!==(Z&&Z.layerMask&V.layerMask)&&V.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}H._ZeroVector=A.Ch.Zero();class K{}class d{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(Z){Z!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=Z,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const Z of this._scene.meshes)if(Z.zh)for(const h of Z.zh)h._wasDispatched=!1;if(this._scene.spriteManagers)for(const Z of this._scene.spriteManagers)Z._wasDispatched=!1;for(const Z of this._scene.bD)Z._wasDispatched=!1}constructor(Z){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new K,this._maintainStateBetweenFrames=!1,this._scene=Z;for(let h=d.MIN_RENDERINGGROUPS;h<d.MAX_RENDERINGGROUPS;h++)this._autoClearDepthStencil[h]={yh:!0,depth:!0,stencil:!0}}getRenderingGroup(Z){const h=Z||0;return this._prepareRenderingGroup(h),this._renderingGroups[h]}_clearDepthStencilBuffer(){let Z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,Z,h),this._depthStencilBufferAlreadyCleaned=!0)}render(Z,h,V,v){const A=this._renderingGroupInfo;if(A.Wh=this._scene,A.camera=this._scene.activeCamera,A.renderingManager=this,this._scene.spriteManagers&&v)for(let H=0;H<this._scene.spriteManagers.length;H++){const Z=this._scene.spriteManagers[H];this.dispatchSprites(Z)}for(let H=d.MIN_RENDERINGGROUPS;H<d.MAX_RENDERINGGROUPS;H++){this._depthStencilBufferAlreadyCleaned=H===d.MIN_RENDERINGGROUPS;const K=this._renderingGroups[H];if(!K||K._empty)continue;const a=1<<H;if(A.renderingGroupId=H,this._scene.onBeforeRenderingGroupObservable.notifyObservers(A,a),d.AUTOCLEAR){const Z=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(H):this._autoClearDepthStencil[H];Z&&Z.yh&&this._clearDepthStencilBuffer(Z.depth,Z.stencil)}for(const Z of this._scene._beforeRenderingGroupDrawStage)Z.action(H);K.render(Z,v,V,h);for(const Z of this._scene._afterRenderingGroupDrawStage)Z.action(H);this._scene.onAfterRenderingGroupObservable.notifyObservers(A,a)}}reset(){if(!this.maintainStateBetweenFrames)for(let Z=d.MIN_RENDERINGGROUPS;Z<d.MAX_RENDERINGGROUPS;Z++){const h=this._renderingGroups[Z];h&&h.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let Z=d.MIN_RENDERINGGROUPS;Z<d.MAX_RENDERINGGROUPS;Z++){const h=this._renderingGroups[Z];h&&h.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let Z=d.MIN_RENDERINGGROUPS;Z<d.MAX_RENDERINGGROUPS;Z++){const h=this._renderingGroups[Z];h&&h.dispose()}}_prepareRenderingGroup(Z){void 0===this._renderingGroups[Z]&&(this._renderingGroups[Z]=new H(Z,this._scene,this._customOpaqueSortCompareFn[Z],this._customAlphaTestSortCompareFn[Z],this._customTransparentSortCompareFn[Z]))}dispatchSprites(Z){this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatchSprites(Z))}dispatchParticles(Z){this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(Z.renderingGroupId).dispatchParticles(Z))}dispatch(Z,h,V){void 0===h&&(h=Z.getMesh()),this.maintainStateBetweenFrames&&Z._wasDispatched||(Z._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatch(Z,h,V))}setRenderingOrder(Z){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,V=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[Z]=h,this._customAlphaTestSortCompareFn[Z]=V,this._customTransparentSortCompareFn[Z]=v,this._renderingGroups[Z]){const h=this._renderingGroups[Z];h.opaqueSortCompareFn=this._customOpaqueSortCompareFn[Z],h.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[Z],h.transparentSortCompareFn=this._customTransparentSortCompareFn[Z]}}setRenderingAutoClearDepthStencil(Z,h){let V=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],v=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[Z]={yh:h,depth:V,stencil:v}}getAutoClearDepthStencilSetup(Z){return this._autoClearDepthStencil[Z]}}d.MAX_RENDERINGGROUPS=4,d.MIN_RENDERINGGROUPS=0,d.AUTOCLEAR=!0}}]);