"use strict";(self.agop5zpabxv=self.agop5zpabxv||[]).push([[19],{12410:(H,u,J)=>{J.d(u,{b:()=>w,d:()=>g});var O=J(12419),U=J(12185),h=J(12425);class w{get B(){return this._isDisposed}constructor(H,u,J){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,h=arguments.length>4&&void 0!==arguments[4]&&arguments[4],w=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7?arguments[7]:void 0,b=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,H&&H.ZH?this._engine=H.ZH().getEngine():this._engine=H,this._updatable=J,this._instanced=w,this._divisor=B||1,this._label=b,u instanceof O.e?(this._data=null,this._buffer=u):(this._data=u,this._buffer=null),this.byteStride=g?U:U*Float32Array.BYTES_PER_ELEMENT,h||this.create()}createVertexBuffer(H,u,J,O,U){let h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6?arguments[6]:void 0;const B=h?u:u*Float32Array.BYTES_PER_ELEMENT,b=O?h?O:O*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new g(this._engine,this,H,this._updatable,!0,b,void 0===U?this._instanced:U,B,J,void 0,void 0,!0,this._divisor||w)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!H&&this._buffer||(H=H||this._data,H&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,H),this._data=H):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(H,this._label),this._data=H):this._buffer=this._engine.createVertexBuffer(H,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.bJ>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.bJ,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.bJ,void 0,this._label));U.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(H){this.create(H)}updateDirectly(H,u,J){let O=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,H,O?u:u*Float32Array.BYTES_PER_ELEMENT,J?J*this.byteStride:void 0),this._data=0===u&&void 0===J?H:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class g{get B(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(H){const u=0!=H;this._instanceDivisor=H,u!==this._instanced&&(this._instanced=u,this._computeHashCode())}get _maxVerticesCount(){const H=this.getData();return H?Array.isArray(H)?H.length/(this.byteStride/4)-this.byteOffset/4:(H.byteLength-this.byteOffset)/this.byteStride:0}constructor(H,u,J,O,U,B,b,d,G,P){let mH=arguments.length>10&&void 0!==arguments[10]&&arguments[10],l=arguments.length>11&&void 0!==arguments[11]&&arguments[11],r=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,p=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let a=!1;if(this.mJ=H,"object"===typeof O&&null!==O?(a=O.updatable??!1,U=O.postponeInternalCreation,B=O.stride,b=O.instanced,d=O.offset,G=O.size,P=O.type,mH=O.normalized??!1,l=O.useBytes??!1,r=O.divisor??1,p=O.takeBufferOwnership??!1,this._label=O.label):a=!!O,u instanceof w?(this._buffer=u,this._ownsBuffer=p):(this._buffer=new w(H,u,a,B,U,b,l,r,this._label),this._ownsBuffer=!0),this.uniqueId=g._Counter++,this._kind=J,void 0===P){const H=this.getData();this.type=H?g.GetDataType(H):g.FLOAT}else this.type=P;const k=(0,h.n)(this.type);l?(this._size=G||(B?B/k:g.DeduceStride(J)),this.byteStride=B||this._buffer.byteStride||this._size*k,this.byteOffset=d||0):(this._size=G||B||g.DeduceStride(J),this.byteStride=B?B*k:this._buffer.byteStride||this._size*k,this.byteOffset=(d||0)*k),this.normalized=mH,this._instanced=void 0!==b&&b,this._instanceDivisor=b?r:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var H;null===(H=this._buffer)||void 0===H||H._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(H,u){const J=this.getData();return J?(0,h.m)(J,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,H,u):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,h.n)(this.type)}getOffset(){return this.byteOffset/(0,h.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,h.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(H){this._buffer.create(H),this._alignBuffer()}update(H){this._buffer.update(H),this._alignBuffer()}updateDirectly(H,u){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(H,u,void 0,J),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(H,u){(0,h.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,H,this.normalized,((H,J)=>{for(let O=0;O<this._size;O++)u(H[O],J+O)}))}_alignBuffer(){}static DeduceStride(H){switch(H){case g.UVKind:case g.UV2Kind:case g.UV3Kind:case g.UV4Kind:case g.UV5Kind:case g.UV6Kind:return 2;case g.NormalKind:case g.PositionKind:return 3;case g.ColorKind:case g.ColorInstanceKind:case g.MatricesIndicesKind:case g.MatricesIndicesExtraKind:case g.MatricesWeightsKind:case g.MatricesWeightsExtraKind:case g.TangentKind:return 4;default:throw new Error("Invalid kind '"+H+"'")}}static GetDataType(H){return H instanceof Int8Array?g.BYTE:H instanceof Uint8Array?g.UNSIGNED_BYTE:H instanceof Int16Array?g.SHORT:H instanceof Uint16Array?g.UNSIGNED_SHORT:H instanceof Int32Array?g.INT:H instanceof Uint32Array?g.UNSIGNED_INT:g.FLOAT}static GetTypeByteLength(H){return(0,h.n)(H)}static ForEach(H,u,J,O,U,w,g,B){(0,h.i)(H,u,J,O,U,w,g,((H,u)=>{for(let J=0;J<O;J++)B(H[J],u+J)}))}static GetFloatData(H,u,J,O,U,w,g,B){return(0,h.m)(H,u,J,O,U,w,g,B)}}g._Counter=0,g.BYTE=5120,g.UNSIGNED_BYTE=5121,g.SHORT=5122,g.UNSIGNED_SHORT=5123,g.INT=5124,g.UNSIGNED_INT=5125,g.FLOAT=5126,g.PositionKind="position",g.NormalKind="normal",g.TangentKind="tangent",g.UVKind="uv",g.UV2Kind="uv2",g.UV3Kind="uv3",g.UV4Kind="uv4",g.UV5Kind="uv5",g.UV6Kind="uv6",g.ColorKind="color",g.ColorInstanceKind="instanceColor",g.MatricesIndicesKind="matricesIndices",g.MatricesWeightsKind="matricesWeights",g.MatricesIndicesExtraKind="matricesIndicesExtra",g.MatricesWeightsExtraKind="matricesWeightsExtra"},12425:(H,u,J)=>{J.d(u,{d:()=>P,g:()=>G,i:()=>B,m:()=>b,n:()=>w,r:()=>g,s:()=>d});var O=J(12185);function U(H,u,J,O){switch(u){case 5120:{let u=H.getInt8(J);return O&&(u=Math.max(u/127,-1)),u}case 5121:{let u=H.getUint8(J);return O&&(u/=255),u}case 5122:{let u=H.getInt16(J,!0);return O&&(u=Math.max(u/32767,-1)),u}case 5123:{let u=H.getUint16(J,!0);return O&&(u/=65535),u}case 5124:return H.getInt32(J,!0);case 5125:return H.getUint32(J,!0);case 5126:return H.getFloat32(J,!0);default:throw new Error(`Invalid component type ${u}`)}}function h(H,u,J,O,U){switch(u){case 5120:O&&(U=Math.round(127*U)),H.setInt8(J,U);break;case 5121:O&&(U=Math.round(255*U)),H.setUint8(J,U);break;case 5122:O&&(U=Math.round(32767*U)),H.setInt16(J,U,!0);break;case 5123:O&&(U=Math.round(65535*U)),H.setUint16(J,U,!0);break;case 5124:H.setInt32(J,U,!0);break;case 5125:H.setUint32(J,U,!0);break;case 5126:H.setFloat32(J,U,!0);break;default:throw new Error(`Invalid component type ${u}`)}}function w(H){switch(H){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${H}'`)}}function g(H){switch(H){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${H}'`)}}function B(H,u,J,O,g,B,b,d){const G=new Array(O),P=new Array(O);if(H instanceof Array){let U=u/4;const h=J/4;for(let u=0;u<B;u+=O){for(let u=0;u<O;u++)G[u]=P[u]=H[U+u];d(P,u);for(let u=0;u<O;u++)G[u]!==P[u]&&(H[U+u]=P[u]);U+=h}}else{const mH=ArrayBuffer.isView(H)?new DataView(H.buffer,H.byteOffset,H.byteLength):new DataView(H),l=w(g);for(let H=0;H<B;H+=O){for(let H=0,J=u;H<O;H++,J+=l)G[H]=P[H]=U(mH,g,J,b);d(P,H);for(let H=0,J=u;H<O;H++,J+=l)G[H]!==P[H]&&h(mH,g,J,b,P[H]);u+=J}}}function b(H,u,J,U,h,g,b,d){const G=u*w(J),P=b*u;if(5126!==J||h!==G){const O=new Float32Array(P);return B(H,U,h,u,J,P,g,((H,J)=>{for(let U=0;U<u;U++)O[J+U]=H[U]})),O}if(!(H instanceof Array||H instanceof Float32Array)||0!==U||H.length!==P){if(H instanceof Array){const u=U/4;return H.slice(u,u+P)}if(H instanceof ArrayBuffer)return new Float32Array(H,U,P);{const u=H.byteOffset+U;return 0!==(3&u)&&(O.b.Warn("Float array must be aligned to 4-bytes border"),d=!0),d?new Float32Array(H.buffer.slice(u,u+P*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(H.buffer,u,P)}}return d?H.slice():H}function d(H,u,J,U,h,b,d,G){const P=w(J),mH=g(J),l=d*u;if(Array.isArray(H)){if(0!==(3&U)||0!==(3&h))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const O=U/4,w=h/4;if(O+(d-1)*w+u>H.length)throw new Error("Last accessed index is out of bounds.");if(w<u)throw new Error("Data stride cannot be smaller than the component size.");if(w!==u){const O=new mH(l);return B(H,U,h,u,J,l,b,((H,J)=>{for(let U=0;U<u;U++)O[J+U]=H[U]})),O}return new mH(H.slice(O,O+l))}let r,p=U;H instanceof ArrayBuffer?r=H:(r=H.buffer,p+=H.byteOffset);if(p+(d-1)*h+u*P>r.byteLength)throw new Error("Last accessed byte is out of bounds.");const a=u*P;if(h<a)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(h!==a){const H=new mH(l);return B(r,p,h,u,J,l,b,((J,O)=>{for(let U=0;U<u;U++)H[O+U]=J[U]})),H}return 1!==P&&0!==(p&P-1)&&(O.b.Warn("Array must be aligned to border of element size. Data will be copied."),G=!0),G?new mH(r.slice(p,p+l*P)):new mH(r,p,l)}function G(H,u,J,U,h,g,b,d){const G=u*w(J),P=b*u;if(d.length!==P)throw new Error("Output length is not valid");if(5126===J&&h===G)if(H instanceof Array){const u=U/4;d.set(H,u)}else if(H instanceof ArrayBuffer){const u=new Float32Array(H,U,P);d.set(u)}else{const u=H.byteOffset+U;if(0!==(3&u))return O.b.Warn("Float array must be aligned to 4-bytes border"),void d.set(new Float32Array(H.buffer.slice(u,u+P*Float32Array.BYTES_PER_ELEMENT)));const J=new Float32Array(H.buffer,u,P);d.set(J)}else B(H,U,h,u,J,P,g,((H,J)=>{for(let O=0;O<u;O++)d[J+O]=H[O]}))}function P(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(H)){for(let U=0;U<u;U++)if(H[J+U]-O>65535)return!0;return!1}return 4===H.BYTES_PER_ELEMENT}},12419:(H,u,J)=>{J.d(u,{e:()=>O});class O{get underlyingResource(){return null}constructor(){this.references=0,this.bJ=0,this.is32Bits=!1,this.uniqueId=O._Counter++}}O._Counter=0},12445:(H,u,J)=>{J.d(u,{c:()=>U});var O=J(12240);class U{static GetEffect(H){return void 0===H.getPipelineContext?H.effect:H}constructor(H){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=H.createDrawContext(),u&&(this.materialContext=H.createMaterialContext())}setEffect(H,u){let J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var O;(this.effect=H,void 0!==u&&(this.defines=u),J)&&(null===(O=this.drawContext)||void 0===O||O.reset())}dispose(){var H;let u=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const H=this.effect;u?H.dispose():O.b.SetImmediate((()=>{H.getEngine().onEndFrameObservable.addOnce((()=>{H.dispose()}))})),this.effect=null}null===(H=this.drawContext)||void 0===H||H.dispose()}}},12526:(H,u,J)=>{J.d(u,{b:()=>U});var O=J(12388);class U{static GetPlanes(H){const u=[];for(let J=0;J<6;J++)u.push(new O.d(0,0,0,0));return U.GetPlanesToRef(H,u),u}static GetNearPlaneToRef(H,u){const J=H.m;u.normal.x=J[3]+J[2],u.normal.y=J[7]+J[6],u.normal.z=J[11]+J[10],u.d=J[15]+J[14],u.normalize()}static GetFarPlaneToRef(H,u){const J=H.m;u.normal.x=J[3]-J[2],u.normal.y=J[7]-J[6],u.normal.z=J[11]-J[10],u.d=J[15]-J[14],u.normalize()}static GetLeftPlaneToRef(H,u){const J=H.m;u.normal.x=J[3]+J[0],u.normal.y=J[7]+J[4],u.normal.z=J[11]+J[8],u.d=J[15]+J[12],u.normalize()}static GetRightPlaneToRef(H,u){const J=H.m;u.normal.x=J[3]-J[0],u.normal.y=J[7]-J[4],u.normal.z=J[11]-J[8],u.d=J[15]-J[12],u.normalize()}static GetTopPlaneToRef(H,u){const J=H.m;u.normal.x=J[3]-J[1],u.normal.y=J[7]-J[5],u.normal.z=J[11]-J[9],u.d=J[15]-J[13],u.normalize()}static GetBottomPlaneToRef(H,u){const J=H.m;u.normal.x=J[3]+J[1],u.normal.y=J[7]+J[5],u.normal.z=J[11]+J[9],u.d=J[15]+J[13],u.normalize()}static GetPlanesToRef(H,u){U.GetNearPlaneToRef(H,u[0]),U.GetFarPlaneToRef(H,u[1]),U.GetLeftPlaneToRef(H,u[2]),U.GetRightPlaneToRef(H,u[3]),U.GetTopPlaneToRef(H,u[4]),U.GetBottomPlaneToRef(H,u[5])}static IsPointInFrustum(H,u){for(let J=0;J<6;J++)if(u[J].dotCoordinate(H)<0)return!1;return!0}}},12539:(H,u,J)=>{J.d(u,{e:()=>U});var O=J(12197);class U{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(H,u){U.Enabled&&(this._current+=H,u&&this._fetchResult())}beginMonitoring(){U.Enabled&&(this._startMonitoringTime=O.e.Now)}endMonitoring(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!U.Enabled)return;H&&this.fetchNewFrame();const u=O.e.Now;this._current=u-this._startMonitoringTime,H&&this._fetchResult()}Ah(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const H=O.e.Now;H-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=H,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}U.Enabled=!0},12432:(H,u,J)=>{J.d(u,{e:()=>U,h:()=>O});class O{constructor(H){this.length=0,this.data=new Array(H),this._id=O._GlobalId++}push(H){this.data[this.length++]=H,this.length>this.data.length&&(this.data.length*=2)}forEach(H){for(let u=0;u<this.length;u++)H(this.data[u])}sort(H){this.data.sort(H)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(H){if(0!==H.length){this.length+H.length>this.data.length&&(this.data.length=2*(this.length+H.length));for(let u=0;u<H.length;u++)this.data[this.length++]=(H.data||H)[u]}}indexOf(H){const u=this.data.indexOf(H);return u>=this.length?-1:u}contains(H){return-1!==this.indexOf(H)}}O._GlobalId=0;class U extends O{constructor(){super(...arguments),this._duplicateId=0}push(H){super.push(H),H.__smartArrayFlags||(H.__smartArrayFlags={}),H.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(H){return(!H.__smartArrayFlags||H.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(H),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(H){if(0!==H.length){this.length+H.length>this.data.length&&(this.data.length=2*(this.length+H.length));for(let u=0;u<H.length;u++){const J=(H.data||H)[u];this.pushNoDuplicate(J)}}}}},12408:(H,u,J)=>{J.d(u,{e:()=>h});var O=J(12410),U=J(12175);class h{constructor(H){this._vertexBuffers={},this.onBeforeRenderObservable=new U.b,this._scene=H}_prepareBuffers(){if(this._vertexBuffers[O.d.PositionKind])return;const H=[];H.push(1,1),H.push(-1,1),H.push(-1,-1),H.push(1,-1),this._vertexBuffers[O.d.PositionKind]=new O.d(this._scene.getEngine(),H,O.d.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const H=[];H.push(0),H.push(1),H.push(2),H.push(0),H.push(2),H.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(H)}_rebuild(){const H=this._vertexBuffers[O.d.PositionKind];H&&(H._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const J=this._scene.activeCamera;return!!J&&(u=u||J._postProcesses.filter((H=>null!=H)),!(!u||0===u.length||!this._scene.postProcessesEnabled)&&(u[0].activate(J,H,null!==u&&void 0!==u),!0))}directRender(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,h=arguments.length>5&&void 0!==arguments[5]&&arguments[5],w=arguments.length>6&&void 0!==arguments[6]?arguments[6]:H.length;const g=this._scene.getEngine();for(let b=0;b<w;b++){var B;if(b<H.length-1)H[b+1].activate(this._scene.activeCamera||this._scene,null===u||void 0===u?void 0:u.texture);else u?g.bindFramebuffer(u,O,void 0,void 0,J,U):h||g.restoreDefaultFramebuffer(),null===(B=g._debugInsertMarker)||void 0===B||B.call(g,`post process ${H[b].name} output`);const w=H[b],d=w.apply();d&&(w.onBeforeRenderObservable.notifyObservers(d),this._prepareBuffers(),g.bindBuffers(this._vertexBuffers,this._indexBuffer,d),g.drawElementsType(0,0,6),w.onAfterRenderObservable.notifyObservers(d))}g.setDepthBuffer(!0),g.setDepthWrite(!0)}_finalizeFrame(H,u,J,O){let U=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const h=this._scene.activeCamera;if(!h)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(O=O||h._postProcesses.filter((H=>null!=H))).length||!this._scene.postProcessesEnabled)return;const w=this._scene.getEngine();for(let B=0,b=O.length;B<b;B++){const d=O[B];var g;if(B<b-1)d._outputTexture=O[B+1].activate(h,null===u||void 0===u?void 0:u.texture);else u?(w.bindFramebuffer(u,J,void 0,void 0,U),d._outputTexture=u):(w.restoreDefaultFramebuffer(),d._outputTexture=null),null===(g=w._debugInsertMarker)||void 0===g||g.call(w,`post process ${O[B].name} output`);if(H)break;const G=d.apply();G&&(d.onBeforeRenderObservable.notifyObservers(G),this._prepareBuffers(),w.bindBuffers(this._vertexBuffers,this._indexBuffer,G),w.drawElementsType(0,0,6),d.onAfterRenderObservable.notifyObservers(G))}w.setDepthBuffer(!0),w.setDepthWrite(!0),w.setAlphaMode(0)}dispose(){const H=this._vertexBuffers[O.d.PositionKind];H&&(H.dispose(),this._vertexBuffers[O.d.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12430:(H,u,J)=>{J.d(u,{b:()=>g});var O=J(12432),U=J(12338);class h{set opaqueSortCompareFn(H){this._opaqueSortCompareFn=H||h.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(H){this._alphaTestSortCompareFn=H||h.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(H){this._transparentSortCompareFn=H||h.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(H,u){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=H,this._opaqueSubMeshes=new O.h(256),this._transparentSubMeshes=new O.h(256),this._alphaTestSubMeshes=new O.h(256),this._depthOnlySubMeshes=new O.h(256),this._particleSystems=new O.h(256),this._spriteManagers=new O.h(256),this._empty=!0,this._edgesRenderers=new O.e(16),this._scene=u,this.opaqueSortCompareFn=J,this.alphaTestSortCompareFn=U,this.transparentSortCompareFn=h}render(H,u,J,O){if(H)return void H(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const U=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(U.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),U.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const h=U.getStencilBuffer();if(U.setStencilBuffer(!1),u&&this._renderSprites(),J&&this._renderParticles(O),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(U.setStencilBuffer(h),this._scene.useOrderIndependentTransparency){const H=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);H.length&&this._renderTransparent(H)}else this._renderTransparent(this._transparentSubMeshes);U.setAlphaMode(0)}if(U.setStencilBuffer(!1),this._edgesRenderers.length){for(let H=0;H<this._edgesRenderers.length;H++)this._edgesRenderers.data[H].render();U.setAlphaMode(0)}U.setStencilBuffer(h)}_renderOpaqueSorted(H){h._RenderSorted(H,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(H){h._RenderSorted(H,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(H){h._RenderSorted(H,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(H,u,J,O){let w,g=0;const B=J?J.globalPosition:h._ZeroVector;if(O)for(;g<H.length;g++)w=H.data[g],w._alphaIndex=w.getMesh().alphaIndex,w._distanceToCamera=U.lu.Distance(w.getBoundingInfo().boundingSphere.centerWorld,B);const b=H.length===H.data.length?H.data:H.data.slice(0,H.length);u&&b.sort(u);const d=b[0].getMesh().ZH();for(g=0;g<b.length;g++)if(w=b[g],!d._activeMeshesFrozenButKeepClipping||w.isInFrustum(d._frustumPlanes)){if(O){const H=w.XH();if(H&&H.needDepthPrePass){const u=H.ZH().getEngine();u.setColorWrite(!1),u.setAlphaMode(0),w.render(!1),u.setColorWrite(!0)}}w.render(O)}}static defaultTransparentSortCompare(H,u){return H._alphaIndex>u._alphaIndex?1:H._alphaIndex<u._alphaIndex?-1:h.backToFrontSortCompare(H,u)}static backToFrontSortCompare(H,u){return H._distanceToCamera<u._distanceToCamera?1:H._distanceToCamera>u._distanceToCamera?-1:0}static frontToBackSortCompare(H,u){return H._distanceToCamera<u._distanceToCamera?-1:H._distanceToCamera>u._distanceToCamera?1:0}static PainterSortCompare(H,u){const J=H.getMesh(),O=u.getMesh();return J.material&&O.material?J.material.uniqueId-O.material.uniqueId:J.uniqueId-O.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(H,u,J){void 0===u&&(u=H.getMesh()),void 0===J&&(J=H.XH()),null!==J&&void 0!==J&&(J.needAlphaBlendingForMesh(u)?this._transparentSubMeshes.push(H):J.needAlphaTestingForMesh(u)?(J.needDepthPrePass&&this._depthOnlySubMeshes.push(H),this._alphaTestSubMeshes.push(H)):(J.needDepthPrePass&&this._depthOnlySubMeshes.push(H),this._opaqueSubMeshes.push(H)),u._renderingGroup=this,u._edgesRenderer&&u.isEnabled()&&u.isVisible&&u._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(u._edgesRenderer),this._empty=!1)}dispatchSprites(H){this._spriteManagers.push(H),this._empty=!1}dispatchParticles(H){this._particleSystems.push(H),this._empty=!1}_renderParticles(H){if(0===this._particleSystems.length)return;const u=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let J=0;J<this._particleSystems.length;J++){const O=this._particleSystems.data[J];if(0===(u&&u.layerMask&O.layerMask))continue;const U=O.Ou;U.position&&H&&-1===H.indexOf(U)||this._scene._activeParticles.addCount(O.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const H=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let u=0;u<this._spriteManagers.length;u++){const J=this._spriteManagers.data[u];0!==(H&&H.layerMask&J.layerMask)&&J.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}h._ZeroVector=U.lu.Zero();class w{}class g{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(H){H!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=H,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const H of this._scene.meshes)if(H.mg)for(const u of H.mg)u._wasDispatched=!1;if(this._scene.spriteManagers)for(const H of this._scene.spriteManagers)H._wasDispatched=!1;for(const H of this._scene.pm)H._wasDispatched=!1}constructor(H){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new w,this._maintainStateBetweenFrames=!1,this._scene=H;for(let u=g.MIN_RENDERINGGROUPS;u<g.MAX_RENDERINGGROUPS;u++)this._autoClearDepthStencil[u]={Eh:!0,depth:!0,Rh:!0}}getRenderingGroup(H){const u=H||0;return this._prepareRenderingGroup(u),this._renderingGroups[u]}_clearDepthStencilBuffer(){let H=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,H,u),this._depthStencilBufferAlreadyCleaned=!0)}render(H,u,J,O){const U=this._renderingGroupInfo;if(U.pu=this._scene,U.camera=this._scene.activeCamera,U.renderingManager=this,this._scene.spriteManagers&&O)for(let h=0;h<this._scene.spriteManagers.length;h++){const H=this._scene.spriteManagers[h];this.dispatchSprites(H)}for(let h=g.MIN_RENDERINGGROUPS;h<g.MAX_RENDERINGGROUPS;h++){this._depthStencilBufferAlreadyCleaned=h===g.MIN_RENDERINGGROUPS;const w=this._renderingGroups[h];if(!w||w._empty)continue;const B=1<<h;if(U.renderingGroupId=h,this._scene.onBeforeRenderingGroupObservable.notifyObservers(U,B),g.AUTOCLEAR){const H=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(h):this._autoClearDepthStencil[h];H&&H.Eh&&this._clearDepthStencilBuffer(H.depth,H.Rh)}for(const H of this._scene._beforeRenderingGroupDrawStage)H.action(h);w.render(H,O,J,u);for(const H of this._scene._afterRenderingGroupDrawStage)H.action(h);this._scene.onAfterRenderingGroupObservable.notifyObservers(U,B)}}reset(){if(!this.maintainStateBetweenFrames)for(let H=g.MIN_RENDERINGGROUPS;H<g.MAX_RENDERINGGROUPS;H++){const u=this._renderingGroups[H];u&&u.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let H=g.MIN_RENDERINGGROUPS;H<g.MAX_RENDERINGGROUPS;H++){const u=this._renderingGroups[H];u&&u.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let H=g.MIN_RENDERINGGROUPS;H<g.MAX_RENDERINGGROUPS;H++){const u=this._renderingGroups[H];u&&u.dispose()}}_prepareRenderingGroup(H){void 0===this._renderingGroups[H]&&(this._renderingGroups[H]=new h(H,this._scene,this._customOpaqueSortCompareFn[H],this._customAlphaTestSortCompareFn[H],this._customTransparentSortCompareFn[H]))}dispatchSprites(H){this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatchSprites(H))}dispatchParticles(H){this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatchParticles(H))}dispatch(H,u,J){void 0===u&&(u=H.getMesh()),this.maintainStateBetweenFrames&&H._wasDispatched||(H._wasDispatched=!0,this.getRenderingGroup(u.renderingGroupId).dispatch(H,u,J))}setRenderingOrder(H){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,O=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[H]=u,this._customAlphaTestSortCompareFn[H]=J,this._customTransparentSortCompareFn[H]=O,this._renderingGroups[H]){const u=this._renderingGroups[H];u.opaqueSortCompareFn=this._customOpaqueSortCompareFn[H],u.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[H],u.transparentSortCompareFn=this._customTransparentSortCompareFn[H]}}setRenderingAutoClearDepthStencil(H,u){let J=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],O=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[H]={Eh:u,depth:J,Rh:O}}getAutoClearDepthStencilSetup(H){return this._autoClearDepthStencil[H]}}g.MAX_RENDERINGGROUPS=4,g.MIN_RENDERINGGROUPS=0,g.AUTOCLEAR=!0}}]);