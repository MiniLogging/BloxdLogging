"use strict";(self["269hv5nclphh"]=self["269hv5nclphh"]||[]).push([[19],{12463:(E,H,d)=>{d.d(H,{e:()=>g,g:()=>l});var n=d(12471),Z=d(12237),I=d(12480);class g{get M(){return this._isDisposed}constructor(E,H,d){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],r=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,E&&E.fE?this._engine=E.fE().getEngine():this._engine=E,this._updatable=d,this._instanced=g,this._divisor=r||1,this._label=t,H instanceof n.d?(this._data=null,this._buffer=H):(this._data=H,this._buffer=null),this.byteStride=l?Z:Z*Float32Array.BYTES_PER_ELEMENT,I||this.create()}createVertexBuffer(E,H,d,n,Z){let I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6?arguments[6]:void 0;const r=I?H:H*Float32Array.BYTES_PER_ELEMENT,t=n?I?n:n*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new l(this._engine,this,E,this._updatable,!0,t,void 0===Z?this._instanced:Z,r,d,void 0,void 0,!0,this._divisor||g)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!E&&this._buffer||(E=E||this._data,E&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,E),this._data=E):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(E,this._label),this._data=E):this._buffer=this._engine.createVertexBuffer(E,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Ld>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Ld,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Ld,void 0,this._label));Z.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(E){this.create(E)}updateDirectly(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,E,n?H:H*Float32Array.BYTES_PER_ELEMENT,d?d*this.byteStride:void 0),this._data=0===H&&void 0===d?E:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class l{get M(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(E){const H=0!=E;this._instanceDivisor=E,H!==this._instanced&&(this._instanced=H,this._computeHashCode())}get _maxVerticesCount(){const E=this.getData();return E?Array.isArray(E)?E.length/(this.byteStride/4)-this.byteOffset/4:(E.byteLength-this.byteOffset)/this.byteStride:0}constructor(E,H,d,n,Z,r,t,S,M,V){let C=arguments.length>10&&void 0!==arguments[10]&&arguments[10],w=arguments.length>11&&void 0!==arguments[11]&&arguments[11],R=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,Q=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let L=!1;if(this.CH=E,"object"===typeof n&&null!==n?(L=n.updatable??!1,Z=n.postponeInternalCreation,r=n.stride,t=n.instanced,S=n.offset,M=n.size,V=n.type,C=n.normalized??!1,w=n.useBytes??!1,R=n.divisor??1,Q=n.takeBufferOwnership??!1,this._label=n.label):L=!!n,H instanceof g?(this._buffer=H,this._ownsBuffer=Q):(this._buffer=new g(E,H,L,r,Z,t,w,R,this._label),this._ownsBuffer=!0),this.uniqueId=l._Counter++,this._kind=d,void 0===V){const E=this.getData();this.type=E?l.GetDataType(E):l.FLOAT}else this.type=V;const D=(0,I.o)(this.type);w?(this._size=M||(r?r/D:l.DeduceStride(d)),this.byteStride=r||this._buffer.byteStride||this._size*D,this.byteOffset=S||0):(this._size=M||r||l.DeduceStride(d),this.byteStride=r?r*D:this._buffer.byteStride||this._size*D,this.byteOffset=(S||0)*D),this.normalized=C,this._instanced=void 0!==t&&t,this._instanceDivisor=t?R:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var E;null===(E=this._buffer)||void 0===E||E._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(E,H){const d=this.getData();return d?(0,I.m)(d,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,E,H):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,I.o)(this.type)}getOffset(){return this.byteOffset/(0,I.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,I.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(E){this._buffer.create(E),this._alignBuffer()}update(E){this._buffer.update(E),this._alignBuffer()}updateDirectly(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(E,H,void 0,d),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(E,H){(0,I.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,E,this.normalized,((E,d)=>{for(let n=0;n<this._size;n++)H(E[n],d+n)}))}_alignBuffer(){}static DeduceStride(E){switch(E){case l.UVKind:case l.UV2Kind:case l.UV3Kind:case l.UV4Kind:case l.UV5Kind:case l.UV6Kind:return 2;case l.NormalKind:case l.PositionKind:return 3;case l.ColorKind:case l.ColorInstanceKind:case l.MatricesIndicesKind:case l.MatricesIndicesExtraKind:case l.MatricesWeightsKind:case l.MatricesWeightsExtraKind:case l.TangentKind:return 4;default:throw new Error("Invalid kind '"+E+"'")}}static GetDataType(E){return E instanceof Int8Array?l.BYTE:E instanceof Uint8Array?l.UNSIGNED_BYTE:E instanceof Int16Array?l.SHORT:E instanceof Uint16Array?l.UNSIGNED_SHORT:E instanceof Int32Array?l.INT:E instanceof Uint32Array?l.UNSIGNED_INT:l.FLOAT}static GetTypeByteLength(E){return(0,I.o)(E)}static ForEach(E,H,d,n,Z,g,l,r){(0,I.j)(E,H,d,n,Z,g,l,((E,H)=>{for(let d=0;d<n;d++)r(E[d],H+d)}))}static GetFloatData(E,H,d,n,Z,g,l,r){return(0,I.m)(E,H,d,n,Z,g,l,r)}}l._Counter=0,l.BYTE=5120,l.UNSIGNED_BYTE=5121,l.SHORT=5122,l.UNSIGNED_SHORT=5123,l.INT=5124,l.UNSIGNED_INT=5125,l.FLOAT=5126,l.PositionKind="position",l.NormalKind="normal",l.TangentKind="tangent",l.UVKind="uv",l.UV2Kind="uv2",l.UV3Kind="uv3",l.UV4Kind="uv4",l.UV5Kind="uv5",l.UV6Kind="uv6",l.ColorKind="color",l.ColorInstanceKind="instanceColor",l.MatricesIndicesKind="matricesIndices",l.MatricesWeightsKind="matricesWeights",l.MatricesIndicesExtraKind="matricesIndicesExtra",l.MatricesWeightsExtraKind="matricesWeightsExtra"},12480:(E,H,d)=>{d.d(H,{e:()=>V,i:()=>M,j:()=>r,m:()=>t,o:()=>g,r:()=>l,v:()=>S});var n=d(12237);function Z(E,H,d,n){switch(H){case 5120:{let H=E.getInt8(d);return n&&(H=Math.max(H/127,-1)),H}case 5121:{let H=E.getUint8(d);return n&&(H/=255),H}case 5122:{let H=E.getInt16(d,!0);return n&&(H=Math.max(H/32767,-1)),H}case 5123:{let H=E.getUint16(d,!0);return n&&(H/=65535),H}case 5124:return E.getInt32(d,!0);case 5125:return E.getUint32(d,!0);case 5126:return E.getFloat32(d,!0);default:throw new Error(`Invalid component type ${H}`)}}function I(E,H,d,n,Z){switch(H){case 5120:n&&(Z=Math.round(127*Z)),E.setInt8(d,Z);break;case 5121:n&&(Z=Math.round(255*Z)),E.setUint8(d,Z);break;case 5122:n&&(Z=Math.round(32767*Z)),E.setInt16(d,Z,!0);break;case 5123:n&&(Z=Math.round(65535*Z)),E.setUint16(d,Z,!0);break;case 5124:E.setInt32(d,Z,!0);break;case 5125:E.setUint32(d,Z,!0);break;case 5126:E.setFloat32(d,Z,!0);break;default:throw new Error(`Invalid component type ${H}`)}}function g(E){switch(E){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${E}'`)}}function l(E){switch(E){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${E}'`)}}function r(E,H,d,n,l,r,t,S){const M=new Array(n),V=new Array(n);if(E instanceof Array){let Z=H/4;const I=d/4;for(let H=0;H<r;H+=n){for(let H=0;H<n;H++)M[H]=V[H]=E[Z+H];S(V,H);for(let H=0;H<n;H++)M[H]!==V[H]&&(E[Z+H]=V[H]);Z+=I}}else{const C=ArrayBuffer.isView(E)?new DataView(E.buffer,E.byteOffset,E.byteLength):new DataView(E),w=g(l);for(let E=0;E<r;E+=n){for(let E=0,d=H;E<n;E++,d+=w)M[E]=V[E]=Z(C,l,d,t);S(V,E);for(let E=0,d=H;E<n;E++,d+=w)M[E]!==V[E]&&I(C,l,d,t,V[E]);H+=d}}}function t(E,H,d,Z,I,l,t,S){const M=H*g(d),V=t*H;if(5126!==d||I!==M){const n=new Float32Array(V);return r(E,Z,I,H,d,V,l,((E,d)=>{for(let Z=0;Z<H;Z++)n[d+Z]=E[Z]})),n}if(!(E instanceof Array||E instanceof Float32Array)||0!==Z||E.length!==V){if(E instanceof Array){const H=Z/4;return E.slice(H,H+V)}if(E instanceof ArrayBuffer)return new Float32Array(E,Z,V);{const H=E.byteOffset+Z;return 0!==(3&H)&&(n.b.Warn("Float array must be aligned to 4-bytes border"),S=!0),S?new Float32Array(E.buffer.slice(H,H+V*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(E.buffer,H,V)}}return S?E.slice():E}function S(E,H,d,Z,I,t,S,M){const V=g(d),C=l(d),w=S*H;if(Array.isArray(E)){if(0!==(3&Z)||0!==(3&I))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const n=Z/4,g=I/4;if(n+(S-1)*g+H>E.length)throw new Error("Last accessed index is out of bounds.");if(g<H)throw new Error("Data stride cannot be smaller than the component size.");if(g!==H){const n=new C(w);return r(E,Z,I,H,d,w,t,((E,d)=>{for(let Z=0;Z<H;Z++)n[d+Z]=E[Z]})),n}return new C(E.slice(n,n+w))}let R,Q=Z;E instanceof ArrayBuffer?R=E:(R=E.buffer,Q+=E.byteOffset);if(Q+(S-1)*I+H*V>R.byteLength)throw new Error("Last accessed byte is out of bounds.");const L=H*V;if(I<L)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(I!==L){const E=new C(w);return r(R,Q,I,H,d,w,t,((d,n)=>{for(let Z=0;Z<H;Z++)E[n+Z]=d[Z]})),E}return 1!==V&&0!==(Q&V-1)&&(n.b.Warn("Array must be aligned to border of element size. Data will be copied."),M=!0),M?new C(R.slice(Q,Q+w*V)):new C(R,Q,w)}function M(E,H,d,Z,I,l,t,S){const M=H*g(d),V=t*H;if(S.length!==V)throw new Error("Output length is not valid");if(5126===d&&I===M)if(E instanceof Array){const H=Z/4;S.set(E,H)}else if(E instanceof ArrayBuffer){const H=new Float32Array(E,Z,V);S.set(H)}else{const H=E.byteOffset+Z;if(0!==(3&H))return n.b.Warn("Float array must be aligned to 4-bytes border"),void S.set(new Float32Array(E.buffer.slice(H,H+V*Float32Array.BYTES_PER_ELEMENT)));const d=new Float32Array(E.buffer,H,V);S.set(d)}else r(E,Z,I,H,d,V,l,((E,d)=>{for(let n=0;n<H;n++)S[d+n]=E[n]}))}function V(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(E)){for(let Z=0;Z<H;Z++)if(E[d+Z]-n>65535)return!0;return!1}return 4===E.BYTES_PER_ELEMENT}},12471:(E,H,d)=>{d.d(H,{d:()=>n});class n{get underlyingResource(){return null}constructor(){this.references=0,this.Ld=0,this.is32Bits=!1,this.uniqueId=n._Counter++}}n._Counter=0},12516:(E,H,d)=>{d.d(H,{c:()=>Z});var n=d(12287);class Z{static GetEffect(E){return void 0===E.getPipelineContext?E.effect:E}constructor(E){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=E.createDrawContext(),H&&(this.materialContext=E.createMaterialContext())}setEffect(E,H){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var n;(this.effect=E,void 0!==H&&(this.defines=H),d)&&(null===(n=this.drawContext)||void 0===n||n.reset())}dispose(){var E;let H=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const E=this.effect;H?E.dispose():n.b.SetImmediate((()=>{E.getEngine().onEndFrameObservable.addOnce((()=>{E.dispose()}))})),this.effect=null}null===(E=this.drawContext)||void 0===E||E.dispose()}}},12602:(E,H,d)=>{d.d(H,{c:()=>Z});var n=d(12439);class Z{static GetPlanes(E){const H=[];for(let d=0;d<6;d++)H.push(new n.d(0,0,0,0));return Z.GetPlanesToRef(E,H),H}static GetNearPlaneToRef(E,H){const d=E.m;H.normal.x=d[3]+d[2],H.normal.y=d[7]+d[6],H.normal.z=d[11]+d[10],H.d=d[15]+d[14],H.normalize()}static GetFarPlaneToRef(E,H){const d=E.m;H.normal.x=d[3]-d[2],H.normal.y=d[7]-d[6],H.normal.z=d[11]-d[10],H.d=d[15]-d[14],H.normalize()}static GetLeftPlaneToRef(E,H){const d=E.m;H.normal.x=d[3]+d[0],H.normal.y=d[7]+d[4],H.normal.z=d[11]+d[8],H.d=d[15]+d[12],H.normalize()}static GetRightPlaneToRef(E,H){const d=E.m;H.normal.x=d[3]-d[0],H.normal.y=d[7]-d[4],H.normal.z=d[11]-d[8],H.d=d[15]-d[12],H.normalize()}static GetTopPlaneToRef(E,H){const d=E.m;H.normal.x=d[3]-d[1],H.normal.y=d[7]-d[5],H.normal.z=d[11]-d[9],H.d=d[15]-d[13],H.normalize()}static GetBottomPlaneToRef(E,H){const d=E.m;H.normal.x=d[3]+d[1],H.normal.y=d[7]+d[5],H.normal.z=d[11]+d[9],H.d=d[15]+d[13],H.normalize()}static GetPlanesToRef(E,H){Z.GetNearPlaneToRef(E,H[0]),Z.GetFarPlaneToRef(E,H[1]),Z.GetLeftPlaneToRef(E,H[2]),Z.GetRightPlaneToRef(E,H[3]),Z.GetTopPlaneToRef(E,H[4]),Z.GetBottomPlaneToRef(E,H[5])}static IsPointInFrustum(E,H){for(let d=0;d<6;d++)if(H[d].dotCoordinate(E)<0)return!1;return!0}}},12612:(E,H,d)=>{d.d(H,{e:()=>Z});var n=d(12247);class Z{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(E,H){Z.Enabled&&(this._current+=E,H&&this._fetchResult())}beginMonitoring(){Z.Enabled&&(this._startMonitoringTime=n.b.Now)}endMonitoring(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!Z.Enabled)return;E&&this.fetchNewFrame();const H=n.b.Now;this._current=H-this._startMonitoringTime,E&&this._fetchResult()}Cd(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const E=n.b.Now;E-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=E,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}Z.Enabled=!0},12491:(E,H,d)=>{d.d(H,{b:()=>Z,c:()=>n});class n{constructor(E){this.length=0,this.data=new Array(E),this._id=n._GlobalId++}push(E){this.data[this.length++]=E,this.length>this.data.length&&(this.data.length*=2)}forEach(E){for(let H=0;H<this.length;H++)E(this.data[H])}sort(E){this.data.sort(E)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(E){if(0!==E.length){this.length+E.length>this.data.length&&(this.data.length=2*(this.length+E.length));for(let H=0;H<E.length;H++)this.data[this.length++]=(E.data||E)[H]}}indexOf(E){const H=this.data.indexOf(E);return H>=this.length?-1:H}contains(E){return-1!==this.indexOf(E)}}n._GlobalId=0;class Z extends n{constructor(){super(...arguments),this._duplicateId=0}push(E){super.push(E),E.__smartArrayFlags||(E.__smartArrayFlags={}),E.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(E){return(!E.__smartArrayFlags||E.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(E),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(E){if(0!==E.length){this.length+E.length>this.data.length&&(this.data.length=2*(this.length+E.length));for(let H=0;H<E.length;H++){const d=(E.data||E)[H];this.pushNoDuplicate(d)}}}}},12459:(E,H,d)=>{d.d(H,{c:()=>I});var n=d(12463),Z=d(12230);class I{constructor(E){this._vertexBuffers={},this.onBeforeRenderObservable=new Z.e,this._scene=E}_prepareBuffers(){if(this._vertexBuffers[n.g.PositionKind])return;const E=[];E.push(1,1),E.push(-1,1),E.push(-1,-1),E.push(1,-1),this._vertexBuffers[n.g.PositionKind]=new n.g(this._scene.getEngine(),E,n.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const E=[];E.push(0),E.push(1),E.push(2),E.push(0),E.push(2),E.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(E)}_rebuild(){const E=this._vertexBuffers[n.g.PositionKind];E&&(E._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const d=this._scene.activeCamera;return!!d&&(H=H||d._postProcesses.filter((E=>null!=E)),!(!H||0===H.length||!this._scene.postProcessesEnabled)&&(H[0].activate(d,E,null!==H&&void 0!==H),!0))}directRender(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,I=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:E.length;const l=this._scene.getEngine();for(let t=0;t<g;t++){var r;if(t<E.length-1)E[t+1].activate(this._scene.activeCamera||this._scene,null===H||void 0===H?void 0:H.texture);else H?l.bindFramebuffer(H,n,void 0,void 0,d,Z):I||l.restoreDefaultFramebuffer(),null===(r=l._debugInsertMarker)||void 0===r||r.call(l,`post process ${E[t].name} output`);const g=E[t],S=g.apply();S&&(g.onBeforeRenderObservable.notifyObservers(S),this._prepareBuffers(),l.bindBuffers(this._vertexBuffers,this._indexBuffer,S),l.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(S))}l.setDepthBuffer(!0),l.setDepthWrite(!0)}_finalizeFrame(E,H,d,n){let Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const I=this._scene.activeCamera;if(!I)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(n=n||I._postProcesses.filter((E=>null!=E))).length||!this._scene.postProcessesEnabled)return;const g=this._scene.getEngine();for(let r=0,t=n.length;r<t;r++){const S=n[r];var l;if(r<t-1)S._outputTexture=n[r+1].activate(I,null===H||void 0===H?void 0:H.texture);else H?(g.bindFramebuffer(H,d,void 0,void 0,Z),S._outputTexture=H):(g.restoreDefaultFramebuffer(),S._outputTexture=null),null===(l=g._debugInsertMarker)||void 0===l||l.call(g,`post process ${n[r].name} output`);if(E)break;const M=S.apply();M&&(S.onBeforeRenderObservable.notifyObservers(M),this._prepareBuffers(),g.bindBuffers(this._vertexBuffers,this._indexBuffer,M),g.drawElementsType(0,0,6),S.onAfterRenderObservable.notifyObservers(M))}g.setDepthBuffer(!0),g.setDepthWrite(!0),g.setAlphaMode(0)}dispose(){const E=this._vertexBuffers[n.g.PositionKind];E&&(E.dispose(),this._vertexBuffers[n.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12486:(E,H,d)=>{d.d(H,{b:()=>l});var n=d(12491),Z=d(12384);class I{set opaqueSortCompareFn(E){this._opaqueSortCompareFn=E||I.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(E){this._alphaTestSortCompareFn=E||I.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(E){this._transparentSortCompareFn=E||I.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=E,this._opaqueSubMeshes=new n.c(256),this._transparentSubMeshes=new n.c(256),this._alphaTestSubMeshes=new n.c(256),this._depthOnlySubMeshes=new n.c(256),this._particleSystems=new n.c(256),this._spriteManagers=new n.c(256),this._empty=!0,this._edgesRenderers=new n.b(16),this._scene=H,this.opaqueSortCompareFn=d,this.alphaTestSortCompareFn=Z,this.transparentSortCompareFn=I}render(E,H,d,n){if(E)return void E(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const Z=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(Z.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),Z.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const I=Z.getStencilBuffer();if(Z.setStencilBuffer(!1),H&&this._renderSprites(),d&&this._renderParticles(n),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(Z.setStencilBuffer(I),this._scene.useOrderIndependentTransparency){const E=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);E.length&&this._renderTransparent(E)}else this._renderTransparent(this._transparentSubMeshes);Z.setAlphaMode(0)}if(Z.setStencilBuffer(!1),this._edgesRenderers.length){for(let E=0;E<this._edgesRenderers.length;E++)this._edgesRenderers.data[E].render();Z.setAlphaMode(0)}Z.setStencilBuffer(I)}_renderOpaqueSorted(E){I._RenderSorted(E,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(E){I._RenderSorted(E,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(E){I._RenderSorted(E,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(E,H,d,n){let g,l=0;const r=d?d.globalPosition:I._ZeroVector;if(n)for(;l<E.length;l++)g=E.data[l],g._alphaIndex=g.getMesh().alphaIndex,g._distanceToCamera=Z.wH.Distance(g.getBoundingInfo().boundingSphere.centerWorld,r);const t=E.length===E.data.length?E.data:E.data.slice(0,E.length);H&&t.sort(H);const S=t[0].getMesh().fE();for(l=0;l<t.length;l++)if(g=t[l],!S._activeMeshesFrozenButKeepClipping||g.isInFrustum(S._frustumPlanes)){if(n){const E=g.kE();if(E&&E.needDepthPrePass){const H=E.fE().getEngine();H.setColorWrite(!1),H.setAlphaMode(0),g.render(!1),H.setColorWrite(!0)}}g.render(n)}}static defaultTransparentSortCompare(E,H){return E._alphaIndex>H._alphaIndex?1:E._alphaIndex<H._alphaIndex?-1:I.backToFrontSortCompare(E,H)}static backToFrontSortCompare(E,H){return E._distanceToCamera<H._distanceToCamera?1:E._distanceToCamera>H._distanceToCamera?-1:0}static frontToBackSortCompare(E,H){return E._distanceToCamera<H._distanceToCamera?-1:E._distanceToCamera>H._distanceToCamera?1:0}static PainterSortCompare(E,H){const d=E.getMesh(),n=H.getMesh();return d.material&&n.material?d.material.uniqueId-n.material.uniqueId:d.uniqueId-n.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(E,H,d){void 0===H&&(H=E.getMesh()),void 0===d&&(d=E.kE()),null!==d&&void 0!==d&&(d.needAlphaBlendingForMesh(H)?this._transparentSubMeshes.push(E):d.needAlphaTestingForMesh(H)?(d.needDepthPrePass&&this._depthOnlySubMeshes.push(E),this._alphaTestSubMeshes.push(E)):(d.needDepthPrePass&&this._depthOnlySubMeshes.push(E),this._opaqueSubMeshes.push(E)),H._renderingGroup=this,H._edgesRenderer&&H.isEnabled()&&H.isVisible&&H._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(H._edgesRenderer),this._empty=!1)}dispatchSprites(E){this._spriteManagers.push(E),this._empty=!1}dispatchParticles(E){this._particleSystems.push(E),this._empty=!1}_renderParticles(E){if(0===this._particleSystems.length)return;const H=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let d=0;d<this._particleSystems.length;d++){const n=this._particleSystems.data[d];if(0===(H&&H.layerMask&n.layerMask))continue;const Z=n.nH;Z.position&&E&&-1===E.indexOf(Z)||this._scene._activeParticles.addCount(n.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const E=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let H=0;H<this._spriteManagers.length;H++){const d=this._spriteManagers.data[H];0!==(E&&E.layerMask&d.layerMask)&&d.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}I._ZeroVector=Z.wH.Zero();class g{}class l{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(E){E!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=E,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const E of this._scene.meshes)if(E.od)for(const H of E.od)H._wasDispatched=!1;if(this._scene.spriteManagers)for(const E of this._scene.spriteManagers)E._wasDispatched=!1;for(const E of this._scene.lV)E._wasDispatched=!1}constructor(E){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new g,this._maintainStateBetweenFrames=!1,this._scene=E;for(let H=l.MIN_RENDERINGGROUPS;H<l.MAX_RENDERINGGROUPS;H++)this._autoClearDepthStencil[H]={ud:!0,depth:!0,ed:!0}}getRenderingGroup(E){const H=E||0;return this._prepareRenderingGroup(H),this._renderingGroups[H]}_clearDepthStencilBuffer(){let E=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,E,H),this._depthStencilBufferAlreadyCleaned=!0)}render(E,H,d,n){const Z=this._renderingGroupInfo;if(Z.QH=this._scene,Z.camera=this._scene.activeCamera,Z.renderingManager=this,this._scene.spriteManagers&&n)for(let I=0;I<this._scene.spriteManagers.length;I++){const E=this._scene.spriteManagers[I];this.dispatchSprites(E)}for(let I=l.MIN_RENDERINGGROUPS;I<l.MAX_RENDERINGGROUPS;I++){this._depthStencilBufferAlreadyCleaned=I===l.MIN_RENDERINGGROUPS;const g=this._renderingGroups[I];if(!g||g._empty)continue;const r=1<<I;if(Z.renderingGroupId=I,this._scene.onBeforeRenderingGroupObservable.notifyObservers(Z,r),l.AUTOCLEAR){const E=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(I):this._autoClearDepthStencil[I];E&&E.ud&&this._clearDepthStencilBuffer(E.depth,E.ed)}for(const E of this._scene._beforeRenderingGroupDrawStage)E.action(I);g.render(E,n,d,H);for(const E of this._scene._afterRenderingGroupDrawStage)E.action(I);this._scene.onAfterRenderingGroupObservable.notifyObservers(Z,r)}}reset(){if(!this.maintainStateBetweenFrames)for(let E=l.MIN_RENDERINGGROUPS;E<l.MAX_RENDERINGGROUPS;E++){const H=this._renderingGroups[E];H&&H.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let E=l.MIN_RENDERINGGROUPS;E<l.MAX_RENDERINGGROUPS;E++){const H=this._renderingGroups[E];H&&H.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let E=l.MIN_RENDERINGGROUPS;E<l.MAX_RENDERINGGROUPS;E++){const H=this._renderingGroups[E];H&&H.dispose()}}_prepareRenderingGroup(E){void 0===this._renderingGroups[E]&&(this._renderingGroups[E]=new I(E,this._scene,this._customOpaqueSortCompareFn[E],this._customAlphaTestSortCompareFn[E],this._customTransparentSortCompareFn[E]))}dispatchSprites(E){this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatchSprites(E))}dispatchParticles(E){this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(E.renderingGroupId).dispatchParticles(E))}dispatch(E,H,d){void 0===H&&(H=E.getMesh()),this.maintainStateBetweenFrames&&E._wasDispatched||(E._wasDispatched=!0,this.getRenderingGroup(H.renderingGroupId).dispatch(E,H,d))}setRenderingOrder(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[E]=H,this._customAlphaTestSortCompareFn[E]=d,this._customTransparentSortCompareFn[E]=n,this._renderingGroups[E]){const H=this._renderingGroups[E];H.opaqueSortCompareFn=this._customOpaqueSortCompareFn[E],H.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[E],H.transparentSortCompareFn=this._customTransparentSortCompareFn[E]}}setRenderingAutoClearDepthStencil(E,H){let d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[E]={ud:H,depth:d,ed:n}}getAutoClearDepthStencilSetup(E){return this._autoClearDepthStencil[E]}}l.MAX_RENDERINGGROUPS=4,l.MIN_RENDERINGGROUPS=0,l.AUTOCLEAR=!0}}]);