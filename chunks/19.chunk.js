"use strict";(self.mo7o6813fhb=self.mo7o6813fhb||[]).push([[19],{12480:(t,U,y)=>{y.d(U,{b:()=>mt,e:()=>X});var I=y(12484),r=y(12221),Y=y(12491);class mt{get G(){return this._isDisposed}constructor(t,U,y){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],mt=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7?arguments[7]:void 0,G=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,t&&t.St?this._engine=t.St().getEngine():this._engine=t,this._updatable=y,this._instanced=mt,this._divisor=P||1,this._label=G,U instanceof I.d?(this._data=null,this._buffer=U):(this._data=U,this._buffer=null),this.byteStride=X?r:r*Float32Array.BYTES_PER_ELEMENT,Y||this.create()}createVertexBuffer(t,U,y,I,r){let Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6?arguments[6]:void 0;const P=Y?U:U*Float32Array.BYTES_PER_ELEMENT,G=I?Y?I:I*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new X(this._engine,this,t,this._updatable,!0,G,void 0===r?this._instanced:r,P,y,void 0,void 0,!0,this._divisor||mt)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!t&&this._buffer||(t=t||this._data,t&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t),this._data=t):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(t,this._label),this._data=t):this._buffer=this._engine.createVertexBuffer(t,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.fU>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.fU,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.fU,void 0,this._label));r.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(t){this.create(t)}updateDirectly(t,U,y){let I=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,t,I?U:U*Float32Array.BYTES_PER_ELEMENT,y?y*this.byteStride:void 0),this._data=0===U&&void 0===y?t:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class X{get G(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(t){const U=0!=t;this._instanceDivisor=t,U!==this._instanced&&(this._instanced=U,this._computeHashCode())}get _maxVerticesCount(){const t=this.getData();return t?Array.isArray(t)?t.length/(this.byteStride/4)-this.byteOffset/4:(t.byteLength-this.byteOffset)/this.byteStride:0}constructor(t,U,y,I,r,P,G,M,L,h){let Q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],F=arguments.length>11&&void 0!==arguments[11]&&arguments[11],E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,w=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let D=!1;if(this.wU=t,"object"===typeof I&&null!==I?(D=I.updatable??!1,r=I.postponeInternalCreation,P=I.stride,G=I.instanced,M=I.offset,L=I.size,h=I.type,Q=I.normalized??!1,F=I.useBytes??!1,E=I.divisor??1,w=I.takeBufferOwnership??!1,this._label=I.label):D=!!I,U instanceof mt?(this._buffer=U,this._ownsBuffer=w):(this._buffer=new mt(t,U,D,P,r,G,F,E,this._label),this._ownsBuffer=!0),this.uniqueId=X._Counter++,this._kind=y,void 0===h){const t=this.getData();this.type=t?X.GetDataType(t):X.FLOAT}else this.type=h;const l=(0,Y.o)(this.type);F?(this._size=L||(P?P/l:X.DeduceStride(y)),this.byteStride=P||this._buffer.byteStride||this._size*l,this.byteOffset=M||0):(this._size=L||P||X.DeduceStride(y),this.byteStride=P?P*l:this._buffer.byteStride||this._size*l,this.byteOffset=(M||0)*l),this.normalized=Q,this._instanced=void 0!==G&&G,this._instanceDivisor=G?E:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var t;null===(t=this._buffer)||void 0===t||t._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(t,U){const y=this.getData();return y?(0,Y.l)(y,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,t,U):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,Y.o)(this.type)}getOffset(){return this.byteOffset/(0,Y.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,Y.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(t){this._buffer.create(t),this._alignBuffer()}update(t){this._buffer.update(t),this._alignBuffer()}updateDirectly(t,U){let y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(t,U,void 0,y),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(t,U){(0,Y.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,t,this.normalized,((t,y)=>{for(let I=0;I<this._size;I++)U(t[I],y+I)}))}_alignBuffer(){}static DeduceStride(t){switch(t){case X.UVKind:case X.UV2Kind:case X.UV3Kind:case X.UV4Kind:case X.UV5Kind:case X.UV6Kind:return 2;case X.NormalKind:case X.PositionKind:return 3;case X.ColorKind:case X.ColorInstanceKind:case X.MatricesIndicesKind:case X.MatricesIndicesExtraKind:case X.MatricesWeightsKind:case X.MatricesWeightsExtraKind:case X.TangentKind:return 4;default:throw new Error("Invalid kind '"+t+"'")}}static GetDataType(t){return t instanceof Int8Array?X.BYTE:t instanceof Uint8Array?X.UNSIGNED_BYTE:t instanceof Int16Array?X.SHORT:t instanceof Uint16Array?X.UNSIGNED_SHORT:t instanceof Int32Array?X.INT:t instanceof Uint32Array?X.UNSIGNED_INT:X.FLOAT}static GetTypeByteLength(t){return(0,Y.o)(t)}static ForEach(t,U,y,I,r,mt,X,P){(0,Y.h)(t,U,y,I,r,mt,X,((t,U)=>{for(let y=0;y<I;y++)P(t[y],U+y)}))}static GetFloatData(t,U,y,I,r,mt,X,P){return(0,Y.l)(t,U,y,I,r,mt,X,P)}}X._Counter=0,X.BYTE=5120,X.UNSIGNED_BYTE=5121,X.SHORT=5122,X.UNSIGNED_SHORT=5123,X.INT=5124,X.UNSIGNED_INT=5125,X.FLOAT=5126,X.PositionKind="position",X.NormalKind="normal",X.TangentKind="tangent",X.UVKind="uv",X.UV2Kind="uv2",X.UV3Kind="uv3",X.UV4Kind="uv4",X.UV5Kind="uv5",X.UV6Kind="uv6",X.ColorKind="color",X.ColorInstanceKind="instanceColor",X.MatricesIndicesKind="matricesIndices",X.MatricesWeightsKind="matricesWeights",X.MatricesIndicesExtraKind="matricesIndicesExtra",X.MatricesWeightsExtraKind="matricesWeightsExtra"},12491:(t,U,y)=>{y.d(U,{b:()=>h,e:()=>L,h:()=>P,l:()=>G,o:()=>mt,r:()=>X,u:()=>M});var I=y(12221);function r(t,U,y,I){switch(U){case 5120:{let U=t.getInt8(y);return I&&(U=Math.max(U/127,-1)),U}case 5121:{let U=t.getUint8(y);return I&&(U/=255),U}case 5122:{let U=t.getInt16(y,!0);return I&&(U=Math.max(U/32767,-1)),U}case 5123:{let U=t.getUint16(y,!0);return I&&(U/=65535),U}case 5124:return t.getInt32(y,!0);case 5125:return t.getUint32(y,!0);case 5126:return t.getFloat32(y,!0);default:throw new Error(`Invalid component type ${U}`)}}function Y(t,U,y,I,r){switch(U){case 5120:I&&(r=Math.round(127*r)),t.setInt8(y,r);break;case 5121:I&&(r=Math.round(255*r)),t.setUint8(y,r);break;case 5122:I&&(r=Math.round(32767*r)),t.setInt16(y,r,!0);break;case 5123:I&&(r=Math.round(65535*r)),t.setUint16(y,r,!0);break;case 5124:t.setInt32(y,r,!0);break;case 5125:t.setUint32(y,r,!0);break;case 5126:t.setFloat32(y,r,!0);break;default:throw new Error(`Invalid component type ${U}`)}}function mt(t){switch(t){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${t}'`)}}function X(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${t}'`)}}function P(t,U,y,I,X,P,G,M){const L=new Array(I),h=new Array(I);if(t instanceof Array){let r=U/4;const Y=y/4;for(let U=0;U<P;U+=I){for(let U=0;U<I;U++)L[U]=h[U]=t[r+U];M(h,U);for(let U=0;U<I;U++)L[U]!==h[U]&&(t[r+U]=h[U]);r+=Y}}else{const Q=ArrayBuffer.isView(t)?new DataView(t.buffer,t.byteOffset,t.byteLength):new DataView(t),F=mt(X);for(let t=0;t<P;t+=I){for(let t=0,y=U;t<I;t++,y+=F)L[t]=h[t]=r(Q,X,y,G);M(h,t);for(let t=0,y=U;t<I;t++,y+=F)L[t]!==h[t]&&Y(Q,X,y,G,h[t]);U+=y}}}function G(t,U,y,r,Y,X,G,M){const L=U*mt(y),h=G*U;if(5126!==y||Y!==L){const I=new Float32Array(h);return P(t,r,Y,U,y,h,X,((t,y)=>{for(let r=0;r<U;r++)I[y+r]=t[r]})),I}if(!(t instanceof Array||t instanceof Float32Array)||0!==r||t.length!==h){if(t instanceof Array){const U=r/4;return t.slice(U,U+h)}if(t instanceof ArrayBuffer)return new Float32Array(t,r,h);{const U=t.byteOffset+r;return 0!==(3&U)&&(I.b.Warn("Float array must be aligned to 4-bytes border"),M=!0),M?new Float32Array(t.buffer.slice(U,U+h*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(t.buffer,U,h)}}return M?t.slice():t}function M(t,U,y,r,Y,G,M,L){const h=mt(y),Q=X(y),F=M*U;if(Array.isArray(t)){if(0!==(3&r)||0!==(3&Y))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const I=r/4,mt=Y/4;if(I+(M-1)*mt+U>t.length)throw new Error("Last accessed index is out of bounds.");if(mt<U)throw new Error("Data stride cannot be smaller than the component size.");if(mt!==U){const I=new Q(F);return P(t,r,Y,U,y,F,G,((t,y)=>{for(let r=0;r<U;r++)I[y+r]=t[r]})),I}return new Q(t.slice(I,I+F))}let E,w=r;t instanceof ArrayBuffer?E=t:(E=t.buffer,w+=t.byteOffset);if(w+(M-1)*Y+U*h>E.byteLength)throw new Error("Last accessed byte is out of bounds.");const D=U*h;if(Y<D)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(Y!==D){const t=new Q(F);return P(E,w,Y,U,y,F,G,((y,I)=>{for(let r=0;r<U;r++)t[I+r]=y[r]})),t}return 1!==h&&0!==(w&h-1)&&(I.b.Warn("Array must be aligned to border of element size. Data will be copied."),L=!0),L?new Q(E.slice(w,w+F*h)):new Q(E,w,F)}function L(t,U,y,r,Y,X,G,M){const L=U*mt(y),h=G*U;if(M.length!==h)throw new Error("Output length is not valid");if(5126===y&&Y===L)if(t instanceof Array){const U=r/4;M.set(t,U)}else if(t instanceof ArrayBuffer){const U=new Float32Array(t,r,h);M.set(U)}else{const U=t.byteOffset+r;if(0!==(3&U))return I.b.Warn("Float array must be aligned to 4-bytes border"),void M.set(new Float32Array(t.buffer.slice(U,U+h*Float32Array.BYTES_PER_ELEMENT)));const y=new Float32Array(t.buffer,U,h);M.set(y)}else P(t,r,Y,U,y,h,X,((t,y)=>{for(let I=0;I<U;I++)M[y+I]=t[I]}))}function h(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(t)){for(let r=0;r<U;r++)if(t[y+r]-I>65535)return!0;return!1}return 4===t.BYTES_PER_ELEMENT}},12484:(t,U,y)=>{y.d(U,{d:()=>I});class I{get underlyingResource(){return null}constructor(){this.references=0,this.fU=0,this.is32Bits=!1,this.uniqueId=I._Counter++}}I._Counter=0},12521:(t,U,y)=>{y.d(U,{e:()=>r});var I=y(12277);class r{static GetEffect(t){return void 0===t.getPipelineContext?t.effect:t}constructor(t){let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=t.createDrawContext(),U&&(this.materialContext=t.createMaterialContext())}setEffect(t,U){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var I;(this.effect=t,void 0!==U&&(this.defines=U),y)&&(null===(I=this.drawContext)||void 0===I||I.reset())}dispose(){var t;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const t=this.effect;U?t.dispose():I.e.SetImmediate((()=>{t.getEngine().onEndFrameObservable.addOnce((()=>{t.dispose()}))})),this.effect=null}null===(t=this.drawContext)||void 0===t||t.dispose()}}},12618:(t,U,y)=>{y.d(U,{c:()=>r});var I=y(12451);class r{static GetPlanes(t){const U=[];for(let y=0;y<6;y++)U.push(new I.d(0,0,0,0));return r.GetPlanesToRef(t,U),U}static GetNearPlaneToRef(t,U){const y=t.m;U.normal.x=y[3]+y[2],U.normal.y=y[7]+y[6],U.normal.z=y[11]+y[10],U.d=y[15]+y[14],U.normalize()}static GetFarPlaneToRef(t,U){const y=t.m;U.normal.x=y[3]-y[2],U.normal.y=y[7]-y[6],U.normal.z=y[11]-y[10],U.d=y[15]-y[14],U.normalize()}static GetLeftPlaneToRef(t,U){const y=t.m;U.normal.x=y[3]+y[0],U.normal.y=y[7]+y[4],U.normal.z=y[11]+y[8],U.d=y[15]+y[12],U.normalize()}static GetRightPlaneToRef(t,U){const y=t.m;U.normal.x=y[3]-y[0],U.normal.y=y[7]-y[4],U.normal.z=y[11]-y[8],U.d=y[15]-y[12],U.normalize()}static GetTopPlaneToRef(t,U){const y=t.m;U.normal.x=y[3]-y[1],U.normal.y=y[7]-y[5],U.normal.z=y[11]-y[9],U.d=y[15]-y[13],U.normalize()}static GetBottomPlaneToRef(t,U){const y=t.m;U.normal.x=y[3]+y[1],U.normal.y=y[7]+y[5],U.normal.z=y[11]+y[9],U.d=y[15]+y[13],U.normalize()}static GetPlanesToRef(t,U){r.GetNearPlaneToRef(t,U[0]),r.GetFarPlaneToRef(t,U[1]),r.GetLeftPlaneToRef(t,U[2]),r.GetRightPlaneToRef(t,U[3]),r.GetTopPlaneToRef(t,U[4]),r.GetBottomPlaneToRef(t,U[5])}static IsPointInFrustum(t,U){for(let y=0;y<6;y++)if(U[y].dotCoordinate(t)<0)return!1;return!0}}},12629:(t,U,y)=>{y.d(U,{e:()=>r});var I=y(12234);class r{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(t,U){r.Enabled&&(this._current+=t,U&&this._fetchResult())}beginMonitoring(){r.Enabled&&(this._startMonitoringTime=I.b.Now)}endMonitoring(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!r.Enabled)return;t&&this.fetchNewFrame();const U=I.b.Now;this._current=U-this._startMonitoringTime,t&&this._fetchResult()}QX(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const t=I.b.Now;t-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=t,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}r.Enabled=!0},12496:(t,U,y)=>{y.d(U,{d:()=>r,e:()=>I});class I{constructor(t){this.length=0,this.data=new Array(t),this._id=I._GlobalId++}push(t){this.data[this.length++]=t,this.length>this.data.length&&(this.data.length*=2)}forEach(t){for(let U=0;U<this.length;U++)t(this.data[U])}sort(t){this.data.sort(t)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(let U=0;U<t.length;U++)this.data[this.length++]=(t.data||t)[U]}}indexOf(t){const U=this.data.indexOf(t);return U>=this.length?-1:U}contains(t){return-1!==this.indexOf(t)}}I._GlobalId=0;class r extends I{constructor(){super(...arguments),this._duplicateId=0}push(t){super.push(t),t.__smartArrayFlags||(t.__smartArrayFlags={}),t.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(t){return(!t.__smartArrayFlags||t.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(t),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(t){if(0!==t.length){this.length+t.length>this.data.length&&(this.data.length=2*(this.length+t.length));for(let U=0;U<t.length;U++){const y=(t.data||t)[U];this.pushNoDuplicate(y)}}}}},12472:(t,U,y)=>{y.d(U,{b:()=>Y});var I=y(12480),r=y(12204);class Y{constructor(t){this._vertexBuffers={},this.onBeforeRenderObservable=new r.b,this._scene=t}_prepareBuffers(){if(this._vertexBuffers[I.e.PositionKind])return;const t=[];t.push(1,1),t.push(-1,1),t.push(-1,-1),t.push(1,-1),this._vertexBuffers[I.e.PositionKind]=new I.e(this._scene.getEngine(),t,I.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const t=[];t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(t)}_rebuild(){const t=this._vertexBuffers[I.e.PositionKind];t&&(t._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const y=this._scene.activeCamera;return!!y&&(U=U||y._postProcesses.filter((t=>null!=t)),!(!U||0===U.length||!this._scene.postProcessesEnabled)&&(U[0].activate(y,t,null!==U&&void 0!==U),!0))}directRender(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],mt=arguments.length>6&&void 0!==arguments[6]?arguments[6]:t.length;const X=this._scene.getEngine();for(let G=0;G<mt;G++){var P;if(G<t.length-1)t[G+1].activate(this._scene.activeCamera||this._scene,null===U||void 0===U?void 0:U.texture);else U?X.bindFramebuffer(U,I,void 0,void 0,y,r):Y||X.restoreDefaultFramebuffer(),null===(P=X._debugInsertMarker)||void 0===P||P.call(X,`post process ${t[G].name} output`);const mt=t[G],M=mt.apply();M&&(mt.onBeforeRenderObservable.notifyObservers(M),this._prepareBuffers(),X.bindBuffers(this._vertexBuffers,this._indexBuffer,M),X.drawElementsType(0,0,6),mt.onAfterRenderObservable.notifyObservers(M))}X.setDepthBuffer(!0),X.setDepthWrite(!0)}_finalizeFrame(t,U,y,I){let r=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Y=this._scene.activeCamera;if(!Y)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(I=I||Y._postProcesses.filter((t=>null!=t))).length||!this._scene.postProcessesEnabled)return;const mt=this._scene.getEngine();for(let P=0,G=I.length;P<G;P++){const M=I[P];var X;if(P<G-1)M._outputTexture=I[P+1].activate(Y,null===U||void 0===U?void 0:U.texture);else U?(mt.bindFramebuffer(U,y,void 0,void 0,r),M._outputTexture=U):(mt.restoreDefaultFramebuffer(),M._outputTexture=null),null===(X=mt._debugInsertMarker)||void 0===X||X.call(mt,`post process ${I[P].name} output`);if(t)break;const L=M.apply();L&&(M.onBeforeRenderObservable.notifyObservers(L),this._prepareBuffers(),mt.bindBuffers(this._vertexBuffers,this._indexBuffer,L),mt.drawElementsType(0,0,6),M.onAfterRenderObservable.notifyObservers(L))}mt.setDepthBuffer(!0),mt.setDepthWrite(!0),mt.setAlphaMode(0)}dispose(){const t=this._vertexBuffers[I.e.PositionKind];t&&(t.dispose(),this._vertexBuffers[I.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12493:(t,U,y)=>{y.d(U,{d:()=>X});var I=y(12496),r=y(12386);class Y{set opaqueSortCompareFn(t){this._opaqueSortCompareFn=t||Y.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(t){this._alphaTestSortCompareFn=t||Y.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(t){this._transparentSortCompareFn=t||Y.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(t,U){let y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=t,this._opaqueSubMeshes=new I.e(256),this._transparentSubMeshes=new I.e(256),this._alphaTestSubMeshes=new I.e(256),this._depthOnlySubMeshes=new I.e(256),this._particleSystems=new I.e(256),this._spriteManagers=new I.e(256),this._empty=!0,this._edgesRenderers=new I.d(16),this._scene=U,this.opaqueSortCompareFn=y,this.alphaTestSortCompareFn=r,this.transparentSortCompareFn=Y}render(t,U,y,I){if(t)return void t(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const r=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(r.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),r.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const Y=r.getStencilBuffer();if(r.setStencilBuffer(!1),U&&this._renderSprites(),y&&this._renderParticles(I),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(r.setStencilBuffer(Y),this._scene.useOrderIndependentTransparency){const t=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);t.length&&this._renderTransparent(t)}else this._renderTransparent(this._transparentSubMeshes);r.setAlphaMode(0)}if(r.setStencilBuffer(!1),this._edgesRenderers.length){for(let t=0;t<this._edgesRenderers.length;t++)this._edgesRenderers.data[t].render();r.setAlphaMode(0)}r.setStencilBuffer(Y)}_renderOpaqueSorted(t){Y._RenderSorted(t,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(t){Y._RenderSorted(t,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(t){Y._RenderSorted(t,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(t,U,y,I){let mt,X=0;const P=y?y.globalPosition:Y._ZeroVector;if(I)for(;X<t.length;X++)mt=t.data[X],mt._alphaIndex=mt.getMesh().alphaIndex,mt._distanceToCamera=r.DU.Distance(mt.getBoundingInfo().boundingSphere.centerWorld,P);const G=t.length===t.data.length?t.data:t.data.slice(0,t.length);U&&G.sort(U);const M=G[0].getMesh().St();for(X=0;X<G.length;X++)if(mt=G[X],!M._activeMeshesFrozenButKeepClipping||mt.isInFrustum(M._frustumPlanes)){if(I){const t=mt.vt();if(t&&t.needDepthPrePass){const U=t.St().getEngine();U.setColorWrite(!1),U.setAlphaMode(0),mt.render(!1),U.setColorWrite(!0)}}mt.render(I)}}static defaultTransparentSortCompare(t,U){return t._alphaIndex>U._alphaIndex?1:t._alphaIndex<U._alphaIndex?-1:Y.backToFrontSortCompare(t,U)}static backToFrontSortCompare(t,U){return t._distanceToCamera<U._distanceToCamera?1:t._distanceToCamera>U._distanceToCamera?-1:0}static frontToBackSortCompare(t,U){return t._distanceToCamera<U._distanceToCamera?-1:t._distanceToCamera>U._distanceToCamera?1:0}static PainterSortCompare(t,U){const y=t.getMesh(),I=U.getMesh();return y.material&&I.material?y.material.uniqueId-I.material.uniqueId:y.uniqueId-I.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(t,U,y){void 0===U&&(U=t.getMesh()),void 0===y&&(y=t.vt()),null!==y&&void 0!==y&&(y.needAlphaBlendingForMesh(U)?this._transparentSubMeshes.push(t):y.needAlphaTestingForMesh(U)?(y.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._alphaTestSubMeshes.push(t)):(y.needDepthPrePass&&this._depthOnlySubMeshes.push(t),this._opaqueSubMeshes.push(t)),U._renderingGroup=this,U._edgesRenderer&&U.isEnabled()&&U.isVisible&&U._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(U._edgesRenderer),this._empty=!1)}dispatchSprites(t){this._spriteManagers.push(t),this._empty=!1}dispatchParticles(t){this._particleSystems.push(t),this._empty=!1}_renderParticles(t){if(0===this._particleSystems.length)return;const U=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let y=0;y<this._particleSystems.length;y++){const I=this._particleSystems.data[y];if(0===(U&&U.layerMask&I.layerMask))continue;const r=I.my;r.position&&t&&-1===t.indexOf(r)||this._scene._activeParticles.addCount(I.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const t=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let U=0;U<this._spriteManagers.length;U++){const y=this._spriteManagers.data[U];0!==(t&&t.layerMask&y.layerMask)&&y.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}Y._ZeroVector=r.DU.Zero();class mt{}class X{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(t){t!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=t,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const t of this._scene.meshes)if(t.BX)for(const U of t.BX)U._wasDispatched=!1;if(this._scene.spriteManagers)for(const t of this._scene.spriteManagers)t._wasDispatched=!1;for(const t of this._scene.mQ)t._wasDispatched=!1}constructor(t){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new mt,this._maintainStateBetweenFrames=!1,this._scene=t;for(let U=X.MIN_RENDERINGGROUPS;U<X.MAX_RENDERINGGROUPS;U++)this._autoClearDepthStencil[U]={gX:!0,depth:!0,EX:!0}}getRenderingGroup(t){const U=t||0;return this._prepareRenderingGroup(U),this._renderingGroups[U]}_clearDepthStencilBuffer(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,t,U),this._depthStencilBufferAlreadyCleaned=!0)}render(t,U,y,I){const r=this._renderingGroupInfo;if(r.gU=this._scene,r.camera=this._scene.activeCamera,r.renderingManager=this,this._scene.spriteManagers&&I)for(let Y=0;Y<this._scene.spriteManagers.length;Y++){const t=this._scene.spriteManagers[Y];this.dispatchSprites(t)}for(let Y=X.MIN_RENDERINGGROUPS;Y<X.MAX_RENDERINGGROUPS;Y++){this._depthStencilBufferAlreadyCleaned=Y===X.MIN_RENDERINGGROUPS;const mt=this._renderingGroups[Y];if(!mt||mt._empty)continue;const P=1<<Y;if(r.renderingGroupId=Y,this._scene.onBeforeRenderingGroupObservable.notifyObservers(r,P),X.AUTOCLEAR){const t=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(Y):this._autoClearDepthStencil[Y];t&&t.gX&&this._clearDepthStencilBuffer(t.depth,t.EX)}for(const t of this._scene._beforeRenderingGroupDrawStage)t.action(Y);mt.render(t,I,y,U);for(const t of this._scene._afterRenderingGroupDrawStage)t.action(Y);this._scene.onAfterRenderingGroupObservable.notifyObservers(r,P)}}reset(){if(!this.maintainStateBetweenFrames)for(let t=X.MIN_RENDERINGGROUPS;t<X.MAX_RENDERINGGROUPS;t++){const U=this._renderingGroups[t];U&&U.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let t=X.MIN_RENDERINGGROUPS;t<X.MAX_RENDERINGGROUPS;t++){const U=this._renderingGroups[t];U&&U.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let t=X.MIN_RENDERINGGROUPS;t<X.MAX_RENDERINGGROUPS;t++){const U=this._renderingGroups[t];U&&U.dispose()}}_prepareRenderingGroup(t){void 0===this._renderingGroups[t]&&(this._renderingGroups[t]=new Y(t,this._scene,this._customOpaqueSortCompareFn[t],this._customAlphaTestSortCompareFn[t],this._customTransparentSortCompareFn[t]))}dispatchSprites(t){this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatchSprites(t))}dispatchParticles(t){this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatchParticles(t))}dispatch(t,U,y){void 0===U&&(U=t.getMesh()),this.maintainStateBetweenFrames&&t._wasDispatched||(t._wasDispatched=!0,this.getRenderingGroup(U.renderingGroupId).dispatch(t,U,y))}setRenderingOrder(t){let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[t]=U,this._customAlphaTestSortCompareFn[t]=y,this._customTransparentSortCompareFn[t]=I,this._renderingGroups[t]){const U=this._renderingGroups[t];U.opaqueSortCompareFn=this._customOpaqueSortCompareFn[t],U.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[t],U.transparentSortCompareFn=this._customTransparentSortCompareFn[t]}}setRenderingAutoClearDepthStencil(t,U){let y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],I=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[t]={gX:U,depth:y,EX:I}}getAutoClearDepthStencilSetup(t){return this._autoClearDepthStencil[t]}}X.MAX_RENDERINGGROUPS=4,X.MIN_RENDERINGGROUPS=0,X.AUTOCLEAR=!0}}]);