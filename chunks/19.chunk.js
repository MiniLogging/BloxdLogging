"use strict";(self["6xhfpmwgjr5"]=self["6xhfpmwgjr5"]||[]).push([[19],{12489:(P,a,R)=>{R.d(a,{e:()=>p,i:()=>j});var S=R(12497),A=R(12248),Z=R(12500);class p{get U(){return this._isDisposed}constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Z=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],j=arguments.length>6&&void 0!==arguments[6]&&arguments[6],U=arguments.length>7?arguments[7]:void 0,Q=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,P&&P.GP?this._engine=P.GP().getEngine():this._engine=P,this._updatable=R,this._instanced=p,this._divisor=U||1,this._label=Q,a instanceof S.b?(this._data=null,this._buffer=a):(this._data=a,this._buffer=null),this.byteStride=j?A:A*Float32Array.BYTES_PER_ELEMENT,Z||this.create()}createVertexBuffer(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6?arguments[6]:void 0;const U=Z?a:a*Float32Array.BYTES_PER_ELEMENT,Q=S?Z?S:S*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new j(this._engine,this,P,this._updatable,!0,Q,void 0===A?this._instanced:A,U,R,void 0,void 0,!0,this._divisor||p)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!P&&this._buffer||(P=P||this._data,P&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,P),this._data=P):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(P,this._label),this._data=P):this._buffer=this._engine.createVertexBuffer(P,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.QR>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.QR,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.QR,void 0,this._label));A.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(P){this.create(P)}updateDirectly(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,P,S?a:a*Float32Array.BYTES_PER_ELEMENT,R?R*this.byteStride:void 0),this._data=0===a&&void 0===R?P:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class j{get U(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(P){const a=0!=P;this._instanceDivisor=P,a!==this._instanced&&(this._instanced=a,this._computeHashCode())}get _maxVerticesCount(){const P=this.getData();return P?Array.isArray(P)?P.length/(this.byteStride/4)-this.byteOffset/4:(P.byteLength-this.byteOffset)/this.byteStride:0}constructor(P,a,R,S,A,U,Q,h,l,V){let f=arguments.length>10&&void 0!==arguments[10]&&arguments[10],O=arguments.length>11&&void 0!==arguments[11]&&arguments[11],q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,y=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let t=!1;if(this.fa=P,"object"===typeof S&&null!==S?(t=S.updatable??!1,A=S.postponeInternalCreation,U=S.stride,Q=S.instanced,h=S.offset,l=S.size,V=S.type,f=S.normalized??!1,O=S.useBytes??!1,q=S.divisor??1,y=S.takeBufferOwnership??!1,this._label=S.label):t=!!S,a instanceof p?(this._buffer=a,this._ownsBuffer=y):(this._buffer=new p(P,a,t,U,A,Q,O,q,this._label),this._ownsBuffer=!0),this.uniqueId=j._Counter++,this._kind=R,void 0===V){const P=this.getData();this.type=P?j.GetDataType(P):j.FLOAT}else this.type=V;const W=(0,Z.n)(this.type);O?(this._size=l||(U?U/W:j.DeduceStride(R)),this.byteStride=U||this._buffer.byteStride||this._size*W,this.byteOffset=h||0):(this._size=l||U||j.DeduceStride(R),this.byteStride=U?U*W:this._buffer.byteStride||this._size*W,this.byteOffset=(h||0)*W),this.normalized=f,this._instanced=void 0!==Q&&Q,this._instanceDivisor=Q?q:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var P;null===(P=this._buffer)||void 0===P||P._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(P,a){const R=this.getData();return R?(0,Z.l)(R,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,P,a):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,Z.n)(this.type)}getOffset(){return this.byteOffset/(0,Z.n)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,Z.n)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(P){this._buffer.create(P),this._alignBuffer()}update(P){this._buffer.update(P),this._alignBuffer()}updateDirectly(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(P,a,void 0,R),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(P,a){(0,Z.k)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,P,this.normalized,((P,R)=>{for(let S=0;S<this._size;S++)a(P[S],R+S)}))}_alignBuffer(){}static DeduceStride(P){switch(P){case j.UVKind:case j.UV2Kind:case j.UV3Kind:case j.UV4Kind:case j.UV5Kind:case j.UV6Kind:return 2;case j.NormalKind:case j.PositionKind:return 3;case j.ColorKind:case j.ColorInstanceKind:case j.MatricesIndicesKind:case j.MatricesIndicesExtraKind:case j.MatricesWeightsKind:case j.MatricesWeightsExtraKind:case j.TangentKind:return 4;default:throw new Error("Invalid kind '"+P+"'")}}static GetDataType(P){return P instanceof Int8Array?j.BYTE:P instanceof Uint8Array?j.UNSIGNED_BYTE:P instanceof Int16Array?j.SHORT:P instanceof Uint16Array?j.UNSIGNED_SHORT:P instanceof Int32Array?j.INT:P instanceof Uint32Array?j.UNSIGNED_INT:j.FLOAT}static GetTypeByteLength(P){return(0,Z.n)(P)}static ForEach(P,a,R,S,A,p,j,U){(0,Z.k)(P,a,R,S,A,p,j,((P,a)=>{for(let R=0;R<S;R++)U(P[R],a+R)}))}static GetFloatData(P,a,R,S,A,p,j,U){return(0,Z.l)(P,a,R,S,A,p,j,U)}}j._Counter=0,j.BYTE=5120,j.UNSIGNED_BYTE=5121,j.SHORT=5122,j.UNSIGNED_SHORT=5123,j.INT=5124,j.UNSIGNED_INT=5125,j.FLOAT=5126,j.PositionKind="position",j.NormalKind="normal",j.TangentKind="tangent",j.UVKind="uv",j.UV2Kind="uv2",j.UV3Kind="uv3",j.UV4Kind="uv4",j.UV5Kind="uv5",j.UV6Kind="uv6",j.ColorKind="color",j.ColorInstanceKind="instanceColor",j.MatricesIndicesKind="matricesIndices",j.MatricesWeightsKind="matricesWeights",j.MatricesIndicesExtraKind="matricesIndicesExtra",j.MatricesWeightsExtraKind="matricesWeightsExtra"},12500:(P,a,R)=>{R.d(a,{d:()=>V,g:()=>l,k:()=>U,l:()=>Q,n:()=>p,o:()=>j,p:()=>h});var S=R(12248);function A(P,a,R,S){switch(a){case 5120:{let a=P.getInt8(R);return S&&(a=Math.max(a/127,-1)),a}case 5121:{let a=P.getUint8(R);return S&&(a/=255),a}case 5122:{let a=P.getInt16(R,!0);return S&&(a=Math.max(a/32767,-1)),a}case 5123:{let a=P.getUint16(R,!0);return S&&(a/=65535),a}case 5124:return P.getInt32(R,!0);case 5125:return P.getUint32(R,!0);case 5126:return P.getFloat32(R,!0);default:throw new Error(`Invalid component type ${a}`)}}function Z(P,a,R,S,A){switch(a){case 5120:S&&(A=Math.round(127*A)),P.setInt8(R,A);break;case 5121:S&&(A=Math.round(255*A)),P.setUint8(R,A);break;case 5122:S&&(A=Math.round(32767*A)),P.setInt16(R,A,!0);break;case 5123:S&&(A=Math.round(65535*A)),P.setUint16(R,A,!0);break;case 5124:P.setInt32(R,A,!0);break;case 5125:P.setUint32(R,A,!0);break;case 5126:P.setFloat32(R,A,!0);break;default:throw new Error(`Invalid component type ${a}`)}}function p(P){switch(P){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${P}'`)}}function j(P){switch(P){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${P}'`)}}function U(P,a,R,S,j,U,Q,h){const l=new Array(S),V=new Array(S);if(P instanceof Array){let A=a/4;const Z=R/4;for(let a=0;a<U;a+=S){for(let a=0;a<S;a++)l[a]=V[a]=P[A+a];h(V,a);for(let a=0;a<S;a++)l[a]!==V[a]&&(P[A+a]=V[a]);A+=Z}}else{const f=ArrayBuffer.isView(P)?new DataView(P.buffer,P.byteOffset,P.byteLength):new DataView(P),O=p(j);for(let P=0;P<U;P+=S){for(let P=0,R=a;P<S;P++,R+=O)l[P]=V[P]=A(f,j,R,Q);h(V,P);for(let P=0,R=a;P<S;P++,R+=O)l[P]!==V[P]&&Z(f,j,R,Q,V[P]);a+=R}}}function Q(P,a,R,A,Z,j,Q,h){const l=a*p(R),V=Q*a;if(5126!==R||Z!==l){const S=new Float32Array(V);return U(P,A,Z,a,R,V,j,((P,R)=>{for(let A=0;A<a;A++)S[R+A]=P[A]})),S}if(!(P instanceof Array||P instanceof Float32Array)||0!==A||P.length!==V){if(P instanceof Array){const a=A/4;return P.slice(a,a+V)}if(P instanceof ArrayBuffer)return new Float32Array(P,A,V);{const a=P.byteOffset+A;return 0!==(3&a)&&(S.c.Warn("Float array must be aligned to 4-bytes border"),h=!0),h?new Float32Array(P.buffer.slice(a,a+V*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(P.buffer,a,V)}}return h?P.slice():P}function h(P,a,R,A,Z,Q,h,l){const V=p(R),f=j(R),O=h*a;if(Array.isArray(P)){if(0!==(3&A)||0!==(3&Z))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const S=A/4,p=Z/4;if(S+(h-1)*p+a>P.length)throw new Error("Last accessed index is out of bounds.");if(p<a)throw new Error("Data stride cannot be smaller than the component size.");if(p!==a){const S=new f(O);return U(P,A,Z,a,R,O,Q,((P,R)=>{for(let A=0;A<a;A++)S[R+A]=P[A]})),S}return new f(P.slice(S,S+O))}let q,y=A;P instanceof ArrayBuffer?q=P:(q=P.buffer,y+=P.byteOffset);if(y+(h-1)*Z+a*V>q.byteLength)throw new Error("Last accessed byte is out of bounds.");const t=a*V;if(Z<t)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(Z!==t){const P=new f(O);return U(q,y,Z,a,R,O,Q,((R,S)=>{for(let A=0;A<a;A++)P[S+A]=R[A]})),P}return 1!==V&&0!==(y&V-1)&&(S.c.Warn("Array must be aligned to border of element size. Data will be copied."),l=!0),l?new f(q.slice(y,y+O*V)):new f(q,y,O)}function l(P,a,R,A,Z,j,Q,h){const l=a*p(R),V=Q*a;if(h.length!==V)throw new Error("Output length is not valid");if(5126===R&&Z===l)if(P instanceof Array){const a=A/4;h.set(P,a)}else if(P instanceof ArrayBuffer){const a=new Float32Array(P,A,V);h.set(a)}else{const a=P.byteOffset+A;if(0!==(3&a))return S.c.Warn("Float array must be aligned to 4-bytes border"),void h.set(new Float32Array(P.buffer.slice(a,a+V*Float32Array.BYTES_PER_ELEMENT)));const R=new Float32Array(P.buffer,a,V);h.set(R)}else U(P,A,Z,a,R,V,j,((P,R)=>{for(let S=0;S<a;S++)h[R+S]=P[S]}))}function V(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(P)){for(let A=0;A<a;A++)if(P[R+A]-S>65535)return!0;return!1}return 4===P.BYTES_PER_ELEMENT}},12497:(P,a,R)=>{R.d(a,{b:()=>S});class S{get underlyingResource(){return null}constructor(){this.references=0,this.QR=0,this.is32Bits=!1,this.uniqueId=S._Counter++}}S._Counter=0},12538:(P,a,R)=>{R.d(a,{d:()=>A});var S=R(12318);class A{static GetEffect(P){return void 0===P.getPipelineContext?P.effect:P}constructor(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=P.createDrawContext(),a&&(this.materialContext=P.createMaterialContext())}setEffect(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var S;(this.effect=P,void 0!==a&&(this.defines=a),R)&&(null===(S=this.drawContext)||void 0===S||S.reset())}dispose(){var P;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const P=this.effect;a?P.dispose():S.b.SetImmediate((()=>{P.getEngine().onEndFrameObservable.addOnce((()=>{P.dispose()}))})),this.effect=null}null===(P=this.drawContext)||void 0===P||P.dispose()}}},12606:(P,a,R)=>{R.d(a,{b:()=>A});var S=R(12465);class A{static GetPlanes(P){const a=[];for(let R=0;R<6;R++)a.push(new S.d(0,0,0,0));return A.GetPlanesToRef(P,a),a}static GetNearPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]+R[2],a.normal.y=R[7]+R[6],a.normal.z=R[11]+R[10],a.d=R[15]+R[14],a.normalize()}static GetFarPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]-R[2],a.normal.y=R[7]-R[6],a.normal.z=R[11]-R[10],a.d=R[15]-R[14],a.normalize()}static GetLeftPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]+R[0],a.normal.y=R[7]+R[4],a.normal.z=R[11]+R[8],a.d=R[15]+R[12],a.normalize()}static GetRightPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]-R[0],a.normal.y=R[7]-R[4],a.normal.z=R[11]-R[8],a.d=R[15]-R[12],a.normalize()}static GetTopPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]-R[1],a.normal.y=R[7]-R[5],a.normal.z=R[11]-R[9],a.d=R[15]-R[13],a.normalize()}static GetBottomPlaneToRef(P,a){const R=P.m;a.normal.x=R[3]+R[1],a.normal.y=R[7]+R[5],a.normal.z=R[11]+R[9],a.d=R[15]+R[13],a.normalize()}static GetPlanesToRef(P,a){A.GetNearPlaneToRef(P,a[0]),A.GetFarPlaneToRef(P,a[1]),A.GetLeftPlaneToRef(P,a[2]),A.GetRightPlaneToRef(P,a[3]),A.GetTopPlaneToRef(P,a[4]),A.GetBottomPlaneToRef(P,a[5])}static IsPointInFrustum(P,a){for(let R=0;R<6;R++)if(a[R].dotCoordinate(P)<0)return!1;return!0}}},12619:(P,a,R)=>{R.d(a,{e:()=>A});var S=R(12261);class A{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(P,a){A.Enabled&&(this._current+=P,a&&this._fetchResult())}beginMonitoring(){A.Enabled&&(this._startMonitoringTime=S.c.Now)}endMonitoring(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!A.Enabled)return;P&&this.fetchNewFrame();const a=S.c.Now;this._current=a-this._startMonitoringTime,P&&this._fetchResult()}Kp(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const P=S.c.Now;P-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=P,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}A.Enabled=!0},12515:(P,a,R)=>{R.d(a,{c:()=>A,g:()=>S});class S{constructor(P){this.length=0,this.data=new Array(P),this._id=S._GlobalId++}push(P){this.data[this.length++]=P,this.length>this.data.length&&(this.data.length*=2)}forEach(P){for(let a=0;a<this.length;a++)P(this.data[a])}sort(P){this.data.sort(P)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(P){if(0!==P.length){this.length+P.length>this.data.length&&(this.data.length=2*(this.length+P.length));for(let a=0;a<P.length;a++)this.data[this.length++]=(P.data||P)[a]}}indexOf(P){const a=this.data.indexOf(P);return a>=this.length?-1:a}contains(P){return-1!==this.indexOf(P)}}S._GlobalId=0;class A extends S{constructor(){super(...arguments),this._duplicateId=0}push(P){super.push(P),P.__smartArrayFlags||(P.__smartArrayFlags={}),P.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(P){return(!P.__smartArrayFlags||P.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(P),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(P){if(0!==P.length){this.length+P.length>this.data.length&&(this.data.length=2*(this.length+P.length));for(let a=0;a<P.length;a++){const R=(P.data||P)[a];this.pushNoDuplicate(R)}}}}},12483:(P,a,R)=>{R.d(a,{d:()=>Z});var S=R(12489),A=R(12232);class Z{constructor(P){this._vertexBuffers={},this.onBeforeRenderObservable=new A.b,this._scene=P}_prepareBuffers(){if(this._vertexBuffers[S.i.PositionKind])return;const P=[];P.push(1,1),P.push(-1,1),P.push(-1,-1),P.push(1,-1),this._vertexBuffers[S.i.PositionKind]=new S.i(this._scene.getEngine(),P,S.i.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const P=[];P.push(0),P.push(1),P.push(2),P.push(0),P.push(2),P.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(P)}_rebuild(){const P=this._vertexBuffers[S.i.PositionKind];P&&(P._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const R=this._scene.activeCamera;return!!R&&(a=a||R._postProcesses.filter((P=>null!=P)),!(!a||0===a.length||!this._scene.postProcessesEnabled)&&(a[0].activate(R,P,null!==a&&void 0!==a),!0))}directRender(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Z=arguments.length>5&&void 0!==arguments[5]&&arguments[5],p=arguments.length>6&&void 0!==arguments[6]?arguments[6]:P.length;const j=this._scene.getEngine();for(let Q=0;Q<p;Q++){var U;if(Q<P.length-1)P[Q+1].activate(this._scene.activeCamera||this._scene,null===a||void 0===a?void 0:a.texture);else a?j.bindFramebuffer(a,S,void 0,void 0,R,A):Z||j.restoreDefaultFramebuffer(),null===(U=j._debugInsertMarker)||void 0===U||U.call(j,`post process ${P[Q].name} output`);const p=P[Q],h=p.apply();h&&(p.onBeforeRenderObservable.notifyObservers(h),this._prepareBuffers(),j.bindBuffers(this._vertexBuffers,this._indexBuffer,h),j.drawElementsType(0,0,6),p.onAfterRenderObservable.notifyObservers(h))}j.setDepthBuffer(!0),j.setDepthWrite(!0)}_finalizeFrame(P,a,R,S){let A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Z=this._scene.activeCamera;if(!Z)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(S=S||Z._postProcesses.filter((P=>null!=P))).length||!this._scene.postProcessesEnabled)return;const p=this._scene.getEngine();for(let U=0,Q=S.length;U<Q;U++){const h=S[U];var j;if(U<Q-1)h._outputTexture=S[U+1].activate(Z,null===a||void 0===a?void 0:a.texture);else a?(p.bindFramebuffer(a,R,void 0,void 0,A),h._outputTexture=a):(p.restoreDefaultFramebuffer(),h._outputTexture=null),null===(j=p._debugInsertMarker)||void 0===j||j.call(p,`post process ${S[U].name} output`);if(P)break;const l=h.apply();l&&(h.onBeforeRenderObservable.notifyObservers(l),this._prepareBuffers(),p.bindBuffers(this._vertexBuffers,this._indexBuffer,l),p.drawElementsType(0,0,6),h.onAfterRenderObservable.notifyObservers(l))}p.setDepthBuffer(!0),p.setDepthWrite(!0),p.setAlphaMode(0)}dispose(){const P=this._vertexBuffers[S.i.PositionKind];P&&(P.dispose(),this._vertexBuffers[S.i.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12506:(P,a,R)=>{R.d(a,{d:()=>j});var S=R(12515),A=R(12415);class Z{set opaqueSortCompareFn(P){this._opaqueSortCompareFn=P||Z.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(P){this._alphaTestSortCompareFn=P||Z.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(P){this._transparentSortCompareFn=P||Z.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=P,this._opaqueSubMeshes=new S.g(256),this._transparentSubMeshes=new S.g(256),this._alphaTestSubMeshes=new S.g(256),this._depthOnlySubMeshes=new S.g(256),this._particleSystems=new S.g(256),this._spriteManagers=new S.g(256),this._empty=!0,this._edgesRenderers=new S.c(16),this._scene=a,this.opaqueSortCompareFn=R,this.alphaTestSortCompareFn=A,this.transparentSortCompareFn=Z}render(P,a,R,S){if(P)return void P(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const A=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(A.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),A.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const Z=A.getStencilBuffer();if(A.setStencilBuffer(!1),a&&this._renderSprites(),R&&this._renderParticles(S),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(A.setStencilBuffer(Z),this._scene.useOrderIndependentTransparency){const P=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);P.length&&this._renderTransparent(P)}else this._renderTransparent(this._transparentSubMeshes);A.setAlphaMode(0)}if(A.setStencilBuffer(!1),this._edgesRenderers.length){for(let P=0;P<this._edgesRenderers.length;P++)this._edgesRenderers.data[P].render();A.setAlphaMode(0)}A.setStencilBuffer(Z)}_renderOpaqueSorted(P){Z._RenderSorted(P,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(P){Z._RenderSorted(P,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(P){Z._RenderSorted(P,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(P,a,R,S){let p,j=0;const U=R?R.globalPosition:Z._ZeroVector;if(S)for(;j<P.length;j++)p=P.data[j],p._alphaIndex=p.getMesh().alphaIndex,p._distanceToCamera=A.Oa.Distance(p.getBoundingInfo().boundingSphere.centerWorld,U);const Q=P.length===P.data.length?P.data:P.data.slice(0,P.length);a&&Q.sort(a);const h=Q[0].getMesh().GP();for(j=0;j<Q.length;j++)if(p=Q[j],!h._activeMeshesFrozenButKeepClipping||p.isInFrustum(h._frustumPlanes)){if(S){const P=p.BP();if(P&&P.needDepthPrePass){const a=P.GP().getEngine();a.setColorWrite(!1),a.setAlphaMode(0),p.render(!1),a.setColorWrite(!0)}}p.render(S)}}static defaultTransparentSortCompare(P,a){return P._alphaIndex>a._alphaIndex?1:P._alphaIndex<a._alphaIndex?-1:Z.backToFrontSortCompare(P,a)}static backToFrontSortCompare(P,a){return P._distanceToCamera<a._distanceToCamera?1:P._distanceToCamera>a._distanceToCamera?-1:0}static frontToBackSortCompare(P,a){return P._distanceToCamera<a._distanceToCamera?-1:P._distanceToCamera>a._distanceToCamera?1:0}static PainterSortCompare(P,a){const R=P.getMesh(),S=a.getMesh();return R.material&&S.material?R.material.uniqueId-S.material.uniqueId:R.uniqueId-S.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(P,a,R){void 0===a&&(a=P.getMesh()),void 0===R&&(R=P.BP()),null!==R&&void 0!==R&&(R.needAlphaBlendingForMesh(a)?this._transparentSubMeshes.push(P):R.needAlphaTestingForMesh(a)?(R.needDepthPrePass&&this._depthOnlySubMeshes.push(P),this._alphaTestSubMeshes.push(P)):(R.needDepthPrePass&&this._depthOnlySubMeshes.push(P),this._opaqueSubMeshes.push(P)),a._renderingGroup=this,a._edgesRenderer&&a.isEnabled()&&a.isVisible&&a._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(a._edgesRenderer),this._empty=!1)}dispatchSprites(P){this._spriteManagers.push(P),this._empty=!1}dispatchParticles(P){this._particleSystems.push(P),this._empty=!1}_renderParticles(P){if(0===this._particleSystems.length)return;const a=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let R=0;R<this._particleSystems.length;R++){const S=this._particleSystems.data[R];if(0===(a&&a.layerMask&S.layerMask))continue;const A=S.Sa;A.position&&P&&-1===P.indexOf(A)||this._scene._activeParticles.addCount(S.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const P=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let a=0;a<this._spriteManagers.length;a++){const R=this._spriteManagers.data[a];0!==(P&&P.layerMask&R.layerMask)&&R.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}Z._ZeroVector=A.Oa.Zero();class p{}class j{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(P){P!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=P,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const P of this._scene.meshes)if(P.Zj)for(const a of P.Zj)a._wasDispatched=!1;if(this._scene.spriteManagers)for(const P of this._scene.spriteManagers)P._wasDispatched=!1;for(const P of this._scene.ZV)P._wasDispatched=!1}constructor(P){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new p,this._maintainStateBetweenFrames=!1,this._scene=P;for(let a=j.MIN_RENDERINGGROUPS;a<j.MAX_RENDERINGGROUPS;a++)this._autoClearDepthStencil[a]={Aj:!0,depth:!0,gp:!0}}getRenderingGroup(P){const a=P||0;return this._prepareRenderingGroup(a),this._renderingGroups[a]}_clearDepthStencilBuffer(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,P,a),this._depthStencilBufferAlreadyCleaned=!0)}render(P,a,R,S){const A=this._renderingGroupInfo;if(A.ya=this._scene,A.camera=this._scene.activeCamera,A.renderingManager=this,this._scene.spriteManagers&&S)for(let Z=0;Z<this._scene.spriteManagers.length;Z++){const P=this._scene.spriteManagers[Z];this.dispatchSprites(P)}for(let Z=j.MIN_RENDERINGGROUPS;Z<j.MAX_RENDERINGGROUPS;Z++){this._depthStencilBufferAlreadyCleaned=Z===j.MIN_RENDERINGGROUPS;const p=this._renderingGroups[Z];if(!p||p._empty)continue;const U=1<<Z;if(A.renderingGroupId=Z,this._scene.onBeforeRenderingGroupObservable.notifyObservers(A,U),j.AUTOCLEAR){const P=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(Z):this._autoClearDepthStencil[Z];P&&P.Aj&&this._clearDepthStencilBuffer(P.depth,P.gp)}for(const P of this._scene._beforeRenderingGroupDrawStage)P.action(Z);p.render(P,S,R,a);for(const P of this._scene._afterRenderingGroupDrawStage)P.action(Z);this._scene.onAfterRenderingGroupObservable.notifyObservers(A,U)}}reset(){if(!this.maintainStateBetweenFrames)for(let P=j.MIN_RENDERINGGROUPS;P<j.MAX_RENDERINGGROUPS;P++){const a=this._renderingGroups[P];a&&a.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let P=j.MIN_RENDERINGGROUPS;P<j.MAX_RENDERINGGROUPS;P++){const a=this._renderingGroups[P];a&&a.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let P=j.MIN_RENDERINGGROUPS;P<j.MAX_RENDERINGGROUPS;P++){const a=this._renderingGroups[P];a&&a.dispose()}}_prepareRenderingGroup(P){void 0===this._renderingGroups[P]&&(this._renderingGroups[P]=new Z(P,this._scene,this._customOpaqueSortCompareFn[P],this._customAlphaTestSortCompareFn[P],this._customTransparentSortCompareFn[P]))}dispatchSprites(P){this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(P.renderingGroupId).dispatchSprites(P))}dispatchParticles(P){this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(P.renderingGroupId).dispatchParticles(P))}dispatch(P,a,R){void 0===a&&(a=P.getMesh()),this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(a.renderingGroupId).dispatch(P,a,R))}setRenderingOrder(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[P]=a,this._customAlphaTestSortCompareFn[P]=R,this._customTransparentSortCompareFn[P]=S,this._renderingGroups[P]){const a=this._renderingGroups[P];a.opaqueSortCompareFn=this._customOpaqueSortCompareFn[P],a.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[P],a.transparentSortCompareFn=this._customTransparentSortCompareFn[P]}}setRenderingAutoClearDepthStencil(P,a){let R=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[P]={Aj:a,depth:R,gp:S}}getAutoClearDepthStencilSetup(P){return this._autoClearDepthStencil[P]}}j.MAX_RENDERINGGROUPS=4,j.MIN_RENDERINGGROUPS=0,j.AUTOCLEAR=!0}}]);