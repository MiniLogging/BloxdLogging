"use strict";(self.zjjkhojdx1=self.zjjkhojdx1||[]).push([[19],{11308:(k,h,o)=>{o.d(h,{d:()=>Y,g:()=>J});var x=o(11314),I=o(11098),q=o(11323);class Y{get l(){return this._isDisposed}constructor(k,h,o){let I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],G=arguments.length>7?arguments[7]:void 0,l=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,k&&k.ik?this._engine=k.ik().getEngine():this._engine=k,this._updatable=o,this._instanced=Y,this._divisor=G||1,this._label=l,h instanceof x.d?(this._data=null,this._buffer=h):(this._data=h,this._buffer=null),this.byteStride=J?I:I*Float32Array.BYTES_PER_ELEMENT,q||this.create()}createVertexBuffer(k,h,o,x,I){let q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6?arguments[6]:void 0;const G=q?h:h*Float32Array.BYTES_PER_ELEMENT,l=x?q?x:x*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new J(this._engine,this,k,this._updatable,!0,l,void 0===I?this._instanced:I,G,o,void 0,void 0,!0,this._divisor||Y)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!k&&this._buffer||(k=k||this._data,k&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,k),this._data=k):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(k,this._label),this._data=k):this._buffer=this._engine.createVertexBuffer(k,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.oo>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.oo,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.oo,void 0,this._label));I.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(k){this.create(k)}updateDirectly(k,h,o){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,k,x?h:h*Float32Array.BYTES_PER_ELEMENT,o?o*this.byteStride:void 0),this._data=0===h&&void 0===o?k:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class J{get l(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(k){const h=0!=k;this._instanceDivisor=k,h!==this._instanced&&(this._instanced=h,this._computeHashCode())}get _maxVerticesCount(){const k=this.getData();return k?Array.isArray(k)?k.length/(this.byteStride/4)-this.byteOffset/4:(k.byteLength-this.byteOffset)/this.byteStride:0}constructor(k,h,o,x,I,G,l,A,K,a){let N=arguments.length>10&&void 0!==arguments[10]&&arguments[10],X=arguments.length>11&&void 0!==arguments[11]&&arguments[11],c=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,W=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let f=!1;if(this.bh=k,"object"===typeof x&&null!==x?(f=x.updatable??!1,I=x.postponeInternalCreation,G=x.stride,l=x.instanced,A=x.offset,K=x.size,a=x.type,N=x.normalized??!1,X=x.useBytes??!1,c=x.divisor??1,W=x.takeBufferOwnership??!1,this._label=x.label):f=!!x,h instanceof Y?(this._buffer=h,this._ownsBuffer=W):(this._buffer=new Y(k,h,f,G,I,l,X,c,this._label),this._ownsBuffer=!0),this.uniqueId=J._Counter++,this._kind=o,void 0===a){const k=this.getData();this.type=k?J.GetDataType(k):J.FLOAT}else this.type=a;const M=(0,q.j)(this.type);X?(this._size=K||(G?G/M:J.DeduceStride(o)),this.byteStride=G||this._buffer.byteStride||this._size*M,this.byteOffset=A||0):(this._size=K||G||J.DeduceStride(o),this.byteStride=G?G*M:this._buffer.byteStride||this._size*M,this.byteOffset=(A||0)*M),this.normalized=N,this._instanced=void 0!==l&&l,this._instanceDivisor=l?c:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var k;null===(k=this._buffer)||void 0===k||k._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(k,h){const o=this.getData();return o?(0,q.i)(o,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,k,h):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,q.j)(this.type)}getOffset(){return this.byteOffset/(0,q.j)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,q.j)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(k){this._buffer.create(k),this._alignBuffer()}update(k){this._buffer.update(k),this._alignBuffer()}updateDirectly(k,h){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(k,h,void 0,o),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(k,h){(0,q.g)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,k,this.normalized,((k,o)=>{for(let x=0;x<this._size;x++)h(k[x],o+x)}))}_alignBuffer(){}static DeduceStride(k){switch(k){case J.UVKind:case J.UV2Kind:case J.UV3Kind:case J.UV4Kind:case J.UV5Kind:case J.UV6Kind:return 2;case J.NormalKind:case J.PositionKind:return 3;case J.ColorKind:case J.ColorInstanceKind:case J.MatricesIndicesKind:case J.MatricesIndicesExtraKind:case J.MatricesWeightsKind:case J.MatricesWeightsExtraKind:case J.TangentKind:return 4;default:throw new Error("Invalid kind '"+k+"'")}}static GetDataType(k){return k instanceof Int8Array?J.BYTE:k instanceof Uint8Array?J.UNSIGNED_BYTE:k instanceof Int16Array?J.SHORT:k instanceof Uint16Array?J.UNSIGNED_SHORT:k instanceof Int32Array?J.INT:k instanceof Uint32Array?J.UNSIGNED_INT:J.FLOAT}static GetTypeByteLength(k){return(0,q.j)(k)}static ForEach(k,h,o,x,I,Y,J,G){(0,q.g)(k,h,o,x,I,Y,J,((k,h)=>{for(let o=0;o<x;o++)G(k[o],h+o)}))}static GetFloatData(k,h,o,x,I,Y,J,G){return(0,q.i)(k,h,o,x,I,Y,J,G)}}J._Counter=0,J.BYTE=5120,J.UNSIGNED_BYTE=5121,J.SHORT=5122,J.UNSIGNED_SHORT=5123,J.INT=5124,J.UNSIGNED_INT=5125,J.FLOAT=5126,J.PositionKind="position",J.NormalKind="normal",J.TangentKind="tangent",J.UVKind="uv",J.UV2Kind="uv2",J.UV3Kind="uv3",J.UV4Kind="uv4",J.UV5Kind="uv5",J.UV6Kind="uv6",J.ColorKind="color",J.ColorInstanceKind="instanceColor",J.MatricesIndicesKind="matricesIndices",J.MatricesWeightsKind="matricesWeights",J.MatricesIndicesExtraKind="matricesIndicesExtra",J.MatricesWeightsExtraKind="matricesWeightsExtra"},11323:(k,h,o)=>{o.d(h,{d:()=>a,e:()=>K,g:()=>G,i:()=>l,j:()=>Y,k:()=>J,m:()=>A});var x=o(11098);function I(k,h,o,x){switch(h){case 5120:{let h=k.getInt8(o);return x&&(h=Math.max(h/127,-1)),h}case 5121:{let h=k.getUint8(o);return x&&(h/=255),h}case 5122:{let h=k.getInt16(o,!0);return x&&(h=Math.max(h/32767,-1)),h}case 5123:{let h=k.getUint16(o,!0);return x&&(h/=65535),h}case 5124:return k.getInt32(o,!0);case 5125:return k.getUint32(o,!0);case 5126:return k.getFloat32(o,!0);default:throw new Error(`Invalid component type ${h}`)}}function q(k,h,o,x,I){switch(h){case 5120:x&&(I=Math.round(127*I)),k.setInt8(o,I);break;case 5121:x&&(I=Math.round(255*I)),k.setUint8(o,I);break;case 5122:x&&(I=Math.round(32767*I)),k.setInt16(o,I,!0);break;case 5123:x&&(I=Math.round(65535*I)),k.setUint16(o,I,!0);break;case 5124:k.setInt32(o,I,!0);break;case 5125:k.setUint32(o,I,!0);break;case 5126:k.setFloat32(o,I,!0);break;default:throw new Error(`Invalid component type ${h}`)}}function Y(k){switch(k){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${k}'`)}}function J(k){switch(k){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${k}'`)}}function G(k,h,o,x,J,G,l,A){const K=new Array(x),a=new Array(x);if(k instanceof Array){let I=h/4;const q=o/4;for(let h=0;h<G;h+=x){for(let h=0;h<x;h++)K[h]=a[h]=k[I+h];A(a,h);for(let h=0;h<x;h++)K[h]!==a[h]&&(k[I+h]=a[h]);I+=q}}else{const N=ArrayBuffer.isView(k)?new DataView(k.buffer,k.byteOffset,k.byteLength):new DataView(k),X=Y(J);for(let k=0;k<G;k+=x){for(let k=0,o=h;k<x;k++,o+=X)K[k]=a[k]=I(N,J,o,l);A(a,k);for(let k=0,o=h;k<x;k++,o+=X)K[k]!==a[k]&&q(N,J,o,l,a[k]);h+=o}}}function l(k,h,o,I,q,J,l,A){const K=h*Y(o),a=l*h;if(5126!==o||q!==K){const x=new Float32Array(a);return G(k,I,q,h,o,a,J,((k,o)=>{for(let I=0;I<h;I++)x[o+I]=k[I]})),x}if(!(k instanceof Array||k instanceof Float32Array)||0!==I||k.length!==a){if(k instanceof Array){const h=I/4;return k.slice(h,h+a)}if(k instanceof ArrayBuffer)return new Float32Array(k,I,a);{const h=k.byteOffset+I;return 0!==(3&h)&&(x.c.Warn("Float array must be aligned to 4-bytes border"),A=!0),A?new Float32Array(k.buffer.slice(h,h+a*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(k.buffer,h,a)}}return A?k.slice():k}function A(k,h,o,I,q,l,A,K){const a=Y(o),N=J(o),X=A*h;if(Array.isArray(k)){if(0!==(3&I)||0!==(3&q))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const x=I/4,Y=q/4;if(x+(A-1)*Y+h>k.length)throw new Error("Last accessed index is out of bounds.");if(Y<h)throw new Error("Data stride cannot be smaller than the component size.");if(Y!==h){const x=new N(X);return G(k,I,q,h,o,X,l,((k,o)=>{for(let I=0;I<h;I++)x[o+I]=k[I]})),x}return new N(k.slice(x,x+X))}let c,W=I;k instanceof ArrayBuffer?c=k:(c=k.buffer,W+=k.byteOffset);if(W+(A-1)*q+h*a>c.byteLength)throw new Error("Last accessed byte is out of bounds.");const f=h*a;if(q<f)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(q!==f){const k=new N(X);return G(c,W,q,h,o,X,l,((o,x)=>{for(let I=0;I<h;I++)k[x+I]=o[I]})),k}return 1!==a&&0!==(W&a-1)&&(x.c.Warn("Array must be aligned to border of element size. Data will be copied."),K=!0),K?new N(c.slice(W,W+X*a)):new N(c,W,X)}function K(k,h,o,I,q,J,l,A){const K=h*Y(o),a=l*h;if(A.length!==a)throw new Error("Output length is not valid");if(5126===o&&q===K)if(k instanceof Array){const h=I/4;A.set(k,h)}else if(k instanceof ArrayBuffer){const h=new Float32Array(k,I,a);A.set(h)}else{const h=k.byteOffset+I;if(0!==(3&h))return x.c.Warn("Float array must be aligned to 4-bytes border"),void A.set(new Float32Array(k.buffer.slice(h,h+a*Float32Array.BYTES_PER_ELEMENT)));const o=new Float32Array(k.buffer,h,a);A.set(o)}else G(k,I,q,h,o,a,J,((k,o)=>{for(let x=0;x<h;x++)A[o+x]=k[x]}))}function a(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(k)){for(let I=0;I<h;I++)if(k[o+I]-x>65535)return!0;return!1}return 4===k.BYTES_PER_ELEMENT}},11314:(k,h,o)=>{o.d(h,{d:()=>x});class x{get underlyingResource(){return null}constructor(){this.references=0,this.oo=0,this.is32Bits=!1,this.uniqueId=x._Counter++}}x._Counter=0},11356:(k,h,o)=>{o.d(h,{e:()=>I});var x=o(11145);class I{static GetEffect(k){return void 0===k.getPipelineContext?k.effect:k}constructor(k){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=k.createDrawContext(),h&&(this.materialContext=k.createMaterialContext())}setEffect(k,h){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var x;(this.effect=k,void 0!==h&&(this.defines=h),o)&&(null===(x=this.drawContext)||void 0===x||x.reset())}dispose(){var k;let h=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const k=this.effect;h?k.dispose():x.c.SetImmediate((()=>{k.getEngine().onEndFrameObservable.addOnce((()=>{k.dispose()}))})),this.effect=null}null===(k=this.drawContext)||void 0===k||k.dispose()}}},11442:(k,h,o)=>{o.d(h,{b:()=>I});var x=o(11288);class I{static GetPlanes(k){const h=[];for(let o=0;o<6;o++)h.push(new x.b(0,0,0,0));return I.GetPlanesToRef(k,h),h}static GetNearPlaneToRef(k,h){const o=k.m;h.normal.x=o[3]+o[2],h.normal.y=o[7]+o[6],h.normal.z=o[11]+o[10],h.d=o[15]+o[14],h.normalize()}static GetFarPlaneToRef(k,h){const o=k.m;h.normal.x=o[3]-o[2],h.normal.y=o[7]-o[6],h.normal.z=o[11]-o[10],h.d=o[15]-o[14],h.normalize()}static GetLeftPlaneToRef(k,h){const o=k.m;h.normal.x=o[3]+o[0],h.normal.y=o[7]+o[4],h.normal.z=o[11]+o[8],h.d=o[15]+o[12],h.normalize()}static GetRightPlaneToRef(k,h){const o=k.m;h.normal.x=o[3]-o[0],h.normal.y=o[7]-o[4],h.normal.z=o[11]-o[8],h.d=o[15]-o[12],h.normalize()}static GetTopPlaneToRef(k,h){const o=k.m;h.normal.x=o[3]-o[1],h.normal.y=o[7]-o[5],h.normal.z=o[11]-o[9],h.d=o[15]-o[13],h.normalize()}static GetBottomPlaneToRef(k,h){const o=k.m;h.normal.x=o[3]+o[1],h.normal.y=o[7]+o[5],h.normal.z=o[11]+o[9],h.d=o[15]+o[13],h.normalize()}static GetPlanesToRef(k,h){I.GetNearPlaneToRef(k,h[0]),I.GetFarPlaneToRef(k,h[1]),I.GetLeftPlaneToRef(k,h[2]),I.GetRightPlaneToRef(k,h[3]),I.GetTopPlaneToRef(k,h[4]),I.GetBottomPlaneToRef(k,h[5])}static IsPointInFrustum(k,h){for(let o=0;o<6;o++)if(h[o].dotCoordinate(k)<0)return!1;return!0}}},11451:(k,h,o)=>{o.d(h,{c:()=>I});var x=o(11106);class I{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(k,h){I.Enabled&&(this._current+=k,h&&this._fetchResult())}beginMonitoring(){I.Enabled&&(this._startMonitoringTime=x.d.Now)}endMonitoring(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!I.Enabled)return;k&&this.fetchNewFrame();const h=x.d.Now;this._current=h-this._startMonitoringTime,k&&this._fetchResult()}dh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const k=x.d.Now;k-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=k,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}I.Enabled=!0},11330:(k,h,o)=>{o.d(h,{c:()=>I,g:()=>x});class x{constructor(k){this.length=0,this.data=new Array(k),this._id=x._GlobalId++}push(k){this.data[this.length++]=k,this.length>this.data.length&&(this.data.length*=2)}forEach(k){for(let h=0;h<this.length;h++)k(this.data[h])}sort(k){this.data.sort(k)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(k){if(0!==k.length){this.length+k.length>this.data.length&&(this.data.length=2*(this.length+k.length));for(let h=0;h<k.length;h++)this.data[this.length++]=(k.data||k)[h]}}indexOf(k){const h=this.data.indexOf(k);return h>=this.length?-1:h}contains(k){return-1!==this.indexOf(k)}}x._GlobalId=0;class I extends x{constructor(){super(...arguments),this._duplicateId=0}push(k){super.push(k),k.__smartArrayFlags||(k.__smartArrayFlags={}),k.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(k){return(!k.__smartArrayFlags||k.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(k),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(k){if(0!==k.length){this.length+k.length>this.data.length&&(this.data.length=2*(this.length+k.length));for(let h=0;h<k.length;h++){const o=(k.data||k)[h];this.pushNoDuplicate(o)}}}}},11305:(k,h,o)=>{o.d(h,{d:()=>q});var x=o(11308),I=o(11082);class q{constructor(k){this._vertexBuffers={},this.onBeforeRenderObservable=new I.d,this._scene=k}_prepareBuffers(){if(this._vertexBuffers[x.g.PositionKind])return;const k=[];k.push(1,1),k.push(-1,1),k.push(-1,-1),k.push(1,-1),this._vertexBuffers[x.g.PositionKind]=new x.g(this._scene.getEngine(),k,x.g.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const k=[];k.push(0),k.push(1),k.push(2),k.push(0),k.push(2),k.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(k)}_rebuild(){const k=this._vertexBuffers[x.g.PositionKind];k&&(k._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const o=this._scene.activeCamera;return!!o&&(h=h||o._postProcesses.filter((k=>null!=k)),!(!h||0===h.length||!this._scene.postProcessesEnabled)&&(h[0].activate(o,k,null!==h&&void 0!==h),!0))}directRender(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,I=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,q=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:k.length;const J=this._scene.getEngine();for(let l=0;l<Y;l++){var G;if(l<k.length-1)k[l+1].activate(this._scene.activeCamera||this._scene,null===h||void 0===h?void 0:h.texture);else h?J.bindFramebuffer(h,x,void 0,void 0,o,I):q||J.restoreDefaultFramebuffer(),null===(G=J._debugInsertMarker)||void 0===G||G.call(J,`post process ${k[l].name} output`);const Y=k[l],A=Y.apply();A&&(Y.onBeforeRenderObservable.notifyObservers(A),this._prepareBuffers(),J.bindBuffers(this._vertexBuffers,this._indexBuffer,A),J.drawElementsType(0,0,6),Y.onAfterRenderObservable.notifyObservers(A))}J.setDepthBuffer(!0),J.setDepthWrite(!0)}_finalizeFrame(k,h,o,x){let I=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const q=this._scene.activeCamera;if(!q)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(x=x||q._postProcesses.filter((k=>null!=k))).length||!this._scene.postProcessesEnabled)return;const Y=this._scene.getEngine();for(let G=0,l=x.length;G<l;G++){const A=x[G];var J;if(G<l-1)A._outputTexture=x[G+1].activate(q,null===h||void 0===h?void 0:h.texture);else h?(Y.bindFramebuffer(h,o,void 0,void 0,I),A._outputTexture=h):(Y.restoreDefaultFramebuffer(),A._outputTexture=null),null===(J=Y._debugInsertMarker)||void 0===J||J.call(Y,`post process ${x[G].name} output`);if(k)break;const K=A.apply();K&&(A.onBeforeRenderObservable.notifyObservers(K),this._prepareBuffers(),Y.bindBuffers(this._vertexBuffers,this._indexBuffer,K),Y.drawElementsType(0,0,6),A.onAfterRenderObservable.notifyObservers(K))}Y.setDepthBuffer(!0),Y.setDepthWrite(!0),Y.setAlphaMode(0)}dispose(){const k=this._vertexBuffers[x.g.PositionKind];k&&(k.dispose(),this._vertexBuffers[x.g.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11326:(k,h,o)=>{o.d(h,{b:()=>J});var x=o(11330),I=o(11239);class q{set opaqueSortCompareFn(k){this._opaqueSortCompareFn=k||q.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(k){this._alphaTestSortCompareFn=k||q.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(k){this._transparentSortCompareFn=k||q.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(k,h){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=k,this._opaqueSubMeshes=new x.g(256),this._transparentSubMeshes=new x.g(256),this._alphaTestSubMeshes=new x.g(256),this._depthOnlySubMeshes=new x.g(256),this._particleSystems=new x.g(256),this._spriteManagers=new x.g(256),this._empty=!0,this._edgesRenderers=new x.c(16),this._scene=h,this.opaqueSortCompareFn=o,this.alphaTestSortCompareFn=I,this.transparentSortCompareFn=q}render(k,h,o,x){if(k)return void k(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const I=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(I.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),I.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const q=I.getStencilBuffer();if(I.setStencilBuffer(!1),h&&this._renderSprites(),o&&this._renderParticles(x),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(I.setStencilBuffer(q),this._scene.useOrderIndependentTransparency){const k=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);k.length&&this._renderTransparent(k)}else this._renderTransparent(this._transparentSubMeshes);I.setAlphaMode(0)}if(I.setStencilBuffer(!1),this._edgesRenderers.length){for(let k=0;k<this._edgesRenderers.length;k++)this._edgesRenderers.data[k].render();I.setAlphaMode(0)}I.setStencilBuffer(q)}_renderOpaqueSorted(k){q._RenderSorted(k,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(k){q._RenderSorted(k,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(k){q._RenderSorted(k,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(k,h,o,x){let Y,J=0;const G=o?o.globalPosition:q._ZeroVector;if(x)for(;J<k.length;J++)Y=k.data[J],Y._alphaIndex=Y.getMesh().alphaIndex,Y._distanceToCamera=I.Vh.Distance(Y.getBoundingInfo().boundingSphere.centerWorld,G);const l=k.length===k.data.length?k.data:k.data.slice(0,k.length);h&&l.sort(h);const A=l[0].getMesh().ik();for(J=0;J<l.length;J++)if(Y=l[J],!A._activeMeshesFrozenButKeepClipping||Y.isInFrustum(A._frustumPlanes)){if(x){const k=Y.Hk();if(k&&k.needDepthPrePass){const h=k.ik().getEngine();h.setColorWrite(!1),h.setAlphaMode(0),Y.render(!1),h.setColorWrite(!0)}}Y.render(x)}}static defaultTransparentSortCompare(k,h){return k._alphaIndex>h._alphaIndex?1:k._alphaIndex<h._alphaIndex?-1:q.backToFrontSortCompare(k,h)}static backToFrontSortCompare(k,h){return k._distanceToCamera<h._distanceToCamera?1:k._distanceToCamera>h._distanceToCamera?-1:0}static frontToBackSortCompare(k,h){return k._distanceToCamera<h._distanceToCamera?-1:k._distanceToCamera>h._distanceToCamera?1:0}static PainterSortCompare(k,h){const o=k.getMesh(),x=h.getMesh();return o.material&&x.material?o.material.uniqueId-x.material.uniqueId:o.uniqueId-x.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(k,h,o){void 0===h&&(h=k.getMesh()),void 0===o&&(o=k.Hk()),null!==o&&void 0!==o&&(o.needAlphaBlendingForMesh(h)?this._transparentSubMeshes.push(k):o.needAlphaTestingForMesh(h)?(o.needDepthPrePass&&this._depthOnlySubMeshes.push(k),this._alphaTestSubMeshes.push(k)):(o.needDepthPrePass&&this._depthOnlySubMeshes.push(k),this._opaqueSubMeshes.push(k)),h._renderingGroup=this,h._edgesRenderer&&h.isEnabled()&&h.isVisible&&h._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(h._edgesRenderer),this._empty=!1)}dispatchSprites(k){this._spriteManagers.push(k),this._empty=!1}dispatchParticles(k){this._particleSystems.push(k),this._empty=!1}_renderParticles(k){if(0===this._particleSystems.length)return;const h=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let o=0;o<this._particleSystems.length;o++){const x=this._particleSystems.data[o];if(0===(h&&h.layerMask&x.layerMask))continue;const I=x.Ih;I.position&&k&&-1===k.indexOf(I)||this._scene._activeParticles.addCount(x.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const k=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let h=0;h<this._spriteManagers.length;h++){const o=this._spriteManagers.data[h];0!==(k&&k.layerMask&o.layerMask)&&o.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}q._ZeroVector=I.Vh.Zero();class Y{}class J{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(k){k!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=k,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const k of this._scene.meshes)if(k.Oh)for(const h of k.Oh)h._wasDispatched=!1;if(this._scene.spriteManagers)for(const k of this._scene.spriteManagers)k._wasDispatched=!1;for(const k of this._scene.ka)k._wasDispatched=!1}constructor(k){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new Y,this._maintainStateBetweenFrames=!1,this._scene=k;for(let h=J.MIN_RENDERINGGROUPS;h<J.MAX_RENDERINGGROUPS;h++)this._autoClearDepthStencil[h]={Hh:!0,depth:!0,stencil:!0}}getRenderingGroup(k){const h=k||0;return this._prepareRenderingGroup(h),this._renderingGroups[h]}_clearDepthStencilBuffer(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,k,h),this._depthStencilBufferAlreadyCleaned=!0)}render(k,h,o,x){const I=this._renderingGroupInfo;if(I.Fh=this._scene,I.camera=this._scene.activeCamera,I.renderingManager=this,this._scene.spriteManagers&&x)for(let q=0;q<this._scene.spriteManagers.length;q++){const k=this._scene.spriteManagers[q];this.dispatchSprites(k)}for(let q=J.MIN_RENDERINGGROUPS;q<J.MAX_RENDERINGGROUPS;q++){this._depthStencilBufferAlreadyCleaned=q===J.MIN_RENDERINGGROUPS;const Y=this._renderingGroups[q];if(!Y||Y._empty)continue;const G=1<<q;if(I.renderingGroupId=q,this._scene.onBeforeRenderingGroupObservable.notifyObservers(I,G),J.AUTOCLEAR){const k=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(q):this._autoClearDepthStencil[q];k&&k.Hh&&this._clearDepthStencilBuffer(k.depth,k.stencil)}for(const k of this._scene._beforeRenderingGroupDrawStage)k.action(q);Y.render(k,x,o,h);for(const k of this._scene._afterRenderingGroupDrawStage)k.action(q);this._scene.onAfterRenderingGroupObservable.notifyObservers(I,G)}}reset(){if(!this.maintainStateBetweenFrames)for(let k=J.MIN_RENDERINGGROUPS;k<J.MAX_RENDERINGGROUPS;k++){const h=this._renderingGroups[k];h&&h.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let k=J.MIN_RENDERINGGROUPS;k<J.MAX_RENDERINGGROUPS;k++){const h=this._renderingGroups[k];h&&h.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let k=J.MIN_RENDERINGGROUPS;k<J.MAX_RENDERINGGROUPS;k++){const h=this._renderingGroups[k];h&&h.dispose()}}_prepareRenderingGroup(k){void 0===this._renderingGroups[k]&&(this._renderingGroups[k]=new q(k,this._scene,this._customOpaqueSortCompareFn[k],this._customAlphaTestSortCompareFn[k],this._customTransparentSortCompareFn[k]))}dispatchSprites(k){this.maintainStateBetweenFrames&&k._wasDispatched||(k._wasDispatched=!0,this.getRenderingGroup(k.renderingGroupId).dispatchSprites(k))}dispatchParticles(k){this.maintainStateBetweenFrames&&k._wasDispatched||(k._wasDispatched=!0,this.getRenderingGroup(k.renderingGroupId).dispatchParticles(k))}dispatch(k,h,o){void 0===h&&(h=k.getMesh()),this.maintainStateBetweenFrames&&k._wasDispatched||(k._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatch(k,h,o))}setRenderingOrder(k){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[k]=h,this._customAlphaTestSortCompareFn[k]=o,this._customTransparentSortCompareFn[k]=x,this._renderingGroups[k]){const h=this._renderingGroups[k];h.opaqueSortCompareFn=this._customOpaqueSortCompareFn[k],h.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[k],h.transparentSortCompareFn=this._customTransparentSortCompareFn[k]}}setRenderingAutoClearDepthStencil(k,h){let o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],x=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[k]={Hh:h,depth:o,stencil:x}}getAutoClearDepthStencilSetup(k){return this._autoClearDepthStencil[k]}}J.MAX_RENDERINGGROUPS=4,J.MIN_RENDERINGGROUPS=0,J.AUTOCLEAR=!0}}]);