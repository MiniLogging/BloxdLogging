"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[19],{11220:(h,V,i)=>{i.d(V,{e:()=>g,h:()=>q});var S=i(11222),l=i(10967),Y=i(11230);class g{get B(){return this._isDisposed}constructor(h,V,i){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Y=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7?arguments[7]:void 0,J=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,h&&h.Mh?this._engine=h.Mh().getEngine():this._engine=h,this._updatable=i,this._instanced=g,this._divisor=B||1,this._label=J,V instanceof S.d?(this._data=null,this._buffer=V):(this._data=V,this._buffer=null),this.byteStride=q?l:l*Float32Array.BYTES_PER_ELEMENT,Y||this.create()}createVertexBuffer(h,V,i,S,l){let Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6?arguments[6]:void 0;const B=Y?V:V*Float32Array.BYTES_PER_ELEMENT,J=S?Y?S:S*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new q(this._engine,this,h,this._updatable,!0,J,void 0===l?this._instanced:l,B,i,void 0,void 0,!0,this._divisor||g)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!h&&this._buffer||(h=h||this._data,h&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h),this._data=h):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(h,this._label),this._data=h):this._buffer=this._engine.createVertexBuffer(h,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Pq>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Pq,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Pq,void 0,this._label));l.d.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(h){this.create(h)}updateDirectly(h,V,i){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,h,S?V:V*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===V&&void 0===i?h:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class q{get B(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(h){const V=0!=h;this._instanceDivisor=h,V!==this._instanced&&(this._instanced=V,this._computeHashCode())}get _maxVerticesCount(){const h=this.getData();return h?Array.isArray(h)?h.length/(this.byteStride/4)-this.byteOffset/4:(h.byteLength-this.byteOffset)/this.byteStride:0}constructor(h,V,i,S,l,B,J,I,v,s){let t=arguments.length>10&&void 0!==arguments[10]&&arguments[10],T=arguments.length>11&&void 0!==arguments[11]&&arguments[11],e=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,n=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let c=!1;if(this.eV=h,"object"===typeof S&&null!==S?(c=S.updatable??!1,l=S.postponeInternalCreation,B=S.stride,J=S.instanced,I=S.offset,v=S.size,s=S.type,t=S.normalized??!1,T=S.useBytes??!1,e=S.divisor??1,n=S.takeBufferOwnership??!1,this._label=S.label):c=!!S,V instanceof g?(this._buffer=V,this._ownsBuffer=n):(this._buffer=new g(h,V,c,B,l,J,T,e,this._label),this._ownsBuffer=!0),this.uniqueId=q._Counter++,this._kind=i,void 0===s){const h=this.getData();this.type=h?q.GetDataType(h):q.FLOAT}else this.type=s;const f=(0,Y.q)(this.type);T?(this._size=v||(B?B/f:q.DeduceStride(i)),this.byteStride=B||this._buffer.byteStride||this._size*f,this.byteOffset=I||0):(this._size=v||B||q.DeduceStride(i),this.byteStride=B?B*f:this._buffer.byteStride||this._size*f,this.byteOffset=(I||0)*f),this.normalized=t,this._instanced=void 0!==J&&J,this._instanceDivisor=J?e:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var h;null===(h=this._buffer)||void 0===h||h._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(h,V){const i=this.getData();return i?(0,Y.n)(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,h,V):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,Y.q)(this.type)}getOffset(){return this.byteOffset/(0,Y.q)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,Y.q)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(h){this._buffer.create(h),this._alignBuffer()}update(h){this._buffer.update(h),this._alignBuffer()}updateDirectly(h,V){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(h,V,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(h,V){(0,Y.j)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,h,this.normalized,((h,i)=>{for(let S=0;S<this._size;S++)V(h[S],i+S)}))}_alignBuffer(){}static DeduceStride(h){switch(h){case q.UVKind:case q.UV2Kind:case q.UV3Kind:case q.UV4Kind:case q.UV5Kind:case q.UV6Kind:return 2;case q.NormalKind:case q.PositionKind:return 3;case q.ColorKind:case q.ColorInstanceKind:case q.MatricesIndicesKind:case q.MatricesIndicesExtraKind:case q.MatricesWeightsKind:case q.MatricesWeightsExtraKind:case q.TangentKind:return 4;default:throw new Error("Invalid kind '"+h+"'")}}static GetDataType(h){return h instanceof Int8Array?q.BYTE:h instanceof Uint8Array?q.UNSIGNED_BYTE:h instanceof Int16Array?q.SHORT:h instanceof Uint16Array?q.UNSIGNED_SHORT:h instanceof Int32Array?q.INT:h instanceof Uint32Array?q.UNSIGNED_INT:q.FLOAT}static GetTypeByteLength(h){return(0,Y.q)(h)}static ForEach(h,V,i,S,l,g,q,B){(0,Y.j)(h,V,i,S,l,g,q,((h,V)=>{for(let i=0;i<S;i++)B(h[i],V+i)}))}static GetFloatData(h,V,i,S,l,g,q,B){return(0,Y.n)(h,V,i,S,l,g,q,B)}}q._Counter=0,q.BYTE=5120,q.UNSIGNED_BYTE=5121,q.SHORT=5122,q.UNSIGNED_SHORT=5123,q.INT=5124,q.UNSIGNED_INT=5125,q.FLOAT=5126,q.PositionKind="position",q.NormalKind="normal",q.TangentKind="tangent",q.UVKind="uv",q.UV2Kind="uv2",q.UV3Kind="uv3",q.UV4Kind="uv4",q.UV5Kind="uv5",q.UV6Kind="uv6",q.ColorKind="color",q.ColorInstanceKind="instanceColor",q.MatricesIndicesKind="matricesIndices",q.MatricesWeightsKind="matricesWeights",q.MatricesIndicesExtraKind="matricesIndicesExtra",q.MatricesWeightsExtraKind="matricesWeightsExtra"},11230:(h,V,i)=>{i.d(V,{e:()=>s,h:()=>v,j:()=>B,n:()=>J,q:()=>g,u:()=>q,w:()=>I});var S=i(10967);function l(h,V,i,S){switch(V){case 5120:{let V=h.getInt8(i);return S&&(V=Math.max(V/127,-1)),V}case 5121:{let V=h.getUint8(i);return S&&(V/=255),V}case 5122:{let V=h.getInt16(i,!0);return S&&(V=Math.max(V/32767,-1)),V}case 5123:{let V=h.getUint16(i,!0);return S&&(V/=65535),V}case 5124:return h.getInt32(i,!0);case 5125:return h.getUint32(i,!0);case 5126:return h.getFloat32(i,!0);default:throw new Error(`Invalid component type ${V}`)}}function Y(h,V,i,S,l){switch(V){case 5120:S&&(l=Math.round(127*l)),h.setInt8(i,l);break;case 5121:S&&(l=Math.round(255*l)),h.setUint8(i,l);break;case 5122:S&&(l=Math.round(32767*l)),h.setInt16(i,l,!0);break;case 5123:S&&(l=Math.round(65535*l)),h.setUint16(i,l,!0);break;case 5124:h.setInt32(i,l,!0);break;case 5125:h.setUint32(i,l,!0);break;case 5126:h.setFloat32(i,l,!0);break;default:throw new Error(`Invalid component type ${V}`)}}function g(h){switch(h){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${h}'`)}}function q(h){switch(h){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${h}'`)}}function B(h,V,i,S,q,B,J,I){const v=new Array(S),s=new Array(S);if(h instanceof Array){let l=V/4;const Y=i/4;for(let V=0;V<B;V+=S){for(let V=0;V<S;V++)v[V]=s[V]=h[l+V];I(s,V);for(let V=0;V<S;V++)v[V]!==s[V]&&(h[l+V]=s[V]);l+=Y}}else{const t=ArrayBuffer.isView(h)?new DataView(h.buffer,h.byteOffset,h.byteLength):new DataView(h),T=g(q);for(let h=0;h<B;h+=S){for(let h=0,i=V;h<S;h++,i+=T)v[h]=s[h]=l(t,q,i,J);I(s,h);for(let h=0,i=V;h<S;h++,i+=T)v[h]!==s[h]&&Y(t,q,i,J,s[h]);V+=i}}}function J(h,V,i,l,Y,q,J,I){const v=V*g(i),s=J*V;if(5126!==i||Y!==v){const S=new Float32Array(s);return B(h,l,Y,V,i,s,q,((h,i)=>{for(let l=0;l<V;l++)S[i+l]=h[l]})),S}if(!(h instanceof Array||h instanceof Float32Array)||0!==l||h.length!==s){if(h instanceof Array){const V=l/4;return h.slice(V,V+s)}if(h instanceof ArrayBuffer)return new Float32Array(h,l,s);{const V=h.byteOffset+l;return 0!==(3&V)&&(S.d.Warn("Float array must be aligned to 4-bytes border"),I=!0),I?new Float32Array(h.buffer.slice(V,V+s*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(h.buffer,V,s)}}return I?h.slice():h}function I(h,V,i,l,Y,J,I,v){const s=g(i),t=q(i),T=I*V;if(Array.isArray(h)){if(0!==(3&l)||0!==(3&Y))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const S=l/4,g=Y/4;if(S+(I-1)*g+V>h.length)throw new Error("Last accessed index is out of bounds.");if(g<V)throw new Error("Data stride cannot be smaller than the component size.");if(g!==V){const S=new t(T);return B(h,l,Y,V,i,T,J,((h,i)=>{for(let l=0;l<V;l++)S[i+l]=h[l]})),S}return new t(h.slice(S,S+T))}let e,n=l;h instanceof ArrayBuffer?e=h:(e=h.buffer,n+=h.byteOffset);if(n+(I-1)*Y+V*s>e.byteLength)throw new Error("Last accessed byte is out of bounds.");const c=V*s;if(Y<c)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(Y!==c){const h=new t(T);return B(e,n,Y,V,i,T,J,((i,S)=>{for(let l=0;l<V;l++)h[S+l]=i[l]})),h}return 1!==s&&0!==(n&s-1)&&(S.d.Warn("Array must be aligned to border of element size. Data will be copied."),v=!0),v?new t(e.slice(n,n+T*s)):new t(e,n,T)}function v(h,V,i,l,Y,q,J,I){const v=V*g(i),s=J*V;if(I.length!==s)throw new Error("Output length is not valid");if(5126===i&&Y===v)if(h instanceof Array){const V=l/4;I.set(h,V)}else if(h instanceof ArrayBuffer){const V=new Float32Array(h,l,s);I.set(V)}else{const V=h.byteOffset+l;if(0!==(3&V))return S.d.Warn("Float array must be aligned to 4-bytes border"),void I.set(new Float32Array(h.buffer.slice(V,V+s*Float32Array.BYTES_PER_ELEMENT)));const i=new Float32Array(h.buffer,V,s);I.set(i)}else B(h,l,Y,V,i,s,q,((h,i)=>{for(let S=0;S<V;S++)I[i+S]=h[S]}))}function s(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(h)){for(let l=0;l<V;l++)if(h[i+l]-S>65535)return!0;return!1}return 4===h.BYTES_PER_ELEMENT}},11222:(h,V,i)=>{i.d(V,{d:()=>S});class S{get underlyingResource(){return null}constructor(){this.references=0,this.Pq=0,this.is32Bits=!1,this.uniqueId=S._Counter++}}S._Counter=0},11271:(h,V,i)=>{i.d(V,{b:()=>l});var S=i(11021);class l{static GetEffect(h){return void 0===h.getPipelineContext?h.effect:h}constructor(h){let V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=h.createDrawContext(),V&&(this.materialContext=h.createMaterialContext())}setEffect(h,V){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var S;(this.effect=h,void 0!==V&&(this.defines=V),i)&&(null===(S=this.drawContext)||void 0===S||S.reset())}dispose(){var h;let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const h=this.effect;V?h.dispose():S.d.SetImmediate((()=>{h.getEngine().onEndFrameObservable.addOnce((()=>{h.dispose()}))})),this.effect=null}null===(h=this.drawContext)||void 0===h||h.dispose()}}},11350:(h,V,i)=>{i.d(V,{d:()=>l});var S=i(11198);class l{static GetPlanes(h){const V=[];for(let i=0;i<6;i++)V.push(new S.b(0,0,0,0));return l.GetPlanesToRef(h,V),V}static GetNearPlaneToRef(h,V){const i=h.m;V.normal.x=i[3]+i[2],V.normal.y=i[7]+i[6],V.normal.z=i[11]+i[10],V.d=i[15]+i[14],V.normalize()}static GetFarPlaneToRef(h,V){const i=h.m;V.normal.x=i[3]-i[2],V.normal.y=i[7]-i[6],V.normal.z=i[11]-i[10],V.d=i[15]-i[14],V.normalize()}static GetLeftPlaneToRef(h,V){const i=h.m;V.normal.x=i[3]+i[0],V.normal.y=i[7]+i[4],V.normal.z=i[11]+i[8],V.d=i[15]+i[12],V.normalize()}static GetRightPlaneToRef(h,V){const i=h.m;V.normal.x=i[3]-i[0],V.normal.y=i[7]-i[4],V.normal.z=i[11]-i[8],V.d=i[15]-i[12],V.normalize()}static GetTopPlaneToRef(h,V){const i=h.m;V.normal.x=i[3]-i[1],V.normal.y=i[7]-i[5],V.normal.z=i[11]-i[9],V.d=i[15]-i[13],V.normalize()}static GetBottomPlaneToRef(h,V){const i=h.m;V.normal.x=i[3]+i[1],V.normal.y=i[7]+i[5],V.normal.z=i[11]+i[9],V.d=i[15]+i[13],V.normalize()}static GetPlanesToRef(h,V){l.GetNearPlaneToRef(h,V[0]),l.GetFarPlaneToRef(h,V[1]),l.GetLeftPlaneToRef(h,V[2]),l.GetRightPlaneToRef(h,V[3]),l.GetTopPlaneToRef(h,V[4]),l.GetBottomPlaneToRef(h,V[5])}static IsPointInFrustum(h,V){for(let i=0;i<6;i++)if(V[i].dotCoordinate(h)<0)return!1;return!0}}},11358:(h,V,i)=>{i.d(V,{b:()=>l});var S=i(10975);class l{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(h,V){l.Enabled&&(this._current+=h,V&&this._fetchResult())}beginMonitoring(){l.Enabled&&(this._startMonitoringTime=S.e.Now)}endMonitoring(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!l.Enabled)return;h&&this.fetchNewFrame();const V=S.e.Now;this._current=V-this._startMonitoringTime,h&&this._fetchResult()}Bg(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const h=S.e.Now;h-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=h,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}l.Enabled=!0},11242:(h,V,i)=>{i.d(V,{c:()=>l,d:()=>S});class S{constructor(h){this.length=0,this.data=new Array(h),this._id=S._GlobalId++}push(h){this.data[this.length++]=h,this.length>this.data.length&&(this.data.length*=2)}forEach(h){for(let V=0;V<this.length;V++)h(this.data[V])}sort(h){this.data.sort(h)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(h){if(0!==h.length){this.length+h.length>this.data.length&&(this.data.length=2*(this.length+h.length));for(let V=0;V<h.length;V++)this.data[this.length++]=(h.data||h)[V]}}indexOf(h){const V=this.data.indexOf(h);return V>=this.length?-1:V}contains(h){return-1!==this.indexOf(h)}}S._GlobalId=0;class l extends S{constructor(){super(...arguments),this._duplicateId=0}push(h){super.push(h),h.__smartArrayFlags||(h.__smartArrayFlags={}),h.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(h){return(!h.__smartArrayFlags||h.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(h),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(h){if(0!==h.length){this.length+h.length>this.data.length&&(this.data.length=2*(this.length+h.length));for(let V=0;V<h.length;V++){const i=(h.data||h)[V];this.pushNoDuplicate(i)}}}}},11218:(h,V,i)=>{i.d(V,{d:()=>Y});var S=i(11220),l=i(10960);class Y{constructor(h){this._vertexBuffers={},this.onBeforeRenderObservable=new l.d,this._scene=h}_prepareBuffers(){if(this._vertexBuffers[S.h.PositionKind])return;const h=[];h.push(1,1),h.push(-1,1),h.push(-1,-1),h.push(1,-1),this._vertexBuffers[S.h.PositionKind]=new S.h(this._scene.getEngine(),h,S.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const h=[];h.push(0),h.push(1),h.push(2),h.push(0),h.push(2),h.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(h)}_rebuild(){const h=this._vertexBuffers[S.h.PositionKind];h&&(h._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let h=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.activeCamera;return!!i&&(V=V||i._postProcesses.filter((h=>null!=h)),!(!V||0===V.length||!this._scene.postProcessesEnabled)&&(V[0].activate(i,h,null!==V&&void 0!==V),!0))}directRender(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,Y=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:h.length;const q=this._scene.getEngine();for(let J=0;J<g;J++){var B;if(J<h.length-1)h[J+1].activate(this._scene.activeCamera||this._scene,null===V||void 0===V?void 0:V.texture);else V?q.bindFramebuffer(V,S,void 0,void 0,i,l):Y||q.restoreDefaultFramebuffer(),null===(B=q._debugInsertMarker)||void 0===B||B.call(q,`post process ${h[J].name} output`);const g=h[J],I=g.apply();I&&(g.onBeforeRenderObservable.notifyObservers(I),this._prepareBuffers(),q.bindBuffers(this._vertexBuffers,this._indexBuffer,I),q.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(I))}q.setDepthBuffer(!0),q.setDepthWrite(!0)}_finalizeFrame(h,V,i,S){let l=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const Y=this._scene.activeCamera;if(!Y)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(S=S||Y._postProcesses.filter((h=>null!=h))).length||!this._scene.postProcessesEnabled)return;const g=this._scene.getEngine();for(let B=0,J=S.length;B<J;B++){const I=S[B];var q;if(B<J-1)I._outputTexture=S[B+1].activate(Y,null===V||void 0===V?void 0:V.texture);else V?(g.bindFramebuffer(V,i,void 0,void 0,l),I._outputTexture=V):(g.restoreDefaultFramebuffer(),I._outputTexture=null),null===(q=g._debugInsertMarker)||void 0===q||q.call(g,`post process ${S[B].name} output`);if(h)break;const v=I.apply();v&&(I.onBeforeRenderObservable.notifyObservers(v),this._prepareBuffers(),g.bindBuffers(this._vertexBuffers,this._indexBuffer,v),g.drawElementsType(0,0,6),I.onAfterRenderObservable.notifyObservers(v))}g.setDepthBuffer(!0),g.setDepthWrite(!0),g.setAlphaMode(0)}dispose(){const h=this._vertexBuffers[S.h.PositionKind];h&&(h.dispose(),this._vertexBuffers[S.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11238:(h,V,i)=>{i.d(V,{d:()=>q});var S=i(11242),l=i(11138);class Y{set opaqueSortCompareFn(h){this._opaqueSortCompareFn=h||Y.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(h){this._alphaTestSortCompareFn=h||Y.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(h){this._transparentSortCompareFn=h||Y.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(h,V){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Y=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=h,this._opaqueSubMeshes=new S.d(256),this._transparentSubMeshes=new S.d(256),this._alphaTestSubMeshes=new S.d(256),this._depthOnlySubMeshes=new S.d(256),this._particleSystems=new S.d(256),this._spriteManagers=new S.d(256),this._empty=!0,this._edgesRenderers=new S.c(16),this._scene=V,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=l,this.transparentSortCompareFn=Y}render(h,V,i,S){if(h)return void h(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const l=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(l.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),l.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const Y=l.getStencilBuffer();if(l.setStencilBuffer(!1),V&&this._renderSprites(),i&&this._renderParticles(S),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(l.setStencilBuffer(Y),this._scene.useOrderIndependentTransparency){const h=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);h.length&&this._renderTransparent(h)}else this._renderTransparent(this._transparentSubMeshes);l.setAlphaMode(0)}if(l.setStencilBuffer(!1),this._edgesRenderers.length){for(let h=0;h<this._edgesRenderers.length;h++)this._edgesRenderers.data[h].render();l.setAlphaMode(0)}l.setStencilBuffer(Y)}_renderOpaqueSorted(h){Y._RenderSorted(h,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(h){Y._RenderSorted(h,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(h){Y._RenderSorted(h,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(h,V,i,S){let g,q=0;const B=i?i.globalPosition:Y._ZeroVector;if(S)for(;q<h.length;q++)g=h.data[q],g._alphaIndex=g.getMesh().alphaIndex,g._distanceToCamera=l.nV.Distance(g.getBoundingInfo().boundingSphere.centerWorld,B);const J=h.length===h.data.length?h.data:h.data.slice(0,h.length);V&&J.sort(V);const I=J[0].getMesh().Mh();for(q=0;q<J.length;q++)if(g=J[q],!I._activeMeshesFrozenButKeepClipping||g.isInFrustum(I._frustumPlanes)){if(S){const h=g.Zh();if(h&&h.needDepthPrePass){const V=h.Mh().getEngine();V.setColorWrite(!1),V.setAlphaMode(0),g.render(!1),V.setColorWrite(!0)}}g.render(S)}}static defaultTransparentSortCompare(h,V){return h._alphaIndex>V._alphaIndex?1:h._alphaIndex<V._alphaIndex?-1:Y.backToFrontSortCompare(h,V)}static backToFrontSortCompare(h,V){return h._distanceToCamera<V._distanceToCamera?1:h._distanceToCamera>V._distanceToCamera?-1:0}static frontToBackSortCompare(h,V){return h._distanceToCamera<V._distanceToCamera?-1:h._distanceToCamera>V._distanceToCamera?1:0}static PainterSortCompare(h,V){const i=h.getMesh(),S=V.getMesh();return i.material&&S.material?i.material.uniqueId-S.material.uniqueId:i.uniqueId-S.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(h,V,i){void 0===V&&(V=h.getMesh()),void 0===i&&(i=h.Zh()),null!==i&&void 0!==i&&(i.needAlphaBlendingForMesh(V)?this._transparentSubMeshes.push(h):i.needAlphaTestingForMesh(V)?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(h),this._alphaTestSubMeshes.push(h)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(h),this._opaqueSubMeshes.push(h)),V._renderingGroup=this,V._edgesRenderer&&V.isEnabled()&&V.isVisible&&V._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(V._edgesRenderer),this._empty=!1)}dispatchSprites(h){this._spriteManagers.push(h),this._empty=!1}dispatchParticles(h){this._particleSystems.push(h),this._empty=!1}_renderParticles(h){if(0===this._particleSystems.length)return;const V=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const S=this._particleSystems.data[i];if(0===(V&&V.layerMask&S.layerMask))continue;const l=S.k;l.position&&h&&-1===h.indexOf(l)||this._scene._activeParticles.addCount(S.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const h=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let V=0;V<this._spriteManagers.length;V++){const i=this._spriteManagers.data[V];0!==(h&&h.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}Y._ZeroVector=l.nV.Zero();class g{}class q{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(h){h!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=h,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const h of this._scene.meshes)if(h.Gg)for(const V of h.Gg)V._wasDispatched=!1;if(this._scene.spriteManagers)for(const h of this._scene.spriteManagers)h._wasDispatched=!1;for(const h of this._scene.Fv)h._wasDispatched=!1}constructor(h){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new g,this._maintainStateBetweenFrames=!1,this._scene=h;for(let V=q.MIN_RENDERINGGROUPS;V<q.MAX_RENDERINGGROUPS;V++)this._autoClearDepthStencil[V]={Fg:!0,depth:!0,stencil:!0}}getRenderingGroup(h){const V=h||0;return this._prepareRenderingGroup(V),this._renderingGroups[V]}_clearDepthStencilBuffer(){let h=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],V=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,h,V),this._depthStencilBufferAlreadyCleaned=!0)}render(h,V,i,S){const l=this._renderingGroupInfo;if(l.fV=this._scene,l.camera=this._scene.activeCamera,l.renderingManager=this,this._scene.spriteManagers&&S)for(let Y=0;Y<this._scene.spriteManagers.length;Y++){const h=this._scene.spriteManagers[Y];this.dispatchSprites(h)}for(let Y=q.MIN_RENDERINGGROUPS;Y<q.MAX_RENDERINGGROUPS;Y++){this._depthStencilBufferAlreadyCleaned=Y===q.MIN_RENDERINGGROUPS;const g=this._renderingGroups[Y];if(!g||g._empty)continue;const B=1<<Y;if(l.renderingGroupId=Y,this._scene.onBeforeRenderingGroupObservable.notifyObservers(l,B),q.AUTOCLEAR){const h=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(Y):this._autoClearDepthStencil[Y];h&&h.Fg&&this._clearDepthStencilBuffer(h.depth,h.stencil)}for(const h of this._scene._beforeRenderingGroupDrawStage)h.action(Y);g.render(h,S,i,V);for(const h of this._scene._afterRenderingGroupDrawStage)h.action(Y);this._scene.onAfterRenderingGroupObservable.notifyObservers(l,B)}}reset(){if(!this.maintainStateBetweenFrames)for(let h=q.MIN_RENDERINGGROUPS;h<q.MAX_RENDERINGGROUPS;h++){const V=this._renderingGroups[h];V&&V.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let h=q.MIN_RENDERINGGROUPS;h<q.MAX_RENDERINGGROUPS;h++){const V=this._renderingGroups[h];V&&V.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let h=q.MIN_RENDERINGGROUPS;h<q.MAX_RENDERINGGROUPS;h++){const V=this._renderingGroups[h];V&&V.dispose()}}_prepareRenderingGroup(h){void 0===this._renderingGroups[h]&&(this._renderingGroups[h]=new Y(h,this._scene,this._customOpaqueSortCompareFn[h],this._customAlphaTestSortCompareFn[h],this._customTransparentSortCompareFn[h]))}dispatchSprites(h){this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatchSprites(h))}dispatchParticles(h){this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(h.renderingGroupId).dispatchParticles(h))}dispatch(h,V,i){void 0===V&&(V=h.getMesh()),this.maintainStateBetweenFrames&&h._wasDispatched||(h._wasDispatched=!0,this.getRenderingGroup(V.renderingGroupId).dispatch(h,V,i))}setRenderingOrder(h){let V=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[h]=V,this._customAlphaTestSortCompareFn[h]=i,this._customTransparentSortCompareFn[h]=S,this._renderingGroups[h]){const V=this._renderingGroups[h];V.opaqueSortCompareFn=this._customOpaqueSortCompareFn[h],V.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[h],V.transparentSortCompareFn=this._customTransparentSortCompareFn[h]}}setRenderingAutoClearDepthStencil(h,V){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],S=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[h]={Fg:V,depth:i,stencil:S}}getAutoClearDepthStencilSetup(h){return this._autoClearDepthStencil[h]}}q.MAX_RENDERINGGROUPS=4,q.MIN_RENDERINGGROUPS=0,q.AUTOCLEAR=!0}}]);