"use strict";(self.b15p7b72fr8=self.b15p7b72fr8||[]).push([[19],{12664:(s,k,h)=>{h.d(k,{b:()=>i,e:()=>K});var A=h(12673),g=h(12422),ms=h(12675);class i{get P(){return this._isDisposed}constructor(s,k,h){let g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,ms=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],K=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7?arguments[7]:void 0,O=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,s&&s.Is?this._engine=s.Is().getEngine():this._engine=s,this._updatable=h,this._instanced=i,this._divisor=H||1,this._label=O,k instanceof A.e?(this._data=null,this._buffer=k):(this._data=k,this._buffer=null),this.byteStride=K?g:g*Float32Array.BYTES_PER_ELEMENT,ms||this.create()}createVertexBuffer(s,k,h,A,g){let ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6?arguments[6]:void 0;const H=ms?k:k*Float32Array.BYTES_PER_ELEMENT,O=A?ms?A:A*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new K(this._engine,this,s,this._updatable,!0,O,void 0===g?this._instanced:g,H,h,void 0,void 0,!0,this._divisor||i)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!s&&this._buffer||(s=s||this._data,s&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,s),this._data=s):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(s,this._label),this._data=s):this._buffer=this._engine.createVertexBuffer(s,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Ch>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Ch,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Ch,void 0,this._label));g.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(s){this.create(s)}updateDirectly(s,k,h){let A=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,s,A?k:k*Float32Array.BYTES_PER_ELEMENT,h?h*this.byteStride:void 0),this._data=0===k&&void 0===h?s:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class K{get P(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(s){const k=0!=s;this._instanceDivisor=s,k!==this._instanced&&(this._instanced=k,this._computeHashCode())}get _maxVerticesCount(){const s=this.getData();return s?Array.isArray(s)?s.length/(this.byteStride/4)-this.byteOffset/4:(s.byteLength-this.byteOffset)/this.byteStride:0}constructor(s,k,h,A,g,H,O,c,S,a){let r=arguments.length>10&&void 0!==arguments[10]&&arguments[10],d=arguments.length>11&&void 0!==arguments[11]&&arguments[11],E=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,j=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let P=!1;if(this.jk=s,"object"===typeof A&&null!==A?(P=A.updatable??!1,g=A.postponeInternalCreation,H=A.stride,O=A.instanced,c=A.offset,S=A.size,a=A.type,r=A.normalized??!1,d=A.useBytes??!1,E=A.divisor??1,j=A.takeBufferOwnership??!1,this._label=A.label):P=!!A,k instanceof i?(this._buffer=k,this._ownsBuffer=j):(this._buffer=new i(s,k,P,H,g,O,d,E,this._label),this._ownsBuffer=!0),this.uniqueId=K._Counter++,this._kind=h,void 0===a){const s=this.getData();this.type=s?K.GetDataType(s):K.FLOAT}else this.type=a;const R=(0,ms.m)(this.type);d?(this._size=S||(H?H/R:K.DeduceStride(h)),this.byteStride=H||this._buffer.byteStride||this._size*R,this.byteOffset=c||0):(this._size=S||H||K.DeduceStride(h),this.byteStride=H?H*R:this._buffer.byteStride||this._size*R,this.byteOffset=(c||0)*R),this.normalized=r,this._instanced=void 0!==O&&O,this._instanceDivisor=O?E:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var s;null===(s=this._buffer)||void 0===s||s._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(s,k){const h=this.getData();return h?(0,ms.i)(h,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,s,k):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,ms.m)(this.type)}getOffset(){return this.byteOffset/(0,ms.m)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,ms.m)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(s){this._buffer.create(s),this._alignBuffer()}update(s){this._buffer.update(s),this._alignBuffer()}updateDirectly(s,k){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(s,k,void 0,h),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(s,k){(0,ms.h)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,s,this.normalized,((s,h)=>{for(let A=0;A<this._size;A++)k(s[A],h+A)}))}_alignBuffer(){}static DeduceStride(s){switch(s){case K.UVKind:case K.UV2Kind:case K.UV3Kind:case K.UV4Kind:case K.UV5Kind:case K.UV6Kind:return 2;case K.NormalKind:case K.PositionKind:return 3;case K.ColorKind:case K.ColorInstanceKind:case K.MatricesIndicesKind:case K.MatricesIndicesExtraKind:case K.MatricesWeightsKind:case K.MatricesWeightsExtraKind:case K.TangentKind:return 4;default:throw new Error("Invalid kind '"+s+"'")}}static GetDataType(s){return s instanceof Int8Array?K.BYTE:s instanceof Uint8Array?K.UNSIGNED_BYTE:s instanceof Int16Array?K.SHORT:s instanceof Uint16Array?K.UNSIGNED_SHORT:s instanceof Int32Array?K.INT:s instanceof Uint32Array?K.UNSIGNED_INT:K.FLOAT}static GetTypeByteLength(s){return(0,ms.m)(s)}static ForEach(s,k,h,A,g,i,K,H){(0,ms.h)(s,k,h,A,g,i,K,((s,k)=>{for(let h=0;h<A;h++)H(s[h],k+h)}))}static GetFloatData(s,k,h,A,g,i,K,H){return(0,ms.i)(s,k,h,A,g,i,K,H)}}K._Counter=0,K.BYTE=5120,K.UNSIGNED_BYTE=5121,K.SHORT=5122,K.UNSIGNED_SHORT=5123,K.INT=5124,K.UNSIGNED_INT=5125,K.FLOAT=5126,K.PositionKind="position",K.NormalKind="normal",K.TangentKind="tangent",K.UVKind="uv",K.UV2Kind="uv2",K.UV3Kind="uv3",K.UV4Kind="uv4",K.UV5Kind="uv5",K.UV6Kind="uv6",K.ColorKind="color",K.ColorInstanceKind="instanceColor",K.MatricesIndicesKind="matricesIndices",K.MatricesWeightsKind="matricesWeights",K.MatricesIndicesExtraKind="matricesIndicesExtra",K.MatricesWeightsExtraKind="matricesWeightsExtra"},12675:(s,k,h)=>{h.d(k,{c:()=>a,g:()=>S,h:()=>H,i:()=>O,m:()=>i,n:()=>K,p:()=>c});var A=h(12422);function g(s,k,h,A){switch(k){case 5120:{let k=s.getInt8(h);return A&&(k=Math.max(k/127,-1)),k}case 5121:{let k=s.getUint8(h);return A&&(k/=255),k}case 5122:{let k=s.getInt16(h,!0);return A&&(k=Math.max(k/32767,-1)),k}case 5123:{let k=s.getUint16(h,!0);return A&&(k/=65535),k}case 5124:return s.getInt32(h,!0);case 5125:return s.getUint32(h,!0);case 5126:return s.getFloat32(h,!0);default:throw new Error(`Invalid component type ${k}`)}}function ms(s,k,h,A,g){switch(k){case 5120:A&&(g=Math.round(127*g)),s.setInt8(h,g);break;case 5121:A&&(g=Math.round(255*g)),s.setUint8(h,g);break;case 5122:A&&(g=Math.round(32767*g)),s.setInt16(h,g,!0);break;case 5123:A&&(g=Math.round(65535*g)),s.setUint16(h,g,!0);break;case 5124:s.setInt32(h,g,!0);break;case 5125:s.setUint32(h,g,!0);break;case 5126:s.setFloat32(h,g,!0);break;default:throw new Error(`Invalid component type ${k}`)}}function i(s){switch(s){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${s}'`)}}function K(s){switch(s){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${s}'`)}}function H(s,k,h,A,K,H,O,c){const S=new Array(A),a=new Array(A);if(s instanceof Array){let g=k/4;const ms=h/4;for(let k=0;k<H;k+=A){for(let k=0;k<A;k++)S[k]=a[k]=s[g+k];c(a,k);for(let k=0;k<A;k++)S[k]!==a[k]&&(s[g+k]=a[k]);g+=ms}}else{const r=ArrayBuffer.isView(s)?new DataView(s.buffer,s.byteOffset,s.byteLength):new DataView(s),d=i(K);for(let s=0;s<H;s+=A){for(let s=0,h=k;s<A;s++,h+=d)S[s]=a[s]=g(r,K,h,O);c(a,s);for(let s=0,h=k;s<A;s++,h+=d)S[s]!==a[s]&&ms(r,K,h,O,a[s]);k+=h}}}function O(s,k,h,g,ms,K,O,c){const S=k*i(h),a=O*k;if(5126!==h||ms!==S){const A=new Float32Array(a);return H(s,g,ms,k,h,a,K,((s,h)=>{for(let g=0;g<k;g++)A[h+g]=s[g]})),A}if(!(s instanceof Array||s instanceof Float32Array)||0!==g||s.length!==a){if(s instanceof Array){const k=g/4;return s.slice(k,k+a)}if(s instanceof ArrayBuffer)return new Float32Array(s,g,a);{const k=s.byteOffset+g;return 0!==(3&k)&&(A.c.Warn("Float array must be aligned to 4-bytes border"),c=!0),c?new Float32Array(s.buffer.slice(k,k+a*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(s.buffer,k,a)}}return c?s.slice():s}function c(s,k,h,g,ms,O,c,S){const a=i(h),r=K(h),d=c*k;if(Array.isArray(s)){if(0!==(3&g)||0!==(3&ms))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const A=g/4,i=ms/4;if(A+(c-1)*i+k>s.length)throw new Error("Last accessed index is out of bounds.");if(i<k)throw new Error("Data stride cannot be smaller than the component size.");if(i!==k){const A=new r(d);return H(s,g,ms,k,h,d,O,((s,h)=>{for(let g=0;g<k;g++)A[h+g]=s[g]})),A}return new r(s.slice(A,A+d))}let E,j=g;s instanceof ArrayBuffer?E=s:(E=s.buffer,j+=s.byteOffset);if(j+(c-1)*ms+k*a>E.byteLength)throw new Error("Last accessed byte is out of bounds.");const P=k*a;if(ms<P)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(ms!==P){const s=new r(d);return H(E,j,ms,k,h,d,O,((h,A)=>{for(let g=0;g<k;g++)s[A+g]=h[g]})),s}return 1!==a&&0!==(j&a-1)&&(A.c.Warn("Array must be aligned to border of element size. Data will be copied."),S=!0),S?new r(E.slice(j,j+d*a)):new r(E,j,d)}function S(s,k,h,g,ms,K,O,c){const S=k*i(h),a=O*k;if(c.length!==a)throw new Error("Output length is not valid");if(5126===h&&ms===S)if(s instanceof Array){const k=g/4;c.set(s,k)}else if(s instanceof ArrayBuffer){const k=new Float32Array(s,g,a);c.set(k)}else{const k=s.byteOffset+g;if(0!==(3&k))return A.c.Warn("Float array must be aligned to 4-bytes border"),void c.set(new Float32Array(s.buffer.slice(k,k+a*Float32Array.BYTES_PER_ELEMENT)));const h=new Float32Array(s.buffer,k,a);c.set(h)}else H(s,g,ms,k,h,a,K,((s,h)=>{for(let A=0;A<k;A++)c[h+A]=s[A]}))}function a(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(s)){for(let g=0;g<k;g++)if(s[h+g]-A>65535)return!0;return!1}return 4===s.BYTES_PER_ELEMENT}},12673:(s,k,h)=>{h.d(k,{e:()=>A});class A{get underlyingResource(){return null}constructor(){this.references=0,this.Ch=0,this.is32Bits=!1,this.uniqueId=A._Counter++}}A._Counter=0},12712:(s,k,h)=>{h.d(k,{b:()=>g});var A=h(12476);class g{static GetEffect(s){return void 0===s.getPipelineContext?s.effect:s}constructor(s){let k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=s.createDrawContext(),k&&(this.materialContext=s.createMaterialContext())}setEffect(s,k){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var A;(this.effect=s,void 0!==k&&(this.defines=k),h)&&(null===(A=this.drawContext)||void 0===A||A.reset())}dispose(){var s;let k=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const s=this.effect;k?s.dispose():A.d.SetImmediate((()=>{s.getEngine().onEndFrameObservable.addOnce((()=>{s.dispose()}))})),this.effect=null}null===(s=this.drawContext)||void 0===s||s.dispose()}}},12796:(s,k,h)=>{h.d(k,{c:()=>g});var A=h(12645);class g{static GetPlanes(s){const k=[];for(let h=0;h<6;h++)k.push(new A.b(0,0,0,0));return g.GetPlanesToRef(s,k),k}static GetNearPlaneToRef(s,k){const h=s.m;k.normal.x=h[3]+h[2],k.normal.y=h[7]+h[6],k.normal.z=h[11]+h[10],k.d=h[15]+h[14],k.normalize()}static GetFarPlaneToRef(s,k){const h=s.m;k.normal.x=h[3]-h[2],k.normal.y=h[7]-h[6],k.normal.z=h[11]-h[10],k.d=h[15]-h[14],k.normalize()}static GetLeftPlaneToRef(s,k){const h=s.m;k.normal.x=h[3]+h[0],k.normal.y=h[7]+h[4],k.normal.z=h[11]+h[8],k.d=h[15]+h[12],k.normalize()}static GetRightPlaneToRef(s,k){const h=s.m;k.normal.x=h[3]-h[0],k.normal.y=h[7]-h[4],k.normal.z=h[11]-h[8],k.d=h[15]-h[12],k.normalize()}static GetTopPlaneToRef(s,k){const h=s.m;k.normal.x=h[3]-h[1],k.normal.y=h[7]-h[5],k.normal.z=h[11]-h[9],k.d=h[15]-h[13],k.normalize()}static GetBottomPlaneToRef(s,k){const h=s.m;k.normal.x=h[3]+h[1],k.normal.y=h[7]+h[5],k.normal.z=h[11]+h[9],k.d=h[15]+h[13],k.normalize()}static GetPlanesToRef(s,k){g.GetNearPlaneToRef(s,k[0]),g.GetFarPlaneToRef(s,k[1]),g.GetLeftPlaneToRef(s,k[2]),g.GetRightPlaneToRef(s,k[3]),g.GetTopPlaneToRef(s,k[4]),g.GetBottomPlaneToRef(s,k[5])}static IsPointInFrustum(s,k){for(let h=0;h<6;h++)if(k[h].dotCoordinate(s)<0)return!1;return!0}}},12811:(s,k,h)=>{h.d(k,{c:()=>g});var A=h(12435);class g{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(s,k){g.Enabled&&(this._current+=s,k&&this._fetchResult())}beginMonitoring(){g.Enabled&&(this._startMonitoringTime=A.e.Now)}endMonitoring(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!g.Enabled)return;s&&this.fetchNewFrame();const k=A.e.Now;this._current=k-this._startMonitoringTime,s&&this._fetchResult()}Rh(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const s=A.e.Now;s-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=s,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}g.Enabled=!0},12688:(s,k,h)=>{h.d(k,{e:()=>g,h:()=>A});class A{constructor(s){this.length=0,this.data=new Array(s),this._id=A._GlobalId++}push(s){this.data[this.length++]=s,this.length>this.data.length&&(this.data.length*=2)}forEach(s){for(let k=0;k<this.length;k++)s(this.data[k])}sort(s){this.data.sort(s)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(s){if(0!==s.length){this.length+s.length>this.data.length&&(this.data.length=2*(this.length+s.length));for(let k=0;k<s.length;k++)this.data[this.length++]=(s.data||s)[k]}}indexOf(s){const k=this.data.indexOf(s);return k>=this.length?-1:k}contains(s){return-1!==this.indexOf(s)}}A._GlobalId=0;class g extends A{constructor(){super(...arguments),this._duplicateId=0}push(s){super.push(s),s.__smartArrayFlags||(s.__smartArrayFlags={}),s.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(s){return(!s.__smartArrayFlags||s.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(s),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(s){if(0!==s.length){this.length+s.length>this.data.length&&(this.data.length=2*(this.length+s.length));for(let k=0;k<s.length;k++){const h=(s.data||s)[k];this.pushNoDuplicate(h)}}}}},12660:(s,k,h)=>{h.d(k,{c:()=>ms});var A=h(12664),g=h(12408);class ms{constructor(s){this._vertexBuffers={},this.onBeforeRenderObservable=new g.c,this._scene=s}_prepareBuffers(){if(this._vertexBuffers[A.e.PositionKind])return;const s=[];s.push(1,1),s.push(-1,1),s.push(-1,-1),s.push(1,-1),this._vertexBuffers[A.e.PositionKind]=new A.e(this._scene.getEngine(),s,A.e.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const s=[];s.push(0),s.push(1),s.push(2),s.push(0),s.push(2),s.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(s)}_rebuild(){const s=this._vertexBuffers[A.e.PositionKind];s&&(s._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const h=this._scene.activeCamera;return!!h&&(k=k||h._postProcesses.filter((s=>null!=s)),!(!k||0===k.length||!this._scene.postProcessesEnabled)&&(k[0].activate(h,s,null!==k&&void 0!==k),!0))}directRender(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,ms=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]?arguments[6]:s.length;const K=this._scene.getEngine();for(let O=0;O<i;O++){var H;if(O<s.length-1)s[O+1].activate(this._scene.activeCamera||this._scene,null===k||void 0===k?void 0:k.texture);else k?K.bindFramebuffer(k,A,void 0,void 0,h,g):ms||K.restoreDefaultFramebuffer(),null===(H=K._debugInsertMarker)||void 0===H||H.call(K,`post process ${s[O].name} output`);const i=s[O],c=i.apply();c&&(i.onBeforeRenderObservable.notifyObservers(c),this._prepareBuffers(),K.bindBuffers(this._vertexBuffers,this._indexBuffer,c),K.drawElementsType(0,0,6),i.onAfterRenderObservable.notifyObservers(c))}K.setDepthBuffer(!0),K.setDepthWrite(!0)}_finalizeFrame(s,k,h,A){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const ms=this._scene.activeCamera;if(!ms)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(A=A||ms._postProcesses.filter((s=>null!=s))).length||!this._scene.postProcessesEnabled)return;const i=this._scene.getEngine();for(let H=0,O=A.length;H<O;H++){const c=A[H];var K;if(H<O-1)c._outputTexture=A[H+1].activate(ms,null===k||void 0===k?void 0:k.texture);else k?(i.bindFramebuffer(k,h,void 0,void 0,g),c._outputTexture=k):(i.restoreDefaultFramebuffer(),c._outputTexture=null),null===(K=i._debugInsertMarker)||void 0===K||K.call(i,`post process ${A[H].name} output`);if(s)break;const S=c.apply();S&&(c.onBeforeRenderObservable.notifyObservers(S),this._prepareBuffers(),i.bindBuffers(this._vertexBuffers,this._indexBuffer,S),i.drawElementsType(0,0,6),c.onAfterRenderObservable.notifyObservers(S))}i.setDepthBuffer(!0),i.setDepthWrite(!0),i.setAlphaMode(0)}dispose(){const s=this._vertexBuffers[A.e.PositionKind];s&&(s.dispose(),this._vertexBuffers[A.e.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},12684:(s,k,h)=>{h.d(k,{b:()=>K});var A=h(12688),g=h(12590);class ms{set opaqueSortCompareFn(s){this._opaqueSortCompareFn=s||ms.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(s){this._alphaTestSortCompareFn=s||ms.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(s){this._transparentSortCompareFn=s||ms.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(s,k){let h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,g=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,ms=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=s,this._opaqueSubMeshes=new A.h(256),this._transparentSubMeshes=new A.h(256),this._alphaTestSubMeshes=new A.h(256),this._depthOnlySubMeshes=new A.h(256),this._particleSystems=new A.h(256),this._spriteManagers=new A.h(256),this._empty=!0,this._edgesRenderers=new A.e(16),this._scene=k,this.opaqueSortCompareFn=h,this.alphaTestSortCompareFn=g,this.transparentSortCompareFn=ms}render(s,k,h,A){if(s)return void s(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const g=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(g.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),g.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const ms=g.getStencilBuffer();if(g.setStencilBuffer(!1),k&&this._renderSprites(),h&&this._renderParticles(A),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(g.setStencilBuffer(ms),this._scene.useOrderIndependentTransparency){const s=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);s.length&&this._renderTransparent(s)}else this._renderTransparent(this._transparentSubMeshes);g.setAlphaMode(0)}if(g.setStencilBuffer(!1),this._edgesRenderers.length){for(let s=0;s<this._edgesRenderers.length;s++)this._edgesRenderers.data[s].render();g.setAlphaMode(0)}g.setStencilBuffer(ms)}_renderOpaqueSorted(s){ms._RenderSorted(s,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(s){ms._RenderSorted(s,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(s){ms._RenderSorted(s,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(s,k,h,A){let i,K=0;const H=h?h.globalPosition:ms._ZeroVector;if(A)for(;K<s.length;K++)i=s.data[K],i._alphaIndex=i.getMesh().alphaIndex,i._distanceToCamera=g.Pk.Distance(i.getBoundingInfo().boundingSphere.centerWorld,H);const O=s.length===s.data.length?s.data:s.data.slice(0,s.length);k&&O.sort(k);const c=O[0].getMesh().Is();for(K=0;K<O.length;K++)if(i=O[K],!c._activeMeshesFrozenButKeepClipping||i.isInFrustum(c._frustumPlanes)){if(A){const s=i.Ms();if(s&&s.needDepthPrePass){const k=s.Is().getEngine();k.setColorWrite(!1),k.setAlphaMode(0),i.render(!1),k.setColorWrite(!0)}}i.render(A)}}static defaultTransparentSortCompare(s,k){return s._alphaIndex>k._alphaIndex?1:s._alphaIndex<k._alphaIndex?-1:ms.backToFrontSortCompare(s,k)}static backToFrontSortCompare(s,k){return s._distanceToCamera<k._distanceToCamera?1:s._distanceToCamera>k._distanceToCamera?-1:0}static frontToBackSortCompare(s,k){return s._distanceToCamera<k._distanceToCamera?-1:s._distanceToCamera>k._distanceToCamera?1:0}static PainterSortCompare(s,k){const h=s.getMesh(),A=k.getMesh();return h.material&&A.material?h.material.uniqueId-A.material.uniqueId:h.uniqueId-A.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(s,k,h){void 0===k&&(k=s.getMesh()),void 0===h&&(h=s.Ms()),null!==h&&void 0!==h&&(h.needAlphaBlendingForMesh(k)?this._transparentSubMeshes.push(s):h.needAlphaTestingForMesh(k)?(h.needDepthPrePass&&this._depthOnlySubMeshes.push(s),this._alphaTestSubMeshes.push(s)):(h.needDepthPrePass&&this._depthOnlySubMeshes.push(s),this._opaqueSubMeshes.push(s)),k._renderingGroup=this,k._edgesRenderer&&k.isEnabled()&&k.isVisible&&k._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(k._edgesRenderer),this._empty=!1)}dispatchSprites(s){this._spriteManagers.push(s),this._empty=!1}dispatchParticles(s){this._particleSystems.push(s),this._empty=!1}_renderParticles(s){if(0===this._particleSystems.length)return;const k=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let h=0;h<this._particleSystems.length;h++){const A=this._particleSystems.data[h];if(0===(k&&k.layerMask&A.layerMask))continue;const g=A.ik;g.position&&s&&-1===s.indexOf(g)||this._scene._activeParticles.addCount(A.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const s=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let k=0;k<this._spriteManagers.length;k++){const h=this._spriteManagers.data[k];0!==(s&&s.layerMask&h.layerMask)&&h.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}ms._ZeroVector=g.Pk.Zero();class i{}class K{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(s){s!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=s,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const s of this._scene.meshes)if(s.Lh)for(const k of s.Lh)k._wasDispatched=!1;if(this._scene.spriteManagers)for(const s of this._scene.spriteManagers)s._wasDispatched=!1;for(const s of this._scene.la)s._wasDispatched=!1}constructor(s){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new i,this._maintainStateBetweenFrames=!1,this._scene=s;for(let k=K.MIN_RENDERINGGROUPS;k<K.MAX_RENDERINGGROUPS;k++)this._autoClearDepthStencil[k]={Xh:!0,depth:!0,Bh:!0}}getRenderingGroup(s){const k=s||0;return this._prepareRenderingGroup(k),this._renderingGroups[k]}_clearDepthStencilBuffer(){let s=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],k=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,s,k),this._depthStencilBufferAlreadyCleaned=!0)}render(s,k,h,A){const g=this._renderingGroupInfo;if(g.Dk=this._scene,g.camera=this._scene.activeCamera,g.renderingManager=this,this._scene.spriteManagers&&A)for(let ms=0;ms<this._scene.spriteManagers.length;ms++){const s=this._scene.spriteManagers[ms];this.dispatchSprites(s)}for(let ms=K.MIN_RENDERINGGROUPS;ms<K.MAX_RENDERINGGROUPS;ms++){this._depthStencilBufferAlreadyCleaned=ms===K.MIN_RENDERINGGROUPS;const i=this._renderingGroups[ms];if(!i||i._empty)continue;const H=1<<ms;if(g.renderingGroupId=ms,this._scene.onBeforeRenderingGroupObservable.notifyObservers(g,H),K.AUTOCLEAR){const s=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(ms):this._autoClearDepthStencil[ms];s&&s.Xh&&this._clearDepthStencilBuffer(s.depth,s.Bh)}for(const s of this._scene._beforeRenderingGroupDrawStage)s.action(ms);i.render(s,A,h,k);for(const s of this._scene._afterRenderingGroupDrawStage)s.action(ms);this._scene.onAfterRenderingGroupObservable.notifyObservers(g,H)}}reset(){if(!this.maintainStateBetweenFrames)for(let s=K.MIN_RENDERINGGROUPS;s<K.MAX_RENDERINGGROUPS;s++){const k=this._renderingGroups[s];k&&k.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let s=K.MIN_RENDERINGGROUPS;s<K.MAX_RENDERINGGROUPS;s++){const k=this._renderingGroups[s];k&&k.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let s=K.MIN_RENDERINGGROUPS;s<K.MAX_RENDERINGGROUPS;s++){const k=this._renderingGroups[s];k&&k.dispose()}}_prepareRenderingGroup(s){void 0===this._renderingGroups[s]&&(this._renderingGroups[s]=new ms(s,this._scene,this._customOpaqueSortCompareFn[s],this._customAlphaTestSortCompareFn[s],this._customTransparentSortCompareFn[s]))}dispatchSprites(s){this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(s.renderingGroupId).dispatchSprites(s))}dispatchParticles(s){this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(s.renderingGroupId).dispatchParticles(s))}dispatch(s,k,h){void 0===k&&(k=s.getMesh()),this.maintainStateBetweenFrames&&s._wasDispatched||(s._wasDispatched=!0,this.getRenderingGroup(k.renderingGroupId).dispatch(s,k,h))}setRenderingOrder(s){let k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[s]=k,this._customAlphaTestSortCompareFn[s]=h,this._customTransparentSortCompareFn[s]=A,this._renderingGroups[s]){const k=this._renderingGroups[s];k.opaqueSortCompareFn=this._customOpaqueSortCompareFn[s],k.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[s],k.transparentSortCompareFn=this._customTransparentSortCompareFn[s]}}setRenderingAutoClearDepthStencil(s,k){let h=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[s]={Xh:k,depth:h,Bh:A}}getAutoClearDepthStencilSetup(s){return this._autoClearDepthStencil[s]}}K.MAX_RENDERINGGROUPS=4,K.MIN_RENDERINGGROUPS=0,K.AUTOCLEAR=!0}}]);