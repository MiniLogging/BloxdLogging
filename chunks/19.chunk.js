"use strict";(self.xeuzlpp225k=self.xeuzlpp225k||[]).push([[19],{11378:(k,Q,i)=>{i.d(Q,{d:()=>B,h:()=>o});var Z=i(11381),U=i(11134),C=i(11387);class B{get J(){return this._isDisposed}constructor(k,Q,i){let U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7?arguments[7]:void 0,O=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,k&&k.sk?this._engine=k.sk().getEngine():this._engine=k,this._updatable=i,this._instanced=B,this._divisor=m||1,this._label=O,Q instanceof Z.d?(this._data=null,this._buffer=Q):(this._data=Q,this._buffer=null),this.byteStride=o?U:U*Float32Array.BYTES_PER_ELEMENT,C||this.create()}createVertexBuffer(k,Q,i,Z,U){let C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6?arguments[6]:void 0;const m=C?Q:Q*Float32Array.BYTES_PER_ELEMENT,O=Z?C?Z:Z*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new o(this._engine,this,k,this._updatable,!0,O,void 0===U?this._instanced:U,m,i,void 0,void 0,!0,this._divisor||B)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!k&&this._buffer||(k=k||this._data,k&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,k),this._data=k):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(k,this._label),this._data=k):this._buffer=this._engine.createVertexBuffer(k,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.yQ>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.yQ,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.yQ,void 0,this._label));U.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(k){this.create(k)}updateDirectly(k,Q,i){let Z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,k,Z?Q:Q*Float32Array.BYTES_PER_ELEMENT,i?i*this.byteStride:void 0),this._data=0===Q&&void 0===i?k:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class o{get J(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(k){const Q=0!=k;this._instanceDivisor=k,Q!==this._instanced&&(this._instanced=Q,this._computeHashCode())}get _maxVerticesCount(){const k=this.getData();return k?Array.isArray(k)?k.length/(this.byteStride/4)-this.byteOffset/4:(k.byteLength-this.byteOffset)/this.byteStride:0}constructor(k,Q,i,Z,U,m,O,J,G,H){let e=arguments.length>10&&void 0!==arguments[10]&&arguments[10],F=arguments.length>11&&void 0!==arguments[11]&&arguments[11],z=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,E=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let l=!1;if(this.FQ=k,"object"===typeof Z&&null!==Z?(l=Z.updatable??!1,U=Z.postponeInternalCreation,m=Z.stride,O=Z.instanced,J=Z.offset,G=Z.size,H=Z.type,e=Z.normalized??!1,F=Z.useBytes??!1,z=Z.divisor??1,E=Z.takeBufferOwnership??!1,this._label=Z.label):l=!!Z,Q instanceof B?(this._buffer=Q,this._ownsBuffer=E):(this._buffer=new B(k,Q,l,m,U,O,F,z,this._label),this._ownsBuffer=!0),this.uniqueId=o._Counter++,this._kind=i,void 0===H){const k=this.getData();this.type=k?o.GetDataType(k):o.FLOAT}else this.type=H;const h=(0,C.p)(this.type);F?(this._size=G||(m?m/h:o.DeduceStride(i)),this.byteStride=m||this._buffer.byteStride||this._size*h,this.byteOffset=J||0):(this._size=G||m||o.DeduceStride(i),this.byteStride=m?m*h:this._buffer.byteStride||this._size*h,this.byteOffset=(J||0)*h),this.normalized=e,this._instanced=void 0!==O&&O,this._instanceDivisor=O?z:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var k;null===(k=this._buffer)||void 0===k||k._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(k,Q){const i=this.getData();return i?(0,C.l)(i,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,k,Q):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,C.p)(this.type)}getOffset(){return this.byteOffset/(0,C.p)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,C.p)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(k){this._buffer.create(k),this._alignBuffer()}update(k){this._buffer.update(k),this._alignBuffer()}updateDirectly(k,Q){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(k,Q,void 0,i),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(k,Q){(0,C.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,k,this.normalized,((k,i)=>{for(let Z=0;Z<this._size;Z++)Q(k[Z],i+Z)}))}_alignBuffer(){}static DeduceStride(k){switch(k){case o.UVKind:case o.UV2Kind:case o.UV3Kind:case o.UV4Kind:case o.UV5Kind:case o.UV6Kind:return 2;case o.NormalKind:case o.PositionKind:return 3;case o.ColorKind:case o.ColorInstanceKind:case o.MatricesIndicesKind:case o.MatricesIndicesExtraKind:case o.MatricesWeightsKind:case o.MatricesWeightsExtraKind:case o.TangentKind:return 4;default:throw new Error("Invalid kind '"+k+"'")}}static GetDataType(k){return k instanceof Int8Array?o.BYTE:k instanceof Uint8Array?o.UNSIGNED_BYTE:k instanceof Int16Array?o.SHORT:k instanceof Uint16Array?o.UNSIGNED_SHORT:k instanceof Int32Array?o.INT:k instanceof Uint32Array?o.UNSIGNED_INT:o.FLOAT}static GetTypeByteLength(k){return(0,C.p)(k)}static ForEach(k,Q,i,Z,U,B,o,m){(0,C.i)(k,Q,i,Z,U,B,o,((k,Q)=>{for(let i=0;i<Z;i++)m(k[i],Q+i)}))}static GetFloatData(k,Q,i,Z,U,B,o,m){return(0,C.l)(k,Q,i,Z,U,B,o,m)}}o._Counter=0,o.BYTE=5120,o.UNSIGNED_BYTE=5121,o.SHORT=5122,o.UNSIGNED_SHORT=5123,o.INT=5124,o.UNSIGNED_INT=5125,o.FLOAT=5126,o.PositionKind="position",o.NormalKind="normal",o.TangentKind="tangent",o.UVKind="uv",o.UV2Kind="uv2",o.UV3Kind="uv3",o.UV4Kind="uv4",o.UV5Kind="uv5",o.UV6Kind="uv6",o.ColorKind="color",o.ColorInstanceKind="instanceColor",o.MatricesIndicesKind="matricesIndices",o.MatricesWeightsKind="matricesWeights",o.MatricesIndicesExtraKind="matricesIndicesExtra",o.MatricesWeightsExtraKind="matricesWeightsExtra"},11387:(k,Q,i)=>{i.d(Q,{c:()=>H,e:()=>G,i:()=>m,l:()=>O,p:()=>B,t:()=>o,x:()=>J});var Z=i(11134);function U(k,Q,i,Z){switch(Q){case 5120:{let Q=k.getInt8(i);return Z&&(Q=Math.max(Q/127,-1)),Q}case 5121:{let Q=k.getUint8(i);return Z&&(Q/=255),Q}case 5122:{let Q=k.getInt16(i,!0);return Z&&(Q=Math.max(Q/32767,-1)),Q}case 5123:{let Q=k.getUint16(i,!0);return Z&&(Q/=65535),Q}case 5124:return k.getInt32(i,!0);case 5125:return k.getUint32(i,!0);case 5126:return k.getFloat32(i,!0);default:throw new Error(`Invalid component type ${Q}`)}}function C(k,Q,i,Z,U){switch(Q){case 5120:Z&&(U=Math.round(127*U)),k.setInt8(i,U);break;case 5121:Z&&(U=Math.round(255*U)),k.setUint8(i,U);break;case 5122:Z&&(U=Math.round(32767*U)),k.setInt16(i,U,!0);break;case 5123:Z&&(U=Math.round(65535*U)),k.setUint16(i,U,!0);break;case 5124:k.setInt32(i,U,!0);break;case 5125:k.setUint32(i,U,!0);break;case 5126:k.setFloat32(i,U,!0);break;default:throw new Error(`Invalid component type ${Q}`)}}function B(k){switch(k){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${k}'`)}}function o(k){switch(k){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${k}'`)}}function m(k,Q,i,Z,o,m,O,J){const G=new Array(Z),H=new Array(Z);if(k instanceof Array){let U=Q/4;const C=i/4;for(let Q=0;Q<m;Q+=Z){for(let Q=0;Q<Z;Q++)G[Q]=H[Q]=k[U+Q];J(H,Q);for(let Q=0;Q<Z;Q++)G[Q]!==H[Q]&&(k[U+Q]=H[Q]);U+=C}}else{const e=ArrayBuffer.isView(k)?new DataView(k.buffer,k.byteOffset,k.byteLength):new DataView(k),F=B(o);for(let k=0;k<m;k+=Z){for(let k=0,i=Q;k<Z;k++,i+=F)G[k]=H[k]=U(e,o,i,O);J(H,k);for(let k=0,i=Q;k<Z;k++,i+=F)G[k]!==H[k]&&C(e,o,i,O,H[k]);Q+=i}}}function O(k,Q,i,U,C,o,O,J){const G=Q*B(i),H=O*Q;if(5126!==i||C!==G){const Z=new Float32Array(H);return m(k,U,C,Q,i,H,o,((k,i)=>{for(let U=0;U<Q;U++)Z[i+U]=k[U]})),Z}if(!(k instanceof Array||k instanceof Float32Array)||0!==U||k.length!==H){if(k instanceof Array){const Q=U/4;return k.slice(Q,Q+H)}if(k instanceof ArrayBuffer)return new Float32Array(k,U,H);{const Q=k.byteOffset+U;return 0!==(3&Q)&&(Z.c.Warn("Float array must be aligned to 4-bytes border"),J=!0),J?new Float32Array(k.buffer.slice(Q,Q+H*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(k.buffer,Q,H)}}return J?k.slice():k}function J(k,Q,i,U,C,O,J,G){const H=B(i),e=o(i),F=J*Q;if(Array.isArray(k)){if(0!==(3&U)||0!==(3&C))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const Z=U/4,B=C/4;if(Z+(J-1)*B+Q>k.length)throw new Error("Last accessed index is out of bounds.");if(B<Q)throw new Error("Data stride cannot be smaller than the component size.");if(B!==Q){const Z=new e(F);return m(k,U,C,Q,i,F,O,((k,i)=>{for(let U=0;U<Q;U++)Z[i+U]=k[U]})),Z}return new e(k.slice(Z,Z+F))}let z,E=U;k instanceof ArrayBuffer?z=k:(z=k.buffer,E+=k.byteOffset);if(E+(J-1)*C+Q*H>z.byteLength)throw new Error("Last accessed byte is out of bounds.");const l=Q*H;if(C<l)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(C!==l){const k=new e(F);return m(z,E,C,Q,i,F,O,((i,Z)=>{for(let U=0;U<Q;U++)k[Z+U]=i[U]})),k}return 1!==H&&0!==(E&H-1)&&(Z.c.Warn("Array must be aligned to border of element size. Data will be copied."),G=!0),G?new e(z.slice(E,E+F*H)):new e(z,E,F)}function G(k,Q,i,U,C,o,O,J){const G=Q*B(i),H=O*Q;if(J.length!==H)throw new Error("Output length is not valid");if(5126===i&&C===G)if(k instanceof Array){const Q=U/4;J.set(k,Q)}else if(k instanceof ArrayBuffer){const Q=new Float32Array(k,U,H);J.set(Q)}else{const Q=k.byteOffset+U;if(0!==(3&Q))return Z.c.Warn("Float array must be aligned to 4-bytes border"),void J.set(new Float32Array(k.buffer.slice(Q,Q+H*Float32Array.BYTES_PER_ELEMENT)));const i=new Float32Array(k.buffer,Q,H);J.set(i)}else m(k,U,C,Q,i,H,o,((k,i)=>{for(let Z=0;Z<Q;Z++)J[i+Z]=k[Z]}))}function H(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(k)){for(let U=0;U<Q;U++)if(k[i+U]-Z>65535)return!0;return!1}return 4===k.BYTES_PER_ELEMENT}},11381:(k,Q,i)=>{i.d(Q,{d:()=>Z});class Z{get underlyingResource(){return null}constructor(){this.references=0,this.yQ=0,this.is32Bits=!1,this.uniqueId=Z._Counter++}}Z._Counter=0},11414:(k,Q,i)=>{i.d(Q,{b:()=>U});var Z=i(11189);class U{static GetEffect(k){return void 0===k.getPipelineContext?k.effect:k}constructor(k){let Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=k.createDrawContext(),Q&&(this.materialContext=k.createMaterialContext())}setEffect(k,Q){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var Z;(this.effect=k,void 0!==Q&&(this.defines=Q),i)&&(null===(Z=this.drawContext)||void 0===Z||Z.reset())}dispose(){var k;let Q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const k=this.effect;Q?k.dispose():Z.c.SetImmediate((()=>{k.getEngine().onEndFrameObservable.addOnce((()=>{k.dispose()}))})),this.effect=null}null===(k=this.drawContext)||void 0===k||k.dispose()}}},11502:(k,Q,i)=>{i.d(Q,{b:()=>U});var Z=i(11355);class U{static GetPlanes(k){const Q=[];for(let i=0;i<6;i++)Q.push(new Z.b(0,0,0,0));return U.GetPlanesToRef(k,Q),Q}static GetNearPlaneToRef(k,Q){const i=k.m;Q.normal.x=i[3]+i[2],Q.normal.y=i[7]+i[6],Q.normal.z=i[11]+i[10],Q.d=i[15]+i[14],Q.normalize()}static GetFarPlaneToRef(k,Q){const i=k.m;Q.normal.x=i[3]-i[2],Q.normal.y=i[7]-i[6],Q.normal.z=i[11]-i[10],Q.d=i[15]-i[14],Q.normalize()}static GetLeftPlaneToRef(k,Q){const i=k.m;Q.normal.x=i[3]+i[0],Q.normal.y=i[7]+i[4],Q.normal.z=i[11]+i[8],Q.d=i[15]+i[12],Q.normalize()}static GetRightPlaneToRef(k,Q){const i=k.m;Q.normal.x=i[3]-i[0],Q.normal.y=i[7]-i[4],Q.normal.z=i[11]-i[8],Q.d=i[15]-i[12],Q.normalize()}static GetTopPlaneToRef(k,Q){const i=k.m;Q.normal.x=i[3]-i[1],Q.normal.y=i[7]-i[5],Q.normal.z=i[11]-i[9],Q.d=i[15]-i[13],Q.normalize()}static GetBottomPlaneToRef(k,Q){const i=k.m;Q.normal.x=i[3]+i[1],Q.normal.y=i[7]+i[5],Q.normal.z=i[11]+i[9],Q.d=i[15]+i[13],Q.normalize()}static GetPlanesToRef(k,Q){U.GetNearPlaneToRef(k,Q[0]),U.GetFarPlaneToRef(k,Q[1]),U.GetLeftPlaneToRef(k,Q[2]),U.GetRightPlaneToRef(k,Q[3]),U.GetTopPlaneToRef(k,Q[4]),U.GetBottomPlaneToRef(k,Q[5])}static IsPointInFrustum(k,Q){for(let i=0;i<6;i++)if(Q[i].dotCoordinate(k)<0)return!1;return!0}}},11513:(k,Q,i)=>{i.d(Q,{b:()=>U});var Z=i(11144);class U{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(k,Q){U.Enabled&&(this._current+=k,Q&&this._fetchResult())}beginMonitoring(){U.Enabled&&(this._startMonitoringTime=Z.c.Now)}endMonitoring(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!U.Enabled)return;k&&this.fetchNewFrame();const Q=Z.c.Now;this._current=Q-this._startMonitoringTime,k&&this._fetchResult()}pi(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const k=Z.c.Now;k-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=k,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}U.Enabled=!0},11396:(k,Q,i)=>{i.d(Q,{d:()=>U,f:()=>Z});class Z{constructor(k){this.length=0,this.data=new Array(k),this._id=Z._GlobalId++}push(k){this.data[this.length++]=k,this.length>this.data.length&&(this.data.length*=2)}forEach(k){for(let Q=0;Q<this.length;Q++)k(this.data[Q])}sort(k){this.data.sort(k)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(k){if(0!==k.length){this.length+k.length>this.data.length&&(this.data.length=2*(this.length+k.length));for(let Q=0;Q<k.length;Q++)this.data[this.length++]=(k.data||k)[Q]}}indexOf(k){const Q=this.data.indexOf(k);return Q>=this.length?-1:Q}contains(k){return-1!==this.indexOf(k)}}Z._GlobalId=0;class U extends Z{constructor(){super(...arguments),this._duplicateId=0}push(k){super.push(k),k.__smartArrayFlags||(k.__smartArrayFlags={}),k.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(k){return(!k.__smartArrayFlags||k.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(k),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(k){if(0!==k.length){this.length+k.length>this.data.length&&(this.data.length=2*(this.length+k.length));for(let Q=0;Q<k.length;Q++){const i=(k.data||k)[Q];this.pushNoDuplicate(i)}}}}},11373:(k,Q,i)=>{i.d(Q,{c:()=>C});var Z=i(11378),U=i(11122);class C{constructor(k){this._vertexBuffers={},this.onBeforeRenderObservable=new U.c,this._scene=k}_prepareBuffers(){if(this._vertexBuffers[Z.h.PositionKind])return;const k=[];k.push(1,1),k.push(-1,1),k.push(-1,-1),k.push(1,-1),this._vertexBuffers[Z.h.PositionKind]=new Z.h(this._scene.getEngine(),k,Z.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const k=[];k.push(0),k.push(1),k.push(2),k.push(0),k.push(2),k.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(k)}_rebuild(){const k=this._vertexBuffers[Z.h.PositionKind];k&&(k._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const i=this._scene.activeCamera;return!!i&&(Q=Q||i._postProcesses.filter((k=>null!=k)),!(!Q||0===Q.length||!this._scene.postProcessesEnabled)&&(Q[0].activate(i,k,null!==Q&&void 0!==Q),!0))}directRender(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,C=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:k.length;const o=this._scene.getEngine();for(let O=0;O<B;O++){var m;if(O<k.length-1)k[O+1].activate(this._scene.activeCamera||this._scene,null===Q||void 0===Q?void 0:Q.texture);else Q?o.bindFramebuffer(Q,Z,void 0,void 0,i,U):C||o.restoreDefaultFramebuffer(),null===(m=o._debugInsertMarker)||void 0===m||m.call(o,`post process ${k[O].name} output`);const B=k[O],J=B.apply();J&&(B.onBeforeRenderObservable.notifyObservers(J),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,J),o.drawElementsType(0,0,6),B.onAfterRenderObservable.notifyObservers(J))}o.setDepthBuffer(!0),o.setDepthWrite(!0)}_finalizeFrame(k,Q,i,Z){let U=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const C=this._scene.activeCamera;if(!C)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(Z=Z||C._postProcesses.filter((k=>null!=k))).length||!this._scene.postProcessesEnabled)return;const B=this._scene.getEngine();for(let m=0,O=Z.length;m<O;m++){const J=Z[m];var o;if(m<O-1)J._outputTexture=Z[m+1].activate(C,null===Q||void 0===Q?void 0:Q.texture);else Q?(B.bindFramebuffer(Q,i,void 0,void 0,U),J._outputTexture=Q):(B.restoreDefaultFramebuffer(),J._outputTexture=null),null===(o=B._debugInsertMarker)||void 0===o||o.call(B,`post process ${Z[m].name} output`);if(k)break;const G=J.apply();G&&(J.onBeforeRenderObservable.notifyObservers(G),this._prepareBuffers(),B.bindBuffers(this._vertexBuffers,this._indexBuffer,G),B.drawElementsType(0,0,6),J.onAfterRenderObservable.notifyObservers(G))}B.setDepthBuffer(!0),B.setDepthWrite(!0),B.setAlphaMode(0)}dispose(){const k=this._vertexBuffers[Z.h.PositionKind];k&&(k.dispose(),this._vertexBuffers[Z.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11389:(k,Q,i)=>{i.d(Q,{d:()=>o});var Z=i(11396),U=i(11298);class C{set opaqueSortCompareFn(k){this._opaqueSortCompareFn=k||C.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(k){this._alphaTestSortCompareFn=k||C.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(k){this._transparentSortCompareFn=k||C.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(k,Q){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,U=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=k,this._opaqueSubMeshes=new Z.f(256),this._transparentSubMeshes=new Z.f(256),this._alphaTestSubMeshes=new Z.f(256),this._depthOnlySubMeshes=new Z.f(256),this._particleSystems=new Z.f(256),this._spriteManagers=new Z.f(256),this._empty=!0,this._edgesRenderers=new Z.d(16),this._scene=Q,this.opaqueSortCompareFn=i,this.alphaTestSortCompareFn=U,this.transparentSortCompareFn=C}render(k,Q,i,Z){if(k)return void k(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const U=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(U.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),U.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const C=U.getStencilBuffer();if(U.setStencilBuffer(!1),Q&&this._renderSprites(),i&&this._renderParticles(Z),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(U.setStencilBuffer(C),this._scene.useOrderIndependentTransparency){const k=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);k.length&&this._renderTransparent(k)}else this._renderTransparent(this._transparentSubMeshes);U.setAlphaMode(0)}if(U.setStencilBuffer(!1),this._edgesRenderers.length){for(let k=0;k<this._edgesRenderers.length;k++)this._edgesRenderers.data[k].render();U.setAlphaMode(0)}U.setStencilBuffer(C)}_renderOpaqueSorted(k){C._RenderSorted(k,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(k){C._RenderSorted(k,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(k){C._RenderSorted(k,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(k,Q,i,Z){let B,o=0;const m=i?i.globalPosition:C._ZeroVector;if(Z)for(;o<k.length;o++)B=k.data[o],B._alphaIndex=B.getMesh().alphaIndex,B._distanceToCamera=U.zQ.Distance(B.getBoundingInfo().boundingSphere.centerWorld,m);const O=k.length===k.data.length?k.data:k.data.slice(0,k.length);Q&&O.sort(Q);const J=O[0].getMesh().sk();for(o=0;o<O.length;o++)if(B=O[o],!J._activeMeshesFrozenButKeepClipping||B.isInFrustum(J._frustumPlanes)){if(Z){const k=B.Dk();if(k&&k.needDepthPrePass){const Q=k.sk().getEngine();Q.setColorWrite(!1),Q.setAlphaMode(0),B.render(!1),Q.setColorWrite(!0)}}B.render(Z)}}static defaultTransparentSortCompare(k,Q){return k._alphaIndex>Q._alphaIndex?1:k._alphaIndex<Q._alphaIndex?-1:C.backToFrontSortCompare(k,Q)}static backToFrontSortCompare(k,Q){return k._distanceToCamera<Q._distanceToCamera?1:k._distanceToCamera>Q._distanceToCamera?-1:0}static frontToBackSortCompare(k,Q){return k._distanceToCamera<Q._distanceToCamera?-1:k._distanceToCamera>Q._distanceToCamera?1:0}static PainterSortCompare(k,Q){const i=k.getMesh(),Z=Q.getMesh();return i.material&&Z.material?i.material.uniqueId-Z.material.uniqueId:i.uniqueId-Z.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(k,Q,i){void 0===Q&&(Q=k.getMesh()),void 0===i&&(i=k.Dk()),null!==i&&void 0!==i&&(i.needAlphaBlendingForMesh(Q)?this._transparentSubMeshes.push(k):i.needAlphaTestingForMesh(Q)?(i.needDepthPrePass&&this._depthOnlySubMeshes.push(k),this._alphaTestSubMeshes.push(k)):(i.needDepthPrePass&&this._depthOnlySubMeshes.push(k),this._opaqueSubMeshes.push(k)),Q._renderingGroup=this,Q._edgesRenderer&&Q.isEnabled()&&Q.isVisible&&Q._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(Q._edgesRenderer),this._empty=!1)}dispatchSprites(k){this._spriteManagers.push(k),this._empty=!1}dispatchParticles(k){this._particleSystems.push(k),this._empty=!1}_renderParticles(k){if(0===this._particleSystems.length)return;const Q=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let i=0;i<this._particleSystems.length;i++){const Z=this._particleSystems.data[i];if(0===(Q&&Q.layerMask&Z.layerMask))continue;const U=Z.UQ;U.position&&k&&-1===k.indexOf(U)||this._scene._activeParticles.addCount(Z.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const k=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let Q=0;Q<this._spriteManagers.length;Q++){const i=this._spriteManagers.data[Q];0!==(k&&k.layerMask&i.layerMask)&&i.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}C._ZeroVector=U.zQ.Zero();class B{}class o{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(k){k!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=k,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const k of this._scene.meshes)if(k.io)for(const Q of k.io)Q._wasDispatched=!1;if(this._scene.spriteManagers)for(const k of this._scene.spriteManagers)k._wasDispatched=!1;for(const k of this._scene.SG)k._wasDispatched=!1}constructor(k){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new B,this._maintainStateBetweenFrames=!1,this._scene=k;for(let Q=o.MIN_RENDERINGGROUPS;Q<o.MAX_RENDERINGGROUPS;Q++)this._autoClearDepthStencil[Q]={Qo:!0,depth:!0,stencil:!0}}getRenderingGroup(k){const Q=k||0;return this._prepareRenderingGroup(Q),this._renderingGroups[Q]}_clearDepthStencilBuffer(){let k=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],Q=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,k,Q),this._depthStencilBufferAlreadyCleaned=!0)}render(k,Q,i,Z){const U=this._renderingGroupInfo;if(U.lQ=this._scene,U.camera=this._scene.activeCamera,U.renderingManager=this,this._scene.spriteManagers&&Z)for(let C=0;C<this._scene.spriteManagers.length;C++){const k=this._scene.spriteManagers[C];this.dispatchSprites(k)}for(let C=o.MIN_RENDERINGGROUPS;C<o.MAX_RENDERINGGROUPS;C++){this._depthStencilBufferAlreadyCleaned=C===o.MIN_RENDERINGGROUPS;const B=this._renderingGroups[C];if(!B||B._empty)continue;const m=1<<C;if(U.renderingGroupId=C,this._scene.onBeforeRenderingGroupObservable.notifyObservers(U,m),o.AUTOCLEAR){const k=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(C):this._autoClearDepthStencil[C];k&&k.Qo&&this._clearDepthStencilBuffer(k.depth,k.stencil)}for(const k of this._scene._beforeRenderingGroupDrawStage)k.action(C);B.render(k,Z,i,Q);for(const k of this._scene._afterRenderingGroupDrawStage)k.action(C);this._scene.onAfterRenderingGroupObservable.notifyObservers(U,m)}}reset(){if(!this.maintainStateBetweenFrames)for(let k=o.MIN_RENDERINGGROUPS;k<o.MAX_RENDERINGGROUPS;k++){const Q=this._renderingGroups[k];Q&&Q.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let k=o.MIN_RENDERINGGROUPS;k<o.MAX_RENDERINGGROUPS;k++){const Q=this._renderingGroups[k];Q&&Q.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let k=o.MIN_RENDERINGGROUPS;k<o.MAX_RENDERINGGROUPS;k++){const Q=this._renderingGroups[k];Q&&Q.dispose()}}_prepareRenderingGroup(k){void 0===this._renderingGroups[k]&&(this._renderingGroups[k]=new C(k,this._scene,this._customOpaqueSortCompareFn[k],this._customAlphaTestSortCompareFn[k],this._customTransparentSortCompareFn[k]))}dispatchSprites(k){this.maintainStateBetweenFrames&&k._wasDispatched||(k._wasDispatched=!0,this.getRenderingGroup(k.renderingGroupId).dispatchSprites(k))}dispatchParticles(k){this.maintainStateBetweenFrames&&k._wasDispatched||(k._wasDispatched=!0,this.getRenderingGroup(k.renderingGroupId).dispatchParticles(k))}dispatch(k,Q,i){void 0===Q&&(Q=k.getMesh()),this.maintainStateBetweenFrames&&k._wasDispatched||(k._wasDispatched=!0,this.getRenderingGroup(Q.renderingGroupId).dispatch(k,Q,i))}setRenderingOrder(k){let Q=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[k]=Q,this._customAlphaTestSortCompareFn[k]=i,this._customTransparentSortCompareFn[k]=Z,this._renderingGroups[k]){const Q=this._renderingGroups[k];Q.opaqueSortCompareFn=this._customOpaqueSortCompareFn[k],Q.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[k],Q.transparentSortCompareFn=this._customTransparentSortCompareFn[k]}}setRenderingAutoClearDepthStencil(k,Q){let i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],Z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[k]={Qo:Q,depth:i,stencil:Z}}getAutoClearDepthStencilSetup(k){return this._autoClearDepthStencil[k]}}o.MAX_RENDERINGGROUPS=4,o.MIN_RENDERINGGROUPS=0,o.AUTOCLEAR=!0}}]);