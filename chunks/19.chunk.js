"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[19],{11255:(P,f,Y)=>{Y.d(f,{c:()=>L,d:()=>o});var C=Y(11264),q=Y(11025),m=Y(11273);class L{get R(){return this._isDisposed}constructor(P,f,Y){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,m=arguments.length>4&&void 0!==arguments[4]&&arguments[4],L=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],w=arguments.length>7?arguments[7]:void 0,d=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,P&&P.vP?this._engine=P.vP().getEngine():this._engine=P,this._updatable=Y,this._instanced=L,this._divisor=w||1,this._label=d,f instanceof C.e?(this._data=null,this._buffer=f):(this._data=f,this._buffer=null),this.byteStride=o?q:q*Float32Array.BYTES_PER_ELEMENT,m||this.create()}createVertexBuffer(P,f,Y,C,q){let m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6?arguments[6]:void 0;const w=m?f:f*Float32Array.BYTES_PER_ELEMENT,d=C?m?C:C*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new o(this._engine,this,P,this._updatable,!0,d,void 0===q?this._instanced:q,w,Y,void 0,void 0,!0,this._divisor||L)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!P&&this._buffer||(P=P||this._data,P&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,P),this._data=P):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(P,this._label),this._data=P):this._buffer=this._engine.createVertexBuffer(P,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.eY>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.eY,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.eY,void 0,this._label));q.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(P){this.create(P)}updateDirectly(P,f,Y){let C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,P,C?f:f*Float32Array.BYTES_PER_ELEMENT,Y?Y*this.byteStride:void 0),this._data=0===f&&void 0===Y?P:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class o{get R(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(P){const f=0!=P;this._instanceDivisor=P,f!==this._instanced&&(this._instanced=f,this._computeHashCode())}get _maxVerticesCount(){const P=this.getData();return P?Array.isArray(P)?P.length/(this.byteStride/4)-this.byteOffset/4:(P.byteLength-this.byteOffset)/this.byteStride:0}constructor(P,f,Y,C,q,w,d,R,y,r){let i=arguments.length>10&&void 0!==arguments[10]&&arguments[10],u=arguments.length>11&&void 0!==arguments[11]&&arguments[11],g=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,S=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let K=!1;if(this.Kf=P,"object"===typeof C&&null!==C?(K=C.updatable??!1,q=C.postponeInternalCreation,w=C.stride,d=C.instanced,R=C.offset,y=C.size,r=C.type,i=C.normalized??!1,u=C.useBytes??!1,g=C.divisor??1,S=C.takeBufferOwnership??!1,this._label=C.label):K=!!C,f instanceof L?(this._buffer=f,this._ownsBuffer=S):(this._buffer=new L(P,f,K,w,q,d,u,g,this._label),this._ownsBuffer=!0),this.uniqueId=o._Counter++,this._kind=Y,void 0===r){const P=this.getData();this.type=P?o.GetDataType(P):o.FLOAT}else this.type=r;const M=(0,m.o)(this.type);u?(this._size=y||(w?w/M:o.DeduceStride(Y)),this.byteStride=w||this._buffer.byteStride||this._size*M,this.byteOffset=R||0):(this._size=y||w||o.DeduceStride(Y),this.byteStride=w?w*M:this._buffer.byteStride||this._size*M,this.byteOffset=(R||0)*M),this.normalized=i,this._instanced=void 0!==d&&d,this._instanceDivisor=d?g:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var P;null===(P=this._buffer)||void 0===P||P._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(P,f){const Y=this.getData();return Y?(0,m.k)(Y,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,P,f):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,m.o)(this.type)}getOffset(){return this.byteOffset/(0,m.o)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,m.o)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(P){this._buffer.create(P),this._alignBuffer()}update(P){this._buffer.update(P),this._alignBuffer()}updateDirectly(P,f){let Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(P,f,void 0,Y),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(P,f){(0,m.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,P,this.normalized,((P,Y)=>{for(let C=0;C<this._size;C++)f(P[C],Y+C)}))}_alignBuffer(){}static DeduceStride(P){switch(P){case o.UVKind:case o.UV2Kind:case o.UV3Kind:case o.UV4Kind:case o.UV5Kind:case o.UV6Kind:return 2;case o.NormalKind:case o.PositionKind:return 3;case o.ColorKind:case o.ColorInstanceKind:case o.MatricesIndicesKind:case o.MatricesIndicesExtraKind:case o.MatricesWeightsKind:case o.MatricesWeightsExtraKind:case o.TangentKind:return 4;default:throw new Error("Invalid kind '"+P+"'")}}static GetDataType(P){return P instanceof Int8Array?o.BYTE:P instanceof Uint8Array?o.UNSIGNED_BYTE:P instanceof Int16Array?o.SHORT:P instanceof Uint16Array?o.UNSIGNED_SHORT:P instanceof Int32Array?o.INT:P instanceof Uint32Array?o.UNSIGNED_INT:o.FLOAT}static GetTypeByteLength(P){return(0,m.o)(P)}static ForEach(P,f,Y,C,q,L,o,w){(0,m.i)(P,f,Y,C,q,L,o,((P,f)=>{for(let Y=0;Y<C;Y++)w(P[Y],f+Y)}))}static GetFloatData(P,f,Y,C,q,L,o,w){return(0,m.k)(P,f,Y,C,q,L,o,w)}}o._Counter=0,o.BYTE=5120,o.UNSIGNED_BYTE=5121,o.SHORT=5122,o.UNSIGNED_SHORT=5123,o.INT=5124,o.UNSIGNED_INT=5125,o.FLOAT=5126,o.PositionKind="position",o.NormalKind="normal",o.TangentKind="tangent",o.UVKind="uv",o.UV2Kind="uv2",o.UV3Kind="uv3",o.UV4Kind="uv4",o.UV5Kind="uv5",o.UV6Kind="uv6",o.ColorKind="color",o.ColorInstanceKind="instanceColor",o.MatricesIndicesKind="matricesIndices",o.MatricesWeightsKind="matricesWeights",o.MatricesIndicesExtraKind="matricesIndicesExtra",o.MatricesWeightsExtraKind="matricesWeightsExtra"},11273:(P,f,Y)=>{Y.d(f,{c:()=>r,f:()=>y,i:()=>w,k:()=>d,o:()=>L,p:()=>o,q:()=>R});var C=Y(11025);function q(P,f,Y,C){switch(f){case 5120:{let f=P.getInt8(Y);return C&&(f=Math.max(f/127,-1)),f}case 5121:{let f=P.getUint8(Y);return C&&(f/=255),f}case 5122:{let f=P.getInt16(Y,!0);return C&&(f=Math.max(f/32767,-1)),f}case 5123:{let f=P.getUint16(Y,!0);return C&&(f/=65535),f}case 5124:return P.getInt32(Y,!0);case 5125:return P.getUint32(Y,!0);case 5126:return P.getFloat32(Y,!0);default:throw new Error(`Invalid component type ${f}`)}}function m(P,f,Y,C,q){switch(f){case 5120:C&&(q=Math.round(127*q)),P.setInt8(Y,q);break;case 5121:C&&(q=Math.round(255*q)),P.setUint8(Y,q);break;case 5122:C&&(q=Math.round(32767*q)),P.setInt16(Y,q,!0);break;case 5123:C&&(q=Math.round(65535*q)),P.setUint16(Y,q,!0);break;case 5124:P.setInt32(Y,q,!0);break;case 5125:P.setUint32(Y,q,!0);break;case 5126:P.setFloat32(Y,q,!0);break;default:throw new Error(`Invalid component type ${f}`)}}function L(P){switch(P){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${P}'`)}}function o(P){switch(P){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${P}'`)}}function w(P,f,Y,C,o,w,d,R){const y=new Array(C),r=new Array(C);if(P instanceof Array){let q=f/4;const m=Y/4;for(let f=0;f<w;f+=C){for(let f=0;f<C;f++)y[f]=r[f]=P[q+f];R(r,f);for(let f=0;f<C;f++)y[f]!==r[f]&&(P[q+f]=r[f]);q+=m}}else{const i=ArrayBuffer.isView(P)?new DataView(P.buffer,P.byteOffset,P.byteLength):new DataView(P),u=L(o);for(let P=0;P<w;P+=C){for(let P=0,Y=f;P<C;P++,Y+=u)y[P]=r[P]=q(i,o,Y,d);R(r,P);for(let P=0,Y=f;P<C;P++,Y+=u)y[P]!==r[P]&&m(i,o,Y,d,r[P]);f+=Y}}}function d(P,f,Y,q,m,o,d,R){const y=f*L(Y),r=d*f;if(5126!==Y||m!==y){const C=new Float32Array(r);return w(P,q,m,f,Y,r,o,((P,Y)=>{for(let q=0;q<f;q++)C[Y+q]=P[q]})),C}if(!(P instanceof Array||P instanceof Float32Array)||0!==q||P.length!==r){if(P instanceof Array){const f=q/4;return P.slice(f,f+r)}if(P instanceof ArrayBuffer)return new Float32Array(P,q,r);{const f=P.byteOffset+q;return 0!==(3&f)&&(C.e.Warn("Float array must be aligned to 4-bytes border"),R=!0),R?new Float32Array(P.buffer.slice(f,f+r*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(P.buffer,f,r)}}return R?P.slice():P}function R(P,f,Y,q,m,d,R,y){const r=L(Y),i=o(Y),u=R*f;if(Array.isArray(P)){if(0!==(3&q)||0!==(3&m))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const C=q/4,L=m/4;if(C+(R-1)*L+f>P.length)throw new Error("Last accessed index is out of bounds.");if(L<f)throw new Error("Data stride cannot be smaller than the component size.");if(L!==f){const C=new i(u);return w(P,q,m,f,Y,u,d,((P,Y)=>{for(let q=0;q<f;q++)C[Y+q]=P[q]})),C}return new i(P.slice(C,C+u))}let g,S=q;P instanceof ArrayBuffer?g=P:(g=P.buffer,S+=P.byteOffset);if(S+(R-1)*m+f*r>g.byteLength)throw new Error("Last accessed byte is out of bounds.");const K=f*r;if(m<K)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(m!==K){const P=new i(u);return w(g,S,m,f,Y,u,d,((Y,C)=>{for(let q=0;q<f;q++)P[C+q]=Y[q]})),P}return 1!==r&&0!==(S&r-1)&&(C.e.Warn("Array must be aligned to border of element size. Data will be copied."),y=!0),y?new i(g.slice(S,S+u*r)):new i(g,S,u)}function y(P,f,Y,q,m,o,d,R){const y=f*L(Y),r=d*f;if(R.length!==r)throw new Error("Output length is not valid");if(5126===Y&&m===y)if(P instanceof Array){const f=q/4;R.set(P,f)}else if(P instanceof ArrayBuffer){const f=new Float32Array(P,q,r);R.set(f)}else{const f=P.byteOffset+q;if(0!==(3&f))return C.e.Warn("Float array must be aligned to 4-bytes border"),void R.set(new Float32Array(P.buffer.slice(f,f+r*Float32Array.BYTES_PER_ELEMENT)));const Y=new Float32Array(P.buffer,f,r);R.set(Y)}else w(P,q,m,f,Y,r,o,((P,Y)=>{for(let C=0;C<f;C++)R[Y+C]=P[C]}))}function r(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(P)){for(let q=0;q<f;q++)if(P[Y+q]-C>65535)return!0;return!1}return 4===P.BYTES_PER_ELEMENT}},11264:(P,f,Y)=>{Y.d(f,{e:()=>C});class C{get underlyingResource(){return null}constructor(){this.references=0,this.eY=0,this.is32Bits=!1,this.uniqueId=C._Counter++}}C._Counter=0},11304:(P,f,Y)=>{Y.d(f,{d:()=>q});var C=Y(11087);class q{static GetEffect(P){return void 0===P.getPipelineContext?P.effect:P}constructor(P){let f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=P.createDrawContext(),f&&(this.materialContext=P.createMaterialContext())}setEffect(P,f){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var C;(this.effect=P,void 0!==f&&(this.defines=f),Y)&&(null===(C=this.drawContext)||void 0===C||C.reset())}dispose(){var P;let f=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const P=this.effect;f?P.dispose():C.b.SetImmediate((()=>{P.getEngine().onEndFrameObservable.addOnce((()=>{P.dispose()}))})),this.effect=null}null===(P=this.drawContext)||void 0===P||P.dispose()}}},11397:(P,f,Y)=>{Y.d(f,{e:()=>q});var C=Y(11230);class q{static GetPlanes(P){const f=[];for(let Y=0;Y<6;Y++)f.push(new C.d(0,0,0,0));return q.GetPlanesToRef(P,f),f}static GetNearPlaneToRef(P,f){const Y=P.m;f.normal.x=Y[3]+Y[2],f.normal.y=Y[7]+Y[6],f.normal.z=Y[11]+Y[10],f.d=Y[15]+Y[14],f.normalize()}static GetFarPlaneToRef(P,f){const Y=P.m;f.normal.x=Y[3]-Y[2],f.normal.y=Y[7]-Y[6],f.normal.z=Y[11]-Y[10],f.d=Y[15]-Y[14],f.normalize()}static GetLeftPlaneToRef(P,f){const Y=P.m;f.normal.x=Y[3]+Y[0],f.normal.y=Y[7]+Y[4],f.normal.z=Y[11]+Y[8],f.d=Y[15]+Y[12],f.normalize()}static GetRightPlaneToRef(P,f){const Y=P.m;f.normal.x=Y[3]-Y[0],f.normal.y=Y[7]-Y[4],f.normal.z=Y[11]-Y[8],f.d=Y[15]-Y[12],f.normalize()}static GetTopPlaneToRef(P,f){const Y=P.m;f.normal.x=Y[3]-Y[1],f.normal.y=Y[7]-Y[5],f.normal.z=Y[11]-Y[9],f.d=Y[15]-Y[13],f.normalize()}static GetBottomPlaneToRef(P,f){const Y=P.m;f.normal.x=Y[3]+Y[1],f.normal.y=Y[7]+Y[5],f.normal.z=Y[11]+Y[9],f.d=Y[15]+Y[13],f.normalize()}static GetPlanesToRef(P,f){q.GetNearPlaneToRef(P,f[0]),q.GetFarPlaneToRef(P,f[1]),q.GetLeftPlaneToRef(P,f[2]),q.GetRightPlaneToRef(P,f[3]),q.GetTopPlaneToRef(P,f[4]),q.GetBottomPlaneToRef(P,f[5])}static IsPointInFrustum(P,f){for(let Y=0;Y<6;Y++)if(f[Y].dotCoordinate(P)<0)return!1;return!0}}},11410:(P,f,Y)=>{Y.d(f,{b:()=>q});var C=Y(11035);class q{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(P,f){q.Enabled&&(this._current+=P,f&&this._fetchResult())}beginMonitoring(){q.Enabled&&(this._startMonitoringTime=C.e.Now)}endMonitoring(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!q.Enabled)return;P&&this.fetchNewFrame();const f=C.e.Now;this._current=f-this._startMonitoringTime,P&&this._fetchResult()}Vf(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const P=C.e.Now;P-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=P,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}q.Enabled=!0},11280:(P,f,Y)=>{Y.d(f,{b:()=>q,f:()=>C});class C{constructor(P){this.length=0,this.data=new Array(P),this._id=C._GlobalId++}push(P){this.data[this.length++]=P,this.length>this.data.length&&(this.data.length*=2)}forEach(P){for(let f=0;f<this.length;f++)P(this.data[f])}sort(P){this.data.sort(P)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(P){if(0!==P.length){this.length+P.length>this.data.length&&(this.data.length=2*(this.length+P.length));for(let f=0;f<P.length;f++)this.data[this.length++]=(P.data||P)[f]}}indexOf(P){const f=this.data.indexOf(P);return f>=this.length?-1:f}contains(P){return-1!==this.indexOf(P)}}C._GlobalId=0;class q extends C{constructor(){super(...arguments),this._duplicateId=0}push(P){super.push(P),P.__smartArrayFlags||(P.__smartArrayFlags={}),P.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(P){return(!P.__smartArrayFlags||P.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(P),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(P){if(0!==P.length){this.length+P.length>this.data.length&&(this.data.length=2*(this.length+P.length));for(let f=0;f<P.length;f++){const Y=(P.data||P)[f];this.pushNoDuplicate(Y)}}}}},11249:(P,f,Y)=>{Y.d(f,{e:()=>m});var C=Y(11255),q=Y(11018);class m{constructor(P){this._vertexBuffers={},this.onBeforeRenderObservable=new q.e,this._scene=P}_prepareBuffers(){if(this._vertexBuffers[C.d.PositionKind])return;const P=[];P.push(1,1),P.push(-1,1),P.push(-1,-1),P.push(1,-1),this._vertexBuffers[C.d.PositionKind]=new C.d(this._scene.getEngine(),P,C.d.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const P=[];P.push(0),P.push(1),P.push(2),P.push(0),P.push(2),P.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(P)}_rebuild(){const P=this._vertexBuffers[C.d.PositionKind];P&&(P._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const Y=this._scene.activeCamera;return!!Y&&(f=f||Y._postProcesses.filter((P=>null!=P)),!(!f||0===f.length||!this._scene.postProcessesEnabled)&&(f[0].activate(Y,P,null!==f&&void 0!==f),!0))}directRender(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,m=arguments.length>5&&void 0!==arguments[5]&&arguments[5],L=arguments.length>6&&void 0!==arguments[6]?arguments[6]:P.length;const o=this._scene.getEngine();for(let d=0;d<L;d++){var w;if(d<P.length-1)P[d+1].activate(this._scene.activeCamera||this._scene,null===f||void 0===f?void 0:f.texture);else f?o.bindFramebuffer(f,C,void 0,void 0,Y,q):m||o.restoreDefaultFramebuffer(),null===(w=o._debugInsertMarker)||void 0===w||w.call(o,`post process ${P[d].name} output`);const L=P[d],R=L.apply();R&&(L.onBeforeRenderObservable.notifyObservers(R),this._prepareBuffers(),o.bindBuffers(this._vertexBuffers,this._indexBuffer,R),o.drawElementsType(0,0,6),L.onAfterRenderObservable.notifyObservers(R))}o.setDepthBuffer(!0),o.setDepthWrite(!0)}_finalizeFrame(P,f,Y,C){let q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const m=this._scene.activeCamera;if(!m)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(C=C||m._postProcesses.filter((P=>null!=P))).length||!this._scene.postProcessesEnabled)return;const L=this._scene.getEngine();for(let w=0,d=C.length;w<d;w++){const R=C[w];var o;if(w<d-1)R._outputTexture=C[w+1].activate(m,null===f||void 0===f?void 0:f.texture);else f?(L.bindFramebuffer(f,Y,void 0,void 0,q),R._outputTexture=f):(L.restoreDefaultFramebuffer(),R._outputTexture=null),null===(o=L._debugInsertMarker)||void 0===o||o.call(L,`post process ${C[w].name} output`);if(P)break;const y=R.apply();y&&(R.onBeforeRenderObservable.notifyObservers(y),this._prepareBuffers(),L.bindBuffers(this._vertexBuffers,this._indexBuffer,y),L.drawElementsType(0,0,6),R.onAfterRenderObservable.notifyObservers(y))}L.setDepthBuffer(!0),L.setDepthWrite(!0),L.setAlphaMode(0)}dispose(){const P=this._vertexBuffers[C.d.PositionKind];P&&(P.dispose(),this._vertexBuffers[C.d.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11276:(P,f,Y)=>{Y.d(f,{c:()=>o});var C=Y(11280),q=Y(11179);class m{set opaqueSortCompareFn(P){this._opaqueSortCompareFn=P||m.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(P){this._alphaTestSortCompareFn=P||m.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(P){this._transparentSortCompareFn=P||m.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(P,f){let Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,m=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=P,this._opaqueSubMeshes=new C.f(256),this._transparentSubMeshes=new C.f(256),this._alphaTestSubMeshes=new C.f(256),this._depthOnlySubMeshes=new C.f(256),this._particleSystems=new C.f(256),this._spriteManagers=new C.f(256),this._empty=!0,this._edgesRenderers=new C.b(16),this._scene=f,this.opaqueSortCompareFn=Y,this.alphaTestSortCompareFn=q,this.transparentSortCompareFn=m}render(P,f,Y,C){if(P)return void P(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const q=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(q.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),q.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const m=q.getStencilBuffer();if(q.setStencilBuffer(!1),f&&this._renderSprites(),Y&&this._renderParticles(C),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(q.setStencilBuffer(m),this._scene.useOrderIndependentTransparency){const P=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);P.length&&this._renderTransparent(P)}else this._renderTransparent(this._transparentSubMeshes);q.setAlphaMode(0)}if(q.setStencilBuffer(!1),this._edgesRenderers.length){for(let P=0;P<this._edgesRenderers.length;P++)this._edgesRenderers.data[P].render();q.setAlphaMode(0)}q.setStencilBuffer(m)}_renderOpaqueSorted(P){m._RenderSorted(P,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(P){m._RenderSorted(P,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(P){m._RenderSorted(P,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(P,f,Y,C){let L,o=0;const w=Y?Y.globalPosition:m._ZeroVector;if(C)for(;o<P.length;o++)L=P.data[o],L._alphaIndex=L.getMesh().alphaIndex,L._distanceToCamera=q.Of.Distance(L.getBoundingInfo().boundingSphere.centerWorld,w);const d=P.length===P.data.length?P.data:P.data.slice(0,P.length);f&&d.sort(f);const R=d[0].getMesh().vP();for(o=0;o<d.length;o++)if(L=d[o],!R._activeMeshesFrozenButKeepClipping||L.isInFrustum(R._frustumPlanes)){if(C){const P=L.IP();if(P&&P.needDepthPrePass){const f=P.vP().getEngine();f.setColorWrite(!1),f.setAlphaMode(0),L.render(!1),f.setColorWrite(!0)}}L.render(C)}}static defaultTransparentSortCompare(P,f){return P._alphaIndex>f._alphaIndex?1:P._alphaIndex<f._alphaIndex?-1:m.backToFrontSortCompare(P,f)}static backToFrontSortCompare(P,f){return P._distanceToCamera<f._distanceToCamera?1:P._distanceToCamera>f._distanceToCamera?-1:0}static frontToBackSortCompare(P,f){return P._distanceToCamera<f._distanceToCamera?-1:P._distanceToCamera>f._distanceToCamera?1:0}static PainterSortCompare(P,f){const Y=P.getMesh(),C=f.getMesh();return Y.material&&C.material?Y.material.uniqueId-C.material.uniqueId:Y.uniqueId-C.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(P,f,Y){void 0===f&&(f=P.getMesh()),void 0===Y&&(Y=P.IP()),null!==Y&&void 0!==Y&&(Y.needAlphaBlendingForMesh(f)?this._transparentSubMeshes.push(P):Y.needAlphaTestingForMesh(f)?(Y.needDepthPrePass&&this._depthOnlySubMeshes.push(P),this._alphaTestSubMeshes.push(P)):(Y.needDepthPrePass&&this._depthOnlySubMeshes.push(P),this._opaqueSubMeshes.push(P)),f._renderingGroup=this,f._edgesRenderer&&f.isEnabled()&&f.isVisible&&f._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(f._edgesRenderer),this._empty=!1)}dispatchSprites(P){this._spriteManagers.push(P),this._empty=!1}dispatchParticles(P){this._particleSystems.push(P),this._empty=!1}_renderParticles(P){if(0===this._particleSystems.length)return;const f=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let Y=0;Y<this._particleSystems.length;Y++){const C=this._particleSystems.data[Y];if(0===(f&&f.layerMask&C.layerMask))continue;const q=C.k;q.position&&P&&-1===P.indexOf(q)||this._scene._activeParticles.addCount(C.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const P=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let f=0;f<this._spriteManagers.length;f++){const Y=this._spriteManagers.data[f];0!==(P&&P.layerMask&Y.layerMask)&&Y.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}m._ZeroVector=q.Of.Zero();class L{}class o{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(P){P!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=P,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const P of this._scene.meshes)if(P.Jf)for(const f of P.Jf)f._wasDispatched=!1;if(this._scene.spriteManagers)for(const P of this._scene.spriteManagers)P._wasDispatched=!1;for(const P of this._scene.Rr)P._wasDispatched=!1}constructor(P){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new L,this._maintainStateBetweenFrames=!1,this._scene=P;for(let f=o.MIN_RENDERINGGROUPS;f<o.MAX_RENDERINGGROUPS;f++)this._autoClearDepthStencil[f]={Qf:!0,depth:!0,stencil:!0}}getRenderingGroup(P){const f=P||0;return this._prepareRenderingGroup(f),this._renderingGroups[f]}_clearDepthStencilBuffer(){let P=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],f=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,P,f),this._depthStencilBufferAlreadyCleaned=!0)}render(P,f,Y,C){const q=this._renderingGroupInfo;if(q.lf=this._scene,q.camera=this._scene.activeCamera,q.renderingManager=this,this._scene.spriteManagers&&C)for(let m=0;m<this._scene.spriteManagers.length;m++){const P=this._scene.spriteManagers[m];this.dispatchSprites(P)}for(let m=o.MIN_RENDERINGGROUPS;m<o.MAX_RENDERINGGROUPS;m++){this._depthStencilBufferAlreadyCleaned=m===o.MIN_RENDERINGGROUPS;const L=this._renderingGroups[m];if(!L||L._empty)continue;const w=1<<m;if(q.renderingGroupId=m,this._scene.onBeforeRenderingGroupObservable.notifyObservers(q,w),o.AUTOCLEAR){const P=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(m):this._autoClearDepthStencil[m];P&&P.Qf&&this._clearDepthStencilBuffer(P.depth,P.stencil)}for(const P of this._scene._beforeRenderingGroupDrawStage)P.action(m);L.render(P,C,Y,f);for(const P of this._scene._afterRenderingGroupDrawStage)P.action(m);this._scene.onAfterRenderingGroupObservable.notifyObservers(q,w)}}reset(){if(!this.maintainStateBetweenFrames)for(let P=o.MIN_RENDERINGGROUPS;P<o.MAX_RENDERINGGROUPS;P++){const f=this._renderingGroups[P];f&&f.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let P=o.MIN_RENDERINGGROUPS;P<o.MAX_RENDERINGGROUPS;P++){const f=this._renderingGroups[P];f&&f.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let P=o.MIN_RENDERINGGROUPS;P<o.MAX_RENDERINGGROUPS;P++){const f=this._renderingGroups[P];f&&f.dispose()}}_prepareRenderingGroup(P){void 0===this._renderingGroups[P]&&(this._renderingGroups[P]=new m(P,this._scene,this._customOpaqueSortCompareFn[P],this._customAlphaTestSortCompareFn[P],this._customTransparentSortCompareFn[P]))}dispatchSprites(P){this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(P.renderingGroupId).dispatchSprites(P))}dispatchParticles(P){this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(P.renderingGroupId).dispatchParticles(P))}dispatch(P,f,Y){void 0===f&&(f=P.getMesh()),this.maintainStateBetweenFrames&&P._wasDispatched||(P._wasDispatched=!0,this.getRenderingGroup(f.renderingGroupId).dispatch(P,f,Y))}setRenderingOrder(P){let f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Y=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,C=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[P]=f,this._customAlphaTestSortCompareFn[P]=Y,this._customTransparentSortCompareFn[P]=C,this._renderingGroups[P]){const f=this._renderingGroups[P];f.opaqueSortCompareFn=this._customOpaqueSortCompareFn[P],f.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[P],f.transparentSortCompareFn=this._customTransparentSortCompareFn[P]}}setRenderingAutoClearDepthStencil(P,f){let Y=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],C=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[P]={Qf:f,depth:Y,stencil:C}}getAutoClearDepthStencilSetup(P){return this._autoClearDepthStencil[P]}}o.MAX_RENDERINGGROUPS=4,o.MIN_RENDERINGGROUPS=0,o.AUTOCLEAR=!0}}]);