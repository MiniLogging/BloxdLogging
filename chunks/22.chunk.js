"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[22],{12202:(f,z,w)=>{w.d(z,{b:()=>S});class S{get underlyingResource(){return this._webGLTexture}constructor(){let f=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,z=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=z,!f&&(f=z.createTexture(),!f))throw new Error("Unable to create webGL texture");this.set(f)}setUsage(){}set(f){this._webGLTexture=f}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(f){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(f)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const f of this._MSAARenderBuffers)this._context.deleteRenderbuffer(f);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var f;let z=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(f=this._MSAARenderBuffers)||void 0===f?void 0:f[z])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},12186:(f,z,w)=>{w.r(z),w.d(z,{ThinEngine:()=>V});var S=w(644),C=w(12195),E=w(548),F=w(540);class J{constructor(){this.shaderLanguage=0}postProcessor(f,z,w,S,C){if(C.drawBuffersExtensionDisabled){const z=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;f=f.replace(z,"")}return f}}const x=/(flat\s)?\s*varying\s*.*/;class u{constructor(){this.shaderLanguage=0}attributeProcessor(f){return f.replace("attribute","in")}varyingCheck(f,z){return x.test(f)}varyingProcessor(f,z){return f.replace("varying",z?"in":"out")}postProcessor(f,z,w){const S=-1!==f.search(/#extension.+GL_EXT_draw_buffers.+require/);if(f=(f=f.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),w){const z=-1!==f.search(/layout *\(location *= *0\) *out/g);f=(f=(f=(f=(f=(f=(f=f.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(S||z?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==z.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+f}return f}}var h=w(12198),X=w(670),K=w(616),c=w(12202),y=w(650),e=w(624),O=w(604),d=w(635);class B{}class V extends K.e{get name(){return this._name}set name(f){this._name=f}get version(){return this._webGLVersion}static get ShadersRepository(){return e.e.ShadersRepository}static set ShadersRepository(f){e.e.ShadersRepository=f}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(f){this._framebufferDimensionsObject=f}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(f,z,w,C){if(w=w||{},super(z??w.antialias,w,C),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!f)return;let F=null;if(f.getContext){if(F=f,this._renderingCanvas=F,void 0===w.Og&&(w.Og=!1),void 0===w.xrCompatible&&(w.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const f=navigator.userAgent;for(const z of V.ExceptionList){const S=z.key,C=z.targets;if(new RegExp(S).test(f)){if(z.capture&&z.captureConstraint){const w=z.capture,S=z.captureConstraint,C=new RegExp(w).exec(f);if(C&&C.length>0){if(parseInt(C[C.length-1])>=S)continue}}for(const f of C)switch(f){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":w.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=f=>{f.preventDefault(),this._contextWasLost=!0,E.b.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},F.addEventListener("webglcontextlost",this._onContextLost,!1),F.addEventListener("webglcontextrestored",this._onContextRestored,!1),w.powerPreference=w.powerPreference||"high-performance"),this._badDesktopOS&&(w.xrCompatible=!1),!w.disableWebGL2Support)try{this._gl=F.getContext("webgl2",w)||F.getContext("experimental-webgl2",w),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(X){}if(!this._gl){if(!F)throw new Error("The provided canvas is null or undefined.");try{this._gl=F.getContext("webgl",w)||F.getContext("experimental-webgl",w)}catch(X){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=f,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const z=this._gl.getContextAttributes();z&&(w.stencil=z.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==w.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=w.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let S=0;S<this._caps.maxVertexAttribs;S++)this._currentBufferPointers[S]=new B;this._shaderProcessor=this.webGLVersion>1?new u:new J;const x=`Babylon.js v${V.Version}`;E.b.Log(x+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",x);const h=(0,S.A)(this._gl);h.validateShaderPrograms=this.validateShaderPrograms,h.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(f){return null}areAllEffectsReady(){for(const f in this._compiledEffects){if(!this._compiledEffects[f].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const f=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=f&&(this._glRenderer=this._gl.getParameter(f.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(f.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const f=this._gl.getExtension("WEBGL_draw_buffers");if(null!==f){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=f.drawBuffersWEBGL.bind(f),this._caps.maxDrawBuffers=this._gl.getParameter(f.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let z=0;z<16;z++)this._gl["COLOR_ATTACHMENT"+z+"_WEBGL"]=f["COLOR_ATTACHMENT"+z+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const f=this._gl.getExtension("WEBGL_depth_texture");null!=f&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=f.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const f=this._gl.getExtension("OES_vertex_array_object");null!=f&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=f.createVertexArrayOES.bind(f),this._gl.bindVertexArray=f.bindVertexArrayOES.bind(f),this._gl.deleteVertexArray=f.deleteVertexArrayOES.bind(f))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const f=this._gl.getExtension("ANGLE_instanced_arrays");null!=f?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=f.drawArraysInstancedANGLE.bind(f),this._gl.drawElementsInstanced=f.drawElementsInstancedANGLE.bind(f),this._gl.vertexAttribDivisor=f.vertexAttribDivisorANGLE.bind(f)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const f=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),z=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);f&&z&&(this._caps.highPrecisionShaderSupported=0!==f.precision&&0!==z.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const f=this._gl.getExtension("EXT_blend_minmax");null!=f&&(this._caps.blendMinMax=!0,this._gl.MAX=f.MAX_EXT,this._gl.MIN=f.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const f=this._gl.getExtension("EXT_sRGB");null!=f&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:f.SRGB_EXT,SRGB8:f.SRGB_ALPHA_EXT,SRGB8_ALPHA8:f.SRGB_ALPHA_EXT})}if(this._creationOptions){const f=this._creationOptions.forceSRGBBufferSupportState;void 0!==f&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&f)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let z=0;z<this._maxSimultaneousTextures;z++)this._nextFreeTextureSlots.push(z);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const f=this._workingCanvas.getContext("2d");f&&(this._workingContext=f)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const f=this.getGlInfo();return f&&f.renderer?f.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(f,z,w){let S=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=C;let E=0;if(z&&f){let z=!0;if(this._currentRenderTarget){var F;const w=null===(F=this._currentRenderTarget.texture)||void 0===F?void 0:F.format;if(8===w||9===w||10===w||11===w){var J;const w=null===(J=this._currentRenderTarget.texture)||void 0===J?void 0:J.type;7===w||5===w?(V._TempClearColorUint32[0]=255*f.r,V._TempClearColorUint32[1]=255*f.g,V._TempClearColorUint32[2]=255*f.b,V._TempClearColorUint32[3]=255*f.a,this._gl.clearBufferuiv(this._gl.COLOR,0,V._TempClearColorUint32),z=!1):(V._TempClearColorInt32[0]=255*f.r,V._TempClearColorInt32[1]=255*f.g,V._TempClearColorInt32[2]=255*f.b,V._TempClearColorInt32[3]=255*f.a,this._gl.clearBufferiv(this._gl.COLOR,0,V._TempClearColorInt32),z=!1)}}z&&(this._gl.clearColor(f.r,f.g,f.b,void 0!==f.a?f.a:1),E|=this._gl.COLOR_BUFFER_BIT)}w&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),E|=this._gl.DEPTH_BUFFER_BIT),S&&(this._gl.clearStencil(0),E|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(E)}_viewport(f,z,w,S){f===this._viewportCached.x&&z===this._viewportCached.y&&w===this._viewportCached.z&&S===this._viewportCached.w||(this._viewportCached.x=f,this._viewportCached.y=z,this._viewportCached.z=w,this._viewportCached.w=S,this._gl.viewport(f,z,w,S))}hk(){super.hk(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const x=f;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=f,this._bindUnboundFramebuffer(x._framebuffer);const u=this._gl;var h;if(!f.isMulti)if(f.is2DArray||f.is3D)u.framebufferTextureLayer(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,null===(h=f.texture._hardwareTexture)||void 0===h?void 0:h.underlyingResource,F,J),x._currentLOD=F;else if(f.isCube){var X;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_CUBE_MAP_POSITIVE_X+z,null===(X=f.texture._hardwareTexture)||void 0===X?void 0:X.underlyingResource,F)}else if(x._currentLOD!==F){var K;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,null===(K=f.texture._hardwareTexture)||void 0===K?void 0:K.underlyingResource,F),x._currentLOD=F}const c=f._depthStencilTexture;if(c){f.is3D&&(f.texture.width===c.width&&f.texture.height===c.height&&f.texture.depth===c.depth||E.b.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const w=f._depthStencilTextureWithStencil?u.DEPTH_STENCIL_ATTACHMENT:u.DEPTH_ATTACHMENT;var y;if(f.is2DArray||f.is3D)u.framebufferTextureLayer(u.FRAMEBUFFER,w,null===(y=c._hardwareTexture)||void 0===y?void 0:y.underlyingResource,F,J);else if(f.isCube){var e;u.framebufferTexture2D(u.FRAMEBUFFER,w,u.TEXTURE_CUBE_MAP_POSITIVE_X+z,null===(e=c._hardwareTexture)||void 0===e?void 0:e.underlyingResource,F)}else{var O;u.framebufferTexture2D(u.FRAMEBUFFER,w,u.TEXTURE_2D,null===(O=c._hardwareTexture)||void 0===O?void 0:O.underlyingResource,F)}}x._MSAAFramebuffer&&this._bindUnboundFramebuffer(x._MSAAFramebuffer),this._cachedViewport&&!C?this.setViewport(this._cachedViewport,w,S):(w||(w=f.width,F&&(w/=Math.pow(2,F))),S||(S=f.height,F&&(S/=Math.pow(2,F))),this._viewport(0,0,w,S)),this.wipeCaches()}setState(f){let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,w=arguments.length>2?arguments[2]:void 0,S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,E=arguments.length>5?arguments[5]:void 0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==f||w)&&(this._depthCullingState.cull=f);const J=this.cullBackFaces??C??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==J||w)&&(this._depthCullingState.cullFace=J),this.setZOffset(z),this.setZOffsetUnits(F);const x=S?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==x||w)&&(this._depthCullingState.frontFace=x),this._stencilStateComposer.stencilMaterial=E}_bindUnboundFramebuffer(f){this._currentFramebuffer!==f&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,f),this._currentFramebuffer=f)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(f){const z=this._getTextureTarget(f);this._bindTextureDirectly(z,f,!0),this._gl.generateMipmap(z),this._bindTextureDirectly(z,null)}unBindFramebuffer(f){var z;let w=arguments.length>1&&void 0!==arguments[1]&&arguments[1],S=arguments.length>2?arguments[2]:void 0;const C=f;this._currentRenderTarget=null;const E=this._gl;if(C._MSAAFramebuffer){if(f.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(f,w,S);E.bindFramebuffer(E.READ_FRAMEBUFFER,C._MSAAFramebuffer),E.bindFramebuffer(E.DRAW_FRAMEBUFFER,C._framebuffer),E.blitFramebuffer(0,0,f.width,f.height,0,0,f.width,f.height,E.COLOR_BUFFER_BIT,E.NEAREST)}null===(z=f.texture)||void 0===z||!z.generateMipMaps||w||f.isCube||this.generateMipmaps(f.texture),S&&(C._MSAAFramebuffer&&this._bindUnboundFramebuffer(C._framebuffer),S()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(f,z,w){return this._createVertexBuffer(f,this._gl.STATIC_DRAW)}_createVertexBuffer(f,z){const w=this._gl.createBuffer();if(!w)throw new Error("Unable to create vertex buffer");const S=new h.e(w);return this.bindArrayBuffer(S),"number"!==typeof f?f instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(f),z),S._a=4*f.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,f,z),S._a=f.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(f),z),S._a=f),this._resetVertexBufferBinding(),S.references=1,S}createDynamicVertexBuffer(f,z){return this._createVertexBuffer(f,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(f,z,w){const S=this._gl.createBuffer(),C=new h.e(S);if(!S)throw new Error("Unable to create index buffer");this.bindIndexBuffer(C);const E=this._normalizeIndexData(f);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,E,z?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),C.references=1,C.is32Bits=4===E.BYTES_PER_ELEMENT,C}_normalizeIndexData(f){if(2===f.BYTES_PER_ELEMENT)return f;if(this._caps.uintIndices){if(f instanceof Uint32Array)return f;for(let z=0;z<f.length;z++)if(f[z]>=65535)return new Uint32Array(f);return new Uint16Array(f)}return new Uint16Array(f)}bindArrayBuffer(f){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(f,this._gl.ARRAY_BUFFER)}bindUniformBlock(f,z,w){const S=f.program,C=this._gl.getUniformBlockIndex(S,z);this._gl.uniformBlockBinding(S,C,w)}bindIndexBuffer(f){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(f,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(f,z){(this._vaoRecordInProgress||this._currentBoundBuffer[z]!==f)&&(this._gl.bindBuffer(z,f?f.underlyingResource:null),this._currentBoundBuffer[z]=f)}updateArrayBuffer(f){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,f)}_vertexAttribPointer(f,z,w,S,C,E,F){const J=this._currentBufferPointers[z];if(!J)return;let x=!1;J.active?(J.buffer!==f&&(J.buffer=f,x=!0),J.size!==w&&(J.size=w,x=!0),J.type!==S&&(J.type=S,x=!0),J.normalized!==C&&(J.normalized=C,x=!0),J.stride!==E&&(J.stride=E,x=!0),J.offset!==F&&(J.offset=F,x=!0)):(x=!0,J.active=!0,J.index=z,J.size=w,J.type=S,J.normalized=C,J.stride=E,J.offset=F,J.buffer=f),(x||this._vaoRecordInProgress)&&(this.bindArrayBuffer(f),S===this._gl.UNSIGNED_INT||S===this._gl.INT?this._gl.vertexAttribIPointer(z,w,S,E,F):this._gl.vertexAttribPointer(z,w,S,C,E,F))}_bindIndexBufferWithCache(f){null!=f&&this._cachedIndexBuffer!==f&&(this._cachedIndexBuffer=f,this.bindIndexBuffer(f),this._uintIndicesCurrentlySet=f.is32Bits)}_bindVertexBuffersAttributes(f,z,w){const S=z.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let C=0;C<S.length;C++){const E=z.getAttributeLocation(C);if(E>=0){const z=S[C];let F=null;if(w&&(F=w[z]),F||(F=f[z]),!F)continue;this._gl.enableVertexAttribArray(E),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[E]=!0);const J=F.getBuffer();J&&(this._vertexAttribPointer(J,E,F.getSize(),F.type,F.normalized,F.byteStride,F.byteOffset),F.getIsInstanced()&&(this._gl.vertexAttribDivisor(E,F.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(E),this._currentInstanceBuffers.push(J))))}}}recordVertexArrayObject(f,z,w,S){const C=this._gl.createVertexArray();if(!C)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(C),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(f,w,S),this.bindIndexBuffer(z),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),C}bindVertexArrayObject(f,z){this._cachedVertexArrayObject!==f&&(this._cachedVertexArrayObject=f,this._gl.bindVertexArray(f),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=z&&z.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(f,z,w,S,C){if(this._cachedVertexBuffers!==f||this._cachedEffectForVertexBuffers!==C){this._cachedVertexBuffers=f,this._cachedEffectForVertexBuffers=C;const z=C.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let E=0;for(let F=0;F<z;F++)if(F<w.length){const z=C.getAttributeLocation(F);z>=0&&(this._gl.enableVertexAttribArray(z),this._vertexAttribArraysEnabled[z]=!0,this._vertexAttribPointer(f,z,w[F],this._gl.FLOAT,!1,S,E)),E+=4*w[F]}}this._bindIndexBufferWithCache(z)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(f,z,w,S){this._cachedVertexBuffers===f&&this._cachedEffectForVertexBuffers===w||(this._cachedVertexBuffers=f,this._cachedEffectForVertexBuffers=w,this._bindVertexBuffersAttributes(f,w,S)),this._bindIndexBufferWithCache(z)}unbindInstanceAttributes(){let f;for(let z=0,w=this._currentInstanceLocations.length;z<w;z++){const w=this._currentInstanceBuffers[z];f!=w&&w.references&&(f=w,this.bindArrayBuffer(w));const S=this._currentInstanceLocations[z];this._gl.vertexAttribDivisor(S,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(f){this._gl.deleteVertexArray(f)}_releaseBuffer(f){return f.references--,0===f.references&&(this._deleteBuffer(f),!0)}_deleteBuffer(f){this._gl.deleteBuffer(f.underlyingResource)}updateAndBindInstancesBuffer(f,z,w){if(this.bindArrayBuffer(f),z&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,z),void 0!==w[0].index)this.bindInstancesBuffer(f,w,!0);else for(let S=0;S<4;S++){const z=w[S];this._vertexAttribArraysEnabled[z]||(this._gl.enableVertexAttribArray(z),this._vertexAttribArraysEnabled[z]=!0),this._vertexAttribPointer(f,z,4,this._gl.FLOAT,!1,64,16*S),this._gl.vertexAttribDivisor(z,1),this._currentInstanceLocations.push(z),this._currentInstanceBuffers.push(f)}}bindInstancesBuffer(f,z){let w=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(f);let S=0;if(w)for(let C=0;C<z.length;C++){S+=4*z[C].attributeSize}for(let C=0;C<z.length;C++){const w=z[C];void 0===w.index&&(w.index=this._currentEffect.getAttributeLocationByName(w.attributeName)),w.index<0||(this._vertexAttribArraysEnabled[w.index]||(this._gl.enableVertexAttribArray(w.index),this._vertexAttribArraysEnabled[w.index]=!0),this._vertexAttribPointer(f,w.index,w.attributeSize,w.attributeType||this._gl.FLOAT,w.normalized||!1,S,w.offset),this._gl.vertexAttribDivisor(w.index,void 0===w.divisor?1:w.divisor),this._currentInstanceLocations.push(w.index),this._currentInstanceBuffers.push(f))}}disableInstanceAttributeByName(f){if(!this._currentEffect)return;const z=this._currentEffect.getAttributeLocationByName(f);this.disableInstanceAttribute(z)}disableInstanceAttribute(f){let z,w=!1;for(;-1!==(z=this._currentInstanceLocations.indexOf(f));)this._currentInstanceLocations.splice(z,1),this._currentInstanceBuffers.splice(z,1),w=!0,z=this._currentInstanceLocations.indexOf(f);w&&(this._gl.vertexAttribDivisor(f,0),this.disableAttributeByIndex(f))}disableAttributeByIndex(f){this._gl.disableVertexAttribArray(f),this._vertexAttribArraysEnabled[f]=!1,this._currentBufferPointers[f].active=!1}draw(f,z,w,S){this.drawElementsType(f?0:1,z,w,S)}drawPointClouds(f,z,w){this.drawArraysType(2,f,z,w)}drawUnIndexed(f,z,w,S){this.drawArraysType(f?0:1,z,w,S)}drawElementsType(f,z,w,S){this.applyStates(),this._reportDrawCall();const C=this._drawMode(f),E=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,F=this._uintIndicesCurrentlySet?4:2;S?this._gl.drawElementsInstanced(C,w,E,z*F,S):this._gl.drawElements(C,w,E,z*F)}drawArraysType(f,z,w,S){this.applyStates(),this._reportDrawCall();const C=this._drawMode(f);S?this._gl.drawArraysInstanced(C,z,w,S):this._gl.drawArrays(C,z,w)}_drawMode(f){switch(f){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(f){this._compiledEffects[f._key]&&delete this._compiledEffects[f._key];const z=f.getPipelineContext();z&&this._deletePipelineContext(z)}_deletePipelineContext(f){const z=f;z&&z.program&&(z.program.__SPECTOR_rebuildProgram=null,(0,d.j)(z),this._gl.deleteProgram(z.program))}_getGlobalDefines(f){return(0,O.k)(f,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(f,z,w,C,E,F,J,x,u){let h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10?arguments[10]:void 0;const K="string"===typeof f?f:f.vertexToken||f.vertexSource||f.vertexElement||f.vertex,c="string"===typeof f?f:f.fragmentToken||f.fragmentSource||f.fragmentElement||f.fragment,y=this._getGlobalDefines();let O=E??z.defines??"";y&&(O+=y);const d=K+"+"+c+"@"+O;if(this._compiledEffects[d]){const f=this._compiledEffects[d];return J&&f.isReady()&&J(f),f._refCount++,f}this._gl&&(0,S.A)(this._gl);const B=new e.e(f,z,w,C,this,E,F,J,x,u,d,z.shaderLanguage??h,z.extraInitializationsAsync??X);return this._compiledEffects[d]=B,B}_getShaderSource(f){return this._gl.getShaderSource(f)}createRawShaderProgram(f,z,w,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const F=(0,S.A)(this._gl);return F._contextWasLost=this._contextWasLost,F.validateShaderPrograms=this.validateShaderPrograms,(0,S.v)(f,z,w,C||this._gl,E)}createShaderProgram(f,z,w,C,E){let F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const J=(0,S.A)(this._gl);return J._contextWasLost=this._contextWasLost,J.validateShaderPrograms=this.validateShaderPrograms,(0,S.x)(f,z,w,C,E||this._gl,F)}inlineShaderCode(f){return f}createPipelineContext(f){if(this._gl){(0,S.A)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const z=(0,S.r)(this._gl,f);return z.Wj=this,z}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(f){return(0,S.i)(f,this._gl,this.validateShaderPrograms)}_preparePipelineContext(f,z,w,C,E,F,J,x,u,h,X){const K=(0,S.A)(this._gl);return K._contextWasLost=this._contextWasLost,K.validateShaderPrograms=this.validateShaderPrograms,K._createShaderProgramInjection=this._createShaderProgram.bind(this),K.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),K.createShaderProgramInjection=this.createShaderProgram.bind(this),K.loadFileInjection=this._loadFile.bind(this),(0,S.m)(f,z,w,C,E,F,J,x,u,h,X)}_createShaderProgram(f,z,w,C){let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,S.d)(f,z,w,C,E)}_isRenderingStateCompiled(f){const z=f;return!this._isDisposed&&!z._isDisposed&&(!!this._gl.getProgramParameter(z.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(z),!0))}_executeWhenRenderingStateIsCompiled(f,z){(0,S.g)(f,z)}getUniforms(f,z){const w=new Array,S=f;for(let C=0;C<z.length;C++)w.push(this._gl.getUniformLocation(S.program,z[C]));return w}getAttributes(f,z){const w=[],S=f;for(let E=0;E<z.length;E++)try{w.push(this._gl.getAttribLocation(S.program,z[E]))}catch(C){w.push(-1)}return w}enableEffect(f){(f=null!==f&&(0,C.d)(f)?f.effect:f)&&f!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(f),this._currentEffect=f,f.onBind&&f.onBind(f),f._onBindObservable&&f._onBindObservable.notifyObservers(f))}setInt(f,z){return!!f&&(this._gl.uniform1i(f,z),!0)}setInt2(f,z,w){return!!f&&(this._gl.uniform2i(f,z,w),!0)}setInt3(f,z,w,S){return!!f&&(this._gl.uniform3i(f,z,w,S),!0)}setInt4(f,z,w,S,C){return!!f&&(this._gl.uniform4i(f,z,w,S,C),!0)}setIntArray(f,z){return!!f&&(this._gl.uniform1iv(f,z),!0)}setIntArray2(f,z){return!(!f||z.length%2!==0)&&(this._gl.uniform2iv(f,z),!0)}setIntArray3(f,z){return!(!f||z.length%3!==0)&&(this._gl.uniform3iv(f,z),!0)}setIntArray4(f,z){return!(!f||z.length%4!==0)&&(this._gl.uniform4iv(f,z),!0)}setUInt(f,z){return!!f&&(this._gl.uniform1ui(f,z),!0)}setUInt2(f,z,w){return!!f&&(this._gl.uniform2ui(f,z,w),!0)}setUInt3(f,z,w,S){return!!f&&(this._gl.uniform3ui(f,z,w,S),!0)}setUInt4(f,z,w,S,C){return!!f&&(this._gl.uniform4ui(f,z,w,S,C),!0)}setUIntArray(f,z){return!!f&&(this._gl.uniform1uiv(f,z),!0)}setUIntArray2(f,z){return!(!f||z.length%2!==0)&&(this._gl.uniform2uiv(f,z),!0)}setUIntArray3(f,z){return!(!f||z.length%3!==0)&&(this._gl.uniform3uiv(f,z),!0)}setUIntArray4(f,z){return!(!f||z.length%4!==0)&&(this._gl.uniform4uiv(f,z),!0)}setArray(f,z){return!!f&&(!(z.length<1)&&(this._gl.uniform1fv(f,z),!0))}setArray2(f,z){return!(!f||z.length%2!==0)&&(this._gl.uniform2fv(f,z),!0)}setArray3(f,z){return!(!f||z.length%3!==0)&&(this._gl.uniform3fv(f,z),!0)}setArray4(f,z){return!(!f||z.length%4!==0)&&(this._gl.uniform4fv(f,z),!0)}setMatrices(f,z){return!!f&&(this._gl.uniformMatrix4fv(f,!1,z),!0)}setMatrix3x3(f,z){return!!f&&(this._gl.uniformMatrix3fv(f,!1,z),!0)}setMatrix2x2(f,z){return!!f&&(this._gl.uniformMatrix2fv(f,!1,z),!0)}setFloat(f,z){return!!f&&(this._gl.uniform1f(f,z),!0)}setFloat2(f,z,w){return!!f&&(this._gl.uniform2f(f,z,w),!0)}setFloat3(f,z,w,S){return!!f&&(this._gl.uniform3f(f,z,w,S),!0)}setFloat4(f,z,w,S,C){return!!f&&(this._gl.uniform4f(f,z,w,S,C),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const f=this._colorWrite;this._gl.colorMask(f,f,f,f)}}wipeCaches(f){this.preventCacheWipeBetweenFrames&&!f||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),f&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(f,z){const w=this._gl;let S=w.NEAREST,C=w.NEAREST;switch(f){case 11:S=w.LINEAR,C=z?w.LINEAR_MIPMAP_NEAREST:w.LINEAR;break;case 3:S=w.LINEAR,C=z?w.LINEAR_MIPMAP_LINEAR:w.LINEAR;break;case 8:S=w.NEAREST,C=z?w.NEAREST_MIPMAP_LINEAR:w.NEAREST;break;case 4:S=w.NEAREST,C=z?w.NEAREST_MIPMAP_NEAREST:w.NEAREST;break;case 5:S=w.NEAREST,C=z?w.LINEAR_MIPMAP_NEAREST:w.LINEAR;break;case 6:S=w.NEAREST,C=z?w.LINEAR_MIPMAP_LINEAR:w.LINEAR;break;case 7:S=w.NEAREST,C=w.LINEAR;break;case 1:S=w.NEAREST,C=w.NEAREST;break;case 9:S=w.LINEAR,C=z?w.NEAREST_MIPMAP_NEAREST:w.NEAREST;break;case 10:S=w.LINEAR,C=z?w.NEAREST_MIPMAP_LINEAR:w.NEAREST;break;case 2:S=w.LINEAR,C=w.LINEAR;break;case 12:S=w.LINEAR,C=w.NEAREST}return{min:C,mag:S}}_createTexture(){const f=this._gl.createTexture();if(!f)throw new Error("Unable to create texture");return f}_createHardwareTexture(){return new c.b(this._createTexture(),this._gl)}_createInternalTexture(f,z){let w,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=!1,F=0,J=3,x=5,u=!1,h=1;void 0!==z&&"object"===typeof z?(C=!!z.generateMipMaps,F=void 0===z.type?0:z.type,J=void 0===z.samplingMode?3:z.samplingMode,x=void 0===z.format?5:z.format,u=void 0!==z.useSRGBBuffer&&z.useSRGBBuffer,h=z.samples??1,w=z.label):C=!!z,u&&(u=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==F||this._caps.textureFloatLinearFiltering)&&(2!==F||this._caps.textureHalfFloatLinearFiltering)||(J=1),1!==F||this._caps.textureFloat||(F=0,E.b.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const X=this._gl,K=new y.e(this,S),c=f.width||f,e=f.height||f,O=f.depth||0,d=f.layers||0,B=this._getSamplingParameters(J,C),V=0!==d?X.TEXTURE_2D_ARRAY:0!==O?X.TEXTURE_3D:X.TEXTURE_2D,W=this._getRGBABufferInternalSizedFormat(F,x,u),T=this._getInternalFormat(x),v=this._getWebGLTextureType(F);return this._bindTextureDirectly(V,K),0!==d?(K.is2DArray=!0,X.texImage3D(V,0,W,c,e,d,0,T,v,null)):0!==O?(K.is3D=!0,X.texImage3D(V,0,W,c,e,O,0,T,v,null)):X.texImage2D(V,0,W,c,e,0,T,v,null),X.texParameteri(V,X.TEXTURE_MAG_FILTER,B.mag),X.texParameteri(V,X.TEXTURE_MIN_FILTER,B.min),X.texParameteri(V,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(V,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),C&&this._gl.generateMipmap(V),this._bindTextureDirectly(V,null),K._useSRGBBuffer=u,K.baseWidth=c,K.baseHeight=e,K.width=c,K.height=e,K.depth=d,K.isReady=!0,K.samples=h,K.generateMipMaps=C,K.samplingMode=J,K.type=F,K.format=x,K.label=w,this._internalTexturesCache.push(K),K}_getUseSRGBBuffer(f,z){return f&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||z)}createTexture(f,z,w,S){var C=this;let E=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,x=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,K=arguments.length>11?arguments[11]:void 0,c=arguments.length>12?arguments[12]:void 0,e=arguments.length>13?arguments[13]:void 0,O=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(f,z,w,S,E,F,J,(function(){for(var f=arguments.length,z=new Array(f),w=0;w<f;w++)z[w]=arguments[w];return C._prepareWebGLTexture(...z,h)}),((f,z,w,C,E,F)=>{const J=this._gl,x=w.width===f&&w.height===z;E._creationFlags=e??0;const u=this._getTexImageParametersForCreateTexture(E.format,E._useSRGBBuffer);if(x)return J.texImage2D(J.TEXTURE_2D,0,u.internalFormat,u.format,u.type,w),!1;const h=this._caps.maxTextureSize;if(w.width>h||w.height>h||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=f,this._workingCanvas.height=z,this._workingContext.drawImage(w,0,0,w.width,w.height,0,0,f,z),J.texImage2D(J.TEXTURE_2D,0,u.internalFormat,u.format,u.type,this._workingCanvas),E.width=f,E.height=z,!1);{const f=new y.e(this,2);this._bindTextureDirectly(J.TEXTURE_2D,f,!0),J.texImage2D(J.TEXTURE_2D,0,u.internalFormat,u.format,u.type,w),this._rescaleTexture(f,E,S,u.format,(()=>{this._releaseTexture(f),this._bindTextureDirectly(J.TEXTURE_2D,E,!0),F()}))}return!0}),x,u,h,X,K,c,O)}_getTexImageParametersForCreateTexture(f,z){let w,S;return 1===this.webGLVersion?(w=this._getInternalFormat(f,z),S=w):(w=this._getInternalFormat(f,!1),S=this._getRGBABufferInternalSizedFormat(0,f,z)),{internalFormat:S,format:w,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(f,z,w,S,C){}_unpackFlipY(f){this._unpackFlipYCached!==f&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,f?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=f))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(f){return f.isCube?this._gl.TEXTURE_CUBE_MAP:f.is3D?this._gl.TEXTURE_3D:f.is2DArray||f.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const S=this._getTextureTarget(z),C=this._getSamplingParameters(f,z.useMipMaps||w);this._setTextureParameterInteger(S,this._gl.TEXTURE_MAG_FILTER,C.mag,z),this._setTextureParameterInteger(S,this._gl.TEXTURE_MIN_FILTER,C.min),w&&(z.generateMipMaps=!0,this._gl.generateMipmap(S)),this._bindTextureDirectly(S,null),z.samplingMode=f}updateTextureDimensions(f,z,w){}updateTextureWrappingMode(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const C=this._getTextureTarget(f);null!==z&&(this._setTextureParameterInteger(C,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(z),f),f._cachedWrapU=z),null!==w&&(this._setTextureParameterInteger(C,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(w),f),f._cachedWrapV=w),(f.is2DArray||f.is3D)&&null!==S&&(this._setTextureParameterInteger(C,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(S),f),f._cachedWrapR=S),this._bindTextureDirectly(C,null)}_uploadCompressedDataToTextureDirectly(f,z,w,S,C){let E=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const J=this._gl;let x=J.TEXTURE_2D;if(f.isCube&&(x=J.TEXTURE_CUBE_MAP_POSITIVE_X+E),f._useSRGBBuffer)switch(z){case 37492:case 36196:this._caps.etc2?z=J.COMPRESSED_SRGB8_ETC2:f._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?z=J.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:f._useSRGBBuffer=!1;break;case 36492:z=J.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:z=J.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?z=J.COMPRESSED_SRGB_S3TC_DXT1_EXT:f._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?z=J.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:f._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?z=J.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:f._useSRGBBuffer=!1;break;default:f._useSRGBBuffer=!1}this._gl.compressedTexImage2D(x,F,z,w,S,0,C)}_uploadDataToTextureDirectly(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4?arguments[4]:void 0,E=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=this._gl,J=this._getWebGLTextureType(f.type),x=this._getInternalFormat(f.format),u=void 0===C?this._getRGBABufferInternalSizedFormat(f.type,f.format,f._useSRGBBuffer):this._getInternalFormat(C,f._useSRGBBuffer);this._unpackFlipY(f.invertY);let h=F.TEXTURE_2D;f.isCube&&(h=F.TEXTURE_CUBE_MAP_POSITIVE_X+w);const X=Math.round(Math.log(f.width)*Math.LOG2E),K=Math.round(Math.log(f.height)*Math.LOG2E),c=E?f.width:Math.pow(2,Math.max(X-S,0)),y=E?f.height:Math.pow(2,Math.max(K-S,0));F.texImage2D(h,S,u,c,y,0,x,J,z)}updateTextureData(f,z,w,S,C,E){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,J=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,x=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const u=this._gl,h=this._getWebGLTextureType(f.type),X=this._getInternalFormat(f.format);this._unpackFlipY(f.invertY);let K=u.TEXTURE_2D,c=u.TEXTURE_2D;f.isCube&&(c=u.TEXTURE_CUBE_MAP_POSITIVE_X+F,K=u.TEXTURE_CUBE_MAP),this._bindTextureDirectly(K,f,!0),u.texSubImage2D(c,J,w,S,C,E,X,h,z),x&&this._gl.generateMipmap(c),this._bindTextureDirectly(K,null)}_uploadArrayBufferViewToTexture(f,z){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const C=this._gl,E=f.isCube?C.TEXTURE_CUBE_MAP:C.TEXTURE_2D;this._bindTextureDirectly(E,f,!0),this._uploadDataToTextureDirectly(f,z,w,S),this._bindTextureDirectly(E,null,!0)}_prepareWebGLTextureContinuation(f,z,w,S,C){const E=this._gl;if(!E)return;const F=this._getSamplingParameters(C,!w);E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,F.mag),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,F.min),w||S||E.generateMipmap(E.TEXTURE_2D),this._bindTextureDirectly(E.TEXTURE_2D,null),z&&z.removePendingData(f),f.onLoadedObservable.notifyObservers(f),f.onLoadedObservable.clear()}_prepareWebGLTexture(f,z,w,S,C,E,F,J,x,u){const h=this.getCaps().maxTextureSize,K=Math.min(h,this.needPOTTextures?(0,X.f)(S.width,h):S.width),c=Math.min(h,this.needPOTTextures?(0,X.f)(S.height,h):S.height),y=this._gl;y&&(f._hardwareTexture?(this._bindTextureDirectly(y.TEXTURE_2D,f,!0),this._unpackFlipY(void 0===C||!!C),f.baseWidth=S.width,f.baseHeight=S.height,f.width=K,f.height=c,f.isReady=!0,f.type=-1!==f.type?f.type:0,f.format=-1!==f.format?f.format:u??(".jpg"!==z||f._useSRGBBuffer?5:4),J(K,c,S,z,f,(()=>{this._prepareWebGLTextureContinuation(f,w,E,F,x)}))||this._prepareWebGLTextureContinuation(f,w,E,F,x)):w&&w.removePendingData(f))}_getInternalFormatFromDepthTextureFormat(f,z,w){const S=this._gl;if(!z)return S.STENCIL_INDEX8;let C=w?S.DEPTH_STENCIL:S.DEPTH_COMPONENT;return this.webGLVersion>1?15===f?C=S.DEPTH_COMPONENT16:16===f?C=S.DEPTH_COMPONENT24:17===f||13===f?C=w?S.DEPTH24_STENCIL8:S.DEPTH_COMPONENT24:14===f?C=S.DEPTH_COMPONENT32F:18===f&&(C=w?S.DEPTH32F_STENCIL8:S.DEPTH_COMPONENT32F):C=S.DEPTH_COMPONENT16,C}_setupFramebufferDepthAttachments(f,z,w,S){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,E=arguments.length>5?arguments[5]:void 0;const F=this._gl;E=E??(f?13:14);const J=this._getInternalFormatFromDepthTextureFormat(E,z,f);return f&&z?this._createRenderBuffer(w,S,C,F.DEPTH_STENCIL,J,F.DEPTH_STENCIL_ATTACHMENT):z?this._createRenderBuffer(w,S,C,J,J,F.DEPTH_ATTACHMENT):f?this._createRenderBuffer(w,S,C,J,J,F.STENCIL_ATTACHMENT):null}_createRenderBuffer(f,z,w,S,C,E){let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const J=this._gl.createRenderbuffer();return this._updateRenderBuffer(J,f,z,w,S,C,E,F)}_updateRenderBuffer(f,z,w,S,C,E,F){let J=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const x=this._gl;return x.bindRenderbuffer(x.RENDERBUFFER,f),S>1&&x.renderbufferStorageMultisample?x.renderbufferStorageMultisample(x.RENDERBUFFER,S,E,z,w):x.renderbufferStorage(x.RENDERBUFFER,C,z,w),x.framebufferRenderbuffer(x.FRAMEBUFFER,F,x.RENDERBUFFER,f),J&&x.bindRenderbuffer(x.RENDERBUFFER,null),f}_releaseTexture(f){this._deleteTexture(f._hardwareTexture),this.unbindAllTextures();const z=this._internalTexturesCache.indexOf(f);-1!==z&&this._internalTexturesCache.splice(z,1),f._lodTextureHigh&&f._lodTextureHigh.dispose(),f._lodTextureMid&&f._lodTextureMid.dispose(),f._lodTextureLow&&f._lodTextureLow.dispose(),f._irradianceTexture&&f._irradianceTexture.dispose()}_deleteTexture(f){null===f||void 0===f||f.release()}_setProgram(f){this._currentProgram!==f&&((0,S.n)(f,this._gl),this._currentProgram=f)}bindSamplers(f){const z=f.getPipelineContext();this._setProgram(z.program);const w=f.getSamplers();for(let S=0;S<w.length;S++){const z=f.getUniform(w[S]);z&&(this._boundUniforms[S]=z)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=!1;const F=z&&z._associatedChannel>-1;w&&F&&(this._activeChannel=z._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==z||S){if(this._activateCurrentTexture(),z&&z.isMultiview)throw E.b.Error(["_bindTextureDirectly called with a multiview texture!",f,z]),"_bindTextureDirectly called with a multiview texture!";var J;this._gl.bindTexture(f,(null===z||void 0===z||null===(J=z._hardwareTexture)||void 0===J?void 0:J.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=z,z&&(z._associatedChannel=this._activeChannel)}else w&&(C=!0,this._activateCurrentTexture());return F&&!w&&this._bindSamplerUniformToChannel(z._associatedChannel,this._activeChannel),C}_bindTexture(f,z,w){if(void 0===f)return;z&&(z._associatedChannel=f),this._activeChannel=f;const S=z?this._getTextureTarget(z):this._gl.TEXTURE_2D;this._bindTextureDirectly(S,z)}unbindAllTextures(){for(let f=0;f<this._maxSimultaneousTextures;f++)this._activeChannel=f,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(f,z,w,S){void 0!==f&&(z&&(this._boundUniforms[f]=z),this._setTexture(f,w))}_bindSamplerUniformToChannel(f,z){const w=this._boundUniforms[f];w&&w._currentState!==z&&(this._gl.uniform1i(w,z),w._currentState=z)}_getTextureWrapMode(f){switch(f){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(f,z){let w,S=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!z)return null!=this._boundTexturesCache[f]&&(this._activeChannel=f,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(z.video){this._activeChannel=f;const w=z.getInternalTexture();w&&(w._associatedChannel=f),z.update()}else if(4===z.delayLoadState)return z.delayLoad(),!1;w=C?z.depthStencilTexture:z.isReady()?z.getInternalTexture():z.isCube?this.emptyCubeTexture:z.is3D?this.emptyTexture3D:z.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!S&&w&&(w._associatedChannel=f);let E=!0;this._boundTexturesCache[f]===w&&(S||this._bindSamplerUniformToChannel(w._associatedChannel,f),E=!1),this._activeChannel=f;const F=this._getTextureTarget(w);if(E&&this._bindTextureDirectly(F,w,S),w&&!w.isMultiview){if(w.isCube&&w._cachedCoordinatesMode!==z.coordinatesMode){w._cachedCoordinatesMode=z.coordinatesMode;const f=3!==z.coordinatesMode&&5!==z.coordinatesMode?1:0;z.wrapU=f,z.wrapV=f}w._cachedWrapU!==z.wrapU&&(w._cachedWrapU=z.wrapU,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(z.wrapU),w)),w._cachedWrapV!==z.wrapV&&(w._cachedWrapV=z.wrapV,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(z.wrapV),w)),w.is3D&&w._cachedWrapR!==z.wrapR&&(w._cachedWrapR=z.wrapR,this._setTextureParameterInteger(F,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(z.wrapR),w)),this._setAnisotropicLevel(F,w,z.anisotropicFilteringLevel)}return!0}setTextureArray(f,z,w,S){if(void 0!==f&&z){this._textureUnits&&this._textureUnits.length===w.length||(this._textureUnits=new Int32Array(w.length));for(let z=0;z<w.length;z++){const S=w[z].getInternalTexture();S?(this._textureUnits[z]=f+z,S._associatedChannel=f+z):this._textureUnits[z]=-1}this._gl.uniform1iv(z,this._textureUnits);for(let f=0;f<w.length;f++)this._setTexture(this._textureUnits[f],w[f],!0)}}_setAnisotropicLevel(f,z,w){const S=this._caps.textureAnisotropicFilterExtension;11!==z.samplingMode&&3!==z.samplingMode&&2!==z.samplingMode&&(w=1),S&&z._cachedAnisotropicFilteringLevel!==w&&(this._setTextureParameterFloat(f,S.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(w,this._caps.maxAnisotropy),z),z._cachedAnisotropicFilteringLevel=w)}_setTextureParameterFloat(f,z,w,S){this._bindTextureDirectly(f,S,!0,!0),this._gl.texParameterf(f,z,w)}_setTextureParameterInteger(f,z,w,S){S&&this._bindTextureDirectly(f,S,!0,!0),this._gl.texParameteri(f,z,w)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let f=0;f<this._caps.maxVertexAttribs;f++)this.disableAttributeByIndex(f)}else for(let f=0,z=this._vertexAttribArraysEnabled.length;f<z;f++)f>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[f]||this.disableAttributeByIndex(f)}releaseEffects(){const f=Object.keys(this._compiledEffects);for(const z of f){this._compiledEffects[z].dispose()}this._compiledEffects={}}dispose(){var f;((0,F.o)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(f=this._gl.getExtension("WEBGL_lose_context"))||void 0===f||f.loseContext());(0,S.z)(this._gl)}attachContextLostEvent(f){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",f,!1)}attachContextRestoredEvent(f){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",f,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(f){const z=this._gl;for(;z.getError()!==z.NO_ERROR;);let w=!0;const S=z.createTexture();z.bindTexture(z.TEXTURE_2D,S),z.texImage2D(z.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(f),1,1,0,z.RGBA,this._getWebGLTextureType(f),null),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MIN_FILTER,z.NEAREST),z.texParameteri(z.TEXTURE_2D,z.TEXTURE_MAG_FILTER,z.NEAREST);const C=z.createFramebuffer();z.bindFramebuffer(z.FRAMEBUFFER,C),z.framebufferTexture2D(z.FRAMEBUFFER,z.COLOR_ATTACHMENT0,z.TEXTURE_2D,S,0);const E=z.checkFramebufferStatus(z.FRAMEBUFFER);if(w=w&&E===z.FRAMEBUFFER_COMPLETE,w=w&&z.getError()===z.NO_ERROR,w&&(z.clear(z.COLOR_BUFFER_BIT),w=w&&z.getError()===z.NO_ERROR),w){z.bindFramebuffer(z.FRAMEBUFFER,null);const f=z.RGBA,S=z.UNSIGNED_BYTE,C=new Uint8Array(4);z.readPixels(0,0,1,1,f,S,C),w=w&&z.getError()===z.NO_ERROR}for(z.deleteTexture(S),z.deleteFramebuffer(C),z.bindFramebuffer(z.FRAMEBUFFER,null);!w&&z.getError()!==z.NO_ERROR;);return w}_getWebGLTextureType(f){if(1===this._webGLVersion){switch(f){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(f){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(f){let z=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=z?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(f){case 0:w=this._gl.ALPHA;break;case 1:w=this._gl.LUMINANCE;break;case 2:w=this._gl.LUMINANCE_ALPHA;break;case 6:w=this._gl.RED;break;case 7:w=this._gl.RG;break;case 4:w=z?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:w=z?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(f){case 8:w=this._gl.RED_INTEGER;break;case 9:w=this._gl.RG_INTEGER;break;case 10:w=this._gl.RGB_INTEGER;break;case 11:w=this._gl.RGBA_INTEGER}return w}_getRGBABufferInternalSizedFormat(f,z){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==z)switch(z){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return w?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(f){case 3:switch(z){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(z){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return w?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return w?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(z){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(z){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(z){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(z){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(z){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(z){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(z){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return w?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(f,z,w,S){let C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],E=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const F=C?4:3,J=C?this._gl.RGBA:this._gl.RGB,x=new Uint8Array(S*w*F);return E&&this.flushFramebuffer(),this._gl.readPixels(f,z,w,S,J,this._gl.UNSIGNED_BYTE,x),Promise.resolve(x)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const f=K.e._CreateCanvas(1,1),z=f.getContext("webgl")||f.getContext("experimental-webgl");this._IsSupported=null!=z&&!!window.WebGLRenderingContext}catch(f){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const f=K.e._CreateCanvas(1,1),z=f.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||f.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!z}catch(f){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}V._TempClearColorUint32=new Uint32Array(4),V._TempClearColorInt32=new Int32Array(4),V.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],V._ConcatenateShader=O.h,V._IsSupported=null,V._HasMajorPerformanceCaveat=null},12195:(f,z,w)=>{function S(f){return void 0===f.getPipelineContext}w.d(z,{d:()=>S})},12198:(f,z,w)=>{w.d(z,{e:()=>C});var S=w(791);class C extends S.d{constructor(f){super(),this._buffer=f}get underlyingResource(){return this._buffer}}}}]);