"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[22],{11880:(Y,d,t)=>{t.d(d,{c:()=>x});class x{get underlyingResource(){return this._webGLTexture}constructor(){let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,d=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=d,!Y&&(Y=d.createTexture(),!Y))throw new Error("Unable to create webGL texture");this.set(Y)}setUsage(){}set(Y){this._webGLTexture=Y}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(Y){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(Y)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const Y of this._MSAARenderBuffers)this._context.deleteRenderbuffer(Y);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var Y;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(Y=this._MSAARenderBuffers)||void 0===Y?void 0:Y[d])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11861:(Y,d,t)=>{t.r(d),t.d(d,{ThinEngine:()=>s});var x=t(600),C=t(11863),U=t(531),y=t(529);class B{constructor(){this.shaderLanguage=0}postProcessor(Y,d,t,x,C){if(C.drawBuffersExtensionDisabled){const d=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;Y=Y.replace(d,"")}return Y}}const W=/(flat\s)?\s*varying\s*.*/;class o{constructor(){this.shaderLanguage=0}attributeProcessor(Y){return Y.replace("attribute","in")}varyingCheck(Y,d){return W.test(Y)}varyingProcessor(Y,d){return Y.replace("varying",d?"in":"out")}postProcessor(Y,d,t){const x=-1!==Y.search(/#extension.+GL_EXT_draw_buffers.+require/);if(Y=(Y=Y.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),t){const d=-1!==Y.search(/layout *\(location *= *0\) *out/g);Y=(Y=(Y=(Y=(Y=(Y=(Y=Y.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(x||d?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==d.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+Y}return Y}}var f=t(11871),F=t(650),D=t(586),b=t(11880),m=t(609),M=t(590),J=t(578),g=t(594);class T{}class s extends D.d{get name(){return this._name}set name(Y){this._name=Y}get version(){return this._webGLVersion}static get ShadersRepository(){return M.b.ShadersRepository}static set ShadersRepository(Y){M.b.ShadersRepository=Y}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(Y){this._framebufferDimensionsObject=Y}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(Y,d,t,C){if(t=t||{},super(d??t.antialias,t,C),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!Y)return;let y=null;if(Y.getContext){if(y=Y,this._renderingCanvas=y,void 0===t.Tk&&(t.Tk=!1),void 0===t.xrCompatible&&(t.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const Y=navigator.userAgent;for(const d of s.ExceptionList){const x=d.key,C=d.targets;if(new RegExp(x).test(Y)){if(d.capture&&d.captureConstraint){const t=d.capture,x=d.captureConstraint,C=new RegExp(t).exec(Y);if(C&&C.length>0){if(parseInt(C[C.length-1])>=x)continue}}for(const Y of C)switch(Y){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":t.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=Y=>{Y.preventDefault(),this._contextWasLost=!0,U.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},y.addEventListener("webglcontextlost",this._onContextLost,!1),y.addEventListener("webglcontextrestored",this._onContextRestored,!1),t.powerPreference=t.powerPreference||"high-performance"),this._badDesktopOS&&(t.xrCompatible=!1),!t.disableWebGL2Support)try{this._gl=y.getContext("webgl2",t)||y.getContext("experimental-webgl2",t),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(F){}if(!this._gl){if(!y)throw new Error("The provided canvas is null or undefined.");try{this._gl=y.getContext("webgl",t)||y.getContext("experimental-webgl",t)}catch(F){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=Y,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const d=this._gl.getContextAttributes();d&&(t.stencil=d.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==t.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=t.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let x=0;x<this._caps.maxVertexAttribs;x++)this._currentBufferPointers[x]=new T;this._shaderProcessor=this.webGLVersion>1?new o:new B;const W=`Babylon.js v${s.Version}`;U.c.Log(W+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",W);const f=(0,x.B)(this._gl);f.validateShaderPrograms=this.validateShaderPrograms,f.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(Y){return null}areAllEffectsReady(){for(const Y in this._compiledEffects){if(!this._compiledEffects[Y].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const Y=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=Y&&(this._glRenderer=this._gl.getParameter(Y.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(Y.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const Y=this._gl.getExtension("WEBGL_draw_buffers");if(null!==Y){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=Y.drawBuffersWEBGL.bind(Y),this._caps.maxDrawBuffers=this._gl.getParameter(Y.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let d=0;d<16;d++)this._gl["COLOR_ATTACHMENT"+d+"_WEBGL"]=Y["COLOR_ATTACHMENT"+d+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const Y=this._gl.getExtension("WEBGL_depth_texture");null!=Y&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=Y.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const Y=this._gl.getExtension("OES_vertex_array_object");null!=Y&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=Y.createVertexArrayOES.bind(Y),this._gl.bindVertexArray=Y.bindVertexArrayOES.bind(Y),this._gl.deleteVertexArray=Y.deleteVertexArrayOES.bind(Y))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const Y=this._gl.getExtension("ANGLE_instanced_arrays");null!=Y?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=Y.drawArraysInstancedANGLE.bind(Y),this._gl.drawElementsInstanced=Y.drawElementsInstancedANGLE.bind(Y),this._gl.vertexAttribDivisor=Y.vertexAttribDivisorANGLE.bind(Y)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const Y=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),d=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);Y&&d&&(this._caps.highPrecisionShaderSupported=0!==Y.precision&&0!==d.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const Y=this._gl.getExtension("EXT_blend_minmax");null!=Y&&(this._caps.blendMinMax=!0,this._gl.MAX=Y.MAX_EXT,this._gl.MIN=Y.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const Y=this._gl.getExtension("EXT_sRGB");null!=Y&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:Y.SRGB_EXT,SRGB8:Y.SRGB_ALPHA_EXT,SRGB8_ALPHA8:Y.SRGB_ALPHA_EXT})}if(this._creationOptions){const Y=this._creationOptions.forceSRGBBufferSupportState;void 0!==Y&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&Y)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let d=0;d<this._maxSimultaneousTextures;d++)this._nextFreeTextureSlots.push(d);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const Y=this._workingCanvas.getContext("2d");Y&&(this._workingContext=Y)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const Y=this.getGlInfo();return Y&&Y.renderer?Y.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(Y,d,t){let x=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const C=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=C;let U=0;if(d&&Y){let d=!0;if(this._currentRenderTarget){var y;const t=null===(y=this._currentRenderTarget.texture)||void 0===y?void 0:y.format;if(8===t||9===t||10===t||11===t){var B;const t=null===(B=this._currentRenderTarget.texture)||void 0===B?void 0:B.type;7===t||5===t?(s._TempClearColorUint32[0]=255*Y.r,s._TempClearColorUint32[1]=255*Y.g,s._TempClearColorUint32[2]=255*Y.b,s._TempClearColorUint32[3]=255*Y.a,this._gl.clearBufferuiv(this._gl.COLOR,0,s._TempClearColorUint32),d=!1):(s._TempClearColorInt32[0]=255*Y.r,s._TempClearColorInt32[1]=255*Y.g,s._TempClearColorInt32[2]=255*Y.b,s._TempClearColorInt32[3]=255*Y.a,this._gl.clearBufferiv(this._gl.COLOR,0,s._TempClearColorInt32),d=!1)}}d&&(this._gl.clearColor(Y.r,Y.g,Y.b,void 0!==Y.a?Y.a:1),U|=this._gl.COLOR_BUFFER_BIT)}t&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),U|=this._gl.DEPTH_BUFFER_BIT),x&&(this._gl.clearStencil(0),U|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(U)}_viewport(Y,d,t,x){Y===this._viewportCached.x&&d===this._viewportCached.y&&t===this._viewportCached.z&&x===this._viewportCached.w||(this._viewportCached.x=Y,this._viewportCached.y=d,this._viewportCached.z=t,this._viewportCached.w=x,this._gl.viewport(Y,d,t,x))}kk(){super.kk(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(Y){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,x=arguments.length>3?arguments[3]:void 0,C=arguments.length>4?arguments[4]:void 0,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const W=Y;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=Y,this._bindUnboundFramebuffer(W._framebuffer);const o=this._gl;var f;if(!Y.isMulti)if(Y.is2DArray||Y.is3D)o.framebufferTextureLayer(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,null===(f=Y.texture._hardwareTexture)||void 0===f?void 0:f.underlyingResource,y,B),W._currentLOD=y;else if(Y.isCube){var F;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_CUBE_MAP_POSITIVE_X+d,null===(F=Y.texture._hardwareTexture)||void 0===F?void 0:F.underlyingResource,y)}else if(W._currentLOD!==y){var D;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,null===(D=Y.texture._hardwareTexture)||void 0===D?void 0:D.underlyingResource,y),W._currentLOD=y}const b=Y._depthStencilTexture;if(b){Y.is3D&&(Y.texture.width===b.width&&Y.texture.height===b.height&&Y.texture.depth===b.depth||U.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const t=Y._depthStencilTextureWithStencil?o.DEPTH_STENCIL_ATTACHMENT:o.DEPTH_ATTACHMENT;var m;if(Y.is2DArray||Y.is3D)o.framebufferTextureLayer(o.FRAMEBUFFER,t,null===(m=b._hardwareTexture)||void 0===m?void 0:m.underlyingResource,y,B);else if(Y.isCube){var M;o.framebufferTexture2D(o.FRAMEBUFFER,t,o.TEXTURE_CUBE_MAP_POSITIVE_X+d,null===(M=b._hardwareTexture)||void 0===M?void 0:M.underlyingResource,y)}else{var J;o.framebufferTexture2D(o.FRAMEBUFFER,t,o.TEXTURE_2D,null===(J=b._hardwareTexture)||void 0===J?void 0:J.underlyingResource,y)}}W._MSAAFramebuffer&&this._bindUnboundFramebuffer(W._MSAAFramebuffer),this._cachedViewport&&!C?this.setViewport(this._cachedViewport,t,x):(t||(t=Y.width,y&&(t/=Math.pow(2,y))),x||(x=Y.height,y&&(x/=Math.pow(2,y))),this._viewport(0,0,t,x)),this.wipeCaches()}setState(Y){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=arguments.length>4?arguments[4]:void 0,U=arguments.length>5?arguments[5]:void 0,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==Y||t)&&(this._depthCullingState.cull=Y);const B=this.cullBackFaces??C??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==B||t)&&(this._depthCullingState.cullFace=B),this.setZOffset(d),this.setZOffsetUnits(y);const W=x?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==W||t)&&(this._depthCullingState.frontFace=W),this._stencilStateComposer.stencilMaterial=U}_bindUnboundFramebuffer(Y){this._currentFramebuffer!==Y&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,Y),this._currentFramebuffer=Y)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(Y){const d=this._getTextureTarget(Y);this._bindTextureDirectly(d,Y,!0),this._gl.generateMipmap(d),this._bindTextureDirectly(d,null)}unBindFramebuffer(Y){var d;let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],x=arguments.length>2?arguments[2]:void 0;const C=Y;this._currentRenderTarget=null;const U=this._gl;if(C._MSAAFramebuffer){if(Y.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(Y,t,x);U.bindFramebuffer(U.READ_FRAMEBUFFER,C._MSAAFramebuffer),U.bindFramebuffer(U.DRAW_FRAMEBUFFER,C._framebuffer),U.blitFramebuffer(0,0,Y.width,Y.height,0,0,Y.width,Y.height,U.COLOR_BUFFER_BIT,U.NEAREST)}null===(d=Y.texture)||void 0===d||!d.generateMipMaps||t||Y.isCube||this.generateMipmaps(Y.texture),x&&(C._MSAAFramebuffer&&this._bindUnboundFramebuffer(C._framebuffer),x()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(Y,d,t){return this._createVertexBuffer(Y,this._gl.STATIC_DRAW)}_createVertexBuffer(Y,d){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create vertex buffer");const x=new f.e(t);return this.bindArrayBuffer(x),"number"!==typeof Y?Y instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(Y),d),x.qb=4*Y.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,Y,d),x.qb=Y.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(Y),d),x.qb=Y),this._resetVertexBufferBinding(),x.references=1,x}createDynamicVertexBuffer(Y,d){return this._createVertexBuffer(Y,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(Y,d,t){const x=this._gl.createBuffer(),C=new f.e(x);if(!x)throw new Error("Unable to create index buffer");this.bindIndexBuffer(C);const U=this._normalizeIndexData(Y);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,U,d?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),C.references=1,C.is32Bits=4===U.BYTES_PER_ELEMENT,C}_normalizeIndexData(Y){if(2===Y.BYTES_PER_ELEMENT)return Y;if(this._caps.uintIndices){if(Y instanceof Uint32Array)return Y;for(let d=0;d<Y.length;d++)if(Y[d]>=65535)return new Uint32Array(Y);return new Uint16Array(Y)}return new Uint16Array(Y)}bindArrayBuffer(Y){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(Y,this._gl.ARRAY_BUFFER)}bindUniformBlock(Y,d,t){const x=Y.program,C=this._gl.getUniformBlockIndex(x,d);this._gl.uniformBlockBinding(x,C,t)}bindIndexBuffer(Y){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(Y,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(Y,d){(this._vaoRecordInProgress||this._currentBoundBuffer[d]!==Y)&&(this._gl.bindBuffer(d,Y?Y.underlyingResource:null),this._currentBoundBuffer[d]=Y)}updateArrayBuffer(Y){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,Y)}_vertexAttribPointer(Y,d,t,x,C,U,y){const B=this._currentBufferPointers[d];if(!B)return;let W=!1;B.active?(B.buffer!==Y&&(B.buffer=Y,W=!0),B.size!==t&&(B.size=t,W=!0),B.type!==x&&(B.type=x,W=!0),B.normalized!==C&&(B.normalized=C,W=!0),B.stride!==U&&(B.stride=U,W=!0),B.offset!==y&&(B.offset=y,W=!0)):(W=!0,B.active=!0,B.index=d,B.size=t,B.type=x,B.normalized=C,B.stride=U,B.offset=y,B.buffer=Y),(W||this._vaoRecordInProgress)&&(this.bindArrayBuffer(Y),x===this._gl.UNSIGNED_INT||x===this._gl.INT?this._gl.vertexAttribIPointer(d,t,x,U,y):this._gl.vertexAttribPointer(d,t,x,C,U,y))}_bindIndexBufferWithCache(Y){null!=Y&&this._cachedIndexBuffer!==Y&&(this._cachedIndexBuffer=Y,this.bindIndexBuffer(Y),this._uintIndicesCurrentlySet=Y.is32Bits)}_bindVertexBuffersAttributes(Y,d,t){const x=d.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let C=0;C<x.length;C++){const U=d.getAttributeLocation(C);if(U>=0){const d=x[C];let y=null;if(t&&(y=t[d]),y||(y=Y[d]),!y)continue;this._gl.enableVertexAttribArray(U),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[U]=!0);const B=y.getBuffer();B&&(this._vertexAttribPointer(B,U,y.getSize(),y.type,y.normalized,y.byteStride,y.byteOffset),y.getIsInstanced()&&(this._gl.vertexAttribDivisor(U,y.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(U),this._currentInstanceBuffers.push(B))))}}}recordVertexArrayObject(Y,d,t,x){const C=this._gl.createVertexArray();if(!C)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(C),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(Y,t,x),this.bindIndexBuffer(d),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),C}bindVertexArrayObject(Y,d){this._cachedVertexArrayObject!==Y&&(this._cachedVertexArrayObject=Y,this._gl.bindVertexArray(Y),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=d&&d.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(Y,d,t,x,C){if(this._cachedVertexBuffers!==Y||this._cachedEffectForVertexBuffers!==C){this._cachedVertexBuffers=Y,this._cachedEffectForVertexBuffers=C;const d=C.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let U=0;for(let y=0;y<d;y++)if(y<t.length){const d=C.getAttributeLocation(y);d>=0&&(this._gl.enableVertexAttribArray(d),this._vertexAttribArraysEnabled[d]=!0,this._vertexAttribPointer(Y,d,t[y],this._gl.FLOAT,!1,x,U)),U+=4*t[y]}}this._bindIndexBufferWithCache(d)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(Y,d,t,x){this._cachedVertexBuffers===Y&&this._cachedEffectForVertexBuffers===t||(this._cachedVertexBuffers=Y,this._cachedEffectForVertexBuffers=t,this._bindVertexBuffersAttributes(Y,t,x)),this._bindIndexBufferWithCache(d)}unbindInstanceAttributes(){let Y;for(let d=0,t=this._currentInstanceLocations.length;d<t;d++){const t=this._currentInstanceBuffers[d];Y!=t&&t.references&&(Y=t,this.bindArrayBuffer(t));const x=this._currentInstanceLocations[d];this._gl.vertexAttribDivisor(x,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(Y){this._gl.deleteVertexArray(Y)}_releaseBuffer(Y){return Y.references--,0===Y.references&&(this._deleteBuffer(Y),!0)}_deleteBuffer(Y){this._gl.deleteBuffer(Y.underlyingResource)}updateAndBindInstancesBuffer(Y,d,t){if(this.bindArrayBuffer(Y),d&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,d),void 0!==t[0].index)this.bindInstancesBuffer(Y,t,!0);else for(let x=0;x<4;x++){const d=t[x];this._vertexAttribArraysEnabled[d]||(this._gl.enableVertexAttribArray(d),this._vertexAttribArraysEnabled[d]=!0),this._vertexAttribPointer(Y,d,4,this._gl.FLOAT,!1,64,16*x),this._gl.vertexAttribDivisor(d,1),this._currentInstanceLocations.push(d),this._currentInstanceBuffers.push(Y)}}bindInstancesBuffer(Y,d){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(Y);let x=0;if(t)for(let C=0;C<d.length;C++){x+=4*d[C].attributeSize}for(let C=0;C<d.length;C++){const t=d[C];void 0===t.index&&(t.index=this._currentEffect.getAttributeLocationByName(t.attributeName)),t.index<0||(this._vertexAttribArraysEnabled[t.index]||(this._gl.enableVertexAttribArray(t.index),this._vertexAttribArraysEnabled[t.index]=!0),this._vertexAttribPointer(Y,t.index,t.attributeSize,t.attributeType||this._gl.FLOAT,t.normalized||!1,x,t.offset),this._gl.vertexAttribDivisor(t.index,void 0===t.divisor?1:t.divisor),this._currentInstanceLocations.push(t.index),this._currentInstanceBuffers.push(Y))}}disableInstanceAttributeByName(Y){if(!this._currentEffect)return;const d=this._currentEffect.getAttributeLocationByName(Y);this.disableInstanceAttribute(d)}disableInstanceAttribute(Y){let d,t=!1;for(;-1!==(d=this._currentInstanceLocations.indexOf(Y));)this._currentInstanceLocations.splice(d,1),this._currentInstanceBuffers.splice(d,1),t=!0,d=this._currentInstanceLocations.indexOf(Y);t&&(this._gl.vertexAttribDivisor(Y,0),this.disableAttributeByIndex(Y))}disableAttributeByIndex(Y){this._gl.disableVertexAttribArray(Y),this._vertexAttribArraysEnabled[Y]=!1,this._currentBufferPointers[Y].active=!1}draw(Y,d,t,x){this.drawElementsType(Y?0:1,d,t,x)}drawPointClouds(Y,d,t){this.drawArraysType(2,Y,d,t)}drawUnIndexed(Y,d,t,x){this.drawArraysType(Y?0:1,d,t,x)}drawElementsType(Y,d,t,x){this.applyStates(),this._reportDrawCall();const C=this._drawMode(Y),U=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,y=this._uintIndicesCurrentlySet?4:2;x?this._gl.drawElementsInstanced(C,t,U,d*y,x):this._gl.drawElements(C,t,U,d*y)}drawArraysType(Y,d,t,x){this.applyStates(),this._reportDrawCall();const C=this._drawMode(Y);x?this._gl.drawArraysInstanced(C,d,t,x):this._gl.drawArrays(C,d,t)}_drawMode(Y){switch(Y){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(Y){this._compiledEffects[Y._key]&&delete this._compiledEffects[Y._key];const d=Y.getPipelineContext();d&&this._deletePipelineContext(d)}_deletePipelineContext(Y){const d=Y;d&&d.program&&(d.program.__SPECTOR_rebuildProgram=null,(0,g.g)(d),this._gl.deleteProgram(d.program))}_getGlobalDefines(Y){return(0,J.i)(Y,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(Y,d,t,C,U,y,B,W,o){let f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,F=arguments.length>10?arguments[10]:void 0;const D="string"===typeof Y?Y:Y.vertexToken||Y.vertexSource||Y.vertexElement||Y.vertex,b="string"===typeof Y?Y:Y.fragmentToken||Y.fragmentSource||Y.fragmentElement||Y.fragment,m=this._getGlobalDefines();let J=U??d.defines??"";m&&(J+=m);const g=D+"+"+b+"@"+J;if(this._compiledEffects[g]){const Y=this._compiledEffects[g];return B&&Y.isReady()&&B(Y),Y._refCount++,Y}this._gl&&(0,x.B)(this._gl);const T=new M.b(Y,d,t,C,this,U,y,B,W,o,g,d.shaderLanguage??f,d.extraInitializationsAsync??F);return this._compiledEffects[g]=T,T}_getShaderSource(Y){return this._gl.getShaderSource(Y)}createRawShaderProgram(Y,d,t,C){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const y=(0,x.B)(this._gl);return y._contextWasLost=this._contextWasLost,y.validateShaderPrograms=this.validateShaderPrograms,(0,x.q)(Y,d,t,C||this._gl,U)}createShaderProgram(Y,d,t,C,U){let y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const B=(0,x.B)(this._gl);return B._contextWasLost=this._contextWasLost,B.validateShaderPrograms=this.validateShaderPrograms,(0,x.u)(Y,d,t,C,U||this._gl,y)}inlineShaderCode(Y){return Y}createPipelineContext(Y){if(this._gl){(0,x.B)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const d=(0,x.o)(this._gl,Y);return d.Xj=this,d}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(Y){return(0,x.f)(Y,this._gl,this.validateShaderPrograms)}_preparePipelineContext(Y,d,t,C,U,y,B,W,o,f,F){const D=(0,x.B)(this._gl);return D._contextWasLost=this._contextWasLost,D.validateShaderPrograms=this.validateShaderPrograms,D._createShaderProgramInjection=this._createShaderProgram.bind(this),D.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),D.createShaderProgramInjection=this.createShaderProgram.bind(this),D.loadFileInjection=this._loadFile.bind(this),(0,x.i)(Y,d,t,C,U,y,B,W,o,f,F)}_createShaderProgram(Y,d,t,C){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,x.c)(Y,d,t,C,U)}_isRenderingStateCompiled(Y){const d=Y;return!this._isDisposed&&!d._isDisposed&&(!!this._gl.getProgramParameter(d.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(d),!0))}_executeWhenRenderingStateIsCompiled(Y,d){(0,x.e)(Y,d)}getUniforms(Y,d){const t=new Array,x=Y;for(let C=0;C<d.length;C++)t.push(this._gl.getUniformLocation(x.program,d[C]));return t}getAttributes(Y,d){const t=[],x=Y;for(let U=0;U<d.length;U++)try{t.push(this._gl.getAttribLocation(x.program,d[U]))}catch(C){t.push(-1)}return t}enableEffect(Y){(Y=null!==Y&&(0,C.b)(Y)?Y.effect:Y)&&Y!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(Y),this._currentEffect=Y,Y.onBind&&Y.onBind(Y),Y._onBindObservable&&Y._onBindObservable.notifyObservers(Y))}setInt(Y,d){return!!Y&&(this._gl.uniform1i(Y,d),!0)}setInt2(Y,d,t){return!!Y&&(this._gl.uniform2i(Y,d,t),!0)}setInt3(Y,d,t,x){return!!Y&&(this._gl.uniform3i(Y,d,t,x),!0)}setInt4(Y,d,t,x,C){return!!Y&&(this._gl.uniform4i(Y,d,t,x,C),!0)}setIntArray(Y,d){return!!Y&&(this._gl.uniform1iv(Y,d),!0)}setIntArray2(Y,d){return!(!Y||d.length%2!==0)&&(this._gl.uniform2iv(Y,d),!0)}setIntArray3(Y,d){return!(!Y||d.length%3!==0)&&(this._gl.uniform3iv(Y,d),!0)}setIntArray4(Y,d){return!(!Y||d.length%4!==0)&&(this._gl.uniform4iv(Y,d),!0)}setUInt(Y,d){return!!Y&&(this._gl.uniform1ui(Y,d),!0)}setUInt2(Y,d,t){return!!Y&&(this._gl.uniform2ui(Y,d,t),!0)}setUInt3(Y,d,t,x){return!!Y&&(this._gl.uniform3ui(Y,d,t,x),!0)}setUInt4(Y,d,t,x,C){return!!Y&&(this._gl.uniform4ui(Y,d,t,x,C),!0)}setUIntArray(Y,d){return!!Y&&(this._gl.uniform1uiv(Y,d),!0)}setUIntArray2(Y,d){return!(!Y||d.length%2!==0)&&(this._gl.uniform2uiv(Y,d),!0)}setUIntArray3(Y,d){return!(!Y||d.length%3!==0)&&(this._gl.uniform3uiv(Y,d),!0)}setUIntArray4(Y,d){return!(!Y||d.length%4!==0)&&(this._gl.uniform4uiv(Y,d),!0)}setArray(Y,d){return!!Y&&(!(d.length<1)&&(this._gl.uniform1fv(Y,d),!0))}setArray2(Y,d){return!(!Y||d.length%2!==0)&&(this._gl.uniform2fv(Y,d),!0)}setArray3(Y,d){return!(!Y||d.length%3!==0)&&(this._gl.uniform3fv(Y,d),!0)}setArray4(Y,d){return!(!Y||d.length%4!==0)&&(this._gl.uniform4fv(Y,d),!0)}setMatrices(Y,d){return!!Y&&(this._gl.uniformMatrix4fv(Y,!1,d),!0)}setMatrix3x3(Y,d){return!!Y&&(this._gl.uniformMatrix3fv(Y,!1,d),!0)}setMatrix2x2(Y,d){return!!Y&&(this._gl.uniformMatrix2fv(Y,!1,d),!0)}setFloat(Y,d){return!!Y&&(this._gl.uniform1f(Y,d),!0)}setFloat2(Y,d,t){return!!Y&&(this._gl.uniform2f(Y,d,t),!0)}setFloat3(Y,d,t,x){return!!Y&&(this._gl.uniform3f(Y,d,t,x),!0)}setFloat4(Y,d,t,x,C){return!!Y&&(this._gl.uniform4f(Y,d,t,x,C),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const Y=this._colorWrite;this._gl.colorMask(Y,Y,Y,Y)}}wipeCaches(Y){this.preventCacheWipeBetweenFrames&&!Y||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),Y&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(Y,d){const t=this._gl;let x=t.NEAREST,C=t.NEAREST;switch(Y){case 11:x=t.LINEAR,C=d?t.LINEAR_MIPMAP_NEAREST:t.LINEAR;break;case 3:x=t.LINEAR,C=d?t.LINEAR_MIPMAP_LINEAR:t.LINEAR;break;case 8:x=t.NEAREST,C=d?t.NEAREST_MIPMAP_LINEAR:t.NEAREST;break;case 4:x=t.NEAREST,C=d?t.NEAREST_MIPMAP_NEAREST:t.NEAREST;break;case 5:x=t.NEAREST,C=d?t.LINEAR_MIPMAP_NEAREST:t.LINEAR;break;case 6:x=t.NEAREST,C=d?t.LINEAR_MIPMAP_LINEAR:t.LINEAR;break;case 7:x=t.NEAREST,C=t.LINEAR;break;case 1:x=t.NEAREST,C=t.NEAREST;break;case 9:x=t.LINEAR,C=d?t.NEAREST_MIPMAP_NEAREST:t.NEAREST;break;case 10:x=t.LINEAR,C=d?t.NEAREST_MIPMAP_LINEAR:t.NEAREST;break;case 2:x=t.LINEAR,C=t.LINEAR;break;case 12:x=t.LINEAR,C=t.NEAREST}return{min:C,mag:x}}_createTexture(){const Y=this._gl.createTexture();if(!Y)throw new Error("Unable to create texture");return Y}_createHardwareTexture(){return new b.c(this._createTexture(),this._gl)}_createInternalTexture(Y,d){let t,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=!1,y=0,B=3,W=5,o=!1,f=1;void 0!==d&&"object"===typeof d?(C=!!d.generateMipMaps,y=void 0===d.type?0:d.type,B=void 0===d.samplingMode?3:d.samplingMode,W=void 0===d.format?5:d.format,o=void 0!==d.useSRGBBuffer&&d.useSRGBBuffer,f=d.samples??1,t=d.label):C=!!d,o&&(o=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==y||this._caps.textureFloatLinearFiltering)&&(2!==y||this._caps.textureHalfFloatLinearFiltering)||(B=1),1!==y||this._caps.textureFloat||(y=0,U.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const F=this._gl,D=new m.c(this,x),b=Y.width||Y,M=Y.height||Y,J=Y.depth||0,g=Y.layers||0,T=this._getSamplingParameters(B,C),s=0!==g?F.TEXTURE_2D_ARRAY:0!==J?F.TEXTURE_3D:F.TEXTURE_2D,l=this._getRGBABufferInternalSizedFormat(y,W,o),h=this._getInternalFormat(W),Z=this._getWebGLTextureType(y);return this._bindTextureDirectly(s,D),0!==g?(D.is2DArray=!0,F.texImage3D(s,0,l,b,M,g,0,h,Z,null)):0!==J?(D.is3D=!0,F.texImage3D(s,0,l,b,M,J,0,h,Z,null)):F.texImage2D(s,0,l,b,M,0,h,Z,null),F.texParameteri(s,F.TEXTURE_MAG_FILTER,T.mag),F.texParameteri(s,F.TEXTURE_MIN_FILTER,T.min),F.texParameteri(s,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(s,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),C&&this._gl.generateMipmap(s),this._bindTextureDirectly(s,null),D._useSRGBBuffer=o,D.baseWidth=b,D.baseHeight=M,D.width=b,D.height=M,D.depth=g,D.isReady=!0,D.samples=f,D.generateMipMaps=C,D.samplingMode=B,D.type=y,D.format=W,D.label=t,this._internalTexturesCache.push(D),D}_getUseSRGBBuffer(Y,d){return Y&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||d)}createTexture(Y,d,t,x){var C=this;let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,y=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,o=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,F=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,D=arguments.length>11?arguments[11]:void 0,b=arguments.length>12?arguments[12]:void 0,M=arguments.length>13?arguments[13]:void 0,J=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(Y,d,t,x,U,y,B,(function(){for(var Y=arguments.length,d=new Array(Y),t=0;t<Y;t++)d[t]=arguments[t];return C._prepareWebGLTexture(...d,f)}),((Y,d,t,C,U,y)=>{const B=this._gl,W=t.width===Y&&t.height===d;U._creationFlags=M??0;const o=this._getTexImageParametersForCreateTexture(U.format,U._useSRGBBuffer);if(W)return B.texImage2D(B.TEXTURE_2D,0,o.internalFormat,o.format,o.type,t),!1;const f=this._caps.maxTextureSize;if(t.width>f||t.height>f||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=Y,this._workingCanvas.height=d,this._workingContext.drawImage(t,0,0,t.width,t.height,0,0,Y,d),B.texImage2D(B.TEXTURE_2D,0,o.internalFormat,o.format,o.type,this._workingCanvas),U.width=Y,U.height=d,!1);{const Y=new m.c(this,2);this._bindTextureDirectly(B.TEXTURE_2D,Y,!0),B.texImage2D(B.TEXTURE_2D,0,o.internalFormat,o.format,o.type,t),this._rescaleTexture(Y,U,x,o.format,(()=>{this._releaseTexture(Y),this._bindTextureDirectly(B.TEXTURE_2D,U,!0),y()}))}return!0}),W,o,f,F,D,b,J)}_getTexImageParametersForCreateTexture(Y,d){let t,x;return 1===this.webGLVersion?(t=this._getInternalFormat(Y,d),x=t):(t=this._getInternalFormat(Y,!1),x=this._getRGBABufferInternalSizedFormat(0,Y,d)),{internalFormat:x,format:t,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(Y,d,t,x,C){}_unpackFlipY(Y){this._unpackFlipYCached!==Y&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,Y?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=Y))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(Y){return Y.isCube?this._gl.TEXTURE_CUBE_MAP:Y.is3D?this._gl.TEXTURE_3D:Y.is2DArray||Y.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(Y,d){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const x=this._getTextureTarget(d),C=this._getSamplingParameters(Y,d.useMipMaps||t);this._setTextureParameterInteger(x,this._gl.TEXTURE_MAG_FILTER,C.mag,d),this._setTextureParameterInteger(x,this._gl.TEXTURE_MIN_FILTER,C.min),t&&(d.generateMipMaps=!0,this._gl.generateMipmap(x)),this._bindTextureDirectly(x,null),d.samplingMode=Y}updateTextureDimensions(Y,d,t){}updateTextureWrappingMode(Y,d){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const C=this._getTextureTarget(Y);null!==d&&(this._setTextureParameterInteger(C,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(d),Y),Y._cachedWrapU=d),null!==t&&(this._setTextureParameterInteger(C,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t),Y),Y._cachedWrapV=t),(Y.is2DArray||Y.is3D)&&null!==x&&(this._setTextureParameterInteger(C,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(x),Y),Y._cachedWrapR=x),this._bindTextureDirectly(C,null)}_uploadCompressedDataToTextureDirectly(Y,d,t,x,C){let U=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const B=this._gl;let W=B.TEXTURE_2D;if(Y.isCube&&(W=B.TEXTURE_CUBE_MAP_POSITIVE_X+U),Y._useSRGBBuffer)switch(d){case 37492:case 36196:this._caps.etc2?d=B.COMPRESSED_SRGB8_ETC2:Y._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?d=B.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:Y._useSRGBBuffer=!1;break;case 36492:d=B.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:d=B.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?d=B.COMPRESSED_SRGB_S3TC_DXT1_EXT:Y._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?d=B.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:Y._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?d=B.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:Y._useSRGBBuffer=!1;break;default:Y._useSRGBBuffer=!1}this._gl.compressedTexImage2D(W,y,d,t,x,0,C)}_uploadDataToTextureDirectly(Y,d){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,C=arguments.length>4?arguments[4]:void 0,U=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const y=this._gl,B=this._getWebGLTextureType(Y.type),W=this._getInternalFormat(Y.format),o=void 0===C?this._getRGBABufferInternalSizedFormat(Y.type,Y.format,Y._useSRGBBuffer):this._getInternalFormat(C,Y._useSRGBBuffer);this._unpackFlipY(Y.invertY);let f=y.TEXTURE_2D;Y.isCube&&(f=y.TEXTURE_CUBE_MAP_POSITIVE_X+t);const F=Math.round(Math.log(Y.width)*Math.LOG2E),D=Math.round(Math.log(Y.height)*Math.LOG2E),b=U?Y.width:Math.pow(2,Math.max(F-x,0)),m=U?Y.height:Math.pow(2,Math.max(D-x,0));y.texImage2D(f,x,o,b,m,0,W,B,d)}updateTextureData(Y,d,t,x,C,U){let y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,B=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const o=this._gl,f=this._getWebGLTextureType(Y.type),F=this._getInternalFormat(Y.format);this._unpackFlipY(Y.invertY);let D=o.TEXTURE_2D,b=o.TEXTURE_2D;Y.isCube&&(b=o.TEXTURE_CUBE_MAP_POSITIVE_X+y,D=o.TEXTURE_CUBE_MAP),this._bindTextureDirectly(D,Y,!0),o.texSubImage2D(b,B,t,x,C,U,F,f,d),W&&this._gl.generateMipmap(b),this._bindTextureDirectly(D,null)}_uploadArrayBufferViewToTexture(Y,d){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const C=this._gl,U=Y.isCube?C.TEXTURE_CUBE_MAP:C.TEXTURE_2D;this._bindTextureDirectly(U,Y,!0),this._uploadDataToTextureDirectly(Y,d,t,x),this._bindTextureDirectly(U,null,!0)}_prepareWebGLTextureContinuation(Y,d,t,x,C){const U=this._gl;if(!U)return;const y=this._getSamplingParameters(C,!t);U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MAG_FILTER,y.mag),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_MIN_FILTER,y.min),t||x||U.generateMipmap(U.TEXTURE_2D),this._bindTextureDirectly(U.TEXTURE_2D,null),d&&d.removePendingData(Y),Y.onLoadedObservable.notifyObservers(Y),Y.onLoadedObservable.clear()}_prepareWebGLTexture(Y,d,t,x,C,U,y,B,W,o){const f=this.getCaps().maxTextureSize,D=Math.min(f,this.needPOTTextures?(0,F.g)(x.width,f):x.width),b=Math.min(f,this.needPOTTextures?(0,F.g)(x.height,f):x.height),m=this._gl;m&&(Y._hardwareTexture?(this._bindTextureDirectly(m.TEXTURE_2D,Y,!0),this._unpackFlipY(void 0===C||!!C),Y.baseWidth=x.width,Y.baseHeight=x.height,Y.width=D,Y.height=b,Y.isReady=!0,Y.type=-1!==Y.type?Y.type:0,Y.format=-1!==Y.format?Y.format:o??(".jpg"!==d||Y._useSRGBBuffer?5:4),B(D,b,x,d,Y,(()=>{this._prepareWebGLTextureContinuation(Y,t,U,y,W)}))||this._prepareWebGLTextureContinuation(Y,t,U,y,W)):t&&t.removePendingData(Y))}_getInternalFormatFromDepthTextureFormat(Y,d,t){const x=this._gl;if(!d)return x.STENCIL_INDEX8;let C=t?x.DEPTH_STENCIL:x.DEPTH_COMPONENT;return this.webGLVersion>1?15===Y?C=x.DEPTH_COMPONENT16:16===Y?C=x.DEPTH_COMPONENT24:17===Y||13===Y?C=t?x.DEPTH24_STENCIL8:x.DEPTH_COMPONENT24:14===Y?C=x.DEPTH_COMPONENT32F:18===Y&&(C=t?x.DEPTH32F_STENCIL8:x.DEPTH_COMPONENT32F):C=x.DEPTH_COMPONENT16,C}_setupFramebufferDepthAttachments(Y,d,t,x){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,U=arguments.length>5?arguments[5]:void 0;const y=this._gl;U=U??(Y?13:14);const B=this._getInternalFormatFromDepthTextureFormat(U,d,Y);return Y&&d?this._createRenderBuffer(t,x,C,y.DEPTH_STENCIL,B,y.DEPTH_STENCIL_ATTACHMENT):d?this._createRenderBuffer(t,x,C,B,B,y.DEPTH_ATTACHMENT):Y?this._createRenderBuffer(t,x,C,B,B,y.STENCIL_ATTACHMENT):null}_createRenderBuffer(Y,d,t,x,C,U){let y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const B=this._gl.createRenderbuffer();return this._updateRenderBuffer(B,Y,d,t,x,C,U,y)}_updateRenderBuffer(Y,d,t,x,C,U,y){let B=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const W=this._gl;return W.bindRenderbuffer(W.RENDERBUFFER,Y),x>1&&W.renderbufferStorageMultisample?W.renderbufferStorageMultisample(W.RENDERBUFFER,x,U,d,t):W.renderbufferStorage(W.RENDERBUFFER,C,d,t),W.framebufferRenderbuffer(W.FRAMEBUFFER,y,W.RENDERBUFFER,Y),B&&W.bindRenderbuffer(W.RENDERBUFFER,null),Y}_releaseTexture(Y){this._deleteTexture(Y._hardwareTexture),this.unbindAllTextures();const d=this._internalTexturesCache.indexOf(Y);-1!==d&&this._internalTexturesCache.splice(d,1),Y._lodTextureHigh&&Y._lodTextureHigh.dispose(),Y._lodTextureMid&&Y._lodTextureMid.dispose(),Y._lodTextureLow&&Y._lodTextureLow.dispose(),Y._irradianceTexture&&Y._irradianceTexture.dispose()}_deleteTexture(Y){null===Y||void 0===Y||Y.release()}_setProgram(Y){this._currentProgram!==Y&&((0,x.k)(Y,this._gl),this._currentProgram=Y)}bindSamplers(Y){const d=Y.getPipelineContext();this._setProgram(d.program);const t=Y.getSamplers();for(let x=0;x<t.length;x++){const d=Y.getUniform(t[x]);d&&(this._boundUniforms[x]=d)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(Y,d){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],x=arguments.length>3&&void 0!==arguments[3]&&arguments[3],C=!1;const y=d&&d._associatedChannel>-1;t&&y&&(this._activeChannel=d._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==d||x){if(this._activateCurrentTexture(),d&&d.isMultiview)throw U.c.Error(["_bindTextureDirectly called with a multiview texture!",Y,d]),"_bindTextureDirectly called with a multiview texture!";var B;this._gl.bindTexture(Y,(null===d||void 0===d||null===(B=d._hardwareTexture)||void 0===B?void 0:B.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=d,d&&(d._associatedChannel=this._activeChannel)}else t&&(C=!0,this._activateCurrentTexture());return y&&!t&&this._bindSamplerUniformToChannel(d._associatedChannel,this._activeChannel),C}_bindTexture(Y,d,t){if(void 0===Y)return;d&&(d._associatedChannel=Y),this._activeChannel=Y;const x=d?this._getTextureTarget(d):this._gl.TEXTURE_2D;this._bindTextureDirectly(x,d)}unbindAllTextures(){for(let Y=0;Y<this._maxSimultaneousTextures;Y++)this._activeChannel=Y,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(Y,d,t,x){void 0!==Y&&(d&&(this._boundUniforms[Y]=d),this._setTexture(Y,t))}_bindSamplerUniformToChannel(Y,d){const t=this._boundUniforms[Y];t&&t._currentState!==d&&(this._gl.uniform1i(t,d),t._currentState=d)}_getTextureWrapMode(Y){switch(Y){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(Y,d){let t,x=arguments.length>2&&void 0!==arguments[2]&&arguments[2],C=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!d)return null!=this._boundTexturesCache[Y]&&(this._activeChannel=Y,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(d.video){this._activeChannel=Y;const t=d.getInternalTexture();t&&(t._associatedChannel=Y),d.update()}else if(4===d.delayLoadState)return d.delayLoad(),!1;t=C?d.depthStencilTexture:d.isReady()?d.getInternalTexture():d.isCube?this.emptyCubeTexture:d.is3D?this.emptyTexture3D:d.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!x&&t&&(t._associatedChannel=Y);let U=!0;this._boundTexturesCache[Y]===t&&(x||this._bindSamplerUniformToChannel(t._associatedChannel,Y),U=!1),this._activeChannel=Y;const y=this._getTextureTarget(t);if(U&&this._bindTextureDirectly(y,t,x),t&&!t.isMultiview){if(t.isCube&&t._cachedCoordinatesMode!==d.coordinatesMode){t._cachedCoordinatesMode=d.coordinatesMode;const Y=3!==d.coordinatesMode&&5!==d.coordinatesMode?1:0;d.wrapU=Y,d.wrapV=Y}t._cachedWrapU!==d.wrapU&&(t._cachedWrapU=d.wrapU,this._setTextureParameterInteger(y,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(d.wrapU),t)),t._cachedWrapV!==d.wrapV&&(t._cachedWrapV=d.wrapV,this._setTextureParameterInteger(y,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(d.wrapV),t)),t.is3D&&t._cachedWrapR!==d.wrapR&&(t._cachedWrapR=d.wrapR,this._setTextureParameterInteger(y,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(d.wrapR),t)),this._setAnisotropicLevel(y,t,d.anisotropicFilteringLevel)}return!0}setTextureArray(Y,d,t,x){if(void 0!==Y&&d){this._textureUnits&&this._textureUnits.length===t.length||(this._textureUnits=new Int32Array(t.length));for(let d=0;d<t.length;d++){const x=t[d].getInternalTexture();x?(this._textureUnits[d]=Y+d,x._associatedChannel=Y+d):this._textureUnits[d]=-1}this._gl.uniform1iv(d,this._textureUnits);for(let Y=0;Y<t.length;Y++)this._setTexture(this._textureUnits[Y],t[Y],!0)}}_setAnisotropicLevel(Y,d,t){const x=this._caps.textureAnisotropicFilterExtension;11!==d.samplingMode&&3!==d.samplingMode&&2!==d.samplingMode&&(t=1),x&&d._cachedAnisotropicFilteringLevel!==t&&(this._setTextureParameterFloat(Y,x.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t,this._caps.maxAnisotropy),d),d._cachedAnisotropicFilteringLevel=t)}_setTextureParameterFloat(Y,d,t,x){this._bindTextureDirectly(Y,x,!0,!0),this._gl.texParameterf(Y,d,t)}_setTextureParameterInteger(Y,d,t,x){x&&this._bindTextureDirectly(Y,x,!0,!0),this._gl.texParameteri(Y,d,t)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let Y=0;Y<this._caps.maxVertexAttribs;Y++)this.disableAttributeByIndex(Y)}else for(let Y=0,d=this._vertexAttribArraysEnabled.length;Y<d;Y++)Y>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[Y]||this.disableAttributeByIndex(Y)}releaseEffects(){const Y=Object.keys(this._compiledEffects);for(const d of Y){this._compiledEffects[d].dispose()}this._compiledEffects={}}dispose(){var Y;((0,y.j)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(Y=this._gl.getExtension("WEBGL_lose_context"))||void 0===Y||Y.loseContext());(0,x.x)(this._gl)}attachContextLostEvent(Y){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",Y,!1)}attachContextRestoredEvent(Y){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",Y,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(Y){const d=this._gl;for(;d.getError()!==d.NO_ERROR;);let t=!0;const x=d.createTexture();d.bindTexture(d.TEXTURE_2D,x),d.texImage2D(d.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(Y),1,1,0,d.RGBA,this._getWebGLTextureType(Y),null),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.NEAREST),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.NEAREST);const C=d.createFramebuffer();d.bindFramebuffer(d.FRAMEBUFFER,C),d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,x,0);const U=d.checkFramebufferStatus(d.FRAMEBUFFER);if(t=t&&U===d.FRAMEBUFFER_COMPLETE,t=t&&d.getError()===d.NO_ERROR,t&&(d.clear(d.COLOR_BUFFER_BIT),t=t&&d.getError()===d.NO_ERROR),t){d.bindFramebuffer(d.FRAMEBUFFER,null);const Y=d.RGBA,x=d.UNSIGNED_BYTE,C=new Uint8Array(4);d.readPixels(0,0,1,1,Y,x,C),t=t&&d.getError()===d.NO_ERROR}for(d.deleteTexture(x),d.deleteFramebuffer(C),d.bindFramebuffer(d.FRAMEBUFFER,null);!t&&d.getError()!==d.NO_ERROR;);return t}_getWebGLTextureType(Y){if(1===this._webGLVersion){switch(Y){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(Y){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(Y){let d=arguments.length>1&&void 0!==arguments[1]&&arguments[1],t=d?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(Y){case 0:t=this._gl.ALPHA;break;case 1:t=this._gl.LUMINANCE;break;case 2:t=this._gl.LUMINANCE_ALPHA;break;case 6:t=this._gl.RED;break;case 7:t=this._gl.RG;break;case 4:t=d?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:t=d?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(Y){case 8:t=this._gl.RED_INTEGER;break;case 9:t=this._gl.RG_INTEGER;break;case 10:t=this._gl.RGB_INTEGER;break;case 11:t=this._gl.RGBA_INTEGER}return t}_getRGBABufferInternalSizedFormat(Y,d){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==d)switch(d){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return t?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(Y){case 3:switch(d){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(d){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return t?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(d){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(d){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(d){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(d){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(d){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(d){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(d){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(Y,d,t,x){let C=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],U=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const y=C?4:3,B=C?this._gl.RGBA:this._gl.RGB,W=new Uint8Array(x*t*y);return U&&this.flushFramebuffer(),this._gl.readPixels(Y,d,t,x,B,this._gl.UNSIGNED_BYTE,W),Promise.resolve(W)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const Y=D.d._CreateCanvas(1,1),d=Y.getContext("webgl")||Y.getContext("experimental-webgl");this._IsSupported=null!=d&&!!window.WebGLRenderingContext}catch(Y){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const Y=D.d._CreateCanvas(1,1),d=Y.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||Y.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!d}catch(Y){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}s._TempClearColorUint32=new Uint32Array(4),s._TempClearColorInt32=new Int32Array(4),s.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],s._ConcatenateShader=J.e,s._IsSupported=null,s._HasMajorPerformanceCaveat=null},11863:(Y,d,t)=>{function x(Y){return void 0===Y.getPipelineContext}t.d(d,{b:()=>x})},11871:(Y,d,t)=>{t.d(d,{e:()=>C});var x=t(757);class C extends x.e{constructor(Y){super(),this._buffer=Y}get underlyingResource(){return this._buffer}}}}]);