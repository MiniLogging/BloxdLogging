"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[22],{12188:(k,M,F)=>{F.d(M,{e:()=>l});class l{get underlyingResource(){return this._webGLTexture}constructor(){let k=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,M=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=M,!k&&(k=M.createTexture(),!k))throw new Error("Unable to create webGL texture");this.set(k)}setUsage(){}set(k){this._webGLTexture=k}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(k){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(k)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const k of this._MSAARenderBuffers)this._context.deleteRenderbuffer(k);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var k;let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(k=this._MSAARenderBuffers)||void 0===k?void 0:k[M])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},12169:(k,M,F)=>{F.r(M),F.d(M,{ThinEngine:()=>o});var l=F(578),t=F(12174),g=F(487),B=F(482);class G{constructor(){this.shaderLanguage=0}postProcessor(k,M,F,l,t){if(t.drawBuffersExtensionDisabled){const M=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;k=k.replace(M,"")}return k}}const A=/(flat\s)?\s*varying\s*.*/;class N{constructor(){this.shaderLanguage=0}attributeProcessor(k){return k.replace("attribute","in")}varyingCheck(k,M){return A.test(k)}varyingProcessor(k,M){return k.replace("varying",M?"in":"out")}postProcessor(k,M,F){const l=-1!==k.search(/#extension.+GL_EXT_draw_buffers.+require/);if(k=(k=k.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),F){const M=-1!==k.search(/layout *\(location *= *0\) *out/g);k=(k=(k=(k=(k=(k=(k=k.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(l||M?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==M.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+k}return k}}var d=F(12181),L=F(629),U=F(552),O=F(12188),w=F(588),Z=F(559),R=F(543),y=F(576);class m{}class o extends U.d{get name(){return this._name}set name(k){this._name=k}get version(){return this._webGLVersion}static get ShadersRepository(){return Z.e.ShadersRepository}static set ShadersRepository(k){Z.e.ShadersRepository=k}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(k){this._framebufferDimensionsObject=k}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(k,M,F,t){if(F=F||{},super(M??F.antialias,F,t),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!k)return;let B=null;if(k.getContext){if(B=k,this._renderingCanvas=B,void 0===F.Sk&&(F.Sk=!1),void 0===F.xrCompatible&&(F.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const k=navigator.userAgent;for(const M of o.ExceptionList){const l=M.key,t=M.targets;if(new RegExp(l).test(k)){if(M.capture&&M.captureConstraint){const F=M.capture,l=M.captureConstraint,t=new RegExp(F).exec(k);if(t&&t.length>0){if(parseInt(t[t.length-1])>=l)continue}}for(const k of t)switch(k){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":F.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=k=>{k.preventDefault(),this._contextWasLost=!0,g.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},B.addEventListener("webglcontextlost",this._onContextLost,!1),B.addEventListener("webglcontextrestored",this._onContextRestored,!1),F.powerPreference=F.powerPreference||"high-performance"),this._badDesktopOS&&(F.xrCompatible=!1),!F.disableWebGL2Support)try{this._gl=B.getContext("webgl2",F)||B.getContext("experimental-webgl2",F),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(L){}if(!this._gl){if(!B)throw new Error("The provided canvas is null or undefined.");try{this._gl=B.getContext("webgl",F)||B.getContext("experimental-webgl",F)}catch(L){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=k,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const M=this._gl.getContextAttributes();M&&(F.stencil=M.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==F.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=F.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let l=0;l<this._caps.maxVertexAttribs;l++)this._currentBufferPointers[l]=new m;this._shaderProcessor=this.webGLVersion>1?new N:new G;const A=`Babylon.js v${o.Version}`;g.c.Log(A+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",A);const d=(0,l.z)(this._gl);d.validateShaderPrograms=this.validateShaderPrograms,d.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(k){return null}areAllEffectsReady(){for(const k in this._compiledEffects){if(!this._compiledEffects[k].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const k=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=k&&(this._glRenderer=this._gl.getParameter(k.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(k.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const k=this._gl.getExtension("WEBGL_draw_buffers");if(null!==k){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=k.drawBuffersWEBGL.bind(k),this._caps.maxDrawBuffers=this._gl.getParameter(k.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let M=0;M<16;M++)this._gl["COLOR_ATTACHMENT"+M+"_WEBGL"]=k["COLOR_ATTACHMENT"+M+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const k=this._gl.getExtension("WEBGL_depth_texture");null!=k&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=k.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const k=this._gl.getExtension("OES_vertex_array_object");null!=k&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=k.createVertexArrayOES.bind(k),this._gl.bindVertexArray=k.bindVertexArrayOES.bind(k),this._gl.deleteVertexArray=k.deleteVertexArrayOES.bind(k))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const k=this._gl.getExtension("ANGLE_instanced_arrays");null!=k?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=k.drawArraysInstancedANGLE.bind(k),this._gl.drawElementsInstanced=k.drawElementsInstancedANGLE.bind(k),this._gl.vertexAttribDivisor=k.vertexAttribDivisorANGLE.bind(k)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const k=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),M=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);k&&M&&(this._caps.highPrecisionShaderSupported=0!==k.precision&&0!==M.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const k=this._gl.getExtension("EXT_blend_minmax");null!=k&&(this._caps.blendMinMax=!0,this._gl.MAX=k.MAX_EXT,this._gl.MIN=k.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const k=this._gl.getExtension("EXT_sRGB");null!=k&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:k.SRGB_EXT,SRGB8:k.SRGB_ALPHA_EXT,SRGB8_ALPHA8:k.SRGB_ALPHA_EXT})}if(this._creationOptions){const k=this._creationOptions.forceSRGBBufferSupportState;void 0!==k&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&k)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let M=0;M<this._maxSimultaneousTextures;M++)this._nextFreeTextureSlots.push(M);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const k=this._workingCanvas.getContext("2d");k&&(this._workingContext=k)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const k=this.getGlInfo();return k&&k.renderer?k.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(k,M,F){let l=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const t=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=t;let g=0;if(M&&k){let M=!0;if(this._currentRenderTarget){var B;const F=null===(B=this._currentRenderTarget.texture)||void 0===B?void 0:B.format;if(8===F||9===F||10===F||11===F){var G;const F=null===(G=this._currentRenderTarget.texture)||void 0===G?void 0:G.type;7===F||5===F?(o._TempClearColorUint32[0]=255*k.r,o._TempClearColorUint32[1]=255*k.g,o._TempClearColorUint32[2]=255*k.b,o._TempClearColorUint32[3]=255*k.a,this._gl.clearBufferuiv(this._gl.COLOR,0,o._TempClearColorUint32),M=!1):(o._TempClearColorInt32[0]=255*k.r,o._TempClearColorInt32[1]=255*k.g,o._TempClearColorInt32[2]=255*k.b,o._TempClearColorInt32[3]=255*k.a,this._gl.clearBufferiv(this._gl.COLOR,0,o._TempClearColorInt32),M=!1)}}M&&(this._gl.clearColor(k.r,k.g,k.b,void 0!==k.a?k.a:1),g|=this._gl.COLOR_BUFFER_BIT)}F&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),g|=this._gl.DEPTH_BUFFER_BIT),l&&(this._gl.clearStencil(0),g|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(g)}_viewport(k,M,F,l){k===this._viewportCached.x&&M===this._viewportCached.y&&F===this._viewportCached.z&&l===this._viewportCached.w||(this._viewportCached.x=k,this._viewportCached.y=M,this._viewportCached.z=F,this._viewportCached.w=l,this._gl.viewport(k,M,F,l))}jk(){super.jk(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(k){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0,l=arguments.length>3?arguments[3]:void 0,t=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const A=k;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=k,this._bindUnboundFramebuffer(A._framebuffer);const N=this._gl;var d;if(!k.isMulti)if(k.is2DArray||k.is3D)N.framebufferTextureLayer(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,null===(d=k.texture._hardwareTexture)||void 0===d?void 0:d.underlyingResource,B,G),A._currentLOD=B;else if(k.isCube){var L;N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_CUBE_MAP_POSITIVE_X+M,null===(L=k.texture._hardwareTexture)||void 0===L?void 0:L.underlyingResource,B)}else if(A._currentLOD!==B){var U;N.framebufferTexture2D(N.FRAMEBUFFER,N.COLOR_ATTACHMENT0,N.TEXTURE_2D,null===(U=k.texture._hardwareTexture)||void 0===U?void 0:U.underlyingResource,B),A._currentLOD=B}const O=k._depthStencilTexture;if(O){k.is3D&&(k.texture.width===O.width&&k.texture.height===O.height&&k.texture.depth===O.depth||g.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const F=k._depthStencilTextureWithStencil?N.DEPTH_STENCIL_ATTACHMENT:N.DEPTH_ATTACHMENT;var w;if(k.is2DArray||k.is3D)N.framebufferTextureLayer(N.FRAMEBUFFER,F,null===(w=O._hardwareTexture)||void 0===w?void 0:w.underlyingResource,B,G);else if(k.isCube){var Z;N.framebufferTexture2D(N.FRAMEBUFFER,F,N.TEXTURE_CUBE_MAP_POSITIVE_X+M,null===(Z=O._hardwareTexture)||void 0===Z?void 0:Z.underlyingResource,B)}else{var R;N.framebufferTexture2D(N.FRAMEBUFFER,F,N.TEXTURE_2D,null===(R=O._hardwareTexture)||void 0===R?void 0:R.underlyingResource,B)}}A._MSAAFramebuffer&&this._bindUnboundFramebuffer(A._MSAAFramebuffer),this._cachedViewport&&!t?this.setViewport(this._cachedViewport,F,l):(F||(F=k.width,B&&(F/=Math.pow(2,B))),l||(l=k.height,B&&(l/=Math.pow(2,B))),this._viewport(0,0,F,l)),this.wipeCaches()}setState(k){let M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,F=arguments.length>2?arguments[2]:void 0,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==k||F)&&(this._depthCullingState.cull=k);const G=this.cullBackFaces??t??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==G||F)&&(this._depthCullingState.cullFace=G),this.setZOffset(M),this.setZOffsetUnits(B);const A=l?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==A||F)&&(this._depthCullingState.frontFace=A),this._stencilStateComposer.stencilMaterial=g}_bindUnboundFramebuffer(k){this._currentFramebuffer!==k&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,k),this._currentFramebuffer=k)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(k){const M=this._getTextureTarget(k);this._bindTextureDirectly(M,k,!0),this._gl.generateMipmap(M),this._bindTextureDirectly(M,null)}unBindFramebuffer(k){var M;let F=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=arguments.length>2?arguments[2]:void 0;const t=k;this._currentRenderTarget=null;const g=this._gl;if(t._MSAAFramebuffer){if(k.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(k,F,l);g.bindFramebuffer(g.READ_FRAMEBUFFER,t._MSAAFramebuffer),g.bindFramebuffer(g.DRAW_FRAMEBUFFER,t._framebuffer),g.blitFramebuffer(0,0,k.width,k.height,0,0,k.width,k.height,g.COLOR_BUFFER_BIT,g.NEAREST)}null===(M=k.texture)||void 0===M||!M.generateMipMaps||F||k.isCube||this.generateMipmaps(k.texture),l&&(t._MSAAFramebuffer&&this._bindUnboundFramebuffer(t._framebuffer),l()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(k,M,F){return this._createVertexBuffer(k,this._gl.STATIC_DRAW)}_createVertexBuffer(k,M){const F=this._gl.createBuffer();if(!F)throw new Error("Unable to create vertex buffer");const l=new d.e(F);return this.bindArrayBuffer(l),"number"!==typeof k?k instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(k),M),l.wb=4*k.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,k,M),l.wb=k.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(k),M),l.wb=k),this._resetVertexBufferBinding(),l.references=1,l}createDynamicVertexBuffer(k,M){return this._createVertexBuffer(k,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(k,M,F){const l=this._gl.createBuffer(),t=new d.e(l);if(!l)throw new Error("Unable to create index buffer");this.bindIndexBuffer(t);const g=this._normalizeIndexData(k);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,g,M?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),t.references=1,t.is32Bits=4===g.BYTES_PER_ELEMENT,t}_normalizeIndexData(k){if(2===k.BYTES_PER_ELEMENT)return k;if(this._caps.uintIndices){if(k instanceof Uint32Array)return k;for(let M=0;M<k.length;M++)if(k[M]>=65535)return new Uint32Array(k);return new Uint16Array(k)}return new Uint16Array(k)}bindArrayBuffer(k){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(k,this._gl.ARRAY_BUFFER)}bindUniformBlock(k,M,F){const l=k.program,t=this._gl.getUniformBlockIndex(l,M);this._gl.uniformBlockBinding(l,t,F)}bindIndexBuffer(k){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(k,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(k,M){(this._vaoRecordInProgress||this._currentBoundBuffer[M]!==k)&&(this._gl.bindBuffer(M,k?k.underlyingResource:null),this._currentBoundBuffer[M]=k)}updateArrayBuffer(k){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,k)}_vertexAttribPointer(k,M,F,l,t,g,B){const G=this._currentBufferPointers[M];if(!G)return;let A=!1;G.active?(G.buffer!==k&&(G.buffer=k,A=!0),G.size!==F&&(G.size=F,A=!0),G.type!==l&&(G.type=l,A=!0),G.normalized!==t&&(G.normalized=t,A=!0),G.stride!==g&&(G.stride=g,A=!0),G.offset!==B&&(G.offset=B,A=!0)):(A=!0,G.active=!0,G.index=M,G.size=F,G.type=l,G.normalized=t,G.stride=g,G.offset=B,G.buffer=k),(A||this._vaoRecordInProgress)&&(this.bindArrayBuffer(k),l===this._gl.UNSIGNED_INT||l===this._gl.INT?this._gl.vertexAttribIPointer(M,F,l,g,B):this._gl.vertexAttribPointer(M,F,l,t,g,B))}_bindIndexBufferWithCache(k){null!=k&&this._cachedIndexBuffer!==k&&(this._cachedIndexBuffer=k,this.bindIndexBuffer(k),this._uintIndicesCurrentlySet=k.is32Bits)}_bindVertexBuffersAttributes(k,M,F){const l=M.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let t=0;t<l.length;t++){const g=M.getAttributeLocation(t);if(g>=0){const M=l[t];let B=null;if(F&&(B=F[M]),B||(B=k[M]),!B)continue;this._gl.enableVertexAttribArray(g),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[g]=!0);const G=B.getBuffer();G&&(this._vertexAttribPointer(G,g,B.getSize(),B.type,B.normalized,B.byteStride,B.byteOffset),B.getIsInstanced()&&(this._gl.vertexAttribDivisor(g,B.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(g),this._currentInstanceBuffers.push(G))))}}}recordVertexArrayObject(k,M,F,l){const t=this._gl.createVertexArray();if(!t)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(t),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(k,F,l),this.bindIndexBuffer(M),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),t}bindVertexArrayObject(k,M){this._cachedVertexArrayObject!==k&&(this._cachedVertexArrayObject=k,this._gl.bindVertexArray(k),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=M&&M.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(k,M,F,l,t){if(this._cachedVertexBuffers!==k||this._cachedEffectForVertexBuffers!==t){this._cachedVertexBuffers=k,this._cachedEffectForVertexBuffers=t;const M=t.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let g=0;for(let B=0;B<M;B++)if(B<F.length){const M=t.getAttributeLocation(B);M>=0&&(this._gl.enableVertexAttribArray(M),this._vertexAttribArraysEnabled[M]=!0,this._vertexAttribPointer(k,M,F[B],this._gl.FLOAT,!1,l,g)),g+=4*F[B]}}this._bindIndexBufferWithCache(M)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(k,M,F,l){this._cachedVertexBuffers===k&&this._cachedEffectForVertexBuffers===F||(this._cachedVertexBuffers=k,this._cachedEffectForVertexBuffers=F,this._bindVertexBuffersAttributes(k,F,l)),this._bindIndexBufferWithCache(M)}unbindInstanceAttributes(){let k;for(let M=0,F=this._currentInstanceLocations.length;M<F;M++){const F=this._currentInstanceBuffers[M];k!=F&&F.references&&(k=F,this.bindArrayBuffer(F));const l=this._currentInstanceLocations[M];this._gl.vertexAttribDivisor(l,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(k){this._gl.deleteVertexArray(k)}_releaseBuffer(k){return k.references--,0===k.references&&(this._deleteBuffer(k),!0)}_deleteBuffer(k){this._gl.deleteBuffer(k.underlyingResource)}updateAndBindInstancesBuffer(k,M,F){if(this.bindArrayBuffer(k),M&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,M),void 0!==F[0].index)this.bindInstancesBuffer(k,F,!0);else for(let l=0;l<4;l++){const M=F[l];this._vertexAttribArraysEnabled[M]||(this._gl.enableVertexAttribArray(M),this._vertexAttribArraysEnabled[M]=!0),this._vertexAttribPointer(k,M,4,this._gl.FLOAT,!1,64,16*l),this._gl.vertexAttribDivisor(M,1),this._currentInstanceLocations.push(M),this._currentInstanceBuffers.push(k)}}bindInstancesBuffer(k,M){let F=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(k);let l=0;if(F)for(let t=0;t<M.length;t++){l+=4*M[t].attributeSize}for(let t=0;t<M.length;t++){const F=M[t];void 0===F.index&&(F.index=this._currentEffect.getAttributeLocationByName(F.attributeName)),F.index<0||(this._vertexAttribArraysEnabled[F.index]||(this._gl.enableVertexAttribArray(F.index),this._vertexAttribArraysEnabled[F.index]=!0),this._vertexAttribPointer(k,F.index,F.attributeSize,F.attributeType||this._gl.FLOAT,F.normalized||!1,l,F.offset),this._gl.vertexAttribDivisor(F.index,void 0===F.divisor?1:F.divisor),this._currentInstanceLocations.push(F.index),this._currentInstanceBuffers.push(k))}}disableInstanceAttributeByName(k){if(!this._currentEffect)return;const M=this._currentEffect.getAttributeLocationByName(k);this.disableInstanceAttribute(M)}disableInstanceAttribute(k){let M,F=!1;for(;-1!==(M=this._currentInstanceLocations.indexOf(k));)this._currentInstanceLocations.splice(M,1),this._currentInstanceBuffers.splice(M,1),F=!0,M=this._currentInstanceLocations.indexOf(k);F&&(this._gl.vertexAttribDivisor(k,0),this.disableAttributeByIndex(k))}disableAttributeByIndex(k){this._gl.disableVertexAttribArray(k),this._vertexAttribArraysEnabled[k]=!1,this._currentBufferPointers[k].active=!1}draw(k,M,F,l){this.drawElementsType(k?0:1,M,F,l)}drawPointClouds(k,M,F){this.drawArraysType(2,k,M,F)}drawUnIndexed(k,M,F,l){this.drawArraysType(k?0:1,M,F,l)}drawElementsType(k,M,F,l){this.applyStates(),this._reportDrawCall();const t=this._drawMode(k),g=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,B=this._uintIndicesCurrentlySet?4:2;l?this._gl.drawElementsInstanced(t,F,g,M*B,l):this._gl.drawElements(t,F,g,M*B)}drawArraysType(k,M,F,l){this.applyStates(),this._reportDrawCall();const t=this._drawMode(k);l?this._gl.drawArraysInstanced(t,M,F,l):this._gl.drawArrays(t,M,F)}_drawMode(k){switch(k){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(k){this._compiledEffects[k._key]&&delete this._compiledEffects[k._key];const M=k.getPipelineContext();M&&this._deletePipelineContext(M)}_deletePipelineContext(k){const M=k;M&&M.program&&(M.program.__SPECTOR_rebuildProgram=null,(0,y.k)(M),this._gl.deleteProgram(M.program))}_getGlobalDefines(k){return(0,R.m)(k,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(k,M,F,t,g,B,G,A,N){let d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,L=arguments.length>10?arguments[10]:void 0;const U="string"===typeof k?k:k.vertexToken||k.vertexSource||k.vertexElement||k.vertex,O="string"===typeof k?k:k.fragmentToken||k.fragmentSource||k.fragmentElement||k.fragment,w=this._getGlobalDefines();let R=g??M.defines??"";w&&(R+=w);const y=U+"+"+O+"@"+R;if(this._compiledEffects[y]){const k=this._compiledEffects[y];return G&&k.isReady()&&G(k),k._refCount++,k}this._gl&&(0,l.z)(this._gl);const m=new Z.e(k,M,F,t,this,g,B,G,A,N,y,M.shaderLanguage??d,M.extraInitializationsAsync??L);return this._compiledEffects[y]=m,m}_getShaderSource(k){return this._gl.getShaderSource(k)}createRawShaderProgram(k,M,F,t){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const B=(0,l.z)(this._gl);return B._contextWasLost=this._contextWasLost,B.validateShaderPrograms=this.validateShaderPrograms,(0,l.u)(k,M,F,t||this._gl,g)}createShaderProgram(k,M,F,t,g){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const G=(0,l.z)(this._gl);return G._contextWasLost=this._contextWasLost,G.validateShaderPrograms=this.validateShaderPrograms,(0,l.v)(k,M,F,t,g||this._gl,B)}inlineShaderCode(k){return k}createPipelineContext(k){if(this._gl){(0,l.z)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const M=(0,l.t)(this._gl,k);return M.Xj=this,M}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(k){return(0,l.j)(k,this._gl,this.validateShaderPrograms)}_preparePipelineContext(k,M,F,t,g,B,G,A,N,d,L){const U=(0,l.z)(this._gl);return U._contextWasLost=this._contextWasLost,U.validateShaderPrograms=this.validateShaderPrograms,U._createShaderProgramInjection=this._createShaderProgram.bind(this),U.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),U.createShaderProgramInjection=this.createShaderProgram.bind(this),U.loadFileInjection=this._loadFile.bind(this),(0,l.n)(k,M,F,t,g,B,G,A,N,d,L)}_createShaderProgram(k,M,F,t){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,l.b)(k,M,F,t,g)}_isRenderingStateCompiled(k){const M=k;return!this._isDisposed&&!M._isDisposed&&(!!this._gl.getProgramParameter(M.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(M),!0))}_executeWhenRenderingStateIsCompiled(k,M){(0,l.f)(k,M)}getUniforms(k,M){const F=new Array,l=k;for(let t=0;t<M.length;t++)F.push(this._gl.getUniformLocation(l.program,M[t]));return F}getAttributes(k,M){const F=[],l=k;for(let g=0;g<M.length;g++)try{F.push(this._gl.getAttribLocation(l.program,M[g]))}catch(t){F.push(-1)}return F}enableEffect(k){(k=null!==k&&(0,t.c)(k)?k.effect:k)&&k!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(k),this._currentEffect=k,k.onBind&&k.onBind(k),k._onBindObservable&&k._onBindObservable.notifyObservers(k))}setInt(k,M){return!!k&&(this._gl.uniform1i(k,M),!0)}setInt2(k,M,F){return!!k&&(this._gl.uniform2i(k,M,F),!0)}setInt3(k,M,F,l){return!!k&&(this._gl.uniform3i(k,M,F,l),!0)}setInt4(k,M,F,l,t){return!!k&&(this._gl.uniform4i(k,M,F,l,t),!0)}setIntArray(k,M){return!!k&&(this._gl.uniform1iv(k,M),!0)}setIntArray2(k,M){return!(!k||M.length%2!==0)&&(this._gl.uniform2iv(k,M),!0)}setIntArray3(k,M){return!(!k||M.length%3!==0)&&(this._gl.uniform3iv(k,M),!0)}setIntArray4(k,M){return!(!k||M.length%4!==0)&&(this._gl.uniform4iv(k,M),!0)}setUInt(k,M){return!!k&&(this._gl.uniform1ui(k,M),!0)}setUInt2(k,M,F){return!!k&&(this._gl.uniform2ui(k,M,F),!0)}setUInt3(k,M,F,l){return!!k&&(this._gl.uniform3ui(k,M,F,l),!0)}setUInt4(k,M,F,l,t){return!!k&&(this._gl.uniform4ui(k,M,F,l,t),!0)}setUIntArray(k,M){return!!k&&(this._gl.uniform1uiv(k,M),!0)}setUIntArray2(k,M){return!(!k||M.length%2!==0)&&(this._gl.uniform2uiv(k,M),!0)}setUIntArray3(k,M){return!(!k||M.length%3!==0)&&(this._gl.uniform3uiv(k,M),!0)}setUIntArray4(k,M){return!(!k||M.length%4!==0)&&(this._gl.uniform4uiv(k,M),!0)}setArray(k,M){return!!k&&(!(M.length<1)&&(this._gl.uniform1fv(k,M),!0))}setArray2(k,M){return!(!k||M.length%2!==0)&&(this._gl.uniform2fv(k,M),!0)}setArray3(k,M){return!(!k||M.length%3!==0)&&(this._gl.uniform3fv(k,M),!0)}setArray4(k,M){return!(!k||M.length%4!==0)&&(this._gl.uniform4fv(k,M),!0)}setMatrices(k,M){return!!k&&(this._gl.uniformMatrix4fv(k,!1,M),!0)}setMatrix3x3(k,M){return!!k&&(this._gl.uniformMatrix3fv(k,!1,M),!0)}setMatrix2x2(k,M){return!!k&&(this._gl.uniformMatrix2fv(k,!1,M),!0)}setFloat(k,M){return!!k&&(this._gl.uniform1f(k,M),!0)}setFloat2(k,M,F){return!!k&&(this._gl.uniform2f(k,M,F),!0)}setFloat3(k,M,F,l){return!!k&&(this._gl.uniform3f(k,M,F,l),!0)}setFloat4(k,M,F,l,t){return!!k&&(this._gl.uniform4f(k,M,F,l,t),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const k=this._colorWrite;this._gl.colorMask(k,k,k,k)}}wipeCaches(k){this.preventCacheWipeBetweenFrames&&!k||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),k&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(k,M){const F=this._gl;let l=F.NEAREST,t=F.NEAREST;switch(k){case 11:l=F.LINEAR,t=M?F.LINEAR_MIPMAP_NEAREST:F.LINEAR;break;case 3:l=F.LINEAR,t=M?F.LINEAR_MIPMAP_LINEAR:F.LINEAR;break;case 8:l=F.NEAREST,t=M?F.NEAREST_MIPMAP_LINEAR:F.NEAREST;break;case 4:l=F.NEAREST,t=M?F.NEAREST_MIPMAP_NEAREST:F.NEAREST;break;case 5:l=F.NEAREST,t=M?F.LINEAR_MIPMAP_NEAREST:F.LINEAR;break;case 6:l=F.NEAREST,t=M?F.LINEAR_MIPMAP_LINEAR:F.LINEAR;break;case 7:l=F.NEAREST,t=F.LINEAR;break;case 1:l=F.NEAREST,t=F.NEAREST;break;case 9:l=F.LINEAR,t=M?F.NEAREST_MIPMAP_NEAREST:F.NEAREST;break;case 10:l=F.LINEAR,t=M?F.NEAREST_MIPMAP_LINEAR:F.NEAREST;break;case 2:l=F.LINEAR,t=F.LINEAR;break;case 12:l=F.LINEAR,t=F.NEAREST}return{min:t,mag:l}}_createTexture(){const k=this._gl.createTexture();if(!k)throw new Error("Unable to create texture");return k}_createHardwareTexture(){return new O.e(this._createTexture(),this._gl)}_createInternalTexture(k,M){let F,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=!1,B=0,G=3,A=5,N=!1,d=1;void 0!==M&&"object"===typeof M?(t=!!M.generateMipMaps,B=void 0===M.type?0:M.type,G=void 0===M.samplingMode?3:M.samplingMode,A=void 0===M.format?5:M.format,N=void 0!==M.useSRGBBuffer&&M.useSRGBBuffer,d=M.samples??1,F=M.label):t=!!M,N&&(N=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==B||this._caps.textureFloatLinearFiltering)&&(2!==B||this._caps.textureHalfFloatLinearFiltering)||(G=1),1!==B||this._caps.textureFloat||(B=0,g.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const L=this._gl,U=new w.c(this,l),O=k.width||k,Z=k.height||k,R=k.depth||0,y=k.layers||0,m=this._getSamplingParameters(G,t),o=0!==y?L.TEXTURE_2D_ARRAY:0!==R?L.TEXTURE_3D:L.TEXTURE_2D,Q=this._getRGBABufferInternalSizedFormat(B,A,N),v=this._getInternalFormat(A),J=this._getWebGLTextureType(B);return this._bindTextureDirectly(o,U),0!==y?(U.is2DArray=!0,L.texImage3D(o,0,Q,O,Z,y,0,v,J,null)):0!==R?(U.is3D=!0,L.texImage3D(o,0,Q,O,Z,R,0,v,J,null)):L.texImage2D(o,0,Q,O,Z,0,v,J,null),L.texParameteri(o,L.TEXTURE_MAG_FILTER,m.mag),L.texParameteri(o,L.TEXTURE_MIN_FILTER,m.min),L.texParameteri(o,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),L.texParameteri(o,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE),t&&this._gl.generateMipmap(o),this._bindTextureDirectly(o,null),U._useSRGBBuffer=N,U.baseWidth=O,U.baseHeight=Z,U.width=O,U.height=Z,U.depth=y,U.isReady=!0,U.samples=d,U.generateMipMaps=t,U.samplingMode=G,U.type=B,U.format=A,U.label=F,this._internalTexturesCache.push(U),U}_getUseSRGBBuffer(k,M){return k&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||M)}createTexture(k,M,F,l){var t=this;let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,N=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,d=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,L=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,U=arguments.length>11?arguments[11]:void 0,O=arguments.length>12?arguments[12]:void 0,Z=arguments.length>13?arguments[13]:void 0,R=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(k,M,F,l,g,B,G,(function(){for(var k=arguments.length,M=new Array(k),F=0;F<k;F++)M[F]=arguments[F];return t._prepareWebGLTexture(...M,d)}),((k,M,F,t,g,B)=>{const G=this._gl,A=F.width===k&&F.height===M;g._creationFlags=Z??0;const N=this._getTexImageParametersForCreateTexture(g.format,g._useSRGBBuffer);if(A)return G.texImage2D(G.TEXTURE_2D,0,N.internalFormat,N.format,N.type,F),!1;const d=this._caps.maxTextureSize;if(F.width>d||F.height>d||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=k,this._workingCanvas.height=M,this._workingContext.drawImage(F,0,0,F.width,F.height,0,0,k,M),G.texImage2D(G.TEXTURE_2D,0,N.internalFormat,N.format,N.type,this._workingCanvas),g.width=k,g.height=M,!1);{const k=new w.c(this,2);this._bindTextureDirectly(G.TEXTURE_2D,k,!0),G.texImage2D(G.TEXTURE_2D,0,N.internalFormat,N.format,N.type,F),this._rescaleTexture(k,g,l,N.format,(()=>{this._releaseTexture(k),this._bindTextureDirectly(G.TEXTURE_2D,g,!0),B()}))}return!0}),A,N,d,L,U,O,R)}_getTexImageParametersForCreateTexture(k,M){let F,l;return 1===this.webGLVersion?(F=this._getInternalFormat(k,M),l=F):(F=this._getInternalFormat(k,!1),l=this._getRGBABufferInternalSizedFormat(0,k,M)),{internalFormat:l,format:F,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(k,M,F,l,t){}_unpackFlipY(k){this._unpackFlipYCached!==k&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,k?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=k))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(k){return k.isCube?this._gl.TEXTURE_CUBE_MAP:k.is3D?this._gl.TEXTURE_3D:k.is2DArray||k.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(k,M){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const l=this._getTextureTarget(M),t=this._getSamplingParameters(k,M.useMipMaps||F);this._setTextureParameterInteger(l,this._gl.TEXTURE_MAG_FILTER,t.mag,M),this._setTextureParameterInteger(l,this._gl.TEXTURE_MIN_FILTER,t.min),F&&(M.generateMipMaps=!0,this._gl.generateMipmap(l)),this._bindTextureDirectly(l,null),M.samplingMode=k}updateTextureDimensions(k,M,F){}updateTextureWrappingMode(k,M){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const t=this._getTextureTarget(k);null!==M&&(this._setTextureParameterInteger(t,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(M),k),k._cachedWrapU=M),null!==F&&(this._setTextureParameterInteger(t,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(F),k),k._cachedWrapV=F),(k.is2DArray||k.is3D)&&null!==l&&(this._setTextureParameterInteger(t,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(l),k),k._cachedWrapR=l),this._bindTextureDirectly(t,null)}_uploadCompressedDataToTextureDirectly(k,M,F,l,t){let g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const G=this._gl;let A=G.TEXTURE_2D;if(k.isCube&&(A=G.TEXTURE_CUBE_MAP_POSITIVE_X+g),k._useSRGBBuffer)switch(M){case 37492:case 36196:this._caps.etc2?M=G.COMPRESSED_SRGB8_ETC2:k._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?M=G.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:k._useSRGBBuffer=!1;break;case 36492:M=G.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:M=G.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?M=G.COMPRESSED_SRGB_S3TC_DXT1_EXT:k._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?M=G.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:k._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?M=G.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:k._useSRGBBuffer=!1;break;default:k._useSRGBBuffer=!1}this._gl.compressedTexImage2D(A,B,M,F,l,0,t)}_uploadDataToTextureDirectly(k,M){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,t=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=this._gl,G=this._getWebGLTextureType(k.type),A=this._getInternalFormat(k.format),N=void 0===t?this._getRGBABufferInternalSizedFormat(k.type,k.format,k._useSRGBBuffer):this._getInternalFormat(t,k._useSRGBBuffer);this._unpackFlipY(k.invertY);let d=B.TEXTURE_2D;k.isCube&&(d=B.TEXTURE_CUBE_MAP_POSITIVE_X+F);const L=Math.round(Math.log(k.width)*Math.LOG2E),U=Math.round(Math.log(k.height)*Math.LOG2E),O=g?k.width:Math.pow(2,Math.max(L-l,0)),w=g?k.height:Math.pow(2,Math.max(U-l,0));B.texImage2D(d,l,N,O,w,0,A,G,M)}updateTextureData(k,M,F,l,t,g){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,G=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,A=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const N=this._gl,d=this._getWebGLTextureType(k.type),L=this._getInternalFormat(k.format);this._unpackFlipY(k.invertY);let U=N.TEXTURE_2D,O=N.TEXTURE_2D;k.isCube&&(O=N.TEXTURE_CUBE_MAP_POSITIVE_X+B,U=N.TEXTURE_CUBE_MAP),this._bindTextureDirectly(U,k,!0),N.texSubImage2D(O,G,F,l,t,g,L,d,M),A&&this._gl.generateMipmap(O),this._bindTextureDirectly(U,null)}_uploadArrayBufferViewToTexture(k,M){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const t=this._gl,g=k.isCube?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D;this._bindTextureDirectly(g,k,!0),this._uploadDataToTextureDirectly(k,M,F,l),this._bindTextureDirectly(g,null,!0)}_prepareWebGLTextureContinuation(k,M,F,l,t){const g=this._gl;if(!g)return;const B=this._getSamplingParameters(t,!F);g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,B.mag),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,B.min),F||l||g.generateMipmap(g.TEXTURE_2D),this._bindTextureDirectly(g.TEXTURE_2D,null),M&&M.removePendingData(k),k.onLoadedObservable.notifyObservers(k),k.onLoadedObservable.clear()}_prepareWebGLTexture(k,M,F,l,t,g,B,G,A,N){const d=this.getCaps().maxTextureSize,U=Math.min(d,this.needPOTTextures?(0,L.f)(l.width,d):l.width),O=Math.min(d,this.needPOTTextures?(0,L.f)(l.height,d):l.height),w=this._gl;w&&(k._hardwareTexture?(this._bindTextureDirectly(w.TEXTURE_2D,k,!0),this._unpackFlipY(void 0===t||!!t),k.baseWidth=l.width,k.baseHeight=l.height,k.width=U,k.height=O,k.isReady=!0,k.type=-1!==k.type?k.type:0,k.format=-1!==k.format?k.format:N??(".jpg"!==M||k._useSRGBBuffer?5:4),G(U,O,l,M,k,(()=>{this._prepareWebGLTextureContinuation(k,F,g,B,A)}))||this._prepareWebGLTextureContinuation(k,F,g,B,A)):F&&F.removePendingData(k))}_getInternalFormatFromDepthTextureFormat(k,M,F){const l=this._gl;if(!M)return l.STENCIL_INDEX8;let t=F?l.DEPTH_STENCIL:l.DEPTH_COMPONENT;return this.webGLVersion>1?15===k?t=l.DEPTH_COMPONENT16:16===k?t=l.DEPTH_COMPONENT24:17===k||13===k?t=F?l.DEPTH24_STENCIL8:l.DEPTH_COMPONENT24:14===k?t=l.DEPTH_COMPONENT32F:18===k&&(t=F?l.DEPTH32F_STENCIL8:l.DEPTH_COMPONENT32F):t=l.DEPTH_COMPONENT16,t}_setupFramebufferDepthAttachments(k,M,F,l){let t=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,g=arguments.length>5?arguments[5]:void 0;const B=this._gl;g=g??(k?13:14);const G=this._getInternalFormatFromDepthTextureFormat(g,M,k);return k&&M?this._createRenderBuffer(F,l,t,B.DEPTH_STENCIL,G,B.DEPTH_STENCIL_ATTACHMENT):M?this._createRenderBuffer(F,l,t,G,G,B.DEPTH_ATTACHMENT):k?this._createRenderBuffer(F,l,t,G,G,B.STENCIL_ATTACHMENT):null}_createRenderBuffer(k,M,F,l,t,g){let B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const G=this._gl.createRenderbuffer();return this._updateRenderBuffer(G,k,M,F,l,t,g,B)}_updateRenderBuffer(k,M,F,l,t,g,B){let G=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const A=this._gl;return A.bindRenderbuffer(A.RENDERBUFFER,k),l>1&&A.renderbufferStorageMultisample?A.renderbufferStorageMultisample(A.RENDERBUFFER,l,g,M,F):A.renderbufferStorage(A.RENDERBUFFER,t,M,F),A.framebufferRenderbuffer(A.FRAMEBUFFER,B,A.RENDERBUFFER,k),G&&A.bindRenderbuffer(A.RENDERBUFFER,null),k}_releaseTexture(k){this._deleteTexture(k._hardwareTexture),this.unbindAllTextures();const M=this._internalTexturesCache.indexOf(k);-1!==M&&this._internalTexturesCache.splice(M,1),k._lodTextureHigh&&k._lodTextureHigh.dispose(),k._lodTextureMid&&k._lodTextureMid.dispose(),k._lodTextureLow&&k._lodTextureLow.dispose(),k._irradianceTexture&&k._irradianceTexture.dispose()}_deleteTexture(k){null===k||void 0===k||k.release()}_setProgram(k){this._currentProgram!==k&&((0,l.q)(k,this._gl),this._currentProgram=k)}bindSamplers(k){const M=k.getPipelineContext();this._setProgram(M.program);const F=k.getSamplers();for(let l=0;l<F.length;l++){const M=k.getUniform(F[l]);M&&(this._boundUniforms[l]=M)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(k,M){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],t=!1;const B=M&&M._associatedChannel>-1;F&&B&&(this._activeChannel=M._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==M||l){if(this._activateCurrentTexture(),M&&M.isMultiview)throw g.c.Error(["_bindTextureDirectly called with a multiview texture!",k,M]),"_bindTextureDirectly called with a multiview texture!";var G;this._gl.bindTexture(k,(null===M||void 0===M||null===(G=M._hardwareTexture)||void 0===G?void 0:G.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=M,M&&(M._associatedChannel=this._activeChannel)}else F&&(t=!0,this._activateCurrentTexture());return B&&!F&&this._bindSamplerUniformToChannel(M._associatedChannel,this._activeChannel),t}_bindTexture(k,M,F){if(void 0===k)return;M&&(M._associatedChannel=k),this._activeChannel=k;const l=M?this._getTextureTarget(M):this._gl.TEXTURE_2D;this._bindTextureDirectly(l,M)}unbindAllTextures(){for(let k=0;k<this._maxSimultaneousTextures;k++)this._activeChannel=k,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(k,M,F,l){void 0!==k&&(M&&(this._boundUniforms[k]=M),this._setTexture(k,F))}_bindSamplerUniformToChannel(k,M){const F=this._boundUniforms[k];F&&F._currentState!==M&&(this._gl.uniform1i(F,M),F._currentState=M)}_getTextureWrapMode(k){switch(k){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(k,M){let F,l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!M)return null!=this._boundTexturesCache[k]&&(this._activeChannel=k,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(M.video){this._activeChannel=k;const F=M.getInternalTexture();F&&(F._associatedChannel=k),M.update()}else if(4===M.delayLoadState)return M.delayLoad(),!1;F=t?M.depthStencilTexture:M.isReady()?M.getInternalTexture():M.isCube?this.emptyCubeTexture:M.is3D?this.emptyTexture3D:M.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!l&&F&&(F._associatedChannel=k);let g=!0;this._boundTexturesCache[k]===F&&(l||this._bindSamplerUniformToChannel(F._associatedChannel,k),g=!1),this._activeChannel=k;const B=this._getTextureTarget(F);if(g&&this._bindTextureDirectly(B,F,l),F&&!F.isMultiview){if(F.isCube&&F._cachedCoordinatesMode!==M.coordinatesMode){F._cachedCoordinatesMode=M.coordinatesMode;const k=3!==M.coordinatesMode&&5!==M.coordinatesMode?1:0;M.wrapU=k,M.wrapV=k}F._cachedWrapU!==M.wrapU&&(F._cachedWrapU=M.wrapU,this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(M.wrapU),F)),F._cachedWrapV!==M.wrapV&&(F._cachedWrapV=M.wrapV,this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(M.wrapV),F)),F.is3D&&F._cachedWrapR!==M.wrapR&&(F._cachedWrapR=M.wrapR,this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(M.wrapR),F)),this._setAnisotropicLevel(B,F,M.anisotropicFilteringLevel)}return!0}setTextureArray(k,M,F,l){if(void 0!==k&&M){this._textureUnits&&this._textureUnits.length===F.length||(this._textureUnits=new Int32Array(F.length));for(let M=0;M<F.length;M++){const l=F[M].getInternalTexture();l?(this._textureUnits[M]=k+M,l._associatedChannel=k+M):this._textureUnits[M]=-1}this._gl.uniform1iv(M,this._textureUnits);for(let k=0;k<F.length;k++)this._setTexture(this._textureUnits[k],F[k],!0)}}_setAnisotropicLevel(k,M,F){const l=this._caps.textureAnisotropicFilterExtension;11!==M.samplingMode&&3!==M.samplingMode&&2!==M.samplingMode&&(F=1),l&&M._cachedAnisotropicFilteringLevel!==F&&(this._setTextureParameterFloat(k,l.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(F,this._caps.maxAnisotropy),M),M._cachedAnisotropicFilteringLevel=F)}_setTextureParameterFloat(k,M,F,l){this._bindTextureDirectly(k,l,!0,!0),this._gl.texParameterf(k,M,F)}_setTextureParameterInteger(k,M,F,l){l&&this._bindTextureDirectly(k,l,!0,!0),this._gl.texParameteri(k,M,F)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let k=0;k<this._caps.maxVertexAttribs;k++)this.disableAttributeByIndex(k)}else for(let k=0,M=this._vertexAttribArraysEnabled.length;k<M;k++)k>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[k]||this.disableAttributeByIndex(k)}releaseEffects(){const k=Object.keys(this._compiledEffects);for(const M of k){this._compiledEffects[M].dispose()}this._compiledEffects={}}dispose(){var k;((0,B.j)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(k=this._gl.getExtension("WEBGL_lose_context"))||void 0===k||k.loseContext());(0,l.x)(this._gl)}attachContextLostEvent(k){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",k,!1)}attachContextRestoredEvent(k){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",k,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(k){const M=this._gl;for(;M.getError()!==M.NO_ERROR;);let F=!0;const l=M.createTexture();M.bindTexture(M.TEXTURE_2D,l),M.texImage2D(M.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(k),1,1,0,M.RGBA,this._getWebGLTextureType(k),null),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MIN_FILTER,M.NEAREST),M.texParameteri(M.TEXTURE_2D,M.TEXTURE_MAG_FILTER,M.NEAREST);const t=M.createFramebuffer();M.bindFramebuffer(M.FRAMEBUFFER,t),M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_2D,l,0);const g=M.checkFramebufferStatus(M.FRAMEBUFFER);if(F=F&&g===M.FRAMEBUFFER_COMPLETE,F=F&&M.getError()===M.NO_ERROR,F&&(M.clear(M.COLOR_BUFFER_BIT),F=F&&M.getError()===M.NO_ERROR),F){M.bindFramebuffer(M.FRAMEBUFFER,null);const k=M.RGBA,l=M.UNSIGNED_BYTE,t=new Uint8Array(4);M.readPixels(0,0,1,1,k,l,t),F=F&&M.getError()===M.NO_ERROR}for(M.deleteTexture(l),M.deleteFramebuffer(t),M.bindFramebuffer(M.FRAMEBUFFER,null);!F&&M.getError()!==M.NO_ERROR;);return F}_getWebGLTextureType(k){if(1===this._webGLVersion){switch(k){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(k){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(k){let M=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=M?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(k){case 0:F=this._gl.ALPHA;break;case 1:F=this._gl.LUMINANCE;break;case 2:F=this._gl.LUMINANCE_ALPHA;break;case 6:F=this._gl.RED;break;case 7:F=this._gl.RG;break;case 4:F=M?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:F=M?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(k){case 8:F=this._gl.RED_INTEGER;break;case 9:F=this._gl.RG_INTEGER;break;case 10:F=this._gl.RGB_INTEGER;break;case 11:F=this._gl.RGBA_INTEGER}return F}_getRGBABufferInternalSizedFormat(k,M){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==M)switch(M){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return F?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(k){case 3:switch(M){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(M){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return F?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return F?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(M){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(M){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(M){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(M){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(M){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(M){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(M){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return F?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(k,M,F,l){let t=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const B=t?4:3,G=t?this._gl.RGBA:this._gl.RGB,A=new Uint8Array(l*F*B);return g&&this.flushFramebuffer(),this._gl.readPixels(k,M,F,l,G,this._gl.UNSIGNED_BYTE,A),Promise.resolve(A)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const k=U.d._CreateCanvas(1,1),M=k.getContext("webgl")||k.getContext("experimental-webgl");this._IsSupported=null!=M&&!!window.WebGLRenderingContext}catch(k){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const k=U.d._CreateCanvas(1,1),M=k.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||k.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!M}catch(k){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}o._TempClearColorUint32=new Uint32Array(4),o._TempClearColorInt32=new Int32Array(4),o.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],o._ConcatenateShader=R.i,o._IsSupported=null,o._HasMajorPerformanceCaveat=null},12174:(k,M,F)=>{function l(k){return void 0===k.getPipelineContext}F.d(M,{c:()=>l})},12181:(k,M,F)=>{F.d(M,{e:()=>t});var l=F(738);class t extends l.e{constructor(k){super(),this._buffer=k}get underlyingResource(){return this._buffer}}}}]);