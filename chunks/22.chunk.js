"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[22],{12012:(K,Y,l)=>{l.d(Y,{e:()=>v});class v{get underlyingResource(){return this._webGLTexture}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,Y=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=Y,!K&&(K=Y.createTexture(),!K))throw new Error("Unable to create webGL texture");this.set(K)}setUsage(){}set(K){this._webGLTexture=K}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(K){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(K)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const K of this._MSAARenderBuffers)this._context.deleteRenderbuffer(K);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var K;let Y=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._MSAARenderBuffers)||void 0===K?void 0:K[Y])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},12001:(K,Y,l)=>{l.r(Y),l.d(Y,{ThinEngine:()=>R});var v=l(586),U=l(12005),d=l(492),A=l(484);class c{constructor(){this.shaderLanguage=0}postProcessor(K,Y,l,v,U){if(U.drawBuffersExtensionDisabled){const Y=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;K=K.replace(Y,"")}return K}}const t=/(flat\s)?\s*varying\s*.*/;class Z{constructor(){this.shaderLanguage=0}attributeProcessor(K){return K.replace("attribute","in")}varyingCheck(K,Y){return t.test(K)}varyingProcessor(K,Y){return K.replace("varying",Y?"in":"out")}postProcessor(K,Y,l){const v=-1!==K.search(/#extension.+GL_EXT_draw_buffers.+require/);if(K=(K=K.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),l){const Y=-1!==K.search(/layout *\(location *= *0\) *out/g);K=(K=(K=(K=(K=(K=(K=K.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(v||Y?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==Y.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+K}return K}}var m=l(12010),V=l(627),M=l(567),u=l(12012),o=l(594),W=l(569),g=l(558),J=l(583);class n{}class R extends M.b{get name(){return this._name}set name(K){this._name=K}get version(){return this._webGLVersion}static get ShadersRepository(){return W.b.ShadersRepository}static set ShadersRepository(K){W.b.ShadersRepository=K}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(K){this._framebufferDimensionsObject=K}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(K,Y,l,U){if(l=l||{},super(Y??l.antialias,l,U),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!K)return;let A=null;if(K.getContext){if(A=K,this._renderingCanvas=A,void 0===l.Qk&&(l.Qk=!1),void 0===l.xrCompatible&&(l.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const K=navigator.userAgent;for(const Y of R.ExceptionList){const v=Y.key,U=Y.targets;if(new RegExp(v).test(K)){if(Y.capture&&Y.captureConstraint){const l=Y.capture,v=Y.captureConstraint,U=new RegExp(l).exec(K);if(U&&U.length>0){if(parseInt(U[U.length-1])>=v)continue}}for(const K of U)switch(K){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":l.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=K=>{K.preventDefault(),this._contextWasLost=!0,d.e.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},A.addEventListener("webglcontextlost",this._onContextLost,!1),A.addEventListener("webglcontextrestored",this._onContextRestored,!1),l.powerPreference=l.powerPreference||"high-performance"),this._badDesktopOS&&(l.xrCompatible=!1),!l.disableWebGL2Support)try{this._gl=A.getContext("webgl2",l)||A.getContext("experimental-webgl2",l),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(V){}if(!this._gl){if(!A)throw new Error("The provided canvas is null or undefined.");try{this._gl=A.getContext("webgl",l)||A.getContext("experimental-webgl",l)}catch(V){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=K,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const Y=this._gl.getContextAttributes();Y&&(l.stencil=Y.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==l.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=l.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let v=0;v<this._caps.maxVertexAttribs;v++)this._currentBufferPointers[v]=new n;this._shaderProcessor=this.webGLVersion>1?new Z:new c;const t=`Babylon.js v${R.Version}`;d.e.Log(t+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",t);const m=(0,v.C)(this._gl);m.validateShaderPrograms=this.validateShaderPrograms,m.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(K){return null}areAllEffectsReady(){for(const K in this._compiledEffects){if(!this._compiledEffects[K].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const K=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=K&&(this._glRenderer=this._gl.getParameter(K.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(K.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const K=this._gl.getExtension("WEBGL_draw_buffers");if(null!==K){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=K.drawBuffersWEBGL.bind(K),this._caps.maxDrawBuffers=this._gl.getParameter(K.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let Y=0;Y<16;Y++)this._gl["COLOR_ATTACHMENT"+Y+"_WEBGL"]=K["COLOR_ATTACHMENT"+Y+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const K=this._gl.getExtension("WEBGL_depth_texture");null!=K&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=K.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const K=this._gl.getExtension("OES_vertex_array_object");null!=K&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=K.createVertexArrayOES.bind(K),this._gl.bindVertexArray=K.bindVertexArrayOES.bind(K),this._gl.deleteVertexArray=K.deleteVertexArrayOES.bind(K))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const K=this._gl.getExtension("ANGLE_instanced_arrays");null!=K?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=K.drawArraysInstancedANGLE.bind(K),this._gl.drawElementsInstanced=K.drawElementsInstancedANGLE.bind(K),this._gl.vertexAttribDivisor=K.vertexAttribDivisorANGLE.bind(K)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const K=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),Y=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);K&&Y&&(this._caps.highPrecisionShaderSupported=0!==K.precision&&0!==Y.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const K=this._gl.getExtension("EXT_blend_minmax");null!=K&&(this._caps.blendMinMax=!0,this._gl.MAX=K.MAX_EXT,this._gl.MIN=K.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const K=this._gl.getExtension("EXT_sRGB");null!=K&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:K.SRGB_EXT,SRGB8:K.SRGB_ALPHA_EXT,SRGB8_ALPHA8:K.SRGB_ALPHA_EXT})}if(this._creationOptions){const K=this._creationOptions.forceSRGBBufferSupportState;void 0!==K&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&K)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let Y=0;Y<this._maxSimultaneousTextures;Y++)this._nextFreeTextureSlots.push(Y);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const K=this._workingCanvas.getContext("2d");K&&(this._workingContext=K)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const K=this.getGlInfo();return K&&K.renderer?K.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(K,Y,l){let v=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const U=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=U;let d=0;if(Y&&K){let Y=!0;if(this._currentRenderTarget){var A;const l=null===(A=this._currentRenderTarget.texture)||void 0===A?void 0:A.format;if(8===l||9===l||10===l||11===l){var c;const l=null===(c=this._currentRenderTarget.texture)||void 0===c?void 0:c.type;7===l||5===l?(R._TempClearColorUint32[0]=255*K.r,R._TempClearColorUint32[1]=255*K.g,R._TempClearColorUint32[2]=255*K.b,R._TempClearColorUint32[3]=255*K.a,this._gl.clearBufferuiv(this._gl.COLOR,0,R._TempClearColorUint32),Y=!1):(R._TempClearColorInt32[0]=255*K.r,R._TempClearColorInt32[1]=255*K.g,R._TempClearColorInt32[2]=255*K.b,R._TempClearColorInt32[3]=255*K.a,this._gl.clearBufferiv(this._gl.COLOR,0,R._TempClearColorInt32),Y=!1)}}Y&&(this._gl.clearColor(K.r,K.g,K.b,void 0!==K.a?K.a:1),d|=this._gl.COLOR_BUFFER_BIT)}l&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),d|=this._gl.DEPTH_BUFFER_BIT),v&&(this._gl.clearStencil(0),d|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(d)}_viewport(K,Y,l,v){K===this._viewportCached.x&&Y===this._viewportCached.y&&l===this._viewportCached.z&&v===this._viewportCached.w||(this._viewportCached.x=K,this._viewportCached.y=Y,this._viewportCached.z=l,this._viewportCached.w=v,this._gl.viewport(K,Y,l,v))}Gi(){super.Gi(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0,v=arguments.length>3?arguments[3]:void 0,U=arguments.length>4?arguments[4]:void 0,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const t=K;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=K,this._bindUnboundFramebuffer(t._framebuffer);const Z=this._gl;var m;if(!K.isMulti)if(K.is2DArray||K.is3D)Z.framebufferTextureLayer(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,null===(m=K.texture._hardwareTexture)||void 0===m?void 0:m.underlyingResource,A,c),t._currentLOD=A;else if(K.isCube){var V;Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_CUBE_MAP_POSITIVE_X+Y,null===(V=K.texture._hardwareTexture)||void 0===V?void 0:V.underlyingResource,A)}else if(t._currentLOD!==A){var M;Z.framebufferTexture2D(Z.FRAMEBUFFER,Z.COLOR_ATTACHMENT0,Z.TEXTURE_2D,null===(M=K.texture._hardwareTexture)||void 0===M?void 0:M.underlyingResource,A),t._currentLOD=A}const u=K._depthStencilTexture;if(u){K.is3D&&(K.texture.width===u.width&&K.texture.height===u.height&&K.texture.depth===u.depth||d.e.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const l=K._depthStencilTextureWithStencil?Z.DEPTH_STENCIL_ATTACHMENT:Z.DEPTH_ATTACHMENT;var o;if(K.is2DArray||K.is3D)Z.framebufferTextureLayer(Z.FRAMEBUFFER,l,null===(o=u._hardwareTexture)||void 0===o?void 0:o.underlyingResource,A,c);else if(K.isCube){var W;Z.framebufferTexture2D(Z.FRAMEBUFFER,l,Z.TEXTURE_CUBE_MAP_POSITIVE_X+Y,null===(W=u._hardwareTexture)||void 0===W?void 0:W.underlyingResource,A)}else{var g;Z.framebufferTexture2D(Z.FRAMEBUFFER,l,Z.TEXTURE_2D,null===(g=u._hardwareTexture)||void 0===g?void 0:g.underlyingResource,A)}}t._MSAAFramebuffer&&this._bindUnboundFramebuffer(t._MSAAFramebuffer),this._cachedViewport&&!U?this.setViewport(this._cachedViewport,l,v):(l||(l=K.width,A&&(l/=Math.pow(2,A))),v||(v=K.height,A&&(v/=Math.pow(2,A))),this._viewport(0,0,l,v)),this.wipeCaches()}setState(K){let Y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,l=arguments.length>2?arguments[2]:void 0,v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=arguments.length>4?arguments[4]:void 0,d=arguments.length>5?arguments[5]:void 0,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==K||l)&&(this._depthCullingState.cull=K);const c=this.cullBackFaces??U??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==c||l)&&(this._depthCullingState.cullFace=c),this.setZOffset(Y),this.setZOffsetUnits(A);const t=v?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==t||l)&&(this._depthCullingState.frontFace=t),this._stencilStateComposer.stencilMaterial=d}_bindUnboundFramebuffer(K){this._currentFramebuffer!==K&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,K),this._currentFramebuffer=K)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(K){const Y=this._getTextureTarget(K);this._bindTextureDirectly(Y,K,!0),this._gl.generateMipmap(Y),this._bindTextureDirectly(Y,null)}unBindFramebuffer(K){var Y;let l=arguments.length>1&&void 0!==arguments[1]&&arguments[1],v=arguments.length>2?arguments[2]:void 0;const U=K;this._currentRenderTarget=null;const d=this._gl;if(U._MSAAFramebuffer){if(K.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(K,l,v);d.bindFramebuffer(d.READ_FRAMEBUFFER,U._MSAAFramebuffer),d.bindFramebuffer(d.DRAW_FRAMEBUFFER,U._framebuffer),d.blitFramebuffer(0,0,K.width,K.height,0,0,K.width,K.height,d.COLOR_BUFFER_BIT,d.NEAREST)}null===(Y=K.texture)||void 0===Y||!Y.generateMipMaps||l||K.isCube||this.generateMipmaps(K.texture),v&&(U._MSAAFramebuffer&&this._bindUnboundFramebuffer(U._framebuffer),v()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(K,Y,l){return this._createVertexBuffer(K,this._gl.STATIC_DRAW)}_createVertexBuffer(K,Y){const l=this._gl.createBuffer();if(!l)throw new Error("Unable to create vertex buffer");const v=new m.b(l);return this.bindArrayBuffer(v),"number"!==typeof K?K instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(K),Y),v.Wh=4*K.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,K,Y),v.Wh=K.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(K),Y),v.Wh=K),this._resetVertexBufferBinding(),v.references=1,v}createDynamicVertexBuffer(K,Y){return this._createVertexBuffer(K,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(K,Y,l){const v=this._gl.createBuffer(),U=new m.b(v);if(!v)throw new Error("Unable to create index buffer");this.bindIndexBuffer(U);const d=this._normalizeIndexData(K);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,d,Y?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),U.references=1,U.is32Bits=4===d.BYTES_PER_ELEMENT,U}_normalizeIndexData(K){if(2===K.BYTES_PER_ELEMENT)return K;if(this._caps.uintIndices){if(K instanceof Uint32Array)return K;for(let Y=0;Y<K.length;Y++)if(K[Y]>=65535)return new Uint32Array(K);return new Uint16Array(K)}return new Uint16Array(K)}bindArrayBuffer(K){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(K,this._gl.ARRAY_BUFFER)}bindUniformBlock(K,Y,l){const v=K.program,U=this._gl.getUniformBlockIndex(v,Y);this._gl.uniformBlockBinding(v,U,l)}bindIndexBuffer(K){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(K,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(K,Y){(this._vaoRecordInProgress||this._currentBoundBuffer[Y]!==K)&&(this._gl.bindBuffer(Y,K?K.underlyingResource:null),this._currentBoundBuffer[Y]=K)}updateArrayBuffer(K){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,K)}_vertexAttribPointer(K,Y,l,v,U,d,A){const c=this._currentBufferPointers[Y];if(!c)return;let t=!1;c.active?(c.buffer!==K&&(c.buffer=K,t=!0),c.size!==l&&(c.size=l,t=!0),c.type!==v&&(c.type=v,t=!0),c.normalized!==U&&(c.normalized=U,t=!0),c.stride!==d&&(c.stride=d,t=!0),c.offset!==A&&(c.offset=A,t=!0)):(t=!0,c.active=!0,c.index=Y,c.size=l,c.type=v,c.normalized=U,c.stride=d,c.offset=A,c.buffer=K),(t||this._vaoRecordInProgress)&&(this.bindArrayBuffer(K),v===this._gl.UNSIGNED_INT||v===this._gl.INT?this._gl.vertexAttribIPointer(Y,l,v,d,A):this._gl.vertexAttribPointer(Y,l,v,U,d,A))}_bindIndexBufferWithCache(K){null!=K&&this._cachedIndexBuffer!==K&&(this._cachedIndexBuffer=K,this.bindIndexBuffer(K),this._uintIndicesCurrentlySet=K.is32Bits)}_bindVertexBuffersAttributes(K,Y,l){const v=Y.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let U=0;U<v.length;U++){const d=Y.getAttributeLocation(U);if(d>=0){const Y=v[U];let A=null;if(l&&(A=l[Y]),A||(A=K[Y]),!A)continue;this._gl.enableVertexAttribArray(d),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[d]=!0);const c=A.getBuffer();c&&(this._vertexAttribPointer(c,d,A.getSize(),A.type,A.normalized,A.byteStride,A.byteOffset),A.getIsInstanced()&&(this._gl.vertexAttribDivisor(d,A.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(d),this._currentInstanceBuffers.push(c))))}}}recordVertexArrayObject(K,Y,l,v){const U=this._gl.createVertexArray();if(!U)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(U),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(K,l,v),this.bindIndexBuffer(Y),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),U}bindVertexArrayObject(K,Y){this._cachedVertexArrayObject!==K&&(this._cachedVertexArrayObject=K,this._gl.bindVertexArray(K),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=Y&&Y.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(K,Y,l,v,U){if(this._cachedVertexBuffers!==K||this._cachedEffectForVertexBuffers!==U){this._cachedVertexBuffers=K,this._cachedEffectForVertexBuffers=U;const Y=U.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let d=0;for(let A=0;A<Y;A++)if(A<l.length){const Y=U.getAttributeLocation(A);Y>=0&&(this._gl.enableVertexAttribArray(Y),this._vertexAttribArraysEnabled[Y]=!0,this._vertexAttribPointer(K,Y,l[A],this._gl.FLOAT,!1,v,d)),d+=4*l[A]}}this._bindIndexBufferWithCache(Y)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(K,Y,l,v){this._cachedVertexBuffers===K&&this._cachedEffectForVertexBuffers===l||(this._cachedVertexBuffers=K,this._cachedEffectForVertexBuffers=l,this._bindVertexBuffersAttributes(K,l,v)),this._bindIndexBufferWithCache(Y)}unbindInstanceAttributes(){let K;for(let Y=0,l=this._currentInstanceLocations.length;Y<l;Y++){const l=this._currentInstanceBuffers[Y];K!=l&&l.references&&(K=l,this.bindArrayBuffer(l));const v=this._currentInstanceLocations[Y];this._gl.vertexAttribDivisor(v,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(K){this._gl.deleteVertexArray(K)}_releaseBuffer(K){return K.references--,0===K.references&&(this._deleteBuffer(K),!0)}_deleteBuffer(K){this._gl.deleteBuffer(K.underlyingResource)}updateAndBindInstancesBuffer(K,Y,l){if(this.bindArrayBuffer(K),Y&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,Y),void 0!==l[0].index)this.bindInstancesBuffer(K,l,!0);else for(let v=0;v<4;v++){const Y=l[v];this._vertexAttribArraysEnabled[Y]||(this._gl.enableVertexAttribArray(Y),this._vertexAttribArraysEnabled[Y]=!0),this._vertexAttribPointer(K,Y,4,this._gl.FLOAT,!1,64,16*v),this._gl.vertexAttribDivisor(Y,1),this._currentInstanceLocations.push(Y),this._currentInstanceBuffers.push(K)}}bindInstancesBuffer(K,Y){let l=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(K);let v=0;if(l)for(let U=0;U<Y.length;U++){v+=4*Y[U].attributeSize}for(let U=0;U<Y.length;U++){const l=Y[U];void 0===l.index&&(l.index=this._currentEffect.getAttributeLocationByName(l.attributeName)),l.index<0||(this._vertexAttribArraysEnabled[l.index]||(this._gl.enableVertexAttribArray(l.index),this._vertexAttribArraysEnabled[l.index]=!0),this._vertexAttribPointer(K,l.index,l.attributeSize,l.attributeType||this._gl.FLOAT,l.normalized||!1,v,l.offset),this._gl.vertexAttribDivisor(l.index,void 0===l.divisor?1:l.divisor),this._currentInstanceLocations.push(l.index),this._currentInstanceBuffers.push(K))}}disableInstanceAttributeByName(K){if(!this._currentEffect)return;const Y=this._currentEffect.getAttributeLocationByName(K);this.disableInstanceAttribute(Y)}disableInstanceAttribute(K){let Y,l=!1;for(;-1!==(Y=this._currentInstanceLocations.indexOf(K));)this._currentInstanceLocations.splice(Y,1),this._currentInstanceBuffers.splice(Y,1),l=!0,Y=this._currentInstanceLocations.indexOf(K);l&&(this._gl.vertexAttribDivisor(K,0),this.disableAttributeByIndex(K))}disableAttributeByIndex(K){this._gl.disableVertexAttribArray(K),this._vertexAttribArraysEnabled[K]=!1,this._currentBufferPointers[K].active=!1}draw(K,Y,l,v){this.drawElementsType(K?0:1,Y,l,v)}drawPointClouds(K,Y,l){this.drawArraysType(2,K,Y,l)}drawUnIndexed(K,Y,l,v){this.drawArraysType(K?0:1,Y,l,v)}drawElementsType(K,Y,l,v){this.applyStates(),this._reportDrawCall();const U=this._drawMode(K),d=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,A=this._uintIndicesCurrentlySet?4:2;v?this._gl.drawElementsInstanced(U,l,d,Y*A,v):this._gl.drawElements(U,l,d,Y*A)}drawArraysType(K,Y,l,v){this.applyStates(),this._reportDrawCall();const U=this._drawMode(K);v?this._gl.drawArraysInstanced(U,Y,l,v):this._gl.drawArrays(U,Y,l)}_drawMode(K){switch(K){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(K){this._compiledEffects[K._key]&&delete this._compiledEffects[K._key];const Y=K.getPipelineContext();Y&&this._deletePipelineContext(Y)}_deletePipelineContext(K){const Y=K;Y&&Y.program&&(Y.program.__SPECTOR_rebuildProgram=null,(0,J.k)(Y),this._gl.deleteProgram(Y.program))}_getGlobalDefines(K){return(0,g.l)(K,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(K,Y,l,U,d,A,c,t,Z){let m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,V=arguments.length>10?arguments[10]:void 0;const M="string"===typeof K?K:K.vertexToken||K.vertexSource||K.vertexElement||K.vertex,u="string"===typeof K?K:K.fragmentToken||K.fragmentSource||K.fragmentElement||K.fragment,o=this._getGlobalDefines();let g=d??Y.defines??"";o&&(g+=o);const J=M+"+"+u+"@"+g;if(this._compiledEffects[J]){const K=this._compiledEffects[J];return c&&K.isReady()&&c(K),K._refCount++,K}this._gl&&(0,v.C)(this._gl);const n=new W.b(K,Y,l,U,this,d,A,c,t,Z,J,Y.shaderLanguage??m,Y.extraInitializationsAsync??V);return this._compiledEffects[J]=n,n}_getShaderSource(K){return this._gl.getShaderSource(K)}createRawShaderProgram(K,Y,l,U){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const A=(0,v.C)(this._gl);return A._contextWasLost=this._contextWasLost,A.validateShaderPrograms=this.validateShaderPrograms,(0,v.u)(K,Y,l,U||this._gl,d)}createShaderProgram(K,Y,l,U,d){let A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const c=(0,v.C)(this._gl);return c._contextWasLost=this._contextWasLost,c.validateShaderPrograms=this.validateShaderPrograms,(0,v.y)(K,Y,l,U,d||this._gl,A)}inlineShaderCode(K){return K}createPipelineContext(K){if(this._gl){(0,v.C)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const Y=(0,v.q)(this._gl,K);return Y.Ii=this,Y}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(K){return(0,v.f)(K,this._gl,this.validateShaderPrograms)}_preparePipelineContext(K,Y,l,U,d,A,c,t,Z,m,V){const M=(0,v.C)(this._gl);return M._contextWasLost=this._contextWasLost,M.validateShaderPrograms=this.validateShaderPrograms,M._createShaderProgramInjection=this._createShaderProgram.bind(this),M.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),M.createShaderProgramInjection=this.createShaderProgram.bind(this),M.loadFileInjection=this._loadFile.bind(this),(0,v.i)(K,Y,l,U,d,A,c,t,Z,m,V)}_createShaderProgram(K,Y,l,U){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,v.b)(K,Y,l,U,d)}_isRenderingStateCompiled(K){const Y=K;return!this._isDisposed&&!Y._isDisposed&&(!!this._gl.getProgramParameter(Y.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(Y),!0))}_executeWhenRenderingStateIsCompiled(K,Y){(0,v.d)(K,Y)}getUniforms(K,Y){const l=new Array,v=K;for(let U=0;U<Y.length;U++)l.push(this._gl.getUniformLocation(v.program,Y[U]));return l}getAttributes(K,Y){const l=[],v=K;for(let d=0;d<Y.length;d++)try{l.push(this._gl.getAttribLocation(v.program,Y[d]))}catch(U){l.push(-1)}return l}enableEffect(K){(K=null!==K&&(0,U.e)(K)?K.effect:K)&&K!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(K),this._currentEffect=K,K.onBind&&K.onBind(K),K._onBindObservable&&K._onBindObservable.notifyObservers(K))}setInt(K,Y){return!!K&&(this._gl.uniform1i(K,Y),!0)}setInt2(K,Y,l){return!!K&&(this._gl.uniform2i(K,Y,l),!0)}setInt3(K,Y,l,v){return!!K&&(this._gl.uniform3i(K,Y,l,v),!0)}setInt4(K,Y,l,v,U){return!!K&&(this._gl.uniform4i(K,Y,l,v,U),!0)}setIntArray(K,Y){return!!K&&(this._gl.uniform1iv(K,Y),!0)}setIntArray2(K,Y){return!(!K||Y.length%2!==0)&&(this._gl.uniform2iv(K,Y),!0)}setIntArray3(K,Y){return!(!K||Y.length%3!==0)&&(this._gl.uniform3iv(K,Y),!0)}setIntArray4(K,Y){return!(!K||Y.length%4!==0)&&(this._gl.uniform4iv(K,Y),!0)}setUInt(K,Y){return!!K&&(this._gl.uniform1ui(K,Y),!0)}setUInt2(K,Y,l){return!!K&&(this._gl.uniform2ui(K,Y,l),!0)}setUInt3(K,Y,l,v){return!!K&&(this._gl.uniform3ui(K,Y,l,v),!0)}setUInt4(K,Y,l,v,U){return!!K&&(this._gl.uniform4ui(K,Y,l,v,U),!0)}setUIntArray(K,Y){return!!K&&(this._gl.uniform1uiv(K,Y),!0)}setUIntArray2(K,Y){return!(!K||Y.length%2!==0)&&(this._gl.uniform2uiv(K,Y),!0)}setUIntArray3(K,Y){return!(!K||Y.length%3!==0)&&(this._gl.uniform3uiv(K,Y),!0)}setUIntArray4(K,Y){return!(!K||Y.length%4!==0)&&(this._gl.uniform4uiv(K,Y),!0)}setArray(K,Y){return!!K&&(!(Y.length<1)&&(this._gl.uniform1fv(K,Y),!0))}setArray2(K,Y){return!(!K||Y.length%2!==0)&&(this._gl.uniform2fv(K,Y),!0)}setArray3(K,Y){return!(!K||Y.length%3!==0)&&(this._gl.uniform3fv(K,Y),!0)}setArray4(K,Y){return!(!K||Y.length%4!==0)&&(this._gl.uniform4fv(K,Y),!0)}setMatrices(K,Y){return!!K&&(this._gl.uniformMatrix4fv(K,!1,Y),!0)}setMatrix3x3(K,Y){return!!K&&(this._gl.uniformMatrix3fv(K,!1,Y),!0)}setMatrix2x2(K,Y){return!!K&&(this._gl.uniformMatrix2fv(K,!1,Y),!0)}setFloat(K,Y){return!!K&&(this._gl.uniform1f(K,Y),!0)}setFloat2(K,Y,l){return!!K&&(this._gl.uniform2f(K,Y,l),!0)}setFloat3(K,Y,l,v){return!!K&&(this._gl.uniform3f(K,Y,l,v),!0)}setFloat4(K,Y,l,v,U){return!!K&&(this._gl.uniform4f(K,Y,l,v,U),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const K=this._colorWrite;this._gl.colorMask(K,K,K,K)}}wipeCaches(K){this.preventCacheWipeBetweenFrames&&!K||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),K&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(K,Y){const l=this._gl;let v=l.NEAREST,U=l.NEAREST;switch(K){case 11:v=l.LINEAR,U=Y?l.LINEAR_MIPMAP_NEAREST:l.LINEAR;break;case 3:v=l.LINEAR,U=Y?l.LINEAR_MIPMAP_LINEAR:l.LINEAR;break;case 8:v=l.NEAREST,U=Y?l.NEAREST_MIPMAP_LINEAR:l.NEAREST;break;case 4:v=l.NEAREST,U=Y?l.NEAREST_MIPMAP_NEAREST:l.NEAREST;break;case 5:v=l.NEAREST,U=Y?l.LINEAR_MIPMAP_NEAREST:l.LINEAR;break;case 6:v=l.NEAREST,U=Y?l.LINEAR_MIPMAP_LINEAR:l.LINEAR;break;case 7:v=l.NEAREST,U=l.LINEAR;break;case 1:v=l.NEAREST,U=l.NEAREST;break;case 9:v=l.LINEAR,U=Y?l.NEAREST_MIPMAP_NEAREST:l.NEAREST;break;case 10:v=l.LINEAR,U=Y?l.NEAREST_MIPMAP_LINEAR:l.NEAREST;break;case 2:v=l.LINEAR,U=l.LINEAR;break;case 12:v=l.LINEAR,U=l.NEAREST}return{min:U,mag:v}}_createTexture(){const K=this._gl.createTexture();if(!K)throw new Error("Unable to create texture");return K}_createHardwareTexture(){return new u.e(this._createTexture(),this._gl)}_createInternalTexture(K,Y){let l,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=!1,A=0,c=3,t=5,Z=!1,m=1;void 0!==Y&&"object"===typeof Y?(U=!!Y.generateMipMaps,A=void 0===Y.type?0:Y.type,c=void 0===Y.samplingMode?3:Y.samplingMode,t=void 0===Y.format?5:Y.format,Z=void 0!==Y.useSRGBBuffer&&Y.useSRGBBuffer,m=Y.samples??1,l=Y.label):U=!!Y,Z&&(Z=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==A||this._caps.textureFloatLinearFiltering)&&(2!==A||this._caps.textureHalfFloatLinearFiltering)||(c=1),1!==A||this._caps.textureFloat||(A=0,d.e.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const V=this._gl,M=new o.e(this,v),u=K.width||K,W=K.height||K,g=K.depth||0,J=K.layers||0,n=this._getSamplingParameters(c,U),R=0!==J?V.TEXTURE_2D_ARRAY:0!==g?V.TEXTURE_3D:V.TEXTURE_2D,H=this._getRGBABufferInternalSizedFormat(A,t,Z),z=this._getInternalFormat(t),r=this._getWebGLTextureType(A);return this._bindTextureDirectly(R,M),0!==J?(M.is2DArray=!0,V.texImage3D(R,0,H,u,W,J,0,z,r,null)):0!==g?(M.is3D=!0,V.texImage3D(R,0,H,u,W,g,0,z,r,null)):V.texImage2D(R,0,H,u,W,0,z,r,null),V.texParameteri(R,V.TEXTURE_MAG_FILTER,n.mag),V.texParameteri(R,V.TEXTURE_MIN_FILTER,n.min),V.texParameteri(R,V.TEXTURE_WRAP_S,V.CLAMP_TO_EDGE),V.texParameteri(R,V.TEXTURE_WRAP_T,V.CLAMP_TO_EDGE),U&&this._gl.generateMipmap(R),this._bindTextureDirectly(R,null),M._useSRGBBuffer=Z,M.baseWidth=u,M.baseHeight=W,M.width=u,M.height=W,M.depth=J,M.isReady=!0,M.samples=m,M.generateMipMaps=U,M.samplingMode=c,M.type=A,M.format=t,M.label=l,this._internalTexturesCache.push(M),M}_getUseSRGBBuffer(K,Y){return K&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||Y)}createTexture(K,Y,l,v){var U=this;let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Z=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,m=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,V=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,M=arguments.length>11?arguments[11]:void 0,u=arguments.length>12?arguments[12]:void 0,W=arguments.length>13?arguments[13]:void 0,g=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(K,Y,l,v,d,A,c,(function(){for(var K=arguments.length,Y=new Array(K),l=0;l<K;l++)Y[l]=arguments[l];return U._prepareWebGLTexture(...Y,m)}),((K,Y,l,U,d,A)=>{const c=this._gl,t=l.width===K&&l.height===Y;d._creationFlags=W??0;const Z=this._getTexImageParametersForCreateTexture(d.format,d._useSRGBBuffer);if(t)return c.texImage2D(c.TEXTURE_2D,0,Z.internalFormat,Z.format,Z.type,l),!1;const m=this._caps.maxTextureSize;if(l.width>m||l.height>m||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=K,this._workingCanvas.height=Y,this._workingContext.drawImage(l,0,0,l.width,l.height,0,0,K,Y),c.texImage2D(c.TEXTURE_2D,0,Z.internalFormat,Z.format,Z.type,this._workingCanvas),d.width=K,d.height=Y,!1);{const K=new o.e(this,2);this._bindTextureDirectly(c.TEXTURE_2D,K,!0),c.texImage2D(c.TEXTURE_2D,0,Z.internalFormat,Z.format,Z.type,l),this._rescaleTexture(K,d,v,Z.format,(()=>{this._releaseTexture(K),this._bindTextureDirectly(c.TEXTURE_2D,d,!0),A()}))}return!0}),t,Z,m,V,M,u,g)}_getTexImageParametersForCreateTexture(K,Y){let l,v;return 1===this.webGLVersion?(l=this._getInternalFormat(K,Y),v=l):(l=this._getInternalFormat(K,!1),v=this._getRGBABufferInternalSizedFormat(0,K,Y)),{internalFormat:v,format:l,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(K,Y,l,v,U){}_unpackFlipY(K){this._unpackFlipYCached!==K&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,K?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=K))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(K){return K.isCube?this._gl.TEXTURE_CUBE_MAP:K.is3D?this._gl.TEXTURE_3D:K.is2DArray||K.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const v=this._getTextureTarget(Y),U=this._getSamplingParameters(K,Y.useMipMaps||l);this._setTextureParameterInteger(v,this._gl.TEXTURE_MAG_FILTER,U.mag,Y),this._setTextureParameterInteger(v,this._gl.TEXTURE_MIN_FILTER,U.min),l&&(Y.generateMipMaps=!0,this._gl.generateMipmap(v)),this._bindTextureDirectly(v,null),Y.samplingMode=K}updateTextureDimensions(K,Y,l){}updateTextureWrappingMode(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const U=this._getTextureTarget(K);null!==Y&&(this._setTextureParameterInteger(U,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(Y),K),K._cachedWrapU=Y),null!==l&&(this._setTextureParameterInteger(U,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(l),K),K._cachedWrapV=l),(K.is2DArray||K.is3D)&&null!==v&&(this._setTextureParameterInteger(U,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(v),K),K._cachedWrapR=v),this._bindTextureDirectly(U,null)}_uploadCompressedDataToTextureDirectly(K,Y,l,v,U){let d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const c=this._gl;let t=c.TEXTURE_2D;if(K.isCube&&(t=c.TEXTURE_CUBE_MAP_POSITIVE_X+d),K._useSRGBBuffer)switch(Y){case 37492:case 36196:this._caps.etc2?Y=c.COMPRESSED_SRGB8_ETC2:K._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?Y=c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:K._useSRGBBuffer=!1;break;case 36492:Y=c.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:Y=c.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?Y=c.COMPRESSED_SRGB_S3TC_DXT1_EXT:K._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?Y=c.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:K._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?Y=c.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:K._useSRGBBuffer=!1;break;default:K._useSRGBBuffer=!1}this._gl.compressedTexImage2D(t,A,Y,l,v,0,U)}_uploadDataToTextureDirectly(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,U=arguments.length>4?arguments[4]:void 0,d=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const A=this._gl,c=this._getWebGLTextureType(K.type),t=this._getInternalFormat(K.format),Z=void 0===U?this._getRGBABufferInternalSizedFormat(K.type,K.format,K._useSRGBBuffer):this._getInternalFormat(U,K._useSRGBBuffer);this._unpackFlipY(K.invertY);let m=A.TEXTURE_2D;K.isCube&&(m=A.TEXTURE_CUBE_MAP_POSITIVE_X+l);const V=Math.round(Math.log(K.width)*Math.LOG2E),M=Math.round(Math.log(K.height)*Math.LOG2E),u=d?K.width:Math.pow(2,Math.max(V-v,0)),o=d?K.height:Math.pow(2,Math.max(M-v,0));A.texImage2D(m,v,Z,u,o,0,t,c,Y)}updateTextureData(K,Y,l,v,U,d){let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const Z=this._gl,m=this._getWebGLTextureType(K.type),V=this._getInternalFormat(K.format);this._unpackFlipY(K.invertY);let M=Z.TEXTURE_2D,u=Z.TEXTURE_2D;K.isCube&&(u=Z.TEXTURE_CUBE_MAP_POSITIVE_X+A,M=Z.TEXTURE_CUBE_MAP),this._bindTextureDirectly(M,K,!0),Z.texSubImage2D(u,c,l,v,U,d,V,m,Y),t&&this._gl.generateMipmap(u),this._bindTextureDirectly(M,null)}_uploadArrayBufferViewToTexture(K,Y){let l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,v=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const U=this._gl,d=K.isCube?U.TEXTURE_CUBE_MAP:U.TEXTURE_2D;this._bindTextureDirectly(d,K,!0),this._uploadDataToTextureDirectly(K,Y,l,v),this._bindTextureDirectly(d,null,!0)}_prepareWebGLTextureContinuation(K,Y,l,v,U){const d=this._gl;if(!d)return;const A=this._getSamplingParameters(U,!l);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,A.mag),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,A.min),l||v||d.generateMipmap(d.TEXTURE_2D),this._bindTextureDirectly(d.TEXTURE_2D,null),Y&&Y.removePendingData(K),K.onLoadedObservable.notifyObservers(K),K.onLoadedObservable.clear()}_prepareWebGLTexture(K,Y,l,v,U,d,A,c,t,Z){const m=this.getCaps().maxTextureSize,M=Math.min(m,this.needPOTTextures?(0,V.e)(v.width,m):v.width),u=Math.min(m,this.needPOTTextures?(0,V.e)(v.height,m):v.height),o=this._gl;o&&(K._hardwareTexture?(this._bindTextureDirectly(o.TEXTURE_2D,K,!0),this._unpackFlipY(void 0===U||!!U),K.baseWidth=v.width,K.baseHeight=v.height,K.width=M,K.height=u,K.isReady=!0,K.type=-1!==K.type?K.type:0,K.format=-1!==K.format?K.format:Z??(".jpg"!==Y||K._useSRGBBuffer?5:4),c(M,u,v,Y,K,(()=>{this._prepareWebGLTextureContinuation(K,l,d,A,t)}))||this._prepareWebGLTextureContinuation(K,l,d,A,t)):l&&l.removePendingData(K))}_getInternalFormatFromDepthTextureFormat(K,Y,l){const v=this._gl;if(!Y)return v.STENCIL_INDEX8;let U=l?v.DEPTH_STENCIL:v.DEPTH_COMPONENT;return this.webGLVersion>1?15===K?U=v.DEPTH_COMPONENT16:16===K?U=v.DEPTH_COMPONENT24:17===K||13===K?U=l?v.DEPTH24_STENCIL8:v.DEPTH_COMPONENT24:14===K?U=v.DEPTH_COMPONENT32F:18===K&&(U=l?v.DEPTH32F_STENCIL8:v.DEPTH_COMPONENT32F):U=v.DEPTH_COMPONENT16,U}_setupFramebufferDepthAttachments(K,Y,l,v){let U=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,d=arguments.length>5?arguments[5]:void 0;const A=this._gl;d=d??(K?13:14);const c=this._getInternalFormatFromDepthTextureFormat(d,Y,K);return K&&Y?this._createRenderBuffer(l,v,U,A.DEPTH_STENCIL,c,A.DEPTH_STENCIL_ATTACHMENT):Y?this._createRenderBuffer(l,v,U,c,c,A.DEPTH_ATTACHMENT):K?this._createRenderBuffer(l,v,U,c,c,A.STENCIL_ATTACHMENT):null}_createRenderBuffer(K,Y,l,v,U,d){let A=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const c=this._gl.createRenderbuffer();return this._updateRenderBuffer(c,K,Y,l,v,U,d,A)}_updateRenderBuffer(K,Y,l,v,U,d,A){let c=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const t=this._gl;return t.bindRenderbuffer(t.RENDERBUFFER,K),v>1&&t.renderbufferStorageMultisample?t.renderbufferStorageMultisample(t.RENDERBUFFER,v,d,Y,l):t.renderbufferStorage(t.RENDERBUFFER,U,Y,l),t.framebufferRenderbuffer(t.FRAMEBUFFER,A,t.RENDERBUFFER,K),c&&t.bindRenderbuffer(t.RENDERBUFFER,null),K}_releaseTexture(K){this._deleteTexture(K._hardwareTexture),this.unbindAllTextures();const Y=this._internalTexturesCache.indexOf(K);-1!==Y&&this._internalTexturesCache.splice(Y,1),K._lodTextureHigh&&K._lodTextureHigh.dispose(),K._lodTextureMid&&K._lodTextureMid.dispose(),K._lodTextureLow&&K._lodTextureLow.dispose(),K._irradianceTexture&&K._irradianceTexture.dispose()}_deleteTexture(K){null===K||void 0===K||K.release()}_setProgram(K){this._currentProgram!==K&&((0,v.m)(K,this._gl),this._currentProgram=K)}bindSamplers(K){const Y=K.getPipelineContext();this._setProgram(Y.program);const l=K.getSamplers();for(let v=0;v<l.length;v++){const Y=K.getUniform(l[v]);Y&&(this._boundUniforms[v]=Y)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],v=arguments.length>3&&void 0!==arguments[3]&&arguments[3],U=!1;const A=Y&&Y._associatedChannel>-1;l&&A&&(this._activeChannel=Y._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==Y||v){if(this._activateCurrentTexture(),Y&&Y.isMultiview)throw d.e.Error(["_bindTextureDirectly called with a multiview texture!",K,Y]),"_bindTextureDirectly called with a multiview texture!";var c;this._gl.bindTexture(K,(null===Y||void 0===Y||null===(c=Y._hardwareTexture)||void 0===c?void 0:c.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=Y,Y&&(Y._associatedChannel=this._activeChannel)}else l&&(U=!0,this._activateCurrentTexture());return A&&!l&&this._bindSamplerUniformToChannel(Y._associatedChannel,this._activeChannel),U}_bindTexture(K,Y,l){if(void 0===K)return;Y&&(Y._associatedChannel=K),this._activeChannel=K;const v=Y?this._getTextureTarget(Y):this._gl.TEXTURE_2D;this._bindTextureDirectly(v,Y)}unbindAllTextures(){for(let K=0;K<this._maxSimultaneousTextures;K++)this._activeChannel=K,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(K,Y,l,v){void 0!==K&&(Y&&(this._boundUniforms[K]=Y),this._setTexture(K,l))}_bindSamplerUniformToChannel(K,Y){const l=this._boundUniforms[K];l&&l._currentState!==Y&&(this._gl.uniform1i(l,Y),l._currentState=Y)}_getTextureWrapMode(K){switch(K){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(K,Y){let l,v=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!Y)return null!=this._boundTexturesCache[K]&&(this._activeChannel=K,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(Y.video){this._activeChannel=K;const l=Y.getInternalTexture();l&&(l._associatedChannel=K),Y.update()}else if(4===Y.delayLoadState)return Y.delayLoad(),!1;l=U?Y.depthStencilTexture:Y.isReady()?Y.getInternalTexture():Y.isCube?this.emptyCubeTexture:Y.is3D?this.emptyTexture3D:Y.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!v&&l&&(l._associatedChannel=K);let d=!0;this._boundTexturesCache[K]===l&&(v||this._bindSamplerUniformToChannel(l._associatedChannel,K),d=!1),this._activeChannel=K;const A=this._getTextureTarget(l);if(d&&this._bindTextureDirectly(A,l,v),l&&!l.isMultiview){if(l.isCube&&l._cachedCoordinatesMode!==Y.coordinatesMode){l._cachedCoordinatesMode=Y.coordinatesMode;const K=3!==Y.coordinatesMode&&5!==Y.coordinatesMode?1:0;Y.wrapU=K,Y.wrapV=K}l._cachedWrapU!==Y.wrapU&&(l._cachedWrapU=Y.wrapU,this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(Y.wrapU),l)),l._cachedWrapV!==Y.wrapV&&(l._cachedWrapV=Y.wrapV,this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(Y.wrapV),l)),l.is3D&&l._cachedWrapR!==Y.wrapR&&(l._cachedWrapR=Y.wrapR,this._setTextureParameterInteger(A,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(Y.wrapR),l)),this._setAnisotropicLevel(A,l,Y.anisotropicFilteringLevel)}return!0}setTextureArray(K,Y,l,v){if(void 0!==K&&Y){this._textureUnits&&this._textureUnits.length===l.length||(this._textureUnits=new Int32Array(l.length));for(let Y=0;Y<l.length;Y++){const v=l[Y].getInternalTexture();v?(this._textureUnits[Y]=K+Y,v._associatedChannel=K+Y):this._textureUnits[Y]=-1}this._gl.uniform1iv(Y,this._textureUnits);for(let K=0;K<l.length;K++)this._setTexture(this._textureUnits[K],l[K],!0)}}_setAnisotropicLevel(K,Y,l){const v=this._caps.textureAnisotropicFilterExtension;11!==Y.samplingMode&&3!==Y.samplingMode&&2!==Y.samplingMode&&(l=1),v&&Y._cachedAnisotropicFilteringLevel!==l&&(this._setTextureParameterFloat(K,v.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(l,this._caps.maxAnisotropy),Y),Y._cachedAnisotropicFilteringLevel=l)}_setTextureParameterFloat(K,Y,l,v){this._bindTextureDirectly(K,v,!0,!0),this._gl.texParameterf(K,Y,l)}_setTextureParameterInteger(K,Y,l,v){v&&this._bindTextureDirectly(K,v,!0,!0),this._gl.texParameteri(K,Y,l)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let K=0;K<this._caps.maxVertexAttribs;K++)this.disableAttributeByIndex(K)}else for(let K=0,Y=this._vertexAttribArraysEnabled.length;K<Y;K++)K>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[K]||this.disableAttributeByIndex(K)}releaseEffects(){const K=Object.keys(this._compiledEffects);for(const Y of K){this._compiledEffects[Y].dispose()}this._compiledEffects={}}dispose(){var K;((0,A.k)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(K=this._gl.getExtension("WEBGL_lose_context"))||void 0===K||K.loseContext());(0,v.A)(this._gl)}attachContextLostEvent(K){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",K,!1)}attachContextRestoredEvent(K){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",K,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(K){const Y=this._gl;for(;Y.getError()!==Y.NO_ERROR;);let l=!0;const v=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,v),Y.texImage2D(Y.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(K),1,1,0,Y.RGBA,this._getWebGLTextureType(K),null),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.NEAREST),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.NEAREST);const U=Y.createFramebuffer();Y.bindFramebuffer(Y.FRAMEBUFFER,U),Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,v,0);const d=Y.checkFramebufferStatus(Y.FRAMEBUFFER);if(l=l&&d===Y.FRAMEBUFFER_COMPLETE,l=l&&Y.getError()===Y.NO_ERROR,l&&(Y.clear(Y.COLOR_BUFFER_BIT),l=l&&Y.getError()===Y.NO_ERROR),l){Y.bindFramebuffer(Y.FRAMEBUFFER,null);const K=Y.RGBA,v=Y.UNSIGNED_BYTE,U=new Uint8Array(4);Y.readPixels(0,0,1,1,K,v,U),l=l&&Y.getError()===Y.NO_ERROR}for(Y.deleteTexture(v),Y.deleteFramebuffer(U),Y.bindFramebuffer(Y.FRAMEBUFFER,null);!l&&Y.getError()!==Y.NO_ERROR;);return l}_getWebGLTextureType(K){if(1===this._webGLVersion){switch(K){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(K){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(K){let Y=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=Y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(K){case 0:l=this._gl.ALPHA;break;case 1:l=this._gl.LUMINANCE;break;case 2:l=this._gl.LUMINANCE_ALPHA;break;case 6:l=this._gl.RED;break;case 7:l=this._gl.RG;break;case 4:l=Y?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:l=Y?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(K){case 8:l=this._gl.RED_INTEGER;break;case 9:l=this._gl.RG_INTEGER;break;case 10:l=this._gl.RGB_INTEGER;break;case 11:l=this._gl.RGBA_INTEGER}return l}_getRGBABufferInternalSizedFormat(K,Y){let l=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==Y)switch(Y){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return l?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(K){case 3:switch(Y){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(Y){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return l?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return l?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(Y){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(Y){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(Y){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(Y){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(Y){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(Y){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(Y){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return l?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(K,Y,l,v){let U=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],d=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const A=U?4:3,c=U?this._gl.RGBA:this._gl.RGB,t=new Uint8Array(v*l*A);return d&&this.flushFramebuffer(),this._gl.readPixels(K,Y,l,v,c,this._gl.UNSIGNED_BYTE,t),Promise.resolve(t)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const K=M.b._CreateCanvas(1,1),Y=K.getContext("webgl")||K.getContext("experimental-webgl");this._IsSupported=null!=Y&&!!window.WebGLRenderingContext}catch(K){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const K=M.b._CreateCanvas(1,1),Y=K.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||K.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!Y}catch(K){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}R._TempClearColorUint32=new Uint32Array(4),R._TempClearColorInt32=new Int32Array(4),R.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],R._ConcatenateShader=g.h,R._IsSupported=null,R._HasMajorPerformanceCaveat=null},12005:(K,Y,l)=>{function v(K){return void 0===K.getPipelineContext}l.d(Y,{e:()=>v})},12010:(K,Y,l)=>{l.d(Y,{b:()=>U});var v=l(732);class U extends v.d{constructor(K){super(),this._buffer=K}get underlyingResource(){return this._buffer}}}}]);