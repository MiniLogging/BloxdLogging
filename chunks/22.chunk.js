"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[22],{11622:(j,H,s)=>{s.d(H,{b:()=>i});class i{get underlyingResource(){return this._webGLTexture}constructor(){let j=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=H,!j&&(j=H.createTexture(),!j))throw new Error("Unable to create webGL texture");this.set(j)}setUsage(){}set(j){this._webGLTexture=j}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(j){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(j)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const j of this._MSAARenderBuffers)this._context.deleteRenderbuffer(j);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var j;let H=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(j=this._MSAARenderBuffers)||void 0===j?void 0:j[H])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11604:(j,H,s)=>{s.r(H),s.d(H,{ThinEngine:()=>o});var i=s(605),B=s(11610),e=s(514),k=s(510);class V{constructor(){this.shaderLanguage=0}postProcessor(j,H,s,i,B){if(B.drawBuffersExtensionDisabled){const H=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;j=j.replace(H,"")}return j}}const C=/(flat\s)?\s*varying\s*.*/;class L{constructor(){this.shaderLanguage=0}attributeProcessor(j){return j.replace("attribute","in")}varyingCheck(j,H){return C.test(j)}varyingProcessor(j,H){return j.replace("varying",H?"in":"out")}postProcessor(j,H,s){const i=-1!==j.search(/#extension.+GL_EXT_draw_buffers.+require/);if(j=(j=j.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),s){const H=-1!==j.search(/layout *\(location *= *0\) *out/g);j=(j=(j=(j=(j=(j=(j=j.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(i||H?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==H.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+j}return j}}var U=s(11618),x=s(652),p=s(583),a=s(11622),E=s(616),r=s(591),q=s(574),J=s(598);class h{}class o extends p.d{get name(){return this._name}set name(j){this._name=j}get version(){return this._webGLVersion}static get ShadersRepository(){return r.b.ShadersRepository}static set ShadersRepository(j){r.b.ShadersRepository=j}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(j){this._framebufferDimensionsObject=j}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(j,H,s,B){if(s=s||{},super(H??s.antialias,s,B),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!j)return;let k=null;if(j.getContext){if(k=j,this._renderingCanvas=k,void 0===s.$i&&(s.$i=!1),void 0===s.xrCompatible&&(s.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const j=navigator.userAgent;for(const H of o.ExceptionList){const i=H.key,B=H.targets;if(new RegExp(i).test(j)){if(H.capture&&H.captureConstraint){const s=H.capture,i=H.captureConstraint,B=new RegExp(s).exec(j);if(B&&B.length>0){if(parseInt(B[B.length-1])>=i)continue}}for(const j of B)switch(j){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":s.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=j=>{j.preventDefault(),this._contextWasLost=!0,e.b.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},k.addEventListener("webglcontextlost",this._onContextLost,!1),k.addEventListener("webglcontextrestored",this._onContextRestored,!1),s.powerPreference=s.powerPreference||"high-performance"),this._badDesktopOS&&(s.xrCompatible=!1),!s.disableWebGL2Support)try{this._gl=k.getContext("webgl2",s)||k.getContext("experimental-webgl2",s),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(x){}if(!this._gl){if(!k)throw new Error("The provided canvas is null or undefined.");try{this._gl=k.getContext("webgl",s)||k.getContext("experimental-webgl",s)}catch(x){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=j,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const H=this._gl.getContextAttributes();H&&(s.stencil=H.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==s.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=s.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let i=0;i<this._caps.maxVertexAttribs;i++)this._currentBufferPointers[i]=new h;this._shaderProcessor=this.webGLVersion>1?new L:new V;const C=`Babylon.js v${o.Version}`;e.b.Log(C+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",C);const U=(0,i.C)(this._gl);U.validateShaderPrograms=this.validateShaderPrograms,U.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(j){return null}areAllEffectsReady(){for(const j in this._compiledEffects){if(!this._compiledEffects[j].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const j=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=j&&(this._glRenderer=this._gl.getParameter(j.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(j.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const j=this._gl.getExtension("WEBGL_draw_buffers");if(null!==j){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=j.drawBuffersWEBGL.bind(j),this._caps.maxDrawBuffers=this._gl.getParameter(j.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let H=0;H<16;H++)this._gl["COLOR_ATTACHMENT"+H+"_WEBGL"]=j["COLOR_ATTACHMENT"+H+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const j=this._gl.getExtension("WEBGL_depth_texture");null!=j&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=j.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const j=this._gl.getExtension("OES_vertex_array_object");null!=j&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=j.createVertexArrayOES.bind(j),this._gl.bindVertexArray=j.bindVertexArrayOES.bind(j),this._gl.deleteVertexArray=j.deleteVertexArrayOES.bind(j))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const j=this._gl.getExtension("ANGLE_instanced_arrays");null!=j?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=j.drawArraysInstancedANGLE.bind(j),this._gl.drawElementsInstanced=j.drawElementsInstancedANGLE.bind(j),this._gl.vertexAttribDivisor=j.vertexAttribDivisorANGLE.bind(j)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const j=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),H=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);j&&H&&(this._caps.highPrecisionShaderSupported=0!==j.precision&&0!==H.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const j=this._gl.getExtension("EXT_blend_minmax");null!=j&&(this._caps.blendMinMax=!0,this._gl.MAX=j.MAX_EXT,this._gl.MIN=j.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const j=this._gl.getExtension("EXT_sRGB");null!=j&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:j.SRGB_EXT,SRGB8:j.SRGB_ALPHA_EXT,SRGB8_ALPHA8:j.SRGB_ALPHA_EXT})}if(this._creationOptions){const j=this._creationOptions.forceSRGBBufferSupportState;void 0!==j&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&j)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let H=0;H<this._maxSimultaneousTextures;H++)this._nextFreeTextureSlots.push(H);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const j=this._workingCanvas.getContext("2d");j&&(this._workingContext=j)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const j=this.getGlInfo();return j&&j.renderer?j.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(j,H,s){let i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const B=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=B;let e=0;if(H&&j){let H=!0;if(this._currentRenderTarget){var k;const s=null===(k=this._currentRenderTarget.texture)||void 0===k?void 0:k.format;if(8===s||9===s||10===s||11===s){var V;const s=null===(V=this._currentRenderTarget.texture)||void 0===V?void 0:V.type;7===s||5===s?(o._TempClearColorUint32[0]=255*j.r,o._TempClearColorUint32[1]=255*j.g,o._TempClearColorUint32[2]=255*j.b,o._TempClearColorUint32[3]=255*j.a,this._gl.clearBufferuiv(this._gl.COLOR,0,o._TempClearColorUint32),H=!1):(o._TempClearColorInt32[0]=255*j.r,o._TempClearColorInt32[1]=255*j.g,o._TempClearColorInt32[2]=255*j.b,o._TempClearColorInt32[3]=255*j.a,this._gl.clearBufferiv(this._gl.COLOR,0,o._TempClearColorInt32),H=!1)}}H&&(this._gl.clearColor(j.r,j.g,j.b,void 0!==j.a?j.a:1),e|=this._gl.COLOR_BUFFER_BIT)}s&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),e|=this._gl.DEPTH_BUFFER_BIT),i&&(this._gl.clearStencil(0),e|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(e)}_viewport(j,H,s,i){j===this._viewportCached.x&&H===this._viewportCached.y&&s===this._viewportCached.z&&i===this._viewportCached.w||(this._viewportCached.x=j,this._viewportCached.y=H,this._viewportCached.z=s,this._viewportCached.w=i,this._gl.viewport(j,H,s,i))}ek(){super.ek(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(j){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const C=j;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=j,this._bindUnboundFramebuffer(C._framebuffer);const L=this._gl;var U;if(!j.isMulti)if(j.is2DArray||j.is3D)L.framebufferTextureLayer(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,null===(U=j.texture._hardwareTexture)||void 0===U?void 0:U.underlyingResource,k,V),C._currentLOD=k;else if(j.isCube){var x;L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_CUBE_MAP_POSITIVE_X+H,null===(x=j.texture._hardwareTexture)||void 0===x?void 0:x.underlyingResource,k)}else if(C._currentLOD!==k){var p;L.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,null===(p=j.texture._hardwareTexture)||void 0===p?void 0:p.underlyingResource,k),C._currentLOD=k}const a=j._depthStencilTexture;if(a){j.is3D&&(j.texture.width===a.width&&j.texture.height===a.height&&j.texture.depth===a.depth||e.b.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const s=j._depthStencilTextureWithStencil?L.DEPTH_STENCIL_ATTACHMENT:L.DEPTH_ATTACHMENT;var E;if(j.is2DArray||j.is3D)L.framebufferTextureLayer(L.FRAMEBUFFER,s,null===(E=a._hardwareTexture)||void 0===E?void 0:E.underlyingResource,k,V);else if(j.isCube){var r;L.framebufferTexture2D(L.FRAMEBUFFER,s,L.TEXTURE_CUBE_MAP_POSITIVE_X+H,null===(r=a._hardwareTexture)||void 0===r?void 0:r.underlyingResource,k)}else{var q;L.framebufferTexture2D(L.FRAMEBUFFER,s,L.TEXTURE_2D,null===(q=a._hardwareTexture)||void 0===q?void 0:q.underlyingResource,k)}}C._MSAAFramebuffer&&this._bindUnboundFramebuffer(C._MSAAFramebuffer),this._cachedViewport&&!B?this.setViewport(this._cachedViewport,s,i):(s||(s=j.width,k&&(s/=Math.pow(2,k))),i||(i=j.height,k&&(i/=Math.pow(2,k))),this._viewport(0,0,s,i)),this.wipeCaches()}setState(j){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=arguments.length>4?arguments[4]:void 0,e=arguments.length>5?arguments[5]:void 0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==j||s)&&(this._depthCullingState.cull=j);const V=this.cullBackFaces??B??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==V||s)&&(this._depthCullingState.cullFace=V),this.setZOffset(H),this.setZOffsetUnits(k);const C=i?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==C||s)&&(this._depthCullingState.frontFace=C),this._stencilStateComposer.stencilMaterial=e}_bindUnboundFramebuffer(j){this._currentFramebuffer!==j&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,j),this._currentFramebuffer=j)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(j){const H=this._getTextureTarget(j);this._bindTextureDirectly(H,j,!0),this._gl.generateMipmap(H),this._bindTextureDirectly(H,null)}unBindFramebuffer(j){var H;let s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;const B=j;this._currentRenderTarget=null;const e=this._gl;if(B._MSAAFramebuffer){if(j.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(j,s,i);e.bindFramebuffer(e.READ_FRAMEBUFFER,B._MSAAFramebuffer),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,B._framebuffer),e.blitFramebuffer(0,0,j.width,j.height,0,0,j.width,j.height,e.COLOR_BUFFER_BIT,e.NEAREST)}null===(H=j.texture)||void 0===H||!H.generateMipMaps||s||j.isCube||this.generateMipmaps(j.texture),i&&(B._MSAAFramebuffer&&this._bindUnboundFramebuffer(B._framebuffer),i()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(j,H,s){return this._createVertexBuffer(j,this._gl.STATIC_DRAW)}_createVertexBuffer(j,H){const s=this._gl.createBuffer();if(!s)throw new Error("Unable to create vertex buffer");const i=new U.e(s);return this.bindArrayBuffer(i),"number"!==typeof j?j instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(j),H),i._a=4*j.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,j,H),i._a=j.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(j),H),i._a=j),this._resetVertexBufferBinding(),i.references=1,i}createDynamicVertexBuffer(j,H){return this._createVertexBuffer(j,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(j,H,s){const i=this._gl.createBuffer(),B=new U.e(i);if(!i)throw new Error("Unable to create index buffer");this.bindIndexBuffer(B);const e=this._normalizeIndexData(j);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e,H?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),B.references=1,B.is32Bits=4===e.BYTES_PER_ELEMENT,B}_normalizeIndexData(j){if(2===j.BYTES_PER_ELEMENT)return j;if(this._caps.uintIndices){if(j instanceof Uint32Array)return j;for(let H=0;H<j.length;H++)if(j[H]>=65535)return new Uint32Array(j);return new Uint16Array(j)}return new Uint16Array(j)}bindArrayBuffer(j){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(j,this._gl.ARRAY_BUFFER)}bindUniformBlock(j,H,s){const i=j.program,B=this._gl.getUniformBlockIndex(i,H);this._gl.uniformBlockBinding(i,B,s)}bindIndexBuffer(j){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(j,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(j,H){(this._vaoRecordInProgress||this._currentBoundBuffer[H]!==j)&&(this._gl.bindBuffer(H,j?j.underlyingResource:null),this._currentBoundBuffer[H]=j)}updateArrayBuffer(j){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,j)}_vertexAttribPointer(j,H,s,i,B,e,k){const V=this._currentBufferPointers[H];if(!V)return;let C=!1;V.active?(V.buffer!==j&&(V.buffer=j,C=!0),V.size!==s&&(V.size=s,C=!0),V.type!==i&&(V.type=i,C=!0),V.normalized!==B&&(V.normalized=B,C=!0),V.stride!==e&&(V.stride=e,C=!0),V.offset!==k&&(V.offset=k,C=!0)):(C=!0,V.active=!0,V.index=H,V.size=s,V.type=i,V.normalized=B,V.stride=e,V.offset=k,V.buffer=j),(C||this._vaoRecordInProgress)&&(this.bindArrayBuffer(j),i===this._gl.UNSIGNED_INT||i===this._gl.INT?this._gl.vertexAttribIPointer(H,s,i,e,k):this._gl.vertexAttribPointer(H,s,i,B,e,k))}_bindIndexBufferWithCache(j){null!=j&&this._cachedIndexBuffer!==j&&(this._cachedIndexBuffer=j,this.bindIndexBuffer(j),this._uintIndicesCurrentlySet=j.is32Bits)}_bindVertexBuffersAttributes(j,H,s){const i=H.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let B=0;B<i.length;B++){const e=H.getAttributeLocation(B);if(e>=0){const H=i[B];let k=null;if(s&&(k=s[H]),k||(k=j[H]),!k)continue;this._gl.enableVertexAttribArray(e),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[e]=!0);const V=k.getBuffer();V&&(this._vertexAttribPointer(V,e,k.getSize(),k.type,k.normalized,k.byteStride,k.byteOffset),k.getIsInstanced()&&(this._gl.vertexAttribDivisor(e,k.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(e),this._currentInstanceBuffers.push(V))))}}}recordVertexArrayObject(j,H,s,i){const B=this._gl.createVertexArray();if(!B)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(B),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(j,s,i),this.bindIndexBuffer(H),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),B}bindVertexArrayObject(j,H){this._cachedVertexArrayObject!==j&&(this._cachedVertexArrayObject=j,this._gl.bindVertexArray(j),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=H&&H.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(j,H,s,i,B){if(this._cachedVertexBuffers!==j||this._cachedEffectForVertexBuffers!==B){this._cachedVertexBuffers=j,this._cachedEffectForVertexBuffers=B;const H=B.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let e=0;for(let k=0;k<H;k++)if(k<s.length){const H=B.getAttributeLocation(k);H>=0&&(this._gl.enableVertexAttribArray(H),this._vertexAttribArraysEnabled[H]=!0,this._vertexAttribPointer(j,H,s[k],this._gl.FLOAT,!1,i,e)),e+=4*s[k]}}this._bindIndexBufferWithCache(H)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(j,H,s,i){this._cachedVertexBuffers===j&&this._cachedEffectForVertexBuffers===s||(this._cachedVertexBuffers=j,this._cachedEffectForVertexBuffers=s,this._bindVertexBuffersAttributes(j,s,i)),this._bindIndexBufferWithCache(H)}unbindInstanceAttributes(){let j;for(let H=0,s=this._currentInstanceLocations.length;H<s;H++){const s=this._currentInstanceBuffers[H];j!=s&&s.references&&(j=s,this.bindArrayBuffer(s));const i=this._currentInstanceLocations[H];this._gl.vertexAttribDivisor(i,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(j){this._gl.deleteVertexArray(j)}_releaseBuffer(j){return j.references--,0===j.references&&(this._deleteBuffer(j),!0)}_deleteBuffer(j){this._gl.deleteBuffer(j.underlyingResource)}updateAndBindInstancesBuffer(j,H,s){if(this.bindArrayBuffer(j),H&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,H),void 0!==s[0].index)this.bindInstancesBuffer(j,s,!0);else for(let i=0;i<4;i++){const H=s[i];this._vertexAttribArraysEnabled[H]||(this._gl.enableVertexAttribArray(H),this._vertexAttribArraysEnabled[H]=!0),this._vertexAttribPointer(j,H,4,this._gl.FLOAT,!1,64,16*i),this._gl.vertexAttribDivisor(H,1),this._currentInstanceLocations.push(H),this._currentInstanceBuffers.push(j)}}bindInstancesBuffer(j,H){let s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(j);let i=0;if(s)for(let B=0;B<H.length;B++){i+=4*H[B].attributeSize}for(let B=0;B<H.length;B++){const s=H[B];void 0===s.index&&(s.index=this._currentEffect.getAttributeLocationByName(s.attributeName)),s.index<0||(this._vertexAttribArraysEnabled[s.index]||(this._gl.enableVertexAttribArray(s.index),this._vertexAttribArraysEnabled[s.index]=!0),this._vertexAttribPointer(j,s.index,s.attributeSize,s.attributeType||this._gl.FLOAT,s.normalized||!1,i,s.offset),this._gl.vertexAttribDivisor(s.index,void 0===s.divisor?1:s.divisor),this._currentInstanceLocations.push(s.index),this._currentInstanceBuffers.push(j))}}disableInstanceAttributeByName(j){if(!this._currentEffect)return;const H=this._currentEffect.getAttributeLocationByName(j);this.disableInstanceAttribute(H)}disableInstanceAttribute(j){let H,s=!1;for(;-1!==(H=this._currentInstanceLocations.indexOf(j));)this._currentInstanceLocations.splice(H,1),this._currentInstanceBuffers.splice(H,1),s=!0,H=this._currentInstanceLocations.indexOf(j);s&&(this._gl.vertexAttribDivisor(j,0),this.disableAttributeByIndex(j))}disableAttributeByIndex(j){this._gl.disableVertexAttribArray(j),this._vertexAttribArraysEnabled[j]=!1,this._currentBufferPointers[j].active=!1}draw(j,H,s,i){this.drawElementsType(j?0:1,H,s,i)}drawPointClouds(j,H,s){this.drawArraysType(2,j,H,s)}drawUnIndexed(j,H,s,i){this.drawArraysType(j?0:1,H,s,i)}drawElementsType(j,H,s,i){this.applyStates(),this._reportDrawCall();const B=this._drawMode(j),e=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,k=this._uintIndicesCurrentlySet?4:2;i?this._gl.drawElementsInstanced(B,s,e,H*k,i):this._gl.drawElements(B,s,e,H*k)}drawArraysType(j,H,s,i){this.applyStates(),this._reportDrawCall();const B=this._drawMode(j);i?this._gl.drawArraysInstanced(B,H,s,i):this._gl.drawArrays(B,H,s)}_drawMode(j){switch(j){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(j){this._compiledEffects[j._key]&&delete this._compiledEffects[j._key];const H=j.getPipelineContext();H&&this._deletePipelineContext(H)}_deletePipelineContext(j){const H=j;H&&H.program&&(H.program.__SPECTOR_rebuildProgram=null,(0,J.j)(H),this._gl.deleteProgram(H.program))}_getGlobalDefines(j){return(0,q.f)(j,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(j,H,s,B,e,k,V,C,L){let U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,x=arguments.length>10?arguments[10]:void 0;const p="string"===typeof j?j:j.vertexToken||j.vertexSource||j.vertexElement||j.vertex,a="string"===typeof j?j:j.fragmentToken||j.fragmentSource||j.fragmentElement||j.fragment,E=this._getGlobalDefines();let q=e??H.defines??"";E&&(q+=E);const J=p+"+"+a+"@"+q;if(this._compiledEffects[J]){const j=this._compiledEffects[J];return V&&j.isReady()&&V(j),j._refCount++,j}this._gl&&(0,i.C)(this._gl);const h=new r.b(j,H,s,B,this,e,k,V,C,L,J,H.shaderLanguage??U,H.extraInitializationsAsync??x);return this._compiledEffects[J]=h,h}_getShaderSource(j){return this._gl.getShaderSource(j)}createRawShaderProgram(j,H,s,B){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const k=(0,i.C)(this._gl);return k._contextWasLost=this._contextWasLost,k.validateShaderPrograms=this.validateShaderPrograms,(0,i.w)(j,H,s,B||this._gl,e)}createShaderProgram(j,H,s,B,e){let k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const V=(0,i.C)(this._gl);return V._contextWasLost=this._contextWasLost,V.validateShaderPrograms=this.validateShaderPrograms,(0,i.y)(j,H,s,B,e||this._gl,k)}inlineShaderCode(j){return j}createPipelineContext(j){if(this._gl){(0,i.C)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const H=(0,i.u)(this._gl,j);return H.Sj=this,H}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(j){return(0,i.k)(j,this._gl,this.validateShaderPrograms)}_preparePipelineContext(j,H,s,B,e,k,V,C,L,U,x){const p=(0,i.C)(this._gl);return p._contextWasLost=this._contextWasLost,p.validateShaderPrograms=this.validateShaderPrograms,p._createShaderProgramInjection=this._createShaderProgram.bind(this),p.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),p.createShaderProgramInjection=this.createShaderProgram.bind(this),p.loadFileInjection=this._loadFile.bind(this),(0,i.o)(j,H,s,B,e,k,V,C,L,U,x)}_createShaderProgram(j,H,s,B){let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,i.e)(j,H,s,B,e)}_isRenderingStateCompiled(j){const H=j;return!this._isDisposed&&!H._isDisposed&&(!!this._gl.getProgramParameter(H.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(H),!0))}_executeWhenRenderingStateIsCompiled(j,H){(0,i.g)(j,H)}getUniforms(j,H){const s=new Array,i=j;for(let B=0;B<H.length;B++)s.push(this._gl.getUniformLocation(i.program,H[B]));return s}getAttributes(j,H){const s=[],i=j;for(let e=0;e<H.length;e++)try{s.push(this._gl.getAttribLocation(i.program,H[e]))}catch(B){s.push(-1)}return s}enableEffect(j){(j=null!==j&&(0,B.e)(j)?j.effect:j)&&j!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(j),this._currentEffect=j,j.onBind&&j.onBind(j),j._onBindObservable&&j._onBindObservable.notifyObservers(j))}setInt(j,H){return!!j&&(this._gl.uniform1i(j,H),!0)}setInt2(j,H,s){return!!j&&(this._gl.uniform2i(j,H,s),!0)}setInt3(j,H,s,i){return!!j&&(this._gl.uniform3i(j,H,s,i),!0)}setInt4(j,H,s,i,B){return!!j&&(this._gl.uniform4i(j,H,s,i,B),!0)}setIntArray(j,H){return!!j&&(this._gl.uniform1iv(j,H),!0)}setIntArray2(j,H){return!(!j||H.length%2!==0)&&(this._gl.uniform2iv(j,H),!0)}setIntArray3(j,H){return!(!j||H.length%3!==0)&&(this._gl.uniform3iv(j,H),!0)}setIntArray4(j,H){return!(!j||H.length%4!==0)&&(this._gl.uniform4iv(j,H),!0)}setUInt(j,H){return!!j&&(this._gl.uniform1ui(j,H),!0)}setUInt2(j,H,s){return!!j&&(this._gl.uniform2ui(j,H,s),!0)}setUInt3(j,H,s,i){return!!j&&(this._gl.uniform3ui(j,H,s,i),!0)}setUInt4(j,H,s,i,B){return!!j&&(this._gl.uniform4ui(j,H,s,i,B),!0)}setUIntArray(j,H){return!!j&&(this._gl.uniform1uiv(j,H),!0)}setUIntArray2(j,H){return!(!j||H.length%2!==0)&&(this._gl.uniform2uiv(j,H),!0)}setUIntArray3(j,H){return!(!j||H.length%3!==0)&&(this._gl.uniform3uiv(j,H),!0)}setUIntArray4(j,H){return!(!j||H.length%4!==0)&&(this._gl.uniform4uiv(j,H),!0)}setArray(j,H){return!!j&&(!(H.length<1)&&(this._gl.uniform1fv(j,H),!0))}setArray2(j,H){return!(!j||H.length%2!==0)&&(this._gl.uniform2fv(j,H),!0)}setArray3(j,H){return!(!j||H.length%3!==0)&&(this._gl.uniform3fv(j,H),!0)}setArray4(j,H){return!(!j||H.length%4!==0)&&(this._gl.uniform4fv(j,H),!0)}setMatrices(j,H){return!!j&&(this._gl.uniformMatrix4fv(j,!1,H),!0)}setMatrix3x3(j,H){return!!j&&(this._gl.uniformMatrix3fv(j,!1,H),!0)}setMatrix2x2(j,H){return!!j&&(this._gl.uniformMatrix2fv(j,!1,H),!0)}setFloat(j,H){return!!j&&(this._gl.uniform1f(j,H),!0)}setFloat2(j,H,s){return!!j&&(this._gl.uniform2f(j,H,s),!0)}setFloat3(j,H,s,i){return!!j&&(this._gl.uniform3f(j,H,s,i),!0)}setFloat4(j,H,s,i,B){return!!j&&(this._gl.uniform4f(j,H,s,i,B),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const j=this._colorWrite;this._gl.colorMask(j,j,j,j)}}wipeCaches(j){this.preventCacheWipeBetweenFrames&&!j||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),j&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(j,H){const s=this._gl;let i=s.NEAREST,B=s.NEAREST;switch(j){case 11:i=s.LINEAR,B=H?s.LINEAR_MIPMAP_NEAREST:s.LINEAR;break;case 3:i=s.LINEAR,B=H?s.LINEAR_MIPMAP_LINEAR:s.LINEAR;break;case 8:i=s.NEAREST,B=H?s.NEAREST_MIPMAP_LINEAR:s.NEAREST;break;case 4:i=s.NEAREST,B=H?s.NEAREST_MIPMAP_NEAREST:s.NEAREST;break;case 5:i=s.NEAREST,B=H?s.LINEAR_MIPMAP_NEAREST:s.LINEAR;break;case 6:i=s.NEAREST,B=H?s.LINEAR_MIPMAP_LINEAR:s.LINEAR;break;case 7:i=s.NEAREST,B=s.LINEAR;break;case 1:i=s.NEAREST,B=s.NEAREST;break;case 9:i=s.LINEAR,B=H?s.NEAREST_MIPMAP_NEAREST:s.NEAREST;break;case 10:i=s.LINEAR,B=H?s.NEAREST_MIPMAP_LINEAR:s.NEAREST;break;case 2:i=s.LINEAR,B=s.LINEAR;break;case 12:i=s.LINEAR,B=s.NEAREST}return{min:B,mag:i}}_createTexture(){const j=this._gl.createTexture();if(!j)throw new Error("Unable to create texture");return j}_createHardwareTexture(){return new a.b(this._createTexture(),this._gl)}_createInternalTexture(j,H){let s,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=!1,k=0,V=3,C=5,L=!1,U=1;void 0!==H&&"object"===typeof H?(B=!!H.generateMipMaps,k=void 0===H.type?0:H.type,V=void 0===H.samplingMode?3:H.samplingMode,C=void 0===H.format?5:H.format,L=void 0!==H.useSRGBBuffer&&H.useSRGBBuffer,U=H.samples??1,s=H.label):B=!!H,L&&(L=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==k||this._caps.textureFloatLinearFiltering)&&(2!==k||this._caps.textureHalfFloatLinearFiltering)||(V=1),1!==k||this._caps.textureFloat||(k=0,e.b.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const x=this._gl,p=new E.e(this,i),a=j.width||j,r=j.height||j,q=j.depth||0,J=j.layers||0,h=this._getSamplingParameters(V,B),o=0!==J?x.TEXTURE_2D_ARRAY:0!==q?x.TEXTURE_3D:x.TEXTURE_2D,R=this._getRGBABufferInternalSizedFormat(k,C,L),Y=this._getInternalFormat(C),v=this._getWebGLTextureType(k);return this._bindTextureDirectly(o,p),0!==J?(p.is2DArray=!0,x.texImage3D(o,0,R,a,r,J,0,Y,v,null)):0!==q?(p.is3D=!0,x.texImage3D(o,0,R,a,r,q,0,Y,v,null)):x.texImage2D(o,0,R,a,r,0,Y,v,null),x.texParameteri(o,x.TEXTURE_MAG_FILTER,h.mag),x.texParameteri(o,x.TEXTURE_MIN_FILTER,h.min),x.texParameteri(o,x.TEXTURE_WRAP_S,x.CLAMP_TO_EDGE),x.texParameteri(o,x.TEXTURE_WRAP_T,x.CLAMP_TO_EDGE),B&&this._gl.generateMipmap(o),this._bindTextureDirectly(o,null),p._useSRGBBuffer=L,p.baseWidth=a,p.baseHeight=r,p.width=a,p.height=r,p.depth=J,p.isReady=!0,p.samples=U,p.generateMipMaps=B,p.samplingMode=V,p.type=k,p.format=C,p.label=s,this._internalTexturesCache.push(p),p}_getUseSRGBBuffer(j,H){return j&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||H)}createTexture(j,H,s,i){var B=this;let e=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,V=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,C=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,L=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,p=arguments.length>11?arguments[11]:void 0,a=arguments.length>12?arguments[12]:void 0,r=arguments.length>13?arguments[13]:void 0,q=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(j,H,s,i,e,k,V,(function(){for(var j=arguments.length,H=new Array(j),s=0;s<j;s++)H[s]=arguments[s];return B._prepareWebGLTexture(...H,U)}),((j,H,s,B,e,k)=>{const V=this._gl,C=s.width===j&&s.height===H;e._creationFlags=r??0;const L=this._getTexImageParametersForCreateTexture(e.format,e._useSRGBBuffer);if(C)return V.texImage2D(V.TEXTURE_2D,0,L.internalFormat,L.format,L.type,s),!1;const U=this._caps.maxTextureSize;if(s.width>U||s.height>U||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=j,this._workingCanvas.height=H,this._workingContext.drawImage(s,0,0,s.width,s.height,0,0,j,H),V.texImage2D(V.TEXTURE_2D,0,L.internalFormat,L.format,L.type,this._workingCanvas),e.width=j,e.height=H,!1);{const j=new E.e(this,2);this._bindTextureDirectly(V.TEXTURE_2D,j,!0),V.texImage2D(V.TEXTURE_2D,0,L.internalFormat,L.format,L.type,s),this._rescaleTexture(j,e,i,L.format,(()=>{this._releaseTexture(j),this._bindTextureDirectly(V.TEXTURE_2D,e,!0),k()}))}return!0}),C,L,U,x,p,a,q)}_getTexImageParametersForCreateTexture(j,H){let s,i;return 1===this.webGLVersion?(s=this._getInternalFormat(j,H),i=s):(s=this._getInternalFormat(j,!1),i=this._getRGBABufferInternalSizedFormat(0,j,H)),{internalFormat:i,format:s,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(j,H,s,i,B){}_unpackFlipY(j){this._unpackFlipYCached!==j&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,j?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=j))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(j){return j.isCube?this._gl.TEXTURE_CUBE_MAP:j.is3D?this._gl.TEXTURE_3D:j.is2DArray||j.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(j,H){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=this._getTextureTarget(H),B=this._getSamplingParameters(j,H.useMipMaps||s);this._setTextureParameterInteger(i,this._gl.TEXTURE_MAG_FILTER,B.mag,H),this._setTextureParameterInteger(i,this._gl.TEXTURE_MIN_FILTER,B.min),s&&(H.generateMipMaps=!0,this._gl.generateMipmap(i)),this._bindTextureDirectly(i,null),H.samplingMode=j}updateTextureDimensions(j,H,s){}updateTextureWrappingMode(j,H){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const B=this._getTextureTarget(j);null!==H&&(this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(H),j),j._cachedWrapU=H),null!==s&&(this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(s),j),j._cachedWrapV=s),(j.is2DArray||j.is3D)&&null!==i&&(this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(i),j),j._cachedWrapR=i),this._bindTextureDirectly(B,null)}_uploadCompressedDataToTextureDirectly(j,H,s,i,B){let e=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const V=this._gl;let C=V.TEXTURE_2D;if(j.isCube&&(C=V.TEXTURE_CUBE_MAP_POSITIVE_X+e),j._useSRGBBuffer)switch(H){case 37492:case 36196:this._caps.etc2?H=V.COMPRESSED_SRGB8_ETC2:j._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?H=V.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:j._useSRGBBuffer=!1;break;case 36492:H=V.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:H=V.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?H=V.COMPRESSED_SRGB_S3TC_DXT1_EXT:j._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?H=V.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:j._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?H=V.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:j._useSRGBBuffer=!1;break;default:j._useSRGBBuffer=!1}this._gl.compressedTexImage2D(C,k,H,s,i,0,B)}_uploadDataToTextureDirectly(j,H){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4?arguments[4]:void 0,e=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const k=this._gl,V=this._getWebGLTextureType(j.type),C=this._getInternalFormat(j.format),L=void 0===B?this._getRGBABufferInternalSizedFormat(j.type,j.format,j._useSRGBBuffer):this._getInternalFormat(B,j._useSRGBBuffer);this._unpackFlipY(j.invertY);let U=k.TEXTURE_2D;j.isCube&&(U=k.TEXTURE_CUBE_MAP_POSITIVE_X+s);const x=Math.round(Math.log(j.width)*Math.LOG2E),p=Math.round(Math.log(j.height)*Math.LOG2E),a=e?j.width:Math.pow(2,Math.max(x-i,0)),E=e?j.height:Math.pow(2,Math.max(p-i,0));k.texImage2D(U,i,L,a,E,0,C,V,H)}updateTextureData(j,H,s,i,B,e){let k=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,V=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,C=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const L=this._gl,U=this._getWebGLTextureType(j.type),x=this._getInternalFormat(j.format);this._unpackFlipY(j.invertY);let p=L.TEXTURE_2D,a=L.TEXTURE_2D;j.isCube&&(a=L.TEXTURE_CUBE_MAP_POSITIVE_X+k,p=L.TEXTURE_CUBE_MAP),this._bindTextureDirectly(p,j,!0),L.texSubImage2D(a,V,s,i,B,e,x,U,H),C&&this._gl.generateMipmap(a),this._bindTextureDirectly(p,null)}_uploadArrayBufferViewToTexture(j,H){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const B=this._gl,e=j.isCube?B.TEXTURE_CUBE_MAP:B.TEXTURE_2D;this._bindTextureDirectly(e,j,!0),this._uploadDataToTextureDirectly(j,H,s,i),this._bindTextureDirectly(e,null,!0)}_prepareWebGLTextureContinuation(j,H,s,i,B){const e=this._gl;if(!e)return;const k=this._getSamplingParameters(B,!s);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,k.mag),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,k.min),s||i||e.generateMipmap(e.TEXTURE_2D),this._bindTextureDirectly(e.TEXTURE_2D,null),H&&H.removePendingData(j),j.onLoadedObservable.notifyObservers(j),j.onLoadedObservable.clear()}_prepareWebGLTexture(j,H,s,i,B,e,k,V,C,L){const U=this.getCaps().maxTextureSize,p=Math.min(U,this.needPOTTextures?(0,x.g)(i.width,U):i.width),a=Math.min(U,this.needPOTTextures?(0,x.g)(i.height,U):i.height),E=this._gl;E&&(j._hardwareTexture?(this._bindTextureDirectly(E.TEXTURE_2D,j,!0),this._unpackFlipY(void 0===B||!!B),j.baseWidth=i.width,j.baseHeight=i.height,j.width=p,j.height=a,j.isReady=!0,j.type=-1!==j.type?j.type:0,j.format=-1!==j.format?j.format:L??(".jpg"!==H||j._useSRGBBuffer?5:4),V(p,a,i,H,j,(()=>{this._prepareWebGLTextureContinuation(j,s,e,k,C)}))||this._prepareWebGLTextureContinuation(j,s,e,k,C)):s&&s.removePendingData(j))}_getInternalFormatFromDepthTextureFormat(j,H,s){const i=this._gl;if(!H)return i.STENCIL_INDEX8;let B=s?i.DEPTH_STENCIL:i.DEPTH_COMPONENT;return this.webGLVersion>1?15===j?B=i.DEPTH_COMPONENT16:16===j?B=i.DEPTH_COMPONENT24:17===j||13===j?B=s?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24:14===j?B=i.DEPTH_COMPONENT32F:18===j&&(B=s?i.DEPTH32F_STENCIL8:i.DEPTH_COMPONENT32F):B=i.DEPTH_COMPONENT16,B}_setupFramebufferDepthAttachments(j,H,s,i){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,e=arguments.length>5?arguments[5]:void 0;const k=this._gl;e=e??(j?13:14);const V=this._getInternalFormatFromDepthTextureFormat(e,H,j);return j&&H?this._createRenderBuffer(s,i,B,k.DEPTH_STENCIL,V,k.DEPTH_STENCIL_ATTACHMENT):H?this._createRenderBuffer(s,i,B,V,V,k.DEPTH_ATTACHMENT):j?this._createRenderBuffer(s,i,B,V,V,k.STENCIL_ATTACHMENT):null}_createRenderBuffer(j,H,s,i,B,e){let k=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const V=this._gl.createRenderbuffer();return this._updateRenderBuffer(V,j,H,s,i,B,e,k)}_updateRenderBuffer(j,H,s,i,B,e,k){let V=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const C=this._gl;return C.bindRenderbuffer(C.RENDERBUFFER,j),i>1&&C.renderbufferStorageMultisample?C.renderbufferStorageMultisample(C.RENDERBUFFER,i,e,H,s):C.renderbufferStorage(C.RENDERBUFFER,B,H,s),C.framebufferRenderbuffer(C.FRAMEBUFFER,k,C.RENDERBUFFER,j),V&&C.bindRenderbuffer(C.RENDERBUFFER,null),j}_releaseTexture(j){this._deleteTexture(j._hardwareTexture),this.unbindAllTextures();const H=this._internalTexturesCache.indexOf(j);-1!==H&&this._internalTexturesCache.splice(H,1),j._lodTextureHigh&&j._lodTextureHigh.dispose(),j._lodTextureMid&&j._lodTextureMid.dispose(),j._lodTextureLow&&j._lodTextureLow.dispose(),j._irradianceTexture&&j._irradianceTexture.dispose()}_deleteTexture(j){null===j||void 0===j||j.release()}_setProgram(j){this._currentProgram!==j&&((0,i.q)(j,this._gl),this._currentProgram=j)}bindSamplers(j){const H=j.getPipelineContext();this._setProgram(H.program);const s=j.getSamplers();for(let i=0;i<s.length;i++){const H=j.getUniform(s[i]);H&&(this._boundUniforms[i]=H)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(j,H){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],B=!1;const k=H&&H._associatedChannel>-1;s&&k&&(this._activeChannel=H._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==H||i){if(this._activateCurrentTexture(),H&&H.isMultiview)throw e.b.Error(["_bindTextureDirectly called with a multiview texture!",j,H]),"_bindTextureDirectly called with a multiview texture!";var V;this._gl.bindTexture(j,(null===H||void 0===H||null===(V=H._hardwareTexture)||void 0===V?void 0:V.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=H,H&&(H._associatedChannel=this._activeChannel)}else s&&(B=!0,this._activateCurrentTexture());return k&&!s&&this._bindSamplerUniformToChannel(H._associatedChannel,this._activeChannel),B}_bindTexture(j,H,s){if(void 0===j)return;H&&(H._associatedChannel=j),this._activeChannel=j;const i=H?this._getTextureTarget(H):this._gl.TEXTURE_2D;this._bindTextureDirectly(i,H)}unbindAllTextures(){for(let j=0;j<this._maxSimultaneousTextures;j++)this._activeChannel=j,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(j,H,s,i){void 0!==j&&(H&&(this._boundUniforms[j]=H),this._setTexture(j,s))}_bindSamplerUniformToChannel(j,H){const s=this._boundUniforms[j];s&&s._currentState!==H&&(this._gl.uniform1i(s,H),s._currentState=H)}_getTextureWrapMode(j){switch(j){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(j,H){let s,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!H)return null!=this._boundTexturesCache[j]&&(this._activeChannel=j,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(H.video){this._activeChannel=j;const s=H.getInternalTexture();s&&(s._associatedChannel=j),H.update()}else if(4===H.delayLoadState)return H.delayLoad(),!1;s=B?H.depthStencilTexture:H.isReady()?H.getInternalTexture():H.isCube?this.emptyCubeTexture:H.is3D?this.emptyTexture3D:H.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!i&&s&&(s._associatedChannel=j);let e=!0;this._boundTexturesCache[j]===s&&(i||this._bindSamplerUniformToChannel(s._associatedChannel,j),e=!1),this._activeChannel=j;const k=this._getTextureTarget(s);if(e&&this._bindTextureDirectly(k,s,i),s&&!s.isMultiview){if(s.isCube&&s._cachedCoordinatesMode!==H.coordinatesMode){s._cachedCoordinatesMode=H.coordinatesMode;const j=3!==H.coordinatesMode&&5!==H.coordinatesMode?1:0;H.wrapU=j,H.wrapV=j}s._cachedWrapU!==H.wrapU&&(s._cachedWrapU=H.wrapU,this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(H.wrapU),s)),s._cachedWrapV!==H.wrapV&&(s._cachedWrapV=H.wrapV,this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(H.wrapV),s)),s.is3D&&s._cachedWrapR!==H.wrapR&&(s._cachedWrapR=H.wrapR,this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(H.wrapR),s)),this._setAnisotropicLevel(k,s,H.anisotropicFilteringLevel)}return!0}setTextureArray(j,H,s,i){if(void 0!==j&&H){this._textureUnits&&this._textureUnits.length===s.length||(this._textureUnits=new Int32Array(s.length));for(let H=0;H<s.length;H++){const i=s[H].getInternalTexture();i?(this._textureUnits[H]=j+H,i._associatedChannel=j+H):this._textureUnits[H]=-1}this._gl.uniform1iv(H,this._textureUnits);for(let j=0;j<s.length;j++)this._setTexture(this._textureUnits[j],s[j],!0)}}_setAnisotropicLevel(j,H,s){const i=this._caps.textureAnisotropicFilterExtension;11!==H.samplingMode&&3!==H.samplingMode&&2!==H.samplingMode&&(s=1),i&&H._cachedAnisotropicFilteringLevel!==s&&(this._setTextureParameterFloat(j,i.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s,this._caps.maxAnisotropy),H),H._cachedAnisotropicFilteringLevel=s)}_setTextureParameterFloat(j,H,s,i){this._bindTextureDirectly(j,i,!0,!0),this._gl.texParameterf(j,H,s)}_setTextureParameterInteger(j,H,s,i){i&&this._bindTextureDirectly(j,i,!0,!0),this._gl.texParameteri(j,H,s)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let j=0;j<this._caps.maxVertexAttribs;j++)this.disableAttributeByIndex(j)}else for(let j=0,H=this._vertexAttribArraysEnabled.length;j<H;j++)j>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[j]||this.disableAttributeByIndex(j)}releaseEffects(){const j=Object.keys(this._compiledEffects);for(const H of j){this._compiledEffects[H].dispose()}this._compiledEffects={}}dispose(){var j;((0,k.l)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(j=this._gl.getExtension("WEBGL_lose_context"))||void 0===j||j.loseContext());(0,i.z)(this._gl)}attachContextLostEvent(j){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",j,!1)}attachContextRestoredEvent(j){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",j,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(j){const H=this._gl;for(;H.getError()!==H.NO_ERROR;);let s=!0;const i=H.createTexture();H.bindTexture(H.TEXTURE_2D,i),H.texImage2D(H.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(j),1,1,0,H.RGBA,this._getWebGLTextureType(j),null),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MIN_FILTER,H.NEAREST),H.texParameteri(H.TEXTURE_2D,H.TEXTURE_MAG_FILTER,H.NEAREST);const B=H.createFramebuffer();H.bindFramebuffer(H.FRAMEBUFFER,B),H.framebufferTexture2D(H.FRAMEBUFFER,H.COLOR_ATTACHMENT0,H.TEXTURE_2D,i,0);const e=H.checkFramebufferStatus(H.FRAMEBUFFER);if(s=s&&e===H.FRAMEBUFFER_COMPLETE,s=s&&H.getError()===H.NO_ERROR,s&&(H.clear(H.COLOR_BUFFER_BIT),s=s&&H.getError()===H.NO_ERROR),s){H.bindFramebuffer(H.FRAMEBUFFER,null);const j=H.RGBA,i=H.UNSIGNED_BYTE,B=new Uint8Array(4);H.readPixels(0,0,1,1,j,i,B),s=s&&H.getError()===H.NO_ERROR}for(H.deleteTexture(i),H.deleteFramebuffer(B),H.bindFramebuffer(H.FRAMEBUFFER,null);!s&&H.getError()!==H.NO_ERROR;);return s}_getWebGLTextureType(j){if(1===this._webGLVersion){switch(j){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(j){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(j){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=H?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(j){case 0:s=this._gl.ALPHA;break;case 1:s=this._gl.LUMINANCE;break;case 2:s=this._gl.LUMINANCE_ALPHA;break;case 6:s=this._gl.RED;break;case 7:s=this._gl.RG;break;case 4:s=H?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:s=H?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(j){case 8:s=this._gl.RED_INTEGER;break;case 9:s=this._gl.RG_INTEGER;break;case 10:s=this._gl.RGB_INTEGER;break;case 11:s=this._gl.RGBA_INTEGER}return s}_getRGBABufferInternalSizedFormat(j,H){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==H)switch(H){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return s?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(j){case 3:switch(H){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(H){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return s?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return s?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(H){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(H){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(H){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(H){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(H){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(H){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(H){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return s?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(j,H,s,i){let B=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],e=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const k=B?4:3,V=B?this._gl.RGBA:this._gl.RGB,C=new Uint8Array(i*s*k);return e&&this.flushFramebuffer(),this._gl.readPixels(j,H,s,i,V,this._gl.UNSIGNED_BYTE,C),Promise.resolve(C)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const j=p.d._CreateCanvas(1,1),H=j.getContext("webgl")||j.getContext("experimental-webgl");this._IsSupported=null!=H&&!!window.WebGLRenderingContext}catch(j){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const j=p.d._CreateCanvas(1,1),H=j.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||j.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!H}catch(j){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}o._TempClearColorUint32=new Uint32Array(4),o._TempClearColorInt32=new Int32Array(4),o.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],o._ConcatenateShader=q.e,o._IsSupported=null,o._HasMajorPerformanceCaveat=null},11610:(j,H,s)=>{function i(j){return void 0===j.getPipelineContext}s.d(H,{e:()=>i})},11618:(j,H,s)=>{s.d(H,{e:()=>B});var i=s(748);class B extends i.e{constructor(j){super(),this._buffer=j}get underlyingResource(){return this._buffer}}}}]);