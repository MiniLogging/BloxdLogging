"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[22],{11950:(B,o,e)=>{e.d(o,{c:()=>k});class k{get underlyingResource(){return this._webGLTexture}constructor(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=o,!B&&(B=o.createTexture(),!B))throw new Error("Unable to create webGL texture");this.set(B)}setUsage(){}set(B){this._webGLTexture=B}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(B){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(B)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const B of this._MSAARenderBuffers)this._context.deleteRenderbuffer(B);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var B;let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(B=this._MSAARenderBuffers)||void 0===B?void 0:B[o])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},11931:(B,o,e)=>{e.r(o),e.d(o,{ThinEngine:()=>I});var k=e(596),d=e(11934),f=e(514),J=e(505);class Z{constructor(){this.shaderLanguage=0}postProcessor(B,o,e,k,d){if(d.drawBuffersExtensionDisabled){const o=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;B=B.replace(o,"")}return B}}const t=/(flat\s)?\s*varying\s*.*/;class h{constructor(){this.shaderLanguage=0}attributeProcessor(B){return B.replace("attribute","in")}varyingCheck(B,o){return t.test(B)}varyingProcessor(B,o){return B.replace("varying",o?"in":"out")}postProcessor(B,o,e){const k=-1!==B.search(/#extension.+GL_EXT_draw_buffers.+require/);if(B=(B=B.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),e){const o=-1!==B.search(/layout *\(location *= *0\) *out/g);B=(B=(B=(B=(B=(B=(B=B.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(k||o?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==o.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+B}return B}}var O=e(11941),K=e(644),w=e(569),u=e(11950),L=e(610),H=e(574),n=e(560),W=e(590);class R{}class I extends w.e{get name(){return this._name}set name(B){this._name=B}get version(){return this._webGLVersion}static get ShadersRepository(){return H.b.ShadersRepository}static set ShadersRepository(B){H.b.ShadersRepository=B}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(B){this._framebufferDimensionsObject=B}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(B,o,e,d){if(e=e||{},super(o??e.antialias,e,d),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!B)return;let J=null;if(B.getContext){if(J=B,this._renderingCanvas=J,void 0===e.Mk&&(e.Mk=!1),void 0===e.xrCompatible&&(e.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const B=navigator.userAgent;for(const o of I.ExceptionList){const k=o.key,d=o.targets;if(new RegExp(k).test(B)){if(o.capture&&o.captureConstraint){const e=o.capture,k=o.captureConstraint,d=new RegExp(e).exec(B);if(d&&d.length>0){if(parseInt(d[d.length-1])>=k)continue}}for(const B of d)switch(B){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":e.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=B=>{B.preventDefault(),this._contextWasLost=!0,f.d.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},J.addEventListener("webglcontextlost",this._onContextLost,!1),J.addEventListener("webglcontextrestored",this._onContextRestored,!1),e.powerPreference=e.powerPreference||"high-performance"),this._badDesktopOS&&(e.xrCompatible=!1),!e.disableWebGL2Support)try{this._gl=J.getContext("webgl2",e)||J.getContext("experimental-webgl2",e),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(K){}if(!this._gl){if(!J)throw new Error("The provided canvas is null or undefined.");try{this._gl=J.getContext("webgl",e)||J.getContext("experimental-webgl",e)}catch(K){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=B,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const o=this._gl.getContextAttributes();o&&(e.stencil=o.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==e.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=e.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let k=0;k<this._caps.maxVertexAttribs;k++)this._currentBufferPointers[k]=new R;this._shaderProcessor=this.webGLVersion>1?new h:new Z;const t=`Babylon.js v${I.Version}`;f.d.Log(t+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",t);const O=(0,k.w)(this._gl);O.validateShaderPrograms=this.validateShaderPrograms,O.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(B){return null}areAllEffectsReady(){for(const B in this._compiledEffects){if(!this._compiledEffects[B].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const B=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=B&&(this._glRenderer=this._gl.getParameter(B.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(B.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const B=this._gl.getExtension("WEBGL_draw_buffers");if(null!==B){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=B.drawBuffersWEBGL.bind(B),this._caps.maxDrawBuffers=this._gl.getParameter(B.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let o=0;o<16;o++)this._gl["COLOR_ATTACHMENT"+o+"_WEBGL"]=B["COLOR_ATTACHMENT"+o+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const B=this._gl.getExtension("WEBGL_depth_texture");null!=B&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=B.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const B=this._gl.getExtension("OES_vertex_array_object");null!=B&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=B.createVertexArrayOES.bind(B),this._gl.bindVertexArray=B.bindVertexArrayOES.bind(B),this._gl.deleteVertexArray=B.deleteVertexArrayOES.bind(B))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const B=this._gl.getExtension("ANGLE_instanced_arrays");null!=B?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=B.drawArraysInstancedANGLE.bind(B),this._gl.drawElementsInstanced=B.drawElementsInstancedANGLE.bind(B),this._gl.vertexAttribDivisor=B.vertexAttribDivisorANGLE.bind(B)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const B=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),o=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);B&&o&&(this._caps.highPrecisionShaderSupported=0!==B.precision&&0!==o.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const B=this._gl.getExtension("EXT_blend_minmax");null!=B&&(this._caps.blendMinMax=!0,this._gl.MAX=B.MAX_EXT,this._gl.MIN=B.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const B=this._gl.getExtension("EXT_sRGB");null!=B&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:B.SRGB_EXT,SRGB8:B.SRGB_ALPHA_EXT,SRGB8_ALPHA8:B.SRGB_ALPHA_EXT})}if(this._creationOptions){const B=this._creationOptions.forceSRGBBufferSupportState;void 0!==B&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&B)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let o=0;o<this._maxSimultaneousTextures;o++)this._nextFreeTextureSlots.push(o);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const B=this._workingCanvas.getContext("2d");B&&(this._workingContext=B)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const B=this.getGlInfo();return B&&B.renderer?B.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(B,o,e){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const d=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=d;let f=0;if(o&&B){let o=!0;if(this._currentRenderTarget){var J;const e=null===(J=this._currentRenderTarget.texture)||void 0===J?void 0:J.format;if(8===e||9===e||10===e||11===e){var Z;const e=null===(Z=this._currentRenderTarget.texture)||void 0===Z?void 0:Z.type;7===e||5===e?(I._TempClearColorUint32[0]=255*B.r,I._TempClearColorUint32[1]=255*B.g,I._TempClearColorUint32[2]=255*B.b,I._TempClearColorUint32[3]=255*B.a,this._gl.clearBufferuiv(this._gl.COLOR,0,I._TempClearColorUint32),o=!1):(I._TempClearColorInt32[0]=255*B.r,I._TempClearColorInt32[1]=255*B.g,I._TempClearColorInt32[2]=255*B.b,I._TempClearColorInt32[3]=255*B.a,this._gl.clearBufferiv(this._gl.COLOR,0,I._TempClearColorInt32),o=!1)}}o&&(this._gl.clearColor(B.r,B.g,B.b,void 0!==B.a?B.a:1),f|=this._gl.COLOR_BUFFER_BIT)}e&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),f|=this._gl.DEPTH_BUFFER_BIT),k&&(this._gl.clearStencil(0),f|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(f)}_viewport(B,o,e,k){B===this._viewportCached.x&&o===this._viewportCached.y&&e===this._viewportCached.z&&k===this._viewportCached.w||(this._viewportCached.x=B,this._viewportCached.y=o,this._viewportCached.z=e,this._viewportCached.w=k,this._gl.viewport(B,o,e,k))}Di(){super.Di(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,d=arguments.length>4?arguments[4]:void 0,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const t=B;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=B,this._bindUnboundFramebuffer(t._framebuffer);const h=this._gl;var O;if(!B.isMulti)if(B.is2DArray||B.is3D)h.framebufferTextureLayer(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,null===(O=B.texture._hardwareTexture)||void 0===O?void 0:O.underlyingResource,J,Z),t._currentLOD=J;else if(B.isCube){var K;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_CUBE_MAP_POSITIVE_X+o,null===(K=B.texture._hardwareTexture)||void 0===K?void 0:K.underlyingResource,J)}else if(t._currentLOD!==J){var w;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,null===(w=B.texture._hardwareTexture)||void 0===w?void 0:w.underlyingResource,J),t._currentLOD=J}const u=B._depthStencilTexture;if(u){B.is3D&&(B.texture.width===u.width&&B.texture.height===u.height&&B.texture.depth===u.depth||f.d.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const e=B._depthStencilTextureWithStencil?h.DEPTH_STENCIL_ATTACHMENT:h.DEPTH_ATTACHMENT;var L;if(B.is2DArray||B.is3D)h.framebufferTextureLayer(h.FRAMEBUFFER,e,null===(L=u._hardwareTexture)||void 0===L?void 0:L.underlyingResource,J,Z);else if(B.isCube){var H;h.framebufferTexture2D(h.FRAMEBUFFER,e,h.TEXTURE_CUBE_MAP_POSITIVE_X+o,null===(H=u._hardwareTexture)||void 0===H?void 0:H.underlyingResource,J)}else{var n;h.framebufferTexture2D(h.FRAMEBUFFER,e,h.TEXTURE_2D,null===(n=u._hardwareTexture)||void 0===n?void 0:n.underlyingResource,J)}}t._MSAAFramebuffer&&this._bindUnboundFramebuffer(t._MSAAFramebuffer),this._cachedViewport&&!d?this.setViewport(this._cachedViewport,e,k):(e||(e=B.width,J&&(e/=Math.pow(2,J))),k||(k=B.height,J&&(k/=Math.pow(2,J))),this._viewport(0,0,e,k)),this.wipeCaches()}setState(B){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5?arguments[5]:void 0,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==B||e)&&(this._depthCullingState.cull=B);const Z=this.cullBackFaces??d??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==Z||e)&&(this._depthCullingState.cullFace=Z),this.setZOffset(o),this.setZOffsetUnits(J);const t=k?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==t||e)&&(this._depthCullingState.frontFace=t),this._stencilStateComposer.stencilMaterial=f}_bindUnboundFramebuffer(B){this._currentFramebuffer!==B&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,B),this._currentFramebuffer=B)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(B){const o=this._getTextureTarget(B);this._bindTextureDirectly(o,B,!0),this._gl.generateMipmap(o),this._bindTextureDirectly(o,null)}unBindFramebuffer(B){var o;let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],k=arguments.length>2?arguments[2]:void 0;const d=B;this._currentRenderTarget=null;const f=this._gl;if(d._MSAAFramebuffer){if(B.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(B,e,k);f.bindFramebuffer(f.READ_FRAMEBUFFER,d._MSAAFramebuffer),f.bindFramebuffer(f.DRAW_FRAMEBUFFER,d._framebuffer),f.blitFramebuffer(0,0,B.width,B.height,0,0,B.width,B.height,f.COLOR_BUFFER_BIT,f.NEAREST)}null===(o=B.texture)||void 0===o||!o.generateMipMaps||e||B.isCube||this.generateMipmaps(B.texture),k&&(d._MSAAFramebuffer&&this._bindUnboundFramebuffer(d._framebuffer),k()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(B,o,e){return this._createVertexBuffer(B,this._gl.STATIC_DRAW)}_createVertexBuffer(B,o){const e=this._gl.createBuffer();if(!e)throw new Error("Unable to create vertex buffer");const k=new O.e(e);return this.bindArrayBuffer(k),"number"!==typeof B?B instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(B),o),k.Th=4*B.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,B,o),k.Th=B.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(B),o),k.Th=B),this._resetVertexBufferBinding(),k.references=1,k}createDynamicVertexBuffer(B,o){return this._createVertexBuffer(B,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(B,o,e){const k=this._gl.createBuffer(),d=new O.e(k);if(!k)throw new Error("Unable to create index buffer");this.bindIndexBuffer(d);const f=this._normalizeIndexData(B);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,f,o?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),d.references=1,d.is32Bits=4===f.BYTES_PER_ELEMENT,d}_normalizeIndexData(B){if(2===B.BYTES_PER_ELEMENT)return B;if(this._caps.uintIndices){if(B instanceof Uint32Array)return B;for(let o=0;o<B.length;o++)if(B[o]>=65535)return new Uint32Array(B);return new Uint16Array(B)}return new Uint16Array(B)}bindArrayBuffer(B){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(B,this._gl.ARRAY_BUFFER)}bindUniformBlock(B,o,e){const k=B.program,d=this._gl.getUniformBlockIndex(k,o);this._gl.uniformBlockBinding(k,d,e)}bindIndexBuffer(B){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(B,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(B,o){(this._vaoRecordInProgress||this._currentBoundBuffer[o]!==B)&&(this._gl.bindBuffer(o,B?B.underlyingResource:null),this._currentBoundBuffer[o]=B)}updateArrayBuffer(B){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,B)}_vertexAttribPointer(B,o,e,k,d,f,J){const Z=this._currentBufferPointers[o];if(!Z)return;let t=!1;Z.active?(Z.buffer!==B&&(Z.buffer=B,t=!0),Z.size!==e&&(Z.size=e,t=!0),Z.type!==k&&(Z.type=k,t=!0),Z.normalized!==d&&(Z.normalized=d,t=!0),Z.stride!==f&&(Z.stride=f,t=!0),Z.offset!==J&&(Z.offset=J,t=!0)):(t=!0,Z.active=!0,Z.index=o,Z.size=e,Z.type=k,Z.normalized=d,Z.stride=f,Z.offset=J,Z.buffer=B),(t||this._vaoRecordInProgress)&&(this.bindArrayBuffer(B),k===this._gl.UNSIGNED_INT||k===this._gl.INT?this._gl.vertexAttribIPointer(o,e,k,f,J):this._gl.vertexAttribPointer(o,e,k,d,f,J))}_bindIndexBufferWithCache(B){null!=B&&this._cachedIndexBuffer!==B&&(this._cachedIndexBuffer=B,this.bindIndexBuffer(B),this._uintIndicesCurrentlySet=B.is32Bits)}_bindVertexBuffersAttributes(B,o,e){const k=o.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let d=0;d<k.length;d++){const f=o.getAttributeLocation(d);if(f>=0){const o=k[d];let J=null;if(e&&(J=e[o]),J||(J=B[o]),!J)continue;this._gl.enableVertexAttribArray(f),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[f]=!0);const Z=J.getBuffer();Z&&(this._vertexAttribPointer(Z,f,J.getSize(),J.type,J.normalized,J.byteStride,J.byteOffset),J.getIsInstanced()&&(this._gl.vertexAttribDivisor(f,J.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(f),this._currentInstanceBuffers.push(Z))))}}}recordVertexArrayObject(B,o,e,k){const d=this._gl.createVertexArray();if(!d)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(d),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(B,e,k),this.bindIndexBuffer(o),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),d}bindVertexArrayObject(B,o){this._cachedVertexArrayObject!==B&&(this._cachedVertexArrayObject=B,this._gl.bindVertexArray(B),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=o&&o.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(B,o,e,k,d){if(this._cachedVertexBuffers!==B||this._cachedEffectForVertexBuffers!==d){this._cachedVertexBuffers=B,this._cachedEffectForVertexBuffers=d;const o=d.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let f=0;for(let J=0;J<o;J++)if(J<e.length){const o=d.getAttributeLocation(J);o>=0&&(this._gl.enableVertexAttribArray(o),this._vertexAttribArraysEnabled[o]=!0,this._vertexAttribPointer(B,o,e[J],this._gl.FLOAT,!1,k,f)),f+=4*e[J]}}this._bindIndexBufferWithCache(o)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(B,o,e,k){this._cachedVertexBuffers===B&&this._cachedEffectForVertexBuffers===e||(this._cachedVertexBuffers=B,this._cachedEffectForVertexBuffers=e,this._bindVertexBuffersAttributes(B,e,k)),this._bindIndexBufferWithCache(o)}unbindInstanceAttributes(){let B;for(let o=0,e=this._currentInstanceLocations.length;o<e;o++){const e=this._currentInstanceBuffers[o];B!=e&&e.references&&(B=e,this.bindArrayBuffer(e));const k=this._currentInstanceLocations[o];this._gl.vertexAttribDivisor(k,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(B){this._gl.deleteVertexArray(B)}_releaseBuffer(B){return B.references--,0===B.references&&(this._deleteBuffer(B),!0)}_deleteBuffer(B){this._gl.deleteBuffer(B.underlyingResource)}updateAndBindInstancesBuffer(B,o,e){if(this.bindArrayBuffer(B),o&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,o),void 0!==e[0].index)this.bindInstancesBuffer(B,e,!0);else for(let k=0;k<4;k++){const o=e[k];this._vertexAttribArraysEnabled[o]||(this._gl.enableVertexAttribArray(o),this._vertexAttribArraysEnabled[o]=!0),this._vertexAttribPointer(B,o,4,this._gl.FLOAT,!1,64,16*k),this._gl.vertexAttribDivisor(o,1),this._currentInstanceLocations.push(o),this._currentInstanceBuffers.push(B)}}bindInstancesBuffer(B,o){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(B);let k=0;if(e)for(let d=0;d<o.length;d++){k+=4*o[d].attributeSize}for(let d=0;d<o.length;d++){const e=o[d];void 0===e.index&&(e.index=this._currentEffect.getAttributeLocationByName(e.attributeName)),e.index<0||(this._vertexAttribArraysEnabled[e.index]||(this._gl.enableVertexAttribArray(e.index),this._vertexAttribArraysEnabled[e.index]=!0),this._vertexAttribPointer(B,e.index,e.attributeSize,e.attributeType||this._gl.FLOAT,e.normalized||!1,k,e.offset),this._gl.vertexAttribDivisor(e.index,void 0===e.divisor?1:e.divisor),this._currentInstanceLocations.push(e.index),this._currentInstanceBuffers.push(B))}}disableInstanceAttributeByName(B){if(!this._currentEffect)return;const o=this._currentEffect.getAttributeLocationByName(B);this.disableInstanceAttribute(o)}disableInstanceAttribute(B){let o,e=!1;for(;-1!==(o=this._currentInstanceLocations.indexOf(B));)this._currentInstanceLocations.splice(o,1),this._currentInstanceBuffers.splice(o,1),e=!0,o=this._currentInstanceLocations.indexOf(B);e&&(this._gl.vertexAttribDivisor(B,0),this.disableAttributeByIndex(B))}disableAttributeByIndex(B){this._gl.disableVertexAttribArray(B),this._vertexAttribArraysEnabled[B]=!1,this._currentBufferPointers[B].active=!1}draw(B,o,e,k){this.drawElementsType(B?0:1,o,e,k)}drawPointClouds(B,o,e){this.drawArraysType(2,B,o,e)}drawUnIndexed(B,o,e,k){this.drawArraysType(B?0:1,o,e,k)}drawElementsType(B,o,e,k){this.applyStates(),this._reportDrawCall();const d=this._drawMode(B),f=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,J=this._uintIndicesCurrentlySet?4:2;k?this._gl.drawElementsInstanced(d,e,f,o*J,k):this._gl.drawElements(d,e,f,o*J)}drawArraysType(B,o,e,k){this.applyStates(),this._reportDrawCall();const d=this._drawMode(B);k?this._gl.drawArraysInstanced(d,o,e,k):this._gl.drawArrays(d,o,e)}_drawMode(B){switch(B){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(B){this._compiledEffects[B._key]&&delete this._compiledEffects[B._key];const o=B.getPipelineContext();o&&this._deletePipelineContext(o)}_deletePipelineContext(B){const o=B;o&&o.program&&(o.program.__SPECTOR_rebuildProgram=null,(0,W.m)(o),this._gl.deleteProgram(o.program))}_getGlobalDefines(B){return(0,n.i)(B,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(B,o,e,d,f,J,Z,t,h){let O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,K=arguments.length>10?arguments[10]:void 0;const w="string"===typeof B?B:B.vertexToken||B.vertexSource||B.vertexElement||B.vertex,u="string"===typeof B?B:B.fragmentToken||B.fragmentSource||B.fragmentElement||B.fragment,L=this._getGlobalDefines();let n=f??o.defines??"";L&&(n+=L);const W=w+"+"+u+"@"+n;if(this._compiledEffects[W]){const B=this._compiledEffects[W];return Z&&B.isReady()&&Z(B),B._refCount++,B}this._gl&&(0,k.w)(this._gl);const R=new H.b(B,o,e,d,this,f,J,Z,t,h,W,o.shaderLanguage??O,o.extraInitializationsAsync??K);return this._compiledEffects[W]=R,R}_getShaderSource(B){return this._gl.getShaderSource(B)}createRawShaderProgram(B,o,e,d){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const J=(0,k.w)(this._gl);return J._contextWasLost=this._contextWasLost,J.validateShaderPrograms=this.validateShaderPrograms,(0,k.o)(B,o,e,d||this._gl,f)}createShaderProgram(B,o,e,d,f){let J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const Z=(0,k.w)(this._gl);return Z._contextWasLost=this._contextWasLost,Z.validateShaderPrograms=this.validateShaderPrograms,(0,k.q)(B,o,e,d,f||this._gl,J)}inlineShaderCode(B){return B}createPipelineContext(B){if(this._gl){(0,k.w)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const o=(0,k.m)(this._gl,B);return o.Fi=this,o}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(B){return(0,k.h)(B,this._gl,this.validateShaderPrograms)}_preparePipelineContext(B,o,e,d,f,J,Z,t,h,O,K){const w=(0,k.w)(this._gl);return w._contextWasLost=this._contextWasLost,w.validateShaderPrograms=this.validateShaderPrograms,w._createShaderProgramInjection=this._createShaderProgram.bind(this),w.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),w.createShaderProgramInjection=this.createShaderProgram.bind(this),w.loadFileInjection=this._loadFile.bind(this),(0,k.i)(B,o,e,d,f,J,Z,t,h,O,K)}_createShaderProgram(B,o,e,d){let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,k.c)(B,o,e,d,f)}_isRenderingStateCompiled(B){const o=B;return!this._isDisposed&&!o._isDisposed&&(!!this._gl.getProgramParameter(o.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(o),!0))}_executeWhenRenderingStateIsCompiled(B,o){(0,k.e)(B,o)}getUniforms(B,o){const e=new Array,k=B;for(let d=0;d<o.length;d++)e.push(this._gl.getUniformLocation(k.program,o[d]));return e}getAttributes(B,o){const e=[],k=B;for(let f=0;f<o.length;f++)try{e.push(this._gl.getAttribLocation(k.program,o[f]))}catch(d){e.push(-1)}return e}enableEffect(B){(B=null!==B&&(0,d.c)(B)?B.effect:B)&&B!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(B),this._currentEffect=B,B.onBind&&B.onBind(B),B._onBindObservable&&B._onBindObservable.notifyObservers(B))}setInt(B,o){return!!B&&(this._gl.uniform1i(B,o),!0)}setInt2(B,o,e){return!!B&&(this._gl.uniform2i(B,o,e),!0)}setInt3(B,o,e,k){return!!B&&(this._gl.uniform3i(B,o,e,k),!0)}setInt4(B,o,e,k,d){return!!B&&(this._gl.uniform4i(B,o,e,k,d),!0)}setIntArray(B,o){return!!B&&(this._gl.uniform1iv(B,o),!0)}setIntArray2(B,o){return!(!B||o.length%2!==0)&&(this._gl.uniform2iv(B,o),!0)}setIntArray3(B,o){return!(!B||o.length%3!==0)&&(this._gl.uniform3iv(B,o),!0)}setIntArray4(B,o){return!(!B||o.length%4!==0)&&(this._gl.uniform4iv(B,o),!0)}setUInt(B,o){return!!B&&(this._gl.uniform1ui(B,o),!0)}setUInt2(B,o,e){return!!B&&(this._gl.uniform2ui(B,o,e),!0)}setUInt3(B,o,e,k){return!!B&&(this._gl.uniform3ui(B,o,e,k),!0)}setUInt4(B,o,e,k,d){return!!B&&(this._gl.uniform4ui(B,o,e,k,d),!0)}setUIntArray(B,o){return!!B&&(this._gl.uniform1uiv(B,o),!0)}setUIntArray2(B,o){return!(!B||o.length%2!==0)&&(this._gl.uniform2uiv(B,o),!0)}setUIntArray3(B,o){return!(!B||o.length%3!==0)&&(this._gl.uniform3uiv(B,o),!0)}setUIntArray4(B,o){return!(!B||o.length%4!==0)&&(this._gl.uniform4uiv(B,o),!0)}setArray(B,o){return!!B&&(!(o.length<1)&&(this._gl.uniform1fv(B,o),!0))}setArray2(B,o){return!(!B||o.length%2!==0)&&(this._gl.uniform2fv(B,o),!0)}setArray3(B,o){return!(!B||o.length%3!==0)&&(this._gl.uniform3fv(B,o),!0)}setArray4(B,o){return!(!B||o.length%4!==0)&&(this._gl.uniform4fv(B,o),!0)}setMatrices(B,o){return!!B&&(this._gl.uniformMatrix4fv(B,!1,o),!0)}setMatrix3x3(B,o){return!!B&&(this._gl.uniformMatrix3fv(B,!1,o),!0)}setMatrix2x2(B,o){return!!B&&(this._gl.uniformMatrix2fv(B,!1,o),!0)}setFloat(B,o){return!!B&&(this._gl.uniform1f(B,o),!0)}setFloat2(B,o,e){return!!B&&(this._gl.uniform2f(B,o,e),!0)}setFloat3(B,o,e,k){return!!B&&(this._gl.uniform3f(B,o,e,k),!0)}setFloat4(B,o,e,k,d){return!!B&&(this._gl.uniform4f(B,o,e,k,d),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const B=this._colorWrite;this._gl.colorMask(B,B,B,B)}}wipeCaches(B){this.preventCacheWipeBetweenFrames&&!B||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),B&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(B,o){const e=this._gl;let k=e.NEAREST,d=e.NEAREST;switch(B){case 11:k=e.LINEAR,d=o?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;break;case 3:k=e.LINEAR,d=o?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;break;case 8:k=e.NEAREST,d=o?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;break;case 4:k=e.NEAREST,d=o?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;break;case 5:k=e.NEAREST,d=o?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;break;case 6:k=e.NEAREST,d=o?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;break;case 7:k=e.NEAREST,d=e.LINEAR;break;case 1:k=e.NEAREST,d=e.NEAREST;break;case 9:k=e.LINEAR,d=o?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;break;case 10:k=e.LINEAR,d=o?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;break;case 2:k=e.LINEAR,d=e.LINEAR;break;case 12:k=e.LINEAR,d=e.NEAREST}return{min:d,mag:k}}_createTexture(){const B=this._gl.createTexture();if(!B)throw new Error("Unable to create texture");return B}_createHardwareTexture(){return new u.c(this._createTexture(),this._gl)}_createInternalTexture(B,o){let e,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=!1,J=0,Z=3,t=5,h=!1,O=1;void 0!==o&&"object"===typeof o?(d=!!o.generateMipMaps,J=void 0===o.type?0:o.type,Z=void 0===o.samplingMode?3:o.samplingMode,t=void 0===o.format?5:o.format,h=void 0!==o.useSRGBBuffer&&o.useSRGBBuffer,O=o.samples??1,e=o.label):d=!!o,h&&(h=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==J||this._caps.textureFloatLinearFiltering)&&(2!==J||this._caps.textureHalfFloatLinearFiltering)||(Z=1),1!==J||this._caps.textureFloat||(J=0,f.d.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const K=this._gl,w=new L.e(this,k),u=B.width||B,H=B.height||B,n=B.depth||0,W=B.layers||0,R=this._getSamplingParameters(Z,d),I=0!==W?K.TEXTURE_2D_ARRAY:0!==n?K.TEXTURE_3D:K.TEXTURE_2D,T=this._getRGBABufferInternalSizedFormat(J,t,h),s=this._getInternalFormat(t),V=this._getWebGLTextureType(J);return this._bindTextureDirectly(I,w),0!==W?(w.is2DArray=!0,K.texImage3D(I,0,T,u,H,W,0,s,V,null)):0!==n?(w.is3D=!0,K.texImage3D(I,0,T,u,H,n,0,s,V,null)):K.texImage2D(I,0,T,u,H,0,s,V,null),K.texParameteri(I,K.TEXTURE_MAG_FILTER,R.mag),K.texParameteri(I,K.TEXTURE_MIN_FILTER,R.min),K.texParameteri(I,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(I,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),d&&this._gl.generateMipmap(I),this._bindTextureDirectly(I,null),w._useSRGBBuffer=h,w.baseWidth=u,w.baseHeight=H,w.width=u,w.height=H,w.depth=W,w.isReady=!0,w.samples=O,w.generateMipMaps=d,w.samplingMode=Z,w.type=J,w.format=t,w.label=e,this._internalTexturesCache.push(w),w}_getUseSRGBBuffer(B,o){return B&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||o)}createTexture(B,o,e,k){var d=this;let f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,J=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Z=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,O=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,w=arguments.length>11?arguments[11]:void 0,u=arguments.length>12?arguments[12]:void 0,H=arguments.length>13?arguments[13]:void 0,n=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(B,o,e,k,f,J,Z,(function(){for(var B=arguments.length,o=new Array(B),e=0;e<B;e++)o[e]=arguments[e];return d._prepareWebGLTexture(...o,O)}),((B,o,e,d,f,J)=>{const Z=this._gl,t=e.width===B&&e.height===o;f._creationFlags=H??0;const h=this._getTexImageParametersForCreateTexture(f.format,f._useSRGBBuffer);if(t)return Z.texImage2D(Z.TEXTURE_2D,0,h.internalFormat,h.format,h.type,e),!1;const O=this._caps.maxTextureSize;if(e.width>O||e.height>O||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=B,this._workingCanvas.height=o,this._workingContext.drawImage(e,0,0,e.width,e.height,0,0,B,o),Z.texImage2D(Z.TEXTURE_2D,0,h.internalFormat,h.format,h.type,this._workingCanvas),f.width=B,f.height=o,!1);{const B=new L.e(this,2);this._bindTextureDirectly(Z.TEXTURE_2D,B,!0),Z.texImage2D(Z.TEXTURE_2D,0,h.internalFormat,h.format,h.type,e),this._rescaleTexture(B,f,k,h.format,(()=>{this._releaseTexture(B),this._bindTextureDirectly(Z.TEXTURE_2D,f,!0),J()}))}return!0}),t,h,O,K,w,u,n)}_getTexImageParametersForCreateTexture(B,o){let e,k;return 1===this.webGLVersion?(e=this._getInternalFormat(B,o),k=e):(e=this._getInternalFormat(B,!1),k=this._getRGBABufferInternalSizedFormat(0,B,o)),{internalFormat:k,format:e,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(B,o,e,k,d){}_unpackFlipY(B){this._unpackFlipYCached!==B&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,B?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=B))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(B){return B.isCube?this._gl.TEXTURE_CUBE_MAP:B.is3D?this._gl.TEXTURE_3D:B.is2DArray||B.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(B,o){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const k=this._getTextureTarget(o),d=this._getSamplingParameters(B,o.useMipMaps||e);this._setTextureParameterInteger(k,this._gl.TEXTURE_MAG_FILTER,d.mag,o),this._setTextureParameterInteger(k,this._gl.TEXTURE_MIN_FILTER,d.min),e&&(o.generateMipMaps=!0,this._gl.generateMipmap(k)),this._bindTextureDirectly(k,null),o.samplingMode=B}updateTextureDimensions(B,o,e){}updateTextureWrappingMode(B,o){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const d=this._getTextureTarget(B);null!==o&&(this._setTextureParameterInteger(d,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(o),B),B._cachedWrapU=o),null!==e&&(this._setTextureParameterInteger(d,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(e),B),B._cachedWrapV=e),(B.is2DArray||B.is3D)&&null!==k&&(this._setTextureParameterInteger(d,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(k),B),B._cachedWrapR=k),this._bindTextureDirectly(d,null)}_uploadCompressedDataToTextureDirectly(B,o,e,k,d){let f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const Z=this._gl;let t=Z.TEXTURE_2D;if(B.isCube&&(t=Z.TEXTURE_CUBE_MAP_POSITIVE_X+f),B._useSRGBBuffer)switch(o){case 37492:case 36196:this._caps.etc2?o=Z.COMPRESSED_SRGB8_ETC2:B._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?o=Z.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:B._useSRGBBuffer=!1;break;case 36492:o=Z.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:o=Z.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?o=Z.COMPRESSED_SRGB_S3TC_DXT1_EXT:B._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?o=Z.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:B._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?o=Z.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:B._useSRGBBuffer=!1;break;default:B._useSRGBBuffer=!1}this._gl.compressedTexImage2D(t,J,o,e,k,0,d)}_uploadDataToTextureDirectly(B,o){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const J=this._gl,Z=this._getWebGLTextureType(B.type),t=this._getInternalFormat(B.format),h=void 0===d?this._getRGBABufferInternalSizedFormat(B.type,B.format,B._useSRGBBuffer):this._getInternalFormat(d,B._useSRGBBuffer);this._unpackFlipY(B.invertY);let O=J.TEXTURE_2D;B.isCube&&(O=J.TEXTURE_CUBE_MAP_POSITIVE_X+e);const K=Math.round(Math.log(B.width)*Math.LOG2E),w=Math.round(Math.log(B.height)*Math.LOG2E),u=f?B.width:Math.pow(2,Math.max(K-k,0)),L=f?B.height:Math.pow(2,Math.max(w-k,0));J.texImage2D(O,k,h,u,L,0,t,Z,o)}updateTextureData(B,o,e,k,d,f){let J=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,Z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const h=this._gl,O=this._getWebGLTextureType(B.type),K=this._getInternalFormat(B.format);this._unpackFlipY(B.invertY);let w=h.TEXTURE_2D,u=h.TEXTURE_2D;B.isCube&&(u=h.TEXTURE_CUBE_MAP_POSITIVE_X+J,w=h.TEXTURE_CUBE_MAP),this._bindTextureDirectly(w,B,!0),h.texSubImage2D(u,Z,e,k,d,f,K,O,o),t&&this._gl.generateMipmap(u),this._bindTextureDirectly(w,null)}_uploadArrayBufferViewToTexture(B,o){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const d=this._gl,f=B.isCube?d.TEXTURE_CUBE_MAP:d.TEXTURE_2D;this._bindTextureDirectly(f,B,!0),this._uploadDataToTextureDirectly(B,o,e,k),this._bindTextureDirectly(f,null,!0)}_prepareWebGLTextureContinuation(B,o,e,k,d){const f=this._gl;if(!f)return;const J=this._getSamplingParameters(d,!e);f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,J.mag),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,J.min),e||k||f.generateMipmap(f.TEXTURE_2D),this._bindTextureDirectly(f.TEXTURE_2D,null),o&&o.removePendingData(B),B.onLoadedObservable.notifyObservers(B),B.onLoadedObservable.clear()}_prepareWebGLTexture(B,o,e,k,d,f,J,Z,t,h){const O=this.getCaps().maxTextureSize,w=Math.min(O,this.needPOTTextures?(0,K.f)(k.width,O):k.width),u=Math.min(O,this.needPOTTextures?(0,K.f)(k.height,O):k.height),L=this._gl;L&&(B._hardwareTexture?(this._bindTextureDirectly(L.TEXTURE_2D,B,!0),this._unpackFlipY(void 0===d||!!d),B.baseWidth=k.width,B.baseHeight=k.height,B.width=w,B.height=u,B.isReady=!0,B.type=-1!==B.type?B.type:0,B.format=-1!==B.format?B.format:h??(".jpg"!==o||B._useSRGBBuffer?5:4),Z(w,u,k,o,B,(()=>{this._prepareWebGLTextureContinuation(B,e,f,J,t)}))||this._prepareWebGLTextureContinuation(B,e,f,J,t)):e&&e.removePendingData(B))}_getInternalFormatFromDepthTextureFormat(B,o,e){const k=this._gl;if(!o)return k.STENCIL_INDEX8;let d=e?k.DEPTH_STENCIL:k.DEPTH_COMPONENT;return this.webGLVersion>1?15===B?d=k.DEPTH_COMPONENT16:16===B?d=k.DEPTH_COMPONENT24:17===B||13===B?d=e?k.DEPTH24_STENCIL8:k.DEPTH_COMPONENT24:14===B?d=k.DEPTH_COMPONENT32F:18===B&&(d=e?k.DEPTH32F_STENCIL8:k.DEPTH_COMPONENT32F):d=k.DEPTH_COMPONENT16,d}_setupFramebufferDepthAttachments(B,o,e,k){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,f=arguments.length>5?arguments[5]:void 0;const J=this._gl;f=f??(B?13:14);const Z=this._getInternalFormatFromDepthTextureFormat(f,o,B);return B&&o?this._createRenderBuffer(e,k,d,J.DEPTH_STENCIL,Z,J.DEPTH_STENCIL_ATTACHMENT):o?this._createRenderBuffer(e,k,d,Z,Z,J.DEPTH_ATTACHMENT):B?this._createRenderBuffer(e,k,d,Z,Z,J.STENCIL_ATTACHMENT):null}_createRenderBuffer(B,o,e,k,d,f){let J=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const Z=this._gl.createRenderbuffer();return this._updateRenderBuffer(Z,B,o,e,k,d,f,J)}_updateRenderBuffer(B,o,e,k,d,f,J){let Z=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const t=this._gl;return t.bindRenderbuffer(t.RENDERBUFFER,B),k>1&&t.renderbufferStorageMultisample?t.renderbufferStorageMultisample(t.RENDERBUFFER,k,f,o,e):t.renderbufferStorage(t.RENDERBUFFER,d,o,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,J,t.RENDERBUFFER,B),Z&&t.bindRenderbuffer(t.RENDERBUFFER,null),B}_releaseTexture(B){this._deleteTexture(B._hardwareTexture),this.unbindAllTextures();const o=this._internalTexturesCache.indexOf(B);-1!==o&&this._internalTexturesCache.splice(o,1),B._lodTextureHigh&&B._lodTextureHigh.dispose(),B._lodTextureMid&&B._lodTextureMid.dispose(),B._lodTextureLow&&B._lodTextureLow.dispose(),B._irradianceTexture&&B._irradianceTexture.dispose()}_deleteTexture(B){null===B||void 0===B||B.release()}_setProgram(B){this._currentProgram!==B&&((0,k.l)(B,this._gl),this._currentProgram=B)}bindSamplers(B){const o=B.getPipelineContext();this._setProgram(o.program);const e=B.getSamplers();for(let k=0;k<e.length;k++){const o=B.getUniform(e[k]);o&&(this._boundUniforms[k]=o)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(B,o){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],d=!1;const J=o&&o._associatedChannel>-1;e&&J&&(this._activeChannel=o._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==o||k){if(this._activateCurrentTexture(),o&&o.isMultiview)throw f.d.Error(["_bindTextureDirectly called with a multiview texture!",B,o]),"_bindTextureDirectly called with a multiview texture!";var Z;this._gl.bindTexture(B,(null===o||void 0===o||null===(Z=o._hardwareTexture)||void 0===Z?void 0:Z.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=o,o&&(o._associatedChannel=this._activeChannel)}else e&&(d=!0,this._activateCurrentTexture());return J&&!e&&this._bindSamplerUniformToChannel(o._associatedChannel,this._activeChannel),d}_bindTexture(B,o,e){if(void 0===B)return;o&&(o._associatedChannel=B),this._activeChannel=B;const k=o?this._getTextureTarget(o):this._gl.TEXTURE_2D;this._bindTextureDirectly(k,o)}unbindAllTextures(){for(let B=0;B<this._maxSimultaneousTextures;B++)this._activeChannel=B,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(B,o,e,k){void 0!==B&&(o&&(this._boundUniforms[B]=o),this._setTexture(B,e))}_bindSamplerUniformToChannel(B,o){const e=this._boundUniforms[B];e&&e._currentState!==o&&(this._gl.uniform1i(e,o),e._currentState=o)}_getTextureWrapMode(B){switch(B){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(B,o){let e,k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!o)return null!=this._boundTexturesCache[B]&&(this._activeChannel=B,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(o.video){this._activeChannel=B;const e=o.getInternalTexture();e&&(e._associatedChannel=B),o.update()}else if(4===o.delayLoadState)return o.delayLoad(),!1;e=d?o.depthStencilTexture:o.isReady()?o.getInternalTexture():o.isCube?this.emptyCubeTexture:o.is3D?this.emptyTexture3D:o.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!k&&e&&(e._associatedChannel=B);let f=!0;this._boundTexturesCache[B]===e&&(k||this._bindSamplerUniformToChannel(e._associatedChannel,B),f=!1),this._activeChannel=B;const J=this._getTextureTarget(e);if(f&&this._bindTextureDirectly(J,e,k),e&&!e.isMultiview){if(e.isCube&&e._cachedCoordinatesMode!==o.coordinatesMode){e._cachedCoordinatesMode=o.coordinatesMode;const B=3!==o.coordinatesMode&&5!==o.coordinatesMode?1:0;o.wrapU=B,o.wrapV=B}e._cachedWrapU!==o.wrapU&&(e._cachedWrapU=o.wrapU,this._setTextureParameterInteger(J,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(o.wrapU),e)),e._cachedWrapV!==o.wrapV&&(e._cachedWrapV=o.wrapV,this._setTextureParameterInteger(J,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(o.wrapV),e)),e.is3D&&e._cachedWrapR!==o.wrapR&&(e._cachedWrapR=o.wrapR,this._setTextureParameterInteger(J,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(o.wrapR),e)),this._setAnisotropicLevel(J,e,o.anisotropicFilteringLevel)}return!0}setTextureArray(B,o,e,k){if(void 0!==B&&o){this._textureUnits&&this._textureUnits.length===e.length||(this._textureUnits=new Int32Array(e.length));for(let o=0;o<e.length;o++){const k=e[o].getInternalTexture();k?(this._textureUnits[o]=B+o,k._associatedChannel=B+o):this._textureUnits[o]=-1}this._gl.uniform1iv(o,this._textureUnits);for(let B=0;B<e.length;B++)this._setTexture(this._textureUnits[B],e[B],!0)}}_setAnisotropicLevel(B,o,e){const k=this._caps.textureAnisotropicFilterExtension;11!==o.samplingMode&&3!==o.samplingMode&&2!==o.samplingMode&&(e=1),k&&o._cachedAnisotropicFilteringLevel!==e&&(this._setTextureParameterFloat(B,k.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this._caps.maxAnisotropy),o),o._cachedAnisotropicFilteringLevel=e)}_setTextureParameterFloat(B,o,e,k){this._bindTextureDirectly(B,k,!0,!0),this._gl.texParameterf(B,o,e)}_setTextureParameterInteger(B,o,e,k){k&&this._bindTextureDirectly(B,k,!0,!0),this._gl.texParameteri(B,o,e)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let B=0;B<this._caps.maxVertexAttribs;B++)this.disableAttributeByIndex(B)}else for(let B=0,o=this._vertexAttribArraysEnabled.length;B<o;B++)B>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[B]||this.disableAttributeByIndex(B)}releaseEffects(){const B=Object.keys(this._compiledEffects);for(const o of B){this._compiledEffects[o].dispose()}this._compiledEffects={}}dispose(){var B;((0,J.l)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(B=this._gl.getExtension("WEBGL_lose_context"))||void 0===B||B.loseContext());(0,k.t)(this._gl)}attachContextLostEvent(B){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",B,!1)}attachContextRestoredEvent(B){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",B,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(B){const o=this._gl;for(;o.getError()!==o.NO_ERROR;);let e=!0;const k=o.createTexture();o.bindTexture(o.TEXTURE_2D,k),o.texImage2D(o.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(B),1,1,0,o.RGBA,this._getWebGLTextureType(B),null),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST);const d=o.createFramebuffer();o.bindFramebuffer(o.FRAMEBUFFER,d),o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,k,0);const f=o.checkFramebufferStatus(o.FRAMEBUFFER);if(e=e&&f===o.FRAMEBUFFER_COMPLETE,e=e&&o.getError()===o.NO_ERROR,e&&(o.clear(o.COLOR_BUFFER_BIT),e=e&&o.getError()===o.NO_ERROR),e){o.bindFramebuffer(o.FRAMEBUFFER,null);const B=o.RGBA,k=o.UNSIGNED_BYTE,d=new Uint8Array(4);o.readPixels(0,0,1,1,B,k,d),e=e&&o.getError()===o.NO_ERROR}for(o.deleteTexture(k),o.deleteFramebuffer(d),o.bindFramebuffer(o.FRAMEBUFFER,null);!e&&o.getError()!==o.NO_ERROR;);return e}_getWebGLTextureType(B){if(1===this._webGLVersion){switch(B){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(B){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(B){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=o?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(B){case 0:e=this._gl.ALPHA;break;case 1:e=this._gl.LUMINANCE;break;case 2:e=this._gl.LUMINANCE_ALPHA;break;case 6:e=this._gl.RED;break;case 7:e=this._gl.RG;break;case 4:e=o?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:e=o?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(B){case 8:e=this._gl.RED_INTEGER;break;case 9:e=this._gl.RG_INTEGER;break;case 10:e=this._gl.RGB_INTEGER;break;case 11:e=this._gl.RGBA_INTEGER}return e}_getRGBABufferInternalSizedFormat(B,o){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==o)switch(o){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return e?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(B){case 3:switch(o){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(o){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return e?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return e?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(o){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(o){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(o){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(o){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(o){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(o){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(o){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return e?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(B,o,e,k){let d=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],f=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const J=d?4:3,Z=d?this._gl.RGBA:this._gl.RGB,t=new Uint8Array(k*e*J);return f&&this.flushFramebuffer(),this._gl.readPixels(B,o,e,k,Z,this._gl.UNSIGNED_BYTE,t),Promise.resolve(t)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const B=w.e._CreateCanvas(1,1),o=B.getContext("webgl")||B.getContext("experimental-webgl");this._IsSupported=null!=o&&!!window.WebGLRenderingContext}catch(B){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const B=w.e._CreateCanvas(1,1),o=B.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||B.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!o}catch(B){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}I._TempClearColorUint32=new Uint32Array(4),I._TempClearColorInt32=new Int32Array(4),I.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],I._ConcatenateShader=n.f,I._IsSupported=null,I._HasMajorPerformanceCaveat=null},11934:(B,o,e)=>{function k(B){return void 0===B.getPipelineContext}e.d(o,{c:()=>k})},11941:(B,o,e)=>{e.d(o,{e:()=>d});var k=e(749);class d extends k.c{constructor(B){super(),this._buffer=B}get underlyingResource(){return this._buffer}}}}]);