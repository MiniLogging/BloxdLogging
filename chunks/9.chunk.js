"use strict";(self.qbp2s7qydk=self.qbp2s7qydk||[]).push([[9],{12836:(M,A,O)=>{O.d(A,{e:()=>C,g:()=>E,j:()=>H,h:()=>u,n:()=>i});class S{constructor(){this.children=[]}isValid(M){return!0}process(M,A,O){let S="";if(this.line){let O=this.line;const e=A.processor;if(e){var z,Q,X,c,j,B,g;e.lineProcessor&&(O=e.lineProcessor(O,A.isFragment,A.processingContext));const S=null!==(z=null===(Q=A.processor)||void 0===Q?void 0:Q.attributeKeywordName)&&void 0!==z?z:"attribute",T=A.isFragment&&null!==(X=A.processor)&&void 0!==X&&X.varyingFragmentKeywordName?null===(c=A.processor)||void 0===c?void 0:c.varyingFragmentKeywordName:!A.isFragment&&null!==(j=A.processor)&&void 0!==j&&j.varyingVertexKeywordName?null===(B=A.processor)||void 0===B?void 0:B.varyingVertexKeywordName:"varying";if(!A.isFragment&&e.attributeProcessor&&this.line.startsWith(S))O=e.attributeProcessor(this.line,M,A.processingContext);else if(e.varyingProcessor&&(null!==(g=e.varyingCheck)&&void 0!==g&&g.call(e,this.line,A.isFragment)||!e.varyingCheck&&this.line.startsWith(T)))O=e.varyingProcessor(this.line,A.isFragment,M,A.processingContext);else if(e.uniformProcessor&&e.uniformRegexp&&e.uniformRegexp.test(this.line))A.lookForClosingBracketForUniformBuffer||(O=e.uniformProcessor(this.line,A.isFragment,M,A.processingContext));else if(e.uniformBufferProcessor&&e.uniformBufferRegexp&&e.uniformBufferRegexp.test(this.line))A.lookForClosingBracketForUniformBuffer||(O=e.uniformBufferProcessor(this.line,A.isFragment,A.processingContext),A.lookForClosingBracketForUniformBuffer=!0);else if(e.textureProcessor&&e.textureRegexp&&e.textureRegexp.test(this.line))O=e.textureProcessor(this.line,A.isFragment,M,A.processingContext);else if((e.uniformProcessor||e.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!A.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?e.uniformProcessor&&(O=e.uniformProcessor(this.line,A.isFragment,M,A.processingContext)):e.uniformBufferProcessor&&(O=e.uniformBufferProcessor(this.line,A.isFragment,A.processingContext),A.lookForClosingBracketForUniformBuffer=!0)}A.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(A.lookForClosingBracketForUniformBuffer=!1,e.endOfUniformBufferProcessor&&(O=e.endOfUniformBufferProcessor(this.line,A.isFragment,A.processingContext)))}S+=O+"\n"}for(const e of this.children)S+=e.process(M,A,O);return this.additionalDefineKey&&(M[this.additionalDefineKey]=this.additionalDefineValue||"true",O[this.additionalDefineKey]=M[this.additionalDefineKey]),S}}class z{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(M){this._lines.length=0;for(const A of M){if(!A||"\r"===A)continue;if("#"===A[0]){this._lines.push(A);continue}const M=A.trim();if(!M)continue;if(M.startsWith("//")){this._lines.push(A);continue}const O=M.indexOf(";");if(-1===O)this._lines.push(M);else if(O===M.length-1)M.length>1&&this._lines.push(M);else{const M=A.split(";");for(let A=0;A<M.length;A++){let O=M[A];O&&(O=O.trim(),O&&this._lines.push(O+(A!==M.length-1?";":"")))}}}}}class Q extends S{process(M,A,O){for(let S=0;S<this.children.length;S++){const z=this.children[S];if(z.isValid(M))return z.process(M,A,O)}return""}}class X extends S{isValid(M){return this.testExpression.isTrue(M)}}class c{isTrue(M){return!0}static postfixToInfix(M){const A=[];for(const O of M)if(void 0===c._OperatorPriority[O])A.push(O);else{const M=A[A.length-1],S=A[A.length-2];A.length-=2,A.push("(".concat(S).concat(O).concat(M,")"))}return A[A.length-1]}static infixToPostfix(M){const A=c._InfixToPostfixCache.get(M);if(A)return A.accessTime=Date.now(),A.result;if(!M.includes("&&")&&!M.includes("||")&&!M.includes(")")&&!M.includes("("))return[M];const O=[];let S=-1;const z=()=>{g=g.trim(),""!==g&&(O.push(g),g="")},Q=M=>{S<c._Stack.length-1&&(c._Stack[++S]=M)},X=()=>c._Stack[S],j=()=>-1===S?"!!INVALID EXPRESSION!!":c._Stack[S--];let B=0,g="";for(;B<M.length;){const A=M.charAt(B),e=B<M.length-1?M.substring(B,2+B):"";if("("===A)g="",Q(A);else if(")"===A){for(z();-1!==S&&"("!==X();)O.push(j());j()}else if(c._OperatorPriority[e]>1){for(z();-1!==S&&c._OperatorPriority[X()]>=c._OperatorPriority[e];)O.push(j());Q(e),B++}else g+=A;B++}for(z();-1!==S;)"("===X()?j():O.push(j());return c._InfixToPostfixCache.size>=c.InfixToPostfixCacheLimitSize&&c.ClearCache(),c._InfixToPostfixCache.set(M,{result:O,accessTime:Date.now()}),O}static ClearCache(){const M=Array.from(c._InfixToPostfixCache.entries()).sort(((M,A)=>M[1].accessTime-A[1].accessTime));for(let A=0;A<c.InfixToPostfixCacheCleanupSize;A++)c._InfixToPostfixCache.delete(M[A][0])}}c.InfixToPostfixCacheLimitSize=5e4,c.InfixToPostfixCacheCleanupSize=25e3,c._InfixToPostfixCache=new Map,c._OperatorPriority={")":0,"(":1,"||":2,"&&":3},c._Stack=["","","","","","","","","","","","","","","","","","","",""];class j extends c{constructor(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=M,this.not=A}isTrue(M){let A=void 0!==M[this.define];return this.not&&(A=!A),A}}class B extends c{isTrue(M){return this.leftOperand.isTrue(M)||this.rightOperand.isTrue(M)}}class g extends c{isTrue(M){return this.leftOperand.isTrue(M)&&this.rightOperand.isTrue(M)}}class e extends c{constructor(M,A,O){super(),this.define=M,this.operand=A,this.testValue=O}toString(){return"".concat(this.define," ").concat(this.operand," ").concat(this.testValue)}isTrue(M){let A=!1;const O=parseInt(void 0!=M[this.define]?M[this.define]:this.define),S=parseInt(void 0!=M[this.testValue]?M[this.testValue]:this.testValue);if(isNaN(O)||isNaN(S))return!1;switch(this.operand){case">":A=O>S;break;case"<":A=O<S;break;case"<=":A=O<=S;break;case">=":A=O>=S;break;case"==":A=O===S;break;case"!=":A=O!==S}return A}}var T=O(12799),J=O(12839);const K=/defined\s*?\((.+?)\)/g,G=/defined\s*?\[(.+?)\]/g,d=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,w=/__decl__/,I=/light\{X\}.(\w*)/g,b=/\{X\}/g,s=[],Y=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function E(M){M.processor&&M.processor.initializeShaders&&M.processor.initializeShaders(M.processingContext)}function H(M,A,O,S){var z;null!==(z=A.processor)&&void 0!==z&&z.preProcessShaderCode&&(M=A.processor.preProcessShaderCode(M,A.isFragment)),u(M,A,(M=>{A.processCodeAfterIncludes&&(M=A.processCodeAfterIncludes(A.isFragment?"fragment":"vertex",M,A.defines));const z=function(M,A,O){let S=function(M,A){var O;if(null!==(O=A.processor)&&void 0!==O&&O.noPrecision)return M;const S=A.shouldUseHighPrecisionShader;-1===M.indexOf("precision highp float")?M=S?"precision highp float;\n"+M:"precision mediump float;\n"+M:S||(M=M.replace("precision highp float","precision mediump float"));return M}(M,A);if(!A.processor)return S;if(0===A.processor.shaderLanguage&&-1!==S.indexOf("#version 3")&&(S=S.replace("#version 300 es",""),!A.processor.parseGLES3))return S;const z=A.defines,Q=h(A,O);A.processor.preProcessor&&(S=A.processor.preProcessor(S,z,Q,A.isFragment,A.processingContext));const X={};S=y(S,Q,A,X),A.processor.postProcessor&&(S=A.processor.postProcessor(S,z,A.isFragment,A.processingContext,O?{drawBuffersExtensionDisabled:!O.getCaps().drawBuffersExtension}:{},Q,X));null!==O&&void 0!==O&&O._features.needShaderCodeInlining&&(S=O.inlineShaderCode(S));return S}(M,A,S);O(z,M)}))}function C(M,A,O){return O.processor&&O.processor.finalizeShaders?O.processor.finalizeShaders(M,A,O.processingContext):{vertexCode:M,fragmentCode:A}}function f(M){const A=/defined\((.+)\)/.exec(M);if(A&&A.length)return new j(A[1].trim(),"!"===M[0]);const O=["==","!=",">=","<=","<",">"];let S="",z=0;for(S of O)if(z=M.indexOf(S),z>-1)break;if(-1===z)return new j(M);const Q=M.substring(0,z).trim(),X=M.substring(z+S.length).trim();return new e(Q,S,X)}function D(M,A){const O=new X,S=M.substring(0,A);let z=M.substring(A);return z=z.substring(0,(z.indexOf("//")+1||z.length+1)-1).trim(),O.testExpression="#ifdef"===S?new j(z):"#ifndef"===S?new j(z,!0):function(M){M=M.replace(K,"defined[$1]");const A=c.infixToPostfix(M),O=[];for(const z of A)if("||"!==z&&"&&"!==z)O.push(z);else if(O.length>=2){let M=O[O.length-1],A=O[O.length-2];O.length-=2;const S="&&"==z?new g:new B;"string"===typeof M&&(M=M.replace(G,"defined($1)")),"string"===typeof A&&(A=A.replace(G,"defined($1)")),S.leftOperand="string"===typeof A?f(A):A,S.rightOperand="string"===typeof M?f(M):M,O.push(S)}let S=O[O.length-1];return"string"===typeof S&&(S=S.replace(G,"defined($1)")),"string"===typeof S?f(S):S}(z),O}function F(M,A,O,z){let Q=M.currentLine;for(;N(M,O,z);){Q=M.currentLine;const X=Q.substring(0,5).toLowerCase();if("#else"===X){const O=new S;return A.children.push(O),void N(M,O,z)}if("#elif"===X){const M=D(Q,5);A.children.push(M),O=M}}}function N(M,A,O){for(;M.canRead;){M.lineIndex++;const z=M.currentLine;if(z.indexOf("#")>=0){const S=Y.exec(z);if(S&&S.length){switch(S[0]){case"#ifdef":{const S=new Q;A.children.push(S);const X=D(z,6);S.children.push(X),F(M,S,X,O);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const S=new Q;A.children.push(S);const X=D(z,7);S.children.push(X),F(M,S,X,O);break}case"#if":{const S=new Q,X=D(z,3);A.children.push(S),S.children.push(X),F(M,S,X,O);break}}continue}}const X=new S;if(X.line=z,A.children.push(X),"#"===z[0]&&"d"===z[1]){const M=z.replace(";","").split(" ");X.additionalDefineKey=M[1],3===M.length&&(X.additionalDefineValue=M[2])}}return!1}function y(M,A,O,Q){const X=new S,c=new z;return c.lineIndex=-1,c.lines=M.split("\n"),N(c,X,Q),X.process(A,O,Q)}function h(M,A){var O;const S=M.defines,z={};for(const Q of S){const M=Q.replace("#define","").replace(";","").trim().split(" ");z[M[0]]=M.length>1?M[1]:""}return 0===(null===(O=M.processor)||void 0===O?void 0:O.shaderLanguage)&&(z.GL_ES="true"),z.__VERSION__=M.version,z[M.platformName]="true",(0,J.i)(z,null===A||void 0===A?void 0:A.isNDCHalfZRange,null===A||void 0===A?void 0:A.QQ,null===A||void 0===A?void 0:A.useExactSrgbConversions),z}function u(M,A,O){let S;for(s.length=0;null!==(S=d.exec(M));)s.push(S);let z=String(M),Q=[M],X=!1;for(const c of s){let M=c[1];if(-1!==M.indexOf("__decl__")&&(M=M.replace(w,""),A.supportsUniformBuffers&&(M=M.replace("Vertex","Ubo").replace("Fragment","Ubo")),M+="Declaration"),!A.includesShadersStore[M]){const S=A.shadersRepository+"ShadersInclude/"+M+".fx";return void i.loadFile(S,(S=>{A.includesShadersStore[M]=S,u(Q.join(""),A,O)}))}{let O=A.includesShadersStore[M];if(c[2]){const M=c[3].split(",");for(let A=0;A<M.length;A+=2){const S=new RegExp(M[A],"g"),z=M[A+1];O=O.replace(S,z)}}if(c[4]){const M=c[5];if(-1!==M.indexOf("..")){const S=M.split(".."),z=parseInt(S[0]);let Q=parseInt(S[1]),X=O.slice(0);O="",isNaN(Q)&&(Q=A.indexParameters[S[1]]);for(let M=z;M<Q;M++)A.supportsUniformBuffers||(X=X.replace(I,((M,A)=>A+"{X}"))),O+=X.replace(b,M.toString())+"\n"}else A.supportsUniformBuffers||(O=O.replace(I,((M,A)=>A+"{X}"))),O=O.replace(b,M)}const S=[];for(const M of Q){const A=M.split(c[0]);for(let M=0;M<A.length-1;M++)S.push(A[M]),S.push(O);S.push(A[A.length-1])}Q=S,X=X||O.indexOf("#include<")>=0||O.indexOf("#include <")>=0}}s.length=0,z=Q.join(""),X?u(z.toString(),A,O):O(z)}const i={loadFile:(M,A,O,S,z,Q)=>{throw(0,T.d)("FileTools")}}},12839:(M,A,O)=>{O.d(A,{b:()=>z,e:()=>Q,i:()=>c,l:()=>X,o:()=>j});var S=O(12799);O(12778);const z={};function Q(M,A){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(A?A+"\n":"")+M}function X(M,A,O,Q,X,c,j){const B=j||z.loadFile;if(B){return B(M,A,O,Q,X,c)}throw(0,S.d)("FileTools")}function c(M,A,O,S){if(M)return A?M.IS_NDC_HALF_ZRANGE="":delete M.IS_NDC_HALF_ZRANGE,O?M.USE_REVERSE_DEPTHBUFFER="":delete M.USE_REVERSE_DEPTHBUFFER,void(S?M.USE_EXACT_SRGB_CONVERSIONS="":delete M.USE_EXACT_SRGB_CONVERSIONS);{let M="";return A&&(M+="#define IS_NDC_HALF_ZRANGE"),O&&(M&&(M+="\n"),M+="#define USE_REVERSE_DEPTHBUFFER"),S&&(M&&(M+="\n"),M+="#define USE_EXACT_SRGB_CONVERSIONS"),M}}function j(M,A){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;switch(M){case 3:{const M=(ArrayBuffer,new Int8Array(A));return S&&M.set(new Int8Array(S)),M}case 0:{const M=(ArrayBuffer,new Uint8Array(A));return S&&M.set(new Uint8Array(S)),M}case 4:{const M=A instanceof ArrayBuffer?new Int16Array(A):new Int16Array(O?A/2:A);return S&&M.set(new Int16Array(S)),M}case 5:case 8:case 9:case 10:case 2:{const M=A instanceof ArrayBuffer?new Uint16Array(A):new Uint16Array(O?A/2:A);return S&&M.set(new Uint16Array(S)),M}case 6:{const M=A instanceof ArrayBuffer?new Int32Array(A):new Int32Array(O?A/4:A);return S&&M.set(new Int32Array(S)),M}case 7:case 11:case 12:case 13:case 14:case 15:{const M=A instanceof ArrayBuffer?new Uint32Array(A):new Uint32Array(O?A/4:A);return S&&M.set(new Uint32Array(S)),M}case 1:{const M=A instanceof ArrayBuffer?new Float32Array(A):new Float32Array(O?A/4:A);return S&&M.set(new Float32Array(S)),M}}const z=(ArrayBuffer,new Uint8Array(A));return S&&z.set(new Uint8Array(S)),z}},12864:(M,A,O)=>{O.d(A,{c:()=>S});class S{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersRepository:S.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersStore:S.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.IncludesShadersStore:S.IncludesShadersStoreWGSL}}S.ShadersRepository="src/Shaders/",S.ShadersStore={},S.IncludesShadersStore={},S.ShadersRepositoryWGSL="src/ShadersWGSL/",S.ShadersStoreWGSL={},S.IncludesShadersStoreWGSL={}},12878:(M,A,O)=>{O.d(A,{c:()=>T,f:()=>b,j:()=>K,n:()=>J,o:()=>G,q:()=>I,s:()=>e,t:()=>B,u:()=>g,y:()=>j,B:()=>c});class S{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.KA._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(M){M&&this.program&&M(this.program)}setEngine(M){this.KA=M}_fillEffectInformation(M,A,O,S,z,Q,X,c){const j=this.KA;if(j.supportsUniformBuffers)for(const g in A)M.bindUniformBlock(g,A[g]);let B;for(this.KA.getUniforms(this,O).forEach(((M,A)=>{S[O[A]]=M})),this._uniforms=S,B=0;B<z.length;B++){null==M.getUniform(z[B])&&(z.splice(B,1),B--)}z.forEach(((M,A)=>{Q[M]=A}));for(const g of j.getAttributes(this,X))c.push(g)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(M,A){const O=this._valueCache[M],S=A.updateFlag;return(void 0===O||O!==S)&&(this._valueCache[M]=S,!0)}_cacheFloat2(M,A,O){let S=this._valueCache[M];if(!S||2!==S.length)return S=[A,O],this._valueCache[M]=S,!0;let z=!1;return S[0]!==A&&(S[0]=A,z=!0),S[1]!==O&&(S[1]=O,z=!0),z}_cacheFloat3(M,A,O,S){let z=this._valueCache[M];if(!z||3!==z.length)return z=[A,O,S],this._valueCache[M]=z,!0;let Q=!1;return z[0]!==A&&(z[0]=A,Q=!0),z[1]!==O&&(z[1]=O,Q=!0),z[2]!==S&&(z[2]=S,Q=!0),Q}_cacheFloat4(M,A,O,S,z){let Q=this._valueCache[M];if(!Q||4!==Q.length)return Q=[A,O,S,z],this._valueCache[M]=Q,!0;let X=!1;return Q[0]!==A&&(Q[0]=A,X=!0),Q[1]!==O&&(Q[1]=O,X=!0),Q[2]!==S&&(Q[2]=S,X=!0),Q[3]!==z&&(Q[3]=z,X=!0),X}setInt(M,A){const O=this._valueCache[M];void 0!==O&&O===A||this.KA.setInt(this._uniforms[M],A)&&(this._valueCache[M]=A)}setInt2(M,A,O){this._cacheFloat2(M,A,O)&&(this.KA.setInt2(this._uniforms[M],A,O)||(this._valueCache[M]=null))}setInt3(M,A,O,S){this._cacheFloat3(M,A,O,S)&&(this.KA.setInt3(this._uniforms[M],A,O,S)||(this._valueCache[M]=null))}setInt4(M,A,O,S,z){this._cacheFloat4(M,A,O,S,z)&&(this.KA.setInt4(this._uniforms[M],A,O,S,z)||(this._valueCache[M]=null))}setIntArray(M,A){this._valueCache[M]=null,this.KA.setIntArray(this._uniforms[M],A)}setIntArray2(M,A){this._valueCache[M]=null,this.KA.setIntArray2(this._uniforms[M],A)}setIntArray3(M,A){this._valueCache[M]=null,this.KA.setIntArray3(this._uniforms[M],A)}setIntArray4(M,A){this._valueCache[M]=null,this.KA.setIntArray4(this._uniforms[M],A)}setUInt(M,A){const O=this._valueCache[M];void 0!==O&&O===A||this.KA.setUInt(this._uniforms[M],A)&&(this._valueCache[M]=A)}setUInt2(M,A,O){this._cacheFloat2(M,A,O)&&(this.KA.setUInt2(this._uniforms[M],A,O)||(this._valueCache[M]=null))}setUInt3(M,A,O,S){this._cacheFloat3(M,A,O,S)&&(this.KA.setUInt3(this._uniforms[M],A,O,S)||(this._valueCache[M]=null))}setUInt4(M,A,O,S,z){this._cacheFloat4(M,A,O,S,z)&&(this.KA.setUInt4(this._uniforms[M],A,O,S,z)||(this._valueCache[M]=null))}setUIntArray(M,A){this._valueCache[M]=null,this.KA.setUIntArray(this._uniforms[M],A)}setUIntArray2(M,A){this._valueCache[M]=null,this.KA.setUIntArray2(this._uniforms[M],A)}setUIntArray3(M,A){this._valueCache[M]=null,this.KA.setUIntArray3(this._uniforms[M],A)}setUIntArray4(M,A){this._valueCache[M]=null,this.KA.setUIntArray4(this._uniforms[M],A)}setArray(M,A){this._valueCache[M]=null,this.KA.setArray(this._uniforms[M],A)}setArray2(M,A){this._valueCache[M]=null,this.KA.setArray2(this._uniforms[M],A)}setArray3(M,A){this._valueCache[M]=null,this.KA.setArray3(this._uniforms[M],A)}setArray4(M,A){this._valueCache[M]=null,this.KA.setArray4(this._uniforms[M],A)}setMatrices(M,A){A&&(this._valueCache[M]=null,this.KA.setMatrices(this._uniforms[M],A))}setMatrix(M,A){this._cacheMatrix(M,A)&&(this.KA.setMatrices(this._uniforms[M],A.gc())||(this._valueCache[M]=null))}setMatrix3x3(M,A){this._valueCache[M]=null,this.KA.setMatrix3x3(this._uniforms[M],A)}setMatrix2x2(M,A){this._valueCache[M]=null,this.KA.setMatrix2x2(this._uniforms[M],A)}setFloat(M,A){const O=this._valueCache[M];void 0!==O&&O===A||this.KA.setFloat(this._uniforms[M],A)&&(this._valueCache[M]=A)}setVector2(M,A){this._cacheFloat2(M,A.x,A.y)&&(this.KA.setFloat2(this._uniforms[M],A.x,A.y)||(this._valueCache[M]=null))}setFloat2(M,A,O){this._cacheFloat2(M,A,O)&&(this.KA.setFloat2(this._uniforms[M],A,O)||(this._valueCache[M]=null))}setVector3(M,A){this._cacheFloat3(M,A.x,A.y,A.z)&&(this.KA.setFloat3(this._uniforms[M],A.x,A.y,A.z)||(this._valueCache[M]=null))}setFloat3(M,A,O,S){this._cacheFloat3(M,A,O,S)&&(this.KA.setFloat3(this._uniforms[M],A,O,S)||(this._valueCache[M]=null))}setVector4(M,A){this._cacheFloat4(M,A.x,A.y,A.z,A.w)&&(this.KA.setFloat4(this._uniforms[M],A.x,A.y,A.z,A.w)||(this._valueCache[M]=null))}setQuaternion(M,A){this._cacheFloat4(M,A.x,A.y,A.z,A.w)&&(this.KA.setFloat4(this._uniforms[M],A.x,A.y,A.z,A.w)||(this._valueCache[M]=null))}setFloat4(M,A,O,S,z){this._cacheFloat4(M,A,O,S,z)&&(this.KA.setFloat4(this._uniforms[M],A,O,S,z)||(this._valueCache[M]=null))}setColor3(M,A){this._cacheFloat3(M,A.r,A.g,A.b)&&(this.KA.setFloat3(this._uniforms[M],A.r,A.g,A.b)||(this._valueCache[M]=null))}setColor4(M,A,O){this._cacheFloat4(M,A.r,A.g,A.b,O)&&(this.KA.setFloat4(this._uniforms[M],A.r,A.g,A.b,O)||(this._valueCache[M]=null))}setDirectColor4(M,A){this._cacheFloat4(M,A.r,A.g,A.b,A.a)&&(this.KA.setFloat4(this._uniforms[M],A.r,A.g,A.b,A.a)||(this._valueCache[M]=null))}_getVertexShaderCode(){return this.vertexShader?this.KA._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.KA._getShaderSource(this.fragmentShader):null}}var z=O(12839);const Q=new WeakMap,X={_webGLVersion:2,cachedPipelines:{}};function c(M){let A=Q.get(M);if(!A){if(!M)return X;A={_webGLVersion:M.TEXTURE_BINDING_3D?2:1,_context:M,parallelShaderCompile:M.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},Q.set(M,A)}return A}function j(M){Q.delete(M)}function B(M,A,O,S,z,Q){const X=c(S);var j;Q||(Q=null!==(j=X._createShaderProgramInjection)&&void 0!==j?j:T);return Q(M,w(A,"vertex",S,X._contextWasLost),w(O,"fragment",S,X._contextWasLost),S,z,X.validateShaderPrograms)}function g(M,A,O,S,z){let Q=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6?arguments[6]:void 0;const j=c(z);var B;X||(X=null!==(B=j._createShaderProgramInjection)&&void 0!==B?B:T);const g=j._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return X(M,d(A,"vertex",S,g,z,j._contextWasLost),d(O,"fragment",S,g,z,j._contextWasLost),z,Q,j.validateShaderPrograms)}function e(M,A){const O=new S,z=c(M);return z.parallelShaderCompile&&!z.disableParallelShaderCompile&&(O.isParallelCompiled=!0),O.context=z._context,O}function T(M,A,O,S){let z=arguments.length>5?arguments[5]:void 0;const Q=S.createProgram();if(M.program=Q,!Q)throw new Error("Unable to create program");return S.attachShader(Q,A),S.attachShader(Q,O),S.linkProgram(Q),M.context=S,M.vertexShader=A,M.fragmentShader=O,M.isParallelCompiled||K(M,S,z),Q}function J(M,A,O){const S=M;if(S._isDisposed)return!1;const z=c(A);return!!(z&&z.parallelShaderCompile&&z.parallelShaderCompile.COMPLETION_STATUS_KHR&&S.program&&A.getProgramParameter(S.program,z.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(K(S,A,O),!0)}function K(M,A,O){const S=M.context,z=M.vertexShader,Q=M.fragmentShader,X=M.program;if(!S.getProgramParameter(X,S.LINK_STATUS)){if(!A.getShaderParameter(z,A.COMPILE_STATUS)){const O=A.getShaderInfoLog(z);if(O)throw M.vertexCompilationError=O,new Error("VERTEX SHADER "+O)}if(!A.getShaderParameter(Q,A.COMPILE_STATUS)){const O=A.getShaderInfoLog(Q);if(O)throw M.fragmentCompilationError=O,new Error("FRAGMENT SHADER "+O)}const O=S.getProgramInfoLog(X);if(O)throw M.programLinkError=O,new Error(O)}if(O){S.validateProgram(X);if(!S.getProgramParameter(X,S.VALIDATE_STATUS)){const A=S.getProgramInfoLog(X);if(A)throw M.programValidationError=A,new Error(A)}}S.deleteShader(z),S.deleteShader(Q),M.vertexShader=void 0,M.fragmentShader=void 0,M.onCompiled&&(M.onCompiled(),M.onCompiled=void 0)}function G(M,A,O,S,z,Q,X,j,e){let T=arguments.length>10?arguments[10]:void 0,J=arguments.length>11?arguments[11]:void 0,K=arguments.length>12?arguments[12]:void 0;const G=c(M.context);var d,w;J||(J=null!==(d=G.createRawShaderProgramInjection)&&void 0!==d?d:B);K||(K=null!==(w=G.createShaderProgramInjection)&&void 0!==w?w:g);const I=M;I.program=S?J(I,A,O,I.context,e):K(I,A,O,j,I.context,e),I.program.__SPECTOR_rebuildProgram=X,T()}function d(M,A,O,S,Q,X){return w((0,z.e)(M,O,S),A,Q,X)}function w(M,A,O,S){const z=O.createShader("vertex"===A?O.VERTEX_SHADER:O.FRAGMENT_SHADER);if(!z){let M=O.NO_ERROR,z=O.NO_ERROR;for(;(z=O.getError())!==O.NO_ERROR;)M=z;throw new Error("Something went wrong while creating a gl ".concat(A," shader object. gl error=").concat(M,", gl isContextLost=").concat(O.isContextLost(),", _contextWasLost=").concat(S))}return O.shaderSource(z,M),O.compileShader(z),z}function I(M,A){A.useProgram(M)}function b(M,A){const O=M;if(!O.isParallelCompiled)return void A(M);const S=O.onCompiled;O.onCompiled=()=>{null===S||void 0===S||S(),A(M)}}},12870:(M,A,O)=>{O.d(A,{c:()=>e,d:()=>J,h:()=>B,j:()=>g});var S=O(12778),z=O(12878),Q=O(12864),X=O(12783),c=O(12836),j=O(12839);function B(M,A){return(0,z.B)(A).cachedPipelines[M]}function g(M){const A=M._name,O=M.context;if(A&&O){const M=(0,z.B)(O),S=M.cachedPipelines[A];null===S||void 0===S||S.dispose(),delete M.cachedPipelines[A]}}function e(M,A,O,z,Q,X,j){let B,g;const e=(0,S.m)()?null===X||void 0===X?void 0:X.getHostDocument():null;B="string"===typeof A?A:A.vertexSource?"source:"+A.vertexSource:A.vertexElement?(null===e||void 0===e?void 0:e.getElementById(A.vertexElement))||A.vertexElement:A.vertex||A,g="string"===typeof A?A:A.fragmentSource?"source:"+A.fragmentSource:A.fragmentElement?(null===e||void 0===e?void 0:e.getElementById(A.fragmentElement))||A.fragmentElement:A.fragment||A;const J=[void 0,void 0],K=()=>{if(J[0]&&J[1]){M.isFragment=!0;const[S,B]=J;(0,c.j)(B,M,((X,B)=>{j&&(j._fragmentSourceCodeBeforeMigration=B),O&&(X=O("fragment",X));const g=(0,c.e)(S,X,M);M=null;const e=function(M,A,O,S){if(O){return{vertexSourceCode:(1===S?"//":"")+"#define SHADER_NAME vertex:"+(O.vertexElement||O.vertex||O.spectorName||O)+"\n"+M,fragmentSourceCode:(1===S?"//":"")+"#define SHADER_NAME fragment:"+(O.fragmentElement||O.fragment||O.spectorName||O)+"\n"+A}}return{vertexSourceCode:M,fragmentSourceCode:A}}(g.vertexCode,g.fragmentCode,A,Q);null===z||void 0===z||z(e.vertexSourceCode,e.fragmentSourceCode)}),X)}};T(B,"Vertex","",(A=>{(0,c.g)(M),(0,c.j)(A,M,((M,S)=>{j&&(j._rawVertexSourceCode=A,j._vertexSourceCodeBeforeMigration=S),O&&(M=O("vertex",M)),J[0]=M,K()}),X)}),Q),T(g,"Fragment","Pixel",(M=>{j&&(j._rawFragmentSourceCode=M),J[1]=M,K()}),Q)}function T(M,A,O,z,X,c){if("undefined"!==typeof HTMLElement&&M instanceof HTMLElement){return void z((0,S.d)(M))}if("source:"===M.substring(0,7))return void z(M.substring(7));if("base64:"===M.substring(0,7)){return void z(window.atob(M.substring(7)))}const B=Q.c.GetShadersStore(X);if(B[M+A+"Shader"])return void z(B[M+A+"Shader"]);if(O&&B[M+O+"Shader"])return void z(B[M+O+"Shader"]);let g;if(g="."===M[0]||"/"===M[0]||M.indexOf("http")>-1?M:Q.c.GetShadersRepository(X)+M,!(c=c||j.l))throw new Error("loadFileInjection is not defined");c(g+"."+A.toLowerCase()+".fx",z)}const J=(M,A,O,S)=>{try{const Q=M.context?(0,z.B)(M.context):null;Q&&(Q.disableParallelShaderCompile=M.disableParallelCompilation);const X=M.existingPipelineContext||A(M.shaderProcessingContext);return X._name=M.name,M.name&&Q&&(Q.cachedPipelines[M.name]=X),O(X,M.vertex,M.fragment,!!M.createAsRaw,"","",M.rebuildRebind,M.defines,M.transformFeedbackVaryings,"",(()=>{S(X,(()=>{var A;null===(A=M.onRenderingStateCompiled)||void 0===A||A.call(M,X)}))})),X}catch(Q){throw X.c.Error("Error compiling effect"),Q}}},12861:(M,A,O)=>{O.r(A),O.d(A,{Effect:()=>j});var S=O(12776),z=O(12783),Q=O(12864),X=O(12870),c=O(12848);class j{static get ShadersRepository(){return Q.c.ShadersRepository}static set ShadersRepository(M){Q.c.ShadersRepository=M}get T(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new S.c),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(M,A,O){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4?arguments[4]:void 0,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,g=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,e=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,T=arguments.length>9?arguments[9]:void 0,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",K=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,G=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new S.c,this.onErrorObservable=new S.c,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=M,this._key=J;const d=this._key.replace(/\r/g,"").replace(/\n/g,"|");let w;if(A.attributes){var I,b,s;const M=A;if(this._engine=O,this._attributesNames=M.attributes,this._uniformsNames=M.uniformsNames.concat(M.samplers),this._samplerList=M.samplers.slice(),this.defines=M.defines,this.onError=M.onError,this.onCompiled=M.onCompiled,this._fallbacks=M.fallbacks,this._indexParameters=M.indexParameters,this._transformFeedbackVaryings=M.transformFeedbackVaryings||null,this._multiTarget=!!M.multiTarget,this._shaderLanguage=null!==(I=M.shaderLanguage)&&void 0!==I?I:0,this._disableParallelShaderCompilation=!!M.disableParallelShaderCompilation,M.uniformBuffersNames){this._uniformBuffersNamesList=M.uniformBuffersNames.slice();for(let A=0;A<M.uniformBuffersNames.length;A++)this._uniformBuffersNames[M.uniformBuffersNames[A]]=A}this._processFinalCode=null!==(b=M.processFinalCode)&&void 0!==b?b:null,this._processCodeAfterIncludes=null!==(s=M.processCodeAfterIncludes)&&void 0!==s?s:void 0,G=M.extraInitializationsAsync,w=M.existingPipelineContext}else this._engine=Q,this.defines=null==c?"":c,this._uniformsNames=O.concat(z),this._samplerList=z?z.slice():[],this._attributesNames=A,this._uniformBuffersNamesList=[],this._shaderLanguage=K,this.onError=e,this.onCompiled=g,this._indexParameters=T,this._fallbacks=B;var Y;"WEBGL2"===this._engine.shaderPlatformName&&(w=null!==(Y=(0,X.h)(d,this._engine._gl))&&void 0!==Y?Y:w);this._attributeLocationByName={},this.uniqueId=j._UniqueIdSeed++,w?(this._pipelineContext=w,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,G),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.T||this.dispose(!0)}))}async _processShaderCodeAsync(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0;S&&await S(),this._processingContext=O||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const z={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:null!==M&&void 0!==M?M:this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Q.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:Q.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,QQ:this._engine.QQ,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,X.c)(z,this.name,this._processFinalCode,((M,O)=>{this._vertexSourceCode=M,this._fragmentSourceCode=O,this._prepareEffect(A)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch(M){return!1}}_isReadyInternal(){return!!this._engine.T||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(M){return this._attributes[M]}getAttributeLocationByName(M){return this._attributeLocationByName[M]}getAttributesCount(){return this._attributes.length}getUniformIndex(M){return this._uniformsNames.indexOf(M)}getUniform(M){return this._uniforms[M]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((M=>{this.executeWhenCompiled(M)}))}executeWhenCompiled(M){this.isReady()?M(this):(this.onCompileObservable.add((A=>{M(A)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(M){(0,c.c)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(A=>{this._processCompilationErrors(A,M)}),16,12e4,!0," - Effect: ".concat("string"===typeof this.name?this.name:this.key))}get vertexSourceCode(){var M,A;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:null!==(M=null===(A=this._pipelineContext)||void 0===A?void 0:A._getVertexShaderCode())&&void 0!==M?M:this._vertexSourceCode}get fragmentSourceCode(){var M,A;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:null!==(M=null===(A=this._pipelineContext)||void 0===A?void 0:A._getFragmentShaderCode())&&void 0!==M?M:this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,QQ:this._engine.QQ,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(M,A,O,S){this._isReady=!1,this._vertexSourceCodeOverride=M,this._fragmentSourceCodeOverride=A,this.onError=(M,A)=>{S&&S(A)},this.onCompiled=()=>{var M,A;const S=this.getEngine().scenes;if(S)for(let O=0;O<S.length;O++)S[O].markAllMaterialsAsDirty(127);null===(M=(A=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===M||M.call(A,O)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(M){if(this._pipelineContext=M,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let A=0;A<this._attributesNames.length;A++){const M=this._attributesNames[A];this._attributeLocationByName[M]=this._attributes[A]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),j.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A=this._pipelineContext;this._isReady=!1;try{const O=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),S=O?null:this.defines,z=O?this._vertexSourceCodeOverride:this._vertexSourceCode,Q=O?this._fragmentSourceCodeOverride:this._fragmentSourceCode,c=this._engine;this._pipelineContext=(0,X.d)({existingPipelineContext:M?A:null,vertex:z,fragment:Q,context:"WEBGL2"===c.shaderPlatformName||"WEBGL1"===c.shaderPlatformName?c._gl:void 0,rebuildRebind:(M,A,O,S)=>this._rebuildProgram(M,A,O,S),defines:S,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:O,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:O=>{A&&!M&&this._engine._deletePipelineContext(A),O&&this._onRenderingStateCompiled(O)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(A)}catch(O){this._processCompilationErrors(O,A)}}_getShaderCodeAndErrorLine(M,A,O){const S=O?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let z=null;if(A&&M){const Q=A.match(S);if(Q&&2===Q.length){const A=parseInt(Q[1]),S=M.split("\n",-1);S.length>=A&&(z="Offending line [".concat(A,"] in ").concat(O?"fragment":"vertex"," code: ").concat(S[A-1]))}}return[M,z]}_processCompilationErrors(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=M.message;const O=this._attributesNames,S=this._fallbacks;if(z.c.Error("Unable to compile effect:"),z.c.Error("Uniforms: ".concat(this._uniformsNames.join(" "))),z.c.Error("Attributes: ".concat(O.join(" "))),z.c.Error("Defines:\n"+this.defines),j.LogShaderCodeOnCompilationError){var Q,X;let M=null,A=null,O=null;var c;if(null!==(Q=this._pipelineContext)&&void 0!==Q&&Q._getVertexShaderCode()&&([O,M]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),O&&(z.c.Error("Vertex code:"),z.c.Error(O))),null!==(X=this._pipelineContext)&&void 0!==X&&X._getFragmentShaderCode())[O,A]=this._getShaderCodeAndErrorLine(null===(c=this._pipelineContext)||void 0===c?void 0:c._getFragmentShaderCode(),this._compilationError,!0),O&&(z.c.Error("Fragment code:"),z.c.Error(O));M&&z.c.Error(M),A&&z.c.Error(A)}z.c.Error("Error: "+this._compilationError);const B=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};A&&(this._pipelineContext=A,this._isReady=!0,B()),S?(this._pipelineContext=null,S.hasMoreFallbacks?(this._allFallbacksProcessed=!1,z.c.Error("Trying next fallback."),this.defines=S.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,B(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,A||B())}get isSupported(){return""===this._compilationError}_bindTexture(M,A){this._engine._bindTexture(this._samplers[M],A,M)}setTexture(M,A){this._engine.setTexture(this._samplers[M],this._uniforms[M],A,M)}setTextureArray(M,A){const O=M+"Ex";if(-1===this._samplerList.indexOf(O+"0")){const S=this._samplerList.indexOf(M);for(let M=1;M<A.length;M++){const A=O+(M-1).toString();this._samplerList.splice(S+M,0,A)}let z=0;for(const M of this._samplerList)this._samplers[M]=z,z+=1}this._engine.setTextureArray(this._samplers[M],this._uniforms[M],A,M)}bindUniformBuffer(M,A){const O=this._uniformBuffersNames[A];void 0===O||j._BaseCache[O]===M&&this._engine._features.useUBOBindingCache||(j._BaseCache[O]=M,this._engine.bindUniformBufferBase(M,O,A))}bindUniformBlock(M,A){this._engine.bindUniformBlock(this._pipelineContext,M,A)}setInt(M,A){return this._pipelineContext.setInt(M,A),this}setInt2(M,A,O){return this._pipelineContext.setInt2(M,A,O),this}setInt3(M,A,O,S){return this._pipelineContext.setInt3(M,A,O,S),this}setInt4(M,A,O,S,z){return this._pipelineContext.setInt4(M,A,O,S,z),this}setIntArray(M,A){return this._pipelineContext.setIntArray(M,A),this}setIntArray2(M,A){return this._pipelineContext.setIntArray2(M,A),this}setIntArray3(M,A){return this._pipelineContext.setIntArray3(M,A),this}setIntArray4(M,A){return this._pipelineContext.setIntArray4(M,A),this}setUInt(M,A){return this._pipelineContext.setUInt(M,A),this}setUInt2(M,A,O){return this._pipelineContext.setUInt2(M,A,O),this}setUInt3(M,A,O,S){return this._pipelineContext.setUInt3(M,A,O,S),this}setUInt4(M,A,O,S,z){return this._pipelineContext.setUInt4(M,A,O,S,z),this}setUIntArray(M,A){return this._pipelineContext.setUIntArray(M,A),this}setUIntArray2(M,A){return this._pipelineContext.setUIntArray2(M,A),this}setUIntArray3(M,A){return this._pipelineContext.setUIntArray3(M,A),this}setUIntArray4(M,A){return this._pipelineContext.setUIntArray4(M,A),this}setFloatArray(M,A){return this._pipelineContext.setArray(M,A),this}setFloatArray2(M,A){return this._pipelineContext.setArray2(M,A),this}setFloatArray3(M,A){return this._pipelineContext.setArray3(M,A),this}setFloatArray4(M,A){return this._pipelineContext.setArray4(M,A),this}setArray(M,A){return this._pipelineContext.setArray(M,A),this}setArray2(M,A){return this._pipelineContext.setArray2(M,A),this}setArray3(M,A){return this._pipelineContext.setArray3(M,A),this}setArray4(M,A){return this._pipelineContext.setArray4(M,A),this}setMatrices(M,A){return this._pipelineContext.setMatrices(M,A),this}setMatrix(M,A){return this._pipelineContext.setMatrix(M,A),this}setMatrix3x3(M,A){return this._pipelineContext.setMatrix3x3(M,A),this}setMatrix2x2(M,A){return this._pipelineContext.setMatrix2x2(M,A),this}setFloat(M,A){return this._pipelineContext.setFloat(M,A),this}setBool(M,A){return this._pipelineContext.setInt(M,A?1:0),this}setVector2(M,A){return this._pipelineContext.setVector2(M,A),this}setFloat2(M,A,O){return this._pipelineContext.setFloat2(M,A,O),this}setVector3(M,A){return this._pipelineContext.setVector3(M,A),this}setFloat3(M,A,O,S){return this._pipelineContext.setFloat3(M,A,O,S),this}setVector4(M,A){return this._pipelineContext.setVector4(M,A),this}setQuaternion(M,A){return this._pipelineContext.setQuaternion(M,A),this}setFloat4(M,A,O,S,z){return this._pipelineContext.setFloat4(M,A,O,S,z),this}setColor3(M,A){return this._pipelineContext.setColor3(M,A),this}setColor4(M,A,O){return this._pipelineContext.setColor4(M,A,O),this}setDirectColor4(M,A){return this._pipelineContext.setDirectColor4(M,A),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(j.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,X.j)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;A&&(Q.c.GetShadersStore(S)["".concat(M,"PixelShader")]=A),O&&(Q.c.GetShadersStore(S)["".concat(M,"VertexShader")]=O)}static ResetCache(){j._BaseCache={}}}j.LogShaderCodeOnCompilationError=!0,j.PersistentMode=!1,j.AutomaticallyClearCodeCache=!1,j._UniqueIdSeed=0,j._BaseCache={},j.ShadersStore=Q.c.ShadersStore,j.IncludesShadersStore=Q.c.IncludesShadersStore},12799:(M,A,O)=>{O.d(A,{d:()=>z});const S={};function z(M){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!S[M])return S[M]=!0,"".concat(M," needs to be imported before as it contains a side-effect required by your code.")}},12778:(M,A,O)=>{function S(){return"undefined"!==typeof window}function z(){return"undefined"!==typeof navigator}function Q(){return"undefined"!==typeof document}function X(M){let A="",O=M.firstChild;for(;O;)3===O.nodeType&&(A+=O.textContent),O=O.nextSibling;return A}O.d(A,{d:()=>X,g:()=>Q,k:()=>z,m:()=>S})},12783:(M,A,O)=>{O.d(A,{c:()=>S});class S{static _CheckLimit(M,A){let O=S._LogLimitOutputs[M];return O?O.current++:(O={limit:A,current:1},S._LogLimitOutputs[M]=O),O.current<=O.limit}static _GenerateLimitMessage(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const O=S._LogLimitOutputs[M];if(!O||!S.MessageLimitReached)return;const z=this._Levels[A];var Q;O.current===O.limit&&S[z.name](S.MessageLimitReached.replace(/%LIMIT%/g,""+O.limit).replace(/%TYPE%/g,null!==(Q=z.name)&&void 0!==Q?Q:""))}static _AddLogEntry(M){S._LogCache=M+S._LogCache,S.OnNewCacheEntry&&S.OnNewCacheEntry(M)}static _FormatMessage(M){const A=M=>M<10?"0"+M:""+M,O=new Date;return"["+A(O.getHours())+":"+A(O.getMinutes())+":"+A(O.getSeconds())+"]: "+M}static _LogDisabled(M,A){}static _LogEnabled(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,A=arguments.length>1?arguments[1]:void 0,O=arguments.length>2?arguments[2]:void 0;const z=Array.isArray(A)?A[0]:A;if(void 0!==O&&!S._CheckLimit(z,O))return;const Q=S._FormatMessage(z),X=this._Levels[M],c=Array.isArray(A)?A.slice(1):[];X.logFunc&&X.logFunc("BJS - "+Q,...c);const j="<div style='color:".concat(X.color,"'>").concat(Q,"</div><br>");S._AddLogEntry(j),S._GenerateLimitMessage(z,M)}static get LogCache(){return S._LogCache}static ClearLogCache(){S._LogCache="",S._LogLimitOutputs={},S.errorsCount=0}static set LogLevels(M){S.Log=S._LogDisabled,S.Warn=S._LogDisabled,S.Error=S._LogDisabled;const A=[S.MessageLogLevel,S.WarningLogLevel,S.ErrorLogLevel];for(const O of A)if((M&O)===O){const M=this._Levels[O];S[M.name]=S._LogEnabled.bind(S,O)}}}S.NoneLogLevel=0,S.MessageLogLevel=1,S.WarningLogLevel=2,S.ErrorLogLevel=4,S.AllLogLevel=7,S.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",S._LogCache="",S._LogLimitOutputs={},S._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],S.errorsCount=0,S.Log=S._LogEnabled.bind(S,S.MessageLogLevel),S.Warn=S._LogEnabled.bind(S,S.WarningLogLevel),S.Error=S._LogEnabled.bind(S,S.ErrorLogLevel)},12776:(M,A,O)=>{O.d(A,{c:()=>X});const S="undefined"!==typeof WeakRef;class z{constructor(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this.initialize(M,A,O,S)}initialize(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],O=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;return this.mask=M,this.skipNextObservers=A,this.target=O,this.currentTarget=S,this}}class Q{constructor(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=M,this.mask=A,this.scope=O,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(M)}}class X{static FromPromise(M,A){const O=new X;return M.then((M=>{O.notifyObservers(M)})).catch((M=>{if(!A)throw M;A.notifyObservers(M)})),O}get observers(){return this._observers}constructor(M){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=A,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new z(0),M&&(this._onObserverAdded=M)}add(M){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],O=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!M)return null;const z=new Q(M,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);z.unregisterOnNextCall=O,A?this._observers.unshift(z):this._observers.push(z),this._onObserverAdded&&this._onObserverAdded(z),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(z,this._lastNotifiedValue);const X=S?new WeakRef(this):{deref:()=>this};return z._remove=function(){let M=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const A=X.deref();A&&(M?A.remove(z):A._remove(z))},z}addOnce(M){return this.add(M,void 0,void 0,void 0,!0)}remove(M){if(!M)return!1;M._remove=null;return-1!==this._observers.indexOf(M)&&(this._deferUnregister(M),!0)}removeCallback(M,A){for(let O=0;O<this._observers.length;O++){const S=this._observers[O];if(!S._willBeUnregistered&&(S.callback===M&&(!A||A===S.scope)))return this._deferUnregister(S),!0}return!1}_deferUnregister(M){M._willBeUnregistered||(this._numObserversMarkedAsDeleted++,M.unregisterOnNextCall=!1,M._willBeUnregistered=!0,setTimeout((()=>{this._remove(M)}),0))}_remove(M){let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!M)return!1;const O=this._observers.indexOf(M);return-1!==O&&(A&&this._numObserversMarkedAsDeleted--,this._observers.splice(O,1),!0)}makeObserverTopPriority(M){this._remove(M,!1),this._observers.unshift(M)}makeObserverBottomPriority(M){this._remove(M,!1),this._observers.push(M)}notifyObservers(M){let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,O=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,z=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=M),!this._observers.length)return!0;const Q=this._eventState;Q.mask=A,Q.target=O,Q.currentTarget=S,Q.skipNextObservers=!1,Q.lastReturnValue=M,Q.userInfo=z;for(const X of this._observers)if(!X._willBeUnregistered&&(X.mask&A&&(X.unregisterOnNextCall&&this._deferUnregister(X),X.scope?Q.lastReturnValue=X.callback.apply(X.scope,[M,Q]):Q.lastReturnValue=X.callback(M,Q)),Q.skipNextObservers))return!1;return!0}notifyObserver(M,A){let O=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=A),M._willBeUnregistered)return;const S=this._eventState;S.mask=O,S.skipNextObservers=!1,M.unregisterOnNextCall&&this._deferUnregister(M),M.callback(A,S)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const M=this._observers.pop();M&&(M._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const M=new X;return M._observers=this._observers.slice(0),M}hasSpecificMask(){let M=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const A of this._observers)if(A.mask&M||A.mask===M)return!0;return!1}}},12848:(M,A,O)=>{O.d(A,{b:()=>z,c:()=>X});let S=[];class z{static SetImmediate(M){0===S.length&&setTimeout((()=>{const M=S;S=[];for(const A of M)A()}),1),S.push(M)}}function Q(M,A,O){try{if(M())return A(),!0}catch(S){return null===O||void 0===O||O(S),!0}return!1}const X=function(M,A,O){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,X=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&Q(M,A,O))return null;const c=setInterval((()=>{Q(M,A,O)?clearInterval(c):(z-=S,z<0&&(clearInterval(c),null===O||void 0===O||O(new Error("Operation timed out after maximum retries. "+(X||"")),!0)))}),S);return()=>clearInterval(c)}}}]);