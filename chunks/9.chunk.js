"use strict";(self.ipz2em9uj1g=self.ipz2em9uj1g||[]).push([[9],{12501:(r,O,W)=>{W.d(O,{e:()=>D,f:()=>o,j:()=>N,i:()=>B,n:()=>Z});class q{constructor(){this.children=[]}isValid(r){return!0}process(r,O,W){let q="";if(this.line){let W=this.line;const d=O.processor;if(d){var Q,C,T,h,J,mr;d.lineProcessor&&(W=d.lineProcessor(W,O.isFragment,O.processingContext));const q=(null===(Q=O.processor)||void 0===Q?void 0:Q.attributeKeywordName)??"attribute",v=O.isFragment&&null!==(C=O.processor)&&void 0!==C&&C.varyingFragmentKeywordName?null===(T=O.processor)||void 0===T?void 0:T.varyingFragmentKeywordName:!O.isFragment&&null!==(h=O.processor)&&void 0!==h&&h.varyingVertexKeywordName?null===(J=O.processor)||void 0===J?void 0:J.varyingVertexKeywordName:"varying";if(!O.isFragment&&d.attributeProcessor&&this.line.startsWith(q))W=d.attributeProcessor(this.line,r,O.processingContext);else if(d.varyingProcessor&&(null!==(mr=d.varyingCheck)&&void 0!==mr&&mr.call(d,this.line,O.isFragment)||!d.varyingCheck&&this.line.startsWith(v)))W=d.varyingProcessor(this.line,O.isFragment,r,O.processingContext);else if(d.uniformProcessor&&d.uniformRegexp&&d.uniformRegexp.test(this.line))O.lookForClosingBracketForUniformBuffer||(W=d.uniformProcessor(this.line,O.isFragment,r,O.processingContext));else if(d.uniformBufferProcessor&&d.uniformBufferRegexp&&d.uniformBufferRegexp.test(this.line))O.lookForClosingBracketForUniformBuffer||(W=d.uniformBufferProcessor(this.line,O.isFragment,O.processingContext),O.lookForClosingBracketForUniformBuffer=!0);else if(d.textureProcessor&&d.textureRegexp&&d.textureRegexp.test(this.line))W=d.textureProcessor(this.line,O.isFragment,r,O.processingContext);else if((d.uniformProcessor||d.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!O.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?d.uniformProcessor&&(W=d.uniformProcessor(this.line,O.isFragment,r,O.processingContext)):d.uniformBufferProcessor&&(W=d.uniformBufferProcessor(this.line,O.isFragment,O.processingContext),O.lookForClosingBracketForUniformBuffer=!0)}O.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(O.lookForClosingBracketForUniformBuffer=!1,d.endOfUniformBufferProcessor&&(W=d.endOfUniformBufferProcessor(this.line,O.isFragment,O.processingContext)))}q+=W+"\n"}for(const d of this.children)q+=d.process(r,O,W);return this.additionalDefineKey&&(r[this.additionalDefineKey]=this.additionalDefineValue||"true",W[this.additionalDefineKey]=r[this.additionalDefineKey]),q}}class Q{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(r){this._lines.length=0;for(const O of r){if(!O||"\r"===O)continue;if("#"===O[0]){this._lines.push(O);continue}const r=O.trim();if(!r)continue;if(r.startsWith("//")){this._lines.push(O);continue}const W=r.indexOf(";");if(-1===W)this._lines.push(r);else if(W===r.length-1)r.length>1&&this._lines.push(r);else{const r=O.split(";");for(let O=0;O<r.length;O++){let W=r[O];W&&(W=W.trim(),W&&this._lines.push(W+(O!==r.length-1?";":"")))}}}}}class C extends q{process(r,O,W){for(let q=0;q<this.children.length;q++){const Q=this.children[q];if(Q.isValid(r))return Q.process(r,O,W)}return""}}class T extends q{isValid(r){return this.testExpression.isTrue(r)}}class h{isTrue(r){return!0}static postfixToInfix(r){const O=[];for(const W of r)if(void 0===h._OperatorPriority[W])O.push(W);else{const r=O[O.length-1],q=O[O.length-2];O.length-=2,O.push(`(${q}${W}${r})`)}return O[O.length-1]}static infixToPostfix(r){const O=h._InfixToPostfixCache.get(r);if(O)return O.accessTime=Date.now(),O.result;if(!r.includes("&&")&&!r.includes("||")&&!r.includes(")")&&!r.includes("("))return[r];const W=[];let q=-1;const Q=()=>{d=d.trim(),""!==d&&(W.push(d),d="")},C=r=>{q<h._Stack.length-1&&(h._Stack[++q]=r)},T=()=>h._Stack[q],J=()=>-1===q?"!!INVALID EXPRESSION!!":h._Stack[q--];let mr=0,d="";for(;mr<r.length;){const O=r.charAt(mr),v=mr<r.length-1?r.substring(mr,2+mr):"";if("("===O)d="",C(O);else if(")"===O){for(Q();-1!==q&&"("!==T();)W.push(J());J()}else if(h._OperatorPriority[v]>1){for(Q();-1!==q&&h._OperatorPriority[T()]>=h._OperatorPriority[v];)W.push(J());C(v),mr++}else d+=O;mr++}for(Q();-1!==q;)"("===T()?J():W.push(J());return h._InfixToPostfixCache.size>=h.InfixToPostfixCacheLimitSize&&h.ClearCache(),h._InfixToPostfixCache.set(r,{result:W,accessTime:Date.now()}),W}static ClearCache(){const r=Array.from(h._InfixToPostfixCache.entries()).sort(((r,O)=>r[1].accessTime-O[1].accessTime));for(let O=0;O<h.InfixToPostfixCacheCleanupSize;O++)h._InfixToPostfixCache.delete(r[O][0])}}h.InfixToPostfixCacheLimitSize=5e4,h.InfixToPostfixCacheCleanupSize=25e3,h._InfixToPostfixCache=new Map,h._OperatorPriority={")":0,"(":1,"||":2,"&&":3},h._Stack=["","","","","","","","","","","","","","","","","","","",""];class J extends h{constructor(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=r,this.not=O}isTrue(r){let O=void 0!==r[this.define];return this.not&&(O=!O),O}}class mr extends h{isTrue(r){return this.leftOperand.isTrue(r)||this.rightOperand.isTrue(r)}}class d extends h{isTrue(r){return this.leftOperand.isTrue(r)&&this.rightOperand.isTrue(r)}}class v extends h{constructor(r,O,W){super(),this.define=r,this.operand=O,this.testValue=W}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(r){let O=!1;const W=parseInt(void 0!=r[this.define]?r[this.define]:this.define),q=parseInt(void 0!=r[this.testValue]?r[this.testValue]:this.testValue);if(isNaN(W)||isNaN(q))return!1;switch(this.operand){case">":O=W>q;break;case"<":O=W<q;break;case"<=":O=W<=q;break;case">=":O=W>=q;break;case"==":O=W===q;break;case"!=":O=W!==q}return O}}var g=W(12474),K=W(12504);const U=/defined\s*?\((.+?)\)/g,P=/defined\s*?\[(.+?)\]/g,b=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,e=/__decl__/,Y=/light\{X\}.(\w*)/g,G=/\{X\}/g,X=[],S=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function o(r){r.processor&&r.processor.initializeShaders&&r.processor.initializeShaders(r.processingContext)}function N(r,O,W,q){var Q;null!==(Q=O.processor)&&void 0!==Q&&Q.preProcessShaderCode&&(r=O.processor.preProcessShaderCode(r,O.isFragment)),B(r,O,(r=>{O.processCodeAfterIncludes&&(r=O.processCodeAfterIncludes(O.isFragment?"fragment":"vertex",r,O.defines));const Q=function(r,O,W){let q=function(r,O){var W;if(null!==(W=O.processor)&&void 0!==W&&W.noPrecision)return r;const q=O.shouldUseHighPrecisionShader;-1===r.indexOf("precision highp float")?r=q?"precision highp float;\n"+r:"precision mediump float;\n"+r:q||(r=r.replace("precision highp float","precision mediump float"));return r}(r,O);if(!O.processor)return q;if(0===O.processor.shaderLanguage&&-1!==q.indexOf("#version 3")&&(q=q.replace("#version 300 es",""),!O.processor.parseGLES3))return q;const Q=O.defines,C=s(O,W);O.processor.preProcessor&&(q=O.processor.preProcessor(q,Q,C,O.isFragment,O.processingContext));const T={};q=k(q,C,O,T),O.processor.postProcessor&&(q=O.processor.postProcessor(q,Q,O.isFragment,O.processingContext,W?{drawBuffersExtensionDisabled:!W.getCaps().drawBuffersExtension}:{},C,T));null!==W&&void 0!==W&&W._features.needShaderCodeInlining&&(q=W.inlineShaderCode(q));return q}(r,O,q);W(Q,r)}))}function D(r,O,W){return W.processor&&W.processor.finalizeShaders?W.processor.finalizeShaders(r,O,W.processingContext):{vertexCode:r,fragmentCode:O}}function p(r){const O=/defined\((.+)\)/.exec(r);if(O&&O.length)return new J(O[1].trim(),"!"===r[0]);const W=["==","!=",">=","<=","<",">"];let q="",Q=0;for(q of W)if(Q=r.indexOf(q),Q>-1)break;if(-1===Q)return new J(r);const C=r.substring(0,Q).trim(),T=r.substring(Q+q.length).trim();return new v(C,q,T)}function z(r,O){const W=new T,q=r.substring(0,O);let Q=r.substring(O);return Q=Q.substring(0,(Q.indexOf("//")+1||Q.length+1)-1).trim(),W.testExpression="#ifdef"===q?new J(Q):"#ifndef"===q?new J(Q,!0):function(r){r=r.replace(U,"defined[$1]");const O=h.infixToPostfix(r),W=[];for(const Q of O)if("||"!==Q&&"&&"!==Q)W.push(Q);else if(W.length>=2){let r=W[W.length-1],O=W[W.length-2];W.length-=2;const q="&&"==Q?new d:new mr;"string"===typeof r&&(r=r.replace(P,"defined($1)")),"string"===typeof O&&(O=O.replace(P,"defined($1)")),q.leftOperand="string"===typeof O?p(O):O,q.rightOperand="string"===typeof r?p(r):r,W.push(q)}let q=W[W.length-1];return"string"===typeof q&&(q=q.replace(P,"defined($1)")),"string"===typeof q?p(q):q}(Q),W}function L(r,O,W,Q){let C=r.currentLine;for(;M(r,W,Q);){C=r.currentLine;const T=C.substring(0,5).toLowerCase();if("#else"===T){const W=new q;return O.children.push(W),void M(r,W,Q)}if("#elif"===T){const r=z(C,5);O.children.push(r),W=r}}}function M(r,O,W){for(;r.canRead;){r.lineIndex++;const Q=r.currentLine;if(Q.indexOf("#")>=0){const q=S.exec(Q);if(q&&q.length){switch(q[0]){case"#ifdef":{const q=new C;O.children.push(q);const T=z(Q,6);q.children.push(T),L(r,q,T,W);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const q=new C;O.children.push(q);const T=z(Q,7);q.children.push(T),L(r,q,T,W);break}case"#if":{const q=new C,T=z(Q,3);O.children.push(q),q.children.push(T),L(r,q,T,W);break}}continue}}const T=new q;if(T.line=Q,O.children.push(T),"#"===Q[0]&&"d"===Q[1]){const r=Q.replace(";","").split(" ");T.additionalDefineKey=r[1],3===r.length&&(T.additionalDefineValue=r[2])}}return!1}function k(r,O,W,C){const T=new q,h=new Q;return h.lineIndex=-1,h.lines=r.split("\n"),M(h,T,C),T.process(O,W,C)}function s(r,O){var W;const q=r.defines,Q={};for(const C of q){const r=C.replace("#define","").replace(";","").trim().split(" ");Q[r[0]]=r.length>1?r[1]:""}return 0===(null===(W=r.processor)||void 0===W?void 0:W.shaderLanguage)&&(Q.GL_ES="true"),Q.__VERSION__=r.version,Q[r.platformName]="true",(0,K.j)(Q,null===O||void 0===O?void 0:O.isNDCHalfZRange,null===O||void 0===O?void 0:O.mh,null===O||void 0===O?void 0:O.useExactSrgbConversions),Q}function B(r,O,W){let q;for(X.length=0;null!==(q=b.exec(r));)X.push(q);let Q=String(r),C=[r],T=!1;for(const h of X){let r=h[1];if(-1!==r.indexOf("__decl__")&&(r=r.replace(e,""),O.supportsUniformBuffers&&(r=r.replace("Vertex","Ubo").replace("Fragment","Ubo")),r+="Declaration"),!O.includesShadersStore[r]){const q=O.shadersRepository+"ShadersInclude/"+r+".fx";return void Z.loadFile(q,(q=>{O.includesShadersStore[r]=q,B(C.join(""),O,W)}))}{let W=O.includesShadersStore[r];if(h[2]){const r=h[3].split(",");for(let O=0;O<r.length;O+=2){const q=new RegExp(r[O],"g"),Q=r[O+1];W=W.replace(q,Q)}}if(h[4]){const r=h[5];if(-1!==r.indexOf("..")){const q=r.split(".."),Q=parseInt(q[0]);let C=parseInt(q[1]),T=W.slice(0);W="",isNaN(C)&&(C=O.indexParameters[q[1]]);for(let r=Q;r<C;r++)O.supportsUniformBuffers||(T=T.replace(Y,((r,O)=>O+"{X}"))),W+=T.replace(G,r.toString())+"\n"}else O.supportsUniformBuffers||(W=W.replace(Y,((r,O)=>O+"{X}"))),W=W.replace(G,r)}const q=[];for(const r of C){const O=r.split(h[0]);for(let r=0;r<O.length-1;r++)q.push(O[r]),q.push(W);q.push(O[O.length-1])}C=q,T=T||W.indexOf("#include<")>=0||W.indexOf("#include <")>=0}}X.length=0,Q=C.join(""),T?B(Q.toString(),O,W):W(Q)}const Z={loadFile:(r,O,W,q,Q,C)=>{throw(0,g.c)("FileTools")}}},12504:(r,O,W)=>{W.d(O,{d:()=>Q,h:()=>C,j:()=>h,k:()=>T,m:()=>J});var q=W(12474);W(12444);const Q={};function C(r,O){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(O?O+"\n":"")+r}function T(r,O,W,C,T,h,J){const mr=J||Q.loadFile;if(mr){return mr(r,O,W,C,T,h)}throw(0,q.c)("FileTools")}function h(r,O,W,q){if(r)return O?r.IS_NDC_HALF_ZRANGE="":delete r.IS_NDC_HALF_ZRANGE,W?r.USE_REVERSE_DEPTHBUFFER="":delete r.USE_REVERSE_DEPTHBUFFER,void(q?r.USE_EXACT_SRGB_CONVERSIONS="":delete r.USE_EXACT_SRGB_CONVERSIONS);{let r="";return O&&(r+="#define IS_NDC_HALF_ZRANGE"),W&&(r&&(r+="\n"),r+="#define USE_REVERSE_DEPTHBUFFER"),q&&(r&&(r+="\n"),r+="#define USE_EXACT_SRGB_CONVERSIONS"),r}}function J(r,O){let W=arguments.length>2&&void 0!==arguments[2]&&arguments[2],q=arguments.length>3?arguments[3]:void 0;switch(r){case 3:{const r=(ArrayBuffer,new Int8Array(O));return q&&r.set(new Int8Array(q)),r}case 0:{const r=(ArrayBuffer,new Uint8Array(O));return q&&r.set(new Uint8Array(q)),r}case 4:{const r=O instanceof ArrayBuffer?new Int16Array(O):new Int16Array(W?O/2:O);return q&&r.set(new Int16Array(q)),r}case 5:case 8:case 9:case 10:case 2:{const r=O instanceof ArrayBuffer?new Uint16Array(O):new Uint16Array(W?O/2:O);return q&&r.set(new Uint16Array(q)),r}case 6:{const r=O instanceof ArrayBuffer?new Int32Array(O):new Int32Array(W?O/4:O);return q&&r.set(new Int32Array(q)),r}case 7:case 11:case 12:case 13:case 14:case 15:{const r=O instanceof ArrayBuffer?new Uint32Array(O):new Uint32Array(W?O/4:O);return q&&r.set(new Uint32Array(q)),r}case 1:{const r=O instanceof ArrayBuffer?new Float32Array(O):new Float32Array(W?O/4:O);return q&&r.set(new Float32Array(q)),r}}const Q=(ArrayBuffer,new Uint8Array(O));return q&&Q.set(new Uint8Array(q)),Q}},12524:(r,O,W)=>{W.d(O,{c:()=>q});class q{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?q.ShadersRepository:q.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?q.ShadersStore:q.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?q.IncludesShadersStore:q.IncludesShadersStoreWGSL}}q.ShadersRepository="src/Shaders/",q.ShadersStore={},q.IncludesShadersStore={},q.ShadersRepositoryWGSL="src/ShadersWGSL/",q.ShadersStoreWGSL={},q.IncludesShadersStoreWGSL={}},12529:(r,O,W)=>{W.d(O,{c:()=>g,e:()=>G,h:()=>U,j:()=>K,m:()=>P,q:()=>Y,u:()=>v,y:()=>mr,C:()=>d,G:()=>J,J:()=>h});class q{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.bO._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(r){r&&this.program&&r(this.program)}setEngine(r){this.bO=r}_fillEffectInformation(r,O,W,q,Q,C,T,h){const J=this.bO;if(J.supportsUniformBuffers)for(const d in O)r.bindUniformBlock(d,O[d]);let mr;for(this.bO.getUniforms(this,W).forEach(((r,O)=>{q[W[O]]=r})),this._uniforms=q,mr=0;mr<Q.length;mr++){null==r.getUniform(Q[mr])&&(Q.splice(mr,1),mr--)}Q.forEach(((r,O)=>{C[r]=O}));for(const d of J.getAttributes(this,T))h.push(d)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(r,O){const W=this._valueCache[r],q=O.updateFlag;return(void 0===W||W!==q)&&(this._valueCache[r]=q,!0)}_cacheFloat2(r,O,W){let q=this._valueCache[r];if(!q||2!==q.length)return q=[O,W],this._valueCache[r]=q,!0;let Q=!1;return q[0]!==O&&(q[0]=O,Q=!0),q[1]!==W&&(q[1]=W,Q=!0),Q}_cacheFloat3(r,O,W,q){let Q=this._valueCache[r];if(!Q||3!==Q.length)return Q=[O,W,q],this._valueCache[r]=Q,!0;let C=!1;return Q[0]!==O&&(Q[0]=O,C=!0),Q[1]!==W&&(Q[1]=W,C=!0),Q[2]!==q&&(Q[2]=q,C=!0),C}_cacheFloat4(r,O,W,q,Q){let C=this._valueCache[r];if(!C||4!==C.length)return C=[O,W,q,Q],this._valueCache[r]=C,!0;let T=!1;return C[0]!==O&&(C[0]=O,T=!0),C[1]!==W&&(C[1]=W,T=!0),C[2]!==q&&(C[2]=q,T=!0),C[3]!==Q&&(C[3]=Q,T=!0),T}setInt(r,O){const W=this._valueCache[r];void 0!==W&&W===O||this.bO.setInt(this._uniforms[r],O)&&(this._valueCache[r]=O)}setInt2(r,O,W){this._cacheFloat2(r,O,W)&&(this.bO.setInt2(this._uniforms[r],O,W)||(this._valueCache[r]=null))}setInt3(r,O,W,q){this._cacheFloat3(r,O,W,q)&&(this.bO.setInt3(this._uniforms[r],O,W,q)||(this._valueCache[r]=null))}setInt4(r,O,W,q,Q){this._cacheFloat4(r,O,W,q,Q)&&(this.bO.setInt4(this._uniforms[r],O,W,q,Q)||(this._valueCache[r]=null))}setIntArray(r,O){this._valueCache[r]=null,this.bO.setIntArray(this._uniforms[r],O)}setIntArray2(r,O){this._valueCache[r]=null,this.bO.setIntArray2(this._uniforms[r],O)}setIntArray3(r,O){this._valueCache[r]=null,this.bO.setIntArray3(this._uniforms[r],O)}setIntArray4(r,O){this._valueCache[r]=null,this.bO.setIntArray4(this._uniforms[r],O)}setUInt(r,O){const W=this._valueCache[r];void 0!==W&&W===O||this.bO.setUInt(this._uniforms[r],O)&&(this._valueCache[r]=O)}setUInt2(r,O,W){this._cacheFloat2(r,O,W)&&(this.bO.setUInt2(this._uniforms[r],O,W)||(this._valueCache[r]=null))}setUInt3(r,O,W,q){this._cacheFloat3(r,O,W,q)&&(this.bO.setUInt3(this._uniforms[r],O,W,q)||(this._valueCache[r]=null))}setUInt4(r,O,W,q,Q){this._cacheFloat4(r,O,W,q,Q)&&(this.bO.setUInt4(this._uniforms[r],O,W,q,Q)||(this._valueCache[r]=null))}setUIntArray(r,O){this._valueCache[r]=null,this.bO.setUIntArray(this._uniforms[r],O)}setUIntArray2(r,O){this._valueCache[r]=null,this.bO.setUIntArray2(this._uniforms[r],O)}setUIntArray3(r,O){this._valueCache[r]=null,this.bO.setUIntArray3(this._uniforms[r],O)}setUIntArray4(r,O){this._valueCache[r]=null,this.bO.setUIntArray4(this._uniforms[r],O)}setArray(r,O){this._valueCache[r]=null,this.bO.setArray(this._uniforms[r],O)}setArray2(r,O){this._valueCache[r]=null,this.bO.setArray2(this._uniforms[r],O)}setArray3(r,O){this._valueCache[r]=null,this.bO.setArray3(this._uniforms[r],O)}setArray4(r,O){this._valueCache[r]=null,this.bO.setArray4(this._uniforms[r],O)}setMatrices(r,O){O&&(this._valueCache[r]=null,this.bO.setMatrices(this._uniforms[r],O))}setMatrix(r,O){this._cacheMatrix(r,O)&&(this.bO.setMatrices(this._uniforms[r],O.Yh())||(this._valueCache[r]=null))}setMatrix3x3(r,O){this._valueCache[r]=null,this.bO.setMatrix3x3(this._uniforms[r],O)}setMatrix2x2(r,O){this._valueCache[r]=null,this.bO.setMatrix2x2(this._uniforms[r],O)}setFloat(r,O){const W=this._valueCache[r];void 0!==W&&W===O||this.bO.setFloat(this._uniforms[r],O)&&(this._valueCache[r]=O)}setVector2(r,O){this._cacheFloat2(r,O.x,O.y)&&(this.bO.setFloat2(this._uniforms[r],O.x,O.y)||(this._valueCache[r]=null))}setFloat2(r,O,W){this._cacheFloat2(r,O,W)&&(this.bO.setFloat2(this._uniforms[r],O,W)||(this._valueCache[r]=null))}setVector3(r,O){this._cacheFloat3(r,O.x,O.y,O.z)&&(this.bO.setFloat3(this._uniforms[r],O.x,O.y,O.z)||(this._valueCache[r]=null))}setFloat3(r,O,W,q){this._cacheFloat3(r,O,W,q)&&(this.bO.setFloat3(this._uniforms[r],O,W,q)||(this._valueCache[r]=null))}setVector4(r,O){this._cacheFloat4(r,O.x,O.y,O.z,O.w)&&(this.bO.setFloat4(this._uniforms[r],O.x,O.y,O.z,O.w)||(this._valueCache[r]=null))}setQuaternion(r,O){this._cacheFloat4(r,O.x,O.y,O.z,O.w)&&(this.bO.setFloat4(this._uniforms[r],O.x,O.y,O.z,O.w)||(this._valueCache[r]=null))}setFloat4(r,O,W,q,Q){this._cacheFloat4(r,O,W,q,Q)&&(this.bO.setFloat4(this._uniforms[r],O,W,q,Q)||(this._valueCache[r]=null))}setColor3(r,O){this._cacheFloat3(r,O.r,O.g,O.b)&&(this.bO.setFloat3(this._uniforms[r],O.r,O.g,O.b)||(this._valueCache[r]=null))}setColor4(r,O,W){this._cacheFloat4(r,O.r,O.g,O.b,W)&&(this.bO.setFloat4(this._uniforms[r],O.r,O.g,O.b,W)||(this._valueCache[r]=null))}setDirectColor4(r,O){this._cacheFloat4(r,O.r,O.g,O.b,O.a)&&(this.bO.setFloat4(this._uniforms[r],O.r,O.g,O.b,O.a)||(this._valueCache[r]=null))}_getVertexShaderCode(){return this.vertexShader?this.bO._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.bO._getShaderSource(this.fragmentShader):null}}var Q=W(12504);const C=new WeakMap,T={_webGLVersion:2,cachedPipelines:{}};function h(r){let O=C.get(r);if(!O){if(!r)return T;O={_webGLVersion:r.TEXTURE_BINDING_3D?2:1,_context:r,parallelShaderCompile:r.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},C.set(r,O)}return O}function J(r){C.delete(r)}function mr(r,O,W,q,Q,C){const T=h(q);C||(C=T._createShaderProgramInjection??g);return C(r,e(O,"vertex",q,T._contextWasLost),e(W,"fragment",q,T._contextWasLost),q,Q,T.validateShaderPrograms)}function d(r,O,W,q,Q){let C=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6?arguments[6]:void 0;const J=h(Q);T||(T=J._createShaderProgramInjection??g);const mr=J._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return T(r,b(O,"vertex",q,mr,Q,J._contextWasLost),b(W,"fragment",q,mr,Q,J._contextWasLost),Q,C,J.validateShaderPrograms)}function v(r,O){const W=new q,Q=h(r);return Q.parallelShaderCompile&&!Q.disableParallelShaderCompile&&(W.isParallelCompiled=!0),W.context=Q._context,W}function g(r,O,W,q){let Q=arguments.length>5?arguments[5]:void 0;const C=q.createProgram();if(r.program=C,!C)throw new Error("Unable to create program");return q.attachShader(C,O),q.attachShader(C,W),q.linkProgram(C),r.context=q,r.vertexShader=O,r.fragmentShader=W,r.isParallelCompiled||U(r,q,Q),C}function K(r,O,W){const q=r;if(q._isDisposed)return!1;const Q=h(O);return!!(Q&&Q.parallelShaderCompile&&Q.parallelShaderCompile.COMPLETION_STATUS_KHR&&q.program&&O.getProgramParameter(q.program,Q.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(U(q,O,W),!0)}function U(r,O,W){const q=r.context,Q=r.vertexShader,C=r.fragmentShader,T=r.program;if(!q.getProgramParameter(T,q.LINK_STATUS)){if(!O.getShaderParameter(Q,O.COMPILE_STATUS)){const W=O.getShaderInfoLog(Q);if(W)throw r.vertexCompilationError=W,new Error("VERTEX SHADER "+W)}if(!O.getShaderParameter(C,O.COMPILE_STATUS)){const W=O.getShaderInfoLog(C);if(W)throw r.fragmentCompilationError=W,new Error("FRAGMENT SHADER "+W)}const W=q.getProgramInfoLog(T);if(W)throw r.programLinkError=W,new Error(W)}if(W){q.validateProgram(T);if(!q.getProgramParameter(T,q.VALIDATE_STATUS)){const O=q.getProgramInfoLog(T);if(O)throw r.programValidationError=O,new Error(O)}}q.deleteShader(Q),q.deleteShader(C),r.vertexShader=void 0,r.fragmentShader=void 0,r.onCompiled&&(r.onCompiled(),r.onCompiled=void 0)}function P(r,O,W,q,Q,C,T,J,v){let g=arguments.length>10?arguments[10]:void 0,K=arguments.length>11?arguments[11]:void 0,U=arguments.length>12?arguments[12]:void 0;const P=h(r.context);K||(K=P.createRawShaderProgramInjection??mr),U||(U=P.createShaderProgramInjection??d);const b=r;b.program=q?K(b,O,W,b.context,v):U(b,O,W,J,b.context,v),b.program.__SPECTOR_rebuildProgram=T,g()}function b(r,O,W,q,C,T){return e((0,Q.h)(r,W,q),O,C,T)}function e(r,O,W,q){const Q=W.createShader("vertex"===O?W.VERTEX_SHADER:W.FRAGMENT_SHADER);if(!Q){let r=W.NO_ERROR,Q=W.NO_ERROR;for(;(Q=W.getError())!==W.NO_ERROR;)r=Q;throw new Error(`Something went wrong while creating a gl ${O} shader object. gl error=${r}, gl isContextLost=${W.isContextLost()}, _contextWasLost=${q}`)}return W.shaderSource(Q,r),W.compileShader(Q),Q}function Y(r,O){O.useProgram(r)}function G(r,O){const W=r;if(!W.isParallelCompiled)return void O(r);const q=W.onCompiled;W.onCompiled=()=>{null===q||void 0===q||q(),O(r)}}},12527:(r,O,W)=>{W.d(O,{d:()=>v,h:()=>K,l:()=>mr,m:()=>d});var q=W(12444),Q=W(12529),C=W(12524),T=W(12453),h=W(12501),J=W(12504);function mr(r,O){return(0,Q.J)(O).cachedPipelines[r]}function d(r){const O=r._name,W=r.context;if(O&&W){const r=(0,Q.J)(W),q=r.cachedPipelines[O];null===q||void 0===q||q.dispose(),delete r.cachedPipelines[O]}}function v(r,O,W,Q,C,T,J){let mr,d;const v=(0,q.l)()?null===T||void 0===T?void 0:T.getHostDocument():null;mr="string"===typeof O?O:O.vertexSource?"source:"+O.vertexSource:O.vertexElement?(null===v||void 0===v?void 0:v.getElementById(O.vertexElement))||O.vertexElement:O.vertex||O,d="string"===typeof O?O:O.fragmentSource?"source:"+O.fragmentSource:O.fragmentElement?(null===v||void 0===v?void 0:v.getElementById(O.fragmentElement))||O.fragmentElement:O.fragment||O;const K=[void 0,void 0],U=()=>{if(K[0]&&K[1]){r.isFragment=!0;const[q,mr]=K;(0,h.j)(mr,r,((T,mr)=>{J&&(J._fragmentSourceCodeBeforeMigration=mr),W&&(T=W("fragment",T));const d=(0,h.e)(q,T,r);r=null;const v=function(r,O,W,q){if(W){return{vertexSourceCode:(1===q?"//":"")+"#define SHADER_NAME vertex:"+(W.vertexElement||W.vertex||W.spectorName||W)+"\n"+r,fragmentSourceCode:(1===q?"//":"")+"#define SHADER_NAME fragment:"+(W.fragmentElement||W.fragment||W.spectorName||W)+"\n"+O}}return{vertexSourceCode:r,fragmentSourceCode:O}}(d.vertexCode,d.fragmentCode,O,C);null===Q||void 0===Q||Q(v.vertexSourceCode,v.fragmentSourceCode)}),T)}};g(mr,"Vertex","",(O=>{(0,h.f)(r),(0,h.j)(O,r,((r,q)=>{J&&(J._rawVertexSourceCode=O,J._vertexSourceCodeBeforeMigration=q),W&&(r=W("vertex",r)),K[0]=r,U()}),T)}),C),g(d,"Fragment","Pixel",(r=>{J&&(J._rawFragmentSourceCode=r),K[1]=r,U()}),C)}function g(r,O,W,Q,T,h){if("undefined"!==typeof HTMLElement&&r instanceof HTMLElement){return void Q((0,q.d)(r))}if("source:"===r.substring(0,7))return void Q(r.substring(7));if("base64:"===r.substring(0,7)){return void Q(window.atob(r.substring(7)))}const mr=C.c.GetShadersStore(T);if(mr[r+O+"Shader"])return void Q(mr[r+O+"Shader"]);if(W&&mr[r+W+"Shader"])return void Q(mr[r+W+"Shader"]);let d;if(d="."===r[0]||"/"===r[0]||r.indexOf("http")>-1?r:C.c.GetShadersRepository(T)+r,!(h=h||J.k))throw new Error("loadFileInjection is not defined");h(d+"."+O.toLowerCase()+".fx",Q)}const K=(r,O,W,q)=>{try{const C=r.context?(0,Q.J)(r.context):null;C&&(C.disableParallelShaderCompile=r.disableParallelCompilation);const T=r.existingPipelineContext||O(r.shaderProcessingContext);return T._name=r.name,r.name&&C&&(C.cachedPipelines[r.name]=T),W(T,r.vertex,r.fragment,!!r.createAsRaw,"","",r.rebuildRebind,r.defines,r.transformFeedbackVaryings,"",(()=>{q(T,(()=>{var O;null===(O=r.onRenderingStateCompiled)||void 0===O||O.call(r,T)}))})),T}catch(C){throw T.b.Error("Error compiling effect"),C}}},12515:(r,O,W)=>{W.r(O),W.d(O,{Effect:()=>J});var q=W(12435),Q=W(12453),C=W(12524),T=W(12527),h=W(12509);class J{static get ShadersRepository(){return C.c.ShadersRepository}static set ShadersRepository(r){C.c.ShadersRepository=r}get J(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new q.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(r,O,W){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,C=arguments.length>4?arguments[4]:void 0,h=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,mr=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,v=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,g=arguments.length>9?arguments[9]:void 0,K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,P=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new q.d,this.onErrorObservable=new q.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=r,this._key=K;const b=this._key.replace(/\r/g,"").replace(/\n/g,"|");let e;if(O.attributes){const r=O;if(this._engine=W,this._attributesNames=r.attributes,this._uniformsNames=r.uniformsNames.concat(r.samplers),this._samplerList=r.samplers.slice(),this.defines=r.defines,this.onError=r.onError,this.onCompiled=r.onCompiled,this._fallbacks=r.fallbacks,this._indexParameters=r.indexParameters,this._transformFeedbackVaryings=r.transformFeedbackVaryings||null,this._multiTarget=!!r.multiTarget,this._shaderLanguage=r.shaderLanguage??0,this._disableParallelShaderCompilation=!!r.disableParallelShaderCompilation,r.uniformBuffersNames){this._uniformBuffersNamesList=r.uniformBuffersNames.slice();for(let O=0;O<r.uniformBuffersNames.length;O++)this._uniformBuffersNames[r.uniformBuffersNames[O]]=O}this._processFinalCode=r.processFinalCode??null,this._processCodeAfterIncludes=r.processCodeAfterIncludes??void 0,P=r.extraInitializationsAsync,e=r.existingPipelineContext}else this._engine=C,this.defines=null==h?"":h,this._uniformsNames=W.concat(Q),this._samplerList=Q?Q.slice():[],this._attributesNames=O,this._uniformBuffersNamesList=[],this._shaderLanguage=U,this.onError=v,this.onCompiled=d,this._indexParameters=g,this._fallbacks=mr;"WEBGL2"===this._engine.shaderPlatformName&&(e=(0,T.l)(b,this._engine._gl)??e),this._attributeLocationByName={},this.uniqueId=J._UniqueIdSeed++,e?(this._pipelineContext=e,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,P),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.J||this.dispose(!0)}))}async _processShaderCodeAsync(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,q=arguments.length>3?arguments[3]:void 0;q&&await q(),this._processingContext=W||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const Q={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:r??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:C.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:C.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,mh:this._engine.mh,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,T.d)(Q,this.name,this._processFinalCode,((r,W)=>{this._vertexSourceCode=r,this._fragmentSourceCode=W,this._prepareEffect(O)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.J||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(r){return this._attributes[r]}getAttributeLocationByName(r){return this._attributeLocationByName[r]}getAttributesCount(){return this._attributes.length}getUniformIndex(r){return this._uniformsNames.indexOf(r)}getUniform(r){return this._uniforms[r]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((r=>{this.executeWhenCompiled(r)}))}executeWhenCompiled(r){this.isReady()?r(this):(this.onCompileObservable.add((O=>{r(O)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(r){(0,h.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(O=>{this._processCompilationErrors(O,r)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var r;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(r=this._pipelineContext)||void 0===r?void 0:r._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var r;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(r=this._pipelineContext)||void 0===r?void 0:r._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,mh:this._engine.mh,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(r,O,W,q){this._isReady=!1,this._vertexSourceCodeOverride=r,this._fragmentSourceCodeOverride=O,this.onError=(r,O)=>{q&&q(O)},this.onCompiled=()=>{var r,O;const q=this.getEngine().scenes;if(q)for(let W=0;W<q.length;W++)q[W].markAllMaterialsAsDirty(127);null===(r=(O=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===r||r.call(O,W)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(r){if(this._pipelineContext=r,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let O=0;O<this._attributesNames.length;O++){const r=this._attributesNames[O];this._attributeLocationByName[r]=this._attributes[O]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),J.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=this._pipelineContext;this._isReady=!1;try{const W=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),q=W?null:this.defines,Q=W?this._vertexSourceCodeOverride:this._vertexSourceCode,C=W?this._fragmentSourceCodeOverride:this._fragmentSourceCode,h=this._engine;this._pipelineContext=(0,T.h)({existingPipelineContext:r?O:null,vertex:Q,fragment:C,context:"WEBGL2"===h.shaderPlatformName||"WEBGL1"===h.shaderPlatformName?h._gl:void 0,rebuildRebind:(r,O,W,q)=>this._rebuildProgram(r,O,W,q),defines:q,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:W,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:W=>{O&&!r&&this._engine._deletePipelineContext(O),W&&this._onRenderingStateCompiled(W)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(O)}catch(W){this._processCompilationErrors(W,O)}}_getShaderCodeAndErrorLine(r,O,W){const q=W?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let Q=null;if(O&&r){const C=O.match(q);if(C&&2===C.length){const O=parseInt(C[1]),q=r.split("\n",-1);q.length>=O&&(Q=`Offending line [${O}] in ${W?"fragment":"vertex"} code: ${q[O-1]}`)}}return[r,Q]}_processCompilationErrors(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=r.message;const W=this._attributesNames,q=this._fallbacks;if(Q.b.Error("Unable to compile effect:"),Q.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),Q.b.Error(`Attributes: ${W.join(" ")}`),Q.b.Error("Defines:\n"+this.defines),J.LogShaderCodeOnCompilationError){var C,T;let r=null,O=null,W=null;var h;if(null!==(C=this._pipelineContext)&&void 0!==C&&C._getVertexShaderCode()&&([W,r]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),W&&(Q.b.Error("Vertex code:"),Q.b.Error(W))),null!==(T=this._pipelineContext)&&void 0!==T&&T._getFragmentShaderCode())[W,O]=this._getShaderCodeAndErrorLine(null===(h=this._pipelineContext)||void 0===h?void 0:h._getFragmentShaderCode(),this._compilationError,!0),W&&(Q.b.Error("Fragment code:"),Q.b.Error(W));r&&Q.b.Error(r),O&&Q.b.Error(O)}Q.b.Error("Error: "+this._compilationError);const mr=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};O&&(this._pipelineContext=O,this._isReady=!0,mr()),q?(this._pipelineContext=null,q.hasMoreFallbacks?(this._allFallbacksProcessed=!1,Q.b.Error("Trying next fallback."),this.defines=q.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,mr(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,O||mr())}get isSupported(){return""===this._compilationError}_bindTexture(r,O){this._engine._bindTexture(this._samplers[r],O,r)}setTexture(r,O){this._engine.setTexture(this._samplers[r],this._uniforms[r],O,r)}setTextureArray(r,O){const W=r+"Ex";if(-1===this._samplerList.indexOf(W+"0")){const q=this._samplerList.indexOf(r);for(let r=1;r<O.length;r++){const O=W+(r-1).toString();this._samplerList.splice(q+r,0,O)}let Q=0;for(const r of this._samplerList)this._samplers[r]=Q,Q+=1}this._engine.setTextureArray(this._samplers[r],this._uniforms[r],O,r)}bindUniformBuffer(r,O){const W=this._uniformBuffersNames[O];void 0===W||J._BaseCache[W]===r&&this._engine._features.useUBOBindingCache||(J._BaseCache[W]=r,this._engine.bindUniformBufferBase(r,W,O))}bindUniformBlock(r,O){this._engine.bindUniformBlock(this._pipelineContext,r,O)}setInt(r,O){return this._pipelineContext.setInt(r,O),this}setInt2(r,O,W){return this._pipelineContext.setInt2(r,O,W),this}setInt3(r,O,W,q){return this._pipelineContext.setInt3(r,O,W,q),this}setInt4(r,O,W,q,Q){return this._pipelineContext.setInt4(r,O,W,q,Q),this}setIntArray(r,O){return this._pipelineContext.setIntArray(r,O),this}setIntArray2(r,O){return this._pipelineContext.setIntArray2(r,O),this}setIntArray3(r,O){return this._pipelineContext.setIntArray3(r,O),this}setIntArray4(r,O){return this._pipelineContext.setIntArray4(r,O),this}setUInt(r,O){return this._pipelineContext.setUInt(r,O),this}setUInt2(r,O,W){return this._pipelineContext.setUInt2(r,O,W),this}setUInt3(r,O,W,q){return this._pipelineContext.setUInt3(r,O,W,q),this}setUInt4(r,O,W,q,Q){return this._pipelineContext.setUInt4(r,O,W,q,Q),this}setUIntArray(r,O){return this._pipelineContext.setUIntArray(r,O),this}setUIntArray2(r,O){return this._pipelineContext.setUIntArray2(r,O),this}setUIntArray3(r,O){return this._pipelineContext.setUIntArray3(r,O),this}setUIntArray4(r,O){return this._pipelineContext.setUIntArray4(r,O),this}setFloatArray(r,O){return this._pipelineContext.setArray(r,O),this}setFloatArray2(r,O){return this._pipelineContext.setArray2(r,O),this}setFloatArray3(r,O){return this._pipelineContext.setArray3(r,O),this}setFloatArray4(r,O){return this._pipelineContext.setArray4(r,O),this}setArray(r,O){return this._pipelineContext.setArray(r,O),this}setArray2(r,O){return this._pipelineContext.setArray2(r,O),this}setArray3(r,O){return this._pipelineContext.setArray3(r,O),this}setArray4(r,O){return this._pipelineContext.setArray4(r,O),this}setMatrices(r,O){return this._pipelineContext.setMatrices(r,O),this}setMatrix(r,O){return this._pipelineContext.setMatrix(r,O),this}setMatrix3x3(r,O){return this._pipelineContext.setMatrix3x3(r,O),this}setMatrix2x2(r,O){return this._pipelineContext.setMatrix2x2(r,O),this}setFloat(r,O){return this._pipelineContext.setFloat(r,O),this}setBool(r,O){return this._pipelineContext.setInt(r,O?1:0),this}setVector2(r,O){return this._pipelineContext.setVector2(r,O),this}setFloat2(r,O,W){return this._pipelineContext.setFloat2(r,O,W),this}setVector3(r,O){return this._pipelineContext.setVector3(r,O),this}setFloat3(r,O,W,q){return this._pipelineContext.setFloat3(r,O,W,q),this}setVector4(r,O){return this._pipelineContext.setVector4(r,O),this}setQuaternion(r,O){return this._pipelineContext.setQuaternion(r,O),this}setFloat4(r,O,W,q,Q){return this._pipelineContext.setFloat4(r,O,W,q,Q),this}setColor3(r,O){return this._pipelineContext.setColor3(r,O),this}setColor4(r,O,W){return this._pipelineContext.setColor4(r,O,W),this}setDirectColor4(r,O){return this._pipelineContext.setDirectColor4(r,O),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(J.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,T.m)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;O&&(C.c.GetShadersStore(q)[`${r}PixelShader`]=O),W&&(C.c.GetShadersStore(q)[`${r}VertexShader`]=W)}static ResetCache(){J._BaseCache={}}}J.LogShaderCodeOnCompilationError=!0,J.PersistentMode=!1,J.AutomaticallyClearCodeCache=!1,J._UniqueIdSeed=0,J._BaseCache={},J.ShadersStore=C.c.ShadersStore,J.IncludesShadersStore=C.c.IncludesShadersStore},12474:(r,O,W)=>{W.d(O,{c:()=>Q});const q={};function Q(r){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!q[r])return q[r]=!0,`${r} needs to be imported before as it contains a side-effect required by your code.`}},12444:(r,O,W)=>{function q(){return"undefined"!==typeof window}function Q(){return"undefined"!==typeof navigator}function C(){return"undefined"!==typeof document}function T(r){let O="",W=r.firstChild;for(;W;)3===W.nodeType&&(O+=W.textContent),W=W.nextSibling;return O}W.d(O,{d:()=>T,g:()=>C,h:()=>Q,l:()=>q})},12453:(r,O,W)=>{W.d(O,{b:()=>q});class q{static _CheckLimit(r,O){let W=q._LogLimitOutputs[r];return W?W.current++:(W={limit:O,current:1},q._LogLimitOutputs[r]=W),W.current<=W.limit}static _GenerateLimitMessage(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const W=q._LogLimitOutputs[r];if(!W||!q.MessageLimitReached)return;const Q=this._Levels[O];W.current===W.limit&&q[Q.name](q.MessageLimitReached.replace(/%LIMIT%/g,""+W.limit).replace(/%TYPE%/g,Q.name??""))}static _AddLogEntry(r){q._LogCache=r+q._LogCache,q.OnNewCacheEntry&&q.OnNewCacheEntry(r)}static _FormatMessage(r){const O=r=>r<10?"0"+r:""+r,W=new Date;return"["+O(W.getHours())+":"+O(W.getMinutes())+":"+O(W.getSeconds())+"]: "+r}static _LogDisabled(r,O){}static _LogEnabled(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,O=arguments.length>1?arguments[1]:void 0,W=arguments.length>2?arguments[2]:void 0;const Q=Array.isArray(O)?O[0]:O;if(void 0!==W&&!q._CheckLimit(Q,W))return;const C=q._FormatMessage(Q),T=this._Levels[r],h=Array.isArray(O)?O.slice(1):[];T.logFunc&&T.logFunc("BJS - "+C,...h);const J=`<div style='color:${T.color}'>${C}</div><br>`;q._AddLogEntry(J),q._GenerateLimitMessage(Q,r)}static get LogCache(){return q._LogCache}static ClearLogCache(){q._LogCache="",q._LogLimitOutputs={},q.errorsCount=0}static set LogLevels(r){q.Log=q._LogDisabled,q.Warn=q._LogDisabled,q.Error=q._LogDisabled;const O=[q.MessageLogLevel,q.WarningLogLevel,q.ErrorLogLevel];for(const W of O)if((r&W)===W){const r=this._Levels[W];q[r.name]=q._LogEnabled.bind(q,W)}}}q.NoneLogLevel=0,q.MessageLogLevel=1,q.WarningLogLevel=2,q.ErrorLogLevel=4,q.AllLogLevel=7,q.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",q._LogCache="",q._LogLimitOutputs={},q._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],q.errorsCount=0,q.Log=q._LogEnabled.bind(q,q.MessageLogLevel),q.Warn=q._LogEnabled.bind(q,q.WarningLogLevel),q.Error=q._LogEnabled.bind(q,q.ErrorLogLevel)},12435:(r,O,W)=>{W.d(O,{d:()=>T});const q="undefined"!==typeof WeakRef;class Q{constructor(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,q=arguments.length>3?arguments[3]:void 0;this.initialize(r,O,W,q)}initialize(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1],W=arguments.length>2?arguments[2]:void 0,q=arguments.length>3?arguments[3]:void 0;return this.mask=r,this.skipNextObservers=O,this.target=W,this.currentTarget=q,this}}class C{constructor(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=r,this.mask=O,this.scope=W,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(r)}}class T{static FromPromise(r,O){const W=new T;return r.then((r=>{W.notifyObservers(r)})).catch((r=>{if(!O)throw r;O.notifyObservers(r)})),W}get observers(){return this._observers}constructor(r){let O=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=O,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new Q(0),r&&(this._onObserverAdded=r)}add(r){let O=arguments.length>2&&void 0!==arguments[2]&&arguments[2],W=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!r)return null;const Q=new C(r,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);Q.unregisterOnNextCall=W,O?this._observers.unshift(Q):this._observers.push(Q),this._onObserverAdded&&this._onObserverAdded(Q),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(Q,this._lastNotifiedValue);const T=q?new WeakRef(this):{deref:()=>this};return Q._remove=function(){let r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const O=T.deref();O&&(r?O.remove(Q):O._remove(Q))},Q}addOnce(r){return this.add(r,void 0,void 0,void 0,!0)}remove(r){if(!r)return!1;r._remove=null;return-1!==this._observers.indexOf(r)&&(this._deferUnregister(r),!0)}removeCallback(r,O){for(let W=0;W<this._observers.length;W++){const q=this._observers[W];if(!q._willBeUnregistered&&(q.callback===r&&(!O||O===q.scope)))return this._deferUnregister(q),!0}return!1}_deferUnregister(r){r._willBeUnregistered||(this._numObserversMarkedAsDeleted++,r.unregisterOnNextCall=!1,r._willBeUnregistered=!0,setTimeout((()=>{this._remove(r)}),0))}_remove(r){let O=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!r)return!1;const W=this._observers.indexOf(r);return-1!==W&&(O&&this._numObserversMarkedAsDeleted--,this._observers.splice(W,1),!0)}makeObserverTopPriority(r){this._remove(r,!1),this._observers.unshift(r)}makeObserverBottomPriority(r){this._remove(r,!1),this._observers.push(r)}notifyObservers(r){let O=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,W=arguments.length>2?arguments[2]:void 0,q=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=r),!this._observers.length)return!0;const C=this._eventState;C.mask=O,C.target=W,C.currentTarget=q,C.skipNextObservers=!1,C.lastReturnValue=r,C.userInfo=Q;for(const T of this._observers)if(!T._willBeUnregistered&&(T.mask&O&&(T.unregisterOnNextCall&&this._deferUnregister(T),T.scope?C.lastReturnValue=T.callback.apply(T.scope,[r,C]):C.lastReturnValue=T.callback(r,C)),C.skipNextObservers))return!1;return!0}notifyObserver(r,O){let W=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=O),r._willBeUnregistered)return;const q=this._eventState;q.mask=W,q.skipNextObservers=!1,r.unregisterOnNextCall&&this._deferUnregister(r),r.callback(O,q)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const r=this._observers.pop();r&&(r._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const r=new T;return r._observers=this._observers.slice(0),r}hasSpecificMask(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const O of this._observers)if(O.mask&r||O.mask===r)return!0;return!1}}},12509:(r,O,W)=>{W.d(O,{c:()=>Q,d:()=>T});let q=[];class Q{static SetImmediate(r){0===q.length&&setTimeout((()=>{const r=q;q=[];for(const O of r)O()}),1),q.push(r)}}function C(r,O,W){try{if(r())return O(),!0}catch(q){return null===W||void 0===W||W(q),!0}return!1}const T=function(r,O,W){let q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,T=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&C(r,O,W))return null;const h=setInterval((()=>{C(r,O,W)?clearInterval(h):(Q-=q,Q<0&&(clearInterval(h),null===W||void 0===W||W(new Error("Operation timed out after maximum retries. "+(T||"")),!0)))}),q);return()=>clearInterval(h)}}}]);