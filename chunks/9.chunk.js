"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{11468:(q,c,U)=>{U.d(c,{b:()=>p,e:()=>h,i:()=>o,k:()=>K,n:()=>b,q:()=>H,r:()=>r});var J=U(10833),Q=U(11093),s=U(10870),g=U(10850),X=U(11476),n=U(11113),W=U(11271),D=U(10913),u=U(11082);const K=Object.freeze(new J.g(0,0,0,0)),r=Object.freeze(J.p.Zero()),H=Object.freeze(J.l.Zero()),b=Object.freeze(W.b.Zero()),h=Object.freeze(Q.c.Black()),o=Object.freeze(new Q.e(0,0,0,0)),a={key:0,repeatCount:0,loopMode:2};class p{static _PrepareAnimation(q,c,U,s,g,X,n,D){let u;if(!isNaN(parseFloat(g))&&isFinite(g)?u=p.ANIMATIONTYPE_FLOAT:g instanceof J.g?u=p.ANIMATIONTYPE_QUATERNION:g instanceof J.p?u=p.ANIMATIONTYPE_VECTOR3:g instanceof J.l?u=p.ANIMATIONTYPE_VECTOR2:g instanceof Q.c?u=p.ANIMATIONTYPE_COLOR3:g instanceof Q.e?u=p.ANIMATIONTYPE_COLOR4:g instanceof W.b&&(u=p.ANIMATIONTYPE_SIZE),void 0==u)return null;const K=new p(q,c,U,u,n),r=[{frame:0,value:g},{frame:s,value:X}];return K.setKeys(r),void 0!==D&&K.setEasingFunction(D),K}static CreateAnimation(q,c,U,J){const Q=new p(q+"Animation",q,U,c,p.ANIMATIONLOOPMODE_CONSTANT);return Q.setEasingFunction(J),Q}static CreateAndStartAnimation(q,c,U,J,Q,s,g,X,n,W,D){const u=p._PrepareAnimation(q,U,J,Q,s,g,X,n);return u?(c.Cq&&(D=c.Cq()),D?D.beginDirectAnimation(c,[u],0,Q,u.loopMode!==p.ANIMATIONLOOPMODE_CONSTANT,1,W):null):null}static CreateAndStartHierarchyAnimation(q,c,U,J,Q,s,g,X,n,W,D){const u=p._PrepareAnimation(q,J,Q,s,g,X,n,W);if(!u)return null;return c.Cq().beginDirectHierarchyAnimation(c,U,[u],0,s,1===u.loopMode,1,D)}static CreateMergeAndStartAnimation(q,c,U,J,Q,s,g,X,n,W){const D=p._PrepareAnimation(q,U,J,Q,s,g,X,n);return D?(c.animations.push(D),c.Cq().beginAnimation(c,0,Q,1===D.loopMode,1,W)):null}static MakeAnimationAdditive(q,c,U){let Q;Q="object"===typeof c?c:{referenceFrame:c??0,range:U,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let s=q;if(Q.cloneOriginalAnimation&&(s=q.clone(),s.name=Q.clonedAnimationName||s.name),!s._keys.length)return s;const g=Q.referenceFrame&&Q.referenceFrame>=0?Q.referenceFrame:0;let X=0;const n=s._keys[0];let W=s._keys.length-1;const D=s._keys[W],u={referenceValue:n.value,referencePosition:J.j.hc[0],referenceQuaternion:J.j.Quaternion[0],referenceScaling:J.j.hc[1],keyPosition:J.j.hc[2],keyQuaternion:J.j.Quaternion[1],keyScaling:J.j.hc[3]};let K=n.frame,r=D.frame;if(Q.range){const q=s.getRange(Q.range);q&&(K=q.from,r=q.to)}else K=Q.fromFrame??K,r=Q.toFrame??r;if(K!==n.frame&&(X=s.createKeyForFrame(K)),r!==D.frame&&(W=s.createKeyForFrame(r)),1===s._keys.length){const q=s._getKeyValue(s._keys[0]);u.referenceValue=q.clone?q.clone():q}else if(g<=n.frame){const q=s._getKeyValue(n.value);u.referenceValue=q.clone?q.clone():q}else if(g>=D.frame){const q=s._getKeyValue(D.value);u.referenceValue=q.clone?q.clone():q}else{a.key=0;const q=s._interpolate(g,a);u.referenceValue=q.clone?q.clone():q}s.dataType===p.ANIMATIONTYPE_QUATERNION?u.referenceValue.normalize().conjugateInPlace():s.dataType===p.ANIMATIONTYPE_MATRIX&&(u.referenceValue.decompose(u.referenceScaling,u.referenceQuaternion,u.referencePosition),u.referenceQuaternion.normalize().conjugateInPlace());let H=Number.MAX_VALUE;const b=Q.clipKeys?[]:null;for(let h=X;h<=W;h++){let q=s._keys[h];if((b||Q.cloneOriginalAnimation)&&(q={frame:q.frame,value:q.value.clone?q.value.clone():q.value,inTangent:q.inTangent,outTangent:q.outTangent,interpolation:q.interpolation,lockedTangent:q.lockedTangent},b&&(H===Number.MAX_VALUE&&(H=q.frame),q.frame-=H,b.push(q))),!h||s.dataType===p.ANIMATIONTYPE_FLOAT||q.value!==n.value)switch(s.dataType){case p.ANIMATIONTYPE_MATRIX:q.value.decompose(u.keyScaling,u.keyQuaternion,u.keyPosition),u.keyPosition.Uu(u.referencePosition),u.keyScaling.divideInPlace(u.referenceScaling),u.referenceQuaternion.multiplyToRef(u.keyQuaternion,u.keyQuaternion),J.d.ComposeToRef(u.keyScaling,u.keyQuaternion,u.keyPosition,q.value);break;case p.ANIMATIONTYPE_QUATERNION:u.referenceValue.multiplyToRef(q.value,q.value);break;case p.ANIMATIONTYPE_VECTOR2:case p.ANIMATIONTYPE_VECTOR3:case p.ANIMATIONTYPE_COLOR3:case p.ANIMATIONTYPE_COLOR4:q.value.subtractToRef(u.referenceValue,q.value);break;case p.ANIMATIONTYPE_SIZE:q.value.width-=u.referenceValue.width,q.value.height-=u.referenceValue.height;break;default:q.value-=u.referenceValue}}return b&&s.setKeys(b,!0),s}static TransitionTo(q,c,U,J,Q,s,g){let X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(g<=0)return U[q]=c,X&&X(),null;const n=Q*(g/1e3);s.setKeys([{frame:0,value:U[q].clone?U[q].clone():U[q]},{frame:n,value:c}]),U.animations||(U.animations=[]),U.animations.push(s);const W=J.beginAnimation(U,0,n,!1);return W.onAnimationEnd=X,W}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const q of this._runtimeAnimations)if(!q.isStopped())return!0;return!1}constructor(q,c,U,J,Q,s){this.name=q,this.targetProperty=c,this.framePerSecond=U,this.dataType=J,this.loopMode=Q,this.enableBlending=s,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this._coreAnimation=null,this.targetPropertyPath=c.split("."),this.dataType=J,this.loopMode=void 0===Q?p.ANIMATIONLOOPMODE_CYCLE:Q,this.uniqueId=p._UniqueIdGenerator++}toString(q){let c="Name: "+this.name+", property: "+this.targetProperty;if(c+=", datatype: "+["Float","hc","Quaternion","Matrix","Nc","Vector2"][this.dataType],c+=", nKeys: "+(this._keys?this._keys.length:"none"),c+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),q){c+=", Ranges: {";let q=!0;for(const U in this._ranges)q&&(c+=", ",q=!1),c+=U;c+="}"}return c}addEvent(q){this._events.push(q),this._events.sort(((q,c)=>q.frame-c.frame))}removeEvents(q){for(let c=0;c<this._events.length;c++)this._events[c].frame===q&&(this._events.splice(c,1),c--)}getEvents(){return this._events}createRange(q,c,U){this._ranges[q]||(this._ranges[q]=new X.d(q,c,U))}deleteRange(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const U=this._ranges[q];if(U){if(c){const q=U.from,c=U.to;for(let U=this._keys.length-1;U>=0;U--)this._keys[U].frame>=q&&this._keys[U].frame<=c&&this._keys.splice(U,1)}this._ranges[q]=null}}getRange(q){return this._ranges[q]}getKeys(){return this._keys}getHighestFrame(){let q=0;for(let c=0,U=this._keys.length;c<U;c++)q<this._keys[c].frame&&(q=this._keys[c].frame);return q}getEasingFunction(){return this._easingFunction}setEasingFunction(q){this._easingFunction=q}floatInterpolateFunction(q,c,U){return(0,s.Lerp)(q,c,U)}floatInterpolateFunctionWithTangents(q,c,U,J,Q){return(0,s.Hermite)(q,c,U,J,Q)}quaternionInterpolateFunction(q,c,U){return J.g.Slerp(q,c,U)}quaternionInterpolateFunctionWithTangents(q,c,U,Q,s){return J.g.Hermite(q,c,U,Q,s).normalize()}vector3InterpolateFunction(q,c,U){return J.p.Lerp(q,c,U)}vector3InterpolateFunctionWithTangents(q,c,U,Q,s){return J.p.Hermite(q,c,U,Q,s)}vector2InterpolateFunction(q,c,U){return J.l.Lerp(q,c,U)}vector2InterpolateFunctionWithTangents(q,c,U,Q,s){return J.l.Hermite(q,c,U,Q,s)}sizeInterpolateFunction(q,c,U){return W.b.Lerp(q,c,U)}color3InterpolateFunction(q,c,U){return Q.c.Lerp(q,c,U)}color3InterpolateFunctionWithTangents(q,c,U,J,s){return Q.c.Hermite(q,c,U,J,s)}color4InterpolateFunction(q,c,U){return Q.e.Lerp(q,c,U)}color4InterpolateFunctionWithTangents(q,c,U,J,s){return Q.e.Hermite(q,c,U,J,s)}_getKeyValue(q){return"function"===typeof q?q():q}evaluate(q){return a.key=0,this._interpolate(q,a)}_interpolate(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(c.loopMode===p.ANIMATIONLOOPMODE_CONSTANT&&c.repeatCount>0)return c.highLimitValue.clone?c.highLimitValue.clone():c.highLimitValue;const J=this._keys;let Q;if(this._coreAnimation)Q=this._coreAnimation._key;else{const s=J.length;for(Q=c.key;Q>=0&&q<J[Q].frame;)--Q;for(;Q+1<=s-1&&q>=J[Q+1].frame;)++Q;if(c.key=Q,Q<0)return U?void 0:this._getKeyValue(J[0].value);if(Q+1>s-1)return U?void 0:this._getKeyValue(J[s-1].value);this._key=Q}const s=J[Q],g=J[Q+1];if(U&&(q===s.frame||q===g.frame))return;const X=this._getKeyValue(s.value),n=this._getKeyValue(g.value);if(1===s.interpolation)return g.frame>q?X:n;const W=void 0!==s.outTangent&&void 0!==g.inTangent,D=g.frame-s.frame;let u=(q-s.frame)/D;const a=s.easingFunction||this.getEasingFunction();switch(a&&(u=a.ease(u)),this.dataType){case p.ANIMATIONTYPE_FLOAT:{const q=W?this.floatInterpolateFunctionWithTangents(X,s.outTangent*D,n,g.inTangent*D,u):this.floatInterpolateFunction(X,n,u);switch(c.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return q;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(c.offsetValue??0)*c.repeatCount+q}break}case p.ANIMATIONTYPE_QUATERNION:{const q=W?this.quaternionInterpolateFunctionWithTangents(X,s.outTangent.scale(D),n,g.inTangent.scale(D),u):this.quaternionInterpolateFunction(X,n,u);switch(c.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return q;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.addInPlace((c.offsetValue||K).scale(c.repeatCount))}return q}case p.ANIMATIONTYPE_VECTOR3:{const q=W?this.vector3InterpolateFunctionWithTangents(X,s.outTangent.scale(D),n,g.inTangent.scale(D),u):this.vector3InterpolateFunction(X,n,u);switch(c.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return q;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((c.offsetValue||r).scale(c.repeatCount))}break}case p.ANIMATIONTYPE_VECTOR2:{const q=W?this.vector2InterpolateFunctionWithTangents(X,s.outTangent.scale(D),n,g.inTangent.scale(D),u):this.vector2InterpolateFunction(X,n,u);switch(c.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return q;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((c.offsetValue||H).scale(c.repeatCount))}break}case p.ANIMATIONTYPE_SIZE:switch(c.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(X,n,u);case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(X,n,u).add((c.offsetValue||b).scale(c.repeatCount))}break;case p.ANIMATIONTYPE_COLOR3:{const q=W?this.color3InterpolateFunctionWithTangents(X,s.outTangent.scale(D),n,g.inTangent.scale(D),u):this.color3InterpolateFunction(X,n,u);switch(c.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return q;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((c.offsetValue||h).scale(c.repeatCount))}break}case p.ANIMATIONTYPE_COLOR4:{const q=W?this.color4InterpolateFunctionWithTangents(X,s.outTangent.scale(D),n,g.inTangent.scale(D),u):this.color4InterpolateFunction(X,n,u);switch(c.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return q;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return q.add((c.offsetValue||o).scale(c.repeatCount))}break}case p.ANIMATIONTYPE_MATRIX:switch(c.loopMode){case p.ANIMATIONLOOPMODE_CYCLE:case p.ANIMATIONLOOPMODE_CONSTANT:case p.ANIMATIONLOOPMODE_YOYO:return p.AllowMatricesInterpolation?this.matrixInterpolateFunction(X,n,u,c.workValue):X;case p.ANIMATIONLOOPMODE_RELATIVE:case p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return X}}return 0}matrixInterpolateFunction(q,c,U,Q){return p.AllowMatrixDecomposeForInterpolation?Q?(J.d.DecomposeLerpToRef(q,c,U,Q),Q):J.d.DecomposeLerp(q,c,U):Q?(J.d.LerpToRef(q,c,U,Q),Q):J.d.Lerp(q,c,U)}clone(){const q=new p(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(q.enableBlending=this.enableBlending,q.blendingSpeed=this.blendingSpeed,this._keys&&q.setKeys(this._keys),this._ranges){q._ranges={};for(const c in this._ranges){const U=this._ranges[c];U&&(q._ranges[c]=U.clone())}}return q}setKeys(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=c?q:q.slice(0)}createKeyForFrame(q){a.key=0;const c=this._interpolate(q,a,!0);if(!c)return this._keys[a.key].frame===q?a.key:a.key+1;const U={frame:q,value:c.clone?c.clone():c};return this._keys.splice(a.key+1,0,U),a.key+1}serialize(){const q={};q.name=this.name,q.property=this.targetProperty,q.framePerSecond=this.framePerSecond,q.dataType=this.dataType,q.loopBehavior=this.loopMode,q.enableBlending=this.enableBlending,q.blendingSpeed=this.blendingSpeed;const c=this.dataType;q.keys=[];const U=this.getKeys();for(let J=0;J<U.length;J++){const Q=U[J],s={};switch(s.frame=Q.frame,c){case p.ANIMATIONTYPE_FLOAT:s.values=[Q.value],void 0!==Q.inTangent&&s.values.push(Q.inTangent),void 0!==Q.outTangent&&(void 0===Q.inTangent&&s.values.push(void 0),s.values.push(Q.outTangent)),void 0!==Q.interpolation&&(void 0===Q.inTangent&&s.values.push(void 0),void 0===Q.outTangent&&s.values.push(void 0),s.values.push(Q.interpolation));break;case p.ANIMATIONTYPE_QUATERNION:case p.ANIMATIONTYPE_MATRIX:case p.ANIMATIONTYPE_VECTOR3:case p.ANIMATIONTYPE_COLOR3:case p.ANIMATIONTYPE_COLOR4:s.values=Q.value.rc(),void 0!=Q.inTangent&&s.values.push(Q.inTangent.rc()),void 0!=Q.outTangent&&(void 0===Q.inTangent&&s.values.push(void 0),s.values.push(Q.outTangent.rc())),void 0!==Q.interpolation&&(void 0===Q.inTangent&&s.values.push(void 0),void 0===Q.outTangent&&s.values.push(void 0),s.values.push(Q.interpolation))}q.keys.push(s)}q.ranges=[];for(const J in this._ranges){const c=this._ranges[J];if(!c)continue;const U={};U.name=J,U.from=c.from,U.to=c.to,q.ranges.push(U)}return q}static _UniversalLerp(q,c,U){const J=q.constructor;return J.Lerp?J.Lerp(q,c,U):J.Slerp?J.Slerp(q,c,U):q.toFixed?q*(1-U)+U*c:c}static Parse(q){const c=new p(q.name,q.property,q.framePerSecond,q.dataType,q.loopBehavior),U=q.dataType,s=[];let g,X;for(q.enableBlending&&(c.enableBlending=q.enableBlending),q.blendingSpeed&&(c.blendingSpeed=q.blendingSpeed),X=0;X<q.keys.length;X++){const c=q.keys[X];let n,W,D;switch(U){case p.ANIMATIONTYPE_FLOAT:g=c.values[0],c.values.length>=2&&(n=c.values[1]),c.values.length>=3&&(W=c.values[2]),c.values.length>=4&&(D=c.values[3]);break;case p.ANIMATIONTYPE_QUATERNION:if(g=J.g.Ic(c.values),c.values.length>=8){const q=J.g.Ic(c.values.slice(4,8));q.equals(J.g.Zero())||(n=q)}if(c.values.length>=12){const q=J.g.Ic(c.values.slice(8,12));q.equals(J.g.Zero())||(W=q)}c.values.length>=13&&(D=c.values[12]);break;case p.ANIMATIONTYPE_MATRIX:g=J.d.Ic(c.values),c.values.length>=17&&(D=c.values[16]);break;case p.ANIMATIONTYPE_COLOR3:g=Q.c.Ic(c.values),c.values[3]&&(n=Q.c.Ic(c.values[3])),c.values[4]&&(W=Q.c.Ic(c.values[4])),c.values[5]&&(D=c.values[5]);break;case p.ANIMATIONTYPE_COLOR4:g=Q.e.Ic(c.values),c.values[4]&&(n=Q.e.Ic(c.values[4])),c.values[5]&&(W=Q.e.Ic(c.values[5])),c.values[6]&&(D=Q.e.Ic(c.values[6]));break;case p.ANIMATIONTYPE_VECTOR3:default:g=J.p.Ic(c.values),c.values[3]&&(n=J.p.Ic(c.values[3])),c.values[4]&&(W=J.p.Ic(c.values[4])),c.values[5]&&(D=c.values[5])}const u={};u.frame=c.frame,u.value=g,void 0!=n&&(u.inTangent=n),void 0!=W&&(u.outTangent=W),void 0!=D&&(u.interpolation=D),s.push(u)}if(c.setKeys(s),q.ranges)for(X=0;X<q.ranges.length;X++)g=q.ranges[X],c.createRange(g.name,g.from,g.to);return c}static AppendSerializedAnimations(q,c){u.e.AppendSerializedAnimations(q,c)}static async ParseFromFileAsync(q,c){return await new Promise(((U,J)=>{const Q=new D.d;Q.addEventListener("readystatechange",(()=>{if(4==Q.readyState)if(200==Q.status){let c=JSON.parse(Q.responseText);if(c.animations&&(c=c.animations),c.length){const q=[];for(const U of c)q.push(this.Parse(U));U(q)}else{const J=this.Parse(c);q&&(J.name=q),U(J)}}else J("Unable to load the animation")})),Q.open("GET",c),Q.send()}))}static async ParseFromSnippetAsync(q){return await new Promise(((c,U)=>{const J=new D.d;J.addEventListener("readystatechange",(()=>{if(4==J.readyState)if(200==J.status){const U=JSON.parse(JSON.parse(J.responseText).jsonPayload);if(U.animations){const J=JSON.parse(U.animations),Q=[];for(const c of J.animations){const U=this.Parse(c);U.snippetId=q,Q.push(U)}c(Q)}else{const J=JSON.parse(U.animation),Q=this.Parse(J);Q.snippetId=q,c(Q)}}else U("Unable to load the snippet "+q)})),J.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),J.send()}))}}p._UniqueIdGenerator=0,p.AllowMatricesInterpolation=!1,p.AllowMatrixDecomposeForInterpolation=!0,p.SnippetUrl="https://snippet.babylonjs.com",p.ANIMATIONTYPE_FLOAT=0,p.ANIMATIONTYPE_VECTOR3=1,p.ANIMATIONTYPE_QUATERNION=2,p.ANIMATIONTYPE_MATRIX=3,p.ANIMATIONTYPE_COLOR3=4,p.ANIMATIONTYPE_COLOR4=7,p.ANIMATIONTYPE_VECTOR2=5,p.ANIMATIONTYPE_SIZE=6,p.ANIMATIONLOOPMODE_RELATIVE=0,p.ANIMATIONLOOPMODE_CYCLE=1,p.ANIMATIONLOOPMODE_CONSTANT=2,p.ANIMATIONLOOPMODE_YOYO=4,p.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,p.CreateFromSnippetAsync=p.ParseFromSnippetAsync,(0,g.f)("BABYLON.Animation",p),n.b._AnimationRangeFactory=(q,c,U)=>new X.d(q,c,U)},11476:(q,c,U)=>{U.d(c,{d:()=>J});class J{constructor(q,c,U){this.name=q,this.from=c,this.to=U}clone(){return new J(this.name,this.from,this.to)}}},11031:(q,c,U)=>{U.d(c,{e:()=>g,h:()=>X});var J=U(11033),Q=U(10886),s=U(11035);class g{get u(){return this._isDisposed}constructor(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7?arguments[7]:void 0,W=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,q&&q.Cq?this._engine=q.Cq().getEngine():this._engine=q,this._updatable=U,this._instanced=g,this._divisor=n||1,this._label=W,c instanceof J.b?(this._data=null,this._buffer=c):(this._data=c,this._buffer=null),this.byteStride=X?Q:Q*Float32Array.BYTES_PER_ELEMENT,s||this.create()}createVertexBuffer(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6?arguments[6]:void 0;const n=s?c:c*Float32Array.BYTES_PER_ELEMENT,W=J?s?J:J*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new X(this._engine,this,q,this._updatable,!0,W,void 0===Q?this._instanced:Q,n,U,void 0,void 0,!0,this._divisor||g)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!q&&this._buffer||(q=q||this._data,q&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,q),this._data=q):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(q,this._label),this._data=q):this._buffer=this._engine.createVertexBuffer(q,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.WU>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.WU,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.WU,void 0,this._label));Q.c.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(q){this.create(q)}updateDirectly(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,q,J?c:c*Float32Array.BYTES_PER_ELEMENT,U?U*this.byteStride:void 0),this._data=0===c&&void 0===U?q:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class X{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(q){const c=0!=q;this._instanceDivisor=q,c!==this._instanced&&(this._instanced=c,this._computeHashCode())}get _maxVerticesCount(){const q=this.getData();return q?Array.isArray(q)?q.length/(this.byteStride/4)-this.byteOffset/4:(q.byteLength-this.byteOffset)/this.byteStride:0}constructor(q,c,U,J,Q,n,W,D,u,K){let r=arguments.length>10&&void 0!==arguments[10]&&arguments[10],H=arguments.length>11&&void 0!==arguments[11]&&arguments[11],b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,h=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let o=!1;if(this.yX=q,"object"===typeof J&&null!==J?(o=J.updatable??!1,Q=J.postponeInternalCreation,n=J.stride,W=J.instanced,D=J.offset,u=J.size,K=J.type,r=J.normalized??!1,H=J.useBytes??!1,b=J.divisor??1,h=J.takeBufferOwnership??!1,this._label=J.label):o=!!J,c instanceof g?(this._buffer=c,this._ownsBuffer=h):(this._buffer=new g(q,c,o,n,Q,W,H,b,this._label),this._ownsBuffer=!0),this.uniqueId=X._Counter++,this._kind=U,void 0===K){const q=this.getData();this.type=q?X.GetDataType(q):X.FLOAT}else this.type=K;const a=(0,s.p)(this.type);H?(this._size=u||(n?n/a:X.DeduceStride(U)),this.byteStride=n||this._buffer.byteStride||this._size*a,this.byteOffset=D||0):(this._size=u||n||X.DeduceStride(U),this.byteStride=n?n*a:this._buffer.byteStride||this._size*a,this.byteOffset=(D||0)*a),this.normalized=r,this._instanced=void 0!==W&&W,this._instanceDivisor=W?b:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var q;null===(q=this._buffer)||void 0===q||q._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(q,c){const U=this.getData();return U?(0,s.m)(U,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,q,c):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/(0,s.p)(this.type)}getOffset(){return this.byteOffset/(0,s.p)(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*(0,s.p)(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(q){this._buffer.create(q),this._alignBuffer()}update(q){this._buffer.update(q),this._alignBuffer()}updateDirectly(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(q,c,void 0,U),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(q,c){(0,s.i)(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,q,this.normalized,((q,U)=>{for(let J=0;J<this._size;J++)c(q[J],U+J)}))}_alignBuffer(){}static DeduceStride(q){switch(q){case X.UVKind:case X.UV2Kind:case X.UV3Kind:case X.UV4Kind:case X.UV5Kind:case X.UV6Kind:return 2;case X.NormalKind:case X.PositionKind:return 3;case X.ColorKind:case X.ColorInstanceKind:case X.MatricesIndicesKind:case X.MatricesIndicesExtraKind:case X.MatricesWeightsKind:case X.MatricesWeightsExtraKind:case X.TangentKind:return 4;default:throw new Error("Invalid kind '"+q+"'")}}static GetDataType(q){return q instanceof Int8Array?X.BYTE:q instanceof Uint8Array?X.UNSIGNED_BYTE:q instanceof Int16Array?X.SHORT:q instanceof Uint16Array?X.UNSIGNED_SHORT:q instanceof Int32Array?X.INT:q instanceof Uint32Array?X.UNSIGNED_INT:X.FLOAT}static GetTypeByteLength(q){return(0,s.p)(q)}static ForEach(q,c,U,J,Q,g,X,n){(0,s.i)(q,c,U,J,Q,g,X,((q,c)=>{for(let U=0;U<J;U++)n(q[U],c+U)}))}static GetFloatData(q,c,U,J,Q,g,X,n){return(0,s.m)(q,c,U,J,Q,g,X,n)}}X._Counter=0,X.BYTE=5120,X.UNSIGNED_BYTE=5121,X.SHORT=5122,X.UNSIGNED_SHORT=5123,X.INT=5124,X.UNSIGNED_INT=5125,X.FLOAT=5126,X.PositionKind="position",X.NormalKind="normal",X.TangentKind="tangent",X.UVKind="uv",X.UV2Kind="uv2",X.UV3Kind="uv3",X.UV4Kind="uv4",X.UV5Kind="uv5",X.UV6Kind="uv6",X.ColorKind="color",X.ColorInstanceKind="instanceColor",X.MatricesIndicesKind="matricesIndices",X.MatricesWeightsKind="matricesWeights",X.MatricesIndicesExtraKind="matricesIndicesExtra",X.MatricesWeightsExtraKind="matricesWeightsExtra"},11035:(q,c,U)=>{U.d(c,{d:()=>K,e:()=>u,i:()=>n,m:()=>W,p:()=>g,q:()=>X,s:()=>D});var J=U(10886);function Q(q,c,U,J){switch(c){case 5120:{let c=q.getInt8(U);return J&&(c=Math.max(c/127,-1)),c}case 5121:{let c=q.getUint8(U);return J&&(c/=255),c}case 5122:{let c=q.getInt16(U,!0);return J&&(c=Math.max(c/32767,-1)),c}case 5123:{let c=q.getUint16(U,!0);return J&&(c/=65535),c}case 5124:return q.getInt32(U,!0);case 5125:return q.getUint32(U,!0);case 5126:return q.getFloat32(U,!0);default:throw new Error(`Invalid component type ${c}`)}}function s(q,c,U,J,Q){switch(c){case 5120:J&&(Q=Math.round(127*Q)),q.setInt8(U,Q);break;case 5121:J&&(Q=Math.round(255*Q)),q.setUint8(U,Q);break;case 5122:J&&(Q=Math.round(32767*Q)),q.setInt16(U,Q,!0);break;case 5123:J&&(Q=Math.round(65535*Q)),q.setUint16(U,Q,!0);break;case 5124:q.setInt32(U,Q,!0);break;case 5125:q.setUint32(U,Q,!0);break;case 5126:q.setFloat32(U,Q,!0);break;default:throw new Error(`Invalid component type ${c}`)}}function g(q){switch(q){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4;default:throw new Error(`Invalid type '${q}'`)}}function X(q){switch(q){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`Invalid component type '${q}'`)}}function n(q,c,U,J,X,n,W,D){const u=new Array(J),K=new Array(J);if(q instanceof Array){let Q=c/4;const s=U/4;for(let c=0;c<n;c+=J){for(let c=0;c<J;c++)u[c]=K[c]=q[Q+c];D(K,c);for(let c=0;c<J;c++)u[c]!==K[c]&&(q[Q+c]=K[c]);Q+=s}}else{const r=ArrayBuffer.isView(q)?new DataView(q.buffer,q.byteOffset,q.byteLength):new DataView(q),H=g(X);for(let q=0;q<n;q+=J){for(let q=0,U=c;q<J;q++,U+=H)u[q]=K[q]=Q(r,X,U,W);D(K,q);for(let q=0,U=c;q<J;q++,U+=H)u[q]!==K[q]&&s(r,X,U,W,K[q]);c+=U}}}function W(q,c,U,Q,s,X,W,D){const u=c*g(U),K=W*c;if(5126!==U||s!==u){const J=new Float32Array(K);return n(q,Q,s,c,U,K,X,((q,U)=>{for(let Q=0;Q<c;Q++)J[U+Q]=q[Q]})),J}if(!(q instanceof Array||q instanceof Float32Array)||0!==Q||q.length!==K){if(q instanceof Array){const c=Q/4;return q.slice(c,c+K)}if(q instanceof ArrayBuffer)return new Float32Array(q,Q,K);{const c=q.byteOffset+Q;return 0!==(3&c)&&(J.c.Warn("Float array must be aligned to 4-bytes border"),D=!0),D?new Float32Array(q.buffer.slice(c,c+K*Float32Array.BYTES_PER_ELEMENT)):new Float32Array(q.buffer,c,K)}}return D?q.slice():q}function D(q,c,U,Q,s,W,D,u){const K=g(U),r=X(U),H=D*c;if(Array.isArray(q)){if(0!==(3&Q)||0!==(3&s))throw new Error("byteOffset and byteStride must be a multiple of 4 for number[] data.");const J=Q/4,g=s/4;if(J+(D-1)*g+c>q.length)throw new Error("Last accessed index is out of bounds.");if(g<c)throw new Error("Data stride cannot be smaller than the component size.");if(g!==c){const J=new r(H);return n(q,Q,s,c,U,H,W,((q,U)=>{for(let Q=0;Q<c;Q++)J[U+Q]=q[Q]})),J}return new r(q.slice(J,J+H))}let b,h=Q;q instanceof ArrayBuffer?b=q:(b=q.buffer,h+=q.byteOffset);if(h+(D-1)*s+c*K>b.byteLength)throw new Error("Last accessed byte is out of bounds.");const o=c*K;if(s<o)throw new Error("Byte stride cannot be smaller than the component's byte size.");if(s!==o){const q=new r(H);return n(b,h,s,c,U,H,W,((U,J)=>{for(let Q=0;Q<c;Q++)q[J+Q]=U[Q]})),q}return 1!==K&&0!==(h&K-1)&&(J.c.Warn("Array must be aligned to border of element size. Data will be copied."),u=!0),u?new r(b.slice(h,h+H*K)):new r(b,h,H)}function u(q,c,U,Q,s,X,W,D){const u=c*g(U),K=W*c;if(D.length!==K)throw new Error("Output length is not valid");if(5126===U&&s===u)if(q instanceof Array){const c=Q/4;D.set(q,c)}else if(q instanceof ArrayBuffer){const c=new Float32Array(q,Q,K);D.set(c)}else{const c=q.byteOffset+Q;if(0!==(3&c))return J.c.Warn("Float array must be aligned to 4-bytes border"),void D.set(new Float32Array(q.buffer.slice(c,c+K*Float32Array.BYTES_PER_ELEMENT)));const U=new Float32Array(q.buffer,c,K);D.set(U)}else n(q,Q,s,c,U,K,X,((q,U)=>{for(let J=0;J<c;J++)D[U+J]=q[J]}))}function K(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Array.isArray(q)){for(let Q=0;Q<c;Q++)if(q[U+Q]-J>65535)return!0;return!1}return 4===q.BYTES_PER_ELEMENT}},11033:(q,c,U)=>{U.d(c,{b:()=>J});class J{get underlyingResource(){return null}constructor(){this.references=0,this.WU=0,this.is32Bits=!1,this.uniqueId=J._Counter++}}J._Counter=0},11151:(q,c,U)=>{U.d(c,{d:()=>h});var J=U(11010),Q=U(11019),s=U(11156),g=U(10879),X=U(10866),n=U(10833),W=U(11113),D=U(10886),u=U(10850),K=U(10910),r=U(11163),H=U(11168),b=U(11082);class h extends W.b{get position(){return this._position}set position(q){this._position=q}set upVector(q){this._upVector=q}get upVector(){return this._upVector}get screenArea(){let q=0,c=0;if(this.mode===h.PERSPECTIVE_CAMERA)this.fovMode===h.FOVMODE_VERTICAL_FIXED?(c=2*this.Oc*Math.tan(this.fov/2),q=this.getEngine().getAspectRatio(this)*c):(q=2*this.Oc*Math.tan(this.fov/2),c=q/this.getEngine().getAspectRatio(this));else{const U=this.getEngine().getRenderWidth()/2,J=this.getEngine().getRenderHeight()/2;q=(this.orthoRight??U)-(this.orthoLeft??-U),c=(this.orthoTop??J)-(this.orthoBottom??-J)}return q*c}set orthoLeft(q){this._orthoLeft=q;for(const c of this._rigCameras)c.orthoLeft=q}get orthoLeft(){return this._orthoLeft}set orthoRight(q){this._orthoRight=q;for(const c of this._rigCameras)c.orthoRight=q}get orthoRight(){return this._orthoRight}set orthoBottom(q){this._orthoBottom=q;for(const c of this._rigCameras)c.orthoBottom=q}get orthoBottom(){return this._orthoBottom}set orthoTop(q){this._orthoTop=q;for(const c of this._rigCameras)c.orthoTop=q}get orthoTop(){return this._orthoTop}setFocalLength(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:36;this.fov=2*Math.atan(c/(2*q))}set mode(q){this._mode=q;for(const c of this._rigCameras)c.mode=q}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(q,c,U){let J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(q,U,!1),this._position=n.p.Zero(),this._upVector=n.p.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Oc=1,this.maxZ=1e4,this.inertia=.9,this._mode=h.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new r.c(0,0,1,1),this.layerMask=268435455,this.fovMode=h.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=h.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new X.e,this.onProjectionMatrixChangedObservable=new X.e,this.onAfterCheckInputsObservable=new X.e,this.onRestoreStateObservable=new X.e,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new n.d,this._postProcesses=new Array,this._activeMeshes=new s.g(256),this._globalPosition=n.p.Zero(),this._computedViewMatrix=n.d.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=n.d.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=n.g.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.Cq().addCamera(this),J&&!this.Cq().activeCamera&&(this.Cq().activeCamera=this),this.position=c,this.renderPassId=this.Cq().getEngine().createRenderPassId(`Camera ${q}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"HD"}toString(q){let c="Name: "+this.name;if(c+=", type: "+this.getClassName(),this.animations)for(let U=0;U<this.animations.length;U++)c+=", animation[0]: "+this.animations[U].toString(q);return c}applyVerticalCorrection(){const q=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-q.x:q.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(q){return-1!==this._activeMeshes.indexOf(q)}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(q)for(const c of this._postProcesses)if(c&&!c.isReady())return!1;return super.isReady(q)}_initCache(){super._initCache(),this._cache.position=new n.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new n.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Oc=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(q){q||super._updateCache(),this._cache.position.X(this.position),this._cache.upVector.X(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let q=this._cache.mode===this.mode&&this._cache.Oc===this.Oc&&this._cache.maxZ===this.maxZ;if(!q)return!1;const c=this.getEngine();return this.mode===h.PERSPECTIVE_CAMERA?q=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===c.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(q=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===c.getRenderWidth()&&this._cache.renderHeight===c.getRenderHeight(),this.oblique&&(q=q&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),q}attachControl(q,c){}Ou(q){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==h.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let q=0;q<this._postProcesses.length;q++)if(null!==this._postProcesses[q])return this._postProcesses[q];return null}_cascadePostProcessesToRigCams(){const q=this._getFirstPostProcess();q&&q.markTextureDirty();for(let c=0,U=this._rigCameras.length;c<U;c++){const q=this._rigCameras[c],U=q._rigPostProcess;if(U){"pass"===U.getEffectName()&&(q.isIntermediate=0===this._postProcesses.length),q._postProcesses=this._postProcesses.slice(0).concat(U),U.markTextureDirty()}else q._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!q.isReusable()&&this._postProcesses.indexOf(q)>-1?(D.c.Error("You're trying to reuse a post process not defined as reusable."),0):(null==c||c<0?this._postProcesses.push(q):null===this._postProcesses[c]?this._postProcesses[c]=q:this._postProcesses.splice(c,0,q),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.PW(),this._postProcesses.indexOf(q))}detachPostProcess(q){const c=this._postProcesses.indexOf(q);-1!==c&&(this._postProcesses[c]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.PW(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return n.d.Identity()}getViewMatrix(q){return!q&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.Cq().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(q){this._doNotComputeProjectionMatrix=!0,void 0!==q&&(this._projectionMatrix=q)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(q){if(this._doNotComputeProjectionMatrix||!q&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Oc=this.Oc,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const c=this.getEngine(),U=this.Cq(),J=c.useReverseDepthBuffer;if(this.mode===h.PERSPECTIVE_CAMERA){let q;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=c.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Oc<=0&&(this.Oc=.1),q=U.useRightHandedSystem?n.d.PerspectiveFovRHToRef:n.d.PerspectiveFovLHToRef,q(this.fov,c.getAspectRatio(this),J?this.maxZ:this.Oc,J?this.Oc:this.maxZ,this._projectionMatrix,this.fovMode===h.FOVMODE_VERTICAL_FIXED,c.isNDCHalfZRange,this.projectionPlaneTilt,J)}else{var Q,s,g;const q=c.getRenderWidth()/2,X=c.getRenderHeight()/2;U.useRightHandedSystem?this.oblique?n.d.ObliqueOffCenterRHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-X,this.orthoTop??X,J?this.maxZ:this.Oc,J?this.Oc:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,c.isNDCHalfZRange):n.d.OrthoOffCenterRHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-X,this.orthoTop??X,J?this.maxZ:this.Oc,J?this.Oc:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange):this.oblique?n.d.ObliqueOffCenterLHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-X,this.orthoTop??X,J?this.maxZ:this.Oc,J?this.Oc:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,c.isNDCHalfZRange):n.d.OrthoOffCenterLHToRef(this.orthoLeft??-q,this.orthoRight??q,this.orthoBottom??-X,this.orthoTop??X,J?this.maxZ:this.Oc,J?this.Oc:this.maxZ,this._projectionMatrix,c.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(Q=this.oblique)||void 0===Q?void 0:Q.angle,this._cache.obliqueLength=null===(s=this.oblique)||void 0===s?void 0:s.length,this._cache.obliqueOffset=null===(g=this.oblique)||void 0===g?void 0:g.offset,this._cache.renderWidth=c.getRenderWidth(),this._cache.renderHeight=c.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(q){return(this.radius||(this.target?n.p.Distance(this.position,this.target):this.position.length()))+q}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?H.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=H.d.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),c&&this.rigCameras.length>0){let c=!1;for(const U of this.rigCameras)U._updateFrustumPlanes(),c=c||q.isInFrustum(U._frustumPlanes);return c}return q.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(q){return this._updateFrustumPlanes(),q.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,K.d)("Ray")}getForwardRayToRef(q){throw(0,K.d)("Ray")}dispose(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.Cq().stopAnimation(this),this.Cq().removeCamera(this);this._rigCameras.length>0;){const q=this._rigCameras.pop();q&&q.dispose()}if(this._parentContainer){const q=this._parentContainer.cameras.indexOf(this);q>-1&&this._parentContainer.cameras.splice(q,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==h.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let q=this._postProcesses.length;for(;--q>=0;){const c=this._postProcesses[q];c&&c.dispose(this)}}let U=this.customRenderTargets.length;for(;--U>=0;)this.customRenderTargets[U].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.Cq().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(q,c)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(q,c){if(this.cameraRigMode!==q){for(;this._rigCameras.length>0;){const q=this._rigCameras.pop();q&&q.dispose()}if(this.cameraRigMode=q,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=c.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=g.e.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==h.RIG_MODE_NONE){const q=this.createRigCamera(this.name+"_L",0);q&&(q._isLeftCamera=!0);const c=this.createRigCamera(this.name+"_R",1);c&&(c._isRightCamera=!0),q&&c&&(this._rigCameras.push(q),this._rigCameras.push(c))}this._setRigMode(c),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(q){}_getVRProjectionMatrix(){return n.d.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Oc,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(q,c){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[q]=c,"interaxialDistance"===q&&(this._cameraRigParams.stereoHalfAngle=g.e.ToRadians(c/.0637))}createRigCamera(q,c){return null}_updateRigCameras(){for(let q=0;q<this._rigCameras.length;q++)this._rigCameras[q].Oc=this.Oc,this._rigCameras[q].maxZ=this.maxZ,this._rigCameras[q].fov=this.fov,this._rigCameras[q].upVector.X(this.upVector);this.cameraRigMode===h.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const q=b.e.Serialize(this);return q.uniqueId=this.uniqueId,q.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(q),this.inputs&&this.inputs.serialize(q),b.e.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.isEnabled=this.isEnabled(),q}clone(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=b.e.Clone(h.GetConstructorFromName(this.getClassName(),q,this.Cq(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return U.name=q,U.parent=c,this.onClonedObservable.notifyObservers(U),U}zn(q){const c=n.p.Zero();return this.getDirectionToRef(q,c),c}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(q,c){n.p.TransformNormalToRef(q,this.getWorldMatrix(),c)}static GetConstructorFromName(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=W.b.Construct(q,c,U,{interaxial_distance:J,isStereoscopicSideBySide:Q});return s||(()=>h._CreateDefaultParsedCamera(c,U))}o(){return this.getWorldMatrix()}static Parse(q,c){const U=q.type,J=h.GetConstructorFromName(U,q.name,c,q.interaxial_distance,q.isStereoscopicSideBySide),Q=b.e.Parse(J,q,c);if(void 0!==q.parentId&&(Q._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(Q._waitingParentInstanceIndex=q.parentInstanceIndex),Q.inputs&&(Q.inputs.parse(q),Q._setupInputs()),q.upVector&&(Q.upVector=n.p.Ic(q.upVector)),Q.setPosition&&(Q.position.bc(0,0,0),Q.setPosition(n.p.Ic(q.position))),q.target&&Q.setTarget&&Q.setTarget(n.p.Ic(q.target)),q.cameraRigMode){const c=q.interaxial_distance?{interaxialDistance:q.interaxial_distance}:{};Q.setCameraRigMode(q.cameraRigMode,c)}if(q.animations){for(let c=0;c<q.animations.length;c++){const U=q.animations[c],J=(0,u.d)("BABYLON.Animation");J&&Q.animations.push(J.Parse(U))}W.b.ParseAnimationRanges(Q,q,c)}return q.autoAnimate&&c.beginAnimation(Q,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),void 0!==q.isEnabled&&Q.LX(q.isEnabled),Q}_calculateHandednessMultiplier(){let q=this.Cq().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(q*=-1),q}}h._CreateDefaultParsedCamera=(q,c)=>{throw(0,K.d)("UniversalCamera")},h.PERSPECTIVE_CAMERA=0,h.ORTHOGRAPHIC_CAMERA=1,h.FOVMODE_VERTICAL_FIXED=0,h.FOVMODE_HORIZONTAL_FIXED=1,h.RIG_MODE_NONE=0,h.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,h.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,h.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,h.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,h.RIG_MODE_STEREOSCOPIC_INTERLACED=14,h.RIG_MODE_VR=20,h.RIG_MODE_CUSTOM=22,h.ForceAttachControlToAlwaysPreventDefault=!1,(0,J.d)([(0,Q.K)("position")],h.prototype,"_position",void 0),(0,J.d)([(0,Q.K)("upVector")],h.prototype,"_upVector",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"orthoLeft",null),(0,J.d)([(0,Q.N)()],h.prototype,"orthoRight",null),(0,J.d)([(0,Q.N)()],h.prototype,"orthoBottom",null),(0,J.d)([(0,Q.N)()],h.prototype,"orthoTop",null),(0,J.d)([(0,Q.N)()],h.prototype,"fov",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"projectionPlaneTilt",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"Oc",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"maxZ",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"inertia",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"mode",null),(0,J.d)([(0,Q.N)()],h.prototype,"layerMask",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"fovMode",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"cameraRigMode",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"interaxialDistance",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"isStereoscopicSideBySide",void 0)},11339:(q,c,U)=>{U.d(c,{c:()=>u});var J=U(11010),Q=U(11019),s=U(11151),g=U(10833),X=U(10836),n=U(11137);U(11113).b.AddNodeConstructor("TargetCamera",((q,c)=>()=>new u(q,g.p.Zero(),c)));const W=g.d.Zero(),D=g.g.Identity();class u extends s.d{constructor(q,c,U){super(q,c,U,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this.cameraDirection=new g.p(0,0,0),this.cameraRotation=new g.l(0,0),this.updateUpVectorFromRotation=!1,this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=g.p.Zero(),this._initialFocalDistance=1,this._viewMatrix=g.d.Zero(),this._cameraTransformMatrix=g.d.Zero(),this._cameraRotationMatrix=g.d.Zero(),this._transformedReferencePoint=g.p.Zero(),this._deferredPositionUpdate=new g.p,this._deferredRotationQuaternionUpdate=new g.g,this._deferredRotationUpdate=new g.p,this._deferredUpdated=!1,this._deferOnly=!1,this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0,this._referencePoint=g.p.Forward(this.Cq().useRightHandedSystem),this.rotation=new g.p(0,this.Cq().useRightHandedSystem?Math.PI:0,0)}getFrontPosition(q){this.getWorldMatrix();const c=g.j.hc[0],U=g.j.hc[1];return U.set(0,0,this._scene.useRightHandedSystem?-1:1),this.getDirectionToRef(U,c),c.scaleInPlace(q),this.globalPosition.add(c)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const q=this.lockedTarget;q.o().getTranslationToRef(q.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.bc(0,0,0),this.cameraRotation.bc(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new g.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new g.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new g.g(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(q){q||super._updateCache();const c=this._getLockedTargetPosition();c?this._cache.lockedTarget?this._cache.lockedTarget.X(c):this._cache.lockedTarget=c.clone():this._cache.lockedTarget=null,this._cache.rotation.X(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.X(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const q=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(q):!q)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const q=this.getEngine();return this.speed*Math.sqrt(q.getDeltaTime()/(100*q.getFps()))}setTarget(q){this.upVector.normalize(),this._initialFocalDistance=q.eU(this.position).length(),this.position.z===q.z&&(this.position.z+=X.d),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),this.Cq().useRightHandedSystem?g.d.LookAtRHToRef(this.position,q,g.p.UpReadOnly,W):g.d.LookAtLHToRef(this.position,q,g.p.UpReadOnly,W),W.invert();const c=this.rotationQuaternion||D;g.g.FromRotationMatrixToRef(W,c),c.toEulerAnglesToRef(this.rotation),this.rotation.z=0}get target(){return this.getTarget()}set target(q){this.setTarget(q)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(g.j.Matrix[0]),g.p.TransformNormalToRef(this.cameraDirection,g.j.Matrix[0],g.j.hc[0]),this._deferredPositionUpdate.addInPlace(g.j.hc[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.X(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.X(this._deferredPositionUpdate)}_checkInputs(){const q=this.invertRotation?-this.inverseRotationSpeed:1,c=this._decideIfNeedsToMove(),U=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.X(this.rotation),this._deferredPositionUpdate.X(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.X(this.rotationQuaternion),c&&this._updatePosition(),U){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*q,this._deferredRotationUpdate.y+=this.cameraRotation.y*q,!this.noRotationConstraint){const q=1.570796;this._deferredRotationUpdate.x>q&&(this._deferredRotationUpdate.x=q),this._deferredRotationUpdate.x<-q&&(this._deferredRotationUpdate.x=-q)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.X(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(g.g.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.X(this._deferredRotationQuaternionUpdate))}}c&&(Math.abs(this.cameraDirection.x)<this.speed*X.d&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*X.d&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*X.d&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),U&&(Math.abs(this.cameraRotation.x)<this.speed*X.d&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*X.d&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):g.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return g.p.TransformNormalToRef(g.p.UpReadOnly,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),g.p.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?n.d.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(g.g.FromEulerVectorToRef(this.rotation,D),n.d.Y.rotateByQuaternionToRef(D,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(q,c,U){if(this.Cq().useRightHandedSystem?g.d.LookAtRHToRef(q,c,U,this._viewMatrix):g.d.LookAtLHToRef(q,c,U,this._viewMatrix),this.parent){const q=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(q,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.X(q)}createRigCamera(q,c){if(this.cameraRigMode!==s.d.RIG_MODE_NONE){const c=new u(q,this.position.clone(),this.Cq());return c.isRigCamera=!0,c.rigParent=this,this.cameraRigMode===s.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new g.g),c._cameraRigParams={},c.rotationQuaternion=new g.g),c.mode=this.mode,c.orthoLeft=this.orthoLeft,c.orthoRight=this.orthoRight,c.orthoTop=this.orthoTop,c.orthoBottom=this.orthoBottom,c}return null}_updateRigCameras(){const q=this._rigCameras[0],c=this._rigCameras[1];switch(this.o(),this.cameraRigMode){case s.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case s.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case s.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case s.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case s.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const U=this.cameraRigMode===s.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,J=this.cameraRigMode===s.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*U,q),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*J,c);break}case s.d.RIG_MODE_VR:q.rotationQuaternion?(q.rotationQuaternion.X(this.rotationQuaternion),c.rotationQuaternion.X(this.rotationQuaternion)):(q.rotation.X(this.rotation),c.rotation.X(this.rotation)),q.position.X(this.position),c.position.X(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(q,c){this.getTarget().subtractToRef(this.position,u._TargetFocalPoint),u._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const U=u._TargetFocalPoint.addInPlace(this.position);g.d.TranslationToRef(-U.x,-U.y,-U.z,u._TargetTransformMatrix),u._TargetTransformMatrix.multiplyToRef(g.d.RotationAxis(c.upVector,q),u._RigCamTransformMatrix),g.d.TranslationToRef(U.x,U.y,U.z,u._TargetTransformMatrix),u._RigCamTransformMatrix.multiplyToRef(u._TargetTransformMatrix,u._RigCamTransformMatrix),g.p.TransformCoordinatesToRef(this.position,u._RigCamTransformMatrix,c.position),c.setTarget(U)}getClassName(){return"TargetCamera"}}u._RigCamTransformMatrix=new g.d,u._TargetTransformMatrix=new g.d,u._TargetFocalPoint=new g.p,(0,J.d)([(0,Q.N)()],u.prototype,"updateUpVectorFromRotation",void 0),(0,J.d)([(0,Q.K)()],u.prototype,"rotation",void 0),(0,J.d)([(0,Q.N)()],u.prototype,"speed",void 0),(0,J.d)([(0,Q.y)("lockedTargetId")],u.prototype,"lockedTarget",void 0)},11043:(q,c,U)=>{U.d(c,{e:()=>J});class J{constructor(q,c,U){this.bu=q,this.bv=c,this.distance=U,this.faceId=0,this.subMeshId=0}}},11132:(q,c,U)=>{U.d(c,{c:()=>s});var J=U(10833),Q=U(11031);class s{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var q;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||U&&!this.pickedMesh.isVerticesDataPresent(Q.h.NormalKind))return null;let s,g=this.pickedMesh.uc();0===(null===(q=g)||void 0===q?void 0:q.length)&&(g=null);const X=J.j.hc[0],n=J.j.hc[1],W=J.j.hc[2];if(U){const q=this.pickedMesh.getVerticesData(Q.h.NormalKind);let c=g?J.p.FromArrayToRef(q,3*g[3*this.faceId],X):X.bc(q[3*this.faceId*3],q[3*this.faceId*3+1],q[3*this.faceId*3+2]),U=g?J.p.FromArrayToRef(q,3*g[3*this.faceId+1],n):n.bc(q[3*(3*this.faceId+1)],q[3*(3*this.faceId+1)+1],q[3*(3*this.faceId+1)+2]),D=g?J.p.FromArrayToRef(q,3*g[3*this.faceId+2],W):W.bc(q[3*(3*this.faceId+2)],q[3*(3*this.faceId+2)+1],q[3*(3*this.faceId+2)+2]);c=c.scale(this.bu),U=U.scale(this.bv),D=D.scale(1-this.bu-this.bv),s=new J.p(c.x+U.x+D.x,c.y+U.y+D.y,c.z+U.z+D.z)}else{const q=this.pickedMesh.getVerticesData(Q.h.PositionKind),c=g?J.p.FromArrayToRef(q,3*g[3*this.faceId],X):X.bc(q[3*this.faceId*3],q[3*this.faceId*3+1],q[3*this.faceId*3+2]),U=g?J.p.FromArrayToRef(q,3*g[3*this.faceId+1],n):n.bc(q[3*(3*this.faceId+1)],q[3*(3*this.faceId+1)+1],q[3*(3*this.faceId+1)+2]),D=g?J.p.FromArrayToRef(q,3*g[3*this.faceId+2],W):W.bc(q[3*(3*this.faceId+2)],q[3*(3*this.faceId+2)+1],q[3*(3*this.faceId+2)+2]),u=c.eU(U),K=D.eU(U);s=J.p.Cross(u,K)}const D=(q,c)=>{if(-1!==this.thinInstanceIndex){const U=q.thinInstanceGetWorldMatrices()[this.thinInstanceIndex];U&&J.p.TransformNormalToRef(c,U,c)}let U=q.getWorldMatrix();q.nonUniformScaling&&(J.j.Matrix[0].X(U),U=J.j.Matrix[0],U.setTranslationFromFloats(0,0,0),U.invert(),U.transposeToRef(J.j.Matrix[1]),U=J.j.Matrix[1]),J.p.TransformNormalToRef(c,U,c)};if(c&&D(this.pickedMesh,s),this.ray){const q=J.j.hc[0].X(s);c||D(this.pickedMesh,q),J.p.Dot(q,this.ray.direction)>0&&s.negateInPlace()}return s.normalize(),s}getTextureCoordinates(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q.h.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(q))return null;const c=this.pickedMesh.uc();if(!c)return null;const U=this.pickedMesh.getVerticesData(q);if(!U)return null;let s=J.l.Ic(U,2*c[3*this.faceId]),g=J.l.Ic(U,2*c[3*this.faceId+1]),X=J.l.Ic(U,2*c[3*this.faceId+2]);return s=s.scale(this.bu),g=g.scale(this.bv),X=X.scale(1-this.bu-this.bv),new J.l(s.x+g.x+X.x,s.y+g.y+X.y)}}},11178:(q,c,U)=>{U.d(c,{b:()=>J});let J=!1},11054:(q,c,U)=>{U.d(c,{c:()=>g});var J=U(10845),Q=U(10833),s=U(10836);class g{constructor(q,c,U){this.vectors=(0,J.d)(8,Q.p.Zero),this.center=Q.p.Zero(),this.centerWorld=Q.p.Zero(),this.extendSize=Q.p.Zero(),this.extendSizeWorld=Q.p.Zero(),this.directions=(0,J.d)(3,Q.p.Zero),this.vectorsWorld=(0,J.d)(8,Q.p.Zero),this.minimumWorld=Q.p.Zero(),this.maximumWorld=Q.p.Zero(),this.minimum=Q.p.Zero(),this.maximum=Q.p.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(q,c,U)}reConstruct(q,c,U){const J=q.x,s=q.y,g=q.z,X=c.x,n=c.y,W=c.z,D=this.vectors;this.minimum.bc(J,s,g),this.maximum.bc(X,n,W),D[0].bc(J,s,g),D[1].bc(X,n,W),D[2].bc(X,s,g),D[3].bc(J,n,g),D[4].bc(J,s,W),D[5].bc(X,n,g),D[6].bc(J,n,W),D[7].bc(X,s,W),c.addToRef(q,this.center).scaleInPlace(.5),c.subtractToRef(q,this.extendSize).scaleInPlace(.5),this._worldMatrix=U||Q.d.IdentityReadOnly,this._update(this._worldMatrix)}scale(q){const c=g._TmpVector3,U=this.maximum.subtractToRef(this.minimum,c[0]),J=U.length();U.normalizeFromLength(J);const Q=J*q,s=U.scaleInPlace(.5*Q),X=this.center.subtractToRef(s,c[1]),n=this.center.addToRef(s,c[2]);return this.reConstruct(X,n,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(q){const c=this.minimumWorld,U=this.maximumWorld,J=this.directions,s=this.vectorsWorld,g=this.vectors;if(q.isIdentity()){c.X(this.minimum),U.X(this.maximum);for(let q=0;q<8;++q)s[q].X(g[q]);this.extendSizeWorld.X(this.extendSize),this.centerWorld.X(this.center)}else{c.tc(Number.MAX_VALUE),U.tc(-Number.MAX_VALUE);for(let J=0;J<8;++J){const X=s[J];Q.p.TransformCoordinatesToRef(g[J],q,X),c.minimizeInPlace(X),U.maximizeInPlace(X)}U.subtractToRef(c,this.extendSizeWorld).scaleInPlace(.5),U.addToRef(c,this.centerWorld).scaleInPlace(.5)}Q.p.FromArrayToRef(q.m,0,J[0]),Q.p.FromArrayToRef(q.m,4,J[1]),Q.p.FromArrayToRef(q.m,8,J[2]),this._worldMatrix=q}isInFrustum(q){return g.IsInFrustum(this.vectorsWorld,q)}isCompletelyInFrustum(q){return g.IsCompletelyInFrustum(this.vectorsWorld,q)}intersectsPoint(q){const c=this.minimumWorld,U=this.maximumWorld,J=c.x,Q=c.y,g=c.z,X=U.x,n=U.y,W=U.z,D=q.x,u=q.y,K=q.z,r=-s.d;return!(X-D<r||r>D-J)&&(!(n-u<r||r>u-Q)&&!(W-K<r||r>K-g))}intersectsSphere(q){return g.IntersectsSphere(this.minimumWorld,this.maximumWorld,q.centerWorld,q.radiusWorld)}intersectsMinMax(q,c){const U=this.minimumWorld,J=this.maximumWorld,Q=U.x,s=U.y,g=U.z,X=J.x,n=J.y,W=J.z,D=q.x,u=q.y,K=q.z,r=c.x,H=c.y,b=c.z;return!(X<D||Q>r)&&(!(n<u||s>H)&&!(W<K||g>b))}dispose(){var q,c;null===(q=this._drawWrapperFront)||void 0===q||q.dispose(),null===(c=this._drawWrapperBack)||void 0===c||c.dispose()}static Intersects(q,c){return q.intersectsMinMax(c.minimumWorld,c.maximumWorld)}static IntersectsSphere(q,c,U,J){const s=g._TmpVector3[0];Q.p.ClampToRef(U,q,c,s);return Q.p.DistanceSquared(U,s)<=J*J}static IsCompletelyInFrustum(q,c){for(let U=0;U<6;++U){const J=c[U];for(let c=0;c<8;++c)if(J.dotCoordinate(q[c])<0)return!1}return!0}static IsInFrustum(q,c){for(let U=0;U<6;++U){let J=!0;const Q=c[U];for(let c=0;c<8;++c)if(Q.dotCoordinate(q[c])>=0){J=!1;break}if(J)return!1}return!0}}g._TmpVector3=(0,J.d)(3,Q.p.Zero)},11050:(q,c,U)=>{U.d(c,{e:()=>u});var J=U(10845),Q=U(10833),s=U(11054),g=U(11059);const X={min:0,max:0},n={min:0,max:0},W=(q,c,U)=>{const J=Q.p.Dot(c.centerWorld,q),s=Math.abs(Q.p.Dot(c.directions[0],q))*c.extendSize.x+Math.abs(Q.p.Dot(c.directions[1],q))*c.extendSize.y+Math.abs(Q.p.Dot(c.directions[2],q))*c.extendSize.z;U.min=J-s,U.max=J+s},D=(q,c,U)=>(W(q,c,X),W(q,U,n),!(X.min>n.max||n.min>X.max));class u{constructor(q,c,U){this._isLocked=!1,this.boundingBox=new s.c(q,c,U),this.boundingSphere=new g.d(q,c,U)}reConstruct(q,c,U){this.boundingBox.reConstruct(q,c,U),this.boundingSphere.reConstruct(q,c,U)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(q){this._isLocked=q}update(q){this._isLocked||(this.boundingBox._update(q),this.boundingSphere._update(q))}centerOn(q,c){const U=u._TmpVector3[0].X(q).Uu(c),J=u._TmpVector3[1].X(q).addInPlace(c);return this.boundingBox.reConstruct(U,J,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(U,J,this.boundingBox.getWorldMatrix()),this}encapsulate(q){const c=Q.p.Minimize(this.minimum,q),U=Q.p.Maximize(this.maximum,q);return this.reConstruct(c,U,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(q){const c=Q.j.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(c);const U=Q.j.hc[0];return Q.p.TransformCoordinatesToRef(q.boundingBox.minimumWorld,c,U),this.encapsulate(U),Q.p.TransformCoordinatesToRef(q.boundingBox.maximumWorld,c,U),this.encapsulate(U),this}scale(q){return this.boundingBox.scale(q),this.boundingSphere.scale(q),this}isInFrustum(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===c||3===c)&&this.boundingSphere.isCenterInFrustum(q))return!0;if(!this.boundingSphere.isInFrustum(q))return!1;return!(1!==c&&3!==c)||this.boundingBox.isInFrustum(q)}get diagonalLength(){const q=this.boundingBox;return q.maximumWorld.subtractToRef(q.minimumWorld,u._TmpVector3[0]).length()}isCompletelyInFrustum(q){return this.boundingBox.isCompletelyInFrustum(q)}_checkCollision(q){return q._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(q){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(q)&&!!this.boundingBox.intersectsPoint(q))}intersects(q,c){if(!g.d.Intersects(this.boundingSphere,q.boundingSphere))return!1;if(!s.c.Intersects(this.boundingBox,q.boundingBox))return!1;if(!c)return!0;const U=this.boundingBox,J=q.boundingBox;return!!D(U.directions[0],U,J)&&(!!D(U.directions[1],U,J)&&(!!D(U.directions[2],U,J)&&(!!D(J.directions[0],U,J)&&(!!D(J.directions[1],U,J)&&(!!D(J.directions[2],U,J)&&(!!D(Q.p.Cross(U.directions[0],J.directions[0]),U,J)&&(!!D(Q.p.Cross(U.directions[0],J.directions[1]),U,J)&&(!!D(Q.p.Cross(U.directions[0],J.directions[2]),U,J)&&(!!D(Q.p.Cross(U.directions[1],J.directions[0]),U,J)&&(!!D(Q.p.Cross(U.directions[1],J.directions[1]),U,J)&&(!!D(Q.p.Cross(U.directions[1],J.directions[2]),U,J)&&(!!D(Q.p.Cross(U.directions[2],J.directions[0]),U,J)&&(!!D(Q.p.Cross(U.directions[2],J.directions[1]),U,J)&&!!D(Q.p.Cross(U.directions[2],J.directions[2]),U,J))))))))))))))}}u._TmpVector3=(0,J.d)(2,Q.p.Zero)},11059:(q,c,U)=>{U.d(c,{d:()=>s});var J=U(10845),Q=U(10833);class s{constructor(q,c,U){this.center=Q.p.Zero(),this.centerWorld=Q.p.Zero(),this.minimum=Q.p.Zero(),this.maximum=Q.p.Zero(),this.reConstruct(q,c,U)}reConstruct(q,c,U){this.minimum.X(q),this.maximum.X(c);const J=Q.p.Distance(q,c);c.addToRef(q,this.center).scaleInPlace(.5),this.radius=.5*J,this._update(U||Q.d.IdentityReadOnly)}scale(q){const c=this.radius*q,U=s._TmpVector3,J=U[0].tc(c),Q=this.center.subtractToRef(J,U[1]),g=this.center.addToRef(J,U[2]);return this.reConstruct(Q,g,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(q){if(q.isIdentity())this.centerWorld.X(this.center),this.radiusWorld=this.radius;else{Q.p.TransformCoordinatesToRef(this.center,q,this.centerWorld);const c=s._TmpVector3[0];Q.p.TransformNormalFromFloatsToRef(1,1,1,q,c),this.radiusWorld=Math.max(Math.abs(c.x),Math.abs(c.y),Math.abs(c.z))*this.radius}}isInFrustum(q){const c=this.centerWorld,U=this.radiusWorld;for(let J=0;J<6;J++)if(q[J].dotCoordinate(c)<=-U)return!1;return!0}isCenterInFrustum(q){const c=this.centerWorld;for(let U=0;U<6;U++)if(q[U].dotCoordinate(c)<0)return!1;return!0}intersectsPoint(q){const c=Q.p.DistanceSquared(this.centerWorld,q);return!(this.radiusWorld*this.radiusWorld<c)}static Intersects(q,c){const U=Q.p.DistanceSquared(q.centerWorld,c.centerWorld),J=q.radiusWorld+c.radiusWorld;return!(J*J<U)}static CreateFromCenterAndRadius(q,c,U){this._TmpVector3[0].X(q),this._TmpVector3[1].bc(0,0,c),this._TmpVector3[2].X(q),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].Uu(this._TmpVector3[1]);const J=new s(this._TmpVector3[0],this._TmpVector3[2]);return J._worldMatrix=U||Q.d.Identity(),J}}s._TmpVector3=(0,J.d)(3,Q.p.Zero)},11251:(q,c,U)=>{U(10954).d.prototype.createDepthStencilTexture=function(q,c,U){if(c.isCube){const U=q.width||q;return this._createDepthStencilCubeTexture(U,c)}return this._createDepthStencilTexture(q,c,U)}},11226:(q,c,U)=>{U(11199).ThinEngine.prototype.setAlphaMode=function(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==q){switch(q){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}c||(this.depthCullingState.depthMask=0===q),this._alphaMode=q}else if(!c){const c=0===q;this.depthCullingState.depthMask!==c&&(this.depthCullingState.depthMask=c)}}},11233:(q,c,U)=>{var J=U(11199);J.ThinEngine.prototype.updateDynamicIndexBuffer=function(q,c){let U;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(q),U=q.is32Bits?c instanceof Uint32Array?c:new Uint32Array(c):c instanceof Uint16Array?c:new Uint16Array(c),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,U,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},J.ThinEngine.prototype.updateDynamicVertexBuffer=function(q,c,U,J){this.bindArrayBuffer(q),void 0===U&&(U=0);const Q=c.byteLength||c.length;void 0===J||J>=Q&&0===U?c instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,U,new Float32Array(c)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,U,c):c instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,U,new Float32Array(c).subarray(0,J/4)):(c=c instanceof ArrayBuffer?new Uint8Array(c,0,J):new Uint8Array(c.buffer,c.byteOffset,J),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,U,c)),this._resetVertexBufferBinding()}},11238:(q,c,U)=>{var J=U(10976),Q=U(10886),s=U(11199),g=U(11247),X=U(11218);class n extends g.b{setDepthStencilTexture(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(super.setDepthStencilTexture(q,c),!q)return;const U=this._engine,J=this._context,Q=q._hardwareTexture;if(Q&&q._autoMSAAManagement&&this._MSAAFramebuffer){const c=U._currentFramebuffer;U._bindUnboundFramebuffer(this._MSAAFramebuffer),J.framebufferRenderbuffer(J.FRAMEBUFFER,(0,X.e)(q.format)?J.DEPTH_STENCIL_ATTACHMENT:J.DEPTH_ATTACHMENT,J.RENDERBUFFER,Q.getMSAARenderBuffer()),U._bindUnboundFramebuffer(c)}}constructor(q,c,U,J,Q){super(q,c,U,J),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=Q}_cloneRenderTargetWrapper(){let q=null;return this._colorTextureArray&&this._depthStencilTextureArray?(q=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),q.texture.isReady=!0):q=super._cloneRenderTargetWrapper(),q}_swapRenderTargetWrapper(q){super._swapRenderTargetWrapper(q),q._framebuffer=this._framebuffer,q._depthStencilBuffer=this._depthStencilBuffer,q._MSAAFramebuffer=this._MSAAFramebuffer,q._colorTextureArray=this._colorTextureArray,q._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,s=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const q=this._engine,c=q._currentFramebuffer,U=this._context;q._bindUnboundFramebuffer(this._framebuffer),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,null),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,null),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.STENCIL_ATTACHMENT,U.RENDERBUFFER,null),q._bindUnboundFramebuffer(c),U.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(q,c,U,J,Q,s)}shareDepth(q){super.shareDepth(q);const c=this._context,U=this._depthStencilBuffer,J=q._MSAAFramebuffer||q._framebuffer,Q=this._engine;q._depthStencilBuffer&&q._depthStencilBuffer!==U&&c.deleteRenderbuffer(q._depthStencilBuffer),q._depthStencilBuffer=U;const s=q._generateStencilBuffer?c.DEPTH_STENCIL_ATTACHMENT:c.DEPTH_ATTACHMENT;Q._bindUnboundFramebuffer(J),c.framebufferRenderbuffer(c.FRAMEBUFFER,s,c.RENDERBUFFER,U),Q._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const Q=q._hardwareTexture;if(!Q)return;const s=this._framebuffer,g=this._engine,X=g._currentFramebuffer;let n;if(g._bindUnboundFramebuffer(s),g.webGLVersion>1){const s=this._context;var W;if(n=s["COLOR_ATTACHMENT"+c],q.is2DArray||q.is3D)U=U??(null===(W=this.layerIndices)||void 0===W?void 0:W[c])??0,s.framebufferTextureLayer(s.FRAMEBUFFER,n,Q.underlyingResource,J,U);else if(q.isCube){var D;U=U??(null===(D=this.faceIndices)||void 0===D?void 0:D[c])??0,s.framebufferTexture2D(s.FRAMEBUFFER,n,s.TEXTURE_CUBE_MAP_POSITIVE_X+U,Q.underlyingResource,J)}else s.framebufferTexture2D(s.FRAMEBUFFER,n,s.TEXTURE_2D,Q.underlyingResource,J)}else{const q=this._context;n=q["COLOR_ATTACHMENT"+c+"_WEBGL"];const s=void 0!==U?q.TEXTURE_CUBE_MAP_POSITIVE_X+U:q.TEXTURE_2D;q.framebufferTexture2D(q.FRAMEBUFFER,n,s,Q.underlyingResource,J)}if(q._autoMSAAManagement&&this._MSAAFramebuffer){const q=this._context;g._bindUnboundFramebuffer(this._MSAAFramebuffer),q.framebufferRenderbuffer(q.FRAMEBUFFER,n,q.RENDERBUFFER,Q.getMSAARenderBuffer())}g._bindUnboundFramebuffer(X)}setTexture(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(q,c,U),this._bindTextureRenderTarget(q,c)}setLayerAndFaceIndices(q,c){var U;if(super.setLayerAndFaceIndices(q,c),!this.textures||!this.layerIndices||!this.faceIndices)return;const J=(null===(U=this._attachments)||void 0===U?void 0:U.length)??this.textures.length;for(let Q=0;Q<J;Q++){const q=this.textures[Q];q&&(q.is2DArray||q.is3D?this._bindTextureRenderTarget(q,Q,this.layerIndices[Q]):q.isCube?this._bindTextureRenderTarget(q,Q,this.faceIndices[Q]):this._bindTextureRenderTarget(q,Q))}}setLayerAndFaceIndex(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(q,c,U),!this.textures||!this.layerIndices||!this.faceIndices)return;const J=this.textures[q];J.is2DArray||J.is3D?this._bindTextureRenderTarget(this.textures[q],q,this.layerIndices[q]):J.isCube&&this._bindTextureRenderTarget(this.textures[q],q,this.faceIndices[q])}resolveMSAATextures(){const q=this._engine,c=q._currentFramebuffer;q._bindUnboundFramebuffer(this._MSAAFramebuffer),super.resolveMSAATextures(),q._bindUnboundFramebuffer(c)}dispose(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const c=this._context;q||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(c.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(c.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(c.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(q)}}U(11251);s.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(q,c,U){const J=new n(q,c,U,this,this._gl);return this._renderTargetWrapperCache.push(J),J},s.ThinEngine.prototype.createRenderTargetTexture=function(q,c){const U=this._createHardwareRenderTargetWrapper(!1,!1,q);let J,Q,s=!0,g=!1,X=!1,n=1;void 0!==c&&"object"===typeof c&&(s=c.generateDepthBuffer??!0,g=!!c.generateStencilBuffer,X=!!c.noColorAttachment,J=c.colorAttachment,n=c.samples??1,Q=c.label);const W=J||(X?null:this._createInternalTexture(q,c,!0,5)),D=q.width||q,u=q.height||q,K=this._currentFramebuffer,r=this._gl,H=r.createFramebuffer();if(this._bindUnboundFramebuffer(H),U._depthStencilBuffer=this._setupFramebufferDepthAttachments(g,s,D,u),!W||W.is2DArray||W.is3D||r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,W._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(K),U.label=Q??"RenderTargetWrapper",U._framebuffer=H,U._generateDepthBuffer=s,U._generateStencilBuffer=g,U.setTextures(W),J){if(U._samples=J.samples,J.samples>1){const q=J._hardwareTexture.getMSAARenderBuffer(0);U._MSAAFramebuffer=r.createFramebuffer(),this._bindUnboundFramebuffer(U._MSAAFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,q),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(U,n);return U},s.ThinEngine.prototype._createDepthStencilTexture=function(q,c,U){const s=this._gl,g=q.layers||0,n=q.depth||0;let W=s.TEXTURE_2D;0!==g?W=s.TEXTURE_2D_ARRAY:0!==n&&(W=s.TEXTURE_3D);const D=new J.e(this,12);if(D.label=c.label,!this._caps.depthTextureExtension)return Q.c.Error("Depth texture is not supported by your browser or hardware."),D;const u={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...c};if(this._bindTextureDirectly(W,D,!0),this._setupDepthStencilTexture(D,q,0!==u.comparisonFunction&&u.bilinearFiltering,u.comparisonFunction,u.samples),void 0!==u.depthTextureFormat){if(15!==u.depthTextureFormat&&16!==u.depthTextureFormat&&17!==u.depthTextureFormat&&13!==u.depthTextureFormat&&14!==u.depthTextureFormat&&18!==u.depthTextureFormat)return Q.c.Error(`Depth texture ${u.depthTextureFormat} format is not supported.`),D;D.format=u.depthTextureFormat}else D.format=u.generateStencil?13:16;const K=(0,X.e)(D.format),r=this._getWebGLTextureTypeFromDepthTextureFormat(D.format),H=K?s.DEPTH_STENCIL:s.DEPTH_COMPONENT,b=this._getInternalFormatFromDepthTextureFormat(D.format,!0,K);return D.is2DArray?s.texImage3D(W,0,b,D.width,D.height,g,0,H,r,null):D.is3D?s.texImage3D(W,0,b,D.width,D.height,n,0,H,r,null):s.texImage2D(W,0,b,D.width,D.height,0,H,r,null),this._bindTextureDirectly(W,null),this._internalTexturesCache.push(D),U._depthStencilBuffer&&(s.deleteRenderbuffer(U._depthStencilBuffer),U._depthStencilBuffer=null),this._bindUnboundFramebuffer(U._MSAAFramebuffer??U._framebuffer),U._generateStencilBuffer=K,U._depthStencilTextureWithStencil=K,U._depthStencilBuffer=this._setupFramebufferDepthAttachments(U._generateStencilBuffer,U._generateDepthBuffer,U.width,U.height,U.samples,D.format),this._bindUnboundFramebuffer(null),D},s.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(q,c){var U;if(this.webGLVersion<2||!q)return 1;if(q.samples===c)return c;const J=this._gl;c=Math.min(c,this.getCaps().maxMSAASamples),q._depthStencilBuffer&&(J.deleteRenderbuffer(q._depthStencilBuffer),q._depthStencilBuffer=null),q._MSAAFramebuffer&&(J.deleteFramebuffer(q._MSAAFramebuffer),q._MSAAFramebuffer=null);const Q=null===(U=q.texture)||void 0===U?void 0:U._hardwareTexture;if(null===Q||void 0===Q||Q.releaseMSAARenderBuffers(),q.texture&&c>1&&"function"===typeof J.renderbufferStorageMultisample){const U=J.createFramebuffer();if(!U)throw new Error("Unable to create multi sampled framebuffer");q._MSAAFramebuffer=U,this._bindUnboundFramebuffer(q._MSAAFramebuffer);const s=this._createRenderBuffer(q.texture.width,q.texture.height,c,-1,this._getRGBABufferInternalSizedFormat(q.texture.type,q.texture.format,q.texture._useSRGBBuffer),J.COLOR_ATTACHMENT0,!1);if(!s)throw new Error("Unable to create multi sampled framebuffer");null===Q||void 0===Q||Q.addMSAARenderBuffer(s)}this._bindUnboundFramebuffer(q._MSAAFramebuffer??q._framebuffer),q.texture&&(q.texture.samples=c),q._samples=c;const s=q._depthStencilTexture?q._depthStencilTexture.format:void 0;return q._depthStencilBuffer=this._setupFramebufferDepthAttachments(q._generateStencilBuffer,q._generateDepthBuffer,q.width,q.height,c,s),this._bindUnboundFramebuffer(null),c},s.ThinEngine.prototype._setupDepthStencilTexture=function(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=c.width??c,g=c.height??c,X=c.layers||0,n=c.depth||0;q.baseWidth=s,q.baseHeight=g,q.width=s,q.height=g,q.is2DArray=X>0,q.depth=X||n,q.isReady=!0,q.samples=Q,q.generateMipMaps=!1,q.samplingMode=U?2:1,q.type=0,q._comparisonFunction=J;const W=this._gl,D=this._getTextureTarget(q),u=this._getSamplingParameters(q.samplingMode,!1);W.texParameteri(D,W.TEXTURE_MAG_FILTER,u.mag),W.texParameteri(D,W.TEXTURE_MIN_FILTER,u.min),W.texParameteri(D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===J?(W.texParameteri(D,W.TEXTURE_COMPARE_FUNC,515),W.texParameteri(D,W.TEXTURE_COMPARE_MODE,W.NONE)):(W.texParameteri(D,W.TEXTURE_COMPARE_FUNC,J),W.texParameteri(D,W.TEXTURE_COMPARE_MODE,W.COMPARE_REF_TO_TEXTURE)))}},10937:(q,c,U)=>{U.d(c,{c:()=>i,f:()=>t,l:()=>C,h:()=>G,n:()=>S});class J{constructor(){this.children=[]}isValid(q){return!0}process(q,c,U){let J="";if(this.line){let U=this.line;const D=c.processor;if(D){var Q,s,g,X,n,W;D.lineProcessor&&(U=D.lineProcessor(U,c.isFragment,c.processingContext));const J=(null===(Q=c.processor)||void 0===Q?void 0:Q.attributeKeywordName)??"attribute",u=c.isFragment&&null!==(s=c.processor)&&void 0!==s&&s.varyingFragmentKeywordName?null===(g=c.processor)||void 0===g?void 0:g.varyingFragmentKeywordName:!c.isFragment&&null!==(X=c.processor)&&void 0!==X&&X.varyingVertexKeywordName?null===(n=c.processor)||void 0===n?void 0:n.varyingVertexKeywordName:"varying";if(!c.isFragment&&D.attributeProcessor&&this.line.startsWith(J))U=D.attributeProcessor(this.line,q,c.processingContext);else if(D.varyingProcessor&&(null!==(W=D.varyingCheck)&&void 0!==W&&W.call(D,this.line,c.isFragment)||!D.varyingCheck&&this.line.startsWith(u)))U=D.varyingProcessor(this.line,c.isFragment,q,c.processingContext);else if(D.uniformProcessor&&D.uniformRegexp&&D.uniformRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(U=D.uniformProcessor(this.line,c.isFragment,q,c.processingContext));else if(D.uniformBufferProcessor&&D.uniformBufferRegexp&&D.uniformBufferRegexp.test(this.line))c.lookForClosingBracketForUniformBuffer||(U=D.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0);else if(D.textureProcessor&&D.textureRegexp&&D.textureRegexp.test(this.line))U=D.textureProcessor(this.line,c.isFragment,q,c.processingContext);else if((D.uniformProcessor||D.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!c.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?D.uniformProcessor&&(U=D.uniformProcessor(this.line,c.isFragment,q,c.processingContext)):D.uniformBufferProcessor&&(U=D.uniformBufferProcessor(this.line,c.isFragment,c.processingContext),c.lookForClosingBracketForUniformBuffer=!0)}c.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(c.lookForClosingBracketForUniformBuffer=!1,D.endOfUniformBufferProcessor&&(U=D.endOfUniformBufferProcessor(this.line,c.isFragment,c.processingContext)))}J+=U+"\n"}for(const D of this.children)J+=D.process(q,c,U);return this.additionalDefineKey&&(q[this.additionalDefineKey]=this.additionalDefineValue||"true",U[this.additionalDefineKey]=q[this.additionalDefineKey]),J}}class Q{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(q){this._lines.length=0;for(const c of q){if(!c||"\r"===c)continue;if("#"===c[0]){this._lines.push(c);continue}const q=c.trim();if(!q)continue;if(q.startsWith("//")){this._lines.push(c);continue}const U=q.indexOf(";");if(-1===U)this._lines.push(q);else if(U===q.length-1)q.length>1&&this._lines.push(q);else{const q=c.split(";");for(let c=0;c<q.length;c++){let U=q[c];U&&(U=U.trim(),U&&this._lines.push(U+(c!==q.length-1?";":"")))}}}}}class s extends J{process(q,c,U){for(let J=0;J<this.children.length;J++){const Q=this.children[J];if(Q.isValid(q))return Q.process(q,c,U)}return""}}class g extends J{isValid(q){return this.testExpression.isTrue(q)}}class X{isTrue(q){return!0}static postfixToInfix(q){const c=[];for(const U of q)if(void 0===X._OperatorPriority[U])c.push(U);else{const q=c[c.length-1],J=c[c.length-2];c.length-=2,c.push(`(${J}${U}${q})`)}return c[c.length-1]}static infixToPostfix(q){const c=X._InfixToPostfixCache.get(q);if(c)return c.accessTime=Date.now(),c.result;if(!q.includes("&&")&&!q.includes("||")&&!q.includes(")")&&!q.includes("("))return[q];const U=[];let J=-1;const Q=()=>{D=D.trim(),""!==D&&(U.push(D),D="")},s=q=>{J<X._Stack.length-1&&(X._Stack[++J]=q)},g=()=>X._Stack[J],n=()=>-1===J?"!!INVALID EXPRESSION!!":X._Stack[J--];let W=0,D="";for(;W<q.length;){const c=q.charAt(W),u=W<q.length-1?q.substring(W,2+W):"";if("("===c)D="",s(c);else if(")"===c){for(Q();-1!==J&&"("!==g();)U.push(n());n()}else if(X._OperatorPriority[u]>1){for(Q();-1!==J&&X._OperatorPriority[g()]>=X._OperatorPriority[u];)U.push(n());s(u),W++}else D+=c;W++}for(Q();-1!==J;)"("===g()?n():U.push(n());return X._InfixToPostfixCache.size>=X.InfixToPostfixCacheLimitSize&&X.ClearCache(),X._InfixToPostfixCache.set(q,{result:U,accessTime:Date.now()}),U}static ClearCache(){const q=Array.from(X._InfixToPostfixCache.entries()).sort(((q,c)=>q[1].accessTime-c[1].accessTime));for(let c=0;c<X.InfixToPostfixCacheCleanupSize;c++)X._InfixToPostfixCache.delete(q[c][0])}}X.InfixToPostfixCacheLimitSize=5e4,X.InfixToPostfixCacheCleanupSize=25e3,X._InfixToPostfixCache=new Map,X._OperatorPriority={")":0,"(":1,"||":2,"&&":3},X._Stack=["","","","","","","","","","","","","","","","","","","",""];class n extends X{constructor(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=q,this.not=c}isTrue(q){let c=void 0!==q[this.define];return this.not&&(c=!c),c}}class W extends X{isTrue(q){return this.leftOperand.isTrue(q)||this.rightOperand.isTrue(q)}}class D extends X{isTrue(q){return this.leftOperand.isTrue(q)&&this.rightOperand.isTrue(q)}}class u extends X{constructor(q,c,U){super(),this.define=q,this.operand=c,this.testValue=U}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(q){let c=!1;const U=parseInt(void 0!=q[this.define]?q[this.define]:this.define),J=parseInt(void 0!=q[this.testValue]?q[this.testValue]:this.testValue);if(isNaN(U)||isNaN(J))return!1;switch(this.operand){case">":c=U>J;break;case"<":c=U<J;break;case"<=":c=U<=J;break;case">=":c=U>=J;break;case"==":c=U===J;break;case"!=":c=U!==J}return c}}var K=U(10910),r=U(10940);const H=/defined\s*?\((.+?)\)/g,b=/defined\s*?\[(.+?)\]/g,h=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=/__decl__/,a=/light\{X\}.(\w*)/g,p=/\{X\}/g,R=[],I=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function t(q){q.processor&&q.processor.initializeShaders&&q.processor.initializeShaders(q.processingContext)}function C(q,c,U,J){var Q;null!==(Q=c.processor)&&void 0!==Q&&Q.preProcessShaderCode&&(q=c.processor.preProcessShaderCode(q,c.isFragment)),G(q,c,(q=>{c.processCodeAfterIncludes&&(q=c.processCodeAfterIncludes(c.isFragment?"fragment":"vertex",q,c.defines));const Q=function(q,c,U){let J=function(q,c){var U;if(null!==(U=c.processor)&&void 0!==U&&U.noPrecision)return q;const J=c.shouldUseHighPrecisionShader;-1===q.indexOf("precision highp float")?q=J?"precision highp float;\n"+q:"precision mediump float;\n"+q:J||(q=q.replace("precision highp float","precision mediump float"));return q}(q,c);if(!c.processor)return J;if(0===c.processor.shaderLanguage&&-1!==J.indexOf("#version 3")&&(J=J.replace("#version 300 es",""),!c.processor.parseGLES3))return J;const Q=c.defines,s=O(c,U);c.processor.preProcessor&&(J=c.processor.preProcessor(J,Q,s,c.isFragment,c.processingContext));const g={};J=V(J,s,c,g),c.processor.postProcessor&&(J=c.processor.postProcessor(J,Q,c.isFragment,c.processingContext,U?{drawBuffersExtensionDisabled:!U.getCaps().drawBuffersExtension}:{},s,g));null!==U&&void 0!==U&&U._features.needShaderCodeInlining&&(J=U.inlineShaderCode(J));return J}(q,c,J);U(Q,q)}))}function i(q,c,U){return U.processor&&U.processor.finalizeShaders?U.processor.finalizeShaders(q,c,U.processingContext):{vertexCode:q,fragmentCode:c}}function F(q){const c=/defined\((.+)\)/.exec(q);if(c&&c.length)return new n(c[1].trim(),"!"===q[0]);const U=["==","!=",">=","<=","<",">"];let J="",Q=0;for(J of U)if(Q=q.indexOf(J),Q>-1)break;if(-1===Q)return new n(q);const s=q.substring(0,Q).trim(),g=q.substring(Q+J.length).trim();return new u(s,J,g)}function v(q,c){const U=new g,J=q.substring(0,c);let Q=q.substring(c);return Q=Q.substring(0,(Q.indexOf("//")+1||Q.length+1)-1).trim(),U.testExpression="#ifdef"===J?new n(Q):"#ifndef"===J?new n(Q,!0):function(q){q=q.replace(H,"defined[$1]");const c=X.infixToPostfix(q),U=[];for(const Q of c)if("||"!==Q&&"&&"!==Q)U.push(Q);else if(U.length>=2){let q=U[U.length-1],c=U[U.length-2];U.length-=2;const J="&&"==Q?new D:new W;"string"===typeof q&&(q=q.replace(b,"defined($1)")),"string"===typeof c&&(c=c.replace(b,"defined($1)")),J.leftOperand="string"===typeof c?F(c):c,J.rightOperand="string"===typeof q?F(q):q,U.push(J)}let J=U[U.length-1];return"string"===typeof J&&(J=J.replace(b,"defined($1)")),"string"===typeof J?F(J):J}(Q),U}function Y(q,c,U,Q){let s=q.currentLine;for(;k(q,U,Q);){s=q.currentLine;const g=s.substring(0,5).toLowerCase();if("#else"===g){const U=new J;return c.children.push(U),void k(q,U,Q)}if("#elif"===g){const q=v(s,5);c.children.push(q),U=q}}}function k(q,c,U){for(;q.canRead;){q.lineIndex++;const Q=q.currentLine;if(Q.indexOf("#")>=0){const J=I.exec(Q);if(J&&J.length){switch(J[0]){case"#ifdef":{const J=new s;c.children.push(J);const g=v(Q,6);J.children.push(g),Y(q,J,g,U);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const J=new s;c.children.push(J);const g=v(Q,7);J.children.push(g),Y(q,J,g,U);break}case"#if":{const J=new s,g=v(Q,3);c.children.push(J),J.children.push(g),Y(q,J,g,U);break}}continue}}const g=new J;if(g.line=Q,c.children.push(g),"#"===Q[0]&&"d"===Q[1]){const q=Q.replace(";","").split(" ");g.additionalDefineKey=q[1],3===q.length&&(g.additionalDefineValue=q[2])}}return!1}function V(q,c,U,s){const g=new J,X=new Q;return X.lineIndex=-1,X.lines=q.split("\n"),k(X,g,s),g.process(c,U,s)}function O(q,c){var U;const J=q.defines,Q={};for(const s of J){const q=s.replace("#define","").replace(";","").trim().split(" ");Q[q[0]]=q.length>1?q[1]:""}return 0===(null===(U=q.processor)||void 0===U?void 0:U.shaderLanguage)&&(Q.GL_ES="true"),Q.__VERSION__=q.version,Q[q.platformName]="true",(0,r.l)(Q,null===c||void 0===c?void 0:c.isNDCHalfZRange,null===c||void 0===c?void 0:c.useReverseDepthBuffer,null===c||void 0===c?void 0:c.useExactSrgbConversions),Q}function G(q,c,U){let J;for(R.length=0;null!==(J=h.exec(q));)R.push(J);let Q=String(q),s=[q],g=!1;for(const X of R){let q=X[1];if(-1!==q.indexOf("__decl__")&&(q=q.replace(o,""),c.supportsUniformBuffers&&(q=q.replace("Vertex","Ubo").replace("Fragment","Ubo")),q+="Declaration"),!c.includesShadersStore[q]){const J=c.shadersRepository+"ShadersInclude/"+q+".fx";return void S.loadFile(J,(J=>{c.includesShadersStore[q]=J,G(s.join(""),c,U)}))}{let U=c.includesShadersStore[q];if(X[2]){const q=X[3].split(",");for(let c=0;c<q.length;c+=2){const J=new RegExp(q[c],"g"),Q=q[c+1];U=U.replace(J,Q)}}if(X[4]){const q=X[5];if(-1!==q.indexOf("..")){const J=q.split(".."),Q=parseInt(J[0]);let s=parseInt(J[1]),g=U.slice(0);U="",isNaN(s)&&(s=c.indexParameters[J[1]]);for(let q=Q;q<s;q++)c.supportsUniformBuffers||(g=g.replace(a,((q,c)=>c+"{X}"))),U+=g.replace(p,q.toString())+"\n"}else c.supportsUniformBuffers||(U=U.replace(a,((q,c)=>c+"{X}"))),U=U.replace(p,q)}const J=[];for(const q of s){const c=q.split(X[0]);for(let q=0;q<c.length-1;q++)J.push(c[q]),J.push(U);J.push(c[c.length-1])}s=J,g=g||U.indexOf("#include<")>=0||U.indexOf("#include <")>=0}}R.length=0,Q=s.join(""),g?G(Q.toString(),c,U):U(Q)}const S={loadFile:(q,c,U,J,Q,s)=>{throw(0,K.d)("FileTools")}}},11210:(q,c,U)=>{U.d(c,{e:()=>J});class J{get underlyingResource(){return this._webGLTexture}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=c,!q&&(q=c.createTexture(),!q))throw new Error("Unable to create webGL texture");this.set(q)}setUsage(){}set(q){this._webGLTexture=q}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(q){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(q)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const q of this._MSAARenderBuffers)this._context.deleteRenderbuffer(q);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var q;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(q=this._MSAARenderBuffers)||void 0===q?void 0:q[c])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10940:(q,c,U)=>{U.d(c,{d:()=>Q,h:()=>s,l:()=>X,p:()=>g,t:()=>n});var J=U(10910);U(10881);const Q={};function s(q,c){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(c?c+"\n":"")+q}function g(q,c,U,s,g,X,n){const W=n||Q.loadFile;if(W){return W(q,c,U,s,g,X)}throw(0,J.d)("FileTools")}function X(q,c,U,J){if(q)return c?q.IS_NDC_HALF_ZRANGE="":delete q.IS_NDC_HALF_ZRANGE,U?q.USE_REVERSE_DEPTHBUFFER="":delete q.USE_REVERSE_DEPTHBUFFER,void(J?q.USE_EXACT_SRGB_CONVERSIONS="":delete q.USE_EXACT_SRGB_CONVERSIONS);{let q="";return c&&(q+="#define IS_NDC_HALF_ZRANGE"),U&&(q&&(q+="\n"),q+="#define USE_REVERSE_DEPTHBUFFER"),J&&(q&&(q+="\n"),q+="#define USE_EXACT_SRGB_CONVERSIONS"),q}}function n(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;switch(q){case 3:{const q=(ArrayBuffer,new Int8Array(c));return J&&q.set(new Int8Array(J)),q}case 0:{const q=(ArrayBuffer,new Uint8Array(c));return J&&q.set(new Uint8Array(J)),q}case 4:{const q=c instanceof ArrayBuffer?new Int16Array(c):new Int16Array(U?c/2:c);return J&&q.set(new Int16Array(J)),q}case 5:case 8:case 9:case 10:case 2:{const q=c instanceof ArrayBuffer?new Uint16Array(c):new Uint16Array(U?c/2:c);return J&&q.set(new Uint16Array(J)),q}case 6:{const q=c instanceof ArrayBuffer?new Int32Array(c):new Int32Array(U?c/4:c);return J&&q.set(new Int32Array(J)),q}case 7:case 11:case 12:case 13:case 14:case 15:{const q=c instanceof ArrayBuffer?new Uint32Array(c):new Uint32Array(U?c/4:c);return J&&q.set(new Uint32Array(J)),q}case 1:{const q=c instanceof ArrayBuffer?new Float32Array(c):new Float32Array(U?c/4:c);return J&&q.set(new Float32Array(J)),q}}const Q=(ArrayBuffer,new Uint8Array(c));return J&&Q.set(new Uint8Array(J)),Q}},10954:(q,c,U)=>{U.d(c,{d:()=>p});var J=U(10864),Q=U(10886),s=U(10956),g=U(10857),X=U(10902);class n{constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,q&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(q){this._zOffset!==q&&(this._zOffset=q,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(q){this._zOffsetUnits!==q&&(this._zOffsetUnits=q,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(q){this._cullFace!==q&&(this._cullFace=q,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(q){this._cull!==q&&(this._cull=q,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(q){this._depthFunc!==q&&(this._depthFunc=q,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(q){this._depthMask!==q&&(this._depthMask=q,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(q){this._depthTest!==q&&(this._depthTest=q,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(q){this._frontFace!==q&&(this._frontFace=q,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(q){this.isDirty&&(this._isCullDirty&&(this.cull?q.enable(q.CULL_FACE):q.disable(q.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(q.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(q.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?q.enable(q.DEPTH_TEST):q.disable(q.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(q.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(q.enable(q.POLYGON_OFFSET_FILL),q.polygonOffset(this.zOffset,this.zOffsetUnits)):q.disable(q.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(q.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class W{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(q){this._func!==q&&(this._func=q,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(q){this._funcRef!==q&&(this._funcRef=q,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(q){this._funcMask!==q&&(this._funcMask=q,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(q){this._opStencilFail!==q&&(this._opStencilFail=q,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(q){this._opDepthFail!==q&&(this._opDepthFail=q,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(q){this._opStencilDepthPass!==q&&(this._opStencilDepthPass=q,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(q){this._mask!==q&&(this._mask=q,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(q){this._enabled!==q&&(this._enabled=q,this._isStencilTestDirty=!0)}constructor(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,q&&this.reset()}reset(){var q;this.stencilMaterial=void 0,null===(q=this.stencilGlobal)||void 0===q||q.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(q){var c;if(!q)return;const U=!this.useStencilGlobalOnly&&!(null===(c=this.stencilMaterial)||void 0===c||!c.enabled);this.enabled=U?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=U?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=U?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=U?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=U?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=U?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=U?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=U?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?q.enable(q.STENCIL_TEST):q.disable(q.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(q.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(q.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(q.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class D{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=D.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=D.KEEP,this.opDepthFail=D.KEEP,this.opStencilDepthPass=D.REPLACE}get stencilFunc(){return this.func}set stencilFunc(q){this.func=q}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(q){this.funcRef=q}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(q){this.funcMask=q}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(q){this.opStencilFail=q}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(q){this.opDepthFail=q}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(q){this.opStencilDepthPass=q}get stencilMask(){return this.mask}set stencilMask(q){this.mask=q}get stencilTest(){return this.enabled}set stencilTest(q){this.enabled=q}}D.ALWAYS=519,D.KEEP=7680,D.REPLACE=7681;class u{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(q){this._alphaBlend!==q&&(this._alphaBlend=q,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(q,c,U,J){this._blendConstants[0]===q&&this._blendConstants[1]===c&&this._blendConstants[2]===U&&this._blendConstants[3]===J||(this._blendConstants[0]=q,this._blendConstants[1]=c,this._blendConstants[2]=U,this._blendConstants[3]=J,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(q,c,U,J){this._blendFunctionParameters[0]===q&&this._blendFunctionParameters[1]===c&&this._blendFunctionParameters[2]===U&&this._blendFunctionParameters[3]===J||(this._blendFunctionParameters[0]=q,this._blendFunctionParameters[1]=c,this._blendFunctionParameters[2]=U,this._blendFunctionParameters[3]=J,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(q,c){this._blendEquationParameters[0]===q&&this._blendEquationParameters[1]===c||(this._blendEquationParameters[0]=q,this._blendEquationParameters[1]=c,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(q){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?q.enable(q.BLEND):q.disable(q.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(q.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(q.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(q.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var K=U(10910),r=U(10976),H=U(10881),b=U(10866),h=U(10940),o=U(10988);function a(q,c){if((0,H.j)()){const{requestAnimationFrame:U}=c||window;if("function"===typeof U)return U(q)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(q);return setTimeout(q,16)}class p{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(q){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(q){q!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=q,this._depthCullingState.depthFunc=q?518:515)}setColorWrite(q){q!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=q)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(q){if(q)return this.isNDCHalfZRange?q.IS_NDC_HALF_ZRANGE="":delete q.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?q.USE_REVERSE_DEPTHBUFFER="":delete q.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?q.USE_EXACT_SRGB_CONVERSIONS="":delete q.USE_EXACT_SRGB_CONVERSIONS);{let q="";return this.isNDCHalfZRange&&(q+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(q&&(q+="\n"),q+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(q&&(q+="\n"),q+="#define USE_EXACT_SRGB_CONVERSIONS"),q}}_rebuildInternalTextures(){const q=this._internalTexturesCache.slice();for(const c of q)c._rebuild()}_rebuildRenderTargetWrappers(){const q=this._renderTargetWrapperCache.slice();for(const c of q)c._rebuild()}_rebuildEffects(){for(const q in this._compiledEffects){const c=this._compiledEffects[q];c._pipelineContext=null,c._prepareEffect()}s.b.ResetCache()}_rebuildGraphicsResources(){var q;this.wipeCaches(!0),this._rebuildEffects(),null===(q=this._rebuildComputeEffects)||void 0===q||q.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){Q.c.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(q){setTimeout((()=>{this._clearEmptyResources();const c=this._depthCullingState.depthTest,U=this._depthCullingState.depthFunc,J=this._depthCullingState.depthMask,Q=this._stencilState.stencilTest;q(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=c,this._depthCullingState.depthFunc=U,this._depthCullingState.depthMask=J,this._stencilState.stencilTest=Q,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(q){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(q){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const q=new Uint8Array(4),c=[q,q,q,q,q,q];this._emptyCubeTexture=this.createRawCubeTexture(c,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(q){if(!q)return this._activeRenderLoops.length=0,void this._cancelFrame();const c=this._activeRenderLoops.indexOf(q);c>=0&&(this._activeRenderLoops.splice(c,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const q=this._frameHandler;if(this._frameHandler=0,(0,H.j)()){const{cancelAnimationFrame:c}=this.getHostWindow()||window;if("function"===typeof c)return c(q)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(q);return clearTimeout(q)}}Bu(){this.onBeginFrameObservable.notifyObservers(this)}Nu(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}get maxFPS(){return this._maxFPS}set maxFPS(q){this._maxFPS=q,void 0!==q&&(this._minFrameTime=q<=0?Number.MAX_VALUE:1e3/q)}_isOverFrameTime(q){if(!q||void 0===this._maxFPS)return!1;const c=q-this._lastFrameTime;return this._lastFrameTime=q,this._renderAccumulator+=c,this._renderAccumulator<this._minFrameTime||(this._renderAccumulator-=this._minFrameTime,this._renderAccumulator>this._minFrameTime&&(this._renderAccumulator=this._minFrameTime),!1)}_processFrame(q){if(this._frameHandler=0,!this._contextWasLost&&!this._isOverFrameTime(q)){let q=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(q=!1),q&&(this.Bu(),this.skipFrameRender||this._renderViews()||this._renderFrame(),this.Nu())}}_renderLoop(q){this._processFrame(q),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let q=0;q<this._activeRenderLoops.length;q++){(0,this._activeRenderLoops[q])()}}_renderViews(){return!1}_queueNewFrame(q,c){return a(q,c)}runRenderLoop(q){-1===this._activeRenderLoops.indexOf(q)&&(this._activeRenderLoops.push(q),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(q){this._depthCullingState.depthTest=q}setZOffset(q){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-q:q}getZOffset(){const q=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-q:q}setZOffsetUnits(q){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-q:q}getZOffsetUnits(){const q=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-q:q}getHostWindow(){return(0,H.j)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(q){this._compatibilityMode=!0}_rebuildTextures(){for(const q of this.scenes)q._rebuildTextures();for(const q of this._virtualScenes)q._rebuildTextures()}_releaseRenderTargetWrapper(q){const c=this._renderTargetWrapperCache.indexOf(q);-1!==c&&this._renderTargetWrapperCache.splice(c,1)}get currentViewport(){return this._cachedViewport}setViewport(q,c,U){const J=c||this.getRenderWidth(),Q=U||this.getRenderHeight(),s=q.x||0,g=q.y||0;this._cachedViewport=q,this._viewport(s*J,g*Q,J*q.width,Q*q.height)}createCanvasImage(){return document.createElement("img")}createCanvasPath2D(q){return new Path2D(q)}get description(){let q=this.name+this.version;return this._caps.parallelShaderCompile&&(q+=" - Parallel shader compilation"),q}_createTextureBase(q,c,U,s){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7?arguments[7]:void 0,D=arguments.length>8?arguments[8]:void 0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,K=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,b=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,h=arguments.length>13?arguments[13]:void 0,a=arguments.length>14?arguments[14]:void 0,R=arguments.length>15?arguments[15]:void 0;const I="data:"===(q=q||"").substring(0,5),t="blob:"===q.substring(0,5),C=I&&-1!==q.indexOf(";base64,"),i=K||new r.e(this,1);i!==K&&(i.label=q.substring(0,60));const F=q;!this._transformTextureUrl||C||K||u||(q=this._transformTextureUrl(q)),F!==q&&(i._originalUrl=F);const v=q.lastIndexOf(".");let Y=b||(v>-1?q.substring(v).toLowerCase():"");Y.indexOf("?")>-1&&(Y=Y.split("?")[0]);const k=(0,o.c)(Y,h);s&&s.addPendingData(i),i.url=q,i.generateMipMaps=!c,i.samplingMode=g,i.invertY=U,i._useSRGBBuffer=this._getUseSRGBBuffer(!!R,c),this._doNotHandleContextLost||(i._buffer=u);let V=null;X&&!K&&(V=i.onLoadedObservable.add(X)),K||this._internalTexturesCache.push(i);const O=(U,K)=>{s&&s.removePendingData(i),q===F?(V&&i.onLoadedObservable.remove(V),J.c.UseFallbackTexture&&q!==J.c.FallbackTexture&&this._createTextureBase(J.c.FallbackTexture,c,i.invertY,s,g,null,n,W,D,u,i),U=(U||"Unknown error")+(J.c.UseFallbackTexture?" - Fallback texture was used":""),i.onErrorObservable.notifyObservers({message:U,exception:K}),n&&n(U,K)):(Q.c.Warn(`Failed to load ${q}, falling back to ${F}`),this._createTextureBase(F,c,i.invertY,s,g,X,n,W,D,u,i,H,b,h,a,R))};if(k){const c=async q=>{(await k).loadData(q,i,((q,c,U,J,Q,X)=>{X?O("TextureLoader failed to load data"):W(i,Y,s,{width:q,height:c},i.invertY,!U,J,(()=>(Q(),!1)),g)}),a)};u?u instanceof ArrayBuffer?c(new Uint8Array(u)):ArrayBuffer.isView(u)?c(u):n&&n("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(q,(q=>{c(new Uint8Array(q))}),void 0,s?s.offlineProvider:void 0,!0,((q,c)=>{O("Unable to load "+(q&&q.responseURL,c))}))}else{const U=q=>{t&&!this._doNotHandleContextLost&&(i._buffer=q),W(i,Y,s,q,i.invertY,c,!1,D,g)};!I||C?u&&("string"===typeof u.decoding||u.close)?U(u):p._FileToolsLoadImage(q||"",U,O,s?s.offlineProvider:null,h,i.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):"string"===typeof u||u instanceof ArrayBuffer||ArrayBuffer.isView(u)||u instanceof Blob?p._FileToolsLoadImage(u,U,O,s?s.offlineProvider:null,h,i.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0,this):u&&U(u)}return i}_rebuildBuffers(){for(const q of this._uniformBuffers)q._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,H.c)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const q in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,q)&&(this._boundTexturesCache[q]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(q){this._name=q}static get NpmPackage(){return"babylonjs@8.13.0"}static get Version(){return"8.13.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(q){this._hardwareScalingLevel=q,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(q){this._doNotHandleContextLost=q}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(q,c,U){var Q,s;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new n,this._stencilStateComposer=new W,this._stencilState=new D,this._alphaState=new u,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new b.e,this.onCanvasFocusObservable=new b.e,this.onNewSceneAddedObservable=new b.e,this.onResizeObservable=new b.e,this.onCanvasPointerOutObservable=new b.e,this.onEffectErrorObservable=new b.e,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new b.e,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=q=>this._renderLoop(q),this._lastFrameTime=0,this._renderAccumulator=0,this.skipFrameRender=!1,this.onBeforeShaderCompilationObservable=new b.e,this.onAfterShaderCompilationObservable=new b.e,this.onBeginFrameObservable=new b.e,this.onEndFrameObservable=new b.e,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new b.e,this.onContextRestoredObservable=new b.e,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.Cc=new b.e,this.onReleaseEffectsObservable=new b.e,J.c.Instances.push(this),this.startTime=X.d.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,g.d.SetMatrixPrecision(!!c.useHighPrecisionMatrix),(0,H.g)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=U??!1,c.antialias=q??c.antialias,c.deterministicLockstep=c.deterministicLockstep??!1,c.lockstepMaxSteps=c.lockstepMaxSteps??4,c.timeStep=c.timeStep??1/60,c.stencil=c.stencil??!0,this._audioContext=(null===(Q=c.audioEngineOptions)||void 0===Q?void 0:Q.audioContext)??null,this._audioDestination=(null===(s=c.audioEngineOptions)||void 0===s?void 0:s.audioDestination)??null,this.premultipliedAlpha=c.premultipliedAlpha??!0,this._doNotHandleContextLost=!!c.doNotHandleContextLost,this._isStencilEnable=!!c.stencil,this.useExactSrgbConversions=c.useExactSrgbConversions??!1;const K=(0,H.j)()&&window.devicePixelRatio||1,r=c.limitDeviceRatio||K;U=U||c.adaptToDeviceRatio||!1,this._hardwareScalingLevel=U?1/Math.min(r,K):1,this._lastDevicePixelRatio=K,this._creationOptions=c}resize(){let q,c,U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const q=(0,H.j)()&&window.devicePixelRatio||1,c=this._lastDevicePixelRatio/q;this._lastDevicePixelRatio=q,this._hardwareScalingLevel*=c}if((0,H.j)()&&(0,H.c)())if(this._renderingCanvas){var J,Q;const U=null===(J=(Q=this._renderingCanvas).getBoundingClientRect)||void 0===J?void 0:J.call(Q);q=this._renderingCanvas.clientWidth||(null===U||void 0===U?void 0:U.width)||this._renderingCanvas.width*this._hardwareScalingLevel||100,c=this._renderingCanvas.clientHeight||(null===U||void 0===U?void 0:U.height)||this._renderingCanvas.height*this._hardwareScalingLevel||100}else q=window.innerWidth,c=window.innerHeight;else q=this._renderingCanvas?this._renderingCanvas.width:100,c=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(q/this._hardwareScalingLevel,c/this._hardwareScalingLevel,U)}setSize(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(q|=0,c|=0,!U&&this._renderingCanvas.width===q&&this._renderingCanvas.height===c)return!1;if(this._renderingCanvas.width=q,this._renderingCanvas.height=c,this.scenes){for(let q=0;q<this.scenes.length;q++){const c=this.scenes[q];for(let q=0;q<c.cameras.length;q++){c.cameras[q]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(q,c,U,J,Q,s,g,X,n,W,D){throw(0,K.d)("engine.rawTexture")}createRawCubeTexture(q,c,U,J,Q,s,g,X){throw(0,K.d)("engine.rawTexture")}createRawTexture3D(q,c,U,J,Q,s,g,X,n,W,D){throw(0,K.d)("engine.rawTexture")}createRawTexture2DArray(q,c,U,J,Q,s,g,X,n,W,D){throw(0,K.d)("engine.rawTexture")}_sharedInit(q){this._renderingCanvas=q}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const q=navigator.userAgent;this.hostInformation.isMobile=-1!==q.indexOf("Mobile")||-1!==q.indexOf("Mac")&&(0,H.c)()&&"ontouchend"in document},this._checkForMobile(),(0,H.j)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(q){return document.createElement("video")}_reportDrawCall(){var q;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(q=this._drawCalls)||void 0===q||q.addCount(c,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(q,c){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(q,c){return createImageBitmap(q,c)}resizeImageBitmap(q,c,U){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(q){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(q,c){if("undefined"===typeof document)return new OffscreenCanvas(q,c);const U=document.createElement("canvas");return U.width=q,U.height=c,U}createCanvas(q,c){return p._CreateCanvas(q,c)}static _FileToolsLoadImage(q,c,U,J,Q,s,g){throw(0,K.d)("FileTools")}_loadFile(q,c,U,J,Q,s){const g=(0,h.p)(q,c,U,J,Q,s);return this._activeRequests.push(g),g.onCompleteObservable.add((()=>{const q=this._activeRequests.indexOf(g);-1!==q&&this._activeRequests.splice(q,1)})),g}static _FileToolsLoadFile(q,c,U,J,Q,s){if(h.d.loadFile)return h.d.loadFile(q,c,U,J,Q,s);throw(0,K.d)("FileTools")}dispose(){var q;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(q=this.releaseComputeEffects)||void 0===q||q.call(this),s.b.ResetCache();for(const U of this._activeRequests)U.abort();this._boundRenderFunction=null,this.Cc.notifyObservers(this),this.Cc.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),this.onEffectErrorObservable.clear(),(0,H.j)()&&window.removeEventListener("resize",this._checkForMobile);const c=J.c.Instances.indexOf(this);c>=0&&J.c.Instances.splice(c,1),J.c.Instances.length||(J.c.OnEnginesDisposedObservable.notifyObservers(this),J.c.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(q){throw(0,K.d)("LoadingScreen")}static MarkAllMaterialsAsDirty(q,c){for(let U=0;U<J.c.Instances.length;U++){const Q=J.c.Instances[U];for(let U=0;U<Q.scenes.length;U++)Q.scenes[U].markAllMaterialsAsDirty(q,c)}}}p._RenderPassIdCounter=0,p._RescalePostProcessFactory=null,p.CollisionsEpsilon=.001,p.QueueNewFrame=a},11328:(q,c,U)=>{U.d(c,{c:()=>J});class J{}J.AUTOSAMPLERSUFFIX="Sampler",J.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",J.ALPHA_DISABLE=0,J.ALPHA_ADD=1,J.ALPHA_COMBINE=2,J.ALPHA_SUBTRACT=3,J.ALPHA_MULTIPLY=4,J.ALPHA_MAXIMIZED=5,J.ALPHA_ONEONE=6,J.ALPHA_PREMULTIPLIED=7,J.ALPHA_PREMULTIPLIED_PORTERDUFF=8,J.ALPHA_INTERPOLATE=9,J.ALPHA_SCREENMODE=10,J.ALPHA_ONEONE_ONEONE=11,J.ALPHA_ALPHATOCOLOR=12,J.ALPHA_REVERSEONEMINUS=13,J.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,J.ALPHA_ONEONE_ONEZERO=15,J.ALPHA_EXCLUSION=16,J.ALPHA_LAYER_ACCUMULATE=17,J.ALPHA_EQUATION_ADD=0,J.ALPHA_EQUATION_SUBSTRACT=1,J.ALPHA_EQUATION_REVERSE_SUBTRACT=2,J.ALPHA_EQUATION_MAX=3,J.ALPHA_EQUATION_MIN=4,J.ALPHA_EQUATION_DARKEN=5,J.DELAYLOADSTATE_NONE=0,J.DELAYLOADSTATE_LOADED=1,J.DELAYLOADSTATE_LOADING=2,J.DELAYLOADSTATE_NOTLOADED=4,J.NEVER=512,J.ALWAYS=519,J.LESS=513,J.EQUAL=514,J.LEQUAL=515,J.GREATER=516,J.GEQUAL=518,J.NOTEQUAL=517,J.KEEP=7680,J.ZERO=0,J.REPLACE=7681,J.INCR=7682,J.DECR=7683,J.INVERT=5386,J.INCR_WRAP=34055,J.DECR_WRAP=34056,J.TEXTURE_CLAMP_ADDRESSMODE=0,J.TEXTURE_WRAP_ADDRESSMODE=1,J.TEXTURE_MIRROR_ADDRESSMODE=2,J.TEXTURE_CREATIONFLAG_STORAGE=1,J.TEXTUREFORMAT_ALPHA=0,J.TEXTUREFORMAT_LUMINANCE=1,J.TEXTUREFORMAT_LUMINANCE_ALPHA=2,J.TEXTUREFORMAT_RGB=4,J.TEXTUREFORMAT_RGBA=5,J.TEXTUREFORMAT_RED=6,J.TEXTUREFORMAT_R=6,J.TEXTUREFORMAT_R16_UNORM=33322,J.TEXTUREFORMAT_RG16_UNORM=33324,J.TEXTUREFORMAT_RGB16_UNORM=32852,J.TEXTUREFORMAT_RGBA16_UNORM=32859,J.TEXTUREFORMAT_R16_SNORM=36760,J.TEXTUREFORMAT_RG16_SNORM=36761,J.TEXTUREFORMAT_RGB16_SNORM=36762,J.TEXTUREFORMAT_RGBA16_SNORM=36763,J.TEXTUREFORMAT_RG=7,J.TEXTUREFORMAT_RED_INTEGER=8,J.TEXTUREFORMAT_R_INTEGER=8,J.TEXTUREFORMAT_RG_INTEGER=9,J.TEXTUREFORMAT_RGB_INTEGER=10,J.TEXTUREFORMAT_RGBA_INTEGER=11,J.TEXTUREFORMAT_BGRA=12,J.TEXTUREFORMAT_DEPTH24_STENCIL8=13,J.TEXTUREFORMAT_DEPTH32_FLOAT=14,J.TEXTUREFORMAT_DEPTH16=15,J.TEXTUREFORMAT_DEPTH24=16,J.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,J.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,J.TEXTUREFORMAT_STENCIL8=19,J.TEXTUREFORMAT_UNDEFINED=4294967295,J.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,J.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,J.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,J.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,J.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,J.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,J.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,J.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,J.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,J.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,J.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,J.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,J.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,J.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,J.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,J.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,J.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,J.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,J.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,J.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,J.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,J.TEXTURETYPE_UNSIGNED_BYTE=0,J.TEXTURETYPE_UNSIGNED_INT=0,J.TEXTURETYPE_FLOAT=1,J.TEXTURETYPE_HALF_FLOAT=2,J.TEXTURETYPE_BYTE=3,J.TEXTURETYPE_SHORT=4,J.TEXTURETYPE_UNSIGNED_SHORT=5,J.TEXTURETYPE_INT=6,J.TEXTURETYPE_UNSIGNED_INTEGER=7,J.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,J.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,J.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,J.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,J.TEXTURETYPE_UNSIGNED_INT_24_8=12,J.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,J.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,J.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,J.TEXTURETYPE_UNDEFINED=16,J.TEXTURE_2D=3553,J.TEXTURE_2D_ARRAY=35866,J.TEXTURE_CUBE_MAP=34067,J.TEXTURE_CUBE_MAP_ARRAY=3735928559,J.TEXTURE_3D=32879,J.TEXTURE_NEAREST_SAMPLINGMODE=1,J.TEXTURE_NEAREST_NEAREST=1,J.TEXTURE_BILINEAR_SAMPLINGMODE=2,J.TEXTURE_LINEAR_LINEAR=2,J.TEXTURE_TRILINEAR_SAMPLINGMODE=3,J.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,J.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,J.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,J.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,J.TEXTURE_NEAREST_LINEAR=7,J.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,J.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,J.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,J.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,J.TEXTURE_LINEAR_NEAREST=12,J.TEXTURE_EXPLICIT_MODE=0,J.TEXTURE_SPHERICAL_MODE=1,J.TEXTURE_PLANAR_MODE=2,J.TEXTURE_CUBIC_MODE=3,J.TEXTURE_PROJECTION_MODE=4,J.TEXTURE_SKYBOX_MODE=5,J.TEXTURE_INVCUBIC_MODE=6,J.TEXTURE_EQUIRECTANGULAR_MODE=7,J.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,J.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,J.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,J.TEXTURE_FILTERING_QUALITY_HIGH=64,J.TEXTURE_FILTERING_QUALITY_MEDIUM=16,J.TEXTURE_FILTERING_QUALITY_LOW=8,J.SCALEMODE_FLOOR=1,J.SCALEMODE_NEAREST=2,J.SCALEMODE_CEILING=3,J.MATERIAL_TextureDirtyFlag=1,J.MATERIAL_LightDirtyFlag=2,J.MATERIAL_FresnelDirtyFlag=4,J.MATERIAL_AttributesDirtyFlag=8,J.MATERIAL_MiscDirtyFlag=16,J.MATERIAL_PrePassDirtyFlag=32,J.MATERIAL_ImageProcessingDirtyFlag=64,J.MATERIAL_AllDirtyFlag=127,J.MATERIAL_TriangleFillMode=0,J.MATERIAL_WireFrameFillMode=1,J.MATERIAL_PointFillMode=2,J.MATERIAL_PointListDrawMode=3,J.MATERIAL_LineListDrawMode=4,J.MATERIAL_LineLoopDrawMode=5,J.MATERIAL_LineStripDrawMode=6,J.MATERIAL_TriangleStripDrawMode=7,J.MATERIAL_TriangleFanDrawMode=8,J.MATERIAL_ClockWiseSideOrientation=0,J.MATERIAL_CounterClockWiseSideOrientation=1,J.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR=0,J.MATERIAL_DIFFUSE_MODEL_BURLEY=1,J.MATERIAL_DIFFUSE_MODEL_LAMBERT=2,J.MATERIAL_DIFFUSE_MODEL_LEGACY=3,J.MATERIAL_DIELECTRIC_SPECULAR_MODEL_GLTF=0,J.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR=1,J.MATERIAL_CONDUCTOR_SPECULAR_MODEL_GLTF=0,J.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR=1,J.ACTION_NothingTrigger=0,J.ACTION_OnPickTrigger=1,J.ACTION_OnLeftPickTrigger=2,J.ACTION_OnRightPickTrigger=3,J.ACTION_OnCenterPickTrigger=4,J.ACTION_OnPickDownTrigger=5,J.ACTION_OnDoublePickTrigger=6,J.ACTION_OnPickUpTrigger=7,J.ACTION_OnPickOutTrigger=16,J.ACTION_OnLongPressTrigger=8,J.ACTION_OnPointerOverTrigger=9,J.ACTION_OnPointerOutTrigger=10,J.ACTION_OnEveryFrameTrigger=11,J.ACTION_OnIntersectionEnterTrigger=12,J.ACTION_OnIntersectionExitTrigger=13,J.ACTION_OnKeyDownTrigger=14,J.ACTION_OnKeyUpTrigger=15,J.PARTICLES_BILLBOARDMODE_Y=2,J.PARTICLES_BILLBOARDMODE_ALL=7,J.PARTICLES_BILLBOARDMODE_STRETCHED=8,J.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,J.MESHES_CULLINGSTRATEGY_STANDARD=0,J.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,J.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,J.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,J.SCENELOADER_NO_LOGGING=0,J.SCENELOADER_MINIMAL_LOGGING=1,J.SCENELOADER_SUMMARY_LOGGING=2,J.SCENELOADER_DETAILED_LOGGING=3,J.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,J.PREPASS_POSITION_TEXTURE_TYPE=1,J.PREPASS_VELOCITY_TEXTURE_TYPE=2,J.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,J.PREPASS_COLOR_TEXTURE_TYPE=4,J.PREPASS_DEPTH_TEXTURE_TYPE=5,J.PREPASS_NORMAL_TEXTURE_TYPE=6,J.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,J.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,J.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,J.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,J.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,J.PREPASS_ALBEDO_TEXTURE_TYPE=12,J.PREPASS_NORMALIZED_VIEW_DEPTH_TEXTURE_TYPE=13,J.BUFFER_CREATIONFLAG_READ=1,J.BUFFER_CREATIONFLAG_WRITE=2,J.BUFFER_CREATIONFLAG_READWRITE=3,J.BUFFER_CREATIONFLAG_UNIFORM=4,J.BUFFER_CREATIONFLAG_VERTEX=8,J.BUFFER_CREATIONFLAG_INDEX=16,J.BUFFER_CREATIONFLAG_STORAGE=32,J.BUFFER_CREATIONFLAG_INDIRECT=64,J.RENDERPASS_MAIN=0,J.INPUT_ALT_KEY=18,J.INPUT_CTRL_KEY=17,J.INPUT_META_KEY1=91,J.INPUT_META_KEY2=92,J.INPUT_META_KEY3=93,J.INPUT_SHIFT_KEY=16,J.SNAPSHOTRENDERING_STANDARD=0,J.SNAPSHOTRENDERING_FAST=1,J.PERSPECTIVE_CAMERA=0,J.ORTHOGRAPHIC_CAMERA=1,J.FOVMODE_VERTICAL_FIXED=0,J.FOVMODE_HORIZONTAL_FIXED=1,J.RIG_MODE_NONE=0,J.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,J.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,J.RIG_MODE_STEREOSCOPIC_INTERLACED=14,J.RIG_MODE_VR=20,J.RIG_MODE_CUSTOM=22,J.MAX_SUPPORTED_UV_SETS=6,J.GL_ALPHA_EQUATION_ADD=32774,J.GL_ALPHA_EQUATION_MIN=32775,J.GL_ALPHA_EQUATION_MAX=32776,J.GL_ALPHA_EQUATION_SUBTRACT=32778,J.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,J.GL_ALPHA_FUNCTION_SRC=768,J.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,J.GL_ALPHA_FUNCTION_SRC_ALPHA=770,J.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,J.GL_ALPHA_FUNCTION_DST_ALPHA=772,J.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,J.GL_ALPHA_FUNCTION_DST_COLOR=774,J.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,J.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,J.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,J.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,J.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,J.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,J.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,J.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,J.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,J.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,J.SnippetUrl="https://snippet.babylonjs.com",J.FOGMODE_NONE=0,J.FOGMODE_EXP=1,J.FOGMODE_EXP2=2,J.FOGMODE_LINEAR=3,J.BYTE=5120,J.UNSIGNED_BYTE=5121,J.SHORT=5122,J.UNSIGNED_SHORT=5123,J.INT=5124,J.UNSIGNED_INT=5125,J.FLOAT=5126,J.PositionKind="position",J.NormalKind="Jc",J.TangentKind="tangent",J.UVKind="uv",J.UV2Kind="uv2",J.UV3Kind="uv3",J.UV4Kind="uv4",J.UV5Kind="uv5",J.UV6Kind="uv6",J.ColorKind="color",J.ColorInstanceKind="instanceColor",J.MatricesIndicesKind="matricesIndices",J.MatricesWeightsKind="matricesWeights",J.MatricesIndicesExtraKind="matricesIndicesExtra",J.MatricesWeightsExtraKind="matricesWeightsExtra",J.ANIMATIONTYPE_FLOAT=0,J.ANIMATIONTYPE_VECTOR3=1,J.ANIMATIONTYPE_QUATERNION=2,J.ANIMATIONTYPE_MATRIX=3,J.ANIMATIONTYPE_COLOR3=4,J.ANIMATIONTYPE_COLOR4=7,J.ANIMATIONTYPE_VECTOR2=5,J.ANIMATIONTYPE_SIZE=6,J.ShadowMinZ=0,J.ShadowMaxZ=1e4},11196:(q,c,U)=>{U.d(c,{e:()=>i});var J=U(10976),Q=U(10864),s=U(11199),g=U(10902);class X{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new n(q)}sampleFrame(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const c=q-this._lastFrameTimeMs;this._rollingFrameTime.add(c)}this._lastFrameTimeMs=q}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const q=this._rollingFrameTime.history(0);return 0===q?0:1e3/q}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class n{constructor(q){this._samples=new Array(q),this.reset()}add(q){let c;if(this.isSaturated()){const q=this._samples[this._pos];c=q-this.average,this.average-=c/(this._sampleCount-1),this._m2-=c*(q-this.average)}else this._sampleCount++;c=q-this.average,this.average+=c/this._sampleCount,this._m2+=c*(q-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=q,this._pos++,this._pos%=this._samples.length}history(q){if(q>=this._sampleCount||q>=this._samples.length)return 0;const c=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(c-q)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(q){const c=this._samples.length;return(q%c+c)%c}}var W=U(11208),D=U(10886),u=U(11210),K=(U(11226),U(11002));function r(q,c,U,J){let Q,s=1;1===J?Q=new Float32Array(c*U*4):2===J?(Q=new Uint16Array(c*U*4),s=15360):Q=7===J?new Uint32Array(c*U*4):new Uint8Array(c*U*4);for(let g=0;g<c;g++)for(let J=0;J<U;J++){const U=3*(J*c+g),X=4*(J*c+g);Q[X+0]=q[U+0],Q[X+1]=q[U+1],Q[X+2]=q[U+2],Q[X+3]=s}return Q}function H(q){return function(c,U,Q,s,g,X,n,W){let D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const K=q?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,r=q?10:11,H=new J.e(this,r);H.baseWidth=U,H.baseHeight=Q,H.baseDepth=s,H.width=U,H.height=Q,H.depth=s,H.format=g,H.type=u,H.generateMipMaps=X,H.samplingMode=W,q?H.is3D=!0:H.is2DArray=!0,this._doNotHandleContextLost||(H._bufferView=c),q?this.updateRawTexture3D(H,c,g,n,D,u):this.updateRawTexture2DArray(H,c,g,n,D,u),this._bindTextureDirectly(K,H,!0);const b=this._getSamplingParameters(W,X);return this._gl.texParameteri(K,this._gl.TEXTURE_MAG_FILTER,b.mag),this._gl.texParameteri(K,this._gl.TEXTURE_MIN_FILTER,b.min),X&&this._gl.generateMipmap(K),this._bindTextureDirectly(K,null),this._internalTexturesCache.push(H),H}}function b(q){return function(c,U,J,Q){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const X=q?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,n=this._getWebGLTextureType(g),W=this._getInternalFormat(J),D=this._getRGBABufferInternalSizedFormat(g,J);this._bindTextureDirectly(X,c,!0),this._unpackFlipY(void 0===Q||!!Q),this._doNotHandleContextLost||(c._bufferView=U,c.format=J,c.invertY=Q,c._compression=s),c.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),s&&U?this._gl.compressedTexImage3D(X,0,this.getCaps().s3tc[s],c.width,c.height,c.depth,0,U):this._gl.texImage3D(X,0,D,c.width,c.height,c.depth,0,W,n,U),c.generateMipMaps&&this._gl.generateMipmap(X),this._bindTextureDirectly(X,null),c.isReady=!0}}s.ThinEngine.prototype.updateRawTexture=function(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!q)return;const X=this._getRGBABufferInternalSizedFormat(s,U,g),n=this._getInternalFormat(U),W=this._getWebGLTextureType(s);this._bindTextureDirectly(this._gl.TEXTURE_2D,q,!0),this._unpackFlipY(void 0===J||!!J),this._doNotHandleContextLost||(q._bufferView=c,q.format=U,q.type=s,q.invertY=J,q._compression=Q),q.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),Q&&c?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[Q],q.width,q.height,0,c):this._gl.texImage2D(this._gl.TEXTURE_2D,0,X,q.width,q.height,0,n,W,c),q.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),q.isReady=!0},s.ThinEngine.prototype.createRawTexture=function(q,c,U,Q,s,g,X){let n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const u=new J.e(this,3);u.baseWidth=c,u.baseHeight=U,u.width=c,u.height=U,u.format=Q,u.generateMipMaps=s,u.samplingMode=X,u.invertY=g,u._compression=n,u.type=W,u._useSRGBBuffer=this._getUseSRGBBuffer(D,!s),this._doNotHandleContextLost||(u._bufferView=q),this.updateRawTexture(u,q,Q,g,n,W,u._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,u,!0);const K=this._getSamplingParameters(X,s);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,K.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,K.min),s&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(u),u},s.ThinEngine.prototype.createRawCubeTexture=function(q,c,U,Q,s,g,X){let n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const W=this._gl,u=new J.e(this,8);u.isCube=!0,u.format=U,u.type=Q,this._doNotHandleContextLost||(u._bufferViewArray=q);const r=this._getWebGLTextureType(Q);let H=this._getInternalFormat(U);H===W.RGB&&(H=W.RGBA),r!==W.FLOAT||this._caps.textureFloatLinearFiltering?r!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?r!==W.FLOAT||this._caps.textureFloatRender?r!==W.HALF_FLOAT||this._caps.colorBufferFloat||(s=!1,D.c.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(s=!1,D.c.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(s=!1,X=1,D.c.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(s=!1,X=1,D.c.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const b=c,h=b;u.width=b,u.height=h,u.invertY=g,u._compression=n;if(!this.needPOTTextures||(0,K.j)(u.width)&&(0,K.j)(u.height)||(s=!1),q)this.updateRawCubeTexture(u,q,U,Q,g,n);else{const q=this._getRGBABufferInternalSizedFormat(Q),c=0;this._bindTextureDirectly(W.TEXTURE_CUBE_MAP,u,!0);for(let U=0;U<6;U++)n?W.compressedTexImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+U,c,this.getCaps().s3tc[n],u.width,u.height,0,void 0):W.texImage2D(W.TEXTURE_CUBE_MAP_POSITIVE_X+U,c,q,u.width,u.height,0,H,r,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,u,!0),q&&s&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const o=this._getSamplingParameters(X,s);return W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MAG_FILTER,o.mag),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_MIN_FILTER,o.min),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_CUBE_MAP,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),this._bindTextureDirectly(W.TEXTURE_CUBE_MAP,null),u.generateMipMaps=s,u.samplingMode=X,u.isReady=!0,u},s.ThinEngine.prototype.updateRawCubeTexture=function(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;q._bufferViewArray=c,q.format=U,q.type=J,q.invertY=Q,q._compression=s;const X=this._gl,n=this._getWebGLTextureType(J);let W=this._getInternalFormat(U);const D=this._getRGBABufferInternalSizedFormat(J);let u=!1;W===X.RGB&&(W=X.RGBA,u=!0),this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,q,!0),this._unpackFlipY(void 0===Q||!!Q),q.width%4!==0&&X.pixelStorei(X.UNPACK_ALIGNMENT,1);for(let K=0;K<6;K++){let U=c[K];s?X.compressedTexImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+K,g,this.getCaps().s3tc[s],q.width,q.height,0,U):(u&&(U=r(U,q.width,q.height,J)),X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+K,g,D,q.width,q.height,0,W,n,U))}(!this.needPOTTextures||(0,K.j)(q.width)&&(0,K.j)(q.height))&&q.generateMipMaps&&0===g&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),q.isReady=!0},s.ThinEngine.prototype.createRawCubeTextureFromUrl=function(q,c,U,J,Q,s,g,X){let n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,u=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const K=this._gl,H=this.createRawCubeTexture(null,U,J,Q,!s,u,D,null);null===c||void 0===c||c.addPendingData(H),H.url=q,H.isReady=!1,this._internalTexturesCache.push(H);const b=q=>{if(!H._hardwareTexture)return;const U=H.width,s=g(q);if(s){if(X){const q=this._getWebGLTextureType(Q);let c=this._getInternalFormat(J);const g=this._getRGBABufferInternalSizedFormat(Q);let n=!1;c===K.RGB&&(c=K.RGBA,n=!0),this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,H,!0),this._unpackFlipY(!1);const W=X(s);for(let J=0;J<W.length;J++){const s=U>>J;for(let U=0;U<6;U++){let X=W[J][U];n&&(X=r(X,s,s,Q)),K.texImage2D(U,J,g,s,s,0,c,q,X)}}this._bindTextureDirectly(K.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(H,s,J,Q,u);H.isReady=!0,null===c||void 0===c||c.removePendingData(H),H.onLoadedObservable.notifyObservers(H),H.onLoadedObservable.clear(),n&&n()}};return this._loadFile(q,(q=>{b(q)}),void 0,null===c||void 0===c?void 0:c.offlineProvider,!0,((q,U)=>{null===c||void 0===c||c.removePendingData(H),W&&q&&W(q.status+" "+q.statusText,U)})),H},s.ThinEngine.prototype.createRawTexture2DArray=H(!1),s.ThinEngine.prototype.createRawTexture3D=H(!0),s.ThinEngine.prototype.updateRawTexture2DArray=b(!1),s.ThinEngine.prototype.updateRawTexture3D=b(!0);var h=U(10940);s.ThinEngine.prototype._readTexturePixelsSync=function(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const D=this._gl;if(!D)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const q=D.createFramebuffer();if(!q)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=q}var u,K;(D.bindFramebuffer(D.FRAMEBUFFER,this._dummyFramebuffer),J>-1)?D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+J,null===(u=q._hardwareTexture)||void 0===u?void 0:u.underlyingResource,Q):D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,null===(K=q._hardwareTexture)||void 0===K?void 0:K.underlyingResource,Q);let r=void 0!==q.type?this._getWebGLTextureType(q.type):D.UNSIGNED_BYTE;if(X)s||(s=(0,h.t)(q.type,4*c*U));else if(r===D.UNSIGNED_BYTE)s||(s=new Uint8Array(4*c*U)),r=D.UNSIGNED_BYTE;else s||(s=new Float32Array(4*c*U)),r=D.FLOAT;return g&&this.flushFramebuffer(),D.readPixels(n,W,c,U,D.RGBA,r,s),D.bindFramebuffer(D.FRAMEBUFFER,this._currentFramebuffer),s},s.ThinEngine.prototype._readTexturePixels=function(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(q,c,U,J,Q,s,g,X,n,W))};U(11233);s.ThinEngine.prototype._createDepthStencilCubeTexture=function(q,c){const U=new J.e(this,12);if(U.isCube=!0,1===this.webGLVersion)return D.c.Error("Depth cube texture is not supported by WebGL 1."),U;const Q={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...c},s=this._gl;this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,U,!0),this._setupDepthStencilTexture(U,q,Q.bilinearFiltering,Q.comparisonFunction);for(let J=0;J<6;J++)Q.generateStencil?s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,s.DEPTH24_STENCIL8,q,q,0,s.DEPTH_STENCIL,s.UNSIGNED_INT_24_8,null):s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,s.DEPTH_COMPONENT24,q,q,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null);return this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(U),U},s.ThinEngine.prototype._setCubeMapTextureParams=function(q,c,U){const J=this._gl;J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,c?J.LINEAR_MIPMAP_LINEAR:J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),q.samplingMode=c?3:2,c&&this.getCaps().textureMaxLevel&&void 0!==U&&U>0&&(J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAX_LEVEL,U),q._maxLodLevel=U),this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,null)},s.ThinEngine.prototype.createCubeTexture=function(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8],W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,r=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,H=arguments.length>13&&void 0!==arguments[13]&&arguments[13],b=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const h=this._gl;return this.createCubeTextureBase(q,c,U,!!J,Q,s,g,X,n,W,u,r,(q=>this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,q,!0)),((q,c)=>{const U=this.needPOTTextures?(0,K.h)(c[0].width,this._caps.maxCubemapTextureSize):c[0].width,s=U,X=[h.TEXTURE_CUBE_MAP_POSITIVE_X,h.TEXTURE_CUBE_MAP_POSITIVE_Y,h.TEXTURE_CUBE_MAP_POSITIVE_Z,h.TEXTURE_CUBE_MAP_NEGATIVE_X,h.TEXTURE_CUBE_MAP_NEGATIVE_Y,h.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(h.TEXTURE_CUBE_MAP,q,!0),this._unpackFlipY(!1);const n=g?this._getInternalFormat(g,q._useSRGBBuffer):q._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:h.RGBA;let W=g?this._getInternalFormat(g):h.RGBA;q._useSRGBBuffer&&1===this.webGLVersion&&(W=n);for(let J=0;J<X.length;J++)if(c[J].width!==U||c[J].height!==s){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void D.c.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=U,this._workingCanvas.height=s,this._workingContext.drawImage(c[J],0,0,c[J].width,c[J].height,0,0,U,s),h.texImage2D(X[J],0,n,W,h.UNSIGNED_BYTE,this._workingCanvas)}else h.texImage2D(X[J],0,n,W,h.UNSIGNED_BYTE,c[J]);J||h.generateMipmap(h.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(q,!J),q.width=U,q.height=s,q.isReady=!0,g&&(q.format=g),q.onLoadedObservable.notifyObservers(q),q.onLoadedObservable.clear(),Q&&Q()}),!!H,b)},s.ThinEngine.prototype.generateMipMapsForCubemap=function(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(q.generateMipMaps){const U=this._gl;this._bindTextureDirectly(U.TEXTURE_CUBE_MAP,q,!0),U.generateMipmap(U.TEXTURE_CUBE_MAP),c&&this._bindTextureDirectly(U.TEXTURE_CUBE_MAP,null)}};U(11238);s.ThinEngine.prototype.setDepthStencilTexture=function(q,c,U,J){void 0!==q&&(c&&(this._boundUniforms[q]=c),U&&U.depthStencilTexture?this._setTexture(q,U,!1,!0,J):this._setTexture(q,null,void 0,void 0,J))},s.ThinEngine.prototype.createRenderTargetCubeTexture=function(q,c){const U=this._createHardwareRenderTargetWrapper(!1,!0,q),Q={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...c};Q.generateStencilBuffer=Q.generateDepthBuffer&&Q.generateStencilBuffer,(1!==Q.type||this._caps.textureFloatLinearFiltering)&&(2!==Q.type||this._caps.textureHalfFloatLinearFiltering)||(Q.samplingMode=1);const s=this._gl,g=new J.e(this,5);this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,g,!0);const X=this._getSamplingParameters(Q.samplingMode,Q.generateMipMaps);1!==Q.type||this._caps.textureFloat||(Q.type=0,D.c.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,X.mag),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,X.min),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);for(let J=0;J<6;J++)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+J,0,this._getRGBABufferInternalSizedFormat(Q.type,Q.format),q,q,0,this._getInternalFormat(Q.format),this._getWebGLTextureType(Q.type),null);const n=s.createFramebuffer();return this._bindUnboundFramebuffer(n),U._depthStencilBuffer=this._setupFramebufferDepthAttachments(Q.generateStencilBuffer,Q.generateDepthBuffer,q,q),Q.generateMipMaps&&s.generateMipmap(s.TEXTURE_CUBE_MAP),this._bindTextureDirectly(s.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),U._framebuffer=n,U._generateDepthBuffer=Q.generateDepthBuffer,U._generateStencilBuffer=Q.generateStencilBuffer,g.width=q,g.height=q,g.isReady=!0,g.isCube=!0,g.samples=1,g.generateMipMaps=Q.generateMipMaps,g.samplingMode=Q.samplingMode,g.type=Q.type,g.format=Q.format,this._internalTexturesCache.push(g),U.setTextures(g),U};var o=U(11258),a=U(11280);s.ThinEngine.prototype.createPrefilteredCubeTexture=function(q,c,Q,s){let g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6?arguments[6]:void 0,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(q,c,null,!1,(async q=>{if(!q)return void(g&&g(null));const X=q.texture;if(u?q.info.sphericalPolynomial&&(X._sphericalPolynomial=q.info.sphericalPolynomial):X._sphericalPolynomial=new o.f,X._source=9,this.getCaps().textureLOD)return void(g&&g(X));const n=this._gl,W=q.width;if(!W)return;const{DDSTools:K}=await U.e(26).then(U.bind(U,13369)),r=[];for(let U=0;U<3;U++){const g=1-U/2,u=s,H=Math.log2(W)*Q+s,b=u+(H-u)*g,h=Math.round(Math.min(Math.max(b,0),H)),o=new J.e(this,2);if(o.type=X.type,o.format=X.format,o.width=Math.pow(2,Math.max(Math.log2(W)-h,0)),o.height=o.width,o.isCube=!0,o._cachedWrapU=0,o._cachedWrapV=0,this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,o,!0),o.samplingMode=2,n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),q.isDDS){const c=q.info,U=q.data;this._unpackFlipY(c.isCompressed),K.UploadDDSLevels(this,o,U,c,!0,6,h)}else D.c.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(n.TEXTURE_CUBE_MAP,null);const p=new a.b(c);p._isCube=!0,p._texture=o,o.isReady=!0,r.push(p)}X._lodTextureHigh=r[2],X._lodTextureMid=r[1],X._lodTextureLow=r[0],g&&g(X)}),X,n,W,u,Q,s)},s.ThinEngine.prototype.createUniformBuffer=function(q,c){const U=this._gl.createBuffer();if(!U)throw new Error("Unable to create uniform buffer");const J=new W.c(U);return this.bindUniformBuffer(J),q instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,q,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(q),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),J.references=1,J},s.ThinEngine.prototype.createDynamicUniformBuffer=function(q,c){const U=this._gl.createBuffer();if(!U)throw new Error("Unable to create dynamic uniform buffer");const J=new W.c(U);return this.bindUniformBuffer(J),q instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,q,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(q),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),J.references=1,J},s.ThinEngine.prototype.updateUniformBuffer=function(q,c,U,J){this.bindUniformBuffer(q),void 0===U&&(U=0),void 0===J?c instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,U,c):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,U,new Float32Array(c)):c instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,c.subarray(U,U+J)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(c).subarray(U,U+J)),this.bindUniformBuffer(null)},s.ThinEngine.prototype.bindUniformBuffer=function(q){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,q?q.underlyingResource:null)},s.ThinEngine.prototype.bindUniformBufferBase=function(q,c,U){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,c,q?q.underlyingResource:null)},s.ThinEngine.prototype.bindUniformBlock=function(q,c,U){const J=q.program,Q=this._gl.getUniformBlockIndex(J,c);4294967295!==Q&&this._gl.uniformBlockBinding(J,Q,U)};var p=U(10881),R=U(10954);R.d.prototype.displayLoadingUI=function(){if(!(0,p.j)())return;const q=this.loadingScreen;q&&q.displayLoadingUI()},R.d.prototype.hideLoadingUI=function(){if(!(0,p.j)())return;const q=this._loadingScreen;q&&q.hideLoadingUI()},Object.defineProperty(R.d.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=R.d.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(q){this._loadingScreen=q},enumerable:!0,configurable:!0}),Object.defineProperty(R.d.prototype,"loadingUIText",{set:function(q){this.loadingScreen.loadingUIText=q},enumerable:!0,configurable:!0}),Object.defineProperty(R.d.prototype,"loadingUIBackgroundColor",{set:function(q){this.loadingScreen.loadingUIBackgroundColor=q},enumerable:!0,configurable:!0}),R.d.prototype.getInputElement=function(){return this._renderingCanvas},R.d.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},R.d.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},R.d.prototype.getAspectRatio=function(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const U=q.viewport;return this.getRenderWidth(c)*U.width/(this.getRenderHeight(c)*U.height)},R.d.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},R.d.prototype._verifyPointerLock=function(){var q;null===(q=this._onPointerLockChange)||void 0===q||q.call(this)},R.d.prototype.setAlphaEquation=function(q){if(this._alphaEquation!==q){switch(q){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=q}},R.d.prototype.getInputElement=function(){return this._renderingCanvas},R.d.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},R.d.prototype.setDepthFunction=function(q){this._depthCullingState.depthFunc=q},R.d.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},R.d.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},R.d.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},R.d.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},R.d.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},R.d.prototype.setDepthWrite=function(q){this._depthCullingState.depthMask=q},R.d.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},R.d.prototype.setStencilBuffer=function(q){this._stencilState.stencilTest=q},R.d.prototype.getStencilMask=function(){return this._stencilState.stencilMask},R.d.prototype.setStencilMask=function(q){this._stencilState.stencilMask=q},R.d.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},R.d.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},R.d.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},R.d.prototype.setStencilFunction=function(q){this._stencilState.stencilFunc=q},R.d.prototype.setStencilFunctionReference=function(q){this._stencilState.stencilFuncRef=q},R.d.prototype.setStencilFunctionMask=function(q){this._stencilState.stencilFuncMask=q},R.d.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},R.d.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},R.d.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},R.d.prototype.setStencilOperationFail=function(q){this._stencilState.stencilOpStencilFail=q},R.d.prototype.setStencilOperationDepthFail=function(q){this._stencilState.stencilOpDepthFail=q},R.d.prototype.setStencilOperationPass=function(q){this._stencilState.stencilOpStencilDepthPass=q},R.d.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},R.d.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},R.d.prototype.setAlphaConstants=function(q,c,U,J){this._alphaState.setAlphaBlendConstants(q,c,U,J)},R.d.prototype.getAlphaMode=function(){return this._alphaMode},R.d.prototype.getAlphaEquation=function(){return this._alphaEquation},R.d.prototype.getRenderPassNames=function(){return this._renderPassNames},R.d.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},R.d.prototype.createRenderPassId=function(q){const c=++R.d._RenderPassIdCounter;return this._renderPassNames[c]=q??"NONAME",c},R.d.prototype.releaseRenderPassId=function(q){this._renderPassNames[q]=void 0;for(let c=0;c<this.scenes.length;++c){const U=this.scenes[c];for(let c=0;c<U.meshes.length;++c){const J=U.meshes[c];if(J.Gc)for(let c=0;c<J.Gc.length;++c){J.Gc[c]._removeDrawWrapper(q)}}}};U(11251);function I(q){if(q.requestPointerLock){const c=q.requestPointerLock();c instanceof Promise?c.then((()=>{q.focus()})).catch((()=>{})):q.focus()}}var t=U(11282),C=U(10945);class i extends s.ThinEngine{static get NpmPackage(){return R.d.NpmPackage}static get Version(){return R.d.Version}static get Instances(){return Q.c.Instances}static get LastCreatedEngine(){return Q.c.LastCreatedEngine}static get LastCreatedScene(){return Q.c.LastCreatedScene}static DefaultLoadingScreenFactory(q){return R.d.DefaultLoadingScreenFactory(q)}get _supportsHardwareTextureRescaling(){return!!i._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(q,c,U){super(q,c,U,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new X,this._drawCalls=new t.e,q&&(this._features.supportRenderPasses=!0,U=this._creationOptions)}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(q){super._sharedInit(q),function(q,c,U){q._onCanvasFocus=()=>{q.onCanvasFocusObservable.notifyObservers(q)},q._onCanvasBlur=()=>{q.onCanvasBlurObservable.notifyObservers(q)},q._onCanvasContextMenu=c=>{q.disableContextMenu&&c.preventDefault()},c.addEventListener("focus",q._onCanvasFocus),c.addEventListener("blur",q._onCanvasBlur),c.addEventListener("contextmenu",q._onCanvasContextMenu),q._onBlur=()=>{q.disablePerformanceMonitorInBackground&&q.performanceMonitor.disable(),q._windowIsBackground=!0},q._onFocus=()=>{q.disablePerformanceMonitorInBackground&&q.performanceMonitor.enable(),q._windowIsBackground=!1},q._onCanvasPointerOut=U=>{document.elementFromPoint(U.clientX,U.clientY)!==c&&q.onCanvasPointerOutObservable.notifyObservers(U)};const J=q.getHostWindow();J&&"function"===typeof J.addEventListener&&(J.addEventListener("blur",q._onBlur),J.addEventListener("focus",q._onFocus)),c.addEventListener("pointerout",q._onCanvasPointerOut),U.doNotHandleTouchAction||function(q){q&&q.setAttribute&&(q.setAttribute("touch-action","none"),q.style.touchAction="none",q.style.webkitTapHighlightColor="transparent")}(c),!R.d.audioEngine&&U.audioEngine&&R.d.AudioEngineFactory&&(R.d.audioEngine=R.d.AudioEngineFactory(q.getRenderingCanvas(),q.getAudioContext(),q.getAudioDestination())),(0,p.c)()&&(q._onFullscreenChange=()=>{q.isFullscreen=!!document.fullscreenElement,q.isFullscreen&&q._pointerLockRequested&&c&&I(c)},document.addEventListener("fullscreenchange",q._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",q._onFullscreenChange,!1),q._onPointerLockChange=()=>{q.isPointerLock=document.pointerLockElement===c},document.addEventListener("pointerlockchange",q._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",q._onPointerLockChange,!1)),q.enableOfflineSupport=void 0!==R.d.OfflineProviderFactory,q._deterministicLockstep=!!U.deterministicLockstep,q._lockstepMaxSteps=U.lockstepMaxSteps||0,q._timeStep=U.timeStep||1/60}(this,q,this._creationOptions)}resizeImageBitmap(q,c,U){return function(q,c,U,J){const Q=q.createCanvas(U,J).getContext("2d");if(!Q)throw new Error("Unable to get 2d context for resizeImageBitmap");return Q.drawImage(c,0,0),Q.getImageData(0,0,U,J).data}(this,q,c,U)}async _createImageBitmapFromSource(q,c){return await async function(q,c,U){return await new Promise(((J,Q)=>{const s=new Image;s.onload=()=>{s.decode().then((()=>{q.createImageBitmap(s,U).then((q=>{J(q)}))}))},s.onerror=()=>{Q(`Error loading image ${s.src}`)},s.src=c}))}(this,q,c)}switchFullscreen(q){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(q)}enterFullscreen(q){this.isFullscreen||(this._pointerLockRequested=q,this._renderingCanvas&&function(q){const c=q.requestFullscreen||q.webkitRequestFullscreen;c&&c.call(q)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const q=document;document.exitFullscreen?document.exitFullscreen():q.webkitCancelFullScreen&&q.webkitCancelFullScreen()}()}setDitheringState(q){q?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(q){q?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(q,c,U,J){const Q=this._cachedViewport;return this._cachedViewport=null,this._viewport(q,c,U,J),Q}scissorClear(q,c,U,J,Q){this.enableScissor(q,c,U,J),this.clear(Q,!0,!0,!0),this.disableScissor()}enableScissor(q,c,U,J){const Q=this._gl;Q.enable(Q.SCISSOR_TEST),Q.scissor(q,c,U,J)}disableScissor(){const q=this._gl;q.disable(q.SCISSOR_TEST)}async _loadFileAsync(q,c,U){return await new Promise(((J,Q)=>{this._loadFile(q,(q=>{J(q)}),void 0,c,U,((q,c)=>{Q(c)}))}))}getVertexShaderSource(q){const c=this._gl.getAttachedShaders(q);return c?this._gl.getShaderSource(c[0]):null}getFragmentShaderSource(q){const c=this._gl.getAttachedShaders(q);return c?this._gl.getShaderSource(c[1]):null}set framebufferDimensionsObject(q){this._framebufferDimensionsObject=q,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const q of this.scenes)q.resetCachedMaterial(),q._rebuildGeometries();for(const q of this._virtualScenes)q.resetCachedMaterial(),q._rebuildGeometries();super._rebuildBuffers()}getFontOffset(q){return function(q){const c=document.createElement("span");c.textContent="Hg",c.style.font=q;const U=document.createElement("div");U.style.display="inline-block",U.style.width="1px",U.style.height="0px",U.style.verticalAlign="bottom";const J=document.createElement("div");J.style.whiteSpace="nowrap",J.appendChild(c),J.appendChild(U),document.body.appendChild(J);let Q=0,s=0;try{s=U.getBoundingClientRect().top-c.getBoundingClientRect().top,U.style.verticalAlign="baseline",Q=U.getBoundingClientRect().top-c.getBoundingClientRect().top}finally{document.body.removeChild(J)}return{ascent:Q,height:s,descent:s-Q}}(q)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:q}=this.customAnimationFrameRequester;q&&q(this.customAnimationFrameRequester.K)}}else super._cancelFrame()}_renderLoop(q){this._processFrame(q),this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.K=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.K):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&I(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Bu(){this._measureFps(),super.Bu()}_deletePipelineContext(q){const c=q;c&&c.program&&c.transformFeedback&&(this.deleteTransformFeedback(c.transformFeedback),c.transformFeedback=null),super._deletePipelineContext(q)}createShaderProgram(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;Q=Q||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const g=super.createShaderProgram(q,c,U,J,Q,s);return this.onAfterShaderCompilationObservable.notifyObservers(this),g}_createShaderProgram(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const s=J.createProgram();if(q.program=s,!s)throw new Error("Unable to create program");if(J.attachShader(s,c),J.attachShader(s,U),this.webGLVersion>1&&Q){const c=this.createTransformFeedback();this.bindTransformFeedback(c),this.setTranformFeedbackVaryings(s,Q),q.transformFeedback=c}return J.linkProgram(s),this.webGLVersion>1&&Q&&this.bindTransformFeedback(null),q.context=J,q.vertexShader=c,q.fragmentShader=U,q.isParallelCompiled||this._finalizePipelineContext(q),s}_releaseTexture(q){super._releaseTexture(q)}_releaseRenderTargetWrapper(q){super._releaseRenderTargetWrapper(q);for(const c of this.scenes){for(const U of c.postProcesses)U._outputTexture===q&&(U._outputTexture=null);for(const U of c.cameras)for(const c of U._postProcesses)c&&c._outputTexture===q&&(c._outputTexture=null)}}_rescaleTexture(q,c,U,J,Q){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const s=this.createRenderTargetTexture({width:c.width,height:c.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&i._RescalePostProcessFactory&&(this._rescalePostProcess=i._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const g=()=>{this._rescalePostProcess.onApply=function(c){c._bindTexture("textureSampler",q)};let g=U;g||(g=this.scenes[this.scenes.length-1]),g.postProcessManager.directRender([this._rescalePostProcess],s,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,c,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,J,0,0,c.width,c.height,0),this.unBindFramebuffer(s),s.dispose(),Q&&Q()},X=this._rescalePostProcess.getEffect();X?X.executeWhenCompiled(g):this._rescalePostProcess.onEffectCreatedObservable.addOnce((q=>{q.executeWhenCompiled(g)}))}}wrapWebGLTexture(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const g=new u.e(q,this._gl),X=new J.e(this,0,!0);return X._hardwareTexture=g,X.baseWidth=Q,X.baseHeight=s,X.width=Q,X.height=s,X.isReady=!0,X.useMipMaps=c,this.updateTextureSamplingMode(U,X),X}_uploadImageToTexture(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const Q=this._gl,s=this._getWebGLTextureType(q.type),g=this._getInternalFormat(q.format),X=this._getRGBABufferInternalSizedFormat(q.type,g),n=q.isCube?Q.TEXTURE_CUBE_MAP:Q.TEXTURE_2D;this._bindTextureDirectly(n,q,!0),this._unpackFlipY(q.invertY);let W=Q.TEXTURE_2D;q.isCube&&(W=Q.TEXTURE_CUBE_MAP_POSITIVE_X+U),Q.texImage2D(W,J,X,g,s,c),this._bindTextureDirectly(n,null,!0)}updateTextureComparisonFunction(q,c){if(1===this.webGLVersion)return void D.c.Error("WebGL 1 does not support texture comparison.");const U=this._gl;q.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,q,!0),0===c?(U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_COMPARE_FUNC,515),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_COMPARE_MODE,U.NONE)):(U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_COMPARE_FUNC,c),U.texParameteri(U.TEXTURE_CUBE_MAP,U.TEXTURE_COMPARE_MODE,U.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,q,!0),0===c?(U.texParameteri(U.TEXTURE_2D,U.TEXTURE_COMPARE_FUNC,515),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_COMPARE_MODE,U.NONE)):(U.texParameteri(U.TEXTURE_2D,U.TEXTURE_COMPARE_FUNC,c),U.texParameteri(U.TEXTURE_2D,U.TEXTURE_COMPARE_MODE,U.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),q._comparisonFunction=c}createInstancesBuffer(q){const c=this._gl.createBuffer();if(!c)throw new Error("Unable to create instance buffer");const U=new W.c(c);return U.WU=q,this.bindArrayBuffer(U),this._gl.bufferData(this._gl.ARRAY_BUFFER,q,this._gl.DYNAMIC_DRAW),U.references=1,U}deleteInstancesBuffer(q){this._gl.deleteBuffer(q)}async _clientWaitAsync(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const J=this._gl;return await new Promise(((Q,s)=>{(0,C.f)((()=>{const U=J.clientWaitSync(q,c,0);if(U==J.WAIT_FAILED)throw new Error("clientWaitSync failed");return U!=J.TIMEOUT_EXPIRED}),Q,s,U)}))}_readPixelsAsync(q,c,U,J,Q,s,g){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const X=this._gl,n=X.createBuffer();X.bindBuffer(X.PIXEL_PACK_BUFFER,n),X.bufferData(X.PIXEL_PACK_BUFFER,g.byteLength,X.STREAM_READ),X.readPixels(q,c,U,J,Q,s,0),X.bindBuffer(X.PIXEL_PACK_BUFFER,null);const W=X.fenceSync(X.SYNC_GPU_COMMANDS_COMPLETE,0);return W?(X.flush(),this._clientWaitAsync(W,0,10).then((()=>(X.deleteSync(W),X.bindBuffer(X.PIXEL_PACK_BUFFER,n),X.getBufferSubData(X.PIXEL_PACK_BUFFER,0,g),X.bindBuffer(X.PIXEL_PACK_BUFFER,null),X.deleteBuffer(n),g)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(q,c){1===Q.c.Instances.length&&R.d.audioEngine&&(R.d.audioEngine.dispose(),R.d.audioEngine=null);const U=q.getHostWindow();U&&"function"===typeof U.removeEventListener&&(U.removeEventListener("blur",q._onBlur),U.removeEventListener("focus",q._onFocus)),c&&(c.removeEventListener("focus",q._onCanvasFocus),c.removeEventListener("blur",q._onCanvasBlur),c.removeEventListener("pointerout",q._onCanvasPointerOut),c.removeEventListener("contextmenu",q._onCanvasContextMenu)),(0,p.c)()&&(document.removeEventListener("fullscreenchange",q._onFullscreenChange),document.removeEventListener("mozfullscreenchange",q._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",q._onFullscreenChange),document.removeEventListener("msfullscreenchange",q._onFullscreenChange),document.removeEventListener("pointerlockchange",q._onPointerLockChange),document.removeEventListener("mspointerlockchange",q._onPointerLockChange),document.removeEventListener("mozpointerlockchange",q._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",q._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}i.ALPHA_DISABLE=0,i.ALPHA_ADD=1,i.ALPHA_COMBINE=2,i.ALPHA_SUBTRACT=3,i.ALPHA_MULTIPLY=4,i.ALPHA_MAXIMIZED=5,i.ALPHA_ONEONE=6,i.ALPHA_PREMULTIPLIED=7,i.ALPHA_PREMULTIPLIED_PORTERDUFF=8,i.ALPHA_INTERPOLATE=9,i.ALPHA_SCREENMODE=10,i.DELAYLOADSTATE_NONE=0,i.DELAYLOADSTATE_LOADED=1,i.DELAYLOADSTATE_LOADING=2,i.DELAYLOADSTATE_NOTLOADED=4,i.NEVER=512,i.ALWAYS=519,i.LESS=513,i.EQUAL=514,i.LEQUAL=515,i.GREATER=516,i.GEQUAL=518,i.NOTEQUAL=517,i.KEEP=7680,i.REPLACE=7681,i.INCR=7682,i.DECR=7683,i.INVERT=5386,i.INCR_WRAP=34055,i.DECR_WRAP=34056,i.TEXTURE_CLAMP_ADDRESSMODE=0,i.TEXTURE_WRAP_ADDRESSMODE=1,i.TEXTURE_MIRROR_ADDRESSMODE=2,i.TEXTUREFORMAT_ALPHA=0,i.TEXTUREFORMAT_LUMINANCE=1,i.TEXTUREFORMAT_LUMINANCE_ALPHA=2,i.TEXTUREFORMAT_RGB=4,i.TEXTUREFORMAT_RGBA=5,i.TEXTUREFORMAT_RED=6,i.TEXTUREFORMAT_R=6,i.TEXTUREFORMAT_R16_UNORM=33322,i.TEXTUREFORMAT_RG16_UNORM=33324,i.TEXTUREFORMAT_RGB16_UNORM=32852,i.TEXTUREFORMAT_RGBA16_UNORM=32859,i.TEXTUREFORMAT_R16_SNORM=36760,i.TEXTUREFORMAT_RG16_SNORM=36761,i.TEXTUREFORMAT_RGB16_SNORM=36762,i.TEXTUREFORMAT_RGBA16_SNORM=36763,i.TEXTUREFORMAT_RG=7,i.TEXTUREFORMAT_RED_INTEGER=8,i.TEXTUREFORMAT_R_INTEGER=8,i.TEXTUREFORMAT_RG_INTEGER=9,i.TEXTUREFORMAT_RGB_INTEGER=10,i.TEXTUREFORMAT_RGBA_INTEGER=11,i.TEXTURETYPE_UNSIGNED_BYTE=0,i.TEXTURETYPE_UNSIGNED_INT=0,i.TEXTURETYPE_FLOAT=1,i.TEXTURETYPE_HALF_FLOAT=2,i.TEXTURETYPE_BYTE=3,i.TEXTURETYPE_SHORT=4,i.TEXTURETYPE_UNSIGNED_SHORT=5,i.TEXTURETYPE_INT=6,i.TEXTURETYPE_UNSIGNED_INTEGER=7,i.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,i.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,i.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,i.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,i.TEXTURETYPE_UNSIGNED_INT_24_8=12,i.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,i.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,i.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,i.TEXTURE_NEAREST_SAMPLINGMODE=1,i.TEXTURE_BILINEAR_SAMPLINGMODE=2,i.TEXTURE_TRILINEAR_SAMPLINGMODE=3,i.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,i.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,i.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,i.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,i.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,i.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,i.TEXTURE_NEAREST_LINEAR=7,i.TEXTURE_NEAREST_NEAREST=1,i.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,i.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,i.TEXTURE_LINEAR_LINEAR=2,i.TEXTURE_LINEAR_NEAREST=12,i.TEXTURE_EXPLICIT_MODE=0,i.TEXTURE_SPHERICAL_MODE=1,i.TEXTURE_PLANAR_MODE=2,i.TEXTURE_CUBIC_MODE=3,i.TEXTURE_PROJECTION_MODE=4,i.TEXTURE_SKYBOX_MODE=5,i.TEXTURE_INVCUBIC_MODE=6,i.TEXTURE_EQUIRECTANGULAR_MODE=7,i.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,i.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,i.SCALEMODE_FLOOR=1,i.SCALEMODE_NEAREST=2,i.SCALEMODE_CEILING=3},10864:(q,c,U)=>{U.d(c,{c:()=>Q});var J=U(10866);class Q{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}Q.Instances=[],Q.OnEnginesDisposedObservable=new J.e,Q._LastCreatedScene=null,Q.UseFallbackTexture=!0,Q.FallbackTexture=""},10857:(q,c,U)=>{U.d(c,{d:()=>J});class J{static SetMatrixPrecision(q){if(J.MatrixTrackPrecisionChange=!1,q&&!J.MatrixUse64Bits&&J.MatrixTrackedMatrices)for(let c=0;c<J.MatrixTrackedMatrices.length;++c){const q=J.MatrixTrackedMatrices[c],U=q.tK;q.tK=new Array(16);for(let c=0;c<16;++c)q.tK[c]=U[c]}J.MatrixUse64Bits=q,J.MatrixCurrentType=J.MatrixUse64Bits?Array:Float32Array,J.MatrixTrackedMatrices=null}}J.MatrixUse64Bits=!1,J.MatrixTrackPrecisionChange=!0,J.MatrixCurrentType=Float32Array,J.MatrixTrackedMatrices=[]},11247:(q,c,U)=>{U.d(c,{b:()=>Q});var J=U(11218);class Q{get depthStencilTexture(){return this._depthStencilTexture}setDepthStencilTexture(q){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this._depthStencilTexture&&this._depthStencilTexture.dispose(),this._depthStencilTexture=q,this._generateDepthBuffer=this._generateStencilBuffer=this._depthStencilTextureWithStencil=!1,q&&(this._generateDepthBuffer=!0,this._generateStencilBuffer=this._depthStencilTextureWithStencil=(0,J.e)(q.format))}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width??this._size}get height(){return this._size.height??this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var q;return(null===(q=this._textures)||void 0===q?void 0:q[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(q){var c,U;if(!this._textures)return-1;const J=this._textures[q],Q=(null===(c=this._layerIndices)||void 0===c?void 0:c[q])??0,s=(null===(U=this._faceIndices)||void 0===U?void 0:U[q])??0;return J.isCube?6*Q+s:J.is3D?0:Q}get samples(){return this._samples}setSamples(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===q&&!U)return q;const J=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,q,c):this._engine.updateRenderTargetTextureSampleCount(this,q);return this._samples=q,J}resolveMSAATextures(){this.isMulti?this._engine.resolveMultiFramebuffer(this):this._engine.resolveFramebuffer(this)}generateMipMaps(){this._engine._currentRenderTarget===this&&this._engine.unBindFramebuffer(this,!0),this.isMulti?this._engine.generateMipMapsMultiFramebuffer(this):this._engine.generateMipMapsFramebuffer(this)}constructor(q,c,U,J,Q){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this.disableAutomaticMSAAResolve=!1,this.resolveMSAAColors=!0,this.resolveMSAADepth=!1,this.resolveMSAAStencil=!1,this._isMulti=q,this._isCube=c,this._size=U,this._engine=J,this._depthStencilTexture=null,this.label=Q}setTextures(q){Array.isArray(q)?this._textures=q:this._textures=q?[q]:null}setTexture(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[c]!==q&&(this._textures[c]&&U&&this._textures[c].dispose(),this._textures[c]=q)}setLayerAndFaceIndices(q,c){this._layerIndices=q,this._faceIndices=c}setLayerAndFaceIndex(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==c&&c>=0&&(this._layerIndices[q]=c),void 0!==U&&U>=0&&(this._faceIndices[q]=U)}createDepthStencilTexture(){var q;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,g=arguments.length>5?arguments[5]:void 0;return null===(q=this._depthStencilTexture)||void 0===q||q.dispose(),this._depthStencilTextureWithStencil=J,this._depthStencilTextureLabel=g,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:U,comparisonFunction:c,generateStencil:J,isCube:this._isCube,samples:Q,depthTextureFormat:s,label:g},this),this._depthStencilTexture}_shareDepth(q){this.shareDepth(q)}shareDepth(q){this._depthStencilTexture&&(q._depthStencilTexture&&q._depthStencilTexture.dispose(),q._depthStencilTexture=this._depthStencilTexture,q._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(q){this.texture&&this.texture._swapAndDie(q),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let q=null;if(this._isMulti){const c=this.textures;if(c&&c.length>0){let U=!1,J=c.length,Q=-1;const s=c[c.length-1]._source;14!==s&&12!==s||(U=!0,Q=c[c.length-1].format,J--);const g=[],X=[],n=[],W=[],D=[],u=[],K=[],r={};for(let q=0;q<J;++q){const U=c[q];g.push(U.samplingMode),X.push(U.type),n.push(U.format);void 0!==r[U.uniqueId]?(W.push(-1),K.push(0)):(r[U.uniqueId]=q,U.is2DArray?(W.push(35866),K.push(U.depth)):U.isCube?(W.push(34067),K.push(0)):U.is3D?(W.push(32879),K.push(U.depth)):(W.push(3553),K.push(0))),this._faceIndices&&D.push(this._faceIndices[q]??0),this._layerIndices&&u.push(this._layerIndices[q]??0)}const H={samplingModes:g,generateMipMaps:c[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:U,depthTextureFormat:Q,types:X,formats:n,textureCount:J,targetTypes:W,faceIndex:D,layerIndex:u,layerCounts:K,label:this.label},b={width:this.width,height:this.height,depth:this.depth};q=this._engine.createMultipleRenderTarget(b,H);for(let h=0;h<J;++h){if(-1!==W[h])continue;const U=r[c[h].uniqueId];q.setTexture(q.textures[U],h)}}}else{var c,U,J,Q;const g={};if(g.generateDepthBuffer=this._generateDepthBuffer,g.generateMipMaps=(null===(c=this.texture)||void 0===c?void 0:c.generateMipMaps)??!1,g.generateStencilBuffer=this._generateStencilBuffer,g.samplingMode=null===(U=this.texture)||void 0===U?void 0:U.samplingMode,g.type=null===(J=this.texture)||void 0===J?void 0:J.type,g.format=null===(Q=this.texture)||void 0===Q?void 0:Q.format,g.noColorAttachment=!this._textures,g.label=this.label,this.isCube)q=this._engine.createRenderTargetCubeTexture(this.width,g);else{var s;const c={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(s=this.texture)||void 0===s?void 0:s.depth:void 0};q=this._engine.createRenderTargetTexture(c,g)}q.texture&&(q.texture.isReady=!0)}return q}_swapRenderTargetWrapper(q){if(this._textures&&q._textures)for(let c=0;c<this._textures.length;++c)this._textures[c]._swapAndDie(q._textures[c],!1),q._textures[c].isReady=!0;this._depthStencilTexture&&q._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(q._depthStencilTexture),q._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const q=this._cloneRenderTargetWrapper();if(q){if(this._depthStencilTexture){const c=this._depthStencilTexture.samplingMode,U=this._depthStencilTexture.format,J=2===c||3===c||11===c;q.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,J,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,U,this._depthStencilTextureLabel)}this.samples>1&&q.setSamples(this.samples),q._swapRenderTargetWrapper(this),q.dispose()}}releaseTextures(){if(this._textures)for(let q=0;q<this._textures.length;++q)this._textures[q].dispose();this._textures=null}dispose(){var q;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(q=this._depthStencilTexture)||void 0===q||q.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10961:(q,c,U)=>{U.d(c,{c:()=>J});class J{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.ShadersRepository:J.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.ShadersStore:J.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?J.IncludesShadersStore:J.IncludesShadersStoreWGSL}}J.ShadersRepository="src/Shaders/",J.ShadersStore={},J.IncludesShadersStore={},J.ShadersRepositoryWGSL="src/ShadersWGSL/",J.ShadersStoreWGSL={},J.IncludesShadersStoreWGSL={}},10969:(q,c,U)=>{U.d(c,{e:()=>K,g:()=>p,k:()=>H,l:()=>r,p:()=>b,t:()=>a,v:()=>u,x:()=>W,A:()=>D,E:()=>n,F:()=>X});class J{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.yX._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(q){q&&this.program&&q(this.program)}setEngine(q){this.yX=q}_fillEffectInformation(q,c,U,J,Q,s,g,X){const n=this.yX;if(n.supportsUniformBuffers)for(const D in c)q.bindUniformBlock(D,c[D]);let W;for(this.yX.getUniforms(this,U).forEach(((q,c)=>{J[U[c]]=q})),this._uniforms=J,W=0;W<Q.length;W++){null==q.getUniform(Q[W])&&(Q.splice(W,1),W--)}Q.forEach(((q,c)=>{s[q]=c}));for(const D of n.getAttributes(this,g))X.push(D)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(q,c){const U=this._valueCache[q],J=c.updateFlag;return(void 0===U||U!==J)&&(this._valueCache[q]=J,!0)}_cacheFloat2(q,c,U){let J=this._valueCache[q];if(!J||2!==J.length)return J=[c,U],this._valueCache[q]=J,!0;let Q=!1;return J[0]!==c&&(J[0]=c,Q=!0),J[1]!==U&&(J[1]=U,Q=!0),Q}_cacheFloat3(q,c,U,J){let Q=this._valueCache[q];if(!Q||3!==Q.length)return Q=[c,U,J],this._valueCache[q]=Q,!0;let s=!1;return Q[0]!==c&&(Q[0]=c,s=!0),Q[1]!==U&&(Q[1]=U,s=!0),Q[2]!==J&&(Q[2]=J,s=!0),s}_cacheFloat4(q,c,U,J,Q){let s=this._valueCache[q];if(!s||4!==s.length)return s=[c,U,J,Q],this._valueCache[q]=s,!0;let g=!1;return s[0]!==c&&(s[0]=c,g=!0),s[1]!==U&&(s[1]=U,g=!0),s[2]!==J&&(s[2]=J,g=!0),s[3]!==Q&&(s[3]=Q,g=!0),g}setInt(q,c){const U=this._valueCache[q];void 0!==U&&U===c||this.yX.setInt(this._uniforms[q],c)&&(this._valueCache[q]=c)}setInt2(q,c,U){this._cacheFloat2(q,c,U)&&(this.yX.setInt2(this._uniforms[q],c,U)||(this._valueCache[q]=null))}setInt3(q,c,U,J){this._cacheFloat3(q,c,U,J)&&(this.yX.setInt3(this._uniforms[q],c,U,J)||(this._valueCache[q]=null))}setInt4(q,c,U,J,Q){this._cacheFloat4(q,c,U,J,Q)&&(this.yX.setInt4(this._uniforms[q],c,U,J,Q)||(this._valueCache[q]=null))}setIntArray(q,c){this._valueCache[q]=null,this.yX.setIntArray(this._uniforms[q],c)}setIntArray2(q,c){this._valueCache[q]=null,this.yX.setIntArray2(this._uniforms[q],c)}setIntArray3(q,c){this._valueCache[q]=null,this.yX.setIntArray3(this._uniforms[q],c)}setIntArray4(q,c){this._valueCache[q]=null,this.yX.setIntArray4(this._uniforms[q],c)}setUInt(q,c){const U=this._valueCache[q];void 0!==U&&U===c||this.yX.setUInt(this._uniforms[q],c)&&(this._valueCache[q]=c)}setUInt2(q,c,U){this._cacheFloat2(q,c,U)&&(this.yX.setUInt2(this._uniforms[q],c,U)||(this._valueCache[q]=null))}setUInt3(q,c,U,J){this._cacheFloat3(q,c,U,J)&&(this.yX.setUInt3(this._uniforms[q],c,U,J)||(this._valueCache[q]=null))}setUInt4(q,c,U,J,Q){this._cacheFloat4(q,c,U,J,Q)&&(this.yX.setUInt4(this._uniforms[q],c,U,J,Q)||(this._valueCache[q]=null))}setUIntArray(q,c){this._valueCache[q]=null,this.yX.setUIntArray(this._uniforms[q],c)}setUIntArray2(q,c){this._valueCache[q]=null,this.yX.setUIntArray2(this._uniforms[q],c)}setUIntArray3(q,c){this._valueCache[q]=null,this.yX.setUIntArray3(this._uniforms[q],c)}setUIntArray4(q,c){this._valueCache[q]=null,this.yX.setUIntArray4(this._uniforms[q],c)}setArray(q,c){this._valueCache[q]=null,this.yX.setArray(this._uniforms[q],c)}setArray2(q,c){this._valueCache[q]=null,this.yX.setArray2(this._uniforms[q],c)}setArray3(q,c){this._valueCache[q]=null,this.yX.setArray3(this._uniforms[q],c)}setArray4(q,c){this._valueCache[q]=null,this.yX.setArray4(this._uniforms[q],c)}setMatrices(q,c){c&&(this._valueCache[q]=null,this.yX.setMatrices(this._uniforms[q],c))}setMatrix(q,c){this._cacheMatrix(q,c)&&(this.yX.setMatrices(this._uniforms[q],c.rc())||(this._valueCache[q]=null))}setMatrix3x3(q,c){this._valueCache[q]=null,this.yX.setMatrix3x3(this._uniforms[q],c)}setMatrix2x2(q,c){this._valueCache[q]=null,this.yX.setMatrix2x2(this._uniforms[q],c)}setFloat(q,c){const U=this._valueCache[q];void 0!==U&&U===c||this.yX.setFloat(this._uniforms[q],c)&&(this._valueCache[q]=c)}setVector2(q,c){this._cacheFloat2(q,c.x,c.y)&&(this.yX.setFloat2(this._uniforms[q],c.x,c.y)||(this._valueCache[q]=null))}setFloat2(q,c,U){this._cacheFloat2(q,c,U)&&(this.yX.setFloat2(this._uniforms[q],c,U)||(this._valueCache[q]=null))}setVector3(q,c){this._cacheFloat3(q,c.x,c.y,c.z)&&(this.yX.setFloat3(this._uniforms[q],c.x,c.y,c.z)||(this._valueCache[q]=null))}setFloat3(q,c,U,J){this._cacheFloat3(q,c,U,J)&&(this.yX.setFloat3(this._uniforms[q],c,U,J)||(this._valueCache[q]=null))}setVector4(q,c){this._cacheFloat4(q,c.x,c.y,c.z,c.w)&&(this.yX.setFloat4(this._uniforms[q],c.x,c.y,c.z,c.w)||(this._valueCache[q]=null))}setQuaternion(q,c){this._cacheFloat4(q,c.x,c.y,c.z,c.w)&&(this.yX.setFloat4(this._uniforms[q],c.x,c.y,c.z,c.w)||(this._valueCache[q]=null))}setFloat4(q,c,U,J,Q){this._cacheFloat4(q,c,U,J,Q)&&(this.yX.setFloat4(this._uniforms[q],c,U,J,Q)||(this._valueCache[q]=null))}setColor3(q,c){this._cacheFloat3(q,c.r,c.g,c.b)&&(this.yX.setFloat3(this._uniforms[q],c.r,c.g,c.b)||(this._valueCache[q]=null))}setColor4(q,c,U){this._cacheFloat4(q,c.r,c.g,c.b,U)&&(this.yX.setFloat4(this._uniforms[q],c.r,c.g,c.b,U)||(this._valueCache[q]=null))}setDirectColor4(q,c){this._cacheFloat4(q,c.r,c.g,c.b,c.a)&&(this.yX.setFloat4(this._uniforms[q],c.r,c.g,c.b,c.a)||(this._valueCache[q]=null))}_getVertexShaderCode(){return this.vertexShader?this.yX._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.yX._getShaderSource(this.fragmentShader):null}}var Q=U(10940);const s=new WeakMap,g={_webGLVersion:2,cachedPipelines:{}};function X(q){let c=s.get(q);if(!c){if(!q)return g;c={_webGLVersion:q.TEXTURE_BINDING_3D?2:1,_context:q,parallelShaderCompile:q.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},s.set(q,c)}return c}function n(q){s.delete(q)}function W(q,c,U,J,Q,s){const g=X(J);s||(s=g._createShaderProgramInjection??K);return s(q,o(c,"vertex",J,g._contextWasLost),o(U,"fragment",J,g._contextWasLost),J,Q,g.validateShaderPrograms)}function D(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6?arguments[6]:void 0;const n=X(Q);g||(g=n._createShaderProgramInjection??K);const W=n._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return g(q,h(c,"vertex",J,W,Q,n._contextWasLost),h(U,"fragment",J,W,Q,n._contextWasLost),Q,s,n.validateShaderPrograms)}function u(q,c){const U=new J,Q=X(q);return Q.parallelShaderCompile&&!Q.disableParallelShaderCompile&&(U.isParallelCompiled=!0),U.context=Q._context,U}function K(q,c,U,J){let Q=arguments.length>5?arguments[5]:void 0;const s=J.createProgram();if(q.program=s,!s)throw new Error("Unable to create program");return J.attachShader(s,c),J.attachShader(s,U),J.linkProgram(s),q.context=J,q.vertexShader=c,q.fragmentShader=U,q.isParallelCompiled||H(q,J,Q),s}function r(q,c,U){const J=q;if(J._isDisposed)return!1;const Q=X(c);return!!(Q&&Q.parallelShaderCompile&&Q.parallelShaderCompile.COMPLETION_STATUS_KHR&&J.program&&c.getProgramParameter(J.program,Q.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(H(J,c,U),!0)}function H(q,c,U){const J=q.context,Q=q.vertexShader,s=q.fragmentShader,g=q.program;if(!J.getProgramParameter(g,J.LINK_STATUS)){if(!c.getShaderParameter(Q,c.COMPILE_STATUS)){const U=c.getShaderInfoLog(Q);if(U)throw q.vertexCompilationError=U,new Error("VERTEX SHADER "+U)}if(!c.getShaderParameter(s,c.COMPILE_STATUS)){const U=c.getShaderInfoLog(s);if(U)throw q.fragmentCompilationError=U,new Error("FRAGMENT SHADER "+U)}const U=J.getProgramInfoLog(g);if(U)throw q.programLinkError=U,new Error(U)}if(U){J.validateProgram(g);if(!J.getProgramParameter(g,J.VALIDATE_STATUS)){const c=J.getProgramInfoLog(g);if(c)throw q.programValidationError=c,new Error(c)}}J.deleteShader(Q),J.deleteShader(s),q.vertexShader=void 0,q.fragmentShader=void 0,q.onCompiled&&(q.onCompiled(),q.onCompiled=void 0)}function b(q,c,U,J,Q,s,g,n,u){let K=arguments.length>10?arguments[10]:void 0,r=arguments.length>11?arguments[11]:void 0,H=arguments.length>12?arguments[12]:void 0;const b=X(q.context);r||(r=b.createRawShaderProgramInjection??W),H||(H=b.createShaderProgramInjection??D);const h=q;h.program=J?r(h,c,U,h.context,u):H(h,c,U,n,h.context,u),h.program.__SPECTOR_rebuildProgram=g,K()}function h(q,c,U,J,s,g){return o((0,Q.h)(q,U,J),c,s,g)}function o(q,c,U,J){const Q=U.createShader("vertex"===c?U.VERTEX_SHADER:U.FRAGMENT_SHADER);if(!Q){let q=U.NO_ERROR,Q=U.NO_ERROR;for(;(Q=U.getError())!==U.NO_ERROR;)q=Q;throw new Error(`Something went wrong while creating a gl ${c} shader object. gl error=${q}, gl isContextLost=${U.isContextLost()}, _contextWasLost=${J}`)}return U.shaderSource(Q,q),U.compileShader(Q),Q}function a(q,c){c.useProgram(q)}function p(q,c){const U=q;if(!U.isParallelCompiled)return void c(q);const J=U.onCompiled;U.onCompiled=()=>{null===J||void 0===J||J(),c(q)}}},11199:(q,c,U)=>{U.r(c),U.d(c,{ThinEngine:()=>R});var J=U(10969),Q=U(11201),s=U(10886),g=U(10881);class X{constructor(){this.shaderLanguage=0}postProcessor(q,c,U,J,Q){if(Q.drawBuffersExtensionDisabled){const c=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;q=q.replace(c,"")}return q}}const n=/(flat\s)?\s*varying\s*.*/;class W{constructor(){this.shaderLanguage=0}attributeProcessor(q){return q.replace("attribute","in")}varyingCheck(q,c){return n.test(q)}varyingProcessor(q,c){return q.replace("varying",c?"in":"out")}postProcessor(q,c,U){const J=-1!==q.search(/#extension.+GL_EXT_draw_buffers.+require/);if(q=(q=q.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),U){const c=-1!==q.search(/layout *\(location *= *0\) *out/g);q=(q=(q=(q=(q=(q=(q=q.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(J||c?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==c.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+q}return q}}var D=U(11208),u=U(11002),K=U(10954),r=U(11210),H=U(10976),b=U(10956),h=U(10940),o=U(10963),a=U(11218);class p{}class R extends K.d{get name(){return this._name}set name(q){this._name=q}get version(){return this._webGLVersion}static get ShadersRepository(){return b.b.ShadersRepository}static set ShadersRepository(q){b.b.ShadersRepository=q}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(q){this._framebufferDimensionsObject=q}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(q,c,U,Q){if(U=U||{},super(c??U.antialias,U,Q),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!q)return;let g=null;if(q.getContext){if(g=q,void 0===U.rD&&(U.rD=!1),void 0===U.xrCompatible&&(U.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const q=navigator.userAgent;for(const c of R.ExceptionList){const J=c.key,Q=c.targets;if(new RegExp(J).test(q)){if(c.capture&&c.captureConstraint){const U=c.capture,J=c.captureConstraint,Q=new RegExp(U).exec(q);if(Q&&Q.length>0){if(parseInt(Q[Q.length-1])>=J)continue}}for(const q of Q)switch(q){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":U.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost?this._onContextLost=()=>{(0,J.E)(this._gl)}:(this._onContextLost=q=>{q.preventDefault(),this._contextWasLost=!0,(0,J.E)(this._gl),s.c.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},g.addEventListener("webglcontextrestored",this._onContextRestored,!1),U.powerPreference=U.powerPreference||"high-performance"),g.addEventListener("webglcontextlost",this._onContextLost,!1),this._badDesktopOS&&(U.xrCompatible=!1),!U.disableWebGL2Support)try{this._gl=g.getContext("webgl2",U)||g.getContext("experimental-webgl2",U),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(u){}if(!this._gl){if(!g)throw new Error("The provided canvas is null or undefined.");try{this._gl=g.getContext("webgl",U)||g.getContext("experimental-webgl",U)}catch(u){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=q,g=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const c=this._gl.getContextAttributes();c&&(U.stencil=c.stencil)}this._sharedInit(g),this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==U.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=U.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let J=0;J<this._caps.maxVertexAttribs;J++)this._currentBufferPointers[J]=new p;this._shaderProcessor=this.webGLVersion>1?new W:new X;const n=`Babylon.js v${R.Version}`;s.c.Log(n+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",n);const D=(0,J.F)(this._gl);D.validateShaderPrograms=this.validateShaderPrograms,D.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(q){return null}areAllEffectsReady(){for(const q in this._compiledEffects){if(!this._compiledEffects[q].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1,textureNorm16:!!this._gl.getExtension("EXT_texture_norm16")},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const q=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=q&&(this._glRenderer=this._gl.getParameter(q.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(q.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.textureNorm16&&(this._gl.R16_EXT=33322,this._gl.RG16_EXT=33324,this._gl.RGB16_EXT=32852,this._gl.RGBA16_EXT=32859,this._gl.R16_SNORM_EXT=36760,this._gl.RG16_SNORM_EXT=36761,this._gl.RGB16_SNORM_EXT=36762,this._gl.RGBA16_SNORM_EXT=36763),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const q=this._gl.getExtension("WEBGL_draw_buffers");if(null!==q){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=q.drawBuffersWEBGL.bind(q),this._caps.maxDrawBuffers=this._gl.getParameter(q.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let c=0;c<16;c++)this._gl["COLOR_ATTACHMENT"+c+"_WEBGL"]=q["COLOR_ATTACHMENT"+c+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const q=this._gl.getExtension("WEBGL_depth_texture");null!=q&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=q.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const q=this._gl.getExtension("OES_vertex_array_object");null!=q&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=q.createVertexArrayOES.bind(q),this._gl.bindVertexArray=q.bindVertexArrayOES.bind(q),this._gl.deleteVertexArray=q.deleteVertexArrayOES.bind(q))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const q=this._gl.getExtension("ANGLE_instanced_arrays");null!=q?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=q.drawArraysInstancedANGLE.bind(q),this._gl.drawElementsInstanced=q.drawElementsInstancedANGLE.bind(q),this._gl.vertexAttribDivisor=q.vertexAttribDivisorANGLE.bind(q)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const q=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),c=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);q&&c&&(this._caps.highPrecisionShaderSupported=0!==q.precision&&0!==c.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const q=this._gl.getExtension("EXT_blend_minmax");null!=q&&(this._caps.blendMinMax=!0,this._gl.MAX=q.MAX_EXT,this._gl.MIN=q.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const q=this._gl.getExtension("EXT_sRGB");null!=q&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:q.SRGB_EXT,SRGB8:q.SRGB_ALPHA_EXT,SRGB8_ALPHA8:q.SRGB_ALPHA_EXT})}if(this._creationOptions){const q=this._creationOptions.forceSRGBBufferSupportState;void 0!==q&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&q)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let c=0;c<this._maxSimultaneousTextures;c++)this._nextFreeTextureSlots.push(c);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const q=this._workingCanvas.getContext("2d");q&&(this._workingContext=q)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const q=this.getGlInfo();return q&&q.renderer?q.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=Q;let s=0;if(c&&q){let c=!0;if(this._currentRenderTarget){var g;const U=null===(g=this._currentRenderTarget.texture)||void 0===g?void 0:g.format;if(8===U||9===U||10===U||11===U){var X;const U=null===(X=this._currentRenderTarget.texture)||void 0===X?void 0:X.type;7===U||5===U?(R._TempClearColorUint32[0]=255*q.r,R._TempClearColorUint32[1]=255*q.g,R._TempClearColorUint32[2]=255*q.b,R._TempClearColorUint32[3]=255*q.a,this._gl.clearBufferuiv(this._gl.COLOR,0,R._TempClearColorUint32),c=!1):(R._TempClearColorInt32[0]=255*q.r,R._TempClearColorInt32[1]=255*q.g,R._TempClearColorInt32[2]=255*q.b,R._TempClearColorInt32[3]=255*q.a,this._gl.clearBufferiv(this._gl.COLOR,0,R._TempClearColorInt32),c=!1)}}c&&(this._gl.clearColor(q.r,q.g,q.b,void 0!==q.a?q.a:1),s|=this._gl.COLOR_BUFFER_BIT)}U&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),s|=this._gl.DEPTH_BUFFER_BIT),J&&(this._gl.clearStencil(0),s|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(s)}_viewport(q,c,U,J){q===this._viewportCached.x&&c===this._viewportCached.y&&U===this._viewportCached.z&&J===this._viewportCached.w||(this._viewportCached.x=q,this._viewportCached.y=c,this._viewportCached.z=U,this._viewportCached.w=J,this._gl.viewport(q,c,U,J))}Nu(){super.Nu(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const n=q;this._currentRenderTarget&&this._resolveAndGenerateMipMapsFramebuffer(this._currentRenderTarget),this._currentRenderTarget=q,this._bindUnboundFramebuffer(n._framebuffer);const W=this._gl;var D;if(!q.isMulti)if(q.is2DArray||q.is3D)W.framebufferTextureLayer(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,null===(D=q.texture._hardwareTexture)||void 0===D?void 0:D.underlyingResource,g,X),n._currentLOD=g;else if(q.isCube){var u;W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_CUBE_MAP_POSITIVE_X+c,null===(u=q.texture._hardwareTexture)||void 0===u?void 0:u.underlyingResource,g)}else if(n._currentLOD!==g){var K;W.framebufferTexture2D(W.FRAMEBUFFER,W.COLOR_ATTACHMENT0,W.TEXTURE_2D,null===(K=q.texture._hardwareTexture)||void 0===K?void 0:K.underlyingResource,g),n._currentLOD=g}const r=q._depthStencilTexture;if(r){q.is3D&&(q.texture.width===r.width&&q.texture.height===r.height&&q.texture.depth===r.depth||s.c.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const U=q._depthStencilTextureWithStencil?W.DEPTH_STENCIL_ATTACHMENT:W.DEPTH_ATTACHMENT;var H;if(q.is2DArray||q.is3D)W.framebufferTextureLayer(W.FRAMEBUFFER,U,null===(H=r._hardwareTexture)||void 0===H?void 0:H.underlyingResource,g,X);else if(q.isCube){var b;W.framebufferTexture2D(W.FRAMEBUFFER,U,W.TEXTURE_CUBE_MAP_POSITIVE_X+c,null===(b=r._hardwareTexture)||void 0===b?void 0:b.underlyingResource,g)}else{var h;W.framebufferTexture2D(W.FRAMEBUFFER,U,W.TEXTURE_2D,null===(h=r._hardwareTexture)||void 0===h?void 0:h.underlyingResource,g)}}n._MSAAFramebuffer&&this._bindUnboundFramebuffer(n._MSAAFramebuffer),this._cachedViewport&&!Q?this.setViewport(this._cachedViewport,U,J):(U||(U=q.width,g&&(U/=Math.pow(2,g))),J||(J=q.height,g&&(J/=Math.pow(2,g))),this._viewport(0,0,U,J)),this.wipeCaches()}setStateCullFaceType(q,c){const U=this.cullBackFaces??q??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==U||c)&&(this._depthCullingState.cullFace=U)}setState(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==q||U)&&(this._depthCullingState.cull=q),this.setStateCullFaceType(Q,U),this.setZOffset(c),this.setZOffsetUnits(g);const X=J?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==X||U)&&(this._depthCullingState.frontFace=X),this._stencilStateComposer.stencilMaterial=s}_resolveAndGenerateMipMapsFramebuffer(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q.disableAutomaticMSAAResolve||(q.isMulti?this.resolveMultiFramebuffer(q):this.resolveFramebuffer(q)),c||(q.isMulti?this.generateMipMapsMultiFramebuffer(q):this.generateMipMapsFramebuffer(q))}_bindUnboundFramebuffer(q){this._currentFramebuffer!==q&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,q),this._currentFramebuffer=q)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(q){const c=this._getTextureTarget(q);this._bindTextureDirectly(c,q,!0),this._gl.generateMipmap(c),this._bindTextureDirectly(c,null)}unBindFramebuffer(q,c,U){const J=q;this._currentRenderTarget=null,this._resolveAndGenerateMipMapsFramebuffer(q,c),U&&(J._MSAAFramebuffer&&this._bindUnboundFramebuffer(J._framebuffer),U()),this._bindUnboundFramebuffer(null)}generateMipMapsFramebuffer(q){var c;q.isMulti||null===(c=q.texture)||void 0===c||!c.generateMipMaps||q.isCube||this.generateMipmaps(q.texture)}resolveFramebuffer(q){const c=q,U=this._gl;if(!c._MSAAFramebuffer||c.isMulti)return;let J=c.resolveMSAAColors?U.COLOR_BUFFER_BIT:0;J|=c._generateDepthBuffer&&c.resolveMSAADepth?U.DEPTH_BUFFER_BIT:0,J|=c._generateStencilBuffer&&c.resolveMSAAStencil?U.STENCIL_BUFFER_BIT:0,U.bindFramebuffer(U.READ_FRAMEBUFFER,c._MSAAFramebuffer),U.bindFramebuffer(U.DRAW_FRAMEBUFFER,c._framebuffer),U.blitFramebuffer(0,0,q.width,q.height,0,0,q.width,q.height,J,U.NEAREST)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(q,c,U){return this._createVertexBuffer(q,this._gl.STATIC_DRAW)}_createVertexBuffer(q,c){const U=this._gl.createBuffer();if(!U)throw new Error("Unable to create vertex buffer");const J=new D.c(U);return this.bindArrayBuffer(J),"number"!==typeof q?q instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(q),c),J.WU=4*q.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,q,c),J.WU=q.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(q),c),J.WU=q),this._resetVertexBufferBinding(),J.references=1,J}createDynamicVertexBuffer(q,c){return this._createVertexBuffer(q,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(q,c,U){const J=this._gl.createBuffer(),Q=new D.c(J);if(!J)throw new Error("Unable to create index buffer");this.bindIndexBuffer(Q);const s=this._normalizeIndexData(q);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,s,c?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),Q.references=1,Q.is32Bits=4===s.BYTES_PER_ELEMENT,Q}_normalizeIndexData(q){if(2===q.BYTES_PER_ELEMENT)return q;if(this._caps.uintIndices){if(q instanceof Uint32Array)return q;for(let c=0;c<q.length;c++)if(q[c]>=65535)return new Uint32Array(q);return new Uint16Array(q)}return new Uint16Array(q)}bindArrayBuffer(q){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(q,this._gl.ARRAY_BUFFER)}bindUniformBlock(q,c,U){const J=q.program,Q=this._gl.getUniformBlockIndex(J,c);this._gl.uniformBlockBinding(J,Q,U)}bindIndexBuffer(q){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(q,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(q,c){(this._vaoRecordInProgress||this._currentBoundBuffer[c]!==q)&&(this._gl.bindBuffer(c,q?q.underlyingResource:null),this._currentBoundBuffer[c]=q)}updateArrayBuffer(q){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,q)}_vertexAttribPointer(q,c,U,J,Q,s,g){const X=this._currentBufferPointers[c];if(!X)return;let n=!1;X.active?(X.buffer!==q&&(X.buffer=q,n=!0),X.size!==U&&(X.size=U,n=!0),X.type!==J&&(X.type=J,n=!0),X.normalized!==Q&&(X.normalized=Q,n=!0),X.stride!==s&&(X.stride=s,n=!0),X.offset!==g&&(X.offset=g,n=!0)):(n=!0,X.active=!0,X.index=c,X.size=U,X.type=J,X.normalized=Q,X.stride=s,X.offset=g,X.buffer=q),(n||this._vaoRecordInProgress)&&(this.bindArrayBuffer(q),J===this._gl.UNSIGNED_INT||J===this._gl.INT?this._gl.vertexAttribIPointer(c,U,J,s,g):this._gl.vertexAttribPointer(c,U,J,Q,s,g))}_bindIndexBufferWithCache(q){null!=q&&this._cachedIndexBuffer!==q&&(this._cachedIndexBuffer=q,this.bindIndexBuffer(q),this._uintIndicesCurrentlySet=q.is32Bits)}_bindVertexBuffersAttributes(q,c,U){const J=c.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let Q=0;Q<J.length;Q++){const s=c.getAttributeLocation(Q);if(s>=0){const c=J[Q];let g=null;if(U&&(g=U[c]),g||(g=q[c]),!g)continue;this._gl.enableVertexAttribArray(s),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[s]=!0);const X=g.getBuffer();X&&(this._vertexAttribPointer(X,s,g.getSize(),g.type,g.normalized,g.byteStride,g.byteOffset),g.getIsInstanced()&&(this._gl.vertexAttribDivisor(s,g.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(s),this._currentInstanceBuffers.push(X))))}}}recordVertexArrayObject(q,c,U,J){const Q=this._gl.createVertexArray();if(!Q)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(Q),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(q,U,J),this.bindIndexBuffer(c),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),Q}bindVertexArrayObject(q,c){this._cachedVertexArrayObject!==q&&(this._cachedVertexArrayObject=q,this._gl.bindVertexArray(q),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=c&&c.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(q,c,U,J,Q){if(this._cachedVertexBuffers!==q||this._cachedEffectForVertexBuffers!==Q){this._cachedVertexBuffers=q,this._cachedEffectForVertexBuffers=Q;const c=Q.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let s=0;for(let g=0;g<c;g++)if(g<U.length){const c=Q.getAttributeLocation(g);c>=0&&(this._gl.enableVertexAttribArray(c),this._vertexAttribArraysEnabled[c]=!0,this._vertexAttribPointer(q,c,U[g],this._gl.FLOAT,!1,J,s)),s+=4*U[g]}}this._bindIndexBufferWithCache(c)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(q,c,U,J){this._cachedVertexBuffers===q&&this._cachedEffectForVertexBuffers===U||(this._cachedVertexBuffers=q,this._cachedEffectForVertexBuffers=U,this._bindVertexBuffersAttributes(q,U,J)),this._bindIndexBufferWithCache(c)}unbindInstanceAttributes(){let q;for(let c=0,U=this._currentInstanceLocations.length;c<U;c++){const U=this._currentInstanceBuffers[c];q!=U&&U.references&&(q=U,this.bindArrayBuffer(U));const J=this._currentInstanceLocations[c];this._gl.vertexAttribDivisor(J,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(q){this._gl.deleteVertexArray(q)}_releaseBuffer(q){return q.references--,0===q.references&&(this._deleteBuffer(q),!0)}_deleteBuffer(q){this._gl.deleteBuffer(q.underlyingResource)}updateAndBindInstancesBuffer(q,c,U){if(this.bindArrayBuffer(q),c&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,c),void 0!==U[0].index)this.bindInstancesBuffer(q,U,!0);else for(let J=0;J<4;J++){const c=U[J];this._vertexAttribArraysEnabled[c]||(this._gl.enableVertexAttribArray(c),this._vertexAttribArraysEnabled[c]=!0),this._vertexAttribPointer(q,c,4,this._gl.FLOAT,!1,64,16*J),this._gl.vertexAttribDivisor(c,1),this._currentInstanceLocations.push(c),this._currentInstanceBuffers.push(q)}}bindInstancesBuffer(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(q);let J=0;if(U)for(let Q=0;Q<c.length;Q++){J+=4*c[Q].attributeSize}for(let Q=0;Q<c.length;Q++){const U=c[Q];void 0===U.index&&(U.index=this._currentEffect.getAttributeLocationByName(U.attributeName)),U.index<0||(this._vertexAttribArraysEnabled[U.index]||(this._gl.enableVertexAttribArray(U.index),this._vertexAttribArraysEnabled[U.index]=!0),this._vertexAttribPointer(q,U.index,U.attributeSize,U.attributeType||this._gl.FLOAT,U.normalized||!1,J,U.offset),this._gl.vertexAttribDivisor(U.index,void 0===U.divisor?1:U.divisor),this._currentInstanceLocations.push(U.index),this._currentInstanceBuffers.push(q))}}disableInstanceAttributeByName(q){if(!this._currentEffect)return;const c=this._currentEffect.getAttributeLocationByName(q);this.disableInstanceAttribute(c)}disableInstanceAttribute(q){let c,U=!1;for(;-1!==(c=this._currentInstanceLocations.indexOf(q));)this._currentInstanceLocations.splice(c,1),this._currentInstanceBuffers.splice(c,1),U=!0,c=this._currentInstanceLocations.indexOf(q);U&&(this._gl.vertexAttribDivisor(q,0),this.disableAttributeByIndex(q))}disableAttributeByIndex(q){this._gl.disableVertexAttribArray(q),this._vertexAttribArraysEnabled[q]=!1,this._currentBufferPointers[q].active=!1}draw(q,c,U,J){this.drawElementsType(q?0:1,c,U,J)}drawPointClouds(q,c,U){this.drawArraysType(2,q,c,U)}drawUnIndexed(q,c,U,J){this.drawArraysType(q?0:1,c,U,J)}drawElementsType(q,c,U,J){this.applyStates(),this._reportDrawCall();const Q=this._drawMode(q),s=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,g=this._uintIndicesCurrentlySet?4:2;J?this._gl.drawElementsInstanced(Q,U,s,c*g,J):this._gl.drawElements(Q,U,s,c*g)}drawArraysType(q,c,U,J){this.applyStates(),this._reportDrawCall();const Q=this._drawMode(q);J?this._gl.drawArraysInstanced(Q,c,U,J):this._gl.drawArrays(Q,c,U)}_drawMode(q){switch(q){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(q){this._compiledEffects[q._key]&&delete this._compiledEffects[q._key];const c=q.getPipelineContext();c&&this._deletePipelineContext(c)}_deletePipelineContext(q){const c=q;c&&c.program&&(c.program.__SPECTOR_rebuildProgram=null,(0,o.k)(c),this._gl&&(this._currentProgram===c.program&&this._setProgram(null),this._gl.deleteProgram(c.program)))}_getGlobalDefines(q){return(0,h.l)(q,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(q,c,U,Q,s,g,X,n,W){let D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,u=arguments.length>10?arguments[10]:void 0;const K="string"===typeof q?q:q.vertexToken||q.vertexSource||q.vertexElement||q.vertex,r="string"===typeof q?q:q.fragmentToken||q.fragmentSource||q.fragmentElement||q.fragment,H=this._getGlobalDefines(),h=void 0!==c.attributes;let o=s??c.defines??"";H&&(o+=H);const a=K+"+"+r+"@"+o;if(this._compiledEffects[a]){const q=this._compiledEffects[a];return X&&q.isReady()&&X(q),q._refCount++,q}this._gl&&(0,J.F)(this._gl);const p=new b.b(q,c,h?this:U,Q,this,s,g,X,n,W,a,c.shaderLanguage??D,c.extraInitializationsAsync??u);return this._compiledEffects[a]=p,p}_getShaderSource(q){return this._gl.getShaderSource(q)}createRawShaderProgram(q,c,U,Q){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const g=(0,J.F)(this._gl);return g._contextWasLost=this._contextWasLost,g.validateShaderPrograms=this.validateShaderPrograms,(0,J.x)(q,c,U,Q||this._gl,s)}createShaderProgram(q,c,U,Q,s){let g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const X=(0,J.F)(this._gl);return X._contextWasLost=this._contextWasLost,X.validateShaderPrograms=this.validateShaderPrograms,(0,J.A)(q,c,U,Q,s||this._gl,g)}inlineShaderCode(q){return q}createPipelineContext(q){if(this._gl){(0,J.F)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const c=(0,J.v)(this._gl,q);return c.yX=this,c}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(q){return(0,J.k)(q,this._gl,this.validateShaderPrograms)}_preparePipelineContextAsync(q,c,U,Q,s,g,X,n,W,D,u){const K=(0,J.F)(this._gl);return K._contextWasLost=this._contextWasLost,K.validateShaderPrograms=this.validateShaderPrograms,K._createShaderProgramInjection=this._createShaderProgram.bind(this),K.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),K.createShaderProgramInjection=this.createShaderProgram.bind(this),K.loadFileInjection=this._loadFile.bind(this),(0,J.p)(q,c,U,Q,s,g,X,n,W,D,u)}_createShaderProgram(q,c,U,Q){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,J.e)(q,c,U,Q,s)}_isRenderingStateCompiled(q){return!this._isDisposed&&(0,J.l)(q,this._gl,this.validateShaderPrograms)}_executeWhenRenderingStateIsCompiled(q,c){(0,J.g)(q,c)}getUniforms(q,c){const U=new Array,J=q;for(let Q=0;Q<c.length;Q++)U.push(this._gl.getUniformLocation(J.program,c[Q]));return U}getAttributes(q,c){const U=[],J=q;for(let s=0;s<c.length;s++)try{U.push(this._gl.getAttribLocation(J.program,c[s]))}catch(Q){U.push(-1)}return U}enableEffect(q){(q=null!==q&&(0,Q.c)(q)?q.effect:q)&&q!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(q),this._currentEffect=q,q.onBind&&q.onBind(q),q._onBindObservable&&q._onBindObservable.notifyObservers(q))}setInt(q,c){return!!q&&(this._gl.uniform1i(q,c),!0)}setInt2(q,c,U){return!!q&&(this._gl.uniform2i(q,c,U),!0)}setInt3(q,c,U,J){return!!q&&(this._gl.uniform3i(q,c,U,J),!0)}setInt4(q,c,U,J,Q){return!!q&&(this._gl.uniform4i(q,c,U,J,Q),!0)}setIntArray(q,c){return!!q&&(this._gl.uniform1iv(q,c),!0)}setIntArray2(q,c){return!(!q||c.length%2!==0)&&(this._gl.uniform2iv(q,c),!0)}setIntArray3(q,c){return!(!q||c.length%3!==0)&&(this._gl.uniform3iv(q,c),!0)}setIntArray4(q,c){return!(!q||c.length%4!==0)&&(this._gl.uniform4iv(q,c),!0)}setUInt(q,c){return!!q&&(this._gl.uniform1ui(q,c),!0)}setUInt2(q,c,U){return!!q&&(this._gl.uniform2ui(q,c,U),!0)}setUInt3(q,c,U,J){return!!q&&(this._gl.uniform3ui(q,c,U,J),!0)}setUInt4(q,c,U,J,Q){return!!q&&(this._gl.uniform4ui(q,c,U,J,Q),!0)}setUIntArray(q,c){return!!q&&(this._gl.uniform1uiv(q,c),!0)}setUIntArray2(q,c){return!(!q||c.length%2!==0)&&(this._gl.uniform2uiv(q,c),!0)}setUIntArray3(q,c){return!(!q||c.length%3!==0)&&(this._gl.uniform3uiv(q,c),!0)}setUIntArray4(q,c){return!(!q||c.length%4!==0)&&(this._gl.uniform4uiv(q,c),!0)}setArray(q,c){return!!q&&(!(c.length<1)&&(this._gl.uniform1fv(q,c),!0))}setArray2(q,c){return!(!q||c.length%2!==0)&&(this._gl.uniform2fv(q,c),!0)}setArray3(q,c){return!(!q||c.length%3!==0)&&(this._gl.uniform3fv(q,c),!0)}setArray4(q,c){return!(!q||c.length%4!==0)&&(this._gl.uniform4fv(q,c),!0)}setMatrices(q,c){return!!q&&(this._gl.uniformMatrix4fv(q,!1,c),!0)}setMatrix3x3(q,c){return!!q&&(this._gl.uniformMatrix3fv(q,!1,c),!0)}setMatrix2x2(q,c){return!!q&&(this._gl.uniformMatrix2fv(q,!1,c),!0)}setFloat(q,c){return!!q&&(this._gl.uniform1f(q,c),!0)}setFloat2(q,c,U){return!!q&&(this._gl.uniform2f(q,c,U),!0)}setFloat3(q,c,U,J){return!!q&&(this._gl.uniform3f(q,c,U,J),!0)}setFloat4(q,c,U,J,Q){return!!q&&(this._gl.uniform4f(q,c,U,J,Q),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const q=this._colorWrite;this._gl.colorMask(q,q,q,q)}}wipeCaches(q){this.preventCacheWipeBetweenFrames&&!q||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),q&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(q,c){const U=this._gl;let J=U.NEAREST,Q=U.NEAREST,s=!1;switch(q){case 11:J=U.LINEAR,Q=c?U.LINEAR_MIPMAP_NEAREST:U.LINEAR;break;case 3:J=U.LINEAR,s=!0,Q=c?U.LINEAR_MIPMAP_LINEAR:U.LINEAR;break;case 8:s=!0,J=U.NEAREST,Q=c?U.NEAREST_MIPMAP_LINEAR:U.NEAREST;break;case 4:J=U.NEAREST,Q=c?U.NEAREST_MIPMAP_NEAREST:U.NEAREST;break;case 5:J=U.NEAREST,Q=c?U.LINEAR_MIPMAP_NEAREST:U.LINEAR;break;case 6:s=!0,J=U.NEAREST,Q=c?U.LINEAR_MIPMAP_LINEAR:U.LINEAR;break;case 7:J=U.NEAREST,Q=U.LINEAR;break;case 1:J=U.NEAREST,Q=U.NEAREST;break;case 9:J=U.LINEAR,Q=c?U.NEAREST_MIPMAP_NEAREST:U.NEAREST;break;case 10:s=!0,J=U.LINEAR,Q=c?U.NEAREST_MIPMAP_LINEAR:U.NEAREST;break;case 2:J=U.LINEAR,Q=U.LINEAR;break;case 12:J=U.LINEAR,Q=U.NEAREST}return{min:Q,mag:J,hasMipMaps:s}}_createTexture(){const q=this._gl.createTexture();if(!q)throw new Error("Unable to create texture");return q}_createHardwareTexture(){return new r.e(this._createTexture(),this._gl)}_createInternalTexture(q,c){let U,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=!1,g=!1,X=0,n=3,W=5,D=!1,u=1,K=!1,r=0;void 0!==c&&"object"===typeof c?(Q=!!c.generateMipMaps,g=!!c.createMipMaps,X=void 0===c.type?0:c.type,n=void 0===c.samplingMode?3:c.samplingMode,W=void 0===c.format?5:c.format,D=void 0!==c.useSRGBBuffer&&c.useSRGBBuffer,u=c.samples??1,U=c.label,K=!!c.createMSAATexture,r=c.comparisonFunction||0):Q=!!c,D&&(D=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==X||this._caps.textureFloatLinearFiltering)&&(2!==X||this._caps.textureHalfFloatLinearFiltering)||(n=1),1!==X||this._caps.textureFloat||(X=0,s.c.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const b=(0,a.i)(W),h=(0,a.e)(W),o=this._gl,p=new H.e(this,J),R=q.width||q,I=q.height||q,t=q.depth||0,C=q.layers||0,i=this._getSamplingParameters(n,(Q||g)&&!b),F=0!==C?o.TEXTURE_2D_ARRAY:0!==t?o.TEXTURE_3D:o.TEXTURE_2D,v=b?this._getInternalFormatFromDepthTextureFormat(W,!0,h):this._getRGBABufferInternalSizedFormat(X,W,D),Y=b?h?o.DEPTH_STENCIL:o.DEPTH_COMPONENT:this._getInternalFormat(W),k=b?this._getWebGLTextureTypeFromDepthTextureFormat(W):this._getWebGLTextureType(X);if(this._bindTextureDirectly(F,p),0!==C?(p.is2DArray=!0,o.texImage3D(F,0,v,R,I,C,0,Y,k,null)):0!==t?(p.is3D=!0,o.texImage3D(F,0,v,R,I,t,0,Y,k,null)):o.texImage2D(F,0,v,R,I,0,Y,k,null),o.texParameteri(F,o.TEXTURE_MAG_FILTER,i.mag),o.texParameteri(F,o.TEXTURE_MIN_FILTER,i.min),o.texParameteri(F,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(F,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),b&&this.webGLVersion>1&&(0===r?(o.texParameteri(F,o.TEXTURE_COMPARE_FUNC,515),o.texParameteri(F,o.TEXTURE_COMPARE_MODE,o.NONE)):(o.texParameteri(F,o.TEXTURE_COMPARE_FUNC,r),o.texParameteri(F,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE))),(Q||g)&&this._gl.generateMipmap(F),this._bindTextureDirectly(F,null),p._useSRGBBuffer=D,p.baseWidth=R,p.baseHeight=I,p.width=R,p.height=I,p.depth=C||t,p.isReady=!0,p.samples=u,p.generateMipMaps=Q,p.samplingMode=n,p.type=X,p.format=W,p.label=U,p.comparisonFunction=r,this._internalTexturesCache.push(p),K){let q=null;if(q=(0,a.i)(p.format)?this._setupFramebufferDepthAttachments((0,a.e)(p.format),19!==p.format,p.width,p.height,u,p.format,!0):this._createRenderBuffer(p.width,p.height,u,-1,this._getRGBABufferInternalSizedFormat(p.type,p.format,p._useSRGBBuffer),-1),!q)throw new Error("Unable to create render buffer");p._autoMSAAManagement=!0;let c=p._hardwareTexture;c||(c=p._hardwareTexture=this._createHardwareTexture()),c.addMSAARenderBuffer(q)}return p}_getUseSRGBBuffer(q,c){return q&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||c)}createTexture(q,c,U,J){var Q=this;let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,u=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,K=arguments.length>11?arguments[11]:void 0,r=arguments.length>12?arguments[12]:void 0,b=arguments.length>13?arguments[13]:void 0,h=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(q,c,U,J,s,g,X,(function(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];return Q._prepareWebGLTexture(...c,D)}),((q,c,U,Q,s,g)=>{const X=this._gl,n=U.width===q&&U.height===c;s._creationFlags=b??0;const W=this._getTexImageParametersForCreateTexture(s.format,s._useSRGBBuffer);if(n)return X.texImage2D(X.TEXTURE_2D,0,W.internalFormat,W.format,W.type,U),!1;const D=this._caps.maxTextureSize;if(U.width>D||U.height>D||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=q,this._workingCanvas.height=c,this._workingContext.drawImage(U,0,0,U.width,U.height,0,0,q,c),X.texImage2D(X.TEXTURE_2D,0,W.internalFormat,W.format,W.type,this._workingCanvas),s.width=q,s.height=c,!1);{const q=new H.e(this,2);this._bindTextureDirectly(X.TEXTURE_2D,q,!0),X.texImage2D(X.TEXTURE_2D,0,W.internalFormat,W.format,W.type,U),this._rescaleTexture(q,s,J,W.format,(()=>{this._releaseTexture(q),this._bindTextureDirectly(X.TEXTURE_2D,s,!0),g()}))}return!0}),n,W,D,u,K,r,h)}_getTexImageParametersForCreateTexture(q,c){let U,J;return 1===this.webGLVersion?(U=this._getInternalFormat(q,c),J=U):(U=this._getInternalFormat(q,!1),J=this._getRGBABufferInternalSizedFormat(0,q,c)),{internalFormat:J,format:U,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(q,c,U,J,Q){}_unpackFlipY(q){this._unpackFlipYCached!==q&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,q?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=q))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(q){return q.isCube?this._gl.TEXTURE_CUBE_MAP:q.is3D?this._gl.TEXTURE_3D:q.is2DArray||q.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=this._getTextureTarget(c),Q=this._getSamplingParameters(q,c.useMipMaps||U);this._setTextureParameterInteger(J,this._gl.TEXTURE_MAG_FILTER,Q.mag,c),this._setTextureParameterInteger(J,this._gl.TEXTURE_MIN_FILTER,Q.min),U&&Q.hasMipMaps&&(c.generateMipMaps=!0,this._gl.generateMipmap(J)),this._bindTextureDirectly(J,null),c.samplingMode=q}updateTextureDimensions(q,c,U){}updateTextureWrappingMode(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Q=this._getTextureTarget(q);null!==c&&(this._setTextureParameterInteger(Q,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(c),q),q._cachedWrapU=c),null!==U&&(this._setTextureParameterInteger(Q,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(U),q),q._cachedWrapV=U),(q.is2DArray||q.is3D)&&null!==J&&(this._setTextureParameterInteger(Q,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(J),q),q._cachedWrapR=J),this._bindTextureDirectly(Q,null)}_uploadCompressedDataToTextureDirectly(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const X=this._gl;let n=X.TEXTURE_2D;if(q.isCube&&(n=X.TEXTURE_CUBE_MAP_POSITIVE_X+s),q._useSRGBBuffer)switch(c){case 37492:case 36196:this._caps.etc2?c=X.COMPRESSED_SRGB8_ETC2:q._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?c=X.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:q._useSRGBBuffer=!1;break;case 36492:c=X.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:c=X.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?c=X.COMPRESSED_SRGB_S3TC_DXT1_EXT:q._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?c=X.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:q._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?c=X.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:q._useSRGBBuffer=!1;break;default:q._useSRGBBuffer=!1}this._gl.compressedTexImage2D(n,g,c,U,J,0,Q)}_uploadDataToTextureDirectly(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const g=this._gl,X=this._getWebGLTextureType(q.type),n=this._getInternalFormat(q.format),W=void 0===Q?this._getRGBABufferInternalSizedFormat(q.type,q.format,q._useSRGBBuffer):this._getInternalFormat(Q,q._useSRGBBuffer);this._unpackFlipY(q.invertY);let D=g.TEXTURE_2D;q.isCube&&(D=g.TEXTURE_CUBE_MAP_POSITIVE_X+U);const u=Math.round(Math.log(q.width)*Math.LOG2E),K=Math.round(Math.log(q.height)*Math.LOG2E),r=s?q.width:Math.pow(2,Math.max(u-J,0)),H=s?q.height:Math.pow(2,Math.max(K-J,0));g.texImage2D(D,J,W,r,H,0,n,X,c)}updateTextureData(q,c,U,J,Q,s){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const W=this._gl,D=this._getWebGLTextureType(q.type),u=this._getInternalFormat(q.format);this._unpackFlipY(q.invertY);let K=W.TEXTURE_2D,r=W.TEXTURE_2D;q.isCube&&(r=W.TEXTURE_CUBE_MAP_POSITIVE_X+g,K=W.TEXTURE_CUBE_MAP),this._bindTextureDirectly(K,q,!0),W.texSubImage2D(r,X,U,J,Q,s,u,D,c),n&&this._gl.generateMipmap(r),this._bindTextureDirectly(K,null)}_uploadArrayBufferViewToTexture(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const Q=this._gl,s=q.isCube?Q.TEXTURE_CUBE_MAP:Q.TEXTURE_2D;this._bindTextureDirectly(s,q,!0),this._uploadDataToTextureDirectly(q,c,U,J),this._bindTextureDirectly(s,null,!0)}_prepareWebGLTextureContinuation(q,c,U,J,Q){const s=this._gl;if(!s)return;const g=this._getSamplingParameters(Q,!U);s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,g.mag),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,g.min),U||J||s.generateMipmap(s.TEXTURE_2D),this._bindTextureDirectly(s.TEXTURE_2D,null),c&&c.removePendingData(q),q.onLoadedObservable.notifyObservers(q),q.onLoadedObservable.clear()}_prepareWebGLTexture(q,c,U,J,Q,s,g,X,n,W){const D=this.getCaps().maxTextureSize,K=Math.min(D,this.needPOTTextures?(0,u.h)(J.width,D):J.width),r=Math.min(D,this.needPOTTextures?(0,u.h)(J.height,D):J.height),H=this._gl;H&&(q._hardwareTexture?(this._bindTextureDirectly(H.TEXTURE_2D,q,!0),this._unpackFlipY(void 0===Q||!!Q),q.baseWidth=J.width,q.baseHeight=J.height,q.width=K,q.height=r,q.isReady=!0,q.type=-1!==q.type?q.type:0,q.format=-1!==q.format?q.format:W??(".jpg"!==c||q._useSRGBBuffer?5:4),X(K,r,J,c,q,(()=>{this._prepareWebGLTextureContinuation(q,U,s,g,n)}))||this._prepareWebGLTextureContinuation(q,U,s,g,n)):U&&U.removePendingData(q))}_getInternalFormatFromDepthTextureFormat(q,c,U){const J=this._gl;if(!c)return J.STENCIL_INDEX8;let Q=U?J.DEPTH_STENCIL:J.DEPTH_COMPONENT;return this.webGLVersion>1?15===q?Q=J.DEPTH_COMPONENT16:16===q?Q=J.DEPTH_COMPONENT24:17===q||13===q?Q=U?J.DEPTH24_STENCIL8:J.DEPTH_COMPONENT24:14===q?Q=J.DEPTH_COMPONENT32F:18===q&&(Q=U?J.DEPTH32F_STENCIL8:J.DEPTH_COMPONENT32F):Q=J.DEPTH_COMPONENT16,Q}_getWebGLTextureTypeFromDepthTextureFormat(q){const c=this._gl;let U=c.UNSIGNED_INT;return 15===q?U=c.UNSIGNED_SHORT:17===q||13===q?U=c.UNSIGNED_INT_24_8:14===q?U=c.FLOAT:18===q?U=c.FLOAT_32_UNSIGNED_INT_24_8_REV:19===q&&(U=c.UNSIGNED_BYTE),U}_setupFramebufferDepthAttachments(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,s=arguments.length>5?arguments[5]:void 0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const X=this._gl;s=s??(q?13:14);const n=this._getInternalFormatFromDepthTextureFormat(s,c,q);return q&&c?this._createRenderBuffer(U,J,Q,X.DEPTH_STENCIL,n,g?-1:X.DEPTH_STENCIL_ATTACHMENT):c?this._createRenderBuffer(U,J,Q,n,n,g?-1:X.DEPTH_ATTACHMENT):q?this._createRenderBuffer(U,J,Q,n,n,g?-1:X.STENCIL_ATTACHMENT):null}_createRenderBuffer(q,c,U,J,Q,s){let g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const X=this._gl.createRenderbuffer();return this._updateRenderBuffer(X,q,c,U,J,Q,s,g)}_updateRenderBuffer(q,c,U,J,Q,s,g){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const n=this._gl;return n.bindRenderbuffer(n.RENDERBUFFER,q),J>1&&n.renderbufferStorageMultisample?n.renderbufferStorageMultisample(n.RENDERBUFFER,J,s,c,U):n.renderbufferStorage(n.RENDERBUFFER,Q,c,U),-1!==g&&n.framebufferRenderbuffer(n.FRAMEBUFFER,g,n.RENDERBUFFER,q),X&&n.bindRenderbuffer(n.RENDERBUFFER,null),q}_releaseTexture(q){this._deleteTexture(q._hardwareTexture),this.unbindAllTextures();const c=this._internalTexturesCache.indexOf(q);-1!==c&&this._internalTexturesCache.splice(c,1),q._lodTextureHigh&&q._lodTextureHigh.dispose(),q._lodTextureMid&&q._lodTextureMid.dispose(),q._lodTextureLow&&q._lodTextureLow.dispose(),q._irradianceTexture&&q._irradianceTexture.dispose()}_deleteTexture(q){null===q||void 0===q||q.release()}_setProgram(q){this._currentProgram!==q&&((0,J.t)(q,this._gl),this._currentProgram=q)}bindSamplers(q){const c=q.getPipelineContext();this._setProgram(c.program);const U=q.getSamplers();for(let J=0;J<U.length;J++){const c=q.getUniform(U[J]);c&&(this._boundUniforms[J]=c)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=!1;const g=c&&c._associatedChannel>-1;U&&g&&(this._activeChannel=c._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==c||J){if(this._activateCurrentTexture(),c&&c.isMultiview)throw s.c.Error(["_bindTextureDirectly called with a multiview texture!",q,c]),"_bindTextureDirectly called with a multiview texture!";var X;this._gl.bindTexture(q,(null===c||void 0===c||null===(X=c._hardwareTexture)||void 0===X?void 0:X.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=c,c&&(c._associatedChannel=this._activeChannel)}else U&&(Q=!0,this._activateCurrentTexture());return g&&!U&&this._bindSamplerUniformToChannel(c._associatedChannel,this._activeChannel),Q}_bindTexture(q,c,U){if(void 0===q)return;c&&(c._associatedChannel=q),this._activeChannel=q;const J=c?this._getTextureTarget(c):this._gl.TEXTURE_2D;this._bindTextureDirectly(J,c)}unbindAllTextures(){for(let q=0;q<this._maxSimultaneousTextures;q++)this._activeChannel=q,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(q,c,U,J){void 0!==q&&(c&&(this._boundUniforms[q]=c),this._setTexture(q,U))}_bindSamplerUniformToChannel(q,c){const U=this._boundUniforms[q];U&&U._currentState!==c&&(this._gl.uniform1i(U,c),U._currentState=c)}_getTextureWrapMode(q){switch(q){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(q,c){let U,J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!c)return null!=this._boundTexturesCache[q]&&(this._activeChannel=q,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(c.video){this._activeChannel=q;const U=c.getInternalTexture();U&&(U._associatedChannel=q),c.update()}else if(4===c.delayLoadState)return c.delayLoad(),!1;U=Q?c.depthStencilTexture:c.isReady()?c.getInternalTexture():c.isCube?this.emptyCubeTexture:c.is3D?this.emptyTexture3D:c.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!J&&U&&(U._associatedChannel=q);let s=!0;this._boundTexturesCache[q]===U&&(J||this._bindSamplerUniformToChannel(U._associatedChannel,q),s=!1),this._activeChannel=q;const g=this._getTextureTarget(U);if(s&&this._bindTextureDirectly(g,U,J),U&&!U.isMultiview){if(U.isCube&&U._cachedCoordinatesMode!==c.coordinatesMode){U._cachedCoordinatesMode=c.coordinatesMode;const q=3!==c.coordinatesMode&&5!==c.coordinatesMode?1:0;c.wrapU=q,c.wrapV=q}U._cachedWrapU!==c.wrapU&&(U._cachedWrapU=c.wrapU,this._setTextureParameterInteger(g,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(c.wrapU),U)),U._cachedWrapV!==c.wrapV&&(U._cachedWrapV=c.wrapV,this._setTextureParameterInteger(g,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(c.wrapV),U)),U.is3D&&U._cachedWrapR!==c.wrapR&&(U._cachedWrapR=c.wrapR,this._setTextureParameterInteger(g,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(c.wrapR),U)),this._setAnisotropicLevel(g,U,c.anisotropicFilteringLevel)}return!0}setTextureArray(q,c,U,J){if(void 0!==q&&c){this._textureUnits&&this._textureUnits.length===U.length||(this._textureUnits=new Int32Array(U.length));for(let c=0;c<U.length;c++){const J=U[c].getInternalTexture();J?(this._textureUnits[c]=q+c,J._associatedChannel=q+c):this._textureUnits[c]=-1}this._gl.uniform1iv(c,this._textureUnits);for(let q=0;q<U.length;q++)this._setTexture(this._textureUnits[q],U[q],!0)}}_setAnisotropicLevel(q,c,U){const J=this._caps.textureAnisotropicFilterExtension;11!==c.samplingMode&&3!==c.samplingMode&&2!==c.samplingMode&&(U=1),J&&c._cachedAnisotropicFilteringLevel!==U&&(this._setTextureParameterFloat(q,J.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(U,this._caps.maxAnisotropy),c),c._cachedAnisotropicFilteringLevel=U)}_setTextureParameterFloat(q,c,U,J){this._bindTextureDirectly(q,J,!0,!0),this._gl.texParameterf(q,c,U)}_setTextureParameterInteger(q,c,U,J){J&&this._bindTextureDirectly(q,J,!0,!0),this._gl.texParameteri(q,c,U)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let q=0;q<this._caps.maxVertexAttribs;q++)this.disableAttributeByIndex(q)}else for(let q=0,c=this._vertexAttribArraysEnabled.length;q<c;q++)q>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[q]||this.disableAttributeByIndex(q)}releaseEffects(){this._compiledEffects={},this.onReleaseEffectsObservable.notifyObservers(this)}dispose(){var q;((0,g.j)()&&this._renderingCanvas&&(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._onContextRestored&&this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored)),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(q=this._gl.getExtension("WEBGL_lose_context"))||void 0===q||q.loseContext());(0,J.E)(this._gl)}attachContextLostEvent(q){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",q,!1)}attachContextRestoredEvent(q){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",q,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(q){const c=this._gl;for(;c.getError()!==c.NO_ERROR;);let U=!0;const J=c.createTexture();c.bindTexture(c.TEXTURE_2D,J),c.texImage2D(c.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(q),1,1,0,c.RGBA,this._getWebGLTextureType(q),null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.NEAREST),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.NEAREST);const Q=c.createFramebuffer();c.bindFramebuffer(c.FRAMEBUFFER,Q),c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,J,0);const s=c.checkFramebufferStatus(c.FRAMEBUFFER);if(U=U&&s===c.FRAMEBUFFER_COMPLETE,U=U&&c.getError()===c.NO_ERROR,U&&(c.clear(c.COLOR_BUFFER_BIT),U=U&&c.getError()===c.NO_ERROR),U){c.bindFramebuffer(c.FRAMEBUFFER,null);const q=c.RGBA,J=c.UNSIGNED_BYTE,Q=new Uint8Array(4);c.readPixels(0,0,1,1,q,J,Q),U=U&&c.getError()===c.NO_ERROR}for(c.deleteTexture(J),c.deleteFramebuffer(Q),c.bindFramebuffer(c.FRAMEBUFFER,null);!U&&c.getError()!==c.NO_ERROR;);return U}_getWebGLTextureType(q){if(1===this._webGLVersion){switch(q){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(q){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=c?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(q){case 0:U=this._gl.ALPHA;break;case 1:U=this._gl.LUMINANCE;break;case 2:U=this._gl.LUMINANCE_ALPHA;break;case 6:case 33322:case 36760:U=this._gl.RED;break;case 7:case 33324:case 36761:U=this._gl.RG;break;case 4:case 32852:case 36762:U=c?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:case 32859:case 36763:U=c?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(q){case 8:U=this._gl.RED_INTEGER;break;case 9:U=this._gl.RG_INTEGER;break;case 10:U=this._gl.RGB_INTEGER;break;case 11:U=this._gl.RGBA_INTEGER}return U}_getRGBABufferInternalSizedFormat(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==c)switch(c){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return U?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(q){case 3:switch(c){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(c){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return U?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return U?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(c){case 8:return this._gl.R16I;case 36760:return this._gl.R16_SNORM_EXT;case 36761:return this._gl.RG16_SNORM_EXT;case 36762:return this._gl.RGB16_SNORM_EXT;case 36763:return this._gl.RGBA16_SNORM_EXT;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(c){case 8:return this._gl.R16UI;case 33322:return this._gl.R16_EXT;case 33324:return this._gl.RG16_EXT;case 32852:return this._gl.RGB16_EXT;case 32859:return this._gl.RGBA16_EXT;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(c){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(c){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(c){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(c){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(c){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return U?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(q,c,U,J){let Q=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;const n=Q?4:3,W=Q?this._gl.RGBA:this._gl.RGB,D=U*J*n;if(X){if(X.length<D)return s.c.Error(`Data buffer is too small to store the read pixels (${X.length} should be more than ${D})`),Promise.resolve(X)}else X=new Uint8Array(D);return g&&this.flushFramebuffer(),this._gl.readPixels(q,c,U,J,W,this._gl.UNSIGNED_BYTE,X),Promise.resolve(X)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const q=K.d._CreateCanvas(1,1),c=q.getContext("webgl")||q.getContext("experimental-webgl");this._IsSupported=null!=c&&!!window.WebGLRenderingContext}catch(q){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const q=K.d._CreateCanvas(1,1),c=q.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||q.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!c}catch(q){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}R._TempClearColorUint32=new Uint32Array(4),R._TempClearColorInt32=new Int32Array(4),R.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],R._ConcatenateShader=h.h,R._IsSupported=null,R._HasMajorPerformanceCaveat=null},11404:(q,c,U)=>{var J;U.d(c,{c:()=>Q}),function(q){q[q.PointerMove=0]="PointerMove",q[q.PointerDown=1]="PointerDown",q[q.PointerUp=2]="PointerUp"}(J||(J={}));class Q{}Q.DOM_DELTA_PIXEL=0,Q.DOM_DELTA_LINE=1,Q.DOM_DELTA_PAGE=2},11396:(q,c,U)=>{U.d(c,{e:()=>J,h:()=>s,j:()=>Q});class J{}J.KEYDOWN=1,J.KEYUP=2;class Q{constructor(q,c){this.type=q,this.event=c}}class s extends Q{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(q){this.skipOnKeyboardObservable=q}constructor(q,c){super(q,c),this.type=q,this.event=c,this.skipOnKeyboardObservable=!1}}},11391:(q,c,U)=>{U.d(c,{d:()=>Q,g:()=>g,j:()=>X});var J=U(10833);class Q{}Q.POINTERDOWN=1,Q.POINTERUP=2,Q.POINTERMOVE=4,Q.POINTERWHEEL=8,Q.POINTERPICK=16,Q.POINTERTAP=32,Q.POINTERDOUBLETAP=64;class s{constructor(q,c){this.type=q,this.event=c}}class g extends s{constructor(q,c,U,Q){super(q,c),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new J.l(U,Q)}}class X extends s{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(q,c),this._pickInfo=U,this._inputManager=J}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},11483:(q,c,U)=>{U.d(c,{c:()=>K});var J=U(11010),Q=U(11019),s=U(10833),g=U(11093),X=U(11113),n=U(11075),W=U(10850),D=U(11100),u=U(11082);class K extends X.b{get range(){return this._range}set range(q){this._range=q,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(q){this._intensityMode=q,this._computePhotometricScale()}get radius(){return this._radius}set radius(q){this._radius=q,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(q){this._shadowEnabled!==q&&(this._shadowEnabled=q,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(q){this._includedOnlyMeshes=q,this._hookArrayForIncludedOnly(q)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(q){this._excludedMeshes=q,this._hookArrayForExcluded(q)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(q){this._excludeWithLayerMask=q,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(q){this._includeOnlyWithLayerMask=q,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(q){this._lightmapMode!==q&&(this._lightmapMode=q,this._markMeshesAsLightDirty())}getViewMatrix(q){return null}getProjectionMatrix(q,c){return null}constructor(q,c){super(q,c,!1),this.dc=new g.c(1,1,1),this.bD=new g.c(1,1,1),this.falloffType=K.FALLOFF_DEFAULT,this.zc=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=K.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.Cq().addLight(this),this._uniformBuffer=new n.d(this.Cq().getEngine(),void 0,void 0,q),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(q,c){return this}_bindLight(q,c,U,J){let Q=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=q.toString();let X=!1;if(this._uniformBuffer.bindToEffect(U,"Light"+s),this._renderId!==c.getRenderId()||this._lastUseSpecular!==J||!this._uniformBuffer.useUbo){this._renderId=c.getRenderId(),this._lastUseSpecular=J;const q=this.getScaledIntensity();this.transferToEffect(U,s),this.dc.scaleToRef(q,g.g.Nc[0]),this._uniformBuffer.updateColor4("vLightDiffuse",g.g.Nc[0],this.range,s),J&&(this.bD.scaleToRef(q,g.g.Nc[1]),this._uniformBuffer.updateColor4("vLightSpecular",g.g.Nc[1],this.radius,s)),X=!0}if(this.transferTexturesToEffect(U,s),c.shadowsEnabled&&this.shadowEnabled&&Q){const q=this.getShadowGenerator(c.activeCamera)??this.getShadowGenerator();q&&(q.bindShadowLight(s,U),X=!0)}X?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(q){let c="Name: "+this.name;if(c+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let U=0;U<this.animations.length;U++)c+=", animation[0]: "+this.animations[U].toString(q);return c}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}LX(q){super.LX(q),this._resyncMeshes()}getShadowGenerator(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(q)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return s.p.Zero()}canAffectMesh(q){return!q||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(q))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(q))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&q.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&q.layerMask)))}dispose(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const q=this._shadowGenerators.values();for(let c=q.next();!0!==c.done;c=q.next()){c.value.dispose()}this._shadowGenerators=null}if(this.Cq().stopAnimation(this),this._parentContainer){const q=this._parentContainer.lights.indexOf(this);q>-1&&this._parentContainer.lights.splice(q,1),this._parentContainer=null}for(const U of this.Cq().meshes)U._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.Cq().removeLight(this),super.dispose(q,c)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.zc}clone(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=K.GetConstructorFromName(this.getTypeID(),q,this.Cq());if(!U)return null;const J=u.e.Clone(U,this);return q&&(J.name=q),c&&(J.parent=c),J.LX(this.isEnabled()),this.onClonedObservable.notifyObservers(J),J}serialize(){const q=u.e.Serialize(this);if(q.uniqueId=this.uniqueId,q.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(q),this.excludedMeshes.length>0){q.excludedMeshesIds=[];for(const c of this.excludedMeshes)q.excludedMeshesIds.push(c.id)}if(this.includedOnlyMeshes.length>0){q.includedOnlyMeshesIds=[];for(const c of this.includedOnlyMeshes)q.includedOnlyMeshesIds.push(c.id)}return u.e.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.isEnabled=this.isEnabled(),q}static GetConstructorFromName(q,c,U){const J=X.b.Construct("Light_Type_"+q,c,U);return J||null}static Parse(q,c){const U=K.GetConstructorFromName(q.type,q.name,c);if(!U)return null;const J=u.e.Parse(U,q,c);if(q.excludedMeshesIds&&(J._excludedMeshesIds=q.excludedMeshesIds),q.includedOnlyMeshesIds&&(J._includedOnlyMeshesIds=q.includedOnlyMeshesIds),void 0!==q.parentId&&(J._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(J._waitingParentInstanceIndex=q.parentInstanceIndex),void 0!==q.falloffType&&(J.falloffType=q.falloffType),void 0!==q.lightmapMode&&(J.lightmapMode=q.lightmapMode),q.animations){for(let c=0;c<q.animations.length;c++){const U=q.animations[c],Q=(0,W.d)("BABYLON.Animation");Q&&J.animations.push(Q.Parse(U))}X.b.ParseAnimationRanges(J,q,c)}return q.autoAnimate&&c.beginAnimation(J,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),void 0!==q.isEnabled&&J.LX(q.isEnabled),J}_hookArrayForExcluded(q){var c=this;const U=q.push;q.push=function(){for(var J=arguments.length,Q=new Array(J),s=0;s<J;s++)Q[s]=arguments[s];const g=U.apply(q,Q);for(const q of Q)q._resyncLightSource(c);return g};const J=q.splice;q.splice=(c,U)=>{const Q=J.apply(q,[c,U]);for(const q of Q)q._resyncLightSource(this);return Q};for(const Q of q)Q._resyncLightSource(this)}_hookArrayForIncludedOnly(q){var c=this;const U=q.push;q.push=function(){for(var J=arguments.length,Q=new Array(J),s=0;s<J;s++)Q[s]=arguments[s];const g=U.apply(q,Q);return c._resyncMeshes(),g};const J=q.splice;q.splice=(c,U)=>{const Q=J.apply(q,[c,U]);return this._resyncMeshes(),Q},this._resyncMeshes()}_resyncMeshes(){for(const q of this.Cq().meshes)q._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const q of this.Cq().meshes)-1!==q.lightSources.indexOf(this)&&q._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.Cq().resetCachedMaterial()}_getPhotometricScale(){let q=0;const c=this.getTypeID();let U=this.intensityMode;switch(U===K.INTENSITYMODE_AUTOMATIC&&(U=c===K.LIGHTTYPEID_DIRECTIONALLIGHT?K.INTENSITYMODE_ILLUMINANCE:K.INTENSITYMODE_LUMINOUSINTENSITY),c){case K.LIGHTTYPEID_POINTLIGHT:case K.LIGHTTYPEID_SPOTLIGHT:switch(U){case K.INTENSITYMODE_LUMINOUSPOWER:q=1/(4*Math.PI);break;case K.INTENSITYMODE_LUMINOUSINTENSITY:q=1;break;case K.INTENSITYMODE_LUMINANCE:q=this.radius*this.radius}break;case K.LIGHTTYPEID_DIRECTIONALLIGHT:switch(U){case K.INTENSITYMODE_ILLUMINANCE:q=1;break;case K.INTENSITYMODE_LUMINANCE:{let c=this.radius;c=Math.max(c,.001);q=2*Math.PI*(1-Math.cos(c));break}}break;case K.LIGHTTYPEID_HEMISPHERICLIGHT:q=1}return q}_reorderLightsInScene(){const q=this.Cq();0!=this._renderPriority&&(q.requireLightSorting=!0),this.Cq().sortLightsByPriority()}_isReady(){return!0}}K.FALLOFF_DEFAULT=D.b.FALLOFF_DEFAULT,K.FALLOFF_PHYSICAL=D.b.FALLOFF_PHYSICAL,K.FALLOFF_GLTF=D.b.FALLOFF_GLTF,K.FALLOFF_STANDARD=D.b.FALLOFF_STANDARD,K.LIGHTMAP_DEFAULT=D.b.LIGHTMAP_DEFAULT,K.LIGHTMAP_SPECULAR=D.b.LIGHTMAP_SPECULAR,K.LIGHTMAP_SHADOWSONLY=D.b.LIGHTMAP_SHADOWSONLY,K.INTENSITYMODE_AUTOMATIC=D.b.INTENSITYMODE_AUTOMATIC,K.INTENSITYMODE_LUMINOUSPOWER=D.b.INTENSITYMODE_LUMINOUSPOWER,K.INTENSITYMODE_LUMINOUSINTENSITY=D.b.INTENSITYMODE_LUMINOUSINTENSITY,K.INTENSITYMODE_ILLUMINANCE=D.b.INTENSITYMODE_ILLUMINANCE,K.INTENSITYMODE_LUMINANCE=D.b.INTENSITYMODE_LUMINANCE,K.LIGHTTYPEID_POINTLIGHT=D.b.LIGHTTYPEID_POINTLIGHT,K.LIGHTTYPEID_DIRECTIONALLIGHT=D.b.LIGHTTYPEID_DIRECTIONALLIGHT,K.LIGHTTYPEID_SPOTLIGHT=D.b.LIGHTTYPEID_SPOTLIGHT,K.LIGHTTYPEID_HEMISPHERICLIGHT=D.b.LIGHTTYPEID_HEMISPHERICLIGHT,K.LIGHTTYPEID_RECT_AREALIGHT=D.b.LIGHTTYPEID_RECT_AREALIGHT,(0,J.d)([(0,Q.j)()],K.prototype,"diffuse",void 0),(0,J.d)([(0,Q.j)()],K.prototype,"specular",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"falloffType",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"intensity",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"range",null),(0,J.d)([(0,Q.N)()],K.prototype,"intensityMode",null),(0,J.d)([(0,Q.N)()],K.prototype,"radius",null),(0,J.d)([(0,Q.N)()],K.prototype,"_renderPriority",void 0),(0,J.d)([(0,Q.c)("_reorderLightsInScene")],K.prototype,"renderPriority",void 0),(0,J.d)([(0,Q.N)("shadowEnabled")],K.prototype,"_shadowEnabled",void 0),(0,J.d)([(0,Q.N)("excludeWithLayerMask")],K.prototype,"_excludeWithLayerMask",void 0),(0,J.d)([(0,Q.N)("includeOnlyWithLayerMask")],K.prototype,"_includeOnlyWithLayerMask",void 0),(0,J.d)([(0,Q.N)("lightmapMode")],K.prototype,"_lightmapMode",void 0)},11100:(q,c,U)=>{U.d(c,{b:()=>J});class J{static CompareLightsPriority(q,c){return q.shadowEnabled!==c.shadowEnabled?(c.shadowEnabled?1:0)-(q.shadowEnabled?1:0):c.renderPriority-q.renderPriority}}J.FALLOFF_DEFAULT=0,J.FALLOFF_PHYSICAL=1,J.FALLOFF_GLTF=2,J.FALLOFF_STANDARD=3,J.LIGHTMAP_DEFAULT=0,J.LIGHTMAP_SPECULAR=1,J.LIGHTMAP_SHADOWSONLY=2,J.INTENSITYMODE_AUTOMATIC=0,J.INTENSITYMODE_LUMINOUSPOWER=1,J.INTENSITYMODE_LUMINOUSINTENSITY=2,J.INTENSITYMODE_ILLUMINANCE=3,J.INTENSITYMODE_LUMINANCE=4,J.LIGHTTYPEID_POINTLIGHT=0,J.LIGHTTYPEID_DIRECTIONALLIGHT=1,J.LIGHTTYPEID_SPOTLIGHT=2,J.LIGHTTYPEID_HEMISPHERICLIGHT=3,J.LIGHTTYPEID_RECT_AREALIGHT=4},11545:(q,c,U)=>{U.d(c,{b:()=>n});var J=U(11010),Q=U(11019),s=U(10833),g=U(11483),X=U(11137);class n extends g.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=s.d.Identity(),this._projectionMatrix=s.d.Identity()}_setPosition(q){this._position=q}get position(){return this._position}set position(q){this._setPosition(q)}_setDirection(q){this._direction=q}get direction(){return this._direction}set direction(q){this._setDirection(q)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(q){this._shadowMinZ=q,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(q){this._shadowMaxZ=q,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=s.p.Zero()),s.p.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=s.p.Zero()),s.p.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(q){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(q){return this.direction=s.p.Normalize(q.eU(this.position)),this.direction}getRotation(){this.direction.normalize();const q=s.p.Cross(this.direction,X.d.Y),c=s.p.Cross(q,this.direction);return s.p.RotationFromAxis(q,c,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=s.p.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}o(q){return!q&&this.isSynchronized()?(this._currentRenderId=this.Cq().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.X(this.position),this._worldMatrix||(this._worldMatrix=s.d.Identity()),s.d.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(q){return void 0!==this.shadowMinZ?this.shadowMinZ:(null===q||void 0===q?void 0:q.Oc)||0}getDepthMaxZ(q){return void 0!==this.shadowMaxZ?this.shadowMaxZ:(null===q||void 0===q?void 0:q.maxZ)||1e4}setShadowProjectionMatrix(q,c,U){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(c,U,q):this._setDefaultShadowProjectionMatrix(q,c,U),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(q){const c=s.j.hc[0];let U=this.position;this.computeTransformedInformation()&&(U=this.transformedPosition),s.p.NormalizeToRef(this.getShadowDirection(q),c),1===Math.abs(s.p.Dot(c,s.p.Up()))&&(c.z=1e-13);const J=s.j.hc[1];return U.addToRef(c,J),s.d.LookAtLHToRef(U,J,s.p.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(q,c){return this.setShadowProjectionMatrix(this._projectionMatrix,q??this._viewMatrix,c??[]),this._projectionMatrix}}(0,J.d)([(0,Q.K)()],n.prototype,"position",null),(0,J.d)([(0,Q.K)()],n.prototype,"direction",null),(0,J.d)([(0,Q.N)()],n.prototype,"shadowMinZ",null),(0,J.d)([(0,Q.N)()],n.prototype,"shadowMaxZ",null)},11175:(q,c,U)=>{U.d(c,{c:()=>J});class J{static get ForceFullSceneLoadingForIncremental(){return J._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(q){J._ForceFullSceneLoadingForIncremental=q}static get ShowLoadingScreen(){return J._ShowLoadingScreen}static set ShowLoadingScreen(q){J._ShowLoadingScreen=q}static get loggingLevel(){return J._LoggingLevel}static set loggingLevel(q){J._LoggingLevel=q}static get CleanBoneMatrixWeights(){return J._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(q){J._CleanBoneMatrixWeights=q}}J._ForceFullSceneLoadingForIncremental=!1,J._ShowLoadingScreen=!0,J._CleanBoneMatrixWeights=!1,J._LoggingLevel=0},11355:(q,c,U)=>{U.d(c,{d:()=>m});var J=U(11010),Q=U(11019),s=U(10886),g=U(11156),X=U(11344),n=U(11364),W=U(10833),D=U(11031),u=U(11416),K=U(11418);class r extends u.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1,this.MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,this.LEGACY_SPECULAR_ENERGY_CONSERVATION=!1,this.BASE_DIFFUSE_MODEL=0,this.DIELECTRIC_SPECULAR_MODEL=0,this.CONDUCTOR_SPECULAR_MODEL=0}}class H extends K.e{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRBRDF",90,new r,c),this._useEnergyConservation=H.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=H.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=H.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=H.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._mixIblRadianceWithIrradiance=H.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this.mixIblRadianceWithIrradiance=H.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE,this._useLegacySpecularEnergyConservation=H.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this.useLegacySpecularEnergyConservation=H.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION,this._baseDiffuseModel=H.DEFAULT_DIFFUSE_MODEL,this.baseDiffuseModel=H.DEFAULT_DIFFUSE_MODEL,this._dielectricSpecularModel=H.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this.dielectricSpecularModel=H.DEFAULT_DIELECTRIC_SPECULAR_MODEL,this._conductorSpecularModel=H.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this.conductorSpecularModel=H.DEFAULT_CONDUCTOR_SPECULAR_MODEL,this._internalMarkAllSubMeshesAsMiscDirty=q._dirtyCallbacks[16],this._enable(!0)}prepareDefines(q){q.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,q.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,q.SPHERICAL_HARMONICS=this._useSphericalHarmonics,q.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation,q.MIX_IBL_RADIANCE_WITH_IRRADIANCE=this._mixIblRadianceWithIrradiance,q.LEGACY_SPECULAR_ENERGY_CONSERVATION=this._useLegacySpecularEnergyConservation,q.BASE_DIFFUSE_MODEL=this._baseDiffuseModel,q.DIELECTRIC_SPECULAR_MODEL=this._dielectricSpecularModel,q.CONDUCTOR_SPECULAR_MODEL=this._conductorSpecularModel}getClassName(){return"PBRBRDFConfiguration"}}H.DEFAULT_USE_ENERGY_CONSERVATION=!0,H.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,H.DEFAULT_USE_SPHERICAL_HARMONICS=!0,H.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,H.DEFAULT_MIX_IBL_RADIANCE_WITH_IRRADIANCE=!0,H.DEFAULT_USE_LEGACY_SPECULAR_ENERGY_CONSERVATION=!0,H.DEFAULT_DIFFUSE_MODEL=0,H.DEFAULT_DIELECTRIC_SPECULAR_MODEL=0,H.DEFAULT_CONDUCTOR_SPECULAR_MODEL=0,(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useEnergyConservation",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSphericalHarmonics",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useSpecularGlossinessInputEnergyConservation",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"mixIblRadianceWithIrradiance",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"useLegacySpecularEnergyConservation",void 0),(0,J.d)([(0,Q.N)("baseDiffuseModel"),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"baseDiffuseModel",void 0),(0,J.d)([(0,Q.N)("dielectricSpecularModel"),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"dielectricSpecularModel",void 0),(0,J.d)([(0,Q.N)("conductorSpecularModel"),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],H.prototype,"conductorSpecularModel",void 0);var b=U(11422),h=U(11093),o=U(11373),a=U(11004),p=U(11429),R=U(11288),I=U(11434),t=(U(11441),U(11454)),C=U(11095);class i extends u.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class F extends K.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRClearCoat",100,new i,c),this._isEnabled=!1,this.isEnabled=!1,this.zc=1,this.roughness=0,this._indexOfRefraction=F._DefaultIndexOfRefraction,this.indexOfRefraction=F._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=h.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,c,U){if(!this._isEnabled)return!0;const J=this._material._disableBumpMap;if(q._areTexturesDirty&&c.texturesEnabled){if(this._texture&&I.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&I.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(U.getCaps().standardDerivatives&&this._bumpTexture&&I.c.ClearCoatBumpTextureEnabled&&!J&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&I.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,c){this._isEnabled?(q.CLEARCOAT=!0,q.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,q.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,q._areTexturesDirty&&c.texturesEnabled&&(this._texture&&I.c.ClearCoatTextureEnabled?(0,C.R)(this._texture,q,"CLEARCOAT_TEXTURE"):q.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&I.c.ClearCoatTextureEnabled?(0,C.R)(this._textureRoughness,q,"CLEARCOAT_TEXTURE_ROUGHNESS"):q.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&I.c.ClearCoatBumpTextureEnabled?(0,C.R)(this._bumpTexture,q,"CLEARCOAT_BUMP"):q.CLEARCOAT_BUMP=!1,q.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===F._DefaultIndexOfRefraction,this._isTintEnabled?(q.CLEARCOAT_TINT=!0,this._tintTexture&&I.c.ClearCoatTintTextureEnabled?((0,C.R)(this._tintTexture,q,"CLEARCOAT_TINT_TEXTURE"),q.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):q.CLEARCOAT_TINT_TEXTURE=!1):(q.CLEARCOAT_TINT=!1,q.CLEARCOAT_TINT_TEXTURE=!1))):(q.CLEARCOAT=!1,q.CLEARCOAT_TEXTURE=!1,q.CLEARCOAT_TEXTURE_ROUGHNESS=!1,q.CLEARCOAT_BUMP=!1,q.CLEARCOAT_TINT=!1,q.CLEARCOAT_TINT_TEXTURE=!1,q.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,q.CLEARCOAT_DEFAULTIOR=!1,q.CLEARCOAT_TEXTUREDIRECTUV=0,q.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,q.CLEARCOAT_BUMPDIRECTUV=0,q.CLEARCOAT_REMAP_F0=!1,q.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,q.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(q,c,U,J){if(!this._isEnabled)return;const Q=J.materialDefines,s=this._material.isFrozen,g=this._material._disableBumpMap,X=this._material._invertNormalMapX,n=this._material._invertNormalMapY;if(!q.useUbo||!s||!q.isSync){var W,D,u,K;if((this._texture||this._textureRoughness)&&I.c.ClearCoatTextureEnabled)q.updateFloat4("vClearCoatInfos",(null===(W=this._texture)||void 0===W?void 0:W.coordinatesIndex)??0,(null===(D=this._texture)||void 0===D?void 0:D.level)??0,(null===(u=this._textureRoughness)||void 0===u?void 0:u.coordinatesIndex)??0,(null===(K=this._textureRoughness)||void 0===K?void 0:K.level)??0),this._texture&&(0,C.s)(this._texture,q,"clearCoat"),this._textureRoughness&&!Q.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,C.s)(this._textureRoughness,q,"clearCoatRoughness");this._bumpTexture&&U.getCaps().standardDerivatives&&I.c.ClearCoatTextureEnabled&&!g&&(q.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,C.s)(this._bumpTexture,q,"clearCoatBump"),c._mirroredCameraPosition?q.updateFloat2("vClearCoatTangentSpaceParams",X?1:-1,n?1:-1):q.updateFloat2("vClearCoatTangentSpaceParams",X?-1:1,n?-1:1)),this._tintTexture&&I.c.ClearCoatTintTextureEnabled&&(q.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,C.s)(this._tintTexture,q,"clearCoatTint")),q.updateFloat2("vClearCoatParams",this.zc,this.roughness);const J=1-this._indexOfRefraction,s=1+this._indexOfRefraction,r=Math.pow(-J/s,2),H=1/this._indexOfRefraction;q.updateFloat4("vClearCoatRefractionParams",r,H,J,s),this._isTintEnabled&&(q.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),q.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}c.texturesEnabled&&(this._texture&&I.c.ClearCoatTextureEnabled&&q.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!Q.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&I.c.ClearCoatTextureEnabled&&q.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&U.getCaps().standardDerivatives&&I.c.ClearCoatBumpTextureEnabled&&!g&&q.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&I.c.ClearCoatTintTextureEnabled&&q.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(q){return this._texture===q||(this._textureRoughness===q||(this._bumpTexture===q||this._tintTexture===q))}getActiveTextures(q){this._texture&&q.push(this._texture),this._textureRoughness&&q.push(this._textureRoughness),this._bumpTexture&&q.push(this._bumpTexture),this._tintTexture&&q.push(this._tintTexture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&q.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&q.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&q.push(this._tintTexture)}dispose(q){var c,U,J,Q;q&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(U=this._textureRoughness)||void 0===U||U.dispose(),null===(J=this._bumpTexture)||void 0===J||J.dispose(),null===(Q=this._tintTexture)||void 0===Q||Q.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(q,c,U){return q.CLEARCOAT_BUMP&&c.addFallback(U++,"CLEARCOAT_BUMP"),q.CLEARCOAT_TINT&&c.addFallback(U++,"CLEARCOAT_TINT"),q.CLEARCOAT&&c.addFallback(U++,"CLEARCOAT"),U}getSamplers(q){q.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}F._DefaultIndexOfRefraction=1.5,(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isEnabled",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"intensity",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"roughness",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"indexOfRefraction",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"texture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useRoughnessFromMainTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"textureRoughness",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"remapF0OnInterfaceChange",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"bumpTexture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"isTintEnabled",void 0),(0,J.d)([(0,Q.j)()],F.prototype,"tintColor",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"tintColorAtDistance",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"tintThickness",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"tintTexture",void 0);class v extends u.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class Y extends K.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRIridescence",110,new v,c),this._isEnabled=!1,this.isEnabled=!1,this.zc=1,this.minimumThickness=Y._DefaultMinimumThickness,this.maximumThickness=Y._DefaultMaximumThickness,this.indexOfRefraction=Y._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,c){if(!this._isEnabled)return!0;if(q._areTexturesDirty&&c.texturesEnabled){if(this._texture&&I.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&I.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,c){this._isEnabled?(q.IRIDESCENCE=!0,q._areTexturesDirty&&c.texturesEnabled&&(this._texture&&I.c.IridescenceTextureEnabled?(0,C.R)(this._texture,q,"IRIDESCENCE_TEXTURE"):q.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&I.c.IridescenceTextureEnabled?(0,C.R)(this._thicknessTexture,q,"IRIDESCENCE_THICKNESS_TEXTURE"):q.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(q.IRIDESCENCE=!1,q.IRIDESCENCE_TEXTURE=!1,q.IRIDESCENCE_THICKNESS_TEXTURE=!1,q.IRIDESCENCE_TEXTUREDIRECTUV=0,q.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(q,c){if(!this._isEnabled)return;const U=this._material.isFrozen;if(!q.useUbo||!U||!q.isSync){var J,Q,s,g;if((this._texture||this._thicknessTexture)&&I.c.IridescenceTextureEnabled)q.updateFloat4("vIridescenceInfos",(null===(J=this._texture)||void 0===J?void 0:J.coordinatesIndex)??0,(null===(Q=this._texture)||void 0===Q?void 0:Q.level)??0,(null===(s=this._thicknessTexture)||void 0===s?void 0:s.coordinatesIndex)??0,(null===(g=this._thicknessTexture)||void 0===g?void 0:g.level)??0),this._texture&&(0,C.s)(this._texture,q,"iridescence"),this._thicknessTexture&&(0,C.s)(this._thicknessTexture,q,"iridescenceThickness");q.updateFloat4("vIridescenceParams",this.zc,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}c.texturesEnabled&&(this._texture&&I.c.IridescenceTextureEnabled&&q.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&I.c.IridescenceTextureEnabled&&q.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(q){return this._texture===q||this._thicknessTexture===q}getActiveTextures(q){this._texture&&q.push(this._texture),this._thicknessTexture&&q.push(this._thicknessTexture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&q.push(this._thicknessTexture)}dispose(q){var c,U;q&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(U=this._thicknessTexture)||void 0===U||U.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(q,c,U){return q.IRIDESCENCE&&c.addFallback(U++,"IRIDESCENCE"),U}getSamplers(q){q.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}Y._DefaultMinimumThickness=100,Y._DefaultMaximumThickness=400,Y._DefaultIndexOfRefraction=1.3,(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"isEnabled",void 0),(0,J.d)([(0,Q.N)()],Y.prototype,"intensity",void 0),(0,J.d)([(0,Q.N)()],Y.prototype,"minimumThickness",void 0),(0,J.d)([(0,Q.N)()],Y.prototype,"maximumThickness",void 0),(0,J.d)([(0,Q.N)()],Y.prototype,"indexOfRefraction",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"texture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Y.prototype,"thicknessTexture",void 0);class k extends u.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class V extends K.e{set angle(q){this.direction.x=Math.cos(q),this.direction.y=Math.sin(q)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRAnisotropic",110,new k,c),this._isEnabled=!1,this.isEnabled=!1,this.zc=1,this.direction=new W.l(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=q._dirtyCallbacks[16]}isReadyForSubMesh(q,c){return!this._isEnabled||!(q._areTexturesDirty&&c.texturesEnabled&&this._texture&&I.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(q,c,U){this._isEnabled?(q.ANISOTROPIC=this._isEnabled,this._isEnabled&&!U.isVerticesDataPresent(D.h.TangentKind)&&(q._needUVs=!0,q.MAINUV1=!0),q._areTexturesDirty&&c.texturesEnabled&&(this._texture&&I.c.AnisotropicTextureEnabled?(0,C.R)(this._texture,q,"ANISOTROPIC_TEXTURE"):q.ANISOTROPIC_TEXTURE=!1),q._areMiscDirty&&(q.ANISOTROPIC_LEGACY=this._legacy)):(q.ANISOTROPIC=!1,q.ANISOTROPIC_TEXTURE=!1,q.ANISOTROPIC_TEXTUREDIRECTUV=0,q.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(q,c){if(!this._isEnabled)return;const U=this._material.isFrozen;q.useUbo&&U&&q.isSync||(this._texture&&I.c.AnisotropicTextureEnabled&&(q.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,C.s)(this._texture,q,"anisotropy")),q.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.zc)),c.texturesEnabled&&this._texture&&I.c.AnisotropicTextureEnabled&&q.setTexture("anisotropySampler",this._texture)}hasTexture(q){return this._texture===q}getActiveTextures(q){this._texture&&q.push(this._texture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture)}dispose(q){q&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(q,c,U){return q.ANISOTROPIC&&c.addFallback(U++,"ANISOTROPIC"),U}getSamplers(q){q.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(q,c,U){super.parse(q,c,U),void 0===q.legacy&&(this.legacy=!0)}}(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"isEnabled",void 0),(0,J.d)([(0,Q.N)()],V.prototype,"intensity",void 0),(0,J.d)([(0,Q.H)()],V.prototype,"direction",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],V.prototype,"texture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],V.prototype,"legacy",void 0);class O extends u.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class G extends K.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"Sheen",120,new O,c),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.zc=1,this.color=h.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,c){if(!this._isEnabled)return!0;if(q._areTexturesDirty&&c.texturesEnabled){if(this._texture&&I.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&I.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,c){this._isEnabled?(q.SHEEN=!0,q.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,q.SHEEN_ROUGHNESS=null!==this._roughness,q.SHEEN_ALBEDOSCALING=this._albedoScaling,q.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,q._areTexturesDirty&&c.texturesEnabled&&(this._texture&&I.c.SheenTextureEnabled?((0,C.R)(this._texture,q,"SHEEN_TEXTURE"),q.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):q.SHEEN_TEXTURE=!1,this._textureRoughness&&I.c.SheenTextureEnabled?(0,C.R)(this._textureRoughness,q,"SHEEN_TEXTURE_ROUGHNESS"):q.SHEEN_TEXTURE_ROUGHNESS=!1)):(q.SHEEN=!1,q.SHEEN_TEXTURE=!1,q.SHEEN_TEXTURE_ROUGHNESS=!1,q.SHEEN_LINKWITHALBEDO=!1,q.SHEEN_ROUGHNESS=!1,q.SHEEN_ALBEDOSCALING=!1,q.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,q.SHEEN_GAMMATEXTURE=!1,q.SHEEN_TEXTUREDIRECTUV=0,q.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(q,c,U,J){if(!this._isEnabled)return;const Q=J.materialDefines,s=this._material.isFrozen;if(!q.useUbo||!s||!q.isSync){var g,X,n,W;if((this._texture||this._textureRoughness)&&I.c.SheenTextureEnabled)q.updateFloat4("vSheenInfos",(null===(g=this._texture)||void 0===g?void 0:g.coordinatesIndex)??0,(null===(X=this._texture)||void 0===X?void 0:X.level)??0,(null===(n=this._textureRoughness)||void 0===n?void 0:n.coordinatesIndex)??0,(null===(W=this._textureRoughness)||void 0===W?void 0:W.level)??0),this._texture&&(0,C.s)(this._texture,q,"sheen"),this._textureRoughness&&!Q.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,C.s)(this._textureRoughness,q,"sheenRoughness");q.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.zc),null!==this._roughness&&q.updateFloat("vSheenRoughness",this._roughness)}c.texturesEnabled&&(this._texture&&I.c.SheenTextureEnabled&&q.setTexture("sheenSampler",this._texture),this._textureRoughness&&!Q.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&I.c.SheenTextureEnabled&&q.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(q){return this._texture===q||this._textureRoughness===q}getActiveTextures(q){this._texture&&q.push(this._texture),this._textureRoughness&&q.push(this._textureRoughness)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&q.push(this._textureRoughness)}dispose(q){var c,U;q&&(null===(c=this._texture)||void 0===c||c.dispose(),null===(U=this._textureRoughness)||void 0===U||U.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(q,c,U){return q.SHEEN&&c.addFallback(U++,"SHEEN"),U}getSamplers(q){q.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"isEnabled",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"linkSheenWithAlbedo",void 0),(0,J.d)([(0,Q.N)()],G.prototype,"intensity",void 0),(0,J.d)([(0,Q.j)()],G.prototype,"color",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"texture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"useRoughnessFromMainTexture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"roughness",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"textureRoughness",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],G.prototype,"albedoScaling",void 0);class S extends u.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1,this.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1,this.SS_TRANSLUCENCY_LEGACY=!1}}class Z extends K.e{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(q){this._scene.enableSubSurfaceForPrePass()&&q&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(q))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(q){this._volumeIndexOfRefraction=q>=1?q:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"PBRSubSurface",130,new S,c),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=h.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=h.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this.applyAlbedoAfterSubSurface=Z.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE,this.legacyTransluceny=Z.DEFAULT_LEGACY_TRANSLUCENCY,this._scene=q.Cq(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=q._dirtyCallbacks[32]}isReadyForSubMesh(q,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(q._areTexturesDirty&&c.texturesEnabled){if(this._thicknessTexture&&I.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&I.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&I.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const q=this._getRefractionTexture(c);if(q&&I.c.RefractionTextureEnabled&&!q.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(q,c){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return q.SUBSURFACE=!1,q.SS_DISPERSION=!1,q.SS_TRANSLUCENCY=!1,q.SS_SCATTERING=!1,q.SS_REFRACTION=!1,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_THICKNESSANDMASK_TEXTURE=!1,q.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,q.SS_HAS_THICKNESS=!1,q.SS_REFRACTIONINTENSITY_TEXTURE=!1,q.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,q.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,q.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,q.SS_REFRACTIONMAP_3D=!1,q.SS_REFRACTIONMAP_OPPOSITEZ=!1,q.SS_LODINREFRACTIONALPHA=!1,q.SS_GAMMAREFRACTION=!1,q.SS_RGBDREFRACTION=!1,q.SS_LINEARSPECULARREFRACTION=!1,q.SS_LINKREFRACTIONTOTRANSPARENCY=!1,q.SS_ALBEDOFORREFRACTIONTINT=!1,q.SS_ALBEDOFORTRANSLUCENCYTINT=!1,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,q.SS_USE_THICKNESS_AS_DEPTH=!1,q.SS_USE_GLTF_TEXTURES=!1,q.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,q.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,q.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=!1,void(q.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=!1);if(q._areTexturesDirty){if(q.SUBSURFACE=!0,q.SS_DISPERSION=this._isDispersionEnabled,q.SS_TRANSLUCENCY=this._isTranslucencyEnabled,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_TRANSLUCENCY_LEGACY=this.legacyTransluceny,q.SS_SCATTERING=this._isScatteringEnabled,q.SS_THICKNESSANDMASK_TEXTURE=!1,q.SS_REFRACTIONINTENSITY_TEXTURE=!1,q.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,q.SS_HAS_THICKNESS=!1,q.SS_USE_GLTF_TEXTURES=!1,q.SS_REFRACTION=!1,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,q.SS_REFRACTIONMAP_3D=!1,q.SS_GAMMAREFRACTION=!1,q.SS_RGBDREFRACTION=!1,q.SS_LINEARSPECULARREFRACTION=!1,q.SS_REFRACTIONMAP_OPPOSITEZ=!1,q.SS_LODINREFRACTIONALPHA=!1,q.SS_LINKREFRACTIONTOTRANSPARENCY=!1,q.SS_ALBEDOFORREFRACTIONTINT=!1,q.SS_ALBEDOFORTRANSLUCENCYTINT=!1,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,q.SS_USE_THICKNESS_AS_DEPTH=!1,q.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,q.SS_APPLY_ALBEDO_AFTER_SUBSURFACE=this.applyAlbedoAfterSubSurface,q._areTexturesDirty&&c.texturesEnabled&&(this._thicknessTexture&&I.c.ThicknessTextureEnabled&&(0,C.R)(this._thicknessTexture,q,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&I.c.RefractionIntensityTextureEnabled&&(0,C.R)(this._refractionIntensityTexture,q,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&I.c.TranslucencyIntensityTextureEnabled&&(0,C.R)(this._translucencyIntensityTexture,q,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&I.c.TranslucencyColorTextureEnabled&&((0,C.R)(this._translucencyColorTexture,q,"SS_TRANSLUCENCYCOLOR_TEXTURE"),q.SS_TRANSLUCENCYCOLOR_TEXTURE_GAMMA=this._translucencyColorTexture.gammaSpace)),q.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,q.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,q.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,q.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&c.texturesEnabled){const U=this._getRefractionTexture(c);U&&I.c.RefractionTextureEnabled&&(q.SS_REFRACTION=!0,q.SS_REFRACTIONMAP_3D=U.isCube,q.SS_GAMMAREFRACTION=U.gammaSpace,q.SS_RGBDREFRACTION=U.isRGBD,q.SS_LINEARSPECULARREFRACTION=U.linearSpecularLOD,q.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&U.isCube?!U.invertZ:U.invertZ,q.SS_LODINREFRACTIONALPHA=U.lodLevelInAlpha,q.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,q.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,q.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=U.isCube&&U.boundingBoxSize,q.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(q.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(q,c,U,J){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)q.updateFloat2("vThicknessParam",0,0);else{J.getRenderingMesh().getWorldMatrix().decompose(W.j.hc[0]);const c=Math.max(Math.abs(W.j.hc[0].x),Math.abs(W.j.hc[0].y),Math.abs(W.j.hc[0].z));q.updateFloat2("vThicknessParam",this.minimumThickness*c,(this.maximumThickness-this.minimumThickness)*c)}}bindForSubMesh(q,c,U,J){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const Q=J.materialDefines,s=this._material.isFrozen,g=this._material.realTimeFiltering,X=Q.LODBASEDMICROSFURACE,n=this._getRefractionTexture(c);if(!q.useUbo||!s||!q.isSync){if(this._thicknessTexture&&I.c.ThicknessTextureEnabled&&(q.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,C.s)(this._thicknessTexture,q,"thickness")),this._refractionIntensityTexture&&I.c.RefractionIntensityTextureEnabled&&Q.SS_REFRACTIONINTENSITY_TEXTURE&&(q.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,C.s)(this._refractionIntensityTexture,q,"refractionIntensity")),this._translucencyColorTexture&&I.c.TranslucencyColorTextureEnabled&&Q.SS_TRANSLUCENCYCOLOR_TEXTURE&&(q.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,C.s)(this._translucencyColorTexture,q,"translucencyColor")),this._translucencyIntensityTexture&&I.c.TranslucencyIntensityTextureEnabled&&Q.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(q.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,C.s)(this._translucencyIntensityTexture,q,"translucencyIntensity")),n&&I.c.RefractionTextureEnabled){q.vc("refractionMatrix",n.getRefractionTextureMatrix());let c=1;n.isCube||n.depth&&(c=n.depth);const U=n.getSize().width,J=this.volumeIndexOfRefraction;if(q.updateFloat4("vRefractionInfos",n.level,1/J,c,this._invertRefractionY?-1:1),q.updateFloat4("vRefractionMicrosurfaceInfos",U,n.lodGenerationScale,n.lodGenerationOffset,1/this.indexOfRefraction),g&&q.updateFloat2("vRefractionFilteringInfo",U,Math.log2(U)),n.boundingBoxSize){const c=n;q.updateVector3("vRefractionPosition",c.boundingBoxPosition),q.updateVector3("vRefractionSize",c.boundingBoxSize)}}this._isScatteringEnabled&&q.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),q.updateColor3("vDiffusionDistance",this.diffusionDistance),q.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),q.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),q.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),q.updateFloat("dispersion",this.dispersion)}c.texturesEnabled&&(this._thicknessTexture&&I.c.ThicknessTextureEnabled&&q.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&I.c.RefractionIntensityTextureEnabled&&Q.SS_REFRACTIONINTENSITY_TEXTURE&&q.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&I.c.TranslucencyIntensityTextureEnabled&&Q.SS_TRANSLUCENCYINTENSITY_TEXTURE&&q.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&I.c.TranslucencyColorTextureEnabled&&Q.SS_TRANSLUCENCYCOLOR_TEXTURE&&q.setTexture("translucencyColorSampler",this._translucencyColorTexture),n&&I.c.RefractionTextureEnabled&&(X?q.setTexture("refractionSampler",n):(q.setTexture("refractionSampler",n._lodTextureMid||n),q.setTexture("refractionSamplerLow",n._lodTextureLow||n),q.setTexture("refractionSamplerHigh",n._lodTextureHigh||n))))}_getRefractionTexture(q){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?q.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(q){I.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&q.push(this._refractionTexture)}hasTexture(q){return this._thicknessTexture===q||(this._refractionTexture===q||(this._refractionIntensityTexture===q||(this._translucencyIntensityTexture===q||this._translucencyColorTexture===q)))}hasRenderTargetTextures(){return!!(I.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(q){this._thicknessTexture&&q.push(this._thicknessTexture),this._refractionTexture&&q.push(this._refractionTexture),this._translucencyColorTexture&&q.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&q.push(this._translucencyIntensityTexture)}getAnimatables(q){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&q.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&q.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&q.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&q.push(this._translucencyIntensityTexture)}dispose(q){q&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(q,c,U){return q.SS_SCATTERING&&c.addFallback(U++,"SS_SCATTERING"),q.SS_TRANSLUCENCY&&c.addFallback(U++,"SS_TRANSLUCENCY"),U}getSamplers(q){q.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}Z.DEFAULT_APPLY_ALBEDO_AFTERSUBSURFACE=!1,Z.DEFAULT_LEGACY_TRANSLUCENCY=!1,(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isRefractionEnabled",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isTranslucencyEnabled",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"isDispersionEnabled",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markScenePrePassDirty")],Z.prototype,"isScatteringEnabled",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"refractionIntensity",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"translucencyIntensity",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"useAlbedoToTintRefraction",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"useAlbedoToTintTranslucency",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"thicknessTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"refractionTexture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"indexOfRefraction",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"_volumeIndexOfRefraction",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"volumeIndexOfRefraction",null),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"invertRefractionY",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"linkRefractionWithTransparency",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"minimumThickness",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"maximumThickness",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"useThicknessAsDepth",void 0),(0,J.d)([(0,Q.j)()],Z.prototype,"tintColor",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"tintColorAtDistance",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"dispersion",void 0),(0,J.d)([(0,Q.j)()],Z.prototype,"diffusionDistance",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useMaskFromThicknessTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"refractionIntensityTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"translucencyIntensityTexture",void 0),(0,J.d)([(0,Q.j)()],Z.prototype,"translucencyColor",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"translucencyColorTexture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],Z.prototype,"useGltfStyleTextures",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"applyAlbedoAfterSubSurface",void 0),(0,J.d)([(0,Q.N)()],Z.prototype,"legacyTransluceny",void 0);var x=U(11458),z=U(11104),y=U(11460);const M={effect:null,subMesh:null};class T extends u.d{constructor(q){super(q),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.IBL_CDF_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BASE_WEIGHT=!1,this.BASE_WEIGHTDIRECTUV=0,this.BASE_DIFFUSE_ROUGHNESS=!1,this.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.MIRRORED=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class m extends p.d{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(q){this._realTimeFiltering=q,this.PW(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(q){this._realTimeFilteringQuality=q,this.PW(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=q||this.Cq().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(q,c){super(q,c,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||m.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new W.q(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._baseWeightTexture=null,this._baseDiffuseRoughnessTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=m.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=h.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new h.c(0,0,0),this._albedoColor=new h.c(1,1,1),this._baseWeight=1,this._baseDiffuseRoughness=null,this._reflectivityColor=new h.c(1,1,1),this._reflectionColor=new h.c(1,1,1),this._emissiveColor=new h.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=m.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new g.g(16),this._globalAmbientColor=new h.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new H(this),this.clearCoat=new F(this),this.iridescence=new Y(this),this.anisotropy=new V(this),this.sheen=new G(this),this.subSurface=new Z(this),this.detailMap=new x.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),I.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,X.d)(this.Cq()),this.prePassConfiguration=new b.e}get hasRenderTargetTextures(){return!!(I.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var q;return this._transparencyMode===m.PBRMATERIAL_OPAQUE||this._transparencyMode===m.PBRMATERIAL_ALPHATEST||(null===(q=this.subSurface)||void 0===q?void 0:q.disableAlphaBlending)}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var q;return this._hasTransparencyMode?this._transparencyModeIsTest:(null===(q=this.subSurface)||void 0===q||!q.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===m.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.Hc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==m.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.Hc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(q,c,U){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const J=c._drawWrapper;if(J.effect&&this.isFrozen&&J._wasPreviouslyReady&&J._wasPreviouslyUsingInstances===U)return!0;c.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),c.materialDefines=new T(this._eventInfo.defineNames));const Q=c.materialDefines;if(this._isReadyForSubMesh(c))return!0;const g=this.Cq(),X=g.getEngine();if(Q._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,g.texturesEnabled)){if(this._albedoTexture&&I.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._baseWeightTexture&&I.c.BaseWeightTextureEnabled&&!this._baseWeightTexture.isReadyOrNotBlocking())return!1;if(this._baseDiffuseRoughnessTexture&&I.c.BaseDiffuseRoughnessTextureEnabled&&!this._baseDiffuseRoughnessTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&I.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&I.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const q=this._getReflectionTexture();if(q&&I.c.ReflectionTextureEnabled){if(!q.isReadyOrNotBlocking())return!1;var n;if(q.irradianceTexture){if(!q.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!q.sphericalPolynomial&&null!==(n=q.getInternalTexture())&&void 0!==n&&n._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&I.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&I.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(I.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(X.getCaps().standardDerivatives&&this._bumpTexture&&I.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&I.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=Q,this._eventInfo.subMesh=c,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(Q._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;if(Q.AREALIGHTUSED)for(let s=0;s<q.lightSources.length;s++)if(!q.lightSources[s]._isReady())return!1;X.getCaps().standardDerivatives||q.isVerticesDataPresent(D.h.NormalKind)||(q.createNormals(!0),s.c.Warn("PBRMaterial: Normals have been created for the mesh: "+q.name));const W=c.effect,u=Q._areLightsDisposed;let K=this._prepareEffect(q,Q,this.onCompiled,this.onError,U,null,c.getRenderingMesh().hasThinInstances),r=!1;if(K)if(this._onEffectCreatedObservable&&(M.effect=K,M.subMesh=c,this._onEffectCreatedObservable.notifyObservers(M)),this.allowShaderHotSwapping&&W&&!K.isReady()){if(K=W,Q.markAsUnprocessed(),r=this.isFrozen,u)return Q._areLightsDisposed=!0,!1}else g.resetCachedMaterial(),c.setEffect(K,Q,this._materialContext);return!(!c.effect||!c.effect.isReady())&&(Q._renderId=g.getRenderId(),J._wasPreviouslyReady=!r,J._wasPreviouslyUsingInstances=!!U,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(q,c){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,g=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(q,c,s,g,X),!c.isDirty)return null;c.markAsProcessed();const n=this.Cq().getEngine(),W=new t.b;let u=0;c.USESPHERICALINVERTEX&&W.addFallback(u++,"USESPHERICALINVERTEX"),c.FOG&&W.addFallback(u,"FOG"),c.SPECULARAA&&W.addFallback(u,"SPECULARAA"),c.POINTSIZE&&W.addFallback(u,"POINTSIZE"),c.LOGARITHMICDEPTH&&W.addFallback(u,"LOGARITHMICDEPTH"),c.PARALLAX&&W.addFallback(u,"PARALLAX"),c.PARALLAX_RHS&&W.addFallback(u,"PARALLAX_RHS"),c.PARALLAXOCCLUSION&&W.addFallback(u++,"PARALLAXOCCLUSION"),c.ENVIRONMENTBRDF&&W.addFallback(u++,"ENVIRONMENTBRDF"),c.TANGENT&&W.addFallback(u++,"TANGENT"),c.BUMP&&W.addFallback(u++,"BUMP"),u=(0,C.u)(c,W,this._maxSimultaneousLights,u++),c.SPECULARTERM&&W.addFallback(u++,"SPECULARTERM"),c.USESPHERICALFROMREFLECTIONMAP&&W.addFallback(u++,"USESPHERICALFROMREFLECTIONMAP"),c.USEIRRADIANCEMAP&&W.addFallback(u++,"USEIRRADIANCEMAP"),c.LIGHTMAP&&W.addFallback(u++,"LIGHTMAP"),c.NORMAL&&W.addFallback(u++,"NORMAL"),c.AMBIENT&&W.addFallback(u++,"AMBIENT"),c.EMISSIVE&&W.addFallback(u++,"EMISSIVE"),c.VERTEXCOLOR&&W.addFallback(u++,"VERTEXCOLOR"),c.MORPHTARGETS&&W.addFallback(u++,"MORPHTARGETS"),c.MULTIVIEW&&W.addFallback(0,"MULTIVIEW");const K=[D.h.PositionKind];c.NORMAL&&K.push(D.h.NormalKind),c.TANGENT&&K.push(D.h.TangentKind);for(let U=1;U<=6;++U)c["UV"+U]&&K.push(`uv${1===U?"":U}`);c.VERTEXCOLOR&&K.push(D.h.ColorKind),(0,C.z)(K,q,c,W),(0,C.C)(K,c),(0,C.D)(K,q,c),(0,C.v)(K,q,c);let r="pbr";const H=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","baseWeight","baseDiffuseRoughness","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vBaseWeightInfos","vBaseDiffuseRoughnessInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","baseWeightMatrix","baseDiffuseRoughnessMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vReflectionDominantDirection","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],h=["albedoSampler","baseWeightSampler","baseDiffuseRoughnessSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","icdfSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],a=["Material","Scene","Mesh"],p={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:c.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=W,this._eventInfo.fallbackRank=u,this._eventInfo.defines=c,this._eventInfo.uniforms=H,this._eventInfo.attributes=K,this._eventInfo.samplers=h,this._eventInfo.uniformBuffersNames=a,this._eventInfo.customCode=void 0,this._eventInfo.mesh=q,this._eventInfo.indexParameters=p,this._callbackPluginEventGeneric(128,this._eventInfo),y.e.AddUniformsAndSamplers(H,h),b.e.AddUniforms(H),b.e.AddSamplers(h),(0,z.b)(H),o.b&&(o.b.PrepareUniforms(H,c),o.b.PrepareSamplers(h,c)),(0,C._)({uniformsNames:H,uniformBuffersNames:a,samplers:h,defines:c,maxSimultaneousLights:this._maxSimultaneousLights});const R={};this.customShaderNameResolve&&(r=this.customShaderNameResolve(r,H,a,h,c,K,R));const I=c.toString(),i=n.createEffect(r,{attributes:K,uniformsNames:H,uniformBuffersNames:a,samplers:h,defines:I,fallbacks:W,onCompiled:J,onError:Q,indexParameters:p,processFinalCode:R.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:c.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([U.e(20),U.e(45)]).then(U.bind(U,13484)),Promise.all([U.e(18),U.e(46)]).then(U.bind(U,13634))]):await Promise.all([Promise.all([U.e(13),U.e(48)]).then(U.bind(U,13712)),Promise.all([U.e(12),U.e(49)]).then(U.bind(U,13864))]),this._shadersLoaded=!0}},n);return this._eventInfo.customCode=void 0,i}_prepareDefines(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=this.Cq(),g=s.getEngine();(0,C.N)(s,q,c,!0,this._maxSimultaneousLights,this._disableLighting),c._needNormals=!0,(0,C.T)(s,c);const X=this.needAlphaBlendingForMesh(q)&&this.Cq().useOrderIndependentTransparency;if((0,C.Y)(s,c,this.canRenderToMRT&&!X),(0,C.W)(s,c,X),y.e.PrepareDefines(g.currentRenderPassId,q,c),c.METALLICWORKFLOW=this.isMetallicWorkflow(),c._areTexturesDirty){c._needUVs=!1;for(let q=1;q<=6;++q)c["MAINUV"+q]=!1;if(s.texturesEnabled){c.ALBEDODIRECTUV=0,c.BASE_WEIGHTDIRECTUV=0,c.BASE_DIFFUSE_ROUGHNESSDIRECTUV=0,c.AMBIENTDIRECTUV=0,c.OPACITYDIRECTUV=0,c.EMISSIVEDIRECTUV=0,c.REFLECTIVITYDIRECTUV=0,c.MICROSURFACEMAPDIRECTUV=0,c.METALLIC_REFLECTANCEDIRECTUV=0,c.REFLECTANCEDIRECTUV=0,c.BUMPDIRECTUV=0,c.LIGHTMAPDIRECTUV=0,g.getCaps().textureLOD&&(c.LODBASEDMICROSFURACE=!0),this._albedoTexture&&I.c.DiffuseTextureEnabled?((0,C.R)(this._albedoTexture,c,"ALBEDO"),c.GAMMAALBEDO=this._albedoTexture.gammaSpace):c.ALBEDO=!1,this._baseWeightTexture&&I.c.BaseWeightTextureEnabled?(0,C.R)(this._baseWeightTexture,c,"BASE_WEIGHT"):c.BASE_WEIGHT=!1,this._baseDiffuseRoughnessTexture&&I.c.BaseDiffuseRoughnessTextureEnabled?(0,C.R)(this._baseDiffuseRoughnessTexture,c,"BASE_DIFFUSE_ROUGHNESS"):c.BASE_DIFFUSE_ROUGHNESS=!1,this._ambientTexture&&I.c.AmbientTextureEnabled?((0,C.R)(this._ambientTexture,c,"AMBIENT"),c.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):c.AMBIENT=!1,this._opacityTexture&&I.c.OpacityTextureEnabled?((0,C.R)(this._opacityTexture,c,"OPACITY"),c.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):c.OPACITY=!1;const q=this._getReflectionTexture();if(q&&I.c.ReflectionTextureEnabled){switch(c.REFLECTION=!0,c.GAMMAREFLECTION=q.gammaSpace,c.RGBDREFLECTION=q.isRGBD,c.LODINREFLECTIONALPHA=q.lodLevelInAlpha,c.LINEARSPECULARREFLECTION=q.linearSpecularLOD,c.USEIRRADIANCEMAP=!1,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(c.NUM_SAMPLES=""+this.realTimeFilteringQuality,g._features.needTypeSuffixInShaderConstants&&(c.NUM_SAMPLES=c.NUM_SAMPLES+"u"),c.REALTIME_FILTERING=!0,this.Cq().iblCdfGenerator&&(c.IBL_CDF_FILTERING=!0)):c.REALTIME_FILTERING=!1,c.INVERTCUBICMAP=q.coordinatesMode===R.c.INVCUBIC_MODE,c.REFLECTIONMAP_3D=q.isCube,c.REFLECTIONMAP_OPPOSITEZ=c.REFLECTIONMAP_3D&&this.Cq().useRightHandedSystem?!q.invertZ:q.invertZ,c.REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,q.coordinatesMode){case R.c.EXPLICIT_MODE:c.REFLECTIONMAP_EXPLICIT=!0;break;case R.c.PLANAR_MODE:c.REFLECTIONMAP_PLANAR=!0;break;case R.c.PROJECTION_MODE:c.REFLECTIONMAP_PROJECTION=!0;break;case R.c.SKYBOX_MODE:c.REFLECTIONMAP_SKYBOX=!0;break;case R.c.SPHERICAL_MODE:c.REFLECTIONMAP_SPHERICAL=!0;break;case R.c.EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case R.c.FIXED_EQUIRECTANGULAR_MODE:c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case R.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case R.c.CUBIC_MODE:case R.c.INVCUBIC_MODE:default:c.REFLECTIONMAP_CUBIC=!0,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!!q.boundingBoxSize}q.coordinatesMode!==R.c.SKYBOX_MODE&&(q.irradianceTexture?(c.USEIRRADIANCEMAP=!0,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USESPHERICALINVERTEX=!1,q.irradianceTexture._dominantDirection&&(c.USE_IRRADIANCE_DOMINANT_DIRECTION=!0)):q.isCube&&(c.USESPHERICALFROMREFLECTIONMAP=!0,c.USEIRRADIANCEMAP=!1,c.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||g.getCaps().maxVaryingVectors<=8||this._baseDiffuseRoughnessTexture?c.USESPHERICALINVERTEX=!1:c.USESPHERICALINVERTEX=!0))}else c.REFLECTION=!1,c.REFLECTIONMAP_3D=!1,c.REFLECTIONMAP_SPHERICAL=!1,c.REFLECTIONMAP_PLANAR=!1,c.REFLECTIONMAP_CUBIC=!1,c.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,c.REFLECTIONMAP_PROJECTION=!1,c.REFLECTIONMAP_SKYBOX=!1,c.REFLECTIONMAP_EXPLICIT=!1,c.REFLECTIONMAP_EQUIRECTANGULAR=!1,c.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,c.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,c.INVERTCUBICMAP=!1,c.USESPHERICALFROMREFLECTIONMAP=!1,c.USEIRRADIANCEMAP=!1,c.USE_IRRADIANCE_DOMINANT_DIRECTION=!1,c.USESPHERICALINVERTEX=!1,c.REFLECTIONMAP_OPPOSITEZ=!1,c.LODINREFLECTIONALPHA=!1,c.GAMMAREFLECTION=!1,c.RGBDREFLECTION=!1,c.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&I.c.LightmapTextureEnabled?((0,C.R)(this._lightmapTexture,c,"LIGHTMAP"),c.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,c.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,c.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):c.LIGHTMAP=!1,this._emissiveTexture&&I.c.EmissiveTextureEnabled?((0,C.R)(this._emissiveTexture,c,"EMISSIVE"),c.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):c.EMISSIVE=!1,I.c.SpecularTextureEnabled?(this._metallicTexture?((0,C.R)(this._metallicTexture,c,"REFLECTIVITY"),c.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,c.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,c.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,c.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,c.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,C.R)(this._reflectivityTexture,c,"REFLECTIVITY"),c.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,c.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,c.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):c.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(c.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,C.R)(this._metallicReflectanceTexture,c,"METALLIC_REFLECTANCE"),c.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):c.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,C.R)(this._reflectanceTexture,c,"REFLECTANCE"),c.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):c.REFLECTANCE=!1):(c.METALLIC_REFLECTANCE=!1,c.REFLECTANCE=!1),this._microSurfaceTexture?(0,C.R)(this._microSurfaceTexture,c,"MICROSURFACEMAP"):c.MICROSURFACEMAP=!1):(c.REFLECTIVITY=!1,c.MICROSURFACEMAP=!1),g.getCaps().standardDerivatives&&this._bumpTexture&&I.c.BumpTextureEnabled&&!this._disableBumpMap?((0,C.R)(this._bumpTexture,c,"BUMP"),this._useParallax&&this._albedoTexture&&I.c.DiffuseTextureEnabled?(c.PARALLAX=!0,c.PARALLAX_RHS=s.useRightHandedSystem,c.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):c.PARALLAX=!1,c.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(c.BUMP=!1,c.PARALLAX=!1,c.PARALLAX_RHS=!1,c.PARALLAXOCCLUSION=!1,c.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&I.c.ReflectionTextureEnabled?(c.ENVIRONMENTBRDF=!0,c.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(c.ENVIRONMENTBRDF=!1,c.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?c.ALPHAFROMALBEDO=!0:c.ALPHAFROMALBEDO=!1}c.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===m.LIGHTFALLOFF_STANDARD?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===m.LIGHTFALLOFF_GLTF?(c.USEPHYSICALLIGHTFALLOFF=!1,c.USEGLTFLIGHTFALLOFF=!0):(c.USEPHYSICALLIGHTFALLOFF=!0,c.USEGLTFLIGHTFALLOFF=!1),c.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Kc&&this._twoSidedLighting?c.TWOSIDEDLIGHTING=!0:c.TWOSIDEDLIGHTING=!1,c.MIRRORED=!!s._mirroredCameraPosition,c.SPECULARAA=g.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(c._areTexturesDirty||c._areMiscDirty)&&(c.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,c.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,c.ALPHABLEND=this.needAlphaBlendingForMesh(q),c.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,c.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),c._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(c),c.FORCENORMALFORWARD=this._forceNormalForward,c.RADIANCEOCCLUSION=this._useRadianceOcclusion,c.HORIZONOCCLUSION=this._useHorizonOcclusion,c._areMiscDirty&&((0,C.S)(q,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(q),c,this._applyDecalMapAfterDetailMap),c.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!q.isVerticesDataPresent(D.h.NormalKind),c.DEBUGMODE=this._debugMode),(0,C.K)(s,g,this,c,!!U,J,Q),this._eventInfo.defines=c,this._eventInfo.mesh=q,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,C.H)(q,c,!0,!0,!0,this._transparencyMode!==m.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(q,c,U){const J={clipPlane:!1,useInstances:!1,...U};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const U=new T(this._eventInfo.defineNames),Q=this._prepareEffect(q,U,void 0,void 0,J.useInstances,J.clipPlane,q.hasThinInstances);this._onEffectCreatedObservable&&(M.effect=Q,M.subMesh=null,this._onEffectCreatedObservable.notifyObservers(M)),Q.isReady()?c&&c(this):Q.onCompileObservable.add((()=>{c&&c(this)}))})()}buildUniformLayout(){const q=this._uniformBuffer;q.addUniform("vAlbedoInfos",2),q.addUniform("vBaseWeightInfos",2),q.addUniform("vBaseDiffuseRoughnessInfos",2),q.addUniform("vAmbientInfos",4),q.addUniform("vOpacityInfos",2),q.addUniform("vEmissiveInfos",2),q.addUniform("vLightmapInfos",2),q.addUniform("vReflectivityInfos",3),q.addUniform("vMicroSurfaceSamplerInfos",2),q.addUniform("vReflectionInfos",2),q.addUniform("vReflectionFilteringInfo",2),q.addUniform("vReflectionPosition",3),q.addUniform("vReflectionSize",3),q.addUniform("vBumpInfos",3),q.addUniform("albedoMatrix",16),q.addUniform("baseWeightMatrix",16),q.addUniform("baseDiffuseRoughnessMatrix",16),q.addUniform("ambientMatrix",16),q.addUniform("opacityMatrix",16),q.addUniform("emissiveMatrix",16),q.addUniform("lightmapMatrix",16),q.addUniform("reflectivityMatrix",16),q.addUniform("microSurfaceSamplerMatrix",16),q.addUniform("bumpMatrix",16),q.addUniform("vTangentSpaceParams",2),q.addUniform("reflectionMatrix",16),q.addUniform("vReflectionColor",3),q.addUniform("vAlbedoColor",4),q.addUniform("baseWeight",1),q.addUniform("baseDiffuseRoughness",1),q.addUniform("vLightingIntensity",4),q.addUniform("vReflectionMicrosurfaceInfos",3),q.addUniform("vReflectionDominantDirection",3),q.addUniform("pointSize",1),q.addUniform("vReflectivityColor",4),q.addUniform("vEmissiveColor",3),q.addUniform("vAmbientColor",3),q.addUniform("vDebugMode",2),q.addUniform("vMetallicReflectanceFactors",4),q.addUniform("vMetallicReflectanceInfos",2),q.addUniform("metallicReflectanceMatrix",16),q.addUniform("vReflectanceInfos",2),q.addUniform("reflectanceMatrix",16),q.addUniform("vSphericalL00",3),q.addUniform("vSphericalL1_1",3),q.addUniform("vSphericalL10",3),q.addUniform("vSphericalL11",3),q.addUniform("vSphericalL2_2",3),q.addUniform("vSphericalL2_1",3),q.addUniform("vSphericalL20",3),q.addUniform("vSphericalL21",3),q.addUniform("vSphericalL22",3),q.addUniform("vSphericalX",3),q.addUniform("vSphericalY",3),q.addUniform("vSphericalZ",3),q.addUniform("vSphericalXX_ZZ",3),q.addUniform("vSphericalYY_ZZ",3),q.addUniform("vSphericalZZ",3),q.addUniform("vSphericalXY",3),q.addUniform("vSphericalYZ",3),q.addUniform("vSphericalZX",3),q.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(q,c,U){const J=this.Cq(),Q=U.materialDefines;if(!Q)return;const s=U.effect;if(!s)return;this._activeEffect=s,c.getMeshUniformBuffer().bindToEffect(s,"Mesh"),c.transferToEffect(q);const g=J.getEngine();this._uniformBuffer.bindToEffect(s,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,J,c,q,this.isFrozen),y.e.Bind(g.currentRenderPassId,this._activeEffect,c,q,this);const X=J.activeCamera;X?this._uniformBuffer.updateFloat4("cameraInfo",X.Oc,X.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=U,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),Q.OBJECTSPACE_NORMALMAP&&(q.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const W=this._mustRebind(J,s,U,c.visibility);(0,C.c)(c,this._activeEffect,this.prePassConfiguration);let D=null;const u=this._uniformBuffer;if(W){if(this.bindViewProjection(s),D=this._getReflectionTexture(),!u.useUbo||!this.isFrozen||!u.isSync||U._drawWrapper._forceRebindOnNextCall){var K;if(J.texturesEnabled){if(this._albedoTexture&&I.c.DiffuseTextureEnabled&&(u.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,C.s)(this._albedoTexture,u,"albedo")),this._baseWeightTexture&&I.c.BaseWeightTextureEnabled&&(u.updateFloat2("vBaseWeightInfos",this._baseWeightTexture.coordinatesIndex,this._baseWeightTexture.level),(0,C.s)(this._baseWeightTexture,u,"baseWeight")),this._baseDiffuseRoughnessTexture&&I.c.BaseDiffuseRoughnessTextureEnabled&&(u.updateFloat2("vBaseDiffuseRoughnessInfos",this._baseDiffuseRoughnessTexture.coordinatesIndex,this._baseDiffuseRoughnessTexture.level),(0,C.s)(this._baseDiffuseRoughnessTexture,u,"baseDiffuseRoughness")),this._ambientTexture&&I.c.AmbientTextureEnabled&&(u.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,C.s)(this._ambientTexture,u,"ambient")),this._opacityTexture&&I.c.OpacityTextureEnabled&&(u.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,C.s)(this._opacityTexture,u,"opacity")),D&&I.c.ReflectionTextureEnabled){if(u.vc("reflectionMatrix",D.getReflectionTextureMatrix()),u.updateFloat2("vReflectionInfos",D.level*J.iblIntensity,0),D.boundingBoxSize){const q=D;u.updateVector3("vReflectionPosition",q.boundingBoxPosition),u.updateVector3("vReflectionSize",q.boundingBoxSize)}if(this.realTimeFiltering){const q=D.getSize().width;u.updateFloat2("vReflectionFilteringInfo",q,Math.log2(q))}if(Q.USEIRRADIANCEMAP)Q.USEIRRADIANCEMAP&&Q.USE_IRRADIANCE_DOMINANT_DIRECTION&&u.updateVector3("vReflectionDominantDirection",D.irradianceTexture._dominantDirection);else{const q=D.sphericalPolynomial;if(Q.USESPHERICALFROMREFLECTIONMAP&&q)if(Q.SPHERICAL_HARMONICS){const c=q.preScaledHarmonics;u.updateVector3("vSphericalL00",c.l00),u.updateVector3("vSphericalL1_1",c.l1_1),u.updateVector3("vSphericalL10",c.l10),u.updateVector3("vSphericalL11",c.l11),u.updateVector3("vSphericalL2_2",c.l2_2),u.updateVector3("vSphericalL2_1",c.l2_1),u.updateVector3("vSphericalL20",c.l20),u.updateVector3("vSphericalL21",c.l21),u.updateVector3("vSphericalL22",c.l22)}else u.updateFloat3("vSphericalX",q.x.x,q.x.y,q.x.z),u.updateFloat3("vSphericalY",q.y.x,q.y.y,q.y.z),u.updateFloat3("vSphericalZ",q.z.x,q.z.y,q.z.z),u.updateFloat3("vSphericalXX_ZZ",q.xx.x-q.zz.x,q.xx.y-q.zz.y,q.xx.z-q.zz.z),u.updateFloat3("vSphericalYY_ZZ",q.yy.x-q.zz.x,q.yy.y-q.zz.y,q.yy.z-q.zz.z),u.updateFloat3("vSphericalZZ",q.zz.x,q.zz.y,q.zz.z),u.updateFloat3("vSphericalXY",q.xy.x,q.xy.y,q.xy.z),u.updateFloat3("vSphericalYZ",q.yz.x,q.yz.y,q.yz.z),u.updateFloat3("vSphericalZX",q.zx.x,q.zx.y,q.zx.z)}u.updateFloat3("vReflectionMicrosurfaceInfos",D.getSize().width,D.lodGenerationScale,D.lodGenerationOffset)}this._emissiveTexture&&I.c.EmissiveTextureEnabled&&(u.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,C.s)(this._emissiveTexture,u,"emissive")),this._lightmapTexture&&I.c.LightmapTextureEnabled&&(u.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,C.s)(this._lightmapTexture,u,"lightmap")),I.c.SpecularTextureEnabled&&(this._metallicTexture?(u.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,C.s)(this._metallicTexture,u,"reflectivity")):this._reflectivityTexture&&(u.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,C.s)(this._reflectivityTexture,u,"reflectivity")),this._metallicReflectanceTexture&&(u.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,C.s)(this._metallicReflectanceTexture,u,"metallicReflectance")),this._reflectanceTexture&&Q.REFLECTANCE&&(u.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,C.s)(this._reflectanceTexture,u,"reflectance")),this._microSurfaceTexture&&(u.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,C.s)(this._microSurfaceTexture,u,"microSurfaceSampler"))),this._bumpTexture&&g.getCaps().standardDerivatives&&I.c.BumpTextureEnabled&&!this._disableBumpMap&&(u.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,C.s)(this._bumpTexture,u,"bump"),J._mirroredCameraPosition?u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):u.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&u.updateFloat("pointSize",this.pointSize),Q.METALLICWORKFLOW){var r;h.g.Pc[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,h.g.Pc[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness;const q=(null===(r=this.subSurface)||void 0===r?void 0:r._indexOfRefraction)??1.5,c=1;h.g.Pc[0].b=q;const U=Math.pow((q-c)/(q+c),2);h.g.Pc[0].a=U,u.updateDirectColor4("vReflectivityColor",h.g.Pc[0]),u.updateColor4("vMetallicReflectanceFactors",this._metallicReflectanceColor,this._metallicF0Factor)}else u.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);u.updateColor3("vEmissiveColor",I.c.EmissiveTextureEnabled?this._emissiveColor:h.c.BlackReadOnly),u.updateColor3("vReflectionColor",this._reflectionColor),!Q.SS_REFRACTION&&null!==(K=this.subSurface)&&void 0!==K&&K._linkRefractionWithTransparency?u.updateColor4("vAlbedoColor",this._albedoColor,1):u.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),u.updateFloat("baseWeight",this._baseWeight),u.updateFloat("baseDiffuseRoughness",this._baseDiffuseRoughness||0),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*J.environmentIntensity,this._lightingInfos.w=this._specularIntensity,u.updateVector4("vLightingIntensity",this._lightingInfos),J.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),u.updateColor3("vAmbientColor",this._globalAmbientColor),u.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}if(J.texturesEnabled){if(this._albedoTexture&&I.c.DiffuseTextureEnabled&&u.setTexture("albedoSampler",this._albedoTexture),this._baseWeightTexture&&I.c.BaseWeightTextureEnabled&&u.setTexture("baseWeightSampler",this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&I.c.BaseDiffuseRoughnessTextureEnabled&&u.setTexture("baseDiffuseRoughnessSampler",this._baseDiffuseRoughnessTexture),this._ambientTexture&&I.c.AmbientTextureEnabled&&u.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&I.c.OpacityTextureEnabled&&u.setTexture("opacitySampler",this._opacityTexture),D&&I.c.ReflectionTextureEnabled){Q.LODBASEDMICROSFURACE?u.setTexture("reflectionSampler",D):(u.setTexture("reflectionSampler",D._lodTextureMid||D),u.setTexture("reflectionSamplerLow",D._lodTextureLow||D),u.setTexture("reflectionSamplerHigh",D._lodTextureHigh||D)),Q.USEIRRADIANCEMAP&&u.setTexture("irradianceSampler",D.irradianceTexture);const q=this.Cq().iblCdfGenerator;this.realTimeFiltering&&q&&u.setTexture("icdfSampler",q.getIcdfTexture())}Q.ENVIRONMENTBRDF&&u.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&I.c.EmissiveTextureEnabled&&u.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&I.c.LightmapTextureEnabled&&u.setTexture("lightmapSampler",this._lightmapTexture),I.c.SpecularTextureEnabled&&(this._metallicTexture?u.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&u.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&u.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&Q.REFLECTANCE&&u.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&u.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&g.getCaps().standardDerivatives&&I.c.BumpTextureEnabled&&!this._disableBumpMap&&u.setTexture("bumpSampler",this._bumpTexture)}this.Cq().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(c)&&this.Cq().depthPeelingRenderer.bind(s),this._eventInfo.subMesh=U,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,z.c)(this._activeEffect,this,J),this.bindEyePosition(s)}else J.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(W||!this.isFrozen){var H;if(J.lightsEnabled&&!this._disableLighting&&(0,C.i)(J,c,this._activeEffect,Q,this._maxSimultaneousLights),(J.fogEnabled&&c.applyFog&&J.fogMode!==n.b.FOGMODE_NONE||D||this.subSurface.refractionTexture||c.receiveShadows||Q.PREPASS)&&this.bindView(s),(0,C.f)(J,c,this._activeEffect,!0),Q.NUM_MORPH_INFLUENCERS&&(0,C.n)(c,this._activeEffect),Q.BAKED_VERTEX_ANIMATION_TEXTURE)null===(H=c.bakedVertexAnimationManager)||void 0===H||H.bind(s,Q.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,C.m)(Q,this._activeEffect,J)}this._afterBind(c,this._activeEffect,U),u.update()}getAnimatables(){const q=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&q.push(this._albedoTexture),this._baseWeightTexture&&this._baseWeightTexture.animations&&this._baseWeightTexture.animations.length>0&&q.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&this._baseDiffuseRoughnessTexture.animations&&this._baseDiffuseRoughnessTexture.animations.length>0&&q.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&q.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&q.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&q.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&q.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?q.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&q.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&q.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&q.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&q.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&q.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&q.push(this._microSurfaceTexture),q}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.Cq().environmentTexture}getActiveTextures(){const q=super.getActiveTextures();return this._albedoTexture&&q.push(this._albedoTexture),this._baseWeightTexture&&q.push(this._baseWeightTexture),this._baseDiffuseRoughnessTexture&&q.push(this._baseDiffuseRoughnessTexture),this._ambientTexture&&q.push(this._ambientTexture),this._opacityTexture&&q.push(this._opacityTexture),this._reflectionTexture&&q.push(this._reflectionTexture),this._emissiveTexture&&q.push(this._emissiveTexture),this._reflectivityTexture&&q.push(this._reflectivityTexture),this._metallicTexture&&q.push(this._metallicTexture),this._metallicReflectanceTexture&&q.push(this._metallicReflectanceTexture),this._reflectanceTexture&&q.push(this._reflectanceTexture),this._microSurfaceTexture&&q.push(this._microSurfaceTexture),this._bumpTexture&&q.push(this._bumpTexture),this._lightmapTexture&&q.push(this._lightmapTexture),q}hasTexture(q){return!!super.hasTexture(q)||(this._albedoTexture===q||(this._baseWeightTexture===q||(this._baseDiffuseRoughnessTexture===q||(this._ambientTexture===q||(this._opacityTexture===q||(this._reflectionTexture===q||(this._emissiveTexture===q||(this._reflectivityTexture===q||(this._metallicTexture===q||(this._metallicReflectanceTexture===q||(this._reflectanceTexture===q||(this._microSurfaceTexture===q||(this._bumpTexture===q||this._lightmapTexture===q)))))))))))))}setPrePassRenderer(){var q;if(null===(q=this.subSurface)||void 0===q||!q.isScatteringEnabled)return!1;const c=this.Cq().enableSubSurfaceForPrePass();return c&&(c.enabled=!0),!0}dispose(q,c){var U,J,Q,s,g,X,n,W,D,u,K,r,H,b;(this._breakShaderLoadedCheck=!0,c)&&(this._environmentBRDFTexture&&this.Cq().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(U=this._albedoTexture)||void 0===U||U.dispose(),null===(J=this._baseWeightTexture)||void 0===J||J.dispose(),null===(Q=this._baseDiffuseRoughnessTexture)||void 0===Q||Q.dispose(),null===(s=this._ambientTexture)||void 0===s||s.dispose(),null===(g=this._opacityTexture)||void 0===g||g.dispose(),null===(X=this._reflectionTexture)||void 0===X||X.dispose(),null===(n=this._emissiveTexture)||void 0===n||n.dispose(),null===(W=this._metallicTexture)||void 0===W||W.dispose(),null===(D=this._reflectivityTexture)||void 0===D||D.dispose(),null===(u=this._bumpTexture)||void 0===u||u.dispose(),null===(K=this._lightmapTexture)||void 0===K||K.dispose(),null===(r=this._metallicReflectanceTexture)||void 0===r||r.dispose(),null===(H=this._reflectanceTexture)||void 0===H||H.dispose(),null===(b=this._microSurfaceTexture)||void 0===b||b.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(q,c)}}m.PBRMATERIAL_OPAQUE=a.b.MATERIAL_OPAQUE,m.PBRMATERIAL_ALPHATEST=a.b.MATERIAL_ALPHATEST,m.PBRMATERIAL_ALPHABLEND=a.b.MATERIAL_ALPHABLEND,m.PBRMATERIAL_ALPHATESTANDBLEND=a.b.MATERIAL_ALPHATESTANDBLEND,m.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,m.LIGHTFALLOFF_PHYSICAL=0,m.LIGHTFALLOFF_GLTF=1,m.LIGHTFALLOFF_STANDARD=2,m.ForceGLSL=!1,(0,J.d)([(0,Q.u)()],m.prototype,"_imageProcessingConfiguration",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsMiscDirty")],m.prototype,"debugMode",void 0)},11341:(q,c,U)=>{U.d(c,{d:()=>u});var J=U(11010),Q=U(11019),s=U(11344),g=U(11093),X=U(11355),n=U(10850),W=U(11004),D=U(11082);class u extends X.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(q){this.subSurface.refractionTexture=q,q?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(q){this.subSurface.indexOfRefraction=q}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(q){this.subSurface.invertRefractionY=q}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(q){this.subSurface.linkRefractionWithTransparency=q,q&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===X.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(q){q!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=q?X.d.LIGHTFALLOFF_PHYSICAL:X.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===X.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(q){q!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=q?X.d.LIGHTFALLOFF_GLTF:X.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q),this._markAllSubMeshesAsImageProcessingDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(q){this.imageProcessingConfiguration.colorCurvesEnabled=q}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(q){this.imageProcessingConfiguration.colorGradingEnabled=q}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(q){this._imageProcessingConfiguration.toneMappingEnabled=q}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(q){this._imageProcessingConfiguration.exposure=q}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(q){this._imageProcessingConfiguration.contrast=q}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(q){this._imageProcessingConfiguration.colorGradingTexture=q}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(q){this._imageProcessingConfiguration.colorCurves=q}constructor(q,c){super(q,c,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=u.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=g.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new g.c(0,0,0),this.albedoColor=new g.c(1,1,1),this.baseWeight=1,this.reflectivityColor=new g.c(1,1,1),this.reflectionColor=new g.c(1,1,1),this.emissiveColor=new g.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,s.d)(this.Cq())}getClassName(){return"PBRMaterial"}clone(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const J=D.e.Clone((()=>new u(q,this.Cq())),this,{cloneTexturesOnlyOnce:c});return J.id=q,J.name=q,this.stencil.copyTo(J.stencil),this._clonePlugins(J,U),J}serialize(){const q=super.serialize();return q.customType="BABYLON.PBRMaterial",q}static Parse(q,c,U){const J=D.e.Parse((()=>new u(q.name,c)),q,c,U);return q.stencil&&J.stencil.parse(q.stencil,c,U),W.b._ParsePlugins(q,J,c,U),q.clearCoat&&J.clearCoat.parse(q.clearCoat,c,U),q.anisotropy&&J.anisotropy.parse(q.anisotropy,c,U),q.brdf&&J.brdf.parse(q.brdf,c,U),q.sheen&&J.sheen.parse(q.sheen,c,U),q.subSurface&&J.subSurface.parse(q.subSurface,c,U),q.iridescence&&J.iridescence.parse(q.iridescence,c,U),J}}u.PBRMATERIAL_OPAQUE=X.d.PBRMATERIAL_OPAQUE,u.PBRMATERIAL_ALPHATEST=X.d.PBRMATERIAL_ALPHATEST,u.PBRMATERIAL_ALPHABLEND=X.d.PBRMATERIAL_ALPHABLEND,u.PBRMATERIAL_ALPHATESTANDBLEND=X.d.PBRMATERIAL_ALPHATESTANDBLEND,u.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=X.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"directIntensity",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"emissiveIntensity",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"environmentIntensity",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"specularIntensity",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"disableBumpMap",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"albedoTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"baseWeightTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"baseDiffuseRoughnessTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientTexture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientTextureStrength",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"opacityTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectionTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"emissiveTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectivityTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallicTexture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallic",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"roughness",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallicF0Factor",void 0),(0,J.d)([(0,Q.j)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallicReflectanceColor",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"metallicReflectanceTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectanceTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"microSurfaceTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"bumpTexture",void 0),(0,J.d)([(0,Q.D)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty",null)],u.prototype,"lightmapTexture",void 0),(0,J.d)([(0,Q.j)("ambient"),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"ambientColor",void 0),(0,J.d)([(0,Q.j)("albedo"),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"albedoColor",void 0),(0,J.d)([(0,Q.N)("baseWeight"),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"baseWeight",void 0),(0,J.d)([(0,Q.N)("baseDiffuseRoughness"),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"baseDiffuseRoughness",void 0),(0,J.d)([(0,Q.j)("reflectivity"),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectivityColor",void 0),(0,J.d)([(0,Q.j)("reflection"),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"reflectionColor",void 0),(0,J.d)([(0,Q.j)("emissive"),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"emissiveColor",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"microSurface",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useLightmapAsShadowmap",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"useAlphaFromAlbedoTexture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"forceAlphaTest",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],u.prototype,"alphaCutOff",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useSpecularOverAlpha",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAmbientInGrayScale",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,J.d)([(0,Q.N)()],u.prototype,"usePhysicalLightFalloff",null),(0,J.d)([(0,Q.N)()],u.prototype,"useGLTFLightFalloff",null),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRadianceOverAlpha",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useObjectSpaceNormalMap",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useParallax",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useParallaxOcclusion",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"parallaxScaleBias",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsLightsDirty")],u.prototype,"disableLighting",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"forceIrradianceInFragment",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsLightsDirty")],u.prototype,"maxSimultaneousLights",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertNormalMapX",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"invertNormalMapY",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"twoSidedLighting",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useAlphaFresnel",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useLinearAlphaFresnel",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"environmentBRDFTexture",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"forceNormalForward",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"enableSpecularAntiAliasing",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useHorizonOcclusion",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRadianceOcclusion",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],u.prototype,"unlit",void 0),(0,J.d)([(0,Q.N)(),(0,Q.c)("_markAllSubMeshesAsMiscDirty")],u.prototype,"applyDecalMapAfterDetailMap",void 0),(0,n.f)("BABYLON.PBRMaterial",u)},10988:(q,c,U)=>{U.d(c,{c:()=>g});var J=U(10886);const Q=new Map;function s(q,c){(function(q){return Q.delete(q)})(q)&&J.c.Warn(`Extension with the name '${q}' already exists`),Q.set(q,c)}function g(q,c){"image/ktx"!==c&&"image/ktx2"!==c||(q=".ktx"),Q.has(q)||(q.endsWith(".ies")&&s(".ies",(async()=>await U.e(28).then(U.bind(U,13361)).then((q=>new q._IESTextureLoader)))),q.endsWith(".dds")&&s(".dds",(async()=>await U.e(25).then(U.bind(U,13365)).then((q=>new q._DDSTextureLoader)))),q.endsWith(".basis")&&s(".basis",(async()=>await U.e(29).then(U.bind(U,13374)).then((q=>new q._BasisTextureLoader)))),q.endsWith(".env")&&s(".env",(async()=>await Promise.all([U.e(24),U.e(30)]).then(U.bind(U,13383)).then((q=>new q._ENVTextureLoader)))),q.endsWith(".hdr")&&s(".hdr",(async()=>await U.e(31).then(U.bind(U,13391)).then((q=>new q._HDRTextureLoader)))),(q.endsWith(".ktx")||q.endsWith(".ktx2"))&&(s(".ktx",(async()=>await U.e(32).then(U.bind(U,13393)).then((q=>new q._KTXTextureLoader)))),s(".ktx2",(async()=>await U.e(32).then(U.bind(U,13393)).then((q=>new q._KTXTextureLoader))))),q.endsWith(".tga")&&s(".tga",(async()=>await U.e(33).then(U.bind(U,13399)).then((q=>new q._TGATextureLoader)))),q.endsWith(".exr")&&s(".exr",(async()=>await U.e(34).then(U.bind(U,13401)).then((q=>new q._ExrTextureLoader)))));const J=Q.get(q);return J?Promise.resolve(J(c)):null}},11280:(q,c,U)=>{U.d(c,{b:()=>K});var J=U(11010),Q=U(11019),s=U(10866),g=U(10833),X=U(10864),n=U(10995),W=(U(10922),U(11271));class D{get wrapU(){return this._wrapU}set wrapU(q){this._wrapU=q}get wrapV(){return this._wrapV}set wrapV(q){this._wrapV=q}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(q){this._texture&&(this._texture.isCube=q)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(q){this._texture&&(this._texture.is3D=q)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(q){this._texture&&(this._texture.is2DArray=q)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(q){return void 0!==(null===q||void 0===q?void 0:q.shareDepth)}constructor(q){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=W.b.Zero(),this._cachedBaseSize=W.b.Zero(),this._initialSamplingMode=2,this._texture=D._IsRenderTargetWrapper(q)?q.texture:q,this._texture&&(this._engine=this._texture.getEngine(),this.wrapU=this._texture._cachedWrapU??this.wrapU,this.wrapV=this._texture._cachedWrapV??this.wrapV,this.wrapR=this._texture._cachedWrapR??this.wrapR)}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(q){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(q,this._texture,this._texture.generateMipMaps)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var u=U(11082);class K extends D{set Hc(q){this._hasAlpha!==q&&(this._hasAlpha=q,this._scene&&this._scene.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get Hc(){return this._hasAlpha}set getAlphaFromRGB(q){this._getAlphaFromRGB!==q&&(this._getAlphaFromRGB=q,this._scene&&this._scene.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(q){this._coordinatesIndex!==q&&(this._coordinatesIndex=q,this._scene&&this._scene.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(q){this._coordinatesMode!==q&&(this._coordinatesMode=q,this._scene&&this._scene.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(q){this._wrapU=q}get wrapV(){return this._wrapV}set wrapV(q){this._wrapV=q}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(q){this._texture?this._texture.isCube=q:this._isCube=q}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(q){this._texture&&(this._texture.is3D=q)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(q){this._texture&&(this._texture.is2DArray=q)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(q){var c;if(this._texture){if(this._texture._gammaSpace===q)return;this._texture._gammaSpace=q}else{if(this._gammaSpace===q)return;this._gammaSpace=q}null===(c=this.Cq())||void 0===c||c.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(q){var c;q!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=q),null===(c=this.Cq())||void 0===c||c.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(q){this._texture&&(this._texture._lodGenerationOffset=q)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(q){this._texture&&(this._texture._lodGenerationScale=q)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(q){this._texture&&(this._texture._linearSpecularLOD=q)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(q){this._texture&&(this._texture._irradianceTexture=q)}get uid(){return this._uid||(this._uid=(0,n.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(q){this._onDisposeObserver&&this.Cc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Cc.add(q)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=K.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this._dominantDirection=null,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.Cc=new s.e,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,q?K._IsScene(q)?this._scene=q:this._engine=q:this._scene=X.c.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=c,this._uid=null}Cq(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return g.d.IdentityReadOnly}getReflectionTextureMatrix(){return g.d.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(q){}get canRescale(){return!1}_getFromCache(q,c,U,J,Q,s){const g=this._getEngine();if(!g)return null;const X=g._getUseSRGBBuffer(!!Q,c),n=g.getLoadedTexturesCache();for(let W=0;W<n.length;W++){const g=n[W];if((void 0===Q||X===g._useSRGBBuffer)&&(void 0===J||J===g.invertY)&&g.url===q&&g.generateMipMaps===!c&&(!U||U===g.samplingMode)&&(void 0===s||s===g.isCube))return g.incrementReferences(),g}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const q=this.Cq();q&&q.markAllMaterialsAsDirty(1)}readPixels(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const W=this._getEngine();if(!W)return null;const D=this.getSize();let u=D.width,K=D.height;0!==c&&(u/=Math.pow(2,c),K/=Math.pow(2,c),u=Math.round(u),K=Math.round(K)),X=Math.min(u,X),n=Math.min(K,n);try{return this._texture.isCube?W._readTexturePixels(this._texture,X,n,q,c,U,J,Q,s,g):W._readTexturePixels(this._texture,X,n,-1,c,U,J,Q,s,g)}catch(r){return null}}_readPixelsSync(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const s=this.getSize();let g=s.width,X=s.height;const n=this._getEngine();if(!n)return null;0!=c&&(g/=Math.pow(2,c),X/=Math.pow(2,c),g=Math.round(g),X=Math.round(X));try{return this._texture.isCube?n._readTexturePixelsSync(this._texture,g,X,q,c,U,J,Q):n._readTexturePixelsSync(this._texture,g,X,-1,c,U,J,Q)}catch(W){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const q=this._scene.textures.indexOf(this);if(q>=0&&this._scene.textures.splice(q,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const q=this._parentContainer.textures.indexOf(this);q>-1&&this._parentContainer.textures.splice(q,1),this._parentContainer=null}}this.Cc.notifyObservers(this),this.Cc.clear(),this.metadata=null,super.dispose()}serialize(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!q)return null;const c=u.e.Serialize(this);return u.e.AppendSerializedAnimations(this,c),c}static WhenAllReady(q,c){let U=q.length;if(0!==U)for(let J=0;J<q.length;J++){const Q=q[J];if(Q.isReady())0===--U&&c();else{const q=Q.onLoadObservable;q?q.addOnce((()=>{0===--U&&c()})):0===--U&&c()}}else c()}static _IsScene(q){return"Scene"===q.getClassName()}}K.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,J.d)([(0,Q.N)()],K.prototype,"uniqueId",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"name",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"displayName",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"metadata",void 0),(0,J.d)([(0,Q.N)("Hc")],K.prototype,"_hasAlpha",void 0),(0,J.d)([(0,Q.N)("getAlphaFromRGB")],K.prototype,"_getAlphaFromRGB",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"level",void 0),(0,J.d)([(0,Q.N)("coordinatesIndex")],K.prototype,"_coordinatesIndex",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"optimizeUVAllocation",void 0),(0,J.d)([(0,Q.N)("coordinatesMode")],K.prototype,"_coordinatesMode",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"wrapU",null),(0,J.d)([(0,Q.N)()],K.prototype,"wrapV",null),(0,J.d)([(0,Q.N)()],K.prototype,"wrapR",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"anisotropicFilteringLevel",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"isCube",null),(0,J.d)([(0,Q.N)()],K.prototype,"is3D",null),(0,J.d)([(0,Q.N)()],K.prototype,"is2DArray",null),(0,J.d)([(0,Q.N)()],K.prototype,"gammaSpace",null),(0,J.d)([(0,Q.N)()],K.prototype,"invertZ",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"lodLevelInAlpha",void 0),(0,J.d)([(0,Q.N)()],K.prototype,"lodGenerationOffset",null),(0,J.d)([(0,Q.N)()],K.prototype,"lodGenerationScale",null),(0,J.d)([(0,Q.N)()],K.prototype,"linearSpecularLOD",null),(0,J.d)([(0,Q.D)()],K.prototype,"irradianceTexture",null),(0,J.d)([(0,Q.N)()],K.prototype,"isRenderTarget",void 0)},11441:(q,c,U)=>{var J=U(11450),Q=U(11280);Q.b.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(Q.b.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=J.c.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((q=>{this._texture._sphericalPolynomial=q,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(q){this._texture&&(this._texture._sphericalPolynomial=q)},enumerable:!0,configurable:!0})},10976:(q,c,U)=>{U.d(c,{e:()=>g});var J,Q=U(10866),s=U(10980);!function(q){q[q.Unknown=0]="Unknown",q[q.Url=1]="Url",q[q.Temp=2]="Temp",q[q.Raw=3]="Raw",q[q.Dynamic=4]="Dynamic",q[q.RenderTarget=5]="RenderTarget",q[q.MultiRenderTarget=6]="MultiRenderTarget",q[q.Cube=7]="Cube",q[q.CubeRaw=8]="CubeRaw",q[q.CubePrefiltered=9]="CubePrefiltered",q[q.Raw3D=10]="Raw3D",q[q.Raw2DArray=11]="Raw2DArray",q[q.DepthStencil=12]="DepthStencil",q[q.CubeRawRGBD=13]="CubeRawRGBD",q[q.Depth=14]="Depth"}(J||(J={}));class g extends s.d{get useMipMaps(){return this.generateMipMaps}set useMipMaps(q){this.generateMipMaps=q}get uniqueId(){return this._uniqueId}_setUniqueId(q){this._uniqueId=q}getEngine(){return this._engine}get source(){return this._source}constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new Q.e,this.onErrorObservable=new Q.e,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._autoMSAAManagement=!1,this._engine=q,this._source=c,this._uniqueId=g._Counter++,U||(this._hardwareTexture=q._createHardwareTexture())}incrementReferences(){this._references++}updateSize(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,q,c,U),this.width=q,this.height=c,this.depth=U,this.baseWidth=q,this.baseHeight=c,this.baseDepth=U,this._size=q*c*U}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const q=this.onRebuildCallback(this),c=c=>{c._swapAndDie(this,!1),this.isReady=q.isReady};return void(q.isAsync?q.proxy.then(c):c(q.proxy))}let q;switch(this.source){case 2:case 12:case 14:break;case 1:return void(q=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(q=>{q._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:q=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),q._swapAndDie(this,!1),this.isReady=!0;break;case 10:q=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),q._swapAndDie(this,!1),this.isReady=!0;break;case 11:q=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),q._swapAndDie(this,!1),this.isReady=!0;break;case 4:q=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),q._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(q=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{q._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:q=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),q._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return q=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(q=>{q&&q._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(q._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(q){var c;let U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(c=this._hardwareTexture)||void 0===c||c.setUsage(q._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),q._hardwareTexture=this._hardwareTexture,U&&(q._isRGBD=this._isRGBD),this._lodTextureHigh&&(q._lodTextureHigh&&q._lodTextureHigh.dispose(),q._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(q._lodTextureMid&&q._lodTextureMid.dispose(),q._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(q._lodTextureLow&&q._lodTextureLow.dispose(),q._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(q._irradianceTexture&&q._irradianceTexture.dispose(),q._irradianceTexture=this._irradianceTexture);const J=this._engine.getLoadedTexturesCache();let Q=J.indexOf(this);-1!==Q&&J.splice(Q,1),Q=J.indexOf(q),-1===Q&&J.push(q)}dispose(){this._references--,0===this._references&&(this.onLoadedObservable.clear(),this.onErrorObservable.clear(),this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}g._Counter=0},11321:(q,c,U)=>{U.d(c,{e:()=>Q});var J=U(11288);class Q extends J.c{constructor(q,c,U,Q,s){let g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>9?arguments[9]:void 0,u=arguments.length>10?arguments[10]:void 0,K=arguments.length>11?arguments[11]:void 0;super(null,s,!g,X,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,D),this.format=Q,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==W||(n=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==W||(n=1),this._texture=this._engine.createRawTexture(q,c,U,Q,g,X,n,null,W,D??0,u??!1),this.wrapU=J.c.CLAMP_ADDRESSMODE,this.wrapV=J.c.CLAMP_ADDRESSMODE,this._waitingForData=!!K&&!q)}update(q){this._getEngine().updateRawTexture(this._texture,q,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer),this._waitingForData=!1}clone(){if(!this._texture)return super.clone();const q=new Q(null,this.getSize().width,this.getSize().height,this.format,this.Cq(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return q._texture=this._texture,this._texture.incrementReferences(),q}isReady(){return super.isReady()&&!this._waitingForData}static CreateLuminanceTexture(q,c,U,J){return new Q(q,c,U,1,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(q,c,U,J){return new Q(q,c,U,2,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(q,c,U,J){return new Q(q,c,U,0,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(q,c,U,J){return new Q(q,c,U,4,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(q,c,U,J){return new Q(q,c,U,5,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9],arguments.length>10&&void 0!==arguments[10]&&arguments[10])}static CreateRGBAStorageTexture(q,c,U,J){return new Q(q,c,U,5,J,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(q,c,U,s){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:J.c.TRILINEAR_SAMPLINGMODE;return new Q(q,c,U,6,s,g,X,n,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(q,c,U,s){let g=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:J.c.TRILINEAR_SAMPLINGMODE;return new Q(q,c,U,6,s,g,X,n,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11296:(q,c,U)=>{U.d(c,{e:()=>r});var J=U(10866),Q=U(10833),s=U(11288),g=U(11303),X=U(11002),n=U(10956),W=U(10886),D=U(11305),u=U(10845);class K{get renderList(){return this._renderList}set renderList(q){this._renderList!==q&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),q&&(this._unObserveRenderList=(0,u.f)(q,this._renderListHasChanged)),this._renderList=q)}get disableImageProcessing(){return this._disableImageProcessing}set disableImageProcessing(q){q!==this._disableImageProcessing&&(this._disableImageProcessing=q,this._scene.markAllMaterialsAsDirty(64))}get name(){return this._name}set name(q){if(this._name===q)return;if(this._name=q,!this._scene)return;const c=this._scene.getEngine();for(let U=0;U<this._renderPassIds.length;++U){const q=this._renderPassIds[U];c._renderPassNames[q]=`${this._name}#${U}`}}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(q,c){let U;U=Array.isArray(q)?q:[q];for(let J=0;J<U.length;++J)for(let q=0;q<this.options.numPasses;++q){let Q=U[J];U[J].isAnInstance&&(Q=U[J].sourceMesh),Q.setMaterialForRenderPass(this._renderPassIds[q],void 0!==c?Array.isArray(c)?c[q]:c:void 0)}}constructor(q,c,U){this._unObserveRenderList=null,this._renderListHasChanged=(q,c)=>{const U=this._renderList?this._renderList.length:0;if(0===c&&U>0||0===U)for(const J of this._scene.meshes)J._markSubMeshesAsLightDirty()},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this._disableImageProcessing=!1,this.onBeforeRenderObservable=new J.e,this.onAfterRenderObservable=new J.e,this.onBeforeRenderingManagerRenderObservable=new J.e,this.onAfterRenderingManagerRenderObservable=new J.e,this.onFastPathRenderObservable=new J.e,this._currentRefreshId=-1,this._refreshRate=1,this._currentApplyByPostProcessSetting=!1,this._currentSceneCamera=null,this.name=q,this._scene=c,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...U},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new D.d(c),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const q=this._scene.getEngine();for(let c=0;c<this.options.numPasses;++c)q.releaseRenderPassId(this._renderPassIds[c]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const q=this._scene.getEngine();for(let c=0;c<this.options.numPasses;++c)this._renderPassIds[c]=q.createRenderPassId(`${this.name}#${c}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(q){this._refreshRate=q,this.resetRefreshCounter()}shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(q,c){this.prepareRenderList(),this.initRender(q,c);const U=this._checkReadiness();return this.finishRender(),U}prepareRenderList(){const q=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let c=0;c<this._waitingRenderList.length;c++){const U=this._waitingRenderList[c],J=q.getMeshById(U);J&&this.renderList.push(J)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const q=this._scene.meshes;for(let c=0;c<q.length;c++){const U=q[c];this.renderListPredicate(U)&&this.renderList.push(U)}}this._currentApplyByPostProcessSetting=this._scene.imageProcessingConfiguration.applyByPostProcess,this._disableImageProcessing&&(this._scene.imageProcessingConfiguration._applyByPostProcess=this._disableImageProcessing)}initRender(q,c){const U=this._scene.getEngine(),J=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,J&&(J!==this._scene.activeCamera&&(this._scene.setTransformMatrix(J.getViewMatrix(),J.getProjectionMatrix(!0)),this._scene.activeCamera=J),U.setViewport(J.rigParent?J.rigParent.viewport:J.viewport,q,c)),this._defaultRenderListPrepared=!1}finishRender(){const q=this._scene;this._disableImageProcessing&&(q.imageProcessingConfiguration._applyByPostProcess=this._currentApplyByPostProcessSetting),q.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==q.activeCamera&&q.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),q.getEngine().setViewport(this._currentSceneCamera.viewport)),q.resetCachedMaterial()}render(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const U=this._scene,J=U.getEngine(),Q=J.currentRenderPassId;J.currentRenderPassId=this._renderPassIds[q],this.onBeforeRenderObservable.notifyObservers(q);if(J.snapshotRendering&&1===J.snapshotRenderingMode)this.onFastPathRenderObservable.notifyObservers(q);else{let c=null;const J=this.renderList?this.renderList:U.getActiveMeshes().data,Q=this.renderList?this.renderList.length:U.getActiveMeshes().length;this.getCustomRenderList&&(c=this.getCustomRenderList(q,J,Q)),c?this._prepareRenderingManager(c,c.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(J,Q,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),c=J),this.onBeforeRenderingManagerRenderObservable.notifyObservers(q),this._renderingManager.render(this.customRenderFunction,c,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(q)}c||this.onAfterRenderObservable.notifyObservers(q),J.currentRenderPassId=Q}_checkReadiness(){const q=this._scene,c=q.getEngine(),U=c.currentRenderPassId;let J=!0;q.getViewMatrix()||q.updateTransformMatrix();const Q=this.options.numPasses;for(let g=0;g<Q&&J;g++){let U=null;const s=this.renderList?this.renderList:q.getActiveMeshes().data,X=this.renderList?this.renderList.length:q.getActiveMeshes().length;c.currentRenderPassId=this._renderPassIds[g],this.onBeforeRenderObservable.notifyObservers(g),this.getCustomRenderList&&(U=this.getCustomRenderList(g,s,X)),U||(U=s),this.options.doNotChangeAspectRatio||q.updateTransformMatrix(!0);for(let q=0;q<U.length&&J;++q){const c=U[q];if(c.isEnabled()&&!c.isBlocked&&c.isVisible&&c.Gc)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(c,this.refreshRate,!0)){J=!1;continue}}else if(!c.isReady(!0)){J=!1;continue}}this.onAfterRenderObservable.notifyObservers(g),Q>1&&(q.incrementRenderId(),q.resetCachedMaterial())}const s=this.particleSystemList||q.qK;for(const g of s)g.isReady()||(J=!1);return c.currentRenderPassId=U,J}_prepareRenderingManager(q,c,U){const J=this._scene,Q=J.activeCamera,s=this.cameraForLOD??Q;this._renderingManager.reset();const g=J.getRenderId(),X=J.getFrameId();for(let W=0;W<c;W++){const c=q[W];if(c&&!c.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(c,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!c.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}let q,n=null;if(s){const q=c._internalAbstractMeshDataInfo._currentLOD.get(s);q&&q[1]===X?n=q[0]:(n=J.customLODSelector?J.customLODSelector(c,s):c.getLOD(s),q?(q[0]=n,q[1]=X):c._internalAbstractMeshDataInfo._currentLOD.set(s,[n,X]))}else n=c;if(!n)continue;if(n!==c&&0!==n.billboardMode&&n.o(),n._preActivateForIntermediateRendering(g),q=!(!U||!Q)&&0===(c.layerMask&Q.layerMask),c.isEnabled()&&c.isVisible&&c.Gc&&!q){if(n!==c&&n._activate(g,!0),c._activate(g,!0)&&c.Gc.length){c.isAnInstance?c._internalAbstractMeshDataInfo._actAsRegularMesh&&(n=c):n._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,n._internalAbstractMeshDataInfo._isActiveIntermediate=!0,J._prepareSkeleton(n);for(let q=0;q<n.Gc.length;q++){const c=n.Gc[q];this._renderingManager.dispatch(c,n)}}c._postActivate()}}}const n=this.particleSystemList||J.qK;for(let W=0;W<n.length;W++){const q=n[W],c=q.j;q.isStarted()&&c&&(!c.position||c.isEnabled())&&this._renderingManager.dispatchParticles(q)}}setRenderingOrder(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(q,c,U,J)}setRenderingAutoClearDepthStencil(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(q,c,U,J),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const q=new K(this.name,this._scene,this.options);return this.renderList&&(q.renderList=this.renderList.slice(0)),q}dispose(){const q=this.renderList?this.renderList:this._scene.getActiveMeshes().data,c=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let U=0;U<c;U++){const c=q[U];c&&void 0!==c.getMaterialForRenderPass(this.renderPassId)&&c.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===K.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=K.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}K.REFRESHRATE_RENDER_ONCE=0,K.REFRESHRATE_RENDER_ONEVERYFRAME=1,K.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,n.b.prototype.setDepthStencilTexture=function(q,c){this._engine.setDepthStencilTexture(this._samplers[q],this._uniforms[q],c,q)};class r extends s.c{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(q){this._objectRenderer.renderListPredicate=q}get renderList(){return this._objectRenderer.renderList}set renderList(q){this._objectRenderer.renderList=q}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(q){this._objectRenderer.particleSystemList=q}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(q){this._objectRenderer.getCustomRenderList=q}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(q){this._objectRenderer.renderParticles=q}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(q){this._objectRenderer.renderSprites=q}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(q){this._objectRenderer.forceLayerMaskCheck=q}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(q){this._objectRenderer.activeCamera=q}get cameraForLOD(){return this._objectRenderer.cameraForLOD}set cameraForLOD(q){this._objectRenderer.cameraForLOD=q}get disableImageProcessing(){return this._objectRenderer.disableImageProcessing}set disableImageProcessing(q){this._objectRenderer.disableImageProcessing=q}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(q){this._objectRenderer.customIsReadyFunction=q}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(q){this._objectRenderer.customRenderFunction=q}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(q){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(q)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(q){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(q)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(q){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(q)}set onClear(q){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(q)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(q){this._objectRenderer._waitingRenderList=q}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(q,c){this._objectRenderer.setMaterialForRendering(q,c)}get isMulti(){var q;return(null===(q=this._renderTarget)||void 0===q?void 0:q.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(q){if(this._boundingBoxSize&&this._boundingBoxSize.equals(q))return;this._boundingBoxSize=q;const c=this.Cq();c&&c.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var q;return(null===(q=this._renderTarget)||void 0===q?void 0:q._depthStencilTexture)??null}constructor(q,c,U){let g,X,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],D=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]?arguments[7]:s.c.TRILINEAR_SAMPLINGMODE,b=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],h=arguments.length>9&&void 0!==arguments[9]&&arguments[9],o=arguments.length>10&&void 0!==arguments[10]&&arguments[10],a=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,p=arguments.length>12&&void 0!==arguments[12]&&arguments[12],R=arguments.length>13?arguments[13]:void 0,I=arguments.length>14?arguments[14]:void 0,t=arguments.length>15&&void 0!==arguments[15]&&arguments[15],C=arguments.length>16&&void 0!==arguments[16]&&arguments[16],i=!0;if("object"===typeof n){const q=n;n=!!q.generateMipMaps,D=q.doNotChangeAspectRatio??!0,u=q.type??0,r=!!q.isCube,H=q.samplingMode??s.c.TRILINEAR_SAMPLINGMODE,b=q.generateDepthBuffer??!0,h=!!q.generateStencilBuffer,o=!!q.isMulti,a=q.format??5,p=!!q.delayAllocation,R=q.samples,I=q.creationFlags,t=!!q.noColorAttachment,C=!!q.useSRGBBuffer,g=q.colorAttachment,i=q.gammaSpace??i,X=q.existingObjectRenderer}if(super(null,U,!n,void 0,H,void 0,void 0,void 0,void 0,a),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new J.e,this.onAfterUnbindObservable=new J.e,this.onClearObservable=new J.e,this.onResizeObservable=new J.e,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this._dontDisposeObjectRenderer=!1,this.boundingBoxPosition=Q.p.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,!(U=this.Cq()))return;const F=this.Cq().getEngine();this._gammaSpace=i,this._coordinatesMode=s.c.PROJECTION_MODE,this.name=q,this.isRenderTarget=!0,this._initialSizeParameter=c,this._dontDisposeObjectRenderer=!!X,this._processSizeParameter(c),this._objectRenderer=X??new K(q,U,{numPasses:r?6:this.getRenderLayers()||1,doNotChangeAspectRatio:D}),this._onBeforeRenderingManagerRenderObserver=this._objectRenderer.onBeforeRenderingManagerRenderObservable.add((()=>{if(!this._disableEngineStages)for(const q of this._scene._beforeRenderTargetClearStage)q.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(F):this.skipInitialClear||F.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const q of this._scene._beforeRenderTargetDrawStage)q.action(this,this._currentFaceIndex,this._currentLayer)})),this._onAfterRenderingManagerRenderObserver=this._objectRenderer.onAfterRenderingManagerRenderObservable.add((()=>{var q;if(!this._disableEngineStages)for(const U of this._scene._afterRenderTargetDrawStage)U.action(this,this._currentFaceIndex,this._currentLayer);const c=(null===(q=this._texture)||void 0===q?void 0:q.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const U of this._scene._afterRenderTargetPostProcessStage)U.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=c),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),F):W.c.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))})),this._onFastPathRenderObserver=this._objectRenderer.onFastPathRenderObservable.add((()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(F):this.skipInitialClear||F.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)})),this._resizeObserver=F.onResizeObservable.add((()=>{})),this._generateMipMaps=!!n,this._doNotChangeAspectRatio=D,o||(this._renderTargetOptions={generateMipMaps:n,type:u,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:b,generateStencilBuffer:h,samples:R,creationFlags:I,noColorAttachment:t,useSRGBBuffer:C,colorAttachment:g,label:this.name},this.samplingMode===s.c.NEAREST_SAMPLINGMODE&&(this.wrapU=s.c.CLAMP_ADDRESSMODE,this.wrapV=s.c.CLAMP_ADDRESSMODE),p||(r?(this._renderTarget=U.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=s.c.INVCUBIC_MODE,this._textureMatrix=Q.d.Identity()):this._renderTarget=U.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==R&&(this.samples=R)))}createDepthStencilTexture(){var q;let c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],J=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,g=arguments.length>5?arguments[5]:void 0;null===(q=this._renderTarget)||void 0===q||q.createDepthStencilTexture(c,U,J,Q,s,g)}_processSizeParameter(q){if(q.ratio){this._sizeRatio=q.ratio;const c=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(c.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(c.getRenderHeight(),this._sizeRatio)}}else this._size=q}get samples(){var q;return(null===(q=this._renderTarget)||void 0===q?void 0:q.samples)??this._samples}set samples(q){this._renderTarget&&(this._samples=this._renderTarget.setSamples(q))}addPostProcess(q){if(!this._postProcessManager){const q=this.Cq();if(!q)return;this._postProcessManager=new g.d(q),this._postProcesses=new Array}this._postProcesses.push(q),this._postProcesses[0].Gu=!1}clearPostProcesses(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(q)for(const q of this._postProcesses)q.dispose();this._postProcesses=[]}}removePostProcess(q){if(!this._postProcesses)return;const c=this._postProcesses.indexOf(q);-1!==c&&(this._postProcesses.splice(c,1),this._postProcesses.length>0&&(this._postProcesses[0].Gu=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(q){this._objectRenderer.refreshRate=q}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const q=this._size.layers;if(q)return q;const c=this._size.depth;return c||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(q){const c=Math.max(1,this.getRenderSize()*q);this.resize(c)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(q){var c;const U=this.isCube;null===(c=this._renderTarget)||void 0===c||c.dispose(),this._renderTarget=null;const J=this.Cq();J&&(this._processSizeParameter(q),this._renderTarget=U?J.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):J.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(q,c)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(U.bind(U,11337)).then((q=>this._dumpTools=q))),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const q=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),q}_render(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const U=this.Cq();if(U){if(void 0!==this.useCameraPostProcesses&&(q=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let J=0;J<6;J++)this._renderToTarget(J,q,c),U.incrementRenderId(),U.resetCachedMaterial();else this._renderToTarget(0,q,c);else for(let J=0;J<this.getRenderLayers();J++)this._renderToTarget(0,q,c,J),U.incrementRenderId(),U.resetCachedMaterial();this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(q,c){const U=q*c,J=(0,X.p)(U+16384/(128+U));return Math.min((0,X.d)(q),J)}_bindFrameBuffer(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=this.Cq();if(!U)return;const J=U.getEngine();this._renderTarget&&J.bindFramebuffer(this._renderTarget,this.isCube?q:void 0,void 0,void 0,this.ignoreCameraViewport,0,c)}_unbindFrameBuffer(q,c){this._renderTarget&&q.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(c)}))}_prepareFrame(q,c,U,J){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses)||this._bindFrameBuffer(c,U):J&&q.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(c,U)}_renderToTarget(q,c,U){var J,Q;let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const g=this.Cq();if(!g)return;const X=g.getEngine();this._currentFaceIndex=q,this._currentLayer=s,this._currentUseCameraPostProcess=c,this._currentDumpForDebug=U,this._prepareFrame(g,q,s,c),null===(J=X._debugPushGroup)||void 0===J||J.call(X,`render to face #${q} layer #${s}`,2),this._objectRenderer.render(q+s,!0),null===(Q=X._debugPopGroup)||void 0===Q||Q.call(X,2),this._unbindFrameBuffer(X,q),this._texture&&this.isCube&&5===q&&X.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._objectRenderer.setRenderingOrder(q,c,U,J)}setRenderingAutoClearDepthStencil(q,c){this._objectRenderer.setRenderingAutoClearDepthStencil(q,c)}clone(){const q=this.getSize(),c=new r(this.name,q,this.Cq(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return c.Hc=this.Hc,c.level=this.level,c.coordinatesMode=this.coordinatesMode,this.renderList&&(c.renderList=this.renderList.slice(0)),c}serialize(){if(!this.name)return null;const q=super.serialize();if(q.renderTargetSize=this.getRenderSize(),q.renderList=[],this.renderList)for(let c=0;c<this.renderList.length;c++)q.renderList.push(this.renderList[c].id);return q}disposeFramebufferObjects(){var q;null===(q=this._renderTarget)||void 0===q||q.dispose(!0)}releaseInternalTexture(){var q;null===(q=this._renderTarget)||void 0===q||q.releaseTextures(),this._texture=null}dispose(){var q;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.onBeforeRenderingManagerRenderObservable.remove(this._onBeforeRenderingManagerRenderObserver),this._objectRenderer.onAfterRenderingManagerRenderObservable.remove(this._onAfterRenderingManagerRenderObserver),this._objectRenderer.onFastPathRenderObservable.remove(this._onFastPathRenderObserver),this._dontDisposeObjectRenderer||this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.Cq().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const c=this.Cq();if(!c)return;let U=c.customRenderTargets.indexOf(this);U>=0&&c.customRenderTargets.splice(U,1);for(const J of c.cameras)U=J.customRenderTargets.indexOf(this),U>=0&&J.customRenderTargets.splice(U,1);null===(q=this._renderTarget)||void 0===q||q.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}r.REFRESHRATE_RENDER_ONCE=K.REFRESHRATE_RENDER_ONCE,r.REFRESHRATE_RENDER_ONEVERYFRAME=K.REFRESHRATE_RENDER_ONEVERYFRAME,r.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=K.REFRESHRATE_RENDER_ONEVERYTWOFRAMES,s.c._CreateRenderTargetTexture=(q,c,U,J,Q)=>new r(q,c,U,J)},11288:(q,c,U)=>{U.d(c,{c:()=>p});var J=U(11010),Q=U(11019),s=U(10866),g=U(10833),X=U(11280),n=U(10850),W=U(10910),D=U(10945),u=U(10991),K=U(11077),r=U(10930);function H(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=c.width,Q=c.height;if(q instanceof Float32Array){let c=q.byteLength/q.BYTES_PER_ELEMENT;const U=new Uint8Array(c);for(;--c>=0;){let J=q[c];J<0?J=0:J>1&&(J=1),U[c]=255*J}q=U}const s=document.createElement("canvas");s.width=J,s.height=Q;const g=s.getContext("2d");if(!g)return null;const X=g.createImageData(J,Q);if(X.data.set(q),g.putImageData(X,0,0),U){const q=document.createElement("canvas");q.width=J,q.height=Q;const c=q.getContext("2d");return c?(c.translate(0,Q),c.scale(1,-1),c.drawImage(s,0,0),q.toDataURL("image/png")):null}return s.toDataURL("image/png")}function b(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=q.getInternalTexture();if(!J)return null;const Q=q._readPixelsSync(c,U);return Q?H(Q,q.getSize(),J.invertY):null}async function h(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=q.getInternalTexture();if(!J)return null;const Q=await q.readPixels(c,U);return Q?H(Q,q.getSize(),J.invertY):null}var o=U(11178),a=U(11082);class p extends X.b{static _CreateVideoTexture(q,c,U){arguments.length>5&&void 0!==arguments[5]||p.TRILINEAR_SAMPLINGMODE;throw(0,W.d)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(q){this._isBlocking=q}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(q,c,U,J){let Q,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:p.TRILINEAR_SAMPLINGMODE,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],K=arguments.length>9?arguments[9]:void 0,r=arguments.length>10?arguments[10]:void 0,H=arguments.length>11?arguments[11]:void 0,b=arguments.length>12?arguments[12]:void 0,h=arguments.length>13?arguments[13]:void 0;super(c),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new s.e,this._isBlocking=!0,this.name=q||"",this.url=q;let a=!1,R=null,I=!0;"object"===typeof U&&null!==U?(Q=U.noMipmap??!1,J=U.invertY??!o.b,g=U.samplingMode??p.TRILINEAR_SAMPLINGMODE,X=U.L??null,n=U.onError??null,W=U.buffer??null,u=U.deleteBuffer??!1,K=U.format,r=U.mimeType,H=U.loaderOptions,b=U.creationFlags,a=U.useSRGBBuffer??!1,R=U.internalTexture??null,I=U.gammaSpace??I,h=U.forcedExtension??h):Q=!!U,this._gammaSpace=I,this._noMipmap=Q,this._invertY=void 0===J?!o.b:J,this._initialSamplingMode=g,this._buffer=W,this._deleteBuffer=u,this._mimeType=r,this._loaderOptions=H,this._creationFlags=b,this._useSRGBBuffer=a,this._forcedExtension=h,void 0!==K&&(this._format=K);const t=this.Cq(),C=this._getEngine();if(!C)return;C.onBeforeTextureInitObservable.notifyObservers(this);const i=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),X&&X(),!this.isBlocking&&t&&t.resetCachedMaterial()},F=(q,c)=>{this._loadingError=!0,this._errorObject={message:q,exception:c},n&&n(q,c),p.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!R)return this._delayedOnLoad=i,void(this._delayedOnError=F);if(this._texture=R??this._getFromCache(this.url,Q,g,this._invertY,a,this.isCube),this._texture)if(this._texture.isReady)D.c.SetImmediate((()=>i()));else{const q=this._texture.onLoadedObservable.add(i);this._texture.onErrorObservable.add((c=>{var U;F(c.message,c.exception),null===(U=this._texture)||void 0===U||U.onLoadedObservable.remove(q)}))}else if(t&&t.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=i,this._delayedOnError=F;else{try{this._texture=C.createTexture(this.url,Q,this._invertY,t,g,i,F,this._buffer,void 0,this._format,this._forcedExtension,r,H,b,a)}catch(v){throw F("error loading",v),v}u&&(this._buffer=null)}}updateURL(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.Cq().markAllMaterialsAsDirty(1,(q=>q.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=q),this.url=q,this._buffer=c,this._forcedExtension=J,this.delayLoadState=4,U&&(this._delayedOnLoad=U),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const q=this.Cq();q&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?D.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=q.getEngine().createTexture(this.url,this._noMipmap,this._invertY,q,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(q,c,U,J){q*=this._cachedUScale,c*=this._cachedVScale,q-=this.uRotationCenter*this._cachedUScale,c-=this.vRotationCenter*this._cachedVScale,U-=this.wRotationCenter,g.p.TransformCoordinatesFromFloatsToRef(q,c,U,this._rowGenerationMatrix,J),J.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,J.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,J.z+=this.wRotationCenter}getTextureMatrix(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*q===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*q,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=g.d.Zero(),this._rowGenerationMatrix=new g.d,this._t0=g.p.Zero(),this._t1=g.p.Zero(),this._t2=g.p.Zero()),g.d.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(g.d.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,g.j.Matrix[0]),g.d.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,g.j.Matrix[1]),g.d.ScalingToRef(this._cachedUScale,this._cachedVScale,0,g.j.Matrix[2]),g.d.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,g.j.Matrix[3]),g.j.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(g.j.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(g.j.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(g.j.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.Uu(this._t0),this._t2.Uu(this._t0),g.d.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const c=this.Cq();if(!c)return this._cachedTextureMatrix;const U=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&U!==this._cachedIdentity3x2&&c.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const q=this.Cq();if(!q)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==p.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===q.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=g.d.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=g.d.Zero());const c=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case p.PLANAR_MODE:g.d.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case p.PROJECTION_MODE:{g.d.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const c=q.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=c.updateFlag,c.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:g.d.IdentityToRef(this._cachedReflectionTextureMatrix)}return c&&q.markAllMaterialsAsDirty(1,(q=>q.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const q={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,L:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return a.e.Clone((()=>new p(this._texture?this._texture.url:null,this.Cq(),q)),this)}serialize(){var q;const c=this.name;p.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const U=super.serialize(p._SerializeInternalTextureUniqueId);if(!U)return null;if(p.SerializeBuffers||p.ForceSerializeBuffers)if("string"===typeof this._buffer&&this._buffer.startsWith("data:"))U.base64String=this._buffer,U.name=U.name.replace("data:","");else if(this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array){const q=this.mimeType||"image/png";U.base64String=`data:${q};base64,${(0,r.k)(this._buffer)}`}else(p.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(U.base64String=!this._engine||this._engine._features.supportSyncTextureRead?b(this):h(this));var J;(U.invertY=this._invertY,U.samplingMode=this.samplingMode,U._creationFlags=this._creationFlags,U._useSRGBBuffer=this._useSRGBBuffer,p._SerializeInternalTextureUniqueId)&&(U.internalTextureUniqueId=null===(J=this._texture)||void 0===J?void 0:J.uniqueId);return U.internalTextureLabel=null===(q=this._texture)||void 0===q?void 0:q.label,U.noMipmap=this._noMipmap,this.name=c,U}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(q,c,U){if(q.customType){const J=u.d.Instantiate(q.customType).Parse(q,c,U);return q.samplingMode&&J.updateSamplingMode&&J._samplingMode&&J._samplingMode!==q.samplingMode&&J.updateSamplingMode(q.samplingMode),J}if(q.isCube&&!q.isRenderTarget)return p._CubeTextureParser(q,c,U);const J=void 0!==q.internalTextureUniqueId;if(!q.name&&!q.isRenderTarget&&!J)return null;let Q;if(J){const U=c.getEngine().getLoadedTexturesCache();for(const c of U)if(c.uniqueId===q.internalTextureUniqueId){Q=c;break}}const s=c=>{if(c&&c._texture&&(c._texture._cachedWrapU=null,c._texture._cachedWrapV=null,c._texture._cachedWrapR=null),q.samplingMode){const U=q.samplingMode;c&&c.samplingMode!==U&&c.updateSamplingMode(U)}if(c&&q.animations)for(let U=0;U<q.animations.length;U++){const J=q.animations[U],Q=(0,n.d)("BABYLON.Animation");Q&&c.animations.push(Q.Parse(J))}c&&c._texture&&(J&&!Q&&c._texture._setUniqueId(q.internalTextureUniqueId),c._texture.label=q.internalTextureLabel)};return a.e.Parse((()=>{let J=!0;if(q.noMipmap&&(J=!1),q.mirrorPlane){const U=p._CreateMirror(q.name,q.renderTargetSize,c,J);return U._waitingRenderList=q.renderList,U.mirrorPlane=K.d.Ic(q.mirrorPlane),s(U),U}if(q.isRenderTarget){let U=null;if(q.isCube){if(c.reflectionProbes)for(let J=0;J<c.reflectionProbes.length;J++){const U=c.reflectionProbes[J];if(U.name===q.name)return U.cubeTexture}}else U=p._CreateRenderTargetTexture(q.name,q.renderTargetSize,c,J,q._creationFlags??0),U._waitingRenderList=q.renderList;return s(U),U}if(q.isVideo){const Q=p._CreateVideoTexture(U+(q.url||q.name),U+(q.src||q.url),c,J,q.invertY,q.samplingMode,q.settings||{});return s(Q),Q}{let g;if(q.base64String&&!Q)g=p.CreateFromBase64String(q.base64String,q.base64String,c,!J,q.invertY,q.samplingMode,(()=>{s(g)}),q._creationFlags??0,q._useSRGBBuffer??!1),g.name=q.name;else{let X;X=q.name&&(q.name.indexOf("://")>0||q.name.startsWith("data:"))?q.name:U+q.name,q.url&&(q.url.startsWith("data:")||p.UseSerializedUrlIfAny)&&(X=q.url);const n={noMipmap:!J,invertY:q.invertY,samplingMode:q.samplingMode,L:()=>{s(g)},internalTexture:Q};g=new p(X,c,n)}return g}}),q,c)}static CreateFromBase64String(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:p.TRILINEAR_SAMPLINGMODE;return new p("data:"+c,U,J,Q,s,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,q,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:p.TRILINEAR_SAMPLINGMODE,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,W=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,D=arguments.length>10?arguments[10]:void 0,u=arguments.length>11?arguments[11]:void 0;return"data:"!==q.substring(0,5)&&(q="data:"+q),new p(q,U,Q,s,g,X,n,c,J,W,void 0,void 0,D,u)}}p.SerializeBuffers=!0,p.ForceSerializeBuffers=!1,p.OnTextureLoadErrorObservable=new s.e,p._SerializeInternalTextureUniqueId=!1,p._CubeTextureParser=(q,c,U)=>{throw(0,W.d)("CubeTexture")},p._CreateMirror=(q,c,U,J)=>{throw(0,W.d)("MirrorTexture")},p._CreateRenderTargetTexture=(q,c,U,J,Q)=>{throw(0,W.d)("RenderTargetTexture")},p.NEAREST_SAMPLINGMODE=1,p.NEAREST_NEAREST_MIPLINEAR=8,p.BILINEAR_SAMPLINGMODE=2,p.LINEAR_LINEAR_MIPNEAREST=11,p.TRILINEAR_SAMPLINGMODE=3,p.LINEAR_LINEAR_MIPLINEAR=3,p.NEAREST_NEAREST_MIPNEAREST=4,p.NEAREST_LINEAR_MIPNEAREST=5,p.NEAREST_LINEAR_MIPLINEAR=6,p.NEAREST_LINEAR=7,p.NEAREST_NEAREST=1,p.LINEAR_NEAREST_MIPNEAREST=9,p.LINEAR_NEAREST_MIPLINEAR=10,p.LINEAR_LINEAR=2,p.LINEAR_NEAREST=12,p.EXPLICIT_MODE=0,p.SPHERICAL_MODE=1,p.PLANAR_MODE=2,p.CUBIC_MODE=3,p.PROJECTION_MODE=4,p.SKYBOX_MODE=5,p.INVCUBIC_MODE=6,p.EQUIRECTANGULAR_MODE=7,p.FIXED_EQUIRECTANGULAR_MODE=8,p.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,p.CLAMP_ADDRESSMODE=0,p.WRAP_ADDRESSMODE=1,p.MIRROR_ADDRESSMODE=2,p.UseSerializedUrlIfAny=!1,(0,J.d)([(0,Q.N)()],p.prototype,"url",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"uOffset",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"vOffset",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"uScale",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"vScale",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"uAng",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"vAng",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"wAng",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"uRotationCenter",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"vRotationCenter",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"wRotationCenter",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"homogeneousRotationInUVTransform",void 0),(0,J.d)([(0,Q.N)()],p.prototype,"isBlocking",null),(0,n.f)("BABYLON.Texture",p),a.e._TextureParser=p.Parse},11218:(q,c,U)=>{function J(q){return 13===q||14===q||15===q||16===q||17===q||18===q||19===q}function Q(q){return 13===q||17===q||18===q||19===q}U.d(c,{e:()=>Q,i:()=>J})},10980:(q,c,U)=>{U.d(c,{d:()=>J});class J{get wrapU(){return this._cachedWrapU}set wrapU(q){this._cachedWrapU=q}get wrapV(){return this._cachedWrapV}set wrapV(q){this._cachedWrapV=q}get wrapR(){return this._cachedWrapR}set wrapR(q){this._cachedWrapR=q}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(q){this._cachedAnisotropicFilteringLevel=q}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(q){this._comparisonFunction=q}get useMipMaps(){return this._useMipMaps}set useMipMaps(q){this._useMipMaps=q}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=q,this._cachedWrapV=c,this._cachedWrapR=U,this._cachedAnisotropicFilteringLevel=J,this.samplingMode=Q,this._comparisonFunction=s,this}compareSampler(q){return this._cachedWrapU===q._cachedWrapU&&this._cachedWrapV===q._cachedWrapV&&this._cachedWrapR===q._cachedWrapR&&this._cachedAnisotropicFilteringLevel===q._cachedAnisotropicFilteringLevel&&this.samplingMode===q.samplingMode&&this._comparisonFunction===q._comparisonFunction&&this._useMipMaps===q._useMipMaps}}},11104:(q,c,U)=>{function J(q){-1===q.indexOf("vClipPlane")&&q.push("vClipPlane"),-1===q.indexOf("vClipPlane2")&&q.push("vClipPlane2"),-1===q.indexOf("vClipPlane3")&&q.push("vClipPlane3"),-1===q.indexOf("vClipPlane4")&&q.push("vClipPlane4"),-1===q.indexOf("vClipPlane5")&&q.push("vClipPlane5"),-1===q.indexOf("vClipPlane6")&&q.push("vClipPlane6")}function Q(q,c,U){const J=!!(q.clipPlane??c.clipPlane),Q=!!(q.clipPlane2??c.clipPlane2),s=!!(q.clipPlane3??c.clipPlane3),g=!!(q.clipPlane4??c.clipPlane4),X=!!(q.clipPlane5??c.clipPlane5),n=!!(q.clipPlane6??c.clipPlane6);J&&U.push("#define CLIPPLANE"),Q&&U.push("#define CLIPPLANE2"),s&&U.push("#define CLIPPLANE3"),g&&U.push("#define CLIPPLANE4"),X&&U.push("#define CLIPPLANE5"),n&&U.push("#define CLIPPLANE6")}function s(q,c,U){let J=!1;const Q=!!(q.clipPlane??c.clipPlane),s=!!(q.clipPlane2??c.clipPlane2),g=!!(q.clipPlane3??c.clipPlane3),X=!!(q.clipPlane4??c.clipPlane4),n=!!(q.clipPlane5??c.clipPlane5),W=!!(q.clipPlane6??c.clipPlane6);return U.CLIPPLANE!==Q&&(U.CLIPPLANE=Q,J=!0),U.CLIPPLANE2!==s&&(U.CLIPPLANE2=s,J=!0),U.CLIPPLANE3!==g&&(U.CLIPPLANE3=g,J=!0),U.CLIPPLANE4!==X&&(U.CLIPPLANE4=X,J=!0),U.CLIPPLANE5!==n&&(U.CLIPPLANE5=n,J=!0),U.CLIPPLANE6!==W&&(U.CLIPPLANE6=W,J=!0),J}function g(q,c,U){let J=c.clipPlane??U.clipPlane;X(q,"vClipPlane",J),J=c.clipPlane2??U.clipPlane2,X(q,"vClipPlane2",J),J=c.clipPlane3??U.clipPlane3,X(q,"vClipPlane3",J),J=c.clipPlane4??U.clipPlane4,X(q,"vClipPlane4",J),J=c.clipPlane5??U.clipPlane5,X(q,"vClipPlane5",J),J=c.clipPlane6??U.clipPlane6,X(q,"vClipPlane6",J)}function X(q,c,U){U&&q.setFloat4(c,U.Jc.x,U.Jc.y,U.Jc.z,U.d)}U.d(c,{b:()=>J,c:()=>g,e:()=>s,h:()=>Q})},11381:(q,c,U)=>{function J(q){q.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}U.d(c,{c:()=>J})},11201:(q,c,U)=>{function J(q){return void 0===q.getPipelineContext}U.d(c,{c:()=>J})},11071:(q,c,U)=>{U.d(c,{c:()=>Q});var J=U(10945);class Q{static GetEffect(q){return void 0===q.getPipelineContext?q.effect:q}constructor(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=q.createDrawContext(),c&&(this.materialContext=q.createMaterialContext())}setEffect(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var J;(this.effect=q,void 0!==c&&(this.defines=c),U)&&(null===(J=this.drawContext)||void 0===J||J.reset())}dispose(){var q;let c=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.effect){const q=this.effect;c?q.dispose():J.c.SetImmediate((()=>{q.getEngine().onEndFrameObservable.addOnce((()=>{q.dispose()}))})),this.effect=null}null===(q=this.drawContext)||void 0===q||q.dispose()}}},10963:(q,c,U)=>{U.d(c,{c:()=>u,g:()=>r,i:()=>W,k:()=>D});var J=U(10881),Q=U(10969),s=U(10961),g=U(10886),X=U(10937),n=U(10940);function W(q,c){return(0,Q.F)(c).cachedPipelines[q]}function D(q){const c=q._name,U=q.context;if(c&&U){const q=(0,Q.F)(U),J=q.cachedPipelines[c];null===J||void 0===J||J.dispose(),delete q.cachedPipelines[c]}}function u(q,c,U,Q,s,g,n){let W,D;const u=(0,J.j)()?null===g||void 0===g?void 0:g.getHostDocument():null;W="string"===typeof c?c:c.vertexSource?"source:"+c.vertexSource:c.vertexElement?(null===u||void 0===u?void 0:u.getElementById(c.vertexElement))||c.vertexElement:c.vertex||c,D="string"===typeof c?c:c.fragmentSource?"source:"+c.fragmentSource:c.fragmentElement?(null===u||void 0===u?void 0:u.getElementById(c.fragmentElement))||c.fragmentElement:c.fragment||c;const r=[void 0,void 0],H=()=>{if(r[0]&&r[1]){q.isFragment=!0;const[J,W]=r;(0,X.l)(W,q,((g,W)=>{n&&(n._fragmentSourceCodeBeforeMigration=W),U&&(g=U("fragment",g));const D=(0,X.c)(J,g,q);q=null;const u=function(q,c,U,J){if(U){return{vertexSourceCode:(1===J?"//":"")+"#define SHADER_NAME vertex:"+(U.vertexElement||U.vertex||U.spectorName||U)+"\n"+q,fragmentSourceCode:(1===J?"//":"")+"#define SHADER_NAME fragment:"+(U.fragmentElement||U.fragment||U.spectorName||U)+"\n"+c}}return{vertexSourceCode:q,fragmentSourceCode:c}}(D.vertexCode,D.fragmentCode,c,s);null===Q||void 0===Q||Q(u.vertexSourceCode,u.fragmentSourceCode)}),g)}};K(W,"Vertex","",(c=>{(0,X.f)(q),(0,X.l)(c,q,((q,J)=>{n&&(n._rawVertexSourceCode=c,n._vertexSourceCodeBeforeMigration=J),U&&(q=U("vertex",q)),r[0]=q,H()}),g)}),s),K(D,"Fragment","Pixel",(q=>{n&&(n._rawFragmentSourceCode=q),r[1]=q,H()}),s)}function K(q,c,U,Q,g,X){if("undefined"!==typeof HTMLElement&&q instanceof HTMLElement){return void Q((0,J.b)(q))}if("source:"===q.substring(0,7))return void Q(q.substring(7));if("base64:"===q.substring(0,7)){return void Q(window.atob(q.substring(7)))}const W=s.c.GetShadersStore(g);if(W[q+c+"Shader"])return void Q(W[q+c+"Shader"]);if(U&&W[q+U+"Shader"])return void Q(W[q+U+"Shader"]);let D;if(D="."===q[0]||"/"===q[0]||q.indexOf("http")>-1?q:s.c.GetShadersRepository(g)+q,!(X=X||n.p))throw new Error("loadFileInjection is not defined");X(D+"."+c.toLowerCase()+".fx",Q)}const r=(q,c,U,J)=>{try{const s=q.context?(0,Q.F)(q.context):null;s&&(s.disableParallelShaderCompile=q.disableParallelCompilation);const g=q.existingPipelineContext||c(q.shaderProcessingContext);return g._name=q.name,q.name&&s&&(s.cachedPipelines[q.name]=g),U(g,q.vertex,q.fragment,!!q.createAsRaw,"","",q.rebuildRebind,q.defines,q.transformFeedbackVaryings,"",(()=>{J(g,(()=>{var c;null===(c=q.onRenderingStateCompiled)||void 0===c||c.call(q,g)}))})),g}catch(s){throw g.c.Error("Error compiling effect"),s}}},10956:(q,c,U)=>{U.d(c,{b:()=>n});var J=U(10866),Q=U(10886),s=U(10961),g=U(10963),X=U(10945);class n{static get ShadersRepository(){return s.c.ShadersRepository}static set ShadersRepository(q){s.c.ShadersRepository=q}get u(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new J.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,K=arguments.length>9?arguments[9]:void 0,r=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,b=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new J.e,this.onErrorObservable=new J.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=q,this._key=r;const h=this._key.replace(/\r/g,"").replace(/\n/g,"|");let o;if(c.attributes){const q=c;if(this._engine=U,this._attributesNames=q.attributes,this._uniformsNames=q.uniformsNames.concat(q.samplers),this._samplerList=q.samplers.slice(),this.defines=q.defines,this.onError=q.onError,this.onCompiled=q.onCompiled,this._fallbacks=q.fallbacks,this._indexParameters=q.indexParameters,this._transformFeedbackVaryings=q.transformFeedbackVaryings||null,this._multiTarget=!!q.multiTarget,this._shaderLanguage=q.shaderLanguage??0,this._disableParallelShaderCompilation=!!q.disableParallelShaderCompilation,q.uniformBuffersNames){this._uniformBuffersNamesList=q.uniformBuffersNames.slice();for(let c=0;c<q.uniformBuffersNames.length;c++)this._uniformBuffersNames[q.uniformBuffersNames[c]]=c}this._processFinalCode=q.processFinalCode??null,this._processCodeAfterIncludes=q.processCodeAfterIncludes??void 0,b=q.extraInitializationsAsync,o=q.existingPipelineContext}else this._engine=s,this.defines=null==X?"":X,this._uniformsNames=U.concat(Q),this._samplerList=Q?Q.slice():[],this._attributesNames=c,this._uniformBuffersNamesList=[],this._shaderLanguage=H,this.onError=u,this.onCompiled=D,this._indexParameters=K,this._fallbacks=W;"WEBGL2"===this._engine.shaderPlatformName&&(o=(0,g.i)(h,this._engine._gl)??o),this._attributeLocationByName={},this.uniqueId=n._UniqueIdSeed++,o?(this._pipelineContext=o,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,b),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.u||this.dispose(!0)}))}async _processShaderCodeAsync(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3?arguments[3]:void 0;J&&await J(),this._processingContext=U||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const Q={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:q??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:s.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:s.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,g.c)(Q,this.name,this._processFinalCode,((q,U)=>{this._vertexSourceCode=q,this._fragmentSourceCode=U,this._prepareEffect(c)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(q){return this._attributes[q]}getAttributeLocationByName(q){return this._attributeLocationByName[q]}getAttributesCount(){return this._attributes.length}getUniformIndex(q){return this._uniformsNames.indexOf(q)}getUniform(q){return this._uniforms[q]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((q=>{this.executeWhenCompiled(q)}))}executeWhenCompiled(q){this.isReady()?q(this):(this.onCompileObservable.add((c=>{q(c)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(q){(0,X.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(c=>{this._processCompilationErrors(c,q)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var q;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(q=this._pipelineContext)||void 0===q?void 0:q._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var q;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(q=this._pipelineContext)||void 0===q?void 0:q._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(q,c,U,J){this._isReady=!1,this._vertexSourceCodeOverride=q,this._fragmentSourceCodeOverride=c,this.onError=(q,c)=>{J&&J(c)},this.onCompiled=()=>{var q,c;const J=this.getEngine().scenes;if(J)for(let U=0;U<J.length;U++)J[U].markAllMaterialsAsDirty(127);null===(q=(c=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===q||q.call(c,U)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(q){if(this._pipelineContext=q,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let c=0;c<this._attributesNames.length;c++){const q=this._attributesNames[c];this._attributeLocationByName[q]=this._attributes[c]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),n.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this._pipelineContext;this._isReady=!1;try{const U=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),J=U?null:this.defines,Q=U?this._vertexSourceCodeOverride:this._vertexSourceCode,s=U?this._fragmentSourceCodeOverride:this._fragmentSourceCode,X=this._engine;this._pipelineContext=(0,g.g)({existingPipelineContext:q?c:null,vertex:Q,fragment:s,context:"WEBGL2"===X.shaderPlatformName||"WEBGL1"===X.shaderPlatformName?X._gl:void 0,rebuildRebind:(q,c,U,J)=>this._rebuildProgram(q,c,U,J),defines:J,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:U,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:U=>{c&&!q&&this._engine._deletePipelineContext(c),U&&this._onRenderingStateCompiled(U)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(c)}catch(U){this._processCompilationErrors(U,c)}}_getShaderCodeAndErrorLine(q,c,U){const J=U?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let Q=null;if(c&&q){const s=c.match(J);if(s&&2===s.length){const c=parseInt(s[1]),J=q.split("\n",-1);J.length>=c&&(Q=`Offending line [${c}] in ${U?"fragment":"vertex"} code: ${J[c-1]}`)}}return[q,Q]}_processCompilationErrors(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=q.message;const U=this._attributesNames,J=this._fallbacks;if(Q.c.Error("Unable to compile effect:"),Q.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),Q.c.Error(`Attributes: ${U.join(" ")}`),Q.c.Error("Defines:\n"+this.defines),n.LogShaderCodeOnCompilationError){var s,g;let q=null,c=null,U=null;var X;if(null!==(s=this._pipelineContext)&&void 0!==s&&s._getVertexShaderCode()&&([U,q]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),U&&(Q.c.Error("Vertex code:"),Q.c.Error(U))),null!==(g=this._pipelineContext)&&void 0!==g&&g._getFragmentShaderCode())[U,c]=this._getShaderCodeAndErrorLine(null===(X=this._pipelineContext)||void 0===X?void 0:X._getFragmentShaderCode(),this._compilationError,!0),U&&(Q.c.Error("Fragment code:"),Q.c.Error(U));q&&Q.c.Error(q),c&&Q.c.Error(c)}Q.c.Error("Error: "+this._compilationError);const W=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};c&&(this._pipelineContext=c,this._isReady=!0,W()),J?(this._pipelineContext=null,J.hasMoreFallbacks?(this._allFallbacksProcessed=!1,Q.c.Error("Trying next fallback."),this.defines=J.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,W(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,c||W())}get isSupported(){return""===this._compilationError}_bindTexture(q,c){this._engine._bindTexture(this._samplers[q],c,q)}setTexture(q,c){this._engine.setTexture(this._samplers[q],this._uniforms[q],c,q)}setTextureArray(q,c){const U=q+"Ex";if(-1===this._samplerList.indexOf(U+"0")){const J=this._samplerList.indexOf(q);for(let q=1;q<c.length;q++){const c=U+(q-1).toString();this._samplerList.splice(J+q,0,c)}let Q=0;for(const q of this._samplerList)this._samplers[q]=Q,Q+=1}this._engine.setTextureArray(this._samplers[q],this._uniforms[q],c,q)}bindUniformBuffer(q,c){const U=this._uniformBuffersNames[c];void 0===U||n._BaseCache[U]===q&&this._engine._features.useUBOBindingCache||(n._BaseCache[U]=q,this._engine.bindUniformBufferBase(q,U,c))}bindUniformBlock(q,c){this._engine.bindUniformBlock(this._pipelineContext,q,c)}setInt(q,c){return this._pipelineContext.setInt(q,c),this}setInt2(q,c,U){return this._pipelineContext.setInt2(q,c,U),this}setInt3(q,c,U,J){return this._pipelineContext.setInt3(q,c,U,J),this}setInt4(q,c,U,J,Q){return this._pipelineContext.setInt4(q,c,U,J,Q),this}setIntArray(q,c){return this._pipelineContext.setIntArray(q,c),this}setIntArray2(q,c){return this._pipelineContext.setIntArray2(q,c),this}setIntArray3(q,c){return this._pipelineContext.setIntArray3(q,c),this}setIntArray4(q,c){return this._pipelineContext.setIntArray4(q,c),this}setUInt(q,c){return this._pipelineContext.setUInt(q,c),this}setUInt2(q,c,U){return this._pipelineContext.setUInt2(q,c,U),this}setUInt3(q,c,U,J){return this._pipelineContext.setUInt3(q,c,U,J),this}setUInt4(q,c,U,J,Q){return this._pipelineContext.setUInt4(q,c,U,J,Q),this}setUIntArray(q,c){return this._pipelineContext.setUIntArray(q,c),this}setUIntArray2(q,c){return this._pipelineContext.setUIntArray2(q,c),this}setUIntArray3(q,c){return this._pipelineContext.setUIntArray3(q,c),this}setUIntArray4(q,c){return this._pipelineContext.setUIntArray4(q,c),this}setFloatArray(q,c){return this._pipelineContext.setArray(q,c),this}setFloatArray2(q,c){return this._pipelineContext.setArray2(q,c),this}setFloatArray3(q,c){return this._pipelineContext.setArray3(q,c),this}setFloatArray4(q,c){return this._pipelineContext.setArray4(q,c),this}setArray(q,c){return this._pipelineContext.setArray(q,c),this}setArray2(q,c){return this._pipelineContext.setArray2(q,c),this}setArray3(q,c){return this._pipelineContext.setArray3(q,c),this}setArray4(q,c){return this._pipelineContext.setArray4(q,c),this}setMatrices(q,c){return this._pipelineContext.setMatrices(q,c),this}setMatrix(q,c){return this._pipelineContext.setMatrix(q,c),this}setMatrix3x3(q,c){return this._pipelineContext.setMatrix3x3(q,c),this}setMatrix2x2(q,c){return this._pipelineContext.setMatrix2x2(q,c),this}setFloat(q,c){return this._pipelineContext.setFloat(q,c),this}setBool(q,c){return this._pipelineContext.setInt(q,c?1:0),this}setVector2(q,c){return this._pipelineContext.setVector2(q,c),this}setFloat2(q,c,U){return this._pipelineContext.setFloat2(q,c,U),this}setVector3(q,c){return this._pipelineContext.setVector3(q,c),this}setFloat3(q,c,U,J){return this._pipelineContext.setFloat3(q,c,U,J),this}setVector4(q,c){return this._pipelineContext.setVector4(q,c),this}setQuaternion(q,c){return this._pipelineContext.setQuaternion(q,c),this}setFloat4(q,c,U,J,Q){return this._pipelineContext.setFloat4(q,c,U,J,Q),this}setColor3(q,c){return this._pipelineContext.setColor3(q,c),this}setColor4(q,c,U){return this._pipelineContext.setColor4(q,c,U),this}setDirectColor4(q,c){return this._pipelineContext.setDirectColor4(q,c),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(n.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,g.k)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;c&&(s.c.GetShadersStore(J)[`${q}PixelShader`]=c),U&&(s.c.GetShadersStore(J)[`${q}VertexShader`]=U)}static ResetCache(){n._BaseCache={}}}n.LogShaderCodeOnCompilationError=!0,n.PersistentMode=!1,n.AutomaticallyClearCodeCache=!1,n._UniqueIdSeed=0,n._BaseCache={},n.ShadersStore=s.c.ShadersStore,n.IncludesShadersStore=s.c.IncludesShadersStore},11454:(q,c,U)=>{U.d(c,{b:()=>J});class J{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(q,c){this._defines[q]||(q<this._currentRank&&(this._currentRank=q),q>this._maxRank&&(this._maxRank=q),this._defines[q]=new Array),this._defines[q].push(c)}addCPUSkinningFallback(q,c){this._mesh=c,q<this._currentRank&&(this._currentRank=q),q>this._maxRank&&(this._maxRank=q)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(q,c){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,q=q.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),c._bonesComputationForcedToCPU=!0;const U=this._mesh.Cq();for(let q=0;q<U.meshes.length;q++){const J=U.meshes[q];if(J.material){if(J.computeBonesUsingShaders&&0!==J.numBoneInfluencers)if(J.material.getEffect()===c)J.computeBonesUsingShaders=!1;else if(J.Gc)for(const q of J.Gc){if(q.effect===c){J.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&J.computeBonesUsingShaders&&J.numBoneInfluencers>0&&(J.computeBonesUsingShaders=!1)}}else{const c=this._defines[this._currentRank];if(c)for(let U=0;U<c.length;U++)q=q.replace("#define "+c[U],"");this._currentRank++}return q}}},11312:(q,c,U)=>{U.d(c,{e:()=>W,i:()=>D});var J=U(11031),Q=U(11163),s=U(10866),g=U(10956),X=U(11071);U(11319);const n={Fq:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class W{constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n;this._fullscreenViewport=new Q.c(0,0,1,1);const U=c.Fq??n.Fq,s=c.indices??n.indices;this.yX=q,this._vertexBuffers={[J.h.PositionKind]:new J.h(q,U,J.h.PositionKind,!1,!1,2)},this._indexBuffer=q.createIndexBuffer(s),this._indexBufferLength=s.length,this._onContextRestoredObserver=q.onContextRestoredObservable.add((()=>{this._indexBuffer=q.createIndexBuffer(s);for(const q in this._vertexBuffers){this._vertexBuffers[q]._rebuild()}}))}setViewport(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.yX.setViewport(q)}bindBuffers(q){this.yX.bindBuffers(this._vertexBuffers,this._indexBuffer,q)}applyEffectWrapper(q){this.yX.setState(!0),this.yX.depthCullingState.depthTest=!1,this.yX.stencilState.stencilTest=!1,this.yX.enableEffect(q.drawWrapper),this.bindBuffers(q.effect),q.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.yX.depthCullingState.depthTest,this._savedStateStencilTest=this.yX.stencilState.stencilTest}restoreStates(){this.yX.depthCullingState.depthTest=this._savedStateDepthTest,this.yX.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.yX.drawElementsType(0,0,this._indexBufferLength)}_isRenderTargetTexture(q){return void 0!==q.renderTarget}render(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!q.effect.isReady())return;this.saveStates(),this.setViewport();const U=null===c?null:this._isRenderTargetTexture(c)?c.renderTarget:c;U&&this.yX.bindFramebuffer(U),this.applyEffectWrapper(q),this.draw(),U&&this.yX.unBindFramebuffer(U),this.restoreStates()}dispose(){const q=this._vertexBuffers[J.h.PositionKind];q&&(q.dispose(),delete this._vertexBuffers[J.h.PositionKind]),this._indexBuffer&&this.yX._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.yX.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class D{static RegisterShaderCodeProcessing(q,c){c?D._CustomShaderCodeProcessing[q??""]=c:delete D._CustomShaderCodeProcessing[q??""]}static _GetShaderCodeProcessing(q){return D._CustomShaderCodeProcessing[q]??D._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(q){this.options.name=q}isReady(){var q;return(null===(q=this._drawWrapper.effect)||void 0===q?void 0:q.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(q){this._drawWrapper.effect=q}constructor(q){this.alphaMode=0,this.onEffectCreatedObservable=new s.e(void 0,!0),this.onApplyObservable=new s.e,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...q,name:q.name||"effectWrapper",yX:q.yX,uniforms:q.uniforms||q.uniformNames||[],uniformNames:void 0,samplers:q.samplers||q.samplerNames||[],samplerNames:void 0,attributeNames:q.attributeNames||["position"],uniformBuffers:q.uniformBuffers||[],defines:q.defines||"",useShaderStore:q.useShaderStore||!1,vertexUrl:q.vertexUrl||q.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:q.fragmentShader||"pass",indexParameters:q.indexParameters,blockCompilation:q.blockCompilation||!1,shaderLanguage:q.shaderLanguage||0,onCompiled:q.onCompiled||void 0,extraInitializations:q.extraInitializations||void 0,extraInitializationsAsync:q.extraInitializationsAsync||void 0,useAsPostProcess:q.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),q.vertexUrl||q.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.yX.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new X.c(this.options.yX),this._webGPUReady=1===this.options.shaderLanguage;const c=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,c,this.options.extraInitializations)}_gatherImports(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(q&&this._webGPUReady?c.push(Promise.all([U.e(42).then(U.bind(U,13448))])):c.push(Promise.all([Promise.resolve().then(U.bind(U,11319))])))}_postConstructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,J&&this._importPromises.push(...J);const Q=this.options.yX.isWebGPU&&!D.ForceGLSL;this._gatherImports(Q,this._importPromises),void 0!==U&&U(Q,this._importPromises),Q&&this._webGPUReady&&(this.options.shaderLanguage=1),q||this.updateEffect(c)}updateEffect(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,n=arguments.length>7?arguments[7]:void 0;const W=D._GetShaderCodeProcessing(this.name);if(null!==W&&void 0!==W&&W.defineCustomBindings){var u,K;const J=(null===(u=c)||void 0===u?void 0:u.slice())??[];J.push(...this.options.uniforms);const Q=(null===(K=U)||void 0===K?void 0:K.slice())??[];Q.push(...this.options.samplers),q=W.defineCustomBindings(this.name,q,J,Q),c=J,U=Q}this.options.defines=q||"";const r=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let H;H=this.options.extraInitializationsAsync?async()=>{null===r||void 0===r||r(),await this.options.extraInitializationsAsync()}:r,this.options.useShaderStore?this._drawWrapper.effect=this.options.yX.createEffect({vertex:X??this._shaderPath.vertex,fragment:n??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:c||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:U||this.options.samplers,defines:null!==q?q:"",fallbacks:null,onCompiled:Q??this.options.onCompiled,onError:s??null,indexParameters:J||this.options.indexParameters,processCodeAfterIncludes:null!==W&&void 0!==W&&W.processCodeAfterIncludes?(q,c)=>W.processCodeAfterIncludes(this.name,q,c):null,processFinalCode:null!==W&&void 0!==W&&W.processFinalCode?(q,c)=>W.processFinalCode(this.name,q,c):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:H},this.options.yX):this._drawWrapper.effect=new g.b(this._shaderPath,this.options.attributeNames,c||this.options.uniforms,U||this.options.samplerNames,this.options.yX,q,void 0,Q||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,H),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var q,c;let U=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.options.useAsPostProcess&&!U&&(this.options.yX.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(q=D._GetShaderCodeProcessing(this.name))||void 0===q||null===(c=q.bindCustomBindings)||void 0===c||c.call(q,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this._drawWrapper.dispose(!0)}}D.ForceGLSL=!1,D._CustomShaderCodeProcessing={}},11383:(q,c,U)=>{U.d(c,{b:()=>s,c:()=>Q});var J=U(11381);function Q(q,c){c.EXPOSURE&&q.push("exposureLinear"),c.CONTRAST&&q.push("contrast"),c.COLORGRADING&&q.push("colorTransformSettings"),(c.VIGNETTE||c.DITHER)&&q.push("vInverseScreenSize"),c.VIGNETTE&&(q.push("vignetteSettings1"),q.push("vignetteSettings2")),c.COLORCURVES&&(0,J.c)(q),c.DITHER&&q.push("ditherIntensity")}function s(q,c){c.COLORGRADING&&q.push("txColorTransform")}},11373:(q,c,U)=>{U.d(c,{b:()=>r});var J=U(11010),Q=U(11019),s=U(10866),g=U(11093),X=U(11082),n=U(11381);class W{constructor(){this._dirty=!0,this._tempColor=new g.e(0,0,0,0),this._globalCurve=new g.e(0,0,0,0),this._highlightsCurve=new g.e(0,0,0,0),this._midtonesCurve=new g.e(0,0,0,0),this._shadowsCurve=new g.e(0,0,0,0),this._positiveCurve=new g.e(0,0,0,0),this._negativeCurve=new g.e(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(q){this._globalHue=q,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(q){this._globalDensity=q,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(q){this._globalSaturation=q,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(q){this._globalExposure=q,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(q){this._highlightsHue=q,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(q){this._highlightsDensity=q,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(q){this._highlightsSaturation=q,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(q){this._highlightsExposure=q,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(q){this._midtonesHue=q,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(q){this._midtonesDensity=q,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(q){this._midtonesSaturation=q,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(q){this._midtonesExposure=q,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(q){this._shadowsHue=q,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(q){this._shadowsDensity=q,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(q){this._shadowsSaturation=q,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(q){this._shadowsExposure=q,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";q._dirty&&(q._dirty=!1,q._getColorGradingDataToRef(q._globalHue,q._globalDensity,q._globalSaturation,q._globalExposure,q._globalCurve),q._getColorGradingDataToRef(q._highlightsHue,q._highlightsDensity,q._highlightsSaturation,q._highlightsExposure,q._tempColor),q._tempColor.multiplyToRef(q._globalCurve,q._highlightsCurve),q._getColorGradingDataToRef(q._midtonesHue,q._midtonesDensity,q._midtonesSaturation,q._midtonesExposure,q._tempColor),q._tempColor.multiplyToRef(q._globalCurve,q._midtonesCurve),q._getColorGradingDataToRef(q._shadowsHue,q._shadowsDensity,q._shadowsSaturation,q._shadowsExposure,q._tempColor),q._tempColor.multiplyToRef(q._globalCurve,q._shadowsCurve),q._highlightsCurve.subtractToRef(q._midtonesCurve,q._positiveCurve),q._midtonesCurve.subtractToRef(q._shadowsCurve,q._negativeCurve)),c&&(c.setFloat4(U,q._positiveCurve.r,q._positiveCurve.g,q._positiveCurve.b,q._positiveCurve.a),c.setFloat4(J,q._midtonesCurve.r,q._midtonesCurve.g,q._midtonesCurve.b,q._midtonesCurve.a),c.setFloat4(Q,q._negativeCurve.r,q._negativeCurve.g,q._negativeCurve.b,q._negativeCurve.a))}_getColorGradingDataToRef(q,c,U,J,Q){null!=q&&(q=W._Clamp(q,0,360),c=W._Clamp(c,-100,100),U=W._Clamp(U,-100,100),J=W._Clamp(J,-100,100),c=W._ApplyColorGradingSliderNonlinear(c),c*=.5,J=W._ApplyColorGradingSliderNonlinear(J),c<0&&(c*=-1,q=(q+180)%360),W._FromHSBToRef(q,c,50+.25*J,Q),Q.scaleToRef(2,Q),Q.a=1+.01*U)}static _ApplyColorGradingSliderNonlinear(q){q/=100;let c=Math.abs(q);return c=Math.pow(c,2),q<0&&(c*=-1),c*=100,c}static _FromHSBToRef(q,c,U,J){let Q=W._Clamp(q,0,360);const s=W._Clamp(c/100,0,1),g=W._Clamp(U/100,0,1);if(0===s)J.r=g,J.g=g,J.b=g;else{Q/=60;const q=Math.floor(Q),c=Q-q,U=g*(1-s),X=g*(1-s*c),n=g*(1-s*(1-c));switch(q){case 0:J.r=g,J.g=n,J.b=U;break;case 1:J.r=X,J.g=g,J.b=U;break;case 2:J.r=U,J.g=g,J.b=n;break;case 3:J.r=U,J.g=X,J.b=g;break;case 4:J.r=n,J.g=U,J.b=g;break;default:J.r=g,J.g=U,J.b=X}}J.a=1}static _Clamp(q,c,U){return Math.min(Math.max(q,c),U)}clone(){return X.e.Clone((()=>new W),this)}serialize(){return X.e.Serialize(this)}static Parse(q){return X.e.Parse((()=>new W),q,null,null)}}W.PrepareUniforms=n.c,(0,J.d)([(0,Q.N)()],W.prototype,"_globalHue",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_globalDensity",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_globalSaturation",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_globalExposure",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_highlightsHue",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_highlightsDensity",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_highlightsSaturation",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_highlightsExposure",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_midtonesHue",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_midtonesDensity",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_midtonesSaturation",void 0),(0,J.d)([(0,Q.N)()],W.prototype,"_midtonesExposure",void 0),X.e._ColorCurvesParser=W.Parse;var D=U(11002),u=U(11383),K=U(10850);class r{constructor(){this.colorCurves=new W,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=r.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new g.e(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=r.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.outputTextureWidth=0,this.outputTextureHeight=0,this.onUpdateParameters=new s.e}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(q){this._colorCurvesEnabled!==q&&(this._colorCurvesEnabled=q,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(q){this._colorGradingTexture!==q&&(this._colorGradingTexture=q,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(q){this._colorGradingEnabled!==q&&(this._colorGradingEnabled=q,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(q){this._colorGradingWithGreenDepth!==q&&(this._colorGradingWithGreenDepth=q,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(q){this._colorGradingBGR!==q&&(this._colorGradingBGR=q,this._updateParameters())}get exposure(){return this._exposure}set exposure(q){this._exposure!==q&&(this._exposure=q,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(q){this._toneMappingEnabled!==q&&(this._toneMappingEnabled=q,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(q){this._toneMappingType!==q&&(this._toneMappingType=q,this._updateParameters())}get contrast(){return this._contrast}set contrast(q){this._contrast!==q&&(this._contrast=q,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(q){this.vignetteCenterY=q}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(q){this.vignetteCenterX=q}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(q){this._vignetteBlendMode!==q&&(this._vignetteBlendMode=q,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(q){this._vignetteEnabled!==q&&(this._vignetteEnabled=q,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(q){this._ditheringEnabled!==q&&(this._ditheringEnabled=q,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(q){this._ditheringIntensity!==q&&(this._ditheringIntensity=q,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(q){this._skipFinalColorClamp!==q&&(this._skipFinalColorClamp=q,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(q){this._applyByPostProcess!==q&&(this._applyByPostProcess=q,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(q){this._isEnabled!==q&&(this._isEnabled=q,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(q){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return q.VIGNETTE=!1,q.TONEMAPPING=0,q.CONTRAST=!1,q.EXPOSURE=!1,q.COLORCURVES=!1,q.COLORGRADING=!1,q.COLORGRADING3D=!1,q.DITHER=!1,q.IMAGEPROCESSING=!1,q.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(q.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(q.VIGNETTE=this.vignetteEnabled,q.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===r._VIGNETTEMODE_MULTIPLY,q.VIGNETTEBLENDMODEOPAQUE=!q.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case r.TONEMAPPING_KHR_PBR_NEUTRAL:q.TONEMAPPING=3;break;case r.TONEMAPPING_ACES:q.TONEMAPPING=2;break;default:q.TONEMAPPING=1}else q.TONEMAPPING=0;q.CONTRAST=1!==this.contrast,q.EXPOSURE=1!==this.exposure,q.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,q.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,q.COLORGRADING?q.COLORGRADING3D=this.colorGradingTexture.is3D:q.COLORGRADING3D=!1,q.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,q.SAMPLER3DBGRMAP=this.colorGradingBGR,q.DITHER=this._ditheringEnabled,q.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,q.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,q.IMAGEPROCESSING=q.VIGNETTE||!!q.TONEMAPPING||q.CONTRAST||q.EXPOSURE||q.COLORCURVES||q.COLORGRADING||q.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(q,c){if(this._colorCurvesEnabled&&this.colorCurves&&W.Bind(this.colorCurves,q),this._vignetteEnabled||this._ditheringEnabled){const U=1/(this.outputTextureWidth||q.getEngine().getRenderWidth()),J=1/(this.outputTextureHeight||q.getEngine().getRenderHeight());if(q.setFloat2("vInverseScreenSize",U,J),this._ditheringEnabled&&q.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const Q=null!=c?c:J/U;let s=Math.tan(.5*this.vignetteCameraFov),g=s*Q;const X=Math.sqrt(g*s);g=(0,D.l)(g,X,this.vignetteStretch),s=(0,D.l)(s,X,this.vignetteStretch),q.setFloat4("vignetteSettings1",g,s,-g*this.vignetteCenterX,-s*this.vignetteCenterY);const n=-2*this.vignetteWeight;q.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,n)}}if(q.setFloat("exposureLinear",this.exposure),q.setFloat("contrast",this.contrast),this.colorGradingTexture){q.setTexture("txColorTransform",this.colorGradingTexture);const c=this.colorGradingTexture.getSize().height;q.setFloat4("colorTransformSettings",(c-1)/c,.5/c,c,this.colorGradingTexture.level)}}clone(){return X.e.Clone((()=>new r),this)}serialize(){return X.e.Serialize(this)}static Parse(q){const c=X.e.Parse((()=>new r),q,null,null);return void 0!==q.vignetteCentreX&&(c.vignetteCenterX=q.vignetteCentreX),void 0!==q.vignetteCentreY&&(c.vignetteCenterY=q.vignetteCentreY),c}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}r.TONEMAPPING_STANDARD=0,r.TONEMAPPING_ACES=1,r.TONEMAPPING_KHR_PBR_NEUTRAL=2,r.PrepareUniforms=u.c,r.PrepareSamplers=u.b,r._VIGNETTEMODE_MULTIPLY=0,r._VIGNETTEMODE_OPAQUE=1,(0,J.d)([(0,Q.g)()],r.prototype,"colorCurves",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_colorCurvesEnabled",void 0),(0,J.d)([(0,Q.D)("colorGradingTexture")],r.prototype,"_colorGradingTexture",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_colorGradingEnabled",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_colorGradingWithGreenDepth",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_colorGradingBGR",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_exposure",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_toneMappingEnabled",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_toneMappingType",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_contrast",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"vignetteStretch",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"vignetteCenterX",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"vignetteCenterY",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"vignetteWeight",void 0),(0,J.d)([(0,Q.m)()],r.prototype,"vignetteColor",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"vignetteCameraFov",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_vignetteBlendMode",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_vignetteEnabled",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_ditheringEnabled",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_ditheringIntensity",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_skipFinalColorClamp",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_applyByPostProcess",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"_isEnabled",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"outputTextureWidth",void 0),(0,J.d)([(0,Q.N)()],r.prototype,"outputTextureHeight",void 0),X.e._ImageProcessingConfigurationParser=r.Parse,(0,K.f)("BABYLON.ImageProcessingConfiguration",r)},11458:(q,c,U)=>{U.d(c,{b:()=>u});var J=U(11010),Q=U(11004),s=U(11019),g=U(11434),X=U(11416),n=U(11418),W=U(11095);class D extends X.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class u extends n.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(q,"DetailMap",140,new D,c),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=Q.b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=q._dirtyCallbacks[1]}isReadyForSubMesh(q,c,U){return!this._isEnabled||!(q._areTexturesDirty&&c.texturesEnabled&&U.getCaps().standardDerivatives&&this._texture&&g.c.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(q,c){if(this._isEnabled){q.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const U=c.getEngine();q._areTexturesDirty&&(U.getCaps().standardDerivatives&&this._texture&&g.c.DetailTextureEnabled&&this._isEnabled?((0,W.R)(this._texture,q,"DETAIL"),q.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):q.DETAIL=!1)}else q.DETAIL=!1}bindForSubMesh(q,c){if(!this._isEnabled)return;const U=this._material.isFrozen;q.useUbo&&U&&q.isSync||this._texture&&g.c.DetailTextureEnabled&&(q.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,W.s)(this._texture,q,"detail")),c.texturesEnabled&&this._texture&&g.c.DetailTextureEnabled&&q.setTexture("detailSampler",this._texture)}hasTexture(q){return this._texture===q}getActiveTextures(q){this._texture&&q.push(this._texture)}getAnimatables(q){this._texture&&this._texture.animations&&this._texture.animations.length>0&&q.push(this._texture)}dispose(q){var c;q&&(null===(c=this._texture)||void 0===c||c.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(q){q.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,J.d)([(0,s.D)("detailTexture"),(0,s.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"texture",void 0),(0,J.d)([(0,s.N)()],u.prototype,"diffuseBlendLevel",void 0),(0,J.d)([(0,s.N)()],u.prototype,"roughnessBlendLevel",void 0),(0,J.d)([(0,s.N)()],u.prototype,"bumpLevel",void 0),(0,J.d)([(0,s.N)(),(0,s.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"normalBlendMethod",void 0),(0,J.d)([(0,s.N)(),(0,s.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isEnabled",void 0)},11004:(q,c,U)=>{U.d(c,{b:()=>h});var J=U(11010),Q=U(11019),s=U(10879),g=U(10866),X=U(10864),n=U(11025),W=U(11075),D=U(10886),u=U(11077),K=U(11071),r=U(11082);class H{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(q){this._func=q}get funcRef(){return this._funcRef}set funcRef(q){this._funcRef=q}get funcMask(){return this._funcMask}set funcMask(q){this._funcMask=q}get opStencilFail(){return this._opStencilFail}set opStencilFail(q){this._opStencilFail=q}get opDepthFail(){return this._opDepthFail}set opDepthFail(q){this._opDepthFail=q}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(q){this._opStencilDepthPass=q}get mask(){return this._mask}set mask(q){this._mask=q}get enabled(){return this._enabled}set enabled(q){this._enabled=q}getClassName(){return"MaterialStencilState"}copyTo(q){r.e.Clone((()=>q),this)}serialize(){return r.e.Serialize(this)}parse(q,c,U){r.e.Parse((()=>this),q,c,U)}}(0,J.d)([(0,Q.N)()],H.prototype,"func",null),(0,J.d)([(0,Q.N)()],H.prototype,"funcRef",null),(0,J.d)([(0,Q.N)()],H.prototype,"funcMask",null),(0,J.d)([(0,Q.N)()],H.prototype,"opStencilFail",null),(0,J.d)([(0,Q.N)()],H.prototype,"opDepthFail",null),(0,J.d)([(0,Q.N)()],H.prototype,"opStencilDepthPass",null),(0,J.d)([(0,Q.N)()],H.prototype,"mask",null),(0,J.d)([(0,Q.N)()],H.prototype,"enabled",null);var b=U(11095);class h{get _supportGlowLayer(){return!1}set _glowModeEnabled(q){}get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(q){if(this._alpha===q)return;const c=this._alpha;this._alpha=q,1!==c&&1!==q||this.PW(h.MiscDirtyFlag+h.PrePassDirtyFlag)}get alpha(){return this._alpha}set Kc(q){this._backFaceCulling!==q&&(this._backFaceCulling=q,this.PW(h.TextureDirtyFlag))}get Kc(){return this._backFaceCulling}set cullBackFaces(q){this._cullBackFaces!==q&&(this._cullBackFaces=q,this.PW(h.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(q){this._blockDirtyMechanism!==q&&(this._blockDirtyMechanism=q,q||this.eu())}atomicMaterialsUpdate(q){this.blockDirtyMechanism=!0;try{q(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(q){this._onDisposeObserver&&this.Cc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Cc.add(q)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new g.e),this._onBindObservable}set onBind(q){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(q)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new g.e),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new g.e),this._onEffectCreatedObservable}set alphaMode(q){this._alphaMode!==q&&(this._alphaMode=q,this.PW(h.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(q){this._needDepthPrePass!==q&&(this._needDepthPrePass=q,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(q){this._fogEnabled!==q&&(this._fogEnabled=q,this.PW(h.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case h.WireFrameFillMode:case h.LineListDrawMode:case h.LineLoopDrawMode:case h.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(q){this.fillMode=q?h.WireFrameFillMode:h.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case h.PointFillMode:case h.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(q){this.fillMode=q?h.PointFillMode:h.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(q){this._fillMode!==q&&(this._fillMode=q,this.PW(h.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(q){const c=this.Cq().getEngine().getCaps().fragmentDepthSupported;q&&!c&&D.c.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=q&&c,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(q){this._drawWrapper=q}constructor(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Cc=new g.e,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new H,this._useUBO=!1,this._fillMode=h.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._transparencyMode=null,this.name=q;const Q=c||X.c.LastCreatedScene;Q&&(this._scene=Q,this._dirtyCallbacks={},this._forceGLSL=J,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[127]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=q||s.e.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new K.c(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new W.d(this._scene.getEngine(),void 0,void 0,q),this._useUBO=this.Cq().getEngine().supportsUniformBuffers,this._createUniformBuffer(),U||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),h.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var q;const c=this.Cq().getEngine();null===(q=this._uniformBuffer)||void 0===q||q.dispose(),c.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new W.d(c,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new W.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(q){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.eu(),this.checkReadyOnlyOnce=!0}unfreeze(){this.eu(),this.checkReadyOnlyOnce=!1}isReady(q,c){return!0}isReadyForSubMesh(q,c,U){const J=c.materialDefines;return!!J&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=J,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}Cq(){return this._scene}_getEffectiveOrientation(q){return null!==this.sideOrientation?this.sideOrientation:q.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(q){this._transparencyMode!==q&&(this._transparencyMode=q,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _hasTransparencyMode(){return null!=this._transparencyMode}get _transparencyModeIsBlend(){return this._transparencyMode===h.MATERIAL_ALPHABLEND||this._transparencyMode===h.MATERIAL_ALPHATESTANDBLEND}get _transparencyModeIsTest(){return this._transparencyMode===h.MATERIAL_ALPHATEST||this._transparencyMode===h.MATERIAL_ALPHATESTANDBLEND}get _disableAlphaBlending(){return this._transparencyMode===h.MATERIAL_OPAQUE||this._transparencyMode===h.MATERIAL_ALPHATEST}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(q){return this._hasTransparencyMode?this._transparencyModeIsBlend:q.visibility<1||!this._disableAlphaBlending&&(q.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._hasTransparencyMode&&this._transparencyModeIsTest}needAlphaTestingForMesh(q){return this._hasTransparencyMode?this._transparencyModeIsTest:!this.needAlphaBlendingForMesh(q)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}eu(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.Cq().meshes;for(const U of c)if(U.Gc)for(const c of U.Gc)if(c.zq()===this)for(const U of c._drawWrappers)U&&this._materialContext===U.materialContext&&(U._wasPreviouslyReady=!1,U._wasPreviouslyUsingInstances=null,U._forceRebindOnNextCall=q);q&&this.PW(h.AllDirtyFlag)}_preBind(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=this._scene.getEngine(),J=(null==c?this.sideOrientation:c)===h.ClockWiseSideOrientation;return U.enableEffect(q||this._getDrawWrapper()),U.setState(this.Kc,this.zOffset,!1,J,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),J}bind(q,c){}buildUniformLayout(){const q=this._uniformBuffer;this._eventInfo.ubo=q,this._callbackPluginEventGeneric(8,this._eventInfo),q.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(q,c,U){const J=U._drawWrapper;this._eventInfo.subMesh=U,this._callbackPluginEventBindForSubMesh(this._eventInfo),J._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(q){}bindView(q){this._useUBO?this._needToBindSceneUbo=!0:q.setMatrix("view",this.Cq().getViewMatrix())}bindViewProjection(q){this._useUBO?this._needToBindSceneUbo=!0:(q.setMatrix("viewProjection",this.Cq().getTransformMatrix()),q.setMatrix("projection",this.Cq().getProjectionMatrix()))}bindEyePosition(q,c){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(q,c)}_afterBind(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&c&&(this._needToBindSceneUbo=!1,(0,b.p)(c,this.Cq().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=q?q.visibility:1,this._onBindObservable&&q&&this._onBindObservable.notifyObservers(q),this.disableDepthWrite){const q=this._scene.getEngine();this._cachedDepthWriteState=q.getDepthWrite(),q.setDepthWrite(!1)}if(this.disableColorWrite){const q=this._scene.getEngine();this._cachedColorWriteState=q.getColorWrite(),q.setColorWrite(!1)}if(0!==this.depthFunction){const q=this._scene.getEngine();this._cachedDepthFunctionState=q.getDepthFunction()||0,q.setDepthFunction(this.depthFunction)}}unbind(){if(this._scene.getSceneUniformBuffer().unbindEffect(),this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(q){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=q,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(q){return null}_clonePlugins(q,c){const U={};if(this._serializePlugins(U),h._ParsePlugins(U,q,this._scene,c),this.pluginManager)for(const J of this.pluginManager._plugins){const c=q.pluginManager.getPlugin(J.name);c&&J.copyTo(c)}}getBindedMeshes(){if(this.meshMap){const q=[];for(const c in this.meshMap){const U=this.meshMap[c];U&&q.push(U)}return q}return this._scene.meshes.filter((q=>q.material===this))}forceCompilation(q,c,U,J){const Q={clipPlane:!1,useInstances:!1,...U},s=this.Cq(),g=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const X=()=>{if(!this._scene||!this._scene.getEngine())return;const U=s.clipPlane;if(Q.clipPlane&&(s.clipPlane=new u.d(0,0,0,1)),this._storeEffectOnSubMeshes){let U=!0,s=null;if(q.Gc){const c=new n.c(0,0,0,0,0,q,void 0,!1,!1);c.materialDefines&&(c.materialDefines._renderId=-1),this.isReadyForSubMesh(q,c,Q.useInstances)||(c.effect&&c.effect.getCompilationError()&&c.effect.allFallbacksProcessed()?s=c.effect.getCompilationError():(U=!1,setTimeout(X,16)))}U&&(this.allowShaderHotSwapping=g,s&&J&&J(s),c&&c(this))}else this.isReady()?(this.allowShaderHotSwapping=g,c&&c(this)):setTimeout(X,16);Q.clipPlane&&(s.clipPlane=U)};X()}async forceCompilationAsync(q,c){return await new Promise(((U,J)=>{this.forceCompilation(q,(()=>{U()}),c,(q=>{J(q)}))}))}PW(q){this.Cq().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(h._DirtyCallbackArray.length=0,q&h.ImageProcessingDirtyFlag&&h._DirtyCallbackArray.push(h._ImageProcessingDirtyCallBack),q&h.TextureDirtyFlag&&h._DirtyCallbackArray.push(h._TextureDirtyCallBack),q&h.LightDirtyFlag&&h._DirtyCallbackArray.push(h._LightsDirtyCallBack),q&h.FresnelDirtyFlag&&h._DirtyCallbackArray.push(h._FresnelDirtyCallBack),q&h.AttributesDirtyFlag&&h._DirtyCallbackArray.push(h._AttributeDirtyCallBack),q&h.MiscDirtyFlag&&h._DirtyCallbackArray.push(h._MiscDirtyCallBack),q&h.PrePassDirtyFlag&&h._DirtyCallbackArray.push(h._PrePassDirtyCallBack),h._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(h._RunDirtyCallBacks),this.Cq().resetCachedMaterial())}resetDrawCache(){const q=this.Cq().meshes;for(const c of q)if(c.Gc)for(const q of c.Gc)q.zq()===this&&q.resetDrawCache()}_markAllSubMeshesAsDirty(q){const c=this.Cq();if(c.blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const U=c.meshes;for(const J of U)if(J.Gc)for(const U of J.Gc){if((U.zq()||(c._hasDefaultMaterial?c.defaultMaterial:null))===this)for(const c of U._drawWrappers)c&&c.defines&&c.defines.markAllAsDirty&&this._materialContext===c.materialContext&&q(c.defines)}}_markScenePrePassDirty(){if(this.Cq().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const q=this.Cq().enablePrePassRenderer();q&&q.PW()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(h._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(h._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(h._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(h._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(h._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(h._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(h._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(h._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(h._PrePassDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(h._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const q=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Cc.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(q)}))}}setPrePassRenderer(q){return!1}dispose(q,c,U){const J=this.Cq();if(J.stopAnimation(this),J.freeProcessedMaterials(),J.removeMaterial(this),this._eventInfo.forceDisposeTextures=c,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const q=this._parentContainer.materials.indexOf(this);q>-1&&this._parentContainer.materials.splice(q,1),this._parentContainer=null}if(!0!==U)if(this.meshMap)for(const Q in this.meshMap){const q=this.meshMap[Q];this._disposeMeshResources(q)}else{const q=J.meshes;for(const c of q)this._disposeMeshResources(c)}this._uniformBuffer.dispose(),this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Cc.notifyObservers(this),this.Cc.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}_disposeMeshResources(q){if(!q)return;const c=q.Dc,U=q._internalAbstractMeshDataInfo._materialForRenderPass;if(this._storeEffectOnSubMeshes){if(q.Gc&&U)for(const Q of q.Gc){const q=Q._drawWrappers;for(let s=0;s<q.length;s++){var J;const g=null===(J=q[s])||void 0===J?void 0:J.effect;if(!g)continue;U[s]===this&&(null===c||void 0===c||c._releaseVertexArrayObject(g),Q._removeDrawWrapper(s,!0,!0))}}}else null===c||void 0===c||c._releaseVertexArrayObject(this._drawWrapper.effect);q.material!==this||q.sourceMesh||(q.material=null)}serialize(){const q=r.e.Serialize(this);return q.stencil=this.stencil.serialize(),q.uniqueId=this.uniqueId,this._serializePlugins(q),q}_serializePlugins(q){if(q.plugins={},this.pluginManager)for(const c of this.pluginManager._plugins)c.doNotSerialize||(q.plugins[c.getClassName()]=c.serialize())}static Parse(q,c,U){if(q.customType){if("BABYLON.PBRMaterial"===q.customType&&q.overloadedAlbedo&&(q.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return D.c.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else q.customType="BABYLON.StandardMaterial";const J=s.e.Instantiate(q.customType).Parse(q,c,U);return J._loadedUniqueId=q.uniqueId,J}static _ParsePlugins(q,c,U,J){if(q.plugins)for(const X in q.plugins){var Q,g;const n=q.plugins[X];let W=null===(Q=c.pluginManager)||void 0===Q?void 0:Q.getPlugin(n.name);if(!W){const q=s.e.Instantiate("BABYLON."+X);q&&(W=new q(c))}null===(g=W)||void 0===g||g.parse(n,U,J)}}}h.TriangleFillMode=0,h.WireFrameFillMode=1,h.PointFillMode=2,h.PointListDrawMode=3,h.LineListDrawMode=4,h.LineLoopDrawMode=5,h.LineStripDrawMode=6,h.TriangleStripDrawMode=7,h.TriangleFanDrawMode=8,h.ClockWiseSideOrientation=0,h.CounterClockWiseSideOrientation=1,h.ImageProcessingDirtyFlag=64,h.TextureDirtyFlag=1,h.LightDirtyFlag=2,h.FresnelDirtyFlag=4,h.AttributesDirtyFlag=8,h.MiscDirtyFlag=16,h.PrePassDirtyFlag=32,h.AllDirtyFlag=127,h.MATERIAL_OPAQUE=0,h.MATERIAL_ALPHATEST=1,h.MATERIAL_ALPHABLEND=2,h.MATERIAL_ALPHATESTANDBLEND=3,h.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,h.MATERIAL_NORMALBLENDMETHOD_RNM=1,h.OnEventObservable=new g.e,h._AllDirtyCallBack=q=>q.markAllAsDirty(),h._ImageProcessingDirtyCallBack=q=>q.markAsImageProcessingDirty(),h._TextureDirtyCallBack=q=>q.markAsTexturesDirty(),h._FresnelDirtyCallBack=q=>q.markAsFresnelDirty(),h._MiscDirtyCallBack=q=>q.markAsMiscDirty(),h._PrePassDirtyCallBack=q=>q.markAsPrePassDirty(),h._LightsDirtyCallBack=q=>q.markAsLightDirty(),h._AttributeDirtyCallBack=q=>q.markAsAttributesDirty(),h._FresnelAndMiscDirtyCallBack=q=>{h._FresnelDirtyCallBack(q),h._MiscDirtyCallBack(q)},h._TextureAndMiscDirtyCallBack=q=>{h._TextureDirtyCallBack(q),h._MiscDirtyCallBack(q)},h._DirtyCallbackArray=[],h._RunDirtyCallBacks=q=>{for(const c of h._DirtyCallbackArray)c(q)},(0,J.d)([(0,Q.N)()],h.prototype,"id",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"uniqueId",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"name",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"metadata",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"checkReadyOnEveryCall",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"checkReadyOnlyOnce",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"state",void 0),(0,J.d)([(0,Q.N)("alpha")],h.prototype,"_alpha",void 0),(0,J.d)([(0,Q.N)("Kc")],h.prototype,"_backFaceCulling",void 0),(0,J.d)([(0,Q.N)("cullBackFaces")],h.prototype,"_cullBackFaces",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"sideOrientation",void 0),(0,J.d)([(0,Q.N)("alphaMode")],h.prototype,"_alphaMode",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"_needDepthPrePass",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"disableDepthWrite",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"disableColorWrite",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"forceDepthWrite",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"depthFunction",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"separateCullingPass",void 0),(0,J.d)([(0,Q.N)("fogEnabled")],h.prototype,"_fogEnabled",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"pointSize",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"zOffset",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"zOffsetUnits",void 0),(0,J.d)([(0,Q.N)()],h.prototype,"pointsCloud",null),(0,J.d)([(0,Q.N)()],h.prototype,"fillMode",null),(0,J.d)([(0,Q.N)()],h.prototype,"useLogarithmicDepth",null),(0,J.d)([(0,Q.N)()],h.prototype,"transparencyMode",null)},11416:(q,c,U)=>{U.d(c,{d:()=>J});class J{constructor(q){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=q,q)for(const c in q)Object.prototype.hasOwnProperty.call(q,c)&&this._setDefaultValue(c)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||q,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const q of Object.keys(this))"_"!==q[0]&&this._keys.push(q);if(this._externalProperties)for(const q in this._externalProperties)-1===this._keys.indexOf(q)&&this._keys.push(q)}isEqual(q){if(this._keys.length!==q._keys.length)return!1;for(let c=0;c<this._keys.length;c++){const U=this._keys[c];if(this[U]!==q[U])return!1}return!0}cloneTo(q){this._keys.length!==q._keys.length&&(q._keys=this._keys.slice(0));for(let c=0;c<this._keys.length;c++){const U=this._keys[c];q[U]=this[U]}}reset(){for(const q of this._keys)this._setDefaultValue(q)}_setDefaultValue(q){var c,U,J,Q;const s=(null===(c=this._externalProperties)||void 0===c||null===(U=c[q])||void 0===U?void 0:U.type)??typeof this[q],g=null===(J=this._externalProperties)||void 0===J||null===(Q=J[q])||void 0===Q?void 0:Q.default;switch(s){case"number":this[q]=g??0;break;case"string":this[q]=g??"";break;default:this[q]=g??!1}}toString(){let q="";for(let c=0;c<this._keys.length;c++){const U=this._keys[c],J=this[U];switch(typeof J){case"number":case"string":q+="#define "+U+" "+J+"\n";break;default:J&&(q+="#define "+U+"\n")}}return q}}},11434:(q,c,U)=>{U.d(c,{c:()=>Q});var J=U(10954);class Q{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(q){this._DiffuseTextureEnabled!==q&&(this._DiffuseTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get BaseWeightTextureEnabled(){return this._BaseWeightTextureEnabled}static set BaseWeightTextureEnabled(q){this._BaseWeightTextureEnabled!==q&&(this._BaseWeightTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get BaseDiffuseRoughnessTextureEnabled(){return this._BaseDiffuseRoughnessTextureEnabled}static set BaseDiffuseRoughnessTextureEnabled(q){this._BaseDiffuseRoughnessTextureEnabled!==q&&(this._BaseDiffuseRoughnessTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(q){this._DetailTextureEnabled!==q&&(this._DetailTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(q){this._DecalMapEnabled!==q&&(this._DecalMapEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(q){this._AmbientTextureEnabled!==q&&(this._AmbientTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(q){this._OpacityTextureEnabled!==q&&(this._OpacityTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(q){this._ReflectionTextureEnabled!==q&&(this._ReflectionTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(q){this._EmissiveTextureEnabled!==q&&(this._EmissiveTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(q){this._SpecularTextureEnabled!==q&&(this._SpecularTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(q){this._BumpTextureEnabled!==q&&(this._BumpTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(q){this._LightmapTextureEnabled!==q&&(this._LightmapTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(q){this._RefractionTextureEnabled!==q&&(this._RefractionTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(q){this._ColorGradingTextureEnabled!==q&&(this._ColorGradingTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(q){this._FresnelEnabled!==q&&(this._FresnelEnabled=q,J.d.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(q){this._ClearCoatTextureEnabled!==q&&(this._ClearCoatTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(q){this._ClearCoatBumpTextureEnabled!==q&&(this._ClearCoatBumpTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(q){this._ClearCoatTintTextureEnabled!==q&&(this._ClearCoatTintTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(q){this._SheenTextureEnabled!==q&&(this._SheenTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(q){this._AnisotropicTextureEnabled!==q&&(this._AnisotropicTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(q){this._ThicknessTextureEnabled!==q&&(this._ThicknessTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(q){this._RefractionIntensityTextureEnabled!==q&&(this._RefractionIntensityTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(q){this._TranslucencyIntensityTextureEnabled!==q&&(this._TranslucencyIntensityTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(q){this._TranslucencyColorTextureEnabled!==q&&(this._TranslucencyColorTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(q){this._IridescenceTextureEnabled!==q&&(this._IridescenceTextureEnabled=q,J.d.MarkAllMaterialsAsDirty(1))}}Q._DiffuseTextureEnabled=!0,Q._BaseWeightTextureEnabled=!0,Q._BaseDiffuseRoughnessTextureEnabled=!0,Q._DetailTextureEnabled=!0,Q._DecalMapEnabled=!0,Q._AmbientTextureEnabled=!0,Q._OpacityTextureEnabled=!0,Q._ReflectionTextureEnabled=!0,Q._EmissiveTextureEnabled=!0,Q._SpecularTextureEnabled=!0,Q._BumpTextureEnabled=!0,Q._LightmapTextureEnabled=!0,Q._RefractionTextureEnabled=!0,Q._ColorGradingTextureEnabled=!0,Q._FresnelEnabled=!0,Q._ClearCoatTextureEnabled=!0,Q._ClearCoatBumpTextureEnabled=!0,Q._ClearCoatTintTextureEnabled=!0,Q._SheenTextureEnabled=!0,Q._AnisotropicTextureEnabled=!0,Q._ThicknessTextureEnabled=!0,Q._RefractionIntensityTextureEnabled=!0,Q._TranslucencyIntensityTextureEnabled=!0,Q._TranslucencyColorTextureEnabled=!0,Q._IridescenceTextureEnabled=!0},11095:(q,c,U)=>{U.d(c,{C:()=>i,D:()=>r,G:()=>K,H:()=>O,K:()=>V,N:()=>Y,R:()=>o,S:()=>v,T:()=>G,W:()=>S,Y:()=>Z,_:()=>z,c:()=>R,cb:()=>H,f:()=>u,i:()=>t,m:()=>D,n:()=>b,p:()=>h,s:()=>a,u:()=>F,v:()=>p,z:()=>C});var J=U(10886),Q=U(11093),s=U(10864),g=U(11100),X=U(11104);const n=Q.c.Black(),W={NUM_MORPH_INFLUENCERS:0,NORMAL:!1,TANGENT:!1,UV:!1,UV2:!1,COLOR:!1};function D(q,c,U){if(!q||q.LOGARITHMICDEPTH||q.indexOf&&q.indexOf("LOGARITHMICDEPTH")>=0){const q=U.activeCamera;1===q.mode&&J.c.Error("Logarithmic depth is not compatible with orthographic cameras!",20),c.setFloat("logarithmicDepthConstant",2/(Math.log(q.maxZ+1)/Math.LN2))}}function u(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];U&&q.fogEnabled&&(!c||c.applyFog)&&0!==q.fogMode&&(U.setFloat4("vFogInfos",q.fogMode,q.fogStart,q.fogEnd,q.fogDensity),J?(q.fogColor.toLinearSpaceToRef(n,q.getEngine().useExactSrgbConversions),U.setColor3("vFogColor",n)):U.setColor3("vFogColor",q.fogColor))}function K(q,c,U,J,Q,s,g,X,n,D){const u=q.numMaxInfluencers||q.numInfluencers;return u<=0?0:(c.push("#define MORPHTARGETS"),q.hasPositions&&c.push("#define MORPHTARGETTEXTURE_HASPOSITIONS"),q.hasNormals&&c.push("#define MORPHTARGETTEXTURE_HASNORMALS"),q.hasTangents&&c.push("#define MORPHTARGETTEXTURE_HASTANGENTS"),q.hasUVs&&c.push("#define MORPHTARGETTEXTURE_HASUVS"),q.hasUV2s&&c.push("#define MORPHTARGETTEXTURE_HASUV2S"),q.hasColors&&c.push("#define MORPHTARGETTEXTURE_HASCOLORS"),q.supportsPositions&&Q&&c.push("#define MORPHTARGETS_POSITION"),q.supportsNormals&&s&&c.push("#define MORPHTARGETS_NORMAL"),q.supportsTangents&&g&&c.push("#define MORPHTARGETS_TANGENT"),q.supportsUVs&&X&&c.push("#define MORPHTARGETS_UV"),q.supportsUV2s&&n&&c.push("#define MORPHTARGETS_UV2"),q.supportsColors&&D&&c.push("#define MORPHTARGETS_COLOR"),c.push("#define NUM_MORPH_INFLUENCERS "+u),q.isUsingTextureForTargets&&c.push("#define MORPHTARGETS_TEXTURE"),W.NUM_MORPH_INFLUENCERS=u,W.NORMAL=s,W.TANGENT=g,W.UV=X,W.UV2=n,W.COLOR=D,r(U,J,W,Q),u)}function r(q,c,U){let Q=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=U.NUM_MORPH_INFLUENCERS;if(g>0&&s.c.LastCreatedEngine){const X=s.c.LastCreatedEngine.getCaps().maxVertexAttribs,n=c.morphTargetManager;if(null!==n&&void 0!==n&&n.isUsingTextureForTargets)return;const W=n&&n.supportsPositions&&Q,D=n&&n.supportsNormals&&U.NORMAL,u=n&&n.supportsTangents&&U.TANGENT,K=n&&n.supportsUVs&&U.UV1,r=n&&n.supportsUV2s&&U.UV2,H=n&&n.supportsColors&&U.VERTEXCOLOR;for(let U=0;U<g;U++)W&&q.push("position"+U),D&&q.push("normal"+U),u&&q.push("tangent"+U),K&&q.push("uv_"+U),r&&q.push("uv2_"+U),H&&q.push("color"+U),q.length>X&&J.c.Error("Cannot add more vertex attributes for mesh "+c.name)}}function H(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q.push("world0"),q.push("world1"),q.push("world2"),q.push("world3"),c&&(q.push("previousWorld0"),q.push("previousWorld1"),q.push("previousWorld2"),q.push("previousWorld3"))}function b(q,c){const U=q.morphTargetManager;q&&U&&c.setFloatArray("morphTargetInfluences",U.influences)}function h(q,c){c.bindToEffect(q,"Scene")}function o(q,c,U){c._needUVs=!0,c[U]=!0,q.optimizeUVAllocation&&q.getTextureMatrix().isIdentityAs3x2()?(c[U+"DIRECTUV"]=q.coordinatesIndex+1,c["MAINUV"+(q.coordinatesIndex+1)]=!0):c[U+"DIRECTUV"]=0}function a(q,c,U){const J=q.getTextureMatrix();c.vc(U+"Matrix",J)}function p(q,c,U){U.BAKED_VERTEX_ANIMATION_TEXTURE&&U.INSTANCES&&q.push("bakedVertexAnimationSettingsInstanced")}function R(q,c,U){var J;if(c&&q&&(q.computeBonesUsingShaders&&c._bonesComputationForcedToCPU&&(q.computeBonesUsingShaders=!1),q.useBones&&q.computeBonesUsingShaders&&q.skeleton)){const Q=q.skeleton;if(Q.isUsingTextureForMatrices&&c.getUniformIndex("boneTextureWidth")>-1){const U=Q.getTransformMatrixTexture(q);c.setTexture("boneSampler",U),c.setFloat("boneTextureWidth",4*(Q.bones.length+1))}else{const s=Q.getTransformMatrices(q);s&&(c.setMatrices("mBones",s),U&&q.Cq().prePassRenderer&&q.Cq().prePassRenderer.getIndex(2)&&(U.previousBones[q.uniqueId]||(U.previousBones[q.uniqueId]=s.slice()),c.setMatrices("mPreviousBones",U.previousBones[q.uniqueId]),J=s,U.previousBones[q.uniqueId].set(J)))}}}function I(q,c,U,J,Q){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];q._bindLight(c,U,J,Q,s)}function t(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const s=Math.min(c.lightSources.length,Q);for(let g=0;g<s;g++){I(c.lightSources[g],g,q,U,"boolean"===typeof J?J:J.SPECULARTERM,c.receiveShadows)}}function C(q,c,U,J){U.NUM_BONE_INFLUENCERS>0&&(J.addCPUSkinningFallback(0,c),q.push("matricesIndices"),q.push("matricesWeights"),U.NUM_BONE_INFLUENCERS>4&&(q.push("matricesIndicesExtra"),q.push("matricesWeightsExtra")))}function i(q,c){(c.INSTANCES||c.THIN_INSTANCES)&&H(q,!!c.PREPASS_VELOCITY),c.INSTANCESCOLOR&&q.push("instanceColor")}function F(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=0;for(let s=0;s<U&&q["LIGHT"+s];s++)s>0&&(Q=J+s,c.addFallback(Q,"LIGHT"+s)),q.SHADOWS||(q["SHADOW"+s]&&c.addFallback(J,"SHADOW"+s),q["SHADOWPCF"+s]&&c.addFallback(J,"SHADOWPCF"+s),q["SHADOWPCSS"+s]&&c.addFallback(J,"SHADOWPCSS"+s),q["SHADOWPOISSON"+s]&&c.addFallback(J,"SHADOWPOISSON"+s),q["SHADOWESM"+s]&&c.addFallback(J,"SHADOWESM"+s),q["SHADOWCLOSEESM"+s]&&c.addFallback(J,"SHADOWCLOSEESM"+s));return Q++}function v(q,c,U,J,Q,s,g){let X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];g._areMiscDirty&&(g.LOGARITHMICDEPTH=U,g.POINTSIZE=J,g.FOG=Q&&function(q,c){return c.fogEnabled&&q.applyFog&&0!==c.fogMode}(q,c),g.NONUNIFORMSCALING=q.nonUniformScaling,g.ALPHATEST=s,g.DECAL_AFTER_DETAIL=X)}function Y(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!U._areLightsDirty)return U._needNormals;let g=0;const X={needNormals:U._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(q.lightsEnabled&&!s)for(const W of c.lightSources)if(k(q,c,W,g,U,J,X),g++,g===Q)break;U.SPECULARTERM=X.specularEnabled,U.SHADOWS=X.shadowEnabled;for(let W=g;W<Q;W++)void 0!==U["LIGHT"+W]&&(U["LIGHT"+W]=!1,U["HEMILIGHT"+W]=!1,U["POINTLIGHT"+W]=!1,U["DIRLIGHT"+W]=!1,U["SPOTLIGHT"+W]=!1,U["AREALIGHT"+W]=!1,U["SHADOW"+W]=!1,U["SHADOWCSM"+W]=!1,U["SHADOWCSMDEBUG"+W]=!1,U["SHADOWCSMNUM_CASCADES"+W]=!1,U["SHADOWCSMUSESHADOWMAXZ"+W]=!1,U["SHADOWCSMNOBLEND"+W]=!1,U["SHADOWCSM_RIGHTHANDED"+W]=!1,U["SHADOWPCF"+W]=!1,U["SHADOWPCSS"+W]=!1,U["SHADOWPOISSON"+W]=!1,U["SHADOWESM"+W]=!1,U["SHADOWCLOSEESM"+W]=!1,U["SHADOWCUBE"+W]=!1,U["SHADOWLOWQUALITY"+W]=!1,U["SHADOWMEDIUMQUALITY"+W]=!1);const n=q.getEngine().getCaps();return void 0===U.SHADOWFLOAT&&(X.needRebuild=!0),U.SHADOWFLOAT=X.shadowEnabled&&(n.textureFloatRender&&n.textureFloatLinearFiltering||n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering),U.LIGHTMAPEXCLUDED=X.lightmapMode,X.needRebuild&&U.rebuild(),X.needNormals}function k(q,c,U,J,Q,s,X){switch(X.needNormals=!0,void 0===Q["LIGHT"+J]&&(X.needRebuild=!0),Q["LIGHT"+J]=!0,Q["SPOTLIGHT"+J]=!1,Q["HEMILIGHT"+J]=!1,Q["POINTLIGHT"+J]=!1,Q["DIRLIGHT"+J]=!1,Q["AREALIGHT"+J]=!1,U.prepareLightSpecificDefines(Q,J),Q["LIGHT_FALLOFF_PHYSICAL"+J]=!1,Q["LIGHT_FALLOFF_GLTF"+J]=!1,Q["LIGHT_FALLOFF_STANDARD"+J]=!1,U.falloffType){case g.b.FALLOFF_GLTF:Q["LIGHT_FALLOFF_GLTF"+J]=!0;break;case g.b.FALLOFF_PHYSICAL:Q["LIGHT_FALLOFF_PHYSICAL"+J]=!0;break;case g.b.FALLOFF_STANDARD:Q["LIGHT_FALLOFF_STANDARD"+J]=!0}if(s&&!U.bD.equalsFloats(0,0,0)&&(X.specularEnabled=!0),Q["SHADOW"+J]=!1,Q["SHADOWCSM"+J]=!1,Q["SHADOWCSMDEBUG"+J]=!1,Q["SHADOWCSMNUM_CASCADES"+J]=!1,Q["SHADOWCSMUSESHADOWMAXZ"+J]=!1,Q["SHADOWCSMNOBLEND"+J]=!1,Q["SHADOWCSM_RIGHTHANDED"+J]=!1,Q["SHADOWPCF"+J]=!1,Q["SHADOWPCSS"+J]=!1,Q["SHADOWPOISSON"+J]=!1,Q["SHADOWESM"+J]=!1,Q["SHADOWCLOSEESM"+J]=!1,Q["SHADOWCUBE"+J]=!1,Q["SHADOWLOWQUALITY"+J]=!1,Q["SHADOWMEDIUMQUALITY"+J]=!1,c&&c.receiveShadows&&q.shadowsEnabled&&U.shadowEnabled){const c=U.getShadowGenerator(q.activeCamera)??U.getShadowGenerator();if(c){const q=c.getShadowMap();q&&q.renderList&&q.renderList.length>0&&(X.shadowEnabled=!0,c.prepareDefines(Q,J))}}U.lightmapMode!=g.b.LIGHTMAP_DEFAULT?(X.lightmapMode=!0,Q["LIGHTMAPEXCLUDED"+J]=!0,Q["LIGHTMAPNOSPECULAR"+J]=U.lightmapMode==g.b.LIGHTMAP_SHADOWSONLY):(Q["LIGHTMAPEXCLUDED"+J]=!1,Q["LIGHTMAPNOSPECULAR"+J]=!1)}function V(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=function(q,c){let U=!1;if(q.activeCamera){const J=c.CAMERA_ORTHOGRAPHIC?1:0,Q=c.CAMERA_PERSPECTIVE?1:0,s=1===q.activeCamera.mode?1:0,g=0===q.activeCamera.mode?1:0;(J^s||Q^g)&&(c.CAMERA_ORTHOGRAPHIC=1===s,c.CAMERA_PERSPECTIVE=1===g,U=!0)}return U}(q,J);!1!==s&&(n=(0,X.e)(U,q,J)),J.DEPTHPREPASS!==!c.getColorWrite()&&(J.DEPTHPREPASS=!J.DEPTHPREPASS,n=!0),J.INSTANCES!==Q&&(J.INSTANCES=Q,n=!0),J.THIN_INSTANCES!==g&&(J.THIN_INSTANCES=g,n=!0),n&&J.markAsUnprocessed()}function O(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!c._areAttributesDirty&&c._needNormals===c._normals&&c._needUVs===c._uvs)return!1;c._normals=c._needNormals,c._uvs=c._needUVs,c.NORMAL=c._needNormals&&q.isVerticesDataPresent("normal"),c._needNormals&&q.isVerticesDataPresent("tangent")&&(c.TANGENT=!0);for(let X=1;X<=6;++X)c["UV"+X]=!!c._needUVs&&q.isVerticesDataPresent(`uv${1===X?"":X}`);if(U){const U=q.useVertexColors&&q.isVerticesDataPresent("color");c.VERTEXCOLOR=U,c.VERTEXALPHA=q.hasVertexAlpha&&U&&s}return q.isVerticesDataPresent("instanceColor")&&(q.hasInstances||q.hasThinInstances)&&(c.INSTANCESCOLOR=!0),J&&function(q,c){if(q.useBones&&q.computeBonesUsingShaders&&q.skeleton){c.NUM_BONE_INFLUENCERS=q.numBoneInfluencers;const U=void 0!==c.BONETEXTURE;if(q.skeleton.isUsingTextureForMatrices&&U)c.BONETEXTURE=!0;else{c.BonesPerMesh=q.skeleton.bones.length+1,c.BONETEXTURE=!U&&void 0;const J=q.Cq().prePassRenderer;if(J&&J.enabled){const U=-1===J.excludedSkinnedMesh.indexOf(q);c.BONES_VELOCITY_ENABLED=U}}}else c.NUM_BONE_INFLUENCERS=0,c.BonesPerMesh=0,void 0!==c.BONETEXTURE&&(c.BONETEXTURE=!1)}(q,c),Q&&function(q,c){const U=q.morphTargetManager;U?(c.MORPHTARGETS_UV=U.supportsUVs&&c.UV1,c.MORPHTARGETS_UV2=U.supportsUV2s&&c.UV2,c.MORPHTARGETS_TANGENT=U.supportsTangents&&c.TANGENT,c.MORPHTARGETS_NORMAL=U.supportsNormals&&c.NORMAL,c.MORPHTARGETS_POSITION=U.supportsPositions,c.MORPHTARGETS_COLOR=U.supportsColors,c.MORPHTARGETTEXTURE_HASUVS=U.hasUVs,c.MORPHTARGETTEXTURE_HASUV2S=U.hasUV2s,c.MORPHTARGETTEXTURE_HASTANGENTS=U.hasTangents,c.MORPHTARGETTEXTURE_HASNORMALS=U.hasNormals,c.MORPHTARGETTEXTURE_HASPOSITIONS=U.hasPositions,c.MORPHTARGETTEXTURE_HASCOLORS=U.hasColors,c.NUM_MORPH_INFLUENCERS=U.numMaxInfluencers||U.numInfluencers,c.MORPHTARGETS=c.NUM_MORPH_INFLUENCERS>0,c.MORPHTARGETS_TEXTURE=U.isUsingTextureForTargets):(c.MORPHTARGETS_UV=!1,c.MORPHTARGETS_UV2=!1,c.MORPHTARGETS_TANGENT=!1,c.MORPHTARGETS_NORMAL=!1,c.MORPHTARGETS_POSITION=!1,c.MORPHTARGETS_COLOR=!1,c.MORPHTARGETTEXTURE_HASUVS=!1,c.MORPHTARGETTEXTURE_HASUV2S=!1,c.MORPHTARGETTEXTURE_HASTANGENTS=!1,c.MORPHTARGETTEXTURE_HASNORMALS=!1,c.MORPHTARGETTEXTURE_HASPOSITIONS=!1,c.MORPHTARGETTEXTURE_HAS_COLORS=!1,c.MORPHTARGETS=!1,c.NUM_MORPH_INFLUENCERS=0)}(q,c),g&&function(q,c){const U=q.bakedVertexAnimationManager;c.BAKED_VERTEX_ANIMATION_TEXTURE=!(!U||!U.isEnabled)}(q,c),!0}function G(q,c){if(q.activeCamera){const U=c.MULTIVIEW;c.MULTIVIEW=null!==q.activeCamera.outputRenderTarget&&q.activeCamera.outputRenderTarget.getViewCount()>1,c.MULTIVIEW!=U&&c.markAsUnprocessed()}}function S(q,c,U){const J=c.ORDER_INDEPENDENT_TRANSPARENCY,Q=c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;c.ORDER_INDEPENDENT_TRANSPARENCY=q.useOrderIndependentTransparency&&U,c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!q.getEngine().getCaps().textureFloatLinearFiltering,J===c.ORDER_INDEPENDENT_TRANSPARENCY&&Q===c.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||c.markAsUnprocessed()}function Z(q,c,U){const J=c.PREPASS;if(!c._arePrePassDirty)return;const Q=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(q.prePassRenderer&&q.prePassRenderer.enabled&&U){c.PREPASS=!0,c.SCENE_MRT_COUNT=q.prePassRenderer.mrtCount,c.PREPASS_NORMAL_WORLDSPACE=q.prePassRenderer.generateNormalsInWorldSpace,c.PREPASS_COLOR=!0,c.PREPASS_COLOR_INDEX=0;for(let U=0;U<Q.length;U++){const J=q.prePassRenderer.getIndex(Q[U].type);-1!==J?(c[Q[U].define]=!0,c[Q[U].index]=J):c[Q[U].define]=!1}}else{c.PREPASS=!1;for(let q=0;q<Q.length;q++)c[Q[q].define]=!1}c.PREPASS!=J&&(c.markAsUnprocessed(),c.markAsImageProcessingDirty())}function x(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Q&&Q.push("Light"+q),s||(c.push("vLightData"+q,"vLightDiffuse"+q,"vLightSpecular"+q,"vLightDirection"+q,"vLightWidth"+q,"vLightHeight"+q,"vLightFalloff"+q,"vLightGround"+q,"lightMatrix"+q,"shadowsInfo"+q,"depthValues"+q),U.push("shadowTexture"+q),U.push("depthTexture"+q),c.push("viewFrustumZ"+q,"cascadeBlendFactor"+q,"lightSizeUVCorrection"+q,"depthCorrection"+q,"penumbraDarkness"+q,"frustumLengths"+q),J&&(U.push("projectionLightTexture"+q),c.push("textureProjectionMatrix"+q)),g&&U.push("iesLightTexture"+q))}function z(q,c,U){let J,Q,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4;if(q.uniformsNames){const g=q;J=g.uniformsNames,Q=g.uniformBuffersNames,c=g.samplers,U=g.defines,s=g.maxSimultaneousLights||0}else J=q,c||(c=[]);for(let g=0;g<s&&U["LIGHT"+g];g++)x(g,J,c,U["PROJECTEDLIGHTTEXTURE"+g],Q,!1,U["IESLIGHTTEXTURE"+g]);U.NUM_MORPH_INFLUENCERS&&(J.push("morphTargetInfluences"),J.push("morphTargetCount")),U.BAKED_VERTEX_ANIMATION_TEXTURE&&(J.push("bakedVertexAnimationSettings"),J.push("bakedVertexAnimationTextureSizeInverted"),J.push("bakedVertexAnimationTime"),c.push("bakedVertexAnimationTexture"))}},11460:(q,c,U)=>{U.d(c,{e:()=>s});var J,Q=U(10833);!function(q){q[q.Zero=0]="Zero",q[q.One=1]="One",q[q.MaxViewZ=2]="MaxViewZ"}(J||(J={}));class s{static CreateConfiguration(q){return s._Configurations[q]={defines:{},previousWorldMatrices:{},previousViewProjection:Q.d.Zero(),currentViewProjection:Q.d.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[],reverseCulling:!1},s._Configurations[q]}static DeleteConfiguration(q){delete s._Configurations[q]}static GetConfiguration(q){return s._Configurations[q]}static AddUniformsAndSamplers(q,c){q.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(q,c){for(const U of c)if(U.Gc)for(const c of U.Gc)c._removeDrawWrapper(q)}static PrepareDefines(q,c,U){if(!U._arePrePassDirty)return;const J=s._Configurations[q];if(!J)return;U.PREPASS=!0,U.PREPASS_COLOR=!1,U.PREPASS_COLOR_INDEX=-1;let Q=0;for(let g=0;g<s.GeometryTextureDescriptions.length;g++){const q=s.GeometryTextureDescriptions[g],c=q.define,X=q.defineIndex,n=J.defines[X];void 0!==n?(U[c]=!0,U[X]=n,Q++):(U[c]=!1,delete U[X])}U.SCENE_MRT_COUNT=Q,U.BONES_VELOCITY_ENABLED=c.useBones&&c.computeBonesUsingShaders&&c.skeleton&&!c.skeleton.isUsingTextureForMatrices&&-1===J.excludedSkinnedMesh.indexOf(c)}static Bind(q,c,U,J,Q){const g=s._Configurations[q];if(!g)return;const X=U.Cq(),n=X.getEngine();if(g.reverseCulling&&n.setStateCullFaceType(X._mirroredCameraPosition?Q.cullBackFaces:!Q.cullBackFaces),(void 0!==g.defines.PREPASS_VELOCITY_INDEX||void 0!==g.defines.PREPASS_VELOCITY_LINEAR_INDEX)&&(g.previousWorldMatrices[U.uniqueId]||(g.previousWorldMatrices[U.uniqueId]=J.clone()),g.previousViewProjection||(g.previousViewProjection=X.getTransformMatrix().clone(),g.currentViewProjection=X.getTransformMatrix().clone()),g.currentViewProjection.updateFlag!==X.getTransformMatrix().updateFlag?(g.lastUpdateFrameId=n.frameId,g.previousViewProjection.X(g.currentViewProjection),g.currentViewProjection.X(X.getTransformMatrix())):g.lastUpdateFrameId!==n.frameId&&(g.lastUpdateFrameId=n.frameId,g.previousViewProjection.X(g.currentViewProjection)),c.setMatrix("previousWorld",g.previousWorldMatrices[U.uniqueId]),c.setMatrix("previousViewProjection",g.previousViewProjection),g.previousWorldMatrices[U.uniqueId]=J.clone(),U.useBones&&U.computeBonesUsingShaders&&U.skeleton)){const q=U.skeleton;if(!q.isUsingTextureForMatrices||-1===c.getUniformIndex("boneTextureWidth")){const J=q.getTransformMatrices(U);J&&(g.previousBones[U.uniqueId]||(g.previousBones[U.uniqueId]=J.slice()),c.setMatrices("mPreviousBones",g.previousBones[U.uniqueId]),g.previousBones[U.uniqueId].set(J))}}}}s.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"},{type:13,name:"NormalizedViewDepth",clearType:1,define:"PREPASS_NORMALIZED_VIEW_DEPTH",defineIndex:"PREPASS_NORMALIZED_VIEW_DEPTH_INDEX"}],s._Configurations={}},11418:(q,c,U)=>{U.d(c,{e:()=>o});var J=U(11010),Q=U(11019),s=U(11004),g=U(10864),X=U(10937),n=U(10961);const W=new RegExp("^([gimus]+)!");class D{constructor(q){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=q,this._scene=q.Cq(),this._engine=this._scene.getEngine()}_addPlugin(q){for(let J=0;J<this._plugins.length;++J)if(this._plugins[J].name===q.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!q.isCompatible(this._material.shaderLanguage))throw`The plugin "${q.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const c=q.getClassName();D._MaterialPluginClassToMainDefine[c]||(D._MaterialPluginClassToMainDefine[c]="MATERIALPLUGIN_"+ ++D._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(q,c)=>this._handlePluginEvent(q,c),this._plugins.push(q),this._plugins.sort(((q,c)=>q.priority-c.priority)),this._codeInjectionPoints={};const U={};U[D._MaterialPluginClassToMainDefine[c]]={type:"boolean",default:!0};for(const J of this._plugins)J.collectDefines(U),this._collectPointNames("vertex",J.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",J.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=U,!0}_activatePlugin(q){-1===this._activePlugins.indexOf(q)&&(this._activePlugins.push(q),this._activePlugins.sort(((q,c)=>q.priority-c.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),q.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(q),this._activePluginsForExtraEvents.sort(((q,c)=>q.priority-c.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(q){for(let c=0;c<this._plugins.length;++c)if(this._plugins[c].name===q)return this._plugins[c];return null}_handlePluginEventIsReadyForSubMesh(q){let c=!0;for(const U of this._activePlugins)c=c&&U.isReadyForSubMesh(q.defines,this._scene,this._engine,q.subMesh);q.isReadyForSubMesh=c}_handlePluginEventPrepareDefinesBeforeAttributes(q){for(const c of this._activePlugins)c.prepareDefinesBeforeAttributes(q.defines,this._scene,q.mesh)}_handlePluginEventPrepareDefines(q){for(const c of this._activePlugins)c.prepareDefines(q.defines,this._scene,q.mesh)}_handlePluginEventHardBindForSubMesh(q){for(const c of this._activePluginsForExtraEvents)c.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,q.subMesh)}_handlePluginEventBindForSubMesh(q){for(const c of this._activePlugins)c.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,q.subMesh)}_handlePluginEventHasRenderTargetTextures(q){let c=!1;for(const U of this._activePluginsForExtraEvents)if(c=U.hasRenderTargetTextures(),c)break;q.hasRenderTargetTextures=c}_handlePluginEventFillRenderTargetTextures(q){for(const c of this._activePluginsForExtraEvents)c.fillRenderTargetTextures(q.renderTargets)}_handlePluginEvent(q,c){switch(q){case 512:{const q=c;for(const c of this._activePlugins)c.getActiveTextures(q.activeTextures);break}case 256:{const q=c;for(const c of this._activePlugins)c.getAnimatables(q.animatables);break}case 1024:{const q=c;let U=!1;for(const c of this._activePlugins)if(U=c.hasTexture(q.texture),U)break;q.hasTexture=U;break}case 2:{const q=c;for(const c of this._plugins)c.dispose(q.forceDisposeTextures);break}case 4:c.defineNames=this._defineNamesFromPlugins;break;case 128:{const q=c;for(const c of this._activePlugins)q.fallbackRank=c.addFallbacks(q.defines,q.fallbacks,q.fallbackRank),c.getAttributes(q.attributes,this._scene,q.mesh);this._uniformList.length>0&&q.uniforms.push(...this._uniformList),this._samplerList.length>0&&q.samplers.push(...this._samplerList),this._uboList.length>0&&q.uniformBuffersNames.push(...this._uboList),q.customCode=this._injectCustomCode(q,q.customCode);break}case 8:{const q=c;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const U=1===this._material.shaderLanguage;for(const c of this._plugins){const J=c.getUniforms(this._material.shaderLanguage);if(J){if(J.ubo)for(const c of J.ubo){if(c.size&&c.type){const J=c.arraySize??0;if(q.ubo.addUniform(c.name,c.size,J),U){let q;switch(c.type){case"mat4":q="mat4x4f";break;case"float":q="f32";break;default:q=`${c.type}f`}this._uboDeclaration+=J>0?`uniform ${c.name}: array<${q}, ${J}>;\n`:`uniform ${c.name}: ${q};\n`}else this._uboDeclaration+=`${c.type} ${c.name}${J>0?`[${J}]`:""};\n`}this._uniformList.push(c.name)}J.vertex&&(this._vertexDeclaration+=J.vertex+"\n"),J.fragment&&(this._fragmentDeclaration+=J.fragment+"\n")}c.getSamplers(this._samplerList),c.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(q,c){if(c)for(const U in c)this._codeInjectionPoints[q]||(this._codeInjectionPoints[q]={}),this._codeInjectionPoints[q][U]=!0}_injectCustomCode(q,c){return(U,J)=>{var Q;c&&(J=c(U,J)),this._uboDeclaration&&(J=J.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(J=J.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(J=J.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const s=null===(Q=this._codeInjectionPoints)||void 0===Q?void 0:Q[U];if(!s)return J;let g=null;for(let c in s){let Q="";for(const J of this._activePlugins){var D;let s=null===(D=J.getCustomCode(U,this._material.shaderLanguage))||void 0===D?void 0:D[c];if(s){if(J.resolveIncludes){if(null===g){const c=0;g={defines:[],indexParameters:q.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:n.c.GetShadersRepository(c),includesShadersStore:n.c.GetIncludesShadersStore(c),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}g.isFragment="fragment"===U,(0,X.h)(s,g,(q=>s=q))}Q+=s+"\n"}}if(Q.length>0)if("!"===c.charAt(0)){c=c.substring(1);let q="g";if("!"===c.charAt(0))q="",c=c.substring(1);else{const U=W.exec(c);U&&U.length>=2&&(q=U[1],c=c.substring(q.length+1))}q.indexOf("g")<0&&(q+="g");const U=J,s=new RegExp(c,q);let g=s.exec(U);for(;null!==g;){let q=Q;for(let c=0;c<g.length;++c)q=q.replace("$"+c,g[c]);J=J.replace(g[0],q),g=s.exec(U)}}else{const q="#define "+c;J=J.replace(q,"\n"+Q+"\n"+q)}}return J}}}D._MaterialPluginClassToMainDefine={},D._MaterialPluginCounter=0,g.c.OnEnginesDisposedObservable.add((()=>{H()}));const u=[];let K=!1,r=null;function H(){u.length=0,K=!1,s.b.OnEventObservable.remove(r),r=null}var b=U(11082),h=U(10850);class o{isCompatible(q){return 0===q}_enable(q){q&&this._pluginManager._activatePlugin(this)}constructor(q,c,U,J){let Q=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this.doNotSerialize=!1,this._material=q,this.name=c,this.priority=U,this.resolveIncludes=g,q.pluginManager||(q.pluginManager=new D(q),q.Cc.add((()=>{q.pluginManager=void 0}))),this._pluginDefineNames=J,this._pluginManager=q.pluginManager,Q&&this._pluginManager._addPlugin(this),s&&this._enable(!0),this.markAllDefinesAsDirty=q._dirtyCallbacks[127]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(q,c,U,J){return!0}hardBindForSubMesh(q,c,U,J){}bindForSubMesh(q,c,U,J){}dispose(q){}getCustomCode(q){return null}collectDefines(q){if(this._pluginDefineNames)for(const c of Object.keys(this._pluginDefineNames)){if("_"===c[0])continue;const U=typeof this._pluginDefineNames[c];q[c]={type:"number"===U?"number":"string"===U?"string":"boolean"===U?"boolean":"object",default:this._pluginDefineNames[c]}}}prepareDefinesBeforeAttributes(q,c,U){}prepareDefines(q,c,U){}hasTexture(q){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(q){}getActiveTextures(q){}getAnimatables(q){}addFallbacks(q,c,U){return U}getSamplers(q){}getAttributes(q,c,U){}getUniformBuffersNames(q){}getUniforms(){return{}}copyTo(q){b.e.Clone((()=>q),this)}serialize(){return b.e.Serialize(this)}parse(q,c,U){b.e.Parse((()=>this),q,c,U)}}(0,J.d)([(0,Q.N)()],o.prototype,"name",void 0),(0,J.d)([(0,Q.N)()],o.prototype,"priority",void 0),(0,J.d)([(0,Q.N)()],o.prototype,"resolveIncludes",void 0),(0,J.d)([(0,Q.N)()],o.prototype,"registerForExtraEvents",void 0),(0,h.f)("BABYLON.MaterialPluginBase",o)},11183:(q,c,U)=>{U.d(c,{e:()=>g});var J=U(11004),Q=U(11087),s=U(10850);class g extends J.b{get Sc(){return this._subMaterials}set Sc(q){this._subMaterials=q,this._hookArray(q)}getChildren(){return this.Sc}constructor(q,c){super(q,c,!0),this._waitingSubMaterialsUniqueIds=[],this.Cq().addMultiMaterial(this),this.Sc=[],this._storeEffectOnSubMeshes=!0}_hookArray(q){var c=this;const U=q.push;q.push=function(){for(var J=arguments.length,Q=new Array(J),s=0;s<J;s++)Q[s]=arguments[s];const g=U.apply(q,Q);return c._markAllSubMeshesAsTexturesDirty(),g};const J=q.splice;q.splice=(c,U)=>{const Q=J.apply(q,[c,U]);return this._markAllSubMeshesAsTexturesDirty(),Q}}getSubMaterial(q){return q<0||q>=this.Sc.length?this.Cq().defaultMaterial:this.Sc[q]}getActiveTextures(){return super.getActiveTextures().concat(...this.Sc.map((q=>q?q.getActiveTextures():[])))}hasTexture(q){if(super.hasTexture(q))return!0;for(let U=0;U<this.Sc.length;U++){var c;if(null!==(c=this.Sc[U])&&void 0!==c&&c.hasTexture(q))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(q,c,U){for(let J=0;J<this.Sc.length;J++){const Q=this.Sc[J];if(Q){if(Q._storeEffectOnSubMeshes){if(!Q.isReadyForSubMesh(q,c,U))return!1;continue}if(!Q.isReady(q))return!1}}return!0}clone(q,c){const U=new g(q,this.Cq());for(let J=0;J<this.Sc.length;J++){let Q=null;const s=this.Sc[J];Q=c&&s?s.clone(q+"-"+s.name):this.Sc[J],U.Sc.push(Q)}return U}serialize(){const q={};q.name=this.name,q.id=this.id,q.uniqueId=this.uniqueId,Q.d&&(q.tags=Q.d.GetTags(this)),q.materialsUniqueIds=[],q.materials=[];for(let c=0;c<this.Sc.length;c++){const U=this.Sc[c];U?(q.materialsUniqueIds.push(U.uniqueId),q.materials.push(U.id)):(q.materialsUniqueIds.push(null),q.materials.push(null))}return q}dispose(q,c,U){const J=this.Cq();if(!J)return;if(U)for(let s=0;s<this.Sc.length;s++){const U=this.Sc[s];U&&U.dispose(q,c)}const Q=J.multiMaterials.indexOf(this);Q>=0&&J.multiMaterials.splice(Q,1),super.dispose(q,c)}static ParseMultiMaterial(q,c){const U=new g(q.name,c);if(U.id=q.id,U._loadedUniqueId=q.uniqueId,Q.d&&Q.d.AddTagsTo(U,q.tags),q.materialsUniqueIds)U._waitingSubMaterialsUniqueIds=q.materialsUniqueIds;else for(const J of q.materials)U.Sc.push(c.getLastMaterialById(J));return U}}(0,s.f)("BABYLON.MultiMaterial",g)},11422:(q,c,U)=>{U.d(c,{e:()=>J});class J{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(q){q.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(q){}bindForSubMesh(q,c,U,J,Q){if(c.prePassRenderer&&c.prePassRenderer.enabled&&c.prePassRenderer.currentRTisSceneRT&&(-1!==c.prePassRenderer.getIndex(2)||-1!==c.prePassRenderer.getIndex(11))){this.previousWorldMatrices[U.uniqueId]||(this.previousWorldMatrices[U.uniqueId]=J.clone()),this.previousViewProjection||(this.previousViewProjection=c.getTransformMatrix().clone(),this.currentViewProjection=c.getTransformMatrix().clone());const Q=c.getEngine();this.currentViewProjection.updateFlag!==c.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=Q.frameId,this.previousViewProjection.X(this.currentViewProjection),this.currentViewProjection.X(c.getTransformMatrix())):this._lastUpdateFrameId!==Q.frameId&&(this._lastUpdateFrameId=Q.frameId,this.previousViewProjection.X(this.currentViewProjection)),q.setMatrix("previousWorld",this.previousWorldMatrices[U.uniqueId]),q.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[U.uniqueId]=J.clone()}}}},11429:(q,c,U)=>{U.d(c,{d:()=>s});var J=U(10833),Q=U(11004);class s extends Q.b{constructor(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(q,c,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new J.d,this._storeEffectOnSubMeshes=U}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(q,c){return!!q&&(!this._storeEffectOnSubMeshes||(!q.Gc||0===q.Gc.length||this.isReadyForSubMesh(q,q.Gc[0],c)))}_isReadyForSubMesh(q){const c=q.materialDefines;return!(this.checkReadyOnEveryCall||!q.effect||!c||c._renderId!==this.Cq().getRenderId())}bindOnlyWorldMatrix(q){this._activeEffect.setMatrix("world",q)}bindOnlyNormalMatrix(q){this._activeEffect.setMatrix("normalMatrix",q)}bind(q,c){c&&this.bindForSubMesh(q,c,c.Gc[0])}_afterBind(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;super._afterBind(q,c,U),this.Cq()._cachedEffect=c,U?U._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return U._drawWrapper._forceRebindOnNextCall||q.isCachedMaterialInvalid(this,c,J)}dispose(q,c,U){this._activeEffect=void 0,super.dispose(q,c,U)}}},11495:(q,c,U)=>{U.d(c,{b:()=>h});var J=U(11082),Q=U(11364),s=U(10833),g=U(11031),X=U(11288),n=U(10850),W=U(11454),D=U(10913),u=U(11429),K=U(10864),r=U(11104),H=U(11095);const b={effect:null,subMesh:null};class h extends u.d{constructor(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(q,c,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new s.d,this._cachedWorldViewProjectionMatrix=new s.d,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=U,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","Jc","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...J}}get shaderPath(){return this._shaderPath}set shaderPath(q){this._shaderPath=q}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(q){-1===this._options.uniforms.indexOf(q)&&this._options.uniforms.push(q)}setTexture(q,c){return-1===this._options.samplers.indexOf(q)&&this._options.samplers.push(q),this._textures[q]=c,this}removeTexture(q){delete this._textures[q]}setTextureArray(q,c){return-1===this._options.samplers.indexOf(q)&&this._options.samplers.push(q),this._checkUniform(q),this._textureArrays[q]=c,this}setExternalTexture(q,c){return-1===this._options.externalTextures.indexOf(q)&&this._options.externalTextures.push(q),this._externalTextures[q]=c,this}setFloat(q,c){return this._checkUniform(q),this._floats[q]=c,this}setInt(q,c){return this._checkUniform(q),this._ints[q]=c,this}setUInt(q,c){return this._checkUniform(q),this._uints[q]=c,this}setFloats(q,c){return this._checkUniform(q),this._floatsArrays[q]=c,this}setColor3(q,c){return this._checkUniform(q),this._colors3[q]=c,this}setColor3Array(q,c){return this._checkUniform(q),this._colors3Arrays[q]=c.reduce(((q,c)=>(q.push(c.r,c.g,c.b),q)),[]),this}setColor4(q,c){return this._checkUniform(q),this._colors4[q]=c,this}setColor4Array(q,c){return this._checkUniform(q),this._colors4Arrays[q]=c.reduce(((q,c)=>(q.push(c.r,c.g,c.b,c.a),q)),[]),this}setVector2(q,c){return this._checkUniform(q),this._vectors2[q]=c,this}setVector3(q,c){return this._checkUniform(q),this._vectors3[q]=c,this}setVector4(q,c){return this._checkUniform(q),this._vectors4[q]=c,this}setQuaternion(q,c){return this._checkUniform(q),this._quaternions[q]=c,this}setQuaternionArray(q,c){return this._checkUniform(q),this._quaternionsArrays[q]=c.reduce(((q,c)=>(c.toArray(q,q.length),q)),[]),this}setMatrix(q,c){return this._checkUniform(q),this._matrices[q]=c,this}setMatrices(q,c){this._checkUniform(q);const U=new Float32Array(16*c.length);for(let J=0;J<c.length;J++){c[J].copyToArray(U,16*J)}return this._matrixArrays[q]=U,this}setMatrix3x3(q,c){return this._checkUniform(q),this._matrices3x3[q]=c,this}setMatrix2x2(q,c){return this._checkUniform(q),this._matrices2x2[q]=c,this}setArray2(q,c){return this._checkUniform(q),this._vectors2Arrays[q]=c,this}setArray3(q,c){return this._checkUniform(q),this._vectors3Arrays[q]=c,this}setArray4(q,c){return this._checkUniform(q),this._vectors4Arrays[q]=c,this}setUniformBuffer(q,c){return-1===this._options.uniformBuffers.indexOf(q)&&this._options.uniformBuffers.push(q),this._uniformBuffers[q]=c,this}setTextureSampler(q,c){return-1===this._options.samplerObjects.indexOf(q)&&this._options.samplerObjects.push(q),this._textureSamplers[q]=c,this}setStorageBuffer(q,c){return-1===this._options.storageBuffers.indexOf(q)&&this._options.storageBuffers.push(q),this._storageBuffers[q]=c,this}setDefine(q,c){const U=q.trimEnd()+" ",J=this.options.defines.findIndex((c=>c===q||c.startsWith(U)));return J>=0&&this.options.defines.splice(J,1),("boolean"!==typeof c||c)&&this.options.defines.push(U+c),this}isReadyForSubMesh(q,c,U){return this.isReady(q,U,c)}isReady(q,c,U){var J;const s=U&&this._storeEffectOnSubMeshes;if(this.isFrozen){const q=s?U._drawWrapper:this._drawWrapper;if(q.effect&&q._wasPreviouslyReady&&q._wasPreviouslyUsingInstances===c)return!0}const X=this.Cq(),n=X.getEngine(),D=[],u=[];let K=null,h=this._shaderPath,o=this._options.uniforms,a=this._options.uniformBuffers,p=this._options.samplers;n.getCaps().multiview&&X.activeCamera&&X.activeCamera.outputRenderTarget&&X.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,D.push("#define MULTIVIEW"),-1!==o.indexOf("viewProjection")&&-1===o.indexOf("viewProjectionR")&&o.push("viewProjectionR"));for(let Q=0;Q<this._options.defines.length;Q++){const q=0===this._options.defines[Q].indexOf("#define")?this._options.defines[Q]:`#define ${this._options.defines[Q]}`;D.push(q)}for(let Q=0;Q<this._options.attributes.length;Q++)u.push(this._options.attributes[Q]);if(q&&q.isVerticesDataPresent(g.h.ColorKind)&&(-1===u.indexOf(g.h.ColorKind)&&u.push(g.h.ColorKind),D.push("#define VERTEXCOLOR")),c&&(D.push("#define INSTANCES"),(0,H.cb)(u,this._materialHelperNeedsPreviousMatrices),null!==q&&void 0!==q&&q.hasThinInstances&&(D.push("#define THIN_INSTANCES"),q&&q.isVerticesDataPresent(g.h.ColorInstanceKind)&&(u.push(g.h.ColorInstanceKind),D.push("#define INSTANCESCOLOR")))),q&&q.useBones&&q.computeBonesUsingShaders&&q.skeleton){u.push(g.h.MatricesIndicesKind),u.push(g.h.MatricesWeightsKind),q.numBoneInfluencers>4&&(u.push(g.h.MatricesIndicesExtraKind),u.push(g.h.MatricesWeightsExtraKind));const c=q.skeleton;D.push("#define NUM_BONE_INFLUENCERS "+q.numBoneInfluencers),K=new W.b,K.addCPUSkinningFallback(0,q),c.isUsingTextureForMatrices?(D.push("#define BONETEXTURE"),-1===o.indexOf("boneTextureWidth")&&o.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(D.push("#define BonesPerMesh "+(c.bones.length+1)),-1===o.indexOf("mBones")&&o.push("mBones"))}else D.push("#define NUM_BONE_INFLUENCERS 0");let R=0;const I=q?q.morphTargetManager:null;if(I){const c=-1!==D.indexOf("#define UV1"),U=-1!==D.indexOf("#define UV2"),J=-1!==D.indexOf("#define TANGENT"),Q=-1!==D.indexOf("#define NORMAL"),s=-1!==D.indexOf("#define VERTEXCOLOR");R=(0,H.G)(I,D,u,q,!0,Q,J,c,U,s),I.isUsingTextureForTargets&&(-1===o.indexOf("morphTargetTextureIndices")&&o.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),R>0&&(o=o.slice(),o.push("morphTargetInfluences"),o.push("morphTargetCount"),o.push("morphTargetTextureInfo"),o.push("morphTargetTextureIndices"))}else D.push("#define NUM_MORPH_INFLUENCERS 0");if(q){const c=q.bakedVertexAnimationManager;c&&c.isEnabled&&(D.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===o.indexOf("bakedVertexAnimationSettings")&&o.push("bakedVertexAnimationSettings"),-1===o.indexOf("bakedVertexAnimationTextureSizeInverted")&&o.push("bakedVertexAnimationTextureSizeInverted"),-1===o.indexOf("bakedVertexAnimationTime")&&o.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,H.v)(u,q,D)}for(const Q in this._textures)if(!this._textures[Q].isReady())return!1;q&&this.needAlphaTestingForMesh(q)&&D.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,r.b)(o),(0,r.h)(this,X,D)),X.fogEnabled&&null!==q&&void 0!==q&&q.applyFog&&X.fogMode!==Q.b.FOGMODE_NONE&&(D.push("#define FOG"),-1===o.indexOf("view")&&o.push("view"),-1===o.indexOf("vFogInfos")&&o.push("vFogInfos"),-1===o.indexOf("vFogColor")&&o.push("vFogColor")),this._useLogarithmicDepth&&(D.push("#define LOGARITHMICDEPTH"),-1===o.indexOf("logarithmicDepthConstant")&&o.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(o=o.slice(),a=a.slice(),p=p.slice(),h=this.customShaderNameResolve(this.name,o,a,p,D,u));const t=s?U._getDrawWrapper(void 0,!0):this._drawWrapper,C=(null===t||void 0===t?void 0:t.effect)??null,i=(null===t||void 0===t?void 0:t.defines)??null,F=D.join("\n");let v=C;return i!==F&&(v=n.createEffect(h,{attributes:u,uniformsNames:o,uniformBuffersNames:a,samplers:p,defines:F,fallbacks:K,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:R},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},n),s?U.setEffect(v,F,this._materialContext):t&&t.setEffect(v,F),this._onEffectCreatedObservable&&(b.effect=v,b.subMesh=U??(null===q||void 0===q?void 0:q.Gc[0])??null,this._onEffectCreatedObservable.notifyObservers(b))),t._wasPreviouslyUsingInstances=!!c,!(null===(J=v)||void 0===J||!J.isReady())&&(C!==v&&X.resetCachedMaterial(),t._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(q,c){const U=c??this.getEffect();if(!U)return;const J=this._options.uniforms;-1!==J.indexOf("world")&&U.setMatrix("world",q);const Q=this.Cq();-1!==J.indexOf("worldView")&&(q.multiplyToRef(Q.getViewMatrix(),this._cachedWorldViewMatrix),U.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==J.indexOf("worldViewProjection")&&(q.multiplyToRef(Q.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),U.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==J.indexOf("view")&&U.setMatrix("view",Q.getViewMatrix())}bindForSubMesh(q,c,U){var J;this.bind(q,c,null===(J=U._drawWrapperOverride)||void 0===J?void 0:J.effect,U)}bind(q,c,U,J){const Q=J&&this._storeEffectOnSubMeshes,s=U??(Q?J.effect:this.getEffect());if(!s)return;const g=this.Cq();this._activeEffect=s,this.bindOnlyWorldMatrix(q,U);const X=this._options.uniformBuffers;let n=!1;if(s&&X&&X.length>0&&g.getEngine().supportsUniformBuffers)for(let u=0;u<X.length;++u){switch(X[u]){case"Mesh":c&&(c.getMeshUniformBuffer().bindToEffect(s,"Mesh"),c.transferToEffect(q));break;case"Scene":(0,H.p)(s,g.getSceneUniformBuffer()),g.finalizeSceneUbo(),n=!0}}const W=c&&Q?this._mustRebind(g,s,J,c.visibility):g.getCachedMaterial()!==this;if(s&&W){let q;for(q in n||-1===this._options.uniforms.indexOf("view")||s.setMatrix("view",g.getViewMatrix()),n||-1===this._options.uniforms.indexOf("projection")||s.setMatrix("projection",g.getProjectionMatrix()),n||-1===this._options.uniforms.indexOf("viewProjection")||(s.setMatrix("viewProjection",g.getTransformMatrix()),this._multiview&&s.setMatrix("viewProjectionR",g._transformMatrixR)),g.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&s.setVector3("cameraPosition",g.activeCamera.globalPosition),(0,H.c)(c,s),(0,r.c)(s,this,g),this._useLogarithmicDepth&&(0,H.m)(Q?J.materialDefines:s.defines,s,g),c&&(0,H.f)(g,c,s),this._textures)s.setTexture(q,this._textures[q]);for(q in this._textureArrays)s.setTextureArray(q,this._textureArrays[q]);for(q in this._ints)s.setInt(q,this._ints[q]);for(q in this._uints)s.setUInt(q,this._uints[q]);for(q in this._floats)s.setFloat(q,this._floats[q]);for(q in this._floatsArrays)s.setArray(q,this._floatsArrays[q]);for(q in this._colors3)s.setColor3(q,this._colors3[q]);for(q in this._colors3Arrays)s.setArray3(q,this._colors3Arrays[q]);for(q in this._colors4){const c=this._colors4[q];s.setFloat4(q,c.r,c.g,c.b,c.a)}for(q in this._colors4Arrays)s.setArray4(q,this._colors4Arrays[q]);for(q in this._vectors2)s.setVector2(q,this._vectors2[q]);for(q in this._vectors3)s.setVector3(q,this._vectors3[q]);for(q in this._vectors4)s.setVector4(q,this._vectors4[q]);for(q in this._quaternions)s.setQuaternion(q,this._quaternions[q]);for(q in this._matrices)s.setMatrix(q,this._matrices[q]);for(q in this._matrixArrays)s.setMatrices(q,this._matrixArrays[q]);for(q in this._matrices3x3)s.setMatrix3x3(q,this._matrices3x3[q]);for(q in this._matrices2x2)s.setMatrix2x2(q,this._matrices2x2[q]);for(q in this._vectors2Arrays)s.setArray2(q,this._vectors2Arrays[q]);for(q in this._vectors3Arrays)s.setArray3(q,this._vectors3Arrays[q]);for(q in this._vectors4Arrays)s.setArray4(q,this._vectors4Arrays[q]);for(q in this._quaternionsArrays)s.setArray4(q,this._quaternionsArrays[q]);for(q in this._uniformBuffers){const c=this._uniformBuffers[q].getBuffer();c&&s.bindUniformBuffer(c,q)}const U=g.getEngine(),X=U.setExternalTexture;if(X)for(q in this._externalTextures)X.call(U,q,this._externalTextures[q]);const W=U.setTextureSampler;if(W)for(q in this._textureSamplers)W.call(U,q,this._textureSamplers[q]);const D=U.setStorageBuffer;if(D)for(q in this._storageBuffers)D.call(U,q,this._storageBuffers[q])}if(s&&c&&(W||!this.isFrozen)){(0,H.n)(c,s),c.morphTargetManager&&c.morphTargetManager.isUsingTextureForTargets&&c.morphTargetManager._bind(s);const q=c.bakedVertexAnimationManager;if(q&&q.isEnabled){var D;const q=Q?J._drawWrapper:this._drawWrapper;null===(D=c.bakedVertexAnimationManager)||void 0===D||D.bind(s,!!q._wasPreviouslyUsingInstances)}}this._afterBind(c,s,J)}getActiveTextures(){const q=super.getActiveTextures();for(const c in this._textures)q.push(this._textures[c]);for(const c in this._textureArrays){const U=this._textureArrays[c];for(let c=0;c<U.length;c++)q.push(U[c])}return q}hasTexture(q){if(super.hasTexture(q))return!0;for(const c in this._textures)if(this._textures[c]===q)return!0;for(const c in this._textureArrays){const U=this._textureArrays[c];for(let c=0;c<U.length;c++)if(U[c]===q)return!0}return!1}clone(q){const c=J.e.Clone((()=>new h(q,this.Cq(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);c.name=q,c.id=q,"object"===typeof c._shaderPath&&(c._shaderPath={...c._shaderPath}),this._options={...this._options};const U=Object.keys(this._options);for(const J of U){const q=this._options[J];Array.isArray(q)&&(this._options[J]=q.slice(0))}this.stencil.copyTo(c.stencil);for(const J in this._textures)c.setTexture(J,this._textures[J]);for(const J in this._textureArrays)c.setTextureArray(J,this._textureArrays[J]);for(const J in this._externalTextures)c.setExternalTexture(J,this._externalTextures[J]);for(const J in this._ints)c.setInt(J,this._ints[J]);for(const J in this._uints)c.setUInt(J,this._uints[J]);for(const J in this._floats)c.setFloat(J,this._floats[J]);for(const J in this._floatsArrays)c.setFloats(J,this._floatsArrays[J]);for(const J in this._colors3)c.setColor3(J,this._colors3[J]);for(const J in this._colors3Arrays)c._colors3Arrays[J]=this._colors3Arrays[J];for(const J in this._colors4)c.setColor4(J,this._colors4[J]);for(const J in this._colors4Arrays)c._colors4Arrays[J]=this._colors4Arrays[J];for(const J in this._vectors2)c.setVector2(J,this._vectors2[J]);for(const J in this._vectors3)c.setVector3(J,this._vectors3[J]);for(const J in this._vectors4)c.setVector4(J,this._vectors4[J]);for(const J in this._quaternions)c.setQuaternion(J,this._quaternions[J]);for(const J in this._quaternionsArrays)c._quaternionsArrays[J]=this._quaternionsArrays[J];for(const J in this._matrices)c.setMatrix(J,this._matrices[J]);for(const J in this._matrixArrays)c._matrixArrays[J]=this._matrixArrays[J].slice();for(const J in this._matrices3x3)c.setMatrix3x3(J,this._matrices3x3[J]);for(const J in this._matrices2x2)c.setMatrix2x2(J,this._matrices2x2[J]);for(const J in this._vectors2Arrays)c.setArray2(J,this._vectors2Arrays[J]);for(const J in this._vectors3Arrays)c.setArray3(J,this._vectors3Arrays[J]);for(const J in this._vectors4Arrays)c.setArray4(J,this._vectors4Arrays[J]);for(const J in this._uniformBuffers)c.setUniformBuffer(J,this._uniformBuffers[J]);for(const J in this._textureSamplers)c.setTextureSampler(J,this._textureSamplers[J]);for(const J in this._storageBuffers)c.setStorageBuffer(J,this._storageBuffers[J]);return c}dispose(q,c,U){if(c){let q;for(q in this._textures)this._textures[q].dispose();for(q in this._textureArrays){const c=this._textureArrays[q];for(let q=0;q<c.length;q++)c[q].dispose()}}this._textures={},super.dispose(q,c,U)}serialize(){const q=J.e.Serialize(this);let c;for(c in q.customType="BABYLON.ShaderMaterial",q.uniqueId=this.uniqueId,q.options=this._options,q.shaderPath=this._shaderPath,q.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,q.stencil=this.stencil.serialize(),q.textures={},this._textures)q.textures[c]=this._textures[c].serialize();for(c in q.textureArrays={},this._textureArrays){q.textureArrays[c]=[];const U=this._textureArrays[c];for(let J=0;J<U.length;J++)q.textureArrays[c].push(U[J].serialize())}for(c in q.ints={},this._ints)q.ints[c]=this._ints[c];for(c in q.uints={},this._uints)q.uints[c]=this._uints[c];for(c in q.floats={},this._floats)q.floats[c]=this._floats[c];for(c in q.floatsArrays={},this._floatsArrays)q.floatsArrays[c]=this._floatsArrays[c];for(c in q.colors3={},this._colors3){const U=this._colors3[c];q.colors3[c]=[U.r,U.g,U.b]}for(c in q.colors3Arrays={},this._colors3Arrays)q.colors3Arrays[c]=this._colors3Arrays[c];for(c in q.colors4={},this._colors4){const U=this._colors4[c];q.colors4[c]=[U.r,U.g,U.b,U.a]}for(c in q.colors4Arrays={},this._colors4Arrays)q.colors4Arrays[c]=this._colors4Arrays[c];for(c in q.vectors2={},this._vectors2){const U=this._vectors2[c];q.vectors2[c]=[U.x,U.y]}for(c in q.vectors3={},this._vectors3){const U=this._vectors3[c];q.vectors3[c]=[U.x,U.y,U.z]}for(c in q.vectors4={},this._vectors4){const U=this._vectors4[c];q.vectors4[c]=[U.x,U.y,U.z,U.w]}for(c in q.quaternions={},this._quaternions)q.quaternions[c]=this._quaternions[c].rc();for(c in q.matrices={},this._matrices)q.matrices[c]=this._matrices[c].rc();for(c in q.matrixArray={},this._matrixArrays)q.matrixArray[c]=this._matrixArrays[c];for(c in q.matrices3x3={},this._matrices3x3)q.matrices3x3[c]=this._matrices3x3[c];for(c in q.matrices2x2={},this._matrices2x2)q.matrices2x2[c]=this._matrices2x2[c];for(c in q.vectors2Arrays={},this._vectors2Arrays)q.vectors2Arrays[c]=this._vectors2Arrays[c];for(c in q.vectors3Arrays={},this._vectors3Arrays)q.vectors3Arrays[c]=this._vectors3Arrays[c];for(c in q.vectors4Arrays={},this._vectors4Arrays)q.vectors4Arrays[c]=this._vectors4Arrays[c];for(c in q.quaternionsArrays={},this._quaternionsArrays)q.quaternionsArrays[c]=this._quaternionsArrays[c];return q}static Parse(q,c,U){const Q=J.e.Parse((()=>new h(q.name,c,q.shaderPath,q.options,q.storeEffectOnSubMeshes)),q,c,U);let g;for(g in q.stencil&&Q.stencil.parse(q.stencil,c,U),q.textures)Q.setTexture(g,X.c.Parse(q.textures[g],c,U));for(g in q.textureArrays){const J=q.textureArrays[g],s=[];for(let q=0;q<J.length;q++)s.push(X.c.Parse(J[q],c,U));Q.setTextureArray(g,s)}for(g in q.ints)Q.setInt(g,q.ints[g]);for(g in q.uints)Q.setUInt(g,q.uints[g]);for(g in q.floats)Q.setFloat(g,q.floats[g]);for(g in q.floatsArrays)Q.setFloats(g,q.floatsArrays[g]);for(g in q.colors3){const c=q.colors3[g];Q.setColor3(g,{r:c[0],g:c[1],b:c[2]})}for(g in q.colors3Arrays){const c=q.colors3Arrays[g].reduce(((q,c,U)=>(U%3===0?q.push([c]):q[q.length-1].push(c),q)),[]).map((q=>({r:q[0],g:q[1],b:q[2]})));Q.setColor3Array(g,c)}for(g in q.colors4){const c=q.colors4[g];Q.setColor4(g,{r:c[0],g:c[1],b:c[2],a:c[3]})}for(g in q.colors4Arrays){const c=q.colors4Arrays[g].reduce(((q,c,U)=>(U%4===0?q.push([c]):q[q.length-1].push(c),q)),[]).map((q=>({r:q[0],g:q[1],b:q[2],a:q[3]})));Q.setColor4Array(g,c)}for(g in q.vectors2){const c=q.vectors2[g];Q.setVector2(g,{x:c[0],y:c[1]})}for(g in q.vectors3){const c=q.vectors3[g];Q.setVector3(g,{x:c[0],y:c[1],z:c[2]})}for(g in q.vectors4){const c=q.vectors4[g];Q.setVector4(g,{x:c[0],y:c[1],z:c[2],w:c[3]})}for(g in q.quaternions)Q.setQuaternion(g,s.g.Ic(q.quaternions[g]));for(g in q.matrices)Q.setMatrix(g,s.d.Ic(q.matrices[g]));for(g in q.matrixArray)Q._matrixArrays[g]=new Float32Array(q.matrixArray[g]);for(g in q.matrices3x3)Q.setMatrix3x3(g,q.matrices3x3[g]);for(g in q.matrices2x2)Q.setMatrix2x2(g,q.matrices2x2[g]);for(g in q.vectors2Arrays)Q.setArray2(g,q.vectors2Arrays[g]);for(g in q.vectors3Arrays)Q.setArray3(g,q.vectors3Arrays[g]);for(g in q.vectors4Arrays)Q.setArray4(g,q.vectors4Arrays[g]);for(g in q.quaternionsArrays)Q.setArray4(g,q.quaternionsArrays[g]);return Q}static async ParseFromFileAsync(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return await new Promise(((Q,s)=>{const g=new D.d;g.addEventListener("readystatechange",(()=>{if(4==g.readyState)if(200==g.status){const c=JSON.parse(g.responseText),s=this.Parse(c,U||K.c.LastCreatedScene,J);q&&(s.name=q),Q(s)}else s("Unable to load the ShaderMaterial")})),g.open("GET",c),g.send()}))}static async ParseFromSnippetAsync(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return await new Promise(((J,Q)=>{const s=new D.d;s.addEventListener("readystatechange",(()=>{if(4==s.readyState)if(200==s.status){const Q=JSON.parse(JSON.parse(s.responseText).jsonPayload),g=JSON.parse(Q.shaderMaterial),X=this.Parse(g,c||K.c.LastCreatedScene,U);X.snippetId=q,J(X)}else Q("Unable to load the snippet "+q)})),s.open("GET",this.SnippetUrl+"/"+q.replace(/#/g,"/")),s.send()}))}}h.SnippetUrl="https://snippet.babylonjs.com",h.CreateFromSnippetAsync=h.ParseFromSnippetAsync,(0,n.f)("BABYLON.ShaderMaterial",h)},11463:(q,c,U)=>{U.d(c,{b:()=>F});var J=U(11010),Q=U(11019),s=U(11156),g=U(11364),X=U(11093),n=U(11031),W=U(11422),D=U(11373),u=U(11004),K=U(11416),r=U(11429),H=U(11288),b=U(10850),h=U(11434),o=U(11454),a=U(11458),p=U(11104),R=U(11095),I=U(11082),t=U(11460);const C={effect:null,subMesh:null};class i extends K.d{constructor(q){super(q),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_POSITION=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.MORPHTARGETS_UV2=!1,this.MORPHTARGETS_COLOR=!1,this.MORPHTARGETTEXTURE_HASPOSITIONS=!1,this.MORPHTARGETTEXTURE_HASNORMALS=!1,this.MORPHTARGETTEXTURE_HASTANGENTS=!1,this.MORPHTARGETTEXTURE_HASUVS=!1,this.MORPHTARGETTEXTURE_HASUV2S=!1,this.MORPHTARGETTEXTURE_HASCOLORS=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMALIZED_VIEW_DEPTH=!1,this.PREPASS_NORMALIZED_VIEW_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.AREALIGHTSUPPORTED=!0,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(q){const c=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const U of c)this[U]=U===q}}class F extends r.d{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(q){this._attachImageProcessingConfiguration(q),this._markAllSubMeshesAsImageProcessingDirty()}_attachImageProcessingConfiguration(q){q!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=q||this.Cq().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(q){this.imageProcessingConfiguration.colorCurvesEnabled=q}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(q){this.imageProcessingConfiguration.colorGradingEnabled=q}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(q){this._imageProcessingConfiguration.toneMappingEnabled=q}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(q){this._imageProcessingConfiguration.exposure=q}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(q){this._imageProcessingConfiguration.contrast=q}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(q){this._imageProcessingConfiguration.colorGradingTexture=q}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(q){this._imageProcessingConfiguration.colorCurves=q}get canRenderToMRT(){return!0}constructor(q,c){super(q,c,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||F.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new X.c(0,0,0),this.diffuseColor=new X.c(1,1,1),this.specularColor=new X.c(1,1,1),this.emissiveColor=new X.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new s.g(16),this._globalAmbientColor=new X.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new a.b(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new W.e,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),F.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),F.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(F.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(F.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"ec"}needAlphaBlending(){return this._hasTransparencyMode?this._transparencyModeIsBlend:!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return this._hasTransparencyMode?this._transparencyModeIsTest:this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===u.b.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.Hc&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==u.b.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.Hc||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(q,c){let J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const Q=c._drawWrapper;if(Q.effect&&this.isFrozen&&Q._wasPreviouslyReady&&Q._wasPreviouslyUsingInstances===J)return!0;c.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),c.materialDefines=new i(this._eventInfo.defineNames));const s=this.Cq(),g=c.materialDefines;if(this._isReadyForSubMesh(c))return!0;const X=s.getEngine();g._needNormals=(0,R.N)(s,q,g,!0,this._maxSimultaneousLights,this._disableLighting),(0,R.T)(s,g);const u=this.needAlphaBlendingForMesh(q)&&this.Cq().useOrderIndependentTransparency;if((0,R.Y)(s,g,this.canRenderToMRT&&!u),(0,R.W)(s,g,u),t.e.PrepareDefines(X.currentRenderPassId,q,g),g._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,g._needUVs=!1;for(let q=1;q<=6;++q)g["MAINUV"+q]=!1;if(s.texturesEnabled){if(g.DIFFUSEDIRECTUV=0,g.BUMPDIRECTUV=0,g.AMBIENTDIRECTUV=0,g.OPACITYDIRECTUV=0,g.EMISSIVEDIRECTUV=0,g.SPECULARDIRECTUV=0,g.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&F.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,R.R)(this._diffuseTexture,g,"DIFFUSE")}else g.DIFFUSE=!1;if(this._ambientTexture&&F.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,R.R)(this._ambientTexture,g,"AMBIENT")}else g.AMBIENT=!1;if(this._opacityTexture&&F.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,R.R)(this._opacityTexture,g,"OPACITY"),g.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else g.OPACITY=!1;if(this._reflectionTexture&&F.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(g._needNormals=!0,g.REFLECTION=!0,g.ROUGHNESS=this._roughness>0,g.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,g.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===H.c.INVCUBIC_MODE,g.REFLECTIONMAP_3D=this._reflectionTexture.isCube,g.REFLECTIONMAP_OPPOSITEZ=g.REFLECTIONMAP_3D&&this.Cq().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,g.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case H.c.EXPLICIT_MODE:g.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case H.c.PLANAR_MODE:g.setReflectionMode("REFLECTIONMAP_PLANAR");break;case H.c.PROJECTION_MODE:g.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case H.c.SKYBOX_MODE:g.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case H.c.SPHERICAL_MODE:g.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case H.c.EQUIRECTANGULAR_MODE:g.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case H.c.FIXED_EQUIRECTANGULAR_MODE:g.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case H.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:g.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case H.c.CUBIC_MODE:case H.c.INVCUBIC_MODE:default:g.setReflectionMode("REFLECTIONMAP_CUBIC")}g.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else g.REFLECTION=!1,g.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&F.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,R.R)(this._emissiveTexture,g,"EMISSIVE")}else g.EMISSIVE=!1;if(this._lightmapTexture&&F.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,R.R)(this._lightmapTexture,g,"LIGHTMAP"),g.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,g.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else g.LIGHTMAP=!1;if(this._specularTexture&&F.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,R.R)(this._specularTexture,g,"SPECULAR"),g.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else g.SPECULAR=!1;if(s.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&F.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,R.R)(this._bumpTexture,g,"BUMP"),g.PARALLAX=this._useParallax,g.PARALLAX_RHS=s.useRightHandedSystem,g.PARALLAXOCCLUSION=this._useParallaxOcclusion,g.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else g.BUMP=!1,g.PARALLAX=!1,g.PARALLAX_RHS=!1,g.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&F.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;g._needUVs=!0,g.REFRACTION=!0,g.REFRACTIONMAP_3D=this._refractionTexture.isCube,g.RGBDREFRACTION=this._refractionTexture.isRGBD,g.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else g.REFRACTION=!1;g.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else g.DIFFUSE=!1,g.AMBIENT=!1,g.OPACITY=!1,g.REFLECTION=!1,g.EMISSIVE=!1,g.LIGHTMAP=!1,g.BUMP=!1,g.REFRACTION=!1;g.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),g.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,g.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,g.SPECULAROVERALPHA=this._useSpecularOverAlpha,g.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,g.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,g.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(q)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=g,this._eventInfo.subMesh=c,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(g._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(g),g.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,g.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}if(g._areFresnelDirty&&(F.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(g.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,g.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,g.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,g.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,g.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,g.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,g._needNormals=!0,g.FRESNEL=!0):g.FRESNEL=!1),g.AREALIGHTUSED)for(let U=0;U<q.lightSources.length;U++)if(!q.lightSources[U]._isReady())return!1;(0,R.S)(q,s,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this.needAlphaTestingForMesh(q),g,this._applyDecalMapAfterDetailMap),(0,R.K)(s,X,this,g,J,null,c.getRenderingMesh().hasThinInstances),this._eventInfo.defines=g,this._eventInfo.mesh=q,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,R.H)(q,g,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let K=!1;if(g.isDirty){const J=g._areLightsDisposed;g.markAsProcessed();const Q=new o.b;g.REFLECTION&&Q.addFallback(0,"REFLECTION"),g.SPECULAR&&Q.addFallback(0,"SPECULAR"),g.BUMP&&Q.addFallback(0,"BUMP"),g.PARALLAX&&Q.addFallback(1,"PARALLAX"),g.PARALLAX_RHS&&Q.addFallback(1,"PARALLAX_RHS"),g.PARALLAXOCCLUSION&&Q.addFallback(0,"PARALLAXOCCLUSION"),g.SPECULAROVERALPHA&&Q.addFallback(0,"SPECULAROVERALPHA"),g.FOG&&Q.addFallback(1,"FOG"),g.POINTSIZE&&Q.addFallback(0,"POINTSIZE"),g.LOGARITHMICDEPTH&&Q.addFallback(0,"LOGARITHMICDEPTH"),(0,R.u)(g,Q,this._maxSimultaneousLights),g.SPECULARTERM&&Q.addFallback(0,"SPECULARTERM"),g.DIFFUSEFRESNEL&&Q.addFallback(1,"DIFFUSEFRESNEL"),g.OPACITYFRESNEL&&Q.addFallback(2,"OPACITYFRESNEL"),g.REFLECTIONFRESNEL&&Q.addFallback(3,"REFLECTIONFRESNEL"),g.EMISSIVEFRESNEL&&Q.addFallback(4,"EMISSIVEFRESNEL"),g.FRESNEL&&Q.addFallback(4,"FRESNEL"),g.MULTIVIEW&&Q.addFallback(0,"MULTIVIEW");const u=[n.h.PositionKind];g.NORMAL&&u.push(n.h.NormalKind),g.TANGENT&&u.push(n.h.TangentKind);for(let q=1;q<=6;++q)g["UV"+q]&&u.push(`uv${1===q?"":q}`);g.VERTEXCOLOR&&u.push(n.h.ColorKind),(0,R.z)(u,q,g,Q),(0,R.C)(u,g),(0,R.D)(u,q,g),(0,R.v)(u,q,g);let r="default";const H=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices","cameraInfo"],b=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler","areaLightsLTC1Sampler","areaLightsLTC2Sampler"],h=["Material","Scene","Mesh"],a={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:g.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=Q,this._eventInfo.fallbackRank=0,this._eventInfo.defines=g,this._eventInfo.uniforms=H,this._eventInfo.attributes=u,this._eventInfo.samplers=b,this._eventInfo.uniformBuffersNames=h,this._eventInfo.customCode=void 0,this._eventInfo.mesh=q,this._eventInfo.indexParameters=a,this._callbackPluginEventGeneric(128,this._eventInfo),t.e.AddUniformsAndSamplers(H,b),W.e.AddUniforms(H),W.e.AddSamplers(b),D.b&&(D.b.PrepareUniforms(H,g),D.b.PrepareSamplers(b,g)),(0,R._)({uniformsNames:H,uniformBuffersNames:h,samplers:b,defines:g,maxSimultaneousLights:this._maxSimultaneousLights}),(0,p.b)(H);const I={};this.customShaderNameResolve&&(r=this.customShaderNameResolve(r,H,h,b,g,u,I));const i=g.toString(),F=c.effect;let v=s.getEngine().createEffect(r,{attributes:u,uniformsNames:H,uniformBuffersNames:h,samplers:b,defines:i,fallbacks:Q,onCompiled:this.onCompiled,onError:this.onError,indexParameters:a,processFinalCode:I.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:g.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([U.e(20),U.e(51)]).then(U.bind(U,13959)),Promise.all([U.e(18),U.e(52)]).then(U.bind(U,13976))]):await Promise.all([Promise.all([U.e(13),U.e(53)]).then(U.bind(U,13981)),Promise.all([U.e(12),U.e(54)]).then(U.bind(U,13995))]),this._shadersLoaded=!0}},X);if(this._eventInfo.customCode=void 0,v)if(this._onEffectCreatedObservable&&(C.effect=v,C.subMesh=c,this._onEffectCreatedObservable.notifyObservers(C)),this.allowShaderHotSwapping&&F&&!v.isReady()){if(v=F,g.markAsUnprocessed(),K=this.isFrozen,J)return g._areLightsDisposed=!0,!1}else s.resetCachedMaterial(),c.setEffect(v,g,this._materialContext)}return!(!c.effect||!c.effect.isReady())&&(g._renderId=s.getRenderId(),Q._wasPreviouslyReady=!K,Q._wasPreviouslyUsingInstances=J,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const q=this._uniformBuffer;q.addUniform("diffuseLeftColor",4),q.addUniform("diffuseRightColor",4),q.addUniform("opacityParts",4),q.addUniform("reflectionLeftColor",4),q.addUniform("reflectionRightColor",4),q.addUniform("refractionLeftColor",4),q.addUniform("refractionRightColor",4),q.addUniform("emissiveLeftColor",4),q.addUniform("emissiveRightColor",4),q.addUniform("vDiffuseInfos",2),q.addUniform("vAmbientInfos",2),q.addUniform("vOpacityInfos",2),q.addUniform("vReflectionInfos",2),q.addUniform("vReflectionPosition",3),q.addUniform("vReflectionSize",3),q.addUniform("vEmissiveInfos",2),q.addUniform("vLightmapInfos",2),q.addUniform("vSpecularInfos",2),q.addUniform("vBumpInfos",3),q.addUniform("diffuseMatrix",16),q.addUniform("ambientMatrix",16),q.addUniform("opacityMatrix",16),q.addUniform("reflectionMatrix",16),q.addUniform("emissiveMatrix",16),q.addUniform("lightmapMatrix",16),q.addUniform("specularMatrix",16),q.addUniform("bumpMatrix",16),q.addUniform("vTangentSpaceParams",2),q.addUniform("pointSize",1),q.addUniform("alphaCutOff",1),q.addUniform("refractionMatrix",16),q.addUniform("vRefractionInfos",4),q.addUniform("vRefractionPosition",3),q.addUniform("vRefractionSize",3),q.addUniform("vSpecularColor",4),q.addUniform("vEmissiveColor",3),q.addUniform("vDiffuseColor",4),q.addUniform("vAmbientColor",3),q.addUniform("cameraInfo",4),super.buildUniformLayout()}bindForSubMesh(q,c,U){const J=this.Cq(),Q=U.materialDefines;if(!Q)return;const s=U.effect;if(!s)return;this._activeEffect=s,c.getMeshUniformBuffer().bindToEffect(s,"Mesh"),c.transferToEffect(q),this._uniformBuffer.bindToEffect(s,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,J,c,q,this.isFrozen),t.e.Bind(J.getEngine().currentRenderPassId,this._activeEffect,c,q,this);const n=J.activeCamera;n?this._uniformBuffer.updateFloat4("cameraInfo",n.Oc,n.maxZ,0,0):this._uniformBuffer.updateFloat4("cameraInfo",0,0,0,0),this._eventInfo.subMesh=U,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),Q.OBJECTSPACE_NORMALMAP&&(q.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const W=this._mustRebind(J,s,U,c.visibility);(0,R.c)(c,s);const D=this._uniformBuffer;if(W){if(this.bindViewProjection(s),!D.useUbo||!this.isFrozen||!D.isSync||U._drawWrapper._forceRebindOnNextCall){if(F.FresnelEnabled&&Q.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(D.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),D.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&D.updateColor4("opacityParts",new X.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(D.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),D.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(D.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),D.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(D.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),D.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),J.texturesEnabled){if(this._diffuseTexture&&F.DiffuseTextureEnabled&&(D.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,R.s)(this._diffuseTexture,D,"diffuse")),this._ambientTexture&&F.AmbientTextureEnabled&&(D.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,R.s)(this._ambientTexture,D,"ambient")),this._opacityTexture&&F.OpacityTextureEnabled&&(D.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,R.s)(this._opacityTexture,D,"opacity")),this._hasAlphaChannel()&&D.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&F.ReflectionTextureEnabled){if(D.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),D.vc("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize){const q=this._reflectionTexture;D.updateVector3("vReflectionPosition",q.boundingBoxPosition),D.updateVector3("vReflectionSize",q.boundingBoxSize)}}else D.updateFloat2("vReflectionInfos",0,this.roughness);if(this._emissiveTexture&&F.EmissiveTextureEnabled&&(D.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,R.s)(this._emissiveTexture,D,"emissive")),this._lightmapTexture&&F.LightmapTextureEnabled&&(D.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,R.s)(this._lightmapTexture,D,"lightmap")),this._specularTexture&&F.SpecularTextureEnabled&&(D.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,R.s)(this._specularTexture,D,"specular")),this._bumpTexture&&J.getEngine().getCaps().standardDerivatives&&F.BumpTextureEnabled&&(D.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,R.s)(this._bumpTexture,D,"bump"),J._mirroredCameraPosition?D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&F.RefractionTextureEnabled){let q=1;if(this._refractionTexture.isCube||(D.vc("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(q=this._refractionTexture.depth)),D.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,q,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const q=this._refractionTexture;D.updateVector3("vRefractionPosition",q.boundingBoxPosition),D.updateVector3("vRefractionSize",q.boundingBoxSize)}}}this.pointsCloud&&D.updateFloat("pointSize",this.pointSize),D.updateColor4("vSpecularColor",this.specularColor,this.specularPower),D.updateColor3("vEmissiveColor",F.EmissiveTextureEnabled?this.emissiveColor:X.c.BlackReadOnly),D.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),J.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),D.updateColor3("vAmbientColor",this._globalAmbientColor)}J.texturesEnabled&&(this._diffuseTexture&&F.DiffuseTextureEnabled&&s.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&F.AmbientTextureEnabled&&s.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&F.OpacityTextureEnabled&&s.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&F.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?s.setTexture("reflectionCubeSampler",this._reflectionTexture):s.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&F.EmissiveTextureEnabled&&s.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&F.LightmapTextureEnabled&&s.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&F.SpecularTextureEnabled&&s.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&J.getEngine().getCaps().standardDerivatives&&F.BumpTextureEnabled&&s.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&F.RefractionTextureEnabled&&(this._refractionTexture.isCube?s.setTexture("refractionCubeSampler",this._refractionTexture):s.setTexture("refraction2DSampler",this._refractionTexture))),this.Cq().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(c)&&this.Cq().depthPeelingRenderer.bind(s),this._eventInfo.subMesh=U,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,p.c)(s,this,J),this.bindEyePosition(s)}else J.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(W||!this.isFrozen){var u;if(J.lightsEnabled&&!this._disableLighting&&(0,R.i)(J,c,s,Q,this._maxSimultaneousLights),(J.fogEnabled&&c.applyFog&&J.fogMode!==g.b.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||c.receiveShadows||Q.PREPASS)&&this.bindView(s),(0,R.f)(J,c,s),Q.NUM_MORPH_INFLUENCERS&&(0,R.n)(c,s),Q.BAKED_VERTEX_ANIMATION_TEXTURE)null===(u=c.bakedVertexAnimationManager)||void 0===u||u.bind(s,Q.INSTANCES);this.useLogarithmicDepth&&(0,R.m)(Q,s,J),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(c,this._activeEffect,U),D.update()}getAnimatables(){const q=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&q.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&q.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&q.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&q.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&q.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&q.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&q.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&q.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&q.push(this._refractionTexture),q}getActiveTextures(){const q=super.getActiveTextures();return this._diffuseTexture&&q.push(this._diffuseTexture),this._ambientTexture&&q.push(this._ambientTexture),this._opacityTexture&&q.push(this._opacityTexture),this._reflectionTexture&&q.push(this._reflectionTexture),this._emissiveTexture&&q.push(this._emissiveTexture),this._specularTexture&&q.push(this._specularTexture),this._bumpTexture&&q.push(this._bumpTexture),this._lightmapTexture&&q.push(this._lightmapTexture),this._refractionTexture&&q.push(this._refractionTexture),q}hasTexture(q){return!!super.hasTexture(q)||(this._diffuseTexture===q||(this._ambientTexture===q||(this._opacityTexture===q||(this._reflectionTexture===q||(this._emissiveTexture===q||(this._specularTexture===q||(this._bumpTexture===q||(this._lightmapTexture===q||this._refractionTexture===q))))))))}dispose(q,c){var U,J,Q,s,g,X,n,W,D;c&&(null===(U=this._diffuseTexture)||void 0===U||U.dispose(),null===(J=this._ambientTexture)||void 0===J||J.dispose(),null===(Q=this._opacityTexture)||void 0===Q||Q.dispose(),null===(s=this._reflectionTexture)||void 0===s||s.dispose(),null===(g=this._emissiveTexture)||void 0===g||g.dispose(),null===(X=this._specularTexture)||void 0===X||X.dispose(),null===(n=this._bumpTexture)||void 0===n||n.dispose(),null===(W=this._lightmapTexture)||void 0===W||W.dispose(),null===(D=this._refractionTexture)||void 0===D||D.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(q,c)}clone(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const J=I.e.Clone((()=>new F(q,this.Cq())),this,{cloneTexturesOnlyOnce:c});return J.name=q,J.id=q,this.stencil.copyTo(J.stencil),this._clonePlugins(J,U),J}static Parse(q,c,U){const J=I.e.Parse((()=>new F(q.name,c)),q,c,U);return q.stencil&&J.stencil.parse(q.stencil,c,U),u.b._ParsePlugins(q,J,c,U),J}static get DiffuseTextureEnabled(){return h.c.DiffuseTextureEnabled}static set DiffuseTextureEnabled(q){h.c.DiffuseTextureEnabled=q}static get DetailTextureEnabled(){return h.c.DetailTextureEnabled}static set DetailTextureEnabled(q){h.c.DetailTextureEnabled=q}static get AmbientTextureEnabled(){return h.c.AmbientTextureEnabled}static set AmbientTextureEnabled(q){h.c.AmbientTextureEnabled=q}static get OpacityTextureEnabled(){return h.c.OpacityTextureEnabled}static set OpacityTextureEnabled(q){h.c.OpacityTextureEnabled=q}static get ReflectionTextureEnabled(){return h.c.ReflectionTextureEnabled}static set ReflectionTextureEnabled(q){h.c.ReflectionTextureEnabled=q}static get EmissiveTextureEnabled(){return h.c.EmissiveTextureEnabled}static set EmissiveTextureEnabled(q){h.c.EmissiveTextureEnabled=q}static get SpecularTextureEnabled(){return h.c.SpecularTextureEnabled}static set SpecularTextureEnabled(q){h.c.SpecularTextureEnabled=q}static get BumpTextureEnabled(){return h.c.BumpTextureEnabled}static set BumpTextureEnabled(q){h.c.BumpTextureEnabled=q}static get LightmapTextureEnabled(){return h.c.LightmapTextureEnabled}static set LightmapTextureEnabled(q){h.c.LightmapTextureEnabled=q}static get RefractionTextureEnabled(){return h.c.RefractionTextureEnabled}static set RefractionTextureEnabled(q){h.c.RefractionTextureEnabled=q}static get ColorGradingTextureEnabled(){return h.c.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(q){h.c.ColorGradingTextureEnabled=q}static get FresnelEnabled(){return h.c.FresnelEnabled}static set FresnelEnabled(q){h.c.FresnelEnabled=q}}F.ForceGLSL=!1,(0,J.d)([(0,Q.D)("diffuseTexture")],F.prototype,"_diffuseTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],F.prototype,"diffuseTexture",void 0),(0,J.d)([(0,Q.D)("ambientTexture")],F.prototype,"_ambientTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"ambientTexture",void 0),(0,J.d)([(0,Q.D)("opacityTexture")],F.prototype,"_opacityTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],F.prototype,"opacityTexture",void 0),(0,J.d)([(0,Q.D)("reflectionTexture")],F.prototype,"_reflectionTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"reflectionTexture",void 0),(0,J.d)([(0,Q.D)("emissiveTexture")],F.prototype,"_emissiveTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"emissiveTexture",void 0),(0,J.d)([(0,Q.D)("specularTexture")],F.prototype,"_specularTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"specularTexture",void 0),(0,J.d)([(0,Q.D)("bumpTexture")],F.prototype,"_bumpTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"bumpTexture",void 0),(0,J.d)([(0,Q.D)("lightmapTexture")],F.prototype,"_lightmapTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"lightmapTexture",void 0),(0,J.d)([(0,Q.D)("refractionTexture")],F.prototype,"_refractionTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"refractionTexture",void 0),(0,J.d)([(0,Q.j)("ambient")],F.prototype,"ambientColor",void 0),(0,J.d)([(0,Q.j)("diffuse")],F.prototype,"diffuseColor",void 0),(0,J.d)([(0,Q.j)("specular")],F.prototype,"specularColor",void 0),(0,J.d)([(0,Q.j)("emissive")],F.prototype,"emissiveColor",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"specularPower",void 0),(0,J.d)([(0,Q.N)("useAlphaFromDiffuseTexture")],F.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],F.prototype,"useAlphaFromDiffuseTexture",void 0),(0,J.d)([(0,Q.N)("useEmissiveAsIllumination")],F.prototype,"_useEmissiveAsIllumination",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useEmissiveAsIllumination",void 0),(0,J.d)([(0,Q.N)("linkEmissiveWithDiffuse")],F.prototype,"_linkEmissiveWithDiffuse",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"linkEmissiveWithDiffuse",void 0),(0,J.d)([(0,Q.N)("useSpecularOverAlpha")],F.prototype,"_useSpecularOverAlpha",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useSpecularOverAlpha",void 0),(0,J.d)([(0,Q.N)("useReflectionOverAlpha")],F.prototype,"_useReflectionOverAlpha",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useReflectionOverAlpha",void 0),(0,J.d)([(0,Q.N)("disableLighting")],F.prototype,"_disableLighting",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsLightsDirty")],F.prototype,"disableLighting",void 0),(0,J.d)([(0,Q.N)("useObjectSpaceNormalMap")],F.prototype,"_useObjectSpaceNormalMap",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useObjectSpaceNormalMap",void 0),(0,J.d)([(0,Q.N)("useParallax")],F.prototype,"_useParallax",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useParallax",void 0),(0,J.d)([(0,Q.N)("useParallaxOcclusion")],F.prototype,"_useParallaxOcclusion",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useParallaxOcclusion",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"parallaxScaleBias",void 0),(0,J.d)([(0,Q.N)("roughness")],F.prototype,"_roughness",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"roughness",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"indexOfRefraction",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"invertRefractionY",void 0),(0,J.d)([(0,Q.N)()],F.prototype,"alphaCutOff",void 0),(0,J.d)([(0,Q.N)("useLightmapAsShadowmap")],F.prototype,"_useLightmapAsShadowmap",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useLightmapAsShadowmap",void 0),(0,J.d)([(0,Q.q)("diffuseFresnelParameters")],F.prototype,"_diffuseFresnelParameters",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsFresnelDirty")],F.prototype,"diffuseFresnelParameters",void 0),(0,J.d)([(0,Q.q)("opacityFresnelParameters")],F.prototype,"_opacityFresnelParameters",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsFresnelAndMiscDirty")],F.prototype,"opacityFresnelParameters",void 0),(0,J.d)([(0,Q.q)("reflectionFresnelParameters")],F.prototype,"_reflectionFresnelParameters",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsFresnelDirty")],F.prototype,"reflectionFresnelParameters",void 0),(0,J.d)([(0,Q.q)("refractionFresnelParameters")],F.prototype,"_refractionFresnelParameters",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsFresnelDirty")],F.prototype,"refractionFresnelParameters",void 0),(0,J.d)([(0,Q.q)("emissiveFresnelParameters")],F.prototype,"_emissiveFresnelParameters",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsFresnelDirty")],F.prototype,"emissiveFresnelParameters",void 0),(0,J.d)([(0,Q.N)("useReflectionFresnelFromSpecular")],F.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsFresnelDirty")],F.prototype,"useReflectionFresnelFromSpecular",void 0),(0,J.d)([(0,Q.N)("useGlossinessFromSpecularMapAlpha")],F.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,J.d)([(0,Q.N)("maxSimultaneousLights")],F.prototype,"_maxSimultaneousLights",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsLightsDirty")],F.prototype,"maxSimultaneousLights",void 0),(0,J.d)([(0,Q.N)("invertNormalMapX")],F.prototype,"_invertNormalMapX",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"invertNormalMapX",void 0),(0,J.d)([(0,Q.N)("invertNormalMapY")],F.prototype,"_invertNormalMapY",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"invertNormalMapY",void 0),(0,J.d)([(0,Q.N)("twoSidedLighting")],F.prototype,"_twoSidedLighting",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsTexturesDirty")],F.prototype,"twoSidedLighting",void 0),(0,J.d)([(0,Q.N)("applyDecalMapAfterDetailMap")],F.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,J.d)([(0,Q.c)("_markAllSubMeshesAsMiscDirty")],F.prototype,"applyDecalMapAfterDetailMap",void 0),(0,b.f)("BABYLON.StandardMaterial",F),g.b.DefaultMaterialFactory=q=>new F("default material",q)},11075:(q,c,U)=>{U.d(c,{d:()=>s});var J=U(10886),Q=U(10879);class s{constructor(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=q,this._noUBO=!q.supportsUniformBuffers||Q,this._dynamic=U,this._name=J??"no-name",this._data=c||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.vc=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.vc=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(q){let c;if(c=q<=2?q:4,this._uniformLocationPointer%c!==0){const q=this._uniformLocationPointer;this._uniformLocationPointer+=c-this._uniformLocationPointer%c;const U=this._uniformLocationPointer-q;for(let c=0;c<U;c++)this._data.push(0)}}addUniform(q,c){let U,J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[q]){if(J>0){if(c instanceof Array)throw"addUniform should not be use with Array in UBO: "+q;if(this._fillAlignment(4),this._uniformArraySizes[q]={strideSize:c,arraySize:J},16==c)c*=J;else{c=c*J+(4-c)*J}U=[];for(let q=0;q<c;q++)U.push(0)}else{if(c instanceof Array)U=c,c=U.length;else{U=[];for(let q=0;q<c;q++)U.push(0)}this._fillAlignment(c)}this._uniformSizes[q]=c,this._uniformLocations[q]=this._uniformLocationPointer,this._uniformLocationPointer+=c;for(let q=0;q<c;q++)this._data.push(U[q]);this._needSync=!0}}addMatrix(q,c){this.addUniform(q,Array.prototype.slice.call(c.rc()))}addFloat2(q,c,U){const J=[c,U];this.addUniform(q,J)}addFloat3(q,c,U,J){const Q=[c,U,J];this.addUniform(q,Q)}addColor3(q,c){const U=[c.r,c.g,c.b];this.addUniform(q,U)}addColor4(q,c,U){const J=[c.r,c.g,c.b,U];this.addUniform(q,J)}addVector3(q,c){const U=[c.x,c.y,c.z];this.addUniform(q,U)}addMatrix3x3(q){this.addUniform(q,12)}addMatrix2x2(q){this.addUniform(q,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const q=[];let c=0;for(const U in this._uniformLocations)if(q.push(U),10===++c)break;return q.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(q,c){for(let U=0;U<q.length;++U)if(q[U]!==c[U])return!1;return!0}_copyBuffer(q,c){for(let U=0;U<q.length;++U)c[U]=q[U]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(s._UpdatedUbosInFrame[this._name]||(s._UpdatedUbosInFrame[this._name]=0),s._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(q,c,U){this._checkNewFrame();let Q=this._uniformLocations[q];if(void 0===Q){if(this._buffer)return void J.c.Error("Cannot add an uniform after UBO has been created. uniformName="+q);this.addUniform(q,U),Q=this._uniformLocations[q]}if(this._buffer||this.create(),this._dynamic)for(let J=0;J<U;J++)this._bufferData[Q+J]=c[J];else{let q=!1;for(let J=0;J<U;J++)(16===U&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[Q+J]!==Math.fround(c[J]))&&(q=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[Q+J]=c[J]);this._needSync=this._needSync||q}}updateUniformArray(q,c,U){this._checkNewFrame();const s=this._uniformLocations[q];if(void 0===s)return void J.c.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const g=this._uniformArraySizes[q];if(this._dynamic)for(let J=0;J<U;J++)this._bufferData[s+J]=c[J];else{let q=!1,J=0,X=0;for(let n=0;n<U;n++)if(this._bufferData[s+4*X+J]!==Q.e.FloatRound(c[n])&&(q=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[s+4*X+J]=c[n]),J++,J===g.strideSize){for(;J<4;J++)this._bufferData[s+4*X+J]=0;J=0,X++}this._needSync=this._needSync||q}}_cacheMatrix(q,c){this._checkNewFrame();const U=this._valueCache[q],J=c.updateFlag;return(void 0===U||U!==J)&&(this._valueCache[q]=J,!0)}_updateMatrix3x3ForUniform(q,c){for(let U=0;U<3;U++)s._TempBuffer[4*U]=c[3*U],s._TempBuffer[4*U+1]=c[3*U+1],s._TempBuffer[4*U+2]=c[3*U+2],s._TempBuffer[4*U+3]=0;this.updateUniform(q,s._TempBuffer,12)}_updateMatrix3x3ForEffect(q,c){this._currentEffect.setMatrix3x3(q,c)}_updateMatrix2x2ForEffect(q,c){this._currentEffect.setMatrix2x2(q,c)}_updateMatrix2x2ForUniform(q,c){for(let U=0;U<2;U++)s._TempBuffer[4*U]=c[2*U],s._TempBuffer[4*U+1]=c[2*U+1],s._TempBuffer[4*U+2]=0,s._TempBuffer[4*U+3]=0;this.updateUniform(q,s._TempBuffer,8)}_updateFloatForEffect(q,c){this._currentEffect.setFloat(q,c)}_updateFloatForUniform(q,c){s._TempBuffer[0]=c,this.updateUniform(q,s._TempBuffer,1)}_updateFloat2ForEffect(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(q+J,c,U)}_updateFloat2ForUniform(q,c,U){s._TempBuffer[0]=c,s._TempBuffer[1]=U,this.updateUniform(q,s._TempBuffer,2)}_updateFloat3ForEffect(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(q+Q,c,U,J)}_updateFloat3ForUniform(q,c,U,J){s._TempBuffer[0]=c,s._TempBuffer[1]=U,s._TempBuffer[2]=J,this.updateUniform(q,s._TempBuffer,3)}_updateFloat4ForEffect(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(q+s,c,U,J,Q)}_updateFloat4ForUniform(q,c,U,J,Q){s._TempBuffer[0]=c,s._TempBuffer[1]=U,s._TempBuffer[2]=J,s._TempBuffer[3]=Q,this.updateUniform(q,s._TempBuffer,4)}_updateFloatArrayForEffect(q,c){this._currentEffect.setFloatArray(q,c)}_updateFloatArrayForUniform(q,c){this.updateUniformArray(q,c,c.length)}_updateArrayForEffect(q,c){this._currentEffect.setArray(q,c)}_updateArrayForUniform(q,c){this.updateUniformArray(q,c,c.length)}_updateIntArrayForEffect(q,c){this._currentEffect.setIntArray(q,c)}_updateIntArrayForUniform(q,c){s._TempBufferInt32View.set(c),this.updateUniformArray(q,s._TempBuffer,c.length)}_updateUIntArrayForEffect(q,c){this._currentEffect.setUIntArray(q,c)}_updateUIntArrayForUniform(q,c){s._TempBufferUInt32View.set(c),this.updateUniformArray(q,s._TempBuffer,c.length)}_updateMatrixForEffect(q,c){this._currentEffect.setMatrix(q,c)}_updateMatrixForUniform(q,c){this._cacheMatrix(q,c)&&this.updateUniform(q,c.rc(),16)}_updateMatricesForEffect(q,c){this._currentEffect.setMatrices(q,c)}_updateMatricesForUniform(q,c){this.updateUniform(q,c,c.length)}_updateVector3ForEffect(q,c){this._currentEffect.setVector3(q,c)}_updateVector3ForUniform(q,c){s._TempBuffer[0]=c.x,s._TempBuffer[1]=c.y,s._TempBuffer[2]=c.z,this.updateUniform(q,s._TempBuffer,3)}_updateVector4ForEffect(q,c){this._currentEffect.setVector4(q,c)}_updateVector4ForUniform(q,c){s._TempBuffer[0]=c.x,s._TempBuffer[1]=c.y,s._TempBuffer[2]=c.z,s._TempBuffer[3]=c.w,this.updateUniform(q,s._TempBuffer,4)}_updateColor3ForEffect(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(q+U,c)}_updateColor3ForUniform(q,c){s._TempBuffer[0]=c.r,s._TempBuffer[1]=c.g,s._TempBuffer[2]=c.b,this.updateUniform(q,s._TempBuffer,3)}_updateColor4ForEffect(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(q+J,c,U)}_updateDirectColor4ForEffect(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(q+U,c)}_updateColor4ForUniform(q,c,U){s._TempBuffer[0]=c.r,s._TempBuffer[1]=c.g,s._TempBuffer[2]=c.b,s._TempBuffer[3]=U,this.updateUniform(q,s._TempBuffer,4)}_updateDirectColor4ForUniform(q,c){s._TempBuffer[0]=c.r,s._TempBuffer[1]=c.g,s._TempBuffer[2]=c.b,s._TempBuffer[3]=c.a,this.updateUniform(q,s._TempBuffer,4)}_updateIntForEffect(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(q+U,c)}_updateIntForUniform(q,c){s._TempBufferInt32View[0]=c,this.updateUniform(q,s._TempBuffer,1)}_updateInt2ForEffect(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(q+J,c,U)}_updateInt2ForUniform(q,c,U){s._TempBufferInt32View[0]=c,s._TempBufferInt32View[1]=U,this.updateUniform(q,s._TempBuffer,2)}_updateInt3ForEffect(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(q+Q,c,U,J)}_updateInt3ForUniform(q,c,U,J){s._TempBufferInt32View[0]=c,s._TempBufferInt32View[1]=U,s._TempBufferInt32View[2]=J,this.updateUniform(q,s._TempBuffer,3)}_updateInt4ForEffect(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(q+s,c,U,J,Q)}_updateInt4ForUniform(q,c,U,J,Q){s._TempBufferInt32View[0]=c,s._TempBufferInt32View[1]=U,s._TempBufferInt32View[2]=J,s._TempBufferInt32View[3]=Q,this.updateUniform(q,s._TempBuffer,4)}_updateUIntForEffect(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(q+U,c)}_updateUIntForUniform(q,c){s._TempBufferUInt32View[0]=c,this.updateUniform(q,s._TempBuffer,1)}_updateUInt2ForEffect(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(q+J,c,U)}_updateUInt2ForUniform(q,c,U){s._TempBufferUInt32View[0]=c,s._TempBufferUInt32View[1]=U,this.updateUniform(q,s._TempBuffer,2)}_updateUInt3ForEffect(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(q+Q,c,U,J)}_updateUInt3ForUniform(q,c,U,J){s._TempBufferUInt32View[0]=c,s._TempBufferUInt32View[1]=U,s._TempBufferUInt32View[2]=J,this.updateUniform(q,s._TempBuffer,3)}_updateUInt4ForEffect(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(q+s,c,U,J,Q)}_updateUInt4ForUniform(q,c,U,J,Q){s._TempBufferUInt32View[0]=c,s._TempBufferUInt32View[1]=U,s._TempBufferUInt32View[2]=J,s._TempBufferUInt32View[3]=Q,this.updateUniform(q,s._TempBuffer,4)}setTexture(q,c){this._currentEffect.setTexture(q,c)}setTextureArray(q,c){this._currentEffect.setTextureArray(q,c)}bindTexture(q,c){this._currentEffect._bindTexture(q,c)}updateUniformDirectly(q,c){this.updateUniform(q,c,c.length),this.update()}bindToEffect(q,c){this._currentEffect=q,this._currentEffectName=c}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(q){if(!this._buffers)return this._buffer===q;for(let c=0;c<this._buffers.length;++c){if(this._buffers[c][0]===q)return this._bufferIndex=c,this._buffer=q,this._createBufferOnWrite=!1,this._currentEffect=void 0,this._buffers.length>1&&this._buffers[c][1]&&this._bufferData.set(this._buffers[c][1]),this._valueCache={},this._currentFrameId=this._engine.frameId,!0}return!1}dispose(){if(this._noUBO)return;const q=this._engine._uniformBuffers,c=q.indexOf(this);if(-1!==c&&(q[c]=q[q.length-1],q.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let U=0;U<this._buffers.length;++U){const q=this._buffers[U][0];this._engine._releaseBuffer(q)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}s._UpdatedUbosInFrame={},s._MAX_UNIFORM_SIZE=256,s._TempBuffer=new Float32Array(s._MAX_UNIFORM_SIZE),s._TempBufferInt32View=new Int32Array(s._TempBuffer.buffer),s._TempBufferUInt32View=new Uint32Array(s._TempBuffer.buffer)},11137:(q,c,U)=>{U.d(c,{d:()=>g,f:()=>J});var J,Q,s=U(10833);!function(q){q[q.LOCAL=0]="LOCAL",q[q.WORLD=1]="WORLD",q[q.BONE=2]="BONE"}(J||(J={}));class g{}g.X=new s.p(1,0,0),g.Y=new s.p(0,1,0),g.Z=new s.p(0,0,1),function(q){q[q.X=0]="X",q[q.Y=1]="Y",q[q.Z=2]="Z"}(Q||(Q={}))},11093:(q,c,U)=>{U.d(c,{c:()=>u,e:()=>K,g:()=>r});var J=U(10845),Q=U(10850),s=U(10836),g=U(10870);function X(q){return Math.pow(q,s.k)}function n(q){return q<=.04045?.0773993808*q:Math.pow(.947867299*(q+.055),2.4)}function W(q){return Math.pow(q,s.h)}function D(q){return q<=.0031308?12.92*q:1.055*Math.pow(q,.41666)-.055}class u{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=q,this.g=c,this.b=U}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"Nc"}getHashCode(){let q=255*this.r|0;return q=397*q^255*this.g,q=397*q^255*this.b,q}toArray(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[c]=this.r,q[c+1]=this.g,q[c+2]=this.b,this}BU(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return u.FromArrayToRef(q,c,this),this}toColor4(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new K(this.r,this.g,this.b,q)}rc(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(q){return new u(this.r*q.r,this.g*q.g,this.b*q.b)}multiplyToRef(q,c){return c.r=this.r*q.r,c.g=this.g*q.g,c.b=this.b*q.b,c}multiplyInPlace(q){return this.r*=q.r,this.g*=q.g,this.b*=q.b,this}multiplyByFloats(q,c,U){return new u(this.r*q,this.g*c,this.b*U)}divide(q){throw new ReferenceError("Can not divide a color")}divideToRef(q,c){throw new ReferenceError("Can not divide a color")}divideInPlace(q){throw new ReferenceError("Can not divide a color")}minimizeInPlace(q){return this.minimizeInPlaceFromFloats(q.r,q.g,q.b)}maximizeInPlace(q){return this.maximizeInPlaceFromFloats(q.r,q.g,q.b)}minimizeInPlaceFromFloats(q,c,U){return this.r=Math.min(q,this.r),this.g=Math.min(c,this.g),this.b=Math.min(U,this.b),this}maximizeInPlaceFromFloats(q,c,U){return this.r=Math.max(q,this.r),this.g=Math.max(c,this.g),this.b=Math.max(U,this.b),this}floorToRef(q){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(q){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(q){return q&&this.r===q.r&&this.g===q.g&&this.b===q.b}equalsFloats(q,c,U){return this.equalsToFloats(q,c,U)}equalsToFloats(q,c,U){return this.r===q&&this.g===c&&this.b===U}equalsWithEpsilon(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.d;return(0,g.WithinEpsilon)(this.r,q.r,c)&&(0,g.WithinEpsilon)(this.g,q.g,c)&&(0,g.WithinEpsilon)(this.b,q.b,c)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(q){throw new ReferenceError("Can not negate a color")}scale(q){return new u(this.r*q,this.g*q,this.b*q)}scaleInPlace(q){return this.r*=q,this.g*=q,this.b*=q,this}scaleToRef(q,c){return c.r=this.r*q,c.g=this.g*q,c.b=this.b*q,c}scaleAndAddToRef(q,c){return c.r+=this.r*q,c.g+=this.g*q,c.b+=this.b*q,c}clampToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2?arguments[2]:void 0;return U.r=(0,g.Clamp)(this.r,q,c),U.g=(0,g.Clamp)(this.g,q,c),U.b=(0,g.Clamp)(this.b,q,c),U}add(q){return new u(this.r+q.r,this.g+q.g,this.b+q.b)}addInPlace(q){return this.r+=q.r,this.g+=q.g,this.b+=q.b,this}addInPlaceFromFloats(q,c,U){return this.r+=q,this.g+=c,this.b+=U,this}addToRef(q,c){return c.r=this.r+q.r,c.g=this.g+q.g,c.b=this.b+q.b,c}eU(q){return new u(this.r-q.r,this.g-q.g,this.b-q.b)}subtractToRef(q,c){return c.r=this.r-q.r,c.g=this.g-q.g,c.b=this.b-q.b,c}Uu(q){return this.r-=q.r,this.g-=q.g,this.b-=q.b,this}subtractFromFloats(q,c,U){return new u(this.r-q,this.g-c,this.b-U)}subtractFromFloatsToRef(q,c,U,J){return J.r=this.r-q,J.g=this.g-c,J.b=this.b-U,J}clone(){return new u(this.r,this.g,this.b)}X(q){return this.r=q.r,this.g=q.g,this.b=q.b,this}bc(q,c,U){return this.r=q,this.g=c,this.b=U,this}set(q,c,U){return this.bc(q,c,U)}tc(q){return this.r=this.g=this.b=q,this}toHexString(){const q=Math.round(255*this.r),c=Math.round(255*this.g),U=Math.round(255*this.b);return"#"+(0,g.ToHex)(q)+(0,g.ToHex)(c)+(0,g.ToHex)(U)}fromHexString(q){return"#"!==q.substring(0,1)||7!==q.length||(this.r=parseInt(q.substring(1,3),16)/255,this.g=parseInt(q.substring(3,5),16)/255,this.b=parseInt(q.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new u)}toHSVToRef(q){const c=this.r,U=this.g,J=this.b,Q=Math.max(c,U,J),s=Math.min(c,U,J);let g=0,X=0;const n=Q,W=Q-s;return 0!==Q&&(X=W/Q),Q!=s&&(Q==c?(g=(U-J)/W,U<J&&(g+=6)):Q==U?g=(J-c)/W+2:Q==J&&(g=(c-U)/W+4),g*=60),q.r=g,q.g=X,q.b=n,q}toLinearSpace(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new u;return this.toLinearSpaceToRef(c,q),c}toLinearSpaceToRef(q){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(q.r=n(this.r),q.g=n(this.g),q.b=n(this.b)):(q.r=X(this.r),q.g=X(this.g),q.b=X(this.b)),this}toGammaSpace(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new u;return this.toGammaSpaceToRef(c,q),c}toGammaSpaceToRef(q){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(q.r=D(this.r),q.g=D(this.g),q.b=D(this.b)):(q.r=W(this.r),q.g=W(this.g),q.b=W(this.b)),this}static HSVtoRGBToRef(q,c,U,J){const Q=U*c,s=q/60,g=Q*(1-Math.abs(s%2-1));let X=0,n=0,W=0;s>=0&&s<=1?(X=Q,n=g):s>=1&&s<=2?(X=g,n=Q):s>=2&&s<=3?(n=Q,W=g):s>=3&&s<=4?(n=g,W=Q):s>=4&&s<=5?(X=g,W=Q):s>=5&&s<=6&&(X=Q,W=g);const D=U-Q;return J.r=X+D,J.g=n+D,J.b=W+D,J}static FromHSV(q,c,U){const J=new u(0,0,0);return u.HSVtoRGBToRef(q,c,U,J),J}static FromHexString(q){return new u(0,0,0).fromHexString(q)}static Ic(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new u(q[c],q[c+1],q[c+2])}static FromArrayToRef(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;U.r=q[c],U.g=q[c+1],U.b=q[c+2]}static FromInts(q,c,U){return new u(q/255,c/255,U/255)}static Lerp(q,c,U){const J=new u(0,0,0);return u.LerpToRef(q,c,U,J),J}static LerpToRef(q,c,U,J){J.r=q.r+(c.r-q.r)*U,J.g=q.g+(c.g-q.g)*U,J.b=q.b+(c.b-q.b)*U}static Hermite(q,c,U,J,Q){const s=Q*Q,g=Q*s,X=2*g-3*s+1,n=-2*g+3*s,W=g-2*s+Q,D=g-s,K=q.r*X+U.r*n+c.r*W+J.r*D,r=q.g*X+U.g*n+c.g*W+J.g*D,H=q.b*X+U.b*n+c.b*W+J.b*D;return new u(K,r,H)}static Hermite1stDerivative(q,c,U,J,Q){const s=u.Black();return this.Hermite1stDerivativeToRef(q,c,U,J,Q,s),s}static Hermite1stDerivativeToRef(q,c,U,J,Q,s){const g=Q*Q;s.r=6*(g-Q)*q.r+(3*g-4*Q+1)*c.r+6*(-g+Q)*U.r+(3*g-2*Q)*J.r,s.g=6*(g-Q)*q.g+(3*g-4*Q+1)*c.g+6*(-g+Q)*U.g+(3*g-2*Q)*J.g,s.b=6*(g-Q)*q.b+(3*g-4*Q+1)*c.b+6*(-g+Q)*U.b+(3*g-2*Q)*J.b}static Red(){return new u(1,0,0)}static Green(){return new u(0,1,0)}static Blue(){return new u(0,0,1)}static Black(){return new u(0,0,0)}static get BlackReadOnly(){return u._BlackReadOnly}static White(){return new u(1,1,1)}static Purple(){return new u(.5,0,.5)}static Magenta(){return new u(1,0,1)}static Yellow(){return new u(1,1,0)}static Gray(){return new u(.5,.5,.5)}static Teal(){return new u(0,1,1)}static Random(){return new u(Math.random(),Math.random(),Math.random())}}u._V8PerformanceHack=new u(.5,.5,.5),u._BlackReadOnly=u.Black(),Object.defineProperties(u.prototype,{dimension:{value:[3]},rank:{value:1}});class K{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=q,this.g=c,this.b=U,this.a=J}rc(){return[this.r,this.g,this.b,this.a]}toArray(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[c]=this.r,q[c+1]=this.g,q[c+2]=this.b,q[c+3]=this.a,this}BU(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=q[c],this.g=q[c+1],this.b=q[c+2],this.a=q[c+3],this}equals(q){return q&&this.r===q.r&&this.g===q.g&&this.b===q.b&&this.a===q.a}add(q){return new K(this.r+q.r,this.g+q.g,this.b+q.b,this.a+q.a)}addToRef(q,c){return c.r=this.r+q.r,c.g=this.g+q.g,c.b=this.b+q.b,c.a=this.a+q.a,c}addInPlace(q){return this.r+=q.r,this.g+=q.g,this.b+=q.b,this.a+=q.a,this}addInPlaceFromFloats(q,c,U,J){return this.r+=q,this.g+=c,this.b+=U,this.a+=J,this}eU(q){return new K(this.r-q.r,this.g-q.g,this.b-q.b,this.a-q.a)}subtractToRef(q,c){return c.r=this.r-q.r,c.g=this.g-q.g,c.b=this.b-q.b,c.a=this.a-q.a,c}Uu(q){return this.r-=q.r,this.g-=q.g,this.b-=q.b,this.a-=q.a,this}subtractFromFloats(q,c,U,J){return new K(this.r-q,this.g-c,this.b-U,this.a-J)}subtractFromFloatsToRef(q,c,U,J,Q){return Q.r=this.r-q,Q.g=this.g-c,Q.b=this.b-U,Q.a=this.a-J,Q}scale(q){return new K(this.r*q,this.g*q,this.b*q,this.a*q)}scaleInPlace(q){return this.r*=q,this.g*=q,this.b*=q,this.a*=q,this}scaleToRef(q,c){return c.r=this.r*q,c.g=this.g*q,c.b=this.b*q,c.a=this.a*q,c}scaleAndAddToRef(q,c){return c.r+=this.r*q,c.g+=this.g*q,c.b+=this.b*q,c.a+=this.a*q,c}clampToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2?arguments[2]:void 0;return U.r=(0,g.Clamp)(this.r,q,c),U.g=(0,g.Clamp)(this.g,q,c),U.b=(0,g.Clamp)(this.b,q,c),U.a=(0,g.Clamp)(this.a,q,c),U}multiply(q){return new K(this.r*q.r,this.g*q.g,this.b*q.b,this.a*q.a)}multiplyToRef(q,c){return c.r=this.r*q.r,c.g=this.g*q.g,c.b=this.b*q.b,c.a=this.a*q.a,c}multiplyInPlace(q){return this.r*=q.r,this.g*=q.g,this.b*=q.b,this.a*=q.a,this}multiplyByFloats(q,c,U,J){return new K(this.r*q,this.g*c,this.b*U,this.a*J)}divide(q){throw new ReferenceError("Can not divide a color")}divideToRef(q,c){throw new ReferenceError("Can not divide a color")}divideInPlace(q){throw new ReferenceError("Can not divide a color")}minimizeInPlace(q){return this.r=Math.min(this.r,q.r),this.g=Math.min(this.g,q.g),this.b=Math.min(this.b,q.b),this.a=Math.min(this.a,q.a),this}maximizeInPlace(q){return this.r=Math.max(this.r,q.r),this.g=Math.max(this.g,q.g),this.b=Math.max(this.b,q.b),this.a=Math.max(this.a,q.a),this}minimizeInPlaceFromFloats(q,c,U,J){return this.r=Math.min(q,this.r),this.g=Math.min(c,this.g),this.b=Math.min(U,this.b),this.a=Math.min(J,this.a),this}maximizeInPlaceFromFloats(q,c,U,J){return this.r=Math.max(q,this.r),this.g=Math.max(c,this.g),this.b=Math.max(U,this.b),this.a=Math.max(J,this.a),this}floorToRef(q){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(q){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(q){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.d;return(0,g.WithinEpsilon)(this.r,q.r,c)&&(0,g.WithinEpsilon)(this.g,q.g,c)&&(0,g.WithinEpsilon)(this.b,q.b,c)&&(0,g.WithinEpsilon)(this.a,q.a,c)}equalsToFloats(q,c,U,J){return this.r===q&&this.g===c&&this.b===U&&this.a===J}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"Pc"}getHashCode(){let q=255*this.r|0;return q=397*q^255*this.g,q=397*q^255*this.b,q=397*q^255*this.a,q}clone(){return(new K).X(this)}X(q){return this.r=q.r,this.g=q.g,this.b=q.b,this.a=q.a,this}bc(q,c,U,J){return this.r=q,this.g=c,this.b=U,this.a=J,this}set(q,c,U,J){return this.bc(q,c,U,J)}tc(q){return this.r=this.g=this.b=this.a=q,this}toHexString(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=Math.round(255*this.r),U=Math.round(255*this.g),J=Math.round(255*this.b);if(q)return"#"+(0,g.ToHex)(c)+(0,g.ToHex)(U)+(0,g.ToHex)(J);const Q=Math.round(255*this.a);return"#"+(0,g.ToHex)(c)+(0,g.ToHex)(U)+(0,g.ToHex)(J)+(0,g.ToHex)(Q)}fromHexString(q){return"#"!==q.substring(0,1)||9!==q.length&&7!==q.length||(this.r=parseInt(q.substring(1,3),16)/255,this.g=parseInt(q.substring(3,5),16)/255,this.b=parseInt(q.substring(5,7),16)/255,9===q.length&&(this.a=parseInt(q.substring(7,9),16)/255)),this}toLinearSpace(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new K;return this.toLinearSpaceToRef(c,q),c}toLinearSpaceToRef(q){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(q.r=n(this.r),q.g=n(this.g),q.b=n(this.b)):(q.r=X(this.r),q.g=X(this.g),q.b=X(this.b)),q.a=this.a,this}toGammaSpace(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=new K;return this.toGammaSpaceToRef(c,q),c}toGammaSpaceToRef(q){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(q.r=D(this.r),q.g=D(this.g),q.b=D(this.b)):(q.r=W(this.r),q.g=W(this.g),q.b=W(this.b)),q.a=this.a,this}static FromHexString(q){return"#"!==q.substring(0,1)||9!==q.length&&7!==q.length?new K(0,0,0,0):new K(0,0,0,1).fromHexString(q)}static Lerp(q,c,U){return K.LerpToRef(q,c,U,new K)}static LerpToRef(q,c,U,J){return J.r=q.r+(c.r-q.r)*U,J.g=q.g+(c.g-q.g)*U,J.b=q.b+(c.b-q.b)*U,J.a=q.a+(c.a-q.a)*U,J}static Hermite(q,c,U,J,Q){const s=Q*Q,g=Q*s,X=2*g-3*s+1,n=-2*g+3*s,W=g-2*s+Q,D=g-s,u=q.r*X+U.r*n+c.r*W+J.r*D,r=q.g*X+U.g*n+c.g*W+J.g*D,H=q.b*X+U.b*n+c.b*W+J.b*D,b=q.a*X+U.a*n+c.a*W+J.a*D;return new K(u,r,H,b)}static Hermite1stDerivative(q,c,U,J,Q){const s=new K;return this.Hermite1stDerivativeToRef(q,c,U,J,Q,s),s}static Hermite1stDerivativeToRef(q,c,U,J,Q,s){const g=Q*Q;s.r=6*(g-Q)*q.r+(3*g-4*Q+1)*c.r+6*(-g+Q)*U.r+(3*g-2*Q)*J.r,s.g=6*(g-Q)*q.g+(3*g-4*Q+1)*c.g+6*(-g+Q)*U.g+(3*g-2*Q)*J.g,s.b=6*(g-Q)*q.b+(3*g-4*Q+1)*c.b+6*(-g+Q)*U.b+(3*g-2*Q)*J.b,s.a=6*(g-Q)*q.a+(3*g-4*Q+1)*c.a+6*(-g+Q)*U.a+(3*g-2*Q)*J.a}static FromColor3(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new K(q.r,q.g,q.b,c)}static Ic(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new K(q[c],q[c+1],q[c+2],q[c+3])}static FromArrayToRef(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0;U.r=q[c],U.g=q[c+1],U.b=q[c+2],U.a=q[c+3]}static FromInts(q,c,U,J){return new K(q/255,c/255,U/255,J/255)}static CheckColors4(q,c){if(q.length===3*c){const c=[];for(let U=0;U<q.length;U+=3){const J=U/3*4;c[J]=q[U],c[J+1]=q[U+1],c[J+2]=q[U+2],c[J+3]=1}return c}return q}}K._V8PerformanceHack=new K(.5,.5,.5,.5),Object.defineProperties(K.prototype,{dimension:{value:[4]},rank:{value:1}});class r{}r.Nc=(0,J.d)(3,u.Black),r.Pc=(0,J.d)(3,(()=>new K(0,0,0,0))),(0,Q.f)("BABYLON.Color3",u),(0,Q.f)("BABYLON.Color4",K)},10836:(q,c,U)=>{U.d(c,{d:()=>g,g:()=>s,h:()=>J,k:()=>Q});const J=1/2.2,Q=2.2,s=(1+Math.sqrt(5))/2,g=.001},11168:(q,c,U)=>{U.d(c,{d:()=>Q});var J=U(11077);class Q{static GetPlanes(q){const c=[];for(let U=0;U<6;U++)c.push(new J.d(0,0,0,0));return Q.GetPlanesToRef(q,c),c}static GetNearPlaneToRef(q,c){const U=q.m;c.Jc.x=U[3]+U[2],c.Jc.y=U[7]+U[6],c.Jc.z=U[11]+U[10],c.d=U[15]+U[14],c.normalize()}static GetFarPlaneToRef(q,c){const U=q.m;c.Jc.x=U[3]-U[2],c.Jc.y=U[7]-U[6],c.Jc.z=U[11]-U[10],c.d=U[15]-U[14],c.normalize()}static GetLeftPlaneToRef(q,c){const U=q.m;c.Jc.x=U[3]+U[0],c.Jc.y=U[7]+U[4],c.Jc.z=U[11]+U[8],c.d=U[15]+U[12],c.normalize()}static GetRightPlaneToRef(q,c){const U=q.m;c.Jc.x=U[3]-U[0],c.Jc.y=U[7]-U[4],c.Jc.z=U[11]-U[8],c.d=U[15]-U[12],c.normalize()}static GetTopPlaneToRef(q,c){const U=q.m;c.Jc.x=U[3]-U[1],c.Jc.y=U[7]-U[5],c.Jc.z=U[11]-U[9],c.d=U[15]-U[13],c.normalize()}static GetBottomPlaneToRef(q,c){const U=q.m;c.Jc.x=U[3]+U[1],c.Jc.y=U[7]+U[5],c.Jc.z=U[11]+U[9],c.d=U[15]+U[13],c.normalize()}static GetPlanesToRef(q,c){Q.GetNearPlaneToRef(q,c[0]),Q.GetFarPlaneToRef(q,c[1]),Q.GetLeftPlaneToRef(q,c[2]),Q.GetRightPlaneToRef(q,c[3]),Q.GetTopPlaneToRef(q,c[4]),Q.GetBottomPlaneToRef(q,c[5])}static IsPointInFrustum(q,c){for(let U=0;U<6;U++)if(c[U].dotCoordinate(q)<0)return!1;return!0}}},11064:(q,c,U)=>{U.d(c,{e:()=>X,g:()=>n});var J=U(11010),Q=U(10833),s=U(11019);class g{static extractMinAndMaxIndexed(q,c,U,J,Q,s){for(let g=U;g<U+J;g++){const U=3*c[g],J=q[U],X=q[U+1],n=q[U+2];Q.minimizeInPlaceFromFloats(J,X,n),s.maximizeInPlaceFromFloats(J,X,n)}}static extractMinAndMax(q,c,U,J,Q,s){for(let g=c,X=c*J;g<c+U;g++,X+=J){const c=q[X],U=q[X+1],J=q[X+2];Q.minimizeInPlaceFromFloats(c,U,J),s.maximizeInPlaceFromFloats(c,U,J)}}}function X(q,c,U,J){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const X=new Q.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new Q.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return g.extractMinAndMaxIndexed(q,c,U,J,X,n),s&&(X.x-=X.x*s.x+s.y,X.y-=X.y*s.x+s.y,X.z-=X.z*s.x+s.y,n.x+=n.x*s.x+s.y,n.y+=n.y*s.x+s.y,n.z+=n.z*s.x+s.y),{minimum:X,maximum:n}}function n(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0;const X=new Q.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n=new Q.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return s||(s=3),g.extractMinAndMax(q,c,U,s,X,n),J&&(X.x-=X.x*J.x+J.y,X.y-=X.y*J.x+J.y,X.z-=X.z*J.x+J.y,n.x+=n.x*J.x+J.y,n.y+=n.y*J.x+J.y,n.z+=n.z*J.x+J.y),{minimum:X,maximum:n}}(0,J.d)([s.d.filter((function(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];let[J,Q]=c;return!Array.isArray(J)&&!Array.isArray(Q)}))],g,"extractMinAndMaxIndexed",null),(0,J.d)([s.d.filter((function(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];let[J]=c;return!Array.isArray(J)}))],g,"extractMinAndMax",null)},11263:(q,c,U)=>{U.d(c,{e:()=>J.d,h:()=>J.g,i:()=>J.j,l:()=>J.p});U(11137),U(11093),U(10836),U(11168),U(11266),U(11077),U(11271);var J=U(10833);U(11163)},11266:(q,c,U)=>{U.d(c,{e:()=>X,f:()=>K,i:()=>D,k:()=>u});var J,Q=U(10870),s=U(10833),g=U(10836);!function(q){q[q.CW=0]="CW",q[q.CCW=1]="CCW"}(J||(J={}));class X{static Interpolate(q,c,U,J,Q){if(0===q)return 0;const s=1-3*J+3*c,g=3*J-6*c,X=3*c;let n=q;for(let W=0;W<5;W++){const c=n*n;n-=(s*(c*n)+g*c+X*n-q)*(1/(3*s*c+2*g*n+X)),n=Math.min(1,Math.max(0,n))}return 3*Math.pow(1-n,2)*n*U+3*(1-n)*Math.pow(n,2)*Q+Math.pow(n,3)}}class n{constructor(q){this._radians=q,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(q,c){const U=c.eU(q),J=Math.atan2(U.y,U.x);return new n(J)}static BetweenTwoVectors(q,c){let U=q.lengthSquared()*c.lengthSquared();if(0===U)return new n(Math.PI/2);U=Math.sqrt(U);let J=q.dot(c)/U;J=(0,Q.Clamp)(J,-1,1);const s=Math.acos(J);return new n(s)}static FromRadians(q){return new n(q)}static FromDegrees(q){return new n(q*Math.PI/180)}}class W{constructor(q,c,U){this.startPoint=q,this.midPoint=c,this.endPoint=U;const J=Math.pow(c.x,2)+Math.pow(c.y,2),Q=(Math.pow(q.x,2)+Math.pow(q.y,2)-J)/2,g=(J-Math.pow(U.x,2)-Math.pow(U.y,2))/2,X=(q.x-c.x)*(c.y-U.y)-(c.x-U.x)*(q.y-c.y);this.centerPoint=new s.l((Q*(c.y-U.y)-g*(q.y-c.y))/X,((q.x-c.x)*g-(c.x-U.x)*Q)/X),this.radius=this.centerPoint.eU(this.startPoint).length(),this.startAngle=n.BetweenTwoPoints(this.centerPoint,this.startPoint);const W=this.startAngle.degrees();let D=n.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),u=n.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();D-W>180&&(D-=360),D-W<-180&&(D+=360),u-D>180&&(u-=360),u-D<-180&&(u+=360),this.orientation=D-W<0?0:1,this.angle=n.FromDegrees(0===this.orientation?W-u:u-W)}}class D{constructor(q,c){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new s.l(q,c))}addLineTo(q,c){if(this.closed)return this;const U=new s.l(q,c),J=this._points[this._points.length-1];return this._points.push(U),this._length+=U.eU(J).length(),this}addArcTo(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const g=this._points[this._points.length-1],X=new s.l(q,c),n=new s.l(U,J),D=new W(g,X,n);let u=D.angle.radians()/Q;0===D.orientation&&(u*=-1);let K=D.startAngle.radians()+u;for(let s=0;s<Q;s++){const q=Math.cos(K)*D.radius+D.centerPoint.x,c=Math.sin(K)*D.radius+D.centerPoint.y;this.addLineTo(q,c),K+=u}return this}addQuadraticCurveTo(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const s=(q,c,U,J)=>(1-q)*(1-q)*c+2*q*(1-q)*U+q*q*J,g=this._points[this._points.length-1];for(let X=0;X<=Q;X++){const n=X/Q,W=s(n,g.x,q,U),D=s(n,g.y,c,J);this.addLineTo(W,D)}return this}addBezierCurveTo(q,c,U,J,Q,s){let g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const X=(q,c,U,J,Q)=>(1-q)*(1-q)*(1-q)*c+3*q*(1-q)*(1-q)*U+3*q*q*(1-q)*J+q*q*q*Q,n=this._points[this._points.length-1];for(let W=0;W<=g;W++){const D=W/g,u=X(D,n.x,q,U,Q),K=X(D,n.y,c,J,s);this.addLineTo(u,K)}return this}isPointInside(q){let c=!1;const U=this._points.length;for(let J=U-1,Q=0;Q<U;J=Q++){let U=this._points[J],s=this._points[Q],g=s.x-U.x,X=s.y-U.y;if(Math.abs(X)>Number.EPSILON){if(X<0&&(U=this._points[Q],g=-g,s=this._points[J],X=-X),q.y<U.y||q.y>s.y)continue;if(q.y===U.y&&q.x===U.x)return!0;{const J=X*(q.x-U.x)-g*(q.y-U.y);if(0===J)return!0;if(J<0)continue;c=!c}}else{if(q.y!==U.y)continue;if(s.x<=q.x&&q.x<=U.x||U.x<=q.x&&q.x<=s.x)return!0}}return c}close(){return this.closed=!0,this}length(){let q=this._length;if(this.closed){const c=this._points[this._points.length-1];q+=this._points[0].eU(c).length()}return q}area(){const q=this._points.length;let c=0;for(let U=q-1,J=0;J<q;U=J++)c+=this._points[U].x*this._points[J].y-this._points[J].x*this._points[U].y;return.5*c}getPoints(){return this._points}getPointAtLengthPosition(q){if(q<0||q>1)return s.l.Zero();const c=q*this.length();let U=0;for(let J=0;J<this._points.length;J++){const q=(J+1)%this._points.length,Q=this._points[J],g=this._points[q].eU(Q),X=g.length()+U;if(c>=U&&c<=X){const q=g.normalize(),J=c-U;return new s.l(Q.x+q.x*J,Q.y+q.y*J)}U=X}return s.l.Zero()}static StartingAt(q,c){return new D(q,c)}}class u{constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=q,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:s.p.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:s.d.Identity()};for(let Q=0;Q<q.length;Q++)this._curve[Q]=q[Q].clone();this._raw=U||!1,this._alignTangentsWithPath=J,this._compute(c,J)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(q){return this._updatePointAtData(q).point}getTangentAt(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(q,c),c?s.p.TransformCoordinates(s.p.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(q,c),c?s.p.TransformCoordinates(s.p.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(q,c),c?s.p.TransformCoordinates(s.p.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(q){return this.length()*q}getPreviousPointIndexAt(q){return this._updatePointAtData(q),this._pointAtData.previousPointArrayIndex}getSubPositionAt(q){return this._updatePointAtData(q),this._pointAtData.subPosition}getClosestPositionTo(q){let c=Number.MAX_VALUE,U=0;for(let J=0;J<this._curve.length-1;J++){const Q=this._curve[J+0],g=this._curve[J+1].eU(Q).normalize(),X=this._distances[J+1]-this._distances[J+0],n=Math.min(Math.max(s.p.Dot(g,q.eU(Q).normalize()),0)*s.p.Distance(Q,q)/X,1),W=s.p.Distance(Q.add(g.scale(n*X)),q);W<c&&(c=W,U=(this._distances[J+0]+X*n)/this.length())}return U}slice(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(q<0&&(q=1- -1*q%1),c<0&&(c=1- -1*c%1),q>c){const U=q;q=c,c=U}const U=this.getCurve(),J=this.getPointAt(q);let Q=this.getPreviousPointIndexAt(q);const s=this.getPointAt(c),g=this.getPreviousPointIndexAt(c)+1,X=[];return 0!==q&&(Q++,X.push(J)),X.push(...U.slice(Q,g)),1===c&&1!==q||X.push(s),new u(X,this.getNormalAt(q),this._raw,this._alignTangentsWithPath)}update(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let J=0;J<q.length;J++)this._curve[J].x=q[J].x,this._curve[J].y=q[J].y,this._curve[J].z=q[J].z;return this._compute(c,U),this}_compute(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const U=this._curve.length;if(U<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[U-1]=this._curve[U-1].eU(this._curve[U-2]),this._raw||this._tangents[U-1].normalize();const J=this._tangents[0],Q=this._normalVector(J,q);let g,X,n,W,D;this._normals[0]=Q,this._raw||this._normals[0].normalize(),this._binormals[0]=s.p.Cross(J,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let u=1;u<U;u++)g=this._getLastNonNullVector(u),u<U-1&&(X=this._getFirstNonNullVector(u),this._tangents[u]=c?X:g.add(X),this._tangents[u].normalize()),this._distances[u]=this._distances[u-1]+this._curve[u].eU(this._curve[u-1]).length(),n=this._tangents[u],D=this._binormals[u-1],this._normals[u]=s.p.Cross(D,n),this._raw||(0===this._normals[u].length()?(W=this._normals[u-1],this._normals[u]=W.clone()):this._normals[u].normalize()),this._binormals[u]=s.p.Cross(n,this._normals[u]),this._raw||this._binormals[u].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(q){let c=1,U=this._curve[q+c].eU(this._curve[q]);for(;0===U.length()&&q+c+1<this._curve.length;)c++,U=this._curve[q+c].eU(this._curve[q]);return U}_getLastNonNullVector(q){let c=1,U=this._curve[q].eU(this._curve[q-c]);for(;0===U.length()&&q>c+1;)c++,U=this._curve[q].eU(this._curve[q-c]);return U}_normalVector(q,c){let U,J=q.length();if(0===J&&(J=1),void 0===c||null===c){let c;c=(0,Q.WithinEpsilon)(Math.abs(q.y)/J,1,g.d)?(0,Q.WithinEpsilon)(Math.abs(q.x)/J,1,g.d)?(0,Q.WithinEpsilon)(Math.abs(q.z)/J,1,g.d)?s.p.Zero():new s.p(0,0,1):new s.p(1,0,0):new s.p(0,-1,0),U=s.p.Cross(q,c)}else U=s.p.Cross(q,c),s.p.CrossToRef(U,q,U);return U.normalize(),U}_updatePointAtData(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===q)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=q;const U=this.getPoints();if(q<=0)return this._setPointAtData(0,0,U[0],0,c);if(q>=1)return this._setPointAtData(1,1,U[U.length-1],U.length-1,c);let J,Q=U[0],g=0;const X=q*this.length();for(let n=1;n<U.length;n++){J=U[n];const W=s.p.Distance(Q,J);if(g+=W,g===X)return this._setPointAtData(q,1,J,n,c);if(g>X){const U=(g-X)/W,s=Q.eU(J),D=J.add(s.scaleInPlace(U));return this._setPointAtData(q,1-U,D,n-1,c)}Q=J}return this._pointAtData}_setPointAtData(q,c,U,J,Q){return this._pointAtData.point=U,this._pointAtData.position=q,this._pointAtData.subPosition=c,this._pointAtData.previousPointArrayIndex=J,this._pointAtData.interpolateReady=Q,Q&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=s.d.Identity();const q=this._pointAtData.previousPointArrayIndex;if(q!==this._tangents.length-1){const c=q+1,U=this._tangents[q].clone(),J=this._normals[q].clone(),Q=this._binormals[q].clone(),g=this._tangents[c].clone(),X=this._normals[c].clone(),n=this._binormals[c].clone(),W=s.g.RotationQuaternionFromAxis(J,Q,U),D=s.g.RotationQuaternionFromAxis(X,n,g);s.g.Slerp(W,D,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}class K{static CreateQuadraticBezier(q,c,U,J){J=J>2?J:3;const Q=[],g=(q,c,U,J)=>(1-q)*(1-q)*c+2*q*(1-q)*U+q*q*J;for(let X=0;X<=J;X++)Q.push(new s.p(g(X/J,q.x,c.x,U.x),g(X/J,q.y,c.y,U.y),g(X/J,q.z,c.z,U.z)));return new K(Q)}static CreateCubicBezier(q,c,U,J,Q){Q=Q>3?Q:4;const g=[],X=(q,c,U,J,Q)=>(1-q)*(1-q)*(1-q)*c+3*q*(1-q)*(1-q)*U+3*q*q*(1-q)*J+q*q*q*Q;for(let n=0;n<=Q;n++)g.push(new s.p(X(n/Q,q.x,c.x,U.x,J.x),X(n/Q,q.y,c.y,U.y,J.y),X(n/Q,q.z,c.z,U.z,J.z)));return new K(g)}static CreateHermiteSpline(q,c,U,J,Q){const g=[],X=1/Q;for(let n=0;n<=Q;n++)g.push(s.p.Hermite(q,c,U,J,n*X));return new K(g)}static CreateCatmullRomSpline(q,c,U){const J=[],Q=1/c;let g=0;if(U){const U=q.length;for(let X=0;X<U;X++){g=0;for(let n=0;n<c;n++)J.push(s.p.CatmullRom(q[X%U],q[(X+1)%U],q[(X+2)%U],q[(X+3)%U],g)),g+=Q}J.push(J[0])}else{const U=[];U.push(q[0].clone()),Array.prototype.push.apply(U,q),U.push(q[q.length-1].clone());let X=0;for(;X<U.length-3;X++){g=0;for(let q=0;q<c;q++)J.push(s.p.CatmullRom(U[X],U[X+1],U[X+2],U[X+3],g)),g+=Q}X--,J.push(s.p.CatmullRom(U[X],U[X+1],U[X+2],U[X+3],g))}return new K(J)}static ArcThru3Points(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32,Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=[],n=c.eU(q),W=U.eU(c),D=q.eU(U),u=s.p.Cross(n,W),r=u.length();if(r<Math.pow(10,-8))return new K(X);const H=n.lengthSquared(),b=W.lengthSquared(),h=D.lengthSquared(),o=u.lengthSquared(),a=.5*n.length()*W.length()*D.length()/r,p=-.5*b*s.p.Dot(n,D)/o,R=-.5*h*s.p.Dot(n,W)/o,I=-.5*H*s.p.Dot(W,D)/o,t=q.scale(p).add(c.scale(R)).add(U.scale(I)),C=q.eU(t).normalize(),i=s.p.Cross(u,C).normalize();if(g){const c=2*Math.PI/J;for(let q=0;q<=2*Math.PI;q+=c)X.push(t.add(C.scale(a*Math.cos(q)).add(i.scale(a*Math.sin(q)))));X.push(q)}else{const c=1/J;let g=0,n=s.p.Zero();do{n=t.add(C.scale(a*Math.cos(g)).add(i.scale(a*Math.sin(g)))),X.push(n),g+=c}while(!n.equalsWithEpsilon(U,a*c*1.1));X.push(U),Q&&X.push(q)}return new K(X)}constructor(q){this._length=0,this._points=q,this._length=this._computeLength(q)}getPoints(){return this._points}length(){return this._length}continue(q){const c=this._points[this._points.length-1],U=this._points.slice(),J=q.getPoints();for(let Q=1;Q<J.length;Q++)U.push(J[Q].eU(J[0]).add(c));return new K(U)}_computeLength(q){let c=0;for(let U=1;U<q.length;U++)c+=q[U].eU(q[U-1]).length();return c}}},11077:(q,c,U)=>{U.d(c,{d:()=>Q});var J=U(10833);class Q{constructor(q,c,U,Q){this.Jc=new J.p(q,c,U),this.d=Q}rc(){return[this.Jc.x,this.Jc.y,this.Jc.z,this.d]}clone(){return new Q(this.Jc.x,this.Jc.y,this.Jc.z,this.d)}getClassName(){return"Plane"}getHashCode(){let q=this.Jc.getHashCode();return q=397*q^this.d,q}normalize(){const q=Math.sqrt(this.Jc.x*this.Jc.x+this.Jc.y*this.Jc.y+this.Jc.z*this.Jc.z);let c=0;return 0!==q&&(c=1/q),this.Jc.x*=c,this.Jc.y*=c,this.Jc.z*=c,this.d*=c,this}transform(q){const c=Q._TmpMatrix;q.invertToRef(c);const U=c.m,J=this.Jc.x,s=this.Jc.y,g=this.Jc.z,X=this.d,n=J*U[0]+s*U[1]+g*U[2]+X*U[3],W=J*U[4]+s*U[5]+g*U[6]+X*U[7],D=J*U[8]+s*U[9]+g*U[10]+X*U[11],u=J*U[12]+s*U[13]+g*U[14]+X*U[15];return new Q(n,W,D,u)}dotCoordinate(q){return this.Jc.x*q.x+this.Jc.y*q.y+this.Jc.z*q.z+this.d}copyFromPoints(q,c,U){const J=c.x-q.x,Q=c.y-q.y,s=c.z-q.z,g=U.x-q.x,X=U.y-q.y,n=U.z-q.z,W=Q*n-s*X,D=s*g-J*n,u=J*X-Q*g,K=Math.sqrt(W*W+D*D+u*u);let r;return r=0!==K?1/K:0,this.Jc.x=W*r,this.Jc.y=D*r,this.Jc.z=u*r,this.d=-(this.Jc.x*q.x+this.Jc.y*q.y+this.Jc.z*q.z),this}isFrontFacingTo(q,c){return J.p.Dot(this.Jc,q)<=c}signedDistanceTo(q){return J.p.Dot(q,this.Jc)+this.d}static Ic(q){return new Q(q[0],q[1],q[2],q[3])}static FromPoints(q,c,U){const J=new Q(0,0,0,0);return J.copyFromPoints(q,c,U),J}static FromPositionAndNormal(q,c){const U=new Q(0,0,0,0);return this.FromPositionAndNormalToRef(q,c,U)}static FromPositionAndNormalToRef(q,c,U){return U.Jc.X(c),U.Jc.normalize(),U.d=-q.dot(U.Jc),U}static SignedDistanceToPlaneFromPositionAndNormal(q,c,U){const Q=-(c.x*q.x+c.y*q.y+c.z*q.z);return J.p.Dot(U,c)+Q}}Q._TmpMatrix=J.d.Identity()},10870:(q,c,U)=>{function J(q){return parseInt(q.toString().replace(/\W/g,""))}function Q(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(q-c)<=U}function s(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1401298e-51;return q<c-J||q>U+J}function g(q,c){return q===c?q:Math.random()*(c-q)+q}function X(q,c,U){return q+(c-q)*U}function n(q,c,U){let J=h(c-q,360);return J>180&&(J-=360),q+J*K(U)}function W(q,c,U){let J=0;return J=q!=c?K((U-q)/(c-q)):0,J}function D(q,c,U,J,Q){const s=Q*Q,g=Q*s;return q*(2*g-3*s+1)+U*(-2*g+3*s)+c*(g-2*s+Q)+J*(g-s)}function u(q,c,U,J,Q){const s=Q*Q;return 6*(s-Q)*q+(3*s-4*Q+1)*c+6*(-s+Q)*U+(3*s-2*Q)*J}function K(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(U,Math.max(c,q))}function r(q){return q-=2*Math.PI*Math.floor((q+Math.PI)/(2*Math.PI))}function H(q){const c=q.toString(16);return q<=15?("0"+c).toUpperCase():c.toUpperCase()}function b(q){if(Math.log2)return Math.floor(Math.log2(q));if(q<0)return NaN;if(0===q)return-1/0;let c=0;if(q<1){for(;q<1;)c++,q*=2;c=-c}else if(q>1)for(;q>1;)c++,q=Math.floor(q/2);return c}function h(q,c){return q-Math.floor(q/c)*c}function o(q,c,U){return(q-c)/(U-c)}function a(q,c,U){return q*(U-c)+c}function p(q,c){let U=h(c-q,360);return U>180&&(U-=360),U}function R(q,c){const U=h(q,2*c);return c-Math.abs(U-c)}function I(q,c,U){let J=K(U);return J=-2*J*J*J+3*J*J,c*J+q*(1-J)}function t(q,c,U){let J=0;return J=Math.abs(c-q)<=U?c:q+Math.sign(c-q)*U,J}function C(q,c,U){const J=p(q,c);let Q=0;return Q=-U<J&&J<U?c:t(q,c=q+J,U),Q}function i(q,c,U){return(q-c)/(U-c)}function F(q,c,U){return(U-c)*q+c}function v(q,c){const U=q%c;return 0===U?c:v(c,U)}U.r(c),U.d(c,{Clamp:()=>K,DeltaAngle:()=>p,Denormalize:()=>a,ExtractAsInt:()=>J,Hermite:()=>D,Hermite1stDerivative:()=>u,HighestCommonFactor:()=>v,ILog2:()=>b,InverseLerp:()=>W,Lerp:()=>X,LerpAngle:()=>n,MoveTowards:()=>t,MoveTowardsAngle:()=>C,Normalize:()=>o,NormalizeRadians:()=>r,OutsideRange:()=>s,PercentToRange:()=>F,PingPong:()=>R,RandomRange:()=>g,RangeToPercent:()=>i,Repeat:()=>h,SmoothStep:()=>I,ToHex:()=>H,WithinEpsilon:()=>Q})},11271:(q,c,U)=>{U.d(c,{b:()=>J});class J{constructor(q,c){this.width=q,this.height=c}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let q=0|this.width;return q=397*q^this.height,q}X(q){this.width=q.width,this.height=q.height}bc(q,c){return this.width=q,this.height=c,this}set(q,c){return this.bc(q,c)}multiplyByFloats(q,c){return new J(this.width*q,this.height*c)}clone(){return new J(this.width,this.height)}equals(q){return!!q&&(this.width===q.width&&this.height===q.height)}get surface(){return this.width*this.height}static Zero(){return new J(0,0)}add(q){return new J(this.width+q.width,this.height+q.height)}eU(q){return new J(this.width-q.width,this.height-q.height)}scale(q){return new J(this.width*q,this.height*q)}static Lerp(q,c,U){const Q=q.width+(c.width-q.width)*U,s=q.height+(c.height-q.height)*U;return new J(Q,s)}}},10833:(q,c,U)=>{U.d(c,{d:()=>a,g:()=>o,j:()=>R,l:()=>H,p:()=>b,q:()=>h});var J=U(10836),Q=U(10845),s=U(10850),g=U(10857),X=U(10864),n=U(10870);class W{}function D(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const Q=q.rc(),s=c.rc(),g=Q[0],X=Q[1],n=Q[2],W=Q[3],D=Q[4],u=Q[5],K=Q[6],r=Q[7],H=Q[8],b=Q[9],h=Q[10],o=Q[11],a=Q[12],p=Q[13],R=Q[14],I=Q[15],t=s[0],C=s[1],i=s[2],F=s[3],v=s[4],Y=s[5],k=s[6],V=s[7],O=s[8],G=s[9],S=s[10],Z=s[11],x=s[12],z=s[13],y=s[14],M=s[15];U[J]=g*t+X*v+n*O+W*x,U[J+1]=g*C+X*Y+n*G+W*z,U[J+2]=g*i+X*k+n*S+W*y,U[J+3]=g*F+X*V+n*Z+W*M,U[J+4]=D*t+u*v+K*O+r*x,U[J+5]=D*C+u*Y+K*G+r*z,U[J+6]=D*i+u*k+K*S+r*y,U[J+7]=D*F+u*V+K*Z+r*M,U[J+8]=H*t+b*v+h*O+o*x,U[J+9]=H*C+b*Y+h*G+o*z,U[J+10]=H*i+b*k+h*S+o*y,U[J+11]=H*F+b*V+h*Z+o*M,U[J+12]=a*t+p*v+R*O+I*x,U[J+13]=a*C+p*Y+R*G+I*z,U[J+14]=a*i+p*k+R*S+I*y,U[J+15]=a*F+p*V+R*Z+I*M}function u(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const J=q.rc();c[U]=J[0],c[U+1]=J[1],c[U+2]=J[2],c[U+3]=J[3],c[U+4]=J[4],c[U+5]=J[5],c[U+6]=J[6],c[U+7]=J[7],c[U+8]=J[8],c[U+9]=J[9],c[U+10]=J[10],c[U+11]=J[11],c[U+12]=J[12],c[U+13]=J[13],c[U+14]=J[14],c[U+15]=J[15]}function K(q,c){const U=q.rc(),J=U[0],Q=U[1],s=U[2],g=U[3],X=U[4],n=U[5],W=U[6],D=U[7],u=U[8],K=U[9],r=U[10],H=U[11],b=U[12],h=U[13],o=U[14],a=U[15],p=r*a-o*H,R=K*a-h*H,I=K*o-h*r,t=u*a-b*H,C=u*o-r*b,i=u*h-b*K,F=+(n*p-W*R+D*I),v=-(X*p-W*t+D*C),Y=+(X*R-n*t+D*i),k=-(X*I-n*C+W*i),V=J*F+Q*v+s*Y+g*k;if(0===V)return!1;const O=1/V,G=W*a-o*D,S=n*a-h*D,Z=n*o-h*W,x=X*a-b*D,z=X*o-b*W,y=X*h-b*n,M=W*H-r*D,T=n*H-K*D,m=n*r-K*W,d=X*H-u*D,e=X*r-u*W,B=X*K-u*n,N=-(Q*p-s*R+g*I),P=+(J*p-s*t+g*C),w=-(J*R-Q*t+g*i),L=+(J*I-Q*C+s*i),l=+(Q*G-s*S+g*Z),j=-(J*G-s*x+g*z),f=+(J*S-Q*x+g*y),A=-(J*Z-Q*z+s*y),E=-(Q*M-s*T+g*m),qq=+(J*M-s*d+g*e),cq=-(J*T-Q*d+g*B),Uq=+(J*m-Q*e+s*B);return c[0]=F*O,c[1]=N*O,c[2]=l*O,c[3]=E*O,c[4]=v*O,c[5]=P*O,c[6]=j*O,c[7]=qq*O,c[8]=Y*O,c[9]=w*O,c[10]=f*O,c[11]=cq*O,c[12]=k*O,c[13]=L*O,c[14]=A*O,c[15]=Uq*O,!0}W._UpdateFlagSeed=0;const r=q=>parseInt(q.toString().replace(/\W/g,""));class H{constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=q,this.y=c}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let q=r(this.x);return q=397*q^r(this.y),q}toArray(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[c]=this.x,q[c+1]=this.y,this}BU(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return H.FromArrayToRef(q,c,this),this}rc(){return[this.x,this.y]}X(q){return this.x=q.x,this.y=q.y,this}bc(q,c){return this.x=q,this.y=c,this}set(q,c){return this.bc(q,c)}tc(q){return this.bc(q,q)}add(q){return new H(this.x+q.x,this.y+q.y)}addToRef(q,c){return c.x=this.x+q.x,c.y=this.y+q.y,c}addInPlace(q){return this.x+=q.x,this.y+=q.y,this}addInPlaceFromFloats(q,c){return this.x+=q,this.y+=c,this}addVector3(q){return new H(this.x+q.x,this.y+q.y)}eU(q){return new H(this.x-q.x,this.y-q.y)}subtractToRef(q,c){return c.x=this.x-q.x,c.y=this.y-q.y,c}Uu(q){return this.x-=q.x,this.y-=q.y,this}multiplyInPlace(q){return this.x*=q.x,this.y*=q.y,this}multiply(q){return new H(this.x*q.x,this.y*q.y)}multiplyToRef(q,c){return c.x=this.x*q.x,c.y=this.y*q.y,c}multiplyByFloats(q,c){return new H(this.x*q,this.y*c)}divide(q){return new H(this.x/q.x,this.y/q.y)}divideToRef(q,c){return c.x=this.x/q.x,c.y=this.y/q.y,c}divideInPlace(q){return this.x=this.x/q.x,this.y=this.y/q.y,this}minimizeInPlace(q){return this.minimizeInPlaceFromFloats(q.x,q.y)}maximizeInPlace(q){return this.maximizeInPlaceFromFloats(q.x,q.y)}minimizeInPlaceFromFloats(q,c){return this.x=Math.min(q,this.x),this.y=Math.min(c,this.y),this}maximizeInPlaceFromFloats(q,c){return this.x=Math.max(q,this.x),this.y=Math.max(c,this.y),this}subtractFromFloats(q,c){return new H(this.x-q,this.y-c)}subtractFromFloatsToRef(q,c,U){return U.x=this.x-q,U.y=this.y-c,U}negate(){return new H(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(q){return q.x=-this.x,q.y=-this.y,q}scaleInPlace(q){return this.x*=q,this.y*=q,this}scale(q){return new H(this.x*q,this.y*q)}scaleToRef(q,c){return c.x=this.x*q,c.y=this.y*q,c}scaleAndAddToRef(q,c){return c.x+=this.x*q,c.y+=this.y*q,c}equals(q){return q&&this.x===q.x&&this.y===q.y}equalsWithEpsilon(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.d;return q&&(0,n.WithinEpsilon)(this.x,q.x,c)&&(0,n.WithinEpsilon)(this.y,q.y,c)}equalsToFloats(q,c){return this.x===q&&this.y===c}floor(){return new H(Math.floor(this.x),Math.floor(this.y))}floorToRef(q){return q.x=Math.floor(this.x),q.y=Math.floor(this.y),q}fract(){return new H(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(q){return q.x=this.x-Math.floor(this.x),q.y=this.y-Math.floor(this.y),q}rotate(q){return this.rotateToRef(q,new H)}rotateToRef(q,c){const U=Math.cos(q),J=Math.sin(q);return c.x=U*this.x-J*this.y,c.y=J*this.x+U*this.y,c}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(q){return 0===q||1===q?this:this.scaleInPlace(1/q)}normalizeToNew(){const q=new H;return this.normalizeToRef(q),q}normalizeToRef(q){const c=this.length();return 0===c&&(q.x=this.x,q.y=this.y),this.scaleToRef(1/c,q)}clone(){return new H(this.x,this.y)}dot(q){return this.x*q.x+this.y*q.y}static Zero(){return new H(0,0)}static One(){return new H(1,1)}static Random(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new H((0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c))}static RandomToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).bc((0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c))}static get ZeroReadOnly(){return H._ZeroReadOnly}static Ic(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new H(q[c],q[c+1])}static FromArrayToRef(q,c,U){return U.x=q[c],U.y=q[c+1],U}static FromFloatsToRef(q,c,U){return U.bc(q,c),U}static CatmullRom(q,c,U,J,Q){const s=Q*Q,g=Q*s,X=.5*(2*c.x+(-q.x+U.x)*Q+(2*q.x-5*c.x+4*U.x-J.x)*s+(-q.x+3*c.x-3*U.x+J.x)*g),n=.5*(2*c.y+(-q.y+U.y)*Q+(2*q.y-5*c.y+4*U.y-J.y)*s+(-q.y+3*c.y-3*U.y+J.y)*g);return new H(X,n)}static ClampToRef(q,c,U,J){return J.x=(0,n.Clamp)(q.x,c.x,U.x),J.y=(0,n.Clamp)(q.y,c.y,U.y),J}static Clamp(q,c,U){const J=(0,n.Clamp)(q.x,c.x,U.x),Q=(0,n.Clamp)(q.y,c.y,U.y);return new H(J,Q)}static Hermite(q,c,U,J,Q){const s=Q*Q,g=Q*s,X=2*g-3*s+1,n=-2*g+3*s,W=g-2*s+Q,D=g-s,u=q.x*X+U.x*n+c.x*W+J.x*D,K=q.y*X+U.y*n+c.y*W+J.y*D;return new H(u,K)}static Hermite1stDerivative(q,c,U,J,Q){return this.Hermite1stDerivativeToRef(q,c,U,J,Q,new H)}static Hermite1stDerivativeToRef(q,c,U,J,Q,s){const g=Q*Q;return s.x=6*(g-Q)*q.x+(3*g-4*Q+1)*c.x+6*(-g+Q)*U.x+(3*g-2*Q)*J.x,s.y=6*(g-Q)*q.y+(3*g-4*Q+1)*c.y+6*(-g+Q)*U.y+(3*g-2*Q)*J.y,s}static Lerp(q,c,U){return H.LerpToRef(q,c,U,new H)}static LerpToRef(q,c,U,J){return J.x=q.x+(c.x-q.x)*U,J.y=q.y+(c.y-q.y)*U,J}static Dot(q,c){return q.x*c.x+q.y*c.y}static Normalize(q){return H.NormalizeToRef(q,new H)}static NormalizeToRef(q,c){return q.normalizeToRef(c),c}static Minimize(q,c){const U=q.x<c.x?q.x:c.x,J=q.y<c.y?q.y:c.y;return new H(U,J)}static Maximize(q,c){const U=q.x>c.x?q.x:c.x,J=q.y>c.y?q.y:c.y;return new H(U,J)}static Transform(q,c){return H.TransformToRef(q,c,new H)}static TransformToRef(q,c,U){const J=c.m,Q=q.x*J[0]+q.y*J[4]+J[12],s=q.x*J[1]+q.y*J[5]+J[13];return U.x=Q,U.y=s,U}static PointInTriangle(q,c,U,J){const Q=.5*(-U.y*J.x+c.y*(-U.x+J.x)+c.x*(U.y-J.y)+U.x*J.y),s=Q<0?-1:1,g=(c.y*J.x-c.x*J.y+(J.y-c.y)*q.x+(c.x-J.x)*q.y)*s,X=(c.x*U.y-c.y*U.x+(c.y-U.y)*q.x+(U.x-c.x)*q.y)*s;return g>0&&X>0&&g+X<2*Q*s}static Distance(q,c){return Math.sqrt(H.DistanceSquared(q,c))}static DistanceSquared(q,c){const U=q.x-c.x,J=q.y-c.y;return U*U+J*J}static Center(q,c){return H.CenterToRef(q,c,new H)}static CenterToRef(q,c,U){return U.bc((q.x+c.x)/2,(q.y+c.y)/2)}static DistanceOfPointFromSegment(q,c,U){const J=H.DistanceSquared(c,U);if(0===J)return H.Distance(q,c);const Q=U.eU(c),s=Math.max(0,Math.min(1,H.Dot(q.eU(c),Q)/J)),g=c.add(Q.multiplyByFloats(s,s));return H.Distance(q,g)}}H._V8PerformanceHack=new H(.5,.5),H._ZeroReadOnly=H.Zero(),Object.defineProperties(H.prototype,{dimension:{value:[2]},rank:{value:1}});class b{get x(){return this._x}set x(q){this._x=q,this._isDirty=!0}get y(){return this._y}set y(q){this._y=q,this._isDirty=!0}get z(){return this._z}set z(q){this._z=q,this._isDirty=!0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=q,this._y=c,this._z=U}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"hc"}getHashCode(){let q=r(this._x);return q=397*q^r(this._y),q=397*q^r(this._z),q}rc(){return[this._x,this._y,this._z]}toArray(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[c]=this._x,q[c+1]=this._y,q[c+2]=this._z,this}BU(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return b.FromArrayToRef(q,c,this),this}toQuaternion(){return o.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(q){return this._x+=q._x,this._y+=q._y,this._z+=q._z,this._isDirty=!0,this}addInPlaceFromFloats(q,c,U){return this._x+=q,this._y+=c,this._z+=U,this._isDirty=!0,this}add(q){return new b(this._x+q._x,this._y+q._y,this._z+q._z)}addToRef(q,c){return c._x=this._x+q._x,c._y=this._y+q._y,c._z=this._z+q._z,c._isDirty=!0,c}Uu(q){return this._x-=q._x,this._y-=q._y,this._z-=q._z,this._isDirty=!0,this}eU(q){return new b(this._x-q._x,this._y-q._y,this._z-q._z)}subtractToRef(q,c){return this.subtractFromFloatsToRef(q._x,q._y,q._z,c)}subtractFromFloats(q,c,U){return new b(this._x-q,this._y-c,this._z-U)}subtractFromFloatsToRef(q,c,U,J){return J._x=this._x-q,J._y=this._y-c,J._z=this._z-U,J._isDirty=!0,J}negate(){return new b(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(q){return q._x=-1*this._x,q._y=-1*this._y,q._z=-1*this._z,q._isDirty=!0,q}scaleInPlace(q){return this._x*=q,this._y*=q,this._z*=q,this._isDirty=!0,this}scale(q){return new b(this._x*q,this._y*q,this._z*q)}scaleToRef(q,c){return c._x=this._x*q,c._y=this._y*q,c._z=this._z*q,c._isDirty=!0,c}getNormalToRef(q){const c=this.length();let U=Math.acos(this._y/c);const J=Math.atan2(this._z,this._x);U>Math.PI/2?U-=Math.PI/2:U+=Math.PI/2;const Q=c*Math.sin(U)*Math.cos(J),s=c*Math.cos(U),g=c*Math.sin(U)*Math.sin(J);return q.set(Q,s,g),q}applyRotationQuaternionToRef(q,c){const U=this._x,J=this._y,Q=this._z,s=q._x,g=q._y,X=q._z,n=q._w,W=2*(g*Q-X*J),D=2*(X*U-s*Q),u=2*(s*J-g*U);return c._x=U+n*W+g*u-X*D,c._y=J+n*D+X*W-s*u,c._z=Q+n*u+s*D-g*W,c._isDirty=!0,c}applyRotationQuaternionInPlace(q){return this.applyRotationQuaternionToRef(q,this)}applyRotationQuaternion(q){return this.applyRotationQuaternionToRef(q,new b)}scaleAndAddToRef(q,c){return c._x+=this._x*q,c._y+=this._y*q,c._z+=this._z*q,c._isDirty=!0,c}projectOnPlane(q,c){return this.projectOnPlaneToRef(q,c,new b)}projectOnPlaneToRef(q,c,U){const J=q.Jc,Q=q.d,s=p.hc[0];this.subtractToRef(c,s),s.normalize();const g=b.Dot(s,J);if(Math.abs(g)<1e-10)U.tc(1/0);else{const q=-(b.Dot(c,J)+Q)/g,X=s.scaleInPlace(q);c.addToRef(X,U)}return U}equals(q){return q&&this._x===q._x&&this._y===q._y&&this._z===q._z}equalsWithEpsilon(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.d;return q&&(0,n.WithinEpsilon)(this._x,q._x,c)&&(0,n.WithinEpsilon)(this._y,q._y,c)&&(0,n.WithinEpsilon)(this._z,q._z,c)}equalsToFloats(q,c,U){return this._x===q&&this._y===c&&this._z===U}multiplyInPlace(q){return this._x*=q._x,this._y*=q._y,this._z*=q._z,this._isDirty=!0,this}multiply(q){return this.multiplyByFloats(q._x,q._y,q._z)}multiplyToRef(q,c){return c._x=this._x*q._x,c._y=this._y*q._y,c._z=this._z*q._z,c._isDirty=!0,c}multiplyByFloats(q,c,U){return new b(this._x*q,this._y*c,this._z*U)}divide(q){return new b(this._x/q._x,this._y/q._y,this._z/q._z)}divideToRef(q,c){return c._x=this._x/q._x,c._y=this._y/q._y,c._z=this._z/q._z,c._isDirty=!0,c}divideInPlace(q){return this._x=this._x/q._x,this._y=this._y/q._y,this._z=this._z/q._z,this._isDirty=!0,this}minimizeInPlace(q){return this.minimizeInPlaceFromFloats(q._x,q._y,q._z)}maximizeInPlace(q){return this.maximizeInPlaceFromFloats(q._x,q._y,q._z)}minimizeInPlaceFromFloats(q,c,U){return q<this._x&&(this.x=q),c<this._y&&(this.y=c),U<this._z&&(this.z=U),this}maximizeInPlaceFromFloats(q,c,U){return q>this._x&&(this.x=q),c>this._y&&(this.y=c),U>this._z&&(this.z=U),this}isNonUniformWithinEpsilon(q){const c=Math.abs(this._x),U=Math.abs(this._y);if(!(0,n.WithinEpsilon)(c,U,q))return!0;const J=Math.abs(this._z);return!(0,n.WithinEpsilon)(c,J,q)||!(0,n.WithinEpsilon)(U,J,q)}get isNonUniform(){const q=Math.abs(this._x);if(q!==Math.abs(this._y))return!0;return q!==Math.abs(this._z)}floorToRef(q){return q._x=Math.floor(this._x),q._y=Math.floor(this._y),q._z=Math.floor(this._z),q._isDirty=!0,q}floor(){return new b(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z))}fractToRef(q){return q._x=this._x-Math.floor(this._x),q._y=this._y-Math.floor(this._y),q._z=this._z-Math.floor(this._z),q._isDirty=!0,q}fract(){return new b(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(q){if("xyz"===(q=q.toLowerCase()))return this;const c=p.hc[0].X(this);return this.x=c[q[0]],this.y=c[q[1]],this.z=c[q[2]],this}rotateByQuaternionToRef(q,c){return q.toRotationMatrix(p.Matrix[0]),b.TransformCoordinatesToRef(this,p.Matrix[0],c),c}rotateByQuaternionAroundPointToRef(q,c,U){return this.subtractToRef(c,p.hc[0]),p.hc[0].rotateByQuaternionToRef(q,p.hc[0]),c.addToRef(p.hc[0],U),U}cross(q){return b.CrossToRef(this,q,new b)}normalizeFromLength(q){return 0===q||1===q?this:this.scaleInPlace(1/q)}normalizeToNew(){return this.normalizeToRef(new b)}normalizeToRef(q){const c=this.length();return 0===c||1===c?(q._x=this._x,q._y=this._y,q._z=this._z,q._isDirty=!0,q):this.scaleToRef(1/c,q)}clone(){return new b(this._x,this._y,this._z)}X(q){return this.bc(q._x,q._y,q._z)}bc(q,c,U){return this._x=q,this._y=c,this._z=U,this._isDirty=!0,this}set(q,c,U){return this.bc(q,c,U)}tc(q){return this._x=this._y=this._z=q,this._isDirty=!0,this}static GetClipFactor(q,c,U,J){const Q=b.Dot(q,U);return(Q-J)/(Q-b.Dot(c,U))}static GetAngleBetweenVectors(q,c,U){const J=q.normalizeToRef(p.hc[1]),Q=c.normalizeToRef(p.hc[2]);let s=b.Dot(J,Q);s=(0,n.Clamp)(s,-1,1);const g=Math.acos(s),X=p.hc[3];return b.CrossToRef(J,Q,X),b.Dot(X,U)>0?isNaN(g)?0:g:isNaN(g)?-Math.PI:-Math.acos(s)}static GetAngleBetweenVectorsOnPlane(q,c,U){p.hc[0].X(q);const J=p.hc[0];p.hc[1].X(c);const Q=p.hc[1];p.hc[2].X(U);const s=p.hc[2],g=p.hc[3],X=p.hc[4];J.normalize(),Q.normalize(),s.normalize(),b.CrossToRef(s,J,g),b.CrossToRef(g,s,X);const W=Math.atan2(b.Dot(Q,g),b.Dot(Q,X));return(0,n.NormalizeRadians)(W)}static PitchYawRollToMoveBetweenPointsToRef(q,c,U){const J=R.hc[0];return c.subtractToRef(q,J),U._y=Math.atan2(J.x,J.z)||0,U._x=Math.atan2(Math.sqrt(J.x**2+J.z**2),J.y)||0,U._z=0,U._isDirty=!0,U}static PitchYawRollToMoveBetweenPoints(q,c){const U=b.Zero();return b.PitchYawRollToMoveBetweenPointsToRef(q,c,U)}static SlerpToRef(q,c,U,Q){U=(0,n.Clamp)(U,0,1);const s=p.hc[0],g=p.hc[1];s.X(q);const X=s.length();s.normalizeFromLength(X),g.X(c);const W=g.length();g.normalizeFromLength(W);const D=b.Dot(s,g);let u,K;if(D<1-J.d){const q=Math.acos(D),c=1/Math.sin(q);u=Math.sin((1-U)*q)*c,K=Math.sin(U*q)*c}else u=1-U,K=U;return s.scaleInPlace(u),g.scaleInPlace(K),Q.X(s).addInPlace(g),Q.scaleInPlace((0,n.Lerp)(X,W,U)),Q}static SmoothToRef(q,c,U,J,Q){return b.SlerpToRef(q,c,0===J?1:U/J,Q),Q}static Ic(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new b(q[c],q[c+1],q[c+2])}static FromFloatArray(q,c){return b.Ic(q,c)}static FromArrayToRef(q,c,U){return U._x=q[c],U._y=q[c+1],U._z=q[c+2],U._isDirty=!0,U}static FromFloatArrayToRef(q,c,U){return b.FromArrayToRef(q,c,U)}static FromFloatsToRef(q,c,U,J){return J.bc(q,c,U),J}static Zero(){return new b(0,0,0)}static One(){return new b(1,1,1)}static Up(){return new b(0,1,0)}static get UpReadOnly(){return b._UpReadOnly}static get DownReadOnly(){return b._DownReadOnly}static get RightReadOnly(){return b._RightReadOnly}static get LeftReadOnly(){return b._LeftReadOnly}static get LeftHandedForwardReadOnly(){return b._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return b._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return b._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return b._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return b._ZeroReadOnly}static get OneReadOnly(){return b._OneReadOnly}static Down(){return new b(0,-1,0)}static Forward(){return new b(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new b(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new b(1,0,0)}static Left(){return new b(-1,0,0)}static Random(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new b((0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c))}static RandomToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).bc((0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c))}static TransformCoordinates(q,c){const U=b.Zero();return b.TransformCoordinatesToRef(q,c,U),U}static TransformCoordinatesToRef(q,c,U){return b.TransformCoordinatesFromFloatsToRef(q._x,q._y,q._z,c,U),U}static TransformCoordinatesFromFloatsToRef(q,c,U,J,Q){const s=J.m,g=q*s[0]+c*s[4]+U*s[8]+s[12],X=q*s[1]+c*s[5]+U*s[9]+s[13],n=q*s[2]+c*s[6]+U*s[10]+s[14],W=1/(q*s[3]+c*s[7]+U*s[11]+s[15]);return Q._x=g*W,Q._y=X*W,Q._z=n*W,Q._isDirty=!0,Q}static TransformNormal(q,c){const U=b.Zero();return b.TransformNormalToRef(q,c,U),U}static TransformNormalToRef(q,c,U){return this.TransformNormalFromFloatsToRef(q._x,q._y,q._z,c,U),U}static TransformNormalFromFloatsToRef(q,c,U,J,Q){const s=J.m;return Q._x=q*s[0]+c*s[4]+U*s[8],Q._y=q*s[1]+c*s[5]+U*s[9],Q._z=q*s[2]+c*s[6]+U*s[10],Q._isDirty=!0,Q}static CatmullRom(q,c,U,J,Q){const s=Q*Q,g=Q*s,X=.5*(2*c._x+(-q._x+U._x)*Q+(2*q._x-5*c._x+4*U._x-J._x)*s+(-q._x+3*c._x-3*U._x+J._x)*g),n=.5*(2*c._y+(-q._y+U._y)*Q+(2*q._y-5*c._y+4*U._y-J._y)*s+(-q._y+3*c._y-3*U._y+J._y)*g),W=.5*(2*c._z+(-q._z+U._z)*Q+(2*q._z-5*c._z+4*U._z-J._z)*s+(-q._z+3*c._z-3*U._z+J._z)*g);return new b(X,n,W)}static Clamp(q,c,U){const J=new b;return b.ClampToRef(q,c,U,J),J}static ClampToRef(q,c,U,J){let Q=q._x;Q=Q>U._x?U._x:Q,Q=Q<c._x?c._x:Q;let s=q._y;s=s>U._y?U._y:s,s=s<c._y?c._y:s;let g=q._z;return g=g>U._z?U._z:g,g=g<c._z?c._z:g,J.bc(Q,s,g),J}static CheckExtends(q,c,U){c.minimizeInPlace(q),U.maximizeInPlace(q)}static Hermite(q,c,U,J,Q){const s=Q*Q,g=Q*s,X=2*g-3*s+1,n=-2*g+3*s,W=g-2*s+Q,D=g-s,u=q._x*X+U._x*n+c._x*W+J._x*D,K=q._y*X+U._y*n+c._y*W+J._y*D,r=q._z*X+U._z*n+c._z*W+J._z*D;return new b(u,K,r)}static Hermite1stDerivative(q,c,U,J,Q){const s=new b;return this.Hermite1stDerivativeToRef(q,c,U,J,Q,s),s}static Hermite1stDerivativeToRef(q,c,U,J,Q,s){const g=Q*Q;return s._x=6*(g-Q)*q._x+(3*g-4*Q+1)*c._x+6*(-g+Q)*U._x+(3*g-2*Q)*J._x,s._y=6*(g-Q)*q._y+(3*g-4*Q+1)*c._y+6*(-g+Q)*U._y+(3*g-2*Q)*J._y,s._z=6*(g-Q)*q._z+(3*g-4*Q+1)*c._z+6*(-g+Q)*U._z+(3*g-2*Q)*J._z,s._isDirty=!0,s}static Lerp(q,c,U){const J=new b(0,0,0);return b.LerpToRef(q,c,U,J),J}static LerpToRef(q,c,U,J){return J._x=q._x+(c._x-q._x)*U,J._y=q._y+(c._y-q._y)*U,J._z=q._z+(c._z-q._z)*U,J._isDirty=!0,J}static Dot(q,c){return q._x*c._x+q._y*c._y+q._z*c._z}dot(q){return this._x*q._x+this._y*q._y+this._z*q._z}static Cross(q,c){const U=new b;return b.CrossToRef(q,c,U),U}static CrossToRef(q,c,U){const J=q._y*c._z-q._z*c._y,Q=q._z*c._x-q._x*c._z,s=q._x*c._y-q._y*c._x;return U.bc(J,Q,s),U}static Normalize(q){const c=b.Zero();return b.NormalizeToRef(q,c),c}static NormalizeToRef(q,c){return q.normalizeToRef(c),c}static Project(q,c,U,J){const Q=new b;return b.ProjectToRef(q,c,U,J,Q),Q}static ProjectToRef(q,c,U,J,Q){var s;const g=J.width,n=J.height,W=J.x,D=J.y,u=p.Matrix[1],K=null===(s=X.c.LastCreatedEngine)||void 0===s?void 0:s.isNDCHalfZRange,r=K?1:.5,H=K?0:.5;a.FromValuesToRef(g/2,0,0,0,0,-n/2,0,0,0,0,r,0,W+g/2,n/2+D,H,1,u);const h=p.Matrix[0];return c.multiplyToRef(U,h),h.multiplyToRef(u,h),b.TransformCoordinatesToRef(q,h,Q),Q}static Reflect(q,c){return this.ReflectToRef(q,c,new b)}static ReflectToRef(q,c,U){const J=R.hc[0];return J.X(c).scaleInPlace(2*b.Dot(q,c)),U.X(q).Uu(J)}static _UnprojectFromInvertedMatrixToRef(q,c,U){b.TransformCoordinatesToRef(q,c,U);const J=c.m,Q=q._x*J[3]+q._y*J[7]+q._z*J[11]+J[15];return(0,n.WithinEpsilon)(Q,1)&&U.scaleInPlace(1/Q),U}static UnprojectFromTransform(q,c,U,J,Q){return this.Unproject(q,c,U,J,Q,a.IdentityReadOnly)}static Unproject(q,c,U,J,Q,s){const g=new b;return b.UnprojectToRef(q,c,U,J,Q,s,g),g}static UnprojectToRef(q,c,U,J,Q,s,g){return b.UnprojectFloatsToRef(q._x,q._y,q._z,c,U,J,Q,s,g),g}static UnprojectFloatsToRef(q,c,U,J,Q,s,g,n,W){var D;const u=p.Matrix[0];s.multiplyToRef(g,u),u.multiplyToRef(n,u),u.invert();const K=p.hc[0];return K.x=q/J*2-1,K.y=-(c/Q*2-1),null!==(D=X.c.LastCreatedEngine)&&void 0!==D&&D.isNDCHalfZRange?K.z=U:K.z=2*U-1,b._UnprojectFromInvertedMatrixToRef(K,u,W),W}static Minimize(q,c){const U=new b;return U.X(q),U.minimizeInPlace(c),U}static Maximize(q,c){const U=new b;return U.X(q),U.maximizeInPlace(c),U}static Distance(q,c){return Math.sqrt(b.DistanceSquared(q,c))}static DistanceSquared(q,c){const U=q._x-c._x,J=q._y-c._y,Q=q._z-c._z;return U*U+J*J+Q*Q}static ProjectOnTriangleToRef(q,c,U,Q,s){const g=p.hc[0],X=p.hc[1],W=p.hc[2],D=p.hc[3],u=p.hc[4];U.subtractToRef(c,g),Q.subtractToRef(c,X),Q.subtractToRef(U,W);const K=g.length(),r=X.length(),H=W.length();if(K<J.d||r<J.d||H<J.d)return s.X(c),b.Distance(q,c);q.subtractToRef(c,u),b.CrossToRef(g,X,D);const h=D.length();if(h<J.d)return s.X(c),b.Distance(q,c);D.normalizeFromLength(h);let o=u.length();if(o<J.d)return s.X(c),0;u.normalizeFromLength(o);const a=b.Dot(D,u),R=p.hc[5],I=p.hc[6];R.X(D).scaleInPlace(-o*a),I.X(q).addInPlace(R);const t=p.hc[4],C=p.hc[5],i=p.hc[7],F=p.hc[8];t.X(g).scaleInPlace(1/K),F.X(X).scaleInPlace(1/r),t.addInPlace(F).scaleInPlace(-1),C.X(g).scaleInPlace(-1/K),F.X(W).scaleInPlace(1/H),C.addInPlace(F).scaleInPlace(-1),i.X(W).scaleInPlace(-1/H),F.X(X).scaleInPlace(-1/r),i.addInPlace(F).scaleInPlace(-1);const v=p.hc[9];let Y;v.X(I).Uu(c),b.CrossToRef(t,v,F),Y=b.Dot(F,D);const k=Y;v.X(I).Uu(U),b.CrossToRef(C,v,F),Y=b.Dot(F,D);const V=Y;v.X(I).Uu(Q),b.CrossToRef(i,v,F),Y=b.Dot(F,D);const O=Y,G=p.hc[10];let S,Z;k>0&&V<0?(G.X(g),S=c,Z=U):V>0&&O<0?(G.X(W),S=U,Z=Q):(G.X(X).scaleInPlace(-1),S=Q,Z=c);const x=p.hc[9],z=p.hc[4];S.subtractToRef(I,F),Z.subtractToRef(I,x),b.CrossToRef(F,x,z);if(!(b.Dot(z,D)<0))return s.X(I),Math.abs(o*a);const y=p.hc[5];b.CrossToRef(G,z,y),y.normalize();const M=p.hc[9];M.X(S).Uu(I);const T=M.length();if(T<J.d)return s.X(S),b.Distance(q,S);M.normalizeFromLength(T);const m=b.Dot(y,M),d=p.hc[7];d.X(I).addInPlace(y.scaleInPlace(T*m)),F.X(d).Uu(S),o=G.length(),G.normalizeFromLength(o);let e=b.Dot(F,G)/Math.max(o,J.d);return e=(0,n.Clamp)(e,0,1),d.X(S).addInPlace(G.scaleInPlace(e*o)),s.X(d),b.Distance(q,d)}static Center(q,c){return b.CenterToRef(q,c,b.Zero())}static CenterToRef(q,c,U){return U.bc((q._x+c._x)/2,(q._y+c._y)/2,(q._z+c._z)/2)}static RotationFromAxis(q,c,U){const J=new b;return b.RotationFromAxisToRef(q,c,U,J),J}static RotationFromAxisToRef(q,c,U,J){const Q=p.Quaternion[0];return o.RotationQuaternionFromAxisToRef(q,c,U,Q),Q.toEulerAnglesToRef(J),J}}b._V8PerformanceHack=new b(.5,.5,.5),b._UpReadOnly=b.Up(),b._DownReadOnly=b.Down(),b._LeftHandedForwardReadOnly=b.Forward(!1),b._RightHandedForwardReadOnly=b.Forward(!0),b._LeftHandedBackwardReadOnly=b.Backward(!1),b._RightHandedBackwardReadOnly=b.Backward(!0),b._RightReadOnly=b.Right(),b._LeftReadOnly=b.Left(),b._ZeroReadOnly=b.Zero(),b._OneReadOnly=b.One(),Object.defineProperties(b.prototype,{dimension:{value:[3]},rank:{value:1}});class h{get x(){return this._x}set x(q){this._x=q,this._isDirty=!0}get y(){return this._y}set y(q){this._y=q,this._isDirty=!0}get z(){return this._z}set z(q){this._z=q,this._isDirty=!0}get w(){return this._w}set w(q){this._w=q,this._isDirty=!0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this._isDirty=!0,this._x=q,this._y=c,this._z=U,this._w=J}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Vector4"}getHashCode(){let q=r(this._x);return q=397*q^r(this._y),q=397*q^r(this._z),q=397*q^r(this._w),q}rc(){return[this._x,this._y,this._z,this._w]}toArray(q,c){return void 0===c&&(c=0),q[c]=this._x,q[c+1]=this._y,q[c+2]=this._z,q[c+3]=this._w,this}BU(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return h.FromArrayToRef(q,c,this),this}addInPlace(q){return this.x+=q._x,this.y+=q._y,this.z+=q._z,this.w+=q._w,this}addInPlaceFromFloats(q,c,U,J){return this.x+=q,this.y+=c,this.z+=U,this.w+=J,this}add(q){return new h(this._x+q.x,this._y+q.y,this._z+q.z,this._w+q.w)}addToRef(q,c){return c.x=this._x+q.x,c.y=this._y+q.y,c.z=this._z+q.z,c.w=this._w+q.w,c}Uu(q){return this.x-=q.x,this.y-=q.y,this.z-=q.z,this.w-=q.w,this}eU(q){return new h(this._x-q.x,this._y-q.y,this._z-q.z,this._w-q.w)}subtractToRef(q,c){return c.x=this._x-q.x,c.y=this._y-q.y,c.z=this._z-q.z,c.w=this._w-q.w,c}subtractFromFloats(q,c,U,J){return new h(this._x-q,this._y-c,this._z-U,this._w-J)}subtractFromFloatsToRef(q,c,U,J,Q){return Q.x=this._x-q,Q.y=this._y-c,Q.z=this._z-U,Q.w=this._w-J,Q}negate(){return new h(-this._x,-this._y,-this._z,-this._w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(q){return q.x=-this._x,q.y=-this._y,q.z=-this._z,q.w=-this._w,q}scaleInPlace(q){return this.x*=q,this.y*=q,this.z*=q,this.w*=q,this}scale(q){return new h(this._x*q,this._y*q,this._z*q,this._w*q)}scaleToRef(q,c){return c.x=this._x*q,c.y=this._y*q,c.z=this._z*q,c.w=this._w*q,c}scaleAndAddToRef(q,c){return c.x+=this._x*q,c.y+=this._y*q,c.z+=this._z*q,c.w+=this._w*q,c}equals(q){return q&&this._x===q.x&&this._y===q.y&&this._z===q.z&&this._w===q.w}equalsWithEpsilon(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.d;return q&&(0,n.WithinEpsilon)(this._x,q.x,c)&&(0,n.WithinEpsilon)(this._y,q.y,c)&&(0,n.WithinEpsilon)(this._z,q.z,c)&&(0,n.WithinEpsilon)(this._w,q.w,c)}equalsToFloats(q,c,U,J){return this._x===q&&this._y===c&&this._z===U&&this._w===J}multiplyInPlace(q){return this.x*=q.x,this.y*=q.y,this.z*=q.z,this.w*=q.w,this}multiply(q){return new h(this._x*q.x,this._y*q.y,this._z*q.z,this._w*q.w)}multiplyToRef(q,c){return c.x=this._x*q.x,c.y=this._y*q.y,c.z=this._z*q.z,c.w=this._w*q.w,c}multiplyByFloats(q,c,U,J){return new h(this._x*q,this._y*c,this._z*U,this._w*J)}divide(q){return new h(this._x/q.x,this._y/q.y,this._z/q.z,this._w/q.w)}divideToRef(q,c){return c.x=this._x/q.x,c.y=this._y/q.y,c.z=this._z/q.z,c.w=this._w/q.w,c}divideInPlace(q){return this.divideToRef(q,this)}minimizeInPlace(q){return q.x<this._x&&(this.x=q.x),q.y<this._y&&(this.y=q.y),q.z<this._z&&(this.z=q.z),q.w<this._w&&(this.w=q.w),this}maximizeInPlace(q){return q.x>this._x&&(this.x=q.x),q.y>this._y&&(this.y=q.y),q.z>this._z&&(this.z=q.z),q.w>this._w&&(this.w=q.w),this}minimizeInPlaceFromFloats(q,c,U,J){return this.x=Math.min(q,this._x),this.y=Math.min(c,this._y),this.z=Math.min(U,this._z),this.w=Math.min(J,this._w),this}maximizeInPlaceFromFloats(q,c,U,J){return this.x=Math.max(q,this._x),this.y=Math.max(c,this._y),this.z=Math.max(U,this._z),this.w=Math.max(J,this._w),this}floorToRef(q){return q.x=Math.floor(this._x),q.y=Math.floor(this._y),q.z=Math.floor(this._z),q.w=Math.floor(this._w),q}floor(){return new h(Math.floor(this._x),Math.floor(this._y),Math.floor(this._z),Math.floor(this._w))}fractToRef(q){return q.x=this._x-Math.floor(this._x),q.y=this._y-Math.floor(this._y),q.z=this._z-Math.floor(this._z),q.w=this._w-Math.floor(this._w),q}fract(){return new h(this._x-Math.floor(this._x),this._y-Math.floor(this._y),this._z-Math.floor(this._z),this._w-Math.floor(this._w))}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(q){return 0===q||1===q?this:this.scaleInPlace(1/q)}normalizeToNew(){return this.normalizeToRef(new h)}normalizeToRef(q){const c=this.length();return 0===c||1===c?(q.x=this._x,q.y=this._y,q.z=this._z,q.w=this._w,q):this.scaleToRef(1/c,q)}toVector3(){return new b(this._x,this._y,this._z)}clone(){return new h(this._x,this._y,this._z,this._w)}X(q){return this.x=q.x,this.y=q.y,this.z=q.z,this.w=q.w,this}bc(q,c,U,J){return this.x=q,this.y=c,this.z=U,this.w=J,this}set(q,c,U,J){return this.bc(q,c,U,J)}tc(q){return this.x=this.y=this.z=this.w=q,this}dot(q){return this._x*q.x+this._y*q.y+this._z*q.z+this._w*q.w}static Ic(q,c){return c||(c=0),new h(q[c],q[c+1],q[c+2],q[c+3])}static FromArrayToRef(q,c,U){return U.x=q[c],U.y=q[c+1],U.z=q[c+2],U.w=q[c+3],U}static FromFloatArrayToRef(q,c,U){return h.FromArrayToRef(q,c,U),U}static FromFloatsToRef(q,c,U,J,Q){return Q.x=q,Q.y=c,Q.z=U,Q.w=J,Q}static Zero(){return new h(0,0,0,0)}static One(){return new h(1,1,1,1)}static Random(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new h((0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c))}static RandomToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,U=arguments.length>2?arguments[2]:void 0;return U.x=(0,n.RandomRange)(q,c),U.y=(0,n.RandomRange)(q,c),U.z=(0,n.RandomRange)(q,c),U.w=(0,n.RandomRange)(q,c),U}static Clamp(q,c,U){return h.ClampToRef(q,c,U,new h)}static ClampToRef(q,c,U,J){return J.x=(0,n.Clamp)(q.x,c.x,U.x),J.y=(0,n.Clamp)(q.y,c.y,U.y),J.z=(0,n.Clamp)(q.z,c.z,U.z),J.w=(0,n.Clamp)(q.w,c.w,U.w),J}static CheckExtends(q,c,U){c.minimizeInPlace(q),U.maximizeInPlace(q)}static get ZeroReadOnly(){return h._ZeroReadOnly}static Normalize(q){return h.NormalizeToRef(q,new h)}static NormalizeToRef(q,c){return q.normalizeToRef(c),c}static Minimize(q,c){const U=new h;return U.X(q),U.minimizeInPlace(c),U}static Maximize(q,c){const U=new h;return U.X(q),U.maximizeInPlace(c),U}static Distance(q,c){return Math.sqrt(h.DistanceSquared(q,c))}static DistanceSquared(q,c){const U=q.x-c.x,J=q.y-c.y,Q=q.z-c.z,s=q.w-c.w;return U*U+J*J+Q*Q+s*s}static Center(q,c){return h.CenterToRef(q,c,new h)}static CenterToRef(q,c,U){return U.x=(q.x+c.x)/2,U.y=(q.y+c.y)/2,U.z=(q.z+c.z)/2,U.w=(q.w+c.w)/2,U}static TransformCoordinates(q,c){return h.TransformCoordinatesToRef(q,c,new h)}static TransformCoordinatesToRef(q,c,U){return h.TransformCoordinatesFromFloatsToRef(q._x,q._y,q._z,c,U),U}static TransformCoordinatesFromFloatsToRef(q,c,U,J,Q){const s=J.m,g=q*s[0]+c*s[4]+U*s[8]+s[12],X=q*s[1]+c*s[5]+U*s[9]+s[13],n=q*s[2]+c*s[6]+U*s[10]+s[14],W=q*s[3]+c*s[7]+U*s[11]+s[15];return Q.x=g,Q.y=X,Q.z=n,Q.w=W,Q}static TransformNormal(q,c){return h.TransformNormalToRef(q,c,new h)}static TransformNormalToRef(q,c,U){const J=c.m,Q=q.x*J[0]+q.y*J[4]+q.z*J[8],s=q.x*J[1]+q.y*J[5]+q.z*J[9],g=q.x*J[2]+q.y*J[6]+q.z*J[10];return U.x=Q,U.y=s,U.z=g,U.w=q.w,U}static TransformNormalFromFloatsToRef(q,c,U,J,Q,s){const g=Q.m;return s.x=q*g[0]+c*g[4]+U*g[8],s.y=q*g[1]+c*g[5]+U*g[9],s.z=q*g[2]+c*g[6]+U*g[10],s.w=J,s}static FromVector3(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new h(q._x,q._y,q._z,c)}static Dot(q,c){return q.x*c.x+q.y*c.y+q.z*c.z+q.w*c.w}}h._V8PerformanceHack=new h(.5,.5,.5,.5),h._ZeroReadOnly=h.Zero(),Object.defineProperties(h.prototype,{dimension:{value:[4]},rank:{value:1}});class o{get x(){return this._x}set x(q){this._x=q,this._isDirty=!0}get y(){return this._y}set y(q){this._y=q,this._isDirty=!0}get z(){return this._z}set z(q){this._z=q,this._isDirty=!0}get w(){return this._w}set w(q){this._w=q,this._isDirty=!0}constructor(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=q,this._y=c,this._z=U,this._w=J}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let q=r(this._x);return q=397*q^r(this._y),q=397*q^r(this._z),q=397*q^r(this._w),q}rc(){return[this._x,this._y,this._z,this._w]}toArray(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return q[c]=this._x,q[c+1]=this._y,q[c+2]=this._z,q[c+3]=this._w,this}BU(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.FromArrayToRef(q,c,this)}equals(q){return q&&this._x===q._x&&this._y===q._y&&this._z===q._z&&this._w===q._w}equalsWithEpsilon(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.d;return q&&(0,n.WithinEpsilon)(this._x,q._x,c)&&(0,n.WithinEpsilon)(this._y,q._y,c)&&(0,n.WithinEpsilon)(this._z,q._z,c)&&(0,n.WithinEpsilon)(this._w,q._w,c)}isApprox(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.d;return q&&((0,n.WithinEpsilon)(this._x,q._x,c)&&(0,n.WithinEpsilon)(this._y,q._y,c)&&(0,n.WithinEpsilon)(this._z,q._z,c)&&(0,n.WithinEpsilon)(this._w,q._w,c)||(0,n.WithinEpsilon)(this._x,-q._x,c)&&(0,n.WithinEpsilon)(this._y,-q._y,c)&&(0,n.WithinEpsilon)(this._z,-q._z,c)&&(0,n.WithinEpsilon)(this._w,-q._w,c))}clone(){return new o(this._x,this._y,this._z,this._w)}X(q){return this._x=q._x,this._y=q._y,this._z=q._z,this._w=q._w,this._isDirty=!0,this}bc(q,c,U,J){return this._x=q,this._y=c,this._z=U,this._w=J,this._isDirty=!0,this}set(q,c,U,J){return this.bc(q,c,U,J)}tc(q){return this.bc(q,q,q,q)}add(q){return new o(this._x+q._x,this._y+q._y,this._z+q._z,this._w+q._w)}addInPlace(q){return this._x+=q._x,this._y+=q._y,this._z+=q._z,this._w+=q._w,this._isDirty=!0,this}addToRef(q,c){return c._x=this._x+q._x,c._y=this._y+q._y,c._z=this._z+q._z,c._w=this._w+q._w,c._isDirty=!0,c}addInPlaceFromFloats(q,c,U,J){return this._x+=q,this._y+=c,this._z+=U,this._w+=J,this._isDirty=!0,this}subtractToRef(q,c){return c._x=this._x-q._x,c._y=this._y-q._y,c._z=this._z-q._z,c._w=this._w-q._w,c._isDirty=!0,c}subtractFromFloats(q,c,U,J){return this.subtractFromFloatsToRef(q,c,U,J,new o)}subtractFromFloatsToRef(q,c,U,J,Q){return Q._x=this._x-q,Q._y=this._y-c,Q._z=this._z-U,Q._w=this._w-J,Q._isDirty=!0,Q}eU(q){return new o(this._x-q._x,this._y-q._y,this._z-q._z,this._w-q._w)}Uu(q){return this._x-=q._x,this._y-=q._y,this._z-=q._z,this._w-=q._w,this._isDirty=!0,this}scale(q){return new o(this._x*q,this._y*q,this._z*q,this._w*q)}scaleToRef(q,c){return c._x=this._x*q,c._y=this._y*q,c._z=this._z*q,c._w=this._w*q,c._isDirty=!0,c}scaleInPlace(q){return this._x*=q,this._y*=q,this._z*=q,this._w*=q,this._isDirty=!0,this}scaleAndAddToRef(q,c){return c._x+=this._x*q,c._y+=this._y*q,c._z+=this._z*q,c._w+=this._w*q,c._isDirty=!0,c}multiply(q){const c=new o(0,0,0,1);return this.multiplyToRef(q,c),c}multiplyToRef(q,c){const U=this._x*q._w+this._y*q._z-this._z*q._y+this._w*q._x,J=-this._x*q._z+this._y*q._w+this._z*q._x+this._w*q._y,Q=this._x*q._y-this._y*q._x+this._z*q._w+this._w*q._z,s=-this._x*q._x-this._y*q._y-this._z*q._z+this._w*q._w;return c.bc(U,J,Q,s),c}multiplyInPlace(q){return this.multiplyToRef(q,this)}multiplyByFloats(q,c,U,J){return this._x*=q,this._y*=c,this._z*=U,this._w*=J,this._isDirty=!0,this}divide(q){throw new ReferenceError("Can not divide a quaternion")}divideToRef(q,c){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(q){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new o)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(q){return q._x=-this._x,q._y=-this._y,q._z=-this._z,q._w=-this._w,q._isDirty=!0,q}equalsToFloats(q,c,U,J){return this._x===q&&this._y===c&&this._z===U&&this._w===J}floorToRef(q){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(q){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(q){return q.bc(-this._x,-this._y,-this._z,this._w),q}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new o(-this._x,-this._y,-this._z,this._w)}invert(){const q=this.conjugate(),c=this.lengthSquared();return 0==c||1==c||q.scaleInPlace(1/c),q}invertInPlace(){this.conjugateInPlace();const q=this.lengthSquared();return 0==q||1==q||this.scaleInPlace(1/q),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(q){return 0===q||1===q?this:this.scaleInPlace(1/q)}normalizeToNew(){const q=new o(0,0,0,1);return this.normalizeToRef(q),q}normalizeToRef(q){const c=this.length();return 0===c||1===c?q.bc(this._x,this._y,this._z,this._w):this.scaleToRef(1/c,q)}toEulerAngles(){const q=b.Zero();return this.toEulerAnglesToRef(q),q}toEulerAnglesToRef(q){const c=this._z,U=this._x,J=this._y,Q=this._w,s=J*c-U*Q,g=.4999999;if(s<-g)q._y=2*Math.atan2(J,Q),q._x=Math.PI/2,q._z=0,q._isDirty=!0;else if(s>g)q._y=2*Math.atan2(J,Q),q._x=-Math.PI/2,q._z=0,q._isDirty=!0;else{const g=Q*Q,X=c*c,n=U*U,W=J*J;q._z=Math.atan2(2*(U*J+c*Q),-X-n+W+g),q._x=Math.asin(-2*s),q._y=Math.atan2(2*(c*U+J*Q),X-n-W+g),q._isDirty=!0}return q}toAlphaBetaGammaToRef(q){const c=this._z,U=this._x,J=this._y,Q=this._w,s=Math.sqrt(U*U+J*J),g=Math.sqrt(c*c+Q*Q),X=2*Math.atan2(s,g),n=2*Math.atan2(c,Q),W=2*Math.atan2(J,U),D=(n+W)/2,u=(n-W)/2;return q.set(u,X,D),q}toRotationMatrix(q){return a.FromQuaternionToRef(this,q),q}fromRotationMatrix(q){return o.FromRotationMatrixToRef(q,this),this}dot(q){return this._x*q._x+this._y*q._y+this._z*q._z+this._w*q._w}toAxisAngle(){const q=b.Zero();return{axis:q,angle:this.toAxisAngleToRef(q)}}toAxisAngleToRef(q){let c=0;const U=Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z),J=this._w;return U>0?(c=2*Math.atan2(U,J),q.set(this._x/U,this._y/U,this._z/U)):(c=0,q.set(1,0,0)),c}static FromRotationMatrix(q){const c=new o;return o.FromRotationMatrixToRef(q,c),c}static FromRotationMatrixToRef(q,c){const U=q.m,J=U[0],Q=U[4],s=U[8],g=U[1],X=U[5],n=U[9],W=U[2],D=U[6],u=U[10],K=J+X+u;let r;return K>0?(r=.5/Math.sqrt(K+1),c._w=.25/r,c._x=(D-n)*r,c._y=(s-W)*r,c._z=(g-Q)*r,c._isDirty=!0):J>X&&J>u?(r=2*Math.sqrt(1+J-X-u),c._w=(D-n)/r,c._x=.25*r,c._y=(Q+g)/r,c._z=(s+W)/r,c._isDirty=!0):X>u?(r=2*Math.sqrt(1+X-J-u),c._w=(s-W)/r,c._x=(Q+g)/r,c._y=.25*r,c._z=(n+D)/r,c._isDirty=!0):(r=2*Math.sqrt(1+u-J-X),c._w=(g-Q)/r,c._x=(s+W)/r,c._y=(n+D)/r,c._z=.25*r,c._isDirty=!0),c}static Dot(q,c){return q._x*c._x+q._y*c._y+q._z*c._z+q._w*c._w}static AreClose(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const J=o.Dot(q,c);return 1-J*J<=U}static SmoothToRef(q,c,U,J,Q){let s=0===J?1:U/J;return s=(0,n.Clamp)(s,0,1),o.SlerpToRef(q,c,s,Q),Q}static Zero(){return new o(0,0,0,0)}static Inverse(q){return new o(-q._x,-q._y,-q._z,q._w)}static InverseToRef(q,c){return c.set(-q._x,-q._y,-q._z,q._w),c}static Identity(){return new o(0,0,0,1)}static IsIdentity(q){return q&&0===q._x&&0===q._y&&0===q._z&&1===q._w}static RotationAxis(q,c){return o.RotationAxisToRef(q,c,new o)}static RotationAxisToRef(q,c,U){U._w=Math.cos(c/2);const J=Math.sin(c/2)/q.length();return U._x=q._x*J,U._y=q._y*J,U._z=q._z*J,U._isDirty=!0,U}static Ic(q,c){return c||(c=0),new o(q[c],q[c+1],q[c+2],q[c+3])}static FromArrayToRef(q,c,U){return U._x=q[c],U._y=q[c+1],U._z=q[c+2],U._w=q[c+3],U._isDirty=!0,U}static FromFloatsToRef(q,c,U,J,Q){return Q.bc(q,c,U,J),Q}static FromEulerAngles(q,c,U){const J=new o;return o.RotationYawPitchRollToRef(c,q,U,J),J}static FromEulerAnglesToRef(q,c,U,J){return o.RotationYawPitchRollToRef(c,q,U,J),J}static FromEulerVector(q){const c=new o;return o.RotationYawPitchRollToRef(q._y,q._x,q._z,c),c}static FromEulerVectorToRef(q,c){return o.RotationYawPitchRollToRef(q._y,q._x,q._z,c),c}static FromUnitVectorsToRef(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J.d;const s=b.Dot(q,c)+1;return s<Q?Math.abs(q.x)>Math.abs(q.z)?U.set(-q.y,q.x,0,0):U.set(0,-q.z,q.y,0):(b.CrossToRef(q,c,R.hc[0]),U.set(R.hc[0].x,R.hc[0].y,R.hc[0].z,s)),U.normalize()}static RotationYawPitchRoll(q,c,U){const J=new o;return o.RotationYawPitchRollToRef(q,c,U,J),J}static RotationYawPitchRollToRef(q,c,U,J){const Q=.5*U,s=.5*c,g=.5*q,X=Math.sin(Q),n=Math.cos(Q),W=Math.sin(s),D=Math.cos(s),u=Math.sin(g),K=Math.cos(g);return J._x=K*W*n+u*D*X,J._y=u*D*n-K*W*X,J._z=K*D*X-u*W*n,J._w=K*D*n+u*W*X,J._isDirty=!0,J}static RotationAlphaBetaGamma(q,c,U){const J=new o;return o.RotationAlphaBetaGammaToRef(q,c,U,J),J}static RotationAlphaBetaGammaToRef(q,c,U,J){const Q=.5*(U+q),s=.5*(U-q),g=.5*c;return J._x=Math.cos(s)*Math.sin(g),J._y=Math.sin(s)*Math.sin(g),J._z=Math.sin(Q)*Math.cos(g),J._w=Math.cos(Q)*Math.cos(g),J._isDirty=!0,J}static RotationQuaternionFromAxis(q,c,U){const J=new o(0,0,0,0);return o.RotationQuaternionFromAxisToRef(q,c,U,J),J}static RotationQuaternionFromAxisToRef(q,c,U,J){const Q=p.Matrix[0];return q=q.normalizeToRef(p.hc[0]),c=c.normalizeToRef(p.hc[1]),U=U.normalizeToRef(p.hc[2]),a.FromXYZAxesToRef(q,c,U,Q),o.FromRotationMatrixToRef(Q,J),J}static FromLookDirectionLH(q,c){const U=new o;return o.FromLookDirectionLHToRef(q,c,U),U}static FromLookDirectionLHToRef(q,c,U){const J=p.Matrix[0];return a.LookDirectionLHToRef(q,c,J),o.FromRotationMatrixToRef(J,U),U}static FromLookDirectionRH(q,c){const U=new o;return o.FromLookDirectionRHToRef(q,c,U),U}static FromLookDirectionRHToRef(q,c,U){const J=p.Matrix[0];return a.LookDirectionRHToRef(q,c,J),o.FromRotationMatrixToRef(J,U)}static Slerp(q,c,U){const J=o.Identity();return o.SlerpToRef(q,c,U,J),J}static SlerpToRef(q,c,U,J){let Q,s,g=q._x*c._x+q._y*c._y+q._z*c._z+q._w*c._w,X=!1;if(g<0&&(X=!0,g=-g),g>.999999)s=1-U,Q=X?-U:U;else{const q=Math.acos(g),c=1/Math.sin(q);s=Math.sin((1-U)*q)*c,Q=X?-Math.sin(U*q)*c:Math.sin(U*q)*c}return J._x=s*q._x+Q*c._x,J._y=s*q._y+Q*c._y,J._z=s*q._z+Q*c._z,J._w=s*q._w+Q*c._w,J._isDirty=!0,J}static Hermite(q,c,U,J,Q){const s=Q*Q,g=Q*s,X=2*g-3*s+1,n=-2*g+3*s,W=g-2*s+Q,D=g-s,u=q._x*X+U._x*n+c._x*W+J._x*D,K=q._y*X+U._y*n+c._y*W+J._y*D,r=q._z*X+U._z*n+c._z*W+J._z*D,H=q._w*X+U._w*n+c._w*W+J._w*D;return new o(u,K,r,H)}static Hermite1stDerivative(q,c,U,J,Q){const s=new o;return this.Hermite1stDerivativeToRef(q,c,U,J,Q,s),s}static Hermite1stDerivativeToRef(q,c,U,J,Q,s){const g=Q*Q;return s._x=6*(g-Q)*q._x+(3*g-4*Q+1)*c._x+6*(-g+Q)*U._x+(3*g-2*Q)*J._x,s._y=6*(g-Q)*q._y+(3*g-4*Q+1)*c._y+6*(-g+Q)*U._y+(3*g-2*Q)*J._y,s._z=6*(g-Q)*q._z+(3*g-4*Q+1)*c._z+6*(-g+Q)*U._z+(3*g-2*Q)*J._z,s._w=6*(g-Q)*q._w+(3*g-4*Q+1)*c._w+6*(-g+Q)*U._w+(3*g-2*Q)*J._w,s._isDirty=!0,s}static Normalize(q){const c=o.Zero();return o.NormalizeToRef(q,c),c}static NormalizeToRef(q,c){return q.normalizeToRef(c),c}static Clamp(q,c,U){const J=new o;return o.ClampToRef(q,c,U,J),J}static ClampToRef(q,c,U,J){return J.bc((0,n.Clamp)(q.x,c.x,U.x),(0,n.Clamp)(q.y,c.y,U.y),(0,n.Clamp)(q.z,c.z,U.z),(0,n.Clamp)(q.w,c.w,U.w))}static Random(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new o((0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c))}static RandomToRef(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).bc((0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c),(0,n.RandomRange)(q,c))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(q,c){return Math.sqrt(o.DistanceSquared(q,c))}static DistanceSquared(q,c){const U=q.x-c.x,J=q.y-c.y,Q=q.z-c.z,s=q.w-c.w;return U*U+J*J+Q*Q+s*s}static Center(q,c){return o.CenterToRef(q,c,o.Zero())}static CenterToRef(q,c,U){return U.bc((q.x+c.x)/2,(q.y+c.y)/2,(q.z+c.z)/2,(q.w+c.w)/2)}}o._V8PerformanceHack=new o(.5,.5,.5,.5),Object.defineProperties(o.prototype,{dimension:{value:[4]},rank:{value:1}});class a{static get Use64Bits(){return g.d.MatrixUse64Bits}get m(){return this.tK}markAsUpdated(){this.updateFlag=W._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=q,this._isIdentity3x2=q||U,this._isIdentityDirty=!this._isIdentity&&c,this._isIdentity3x2Dirty=!this._isIdentity3x2&&J}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,g.d.MatrixTrackPrecisionChange&&g.d.MatrixTrackedMatrices.push(this),this.tK=new g.d.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const q=this.tK;this._isIdentity=1===q[0]&&0===q[1]&&0===q[2]&&0===q[3]&&0===q[4]&&1===q[5]&&0===q[6]&&0===q[7]&&0===q[8]&&0===q[9]&&1===q[10]&&0===q[11]&&0===q[12]&&0===q[13]&&0===q[14]&&1===q[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.tK[0]||1!==this.tK[5]||1!==this.tK[15]||0!==this.tK[1]||0!==this.tK[2]||0!==this.tK[3]||0!==this.tK[4]||0!==this.tK[6]||0!==this.tK[7]||0!==this.tK[8]||0!==this.tK[9]||0!==this.tK[10]||0!==this.tK[11]||0!==this.tK[12]||0!==this.tK[13]||0!==this.tK[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const q=this.tK,c=q[0],U=q[1],J=q[2],Q=q[3],s=q[4],g=q[5],X=q[6],n=q[7],W=q[8],D=q[9],u=q[10],K=q[11],r=q[12],H=q[13],b=q[14],h=q[15],o=u*h-b*K,a=D*h-H*K,p=D*b-H*u,R=W*h-r*K,I=W*b-u*r,t=W*H-r*D;return c*+(g*o-X*a+n*p)+U*-(s*o-X*R+n*I)+J*+(s*a-g*R+n*t)+Q*-(s*p-g*I+X*t)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!q)return this.tK;const U=this.tK;for(let J=0;J<16;J++)q[c+J]=U[J];return this}rc(){return this.tK}BU(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a.FromArrayToRef(q,c,this)}bc(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];return a.FromArrayToRef(c,0,this)}set(){const q=this.tK;for(let c=0;c<16;c++)q[c]=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}tc(q){const c=this.tK;for(let U=0;U<16;U++)c[U]=q;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return a.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(q){const c=new a;return this.addToRef(q,c),c}addToRef(q,c){const U=this.tK,J=c.tK,Q=q.m;for(let s=0;s<16;s++)J[s]=U[s]+Q[s];return c.markAsUpdated(),c}addToSelf(q){const c=this.tK,U=q.m;return c[0]+=U[0],c[1]+=U[1],c[2]+=U[2],c[3]+=U[3],c[4]+=U[4],c[5]+=U[5],c[6]+=U[6],c[7]+=U[7],c[8]+=U[8],c[9]+=U[9],c[10]+=U[10],c[11]+=U[11],c[12]+=U[12],c[13]+=U[13],c[14]+=U[14],c[15]+=U[15],this.markAsUpdated(),this}addInPlace(q){const c=this.tK,U=q.m;for(let J=0;J<16;J++)c[J]+=U[J];return this.markAsUpdated(),this}addInPlaceFromFloats(){const q=this.tK;for(let c=0;c<16;c++)q[c]+=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}eU(q){const c=this.tK,U=q.m;for(let J=0;J<16;J++)c[J]-=U[J];return this.markAsUpdated(),this}subtractToRef(q,c){const U=this.tK,J=q.m,Q=c.tK;for(let s=0;s<16;s++)Q[s]=U[s]-J[s];return c.markAsUpdated(),c}Uu(q){const c=this.tK,U=q.m;for(let J=0;J<16;J++)c[J]-=U[J];return this.markAsUpdated(),this}subtractFromFloats(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];return this.subtractFromFloatsToRef(...c,new a)}subtractFromFloatsToRef(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];const J=c.pop(),Q=this.tK,s=J.tK,g=c;for(let X=0;X<16;X++)s[X]=Q[X]-g[X];return J.markAsUpdated(),J}invertToRef(q){return!0===this._isIdentity?(a.IdentityToRef(q),q):(K(this,q.rc())?q.markAsUpdated():q.X(this),q)}addAtIndex(q,c){return this.tK[q]+=c,this.markAsUpdated(),this}multiplyAtIndex(q,c){return this.tK[q]*=c,this.markAsUpdated(),this}setTranslationFromFloats(q,c,U){return this.tK[12]=q,this.tK[13]=c,this.tK[14]=U,this.markAsUpdated(),this}addTranslationFromFloats(q,c,U){return this.tK[12]+=q,this.tK[13]+=c,this.tK[14]+=U,this.markAsUpdated(),this}setTranslation(q){return this.setTranslationFromFloats(q._x,q._y,q._z)}getTranslation(){return new b(this.tK[12],this.tK[13],this.tK[14])}getTranslationToRef(q){return q.x=this.tK[12],q.y=this.tK[13],q.z=this.tK[14],q}removeRotationAndScaling(){const q=this.m;return a.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,q[12],q[13],q[14],q[15],this),this._updateIdentityStatus(0===q[12]&&0===q[13]&&0===q[14]&&1===q[15]),this}X(q){q.copyToArray(this.tK);const c=q;return this.updateFlag=c.updateFlag,this._updateIdentityStatus(c._isIdentity,c._isIdentityDirty,c._isIdentity3x2,c._isIdentity3x2Dirty),this}copyToArray(q){return u(this,q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),this}multiply(q){const c=new a;return this.multiplyToRef(q,c),c}multiplyInPlace(q){const c=this.tK,U=q.m;for(let J=0;J<16;J++)c[J]*=U[J];return this.markAsUpdated(),this}multiplyByFloats(){const q=this.tK;for(let c=0;c<16;c++)q[c]*=c<0||arguments.length<=c?void 0:arguments[c];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];const J=c.pop(),Q=this.tK,s=J.tK,g=c;for(let X=0;X<16;X++)s[X]=Q[X]*g[X];return J.markAsUpdated(),J}multiplyToRef(q,c){return this._isIdentity?(c.X(q),c):q._isIdentity?(c.X(this),c):(this.multiplyToArray(q,c.tK,0),c.markAsUpdated(),c)}multiplyToArray(q,c,U){return D(this,q,c,U),this}divide(q){return this.divideToRef(q,new a)}divideToRef(q,c){const U=this.tK,J=q.m,Q=c.tK;for(let s=0;s<16;s++)Q[s]=U[s]/J[s];return c.markAsUpdated(),c}divideInPlace(q){const c=this.tK,U=q.m;for(let J=0;J<16;J++)c[J]/=U[J];return this.markAsUpdated(),this}minimizeInPlace(q){const c=this.tK,U=q.m;for(let J=0;J<16;J++)c[J]=Math.min(c[J],U[J]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const q=this.tK;for(let c=0;c<16;c++)q[c]=Math.min(q[c],c<0||arguments.length<=c?void 0:arguments[c]);return this.markAsUpdated(),this}maximizeInPlace(q){const c=this.tK,U=q.m;for(let J=0;J<16;J++)c[J]=Math.min(c[J],U[J]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const q=this.tK;for(let c=0;c<16;c++)q[c]=Math.min(q[c],c<0||arguments.length<=c?void 0:arguments[c]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new a)}negateInPlace(){const q=this.tK;for(let c=0;c<16;c++)q[c]=-q[c];return this.markAsUpdated(),this}negateToRef(q){const c=this.tK,U=q.tK;for(let J=0;J<16;J++)U[J]=-c[J];return q.markAsUpdated(),q}equals(q){const c=q;if(!c)return!1;if((this._isIdentity||c._isIdentity)&&!this._isIdentityDirty&&!c._isIdentityDirty)return this._isIdentity&&c._isIdentity;const U=this.m,J=c.m;return U[0]===J[0]&&U[1]===J[1]&&U[2]===J[2]&&U[3]===J[3]&&U[4]===J[4]&&U[5]===J[5]&&U[6]===J[6]&&U[7]===J[7]&&U[8]===J[8]&&U[9]===J[9]&&U[10]===J[10]&&U[11]===J[11]&&U[12]===J[12]&&U[13]===J[13]&&U[14]===J[14]&&U[15]===J[15]}equalsWithEpsilon(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=this.tK,J=q.m;for(let Q=0;Q<16;Q++)if(!(0,n.WithinEpsilon)(U[Q],J[Q],c))return!1;return!0}equalsToFloats(){const q=this.tK;for(let c=0;c<16;c++)if(q[c]!=(c<0||arguments.length<=c?void 0:arguments[c]))return!1;return!0}floor(){return this.floorToRef(new a)}floorToRef(q){const c=this.tK,U=q.tK;for(let J=0;J<16;J++)U[J]=Math.floor(c[J]);return q.markAsUpdated(),q}fract(){return this.fractToRef(new a)}fractToRef(q){const c=this.tK,U=q.tK;for(let J=0;J<16;J++)U[J]=c[J]-Math.floor(c[J]);return q.markAsUpdated(),q}clone(){const q=new a;return q.X(this),q}getClassName(){return"Matrix"}getHashCode(){let q=r(this.tK[0]);for(let c=1;c<16;c++)q=397*q^r(this.tK[c]);return q}decomposeToTransformNode(q){return q.rotationQuaternion=q.rotationQuaternion||new o,this.decompose(q.ac,q.rotationQuaternion,q.position)}decompose(q,c,U,J){let Q=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return U&&U.tc(0),q&&q.tc(1),c&&c.bc(0,0,0,1),!0;const s=this.tK;if(U&&U.bc(s[12],s[13],s[14]),(q=q||p.hc[0]).x=Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2]),q.y=Math.sqrt(s[4]*s[4]+s[5]*s[5]+s[6]*s[6]),q.z=Math.sqrt(s[8]*s[8]+s[9]*s[9]+s[10]*s[10]),J){const c=(Q?J.absoluteScaling.x:J.ac.x)<0?-1:1,U=(Q?J.absoluteScaling.y:J.ac.y)<0?-1:1,s=(Q?J.absoluteScaling.z:J.ac.z)<0?-1:1;q.x*=c,q.y*=U,q.z*=s}else this.determinant()<=0&&(q.y*=-1);if(0===q._x||0===q._y||0===q._z)return c&&c.bc(0,0,0,1),!1;if(c){const U=1/q._x,J=1/q._y,Q=1/q._z;a.FromValuesToRef(s[0]*U,s[1]*U,s[2]*U,0,s[4]*J,s[5]*J,s[6]*J,0,s[8]*Q,s[9]*Q,s[10]*Q,0,0,0,0,1,p.Matrix[0]),o.FromRotationMatrixToRef(p.Matrix[0],c)}return!0}getRow(q){if(q<0||q>3)return null;const c=4*q;return new h(this.tK[c+0],this.tK[c+1],this.tK[c+2],this.tK[c+3])}getRowToRef(q,c){if(q>=0&&q<=3){const U=4*q;c.x=this.tK[U+0],c.y=this.tK[U+1],c.z=this.tK[U+2],c.w=this.tK[U+3]}return c}setRow(q,c){return this.setRowFromFloats(q,c.x,c.y,c.z,c.w)}transpose(){const q=new a;return a.TransposeToRef(this,q),q}transposeToRef(q){return a.TransposeToRef(this,q),q}setRowFromFloats(q,c,U,J,Q){if(q<0||q>3)return this;const s=4*q;return this.tK[s+0]=c,this.tK[s+1]=U,this.tK[s+2]=J,this.tK[s+3]=Q,this.markAsUpdated(),this}scale(q){const c=new a;return this.scaleToRef(q,c),c}scaleToRef(q,c){for(let U=0;U<16;U++)c.tK[U]=this.tK[U]*q;return c.markAsUpdated(),c}scaleAndAddToRef(q,c){for(let U=0;U<16;U++)c.tK[U]+=this.tK[U]*q;return c.markAsUpdated(),c}scaleInPlace(q){const c=this.tK;for(let U=0;U<16;U++)c[U]*=q;return this.markAsUpdated(),this}toNormalMatrix(q){const c=p.Matrix[0];this.invertToRef(c),c.transposeToRef(q);const U=q.tK;return a.FromValuesToRef(U[0],U[1],U[2],0,U[4],U[5],U[6],0,U[8],U[9],U[10],0,0,0,0,1,q),q}getRotationMatrix(){const q=new a;return this.getRotationMatrixToRef(q),q}getRotationMatrixToRef(q){const c=p.hc[0];if(!this.decompose(c))return a.IdentityToRef(q),q;const U=this.tK,J=1/c._x,Q=1/c._y,s=1/c._z;return a.FromValuesToRef(U[0]*J,U[1]*J,U[2]*J,0,U[4]*Q,U[5]*Q,U[6]*Q,0,U[8]*s,U[9]*s,U[10]*s,0,0,0,0,1,q),q}toggleModelMatrixHandInPlace(){const q=this.tK;return q[2]*=-1,q[6]*=-1,q[8]*=-1,q[9]*=-1,q[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const q=this.tK;return q[8]*=-1,q[9]*=-1,q[10]*=-1,q[11]*=-1,this.markAsUpdated(),this}static Ic(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const U=new a;return a.FromArrayToRef(q,c,U),U}static FromArrayToRef(q,c,U){for(let J=0;J<16;J++)U.tK[J]=q[J+c];return U.markAsUpdated(),U}static FromFloat32ArrayToRefScaled(q,c,U,J){return J.tK[0]=q[0+c]*U,J.tK[1]=q[1+c]*U,J.tK[2]=q[2+c]*U,J.tK[3]=q[3+c]*U,J.tK[4]=q[4+c]*U,J.tK[5]=q[5+c]*U,J.tK[6]=q[6+c]*U,J.tK[7]=q[7+c]*U,J.tK[8]=q[8+c]*U,J.tK[9]=q[9+c]*U,J.tK[10]=q[10+c]*U,J.tK[11]=q[11+c]*U,J.tK[12]=q[12+c]*U,J.tK[13]=q[13+c]*U,J.tK[14]=q[14+c]*U,J.tK[15]=q[15+c]*U,J.markAsUpdated(),J}static get IdentityReadOnly(){return a._IdentityReadOnly}static FromValuesToRef(q,c,U,J,Q,s,g,X,n,W,D,u,K,r,H,b,h){const o=h.tK;o[0]=q,o[1]=c,o[2]=U,o[3]=J,o[4]=Q,o[5]=s,o[6]=g,o[7]=X,o[8]=n,o[9]=W,o[10]=D,o[11]=u,o[12]=K,o[13]=r,o[14]=H,o[15]=b,h.markAsUpdated()}static FromValues(q,c,U,J,Q,s,g,X,n,W,D,u,K,r,H,b){const h=new a,o=h.tK;return o[0]=q,o[1]=c,o[2]=U,o[3]=J,o[4]=Q,o[5]=s,o[6]=g,o[7]=X,o[8]=n,o[9]=W,o[10]=D,o[11]=u,o[12]=K,o[13]=r,o[14]=H,o[15]=b,h.markAsUpdated(),h}static Compose(q,c,U){const J=new a;return a.ComposeToRef(q,c,U,J),J}static ComposeToRef(q,c,U,J){const Q=J.tK,s=c._x,g=c._y,X=c._z,n=c._w,W=s+s,D=g+g,u=X+X,K=s*W,r=s*D,H=s*u,b=g*D,h=g*u,o=X*u,a=n*W,p=n*D,R=n*u,I=q._x,t=q._y,C=q._z;return Q[0]=(1-(b+o))*I,Q[1]=(r+R)*I,Q[2]=(H-p)*I,Q[3]=0,Q[4]=(r-R)*t,Q[5]=(1-(K+o))*t,Q[6]=(h+a)*t,Q[7]=0,Q[8]=(H+p)*C,Q[9]=(h-a)*C,Q[10]=(1-(K+b))*C,Q[11]=0,Q[12]=U._x,Q[13]=U._y,Q[14]=U._z,Q[15]=1,J.markAsUpdated(),J}static Identity(){const q=a.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return q._updateIdentityStatus(!0),q}static IdentityToRef(q){return a.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,q),q._updateIdentityStatus(!0),q}static Zero(){const q=a.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return q._updateIdentityStatus(!1),q}static RotationX(q){const c=new a;return a.RotationXToRef(q,c),c}static Invert(q){const c=new a;return q.invertToRef(c),c}static RotationXToRef(q,c){const U=Math.sin(q),J=Math.cos(q);return a.FromValuesToRef(1,0,0,0,0,J,U,0,0,-U,J,0,0,0,0,1,c),c._updateIdentityStatus(1===J&&0===U),c}static RotationY(q){const c=new a;return a.RotationYToRef(q,c),c}static RotationYToRef(q,c){const U=Math.sin(q),J=Math.cos(q);return a.FromValuesToRef(J,0,-U,0,0,1,0,0,U,0,J,0,0,0,0,1,c),c._updateIdentityStatus(1===J&&0===U),c}static RotationZ(q){const c=new a;return a.RotationZToRef(q,c),c}static RotationZToRef(q,c){const U=Math.sin(q),J=Math.cos(q);return a.FromValuesToRef(J,U,0,0,-U,J,0,0,0,0,1,0,0,0,0,1,c),c._updateIdentityStatus(1===J&&0===U),c}static RotationAxis(q,c){const U=new a;return a.RotationAxisToRef(q,c,U),U}static RotationAxisToRef(q,c,U){const J=Math.sin(-c),Q=Math.cos(-c),s=1-Q;q=q.normalizeToRef(p.hc[0]);const g=U.tK;return g[0]=q._x*q._x*s+Q,g[1]=q._x*q._y*s-q._z*J,g[2]=q._x*q._z*s+q._y*J,g[3]=0,g[4]=q._y*q._x*s+q._z*J,g[5]=q._y*q._y*s+Q,g[6]=q._y*q._z*s-q._x*J,g[7]=0,g[8]=q._z*q._x*s-q._y*J,g[9]=q._z*q._y*s+q._x*J,g[10]=q._z*q._z*s+Q,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,U.markAsUpdated(),U}static RotationAlignToRef(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const s=b.Dot(c,q),g=U.tK;if(s<-1+J.d)g[0]=-1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=Q?1:-1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=Q?-1:1,g[11]=0;else{const U=b.Cross(c,q),J=1/(1+s);g[0]=U._x*U._x*J+s,g[1]=U._y*U._x*J-U._z,g[2]=U._z*U._x*J+U._y,g[3]=0,g[4]=U._x*U._y*J+U._z,g[5]=U._y*U._y*J+s,g[6]=U._z*U._y*J-U._x,g[7]=0,g[8]=U._x*U._z*J-U._y,g[9]=U._y*U._z*J+U._x,g[10]=U._z*U._z*J+s,g[11]=0}return g[12]=0,g[13]=0,g[14]=0,g[15]=1,U.markAsUpdated(),U}static RotationYawPitchRoll(q,c,U){const J=new a;return a.RotationYawPitchRollToRef(q,c,U,J),J}static RotationYawPitchRollToRef(q,c,U,J){return o.RotationYawPitchRollToRef(q,c,U,p.Quaternion[0]),p.Quaternion[0].toRotationMatrix(J),J}static Scaling(q,c,U){const J=new a;return a.ScalingToRef(q,c,U,J),J}static ScalingToRef(q,c,U,J){return a.FromValuesToRef(q,0,0,0,0,c,0,0,0,0,U,0,0,0,0,1,J),J._updateIdentityStatus(1===q&&1===c&&1===U),J}static Translation(q,c,U){const J=new a;return a.TranslationToRef(q,c,U,J),J}static TranslationToRef(q,c,U,J){return a.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,q,c,U,1,J),J._updateIdentityStatus(0===q&&0===c&&0===U),J}static Lerp(q,c,U){const J=new a;return a.LerpToRef(q,c,U,J),J}static LerpToRef(q,c,U,J){const Q=J.tK,s=q.m,g=c.m;for(let X=0;X<16;X++)Q[X]=s[X]*(1-U)+g[X]*U;return J.markAsUpdated(),J}static DecomposeLerp(q,c,U){const J=new a;return a.DecomposeLerpToRef(q,c,U,J),J}static DecomposeLerpToRef(q,c,U,J){const Q=p.hc[0],s=p.Quaternion[0],g=p.hc[1];q.decompose(Q,s,g);const X=p.hc[2],n=p.Quaternion[1],W=p.hc[3];c.decompose(X,n,W);const D=p.hc[4];b.LerpToRef(Q,X,U,D);const u=p.Quaternion[2];o.SlerpToRef(s,n,U,u);const K=p.hc[5];return b.LerpToRef(g,W,U,K),a.ComposeToRef(D,u,K,J),J}static LookAtLH(q,c,U){const J=new a;return a.LookAtLHToRef(q,c,U,J),J}static LookAtLHToRef(q,c,U,J){const Q=p.hc[0],s=p.hc[1],g=p.hc[2];c.subtractToRef(q,g),g.normalize(),b.CrossToRef(U,g,Q);const X=Q.lengthSquared();0===X?Q.x=1:Q.normalizeFromLength(Math.sqrt(X)),b.CrossToRef(g,Q,s),s.normalize();const n=-b.Dot(Q,q),W=-b.Dot(s,q),D=-b.Dot(g,q);return a.FromValuesToRef(Q._x,s._x,g._x,0,Q._y,s._y,g._y,0,Q._z,s._z,g._z,0,n,W,D,1,J),J}static LookAtRH(q,c,U){const J=new a;return a.LookAtRHToRef(q,c,U,J),J}static LookAtRHToRef(q,c,U,J){const Q=p.hc[0],s=p.hc[1],g=p.hc[2];q.subtractToRef(c,g),g.normalize(),b.CrossToRef(U,g,Q);const X=Q.lengthSquared();0===X?Q.x=1:Q.normalizeFromLength(Math.sqrt(X)),b.CrossToRef(g,Q,s),s.normalize();const n=-b.Dot(Q,q),W=-b.Dot(s,q),D=-b.Dot(g,q);return a.FromValuesToRef(Q._x,s._x,g._x,0,Q._y,s._y,g._y,0,Q._z,s._z,g._z,0,n,W,D,1,J),J}static LookDirectionLH(q,c){const U=new a;return a.LookDirectionLHToRef(q,c,U),U}static LookDirectionLHToRef(q,c,U){const J=p.hc[0];J.X(q),J.scaleInPlace(-1);const Q=p.hc[1];return b.CrossToRef(c,J,Q),a.FromValuesToRef(Q._x,Q._y,Q._z,0,c._x,c._y,c._z,0,J._x,J._y,J._z,0,0,0,0,1,U),U}static LookDirectionRH(q,c){const U=new a;return a.LookDirectionRHToRef(q,c,U),U}static LookDirectionRHToRef(q,c,U){const J=p.hc[2];return b.CrossToRef(c,q,J),a.FromValuesToRef(J._x,J._y,J._z,0,c._x,c._y,c._z,0,q._x,q._y,q._z,0,0,0,0,1,U),U}static OrthoLH(q,c,U,J,Q){const s=new a;return a.OrthoLHToRef(q,c,U,J,s,Q),s}static OrthoLHToRef(q,c,U,J,Q,s){const g=2/q,X=2/c,n=2/(J-U),W=-(J+U)/(J-U);return a.FromValuesToRef(g,0,0,0,0,X,0,0,0,0,n,0,0,0,W,1,Q),s&&Q.multiplyToRef(I,Q),Q._updateIdentityStatus(1===g&&1===X&&1===n&&0===W),Q}static OrthoOffCenterLH(q,c,U,J,Q,s,g){const X=new a;return a.OrthoOffCenterLHToRef(q,c,U,J,Q,s,X,g),X}static OrthoOffCenterLHToRef(q,c,U,J,Q,s,g,X){const n=2/(c-q),W=2/(J-U),D=2/(s-Q),u=-(s+Q)/(s-Q),K=(q+c)/(q-c),r=(J+U)/(U-J);return a.FromValuesToRef(n,0,0,0,0,W,0,0,0,0,D,0,K,r,u,1,g),X&&g.multiplyToRef(I,g),g.markAsUpdated(),g}static ObliqueOffCenterLHToRef(q,c,U,J,Q,s,g,X,n,W,D){const u=-g*Math.cos(X),K=-g*Math.sin(X);return a.TranslationToRef(0,0,-n,p.Matrix[1]),a.FromValuesToRef(1,0,0,0,0,1,0,0,u,K,1,0,0,0,0,1,p.Matrix[0]),p.Matrix[1].multiplyToRef(p.Matrix[0],p.Matrix[0]),a.TranslationToRef(0,0,n,p.Matrix[1]),p.Matrix[0].multiplyToRef(p.Matrix[1],p.Matrix[0]),a.OrthoOffCenterLHToRef(q,c,U,J,Q,s,W,D),p.Matrix[0].multiplyToRef(W,W),W}static OrthoOffCenterRH(q,c,U,J,Q,s,g){const X=new a;return a.OrthoOffCenterRHToRef(q,c,U,J,Q,s,X,g),X}static OrthoOffCenterRHToRef(q,c,U,J,Q,s,g,X){return a.OrthoOffCenterLHToRef(q,c,U,J,Q,s,g,X),g.tK[10]*=-1,g}static ObliqueOffCenterRHToRef(q,c,U,J,Q,s,g,X,n,W,D){const u=g*Math.cos(X),K=g*Math.sin(X);return a.TranslationToRef(0,0,n,p.Matrix[1]),a.FromValuesToRef(1,0,0,0,0,1,0,0,u,K,1,0,0,0,0,1,p.Matrix[0]),p.Matrix[1].multiplyToRef(p.Matrix[0],p.Matrix[0]),a.TranslationToRef(0,0,-n,p.Matrix[1]),p.Matrix[0].multiplyToRef(p.Matrix[1],p.Matrix[0]),a.OrthoOffCenterRHToRef(q,c,U,J,Q,s,W,D),p.Matrix[0].multiplyToRef(W,W),W}static PerspectiveLH(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const g=new a,X=2*U/q,n=2*U/c,W=(J+U)/(J-U),D=-2*J*U/(J-U),u=Math.tan(s);return a.FromValuesToRef(X,0,0,0,0,n,0,u,0,0,W,1,0,0,D,0,g),Q&&g.multiplyToRef(I,g),g._updateIdentityStatus(!1),g}static PerspectiveFovLH(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const X=new a;return a.PerspectiveFovLHToRef(q,c,U,J,X,!0,Q,s,g),X}static PerspectiveFovLHToRef(q,c,U,J,Q){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const W=U,D=J,u=1/Math.tan(.5*q),K=s?u/c:u,r=s?u:u*c,H=n&&0===W?-1:0!==D?(D+W)/(D-W):1,b=n&&0===W?2*D:0!==D?-2*D*W/(D-W):-2*W,h=Math.tan(X);return a.FromValuesToRef(K,0,0,0,0,r,0,h,0,0,H,1,0,0,b,0,Q),g&&Q.multiplyToRef(I,Q),Q._updateIdentityStatus(!1),Q}static PerspectiveFovReverseLHToRef(q,c,U,J,Q){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const n=1/Math.tan(.5*q),W=s?n/c:n,D=s?n:n*c,u=Math.tan(X);return a.FromValuesToRef(W,0,0,0,0,D,0,u,0,0,-U,1,0,0,1,0,Q),g&&Q.multiplyToRef(I,Q),Q._updateIdentityStatus(!1),Q}static PerspectiveFovRH(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,g=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const X=new a;return a.PerspectiveFovRHToRef(q,c,U,J,X,!0,Q,s,g),X}static PerspectiveFovRHToRef(q,c,U,J,Q){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,n=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const W=U,D=J,u=1/Math.tan(.5*q),K=s?u/c:u,r=s?u:u*c,H=n&&0===W?1:0!==D?-(D+W)/(D-W):-1,b=n&&0===W?2*D:0!==D?-2*D*W/(D-W):-2*W,h=Math.tan(X);return a.FromValuesToRef(K,0,0,0,0,r,0,h,0,0,H,-1,0,0,b,0,Q),g&&Q.multiplyToRef(I,Q),Q._updateIdentityStatus(!1),Q}static PerspectiveFovReverseRHToRef(q,c,U,J,Q){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const n=1/Math.tan(.5*q),W=s?n/c:n,D=s?n:n*c,u=Math.tan(X);return a.FromValuesToRef(W,0,0,0,0,D,0,u,0,0,-U,-1,0,0,-1,0,Q),g&&Q.multiplyToRef(I,Q),Q._updateIdentityStatus(!1),Q}static GetFinalMatrix(q,c,U,J,Q,s){const g=q.width,X=q.height,n=q.x,W=q.y,D=a.FromValues(g/2,0,0,0,0,-X/2,0,0,0,0,s-Q,0,n+g/2,X/2+W,Q,1),u=new a;return c.multiplyToRef(U,u),u.multiplyToRef(J,u),u.multiplyToRef(D,u)}static GetAsMatrix2x2(q){const c=q.m,U=[c[0],c[1],c[4],c[5]];return g.d.MatrixUse64Bits?U:new Float32Array(U)}static GetAsMatrix3x3(q){const c=q.m,U=[c[0],c[1],c[2],c[4],c[5],c[6],c[8],c[9],c[10]];return g.d.MatrixUse64Bits?U:new Float32Array(U)}static Transpose(q){const c=new a;return a.TransposeToRef(q,c),c}static TransposeToRef(q,c){const U=q.m,J=U[0],Q=U[4],s=U[8],g=U[12],X=U[1],n=U[5],W=U[9],D=U[13],u=U[2],K=U[6],r=U[10],H=U[14],b=U[3],h=U[7],o=U[11],a=U[15],p=c.tK;return p[0]=J,p[1]=Q,p[2]=s,p[3]=g,p[4]=X,p[5]=n,p[6]=W,p[7]=D,p[8]=u,p[9]=K,p[10]=r,p[11]=H,p[12]=b,p[13]=h,p[14]=o,p[15]=a,c.markAsUpdated(),c._updateIdentityStatus(q._isIdentity,q._isIdentityDirty),c}static Reflection(q){const c=new a;return a.ReflectionToRef(q,c),c}static ReflectionToRef(q,c){q.normalize();const U=q.Jc.x,J=q.Jc.y,Q=q.Jc.z,s=-2*U,g=-2*J,X=-2*Q;return a.FromValuesToRef(s*U+1,g*U,X*U,0,s*J,g*J+1,X*J,0,s*Q,g*Q,X*Q+1,0,s*q.d,g*q.d,X*q.d,1,c),c}static FromXYZAxesToRef(q,c,U,J){return a.FromValuesToRef(q._x,q._y,q._z,0,c._x,c._y,c._z,0,U._x,U._y,U._z,0,0,0,0,1,J),J}static FromQuaternionToRef(q,c){const U=q._x*q._x,J=q._y*q._y,Q=q._z*q._z,s=q._x*q._y,g=q._z*q._w,X=q._z*q._x,n=q._y*q._w,W=q._y*q._z,D=q._x*q._w;return c.tK[0]=1-2*(J+Q),c.tK[1]=2*(s+g),c.tK[2]=2*(X-n),c.tK[3]=0,c.tK[4]=2*(s-g),c.tK[5]=1-2*(Q+U),c.tK[6]=2*(W+D),c.tK[7]=0,c.tK[8]=2*(X+n),c.tK[9]=2*(W-D),c.tK[10]=1-2*(J+U),c.tK[11]=0,c.tK[12]=0,c.tK[13]=0,c.tK[14]=0,c.tK[15]=1,c.markAsUpdated(),c}}a._IdentityReadOnly=a.Identity(),Object.defineProperties(a.prototype,{dimension:{value:[4,4]},rank:{value:2}});class p{}p.hc=(0,Q.e)(11,b.Zero),p.Matrix=(0,Q.e)(2,a.Identity),p.Quaternion=(0,Q.e)(3,o.Zero);class R{}R.Vector2=(0,Q.e)(3,H.Zero),R.hc=(0,Q.e)(13,b.Zero),R.Vector4=(0,Q.e)(3,h.Zero),R.Quaternion=(0,Q.e)(3,o.Zero),R.Matrix=(0,Q.e)(8,a.Identity),(0,s.f)("BABYLON.Vector2",H),(0,s.f)("BABYLON.Vector3",b),(0,s.f)("BABYLON.Vector4",h),(0,s.f)("BABYLON.Matrix",a);const I=a.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11163:(q,c,U)=>{U.d(c,{c:()=>J});class J{constructor(q,c,U,J){this.x=q,this.y=c,this.width=U,this.height=J}toGlobal(q,c){return new J(this.x*q,this.y*c,this.width*q,this.height*c)}toGlobalToRef(q,c,U){return U.x=this.x*q,U.y=this.y*c,U.width=this.width*q,U.height=this.height*c,this}clone(){return new J(this.x,this.y,this.width,this.height)}}},11258:(q,c,U)=>{U.d(c,{d:()=>W,f:()=>D});var J=U(10833),Q=U(11263);const s=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],g=[()=>1,q=>q.y,q=>q.z,q=>q.x,q=>q.x*q.y,q=>q.y*q.z,q=>3*q.z*q.z-1,q=>q.x*q.z,q=>q.x*q.x-q.y*q.y],X=(q,c)=>s[q]*g[q](c),n=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class W{constructor(){this.preScaled=!1,this.l00=J.p.Zero(),this.l1_1=J.p.Zero(),this.l10=J.p.Zero(),this.l11=J.p.Zero(),this.l2_2=J.p.Zero(),this.l2_1=J.p.Zero(),this.l20=J.p.Zero(),this.l21=J.p.Zero(),this.l22=J.p.Zero()}addLight(q,c,U){Q.i.hc[0].set(c.r,c.g,c.b);const J=Q.i.hc[0],s=Q.i.hc[1];J.scaleToRef(U,s),s.scaleToRef(X(0,q),Q.i.hc[2]),this.l00.addInPlace(Q.i.hc[2]),s.scaleToRef(X(1,q),Q.i.hc[2]),this.l1_1.addInPlace(Q.i.hc[2]),s.scaleToRef(X(2,q),Q.i.hc[2]),this.l10.addInPlace(Q.i.hc[2]),s.scaleToRef(X(3,q),Q.i.hc[2]),this.l11.addInPlace(Q.i.hc[2]),s.scaleToRef(X(4,q),Q.i.hc[2]),this.l2_2.addInPlace(Q.i.hc[2]),s.scaleToRef(X(5,q),Q.i.hc[2]),this.l2_1.addInPlace(Q.i.hc[2]),s.scaleToRef(X(6,q),Q.i.hc[2]),this.l20.addInPlace(Q.i.hc[2]),s.scaleToRef(X(7,q),Q.i.hc[2]),this.l21.addInPlace(Q.i.hc[2]),s.scaleToRef(X(8,q),Q.i.hc[2]),this.l22.addInPlace(Q.i.hc[2])}scaleInPlace(q){this.l00.scaleInPlace(q),this.l1_1.scaleInPlace(q),this.l10.scaleInPlace(q),this.l11.scaleInPlace(q),this.l2_2.scaleInPlace(q),this.l2_1.scaleInPlace(q),this.l20.scaleInPlace(q),this.l21.scaleInPlace(q),this.l22.scaleInPlace(q)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(n[0]),this.l1_1.scaleInPlace(n[1]),this.l10.scaleInPlace(n[2]),this.l11.scaleInPlace(n[3]),this.l2_2.scaleInPlace(n[4]),this.l2_1.scaleInPlace(n[5]),this.l20.scaleInPlace(n[6]),this.l21.scaleInPlace(n[7]),this.l22.scaleInPlace(n[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(s[0]),this.l1_1.scaleInPlace(s[1]),this.l10.scaleInPlace(s[2]),this.l11.scaleInPlace(s[3]),this.l2_2.scaleInPlace(s[4]),this.l2_1.scaleInPlace(s[5]),this.l20.scaleInPlace(s[6]),this.l21.scaleInPlace(s[7]),this.l22.scaleInPlace(s[8])}updateFromArray(q){return J.p.FromArrayToRef(q[0],0,this.l00),J.p.FromArrayToRef(q[1],0,this.l1_1),J.p.FromArrayToRef(q[2],0,this.l10),J.p.FromArrayToRef(q[3],0,this.l11),J.p.FromArrayToRef(q[4],0,this.l2_2),J.p.FromArrayToRef(q[5],0,this.l2_1),J.p.FromArrayToRef(q[6],0,this.l20),J.p.FromArrayToRef(q[7],0,this.l21),J.p.FromArrayToRef(q[8],0,this.l22),this}updateFromFloatsArray(q){return J.p.FromFloatsToRef(q[0],q[1],q[2],this.l00),J.p.FromFloatsToRef(q[3],q[4],q[5],this.l1_1),J.p.FromFloatsToRef(q[6],q[7],q[8],this.l10),J.p.FromFloatsToRef(q[9],q[10],q[11],this.l11),J.p.FromFloatsToRef(q[12],q[13],q[14],this.l2_2),J.p.FromFloatsToRef(q[15],q[16],q[17],this.l2_1),J.p.FromFloatsToRef(q[18],q[19],q[20],this.l20),J.p.FromFloatsToRef(q[21],q[22],q[23],this.l21),J.p.FromFloatsToRef(q[24],q[25],q[26],this.l22),this}static Ic(q){return(new W).updateFromArray(q)}static FromPolynomial(q){const c=new W;return c.l00=q.xx.scale(.376127).add(q.yy.scale(.376127)).add(q.zz.scale(.376126)),c.l1_1=q.y.scale(.977204),c.l10=q.z.scale(.977204),c.l11=q.x.scale(.977204),c.l2_2=q.xy.scale(1.16538),c.l2_1=q.yz.scale(1.16538),c.l20=q.zz.scale(1.34567).eU(q.xx.scale(.672834)).eU(q.yy.scale(.672834)),c.l21=q.zx.scale(1.16538),c.l22=q.xx.scale(1.16538).eU(q.yy.scale(1.16538)),c.l1_1.scaleInPlace(-1),c.l11.scaleInPlace(-1),c.l2_1.scaleInPlace(-1),c.l21.scaleInPlace(-1),c.scaleInPlace(Math.PI),c}}class D{constructor(){this.x=J.p.Zero(),this.y=J.p.Zero(),this.z=J.p.Zero(),this.xx=J.p.Zero(),this.yy=J.p.Zero(),this.zz=J.p.Zero(),this.xy=J.p.Zero(),this.yz=J.p.Zero(),this.zx=J.p.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=W.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(q){Q.i.hc[0].bc(q.r,q.g,q.b);const c=Q.i.hc[0];this.xx.addInPlace(c),this.yy.addInPlace(c),this.zz.addInPlace(c)}scaleInPlace(q){this.x.scaleInPlace(q),this.y.scaleInPlace(q),this.z.scaleInPlace(q),this.xx.scaleInPlace(q),this.yy.scaleInPlace(q),this.zz.scaleInPlace(q),this.yz.scaleInPlace(q),this.zx.scaleInPlace(q),this.xy.scaleInPlace(q)}updateFromHarmonics(q){return this._harmonics=q,this.x.X(q.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.X(q.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.X(q.l10),this.z.scaleInPlace(1.02333),this.xx.X(q.l00),Q.i.hc[0].X(q.l20).scaleInPlace(.247708),Q.i.hc[1].X(q.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).Uu(Q.i.hc[0]).addInPlace(Q.i.hc[1]),this.yy.X(q.l00),this.yy.scaleInPlace(.886277).Uu(Q.i.hc[0]).Uu(Q.i.hc[1]),this.zz.X(q.l00),Q.i.hc[0].X(q.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(Q.i.hc[0]),this.yz.X(q.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.X(q.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.X(q.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(q){return(new D).updateFromHarmonics(q)}static Ic(q){const c=new D;return J.p.FromArrayToRef(q[0],0,c.x),J.p.FromArrayToRef(q[1],0,c.y),J.p.FromArrayToRef(q[2],0,c.z),J.p.FromArrayToRef(q[3],0,c.xx),J.p.FromArrayToRef(q[4],0,c.yy),J.p.FromArrayToRef(q[5],0,c.zz),J.p.FromArrayToRef(q[6],0,c.yz),J.p.FromArrayToRef(q[7],0,c.zx),J.p.FromArrayToRef(q[8],0,c.xy),c}}},11505:(q,c,U)=>{U.d(c,{b:()=>o,e:()=>a});var J=U(10833),Q=U(11093),s=U(11149),g=U(11125),X=U(10886),n=U(11031),W=U(11266),D=U(10836),u=U(10864);class K extends J.l{constructor(q,c){super(q.x,q.y),this.index=c}}class r{constructor(){this.elements=[]}add(q){const c=[];for(const U of q){const q=new K(U,this.elements.length);c.push(q),this.elements.push(q)}return c}computeBounds(){const q=new J.l(this.elements[0].x,this.elements[0].y),c=new J.l(this.elements[0].x,this.elements[0].y);for(const U of this.elements)U.x<q.x?q.x=U.x:U.x>c.x&&(c.x=U.x),U.y<q.y?q.y=U.y:U.y>c.y&&(c.y=U.y);return{min:q,max:c,width:c.x-q.x,height:c.y-q.y}}}class H{_addToepoint(q){for(const c of q)this._epoints.push(c.x,c.y)}constructor(q,c,U){let J,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new r,this._outlinepoints=new r,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=Q,this._name=q,this._scene=U||u.c.LastCreatedScene,J=c instanceof W.i?c.getPoints():c,this._addToepoint(J),this._points.add(J),this._outlinepoints.add(J),"undefined"===typeof this.bjsEarcut&&X.c.Warn("Earcut was not found, the polygon will not be built.")}addHole(q){this._points.add(q);const c=new r;return c.add(q),this._holes.push(c),this._eholes.push(this._epoints.length/2),this._addToepoint(q),this}build(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const J=new s.b(this._name,this._scene),Q=this.buildVertexData(c,U);return J.xq(n.h.PositionKind,Q.Fq,q),J.xq(n.h.NormalKind,Q.vq,q),J.xq(n.h.UVKind,Q.kq,q),J.setIndices(Q.indices),J}buildVertexData(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const U=new g.c,J=[],Q=[],s=[],X=this._points.computeBounds();for(const g of this._points.elements)J.push(0,1,0),Q.push(g.x,0,g.y),s.push((g.x-X.min.x)/X.width,(g.y-X.min.y)/X.height);const n=[],W=this.bjsEarcut(this._epoints,this._eholes,2);for(let g=0;g<W.length;g++)n.push(W[g]);if(q>0){const U=Q.length/3;for(const c of this._points.elements)J.push(0,-1,0),Q.push(c.x,-q,c.y),s.push(1-(c.x-X.min.x)/X.width,1-(c.y-X.min.y)/X.height);const g=n.length;for(let q=0;q<g;q+=3){const c=n[q+0],J=n[q+1],Q=n[q+2];n.push(Q+U),n.push(J+U),n.push(c+U)}this._addSide(Q,J,s,n,X,this._outlinepoints,q,!1,c);for(const W of this._holes)this._addSide(Q,J,s,n,X,W,q,!0,c)}return U.indices=n,U.Fq=Q,U.vq=J,U.kq=s,U}_addSide(q,c,U,Q,s,g,X,n,W){let u=q.length/3,K=0;for(let r=0;r<g.elements.length;r++){const H=g.elements[r],b=g.elements[(r+1)%g.elements.length];q.push(H.x,0,H.y),q.push(H.x,-X,H.y),q.push(b.x,0,b.y),q.push(b.x,-X,b.y);const h=g.elements[(r+g.elements.length-1)%g.elements.length],o=g.elements[(r+2)%g.elements.length];let a=new J.p(-(b.y-H.y),0,b.x-H.x),p=new J.p(-(H.y-h.y),0,H.x-h.x),R=new J.p(-(o.y-b.y),0,o.x-b.x);n||(a=a.scale(-1),p=p.scale(-1),R=R.scale(-1));const I=a.normalizeToNew();let t=p.normalizeToNew(),C=R.normalizeToNew();const i=J.p.Dot(t,I);t=i>W?i<D.d-1?new J.p(H.x,0,H.y).eU(new J.p(b.x,0,b.y)).normalize():p.add(a).normalize():I;const F=J.p.Dot(R,a);C=F>W?F<D.d-1?new J.p(b.x,0,b.y).eU(new J.p(H.x,0,H.y)).normalize():R.add(a).normalize():I,U.push(K/s.width,0),U.push(K/s.width,1),K+=a.length(),U.push(K/s.width,0),U.push(K/s.width,1),c.push(t.x,t.y,t.z),c.push(t.x,t.y,t.z),c.push(C.x,C.y,C.z),c.push(C.x,C.y,C.z),n?(Q.push(u),Q.push(u+2),Q.push(u+1),Q.push(u+1),Q.push(u+2),Q.push(u+3)):(Q.push(u),Q.push(u+1),Q.push(u+2),Q.push(u+1),Q.push(u+3),Q.push(u+2)),u+=4}}}var b=U(11178);function h(q,c,U,s,X,W,D){const u=U||new Array(3),K=s,r=[],H=D||!1;for(let g=0;g<3;g++)void 0===u[g]&&(u[g]=new J.q(0,0,1,1)),K&&void 0===K[g]&&(K[g]=new Q.e(1,1,1,1));const h=q.getVerticesData(n.h.PositionKind),o=q.getVerticesData(n.h.NormalKind),a=q.getVerticesData(n.h.UVKind),p=q.uc(),R=h.length/9;let I=0,t=0,C=0,i=0,F=0;const v=[0];if(H)for(let J=R;J<h.length/3;J+=4)t=h[3*(J+2)]-h[3*J],C=h[3*(J+2)+2]-h[3*J+2],i=Math.sqrt(t*t+C*C),F+=i,v.push(F);let Y=0,k=0;for(let J=0;J<o.length;J+=3)Math.abs(o[J+1])<.001&&(k=1),Math.abs(o[J+1]-1)<.001&&(k=0),Math.abs(o[J+1]+1)<.001&&(k=2),Y=J/3,1===k?(I=Y-R,a[2*Y]=I%4<1.5?H?u[k].x+(u[k].z-u[k].x)*v[Math.floor(I/4)]/F:u[k].x:H?u[k].x+(u[k].z-u[k].x)*v[Math.floor(I/4)+1]/F:u[k].z,a[2*Y+1]=I%2===0?b.b?1-u[k].w:u[k].w:b.b?1-u[k].y:u[k].y):(a[2*Y]=(1-a[2*Y])*u[k].x+a[2*Y]*u[k].z,a[2*Y+1]=(1-a[2*Y+1])*u[k].y+a[2*Y+1]*u[k].w,b.b&&(a[2*Y+1]=1-a[2*Y+1])),K&&r.push(K[k].r,K[k].g,K[k].b,K[k].a);g.c._ComputeSides(c,h,p,o,a,X,W);const V=new g.c;if(V.indices=p,V.Fq=h,V.vq=o,V.kq=a,K){const q=c===g.c.DOUBLESIDE?r.concat(r):r;V.Yq=q}return V}function o(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;c.sideOrientation=s.b._GetDefaultSideOrientation(c.sideOrientation);const g=c.shape,X=c.holes||[],n=c.depth||0,W=c.smoothingThreshold||2,D=[];let K=[];for(let s=0;s<g.length;s++)D[s]=new J.l(g[s].x,g[s].z);D[0].equalsWithEpsilon(D[D.length-1],1e-8)&&D.pop();const r=new H(q,D,U||u.c.LastCreatedScene,Q);for(let s=0;s<X.length;s++){K=[];for(let q=0;q<X[s].length;q++)K.push(new J.l(X[s][q].x,X[s][q].z));r.addHole(K)}const b=r.build(!1,n,W);b._originalBuilderSideOrientation=c.sideOrientation;return h(b,c.sideOrientation,c.faceUV,c.faceColors,c.frontUVs,c.backUVs,c.wrap).Oq(b,c.updatable),b}function a(q,c){return o(q,c,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}g.c.CreatePolygon=h,s.b.CreatePolygon=function(q,c,U,J,Q,s){return o(q,{shape:c,holes:J,updatable:Q,sideOrientation:s},U,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},s.b.ExtrudePolygon=function(q,c,U,J,Q,s,g){return a(q,{shape:c,holes:Q,depth:U,updatable:s,sideOrientation:g},J,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)}},11502:(q,c,U)=>{U.d(c,{e:()=>D,f:()=>u});var J=U(11266),Q=U(10833),s=U(11149),g=U(11107),X=U(11505);class n{constructor(q){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=q}moveTo(q,c){this._currentPath=new J.i(q,c),this._tempPaths.push(this._currentPath)}lineTo(q,c){this._currentPath.addLineTo(q,c)}quadraticCurveTo(q,c,U,J){this._currentPath.addQuadraticCurveTo(q,c,U,J,this._resolution)}bezierCurveTo(q,c,U,J,Q,s){this._currentPath.addBezierCurveTo(q,c,U,J,Q,s,this._resolution)}extractHoles(){for(const q of this._tempPaths)q.area()>0?this._holes.push(q):this._paths.push(q);if(!this._paths.length&&this._holes.length){const q=this._holes;this._holes=this._paths,this._paths=q}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function W(q,c,U,J,Q,s){const g=s.glyphs[q]||s.glyphs["?"];if(!g)return null;const X=new n(Q);if(g.o){const q=g.o.split(" ");for(let Q=0,s=q.length;Q<s;){switch(q[Q++]){case"m":{const s=parseInt(q[Q++])*c+U,g=parseInt(q[Q++])*c+J;X.moveTo(s,g);break}case"l":{const s=parseInt(q[Q++])*c+U,g=parseInt(q[Q++])*c+J;X.lineTo(s,g);break}case"q":{const s=parseInt(q[Q++])*c+U,g=parseInt(q[Q++])*c+J,n=parseInt(q[Q++])*c+U,W=parseInt(q[Q++])*c+J;X.quadraticCurveTo(n,W,s,g);break}case"b":{const s=parseInt(q[Q++])*c+U,g=parseInt(q[Q++])*c+J,n=parseInt(q[Q++])*c+U,W=parseInt(q[Q++])*c+J,D=parseInt(q[Q++])*c+U,u=parseInt(q[Q++])*c+J;X.bezierCurveTo(n,W,D,u,s,g);break}}}}return X.extractHoles(),{offsetX:g.ha*c,shapePath:X}}function D(q,c,U,J){const Q=Array.from(q),s=c/J.resolution,g=(J.boundingBox.yMax-J.boundingBox.yMin+J.underlineThickness)*s,X=[];let n=0,D=0;for(let u=0;u<Q.length;u++){const q=Q[u];if("\n"===q)n=0,D-=g;else{const c=W(q,s,n,D,U,J);c&&(n+=c.offsetX,X.push(c.shapePath))}}return X}function u(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const u=D(c,J.size||50,J.resolution||8,U),K=[];let r=0;for(const g of u){if(!g.paths.length)continue;const c=g.holes.slice();for(const U of g.paths){var H,b;const g=[],D=[],u=U.getPoints();for(const q of u)D.push(new Q.p(q.x,0,q.y));const h=c.slice();for(const q of h){const J=q.getPoints();let s=!1;for(const q of J)if(U.isPointInside(q)){s=!0;break}if(!s)continue;const X=[];for(const q of J)X.push(new Q.p(q.x,0,q.y));g.push(X),c.splice(c.indexOf(q),1)}if(!g.length&&c.length)for(const q of c){const c=q.getPoints(),U=[];for(const q of c)U.push(new Q.p(q.x,0,q.y));g.push(U)}const o=(0,X.e)(q,{shape:D,holes:g.length?g:void 0,depth:J.depth||1,faceUV:J.faceUV||(null===(H=J.perLetterFaceUV)||void 0===H?void 0:H.call(J,r)),faceColors:J.faceColors||(null===(b=J.perLetterFaceColors)||void 0===b?void 0:b.call(J,r)),sideOrientation:s.b._GetDefaultSideOrientation(J.sideOrientation||s.b.DOUBLESIDE)},n,W);K.push(o),r++}}const h=s.b.MergeMeshes(K,!0,!0);if(h){const c=h.getBoundingInfo().boundingBox;h.position.x+=-(c.minimumWorld.x+c.maximumWorld.x)/2,h.position.y+=-(c.minimumWorld.y+c.maximumWorld.y)/2,h.position.z+=-(c.minimumWorld.z+c.maximumWorld.z)/2+c.extendSize.z,h.name=q;const U=new g.c("pivot",n);U.rotation.x=-Math.PI/2,h.parent=U,h.bakeCurrentTransformIntoVertices(),h.parent=null,U.dispose()}return h}},11517:(q,c,U)=>{U.d(c,{c:()=>n,g:()=>g,k:()=>X});var J=U(10879),Q=U(11526),s=U(11532);function g(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}function X(q){return!!(q.wasmUrl&&(q.wasmBinary||q.wasmBinaryUrl)&&"object"===typeof WebAssembly||q.fallbackUrl)}class n{constructor(q){if(q.workerPool)return void(this._workerPoolPromise=Promise.resolve(q.workerPool));const c=q.wasmBinary,U=q.numWorkers??g(),X=U&&"function"===typeof Worker&&"function"===typeof URL,n=X||!q.jsModule,W=q.wasmUrl&&q.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:n?J.e.GetBabylonScriptURL(q.wasmUrl,!0):"",wasmBinaryPromise:c?Promise.resolve(c):J.e.LoadFileAsync(J.e.GetBabylonScriptURL(q.wasmBinaryUrl,!0))}:{url:n?J.e.GetBabylonScriptURL(q.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};X?this._workerPoolPromise=W.wasmBinaryPromise.then((q=>{const c=this._getWorkerContent(),J=URL.createObjectURL(new Blob([c],{type:"application/javascript"}));return new Q.c(U,(()=>{const c=new Worker(J);return(0,s.p)(c,q,W.url)}))})):this._modulePromise=W.wasmBinaryPromise.then((async c=>{if(!this._isModuleAvailable()&&!q.jsModule){if(!W.url)throw new Error("Draco codec module is not available");await J.e.LoadBabylonScriptAsync(W.url)}return await this._createModuleAsync(c,q.jsModule)}))}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._modulePromise&&await this._modulePromise}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((q=>{q.dispose()})),delete this._workerPoolPromise,delete this._modulePromise}}},11532:(q,c,U)=>{function J(q,c,U,J){const Q=q;let s=null,g=null,X=null,n=null;const W={},D=c.find((q=>"POSITION"===q.dracoName));if(!D)throw new Error("Position attribute is required for Draco encoding");if(!U){const q=D.data.length/D.size;U=new(q>65535?Uint32Array:Uint16Array)(q);for(let c=0;c<q;c++)U[c]=c}try{s=new Q.Encoder,g=new Q.MeshBuilder,X=new Q.Mesh,g.AddFacesToMesh(X,U.length/3,U);const q=new Map([[Float32Array,(q,c,U,J,Q,s)=>q.AddFloatAttribute(c,U,J,Q,s)],[Uint32Array,(q,c,U,J,Q,s)=>q.AddUInt32Attribute(c,U,J,Q,s)],[Uint16Array,(q,c,U,J,Q,s)=>q.AddUInt16Attribute(c,U,J,Q,s)],[Uint8Array,(q,c,U,J,Q,s)=>q.AddUInt8Attribute(c,U,J,Q,s)],[Int32Array,(q,c,U,J,Q,s)=>q.AddInt32Attribute(c,U,J,Q,s)],[Int16Array,(q,c,U,J,Q,s)=>q.AddInt16Attribute(c,U,J,Q,s)],[Int8Array,(q,c,U,J,Q,s)=>q.AddInt8Attribute(c,U,J,Q,s)]]);for(const U of c){U.data instanceof Uint8ClampedArray&&(U.data=new Uint8Array(U.data));const c=q.get(U.data.constructor),n=U.data.length/U.size;W[U.kind]=c(g,X,Q[U.dracoName],n,U.size,U.data),J.quantizationBits&&J.quantizationBits[U.dracoName]&&s.SetAttributeQuantization(Q[U.dracoName],J.quantizationBits[U.dracoName])}J.method&&s.SetEncodingMethod(Q[J.method]),void 0!==J.encodeSpeed&&void 0!==J.decodeSpeed&&s.SetSpeedOptions(J.encodeSpeed,J.decodeSpeed),n=new Q.DracoInt8Array;const D=s.EncodeMeshToDracoBuffer(X,n);if(D<=0)throw new Error("Draco encoding failed.");const u=new Int8Array(D);for(let c=0;c<D;c++)u[c]=n.GetValue(c);return{data:u,attributeIds:W}}finally{X&&Q.destroy(X),g&&Q.destroy(g),s&&Q.destroy(s),n&&Q.destroy(n)}}function Q(){let q;onmessage=c=>{const U=c.data;switch(U.id){case"init":{U.url&&importScripts(U.url);const c=U.wasmBinary?{wasmBinary:U.wasmBinary}:{};q=DracoEncoderModule(c),postMessage({id:"initDone"});break}case"encodeMesh":if(!q)throw new Error("Draco encoder module is not available");q.then((q=>{const c=J(q,U.attributes,U.indices,U.options);postMessage({id:"encodeMeshDone",encodedMeshData:c},c?[c.data.buffer]:void 0)}))}}}function s(q,c,U,J,Q){const s=q;let g=null,X=null,n=null;try{let q;g=new s.Decoder,X=new s.DecoderBuffer,X.Init(c,c.byteLength);const W=g.GetEncodedGeometryType(X);switch(W){case s.TRIANGULAR_MESH:{const c=new s.Mesh;if(q=g.DecodeBufferToMesh(X,c),!q.ok()||0===c.ptr)throw new Error(q.error_msg());const U=3*c.num_faces(),Q=4*U,W=s._malloc(Q);try{g.GetTrianglesUInt32Array(c,Q,W);const q=new Uint32Array(U);q.set(new Uint32Array(s.HEAPF32.buffer,W,U)),J(q)}finally{s._free(W)}n=c;break}case s.POINT_CLOUD:{const c=new s.PointCloud;if(q=g.DecodeBufferToPointCloud(X,c),!q.ok()||!c.ptr)throw new Error(q.error_msg());n=c;break}default:throw new Error(`Invalid geometry type ${W}`)}const D=n.num_points(),u=(q,c,U,J)=>{const g=J.data_type(),X=J.num_components(),n=J.normalized(),W=J.byte_stride(),u=J.byte_offset(),K={[s.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:s.HEAPF32},[s.DT_INT8]:{typedArrayConstructor:Int8Array,heap:s.HEAP8},[s.DT_INT16]:{typedArrayConstructor:Int16Array,heap:s.HEAP16},[s.DT_INT32]:{typedArrayConstructor:Int32Array,heap:s.HEAP32},[s.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:s.HEAPU8},[s.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:s.HEAPU16},[s.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:s.HEAPU32}}[g];if(!K)throw new Error(`Invalid data type ${g}`);const r=D*X,H=r*K.typedArrayConstructor.BYTES_PER_ELEMENT,b=s._malloc(H);try{q.GetAttributeDataArrayForAllPoints(c,J,g,H,b);const s=new K.typedArrayConstructor(K.heap.buffer,b,r);Q(U,s.slice(),X,u,W,n)}finally{s._free(b)}};if(U)for(const c in U){const q=U[c],J=g.GetAttributeByUniqueId(n,q);u(g,n,c,J)}else{const q={position:s.POSITION,Jc:s.NORMAL,color:s.COLOR,uv:s.TEX_COORD};for(const c in q){const U=g.GetAttributeId(n,q[c]);if(-1!==U){const q=g.GetAttribute(n,U);u(g,n,c,q)}}}return D}finally{n&&s.destroy(n),X&&s.destroy(X),g&&s.destroy(g)}}function g(){let q;onmessage=c=>{const U=c.data;switch(U.id){case"init":{U.url&&importScripts(U.url);const c=U.wasmBinary?{wasmBinary:U.wasmBinary}:{};q=DracoDecoderModule(c),postMessage({id:"initDone"});break}case"decodeMesh":if(!q)throw new Error("Draco decoder module is not available");q.then((q=>{const c=s(q,U.dataView,U.attributes,(q=>{postMessage({id:"indices",data:q},[q.buffer])}),((q,c,U,J,Q,s)=>{postMessage({id:"attribute",kind:q,data:c,size:U,byteOffset:J,byteStride:Q,normalized:s},[c.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:c})}))}}}async function X(q,c,U){return await new Promise(((J,Q)=>{const s=c=>{q.removeEventListener("error",s),q.removeEventListener("message",g),Q(c)},g=c=>{"initDone"===c.data.id&&(q.removeEventListener("error",s),q.removeEventListener("message",g),J(q))};if(q.addEventListener("error",s),q.addEventListener("message",g),c){const J=c.slice(0);q.postMessage({id:"init",url:U,wasmBinary:J},[J])}else q.postMessage({id:"init",url:U})}))}U.d(c,{e:()=>s,h:()=>g,j:()=>J,l:()=>Q,p:()=>X})},11208:(q,c,U)=>{U.d(c,{c:()=>Q});var J=U(11033);class Q extends J.b{constructor(q){super(),this._buffer=q}get underlyingResource(){return this._buffer}}},11119:(q,c,U)=>{U.d(c,{c:()=>C});var J=U(11010),Q=U(10866),s=U(10833),g=U(11031),X=U(11125),n=U(11107),W=U(11132),D=U(11050),u=U(11075);class K{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new s.p(0,0,0),this._diffPositionForCollisions=new s.p(0,0,0),this._collisionResponse=!0}}var r=U(10910),H=U(11064),b=U(11093),h=U(10836),o=U(11137),a=U(10850),p=U(11019),R=U(10954);class I{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=s.p.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class t{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new I,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=new Map,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new K,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class C extends n.c{static get BILLBOARDMODE_NONE(){return n.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return n.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return n.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return n.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return n.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return n.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(q){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=q}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(q){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=q}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(q){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=q}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(q){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=q}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(q){this._internalAbstractMeshDataInfo._collisionRetryCount=q}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(q){this._internalAbstractMeshDataInfo._morphTargetManager!==q&&(this._internalAbstractMeshDataInfo._morphTargetManager=q,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(q){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==q&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=q,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(q){return!!super._updateNonUniformScalingState(q)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(q){this._internalAbstractMeshDataInfo._rawBoundingInfo=q}set ar(q){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(q)}set onCollisionPositionChange(q){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(q)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(q){if(this._internalAbstractMeshDataInfo._visibility===q)return;const c=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=q,(1===c&&1!==q||1!==c&&1===q)&&this._markSubMeshesAsDirty((q=>{q.markAsMiscDirty(),q.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(q){this._internalAbstractMeshDataInfo._inheritVisibility=q}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let q=this._parentNode;for(;q;){const c=q.isVisible;if("undefined"!==typeof c)return c;q=q.parent}}return this._isVisible}set isVisible(q){this._isVisible=q}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(q){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=q}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(q){this._internalAbstractMeshDataInfo._renderingGroupId=q}get material(){return this._internalAbstractMeshDataInfo._material}set material(q){this._setMaterial(q)}_setMaterial(q){this._internalAbstractMeshDataInfo._material!==q&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=q,q&&q.meshMap&&(q.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Gc&&(this.resetDrawCache(void 0,null==q),this._unBindEffect()))}getMaterialForRenderPass(q){var c;return null===(c=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===c?void 0:c[q]}setMaterialForRenderPass(q,c){var U;this.resetDrawCache(q),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]);const J=this._internalAbstractMeshDataInfo._materialForRenderPass[q];null!==J&&void 0!==J&&null!==(U=J.meshMap)&&void 0!==U&&U[this.uniqueId]&&(J.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._materialForRenderPass[q]=c,c&&c.meshMap&&(c.meshMap[this.uniqueId]=this)}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(q){this._internalAbstractMeshDataInfo._receiveShadows!==q&&(this._internalAbstractMeshDataInfo._receiveShadows=q,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(q){this._internalAbstractMeshDataInfo._hasVertexAlpha!==q&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=q,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(q){this._internalAbstractMeshDataInfo._useVertexColors!==q&&(this._internalAbstractMeshDataInfo._useVertexColors=q,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(q){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==q&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=q,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(q){this._internalAbstractMeshDataInfo._numBoneInfluencers!==q&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=q,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(q){this._internalAbstractMeshDataInfo._applyFog!==q&&(this._internalAbstractMeshDataInfo._applyFog=q,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(q){this._internalAbstractMeshDataInfo._enableDistantPicking=q}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(q){q!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=q,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(q)?-1:q}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=q}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(q){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(q)?-1:q}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(q){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=q}get lightSources(){return this._lightSources}set skeleton(q){const c=this._internalAbstractMeshDataInfo._skeleton;c&&c.needInitialSkinMatrix&&c._unregisterMeshWithPoseMatrix(this),q&&q.needInitialSkinMatrix&&q._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=q,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(q){var c;let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(q,U,!1),c=this,this._internalAbstractMeshDataInfo=new t,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.bu=C.hu,this.onCollideObservable=new Q.e,this.onCollisionPositionChangeObservable=new Q.e,this.onMaterialChangedObservable=new Q.e,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Pn=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=b.c.Red(),this.outlineWidth=.02,this.overlayColor=b.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.Tg=!1,this.Gq=!1,this.actionManager=null,this.ellipsoid=new s.p(.5,1,.5),this.ellipsoidOffset=new s.p(0,0,0),this.edgesWidth=1,this.edgesColor=new b.e(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Vg:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new Q.e,this._onCollisionPositionChange=function(q,U){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;U.subtractToRef(c._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>R.d.CollisionsEpsilon&&c.position.addInPlace(c._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),J&&c.onCollideObservable.notifyObservers(J),c.onCollisionPositionChangeObservable.notifyObservers(c.position)},U=this.Cq(),U.sD(this),this._resyncLightSources(),this._uniformBuffer=new u.d(this.Cq().getEngine(),void 0,void 0,q,!this.Cq().getEngine().isWebGPU),this._buildUniformLayout(),U.performancePriority){case 2:this.Gq=!0;case 1:this.Tg=!0,this.Pn=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(q){const c=this._uniformBuffer;c.vc("world",q),c.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),c.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(q){let c="Name: "+this.name+", isInstance: "+("InstancedMesh"===this.getClassName()?"YES":"NO");c+=", # of submeshes: "+(this.Gc?this.Gc.length:0);const U=this._internalAbstractMeshDataInfo._skeleton;return U&&(c+=", skeleton: "+U.name),q&&(c+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],c+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Vg?"YES":"NO")),c}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==n.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(c||this.actionManager.isRecursive)){if(!q)return this.actionManager;if(this.actionManager.hasSpecificTrigger(q))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(q,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Gc){for(const q of this.Gc)q._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const q of this.Cq().lights)q.isEnabled()&&q.canAffectMesh(this)&&this._lightSources.push(q);this._markSubMeshesAsLightDirty()}_resyncLightSource(q){const c=q.isEnabled()&&q.canAffectMesh(this),U=this._lightSources.indexOf(q);let J=!1;if(-1===U){if(!c)return;this._lightSources.push(q)}else{if(c)return;J=!0,this._lightSources.splice(U,1)}this._markSubMeshesAsLightDirty(J)}_unBindEffect(){for(const q of this.Gc)q.setEffect(null)}_removeLightSource(q,c){const U=this._lightSources.indexOf(q);-1!==U&&(this._lightSources.splice(U,1),this._markSubMeshesAsLightDirty(c))}_markSubMeshesAsDirty(q){if(this.Gc)for(const c of this.Gc)for(let U=0;U<c._drawWrappers.length;++U){const J=c._drawWrappers[U];J&&J.defines&&J.defines.markAllAsDirty&&q(J.defines)}}_markSubMeshesAsLightDirty(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((c=>c.markAsLightDirty(q)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((q=>q.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((q=>q.markAsMiscDirty()))}PW(q){return this._currentRenderId=Number.MAX_VALUE,super.PW(q),this._isDirty=!0,this}resetDrawCache(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.Gc)for(const U of this.Gc)U.resetDrawCache(q,c)}get isBlocked(){return!1}getLOD(q){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}uc(){return null}getVerticesData(q){return null}xq(q,c,U,J){return this}updateVerticesData(q,c,U,J){return this}setIndices(q,c){return this}isVerticesDataPresent(q){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Sq()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(q){return this._boundingInfo=q,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(q,c,U){return this._boundingInfo=new D.e(q,c,U),this._boundingInfo}normalizeToUnitCube(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(q,c,U)}get useBones(){return this.skeleton&&this.Cq().skeletonsEnabled&&this.isVerticesDataPresent(g.h.MatricesIndicesKind)&&this.isVerticesDataPresent(g.h.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(q){}_activate(q,c){return this._renderId=q,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===n.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(q,c,U){return this.position.addInPlace(this.calcMovePOV(q,c,U)),this}calcMovePOV(q,c,U){const J=new s.d;(this.rotationQuaternion?this.rotationQuaternion:s.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(J);const Q=s.p.Zero(),g=this.definedFacingForward?-1:1;return s.p.TransformCoordinatesFromFloatsToRef(q*g,c,U*g,J,Q),Q}rotatePOV(q,c,U){return this.rotation.addInPlace(this.calcRotatePOV(q,c,U)),this}calcRotatePOV(q,c,U){const J=this.definedFacingForward?1:-1;return new s.p(q*J,c,U*J)}Zq(q,c){if(q){const U=(0,H.g)(q,0,this.getTotalVertices(),c);this._boundingInfo?this._boundingInfo.reConstruct(U.minimum,U.maximum):this._boundingInfo=new D.e(U.minimum,U.maximum)}if(this.Gc)for(let U=0;U<this.Gc.length;U++)this.Gc[U].refreshBoundingInfo(q);this.Sq()}_refreshBoundingInfoDirect(q){if(this._boundingInfo?this._boundingInfo.reConstruct(q.minimum,q.maximum):this._boundingInfo=new D.e(q.minimum,q.maximum),this.Gc)for(let c=0;c<this.Gc.length;c++)this.Gc[c].refreshBoundingInfo(null);this.Sq()}static _ApplySkeleton(q,c,U,J,Q,X,n){!function(q,c,U,J,Q,X,n){const W=s.j.hc[0],D=s.j.Matrix[0],u=s.j.Matrix[1],K=c===g.h.NormalKind?s.p.TransformNormalFromFloatsToRef:s.p.TransformCoordinatesFromFloatsToRef;for(let g=0,r=0;g<q.length;g+=3,r+=4){let c,H;for(D.reset(),c=0;c<4;c++)H=Q[r+c],H>0&&(s.d.FromFloat32ArrayToRefScaled(U,Math.floor(16*J[r+c]),H,u),D.addToSelf(u));if(X&&n)for(c=0;c<4;c++)H=n[r+c],H>0&&(s.d.FromFloat32ArrayToRefScaled(U,Math.floor(16*X[r+c]),H,u),D.addToSelf(u));K(q[g],q[g+1],q[g+2],D,W),W.toArray(q,g)}}(q,c,U,J,Q,X,n)}_getData(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g.h.PositionKind;const J=q.cache,Q=q=>{if(J){const c=J._vertexData||(J._vertexData={});return c[q]||this.copyVerticesData(q,c),c[q]}return this.getVerticesData(q)};if(c||(c=Q(U)),!c)return null;if(J?(J._outputData?J._outputData.set(c):J._outputData=new Float32Array(c),c=J._outputData):(q.applyMorph&&this.morphTargetManager||q.applySkeleton&&this.skeleton)&&(c=c.slice()),q.applyMorph&&this.morphTargetManager&&function(q,c,U){let J=null;switch(c){case g.h.PositionKind:J=q=>q.getPositions();break;case g.h.NormalKind:J=q=>q.getNormals();break;case g.h.TangentKind:J=q=>q.getTangents();break;case g.h.UVKind:J=q=>q.getUVs();break;case g.h.UV2Kind:J=q=>q.getUV2s();break;case g.h.ColorKind:J=q=>q.getColors();break;default:return}for(let Q=0;Q<q.length;Q++){let c=q[Q];for(let s=0;s<U.numTargets;s++){const g=U.getTarget(s),X=g.influence;if(0!==X){const U=J(g);U&&(c+=(U[Q]-q[Q])*X)}}q[Q]=c}}(c,U,this.morphTargetManager),q.applySkeleton&&this.skeleton){const q=Q(g.h.MatricesIndicesKind),J=Q(g.h.MatricesWeightsKind);if(J&&q){const s=this.numBoneInfluencers>4,X=s?Q(g.h.MatricesIndicesExtraKind):null,n=s?Q(g.h.MatricesWeightsExtraKind):null,W=this.skeleton.getTransformMatrices(this);C._ApplySkeleton(c,U,W,q,J,X,n)}}if(!1!==q.updatePositionsArray&&U===g.h.PositionKind){const q=this._internalAbstractMeshDataInfo._positions||[],U=q.length;if(q.length=c.length/3,U<q.length)for(let c=U;c<q.length;c++)q[c]=new s.p;for(let J=0,Q=0;J<q.length;J++,Q+=3)q[J].bc(c[Q],c[Q+1],c[Q+2]);this._internalAbstractMeshDataInfo._positions=q}return c}getNormalsData(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:q,applyMorph:c,updatePositionsArray:!1},null,g.h.NormalKind)}jX(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:q,applyMorph:c,updatePositionsArray:!1},U,g.h.PositionKind)}Sq(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new D.e(s.p.Zero(),s.p.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(q){if(!this.Gc)return this;const c=this.Gc.length;for(let U=0;U<c;U++){const J=this.Gc[U];(c>1||!J.IsGlobal)&&J.updateBoundingInfo(q)}return this}_afterComputeWorldMatrix(){this.Gq||(this._boundingInfoIsDirty=!0)}isInFrustum(q){return this.getBoundingInfo().isInFrustum(q,this.bu)}isCompletelyInFrustum(q){return this.getBoundingInfo().isCompletelyInFrustum(q)}intersectsMesh(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0;const J=this.getBoundingInfo(),Q=q.getBoundingInfo();if(J.intersects(Q,c))return!0;if(U)for(const s of this.getChildMeshes())if(s.intersectsMesh(q,c,!0))return!0;return!1}intersectsPoint(q){return this.getBoundingInfo().intersectsPoint(q)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(q){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=q}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const U=this.Cq().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=U.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,U.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,q,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId,c),this}_collideForSubMesh(q,c,U){var J;if(this._generatePointsArray(),!this._positions)return this;if(!q._lastColliderWorldVertices||!q._lastColliderTransformMatrix.equals(c)){q._lastColliderTransformMatrix=c.clone(),q._lastColliderWorldVertices=[],q._trianglePlanes=[];const U=q.verticesStart,J=q.verticesStart+q.verticesCount;for(let Q=U;Q<J;Q++)q._lastColliderWorldVertices.push(s.p.TransformCoordinates(this._positions[Q],c))}return U._collide(q._trianglePlanes,q._lastColliderWorldVertices,this.uc(),q.indexStart,q.indexStart+q.indexCount,q.verticesStart,!!q.zq(),this,this._shouldConvertRHS(),7===(null===(J=q.zq())||void 0===J?void 0:J.fillMode)),this}_processCollisionsForSubMeshes(q,c){const U=this._scene.getCollidingSubMeshCandidates(this,q),J=U.length;for(let Q=0;Q<J;Q++){const s=U.data[Q];J>1&&!s._checkCollision(q)||this._collideForSubMesh(s,c,q)}return this}_shouldConvertRHS(){return!1}_checkCollision(q){if(!this.getBoundingInfo()._checkCollision(q))return this;const c=s.j.Matrix[0],U=s.j.Matrix[1];return s.d.ScalingToRef(1/q._radius.x,1/q._radius.y,1/q._radius.z,c),this.worldMatrixFromCache.multiplyToRef(c,U),this._processCollisionsForSubMeshes(q,U),this}_generatePointsArray(){return!1}intersects(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4?arguments[4]:void 0,g=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=new W.c,n=this.getClassName(),D="InstancedLinesMesh"===n||"LinesMesh"===n||"GreasedLineMesh"===n?this.intersectionThreshold:0,u=this.getBoundingInfo();if(!this.Gc)return X;if(!g&&(!q.intersectsSphere(u.boundingSphere,D)||!q.intersectsBox(u.boundingBox,D)))return X;if(J)return X.hit=!g,X.pickedMesh=g?null:this,X.distance=g?0:s.p.Distance(q.origin,u.boundingSphere.center),X.subMeshId=0,X;if(!this._generatePointsArray())return X;let K=null;const r=this._scene.getIntersectingSubMeshCandidates(this,q),H=r.length;let b=!1;for(let s=0;s<H;s++){const q=r.data[s].zq();if(q&&(7==q.fillMode||0==q.fillMode||1==q.fillMode||2==q.fillMode||4==q.fillMode)){b=!0;break}}if(!b)return X.hit=!0,X.pickedMesh=this,X.distance=s.p.Distance(q.origin,u.boundingSphere.center),X.subMeshId=-1,X;for(let s=0;s<H;s++){const J=r.data[s];if(H>1&&!g&&!J.canIntersects(q))continue;const Q=J.intersects(q,this._positions,this.uc(),c,U);if(Q&&(c||!K||Q.distance<K.distance)&&(K=Q,K.subMeshId=s,c))break}if(K){const c=Q??this.getWorldMatrix(),U=s.j.hc[0],J=s.j.hc[1];s.p.TransformCoordinatesToRef(q.origin,c,U),q.direction.scaleToRef(K.distance,J);const g=s.p.TransformNormal(J,c).addInPlace(U);return X.hit=!0,X.distance=s.p.Distance(U,g),X.pickedPoint=g,X.pickedMesh=this,X.bu=K.bu||0,X.bv=K.bv||0,X.subMeshFaceId=K.faceId,X.faceId=K.faceId+r.data[K.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),X.subMeshId=K.subMeshId,X}return X}clone(q,c,U){return null}releaseSubMeshes(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.Gc)for(;this.Gc.length;)this.Gc[0].dispose(q);else this.Gc=[];return this}dispose(q){let c,U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const J=this.Cq();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),J.freeActiveMeshes(),J.freeRenderingGroups(),J.renderingManager.maintainStateBetweenFrames&&J.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((q=>q!==this&&q.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),c=0;c<this._intersectionsInProgress.length;c++){const q=this._intersectionsInProgress[c],U=q._intersectionsInProgress.indexOf(this);q._intersectionsInProgress.splice(U,1)}this._intersectionsInProgress.length=0;const Q=J.lights;for(const g of Q){let q=g.includedOnlyMeshes.indexOf(this);-1!==q&&g.includedOnlyMeshes.splice(q,1),q=g.excludedMeshes.indexOf(this),-1!==q&&g.excludedMeshes.splice(q,1);const c=g.getShadowGenerators();if(c){const U=c.values();for(let c=U.next();!0!==c.done;c=U.next()){const U=c.value.getShadowMap();U&&U.renderList&&(q=U.renderList.indexOf(this),-1!==q&&U.renderList.splice(q,1))}}}"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes(!0);const s=J.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,s.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),s.wipeCaches(),J.QD(this),this._parentContainer){const q=this._parentContainer.meshes.indexOf(this);q>-1&&this._parentContainer.meshes.splice(q,1),this._parentContainer=null}if(U&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!q)for(c=0;c<J.qK.length;c++)J.qK[c].j===this&&(J.qK[c].dispose(),c--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(q,U)}_initFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;q.facetNormals||(q.facetNormals=[]),q.facetPositions||(q.facetPositions=[]),q.facetPartitioning||(q.facetPartitioning=new Array),q.facetNb=this.uc().length/3|0,q.partitioningSubdivisions=q.partitioningSubdivisions?q.partitioningSubdivisions:10,q.partitioningBBoxRatio=q.partitioningBBoxRatio?q.partitioningBBoxRatio:1.01;for(let c=0;c<q.facetNb;c++)q.facetNormals[c]=s.p.Zero(),q.facetPositions[c]=s.p.Zero();return q.facetDataEnabled=!0,this}updateFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;q.facetDataEnabled||this._initFacetData();const c=this.getVerticesData(g.h.PositionKind),U=this.uc(),J=this.getVerticesData(g.h.NormalKind),Q=this.getBoundingInfo();if(q.facetDepthSort&&!q.facetDepthSortEnabled){if(q.facetDepthSortEnabled=!0,U instanceof Uint16Array)q.depthSortedIndices=new Uint16Array(U);else if(U instanceof Uint32Array)q.depthSortedIndices=new Uint32Array(U);else{let c=!1;for(let q=0;q<U.length;q++)if(U[q]>65535){c=!0;break}q.depthSortedIndices=c?new Uint32Array(U):new Uint16Array(U)}if(q.facetDepthSortFunction=function(q,c){return c.sqDistance-q.sqDistance},!q.facetDepthSortFrom){const c=this.Cq().activeCamera;q.facetDepthSortFrom=c?c.position:s.p.Zero()}q.depthSortedFacets=[];for(let c=0;c<q.facetNb;c++){const U={ind:3*c,sqDistance:0};q.depthSortedFacets.push(U)}q.invertedMatrix=s.d.Identity(),q.facetDepthSortOrigin=s.p.Zero()}q.bbSize.x=Q.maximum.x-Q.minimum.x>h.d?Q.maximum.x-Q.minimum.x:h.d,q.bbSize.y=Q.maximum.y-Q.minimum.y>h.d?Q.maximum.y-Q.minimum.y:h.d,q.bbSize.z=Q.maximum.z-Q.minimum.z>h.d?Q.maximum.z-Q.minimum.z:h.d;let n=q.bbSize.x>q.bbSize.y?q.bbSize.x:q.bbSize.y;if(n=n>q.bbSize.z?n:q.bbSize.z,q.subDiv.max=q.partitioningSubdivisions,q.subDiv.X=Math.floor(q.subDiv.max*q.bbSize.x/n),q.subDiv.Y=Math.floor(q.subDiv.max*q.bbSize.y/n),q.subDiv.Z=Math.floor(q.subDiv.max*q.bbSize.z/n),q.subDiv.X=q.subDiv.X<1?1:q.subDiv.X,q.subDiv.Y=q.subDiv.Y<1?1:q.subDiv.Y,q.subDiv.Z=q.subDiv.Z<1?1:q.subDiv.Z,q.facetParameters.facetNormals=this.getFacetLocalNormals(),q.facetParameters.facetPositions=this.getFacetLocalPositions(),q.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),q.facetParameters.bInfo=Q,q.facetParameters.bbSize=q.bbSize,q.facetParameters.subDiv=q.subDiv,q.facetParameters.ratio=this.partitioningBBoxRatio,q.facetParameters.depthSort=q.facetDepthSort,q.facetDepthSort&&q.facetDepthSortEnabled&&(this.o(!0),this._worldMatrix.invertToRef(q.invertedMatrix),s.p.TransformCoordinatesToRef(q.facetDepthSortFrom,q.invertedMatrix,q.facetDepthSortOrigin),q.facetParameters.distanceTo=q.facetDepthSortOrigin),q.facetParameters.depthSortedFacets=q.depthSortedFacets,J&&X.c.ComputeNormals(c,U,J,q.facetParameters),q.facetDepthSort&&q.facetDepthSortEnabled){q.depthSortedFacets.sort(q.facetDepthSortFunction);const c=q.depthSortedIndices.length/3|0;for(let J=0;J<c;J++){const c=q.depthSortedFacets[J].ind;q.depthSortedIndices[3*J]=U[c],q.depthSortedIndices[3*J+1]=U[c+1],q.depthSortedIndices[3*J+2]=U[c+2]}this.updateIndices(q.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetNormals||this.updateFacetData(),q.facetNormals}getFacetLocalPositions(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetPositions||this.updateFacetData(),q.facetPositions}getFacetLocalPartitioning(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetPartitioning||this.updateFacetData(),q.facetPartitioning}getFacetPosition(q){const c=s.p.Zero();return this.getFacetPositionToRef(q,c),c}getFacetPositionToRef(q,c){const U=this.getFacetLocalPositions()[q],J=this.getWorldMatrix();return s.p.TransformCoordinatesToRef(U,J,c),this}getFacetNormal(q){const c=s.p.Zero();return this.getFacetNormalToRef(q,c),c}getFacetNormalToRef(q,c){const U=this.getFacetLocalNormals()[q];return s.p.TransformNormalToRef(U,this.getWorldMatrix(),c),this}getFacetsAtLocalCoordinates(q,c,U){const J=this.getBoundingInfo(),Q=this._internalAbstractMeshDataInfo._facetData,s=Math.floor((q-J.minimum.x*Q.partitioningBBoxRatio)*Q.subDiv.X*Q.partitioningBBoxRatio/Q.bbSize.x),g=Math.floor((c-J.minimum.y*Q.partitioningBBoxRatio)*Q.subDiv.Y*Q.partitioningBBoxRatio/Q.bbSize.y),X=Math.floor((U-J.minimum.z*Q.partitioningBBoxRatio)*Q.subDiv.Z*Q.partitioningBBoxRatio/Q.bbSize.z);return s<0||s>Q.subDiv.max||g<0||g>Q.subDiv.max||X<0||X>Q.subDiv.max?null:Q.facetPartitioning[s+Q.subDiv.max*g+Q.subDiv.max*Q.subDiv.max*X]}getClosestFacetAtCoordinates(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const X=this.getWorldMatrix(),n=s.j.Matrix[5];X.invertToRef(n);const W=s.j.hc[8];s.p.TransformCoordinatesFromFloatsToRef(q,c,U,n,W);const D=this.getClosestFacetAtLocalCoordinates(W.x,W.y,W.z,J,Q,g);return J&&s.p.TransformCoordinatesFromFloatsToRef(J.x,J.y,J.z,X,J),D}getClosestFacetAtLocalCoordinates(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=null,X=0,n=0,W=0,D=0,u=0,K=0,r=0,H=0;const b=this.getFacetLocalPositions(),h=this.getFacetLocalNormals(),o=this.getFacetsAtLocalCoordinates(q,c,U);if(!o)return null;let a,p,R,I=Number.MAX_VALUE,t=I;for(let C=0;C<o.length;C++)a=o[C],p=h[a],R=b[a],D=(q-R.x)*p.x+(c-R.y)*p.y+(U-R.z)*p.z,(!Q||Q&&s&&D>=0||Q&&!s&&D<=0)&&(D=p.x*R.x+p.y*R.y+p.z*R.z,u=-(p.x*q+p.y*c+p.z*U-D)/(p.x*p.x+p.y*p.y+p.z*p.z),K=q+p.x*u,r=c+p.y*u,H=U+p.z*u,X=K-q,n=r-c,W=H-U,t=X*X+n*n+W*W,t<I&&(I=t,g=a,J&&(J.x=K,J.y=r,J.z=H)));return g}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const q=this._internalAbstractMeshDataInfo._facetData;return q.facetDataEnabled&&(q.facetDataEnabled=!1,q.facetPositions=[],q.facetNormals=[],q.facetPartitioning=new Array,q.facetParameters={},q.depthSortedIndices=new Uint32Array(0)),this}updateIndices(q,c){return this}createNormals(q){const c=this.getVerticesData(g.h.PositionKind),U=this.uc();let J;return J=this.isVerticesDataPresent(g.h.NormalKind)?this.getVerticesData(g.h.NormalKind):[],X.c.ComputeNormals(c,U,J,{useRightHandedSystem:this.Cq().useRightHandedSystem}),this.xq(g.h.NormalKind,J,q),this}async optimizeIndicesAsync(){const q=this.uc();if(!q)return this;const{OptimizeIndices:c}=await U.e(35).then(U.bind(U,13406));return c(q),this.setIndices(q,this.getTotalVertices()),this}alignWithNormal(q,c){c||(c=o.d.Y);const U=s.j.hc[0],J=s.j.hc[1];return s.p.CrossToRef(c,q,J),s.p.CrossToRef(q,J,U),this.rotationQuaternion?s.g.RotationQuaternionFromAxisToRef(U,q,J,this.rotationQuaternion):s.p.RotationFromAxisToRef(U,q,J,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,r.d)("EdgesRenderer")}enableEdgesRendering(q,c,U){throw(0,r.d)("EdgesRenderer")}cK(){return this._scene.qK.filter((q=>q.j===this))}}C.OCCLUSION_TYPE_NONE=0,C.OCCLUSION_TYPE_OPTIMISTIC=1,C.OCCLUSION_TYPE_STRICT=2,C.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,C.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,C.CULLINGSTRATEGY_STANDARD=0,C.hu=1,C.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,C.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,J.d)([p.d.filter((function(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];let[J,Q,s,g,X]=c;return!Array.isArray(J)&&!Array.isArray(Q)&&!Array.isArray(s)&&!Array.isArray(g)&&!Array.isArray(X)}))],C,"_ApplySkeleton",null),(0,a.f)("BABYLON.AbstractMesh",C)},11539:(q,c,U)=>{U.d(c,{c:()=>J.h});var J=U(11031)},11170:(q,c,U)=>{U.d(c,{d:()=>h});var J=U(10833),Q=U(11093),s=U(11125),g=U(11031),X=U(11025),n=U(11175),W=U(11050),D=U(10879),u=U(11087),K=U(11064),r=U(10864),H=U(11178),b=U(11035);class h{get boundingBias(){return this._boundingBias}set boundingBias(q){this._boundingBias?this._boundingBias.X(q):this._boundingBias=q.clone(),this.Sq(!0,null)}static CreateGeometryForMesh(q){const c=new h(h.RandomId(),q.Cq());return c.Oq(q),c}get meshes(){return this._meshes}constructor(q,c,U){let Q=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._extend={minimum:new J.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),maximum:new J.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=c||r.c.LastCreatedScene,this._scene&&(this.id=q,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=Q,U?this.setAllVerticesData(U,Q):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),s&&(this.Oq(s),s.o(!0)))}get extend(){return this._extend}Cq(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let q=0;q<this._meshes.length;q++)if(!this._meshes[q].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const q=new Set;for(const c in this._vertexBuffers)q.add(this._vertexBuffers[c].getWrapperBuffer());q.forEach((q=>{q._rebuild()}))}setAllVerticesData(q,c){q.applyToGeometry(this,c),this._notifyUpdate()}xq(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;U&&Array.isArray(c)&&(c=new Float32Array(c));const Q=new g.h(this._engine,c,q,{updatable:U,postponeInternalCreation:0===this._meshes.length,stride:J,label:"Geometry_"+this.id+"_"+q});this.setVerticesBuffer(Q)}removeVerticesData(q){this._vertexBuffers[q]&&(this._vertexBuffers[q].dispose(),delete this._vertexBuffers[q]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const Q=q.getKind();this._vertexBuffers[Q]&&U&&this._vertexBuffers[Q].dispose(),q._buffer&&q._buffer._increaseReferences(),this._vertexBuffers[Q]=q;const s=this._meshes,X=s.length;if(Q===g.h.PositionKind){this._totalVertices=c??q._maxVerticesCount,this._updateExtend(q.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const U=this._extend&&this._extend.minimum||new J.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),Q=this._extend&&this._extend.maximum||new J.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let q=0;q<X;q++){const c=s[q];c.buildBoundingInfo(U,Q),c._createGlobalSubMesh(c.isUnIndexed),c.o(!0),c.synchronizeInstances()}}this._notifyUpdate(Q)}updateVerticesDataDirectly(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=this.getVertexBuffer(q);Q&&(Q.updateDirectly(c,U,J),this._notifyUpdate(q))}updateVerticesData(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const J=this.getVertexBuffer(q);J&&(J.update(c),q===g.h.PositionKind&&this.Sq(U,c),this._notifyUpdate(q))}Sq(q,c){if(q&&this._updateExtend(c),this._resetPointsArrayCache(),q){const q=this._meshes;for(const c of q){c.hasBoundingInfo?c.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):c.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const q=c.Gc;for(const c of q)c.refreshBoundingInfo()}}}_bind(q,c,U,J){if(!q)return;void 0===c&&(c=this._indexBuffer);const Q=this.getVertexBuffers();if(!Q)return;if(c!=this._indexBuffer||!this._vertexArrayObjects&&!J)return void this._engine.bindBuffers(Q,c,q,U);const s=J||this._vertexArrayObjects,g=this._engine;s[q.key]||(s[q.key]=g.recordVertexArrayObject(Q,c,q,U)),g.bindVertexArrayObject(s[q.key],c)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(q,c,U){const J=this.getVertexBuffer(q);return J?J.getFloatData(this._totalVertices,U||c&&1!==this._meshes.length):null}copyVerticesData(q,c){const U=this.getVertexBuffer(q);if(!U)return;c[q]||(c[q]=new Float32Array(this._totalVertices*U.getSize()));const J=U.getData();J&&(0,b.e)(J,U.getSize(),U.type,U.byteOffset,U.byteStride,U.normalized,this._totalVertices,c[q])}isVertexBufferUpdatable(q){const c=this._vertexBuffers[q];return!!c&&c.isUpdatable()}getVertexBuffer(q){return this.isReady()?this._vertexBuffers[q]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(q){return this._vertexBuffers?void 0!==this._vertexBuffers[q]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(q)}getVerticesDataKinds(){const q=[];let c;if(!this._vertexBuffers&&this._delayInfo)for(c in this._delayInfo)q.push(c);else for(c in this._vertexBuffers)q.push(c);return q}updateIndices(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const J=q.length!==this._indices.length;if(U||(this._indices=q.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,q,c),J)for(const q of this._meshes)q._createGlobalSubMesh(!0)}else this.setIndices(q,null,!0)}setIndexBuffer(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=q,this._totalVertices=c,this._totalIndices=U,q.is32Bits=null===J?c>65535:J;for(const Q of this._meshes)Q._createGlobalSubMesh(!0),Q.synchronizeInstances();this._notifyUpdate()}setIndices(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=q,this._indexBufferIsUpdatable=U,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,U,"Geometry_"+this.id+"_IndexBuffer")),void 0!=c&&(this._totalVertices=c);for(const Q of this._meshes)Q._createGlobalSubMesh(!J),Q.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}uc(q,c){if(!this.isReady())return null;const U=this._indices;return c||q&&1!==this._meshes.length?U.slice():U}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;q&&this._vertexArrayObjects&&this._vertexArrayObjects[q.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[q.key]),delete this._vertexArrayObjects[q.key])}releaseForMesh(q,c){const U=this._meshes,J=U.indexOf(q);-1!==J&&(U.splice(J,1),this._vertexArrayObjects&&q._invalidateInstanceVertexArrayObject(),q._geometry=null,0===U.length&&c&&this.dispose())}Oq(q){if(q._geometry===this)return;const c=q._geometry;c&&c.releaseForMesh(q),this._vertexArrayObjects&&q._invalidateInstanceVertexArrayObject();const U=this._meshes;q._geometry=this,q._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),U.push(q),this.isReady()?this._applyToMesh(q):this._boundingInfo&&q.setBoundingInfo(this._boundingInfo)}_updateExtend(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!q&&(q=this.getVerticesData(g.h.PositionKind),!q))return;this._extend=(0,K.g)(q,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(q){const c=this._meshes.length;for(const U in this._vertexBuffers)1===c&&this._vertexBuffers[U].create(),U===g.h.PositionKind&&(this._extend||this._updateExtend(),q.buildBoundingInfo(this._extend.minimum,this._extend.maximum),q._createGlobalSubMesh(q.isUnIndexed),q.Sq());1===c&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),q._syncGeometryWithMorphTargetManager(),q.synchronizeInstances()}_notifyUpdate(q){this.onGeometryUpdated&&this.onGeometryUpdated(this,q),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const c of this._meshes)c._markSubMeshesAsAttributesDirty()}load(q,c){2!==this.delayLoadState&&(this.isReady()?c&&c():(this.delayLoadState=2,this._queueLoad(q,c)))}_queueLoad(q,c){this.delayLoadingFile&&(q.addPendingData(this),q._loadFile(this.delayLoadingFile,(U=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(U),this),this.delayLoadState=1,this._delayInfo=[],q.removePendingData(this);const J=this._meshes,Q=J.length;for(let q=0;q<Q;q++)this._applyToMesh(J[q]);c&&c()}),void 0,!0))}toLeftHanded(){const q=this.uc(!1);if(null!=q&&q.length>0){for(let c=0;c<q.length;c+=3){const U=q[c+0];q[c+0]=q[c+2],q[c+2]=U}this.setIndices(q)}const c=this.getVerticesData(g.h.PositionKind,!1);if(null!=c&&c.length>0){for(let q=0;q<c.length;q+=3)c[q+2]=-c[q+2];this.xq(g.h.PositionKind,c,!1)}const U=this.getVerticesData(g.h.NormalKind,!1);if(null!=U&&U.length>0){for(let q=0;q<U.length;q+=3)U[q+2]=-U[q+2];this.xq(g.h.NormalKind,U,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const q=this.getVerticesData(g.h.PositionKind);if(!q||0===q.length)return!1;for(let c=3*this._positionsCache.length,U=this._positionsCache.length;c<q.length;c+=3,++U)this._positionsCache[U]=J.p.Ic(q,c);for(let c=0,U=0;c<q.length;c+=3,++U)this._positionsCache[U].set(q[0+c],q[1+c],q[2+c]);return this._positionsCache.length=q.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const U in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[U]);this._vertexArrayObjects={};const q=this._meshes,c=q.length;for(let U=0;U<c;U++)q[U]._invalidateInstanceVertexArrayObject()}}dispose(){const q=this._meshes,c=q.length;let U;for(U=0;U<c;U++)this.releaseForMesh(q[U]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const J in this._vertexBuffers)this._vertexBuffers[J].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const q=this._parentContainer.geometries.indexOf(this);q>-1&&this._parentContainer.geometries.splice(q,1),this._parentContainer=null}this._isDisposed=!0}k(q){const c=new s.c;c.indices=[];const U=this.uc();if(U)for(let s=0;s<U.length;s++)c.indices.push(U[s]);let J,Q=!1,g=!1;for(J in this._vertexBuffers){const q=this.getVerticesData(J);if(q&&(q instanceof Float32Array?c.set(new Float32Array(q),J):c.set(q.slice(0),J),!g)){const q=this.getVertexBuffer(J);q&&(Q=q.isUpdatable(),g=!Q)}}const X=new h(q,this._scene,c,Q);for(J in X.delayLoadState=this.delayLoadState,X.delayLoadingFile=this.delayLoadingFile,X._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)X._delayInfo=X._delayInfo||[],X._delayInfo.push(J);return X._boundingInfo=new W.e(this._extend.minimum,this._extend.maximum),X}serialize(){const q={};return q.id=this.id,q.uniqueId=this.uniqueId,q.updatable=this._updatable,u.d&&u.d.HasTags(this)&&(q.tags=u.d.GetTags(this)),q}_toNumberArray(q){return Array.isArray(q)?q:Array.prototype.slice.call(q)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const q in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,q)&&(this._vertexBuffers[q]._buffer._data=null)}serializeVerticeData(){const q=this.serialize();return this.isVerticesDataPresent(g.h.PositionKind)&&(q.Fq=this._toNumberArray(this.getVerticesData(g.h.PositionKind)),this.isVertexBufferUpdatable(g.h.PositionKind)&&(q.positionsUpdatable=!0)),this.isVerticesDataPresent(g.h.NormalKind)&&(q.vq=this._toNumberArray(this.getVerticesData(g.h.NormalKind)),this.isVertexBufferUpdatable(g.h.NormalKind)&&(q.normalsUpdatable=!0)),this.isVerticesDataPresent(g.h.TangentKind)&&(q.tangents=this._toNumberArray(this.getVerticesData(g.h.TangentKind)),this.isVertexBufferUpdatable(g.h.TangentKind)&&(q.tangentsUpdatable=!0)),this.isVerticesDataPresent(g.h.UVKind)&&(q.kq=this._toNumberArray(this.getVerticesData(g.h.UVKind)),this.isVertexBufferUpdatable(g.h.UVKind)&&(q.uvsUpdatable=!0)),this.isVerticesDataPresent(g.h.UV2Kind)&&(q.uvs2=this._toNumberArray(this.getVerticesData(g.h.UV2Kind)),this.isVertexBufferUpdatable(g.h.UV2Kind)&&(q.uvs2Updatable=!0)),this.isVerticesDataPresent(g.h.UV3Kind)&&(q.uvs3=this._toNumberArray(this.getVerticesData(g.h.UV3Kind)),this.isVertexBufferUpdatable(g.h.UV3Kind)&&(q.uvs3Updatable=!0)),this.isVerticesDataPresent(g.h.UV4Kind)&&(q.uvs4=this._toNumberArray(this.getVerticesData(g.h.UV4Kind)),this.isVertexBufferUpdatable(g.h.UV4Kind)&&(q.uvs4Updatable=!0)),this.isVerticesDataPresent(g.h.UV5Kind)&&(q.uvs5=this._toNumberArray(this.getVerticesData(g.h.UV5Kind)),this.isVertexBufferUpdatable(g.h.UV5Kind)&&(q.uvs5Updatable=!0)),this.isVerticesDataPresent(g.h.UV6Kind)&&(q.uvs6=this._toNumberArray(this.getVerticesData(g.h.UV6Kind)),this.isVertexBufferUpdatable(g.h.UV6Kind)&&(q.uvs6Updatable=!0)),this.isVerticesDataPresent(g.h.ColorKind)&&(q.Yq=this._toNumberArray(this.getVerticesData(g.h.ColorKind)),this.isVertexBufferUpdatable(g.h.ColorKind)&&(q.colorsUpdatable=!0)),this.isVerticesDataPresent(g.h.MatricesIndicesKind)&&(q.matricesIndices=this._toNumberArray(this.getVerticesData(g.h.MatricesIndicesKind)),q.matricesIndicesExpanded=!0,this.isVertexBufferUpdatable(g.h.MatricesIndicesKind)&&(q.matricesIndicesUpdatable=!0)),this.isVerticesDataPresent(g.h.MatricesWeightsKind)&&(q.matricesWeights=this._toNumberArray(this.getVerticesData(g.h.MatricesWeightsKind)),this.isVertexBufferUpdatable(g.h.MatricesWeightsKind)&&(q.matricesWeightsUpdatable=!0)),q.indices=this._toNumberArray(this.uc()),q}static ExtractFromMesh(q,c){const U=q._geometry;return U?U.k(c):null}static RandomId(){return D.e.RandomId()}static _GetGeometryByLoadedUniqueId(q,c){for(let U=0;U<c.geometries.length;U++)if(c.geometries[U]._loadedUniqueId===q)return c.geometries[U];return null}static _ImportGeometry(q,c){const U=c.Cq(),J=q.geometryUniqueId,s=q.geometryId;if(J||s){const q=J?this._GetGeometryByLoadedUniqueId(J,U):U.getGeometryById(s);q&&q.Oq(c)}else if(q instanceof ArrayBuffer){const U=c._binaryInfo;if(U.positionsAttrDesc&&U.positionsAttrDesc.count>0){const J=new Float32Array(q,U.positionsAttrDesc.offset,U.positionsAttrDesc.count);c.xq(g.h.PositionKind,J,!1)}if(U.normalsAttrDesc&&U.normalsAttrDesc.count>0){const J=new Float32Array(q,U.normalsAttrDesc.offset,U.normalsAttrDesc.count);c.xq(g.h.NormalKind,J,!1)}if(U.tangetsAttrDesc&&U.tangetsAttrDesc.count>0){const J=new Float32Array(q,U.tangetsAttrDesc.offset,U.tangetsAttrDesc.count);c.xq(g.h.TangentKind,J,!1)}if(U.uvsAttrDesc&&U.uvsAttrDesc.count>0){const J=new Float32Array(q,U.uvsAttrDesc.offset,U.uvsAttrDesc.count);if(H.b)for(let q=1;q<J.length;q+=2)J[q]=1-J[q];c.xq(g.h.UVKind,J,!1)}if(U.uvs2AttrDesc&&U.uvs2AttrDesc.count>0){const J=new Float32Array(q,U.uvs2AttrDesc.offset,U.uvs2AttrDesc.count);if(H.b)for(let q=1;q<J.length;q+=2)J[q]=1-J[q];c.xq(g.h.UV2Kind,J,!1)}if(U.uvs3AttrDesc&&U.uvs3AttrDesc.count>0){const J=new Float32Array(q,U.uvs3AttrDesc.offset,U.uvs3AttrDesc.count);if(H.b)for(let q=1;q<J.length;q+=2)J[q]=1-J[q];c.xq(g.h.UV3Kind,J,!1)}if(U.uvs4AttrDesc&&U.uvs4AttrDesc.count>0){const J=new Float32Array(q,U.uvs4AttrDesc.offset,U.uvs4AttrDesc.count);if(H.b)for(let q=1;q<J.length;q+=2)J[q]=1-J[q];c.xq(g.h.UV4Kind,J,!1)}if(U.uvs5AttrDesc&&U.uvs5AttrDesc.count>0){const J=new Float32Array(q,U.uvs5AttrDesc.offset,U.uvs5AttrDesc.count);if(H.b)for(let q=1;q<J.length;q+=2)J[q]=1-J[q];c.xq(g.h.UV5Kind,J,!1)}if(U.uvs6AttrDesc&&U.uvs6AttrDesc.count>0){const J=new Float32Array(q,U.uvs6AttrDesc.offset,U.uvs6AttrDesc.count);if(H.b)for(let q=1;q<J.length;q+=2)J[q]=1-J[q];c.xq(g.h.UV6Kind,J,!1)}if(U.colorsAttrDesc&&U.colorsAttrDesc.count>0){const J=new Float32Array(q,U.colorsAttrDesc.offset,U.colorsAttrDesc.count);c.xq(g.h.ColorKind,J,!1,U.colorsAttrDesc.stride)}if(U.matricesIndicesAttrDesc&&U.matricesIndicesAttrDesc.count>0){const J=new Int32Array(q,U.matricesIndicesAttrDesc.offset,U.matricesIndicesAttrDesc.count),Q=[];for(let q=0;q<J.length;q++){const c=J[q];Q.push(255&c),Q.push((65280&c)>>8),Q.push((16711680&c)>>16),Q.push(c>>24&255)}c.xq(g.h.MatricesIndicesKind,Q,!1)}if(U.matricesIndicesExtraAttrDesc&&U.matricesIndicesExtraAttrDesc.count>0){const J=new Int32Array(q,U.matricesIndicesExtraAttrDesc.offset,U.matricesIndicesExtraAttrDesc.count),Q=[];for(let q=0;q<J.length;q++){const c=J[q];Q.push(255&c),Q.push((65280&c)>>8),Q.push((16711680&c)>>16),Q.push(c>>24&255)}c.xq(g.h.MatricesIndicesExtraKind,Q,!1)}if(U.matricesWeightsAttrDesc&&U.matricesWeightsAttrDesc.count>0){const J=new Float32Array(q,U.matricesWeightsAttrDesc.offset,U.matricesWeightsAttrDesc.count);c.xq(g.h.MatricesWeightsKind,J,!1)}if(U.indicesAttrDesc&&U.indicesAttrDesc.count>0){const J=new Int32Array(q,U.indicesAttrDesc.offset,U.indicesAttrDesc.count);c.setIndices(J,null)}if(U.subMeshesAttrDesc&&U.subMeshesAttrDesc.count>0){const J=new Int32Array(q,U.subMeshesAttrDesc.offset,5*U.subMeshesAttrDesc.count);c.Gc=[];for(let q=0;q<U.subMeshesAttrDesc.count;q++){const U=J[5*q+0],Q=J[5*q+1],s=J[5*q+2],g=J[5*q+3],n=J[5*q+4];X.c.AddToMesh(U,Q,s,g,n,c)}}}else if(q.Fq&&q.vq&&q.indices){if(c.xq(g.h.PositionKind,q.Fq,q.Fq._updatable||q.positionsUpdatable),c.xq(g.h.NormalKind,q.vq,q.vq._updatable||q.normalsUpdatable),q.tangents&&c.xq(g.h.TangentKind,q.tangents,q.tangents._updatable||q.tangentsUpdatable),q.kq&&c.xq(g.h.UVKind,q.kq,q.kq._updatable||q.uvsUpdatable),q.uvs2&&c.xq(g.h.UV2Kind,q.uvs2,q.uvs2._updatable||q.uvs2Updatable),q.uvs3&&c.xq(g.h.UV3Kind,q.uvs3,q.uvs3._updatable||q.uvs3Updatable),q.uvs4&&c.xq(g.h.UV4Kind,q.uvs4,q.uvs4._updatable||q.uvs4Updatable),q.uvs5&&c.xq(g.h.UV5Kind,q.uvs5,q.uvs5._updatable||q.uvs5Updatable),q.uvs6&&c.xq(g.h.UV6Kind,q.uvs6,q.uvs6._updatable||q.uvs6Updatable),q.Yq&&c.xq(g.h.ColorKind,Q.e.CheckColors4(q.Yq,q.Fq.length/3),q.Yq._updatable),q.matricesIndices)if(q.matricesIndices._isExpanded||q.matricesIndicesExpanded)delete q.matricesIndices._isExpanded,delete q.matricesIndicesExpanded,c.xq(g.h.MatricesIndicesKind,q.matricesIndices,q.matricesIndices._updatable||q.matricesIndicesUpdatable);else{const U=[];for(let c=0;c<q.matricesIndices.length;c++){const J=q.matricesIndices[c];U.push(255&J),U.push((65280&J)>>8),U.push((16711680&J)>>16),U.push(J>>24&255)}c.xq(g.h.MatricesIndicesKind,U,q.matricesIndices._updatable||q.matricesIndicesUpdatable)}if(q.matricesIndicesExtra)if(q.matricesIndicesExtraExpanded||q.matricesIndicesExtra._isExpanded)delete q.matricesIndices._isExpanded,delete q.matricesIndicesExtraExpanded,c.xq(g.h.MatricesIndicesExtraKind,q.matricesIndicesExtra,q.matricesIndicesExtra._updatable||q.matricesIndicesExtraUpdatable);else{const U=[];for(let c=0;c<q.matricesIndicesExtra.length;c++){const J=q.matricesIndicesExtra[c];U.push(255&J),U.push((65280&J)>>8),U.push((16711680&J)>>16),U.push(J>>24&255)}c.xq(g.h.MatricesIndicesExtraKind,U,q.matricesIndicesExtra._updatable||q.matricesIndicesExtraUpdatable)}q.matricesWeights&&(h._CleanMatricesWeights(q,c),c.xq(g.h.MatricesWeightsKind,q.matricesWeights,q.matricesWeights._updatable)),q.matricesWeightsExtra&&c.xq(g.h.MatricesWeightsExtraKind,q.matricesWeightsExtra,q.matricesWeights._updatable),c.setIndices(q.indices,null)}if(q.Gc){c.Gc=[];for(let U=0;U<q.Gc.length;U++){const J=q.Gc[U];X.c.AddToMesh(J.materialIndex,J.verticesStart,J.verticesCount,J.indexStart,J.indexCount,c)}}c._shouldGenerateFlatShading&&(c.convertToFlatShadedMesh(),c._shouldGenerateFlatShading=!1),c.o(!0),U.onMeshImportedObservable.notifyObservers(c)}static _CleanMatricesWeights(q,c){const U=.001;if(!n.c.CleanBoneMatrixWeights)return;let J=0;if(!(q.skeletonId>-1))return;{const U=c.Cq().getLastSkeletonById(q.skeletonId);if(!U)return;J=U.bones.length}const Q=c.getVerticesData(g.h.MatricesIndicesKind),s=c.getVerticesData(g.h.MatricesIndicesExtraKind),X=q.matricesWeights,W=q.matricesWeightsExtra,D=q.numBoneInfluencer,u=X.length;for(let g=0;g<u;g+=4){let q=0,c=-1;for(let J=0;J<4;J++){const Q=X[g+J];q+=Q,Q<U&&c<0&&(c=J)}if(W)for(let J=0;J<4;J++){const Q=W[g+J];q+=Q,Q<U&&c<0&&(c=J+4)}if((c<0||c>D-1)&&(c=D-1),q>U){const c=1/q;for(let q=0;q<4;q++)X[g+q]*=c;if(W)for(let q=0;q<4;q++)W[g+q]*=c}else c>=4?(W[g+c-4]=1-q,s[g+c-4]=J):(X[g+c]=1-q,Q[g+c]=J)}c.xq(g.h.MatricesIndicesKind,Q),q.matricesWeightsExtra&&c.xq(g.h.MatricesIndicesExtraKind,s)}static Parse(q,c,U){const Q=new h(q.id,c,void 0,q.updatable);return Q._loadedUniqueId=q.uniqueId,u.d&&u.d.AddTagsTo(Q,q.tags),q.delayLoadingFile?(Q.delayLoadState=4,Q.delayLoadingFile=U+q.delayLoadingFile,Q._boundingInfo=new W.e(J.p.Ic(q.boundingBoxMinimum),J.p.Ic(q.boundingBoxMaximum)),Q._delayInfo=[],q.hasUVs&&Q._delayInfo.push(g.h.UVKind),q.hasUVs2&&Q._delayInfo.push(g.h.UV2Kind),q.hasUVs3&&Q._delayInfo.push(g.h.UV3Kind),q.hasUVs4&&Q._delayInfo.push(g.h.UV4Kind),q.hasUVs5&&Q._delayInfo.push(g.h.UV5Kind),q.hasUVs6&&Q._delayInfo.push(g.h.UV6Kind),q.hasColors&&Q._delayInfo.push(g.h.ColorKind),q.hasMatricesIndices&&Q._delayInfo.push(g.h.MatricesIndicesKind),q.hasMatricesWeights&&Q._delayInfo.push(g.h.MatricesWeightsKind),Q._delayLoadingFunction=s.c.ImportVertexData):s.c.ImportVertexData(q,Q),c.pushGeometry(Q,!0),Q}}},11144:(q,c,U)=>{U.d(c,{d:()=>K});var J=U(10833),Q=U(10886),s=U(11119),g=U(11149),X=U(10895),n=U(11107),W=U(11031),D=U(10879),u=U(10850);g.b._instancedMeshFactory=(q,c)=>{const U=new K(q,c);if(c.instancedBuffers){U.instancedBuffers={};for(const q in c.instancedBuffers)U.instancedBuffers[q]=c.instancedBuffers[q]}return U};class K extends s.c{constructor(q,c){super(q,c.Cq()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,c.bK(this),this._sourceMesh=c,this._unIndexed=c._unIndexed,this.position.X(c.position),this.rotation.X(c.rotation),this.ac.X(c.ac),c.rotationQuaternion&&(this.rotationQuaternion=c.rotationQuaternion.clone()),this.animations=c.animations.slice();for(const U of c.getAnimationRanges())null!=U&&this.createAnimationRange(U.name,U.from,U.to);if(this.infiniteDistance=c.infiniteDistance,this.setPivotMatrix(c.getPivotMatrix()),c.skeleton||c.morphTargetManager||!c.hasBoundingInfo)this.refreshBoundingInfo(!0,!0);else{const q=c.getBoundingInfo();this.buildBoundingInfo(q.minimum,q.maximum)}this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(q){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.receiveShadows)!==q&&D.e.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(q){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.material)!==q&&D.e.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(q){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.visibility)!==q&&D.e.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(q){var c;(null===(c=this._sourceMesh)||void 0===c?void 0:c.skeleton)!==q&&D.e.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(q){this._sourceMesh&&q!==this._sourceMesh.renderingGroupId&&Q.c.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}get Dc(){return this._sourceMesh._geometry}createInstance(q){return this._sourceMesh.createInstance(q)}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(q,!0)}getVerticesData(q,c,U){return this._sourceMesh.getVerticesData(q,c,U)}copyVerticesData(q,c){this._sourceMesh.copyVerticesData(q,c)}xq(q,c,U,J){return this.sourceMesh&&this.sourceMesh.xq(q,c,U,J),this.sourceMesh}updateVerticesData(q,c,U,J){return this.sourceMesh&&this.sourceMesh.updateVerticesData(q,c,U,J),this.sourceMesh}setIndices(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(q,c),this.sourceMesh}isVerticesDataPresent(q){return this._sourceMesh.isVerticesDataPresent(q)}uc(){return this._sourceMesh.uc()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let q,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;q="object"===typeof c?c:{applySkeleton:c,applyMorph:U};const J=this._sourceMesh.Dc?this._sourceMesh.Dc.boundingBias:null;return this.Zq(this._sourceMesh._getData(q,null,W.h.PositionKind),J),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(q,c){if(super._activate(q,c),this._sourceMesh.Gc||Q.c.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,q),c){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD!==this._sourceMesh&&this._currentLOD.billboardMode!==n.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new J.d);const q=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,J.j.hc[7].X(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.X(this._currentLOD.o(!0)),this._currentLOD.position.X(J.j.hc[7]),this._currentLOD._masterMesh=q,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(q){if(!q)return this;const c=this.sourceMesh.getLODLevels();if(c&&0!==c.length){const c=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(q,c.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(q){return this.sourceMesh._preActivateForIntermediateRendering(q)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Gc)for(let q=0;q<this._sourceMesh.Gc.length;q++)this._sourceMesh.Gc[q].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Sq(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;const J=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(q);if(X.e.DeepCopy(this,J,["name","Gc","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Eu","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo","Dc"],[]),this.refreshBoundingInfo(),c&&(J.parent=c),!U)for(let Q=0;Q<this.Cq().meshes.length;Q++){const q=this.Cq().meshes[Q];q.parent===this&&q.clone(q.name,J)}return J.o(!0),this.onClonedObservable.notifyObservers(J),J}dispose(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.HK(this),super.dispose(q,c)}_serializeAsParent(q){super._serializeAsParent(q),q.parentId=this._sourceMesh.uniqueId,q.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;const J=this.clone("Clone of "+(this.name||this.id),q||this.parent,!0,c&&c.newSourcedMesh);J&&U&&U(this,J);for(const Q of this.getChildTransformNodes(!0))Q.instantiateHierarchy(J,c,U);return J}}g.b.prototype.registerInstancedBuffer=function(q,c){var U,J;if(null===(U=this._userInstancedBuffersStorage)||void 0===U||null===(J=U.vertexBuffers[q])||void 0===J||J.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const q of this.instances)q.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[q]=null,this._userInstancedBuffersStorage.strides[q]=c,this._userInstancedBuffersStorage.sizes[q]=32*c,this._userInstancedBuffersStorage.data[q]=new Float32Array(this._userInstancedBuffersStorage.sizes[q]),this._userInstancedBuffersStorage.vertexBuffers[q]=new W.h(this.getEngine(),this._userInstancedBuffersStorage.data[q],q,!0,!1,c,!0);for(const Q of this.instances)Q.instancedBuffers[q]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},g.b.prototype._processInstancedBuffers=function(q,c){const U=q?q.length:0;for(const J in this.instancedBuffers){let Q=this._userInstancedBuffersStorage.sizes[J];const s=this._userInstancedBuffersStorage.strides[J],g=(U+1)*s;for(;Q<g;)Q*=2;this._userInstancedBuffersStorage.data[J].length!=Q&&(this._userInstancedBuffersStorage.data[J]=new Float32Array(Q),this._userInstancedBuffersStorage.sizes[J]=Q,this._userInstancedBuffersStorage.vertexBuffers[J]&&(this._userInstancedBuffersStorage.vertexBuffers[J].dispose(),this._userInstancedBuffersStorage.vertexBuffers[J]=null));const X=this._userInstancedBuffersStorage.data[J];let n=0;if(c){const q=this.instancedBuffers[J];q.toArray?q.toArray(X,n):q.copyToArray?q.copyToArray(X,n):X[n]=q,n+=s}for(let c=0;c<U;c++){const U=q[c].instancedBuffers[J];U.toArray?U.toArray(X,n):U.copyToArray?U.copyToArray(X,n):X[n]=U,n+=s}this._userInstancedBuffersStorage.vertexBuffers[J]?this._userInstancedBuffersStorage.vertexBuffers[J].updateDirectly(X,0):(this._userInstancedBuffersStorage.vertexBuffers[J]=new W.h(this.getEngine(),this._userInstancedBuffersStorage.data[J],J,!0,!1,s,!0),this._invalidateInstanceVertexArrayObject())}},g.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const q in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[q]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},g.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const q in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[q]&&this._userInstancedBuffersStorage.vertexBuffers[q].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,u.f)("BABYLON.InstancedMesh",K)},11486:(q,c,U)=>{U.d(c,{d:()=>W});var J=U(11093),Q=U(11031),s=U(11149),g=U(11144),X=U(11004),n=U(11495);s.b._LinesMeshParser=(q,c)=>W.Parse(q,c);class W extends s.b{_isShaderMaterial(q){return"ShaderMaterial"===q.getClassName()}constructor(q){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0,X=arguments.length>7?arguments[7]:void 0;super(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,c,arguments.length>4?arguments[4]:void 0),this.useVertexColor=s,this.useVertexAlpha=g,this.color=new J.c(1,1,1),this.alpha=1,this._shaderLanguage=0,c&&(this.color=c.color.clone(),this.alpha=c.alpha,this.useVertexColor=c.useVertexColor,this.useVertexAlpha=c.useVertexAlpha),this.intersectionThreshold=.1;const D={attributes:[Q.h.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(this.useVertexAlpha?D.defines.push("#define VERTEXALPHA"):D.needAlphaBlending=!1,this.useVertexColor?(D.defines.push("#define VERTEXCOLOR"),D.attributes.push(Q.h.ColorKind)):(D.uniforms.push("color"),this._color4=new J.e),X)this.material=X;else{this.Cq().getEngine().isWebGPU&&!W.ForceGLSL&&(this._shaderLanguage=1),D.shaderLanguage=this._shaderLanguage,D.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([U.e(23).then(U.bind(U,13997)),U.e(19).then(U.bind(U,14e3))]):await Promise.all([U.e(17).then(U.bind(U,14008)),U.e(16).then(U.bind(U,14011))])},this.material=new n.b("colorShader",this.Cq(),"color",D,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(q){this._lineMaterial=q,this._lineMaterial.fillMode=X.b.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(q){}_bind(q,c){if(!this._geometry)return this;const U=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(c,U):this._geometry._bind(c,U,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:q,g:c,b:U}=this.color;this._color4.set(q,c,U,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(q,c,U){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const J=this.Cq().getEngine();return this._unIndexed?J.drawArraysType(X.b.LineListDrawMode,q.verticesStart,q.verticesCount,U):J.drawElementsType(X.b.LineListDrawMode,q.indexStart,q.indexCount,U),this}dispose(q){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(q)}clone(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0;if(c&&void 0===c._addToSceneRootNodes){const U=c;return U.source=this,new W(q,this.Cq(),U.parent,U.source,U.doNotCloneChildren)}return new W(q,this.Cq(),c,this,U)}createInstance(q){const c=new D(q,this);if(this.instancedBuffers){c.instancedBuffers={};for(const q in this.instancedBuffers)c.instancedBuffers[q]=this.instancedBuffers[q]}return c}serialize(q){super.serialize(q),q.color=this.color.rc(),q.alpha=this.alpha}static Parse(q,c){const U=new W(q.name,c);return U.color=J.c.Ic(q.color),U.alpha=q.alpha,U}}W.ForceGLSL=!1;class D extends g.d{constructor(q,c){super(q,c),this.intersectionThreshold=c.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}},11149:(q,c,U)=>{U.d(c,{b:()=>S,e:()=>v});var J=U(10866),Q=U(10879),s=U(10895),g=U(11087),X=U(11127),n=U(11151),W=U(10833),D=U(11093),u=U(11113),K=U(11031),r=U(11125),H=U(11170),b=U(11119),h=U(11025),o=U(11004),a=U(11183),p=U(11175),R=U(11082),I=U(10886),t=U(10850),C=U(10910),i=U(11192);class F{constructor(q,c){this.distanceOrScreenCoverage=q,this.mesh=c}}class v{}class Y{constructor(){this.visibleInstances={},this.batchCache=new k,this.batchCacheReplacementModeInFrozenMode=new k,this.instancesBufferSize=2048}}class k{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class V{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class O{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}const G={source:null,parent:null,doNotCloneChildren:!1,clonePhysicsImpostor:!0,cloneThinInstances:!1};class S extends b.c{static _GetDefaultSideOrientation(q){return q||S.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(q){this._internalMeshDataInfo._useLODScreenCoverage=q,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(q){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==q&&(q&&this._internalMeshDataInfo._sourcePositions&&(this.xq(K.h.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.xq(K.h.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=q,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new J.e),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new J.e),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new J.e),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new J.e),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new J.e),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(q){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(q)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(q){this._internalMeshDataInfo._forcedInstanceCount=q}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(q){this._internalMeshDataInfo._sideOrientation=q,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===q||!this._scene.useRightHandedSystem&&0===q}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(q){this.sideOrientation=q,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(q){this._internalMeshDataInfo._overrideRenderingFillMode=q}get material(){return this._internalAbstractMeshDataInfo._material}set material(q){q&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(q.sideOrientation=null),this._setMaterial(q)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(q){this._unIndexed!==q&&(this._unIndexed=q,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(q){this._instanceDataStorage.manualUpdate=q}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(q){this._instanceDataStorage.previousManualUpdate=q}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(q){this._instanceDataStorage.forceMatrixUpdates=q}_copySource(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const Q=this.Cq();if(q._geometry&&q._geometry.Oq(this),s.e.DeepCopy(q,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Dc","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","Eu","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=q,Q.useClonedMeshMap&&(q._internalMeshDataInfo.meshMap||(q._internalMeshDataInfo.meshMap={}),q._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=q._originalBuilderSideOrientation,this._creationDataStorage=q._creationDataStorage,q._ranges){const c=q._ranges;for(const q in c)Object.prototype.hasOwnProperty.call(c,q)&&c[q]&&this.createAnimationRange(q,c[q].from,c[q].to)}if(q.metadata&&q.metadata.clone?this.metadata=q.metadata.clone():this.metadata=q.metadata,this._internalMetadata=q._internalMetadata,g.d&&g.d.HasTags(q)&&g.d.AddTagsTo(this,g.d.GetTags(q,!0)),this.LX(q.isEnabled(!1)),this.parent=q.parent,this.setPivotMatrix(q.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+q.id,this.material=q.material,!c){const Q=q.getDescendants(!0);for(let q=0;q<Q.length;q++){const s=Q[q];s._isMesh?(G.parent=this,G.doNotCloneChildren=c,G.clonePhysicsImpostor=U,G.cloneThinInstances=J,s.clone(this.name+"."+s.name,G)):s.clone&&s.clone(this.name+"."+s.name,this)}}if(q.morphTargetManager&&(this.morphTargetManager=q.morphTargetManager),Q.getPhysicsEngine){const c=Q.getPhysicsEngine();if(U&&c)if(1===c.getPluginVersion()){const U=c.getImpostorForPhysicsObject(q);U&&(this.physicsImpostor=U.clone(this))}else 2===c.getPluginVersion()&&q.physicsBody&&q.physicsBody.clone(this)}for(let s=0;s<Q.qK.length;s++){const c=Q.qK[s];c.j===q&&c.clone(c.name,this)}if(this.skeleton=q.skeleton,J&&(q._thinInstanceDataStorage.matrixData?(this.ou("matrix",new Float32Array(q._thinInstanceDataStorage.matrixData),16,!q._thinInstanceDataStorage.matrixBuffer.isUpdatable()),this._thinInstanceDataStorage.matrixBufferSize=q._thinInstanceDataStorage.matrixBufferSize,this._thinInstanceDataStorage.instancesCount=q._thinInstanceDataStorage.instancesCount):this._thinInstanceDataStorage.matrixBufferSize=q._thinInstanceDataStorage.matrixBufferSize,q._userThinInstanceBuffersStorage)){const c=q._userThinInstanceBuffersStorage;for(const q in c.data){var X,n;this.ou(q,new Float32Array(c.data[q]),c.strides[q],!(null!==(X=c.vertexBuffers)&&void 0!==X&&null!==(n=X[q])&&void 0!==n&&n.isUpdatable())),this._userThinInstanceBuffersStorage.sizes[q]=c.sizes[q]}}this.refreshBoundingInfo(!0,!0),this.o(!0)}constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4?arguments[4]:void 0,g=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(q,c),this._internalMeshDataInfo=new O,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new Y,this._thinInstanceDataStorage=new V,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=S.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,c=this.Cq(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(q,c,U)=>{q&&U&&(this._uniformBuffer?this.transferToEffect(c):U.bindOnlyWorldMatrix(c))};let X=null,n=!1;if(U&&void 0===U._addToSceneRootNodes){const q=U;X=q.parent??null,Q=q.source??null,s=q.doNotCloneChildren??!1,g=q.clonePhysicsImpostor??!0,n=q.cloneThinInstances??!1}else X=U;Q&&this._copySource(Q,s,g,n),null!==X&&(this.parent=X),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=q=>{q.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new J.e(this._internalMeshDataInfo._onMeshReadyObserverAdded),Q&&Q.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;const J=0===this.getTotalVertices()||c&&c.doNotInstantiate&&(!0===c.doNotInstantiate||c.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),q||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));J.parent=q||this.parent,J.position=this.position.clone(),J.ac=this.ac.clone(),this.rotationQuaternion?J.rotationQuaternion=this.rotationQuaternion.clone():J.rotation=this.rotation.clone(),U&&U(this,J);for(const Q of this.getChildTransformNodes(!0))"InstancedMesh"===Q.getClassName()&&"Mesh"===J.getClassName()&&Q.sourceMesh===this?Q.instantiateHierarchy(J,{doNotInstantiate:c&&c.doNotInstantiate||!1,newSourcedMesh:J},U):Q.instantiateHierarchy(J,c,U);return J}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(q){let c=super.toString(q);if(c+=", n vertices: "+this.getTotalVertices(),c+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let U=0;U<this.animations.length;U++)c+=", animation[0]: "+this.animations[U].toString(q);if(q)if(this._geometry){const q=this.uc(),U=this.getVerticesData(K.h.PositionKind);U&&q&&(c+=", flat shading: "+(U.length/3===q.length?"YES":"NO"))}else c+=", flat shading: UNKNOWN";return c}_unBindEffect(){super._unBindEffect();for(const q of this.instances)q._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const q=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((c,U)=>c.distanceOrScreenCoverage<U.distanceOrScreenCoverage?q:c.distanceOrScreenCoverage>U.distanceOrScreenCoverage?-q:0))}addLODLevel(q,c){if(c&&c._masterMesh)return I.c.Warn("You cannot use a mesh as LOD level twice"),this;const U=new F(q,c);return this._internalMeshDataInfo._LODLevels.push(U),c&&(c._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(q){const c=this._internalMeshDataInfo;for(let U=0;U<c._LODLevels.length;U++){const J=c._LODLevels[U];if(J.distanceOrScreenCoverage===q)return J.mesh}return null}removeLODLevel(q){const c=this._internalMeshDataInfo;for(let U=0;U<c._LODLevels.length;U++)c._LODLevels[U].mesh===q&&(c._LODLevels.splice(U,1),q&&(q._masterMesh=null));return this._sortLODLevels(),this}getLOD(q,c){const U=this._internalMeshDataInfo;if(!U._LODLevels||0===U._LODLevels.length)return this;const J=c||this.getBoundingInfo().boundingSphere,Q=q.mode===n.d.ORTHOGRAPHIC_CAMERA?q.Oc:J.centerWorld.eU(q.globalPosition).length();let s=Q,g=1;if(U._useLODScreenCoverage){const c=q.screenArea;let U=J.radiusWorld*q.Oc/Q;U=U*U*Math.PI,s=U/c,g=-1}if(g*U._LODLevels[U._LODLevels.length-1].distanceOrScreenCoverage>g*s)return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this;for(let X=0;X<U._LODLevels.length;X++){const q=U._LODLevels[X];if(g*q.distanceOrScreenCoverage<g*s){if(q.mesh){if(4===q.mesh.delayLoadState)return q.mesh._checkDelayState(),this;if(2===q.mesh.delayLoadState)return this;q.mesh._preActivate(),q.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,q.mesh),q.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(s,this,this),this}get Dc(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(q,c,U,J){var Q,s;if(!this._geometry)return null;let g=J||null===(Q=this._userInstancedBuffersStorage)||void 0===Q||null===(s=Q.vertexBuffers[q])||void 0===s?void 0:s.getFloatData(this.instances.length+1,U||c&&1!==this._geometry.meshes.length);return g||(g=this._geometry.getVerticesData(q,c,U)),g}copyVerticesData(q,c){this._geometry&&this._geometry.copyVerticesData(q,c)}getVertexBuffer(q,c){var U;return this._geometry?(c||null===(U=this._userInstancedBuffersStorage)||void 0===U?void 0:U.vertexBuffers[q])??this._geometry.getVertexBuffer(q):null}isVerticesDataPresent(q,c){var U;return this._geometry?!c&&void 0!==(null===(U=this._userInstancedBuffersStorage)||void 0===U?void 0:U.vertexBuffers[q])||this._geometry.isVerticesDataPresent(q):!!this._delayInfo&&-1!==this._delayInfo.indexOf(q)}isVertexBufferUpdatable(q,c){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(q);if(!c){var U;const c=null===(U=this._userInstancedBuffersStorage)||void 0===U?void 0:U.vertexBuffers[q];if(c)return c.isUpdatable()}return this._geometry.isVertexBufferUpdatable(q)}getVerticesDataKinds(q){if(!this._geometry){const q=[];if(this._delayInfo)for(const c of this._delayInfo)q.push(c);return q}const c=this._geometry.getVerticesDataKinds();if(!q&&this._userInstancedBuffersStorage)for(const U in this._userInstancedBuffersStorage.vertexBuffers)-1===c.indexOf(U)&&c.push(U);return c}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}uc(q,c){return this._geometry?this._geometry.uc(q,c):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(q))return!1;if(!this.Gc||0===this.Gc.length)return!0;if(!q)return!0;const U=this.getEngine(),J=this.Cq(),Q=c||U.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.o();const s=this.material||J.defaultMaterial;if(s)if(s._storeEffectOnSubMeshes)for(const K of this.Gc){const q=K.zq();if(q)if(q._storeEffectOnSubMeshes){if(!q.isReadyForSubMesh(this,K,Q))return!1}else if(!q.isReady(this,Q))return!1}else if(!s.isReady(this,Q))return!1;const g=U.currentRenderPassId;for(const K of this.lightSources){const q=K.getShadowGenerators();if(!q)continue;const c=q.values();for(let J=c.next();!0!==J.done;J=c.next()){var X,n,W,D;const q=J.value;if(q&&(null===(X=q.getShadowMap())||void 0===X||!X.renderList||null!==(n=q.getShadowMap())&&void 0!==n&&n.renderList&&-1!==(null===(W=q.getShadowMap())||void 0===W||null===(D=W.renderList)||void 0===D?void 0:D.indexOf(this)))){const c=q.getShadowMap().renderPassIds??[U.currentRenderPassId];for(let J=0;J<c.length;++J){U.currentRenderPassId=c[J];for(const c of this.Gc){var u;if(!q.isReady(c,Q,(null===(u=c.zq())||void 0===u?void 0:u.needAlphaBlendingForMesh(this))??!1))return U.currentRenderPassId=g,!1}}U.currentRenderPassId=g}}}for(const K of this._internalMeshDataInfo._LODLevels)if(K.mesh&&!K.mesh.isReady(Q))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}vD(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(q){this._instanceDataStorage.overridenInstanceCount=q}_preActivate(){const q=this._internalMeshDataInfo,c=this.Cq().getRenderId();return q._preActivateId===c||(q._preActivateId=c,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(q){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=q),this}_registerInstanceForRenderId(q,c){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:c,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[c]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=c,this._instanceDataStorage.visibleInstances[c]=new Array),this._instanceDataStorage.visibleInstances[c].push(q),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Gq||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let q,c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;q="object"===typeof c?c:{applySkeleton:c,applyMorph:U};const J=this.Dc?this.Dc.boundingBias:null;return this.Zq(this._getData(q,null,K.h.PositionKind),J),this}_createGlobalSubMesh(q){const c=this.getTotalVertices();if(!c||!this.uc())return null;if(this.Gc&&this.Gc.length>0){const U=this.uc();if(!U)return null;const J=U.length;let Q=!1;if(q)Q=!0;else for(const q of this.Gc){if(q.indexStart+q.indexCount>J){Q=!0;break}if(q.verticesStart+q.verticesCount>c){Q=!0;break}}if(!Q)return this.Gc[0]}return this.releaseSubMeshes(),new h.c(0,0,c,0,this.getTotalIndices()||c,this)}subdivide(q){if(q<1)return;const c=this.getTotalIndices();let U=c/q|0,J=0;for(;U%3!==0;)U++;this.releaseSubMeshes();for(let Q=0;Q<q&&!(J>=c);Q++)h.c.CreateFromIndices(0,J,Q===q-1?c-J:U,this,void 0,!1),J+=U;this.refreshBoundingInfo(),this.synchronizeInstances()}xq(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.xq(q,c,U,J);else{const J=new r.c;J.set(c,q);const Q=this.Cq();new H.d(H.d.RandomId(),Q,J,U,this)}return this}removeVerticesData(q){this._geometry&&this._geometry.removeVerticesData(q)}markVerticesDataAsUpdatable(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const U=this.getVertexBuffer(q);U&&U.isUpdatable()!==c&&this.xq(q,this.getVerticesData(q),c)}setVerticesBuffer(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=H.d.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(q,null,c),this}updateVerticesData(q,c,U,J){return this._geometry?(J?(this.makeGeometryUnique(),this.updateVerticesData(q,c,U,!1)):this._geometry.updateVerticesData(q,c,U),this):this}updateMeshPositions(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const U=this.getVerticesData(K.h.PositionKind);if(!U)return this;if(q(U),this.updateVerticesData(K.h.PositionKind,U,!1,!1),c){const q=this.uc(),c=this.getVerticesData(K.h.NormalKind);if(!c)return this;r.c.ComputeNormals(U,q,c),this.updateVerticesData(K.h.NormalKind,c,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const q=this._geometry,c=this._geometry.k(H.d.RandomId());return q.releaseForMesh(this,!0),c.Oq(this),this}setIndexBuffer(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Q=this._geometry;Q||(Q=new H.d(H.d.RandomId(),this.Cq(),void 0,void 0,this)),Q.setIndexBuffer(q,c,U,J)}setIndices(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(q,c,U,J);else{const c=new r.c;c.indices=q;const J=this.Cq();new H.d(H.d.RandomId(),J,c,U,this)}return this}updateIndices(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(q,c,U),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(q,c,U){let J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const Q=this.Cq().getEngine();let s;if(this._unIndexed)if(this._getRenderingFillMode(U)===o.b.WireFrameFillMode)s=q._getLinesIndexBuffer(this.uc(),Q);else s=null;else switch(this._getRenderingFillMode(U)){case o.b.PointFillMode:s=null;break;case o.b.WireFrameFillMode:s=q._getLinesIndexBuffer(this.uc(),Q);break;default:case o.b.TriangleFillMode:s=this._geometry.getIndexBuffer()}return this._bindDirect(c,s,J)}_bindDirect(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(q),U&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(q,c,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(q,c),this):this}_draw(q,c,U){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const J=this.Cq().getEngine();return this._unIndexed&&c!==o.b.WireFrameFillMode||c==o.b.PointFillMode?J.drawArraysType(c,q.verticesStart,q.verticesCount,this.forcedInstanceCount||U):c==o.b.WireFrameFillMode?J.drawElementsType(c,0,q._linesIndexCount,this.forcedInstanceCount||U):J.drawElementsType(c,q.indexStart,q.indexCount,this.forcedInstanceCount||U),this}registerBeforeRender(q){return this.onBeforeRenderObservable.add(q),this}unregisterBeforeRender(q){return this.onBeforeRenderObservable.removeCallback(q),this}registerAfterRender(q){return this.onAfterRenderObservable.add(q),this}unregisterAfterRender(q){return this.onAfterRenderObservable.removeCallback(q),this}_getInstancesRenderList(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(c)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[q]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[q]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const U=this.Cq(),J=U._isInIntermediateRendering(),Q=J?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,s=this._instanceDataStorage.batchCache;if(s.mustReturn=!1,s.renderSelf[q]=c||!Q&&this.isEnabled()&&this.isVisible,s.visibleInstances[q]=null,this._instanceDataStorage.visibleInstances&&!c){const c=this._instanceDataStorage.visibleInstances,Q=U.getRenderId(),g=J?c.intermediateDefaultRenderId:c.defaultRenderId;s.visibleInstances[q]=c[Q],!s.visibleInstances[q]&&g&&(s.visibleInstances[q]=c[g])}return s.hardwareInstancedRendering[q]=!c&&this._instanceDataStorage.hardwareInstancedRendering&&null!==s.visibleInstances[q]&&void 0!==s.visibleInstances[q],this._instanceDataStorage.previousBatch=s,s}_updateInstancedBuffers(q,c,U,J,Q,s){const g=c.visibleInstances[q._id],X=g?g.length:0,n=this._instanceDataStorage;let D=n.instancesBuffer,u=n.instancesPreviousBuffer,r=0,H=0;const b=c.renderSelf[q._id],h=!D||U!==n.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!n.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||n.isFrozen&&!h)H=(b?1:0)+X;else{const c=this.getWorldMatrix();if(b&&(this._scene.needsPreviousWorldMatrices&&(n.masterMeshPreviousWorldMatrix?(n.masterMeshPreviousWorldMatrix.copyToArray(n.instancesPreviousData,r),n.masterMeshPreviousWorldMatrix.X(c)):(n.masterMeshPreviousWorldMatrix=c.clone(),n.masterMeshPreviousWorldMatrix.copyToArray(n.instancesPreviousData,r))),c.copyToArray(n.instancesData,r),r+=16,H++),g){var o;if(S.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(o=q.zq())&&void 0!==o&&o.needAlphaBlendingForMesh(q.getRenderingMesh())){const q=this._scene.activeCamera.globalPosition;for(let c=0;c<g.length;c++){const U=g[c];U._distanceToCamera=W.p.Distance(U.getBoundingInfo().boundingSphere.centerWorld,q)}g.sort(((q,c)=>q._distanceToCamera>c._distanceToCamera?-1:q._distanceToCamera<c._distanceToCamera?1:0))}for(let q=0;q<g.length;q++){const c=g[q],U=c.getWorldMatrix();U.copyToArray(n.instancesData,r),this._scene.needsPreviousWorldMatrices&&(c._previousWorldMatrix?(c._previousWorldMatrix.copyToArray(n.instancesPreviousData,r),c._previousWorldMatrix.X(U)):(c._previousWorldMatrix=U.clone(),c._previousWorldMatrix.copyToArray(n.instancesPreviousData,r))),r+=16,H++}}}h?(D&&D.dispose(),u&&u.dispose(),D=new K.e(J,n.instancesData,!0,16,!1,!0),n.instancesBuffer=D,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=D.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=D.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=D.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=D.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(u=new K.e(J,n.instancesPreviousData,!0,16,!1,!0),n.instancesPreviousBuffer=u,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=u.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=u.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=u.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=u.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(D.updateDirectly(n.instancesData,0,H),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||u.updateDirectly(n.instancesPreviousData,0,H)),this._processInstancedBuffers(g,b),s&&void 0!==Q&&(this.Cq()._activeIndices.addCount(q.indexCount*H,!1),J._currentDrawContext&&(J._currentDrawContext.useInstancing=!0),this._bind(q,s,Q),this._draw(q,Q,H)),!this._scene.needsPreviousWorldMatrices||h||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||u.updateDirectly(n.instancesData,0,H)}_renderWithInstances(q,c,U,J,Q){const s=U.visibleInstances[q._id],g=s?s.length:0,X=this._instanceDataStorage,n=X.instancesBufferSize,W=16*(g+1)*4;for(;X.instancesBufferSize<W;)X.instancesBufferSize*=2;return X.instancesData&&n==X.instancesBufferSize||(X.instancesData=new Float32Array(X.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!X.instancesPreviousData||n!=X.instancesBufferSize)&&(X.instancesPreviousData=new Float32Array(X.instancesBufferSize/4)),this._updateInstancedBuffers(q,U,n,Q,c,J),Q.unbindInstanceAttributes(),this}_renderWithThinInstances(q,c,U,J){var Q;const s=(null===(Q=this._thinInstanceDataStorage)||void 0===Q?void 0:Q.instancesCount)??0;this.Cq()._activeIndices.addCount(q.indexCount*s,!1),J._currentDrawContext&&(J._currentDrawContext.useInstancing=!0),this._bind(q,U,c),this._draw(q,c,s),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,s):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),J.unbindInstanceAttributes()}_processInstancedBuffers(q,c){}_processRendering(q,c,U,J,Q,s,g,X){const n=this.Cq(),W=n.getEngine();if(J=this._getRenderingFillMode(J),s&&c.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(c,J,U,W),this;if(s)this._renderWithInstances(c,J,Q,U,W);else{W._currentDrawContext&&(W._currentDrawContext.useInstancing=!1);let U=0;Q.renderSelf[c._id]&&(g&&g(!1,q.getWorldMatrix(),X),U++,this._draw(c,J,this._instanceDataStorage.overridenInstanceCount));const s=Q.visibleInstances[c._id];if(s){const q=s.length;U+=q;for(let U=0;U<q;U++){const q=s[U].getWorldMatrix();g&&g(!0,q,X),this._draw(c,J)}}n._activeIndices.addCount(c.indexCount*U,!1)}return this}_rebuild(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(q&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const c in this._userInstancedBuffersStorage.vertexBuffers){const U=this._userInstancedBuffersStorage.vertexBuffers[c];U&&(q&&U.dispose(),this._userInstancedBuffersStorage.vertexBuffers[c]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(q)}_freeze(){if(this.Gc){for(let q=0;q<this.Gc.length;q++)this._getInstancesRenderList(q);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(q,c,U,J){let Q=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const s=this._scene.getEngine(),g=s.currentRenderPassId;if(void 0!==q&&(s.currentRenderPassId=q),J)(!Q||Q&&J.isInFrustum(this._scene._frustumPlanes))&&this.render(J,!!c,U);else for(let X=0;X<this.Gc.length;X++){const q=this.Gc[X];(!Q||Q&&q.isInFrustum(this._scene._frustumPlanes))&&this.render(q,!!c,U)}return void 0!==q&&(s.currentRenderPassId=g),this}directRender(){if(!this.Gc)return this;for(const q of this.Gc)this.render(q,!1);return this}render(q,c,U){var J,Q,s;const g=this.Cq();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const X=(null===(J=g.activeCameras)||void 0===J?void 0:J.length)??0;if((X>1&&g.activeCamera===g.activeCameras[0]||X<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const n=this._getInstancesRenderList(q._id,!!U);if(n.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const W=g.getEngine();let D=0,u=null;this.ignoreCameraMaxZ&&g.activeCamera&&!g._isInIntermediateRendering()&&(D=g.activeCamera.maxZ,u=g.activeCamera,g.activeCamera.maxZ=0,g.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const K=q.getRenderingMesh(),r=n.hardwareInstancedRendering[q._id]||K.hasThinInstances||!!this._userInstancedBuffersStorage&&!q.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,H=this._instanceDataStorage,b=q.zq();if(!b)return u&&(u.maxZ=D,g.updateTransformMatrix(!0)),this;if(H.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===b){if(b._storeEffectOnSubMeshes&&(null===(Q=q._drawWrapper)||void 0===Q||!Q._wasPreviouslyReady)||!b._storeEffectOnSubMeshes&&!b._getDrawWrapper()._wasPreviouslyReady)return u&&(u.maxZ=D,g.updateTransformMatrix(!0)),this}else{if(b._storeEffectOnSubMeshes){if(!b.isReadyForSubMesh(this,q,r))return u&&(u.maxZ=D,g.updateTransformMatrix(!0)),this}else if(!b.isReady(this,r))return u&&(u.maxZ=D,g.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=b}let h;c&&W.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),h=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?q._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const a=(null===(s=h)||void 0===s?void 0:s.effect)??null;for(const o of g._beforeRenderingMeshStage)o.action(this,q,n,a);if(!h||!a)return u&&(u.maxZ=D,g.updateTransformMatrix(!0)),this;const p=U||this;let R;if(H.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Kc&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)R=H.sideOrientation;else{const q=p._getWorldMatrixDeterminant();R=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),q<0&&(R=R===o.b.ClockWiseSideOrientation?o.b.CounterClockWiseSideOrientation:o.b.ClockWiseSideOrientation),H.sideOrientation=R}const I=this._internalMeshDataInfo._effectiveMaterial._preBind(h,R);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&W.setDepthWrite(!0);const t=this._internalMeshDataInfo._effectiveMaterial,C=t.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),r||this._bind(q,a,C,!1);const i=p.getWorldMatrix();t._storeEffectOnSubMeshes?t.bindForSubMesh(i,this,q):t.bind(i,this),!t.Kc&&t.separateCullingPass&&(W.setState(!0,t.zOffset,!1,!I,t.cullBackFaces,t.stencil,t.zOffsetUnits),this._processRendering(this,q,a,C,n,r,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),W.setState(!0,t.zOffset,!1,I,t.cullBackFaces,t.stencil,t.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(q)),this._processRendering(this,q,a,C,n,r,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const o of g._afterRenderingMeshStage)o.action(this,q,n,a);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),u&&(u.maxZ=D,g.updateTransformMatrix(!0)),2!==g.performancePriority||H.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(K.h.MatricesWeightsKind)&&(this.isVerticesDataPresent(K.h.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const q=this.getVerticesData(K.h.MatricesWeightsKind),c=q.length;for(let U=0;U<c;U+=4){const c=q[U]+q[U+1]+q[U+2]+q[U+3];if(0===c)q[U]=1;else{const J=1/c;q[U]*=J,q[U+1]*=J,q[U+2]*=J,q[U+3]*=J}}this.xq(K.h.MatricesWeightsKind,q)}_normalizeSkinWeightsAndExtra(){const q=this.getVerticesData(K.h.MatricesWeightsExtraKind),c=this.getVerticesData(K.h.MatricesWeightsKind),U=c.length;for(let J=0;J<U;J+=4){let U=c[J]+c[J+1]+c[J+2]+c[J+3];if(U+=q[J]+q[J+1]+q[J+2]+q[J+3],0===U)c[J]=1;else{const Q=1/U;c[J]*=Q,c[J+1]*=Q,c[J+2]*=Q,c[J+3]*=Q,q[J]*=Q,q[J+1]*=Q,q[J+2]*=Q,q[J+3]*=Q}}this.xq(K.h.MatricesWeightsKind,c),this.xq(K.h.MatricesWeightsKind,q)}validateSkinning(){const q=this.getVerticesData(K.h.MatricesWeightsExtraKind),c=this.getVerticesData(K.h.MatricesWeightsKind);if(null===c||null==this.skeleton)return{skinned:!1,valid:!0,jH:"not skinned"};const U=c.length;let J=0,Q=0,s=0,g=0;const X=null===q?4:8,n=[];for(let K=0;K<=X;K++)n[K]=0;for(let K=0;K<U;K+=4){let U=c[K],W=U,D=0===W?0:1;for(let Q=1;Q<X;Q++){const s=Q<4?c[K+Q]:q[K+Q-4];s>U&&J++,0!==s&&D++,W+=s,U=s}if(n[D]++,D>s&&(s=D),0===W)Q++;else{const U=1/W;let J=0;for(let Q=0;Q<X;Q++)J+=Q<4?Math.abs(c[K+Q]-c[K+Q]*U):Math.abs(q[K+Q-4]-q[K+Q-4]*U);J>.001&&g++}}const W=this.skeleton.bones.length,D=this.getVerticesData(K.h.MatricesIndicesKind),u=this.getVerticesData(K.h.MatricesIndicesExtraKind);let r=0;for(let K=0;K<U;K+=4)for(let q=0;q<X;q++){const c=q<4?D[K+q]:u[K+q-4];(c>=W||c<0)&&r++}return{skinned:!0,valid:0===Q&&0===g&&0===r,jH:"Number of Weights = "+U/4+"\nMaximum influences = "+s+"\nMissing Weights = "+Q+"\nNot Sorted = "+J+"\nNot Normalized = "+g+"\nWeightCounts = ["+n+"]\nNumber of bones = "+W+"\nBad Bone Indices = "+r}}_checkDelayState(){const q=this.Cq();return this._geometry?this._geometry.load(q):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(q)),this}_queueLoad(q){q.addPendingData(this);const c=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return Q.e.LoadFile(this.delayLoadingFile,(c=>{c instanceof ArrayBuffer?this._delayLoadingFunction(c,this):this._delayLoadingFunction(JSON.parse(c),this);for(const q of this.instances)q.refreshBoundingInfo(),q._syncSubMeshes();this.delayLoadState=1,q.removePendingData(this)}),(()=>{}),q.offlineProvider,c),this}isInFrustum(q){return 2!==this.delayLoadState&&(!!super.isInFrustum(q)&&(this._checkDelayState(),!0))}setMaterialById(q){const c=this.Cq().materials;let U;for(U=c.length-1;U>-1;U--)if(c[U].id===q)return this.material=c[U],this;const J=this.Cq().multiMaterials;for(U=J.length-1;U>-1;U--)if(J[U].id===q)return this.material=J[U],this;return this}getAnimatables(){const q=[];return this.material&&q.push(this.material),this.skeleton&&q.push(this.skeleton),q}bakeTransformIntoVertices(q){if(!this.isVerticesDataPresent(K.h.PositionKind))return this;const c=this.Gc.splice(0);this._resetPointsArrayCache();let U=this.getVerticesData(K.h.PositionKind);const J=W.p.Zero();let Q;for(Q=0;Q<U.length;Q+=3)W.p.TransformCoordinatesFromFloatsToRef(U[Q],U[Q+1],U[Q+2],q,J).toArray(U,Q);if(this.xq(K.h.PositionKind,U,this.getVertexBuffer(K.h.PositionKind).isUpdatable()),this.isVerticesDataPresent(K.h.NormalKind)){for(U=this.getVerticesData(K.h.NormalKind),Q=0;Q<U.length;Q+=3)W.p.TransformNormalFromFloatsToRef(U[Q],U[Q+1],U[Q+2],q,J).normalize().toArray(U,Q);this.xq(K.h.NormalKind,U,this.getVertexBuffer(K.h.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(K.h.TangentKind)){for(U=this.getVerticesData(K.h.TangentKind),Q=0;Q<U.length;Q+=4)W.p.TransformNormalFromFloatsToRef(U[Q],U[Q+1],U[Q+2],q,J).normalize().toArray(U,Q);this.xq(K.h.TangentKind,U,this.getVertexBuffer(K.h.TangentKind).isUpdatable())}return q.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Gc=c,this}bakeCurrentTransformIntoVertices(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&this.makeGeometryUnique(),this.bakeTransformIntoVertices(this.o(!0)),this.resetLocalMatrix(q),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(c&&void 0===c._addToSceneRootNodes){const U=c;return G.source=this,G.doNotCloneChildren=U.doNotCloneChildren,G.clonePhysicsImpostor=U.clonePhysicsImpostor,G.cloneThinInstances=U.cloneThinInstances,new S(q,this.Cq(),G)}return new S(q,this.Cq(),c,this,U,J)}dispose(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const U=this._internalMeshDataInfo;if(U._onBeforeDrawObservable&&U._onBeforeDrawObservable.clear(),U._onBeforeBindObservable&&U._onBeforeBindObservable.clear(),U._onBeforeRenderObservable&&U._onBeforeRenderObservable.clear(),U._onAfterRenderObservable&&U._onAfterRenderObservable.clear(),U._onBetweenPassObservable&&U._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(U.meshMap)for(const q in U.meshMap){const c=U.meshMap[q];c&&(c._internalMeshDataInfo._source=null,U.meshMap[q]=void 0)}U._source&&U._source._internalMeshDataInfo.meshMap&&(U._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const q=this.Cq().meshes;for(const c of q){const q=c;q._internalMeshDataInfo&&q._internalMeshDataInfo._source&&q._internalMeshDataInfo._source===this&&(q._internalMeshDataInfo._source=null)}}U._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(q,c)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(q,c,U,J,s,g){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],n=arguments.length>7?arguments[7]:void 0;const W=this.Cq();return Q.e.LoadImage(q,(q=>{const Q=q.width,n=q.height,W=this.getEngine().createCanvas(Q,n).getContext("2d");W.drawImage(q,0,0);const D=W.getImageData(0,0,Q,n).data;this.applyDisplacementMapFromBuffer(D,Q,n,c,U,s,g,X),J&&J(this)}),n||(()=>{}),W.offlineProvider),this}applyDisplacementMapFromBuffer(q,c,U,J,Q,s,g){let X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(K.h.PositionKind)||!this.isVerticesDataPresent(K.h.NormalKind)||!this.isVerticesDataPresent(K.h.UVKind))return I.c.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const n=this.getVerticesData(K.h.PositionKind,!0,!0),D=this.getVerticesData(K.h.NormalKind),u=this.getVerticesData(K.h.UVKind);let H=W.p.Zero();const b=W.p.Zero(),h=W.l.Zero();s=s||W.l.Zero(),g=g||new W.l(1,1);for(let K=0;K<n.length;K+=3){W.p.FromArrayToRef(n,K,H),W.p.FromArrayToRef(D,K,b),W.l.FromArrayToRef(u,K/3*2,h);const X=4*((Math.abs(h.x*g.x+s.x%1)*(c-1)%c|0)+(Math.abs(h.y*g.y+s.y%1)*(U-1)%U|0)*c),r=.3*(q[X]/255)+.59*(q[X+1]/255)+.11*(q[X+2]/255);b.normalize(),b.scaleInPlace(J+(Q-J)*r),H=H.add(b),H.toArray(n,K)}return r.c.ComputeNormals(n,this.uc(),D),X?(this.xq(K.h.PositionKind,n),this.xq(K.h.NormalKind,D),this.xq(K.h.UVKind,u)):(this.updateVerticesData(K.h.PositionKind,n),this.updateVerticesData(K.h.NormalKind,D)),this}_getFlattenedNormals(q,c){const U=new Float32Array(3*q.length);let J=0;const Q=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let s=0;s<q.length;s+=3){const g=W.p.Ic(c,3*q[s]),X=W.p.Ic(c,3*q[s+1]),n=W.p.Ic(c,3*q[s+2]),D=g.eU(X),u=n.eU(X),K=W.p.Normalize(W.p.Cross(D,u));Q&&K.scaleInPlace(-1);for(let q=0;q<3;q++)U[J++]=K.x,U[J++]=K.y,U[J++]=K.z}return U}_convertToUnIndexedMesh(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=this.getVerticesDataKinds().filter((q=>{var c;return!(null!==(c=this.getVertexBuffer(q))&&void 0!==c&&c.getIsInstanced())})),U=this.uc(),J={},Q=(q,c)=>{const J=new Float32Array(U.length*c);let Q=0;for(let s=0;s<U.length;s++)for(let g=0;g<c;g++)J[Q++]=q[U[s]*c+g];return J},s=this.getBoundingInfo(),g=this.Dc?this.Gc.slice(0):[];for(const X of c)J[X]=this.getVerticesData(X);for(const X of c){const c=this.getVertexBuffer(X),s=c.getSize();if(q&&X===K.h.NormalKind){const q=this._getFlattenedNormals(U,J[K.h.PositionKind]);this.xq(K.h.NormalKind,q,c.isUpdatable(),s)}else this.xq(X,Q(J[X],s),c.isUpdatable(),s)}if(this.morphTargetManager){for(let c=0;c<this.morphTargetManager.numTargets;c++){const J=this.morphTargetManager.getTarget(c),s=J.getPositions();J.setPositions(Q(s,3));const g=J.getNormals();g&&J.setNormals(q?this._getFlattenedNormals(U,s):Q(g,3));const X=J.getTangents();X&&J.setTangents(Q(X,3));const n=J.getUVs();n&&J.setUVs(Q(n,2));const W=J.getColors();W&&J.setColors(Q(W,4))}this.morphTargetManager.synchronize()}for(let X=0;X<U.length;X++)U[X]=X;this.setIndices(U),this._unIndexed=!0,this.releaseSubMeshes();for(const X of g){const q=X.getBoundingInfo();h.c.AddToMesh(X.materialIndex,X.indexStart,X.indexCount,X.indexStart,X.indexCount,this).setBoundingInfo(q)}return this.setBoundingInfo(s),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=r.c.ExtractFromMesh(this);let U;if(q&&this.isVerticesDataPresent(K.h.NormalKind)&&c.vq){for(U=0;U<c.vq.length;U++)c.vq[U]*=-1;this.xq(K.h.NormalKind,c.vq,this.isVertexBufferUpdatable(K.h.NormalKind))}if(c.indices){let q;for(U=0;U<c.indices.length;U+=3)q=c.indices[U+1],c.indices[U+1]=c.indices[U+2],c.indices[U+2]=q;this.setIndices(c.indices,null,this.isVertexBufferUpdatable(K.h.PositionKind),!0)}return this}increaseVertices(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const c=r.c.ExtractFromMesh(this),U=c.indices&&!Array.isArray(c.indices)&&Array.from?Array.from(c.indices):c.indices,J=c.Fq&&!Array.isArray(c.Fq)&&Array.from?Array.from(c.Fq):c.Fq,Q=c.kq&&!Array.isArray(c.kq)&&Array.from?Array.from(c.kq):c.kq,s=c.vq&&!Array.isArray(c.vq)&&Array.from?Array.from(c.vq):c.vq;if(U&&J){c.indices=U,c.Fq=J,Q&&(c.kq=Q),s&&(c.vq=s);const g=q+1,X=[];for(let q=0;q<g+1;q++)X[q]=[];let n,D;const u=new W.p(0,0,0),r=new W.p(0,0,0),H=new W.l(0,0),b=[],h=[],o=[];let a,p,R,I=J.length;Q&&(p=Q.length),s&&(R=s.length);for(let q=0;q<U.length;q+=3){h[0]=U[q],h[1]=U[q+1],h[2]=U[q+2];for(let q=0;q<3;q++)if(n=h[q],D=h[(q+1)%3],void 0===o[n]&&void 0===o[D]?(o[n]=[],o[D]=[]):(void 0===o[n]&&(o[n]=[]),void 0===o[D]&&(o[D]=[])),void 0===o[n][D]&&void 0===o[D][n]){o[n][D]=[],u.x=(J[3*D]-J[3*n])/g,u.y=(J[3*D+1]-J[3*n+1])/g,u.z=(J[3*D+2]-J[3*n+2])/g,s&&(r.x=(s[3*D]-s[3*n])/g,r.y=(s[3*D+1]-s[3*n+1])/g,r.z=(s[3*D+2]-s[3*n+2])/g),Q&&(H.x=(Q[2*D]-Q[2*n])/g,H.y=(Q[2*D+1]-Q[2*n+1])/g),o[n][D].push(n);for(let q=1;q<g;q++)o[n][D].push(J.length/3),J[I++]=J[3*n]+q*u.x,J[I++]=J[3*n+1]+q*u.y,J[I++]=J[3*n+2]+q*u.z,s&&(s[R++]=s[3*n]+q*r.x,s[R++]=s[3*n+1]+q*r.y,s[R++]=s[3*n+2]+q*r.z),Q&&(Q[p++]=Q[2*n]+q*H.x,Q[p++]=Q[2*n+1]+q*H.y);o[n][D].push(D),o[D][n]=[],a=o[n][D].length;for(let q=0;q<a;q++)o[D][n][q]=o[n][D][a-1-q]}X[0][0]=U[q],X[1][0]=o[U[q]][U[q+1]][1],X[1][1]=o[U[q]][U[q+2]][1];for(let c=2;c<g;c++){X[c][0]=o[U[q]][U[q+1]][c],X[c][c]=o[U[q]][U[q+2]][c],u.x=(J[3*X[c][c]]-J[3*X[c][0]])/c,u.y=(J[3*X[c][c]+1]-J[3*X[c][0]+1])/c,u.z=(J[3*X[c][c]+2]-J[3*X[c][0]+2])/c,s&&(r.x=(s[3*X[c][c]]-s[3*X[c][0]])/c,r.y=(s[3*X[c][c]+1]-s[3*X[c][0]+1])/c,r.z=(s[3*X[c][c]+2]-s[3*X[c][0]+2])/c),Q&&(H.x=(Q[2*X[c][c]]-Q[2*X[c][0]])/c,H.y=(Q[2*X[c][c]+1]-Q[2*X[c][0]+1])/c);for(let q=1;q<c;q++)X[c][q]=J.length/3,J[I++]=J[3*X[c][0]]+q*u.x,J[I++]=J[3*X[c][0]+1]+q*u.y,J[I++]=J[3*X[c][0]+2]+q*u.z,s&&(s[R++]=s[3*X[c][0]]+q*r.x,s[R++]=s[3*X[c][0]+1]+q*r.y,s[R++]=s[3*X[c][0]+2]+q*r.z),Q&&(Q[p++]=Q[2*X[c][0]]+q*H.x,Q[p++]=Q[2*X[c][0]+1]+q*H.y)}X[g]=o[U[q+1]][U[q+2]],b.push(X[0][0],X[1][0],X[1][1]);for(let q=1;q<g;q++){let c;for(c=0;c<q;c++)b.push(X[q][c],X[q+1][c],X[q+1][c+1]),b.push(X[q][c],X[q+1][c+1],X[q][c+1]);b.push(X[q][c],X[q+1][c],X[q+1][c+1])}}c.indices=b,c.Oq(this,this.isVertexBufferUpdatable(K.h.PositionKind))}else I.c.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const q=r.c.ExtractFromMesh(this),c=q.kq,U=q.indices,J=q.Fq,Q=q.Yq,s=q.matricesIndices,g=q.matricesWeights,X=q.matricesIndicesExtra,n=q.matricesWeightsExtra;if(void 0===U||void 0===J||null===U||null===J)I.c.Warn("VertexData contains empty entries");else{const W=[],D=[],u=[],H=[],b=[],h=[],o=[],a=[];let p=[],R=0;const I={};let t,C;for(let q=0;q<U.length;q+=3){C=[U[q],U[q+1],U[q+2]],p=[];for(let q=0;q<3;q++){p[q]="";for(let c=0;c<3;c++)Math.abs(J[3*C[q]+c])<1e-8&&(J[3*C[q]+c]=0),p[q]+=J[3*C[q]+c]+"|"}if(p[0]!=p[1]&&p[0]!=p[2]&&p[1]!=p[2])for(let q=0;q<3;q++){if(t=I[p[q]],void 0===t){I[p[q]]=R,t=R++;for(let c=0;c<3;c++)W.push(J[3*C[q]+c]);if(null!==Q&&void 0!==Q)for(let c=0;c<4;c++)H.push(Q[4*C[q]+c]);if(null!==c&&void 0!==c)for(let U=0;U<2;U++)u.push(c[2*C[q]+U]);if(null!==s&&void 0!==s)for(let c=0;c<4;c++)b.push(s[4*C[q]+c]);if(null!==g&&void 0!==g)for(let c=0;c<4;c++)h.push(g[4*C[q]+c]);if(null!==X&&void 0!==X)for(let c=0;c<4;c++)o.push(X[4*C[q]+c]);if(null!==n&&void 0!==n)for(let c=0;c<4;c++)a.push(n[4*C[q]+c])}D.push(t)}}const i=[];r.c.ComputeNormals(W,D,i),q.Fq=W,q.indices=D,q.vq=i,null!==c&&void 0!==c&&(q.kq=u),null!==Q&&void 0!==Q&&(q.Yq=H),null!==s&&void 0!==s&&(q.matricesIndices=b),null!==g&&void 0!==g&&(q.matricesWeights=h),null!==X&&void 0!==X&&(q.matricesIndicesExtra=o),null!==g&&void 0!==g&&(q.matricesWeightsExtra=a),q.Oq(this,this.isVertexBufferUpdatable(K.h.PositionKind))}}static _instancedMeshFactory(q,c){throw(0,C.d)("InstancedMesh")}static _PhysicsImpostorParser(q,c,U){throw(0,C.d)("PhysicsImpostor")}createInstance(q){const c=S._instancedMeshFactory(q,this);return c.parent=this.parent,c}synchronizeInstances(){for(let q=0;q<this.instances.length;q++){this.instances[q]._syncSubMeshes()}return this}optimizeIndices(q){const c=this.uc(),U=this.getVerticesData(K.h.PositionKind);if(!U||!c)return this;const J=[];for(let Q=0;Q<U.length;Q+=3)J.push(W.p.Ic(U,Q));const s=[];return Q.b.SyncAsyncForLoop(J.length,40,(q=>{const c=J.length-1-q,U=J[c];for(let Q=0;Q<c;++Q){const q=J[Q];if(U.equals(q)){s[c]=Q;break}}}),(()=>{for(let q=0;q<c.length;++q)c[q]=s[c[q]]||c[q];const U=this.Gc.slice(0);this.setIndices(c),this.Gc=U,q&&q(this)})),this}serialize(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};q.name=this.name,q.id=this.id,q.uniqueId=this.uniqueId,q.type=this.getClassName(),g.d&&g.d.HasTags(this)&&(q.tags=g.d.GetTags(this)),q.position=this.position.rc(),this.rotationQuaternion?q.rotationQuaternion=this.rotationQuaternion.rc():this.rotation&&(q.rotation=this.rotation.rc()),q.ac=this.ac.rc(),this._postMultiplyPivotMatrix?q.pivotMatrix=this.getPivotMatrix().rc():q.localMatrix=this.getPivotMatrix().rc(),q.isEnabled=this.isEnabled(!1),q.isVisible=this.isVisible,q.infiniteDistance=this.infiniteDistance,q.pickable=this.Pn,q.receiveShadows=this.receiveShadows,q.billboardMode=this.billboardMode,q.visibility=this.visibility,q.Tg=this.Tg,q.checkCollisions=this.checkCollisions,q.ellipsoid=this.ellipsoid.rc(),q.ellipsoidOffset=this.ellipsoidOffset.rc(),q.Gq=this.Gq,q.isBlocker=this.isBlocker,q.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(q),q.isUnIndexed=this.isUnIndexed;const c=this._geometry;if(c&&this.Gc){q.geometryUniqueId=c.uniqueId,q.geometryId=c.id,q.Gc=[];for(let c=0;c<this.Gc.length;c++){const U=this.Gc[c];q.Gc.push({materialIndex:U.materialIndex,verticesStart:U.verticesStart,verticesCount:U.verticesCount,indexStart:U.indexStart,indexCount:U.indexCount})}}if(this.material?this.material.doNotSerialize||(q.materialUniqueId=this.material.uniqueId,q.materialId=this.material.id):(this.material=null,q.materialUniqueId=this._scene.defaultMaterial.uniqueId,q.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(q.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(q.skeletonId=this.skeleton.id,q.numBoneInfluencers=this.numBoneInfluencers),this.Cq()._getComponent(i.d.NAME_PHYSICSENGINE)){const c=this.getPhysicsImpostor();c&&(q.physicsMass=c.getParam("aQ"),q.physicsFriction=c.getParam("friction"),q.physicsRestitution=c.getParam("aQ"),q.physicsImpostor=c.type)}this.metadata&&(q.metadata=this.metadata),q.instances=[];for(let U=0;U<this.instances.length;U++){const c=this.instances[U];if(c.doNotSerialize)continue;const J={name:c.name,id:c.id,isEnabled:c.isEnabled(!1),isVisible:c.isVisible,Pn:c.Pn,checkCollisions:c.checkCollisions,position:c.position.rc(),ac:c.ac.rc()};if(c.parent&&c.parent._serializeAsParent(J),c.rotationQuaternion?J.rotationQuaternion=c.rotationQuaternion.rc():c.rotation&&(J.rotation=c.rotation.rc()),this.Cq()._getComponent(i.d.NAME_PHYSICSENGINE)){const q=c.getPhysicsImpostor();q&&(J.physicsMass=q.getParam("aQ"),J.physicsFriction=q.getParam("friction"),J.physicsRestitution=q.getParam("aQ"),J.physicsImpostor=q.type)}c.metadata&&(J.metadata=c.metadata),c.actionManager&&(J.actions=c.actionManager.serialize(c.name)),q.instances.push(J),R.e.AppendSerializedAnimations(c,J),J.ranges=c.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(q.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const c={data:{},sizes:{},strides:{}};for(const q in this._userThinInstanceBuffersStorage.data)c.data[q]=Array.from(this._userThinInstanceBuffersStorage.data[q]),c.sizes[q]=this._userThinInstanceBuffersStorage.sizes[q],c.strides[q]=this._userThinInstanceBuffersStorage.strides[q];q.thinInstances.userThinInstance=c}return R.e.AppendSerializedAnimations(this,q),q.ranges=this.serializeAnimationRanges(),q.layerMask=this.layerMask,q.alphaIndex=this.alphaIndex,q.hasVertexAlpha=this.hasVertexAlpha,q.overlayAlpha=this.overlayAlpha,q.overlayColor=this.overlayColor.rc(),q.renderOverlay=this.renderOverlay,q.applyFog=this.applyFog,this.actionManager&&(q.actions=this.actionManager.serialize(this.name)),q}_syncGeometryWithMorphTargetManager(){if(!this.Dc)return;this._markSubMeshesAsAttributesDirty();const q=this._internalAbstractMeshDataInfo._morphTargetManager;if(q&&q.vertexCount){if(q.vertexCount!==this.getTotalVertices())return I.c.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(q.isUsingTextureForTargets)return;for(let c=0;c<q.numInfluencers;c++){const U=q.getActiveTarget(c),J=U.getPositions();if(!J)return void I.c.Error("Invalid morph target. Target must have positions.");this.Dc.xq(K.h.PositionKind+c,J,!1,3);const Q=U.getNormals();Q&&this.Dc.xq(K.h.NormalKind+c,Q,!1,3);const s=U.getTangents();s&&this.Dc.xq(K.h.TangentKind+c,s,!1,3);const g=U.getUVs();g&&this.Dc.xq(K.h.UVKind+"_"+c,g,!1,2);const X=U.getUV2s();X&&this.Dc.xq(K.h.UV2Kind+"_"+c,X,!1,2);const n=U.getColors();n&&this.Dc.xq(K.h.ColorKind+c,n,!1,4)}}else{let q=0;for(;this.Dc.isVerticesDataPresent(K.h.PositionKind+q);)this.Dc.removeVerticesData(K.h.PositionKind+q),this.Dc.isVerticesDataPresent(K.h.NormalKind+q)&&this.Dc.removeVerticesData(K.h.NormalKind+q),this.Dc.isVerticesDataPresent(K.h.TangentKind+q)&&this.Dc.removeVerticesData(K.h.TangentKind+q),this.Dc.isVerticesDataPresent(K.h.UVKind+q)&&this.Dc.removeVerticesData(K.h.UVKind+"_"+q),this.Dc.isVerticesDataPresent(K.h.UV2Kind+q)&&this.Dc.removeVerticesData(K.h.UV2Kind+"_"+q),this.Dc.isVerticesDataPresent(K.h.ColorKind+q)&&this.Dc.removeVerticesData(K.h.ColorKind+q),q++}}static Parse(q,c,U){let J;if(J=q.type&&"LinesMesh"===q.type?S._LinesMeshParser(q,c):q.type&&"GroundMesh"===q.type?S._GroundMeshParser(q,c):q.type&&"GoldbergMesh"===q.type?S._GoldbergMeshParser(q,c):q.type&&"GreasedLineMesh"===q.type?S._GreasedLineMeshParser(q,c):q.type&&"TrailMesh"===q.type?S._TrailMeshParser(q,c):new S(q.name,c),J.id=q.id,J._waitingParsedUniqueId=q.uniqueId,g.d&&g.d.AddTagsTo(J,q.tags),J.position=W.p.Ic(q.position),void 0!==q.metadata&&(J.metadata=q.metadata),q.rotationQuaternion?J.rotationQuaternion=W.g.Ic(q.rotationQuaternion):q.rotation&&(J.rotation=W.p.Ic(q.rotation)),J.ac=W.p.Ic(q.ac),q.localMatrix?J.setPreTransformMatrix(W.d.Ic(q.localMatrix)):q.pivotMatrix&&J.setPivotMatrix(W.d.Ic(q.pivotMatrix)),J.LX(q.isEnabled),J.isVisible=q.isVisible,J.infiniteDistance=q.infiniteDistance,J.Tg=!!q.Tg,J.showBoundingBox=q.showBoundingBox,J.showSubMeshesBoundingBox=q.showSubMeshesBoundingBox,void 0!==q.applyFog&&(J.applyFog=q.applyFog),void 0!==q.pickable&&(J.Pn=q.pickable),void 0!==q.alphaIndex&&(J.alphaIndex=q.alphaIndex),J.receiveShadows=q.receiveShadows,void 0!==q.billboardMode&&(J.billboardMode=q.billboardMode),void 0!==q.visibility&&(J.visibility=q.visibility),J.checkCollisions=q.checkCollisions,J.Gq=!!q.Gq,q.ellipsoid&&(J.ellipsoid=W.p.Ic(q.ellipsoid)),q.ellipsoidOffset&&(J.ellipsoidOffset=W.p.Ic(q.ellipsoidOffset)),null!=q.overrideMaterialSideOrientation&&(J.sideOrientation=q.overrideMaterialSideOrientation),void 0!==q.sideOrientation&&(J.sideOrientation=q.sideOrientation),void 0!==q.isBlocker&&(J.isBlocker=q.isBlocker),J._shouldGenerateFlatShading=q.useFlatShading,q.Vg&&(J._waitingData.Vg=q.Vg),void 0!==q.parentId&&(J._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(J._waitingParentInstanceIndex=q.parentInstanceIndex),void 0!==q.actions&&(J._waitingData.actions=q.actions),void 0!==q.overlayAlpha&&(J.overlayAlpha=q.overlayAlpha),void 0!==q.overlayColor&&(J.overlayColor=D.c.Ic(q.overlayColor)),void 0!==q.renderOverlay&&(J.renderOverlay=q.renderOverlay),J.isUnIndexed=!!q.isUnIndexed,J.hasVertexAlpha=q.hasVertexAlpha,q.delayLoadingFile?(J.delayLoadState=4,J.delayLoadingFile=U+q.delayLoadingFile,J.buildBoundingInfo(W.p.Ic(q.boundingBoxMinimum),W.p.Ic(q.boundingBoxMaximum)),q._binaryInfo&&(J._binaryInfo=q._binaryInfo),J._delayInfo=[],q.hasUVs&&J._delayInfo.push(K.h.UVKind),q.hasUVs2&&J._delayInfo.push(K.h.UV2Kind),q.hasUVs3&&J._delayInfo.push(K.h.UV3Kind),q.hasUVs4&&J._delayInfo.push(K.h.UV4Kind),q.hasUVs5&&J._delayInfo.push(K.h.UV5Kind),q.hasUVs6&&J._delayInfo.push(K.h.UV6Kind),q.hasColors&&J._delayInfo.push(K.h.ColorKind),q.hasMatricesIndices&&J._delayInfo.push(K.h.MatricesIndicesKind),q.hasMatricesWeights&&J._delayInfo.push(K.h.MatricesWeightsKind),J._delayLoadingFunction=H.d._ImportGeometry,p.c.ForceFullSceneLoadingForIncremental&&J._checkDelayState()):H.d._ImportGeometry(q,J),q.materialUniqueId?J._waitingMaterialId=q.materialUniqueId:q.materialId&&(J._waitingMaterialId=q.materialId),q.morphTargetManagerId>-1&&(J._waitingMorphTargetManagerId=q.morphTargetManagerId),void 0!==q.skeletonId&&null!==q.skeletonId&&(J.skeleton=c.getLastSkeletonById(q.skeletonId),q.numBoneInfluencers&&(J.numBoneInfluencers=q.numBoneInfluencers)),q.animations){for(let c=0;c<q.animations.length;c++){const U=q.animations[c],Q=(0,t.d)("BABYLON.Animation");Q&&J.animations.push(Q.Parse(U))}u.b.ParseAnimationRanges(J,q,c)}if(q.autoAnimate&&c.beginAnimation(J,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),q.layerMask&&!isNaN(q.layerMask)?J.layerMask=Math.abs(parseInt(q.layerMask)):J.layerMask=268435455,q.physicsImpostor&&(J.physicsImpostor=S._PhysicsImpostorParser(c,J,q)),q.lodMeshIds&&(J._waitingData.lods={ids:q.lodMeshIds,distances:q.lodDistances?q.lodDistances:null,coverages:q.lodCoverages?q.lodCoverages:null}),q.instances)for(let Q=0;Q<q.instances.length;Q++){const U=q.instances[Q],s=J.createInstance(U.name);if(U.id&&(s.id=U.id),g.d&&(U.tags?g.d.AddTagsTo(s,U.tags):g.d.AddTagsTo(s,q.tags)),s.position=W.p.Ic(U.position),void 0!==U.metadata&&(s.metadata=U.metadata),void 0!==U.parentId&&(s._waitingParentId=U.parentId),void 0!==U.parentInstanceIndex&&(s._waitingParentInstanceIndex=U.parentInstanceIndex),void 0!==U.isEnabled&&null!==U.isEnabled&&s.LX(U.isEnabled),void 0!==U.isVisible&&null!==U.isVisible&&(s.isVisible=U.isVisible),void 0!==U.Pn&&null!==U.Pn&&(s.Pn=U.Pn),U.rotationQuaternion?s.rotationQuaternion=W.g.Ic(U.rotationQuaternion):U.rotation&&(s.rotation=W.p.Ic(U.rotation)),s.ac=W.p.Ic(U.ac),void 0!=U.checkCollisions&&null!=U.checkCollisions&&(s.checkCollisions=U.checkCollisions),void 0!=U.pickable&&null!=U.pickable&&(s.Pn=U.pickable),void 0!=U.showBoundingBox&&null!=U.showBoundingBox&&(s.showBoundingBox=U.showBoundingBox),void 0!=U.showSubMeshesBoundingBox&&null!=U.showSubMeshesBoundingBox&&(s.showSubMeshesBoundingBox=U.showSubMeshesBoundingBox),void 0!=U.alphaIndex&&null!=U.showSubMeshesBoundingBox&&(s.alphaIndex=U.alphaIndex),U.physicsImpostor&&(s.physicsImpostor=S._PhysicsImpostorParser(c,s,U)),void 0!==U.actions&&(s._waitingData.actions=U.actions),U.animations){for(let q=0;q<U.animations.length;q++){const c=U.animations[q],J=(0,t.d)("BABYLON.Animation");J&&s.animations.push(J.Parse(c))}u.b.ParseAnimationRanges(s,U,c),U.autoAnimate&&c.beginAnimation(s,U.autoAnimateFrom,U.autoAnimateTo,U.autoAnimateLoop,U.autoAnimateSpeed||1)}}if(q.thinInstances){const c=q.thinInstances;if(J.thinInstanceEnablePicking=!!c.enablePicking,c.matrixData?(J.ou("matrix",new Float32Array(c.matrixData),16,!1),J._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,J._thinInstanceDataStorage.instancesCount=c.instancesCount):J._thinInstanceDataStorage.matrixBufferSize=c.matrixBufferSize,q.thinInstances.userThinInstance){const c=q.thinInstances.userThinInstance;for(const q in c.data)J.ou(q,new Float32Array(c.data[q]),c.strides[q],!1),J._userThinInstanceBuffersStorage.sizes[q]=c.sizes[q]}}return J}setPositionsForCPUSkinning(){const q=this._internalMeshDataInfo;if(!q._sourcePositions){const c=this.getVerticesData(K.h.PositionKind);if(!c)return q._sourcePositions;q._sourcePositions=new Float32Array(c),this.isVertexBufferUpdatable(K.h.PositionKind)||this.xq(K.h.PositionKind,c,!0)}return q._sourcePositions}setNormalsForCPUSkinning(){const q=this._internalMeshDataInfo;if(!q._sourceNormals){const c=this.getVerticesData(K.h.NormalKind);if(!c)return q._sourceNormals;q._sourceNormals=new Float32Array(c),this.isVertexBufferUpdatable(K.h.NormalKind)||this.xq(K.h.NormalKind,c,!0)}return q._sourceNormals}applySkeleton(q){if(!this.Dc)return this;if(this.Dc._softwareSkinningFrameId==this.Cq().getFrameId())return this;if(this.Dc._softwareSkinningFrameId=this.Cq().getFrameId(),!this.isVerticesDataPresent(K.h.PositionKind))return this;if(!this.isVerticesDataPresent(K.h.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(K.h.MatricesWeightsKind))return this;const c=this.isVerticesDataPresent(K.h.NormalKind),U=this._internalMeshDataInfo;if(!U._sourcePositions){const q=this.Gc.slice();this.setPositionsForCPUSkinning(),this.Gc=q}c&&!U._sourceNormals&&this.setNormalsForCPUSkinning();let J=this.getVerticesData(K.h.PositionKind);if(!J)return this;J instanceof Float32Array||(J=new Float32Array(J));let Q=this.getVerticesData(K.h.NormalKind);if(c){if(!Q)return this;Q instanceof Float32Array||(Q=new Float32Array(Q))}const s=this.getVerticesData(K.h.MatricesIndicesKind),g=this.getVerticesData(K.h.MatricesWeightsKind);if(!g||!s)return this;const X=this.numBoneInfluencers>4,n=X?this.getVerticesData(K.h.MatricesIndicesExtraKind):null,D=X?this.getVerticesData(K.h.MatricesWeightsExtraKind):null,u=q.getTransformMatrices(this),r=W.p.Zero(),H=new W.d,b=new W.d;let h,o=0;for(let K=0;K<J.length;K+=3,o+=4){let q;for(h=0;h<4;h++)q=g[o+h],q>0&&(W.d.FromFloat32ArrayToRefScaled(u,Math.floor(16*s[o+h]),q,b),H.addToSelf(b));if(X)for(h=0;h<4;h++)q=D[o+h],q>0&&(W.d.FromFloat32ArrayToRefScaled(u,Math.floor(16*n[o+h]),q,b),H.addToSelf(b));W.p.TransformCoordinatesFromFloatsToRef(U._sourcePositions[K],U._sourcePositions[K+1],U._sourcePositions[K+2],H,r),r.toArray(J,K),c&&(W.p.TransformNormalFromFloatsToRef(U._sourceNormals[K],U._sourceNormals[K+1],U._sourceNormals[K+2],H,r),r.toArray(Q,K)),H.reset()}return this.updateVerticesData(K.h.PositionKind,J),c&&this.updateVerticesData(K.h.NormalKind,Q),this}static MinMax(q){let c=null,U=null;for(const J of q){const q=J.getBoundingInfo().boundingBox;c&&U?(c.minimizeInPlace(q.minimumWorld),U.maximizeInPlace(q.maximumWorld)):(c=q.minimumWorld,U=q.maximumWorld)}return c&&U?{min:c,max:U}:{min:W.p.Zero(),max:W.p.Zero()}}static Center(q){const c=q instanceof Array?S.MinMax(q):q;return W.p.Center(c.min,c.max)}static MergeMeshes(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;return(0,X.k)(S._MergeMeshesCoroutine(q,c,U,J,Q,s,!1))}static async MergeMeshesAsync(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0;return await(0,X.g)(S._MergeMeshesCoroutine(q,c,U,J,Q,s,!0),(0,X.b)())}static*_MergeMeshesCoroutine(q){let c,U=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],J=arguments.length>2?arguments[2]:void 0,Q=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,g=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0;if(0===(q=q.filter(Boolean)).length)return null;if(!J){let U=0;for(c=0;c<q.length;c++)if(U+=q[c].getTotalVertices(),U>=65536)return I.c.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}g&&(s=!1);const n=new Array,W=new Array,D=new Array,u=q[0].sideOrientation;for(c=0;c<q.length;c++){const U=q[c];if(U.isAnInstance)return I.c.Warn("Cannot merge instance meshes."),null;if(u!==U.sideOrientation)return I.c.Warn("Cannot merge meshes with different sideOrientation values."),null;if(s&&D.push(U.getTotalIndices()),g)if(U.material){const q=U.material;if(q instanceof a.e){for(let c=0;c<q.Sc.length;c++)n.indexOf(q.Sc[c])<0&&n.push(q.Sc[c]);for(let c=0;c<U.Gc.length;c++)W.push(n.indexOf(q.Sc[U.Gc[c].materialIndex])),D.push(U.Gc[c].indexCount)}else{n.indexOf(q)<0&&n.push(q);for(let c=0;c<U.Gc.length;c++)W.push(n.indexOf(q)),D.push(U.Gc[c].indexCount)}}else for(let q=0;q<U.Gc.length;q++)W.push(0),D.push(U.Gc[q].indexCount)}const K=q[0],H=q=>{const c=q.o(!0);return{vertexData:r.c.ExtractFromMesh(q,!1,!1),transform:c}},{vertexData:b,transform:o}=H(K);X&&(yield);const p=new Array(q.length-1);for(let r=1;r<q.length;r++)p[r-1]=H(q[r]),X&&(yield);const R=b._mergeCoroutine(o,p,J,X,!U);let t=R.next();for(;!t.done;)X&&(yield),t=R.next();const C=t.value;Q||(Q=new S(K.name+"_merged",K.Cq()));const i=C._applyToCoroutine(Q,void 0,X);let F=i.next();for(;!F.done;)X&&(yield),F=i.next();if(Q.checkCollisions=K.checkCollisions,Q.sideOrientation=K.sideOrientation,U)for(c=0;c<q.length;c++)q[c].dispose();if(s||g){Q.releaseSubMeshes(),c=0;let q=0;for(;c<D.length;)h.c.CreateFromIndices(0,q,D[c],Q,void 0,!1),q+=D[c],c++;for(const c of Q.Gc)c.refreshBoundingInfo();Q.o(!0)}if(g){const q=new a.e(K.name+"_merged",K.Cq());q.Sc=n;for(let c=0;c<Q.Gc.length;c++)Q.Gc[c].materialIndex=W[c];Q.material=q}else Q.material=K.material;return Q}bK(q){q._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(q)}HK(q){const c=q._indexInSourceMeshInstanceArray;if(-1!=c){if(c!==this.instances.length-1){const q=this.instances[this.instances.length-1];this.instances[c]=q,q._indexInSourceMeshInstanceArray=c}q._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===o.b.CounterClockWiseSideOrientation}_getRenderingFillMode(q){const c=this.Cq();return c.forcePointsCloud?o.b.PointFillMode:c.forceWireframe?o.b.WireFrameFillMode:this.overrideRenderingFillMode??q}setMaterialByID(q){return this.setMaterialById(q)}static CreateRibbon(q,c,U,J,Q,s,g,X,n){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(q,c,U,J,Q,s){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(q,c,U,J,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(q,c,U,J,Q,s){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(q,c,U,J){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(q,c,U,J,Q,s,g,X,n){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(q,c,U,J,Q,s,g){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(q,c,U,J,Q,s,g,X,n,W){throw new Error("Import MeshBuilder to populate this function")}static tW(q,c,U,J,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(q,c,U,J,Q,s,g,X){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(q,c,U,J,Q,s,g){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(q,c,U,J,Q,s,g,X){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(q,c,U,J,Q,s,g,X,n,W){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(q,c,U,J,Q,s,g,X,n,W,D,u){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(q,c,U,J,Q,s,g){throw new Error("Import MeshBuilder to populate this function")}static FW(q,c,U,J,Q){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(q,c,U,J,Q,s){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(q,c,U,J,Q,s,g,X,n){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(q,c,U,J,Q,s,g,X,n,W,D){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(q,c,U,J,Q,s,g,X,n,W){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(q,c,U){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(q,c,U){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(q,c,U,J,Q,s){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(q,c,U){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(q){throw new Error("Import MeshBuilder to populate this function")}}S.FRONTSIDE=r.c.FRONTSIDE,S.BACKSIDE=r.c.BACKSIDE,S.DOUBLESIDE=r.c.DOUBLESIDE,S.DEFAULTSIDE=r.c.DEFAULTSIDE,S.NO_CAP=0,S.CAP_START=1,S.CAP_END=2,S.CAP_ALL=3,S.NO_FLIP=0,S.FLIP_TILE=1,S.ROTATE_TILE=2,S.FLIP_ROW=3,S.ROTATE_ROW=4,S.FLIP_N_ROTATE_TILE=5,S.FLIP_N_ROTATE_ROW=6,S.CENTER=0,S.LEFT=1,S.RIGHT=2,S.TOP=3,S.BOTTOM=4,S.INSTANCEDMESH_SORT_TRANSPARENT=!1,S._GroundMeshParser=(q,c)=>{throw(0,C.d)("GroundMesh")},S._GoldbergMeshParser=(q,c)=>{throw(0,C.d)("GoldbergMesh")},S._LinesMeshParser=(q,c)=>{throw(0,C.d)("LinesMesh")},S._GreasedLineMeshParser=(q,c)=>{throw(0,C.d)("GreasedLineMesh")},S._GreasedLineRibbonMeshParser=(q,c)=>{throw(0,C.d)("GreasedLineRibbonMesh")},S._TrailMeshParser=(q,c)=>{throw(0,C.d)("TrailMesh")},(0,t.f)("BABYLON.Mesh",S)},11125:(q,c,U)=>{U.d(c,{c:()=>H});var J=U(11010),Q=U(10833),s=U(11031),g=U(10910),X=U(11093),n=U(10886),W=U(11019),D=U(11127),u=U(10928),K=U(11025);class r{}class H{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,D.e)(this._applyToCoroutine.bind(this)),this.uniqueId=H._UniqueIdGenerator,H._UniqueIdGenerator++}set(q,c){switch(q.length||n.c.Warn(`Setting vertex data kind '${c}' with an empty array`),c){case s.h.PositionKind:this.Fq=q;break;case s.h.NormalKind:this.vq=q;break;case s.h.TangentKind:this.tangents=q;break;case s.h.UVKind:this.kq=q;break;case s.h.UV2Kind:this.uvs2=q;break;case s.h.UV3Kind:this.uvs3=q;break;case s.h.UV4Kind:this.uvs4=q;break;case s.h.UV5Kind:this.uvs5=q;break;case s.h.UV6Kind:this.uvs6=q;break;case s.h.ColorKind:this.Yq=q;break;case s.h.MatricesIndicesKind:this.matricesIndices=q;break;case s.h.MatricesWeightsKind:this.matricesWeights=q;break;case s.h.MatricesIndicesExtraKind:this.matricesIndicesExtra=q;break;case s.h.MatricesWeightsExtraKind:this.matricesWeightsExtra=q}}Oq(q,c){return this._applyTo(q,c,!1),this}applyToGeometry(q,c){return this._applyTo(q,c,!1),this}updateMesh(q){return this._update(q),this}updateGeometry(q){return this._update(q),this}*_applyToCoroutine(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0;if(this.Fq&&(q.xq(s.h.PositionKind,this.Fq,c),U&&(yield)),this.vq&&(q.xq(s.h.NormalKind,this.vq,c),U&&(yield)),this.tangents&&(q.xq(s.h.TangentKind,this.tangents,c),U&&(yield)),this.kq&&(q.xq(s.h.UVKind,this.kq,c),U&&(yield)),this.uvs2&&(q.xq(s.h.UV2Kind,this.uvs2,c),U&&(yield)),this.uvs3&&(q.xq(s.h.UV3Kind,this.uvs3,c),U&&(yield)),this.uvs4&&(q.xq(s.h.UV4Kind,this.uvs4,c),U&&(yield)),this.uvs5&&(q.xq(s.h.UV5Kind,this.uvs5,c),U&&(yield)),this.uvs6&&(q.xq(s.h.UV6Kind,this.uvs6,c),U&&(yield)),this.Yq){const J=this.Fq&&this.Yq.length===this.Fq.length?3:4;q.xq(s.h.ColorKind,this.Yq,c,J),this.hasVertexAlpha&&void 0!==q.hasVertexAlpha&&(q.hasVertexAlpha=!0),U&&(yield)}if(this.matricesIndices&&(q.xq(s.h.MatricesIndicesKind,this.matricesIndices,c),U&&(yield)),this.matricesWeights&&(q.xq(s.h.MatricesWeightsKind,this.matricesWeights,c),U&&(yield)),this.matricesIndicesExtra&&(q.xq(s.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,c),U&&(yield)),this.matricesWeightsExtra&&(q.xq(s.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,c),U&&(yield)),this.indices?(q.setIndices(this.indices,null,c),U&&(yield)):q.setIndices([],null),q.Gc&&this.materialInfos&&this.materialInfos.length>1){const c=q;c.Gc=[];for(const q of this.materialInfos)new K.c(q.materialIndex,q.verticesStart,q.verticesCount,q.indexStart,q.indexCount,c)}return this}_update(q,c,U){return this.Fq&&q.updateVerticesData(s.h.PositionKind,this.Fq,c,U),this.vq&&q.updateVerticesData(s.h.NormalKind,this.vq,c,U),this.tangents&&q.updateVerticesData(s.h.TangentKind,this.tangents,c,U),this.kq&&q.updateVerticesData(s.h.UVKind,this.kq,c,U),this.uvs2&&q.updateVerticesData(s.h.UV2Kind,this.uvs2,c,U),this.uvs3&&q.updateVerticesData(s.h.UV3Kind,this.uvs3,c,U),this.uvs4&&q.updateVerticesData(s.h.UV4Kind,this.uvs4,c,U),this.uvs5&&q.updateVerticesData(s.h.UV5Kind,this.uvs5,c,U),this.uvs6&&q.updateVerticesData(s.h.UV6Kind,this.uvs6,c,U),this.Yq&&q.updateVerticesData(s.h.ColorKind,this.Yq,c,U),this.matricesIndices&&q.updateVerticesData(s.h.MatricesIndicesKind,this.matricesIndices,c,U),this.matricesWeights&&q.updateVerticesData(s.h.MatricesWeightsKind,this.matricesWeights,c,U),this.matricesIndicesExtra&&q.updateVerticesData(s.h.MatricesIndicesExtraKind,this.matricesIndicesExtra,c,U),this.matricesWeightsExtra&&q.updateVerticesData(s.h.MatricesWeightsExtraKind,this.matricesWeightsExtra,c,U),this.indices&&q.setIndices(this.indices,null),this}static _TransformVector3Coordinates(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const s=Q.j.hc[0],g=Q.j.hc[1];for(let X=U;X<U+J;X+=3)Q.p.FromArrayToRef(q,X,s),Q.p.TransformCoordinatesToRef(s,c,g),q[X]=g.x,q[X+1]=g.y,q[X+2]=g.z}static _TransformVector3Normals(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const s=Q.j.hc[0],g=Q.j.hc[1];for(let X=U;X<U+J;X+=3)Q.p.FromArrayToRef(q,X,s),Q.p.TransformNormalToRef(s,c,g),q[X]=g.x,q[X+1]=g.y,q[X+2]=g.z}static _TransformVector4Normals(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:q.length;const s=Q.j.Vector4[0],g=Q.j.Vector4[1];for(let X=U;X<U+J;X+=4)Q.q.FromArrayToRef(q,X,s),Q.q.TransformNormalToRef(s,c,g),q[X]=g.x,q[X+1]=g.y,q[X+2]=g.z,q[X+3]=g.w}static _FlipFaces(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:q.length;for(let J=c;J<c+U;J+=3){const c=q[J+1];q[J+1]=q[J+2],q[J+2]=c}}transform(q){const c=q.determinant()<0;return this.Fq&&H._TransformVector3Coordinates(this.Fq,q),this.vq&&H._TransformVector3Normals(this.vq,q),this.tangents&&H._TransformVector4Normals(this.tangents,q),c&&this.indices&&H._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const q=[];for(const c of this.materialInfos){const U=new H;if(this.Fq&&(U.Fq=this.Fq.slice(3*c.verticesStart,3*(c.verticesCount+c.verticesStart))),this.vq&&(U.vq=this.vq.slice(3*c.verticesStart,3*(c.verticesCount+c.verticesStart))),this.tangents&&(U.tangents=this.tangents.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.Yq&&(U.Yq=this.Yq.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.kq&&(U.kq=this.kq.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs2&&(U.uvs2=this.uvs2.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs3&&(U.uvs3=this.uvs3.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs4&&(U.uvs4=this.uvs4.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs5&&(U.uvs5=this.uvs5.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.uvs6&&(U.uvs6=this.uvs6.slice(2*c.verticesStart,2*(c.verticesCount+c.verticesStart))),this.matricesIndices&&(U.matricesIndices=this.matricesIndices.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesIndicesExtra&&(U.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesWeights&&(U.matricesWeights=this.matricesWeights.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.matricesWeightsExtra&&(U.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*c.verticesStart,4*(c.verticesCount+c.verticesStart))),this.indices){U.indices=[];for(let q=c.indexStart;q<c.indexStart+c.indexCount;q++)U.indices.push(this.indices[q]-c.verticesStart)}const J=new r;J.indexStart=0,J.indexCount=U.indices?U.indices.length:0,J.materialIndex=c.materialIndex,J.verticesStart=0,J.verticesCount=(U.Fq?U.Fq.length:0)/3,U.materialInfos=[J],q.push(U)}return q}merge(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=Array.isArray(q)?q.map((q=>({vertexData:q}))):[{vertexData:q}];return(0,D.k)(this._mergeCoroutine(void 0,s,c,!1,U,J,Q))}*_mergeCoroutine(q,c){var U,J;let Q=arguments.length>2&&void 0!==arguments[2]&&arguments[2],g=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0,n=arguments.length>5&&void 0!==arguments[5]&&arguments[5],W=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let D=c.map((q=>q.vertexData)),u=this;if(W)for(const s of D)s&&(s._validate(),!this.vq&&s.vq&&(this.vq=new Float32Array(this.Fq.length)),!this.tangents&&s.tangents&&(this.tangents=new Float32Array(this.Fq.length/3*4)),!this.kq&&s.kq&&(this.kq=new Float32Array(this.Fq.length/3*2)),!this.uvs2&&s.uvs2&&(this.uvs2=new Float32Array(this.Fq.length/3*2)),!this.uvs3&&s.uvs3&&(this.uvs3=new Float32Array(this.Fq.length/3*2)),!this.uvs4&&s.uvs4&&(this.uvs4=new Float32Array(this.Fq.length/3*2)),!this.uvs5&&s.uvs5&&(this.uvs5=new Float32Array(this.Fq.length/3*2)),!this.uvs6&&s.uvs6&&(this.uvs6=new Float32Array(this.Fq.length/3*2)),!this.Yq&&s.Yq&&(this.Yq=new Float32Array(this.Fq.length/3*4),this.Yq.fill(1)),!this.matricesIndices&&s.matricesIndices&&(this.matricesIndices=new Float32Array(this.Fq.length/3*4)),!this.matricesWeights&&s.matricesWeights&&(this.matricesWeights=new Float32Array(this.Fq.length/3*4)),!this.matricesIndicesExtra&&s.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.Fq.length/3*4)),!this.matricesWeightsExtra&&s.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.Fq.length/3*4)));for(const s of D)if(s)if(W)this.vq&&!s.vq&&(s.vq=new Float32Array(s.Fq.length)),this.tangents&&!s.tangents&&(s.tangents=new Float32Array(s.Fq.length/3*4)),this.kq&&!s.kq&&(s.kq=new Float32Array(s.Fq.length/3*2)),this.uvs2&&!s.uvs2&&(s.uvs2=new Float32Array(s.Fq.length/3*2)),this.uvs3&&!s.uvs3&&(s.uvs3=new Float32Array(s.Fq.length/3*2)),this.uvs4&&!s.uvs4&&(s.uvs4=new Float32Array(s.Fq.length/3*2)),this.uvs5&&!s.uvs5&&(s.uvs5=new Float32Array(s.Fq.length/3*2)),this.uvs6&&!s.uvs6&&(s.uvs6=new Float32Array(s.Fq.length/3*2)),this.Yq&&!s.Yq&&(s.Yq=new Float32Array(s.Fq.length/3*4),s.Yq.fill(1)),this.matricesIndices&&!s.matricesIndices&&(s.matricesIndices=new Float32Array(s.Fq.length/3*4)),this.matricesWeights&&!s.matricesWeights&&(s.matricesWeights=new Float32Array(s.Fq.length/3*4)),this.matricesIndicesExtra&&!s.matricesIndicesExtra&&(s.matricesIndicesExtra=new Float32Array(s.Fq.length/3*4)),this.matricesWeightsExtra&&!s.matricesWeightsExtra&&(s.matricesWeightsExtra=new Float32Array(s.Fq.length/3*4));else if(s._validate(),!this.vq!==!s.vq||!this.tangents!==!s.tangents||!this.kq!==!s.kq||!this.uvs2!==!s.uvs2||!this.uvs3!==!s.uvs3||!this.uvs4!==!s.uvs4||!this.uvs5!==!s.uvs5||!this.uvs6!==!s.uvs6||!this.Yq!==!s.Yq||!this.matricesIndices!==!s.matricesIndices||!this.matricesWeights!==!s.matricesWeights||!this.matricesIndicesExtra!==!s.matricesIndicesExtra||!this.matricesWeightsExtra!==!s.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(n){let U=0,J=0,Q=0;const s=[];let g=null;const X=[];for(const c of this.splitBasedOnMaterialID())X.push({vertexData:c,transform:q});for(const q of c)if(q.vertexData)for(const c of q.vertexData.splitBasedOnMaterialID())X.push({vertexData:c,transform:q.transform});X.sort(((q,c)=>{const U=q.vertexData.materialInfos?q.vertexData.materialInfos[0].materialIndex:0,J=c.vertexData.materialInfos?c.vertexData.materialInfos[0].materialIndex:0;return U>J?1:U===J?0:-1}));for(const q of X){const c=q.vertexData;if(U=c.materialInfos?c.materialInfos[0].materialIndex:0,g&&g.materialIndex===U)g.indexCount+=c.indices.length,g.verticesCount+=c.Fq.length/3;else{const q=new r;q.materialIndex=U,q.indexStart=J,q.indexCount=c.indices.length,q.verticesStart=Q,q.verticesCount=c.Fq.length/3,s.push(q),g=q}J+=c.indices.length,Q+=c.Fq.length/3}const n=X.splice(0,1)[0];u=n.vertexData,q=n.transform,D=X.map((q=>q.vertexData)),c=X,this.materialInfos=s}const K=D.reduce(((q,c)=>{var U;return q+((null===(U=c.indices)||void 0===U?void 0:U.length)??0)}),(null===(U=u.indices)||void 0===U?void 0:U.length)??0);let b=X||D.some((q=>q.indices===u.indices))?null===(J=u.indices)||void 0===J?void 0:J.slice():u.indices;if(K>0){var h;let U=(null===(h=b)||void 0===h?void 0:h.length)??0;if(b||(b=new Array(K)),b.length!==K){if(Array.isArray(b))b.length=K;else{const q=Q||b instanceof Uint32Array?new Uint32Array(K):new Uint16Array(K);q.set(b),b=q}q&&q.determinant()<0&&H._FlipFaces(b,0,U)}let J=u.Fq?u.Fq.length/3:0;for(const{vertexData:q,transform:Q}of c)if(q.indices){for(let c=0;c<q.indices.length;c++)b[U+c]=q.indices[c]+J;Q&&Q.determinant()<0&&H._FlipFaces(b,U,q.indices.length),J+=q.Fq.length/3,U+=q.indices.length,g&&(yield)}}return this.indices=b,this.Fq=H._MergeElement(s.h.PositionKind,u.Fq,q,c.map((q=>[q.vertexData.Fq,q.transform]))),g&&(yield),u.vq&&(this.vq=H._MergeElement(s.h.NormalKind,u.vq,q,c.map((q=>[q.vertexData.vq,q.transform]))),g&&(yield)),u.tangents&&(this.tangents=H._MergeElement(s.h.TangentKind,u.tangents,q,c.map((q=>[q.vertexData.tangents,q.transform]))),g&&(yield)),u.kq&&(this.kq=H._MergeElement(s.h.UVKind,u.kq,q,c.map((q=>[q.vertexData.kq,q.transform]))),g&&(yield)),u.uvs2&&(this.uvs2=H._MergeElement(s.h.UV2Kind,u.uvs2,q,c.map((q=>[q.vertexData.uvs2,q.transform]))),g&&(yield)),u.uvs3&&(this.uvs3=H._MergeElement(s.h.UV3Kind,u.uvs3,q,c.map((q=>[q.vertexData.uvs3,q.transform]))),g&&(yield)),u.uvs4&&(this.uvs4=H._MergeElement(s.h.UV4Kind,u.uvs4,q,c.map((q=>[q.vertexData.uvs4,q.transform]))),g&&(yield)),u.uvs5&&(this.uvs5=H._MergeElement(s.h.UV5Kind,u.uvs5,q,c.map((q=>[q.vertexData.uvs5,q.transform]))),g&&(yield)),u.uvs6&&(this.uvs6=H._MergeElement(s.h.UV6Kind,u.uvs6,q,c.map((q=>[q.vertexData.uvs6,q.transform]))),g&&(yield)),u.Yq&&(this.Yq=H._MergeElement(s.h.ColorKind,u.Yq,q,c.map((q=>[q.vertexData.Yq,q.transform]))),(void 0!==u.hasVertexAlpha||c.some((q=>void 0!==q.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=u.hasVertexAlpha||c.some((q=>q.vertexData.hasVertexAlpha))),g&&(yield)),u.matricesIndices&&(this.matricesIndices=H._MergeElement(s.h.MatricesIndicesKind,u.matricesIndices,q,c.map((q=>[q.vertexData.matricesIndices,q.transform]))),g&&(yield)),u.matricesWeights&&(this.matricesWeights=H._MergeElement(s.h.MatricesWeightsKind,u.matricesWeights,q,c.map((q=>[q.vertexData.matricesWeights,q.transform]))),g&&(yield)),u.matricesIndicesExtra&&(this.matricesIndicesExtra=H._MergeElement(s.h.MatricesIndicesExtraKind,u.matricesIndicesExtra,q,c.map((q=>[q.vertexData.matricesIndicesExtra,q.transform]))),g&&(yield)),u.matricesWeightsExtra&&(this.matricesWeightsExtra=H._MergeElement(s.h.MatricesWeightsExtraKind,u.matricesWeightsExtra,q,c.map((q=>[q.vertexData.matricesWeightsExtra,q.transform])))),this}static _MergeElement(q,c,U,J){const Q=J.filter((q=>null!==q[0]&&void 0!==q[0]));if(!c&&0==Q.length)return c;if(!c)return this._MergeElement(q,Q[0][0],Q[0][1],Q.slice(1));const g=Q.reduce(((q,c)=>q+c[0].length),c.length),X=q===s.h.PositionKind?H._TransformVector3Coordinates:q===s.h.NormalKind?H._TransformVector3Normals:q===s.h.TangentKind?H._TransformVector4Normals:()=>{};if(c instanceof Float32Array){const q=new Float32Array(g);q.set(c),U&&X(q,U,0,c.length);let J=c.length;for(const[c,U]of Q)q.set(c,J),U&&X(q,U,J,c.length),J+=c.length;return q}{const q=new Array(g);for(let U=0;U<c.length;U++)q[U]=c[U];U&&X(q,U,0,c.length);let J=c.length;for(const[c,U]of Q){for(let U=0;U<c.length;U++)q[J+U]=c[U];U&&X(q,U,J,c.length),J+=c.length}return q}}_validate(){if(!this.Fq)throw new u.i("Positions are required",u.e.MeshInvalidPositionsError);const q=(q,c)=>{const U=s.h.DeduceStride(q);if(c.length%U!==0)throw new Error("The "+q+"s array count must be a multiple of "+U);return c.length/U},c=q(s.h.PositionKind,this.Fq),U=(U,J)=>{const Q=q(U,J);if(Q!==c)throw new Error("The "+U+"s element count ("+Q+") does not match the positions count ("+c+")")};this.vq&&U(s.h.NormalKind,this.vq),this.tangents&&U(s.h.TangentKind,this.tangents),this.kq&&U(s.h.UVKind,this.kq),this.uvs2&&U(s.h.UV2Kind,this.uvs2),this.uvs3&&U(s.h.UV3Kind,this.uvs3),this.uvs4&&U(s.h.UV4Kind,this.uvs4),this.uvs5&&U(s.h.UV5Kind,this.uvs5),this.uvs6&&U(s.h.UV6Kind,this.uvs6),this.Yq&&U(s.h.ColorKind,this.Yq),this.matricesIndices&&U(s.h.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&U(s.h.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&U(s.h.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&U(s.h.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const q=this.serialize();return H.Parse(q)}serialize(){const q={};if(this.Fq&&(q.Fq=Array.from(this.Fq)),this.vq&&(q.vq=Array.from(this.vq)),this.tangents&&(q.tangents=Array.from(this.tangents)),this.kq&&(q.kq=Array.from(this.kq)),this.uvs2&&(q.uvs2=Array.from(this.uvs2)),this.uvs3&&(q.uvs3=Array.from(this.uvs3)),this.uvs4&&(q.uvs4=Array.from(this.uvs4)),this.uvs5&&(q.uvs5=Array.from(this.uvs5)),this.uvs6&&(q.uvs6=Array.from(this.uvs6)),this.Yq&&(q.Yq=Array.from(this.Yq),q.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(q.matricesIndices=Array.from(this.matricesIndices),q.matricesIndicesExpanded=!0),this.matricesWeights&&(q.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(q.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),q.matricesIndicesExtraExpanded=!0),this.matricesWeightsExtra&&(q.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),q.indices=this.indices?Array.from(this.indices):[],this.materialInfos){q.materialInfos=[];for(const c of this.materialInfos){const U={indexStart:c.indexStart,indexCount:c.indexCount,materialIndex:c.materialIndex,verticesStart:c.verticesStart,verticesCount:c.verticesCount};q.materialInfos.push(U)}}return q}static ExtractFromMesh(q,c,U){return H._ExtractFrom(q,c,U)}static ExtractFromGeometry(q,c,U){return H._ExtractFrom(q,c,U)}static _ExtractFrom(q,c,U){const J=new H;if(q.isVerticesDataPresent(s.h.PositionKind)&&(J.Fq=q.getVerticesData(s.h.PositionKind,c,U)),q.isVerticesDataPresent(s.h.NormalKind)&&(J.vq=q.getVerticesData(s.h.NormalKind,c,U)),q.isVerticesDataPresent(s.h.TangentKind)&&(J.tangents=q.getVerticesData(s.h.TangentKind,c,U)),q.isVerticesDataPresent(s.h.UVKind)&&(J.kq=q.getVerticesData(s.h.UVKind,c,U)),q.isVerticesDataPresent(s.h.UV2Kind)&&(J.uvs2=q.getVerticesData(s.h.UV2Kind,c,U)),q.isVerticesDataPresent(s.h.UV3Kind)&&(J.uvs3=q.getVerticesData(s.h.UV3Kind,c,U)),q.isVerticesDataPresent(s.h.UV4Kind)&&(J.uvs4=q.getVerticesData(s.h.UV4Kind,c,U)),q.isVerticesDataPresent(s.h.UV5Kind)&&(J.uvs5=q.getVerticesData(s.h.UV5Kind,c,U)),q.isVerticesDataPresent(s.h.UV6Kind)&&(J.uvs6=q.getVerticesData(s.h.UV6Kind,c,U)),q.isVerticesDataPresent(s.h.ColorKind)){const Q=q.Dc||q,g=Q.getVertexBuffer(s.h.ColorKind),X=Q.getVerticesData(s.h.ColorKind,c,U);if(3===g.getSize()){const q=new Float32Array(4*X.length/3);for(let c=0,U=0;c<X.length;c+=3,U+=4)q[U]=X[c],q[U+1]=X[c+1],q[U+2]=X[c+2],q[U+3]=1;J.Yq=q}else{if(4!==g.getSize())throw new Error(`Unexpected number of color components: ${g.getSize()}`);J.Yq=X}}return q.isVerticesDataPresent(s.h.MatricesIndicesKind)&&(J.matricesIndices=q.getVerticesData(s.h.MatricesIndicesKind,c,U)),q.isVerticesDataPresent(s.h.MatricesWeightsKind)&&(J.matricesWeights=q.getVerticesData(s.h.MatricesWeightsKind,c,U)),q.isVerticesDataPresent(s.h.MatricesIndicesExtraKind)&&(J.matricesIndicesExtra=q.getVerticesData(s.h.MatricesIndicesExtraKind,c,U)),q.isVerticesDataPresent(s.h.MatricesWeightsExtraKind)&&(J.matricesWeightsExtra=q.getVerticesData(s.h.MatricesWeightsExtraKind,c,U)),J.indices=q.uc(c,U),J}static CreateRibbon(q){throw(0,g.d)("ribbonBuilder")}static CreateBox(q){throw(0,g.d)("boxBuilder")}static CreateTiledBox(q){throw(0,g.d)("tiledBoxBuilder")}static CreateTiledPlane(q){throw(0,g.d)("tiledPlaneBuilder")}static CreateSphere(q){throw(0,g.d)("sphereBuilder")}static CreateCylinder(q){throw(0,g.d)("cylinderBuilder")}static CreateTorus(q){throw(0,g.d)("torusBuilder")}static CreateLineSystem(q){throw(0,g.d)("linesBuilder")}static CreateDashedLines(q){throw(0,g.d)("linesBuilder")}static CreateGround(q){throw(0,g.d)("groundBuilder")}static CreateTiledGround(q){throw(0,g.d)("groundBuilder")}static CreateGroundFromHeightMap(q){throw(0,g.d)("groundBuilder")}static FW(q){throw(0,g.d)("planeBuilder")}static CreateDisc(q){throw(0,g.d)("discBuilder")}static CreatePolygon(q,c,U,J,Q,s,X){throw(0,g.d)("polygonBuilder")}static CreateIcoSphere(q){throw(0,g.d)("icoSphereBuilder")}static CreatePolyhedron(q){throw(0,g.d)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||Q.p.Up();throw(0,g.d)("capsuleBuilder")}static CreateTorusKnot(q){throw(0,g.d)("torusKnotBuilder")}static ComputeNormals(q,c,U,J){let s=0,g=0,X=0,n=0,W=0,D=0,u=0,K=0,r=0,H=0,b=0,h=0,o=0,a=0,p=0,R=0,I=0,t=0,C=0,i=0,F=!1,v=!1,Y=!1,k=!1,V=1,O=0,G=null;J&&(F=!!J.facetNormals,v=!!J.facetPositions,Y=!!J.facetPartitioning,V=!0===J.useRightHandedSystem?-1:1,O=J.ratio||0,k=!!J.depthSort,G=J.distanceTo,k&&void 0===G&&(G=Q.p.Zero()));let S=0,Z=0,x=0,z=0;for(Y&&J&&J.bbSize&&(S=J.subDiv.X*O/J.bbSize.x,Z=J.subDiv.Y*O/J.bbSize.y,x=J.subDiv.Z*O/J.bbSize.z,z=J.subDiv.max*J.subDiv.max,J.facetPartitioning.length=0),s=0;s<q.length;s++)U[s]=0;const y=c.length/3|0;for(s=0;s<y;s++){if(h=3*c[3*s],o=h+1,a=h+2,p=3*c[3*s+1],R=p+1,I=p+2,t=3*c[3*s+2],C=t+1,i=t+2,g=q[h]-q[p],X=q[o]-q[R],n=q[a]-q[I],W=q[t]-q[p],D=q[C]-q[R],u=q[i]-q[I],K=V*(X*u-n*D),r=V*(n*W-g*u),H=V*(g*D-X*W),b=Math.sqrt(K*K+r*r+H*H),b=0===b?1:b,K/=b,r/=b,H/=b,F&&J&&(J.facetNormals[s].x=K,J.facetNormals[s].y=r,J.facetNormals[s].z=H),v&&J&&(J.facetPositions[s].x=(q[h]+q[p]+q[t])/3,J.facetPositions[s].y=(q[o]+q[R]+q[C])/3,J.facetPositions[s].z=(q[a]+q[I]+q[i])/3),Y&&J){const c=Math.floor((J.facetPositions[s].x-J.bInfo.minimum.x*O)*S),U=Math.floor((J.facetPositions[s].y-J.bInfo.minimum.y*O)*Z),Q=Math.floor((J.facetPositions[s].z-J.bInfo.minimum.z*O)*x),g=Math.floor((q[h]-J.bInfo.minimum.x*O)*S),X=Math.floor((q[o]-J.bInfo.minimum.y*O)*Z),n=Math.floor((q[a]-J.bInfo.minimum.z*O)*x),W=Math.floor((q[p]-J.bInfo.minimum.x*O)*S),D=Math.floor((q[R]-J.bInfo.minimum.y*O)*Z),u=Math.floor((q[I]-J.bInfo.minimum.z*O)*x),K=Math.floor((q[t]-J.bInfo.minimum.x*O)*S),r=Math.floor((q[C]-J.bInfo.minimum.y*O)*Z),H=Math.floor((q[i]-J.bInfo.minimum.z*O)*x),b=g+J.subDiv.max*X+z*n,F=W+J.subDiv.max*D+z*u,v=K+J.subDiv.max*r+z*H,Y=c+J.subDiv.max*U+z*Q;J.facetPartitioning[Y]=J.facetPartitioning[Y]?J.facetPartitioning[Y]:[],J.facetPartitioning[b]=J.facetPartitioning[b]?J.facetPartitioning[b]:[],J.facetPartitioning[F]=J.facetPartitioning[F]?J.facetPartitioning[F]:[],J.facetPartitioning[v]=J.facetPartitioning[v]?J.facetPartitioning[v]:[],J.facetPartitioning[b].push(s),F!=b&&J.facetPartitioning[F].push(s),v!=F&&v!=b&&J.facetPartitioning[v].push(s),Y!=b&&Y!=F&&Y!=v&&J.facetPartitioning[Y].push(s)}if(k&&J&&J.facetPositions){const q=J.depthSortedFacets[s];q.ind=3*s,q.sqDistance=Q.p.DistanceSquared(J.facetPositions[s],G)}U[h]+=K,U[o]+=r,U[a]+=H,U[p]+=K,U[R]+=r,U[I]+=H,U[t]+=K,U[C]+=r,U[i]+=H}for(s=0;s<U.length/3;s++)K=U[3*s],r=U[3*s+1],H=U[3*s+2],b=Math.sqrt(K*K+r*r+H*H),b=0===b?1:b,K/=b,r/=b,H/=b,U[3*s]=K,U[3*s+1]=r,U[3*s+2]=H}static _ComputeSides(q,c,U,J,s,g,X){const n=U.length,W=J.length;let D,u;switch(q=q||H.DEFAULTSIDE){case H.FRONTSIDE:break;case H.BACKSIDE:for(D=0;D<n;D+=3){const q=U[D];U[D]=U[D+2],U[D+2]=q}for(u=0;u<W;u++)J[u]=-J[u];break;case H.DOUBLESIDE:{const q=c.length,K=q/3;for(let U=0;U<q;U++)c[q+U]=c[U];for(D=0;D<n;D+=3)U[D+n]=U[D+2]+K,U[D+1+n]=U[D+1]+K,U[D+2+n]=U[D]+K;for(u=0;u<W;u++)J[W+u]=-J[u];const r=s.length;let H=0;for(H=0;H<r;H++)s[H+r]=s[H];for(g=g||new Q.q(0,0,1,1),X=X||new Q.q(0,0,1,1),H=0,D=0;D<r/2;D++)s[H]=g.x+(g.z-g.x)*s[H],s[H+1]=g.y+(g.w-g.y)*s[H+1],s[H+r]=X.x+(X.z-X.x)*s[H+r],s[H+r+1]=X.y+(X.w-X.y)*s[H+r+1],H+=2;break}}}static Parse(q){const c=new H,U=q.Fq;U&&c.set(U,s.h.PositionKind);const J=q.vq;J&&c.set(J,s.h.NormalKind);const Q=q.tangents;Q&&c.set(Q,s.h.TangentKind);const g=q.kq;g&&c.set(g,s.h.UVKind);const n=q.uvs2;n&&c.set(n,s.h.UV2Kind);const W=q.uvs3;W&&c.set(W,s.h.UV3Kind);const D=q.uvs4;D&&c.set(D,s.h.UV4Kind);const u=q.uvs5;u&&c.set(u,s.h.UV5Kind);const K=q.uvs6;K&&c.set(K,s.h.UV6Kind);const b=q.Yq;b&&(c.set(X.e.CheckColors4(b,U.length/3),s.h.ColorKind),void 0!==q.hasVertexAlpha&&(c.hasVertexAlpha=q.hasVertexAlpha));const h=q.matricesIndices;h&&c.set(h,s.h.MatricesIndicesKind);const o=q.matricesWeights;o&&c.set(o,s.h.MatricesWeightsKind);const a=q.indices;a&&(c.indices=a);const p=q.materialInfos;if(p){c.materialInfos=[];for(const q of p){const U=new r;U.indexCount=q.indexCount,U.indexStart=q.indexStart,U.verticesCount=q.verticesCount,U.verticesStart=q.verticesStart,U.materialIndex=q.materialIndex,c.materialInfos.push(U)}}return c}static ImportVertexData(q,c){const U=H.Parse(q);c.setAllVerticesData(U,q.updatable)}}H.FRONTSIDE=0,H.BACKSIDE=1,H.DOUBLESIDE=2,H.DEFAULTSIDE=0,H._UniqueIdGenerator=0,(0,J.d)([W.d.filter((function(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];let[J]=c;return!Array.isArray(J)}))],H,"_TransformVector3Coordinates",null),(0,J.d)([W.d.filter((function(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];let[J]=c;return!Array.isArray(J)}))],H,"_TransformVector3Normals",null),(0,J.d)([W.d.filter((function(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];let[J]=c;return!Array.isArray(J)}))],H,"_TransformVector4Normals",null),(0,J.d)([W.d.filter((function(){for(var q=arguments.length,c=new Array(q),U=0;U<q;U++)c[U]=arguments[U];let[J]=c;return!Array.isArray(J)}))],H,"_FlipFaces",null)},11025:(q,c,U)=>{U.d(c,{c:()=>n});var J=U(11031),Q=U(11043),s=U(11050),g=U(11064),X=U(11071);class n{get materialDefines(){var q;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(q=this._getDrawWrapper())||void 0===q?void 0:q.defines}set materialDefines(q){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=q}_getDrawWrapper(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];q=q??this._engine.currentRenderPassId;let U=this._drawWrappers[q];return!U&&c&&(this._drawWrappers[q]=U=new X.c(this._mesh.Cq().getEngine())),U}_removeDrawWrapper(q){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var U;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(U=this._drawWrappers[q])||void 0===U||U.dispose(c));this._drawWrappers[q]=void 0}get effect(){var q;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(q=this._getDrawWrapper())||void 0===q?void 0:q.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(q){this._mainDrawWrapperOverride=q}setEffect(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const Q=this._drawWrapper;Q.setEffect(q,c,J),void 0!==U&&(Q.materialContext=U),q||(Q.defines=null,Q.materialContext=void 0)}resetDrawCache(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._drawWrappers){if(void 0!==q)return void this._removeDrawWrapper(q,!0,c);for(const q of this._drawWrappers)null===q||void 0===q||q.dispose(c)}this._drawWrappers=[]}static AddToMesh(q,c,U,J,Q,s,g){return new n(q,c,U,J,Q,s,g,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(q,c,U,J,Q,s,g){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],n=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=q,this.verticesStart=c,this.verticesCount=U,this.indexStart=J,this.indexCount=Q,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=s,this._renderingMesh=g||s,n&&s.Gc.push(this),this._engine=this._mesh.Cq().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=s.Gc.length-1,X&&(this.refreshBoundingInfo(),s.o(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(q){return this._boundingInfo=q,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const q=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return q||this._renderingMesh}zq(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const c=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!c)return q&&this._mesh.Cq()._hasDefaultMaterial?this._mesh.Cq().defaultMaterial:null;if(this._isMultiMaterial(c)){const q=c.getSubMaterial(this.materialIndex);return this._currentMaterial!==q&&(this._currentMaterial=q,this.resetDrawCache()),q}return c}_isMultiMaterial(q){return void 0!==q.getSubMaterial}refreshBoundingInfo(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Dc)return this;if(q||(q=this._renderingMesh.getVerticesData(J.h.PositionKind)),!q)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const c=this._renderingMesh.uc();let U;if(0===this.indexStart&&this.indexCount===c.length){const q=this._renderingMesh.getBoundingInfo();U={minimum:q.minimum.clone(),maximum:q.maximum.clone()}}else U=(0,g.e)(q,c,this.indexStart,this.indexCount,this._renderingMesh.Dc.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(U.minimum,U.maximum):this._boundingInfo=new s.e(U.minimum,U.maximum),this}_checkCollision(q){return this.getBoundingInfo()._checkCollision(q)}updateBoundingInfo(q){let c=this.getBoundingInfo();return c||(this.refreshBoundingInfo(),c=this.getBoundingInfo()),c&&c.update(q),this}isInFrustum(q){const c=this.getBoundingInfo();return!!c&&c.isInFrustum(q,this._mesh.bu)}isCompletelyInFrustum(q){const c=this.getBoundingInfo();return!!c&&c.isCompletelyInFrustum(q)}render(q){return this._renderingMesh.render(this,q,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(q,c){if(!this._linesIndexBuffer){const U=6*Math.floor(this.indexCount/3),J=this.verticesStart+this.verticesCount>65535?new Uint32Array(U):new Uint16Array(U);let Q=0;if(0===q.length)for(let q=this.indexStart;q<this.indexStart+this.indexCount;q+=3)J[Q++]=q,J[Q++]=q+1,J[Q++]=q+1,J[Q++]=q+2,J[Q++]=q+2,J[Q++]=q;else for(let c=this.indexStart;c<this.indexStart+this.indexCount;c+=3)J[Q++]=q[c],J[Q++]=q[c+1],J[Q++]=q[c+1],J[Q++]=q[c+2],J[Q++]=q[c+2],J[Q++]=q[c];this._linesIndexBuffer=c.createIndexBuffer(J),this._linesIndexCount=J.length}return this._linesIndexBuffer}canIntersects(q){const c=this.getBoundingInfo();return!!c&&q.intersectsBox(c.boundingBox)}intersects(q,c,U,J,Q){const s=this.zq();if(!s)return null;let g=3,X=!1;switch(s.fillMode){case 3:case 5:case 6:case 8:return null;case 7:g=1,X=!0}return 4===s.fillMode?U.length?this._intersectLines(q,c,U,this._mesh.intersectionThreshold,J):this._intersectUnIndexedLines(q,c,U,this._mesh.intersectionThreshold,J):!U.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(q,c,U,J,Q):this._intersectTriangles(q,c,U,g,X,J,Q)}_intersectLines(q,c,U,J,s){let g=null;for(let X=this.indexStart;X<this.indexStart+this.indexCount;X+=2){const n=c[U[X]],W=c[U[X+1]],D=q.intersectionSegment(n,W,J);if(!(D<0)&&((s||!g||D<g.distance)&&(g=new Q.e(null,null,D),g.faceId=X/2,s)))break}return g}_intersectUnIndexedLines(q,c,U,J,s){let g=null;for(let X=this.verticesStart;X<this.verticesStart+this.verticesCount;X+=2){const U=c[X],n=c[X+1],W=q.intersectionSegment(U,n,J);if(!(W<0)&&((s||!g||W<g.distance)&&(g=new Q.e(null,null,W),g.faceId=X/2,s)))break}return g}_intersectTriangles(q,c,U,J,Q,s,g){let X=null,n=-1;for(let W=this.indexStart;W<this.indexStart+this.indexCount-(3-J);W+=J){n++;const J=U[W],D=U[W+1],u=U[W+2];if(Q&&4294967295===u){W+=2;continue}const K=c[J],r=c[D],H=c[u];if(!K||!r||!H)continue;if(g&&!g(K,r,H,q,J,D,u))continue;const b=q.intersectsTriangle(K,r,H);if(b){if(b.distance<0)continue;if((s||!X||b.distance<X.distance)&&(X=b,X.faceId=n,s))break}}return X}_intersectUnIndexedTriangles(q,c,U,J,Q){let s=null;for(let g=this.verticesStart;g<this.verticesStart+this.verticesCount;g+=3){const U=c[g],X=c[g+1],n=c[g+2];if(Q&&!Q(U,X,n,q,-1,-1,-1))continue;const W=q.intersectsTriangle(U,X,n);if(W){if(W.distance<0)continue;if((J||!s||W.distance<s.distance)&&(s=W,s.faceId=g/3,J))break}}return s}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(q,c){const U=new n(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,q,c,!1);if(!this.IsGlobal){const q=this.getBoundingInfo();if(!q)return U;U._boundingInfo=new s.e(q.minimum,q.maximum)}return U}dispose(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._linesIndexBuffer&&(this._mesh.Cq().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const c=this._mesh.Gc.indexOf(this);this._mesh.Gc.splice(c,1),this.resetDrawCache(void 0,q)}getClassName(){return"SubMesh"}static CreateFromIndices(q,c,U,J,Q){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],g=Number.MAX_VALUE,X=-Number.MAX_VALUE;const W=(Q||J).uc();for(let n=c;n<c+U;n++){const q=W[n];q<g&&(g=q),q>X&&(X=q)}return new n(q,g,X-g+1,c,U,J,Q,s)}}},11510:(q,c,U)=>{var J=U(11149),Q=U(11031),s=U(10833),g=U(10886),X=U(11050);J.b.prototype.thinInstanceAdd=function(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.Cq().getEngine().getCaps().instancedArrays)return g.c.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(q)?q.length:1);const U=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(q))for(let J=0;J<q.length;++J)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,q[J],J===q.length-1&&c);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,q,c);return U},J.b.prototype.thinInstanceAddSelf=function(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(s.d.IdentityReadOnly,q)},J.b.prototype.thinInstanceRegisterAttribute=function(q,c){q===Q.h.ColorKind&&(q=Q.h.ColorInstanceKind),this.removeVerticesData(q),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[q]=c,this._userThinInstanceBuffersStorage.sizes[q]=c*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[q]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[q]),this._userThinInstanceBuffersStorage.vertexBuffers[q]=new Q.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[q],q,!0,!1,c,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])},J.b.prototype.thinInstanceSetMatrixAt=function(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||q>=this._thinInstanceDataStorage.instancesCount)return!1;const J=this._thinInstanceDataStorage.matrixData;return c.copyToArray(J,16*q),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[q]=c),U&&(this.au("matrix"),this.Gq||this.thinInstanceRefreshBoundingInfo(!1)),!0},J.b.prototype.thinInstanceSetAttributeAt=function(q,c,U){let J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return q===Q.h.ColorKind&&(q=Q.h.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[q]||c>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(q,0),this._userThinInstanceBuffersStorage.data[q].set(U,c*this._userThinInstanceBuffersStorage.strides[q]),J&&this.au(q),!0)},Object.defineProperty(J.b.prototype,"xc",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(q){var c;const U=this._thinInstanceDataStorage.matrixData??(null===(c=this.source)||void 0===c?void 0:c._thinInstanceDataStorage.matrixData);q<=(U?U.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=q)},enumerable:!0,configurable:!0}),J.b.prototype._thinInstanceCreateMatrixBuffer=function(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const J=new Q.e(this.getEngine(),c,!U,16,!1,!0);for(let Q=0;Q<4;Q++)this.setVerticesBuffer(J.createVertexBuffer(q+Q,4*Q,4));return J},J.b.prototype.ou=function(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var s;if(U=U||16,"matrix"===q)null===(s=this._thinInstanceDataStorage.matrixBuffer)||void 0===s||s.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=c?c.length:32*U,this._thinInstanceDataStorage.matrixData=c,this._thinInstanceDataStorage.worldMatrices=null,null!==c?(this._thinInstanceDataStorage.instancesCount=c.length/U,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",c,J),this.Gq||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Gq||this.refreshBoundingInfo());else if("previousMatrix"===q){var g;null===(g=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===g||g.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=c,null!==c&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",c,J))}else{var X;if(q===Q.h.ColorKind&&(q=Q.h.ColorInstanceKind),null===c)null!==(X=this._userThinInstanceBuffersStorage)&&void 0!==X&&X.data[q]&&(this.removeVerticesData(q),delete this._userThinInstanceBuffersStorage.data[q],delete this._userThinInstanceBuffersStorage.strides[q],delete this._userThinInstanceBuffersStorage.sizes[q],delete this._userThinInstanceBuffersStorage.vertexBuffers[q]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[q]=c,this._userThinInstanceBuffersStorage.strides[q]=U,this._userThinInstanceBuffersStorage.sizes[q]=c.length,this._userThinInstanceBuffersStorage.vertexBuffers[q]=new Q.h(this.getEngine(),c,q,!J,!1,U,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},J.b.prototype.au=function(q){var c;if("matrix"===q)this.RK&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(q),null===(c=this._thinInstanceDataStorage.matrixBuffer)||void 0===c||c.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===q){var U;this.RK&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(q),null===(U=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===U||U.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var J;q===Q.h.ColorKind&&(q=Q.h.ColorInstanceKind),null!==(J=this._userThinInstanceBuffersStorage)&&void 0!==J&&J.vertexBuffers[q]&&(this.RK&&!this._userThinInstanceBuffersStorage.vertexBuffers[q].isUpdatable()&&this._thinInstanceRecreateBuffer(q),this._userThinInstanceBuffersStorage.vertexBuffers[q].updateDirectly(this._userThinInstanceBuffersStorage.data[q],0))}},J.b.prototype.thinInstancePartialBufferUpdate=function(q,c,U){var J;"matrix"===q?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(c,U):(q===Q.h.ColorKind&&(q=Q.h.ColorInstanceKind),null!==(J=this._userThinInstanceBuffersStorage)&&void 0!==J&&J.vertexBuffers[q]&&this._userThinInstanceBuffersStorage.vertexBuffers[q].updateDirectly(c,U))},J.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const q=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let c=0;c<this._thinInstanceDataStorage.instancesCount;++c)this._thinInstanceDataStorage.worldMatrices[c]=s.d.Ic(q,16*c)}return this._thinInstanceDataStorage.worldMatrices},J.b.prototype.thinInstanceRefreshBoundingInfo=function(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const J=this._thinInstanceDataStorage.boundingVectors;if(q||!this.rawBoundingInfo){J.length=0,this.refreshBoundingInfo(c,U);const q=this.getBoundingInfo();this.rawBoundingInfo=new X.e(q.minimum,q.maximum)}const Q=this.getBoundingInfo(),g=this._thinInstanceDataStorage.matrixData;if(0===J.length)for(let s=0;s<Q.boundingBox.vectors.length;++s)J.push(Q.boundingBox.vectors[s].clone());s.j.hc[0].tc(Number.POSITIVE_INFINITY),s.j.hc[1].tc(Number.NEGATIVE_INFINITY);for(let X=0;X<this._thinInstanceDataStorage.instancesCount;++X){s.d.FromArrayToRef(g,16*X,s.j.Matrix[0]);for(let q=0;q<J.length;++q)s.p.TransformCoordinatesToRef(J[q],s.j.Matrix[0],s.j.hc[2]),s.j.hc[0].minimizeInPlace(s.j.hc[2]),s.j.hc[1].maximizeInPlace(s.j.hc[2])}Q.reConstruct(s.j.hc[0],s.j.hc[1]),this.Sq()},J.b.prototype._thinInstanceRecreateBuffer=function(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var U;if("matrix"===q)null===(U=this._thinInstanceDataStorage.matrixBuffer)||void 0===U||U.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,c);else if("previousMatrix"===q){var J;if(this._scene.needsPreviousWorldMatrices)null===(J=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===J||J.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,c)}else{var s;q===Q.h.ColorKind&&(q=Q.h.ColorInstanceKind),null===(s=this._userThinInstanceBuffersStorage.vertexBuffers[q])||void 0===s||s.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[q]=new Q.h(this.getEngine(),this._userThinInstanceBuffersStorage.data[q],q,!c,!1,this._userThinInstanceBuffersStorage.strides[q],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},J.b.prototype._thinInstanceUpdateBufferSize=function(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;q===Q.h.ColorKind&&(q=Q.h.ColorInstanceKind);const U="matrix"===q;if(!U&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[q]))return;const J=U?16:this._userThinInstanceBuffersStorage.strides[q],s=U?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[q];let g=U?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[q];const X=(this._thinInstanceDataStorage.instancesCount+c)*J;let n=s;for(;n<X;)n*=2;if(!g||s!=n){if(g){const q=new Float32Array(n);q.set(g,0),g=q}else g=new Float32Array(n);var W,D,u;if(U){if(null===(W=this._thinInstanceDataStorage.matrixBuffer)||void 0===W||W.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",g,!1),this._thinInstanceDataStorage.matrixData=g,this._thinInstanceDataStorage.matrixBufferSize=n,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(D=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===D||D.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",g,!1)}else null===(u=this._userThinInstanceBuffersStorage.vertexBuffers[q])||void 0===u||u.dispose(),this._userThinInstanceBuffersStorage.data[q]=g,this._userThinInstanceBuffersStorage.sizes[q]=n,this._userThinInstanceBuffersStorage.vertexBuffers[q]=new Q.h(this.getEngine(),g,q,!0,!1,J,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[q])}},J.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},J.b.prototype._disposeThinInstanceSpecificData=function(){var q;null!==(q=this._thinInstanceDataStorage)&&void 0!==q&&q.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11107:(q,c,U)=>{U.d(c,{c:()=>D});var J=U(11010),Q=U(11019),s=U(11082),g=U(10866),X=U(10833),n=U(11113),W=U(10850);class D extends n.b{get billboardMode(){return this._billboardMode}set billboardMode(q){this._billboardMode!==q&&(this._billboardMode=q,this._cache.useBillboardPosition=0!==(this._billboardMode&D.BILLBOARDMODE_USE_POSITION))}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(q){this._infiniteDistance!==q&&(this._infiniteDistance=q)}constructor(q){let c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new X.p(0,0,1),this._up=new X.p(0,1,0),this._right=new X.p(1,0,0),this._position=X.p.Zero(),this._rotation=X.p.Zero(),this._rotationQuaternion=null,this._scaling=X.p.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=D.BILLBOARDMODE_NONE,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.CK=X.d.Zero(),this._usePivotMatrix=!1,this._absolutePosition=X.p.Zero(),this._absoluteScaling=X.p.Zero(),this._absoluteRotationQuaternion=X.g.Identity(),this._pivotMatrix=X.d.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new g.e,this._nonUniformScaling=!1,c&&this.Cq().addTransformNode(this)}getClassName(){return"wc"}get position(){return this._position}set position(q){this._position=q,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(q){this._rotation=q,this._rotationQuaternion=null,this._markAsDirtyInternal()}get ac(){return this._scaling}set ac(q){this._scaling=q,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(q){this._rotationQuaternion=q,q&&this._rotation.tc(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return X.p.TransformNormalFromFloatsToRef(0,0,this.Cq().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return X.p.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return X.p.TransformNormalFromFloatsToRef(this.Cq().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(q){return this._poseMatrix?(this._poseMatrix.X(q),this):(this._poseMatrix=q.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=X.d.Identity()),this._poseMatrix}_isSynchronized(){const q=this._cache;return this._billboardMode===q.billboardMode&&this._billboardMode===D.BILLBOARDMODE_NONE&&(!q.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const q=this._cache;q.localMatrixUpdated=!1,q.billboardMode=-1,q.infiniteDistance=!1,q.useBillboardPosition=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(q){return this.setPivotMatrix(q,!1)}setPivotMatrix(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.X(q),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=c,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=X.d.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;const J=this.clone("Clone of "+(this.name||this.id),q||this.parent,!0);J&&U&&U(this,J);for(const Q of this.getChildTransformNodes(!0))Q.instantiateHierarchy(J,c,U);return J}Vg(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.tc(0),this._rotationQuaternion=this._rotationQuaternion||X.g.Identity(),q.decompose(this._scaling,this._rotationQuaternion,this._position),this.o(!0)):(this._worldMatrix=q,this._absolutePosition.bc(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.o(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.o(!0),this}get Eu(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.o(),this._absolutePosition}setAbsolutePosition(q){if(!q)return this;let c,U,J;if(void 0===q.x){if(arguments.length<3)return this;c=arguments[0],U=arguments[1],J=arguments[2]}else c=q.x,U=q.y,J=q.z;if(this.parent){const q=X.j.Matrix[0];this.parent.getWorldMatrix().invertToRef(q),X.p.TransformCoordinatesFromFloatsToRef(c,U,J,q,this.position)}else this.position.x=c,this.position.y=U,this.position.z=J;return this._absolutePosition.X(q),this}setPositionWithLocalVector(q){return this.o(),this.position=X.p.TransformNormal(q,this.CK),this}getPositionExpressedInLocalSpace(){this.o();const q=X.j.Matrix[0];return this.CK.invertToRef(q),X.p.TransformNormal(this.position,q)}locallyTranslate(q){return this.o(!0),this.position=X.p.TransformCoordinates(q,this.CK),this}lookAt(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const s=D._LookAtVectorCache,g=0===Q?this.position:this.getAbsolutePosition();if(q.subtractToRef(g,s),this.setDirection(s,c,U,J),1===Q&&this.parent)if(this.rotationQuaternion){const q=X.j.Matrix[0];this.rotationQuaternion.toRotationMatrix(q);const c=X.j.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(c),c.invert(),q.multiplyToRef(c,q),this.rotationQuaternion.fromRotationMatrix(q)}else{const q=X.j.Quaternion[0];X.g.FromEulerVectorToRef(this.rotation,q);const c=X.j.Matrix[0];q.toRotationMatrix(c);const U=X.j.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(U),U.invert(),c.multiplyToRef(U,c),q.fromRotationMatrix(c),q.toEulerAnglesToRef(this.rotation)}return this}zn(q){const c=X.p.Zero();return this.getDirectionToRef(q,c),c}getDirectionToRef(q,c){return X.p.TransformNormalToRef(q,this.getWorldMatrix(),c),this}setDirection(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const Q=-Math.atan2(q.z,q.x)+Math.PI/2,s=Math.sqrt(q.x*q.x+q.z*q.z),g=-Math.atan2(q.y,s);return this.rotationQuaternion?X.g.RotationYawPitchRollToRef(Q+c,g+U,J,this.rotationQuaternion):(this.rotation.x=g+U,this.rotation.y=Q+c,this.rotation.z=J),this}setPivotPoint(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.Cq().getRenderId()&&this.o(!0);const U=this.getWorldMatrix();if(1==c){const c=X.j.Matrix[0];U.invertToRef(c),q=X.p.TransformCoordinates(q,c)}return this.setPivotMatrix(X.d.Translation(-q.x,-q.y,-q.z),!0)}getPivotPoint(){const q=X.p.Zero();return this.getPivotPointToRef(q),q}getPivotPointToRef(q){return q.x=-this._pivotMatrix.m[12],q.y=-this._pivotMatrix.m[13],q.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const q=X.p.Zero();return this.getAbsolutePivotPointToRef(q),q}getAbsolutePivotPointToRef(q){return this.getPivotPointToRef(q),X.p.TransformCoordinatesToRef(q,this.getWorldMatrix(),q),this}PW(q){if(this._isDirty)return this;if(this._children)for(const c of this._children)c.PW(q);return super.PW(q)}setParent(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!q&&!this.parent)return this;const J=X.j.Quaternion[0],Q=X.j.hc[0],s=X.j.hc[1],g=X.j.Matrix[1];X.d.IdentityToRef(g);const n=X.j.Matrix[0];this.o(!0);let W=this.rotationQuaternion;return W||(W=D._TmpRotation,X.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,W)),X.d.ComposeToRef(this.ac,W,this.position,n),this.parent&&n.multiplyToRef(this.parent.o(!0),n),q&&(q.o(!0).invertToRef(g),n.multiplyToRef(g,n)),n.decompose(s,J,Q,c?this:void 0),this.rotationQuaternion?this.rotationQuaternion.X(J):J.toEulerAnglesToRef(this.rotation),this.ac.X(s),this.position.X(Q),this.parent=q,U&&this.setPivotMatrix(X.d.Identity()),this}addChild(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return q.setParent(this,c),this}removeChild(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return q.parent!==this||q.setParent(null,c),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(q){return this._nonUniformScaling!==q&&(this._nonUniformScaling=q,!0)}attachToBone(q,c){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=c,this.parent=q,q.getSkeleton().prepare(!0),q.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=q?this._currentParentWhenAttachingToBone:null,this):(q&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(q,c,U){let J;if(q.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.tc(0)),U&&0!==U){if(this.parent){const U=this.parent.getWorldMatrix(),J=X.j.Matrix[0];U.invertToRef(J),q=X.p.TransformNormal(q,J),U.determinant()<0&&(c*=-1)}J=X.g.RotationAxisToRef(q,c,D._RotationAxisCache),J.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else J=X.g.RotationAxisToRef(q,c,D._RotationAxisCache),this.rotationQuaternion.multiplyToRef(J,this.rotationQuaternion);return this}rotateAround(q,c,U){c.normalize(),this.rotationQuaternion||(this.rotationQuaternion=X.g.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.tc(0));const J=X.j.hc[0],Q=X.j.hc[1],s=X.j.hc[2],g=X.j.Quaternion[0],n=X.j.Matrix[0],W=X.j.Matrix[1],D=X.j.Matrix[2],u=X.j.Matrix[3];return q.subtractToRef(this.position,J),X.d.TranslationToRef(J.x,J.y,J.z,n),X.d.TranslationToRef(-J.x,-J.y,-J.z,W),X.d.RotationAxisToRef(c,U,D),W.multiplyToRef(D,u),u.multiplyToRef(n,u),u.decompose(Q,g,s),this.position.addInPlace(s),g.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(q,c,U){const J=q.scale(c);if(U&&0!==U)this.setAbsolutePosition(this.getAbsolutePosition().add(J));else{const q=this.getPositionExpressedInLocalSpace().add(J);this.setPositionWithLocalVector(q)}return this}addRotation(q,c,U){let J;this.rotationQuaternion?J=this.rotationQuaternion:(J=X.j.Quaternion[1],X.g.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,J));const Q=X.j.Quaternion[0];return X.g.RotationYawPitchRollToRef(c,q,U,Q),J.multiplyInPlace(Q),this.rotationQuaternion||J.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==D.BILLBOARDMODE_NONE}o(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const U=this.Cq().getRenderId();if(!this._isDirty&&!q&&(this._currentRenderId===U||this.isSynchronized()))return this._currentRenderId=U,this._worldMatrix;c=c||this.Cq().activeCamera,this._updateCache();const J=this._cache;J.pivotMatrixUpdated=!1,J.billboardMode=this.billboardMode,J.infiniteDistance=this.infiniteDistance,J.parent=this._parentNode,this._currentRenderId=U,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const Q=this._getEffectiveParent(),s=D._TmpScaling;let g,n=this._position;if(this._infiniteDistance&&!this.parent&&c){const q=c.getWorldMatrix(),U=new X.p(q.m[12],q.m[13],q.m[14]);n=D._TmpTranslation,n.bc(this._position.x+U.x,this._position.y+U.y,this._position.z+U.z)}if(s.bc(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,g=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(X.g.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.bc(0,0,0))}}else g=D._TmpRotation,X.g.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,g);if(this._usePivotMatrix){const q=X.j.Matrix[1];X.d.ScalingToRef(s.x,s.y,s.z,q);const c=X.j.Matrix[0];g.toRotationMatrix(c),this._pivotMatrix.multiplyToRef(q,X.j.Matrix[4]),X.j.Matrix[4].multiplyToRef(c,this.CK),this._postMultiplyPivotMatrix&&this.CK.multiplyToRef(this._pivotMatrixInverse,this.CK),this.CK.addTranslationFromFloats(n.x,n.y,n.z)}else X.d.ComposeToRef(s,g,n,this.CK);if(Q&&Q.getWorldMatrix){if(q&&Q.o(q),this.billboardMode){if(this._transformToBoneReferal){const q=this.parent;q.getSkeleton().prepare(),q.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),X.j.Matrix[7])}else X.j.Matrix[7].X(Q.getWorldMatrix());const q=X.j.hc[5],c=X.j.hc[6],U=X.j.Quaternion[0];X.j.Matrix[7].decompose(c,U,q),X.d.ScalingToRef(c.x,c.y,c.z,X.j.Matrix[7]),X.j.Matrix[7].setTranslation(q),D.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(U,q),this.CK.setTranslation(q)),this.CK.multiplyToRef(X.j.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const q=this.parent;q.getSkeleton().prepare(),this.CK.multiplyToRef(q.getFinalMatrix(),X.j.Matrix[6]),X.j.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.CK.multiplyToRef(Q.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.X(this.CK);if(c&&this.billboardMode)if(J.useBillboardPosition){if(J.useBillboardPosition){const q=X.j.hc[0];this._worldMatrix.getTranslationToRef(q);const U=c.globalPosition;this._worldMatrix.invertToRef(X.j.Matrix[1]);const J=X.j.hc[1];X.p.TransformCoordinatesToRef(U,X.j.Matrix[1],J),J.normalize();const Q=-Math.atan2(J.z,J.x)+Math.PI/2,s=Math.sqrt(J.x*J.x+J.z*J.z),g=-Math.atan2(J.y,s);if(X.g.RotationYawPitchRollToRef(Q,g,0,X.j.Quaternion[0]),(this.billboardMode&D.BILLBOARDMODE_ALL)!==D.BILLBOARDMODE_ALL){const q=X.j.hc[1];X.j.Quaternion[0].toEulerAnglesToRef(q),(this.billboardMode&D.BILLBOARDMODE_X)!==D.BILLBOARDMODE_X&&(q.x=0),(this.billboardMode&D.BILLBOARDMODE_Y)!==D.BILLBOARDMODE_Y&&(q.y=0),(this.billboardMode&D.BILLBOARDMODE_Z)!==D.BILLBOARDMODE_Z&&(q.z=0),X.d.RotationYawPitchRollToRef(q.y,q.x,q.z,X.j.Matrix[0])}else X.d.FromQuaternionToRef(X.j.Quaternion[0],X.j.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(X.j.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(X.j.hc[0])}}else{const q=X.j.hc[0];if(this._worldMatrix.getTranslationToRef(q),X.j.Matrix[1].X(c.getViewMatrix()),X.j.Matrix[1].setTranslationFromFloats(0,0,0),X.j.Matrix[1].invertToRef(X.j.Matrix[0]),(this.billboardMode&D.BILLBOARDMODE_ALL)!==D.BILLBOARDMODE_ALL){X.j.Matrix[0].decompose(void 0,X.j.Quaternion[0],void 0);const q=X.j.hc[1];X.j.Quaternion[0].toEulerAnglesToRef(q),(this.billboardMode&D.BILLBOARDMODE_X)!==D.BILLBOARDMODE_X&&(q.x=0),(this.billboardMode&D.BILLBOARDMODE_Y)!==D.BILLBOARDMODE_Y&&(q.y=0),(this.billboardMode&D.BILLBOARDMODE_Z)!==D.BILLBOARDMODE_Z&&(q.z=0),X.d.RotationYawPitchRollToRef(q.y,q.x,q.z,X.j.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(X.j.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(X.j.hc[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):Q&&Q._nonUniformScaling?this._updateNonUniformScalingState(Q._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.bc(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=X.d.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.o(),q){const q=this.getChildren();for(let c=0;c<q.length;++c){const U=q[c];if(U){U.o();const q=X.j.Matrix[0];U.CK.multiplyToRef(this.CK,q);const c=X.j.Quaternion[0];q.decompose(U.ac,c,U.position),U.rotationQuaternion?U.rotationQuaternion.X(c):c.toEulerAnglesToRef(U.rotation)}}}this.ac.bc(1,1,1),this.position.bc(0,0,0),this.rotation.bc(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=X.g.Identity()),this._worldMatrix=X.d.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(q){return this.onAfterWorldMatrixUpdateObservable.add(q),this}unregisterAfterWorldMatrixUpdate(q){return this.onAfterWorldMatrixUpdateObservable.removeCallback(q),this}getPositionInCameraSpace(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q||(q=this.Cq().activeCamera),X.p.TransformCoordinates(this.getAbsolutePosition(),q.getViewMatrix())}getDistanceToCamera(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return q||(q=this.Cq().activeCamera),this.getAbsolutePosition().eU(q.globalPosition).length()}clone(q,c,U){const J=s.e.Clone((()=>new D(q,this.Cq())),this);if(J.name=q,J.id=q,c&&(J.parent=c),!U){const c=this.getDescendants(!0);for(let U=0;U<c.length;U++){const Q=c[U];Q.clone&&Q.clone(q+"."+Q.name,J)}}return J}serialize(q){const c=s.e.Serialize(this,q);return c.type=this.getClassName(),c.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(c),c.localMatrix=this.getPivotMatrix().rc(),c.isEnabled=this.isEnabled(),s.e.AppendSerializedAnimations(this,c),c.ranges=this.serializeAnimationRanges(),c}static Parse(q,c,U){const J=s.e.Parse((()=>new D(q.name,c)),q,c,U);if(q.localMatrix?J.setPreTransformMatrix(X.d.Ic(q.localMatrix)):q.pivotMatrix&&J.setPivotMatrix(X.d.Ic(q.pivotMatrix)),J.LX(q.isEnabled),J._waitingParsedUniqueId=q.uniqueId,void 0!==q.parentId&&(J._waitingParentId=q.parentId),void 0!==q.parentInstanceIndex&&(J._waitingParentInstanceIndex=q.parentInstanceIndex),q.animations){for(let c=0;c<q.animations.length;c++){const U=q.animations[c],Q=(0,W.d)("BABYLON.Animation");Q&&J.animations.push(Q.Parse(U))}n.b.ParseAnimationRanges(J,q,c)}return q.autoAnimate&&c.beginAnimation(J,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1),J}getChildTransformNodes(q,c){const U=[];return this._getDescendants(U,q,(q=>(!c||c(q))&&q instanceof D)),U}dispose(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.Cq().stopAnimation(this),this.Cq().removeTransformNode(this),this._parentContainer){const q=this._parentContainer.transformNodes.indexOf(this);q>-1&&this._parentContainer.transformNodes.splice(q,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),q){const q=this.getChildTransformNodes(!0);for(const c of q)c.parent=null,c.o(!0)}super.dispose(q,c)}normalizeToUnitCube(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0,J=null,Q=null;c&&(this.rotationQuaternion?(Q=this.rotationQuaternion.clone(),this.rotationQuaternion.bc(0,0,0,1)):this.rotation&&(J=this.rotation.clone(),this.rotation.bc(0,0,0)));const s=this.getHierarchyBoundingVectors(q,U),g=s.max.eU(s.min),X=Math.max(g.x,g.y,g.z);if(0===X)return this;const n=1/X;return this.ac.scaleInPlace(n),c&&(this.rotationQuaternion&&Q?this.rotationQuaternion.X(Q):this.rotation&&J&&this.rotation.X(J)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}D.BILLBOARDMODE_NONE=0,D.BILLBOARDMODE_X=1,D.BILLBOARDMODE_Y=2,D.BILLBOARDMODE_Z=4,D.BILLBOARDMODE_ALL=7,D.BILLBOARDMODE_USE_POSITION=128,D.BillboardUseParentOrientation=!1,D._TmpRotation=X.g.Zero(),D._TmpScaling=X.p.Zero(),D._TmpTranslation=X.p.Zero(),D._LookAtVectorCache=new X.p(0,0,0),D._RotationAxisCache=new X.g,(0,J.d)([(0,Q.K)("position")],D.prototype,"_position",void 0),(0,J.d)([(0,Q.K)("rotation")],D.prototype,"_rotation",void 0),(0,J.d)([(0,Q.B)("rotationQuaternion")],D.prototype,"_rotationQuaternion",void 0),(0,J.d)([(0,Q.K)("ac")],D.prototype,"_scaling",void 0),(0,J.d)([(0,Q.N)("billboardMode")],D.prototype,"_billboardMode",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"scalingDeterminant",void 0),(0,J.d)([(0,Q.N)("infiniteDistance")],D.prototype,"_infiniteDistance",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"ignoreNonUniformScaling",void 0),(0,J.d)([(0,Q.N)()],D.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11450:(q,c,U)=>{U.d(c,{c:()=>W});var J=U(10833),Q=U(10870),s=U(11258),g=U(10836),X=U(11093);class n{constructor(q,c,U,J){this.name=q,this.worldAxisForNormal=c,this.worldAxisForFileX=U,this.worldAxisForFileY=J}}class W{static ConvertCubeMapTextureToSphericalPolynomial(q){var c;if(!q.isCube)return null;null===(c=q.Cq())||void 0===c||c.getEngine().flushFramebuffer();const U=q.getSize().width,J=q.readPixels(0,void 0,void 0,!1),Q=q.readPixels(1,void 0,void 0,!1);let s,g;q.isRenderTarget?(s=q.readPixels(3,void 0,void 0,!1),g=q.readPixels(2,void 0,void 0,!1)):(s=q.readPixels(2,void 0,void 0,!1),g=q.readPixels(3,void 0,void 0,!1));const X=q.readPixels(4,void 0,void 0,!1),n=q.readPixels(5,void 0,void 0,!1),W=q.gammaSpace;let D=0;return 1!=q.textureType&&2!=q.textureType||(D=1),new Promise((q=>{Promise.all([Q,J,s,g,X,n]).then((c=>{let[J,Q,s,g,X,n]=c;const u={size:U,right:Q,left:J,up:s,down:g,front:X,back:n,format:5,type:D,gammaSpace:W};q(this.ConvertCubeMapToSphericalPolynomial(u))}))}))}static _AreaElement(q,c){return Math.atan2(q*c,Math.sqrt(q*q+c*c+1))}static ConvertCubeMapToSphericalPolynomial(q){const c=new s.d;let U=0;const J=2/q.size,n=J,W=.5*J,D=W-1;for(let s=0;s<6;s++){const u=this._FileFaces[s],K=q[u.name];let r=D;const H=5===q.format?4:3;for(let s=0;s<q.size;s++){let b=D;for(let n=0;n<q.size;n++){const D=u.worldAxisForFileX.scale(b).add(u.worldAxisForFileY.scale(r)).add(u.worldAxisForNormal);D.normalize();const h=this._AreaElement(b-W,r-W)-this._AreaElement(b-W,r+W)-this._AreaElement(b+W,r-W)+this._AreaElement(b+W,r+W);let o=K[s*q.size*H+n*H+0],a=K[s*q.size*H+n*H+1],p=K[s*q.size*H+n*H+2];isNaN(o)&&(o=0),isNaN(a)&&(a=0),isNaN(p)&&(p=0),0===q.type&&(o/=255,a/=255,p/=255),q.gammaSpace&&(o=Math.pow((0,Q.Clamp)(o),g.k),a=Math.pow((0,Q.Clamp)(a),g.k),p=Math.pow((0,Q.Clamp)(p),g.k));const R=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const q=Math.max(o,a,p);if(q>R){const c=R/q;o*=c,a*=c,p*=c}}else o=(0,Q.Clamp)(o,0,R),a=(0,Q.Clamp)(a,0,R),p=(0,Q.Clamp)(p,0,R);const I=new X.c(o,a,p);c.addLight(D,I,h),U+=h,b+=J}r+=n}}const u=6*(4*Math.PI)/6/U;return c.scaleInPlace(u),c.convertIncidentRadianceToIrradiance(),c.convertIrradianceToLambertianRadiance(),s.f.FromHarmonics(c)}}W._FileFaces=[new n("right",new J.p(1,0,0),new J.p(0,0,-1),new J.p(0,-1,0)),new n("left",new J.p(-1,0,0),new J.p(0,0,1),new J.p(0,-1,0)),new n("up",new J.p(0,1,0),new J.p(1,0,0),new J.p(0,0,1)),new n("down",new J.p(0,-1,0),new J.p(1,0,0),new J.p(0,0,-1)),new n("front",new J.p(0,0,1),new J.p(1,0,0),new J.p(0,-1,0)),new n("back",new J.p(0,0,-1),new J.p(-1,0,0),new J.p(0,-1,0))],W.MAX_HDRI_VALUE=4096,W.PRESERVE_CLAMPED_COLORS=!1},10845:(q,c,U)=>{function J(q,c){const U=[];for(let J=0;J<q;++J)U.push(c());return U}function Q(q,c){return J(q,c)}U.d(c,{d:()=>J,e:()=>Q,f:()=>g});const s=["push","splice","pop","shift","unshift"];function g(q,c){const U=s.map((U=>function(q,c,U){const J=q[c];if("function"!==typeof J)return null;const Q=function(){const J=q.length,s=Q.previous.apply(q,arguments);return U(c,J),s};return J.next=Q,Q.previous=J,q[c]=Q,()=>{const U=Q.previous;if(!U)return;const J=Q.next;J?(U.next=J,J.previous=U):(U.next=void 0,q[c]=U),Q.next=void 0,Q.previous=void 0}}(q,U,c)));return()=>{for(const q of U)null===q||void 0===q||q()}}},11344:(q,c,U)=>{U.d(c,{d:()=>g});var J=U(11288),Q=U(11346);let s=0;const g=q=>{if(!q.environmentBRDFTexture){const c=q.useDelayedTextureLoading;q.useDelayedTextureLoading=!1;const U=q._blockEntityCollection;q._blockEntityCollection=!1;const g=J.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+s++,q,!0,!1,J.c.BILINEAR_SAMPLINGMODE);q._blockEntityCollection=U;const X=q.getEngine().getLoadedTexturesCache(),n=X.indexOf(g.getInternalTexture());-1!==n&&X.splice(n,1),g.isRGBD=!0,g.wrapU=J.c.CLAMP_ADDRESSMODE,g.wrapV=J.c.CLAMP_ADDRESSMODE,q.environmentBRDFTexture=g,q.useDelayedTextureLoading=c,Q.e.ExpandRGBDTexture(g);const W=q.getEngine().onContextRestoredObservable.add((()=>{g.isRGBD=!0;const c=q.onBeforeRenderObservable.add((()=>{g.isReady()&&(q.onBeforeRenderObservable.remove(c),Q.e.ExpandRGBDTexture(g))}))}));q.Cc.add((()=>{q.getEngine().onContextRestoredObservable.remove(W)}))}return q.environmentBRDFTexture}},11127:(q,c,U)=>{function J(q,c,U){try{const J=q.next();J.done?c(J):J.value?J.value.then((()=>{J.value=void 0,c(J)}),U):c(J)}catch(J){U(J)}}function Q(){let q,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(U,Q,s)=>{const g=performance.now();void 0===q||g-q>c?(q=g,setTimeout((()=>{J(U,Q,s)}),0)):J(U,Q,s)}}function s(q,c,U,J,Q){const s=()=>{let g;const X=q=>{q.done?U(q.value):void 0===g?g=!0:s()};do{g=void 0,Q&&Q.aborted?J(new Error("Aborted")):c(q,X,J),void 0===g&&(g=!1)}while(g)};s()}function g(q,c){let U;return s(q,J,(q=>U=q),(q=>{throw q}),c),U}async function X(q,c,U){return await new Promise(((J,Q)=>{s(q,c,J,Q,U)}))}function n(q,c){return function(){return g(q(...arguments),c)}}U.d(c,{b:()=>Q,e:()=>n,g:()=>X,k:()=>g})},11022:(q,c,U)=>{U.d(c,{e:()=>s,h:()=>g});const J={},Q={};function s(q){const c=q.getClassName();return Q[c]||(Q[c]={}),Q[c]}function g(q){const c=q.getClassName();if(J[c])return J[c];J[c]={};const U=J[c];let s=q,g=c;for(;g;){const q=Q[g];for(const Q in q)U[Q]=q[Q];let c,J=!1;do{if(c=Object.getPrototypeOf(s),!c.getClassName){J=!0;break}if(c.getClassName()!==g)break;s=c}while(c);if(J)break;g=c.getClassName(),s=c}return U}},11019:(q,c,U)=>{U.d(c,{B:()=>h,D:()=>X,H:()=>D,K:()=>u,N:()=>g,c:()=>s,d:()=>a,g:()=>r,j:()=>n,m:()=>H,q:()=>W,u:()=>b,w:()=>o,y:()=>K});var J=U(11022);function Q(q,c){return(U,Q)=>{const s=(0,J.e)(U);s[Q]||(s[Q]={type:q,sourceName:c})}}function s(q){return function(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(U,J)=>{const Q=c||"_"+J;Object.defineProperty(U,J,{get:function(){return this[Q]},set:function(c){var J;"function"===typeof(null===(J=this[Q])||void 0===J?void 0:J.equals)&&this[Q].equals(c)||this[Q]!==c&&(this[Q]=c,U[q].apply(this))},enumerable:!0,configurable:!0})}}(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function g(q){return Q(0,q)}function X(q){return Q(1,q)}function n(q){return Q(2,q)}function W(q){return Q(3,q)}function D(q){return Q(4,q)}function u(q){return Q(5,q)}function K(q){return Q(6,q)}function r(q){return Q(7,q)}function H(q){return Q(8,q)}function b(q){return Q(9,q)}function h(q){return Q(10,q)}function o(q){return Q(12,q)}function a(q,c,U,J){const Q=U.value;U.value=function(){let U=Q;if("undefined"!==typeof _native&&_native[c]){const q=_native[c];U=J?function(){return J(...arguments)?q(...arguments):Q(...arguments)}:q}return q[c]=U,U(...arguments)}}a.filter=function(q){return(c,U,J)=>a(c,U,J,q)}},11082:(q,c,U)=>{U.d(c,{e:()=>W});var J=U(10910),Q=U(11087),s=U(11093),g=U(10833),X=U(11022);const n=function(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=q();Q.d&&Q.d.HasTags(c)&&Q.d.AddTagsTo(s,Q.d.GetTags(c,!0));const g=(0,X.h)(s),n={};for(const Q in g){const q=g[Q],X=c[Q],D=q.type;if(void 0!==X&&null!==X&&("uniqueId"!==Q||W.AllowLoadingUniqueId))switch(D){case 0:case 6:case 9:case 11:s[Q]=X;break;case 1:J.cloneTexturesOnlyOnce&&n[X.uniqueId]?s[Q]=n[X.uniqueId]:(s[Q]=U||X.isRenderTarget?X:X.clone(),n[X.uniqueId]=s[Q]);break;case 2:case 3:case 4:case 5:case 7:case 8:case 10:case 12:s[Q]=U?X:X.clone()}}return s};class W{static AppendSerializedAnimations(q,c){if(q.animations){c.animations=[];for(let U=0;U<q.animations.length;U++){const J=q.animations[U];c.animations.push(J.serialize())}}}static Serialize(q,c){c||(c={}),Q.d&&(c.tags=Q.d.GetTags(q));const U=(0,X.h)(q);for(const J in U){const Q=U[J],s=Q.sourceName||J,g=Q.type,X=q[J];if(void 0!==X&&null!==X&&("uniqueId"!==J||W.AllowLoadingUniqueId))switch(g){case 0:c[s]=X;break;case 1:case 3:case 7:case 9:c[s]=X.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:c[s]=X.rc();break;case 6:case 11:c[s]=X.id}}return c}static ParseProperties(q,c,U,J){J||(J="");const Q=(0,X.h)(c);for(const X in Q){const n=Q[X],D=q[n.sourceName||X],u=n.type;if(void 0!==D&&null!==D&&("uniqueId"!==X||W.AllowLoadingUniqueId)){const q=c;switch(u){case 0:q[X]=D;break;case 1:U&&(q[X]=W._TextureParser(D,U,J));break;case 2:q[X]=s.c.Ic(D);break;case 3:q[X]=W._FresnelParametersParser(D);break;case 4:q[X]=g.l.Ic(D);break;case 5:q[X]=g.p.Ic(D);break;case 6:U&&(q[X]=U.getLastMeshById(D));break;case 7:q[X]=W._ColorCurvesParser(D);break;case 8:q[X]=s.e.Ic(D);break;case 9:q[X]=W._ImageProcessingConfigurationParser(D);break;case 10:q[X]=g.g.Ic(D);break;case 11:U&&(q[X]=U.getCameraById(D));break;case 12:q[X]=g.d.Ic(D)}}}}static Parse(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const s=q();return Q.d&&Q.d.AddTagsTo(s,c.tags),W.ParseProperties(c,s,U,J),s}static Clone(q,c){return n(q,c,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(q,c){return n(q,c,!0)}}W.AllowLoadingUniqueId=!1,W._ImageProcessingConfigurationParser=q=>{throw(0,J.d)("ImageProcessingConfiguration")},W._FresnelParametersParser=q=>{throw(0,J.d)("FresnelParameters")},W._ColorCurvesParser=q=>{throw(0,J.d)("ColorCurves")},W._TextureParser=(q,c,U)=>{throw(0,J.d)("Texture")}},10895:(q,c,U)=>{U.d(c,{e:()=>s});var J=U(10886);const Q=(q,c,U)=>q?q.getClassName&&"Mesh"===q.getClassName()?null:!q.getClassName||"SubMesh"!==q.getClassName()&&"PhysicsBody"!==q.getClassName()?q.clone?q.clone():Array.isArray(q)?q.slice():U&&"object"===typeof q?{...q}:null:q.clone(c):null;class s{static DeepCopy(q,c,U,s){let g=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const X=function(q){const c=[];do{const U=Object.getOwnPropertyNames(q);for(const q of U)-1===c.indexOf(q)&&c.push(q)}while(q=Object.getPrototypeOf(q));return c}(q);for(const W of X){if("_"===W[0]&&(!s||-1===s.indexOf(W)))continue;if(W.endsWith("Observable"))continue;if(U&&-1!==U.indexOf(W))continue;const X=q[W],D=typeof X;if("function"!==D)try{if("object"===D)if(X instanceof Uint8Array)c[W]=Uint8Array.from(X);else if(X instanceof Array){if(c[W]=[],X.length>0)if("object"==typeof X[0])for(let q=0;q<X.length;q++){const U=Q(X[q],c,g);-1===c[W].indexOf(U)&&c[W].push(U)}else c[W]=X.slice(0)}else c[W]=Q(X,c,g);else c[W]=X}catch(n){J.c.Warn(n.message)}}}}},11542:(q,c,U)=>{function J(){const q=q=>!!q&&"object"===typeof q;for(var c=arguments.length,U=new Array(c),Q=0;Q<c;Q++)U[Q]=arguments[Q];return U.reduce(((c,U)=>{const Q=Object.keys(U);for(const s of Q){const Q=c[s],g=U[s];Array.isArray(Q)&&Array.isArray(g)?c[s]=Q.concat(...g):q(Q)&&q(g)?c[s]=J(Q,g):c[s]=g}return c}),{})}U.d(c,{e:()=>J})},10910:(q,c,U)=>{U.d(c,{d:()=>Q});const J={};function Q(q){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!J[q])return J[q]=!0,`${q} needs to be imported before as it contains a side-effect required by your code.`}},10881:(q,c,U)=>{function J(){return"undefined"!==typeof window}function Q(){return"undefined"!==typeof navigator}function s(){return"undefined"!==typeof document}function g(q){let c="",U=q.firstChild;for(;U;)3===U.nodeType&&(c+=U.textContent),U=U.nextSibling;return c}U.d(c,{b:()=>g,c:()=>s,g:()=>Q,j:()=>J})},11337:(q,c,U)=>{U.r(c),U.d(c,{Dispose:()=>K,DumpData:()=>u,DumpDataAsync:()=>D,DumpFramebuffer:()=>W,DumpTools:()=>r});var J=U(11312),Q=U(10879),s=U(10870),g=U(10864);let X,n=null;async function W(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",s=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0;const X=await U.readPixels(0,0,q,c);u(q,c,new Uint8Array(X.buffer),J,Q,s,!0,void 0,g)}async function D(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return await new Promise((n=>{u(q,c,U,(q=>n(q)),J,Q,s,g,X)}))}function u(q,c,W,D){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",r=arguments.length>5?arguments[5]:void 0,H=arguments.length>6&&void 0!==arguments[6]&&arguments[6],b=arguments.length>7&&void 0!==arguments[7]&&arguments[7],h=arguments.length>8?arguments[8]:void 0;(async function(){return n||(n=new Promise(((q,c)=>{let Q,s=null;const n={rD:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(U.bind(U,11199)).then((W=>{let{ThinEngine:D}=W;const u=g.c.Instances.length;try{Q=new OffscreenCanvas(100,100),s=new D(Q,!1,n)}catch(b){var r;u<g.c.Instances.length&&(null===(r=g.c.Instances.pop())||void 0===r||r.dispose()),Q=document.createElement("canvas"),s=new D(Q,!1,n)}g.c.Instances.pop(),g.c.OnEnginesDisposedObservable.add((q=>{s&&q!==s&&!s.u&&0===g.c.Instances.length&&K()})),s.getCaps().parallelShaderCompile=void 0;const H=new J.e(s);U.e(37).then(U.bind(U,13421)).then((U=>{let{passPixelShader:g}=U;if(!s)return void c("Engine is not defined");const n=new J.i({yX:s,name:g.name,fragmentShader:g.shader,samplerNames:["textureSampler"]});X={canvas:Q,yX:s,renderer:H,wrapper:n},q(X)}))})).catch(c)}))),await n})().then((U=>{if(U.yX.setSize(q,c,!0),W instanceof Float32Array){const q=new Uint8Array(W.length);let c=W.length;for(;c--;){const U=W[c];q[c]=Math.round(255*(0,s.Clamp)(U))}W=q}const J=U.yX.createRawTexture(W,q,c,5,!1,!H,1);U.renderer.setViewport(),U.renderer.applyEffectWrapper(U.wrapper),U.wrapper.effect._bindTexture("textureSampler",J),U.renderer.draw(),b?Q.e.ToBlob(U.canvas,(q=>{const c=new FileReader;c.onload=q=>{const c=q.target.result;D&&D(c)},c.readAsArrayBuffer(q)}),u,h):Q.e.EncodeScreenshotCanvasData(U.canvas,D,u,r,h),J.dispose()}))}function K(){var q;X?(X.wrapper.dispose(),X.renderer.dispose(),X.yX.dispose()):null===(q=n)||void 0===q||q.then((q=>{q.wrapper.dispose(),q.renderer.dispose(),q.yX.dispose()}));n=null,X=null}const r={DumpData:u,DumpDataAsync:D,DumpFramebuffer:W,Dispose:K};Q.e.DumpData=u,Q.e.DumpDataAsync=D,Q.e.DumpFramebuffer=W},10928:(q,c,U)=>{U.d(c,{d:()=>J,e:()=>Q,i:()=>s});class J extends Error{}J._setPrototypeOf=Object.setPrototypeOf||((q,c)=>(q.__proto__=c,q));const Q={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class s extends J{constructor(q,c,U){super(q),this.errorCode=c,this.innerError=U,this.name="RuntimeError",J._setPrototypeOf(this,s.prototype)}}},10922:(q,c,U)=>{U.d(c,{c:()=>O,d:()=>p,f:()=>v,i:()=>k,q:()=>i,m:()=>h,s:()=>t,t:()=>C,v:()=>F,z:()=>R});var J=U(10913),Q=U(10881),s=U(10866);class g{}g.FilesToLoad={};var X=U(10928),n=U(10930),W=U(10937),D=U(10864),u=U(10886),K=U(10945),r=U(10940),H=U(10954);const b=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class h extends X.i{constructor(q,c){super(q,X.e.LoadFileError),this.name="LoadFileError",X.d._setPrototypeOf(this,h.prototype),c instanceof J.d?this.request=c:this.file=c}}class o extends X.i{constructor(q,c){super(q,X.e.RequestFileError),this.request=c,this.name="RequestFileError",X.d._setPrototypeOf(this,o.prototype)}}class a extends X.i{constructor(q,c){super(q,X.e.ReadFileError),this.file=c,this.name="ReadFileError",X.d._setPrototypeOf(this,a.prototype)}}const p={DefaultRetryStrategy:class{static ExponentialBackoff(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(U,J,Q)=>0!==J.status||Q>=q||-1!==U.indexOf("file:")?-1:Math.pow(2,Q)*c}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:q=>q,ScriptBaseUrl:"",ScriptPreprocessUrl:q=>q,CleanUrl:q=>q=q.replace(/#/gm,"%23")},R=(q,c)=>{if((!q||0!==q.indexOf("data:"))&&p.CorsBehavior)if("string"===typeof p.CorsBehavior||p.CorsBehavior instanceof String)c.crossOrigin=p.CorsBehavior;else{const U=p.CorsBehavior(q);U&&(c.crossOrigin=U)}},I={getRequiredSize:null},t=function(q,c,U,Q){let s,X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",W=arguments.length>5?arguments[5]:void 0,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:D.c.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===u||void 0===u||!u._features.forceBitmapOverHTMLImageElement))return U("LoadImage is only supported in web or BabylonNative environments."),null;let K=!1;q instanceof ArrayBuffer||ArrayBuffer.isView(q)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(s=URL.createObjectURL(new Blob([q],{type:X})),K=!0):s=`data:${X};base64,`+(0,n.k)(q):q instanceof Blob?(s=URL.createObjectURL(q),K=!0):(s=p.CleanUrl(q),s=p.PreprocessUrl(s));const r=c=>{if(U){const J=s||q.toString();U(`Error while trying to load image: ${0===J.indexOf("http")||J.length<=128?J:J.slice(0,128)+"..."}`,c)}};if(null!==u&&void 0!==u&&u._features.forceBitmapOverHTMLImageElement)return i(s,(J=>{u.createImageBitmap(new Blob([J],{type:X}),{premultiplyAlpha:"none",...W}).then((q=>{c(q),K&&URL.revokeObjectURL(s)})).catch((c=>{U&&U("Error while trying to load image: "+q,c)}))}),void 0,Q||void 0,!0,((q,c)=>{r(c)})),null;const H=new Image;if(I.getRequiredSize){const c=I.getRequiredSize(q);c.width&&(H.width=c.width),c.height&&(H.height=c.height)}R(s,H);const b=[],h=()=>{for(const q of b)q.target.removeEventListener(q.name,q.handler);b.length=0};b.push({target:H,name:"load",handler:()=>{h(),c(H),K&&H.src&&URL.revokeObjectURL(H.src)}}),b.push({target:H,name:"error",handler:q=>{h(),r(q),K&&H.src&&URL.revokeObjectURL(H.src)}}),b.push({target:document,name:"securitypolicyviolation",handler:q=>{if(q.blockedURI!==H.src||"jH"===q.disposition)return;h();const c=new Error(`CSP violation of policy ${q.effectiveDirective} ${q.blockedURI}. Current policy is ${q.originalPolicy}`);D.c.UseFallbackTexture=!1,r(c),K&&H.src&&URL.revokeObjectURL(H.src),H.src=""}}),(()=>{for(const q of b)q.target.addEventListener(q.name,q.handler)})();const o="blob:"===s.substring(0,5),a="data:"===s.substring(0,5),t=()=>{o||a||!J.d.IsCustomRequestAvailable?H.src=s:i(s,((q,c,U)=>{const J=new Blob([q],{type:!X&&U?U:X}),Q=URL.createObjectURL(J);K=!0,H.src=Q}),void 0,Q||void 0,!0,((q,c)=>{r(c)}))},C=()=>{Q&&Q.loadImage(s,H)};if(!o&&!a&&Q&&Q.enableTexturesOffline)Q.open(C,t);else{if(-1!==s.indexOf("file:")){const q=decodeURIComponent(s.substring(5).toLowerCase());if(g.FilesToLoad[q]&&"undefined"!==typeof URL){try{let c;try{c=URL.createObjectURL(g.FilesToLoad[q])}catch(F){c=URL.createObjectURL(g.FilesToLoad[q])}H.src=c,K=!0}catch(v){H.src=""}return H}}t()}return H},C=(q,c,U,J,Q)=>{const g=new FileReader,X={onCompleteObservable:new s.e,abort:()=>g.abort()};return g.onloadend=()=>X.onCompleteObservable.notifyObservers(X),Q&&(g.onerror=()=>{Q(new a(`Unable to read ${q.name}`,q))}),g.onload=q=>{c(q.target.result)},U&&(g.onprogress=U),J?g.readAsArrayBuffer(q):g.readAsText(q),X},i=(q,c,U,J,Q,n,W)=>{if(q.name)return C(q,c,U,Q,n?q=>{n(void 0,q)}:void 0);const D=q;if(-1!==D.indexOf("file:")){let q=decodeURIComponent(D.substring(5).toLowerCase());0===q.indexOf("./")&&(q=q.substring(2));const J=g.FilesToLoad[q];if(J)return C(J,c,U,Q,n?q=>n(void 0,new h(q.message,q.file)):void 0)}const{match:r,type:H}=V(D);if(r){const q={onCompleteObservable:new s.e,abort:()=>()=>{}};try{const q=Q?O(D):G(D);c(q,void 0,H)}catch(X){n?n(void 0,X):u.c.Error(X.message||"Failed to parse the Data URL")}return K.c.SetImmediate((()=>{q.onCompleteObservable.notifyObservers(q)})),q}return F(D,((q,U)=>{c(q,null===U||void 0===U?void 0:U.responseURL,null===U||void 0===U?void 0:U.getResponseHeader("content-type"))}),U,J,Q,n?q=>{n(q.request,new h(q.message,q.request))}:void 0,W)},F=(q,c,U,g,X,n,W)=>{q=p.CleanUrl(q),q=p.PreprocessUrl(q);const D=p.BaseUrl+q;let K=!1;const r={onCompleteObservable:new s.e,abort:()=>K=!0},H=()=>{let q,s=new J.d,g=null;const H=()=>{s&&(U&&s.removeEventListener("progress",U),q&&s.removeEventListener("readystatechange",q),s.removeEventListener("loadend",b))};let b=()=>{H(),r.onCompleteObservable.notifyObservers(r),r.onCompleteObservable.clear(),U=void 0,q=null,b=null,n=void 0,W=void 0,c=void 0};r.abort=()=>{K=!0,b&&b(),s&&s.readyState!==(XMLHttpRequest.DONE||4)&&s.abort(),null!==g&&(clearTimeout(g),g=null),s=null};const h=q=>{const c=q.message||"Unknown error";n&&s?n(new o(c,s)):u.c.Error(c)},a=u=>{if(s){if(s.open("GET",D),W)try{W(s)}catch(r){return void h(r)}X&&(s.responseType="arraybuffer"),U&&s.addEventListener("progress",U),b&&s.addEventListener("loadend",b),q=()=>{if(!K&&s&&s.readyState===(XMLHttpRequest.DONE||4)){if(q&&s.removeEventListener("readystatechange",q),s.status>=200&&s.status<300||0===s.status&&(!(0,Q.j)()||Y())){const q=X?s.response:s.responseText;if(null!==q){try{c&&c(q,s)}catch(r){h(r)}return}}const U=p.DefaultRetryStrategy;if(U){const q=U(D,s,u);if(-1!==q)return H(),s=new J.d,void(g=setTimeout((()=>a(u+1)),q))}const W=new o("Error status: "+s.status+" "+s.statusText+" - Unable to load "+D,s);n&&n(W)}},s.addEventListener("readystatechange",q),s.send()}};a(0)};if(g&&g.enableSceneOffline){const J=q=>{q&&q.status>400?n&&n(q):H()},Q=()=>{g&&g.loadFile(p.BaseUrl+q,(q=>{!K&&c&&c(q),r.onCompleteObservable.notifyObservers(r)}),U?q=>{!K&&U&&U(q)}:void 0,J,X)};g.open(Q,J)}else H();return r},v=q=>{const{match:c,type:U}=V(q);if(c)return U||void 0;const J=q.lastIndexOf(".");switch(q.substring(J+1).toLowerCase()){case"glb":return"model/gltf-binary";case"bin":return"application/octet-stream";case"Vc":return"model/gltf+json";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"webp":return"image/webp";default:return}},Y=()=>"undefined"!==typeof location&&"file:"===location.protocol,k=q=>b.test(q),V=q=>{const c=b.exec(q);if(null===c||0===c.length)return{match:!1,type:""};return{match:!0,type:c[0].replace("data:","").replace("base64,","")}};function O(q){return(0,n.b)(q.split(",")[1])}const G=q=>(0,n.e)(q.split(",")[1]);let S;H.d._FileToolsLoadImage=t,r.d.loadFile=i,W.n.loadFile=i;((q,c,U,J,Q,s,g,X,n,W)=>{S={DecodeBase64UrlToBinary:q,DecodeBase64UrlToString:c,DefaultRetryStrategy:U.DefaultRetryStrategy,BaseUrl:U.BaseUrl,CorsBehavior:U.CorsBehavior,PreprocessUrl:U.PreprocessUrl,IsBase64DataUrl:J,IsFileURL:Q,LoadFile:s,LoadImage:g,ReadFile:X,RequestFile:n,SetCorsBehavior:W},Object.defineProperty(S,"DefaultRetryStrategy",{get:function(){return U.DefaultRetryStrategy},set:function(q){U.DefaultRetryStrategy=q}}),Object.defineProperty(S,"BaseUrl",{get:function(){return U.BaseUrl},set:function(q){U.BaseUrl=q}}),Object.defineProperty(S,"PreprocessUrl",{get:function(){return U.PreprocessUrl},set:function(q){U.PreprocessUrl=q}}),Object.defineProperty(S,"CorsBehavior",{get:function(){return U.CorsBehavior},set:function(q){U.CorsBehavior=q}})})(O,G,p,k,Y,i,t,C,F,R)},10995:(q,c,U)=>{function J(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(q=>{const c=16*Math.random()|0;return("x"===q?c:3&c|8).toString(16)}))}U.d(c,{b:()=>J})},10991:(q,c,U)=>{U.d(c,{d:()=>s});var J=U(10886),Q=U(10850);class s{static Instantiate(q){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[q])return this.RegisteredExternalClasses[q];const c=(0,Q.d)(q);if(c)return c;J.c.Warn(q+" not found, you may have missed an import.");const U=q.split(".");let s=window||this;for(let J=0,Q=U.length;J<Q;J++)s=s[U[J]];return"function"!==typeof s?null:s}}s.RegisteredExternalClasses={}},10886:(q,c,U)=>{U.d(c,{c:()=>J});class J{static _CheckLimit(q,c){let U=J._LogLimitOutputs[q];return U?U.current++:(U={limit:c,current:1},J._LogLimitOutputs[q]=U),U.current<=U.limit}static _GenerateLimitMessage(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const U=J._LogLimitOutputs[q];if(!U||!J.MessageLimitReached)return;const Q=this._Levels[c];U.current===U.limit&&J[Q.name](J.MessageLimitReached.replace(/%LIMIT%/g,""+U.limit).replace(/%TYPE%/g,Q.name??""))}static _AddLogEntry(q){J._LogCache=q+J._LogCache,J.OnNewCacheEntry&&J.OnNewCacheEntry(q)}static _FormatMessage(q){const c=q=>q<10?"0"+q:""+q,U=new Date;return"["+c(U.getHours())+":"+c(U.getMinutes())+":"+c(U.getSeconds())+"]: "+q}static _LogDisabled(q,c){}static _LogEnabled(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0;const Q=Array.isArray(c)?c[0]:c;if(void 0!==U&&!J._CheckLimit(Q,U))return;const s=J._FormatMessage(Q),g=this._Levels[q],X=Array.isArray(c)?c.slice(1):[];g.logFunc&&g.logFunc("BJS - "+s,...X);const n=`<div style='color:${g.color}'>${s}</div><br>`;J._AddLogEntry(n),J._GenerateLimitMessage(Q,q)}static get LogCache(){return J._LogCache}static ClearLogCache(){J._LogCache="",J._LogLimitOutputs={},J.errorsCount=0}static set LogLevels(q){J.Log=J._LogDisabled,J.Warn=J._LogDisabled,J.Error=J._LogDisabled;const c=[J.MessageLogLevel,J.WarningLogLevel,J.ErrorLogLevel];for(const U of c)if((q&U)===U){const q=this._Levels[U];J[q.name]=J._LogEnabled.bind(J,U)}}}J.NoneLogLevel=0,J.MessageLogLevel=1,J.WarningLogLevel=2,J.ErrorLogLevel=4,J.AllLogLevel=7,J.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",J._LogCache="",J._LogLimitOutputs={},J._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],J.errorsCount=0,J.Log=J._LogEnabled.bind(J,J.MessageLogLevel),J.Warn=J._LogEnabled.bind(J,J.WarningLogLevel),J.Error=J._LogEnabled.bind(J,J.ErrorLogLevel)},10866:(q,c,U)=>{U.d(c,{e:()=>g});const J="undefined"!==typeof WeakRef;class Q{constructor(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;this.initialize(q,c,U,J)}initialize(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;return this.mask=q,this.skipNextObservers=c,this.target=U,this.currentTarget=J,this}}class s{constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=q,this.mask=c,this.scope=U,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(q)}}class g{static FromPromise(q,c){const U=new g;return q.then((q=>{U.notifyObservers(q)})).catch((q=>{if(!c)throw q;c.notifyObservers(q)})),U}get observers(){return this._observers}constructor(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=c,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new Q(0),q&&(this._onObserverAdded=q)}add(q){let c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],U=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!q)return null;const Q=new s(q,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);Q.unregisterOnNextCall=U,c?this._observers.unshift(Q):this._observers.push(Q),this._onObserverAdded&&this._onObserverAdded(Q),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(Q,this._lastNotifiedValue);const g=J?new WeakRef(this):{deref:()=>this};return Q._remove=function(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=g.deref();c&&(q?c.remove(Q):c._remove(Q))},Q}addOnce(q){return this.add(q,void 0,void 0,void 0,!0)}remove(q){if(!q)return!1;q._remove=null;return-1!==this._observers.indexOf(q)&&(this._deferUnregister(q),!0)}removeCallback(q,c){for(let U=0;U<this._observers.length;U++){const J=this._observers[U];if(!J._willBeUnregistered&&(J.callback===q&&(!c||c===J.scope)))return this._deferUnregister(J),!0}return!1}_deferUnregister(q){q._willBeUnregistered||(this._numObserversMarkedAsDeleted++,q.unregisterOnNextCall=!1,q._willBeUnregistered=!0,setTimeout((()=>{this._remove(q)}),0))}_remove(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!q)return!1;const U=this._observers.indexOf(q);return-1!==U&&(c&&this._numObserversMarkedAsDeleted--,this._observers.splice(U,1),!0)}makeObserverTopPriority(q){this._remove(q,!1),this._observers.unshift(q)}makeObserverBottomPriority(q){this._remove(q,!1),this._observers.push(q)}notifyObservers(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=q),!this._observers.length)return!0;const s=this._eventState;s.mask=c,s.target=U,s.currentTarget=J,s.skipNextObservers=!1,s.lastReturnValue=q,s.userInfo=Q;for(const g of this._observers)if(!g._willBeUnregistered&&(g.mask&c&&(g.unregisterOnNextCall&&this._deferUnregister(g),g.scope?s.lastReturnValue=g.callback.apply(g.scope,[q,s]):s.lastReturnValue=g.callback(q,s)),s.skipNextObservers))return!1;return!0}notifyObserver(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=c),q._willBeUnregistered)return;const J=this._eventState;J.mask=U,J.skipNextObservers=!1,q.unregisterOnNextCall&&this._deferUnregister(q),q.callback(c,J)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const q=this._observers.pop();q&&(q._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const q=new g;return q._observers=this._observers.slice(0),q}hasSpecificMask(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const c of this._observers)if(c.mask&q||c.mask===q)return!0;return!1}}},11282:(q,c,U)=>{U.d(c,{e:()=>Q});var J=U(10902);class Q{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(q,c){Q.Enabled&&(this._current+=q,c&&this._fetchResult())}beginMonitoring(){Q.Enabled&&(this._startMonitoringTime=J.d.Now)}endMonitoring(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!Q.Enabled)return;q&&this.fetchNewFrame();const c=J.d.Now;this._current=c-this._startMonitoringTime,q&&this._fetchResult()}Nu(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const q=J.d.Now;q-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=q,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}Q.Enabled=!0},10902:(q,c,U)=>{U.d(c,{d:()=>Q});var J=U(10881);class Q{static get Now(){return(0,J.j)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11346:(q,c,U)=>{U.d(c,{e:()=>s});var J=U(11309),Q=U(11285);class s{static ExpandRGBDTexture(q){const c=q._texture;if(!c||!q.isRGBD)return;const Q=c.getEngine(),s=Q.getCaps(),g=c.isReady;let X=!1;s.textureHalfFloatRender&&s.textureHalfFloatLinearFiltering?(X=!0,c.type=2):s.textureFloatRender&&s.textureFloatLinearFiltering&&(X=!0,c.type=1),X&&(c.isReady=!1,c._isRGBD=!1,c.invertY=!1);const n=async()=>{const s=Q.isWebGPU,g=s?1:0;c.isReady=!1,s?await U.e(21).then(U.bind(U,13463)):await U.e(14).then(U.bind(U,13467));const X=new J.b("rgbdDecode","rgbdDecode",null,null,1,null,3,Q,!1,void 0,c.type,void 0,null,!1,void 0,g);X.externalTextureSamplerBinding=!0;const n=Q.createRenderTargetTexture(c.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:c.samplingMode,type:c.type,format:5});X.onEffectCreatedObservable.addOnce((U=>{U.executeWhenCompiled((()=>{X.onApply=q=>{q._bindTexture("textureSampler",c),q.setFloat2("scale",1,1)},q.Cq().postProcessManager.directRender([X],n,!0),Q.restoreDefaultFramebuffer(),Q._releaseTexture(c),X&&X.dispose(),n._swapAndDie(c),c.isReady=!0}))}))};X&&(g?n():q.onLoadObservable.addOnce(n))}static async EncodeTextureToRGBD(q,c){let J=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return c.getEngine().isWebGPU?await U.e(22).then(U.bind(U,13477)):await U.e(15).then(U.bind(U,13471)),await(0,Q.c)("rgbdEncode",q,c,J,1,5)}}},11156:(q,c,U)=>{U.d(c,{e:()=>Q,g:()=>J});class J{constructor(q){this.length=0,this.data=new Array(q),this._id=J._GlobalId++}push(q){this.data[this.length++]=q,this.length>this.data.length&&(this.data.length*=2)}forEach(q){for(let c=0;c<this.length;c++)q(this.data[c])}sort(q){this.data.sort(q)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(q){if(0!==q.length){this.length+q.length>this.data.length&&(this.data.length=2*(this.length+q.length));for(let c=0;c<q.length;c++)this.data[this.length++]=(q.data||q)[c]}}indexOf(q){const c=this.data.indexOf(q);return c>=this.length?-1:c}contains(q){return-1!==this.indexOf(q)}}J._GlobalId=0;class Q extends J{constructor(){super(...arguments),this._duplicateId=0}push(q){super.push(q),q.__smartArrayFlags||(q.__smartArrayFlags={}),q.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(q){return(!q.__smartArrayFlags||q.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(q),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(q){if(0!==q.length){this.length+q.length>this.data.length&&(this.data.length=2*(this.length+q.length));for(let c=0;c<q.length;c++){const U=(q.data||q)[c];this.pushNoDuplicate(U)}}}}},10930:(q,c,U)=>{U.d(c,{b:()=>g,e:()=>s,i:()=>J,k:()=>Q});const J=q=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(q);let c="";for(let U=0;U<q.byteLength;U++)c+=String.fromCharCode(q[U]);return c},Q=q=>{const c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let U,J,Q,s,g,X,n,W="",D=0;const u=ArrayBuffer.isView(q)?new Uint8Array(q.buffer,q.byteOffset,q.byteLength):new Uint8Array(q);for(;D<u.length;)U=u[D++],J=D<u.length?u[D++]:Number.NaN,Q=D<u.length?u[D++]:Number.NaN,s=U>>2,g=(3&U)<<4|J>>4,X=(15&J)<<2|Q>>6,n=63&Q,isNaN(J)?X=n=64:isNaN(Q)&&(n=64),W+=c.charAt(s)+c.charAt(g)+c.charAt(X)+c.charAt(n);return W},s=q=>atob(q),g=q=>{const c=s(q),U=c.length,J=new Uint8Array(new ArrayBuffer(U));for(let Q=0;Q<U;Q++)J[Q]=c.charCodeAt(Q);return J.buffer}},11087:(q,c,U)=>{U.d(c,{d:()=>Q});class J{static Eval(q,c){return"true"===(q=q.match(/\([^()]*\)/g)?q.replace(/\([^()]*\)/g,(q=>(q=q.slice(1,q.length-1),J._HandleParenthesisContent(q,c)))):J._HandleParenthesisContent(q,c))||"false"!==q&&J.Eval(q,c)}static _HandleParenthesisContent(q,c){let U;c=c||(q=>"true"===q);const Q=q.split("||");for(const s in Q)if(Object.prototype.hasOwnProperty.call(Q,s)){let q=J._SimplifyNegation(Q[s].trim());const g=q.split("&&");if(g.length>1)for(let Q=0;Q<g.length;++Q){const s=J._SimplifyNegation(g[Q].trim());if(U="true"!==s&&"false"!==s?"!"===s[0]?!c(s.substring(1)):c(s):"true"===s,!U){q="false";break}}if(U||"true"===q){U=!0;break}U="true"!==q&&"false"!==q?"!"===q[0]?!c(q.substring(1)):c(q):"true"===q}return U?"true":"false"}static _SimplifyNegation(q){return"!true"===(q=(q=q.replace(/^[\s!]+/,(q=>(q=q.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?q="false":"!false"===q&&(q="true"),q}}class Q{static EnableFor(q){q._tags=q._tags||{},q.hasTags=()=>Q.HasTags(q),q.addTags=c=>Q.AddTagsTo(q,c),q.removeTags=c=>Q.RemoveTagsFrom(q,c),q.matchesTagsQuery=c=>Q.MatchesQuery(q,c)}static DisableFor(q){delete q._tags,delete q.hasTags,delete q.addTags,delete q.removeTags,delete q.matchesTagsQuery}static HasTags(q){if(!q._tags)return!1;const c=q._tags;for(const U in c)if(Object.prototype.hasOwnProperty.call(c,U))return!0;return!1}static GetTags(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!q._tags)return null;if(c){const c=[];for(const U in q._tags)Object.prototype.hasOwnProperty.call(q._tags,U)&&!0===q._tags[U]&&c.push(U);return c.join(" ")}return q._tags}static AddTagsTo(q,c){if(!c)return;if("string"!==typeof c)return;const U=c.split(" ");for(const J of U)Q._AddTagTo(q,J)}static _AddTagTo(q,c){""!==(c=c.trim())&&"true"!==c&&"false"!==c&&(c.match(/[\s]/)||c.match(/^([!]|([|]|[&]){2})/)||(Q.EnableFor(q),q._tags[c]=!0))}static RemoveTagsFrom(q,c){if(!Q.HasTags(q))return;const U=c.split(" ");for(const J in U)Q._RemoveTagFrom(q,U[J])}static _RemoveTagFrom(q,c){delete q._tags[c]}static MatchesQuery(q,c){return void 0===c||(""===c?Q.HasTags(q):J.Eval(c,(c=>Q.HasTags(q)&&q._tags[c])))}}},11285:(q,c,U)=>{U.d(c,{c:()=>o,g:()=>I,k:()=>C,l:()=>i,n:()=>R});var J=U(11288),Q=U(11296),s=U(11010),g=U(11309),X=U(10954),n=U(10850),W=U(11082),D=U(11312),u=U(11196);class K extends D.i{_gatherImports(q,c){q?(this._webGPUReady=!0,c.push(Promise.all([U.e(36).then(U.bind(U,13413))]))):c.push(Promise.all([U.e(37).then(U.bind(U,13421))])),super._gatherImports(q,c)}constructor(q){super({...arguments.length>2?arguments[2]:void 0,name:q,yX:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||u.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:K.FragmentUrl})}}K.FragmentUrl="pass";class r extends D.i{_gatherImports(q,c){q?(this._webGPUReady=!0,c.push(Promise.all([U.e(43).then(U.bind(U,13452))]))):c.push(Promise.all([U.e(44).then(U.bind(U,13456))])),super._gatherImports(q,c)}constructor(q){super({...arguments.length>2?arguments[2]:void 0,name:q,yX:(arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)||u.e.LastCreatedEngine,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:r.FragmentUrl,defines:"#define POSITIVEX"}),this._face=0}get face(){return this._face}set face(q){if(!(q<0||q>5))switch(this._face=q,this._face){case 0:this.updateEffect("#define POSITIVEX");break;case 1:this.updateEffect("#define NEGATIVEX");break;case 2:this.updateEffect("#define POSITIVEY");break;case 3:this.updateEffect("#define NEGATIVEY");break;case 4:this.updateEffect("#define POSITIVEZ");break;case 5:this.updateEffect("#define NEGATIVEZ")}}}r.FragmentUrl="passCube";var H=U(11019);class b extends g.b{getClassName(){return"PassPostProcess"}constructor(q,c){let U=arguments.length>4?arguments[4]:void 0;const J={size:"number"===typeof c?c:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,yX:U,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...c};super(q,K.FragmentUrl,{effectWrapper:"number"!==typeof c&&c.effectWrapper?void 0:new K(q,U,J),...J})}static _Parse(q,c,U,J){return W.e.Parse((()=>new b(q.name,q.options,c,q.renderTargetSamplingMode,q._engine,q.reusable)),q,U,J)}}(0,n.f)("BABYLON.PassPostProcess",b);class h extends g.b{get face(){return this._effectWrapper.face}set face(q){this._effectWrapper.face=q}getClassName(){return"PassCubePostProcess"}constructor(q,c){let U=arguments.length>4?arguments[4]:void 0;const J={size:"number"===typeof c?c:void 0,camera:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,samplingMode:arguments.length>3?arguments[3]:void 0,yX:U,reusable:arguments.length>5?arguments[5]:void 0,textureType:arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,blockCompilation:arguments.length>7&&void 0!==arguments[7]&&arguments[7],...c};super(q,K.FragmentUrl,{effectWrapper:"number"!==typeof c&&c.effectWrapper?void 0:new r(q,U,J),...J})}static _Parse(q,c,U,J){return W.e.Parse((()=>new h(q.name,q.options,c,q.renderTargetSamplingMode,q._engine,q.reusable)),q,U,J)}}function o(q,c,U,J,Q,s,X,n){const W=c.getEngine();return c.isReady=!1,Q=Q??c.samplingMode,J=J??c.type,s=s??c.format,X=X??c.width,n=n??c.height,-1===J&&(J=0),new Promise((D=>{const u=new g.b("postprocess",q,null,null,1,null,Q,W,!1,void 0,J,void 0,null,!1,s);u.externalTextureSamplerBinding=!0;const K=W.createRenderTargetTexture({width:X,height:n},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:Q,type:J,format:s});u.onEffectCreatedObservable.addOnce((q=>{q.executeWhenCompiled((()=>{u.onApply=q=>{q._bindTexture("textureSampler",c),q.setFloat2("scale",1,1)},U.postProcessManager.directRender([u],K,!0),W.restoreDefaultFramebuffer(),W._releaseTexture(c),u&&u.dispose(),K._swapAndDie(c),c.type=J,c.format=5,c.isReady=!0,D(c)}))}))}))}let a,p;function R(q){a||(a=new Float32Array(1),p=new Int32Array(a.buffer)),a[0]=q;const c=p[0];let U=c>>16&32768,J=c>>12&2047;const Q=c>>23&255;return Q<103?U:Q>142?(U|=31744,U|=(255==Q?0:1)&&8388607&c,U):Q<113?(J|=2048,U|=(J>>114-Q)+(J>>113-Q&1),U):(U|=Q-112<<10|J>>1,U+=1&J,U)}function I(q){const c=(32768&q)>>15,U=(31744&q)>>10,J=1023&q;return 0===U?(c?-1:1)*Math.pow(2,-14)*(J/Math.pow(2,10)):31==U?J?NaN:1/0*(c?-1:1):(c?-1:1)*Math.pow(2,U-15)*(1+J/Math.pow(2,10))}(0,s.d)([(0,H.N)()],h.prototype,"face",null),X.d._RescalePostProcessFactory=q=>new b("rescale",1,null,2,q,!1,0);const t=async(q,c,s,X,n)=>{const W=q.Cq(),D=W.getEngine();let u;if(D.isWebGPU?q.isCube?await U.e(40).then(U.bind(U,13436)):await U.e(41).then(U.bind(U,13442)):q.isCube?await U.e(38).then(U.bind(U,13429)):await U.e(39).then(U.bind(U,13431)),q.isCube){const q=["#define POSITIVEX","#define NEGATIVEX","#define POSITIVEY","#define NEGATIVEY","#define POSITIVEZ","#define NEGATIVEZ"];u=new g.b("lodCube","lodCube",{uniforms:["lod","gamma"],samplingMode:J.c.NEAREST_NEAREST_MIPNEAREST,yX:D,defines:q[X],shaderLanguage:D.isWebGPU?1:0})}else u=new g.b("lod","lod",{uniforms:["lod","gamma"],samplingMode:J.c.NEAREST_NEAREST_MIPNEAREST,yX:D,shaderLanguage:D.isWebGPU?1:0});await new Promise((q=>{u.onEffectCreatedObservable.addOnce((c=>{c.executeWhenCompiled((()=>{q(0)}))}))}));const K=new Q.e("temp",{width:c,height:s},W,!1);u.onApply=function(c){c.setTexture("textureSampler",q),c.setFloat("lod",n),c.setInt("gamma",q.gammaSpace?1:0)};const r=q.getInternalTexture();try{if(K.renderTarget&&r){const U=r.samplingMode;0!==n?q.updateSamplingMode(J.c.NEAREST_NEAREST_MIPNEAREST):q.updateSamplingMode(J.c.NEAREST_NEAREST),W.postProcessManager.directRender([u],K.renderTarget,!0),q.updateSamplingMode(U);const Q=await D.readPixels(0,0,c,s),g=new Uint8Array(Q.buffer,0,Q.byteLength);return D.unBindFramebuffer(K.renderTarget),g}throw Error("Render to texture failed.")}finally{K.dispose(),u.dispose()}};async function C(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return!q.isReady()&&q._texture&&await new Promise(((c,U)=>{null!==q._texture?q._texture.onLoadedObservable.addOnce((()=>{c(0)})):U(0)})),await t(q,c,U,J,Q)}const i={CreateResizedCopy:function(q,c,U){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const g=q.Cq(),X=g.getEngine(),n=new Q.e("resized"+q.name,{width:c,height:U},g,!q.noMipmap,!0,q._texture.type,!1,q.samplingMode,!1);n.wrapU=q.wrapU,n.wrapV=q.wrapV,n.uOffset=q.uOffset,n.vOffset=q.vOffset,n.uScale=q.uScale,n.vScale=q.vScale,n.uAng=q.uAng,n.vAng=q.vAng,n.wAng=q.wAng,n.coordinatesIndex=q.coordinatesIndex,n.level=q.level,n.anisotropicFilteringLevel=q.anisotropicFilteringLevel,n._texture.isReady=!1,q.wrapU=J.c.CLAMP_ADDRESSMODE,q.wrapV=J.c.CLAMP_ADDRESSMODE;const W=new b("pass",1,null,s?J.c.BILINEAR_SAMPLINGMODE:J.c.NEAREST_SAMPLINGMODE,X,!1,0);return W.externalTextureSamplerBinding=!0,W.onEffectCreatedObservable.addOnce((c=>{c.executeWhenCompiled((()=>{W.onApply=function(c){c.setTexture("textureSampler",q)};const c=n.renderTarget;c&&(g.postProcessManager.directRender([W],c),X.unBindFramebuffer(c),n.disposeFramebufferObjects(),W.dispose(),n.getInternalTexture().isReady=!0)}))})),n},ApplyPostProcess:o,ToHalfFloat:R,FromHalfFloat:I,GetTextureDataAsync:C}},10945:(q,c,U)=>{U.d(c,{c:()=>Q,f:()=>g});let J=[];class Q{static SetImmediate(q){0===J.length&&setTimeout((()=>{const q=J;J=[];for(const c of q)c()}),1),J.push(q)}}function s(q,c,U){try{if(q())return c(),!0}catch(J){return null===U||void 0===U||U(J),!0}return!1}const g=function(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,g=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&s(q,c,U))return null;const X=setInterval((()=>{s(q,c,U)?clearInterval(X):(Q-=J,Q<0&&(clearInterval(X),null===U||void 0===U||U(new Error("Operation timed out after maximum retries. "+(g||"")),!0)))}),J);return()=>clearInterval(X)}},11002:(q,c,U)=>{function J(q){let c=1;do{c*=2}while(c<q);return c===q}function Q(q,c,U){return q*(1-U)+c*U}function s(q){const c=g(q),U=X(q);return c-q>q-U?U:c}function g(q){return q--,q|=q>>1,q|=q>>2,q|=q>>4,q|=q>>8,q|=q>>16,++q}function X(q){return q|=q>>1,q|=q>>2,q|=q>>4,q|=q>>8,(q|=q>>16)-(q>>1)}function n(q,c){let U;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:U=X(q);break;case 2:U=s(q);break;default:U=g(q)}return Math.min(U,c)}U.d(c,{d:()=>X,h:()=>n,j:()=>J,l:()=>Q,p:()=>s})},10879:(q,c,U)=>{U.d(c,{b:()=>o,e:()=>h});var J=U(10866),Q=U(10881),s=U(10886),g=U(10895),X=U(10902),n=U(10910),W=U(10913),D=U(10864),u=U(10922),K=U(10945),r=U(10991),H=U(10995),b=U(11002);class h{static get BaseUrl(){return u.d.BaseUrl}static set BaseUrl(q){u.d.BaseUrl=q}static get CleanUrl(){return u.d.CleanUrl}static set CleanUrl(q){u.d.CleanUrl=q}static IsAbsoluteUrl(q){return 0===q.indexOf("//")||-1!==q.indexOf("://")&&(-1!==q.indexOf(".")&&(-1!==q.indexOf("/")&&(!(q.indexOf(":")>q.indexOf("/"))&&(q.indexOf("://")<q.indexOf(".")||(0===q.indexOf("data:")||0===q.indexOf("blob:"))))))}static set ScriptBaseUrl(q){u.d.ScriptBaseUrl=q}static get ScriptBaseUrl(){return u.d.ScriptBaseUrl}static set CDNBaseUrl(q){h.ScriptBaseUrl=q,h.AssetBaseUrl=q}static set ScriptPreprocessUrl(q){u.d.ScriptPreprocessUrl=q}static get ScriptPreprocessUrl(){return u.d.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return u.d.DefaultRetryStrategy}static set DefaultRetryStrategy(q){u.d.DefaultRetryStrategy=q}static get CorsBehavior(){return u.d.CorsBehavior}static set CorsBehavior(q){u.d.CorsBehavior=q}static get UseFallbackTexture(){return D.c.UseFallbackTexture}static set UseFallbackTexture(q){D.c.UseFallbackTexture=q}static get RegisteredExternalClasses(){return r.d.RegisteredExternalClasses}static set RegisteredExternalClasses(q){r.d.RegisteredExternalClasses=q}static get fallbackTexture(){return D.c.FallbackTexture}static set fallbackTexture(q){D.c.FallbackTexture=q}static FetchToRef(q,c,U,J,Q,s){const g=4*((Math.abs(q)*U%U|0)+(Math.abs(c)*J%J|0)*U);s.r=Q[g]/255,s.g=Q[g+1]/255,s.b=Q[g+2]/255,s.a=Q[g+3]/255}static Mix(q,c,U){return 0}static Instantiate(q){return r.d.Instantiate(q)}static SetImmediate(q){K.c.SetImmediate(q)}static IsExponentOfTwo(q){return!0}static FloatRound(q){return Math.fround(q)}static GetFilename(q){const c=q.lastIndexOf("/");return c<0?q:q.substring(c+1)}static GetFolderPath(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const U=q.lastIndexOf("/");return U<0?c?q:"":q.substring(0,U+1)}static ToDegrees(q){return 180*q/Math.PI}static ToRadians(q){return q*Math.PI/180}static SmoothAngleChange(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const J=this.ToRadians(q),Q=this.ToRadians(c);return this.ToDegrees(Math.atan2((1-U)*Math.sin(Q)+U*Math.sin(J),(1-U)*Math.cos(Q)+U*Math.cos(J)))}static MakeArray(q,c){return!0===c||void 0!==q&&null!=q?Array.isArray(q)?q:[q]:null}static GetPointerPrefix(q){return(0,Q.j)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(q,c){(0,u.z)(q,c)}static SetReferrerPolicyBehavior(q,c){c.referrerPolicy=q}static get PreprocessUrl(){return u.d.PreprocessUrl}static set PreprocessUrl(q){u.d.PreprocessUrl=q}static LoadImage(q,c,U,J,Q,s){return(0,u.s)(q,c,U,J,Q,s)}static LoadFile(q,c,U,J,Q,s){return(0,u.q)(q,c,U,J,Q,s)}static async LoadFileAsync(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return await new Promise(((U,J)=>{(0,u.q)(q,(q=>{U(q)}),void 0,void 0,c,((q,c)=>{J(c)}))}))}static GetAssetUrl(q){if(!q)return"";if(h.AssetBaseUrl&&q.startsWith(h._DefaultAssetsUrl)){const c="/"===h.AssetBaseUrl[h.AssetBaseUrl.length-1]?h.AssetBaseUrl.substring(0,h.AssetBaseUrl.length-1):h.AssetBaseUrl;return q.replace(h._DefaultAssetsUrl,c)}return q}static GetBabylonScriptURL(q,c){if(!q)return"";if(h.ScriptBaseUrl&&q.startsWith(h._DefaultCdnUrl)){const c="/"===h.ScriptBaseUrl[h.ScriptBaseUrl.length-1]?h.ScriptBaseUrl.substring(0,h.ScriptBaseUrl.length-1):h.ScriptBaseUrl;q=q.replace(h._DefaultCdnUrl,c)}return q=h.ScriptPreprocessUrl(q),c&&(q=h.GetAbsoluteUrl(q)),q}static LoadBabylonScript(q,c,U,J){q=h.GetBabylonScriptURL(q),h.LoadScript(q,c,U)}static async LoadBabylonScriptAsync(q){return q=h.GetBabylonScriptURL(q),await h.LoadScriptAsync(q)}static LoadScript(q,c,U,J){let s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(q),c&&c()}catch(n){null===U||void 0===U||U(`Unable to load script '${q}' in worker`,n)}return}if(!(0,Q.j)())return void(null===U||void 0===U||U(`Cannot load script '${q}' outside of a window or a worker`));const g=document.getElementsByTagName("head")[0],X=document.createElement("script");s?(X.setAttribute("type","module"),X.innerText=q):(X.setAttribute("type","text/javascript"),X.setAttribute("src",q)),J&&(X.id=J),X.onload=()=>{c&&c()},X.onerror=c=>{U&&U(`Unable to load script '${q}'`,c)},g.appendChild(X)}static async LoadScriptAsync(q,c){return await new Promise(((U,J)=>{this.LoadScript(q,(()=>{U()}),((q,c)=>{J(c||new Error(q))}),c)}))}static ReadFileAsDataURL(q,c,U){const Q=new FileReader,s={onCompleteObservable:new J.e,abort:()=>Q.abort()};return Q.onloadend=()=>{s.onCompleteObservable.notifyObservers(s)},Q.onload=q=>{c(q.target.result)},Q.onprogress=U,Q.readAsDataURL(q),s}static ReadFile(q,c,U,J,Q){return(0,u.t)(q,c,U,J,Q)}static FileAsURL(q){const c=new Blob([q]);return window.URL.createObjectURL(c)}static Format(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return q.toFixed(c)}static DeepCopy(q,c,U,J){g.e.DeepCopy(q,c,U,J)}static IsEmpty(q){for(const c in q)if(Object.prototype.hasOwnProperty.call(q,c))return!1;return!0}static RegisterTopRootEvents(q,c){for(let J=0;J<c.length;J++){const Q=c[J];q.addEventListener(Q.name,Q.handler,!1);try{window.parent&&window.parent.addEventListener(Q.name,Q.handler,!1)}catch(U){}}}static UnregisterTopRootEvents(q,c){for(let J=0;J<c.length;J++){const Q=c[J];q.removeEventListener(Q.name,Q.handler);try{q.parent&&q.parent.removeEventListener(Q.name,Q.handler)}catch(U){}}}static async DumpFramebuffer(q,c,U,J){throw(0,n.d)("DumpTools")}static DumpData(q,c,U,J){throw(0,n.d)("DumpTools")}static async DumpDataAsync(q,c,U){throw(0,n.d)("DumpTools")}static _IsOffScreenCanvas(q){return void 0!==q.convertToBlob}static ToBlob(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",J=arguments.length>3?arguments[3]:void 0;h._IsOffScreenCanvas(q)||q.toBlob||(q.toBlob=function(q,c,U){setTimeout((()=>{const J=atob(this.toDataURL(c,U).split(",")[1]),Q=J.length,s=new Uint8Array(Q);for(let q=0;q<Q;q++)s[q]=J.charCodeAt(q);q(new Blob([s]))}))}),h._IsOffScreenCanvas(q)?q.convertToBlob({type:U,quality:J}).then((q=>c(q))):q.toBlob((function(q){c(q)}),U,J)}static DownloadBlob(q,c){if("download"in document.createElement("a")){if(!c){const q=new Date;c="screenshot_"+((q.getFullYear()+"-"+(q.getMonth()+1)).slice(2)+"-"+q.getDate()+"_"+q.getHours()+"-"+("0"+q.getMinutes()).slice(-2))+".png"}h.Download(q,c)}else if(q&&"undefined"!==typeof URL){const c=URL.createObjectURL(q),U=window.open("");if(!U)return;const J=U.document.createElement("img");J.onload=function(){URL.revokeObjectURL(c)},J.src=c,U.document.body.appendChild(J)}}static EncodeScreenshotCanvasData(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0;if("string"!==typeof J&&c){if(c){if(h._IsOffScreenCanvas(q))return void q.convertToBlob({type:U,quality:Q}).then((q=>{const U=new FileReader;U.readAsDataURL(q),U.onloadend=()=>{const q=U.result;c(q)}}));const J=q.toDataURL(U,Q);c(J)}}else this.ToBlob(q,(function(q){q&&h.DownloadBlob(q,J),c&&c("")}),U,Q)}static Download(q,c){if("undefined"===typeof URL)return;const U=window.URL.createObjectURL(q),J=document.createElement("a");document.body.appendChild(J),J.style.display="none",J.href=U,J.download=c,J.addEventListener("click",(()=>{J.parentElement&&J.parentElement.removeChild(J)})),J.click(),window.URL.revokeObjectURL(U)}static BackCompatCameraNoPreventDefault(q){return"boolean"===typeof q[0]?q[0]:"boolean"===typeof q[1]&&q[1]}static CreateScreenshot(q,c,U,J){throw(0,n.d)("ScreenshotTools")}static async CreateScreenshotAsync(q,c,U){throw(0,n.d)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(q,c,U,J){throw(0,n.d)("ScreenshotTools")}static async CreateScreenshotUsingRenderTargetAsync(q,c,U){throw(0,n.d)("ScreenshotTools")}static RandomId(){return(0,H.b)()}static IsBase64(q){return(0,u.i)(q)}static DecodeBase64(q){return(0,u.c)(q)}static get errorsCount(){return s.c.errorsCount}static Log(q){s.c.Log(q)}static Warn(q){s.c.Warn(q)}static Error(q){s.c.Error(q)}static get LogCache(){return s.c.LogCache}static ClearLogCache(){s.c.ClearLogCache()}static set LogLevels(q){s.c.LogLevels=q}static set PerformanceLogLevel(q){return(q&h.PerformanceUserMarkLogLevel)===h.PerformanceUserMarkLogLevel?(h.StartPerformanceCounter=h._StartUserMark,void(h.EndPerformanceCounter=h._EndUserMark)):(q&h.PerformanceConsoleLogLevel)===h.PerformanceConsoleLogLevel?(h.StartPerformanceCounter=h._StartPerformanceConsole,void(h.EndPerformanceCounter=h._EndPerformanceConsole)):(h.StartPerformanceCounter=h._StartPerformanceCounterDisabled,void(h.EndPerformanceCounter=h._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(q,c){}static _EndPerformanceCounterDisabled(q,c){}static _StartUserMark(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!h._Performance){if(!(0,Q.j)())return;h._Performance=window.performance}c&&h._Performance.mark&&h._Performance.mark(q+"-Begin")}static _EndUserMark(q){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&h._Performance.mark&&(h._Performance.mark(q+"-End"),h._Performance.measure(q,q+"-Begin",q+"-End"))}static _StartPerformanceConsole(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c&&(h._StartUserMark(q,c),console.time&&console.time(q))}static _EndPerformanceConsole(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];c&&(h._EndUserMark(q,c),console.timeEnd(q))}static get Now(){return X.d.Now}static GetClassName(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=null;if(!c&&q.getClassName)U=q.getClassName();else{if(q instanceof Object){U=(c?q:Object.getPrototypeOf(q)).constructor.__bjsclassName__}U||(U=typeof q)}return U}static First(q,c){for(const U of q)if(c(U))return U;return null}static getFullClassName(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=null,J=null;if(!c&&q.getClassName)U=q.getClassName();else{if(q instanceof Object){const Q=c?q:Object.getPrototypeOf(q);U=Q.constructor.__bjsclassName__,J=Q.constructor.__bjsmoduleName__}U||(U=typeof q)}return U?(null!=J?J+".":"")+U:null}static async DelayAsync(q){await new Promise((c=>{setTimeout((()=>{c()}),q)}))}static IsSafari(){return!!(0,Q.g)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}h.AssetBaseUrl="",h.UseCustomRequestHeaders=!1,h.CustomRequestHeaders=W.d.CustomRequestHeaders,h.GetDOMTextContent=Q.b,h._DefaultCdnUrl="https://cdn.babylonjs.com",h._DefaultAssetsUrl="https://assets.babylonjs.com/core",h.GetAbsoluteUrl="object"===typeof document?q=>{const c=document.createElement("a");return c.href=q,c.href}:"function"===typeof URL&&"object"===typeof location?q=>new URL(q,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},h.NoneLogLevel=s.c.NoneLogLevel,h.MessageLogLevel=s.c.MessageLogLevel,h.WarningLogLevel=s.c.WarningLogLevel,h.ErrorLogLevel=s.c.ErrorLogLevel,h.AllLogLevel=s.c.AllLogLevel,h.IsWindowObjectExist=Q.j,h.PerformanceNoneLogLevel=0,h.PerformanceUserMarkLogLevel=1,h.PerformanceConsoleLogLevel=2,h.StartPerformanceCounter=h._StartPerformanceCounterDisabled,h.EndPerformanceCounter=h._EndPerformanceCounterDisabled;class o{constructor(q,c,U){let J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=q,this.index=J-1,this._done=!1,this._fn=c,this._successCallback=U}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(q,c,U){const J=new o(q,c,U,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return J.executeNext(),J}static SyncAsyncForLoop(q,c,U,J,Q){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return o.Run(Math.ceil(q/c),(J=>{Q&&Q()?J.breakLoop():setTimeout((()=>{for(let s=0;s<c;++s){const g=J.index*c+s;if(g>=q)break;if(U(g),Q&&Q()){J.breakLoop();break}}J.executeNext()}),s)}),J)}}h.Mix=b.l,h.IsExponentOfTwo=b.j,D.c.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10850:(q,c,U)=>{U.d(c,{d:()=>s,f:()=>Q});const J={};function Q(q,c){J[q]=c}function s(q){return J[q]}},11414:(q,c,U)=>{U.d(c,{d:()=>J});class J{static get UniqueId(){const q=this._UniqueIdCounter;return this._UniqueIdCounter++,q}}J._UniqueIdCounter=1},10913:(q,c,U)=>{U.d(c,{d:()=>J});class J{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(J.CustomRequestHeaders).length>0||J.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const q in J.CustomRequestHeaders){const c=J.CustomRequestHeaders[q];c&&this._xhr.setRequestHeader(q,c)}}_shouldSkipRequestModifications(q){return J.SkipRequestModificationForBabylonCDN&&(q.includes("preview.babylonjs.com")||q.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(q){this._xhr.onprogress=q}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(q){this._xhr.responseType=q}get timeout(){return this._xhr.timeout}set timeout(q){this._xhr.timeout=q}addEventListener(q,c,U){this._xhr.addEventListener(q,c,U)}removeEventListener(q,c,U){this._xhr.removeEventListener(q,c,U)}abort(){this._xhr.abort()}send(q){J.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(q)}open(q,c){for(const U of J.CustomRequestModifiers){if(this._shouldSkipRequestModifications(c))return;c=U(this._xhr,c)||c}c=(c=c.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=c,this._xhr.open(q,c,!0)}setRequestHeader(q,c){this._xhr.setRequestHeader(q,c)}getResponseHeader(q){return this._xhr.getResponseHeader(q)}}J.CustomRequestHeaders={},J.CustomRequestModifiers=new Array,J.SkipRequestModificationForBabylonCDN=!0},11526:(q,c,U)=>{U.d(c,{c:()=>Q});class J{constructor(q){this._pendingActions=new Array,this._workerInfos=q.map((q=>({workerPromise:Promise.resolve(q),idle:!0})))}dispose(){for(const q of this._workerInfos)q.workerPromise.then((q=>{q.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(q){this._executeOnIdleWorker(q)||this._pendingActions.push(q)}_executeOnIdleWorker(q){for(const c of this._workerInfos)if(c.idle)return this._execute(c,q),!0;return!1}_execute(q,c){q.idle=!1,q.workerPromise.then((U=>{c(U,(()=>{const c=this._pendingActions.shift();c?this._execute(q,c):q.idle=!0}))}))}}class Q extends J{constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Q.DefaultOptions;super([]),this._maxWorkers=q,this._createWorkerAsync=c,this._options=U}push(q){if(!this._executeOnIdleWorker(q))if(this._workerInfos.length<this._maxWorkers){const c={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(c),this._execute(c,q)}else this._pendingActions.push(q)}_execute(q,c){q.timeoutId&&(clearTimeout(q.timeoutId),delete q.timeoutId),super._execute(q,((U,J)=>{c(U,(()=>{J(),q.idle&&(q.timeoutId=setTimeout((()=>{q.workerPromise.then((q=>{q.terminate()}));const c=this._workerInfos.indexOf(q);-1!==c&&this._workerInfos.splice(c,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}Q.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11481:(q,c,U)=>{U.d(c,{c:()=>D});var J=U(11010),Q=U(10866),s=U(10864),g=U(11031),X=U(11019),n=U(11082),W=U(10850);class D{get influence(){return this._influence}set influence(q){if(this._influence===q)return;const c=this._influence;this._influence=q,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===c||0===q)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=q,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uv2s=null,this._colors=null,this._uniqueId=0,this.onInfluenceChanged=new Q.e,this._onDataLayoutChanged=new Q.e,this._animationPropertiesOverride=null,this.id=q,this._scene=U||s.c.LastCreatedScene,this.influence=c,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}get hasUV2s(){return!!this._uv2s}get hasColors(){return!!this._colors}get vertexCount(){return this._positions?this._positions.length/3:this._normals?this._normals.length/3:this._tangents?this._tangents.length/3:this._uvs?this._uvs.length/2:this._uv2s?this._uv2s.length/2:this._colors?this._colors.length/4:0}setPositions(q){const c=this.hasPositions;this._positions=q,c!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(q){const c=this.hasNormals;this._normals=q,c!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(q){const c=this.hasTangents;this._tangents=q,c!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(q){const c=this.hasUVs;this._uvs=q,c!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}setUV2s(q){const c=this.hasUV2s;this._uv2s=q,c!==this.hasUV2s&&this._onDataLayoutChanged.notifyObservers(void 0)}getUV2s(){return this._uv2s}setColors(q){const c=this.hasColors;this._colors=q,c!==this.hasColors&&this._onDataLayoutChanged.notifyObservers(void 0)}getColors(){return this._colors}clone(){const q=n.e.Clone((()=>new D(this.name,this.influence,this._scene)),this);return q._positions=this._positions,q._normals=this._normals,q._tangents=this._tangents,q._uvs=this._uvs,q._uv2s=this._uv2s,q._colors=this._colors,q}serialize(){const q={};return q.name=this.name,q.influence=this.influence,q.Fq=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(q.id=this.id),this.hasNormals&&(q.vq=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(q.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(q.kq=Array.prototype.slice.call(this.getUVs())),this.hasUV2s&&(q.uv2s=Array.prototype.slice.call(this.getUV2s())),this.hasColors&&(q.Yq=Array.prototype.slice.call(this.getColors())),n.e.AppendSerializedAnimations(this,q),q}getClassName(){return"MorphTarget"}static Parse(q,c){const U=new D(q.name,q.influence);if(U.setPositions(q.Fq),null!=q.id&&(U.id=q.id),q.vq&&U.setNormals(q.vq),q.tangents&&U.setTangents(q.tangents),q.kq&&U.setUVs(q.kq),q.uv2s&&U.setUV2s(q.uv2s),q.Yq&&U.setColors(q.Yq),q.animations){for(let c=0;c<q.animations.length;c++){const J=q.animations[c],Q=(0,W.d)("BABYLON.Animation");Q&&U.animations.push(Q.Parse(J))}q.autoAnimate&&c&&c.beginAnimation(U,q.autoAnimateFrom,q.autoAnimateTo,q.autoAnimateLoop,q.autoAnimateSpeed||1)}return U}static FromMesh(q,c,U){c||(c=q.name);const J=new D(c,U,q.Cq());return J.setPositions(q.getVerticesData(g.h.PositionKind)),q.isVerticesDataPresent(g.h.NormalKind)&&J.setNormals(q.getVerticesData(g.h.NormalKind)),q.isVerticesDataPresent(g.h.TangentKind)&&J.setTangents(q.getVerticesData(g.h.TangentKind)),q.isVerticesDataPresent(g.h.UVKind)&&J.setUVs(q.getVerticesData(g.h.UVKind)),q.isVerticesDataPresent(g.h.UV2Kind)&&J.setUV2s(q.getVerticesData(g.h.UV2Kind)),q.isVerticesDataPresent(g.h.ColorKind)&&J.setColors(q.getVerticesData(g.h.ColorKind)),J}}(0,J.d)([(0,X.N)()],D.prototype,"id",void 0)},11309:(q,c,U)=>{U.d(c,{b:()=>H});var J=U(11010),Q=U(11156),s=U(10866),g=U(10833),X=U(10956),n=U(11019),W=U(11082),D=U(10850),u=U(10954),K=U(11002),r=U(11312);u.d.prototype.setTextureFromPostProcess=function(q,c,U){var J;let Q=null;c&&(c._forcedOutputTexture?Q=c._forcedOutputTexture:c._textures.data[c._currentRenderTextureInd]&&(Q=c._textures.data[c._currentRenderTextureInd])),this._bindTexture(q,(null===(J=Q)||void 0===J?void 0:J.texture)??null,U)},u.d.prototype.setTextureFromPostProcessOutput=function(q,c,U){var J;this._bindTexture(q,(null===c||void 0===c||null===(J=c._outputTexture)||void 0===J?void 0:J.texture)??null,U)},X.b.prototype.setTextureFromPostProcess=function(q,c){this._engine.setTextureFromPostProcess(this._samplers[q],c,q)},X.b.prototype.setTextureFromPostProcessOutput=function(q,c){this._engine.setTextureFromPostProcessOutput(this._samplers[q],c,q)};class H{static get ForceGLSL(){return r.i.ForceGLSL}static set ForceGLSL(q){r.i.ForceGLSL=q}static RegisterShaderCodeProcessing(q,c){r.i.RegisterShaderCodeProcessing(q,c)}get name(){return this._effectWrapper.name}set name(q){this._effectWrapper.name=q}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(q){this._effectWrapper.alphaMode=q}get samples(){return this._samples}set samples(q){this._samples=Math.min(q,this._engine.getCaps().maxMSAASamples),this._textures.forEach((q=>{q.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(q){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),q&&(this._onActivateObserver=this.onActivateObservable.add(q))}set onSizeChanged(q){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(q)}set onApply(q){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(q)}set onBeforeRender(q){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(q)}set onAfterRender(q){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(q)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(q){this._forcedOutputTexture=q}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.bc(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(q,c,U,J,X,n){var W;let D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=arguments.length>7?arguments[7]:void 0,K=arguments.length>8?arguments[8]:void 0,b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,o=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",a=arguments.length>12?arguments[12]:void 0,p=arguments.length>13&&void 0!==arguments[13]&&arguments[13],R=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,I=arguments.length>15?arguments[15]:void 0,t=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Gu=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new Q.g(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new g.l(1,1),this._texelSize=g.l.Zero(),this.onActivateObservable=new s.e,this.onSizeChangedObservable=new s.e,this.onApplyObservable=new s.e,this.onBeforeRenderObservable=new s.e,this.onAfterRenderObservable=new s.e,this.Cc=new s.e;let C,i=1,F=null;if(U&&!Array.isArray(U)){const q=U;U=q.uniforms??null,J=q.samplers??null,i=q.size??1,n=q.camera??null,D=q.samplingMode??1,u=q.yX,K=q.reusable,b=Array.isArray(q.defines)?q.defines.join("\n"):q.defines??null,h=q.textureType??0,o=q.vertexUrl??"postprocess",a=q.indexParameters,p=q.blockCompilation??!1,R=q.textureFormat??5,I=q.shaderLanguage??0,F=q.uniformBuffers??null,t=q.extraInitializations,C=q.effectWrapper}else X&&(i="number"===typeof X?X:{width:X.width,height:X.height});if(this._useExistingThinPostProcess=!!C,this._effectWrapper=C??new r.i({name:q,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:c,yX:u||(null===(W=n)||void 0===W?void 0:W.Cq().getEngine()),uniforms:U,samplers:J,uniformBuffers:F,defines:b,vertexUrl:o,indexParameters:a,blockCompilation:!0,shaderLanguage:I,extraInitializations:void 0}),this.name=q,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=n?(this._camera=n,this._scene=n.Cq(),n.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):u&&(this._engine=u,this._engine.postProcesses.push(this)),this._options=i,this.renderTargetSamplingMode=D||1,this._reusable=K||!1,this._textureType=h,this._textureFormat=R,this._shaderLanguage=I||0,this._samplers=J||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=c,this._vertexUrl=o,this._parameters=U||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=F||[],this._indexParameters=a,!this._useExistingThinPostProcess){this._webGPUReady=1===this._shaderLanguage;const q=[];this._gatherImports(this._engine.isWebGPU&&!H.ForceGLSL,q),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(p,b,t,q)}}_gatherImports(){let q=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?q.push(Promise.all([U.e(42).then(U.bind(U,13448))])):q.push(Promise.all([Promise.resolve().then(U.bind(U,11319))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(q){return this._disposeTextures(),this._shareOutputWithPostProcess=q,this}useOwnOutput(){0==this._textures.length&&(this._textures=new Q.g(2)),this._shareOutputWithPostProcess=null}updateEffect(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3?arguments[3]:void 0,Q=arguments.length>4?arguments[4]:void 0,s=arguments.length>5?arguments[5]:void 0,g=arguments.length>6?arguments[6]:void 0,X=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(q,c,U,J,Q,s,g,X),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let Q=0;Q<this._textureCache.length;Q++)if(this._textureCache[Q].texture.width===q.width&&this._textureCache[Q].texture.height===q.height&&this._textureCache[Q].postProcessChannel===U&&this._textureCache[Q].texture._generateDepthBuffer===c.generateDepthBuffer&&this._textureCache[Q].texture.samples===c.samples)return this._textureCache[Q].texture;const J=this._engine.createRenderTargetTexture(q,c);return this._textureCache.push({texture:J,postProcessChannel:U,lastUsedRenderId:-1}),J}_flushTextureCache(){const q=this._renderId;for(let c=this._textureCache.length-1;c>=0;c--)if(q-this._textureCache[c].lastUsedRenderId>100){let q=!1;for(let U=0;U<this._textures.length;U++)if(this._textures.data[U]===this._textureCache[c].texture){q=!0;break}q||(this._textureCache[c].texture.dispose(),this._textureCache.splice(c,1))}}resize(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=q,this.height=c;let s=null;if(U)for(let n=0;n<U._postProcesses.length;n++)if(null!==U._postProcesses[n]){s=U._postProcesses[n];break}const g={width:this.width,height:this.height},X={generateMipMaps:J,generateDepthBuffer:Q||s===this,generateStencilBuffer:(Q||s===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(g,X,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(g,X,1)),this._texelSize.bc(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let q;if(this._shareOutputWithPostProcess)q=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)q=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let c;q=this.inputTexture;for(let U=0;U<this._textureCache.length;U++)if(this._textureCache[U].texture===q){c=this._textureCache[U];break}c&&(c.lastUsedRenderId=this._renderId)}return q}activate(q){var c,U;let J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,Q=arguments.length>2?arguments[2]:void 0;const s=null===q||void 0!==q.cameraRigMode?q||this._camera:null,g=(null===s||void 0===s?void 0:s.Cq())??q,X=g.getEngine(),n=X.getCaps().maxTextureSize,W=(J?J.width:this._engine.getRenderWidth(!0))*this._options|0,D=(J?J.height:this._engine.getRenderHeight(!0))*this._options|0;let u=this._options.width||W,r=this._options.height||D;const H=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let b=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const q=X.currentViewport;q&&(u*=q.width,r*=q.height)}(H||this.alwaysForcePOT)&&(this._options.width||(u=X.needPOTTextures?(0,K.h)(u,n,this.scaleMode):u),this._options.height||(r=X.needPOTTextures?(0,K.h)(r,n,this.scaleMode):r)),this.width===u&&this.height===r&&(b=this._getTarget())||this.resize(u,r,s,H,Q),this._textures.forEach((q=>{q.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(q,this.samples)})),this._flushTextureCache(),this._renderId++}return b||(b=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.bc(W/u,D/r),this._engine.bindFramebuffer(b,0,W,D,this.forceFullscreenViewport)):(this._scaleRatio.bc(1,1),this._engine.bindFramebuffer(b,0,void 0,void 0,this.forceFullscreenViewport)),null===(c=(U=this._engine)._debugInsertMarker)||void 0===c||c.call(U,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(s),this.Gu&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:g.clearColor,g._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),b}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let q;var c;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),this._engine.setAlphaMode(this.alphaMode),q=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(c=q)||void 0===c?void 0:c.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(!0),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let q=this._textureCache.length-1;q>=0;q--)this._textureCache[q].texture.dispose();this._textureCache.length=0}setPrePassRenderer(q){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=q.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(q){let c;if(q=q||this._camera,this._useExistingThinPostProcess||this._effectWrapper.dispose(),this._disposeTextures(),this._scene&&(c=this._scene.postProcesses.indexOf(this),-1!==c&&this._scene.postProcesses.splice(c,1)),this._parentContainer){const q=this._parentContainer.postProcesses.indexOf(this);q>-1&&this._parentContainer.postProcesses.splice(q,1),this._parentContainer=null}if(c=this._engine.postProcesses.indexOf(this),-1!==c&&this._engine.postProcesses.splice(c,1),this.Cc.notifyObservers(),q){if(q.detachPostProcess(this),c=q._postProcesses.indexOf(this),0===c&&q._postProcesses.length>0){const q=this._camera._getFirstPostProcess();q&&q.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const q=W.e.Serialize(this),c=this.getCamera()||this._scene&&this._scene.activeCamera;return q.customType="BABYLON."+this.getClassName(),q.cameraId=c?c.id:null,q.reusable=this._reusable,q.textureType=this._textureType,q.fragmentUrl=this._fragmentUrl,q.parameters=this._parameters,q.samplers=this._samplers,q.uniformBuffers=this._uniformBuffers,q.options=this._options,q.defines=this._postProcessDefines,q.textureFormat=this._textureFormat,q.vertexUrl=this._vertexUrl,q.indexParameters=this._indexParameters,q}clone(){const q=this.serialize();q._engine=this._engine,q.cameraId=null;const c=H.Parse(q,this._scene,"");return c?(c.onActivateObservable=this.onActivateObservable.clone(),c.onSizeChangedObservable=this.onSizeChangedObservable.clone(),c.onApplyObservable=this.onApplyObservable.clone(),c.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),c.onAfterRenderObservable=this.onAfterRenderObservable.clone(),c._prePassEffectConfiguration=this._prePassEffectConfiguration,c):null}static Parse(q,c,U){const J=(0,D.d)(q.customType);if(!J||!J._Parse)return null;const Q=c?c.getCameraById(q.cameraId):null;return J._Parse(q,Q,c,U)}static _Parse(q,c,U,J){return W.e.Parse((()=>new H(q.name,q.fragmentUrl,q.parameters,q.samplers,q.options,c,q.renderTargetSamplingMode,q._engine,q.reusable,q.defines,q.textureType,q.vertexUrl,q.indexParameters,!1,q.textureFormat)),q,U,J)}}(0,J.d)([(0,n.N)()],H.prototype,"uniqueId",void 0),(0,J.d)([(0,n.N)()],H.prototype,"name",null),(0,J.d)([(0,n.N)()],H.prototype,"width",void 0),(0,J.d)([(0,n.N)()],H.prototype,"height",void 0),(0,J.d)([(0,n.N)()],H.prototype,"renderTargetSamplingMode",void 0),(0,J.d)([(0,n.m)()],H.prototype,"clearColor",void 0),(0,J.d)([(0,n.N)()],H.prototype,"Gu",void 0),(0,J.d)([(0,n.N)()],H.prototype,"forceAutoClearInAlphaMode",void 0),(0,J.d)([(0,n.N)()],H.prototype,"alphaMode",null),(0,J.d)([(0,n.N)()],H.prototype,"alphaConstants",void 0),(0,J.d)([(0,n.N)()],H.prototype,"enablePixelPerfectMode",void 0),(0,J.d)([(0,n.N)()],H.prototype,"forceFullscreenViewport",void 0),(0,J.d)([(0,n.N)()],H.prototype,"scaleMode",void 0),(0,J.d)([(0,n.N)()],H.prototype,"alwaysForcePOT",void 0),(0,J.d)([(0,n.N)("samples")],H.prototype,"_samples",void 0),(0,J.d)([(0,n.N)()],H.prototype,"adaptScaleToCurrentViewport",void 0),(0,D.f)("BABYLON.PostProcess",H)},11303:(q,c,U)=>{U.d(c,{d:()=>s});var J=U(11031),Q=U(10866);class s{constructor(q){this._vertexBuffers={},this.onBeforeRenderObservable=new Q.e,this._scene=q}_prepareBuffers(){if(this._vertexBuffers[J.h.PositionKind])return;const q=[];q.push(1,1),q.push(-1,1),q.push(-1,-1),q.push(1,-1),this._vertexBuffers[J.h.PositionKind]=new J.h(this._scene.getEngine(),q,J.h.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const q=[];q.push(0),q.push(1),q.push(2),q.push(0),q.push(2),q.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(q)}_rebuild(){const q=this._vertexBuffers[J.h.PositionKind];q&&(q._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const U=this._scene.activeCamera;return!!U&&(c=c||U._postProcesses.filter((q=>null!=q)),!(!c||0===c.length||!this._scene.postProcessesEnabled)&&(c[0].activate(U,q,null!==c&&void 0!==c),!0))}directRender(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,Q=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5&&void 0!==arguments[5]&&arguments[5],g=arguments.length>6&&void 0!==arguments[6]?arguments[6]:q.length;const X=this._scene.getEngine();for(let W=0;W<g;W++){var n;if(W<q.length-1)q[W+1].activate(this._scene.activeCamera||this._scene,null===c||void 0===c?void 0:c.texture);else c?X.bindFramebuffer(c,J,void 0,void 0,U,Q):s||X.restoreDefaultFramebuffer(),null===(n=X._debugInsertMarker)||void 0===n||n.call(X,`post process ${q[W].name} output`);const g=q[W],D=g.apply();D&&(g.onBeforeRenderObservable.notifyObservers(D),this._prepareBuffers(),X.bindBuffers(this._vertexBuffers,this._indexBuffer,D),X.drawElementsType(0,0,6),g.onAfterRenderObservable.notifyObservers(D))}X.setDepthBuffer(!0),X.setDepthWrite(!0)}_finalizeFrame(q,c,U,J){let Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=this._scene.activeCamera;if(!s)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(J=J||s._postProcesses.filter((q=>null!=q))).length||!this._scene.postProcessesEnabled)return;const g=this._scene.getEngine();for(let n=0,W=J.length;n<W;n++){const D=J[n];var X;if(n<W-1)D._outputTexture=J[n+1].activate(s,null===c||void 0===c?void 0:c.texture);else c?(g.bindFramebuffer(c,U,void 0,void 0,Q),D._outputTexture=c):(g.restoreDefaultFramebuffer(),D._outputTexture=null),null===(X=g._debugInsertMarker)||void 0===X||X.call(g,`post process ${J[n].name} output`);if(q)break;const u=D.apply();u&&(D.onBeforeRenderObservable.notifyObservers(u),this._prepareBuffers(),g.bindBuffers(this._vertexBuffers,this._indexBuffer,u),g.drawElementsType(0,0,6),D.onAfterRenderObservable.notifyObservers(u))}g.setDepthBuffer(!0),g.setDepthWrite(!0),g.setAlphaMode(0)}dispose(){const q=this._vertexBuffers[J.h.PositionKind];q&&(q.dispose(),this._vertexBuffers[J.h.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11305:(q,c,U)=>{U.d(c,{d:()=>X});var J=U(11156),Q=U(10833);class s{set opaqueSortCompareFn(q){this._opaqueSortCompareFn=q||s.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(q){this._alphaTestSortCompareFn=q||s.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(q){this._transparentSortCompareFn=q||s.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Q=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=q,this._opaqueSubMeshes=new J.g(256),this._transparentSubMeshes=new J.g(256),this._alphaTestSubMeshes=new J.g(256),this._depthOnlySubMeshes=new J.g(256),this._particleSystems=new J.g(256),this._spriteManagers=new J.g(256),this._empty=!0,this._edgesRenderers=new J.e(16),this._scene=c,this.opaqueSortCompareFn=U,this.alphaTestSortCompareFn=Q,this.transparentSortCompareFn=s}render(q,c,U,J){if(q)return void q(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const Q=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(Q.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),Q.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const s=Q.getStencilBuffer();if(Q.setStencilBuffer(!1),c&&this._renderSprites(),U&&this._renderParticles(J),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(Q.setStencilBuffer(s),this._scene.useOrderIndependentTransparency){const q=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);q.length&&this._renderTransparent(q)}else this._renderTransparent(this._transparentSubMeshes);Q.setAlphaMode(0)}if(Q.setStencilBuffer(!1),this._edgesRenderers.length){for(let q=0;q<this._edgesRenderers.length;q++)this._edgesRenderers.data[q].render();Q.setAlphaMode(0)}Q.setStencilBuffer(s)}_renderOpaqueSorted(q){s._RenderSorted(q,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(q){s._RenderSorted(q,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(q){s._RenderSorted(q,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(q,c,U,J){let g,X=0;const n=U?U.globalPosition:s._ZeroVector;if(J)for(;X<q.length;X++)g=q.data[X],g._alphaIndex=g.getMesh().alphaIndex,g._distanceToCamera=Q.p.Distance(g.getBoundingInfo().boundingSphere.centerWorld,n);const W=q.length===q.data.length?q.data:q.data.slice(0,q.length);c&&W.sort(c);const D=W[0].getMesh().Cq();for(X=0;X<W.length;X++)if(g=W[X],!D._activeMeshesFrozenButKeepClipping||g.isInFrustum(D._frustumPlanes)){if(J){const q=g.zq();if(q&&q.needDepthPrePass){const c=q.Cq().getEngine();c.setColorWrite(!1),c.setAlphaMode(0),g.render(!1),c.setColorWrite(!0)}}g.render(J)}}static defaultTransparentSortCompare(q,c){return q._alphaIndex>c._alphaIndex?1:q._alphaIndex<c._alphaIndex?-1:s.backToFrontSortCompare(q,c)}static backToFrontSortCompare(q,c){return q._distanceToCamera<c._distanceToCamera?1:q._distanceToCamera>c._distanceToCamera?-1:0}static frontToBackSortCompare(q,c){return q._distanceToCamera<c._distanceToCamera?-1:q._distanceToCamera>c._distanceToCamera?1:0}static PainterSortCompare(q,c){const U=q.getMesh(),J=c.getMesh();return U.material&&J.material?U.material.uniqueId-J.material.uniqueId:U.uniqueId-J.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(q,c,U){void 0===c&&(c=q.getMesh()),void 0===U&&(U=q.zq()),null!==U&&void 0!==U&&(U.needAlphaBlendingForMesh(c)?this._transparentSubMeshes.push(q):U.needAlphaTestingForMesh(c)?(U.needDepthPrePass&&this._depthOnlySubMeshes.push(q),this._alphaTestSubMeshes.push(q)):(U.needDepthPrePass&&this._depthOnlySubMeshes.push(q),this._opaqueSubMeshes.push(q)),c._renderingGroup=this,c._edgesRenderer&&c.isEnabled()&&c.isVisible&&c._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(c._edgesRenderer),this._empty=!1)}dispatchSprites(q){this._spriteManagers.push(q),this._empty=!1}dispatchParticles(q){this._particleSystems.push(q),this._empty=!1}_renderParticles(q){if(0===this._particleSystems.length)return;const c=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let U=0;U<this._particleSystems.length;U++){const J=this._particleSystems.data[U];if(0===(c&&c.layerMask&J.layerMask))continue;const Q=J.j;Q.position&&q&&-1===q.indexOf(Q)||this._scene._activeParticles.addCount(J.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const q=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let c=0;c<this._spriteManagers.length;c++){const U=this._spriteManagers.data[c];0!==(q&&q.layerMask&U.layerMask)&&U.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}s._ZeroVector=Q.p.Zero();class g{}class X{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(q){q!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=q,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const q of this._scene.meshes)if(q.Gc)for(const c of q.Gc)c._wasDispatched=!1;if(this._scene.spriteManagers)for(const q of this._scene.spriteManagers)q._wasDispatched=!1;for(const q of this._scene.qK)q._wasDispatched=!1}constructor(q){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new g,this._maintainStateBetweenFrames=!1,this._scene=q;for(let c=X.MIN_RENDERINGGROUPS;c<X.MAX_RENDERINGGROUPS;c++)this._autoClearDepthStencil[c]={Gu:!0,depth:!0,stencil:!0}}getRenderingGroup(q){const c=q||0;return this._prepareRenderingGroup(c),this._renderingGroups[c]}_clearDepthStencilBuffer(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,q,c),this._depthStencilBufferAlreadyCleaned=!0)}render(q,c,U,J){const Q=this._renderingGroupInfo;if(Q.mc=this._scene,Q.camera=this._scene.activeCamera,Q.renderingManager=this,this._scene.spriteManagers&&J)for(let s=0;s<this._scene.spriteManagers.length;s++){const q=this._scene.spriteManagers[s];this.dispatchSprites(q)}for(let s=X.MIN_RENDERINGGROUPS;s<X.MAX_RENDERINGGROUPS;s++){this._depthStencilBufferAlreadyCleaned=s===X.MIN_RENDERINGGROUPS;const g=this._renderingGroups[s];if(!g||g._empty)continue;const n=1<<s;if(Q.renderingGroupId=s,this._scene.onBeforeRenderingGroupObservable.notifyObservers(Q,n),X.AUTOCLEAR){const q=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(s):this._autoClearDepthStencil[s];q&&q.Gu&&this._clearDepthStencilBuffer(q.depth,q.stencil)}for(const q of this._scene._beforeRenderingGroupDrawStage)q.action(s);g.render(q,J,U,c);for(const q of this._scene._afterRenderingGroupDrawStage)q.action(s);this._scene.onAfterRenderingGroupObservable.notifyObservers(Q,n)}}reset(){if(!this.maintainStateBetweenFrames)for(let q=X.MIN_RENDERINGGROUPS;q<X.MAX_RENDERINGGROUPS;q++){const c=this._renderingGroups[q];c&&c.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let q=X.MIN_RENDERINGGROUPS;q<X.MAX_RENDERINGGROUPS;q++){const c=this._renderingGroups[q];c&&c.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let q=X.MIN_RENDERINGGROUPS;q<X.MAX_RENDERINGGROUPS;q++){const c=this._renderingGroups[q];c&&c.dispose()}}_prepareRenderingGroup(q){void 0===this._renderingGroups[q]&&(this._renderingGroups[q]=new s(q,this._scene,this._customOpaqueSortCompareFn[q],this._customAlphaTestSortCompareFn[q],this._customTransparentSortCompareFn[q]))}dispatchSprites(q){this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatchSprites(q))}dispatchParticles(q){this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(q.renderingGroupId).dispatchParticles(q))}dispatch(q,c,U){void 0===c&&(c=q.getMesh()),this.maintainStateBetweenFrames&&q._wasDispatched||(q._wasDispatched=!0,this.getRenderingGroup(c.renderingGroupId).dispatch(q,c,U))}setRenderingOrder(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[q]=c,this._customAlphaTestSortCompareFn[q]=U,this._customTransparentSortCompareFn[q]=J,this._renderingGroups[q]){const c=this._renderingGroups[q];c.opaqueSortCompareFn=this._customOpaqueSortCompareFn[q],c.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[q],c.transparentSortCompareFn=this._customTransparentSortCompareFn[q]}}setRenderingAutoClearDepthStencil(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[q]={Gu:c,depth:U,stencil:J}}getAutoClearDepthStencilSetup(q){return this._autoClearDepthStencil[q]}}X.MAX_RENDERINGGROUPS=4,X.MIN_RENDERINGGROUPS=0,X.AUTOCLEAR=!0},11319:(q,c,U)=>{U.r(c),U.d(c,{postprocessVertexShader:()=>g});var J=U(10961);const Q="postprocessVertexShader",s="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";J.c.ShadersStore[Q]||(J.c.ShadersStore[Q]=s);const g={name:Q,shader:s}},11407:(q,c,U)=>{U.d(c,{b:()=>J});class J{}J._IsPickingAvailable=!1},11113:(q,c,U)=>{U.d(c,{b:()=>u});var J=U(11010),Q=U(10833),s=U(11019),g=U(10866),X=U(10864),n=U(10910),W=U(11082);class D{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new g.e,this._onClonedObservable=new g.e}}class u{static AddNodeConstructor(q,c){this._NodeConstructors[q]=c}static Construct(q,c,U,J){const Q=this._NodeConstructors[q];return Q?Q(c,U,J):null}set accessibilityTag(q){this._accessibilityTag=q,this.onAccessibilityTagChangedObservable.notifyObservers(q)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(q){this._nodeDataStorage._doNotSerialize=q}u(){return this._nodeDataStorage._isDisposed}set parent(q){if(this._parentNode===q)return;const c=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const c=this._parentNode._children.indexOf(this);-1!==c&&this._parentNode._children.splice(c,1),q||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=q,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),c||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(q){q.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const q=this._scene.rootNodes,c=q.length-1;q[this._nodeDataStorage._sceneRootNodesIndex]=q[c],q[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}getClassName(){return"Node"}set onDispose(q){this._onDisposeObserver&&this.Cc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Cc.add(q)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new D,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new g.e,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=Q.d.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Cc=new g.e,this._onDisposeObserver=null,this._behaviors=new Array,this.name=q,this.id=q,this._scene=c||X.c.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),U&&this._addToSceneRootNodes()}Cq(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(q)||(q.init(),this._scene.isLoading&&!c?this._scene.onDataLoadedObservable.addOnce((()=>{q.attach(this)})):q.attach(this),this._behaviors.push(q)),this}removeBehavior(q){const c=this._behaviors.indexOf(q);return-1===c||(this._behaviors[c].detach(),this._behaviors.splice(c,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(q){for(const c of this._behaviors)if(c.name===q)return c;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.o(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(q){!q&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(q){return this.parent?this.parent._getActionManagerForTrigger(q,!1):null}_updateCache(q){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}PW(q){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){if(this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children)for(const q of this._children)q._syncParentEnabledState()}LX(q){this._nodeDataStorage._isEnabled!==q&&(this._nodeDataStorage._isEnabled=q,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(q))}isDescendantOf(q){return!!this.parent&&(this.parent===q||this.parent.isDescendantOf(q))}_getDescendants(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1],U=arguments.length>2?arguments[2]:void 0;if(this._children)for(let J=0;J<this._children.length;J++){const Q=this._children[J];U&&!U(Q)||q.push(Q),c||Q._getDescendants(q,!1,U)}}getDescendants(q,c){const U=[];return this._getDescendants(U,q,c),U}getChildMeshes(q,c){const U=[];return this._getDescendants(U,q,(q=>(!c||c(q))&&void 0!==q.bu)),U}getChildren(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(c,q)}_setReady(q){q!==this._nodeDataStorage._isReady&&(q?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(q){for(let c=0;c<this.animations.length;c++){const U=this.animations[c];if(U.name===q)return U}return null}createAnimationRange(q,c,U){if(!this._ranges[q]){this._ranges[q]=u._AnimationRangeFactory(q,c,U);for(let J=0,Q=this.animations.length;J<Q;J++)this.animations[J]&&this.animations[J].createRange(q,c,U)}}deleteAnimationRange(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let U=0,J=this.animations.length;U<J;U++)this.animations[U]&&this.animations[U].deleteRange(q,c);this._ranges[q]=null}getAnimationRange(q){return this._ranges[q]||null}clone(q,c,U){const J=W.e.Clone((()=>new u(q,this.Cq())),this);if(c&&(J.parent=c),!U){const c=this.getDescendants(!0);for(let U=0;U<c.length;U++){const Q=c[U];Q.clone(q+"."+Q.name,J)}}return J}getAnimationRanges(){const q=[];let c;for(c in this._ranges)q.push(this._ranges[c]);return q}beginAnimation(q,c,U,J){const Q=this.getAnimationRange(q);return Q?this._scene.beginAnimation(this,Q.from,Q.to,c,U,J):null}serializeAnimationRanges(){const q=[];for(const c in this._ranges){const U=this._ranges[c];if(!U)continue;const J={};J.name=c,J.from=U.from,J.to=U.to,q.push(J)}return q}o(q){return this._worldMatrix||(this._worldMatrix=Q.d.Identity()),this._worldMatrix}dispose(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!q){const U=this.getDescendants(!0);for(const J of U)J.dispose(q,c)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Cc.notifyObservers(this),this.Cc.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const U of this._behaviors)U.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(q,c,U){if(c.ranges)for(let J=0;J<c.ranges.length;J++){const U=c.ranges[J];q.createAnimationRange(U.name,U.from,U.to)}}getHierarchyBoundingVectors(){let q,c,U=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],J=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.Cq().incrementRenderId(),this.o(!0);const s=this;if(s.getBoundingInfo&&s.Gc){const U=s.getBoundingInfo();q=U.boundingBox.minimumWorld.clone(),c=U.boundingBox.maximumWorld.clone()}else q=new Q.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),c=new Q.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(U){const U=this.getDescendants(!1);for(const s of U){const U=s;if(U.o(!0),J&&!J(U))continue;if(!U.getBoundingInfo||0===U.getTotalVertices())continue;const g=U.getBoundingInfo().boundingBox,X=g.minimumWorld,n=g.maximumWorld;Q.p.CheckExtends(X,q,c),Q.p.CheckExtends(n,q,c)}}return{min:q,max:c}}}u._AnimationRangeFactory=(q,c,U)=>{throw(0,n.d)("AnimationRange")},u._NodeConstructors={},(0,J.d)([(0,s.N)()],u.prototype,"name",void 0),(0,J.d)([(0,s.N)()],u.prototype,"id",void 0),(0,J.d)([(0,s.N)()],u.prototype,"uniqueId",void 0),(0,J.d)([(0,s.N)()],u.prototype,"state",void 0),(0,J.d)([(0,s.N)()],u.prototype,"metadata",void 0)},11364:(q,c,U)=>{U.d(c,{b:()=>qq});var J=U(10879),Q=U(10902),s=U(10866),g=U(11156);class X{constructor(){this._count=0,this._data={}}X(q){this.clear(),q.forEach(((q,c)=>this.add(q,c)))}get(q){const c=this._data[q];if(void 0!==c)return c}getOrAddWithFactory(q,c){let U=this.get(q);return void 0!==U||(U=c(q),U&&this.add(q,U)),U}getOrAdd(q,c){const U=this.get(q);return void 0!==U?U:(this.add(q,c),c)}contains(q){return void 0!==this._data[q]}add(q,c){return void 0===this._data[q]&&(this._data[q]=c,++this._count,!0)}set(q,c){return void 0!==this._data[q]&&(this._data[q]=c,!0)}getAndRemove(q){const c=this.get(q);return void 0!==c?(delete this._data[q],--this._count,c):null}remove(q){return!!this.contains(q)&&(delete this._data[q],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(q){for(const c in this._data){q(c,this._data[c])}}first(q){for(const c in this._data){const U=q(c,this._data[c]);if(U)return U}return null}}var n=U(11087),W=U(10833),D=U(11373),u=U(11075),K=U(11132);class r{constructor(q,c,U,J,Q,s){this.source=q,this.pointerX=c,this.pointerY=U,this.meshUnderPointer=J,this.sourceEvent=Q,this.additionalData=s}static CreateNew(q,c,U){const J=q.Cq();return new r(q,J.pointerX,J.pointerY,J.meshUnderPointer||q,c,U)}static CreateNewFromSprite(q,c,U,J){return new r(q,c.pointerX,c.pointerY,c.meshUnderPointer,U,J)}static CreateNewFromScene(q,c){return new r(null,q.pointerX,q.pointerY,q.meshUnderPointer,c)}static CreateNewFromPrimitive(q,c,U,J){return new r(q,c.x,c.y,null,U,J)}}var H=U(11303),b=U(11305),h=U(11192),o=U(10881),a=U(10864),p=U(10910),R=U(11391);class I{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const q in I.Triggers)if(Object.prototype.hasOwnProperty.call(I.Triggers,q))return!0;return!1}static get HasPickTriggers(){for(const q in I.Triggers)if(Object.prototype.hasOwnProperty.call(I.Triggers,q)){const c=parseInt(q);if(c>=1&&c<=7)return!0}return!1}static HasSpecificTrigger(q){for(const c in I.Triggers)if(Object.prototype.hasOwnProperty.call(I.Triggers,c)){if(parseInt(c)===q)return!0}return!1}}I.Triggers={};var t,C,i,F,v,Y,k,V=U(11396);!function(q){q[q.Generic=0]="Generic",q[q.Keyboard=1]="Keyboard",q[q.Mouse=2]="Mouse",q[q.Touch=3]="Touch",q[q.DualShock=4]="DualShock",q[q.Xbox=5]="Xbox",q[q.Switch=6]="Switch",q[q.DualSense=7]="DualSense"}(t||(t={})),function(q){q[q.Horizontal=0]="Horizontal",q[q.Vertical=1]="Vertical",q[q.LeftClick=2]="LeftClick",q[q.MiddleClick=3]="MiddleClick",q[q.RightClick=4]="RightClick",q[q.BrowserBack=5]="BrowserBack",q[q.BrowserForward=6]="BrowserForward",q[q.MouseWheelX=7]="MouseWheelX",q[q.MouseWheelY=8]="MouseWheelY",q[q.MouseWheelZ=9]="MouseWheelZ",q[q.Move=12]="Move"}(C||(C={})),function(q){q[q.Horizontal=0]="Horizontal",q[q.Vertical=1]="Vertical",q[q.LeftClick=2]="LeftClick",q[q.MiddleClick=3]="MiddleClick",q[q.RightClick=4]="RightClick",q[q.BrowserBack=5]="BrowserBack",q[q.BrowserForward=6]="BrowserForward",q[q.MouseWheelX=7]="MouseWheelX",q[q.MouseWheelY=8]="MouseWheelY",q[q.MouseWheelZ=9]="MouseWheelZ",q[q.DeltaHorizontal=10]="DeltaHorizontal",q[q.DeltaVertical=11]="DeltaVertical"}(i||(i={})),function(q){q[q.Cross=0]="Cross",q[q.Circle=1]="Circle",q[q.Square=2]="Square",q[q.Triangle=3]="Triangle",q[q.L1=4]="L1",q[q.R1=5]="R1",q[q.L2=6]="L2",q[q.R2=7]="R2",q[q.Share=8]="Share",q[q.Options=9]="Options",q[q.L3=10]="L3",q[q.R3=11]="R3",q[q.DPadUp=12]="DPadUp",q[q.DPadDown=13]="DPadDown",q[q.DPadLeft=14]="DPadLeft",q[q.DPadRight=15]="DPadRight",q[q.Home=16]="Home",q[q.TouchPad=17]="TouchPad",q[q.LStickXAxis=18]="LStickXAxis",q[q.LStickYAxis=19]="LStickYAxis",q[q.RStickXAxis=20]="RStickXAxis",q[q.RStickYAxis=21]="RStickYAxis"}(F||(F={})),function(q){q[q.Cross=0]="Cross",q[q.Circle=1]="Circle",q[q.Square=2]="Square",q[q.Triangle=3]="Triangle",q[q.L1=4]="L1",q[q.R1=5]="R1",q[q.L2=6]="L2",q[q.R2=7]="R2",q[q.Create=8]="Create",q[q.Options=9]="Options",q[q.L3=10]="L3",q[q.R3=11]="R3",q[q.DPadUp=12]="DPadUp",q[q.DPadDown=13]="DPadDown",q[q.DPadLeft=14]="DPadLeft",q[q.DPadRight=15]="DPadRight",q[q.Home=16]="Home",q[q.TouchPad=17]="TouchPad",q[q.LStickXAxis=18]="LStickXAxis",q[q.LStickYAxis=19]="LStickYAxis",q[q.RStickXAxis=20]="RStickXAxis",q[q.RStickYAxis=21]="RStickYAxis"}(v||(v={})),function(q){q[q.A=0]="A",q[q.B=1]="B",q[q.X=2]="X",q[q.Y=3]="Y",q[q.LB=4]="LB",q[q.RB=5]="RB",q[q.LT=6]="LT",q[q.RT=7]="RT",q[q.Back=8]="Back",q[q.Start=9]="Start",q[q.LS=10]="LS",q[q.RS=11]="RS",q[q.DPadUp=12]="DPadUp",q[q.DPadDown=13]="DPadDown",q[q.DPadLeft=14]="DPadLeft",q[q.DPadRight=15]="DPadRight",q[q.Home=16]="Home",q[q.LStickXAxis=17]="LStickXAxis",q[q.LStickYAxis=18]="LStickYAxis",q[q.RStickXAxis=19]="RStickXAxis",q[q.RStickYAxis=20]="RStickYAxis"}(Y||(Y={})),function(q){q[q.B=0]="B",q[q.A=1]="A",q[q.Y=2]="Y",q[q.X=3]="X",q[q.L=4]="L",q[q.R=5]="R",q[q.ZL=6]="ZL",q[q.ZR=7]="ZR",q[q.Minus=8]="Minus",q[q.Plus=9]="Plus",q[q.LS=10]="LS",q[q.RS=11]="RS",q[q.DPadUp=12]="DPadUp",q[q.DPadDown=13]="DPadDown",q[q.DPadLeft=14]="DPadLeft",q[q.DPadRight=15]="DPadRight",q[q.Home=16]="Home",q[q.Capture=17]="Capture",q[q.LStickXAxis=18]="LStickXAxis",q[q.LStickYAxis=19]="LStickYAxis",q[q.RStickXAxis=20]="RStickXAxis",q[q.RStickYAxis=21]="RStickYAxis"}(k||(k={}));var O=U(11404);class G{static CreateDeviceEvent(q,c,U,J,Q,s,g){switch(q){case t.Keyboard:return this._CreateKeyboardEvent(U,J,Q,s);case t.Mouse:if(U===C.MouseWheelX||U===C.MouseWheelY||U===C.MouseWheelZ)return this._CreateWheelEvent(q,c,U,J,Q,s);case t.Touch:return this._CreatePointerEvent(q,c,U,J,Q,s,g);default:throw`Unable to generate event for device ${t[q]}`}}static _CreatePointerEvent(q,c,U,J,Q,s,g){const X=this._CreateMouseEvent(q,c,U,J,Q,s);q===t.Mouse?(X.deviceType=t.Mouse,X.pointerId=1,X.pointerType="mouse"):(X.deviceType=t.Touch,X.pointerId=g??c,X.pointerType="touch");let n=0;return n+=Q.pollInput(q,c,C.LeftClick),n+=2*Q.pollInput(q,c,C.RightClick),n+=4*Q.pollInput(q,c,C.MiddleClick),X.buttons=n,U===C.Move?X.type="pointermove":U>=C.LeftClick&&U<=C.RightClick&&(X.type=1===J?"pointerdown":"pointerup",X.button=U-2),X}static _CreateWheelEvent(q,c,U,J,Q,s){const g=this._CreateMouseEvent(q,c,U,J,Q,s);switch(g.pointerId=1,g.type="wheel",g.deltaMode=O.c.DOM_DELTA_PIXEL,g.deltaX=0,g.deltaY=0,g.deltaZ=0,U){case C.MouseWheelX:g.deltaX=J;break;case C.MouseWheelY:g.deltaY=J;break;case C.MouseWheelZ:g.deltaZ=J}return g}static _CreateMouseEvent(q,c,U,J,Q,s){const g=this._CreateEvent(s),X=Q.pollInput(q,c,C.Horizontal),n=Q.pollInput(q,c,C.Vertical);return s?(g.movementX=0,g.movementY=0,g.offsetX=g.movementX-s.getBoundingClientRect().x,g.offsetY=g.movementY-s.getBoundingClientRect().y):(g.movementX=Q.pollInput(q,c,10),g.movementY=Q.pollInput(q,c,11),g.offsetX=0,g.offsetY=0),this._CheckNonCharacterKeys(g,Q),g.clientX=X,g.clientY=n,g.x=X,g.y=n,g.deviceType=q,g.deviceSlot=c,g.inputIndex=U,g}static _CreateKeyboardEvent(q,c,U,J){const Q=this._CreateEvent(J);return this._CheckNonCharacterKeys(Q,U),Q.deviceType=t.Keyboard,Q.deviceSlot=0,Q.inputIndex=q,Q.type=1===c?"keydown":"keyup",Q.key=String.fromCharCode(q),Q.keyCode=q,Q}static _CheckNonCharacterKeys(q,c){const U=c.isDeviceAvailable(t.Keyboard),J=U&&1===c.pollInput(t.Keyboard,0,18),Q=U&&1===c.pollInput(t.Keyboard,0,17),s=U&&(1===c.pollInput(t.Keyboard,0,91)||1===c.pollInput(t.Keyboard,0,92)||1===c.pollInput(t.Keyboard,0,93)),g=U&&1===c.pollInput(t.Keyboard,0,16);q.altKey=J,q.ctrlKey=Q,q.metaKey=s,q.shiftKey=g}static _CreateEvent(q){const c={preventDefault:()=>{}};return c.target=q,c}}class S{constructor(q,c,U){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(q,c,((q,c,J,Q)=>{const s=G.CreateDeviceEvent(q,c,J,Q,this);U(q,c,s)})):this._createDummyNativeInput()}pollInput(q,c,U){return this._nativeInput.pollInput(q,c,U)}isDeviceAvailable(q){return q===t.Mouse||q===t.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const Z=Object.keys(C).length/2;class x{constructor(q,c,U,Q){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=J.e.IsSafari(),this._usingMacOs=(0,o.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=q=>{},this._keyboardUpEvent=q=>{},this._keyboardBlurEvent=q=>{},this._pointerMoveEvent=q=>{},this._pointerDownEvent=q=>{},this._pointerUpEvent=q=>{},this._pointerCancelEvent=q=>{},this._pointerCancelTouch=q=>{},this._pointerLeaveEvent=q=>{},this._pointerWheelEvent=q=>{},this._pointerBlurEvent=q=>{},this._pointerMacOsChromeOutEvent=q=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,o.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,o.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=q=>{},this._gamepadDisconnectedEvent=q=>{},this._eventPrefix=J.e.GetPointerPrefix(q),this._engine=q,this._onDeviceConnected=c,this._onDeviceDisconnected=U,this._onInputChanged=Q,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOs&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(q,c,U){const Q=this._inputs[q][c];if(!Q)throw`Unable to find device ${t[q]}`;q>=t.DualShock&&q<=t.DualSense&&this._updateDevice(q,c,U);const s=Q[U];if(void 0===s)throw`Unable to find input ${U} for device ${t[q]} in slot ${c}`;return U===C.Move&&J.e.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),s}isDeviceAvailable(q){return void 0!==this._inputs[q]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const q=null===this||void 0===this?void 0:this._engine.getInputElement();if(q&&(!this._eventsAttached||this._elementToAttachTo!==q)){if(this._disableEvents(),this._inputs)for(const q of this._inputs)if(q)for(const c in q){const U=q[+c];if(U)for(let q=0;q<U.length;q++)U[q]=0}this._elementToAttachTo=q,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOs&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const q=navigator.getGamepads();for(const c of q)c&&this._addGamePad(c)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(t.Mouse,0,0,0)}_addGamePad(q){const c=this._getGamepadDeviceType(q.id),U=q.index;this._gamepads=this._gamepads||new Array(q.index+1),this._registerDevice(c,U,q.buttons.length+q.axes.length),this._gamepads[U]=c}_addPointerDevice(q,c,U,J){this._pointerActive||(this._pointerActive=!0),this._registerDevice(q,c,Z);const Q=this._inputs[q][c];Q[0]=U,Q[1]=J}_registerDevice(q,c,U){if(void 0===c)throw`Unable to register device ${t[q]} to undefined slot.`;if(this._inputs[q]||(this._inputs[q]={}),!this._inputs[q][c]){const J=new Array(U);J.fill(0),this._inputs[q][c]=J,this._onDeviceConnected(q,c)}}_unregisterDevice(q,c){this._inputs[q][c]&&(delete this._inputs[q][c],this._onDeviceDisconnected(q,c))}_handleKeyActions(){this._keyboardDownEvent=q=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(t.Keyboard,0,255));const c=this._inputs[t.Keyboard][0];if(c){c[q.keyCode]=1;const U=q;U.inputIndex=q.keyCode,this._usingMacOs&&q.metaKey&&"Meta"!==q.key&&(this._metaKeys.includes(q.keyCode)||this._metaKeys.push(q.keyCode)),this._onInputChanged(t.Keyboard,0,U)}},this._keyboardUpEvent=q=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(t.Keyboard,0,255));const c=this._inputs[t.Keyboard][0];if(c){c[q.keyCode]=0;const U=q;if(U.inputIndex=q.keyCode,this._usingMacOs&&"Meta"===q.key&&this._metaKeys.length>0){for(const q of this._metaKeys){const U=G.CreateDeviceEvent(t.Keyboard,0,q,0,this,this._elementToAttachTo);c[q]=0,this._onInputChanged(t.Keyboard,0,U)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(t.Keyboard,0,U)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const q=this._inputs[t.Keyboard][0];for(let c=0;c<q.length;c++)if(0!==q[c]){q[c]=0;const U=G.CreateDeviceEvent(t.Keyboard,0,c,0,this,this._elementToAttachTo);this._onInputChanged(t.Keyboard,0,U)}this._usingMacOs&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,o.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let J=0;J<this._maxTouchPoints;J++)this._activeTouchIds[J]=-1;this._pointerMoveEvent=q=>{const c=this._getPointerType(q);let U=c===t.Mouse?0:this._activeTouchIds.indexOf(q.pointerId);if(c===t.Touch&&-1===U){const Q=this._activeTouchIds.indexOf(-1);if(!(Q>=0))return void J.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);U=Q,this._activeTouchIds[Q]=q.pointerId,this._onDeviceConnected(c,U)}this._inputs[c]||(this._inputs[c]={}),this._inputs[c][U]||this._addPointerDevice(c,U,q.clientX,q.clientY);const Q=this._inputs[c][U];if(Q){const J=q;J.inputIndex=C.Move,Q[C.Horizontal]=q.clientX,Q[C.Vertical]=q.clientY,c===t.Touch&&0===Q[C.LeftClick]&&(Q[C.LeftClick]=1),void 0===q.pointerId&&(q.pointerId=this._mouseId),this._onInputChanged(c,U,J),this._usingSafari||-1===q.button||(J.inputIndex=q.button+2,Q[q.button+2]=Q[q.button+2]?0:1,this._onInputChanged(c,U,J))}},this._pointerDownEvent=q=>{const c=this._getPointerType(q);let U=c===t.Mouse?0:q.pointerId;if(c===t.Touch){let c=this._activeTouchIds.indexOf(q.pointerId);if(-1===c&&(c=this._activeTouchIds.indexOf(-1)),!(c>=0))return void J.e.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);U=c,this._activeTouchIds[c]=q.pointerId}this._inputs[c]||(this._inputs[c]={}),this._inputs[c][U]?c===t.Touch&&this._onDeviceConnected(c,U):this._addPointerDevice(c,U,q.clientX,q.clientY);const Q=this._inputs[c][U];if(Q){const J=Q[C.Horizontal],g=Q[C.Vertical];if(c===t.Mouse){if(void 0===q.pointerId&&(q.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(s){}}else if(q.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(q.pointerId)}catch(s){}Q[C.Horizontal]=q.clientX,Q[C.Vertical]=q.clientY,Q[q.button+2]=1;const X=q;X.inputIndex=q.button+2,this._onInputChanged(c,U,X),J===q.clientX&&g===q.clientY||(X.inputIndex=C.Move,this._onInputChanged(c,U,X))}},this._pointerUpEvent=q=>{var c;const U=this._getPointerType(q),J=U===t.Mouse?0:this._activeTouchIds.indexOf(q.pointerId);if(U===t.Touch){if(-1===J)return;this._activeTouchIds[J]=-1}const Q=null===(c=this._inputs[U])||void 0===c?void 0:c[J];let s=q.button,g=Q&&0!==Q[s+2];if(!g&&this._isUsingFirefox&&this._usingMacOs&&Q&&(s=2===s?0:2,g=0!==Q[s+2]),g){var X,n,W,D;const c=Q[C.Horizontal],g=Q[C.Vertical];Q[C.Horizontal]=q.clientX,Q[C.Vertical]=q.clientY,Q[s+2]=0;const u=q;void 0===q.pointerId&&(q.pointerId=this._mouseId),c===q.clientX&&g===q.clientY||(u.inputIndex=C.Move,this._onInputChanged(U,J,u)),u.inputIndex=s+2,U===t.Mouse&&this._mouseId>=0&&null!==(X=(n=this._elementToAttachTo).hasPointerCapture)&&void 0!==X&&X.call(n,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):q.pointerId&&null!==(W=(D=this._elementToAttachTo).hasPointerCapture)&&void 0!==W&&W.call(D,q.pointerId)&&this._elementToAttachTo.releasePointerCapture(q.pointerId),this._onInputChanged(U,J,u),U===t.Touch&&this._onDeviceDisconnected(U,J)}},this._pointerCancelTouch=q=>{var c,U;const J=this._activeTouchIds.indexOf(q);if(-1===J)return;null!==(c=(U=this._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(U,q)&&this._elementToAttachTo.releasePointerCapture(q),this._inputs[t.Touch][J][C.LeftClick]=0;const Q=G.CreateDeviceEvent(t.Touch,J,C.LeftClick,0,this,this._elementToAttachTo,q);this._onInputChanged(t.Touch,J,Q),this._activeTouchIds[J]=-1,this._onDeviceDisconnected(t.Touch,J)},this._pointerCancelEvent=q=>{if("mouse"===q.pointerType){var c,U;const q=this._inputs[t.Mouse][0];this._mouseId>=0&&null!==(c=(U=this._elementToAttachTo).hasPointerCapture)&&void 0!==c&&c.call(U,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let c=C.LeftClick;c<=C.BrowserForward;c++)if(1===q[c]){q[c]=0;const U=G.CreateDeviceEvent(t.Mouse,0,c,0,this,this._elementToAttachTo);this._onInputChanged(t.Mouse,0,U)}}else this._pointerCancelTouch(q.pointerId)},this._pointerLeaveEvent=q=>{"pen"===q.pointerType&&this._pointerCancelTouch(q.pointerId)},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let q=!1;const c=function(){};try{const U=Object.defineProperty({},"passive",{get:function(){q=!0}});this._elementToAttachTo.addEventListener("test",c,U),this._elementToAttachTo.removeEventListener("test",c,U)}catch(U){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(t.Mouse)){var q,c;const U=this._inputs[t.Mouse][0];this._mouseId>=0&&null!==(q=(c=this._elementToAttachTo).hasPointerCapture)&&void 0!==q&&q.call(c,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let q=C.LeftClick;q<=C.BrowserForward;q++)if(1===U[q]){U[q]=0;const c=G.CreateDeviceEvent(t.Mouse,0,q,0,this,this._elementToAttachTo);this._onInputChanged(t.Mouse,0,c)}}if(this.isDeviceAvailable(t.Touch)){const q=this._inputs[t.Touch];for(let c=0;c<this._activeTouchIds.length;c++){var U,J,Q;const s=this._activeTouchIds[c];if(null!==(U=(J=this._elementToAttachTo).hasPointerCapture)&&void 0!==U&&U.call(J,s)&&this._elementToAttachTo.releasePointerCapture(s),-1!==s&&1===(null===(Q=q[c])||void 0===Q?void 0:Q[C.LeftClick])){q[c][C.LeftClick]=0;const U=G.CreateDeviceEvent(t.Touch,c,C.LeftClick,0,this,this._elementToAttachTo,s);this._onInputChanged(t.Touch,c,U),this._activeTouchIds[c]=-1,this._onDeviceDisconnected(t.Touch,c)}}}},this._pointerWheelEvent=q=>{const c=t.Mouse;this._inputs[c]||(this._inputs[c]=[]),this._inputs[c][0]||(this._pointerActive=!0,this._registerDevice(c,0,Z));const U=this._inputs[c][0];if(U){U[C.MouseWheelX]=q.deltaX||0,U[C.MouseWheelY]=q.deltaY||q.wheelDelta||0,U[C.MouseWheelZ]=q.deltaZ||0;const J=q;void 0===q.pointerId&&(q.pointerId=this._mouseId),0!==U[C.MouseWheelX]&&(J.inputIndex=C.MouseWheelX,this._onInputChanged(c,0,J)),0!==U[C.MouseWheelY]&&(J.inputIndex=C.MouseWheelY,this._onInputChanged(c,0,J)),0!==U[C.MouseWheelZ]&&(J.inputIndex=C.MouseWheelZ,this._onInputChanged(c,0,J))}},this._usingMacOs&&this._isUsingChromium&&(this._pointerMacOsChromeOutEvent=q=>{q.buttons>1&&this._pointerCancelEvent(q)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOsChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"leave",this._pointerLeaveEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!q&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(t.Mouse)){const q=this._inputs[t.Mouse][0];q[C.MouseWheelX]=0,q[C.MouseWheelY]=0,q[C.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=q=>{this._addGamePad(q.gamepad)},this._gamepadDisconnectedEvent=q=>{if(this._gamepads){const c=this._getGamepadDeviceType(q.gamepad.id),U=q.gamepad.index;this._unregisterDevice(c,U),delete this._gamepads[U]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(q,c,U){const J=navigator.getGamepads()[c];if(J&&q===this._gamepads[c]){const Q=this._inputs[q][c];U>=J.buttons.length?Q[U]=J.axes[U-J.buttons.length].valueOf():Q[U]=J.buttons[U].value}}_getGamepadDeviceType(q){return-1!==q.indexOf("054c")?-1!==q.indexOf("0ce6")?t.DualSense:t.DualShock:-1!==q.indexOf("Xbox One")||-1!==q.search("Xbox 360")||-1!==q.search("xinput")?t.Xbox:-1!==q.indexOf("057e")?t.Switch:t.Generic}_getPointerType(q){let c=t.Mouse;return("touch"===q.pointerType||"pen"===q.pointerType||q.touches)&&(c=t.Touch),c}}class z{constructor(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=c,this.deviceSlot=U,this.onInputChangedObservable=new s.e,this._deviceInputSystem=q}getInput(q){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,q)}}class y{constructor(q){this._registeredManagers=new Array,this._refCount=0,this.registerManager=q=>{for(let c=0;c<this._devices.length;c++){const U=this._devices[c];for(const J in U){const U=+J;q._addDevice(new z(this._deviceInputSystem,c,U))}}this._registeredManagers.push(q)},this.unregisterManager=q=>{const c=this._registeredManagers.indexOf(q);c>-1&&this._registeredManagers.splice(c,1)};const c=Object.keys(t).length/2;this._devices=new Array(c);const U=(q,c)=>{this._devices[q]||(this._devices[q]=new Array),this._devices[q][c]||(this._devices[q][c]=c);for(const U of this._registeredManagers){const J=new z(this._deviceInputSystem,q,c);U._addDevice(J)}},J=(q,c)=>{var U;null!==(U=this._devices[q])&&void 0!==U&&U[c]&&delete this._devices[q][c];for(const J of this._registeredManagers)J._removeDevice(q,c)},Q=(q,c,U)=>{if(U)for(const J of this._registeredManagers)J._onInputChanged(q,c,U)};"undefined"!==typeof _native?this._deviceInputSystem=new S(U,J,Q):this._deviceInputSystem=new x(q,U,J,Q)}dispose(){this._deviceInputSystem.dispose()}}class M{getDeviceSource(q,c){if(void 0===c){if(void 0===this._firstDevice[q])return null;c=this._firstDevice[q]}return this._devices[q]&&void 0!==this._devices[q][c]?this._devices[q][c]:null}getDeviceSources(q){return this._devices[q]?this._devices[q].filter((q=>!!q)):[]}constructor(q){const c=Object.keys(t).length/2;this._devices=new Array(c),this._firstDevice=new Array(c),this._engine=q,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new y(q)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new s.e((q=>{for(const c of this._devices)if(c)for(const U of c)U&&this.onDeviceConnectedObservable.notifyObserver(q,U)})),this.onDeviceDisconnectedObservable=new s.e,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=q.Cc.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.Cc.remove(this._onDisposeObserver)}_addDevice(q){this._devices[q.deviceType]||(this._devices[q.deviceType]=[]),this._devices[q.deviceType][q.deviceSlot]||(this._devices[q.deviceType][q.deviceSlot]=q,this._updateFirstDevices(q.deviceType)),this.onDeviceConnectedObservable.notifyObservers(q)}_removeDevice(q,c){var U,J;const Q=null===(U=this._devices[q])||void 0===U?void 0:U[c];this.onDeviceDisconnectedObservable.notifyObservers(Q),null!==(J=this._devices[q])&&void 0!==J&&J[c]&&delete this._devices[q][c],this._updateFirstDevices(q)}_onInputChanged(q,c,U){var J,Q;null===(J=this._devices[q])||void 0===J||null===(Q=J[c])||void 0===Q||Q.onInputChangedObservable.notifyObservers(U)}_updateFirstDevices(q){switch(q){case t.Keyboard:case t.Mouse:this._firstDevice[q]=0;break;case t.Touch:case t.DualSense:case t.DualShock:case t.Xbox:case t.Switch:case t.Generic:{delete this._firstDevice[q];const c=this._devices[q];if(c)for(let U=0;U<c.length;U++)if(c[U]){this._firstDevice[q]=U;break}break}}}}var T=U(11407);class m{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get hJ(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(q){this._singleClick=q}set hJ(q){this._doubleClick=q}set hasSwiped(q){this._hasSwiped=q}set ignore(q){this._ignore=q}}class d{constructor(q){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new W.l(0,0),this._previousStartingPointerPosition=new W.l(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=q||a.c.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(q){return this._meshUnderPointerId[q]||null}get unTranslatedPointer(){return new W.l(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(q){this._pointerX=q}get pointerY(){return this._pointerY}set pointerY(q){this._pointerY=q}_updatePointerPosition(q){const c=this._scene.getEngine().getInputElementClientRect();c&&(this._pointerX=q.clientX-c.left,this._pointerY=q.clientY-c.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(q,c){const U=this._scene,J=U.getEngine(),Q=J.getInputElement();Q&&(Q.tabIndex=J.canvasTabIndex,U.doNotHandleCursors||(Q.style.cursor=U.defaultCursor)),this._setCursorAndPointerOverMesh(q,c,U);for(const n of U._pointerMoveStage){var s;const U=!(null===(s=q=q||this._pickMove(c))||void 0===s||!s.pickedMesh);q=n.action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,U,Q)}const g=c.inputIndex>=C.MouseWheelX&&c.inputIndex<=C.MouseWheelZ?R.d.POINTERWHEEL:R.d.POINTERMOVE;let X;U.onPointerMove&&(q=q||this._pickMove(c),U.onPointerMove(c,q,g)),q?(X=new R.j(g,c,q),this._setRayOnPointerInfo(q,c)):(X=new R.j(g,c,null,this),this._movePointerInfo=X),U.onPointerObservable.hasObservers()&&U.onPointerObservable.notifyObservers(X,g)}_setRayOnPointerInfo(q,c){const U=this._scene;q&&T.b._IsPickingAvailable&&(q.ray||(q.ray=U.createPickingRay(c.offsetX,c.offsetY,W.d.Identity(),U.activeCamera)))}_addCameraPointerObserver(q,c){return this._cameraObserverCount++,this._scene.onPointerObservable.add(q,c)}_removeCameraPointerObserver(q){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(q)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(q,c,U){const J=this._scene,Q=new R.g(U,c,this._unTranslatedPointerX,this._unTranslatedPointerY);return q&&(Q.originalPickingInfo=q,Q.ray=q.ray,"xr-near"===c.pointerType&&q.originMesh&&(Q.nearInteractionPickingInfo=q)),J.onPrePointerObservable.notifyObservers(Q,U),!!Q.skipOnPointerObservable}_pickMove(q){const c=this._scene,U=c.dU(this._unTranslatedPointerX,this._unTranslatedPointerY,c.pointerMovePredicate,c.pointerMoveFastCheck,c.cameraToUseForPointers,c.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(U,q,c),U}_setCursorAndPointerOverMesh(q,c,U){const J=U.getEngine().getInputElement();if(null!==q&&void 0!==q&&q.pickedMesh){if(this.setPointerOverMesh(q.pickedMesh,c.pointerId,q,c),!U.doNotHandleCursors&&J&&this._pointerOverMesh){const q=this._pointerOverMesh._getActionManagerForTrigger();q&&q.hasPointerTriggers&&(J.style.cursor=q.hoverCursor||U.hoverCursor)}}else this.setPointerOverMesh(null,c.pointerId,q,c)}simulatePointerMove(q,c){const U=new PointerEvent("pointermove",c);U.inputIndex=C.Move,this._checkPrePointerObservable(q,U,R.d.POINTERMOVE)||this._processPointerMove(q,U)}simulatePointerDown(q,c){const U=new PointerEvent("pointerdown",c);U.inputIndex=U.button+2,this._checkPrePointerObservable(q,U,R.d.POINTERDOWN)||this._processPointerDown(q,U)}_processPointerDown(q,c){var U;const J=this._scene;if(null!==(U=q)&&void 0!==U&&U.pickedMesh){this._pickedDownMesh=q.pickedMesh;const U=q.pickedMesh._getActionManagerForTrigger();if(U){if(U.hasPickTriggers)switch(U.processTrigger(5,new r(q.pickedMesh,J.pointerX,J.pointerY,q.pickedMesh,c,q)),c.button){case 0:U.processTrigger(2,new r(q.pickedMesh,J.pointerX,J.pointerY,q.pickedMesh,c,q));break;case 1:U.processTrigger(4,new r(q.pickedMesh,J.pointerX,J.pointerY,q.pickedMesh,c,q));break;case 2:U.processTrigger(3,new r(q.pickedMesh,J.pointerX,J.pointerY,q.pickedMesh,c,q))}U.hasSpecificTrigger(8)&&window.setTimeout((()=>{const q=J.dU(this._unTranslatedPointerX,this._unTranslatedPointerY,(q=>q.Pn&&q.isVisible&&q.isReady()&&q.actionManager&&q.actionManager.hasSpecificTrigger(8)&&q===this._pickedDownMesh),!1,J.cameraToUseForPointers);null!==q&&void 0!==q&&q.pickedMesh&&U&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>d.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,U.processTrigger(8,r.CreateNew(q.pickedMesh,c)))}),d.LongPressDelay)}}else for(const g of J._pointerDownStage)q=g.action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,c,!1);let Q;const s=R.d.POINTERDOWN;q?(J.onPointerDown&&J.onPointerDown(c,q,s),Q=new R.j(s,c,q),this._setRayOnPointerInfo(q,c)):Q=new R.j(s,c,null,this),J.onPointerObservable.hasObservers()&&J.onPointerObservable.notifyObservers(Q,s)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(q,c,U){const J=new PointerEvent("pointerup",c);J.inputIndex=C.Move;const Q=new m;U?Q.hJ=!0:Q.singleClick=!0,this._checkPrePointerObservable(q,J,R.d.POINTERUP)||this._processPointerUp(q,J,Q)}_processPointerUp(q,c,U){var J;const Q=this._scene;if(null!==(J=q)&&void 0!==J&&J.pickedMesh){if(this._pickedUpMesh=q.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(Q.onPointerPick&&Q.onPointerPick(c,q),U.singleClick&&!U.ignore&&Q.onPointerObservable.observers.length>this._cameraObserverCount)){const U=R.d.POINTERPICK,J=new R.j(U,c,q);this._setRayOnPointerInfo(q,c),Q.onPointerObservable.notifyObservers(J,U)}const J=q.pickedMesh._getActionManagerForTrigger();if(J&&!U.ignore){J.processTrigger(7,r.CreateNew(q.pickedMesh,c,q)),!U.hasSwiped&&U.singleClick&&J.processTrigger(1,r.CreateNew(q.pickedMesh,c,q));const Q=q.pickedMesh._getActionManagerForTrigger(6);U.hJ&&Q&&Q.processTrigger(6,r.CreateNew(q.pickedMesh,c,q))}}else if(!U.ignore)for(const s of Q._pointerUpStage)q=s.action(this._unTranslatedPointerX,this._unTranslatedPointerY,q,c,U.hJ);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const q=this._pickedDownMesh._getActionManagerForTrigger(16);q&&q.processTrigger(16,r.CreateNew(this._pickedDownMesh,c))}if(!U.ignore){const J=new R.j(R.d.POINTERUP,c,q);if(this._setRayOnPointerInfo(q,c),Q.onPointerObservable.notifyObservers(J,R.d.POINTERUP),Q.onPointerUp&&Q.onPointerUp(c,q,R.d.POINTERUP),!U.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let J=0;if(U.singleClick?J=R.d.POINTERTAP:U.hJ&&(J=R.d.POINTERDOUBLETAP),J){const U=new R.j(J,c,q);Q.onPointerObservable.hasObservers()&&Q.onPointerObservable.hasSpecificMask(J)&&Q.onPointerObservable.notifyObservers(U,J)}}}}isPointerCaptured(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[q]}attachControl(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const Q=this._scene,s=Q.getEngine();J||(J=s.getInputElement()),this._alreadyAttached&&this.Ou(),J&&(this._alreadyAttachedTo=J),this._deviceSourceManager=new M(s),this._initActionManager=q=>{if(!this._meshPickProceed){const c=Q.skipPointerUpPicking||0===Q._registeredActions&&!this._checkForPicking()&&!Q.onPointerUp?null:Q.dU(this._unTranslatedPointerX,this._unTranslatedPointerY,Q.pointerUpPredicate,Q.pointerUpFastCheck,Q.cameraToUseForPointers,Q.pointerUpTrianglePredicate);this._currentPickResult=c,c&&(q=c.hit&&c.pickedMesh?c.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return q},this._delayedSimpleClick=(q,c,U)=>{if((Date.now()-this._previousStartingPointerTime>d.DoubleClickDelay&&!this._doubleClickOccured||q!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,c.singleClick=!0,c.ignore=!1,this._delayedClicks[q])){const c=this._delayedClicks[q].evt,U=R.d.POINTERTAP,J=new R.j(U,c,this._currentPickResult);Q.onPointerObservable.hasObservers()&&Q.onPointerObservable.hasSpecificMask(U)&&Q.onPointerObservable.notifyObservers(J,U),this._delayedClicks[q]=null}},this._initClickEvent=(q,c,U,J)=>{const Q=new m;this._currentPickResult=null;let s=null,g=q.hasSpecificMask(R.d.POINTERPICK)||c.hasSpecificMask(R.d.POINTERPICK)||q.hasSpecificMask(R.d.POINTERTAP)||c.hasSpecificMask(R.d.POINTERTAP)||q.hasSpecificMask(R.d.POINTERDOUBLETAP)||c.hasSpecificMask(R.d.POINTERDOUBLETAP);!g&&I&&(s=this._initActionManager(s,Q),s&&(g=s.hasPickTriggers));let X=!1;if(g=g&&!this._isMultiTouchGesture,g){const g=U.button;if(Q.hasSwiped=this._isPointerSwiping(),!Q.hasSwiped){let D=!d.ExclusiveDoubleClickMode;if(D||(D=!q.hasSpecificMask(R.d.POINTERDOUBLETAP)&&!c.hasSpecificMask(R.d.POINTERDOUBLETAP),D&&!I.HasSpecificTrigger(6)&&(s=this._initActionManager(s,Q),s&&(D=!s.hasSpecificTrigger(6)))),D)(Date.now()-this._previousStartingPointerTime>d.DoubleClickDelay||g!==this._previousButtonPressed)&&(Q.singleClick=!0,J(Q,this._currentPickResult),X=!0);else{const q={evt:U,clickInfo:Q,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,g,Q,J),d.DoubleClickDelay)};this._delayedClicks[g]=q}let u=q.hasSpecificMask(R.d.POINTERDOUBLETAP)||c.hasSpecificMask(R.d.POINTERDOUBLETAP);if(!u&&I.HasSpecificTrigger(6)&&(s=this._initActionManager(s,Q),s&&(u=s.hasSpecificTrigger(6))),u)if(g===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<d.DoubleClickDelay&&!this._doubleClickOccured){if(Q.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=g,d.ExclusiveDoubleClickMode){var n;if(this._delayedClicks[g])clearTimeout(null===(n=this._delayedClicks[g])||void 0===n?void 0:n.timeoutId),this._delayedClicks[g]=null;J(Q,this._previousPickResult)}else J(Q,this._currentPickResult);else{var W;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,Q.hJ=!0,Q.ignore=!1,d.ExclusiveDoubleClickMode&&this._delayedClicks[g])clearTimeout(null===(W=this._delayedClicks[g])||void 0===W?void 0:W.timeoutId),this._delayedClicks[g]=null;J(Q,this._currentPickResult)}X=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=g}}X||J(Q,this._currentPickResult)},this._onPointerMove=q=>{if(this._updatePointerPosition(q),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>d.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>d.DragMovementThreshold),s.isPointerLock&&s._verifyPointerLock(),this._checkPrePointerObservable(null,q,q.inputIndex>=C.MouseWheelX&&q.inputIndex<=C.MouseWheelZ?R.d.POINTERWHEEL:R.d.POINTERMOVE))return;if(!Q.cameraToUseForPointers&&!Q.activeCamera)return;if(Q.Mu)return void this._processPointerMove(new K.c,q);Q.pointerMovePredicate||(Q.pointerMovePredicate=q=>q.Pn&&q.isVisible&&q.isReady()&&q.isEnabled()&&(q.enablePointerMoveEvents||Q.constantlyUpdateMeshUnderPointer||null!==q._getActionManagerForTrigger())&&(!Q.cameraToUseForPointers||0!==(Q.cameraToUseForPointers.layerMask&q.layerMask)));const c=Q._registeredActions>0||Q.constantlyUpdateMeshUnderPointer?this._pickMove(q):null;this._processPointerMove(c,q)},this._onPointerDown=q=>{const c=this._activePointerIds.indexOf(-1);if(-1===c?this._activePointerIds.push(q.pointerId):this._activePointerIds[c]=q.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,d.ExclusiveDoubleClickMode)for(let J=0;J<this._delayedClicks.length;J++)if(this._delayedClicks[J])if(q.button===J){var U;clearTimeout(null===(U=this._delayedClicks[J])||void 0===U?void 0:U.timeoutId)}else{const q=this._delayedClicks[J].clickInfo;this._doubleClickOccured=!1,q.singleClick=!0,q.ignore=!1;const c=this._delayedClicks[J].evt,U=R.d.POINTERTAP,s=new R.j(U,c,this._currentPickResult);Q.onPointerObservable.hasObservers()&&Q.onPointerObservable.hasSpecificMask(U)&&Q.onPointerObservable.notifyObservers(s,U),this._delayedClicks[J]=null}if(this._updatePointerPosition(q),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=q.button),Q.preventDefaultOnPointerDown&&J&&(q.preventDefault(),J.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,q,R.d.POINTERDOWN))return;if(!Q.cameraToUseForPointers&&!Q.activeCamera)return;let s;this._pointerCaptures[q.pointerId]=!0,Q.pointerDownPredicate||(Q.pointerDownPredicate=q=>q.Pn&&q.isVisible&&q.isReady()&&q.isEnabled()&&(!Q.cameraToUseForPointers||0!==(Q.cameraToUseForPointers.layerMask&q.layerMask))),this._pickedDownMesh=null,s=Q.skipPointerDownPicking||0===Q._registeredActions&&!this._checkForPicking()&&!Q.onPointerDown?new K.c:Q.dU(this._unTranslatedPointerX,this._unTranslatedPointerY,Q.pointerDownPredicate,Q.pointerDownFastCheck,Q.cameraToUseForPointers,Q.pointerDownTrianglePredicate),this._processPointerDown(s,q)},this._onPointerUp=q=>{const c=this._activePointerIds.indexOf(q.pointerId);-1!==c&&(this._activePointerIds[c]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(q),Q.preventDefaultOnPointerUp&&J&&(q.preventDefault(),J.focus()),this._initClickEvent(Q.onPrePointerObservable,Q.onPointerObservable,q,((c,U)=>{if(Q.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!c.ignore)){if(this._checkPrePointerObservable(null,q,R.d.POINTERUP))return this._swipeButtonPressed===q.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===q.buttons&&(this._pointerCaptures[q.pointerId]=!1));c.hasSwiped||(c.singleClick&&Q.onPrePointerObservable.hasSpecificMask(R.d.POINTERTAP)&&this._checkPrePointerObservable(null,q,R.d.POINTERTAP)&&(this._skipPointerTap=!0),c.hJ&&Q.onPrePointerObservable.hasSpecificMask(R.d.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,q,R.d.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[q.pointerId]?(0===q.buttons&&(this._pointerCaptures[q.pointerId]=!1),(Q.cameraToUseForPointers||Q.activeCamera)&&(Q.pointerUpPredicate||(Q.pointerUpPredicate=q=>q.Pn&&q.isVisible&&q.isReady()&&q.isEnabled()&&(!Q.cameraToUseForPointers||0!==(Q.cameraToUseForPointers.layerMask&q.layerMask))),!this._meshPickProceed&&(I&&I.HasTriggers||this._checkForPicking()||Q.onPointerUp)&&this._initActionManager(null,c),U||(U=this._currentPickResult),this._processPointerUp(U,q,c),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===q.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===q.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=q=>{const c=V.e.KEYDOWN;if(Q.onPreKeyboardObservable.hasObservers()){const U=new V.h(c,q);if(Q.onPreKeyboardObservable.notifyObservers(U,c),U.skipOnKeyboardObservable)return}if(Q.onKeyboardObservable.hasObservers()){const U=new V.j(c,q);Q.onKeyboardObservable.notifyObservers(U,c)}Q.actionManager&&Q.actionManager.processTrigger(14,r.CreateNewFromScene(Q,q))},this._onKeyUp=q=>{const c=V.e.KEYUP;if(Q.onPreKeyboardObservable.hasObservers()){const U=new V.h(c,q);if(Q.onPreKeyboardObservable.notifyObservers(U,c),U.skipOnKeyboardObservable)return}if(Q.onKeyboardObservable.hasObservers()){const U=new V.j(c,q);Q.onKeyboardObservable.notifyObservers(U,c)}Q.actionManager&&Q.actionManager.processTrigger(15,r.CreateNewFromScene(Q,q))},this._deviceSourceManager.onDeviceConnectedObservable.add((J=>{J.deviceType===t.Mouse?J.onInputChangedObservable.add((Q=>{this._originMouseEvent=Q,Q.inputIndex===C.LeftClick||Q.inputIndex===C.MiddleClick||Q.inputIndex===C.RightClick||Q.inputIndex===C.BrowserBack||Q.inputIndex===C.BrowserForward?c&&1===J.getInput(Q.inputIndex)?this._onPointerDown(Q):q&&0===J.getInput(Q.inputIndex)&&this._onPointerUp(Q):U&&(Q.inputIndex===C.Move?this._onPointerMove(Q):Q.inputIndex!==C.MouseWheelX&&Q.inputIndex!==C.MouseWheelY&&Q.inputIndex!==C.MouseWheelZ||this._onPointerMove(Q))})):J.deviceType===t.Touch?J.onInputChangedObservable.add((Q=>{Q.inputIndex===C.LeftClick&&(c&&1===J.getInput(Q.inputIndex)?(this._onPointerDown(Q),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):q&&0===J.getInput(Q.inputIndex)&&(this._onPointerUp(Q),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),U&&Q.inputIndex===C.Move&&this._onPointerMove(Q)})):J.deviceType===t.Keyboard&&J.onInputChangedObservable.add((q=>{"keydown"===q.type?this._onKeyDown(q):"keyup"===q.type&&this._onKeyUp(q)}))})),this._alreadyAttached=!0}Ou(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,U=arguments.length>2?arguments[2]:void 0,J=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[c]===q&&(!q||!q._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const Q=this._meshUnderPointerId[c];let s;Q&&(s=Q._getActionManagerForTrigger(10),s&&s.processTrigger(10,new r(Q,this._pointerX,this._pointerY,q,J,{pointerId:c}))),q?(this._meshUnderPointerId[c]=q,this._pointerOverMesh=q,s=q._getActionManagerForTrigger(9),s&&s.processTrigger(9,new r(q,this._pointerX,this._pointerY,q,J,{pointerId:c,pickResult:U}))):(delete this._meshUnderPointerId[c],this._pointerOverMesh=null),this._scene.onMeshUnderPointerUpdatedObservable.hasObservers()&&this._scene.onMeshUnderPointerUpdatedObservable.notifyObservers({mesh:q,pointerId:c})}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(q){this._pointerOverMesh===q&&(this._pointerOverMesh=null),this._pickedDownMesh===q&&(this._pickedDownMesh=null),this._pickedUpMesh===q&&(this._pickedUpMesh=null);for(const c in this._meshUnderPointerId)this._meshUnderPointerId[c]===q&&delete this._meshUnderPointerId[c]}}d.DragMovementThreshold=10,d.LongPressDelay=500,d.DoubleClickDelay=300,d.ExclusiveDoubleClickMode=!1;var e=U(11282),B=U(11093),N=U(11168),P=U(11414),w=U(10922),L=U(11100),l=U(10845);class j{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Mu=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var f,A=U(10886),E=U(10850);!function(q){q[q.BackwardCompatible=0]="BackwardCompatible",q[q.Intermediate=1]="Intermediate",q[q.Aggressive=2]="Aggressive"}(f||(f={}));class qq{static DefaultMaterialFactory(q){throw(0,p.d)("ec")}static CollisionCoordinatorFactory(){throw(0,p.d)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(q){q!==this._clearColor&&(this._clearColor=q,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(q){if(q!==this._performancePriority){switch(this._performancePriority=q,q){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Mu=!1,this.Gu=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Mu=!0,this.Gu=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Mu=!0,this.Gu=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(q)}}set forceWireframe(q){this._forceWireframe!==q&&(this._forceWireframe=q,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(q){this._skipFrustumClipping!==q&&(this._skipFrustumClipping=q)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(q){this._forcePointsCloud!==q&&(this._forcePointsCloud=q,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(q){this._environmentTexture!==q&&(this._environmentTexture=q,this.onEnvironmentTextureChangedObservable.notifyObservers(q),this.markAllMaterialsAsDirty(1))}getNodes(){let q=[];q=q.concat(this.meshes),q=q.concat(this.lights),q=q.concat(this.cameras),q=q.concat(this.transformNodes);for(const c of this.skeletons)q=q.concat(c.bones);return q}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(q){this._animationPropertiesOverride=q}set onDispose(q){this._onDisposeObserver&&this.Cc.remove(this._onDisposeObserver),this._onDisposeObserver=this.Cc.add(q)}set beforeRender(q){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),q&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(q))}set afterRender(q){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),q&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(q))}set beforeCameraRender(q){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(q)}set afterCameraRender(q){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(q)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(q){this._pointerPickingConfiguration.pointerDownPredicate=q}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(q){this._pointerPickingConfiguration.pointerUpPredicate=q}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(q){this._pointerPickingConfiguration.pointerMovePredicate=q}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(q){this._pointerPickingConfiguration.pointerDownFastCheck=q}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(q){this._pointerPickingConfiguration.pointerUpFastCheck=q}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(q){this._pointerPickingConfiguration.pointerMoveFastCheck=q}get Mu(){return this._pointerPickingConfiguration.Mu}set Mu(q){this._pointerPickingConfiguration.Mu=q}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(q){this._pointerPickingConfiguration.skipPointerDownPicking=q}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(q){this._pointerPickingConfiguration.skipPointerUpPicking=q}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return d.DragMovementThreshold}static set DragMovementThreshold(q){d.DragMovementThreshold=q}static get LongPressDelay(){return d.LongPressDelay}static set LongPressDelay(q){d.LongPressDelay=q}static get DoubleClickDelay(){return d.DoubleClickDelay}static set DoubleClickDelay(q){d.DoubleClickDelay=q}static get ExclusiveDoubleClickMode(){return d.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(q){d.ExclusiveDoubleClickMode=q}bindEyePosition(q){var c;let U=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",J=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const Q=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:(null===(c=this.activeCamera)||void 0===c?void 0:c.globalPosition)??W.p.ZeroReadOnly,s=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return W.j.Vector4[0].set(Q.x,Q.y,Q.z,s?-1:1),q&&(J?q.setFloat3(U,W.j.Vector4[0].x,W.j.Vector4[0].y,W.j.Vector4[0].z):q.setVector4(U,W.j.Vector4[0])),W.j.Vector4[0]}finalizeSceneUbo(){const q=this.getSceneUniformBuffer(),c=this.bindEyePosition(null);return q.updateFloat4("vEyePosition",c.x,c.y,c.z,c.w),q.update(),q}set useRightHandedSystem(q){this._useRightHandedSystem!==q&&(this._useRightHandedSystem=q,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(q){this._currentStepId=q}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(q){this._fogEnabled!==q&&(this._fogEnabled=q,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(q){this._fogMode!==q&&(this._fogMode=q,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(q){this._shadowsEnabled!==q&&(this._shadowsEnabled=q,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(q){this._lightsEnabled!==q&&(this._lightsEnabled=q,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(q){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),q&&(this._unObserveActiveCameras=(0,l.f)(q,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=q}get activeCamera(){return this._activeCamera}set activeCamera(q){q!==this._activeCamera&&(this._activeCamera=q,this.onActiveCameraChanged.notifyObservers(this))}get _hasDefaultMaterial(){return qq.DefaultMaterialFactory!==qq._OriginalDefaultMaterialFactory}get defaultMaterial(){return this.Xu||(this.Xu=qq.DefaultMaterialFactory(this)),this.Xu}set defaultMaterial(q){this.Xu=q}set texturesEnabled(q){this._texturesEnabled!==q&&(this._texturesEnabled=q,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(q){if(this._frameGraph)return this._frameGraph=q,void(q||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=q,q&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph,this.activeCamera=null)}set skeletonsEnabled(q){this._skeletonsEnabled!==q&&(this._skeletonsEnabled=q,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=qq.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const q of this._transientComponents)q.register();this._transientComponents.length=0}}nc(q){this._components.push(q),this._transientComponents.push(q);const c=q;c.addFromContainer&&c.serialize&&this._serializableComponents.push(c)}_getComponent(q){for(const c of this._components)if(c.name===q)return c;return null}get uniqueId(){return this._uniqueId}constructor(q,c){this._inputManager=new d(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Gu=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new B.e(.2,.2,.3,1),this.onClearColorChangedObservable=new s.e,this.ambientColor=new B.c(0,0,0),this.environmentIntensity=1,this.iblIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new s.e,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.qK=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.zK=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.Cc=new s.e,this._onDisposeObserver=null,this.onBeforeRenderObservable=new s.e,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new s.e,this.onAfterRenderCameraObservable=new s.e,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new s.e,this.onAfterAnimationsObservable=new s.e,this.onBeforeDrawPhaseObservable=new s.e,this.onAfterDrawPhaseObservable=new s.e,this.onReadyObservable=new s.e,this.onBeforeCameraRenderObservable=new s.e,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new s.e,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new s.e,this.onAfterActiveMeshesEvaluationObservable=new s.e,this.onBeforeParticlesRenderingObservable=new s.e,this.onAfterParticlesRenderingObservable=new s.e,this.onDataLoadedObservable=new s.e,this.onNewCameraAddedObservable=new s.e,this.onCameraRemovedObservable=new s.e,this.onNewLightAddedObservable=new s.e,this.onLightRemovedObservable=new s.e,this.onNewGeometryAddedObservable=new s.e,this.onGeometryRemovedObservable=new s.e,this.onNewTransformNodeAddedObservable=new s.e,this.onTransformNodeRemovedObservable=new s.e,this.onNewMeshAddedObservable=new s.e,this.onMeshRemovedObservable=new s.e,this.onNewSkeletonAddedObservable=new s.e,this.onSkeletonRemovedObservable=new s.e,this.onNewMaterialAddedObservable=new s.e,this.onNewMultiMaterialAddedObservable=new s.e,this.onMaterialRemovedObservable=new s.e,this.onMultiMaterialRemovedObservable=new s.e,this.onNewTextureAddedObservable=new s.e,this.onTextureRemovedObservable=new s.e,this.onBeforeRenderTargetsRenderObservable=new s.e,this.onAfterRenderTargetsRenderObservable=new s.e,this.onBeforeStepObservable=new s.e,this.onAfterStepObservable=new s.e,this.onActiveCameraChanged=new s.e,this.onActiveCamerasChanged=new s.e,this.onBeforeRenderingGroupObservable=new s.e,this.onAfterRenderingGroupObservable=new s.e,this.onMeshImportedObservable=new s.e,this.onAnimationFileImportedObservable=new s.e,this.onEnvironmentTextureChangedObservable=new s.e,this.onMeshUnderPointerUpdatedObservable=new s.e,this._registeredForLateAnimationBindings=new g.e(256),this._pointerPickingConfiguration=new j,this.onPrePointerObservable=new s.e,this.onPointerObservable=new s.e,this.onPreKeyboardObservable=new s.e,this.onKeyboardObservable=new s.e,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=qq.FOGMODE_NONE,this.fogColor=new B.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.frameGraphs=[],this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new W.p(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new g.e(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new e.e,this._activeIndices=new e.e,this._activeParticles=new e.e,this._activeBones=new e.e,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=[],this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new g.g(256),this._processedMaterials=new g.g(256),this._renderTargets=new g.e(256),this._materialsRenderTargets=new g.e(256),this._activeParticleSystems=new g.g(256),this._activeSkeletons=new g.e(32),this._softwareSkinnedMeshes=new g.e(32),this._activeAnimatables=new Array,this._transformMatrix=W.d.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=h.h.Create(),this._beforeClearStage=h.h.Create(),this._beforeRenderTargetClearStage=h.h.Create(),this._gatherRenderTargetsStage=h.h.Create(),this._gatherActiveCameraRenderTargetsStage=h.h.Create(),this._isReadyForMeshStage=h.h.Create(),this._beforeEvaluateActiveMeshStage=h.h.Create(),this._evaluateSubMeshStage=h.h.Create(),this._preActiveMeshStage=h.h.Create(),this._cameraDrawRenderTargetStage=h.h.Create(),this._beforeCameraDrawStage=h.h.Create(),this._beforeRenderTargetDrawStage=h.h.Create(),this._beforeRenderingGroupDrawStage=h.h.Create(),this._beforeRenderingMeshStage=h.h.Create(),this._afterRenderingMeshStage=h.h.Create(),this._afterRenderingGroupDrawStage=h.h.Create(),this._afterCameraDrawStage=h.h.Create(),this._afterCameraPostProcessStage=h.h.Create(),this._afterRenderTargetDrawStage=h.h.Create(),this._afterRenderTargetPostProcessStage=h.h.Create(),this._afterRenderStage=h.h.Create(),this._pointerMoveStage=h.h.Create(),this._pointerDownStage=h.h.Create(),this._pointerUpStage=h.h.Create(),this._geometriesByUniqueId=null,this._uniqueId=0,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._useCurrentFrameBuffer=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[],this._uniqueId=this.getUniqueId();const U={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...c};q=this._engine=q||a.c.LastCreatedEngine,U.virtual?q._virtualScenes.push(this):(a.c._LastCreatedScene=this,q.scenes.push(this)),this._uid=null,this._renderingManager=new b.d(this),H.d&&(this.postProcessManager=new H.d(this)),(0,o.j)()&&this.attachControl(),this._createUbo(),D.b&&(this._imageProcessingConfiguration=new D.b),this.setDefaultCandidateProviders(),U.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=U.useMaterialMeshMap,this.useClonedMeshMap=U.useClonedMeshMap,c&&c.virtual||q.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(q){return this._defaultSubMeshCandidates.data=q.Gc,this._defaultSubMeshCandidates.length=q.Gc.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=q=>this._getDefaultSubMeshCandidates(q),this.getIntersectingSubMeshCandidates=(q,c)=>this._getDefaultSubMeshCandidates(q),this.getCollidingSubMeshCandidates=(q,c)=>this._getDefaultSubMeshCandidates(q)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(q){this._inputManager.pointerX=q}get pointerY(){return this._inputManager.pointerY}set pointerY(q){this._inputManager.pointerY=q}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(q,c){let U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==c||this._cachedMaterial!==q||this._cachedVisibility!==U}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(q,c){return this._inputManager.simulatePointerMove(q,c),this}simulatePointerDown(q,c){return this._inputManager.simulatePointerDown(q,c),this}simulatePointerUp(q,c,U){return this._inputManager.simulatePointerUp(q,c,U),this}isPointerCaptured(){let q=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(q)}attachControl(){let q=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(q,c,U)}Ou(){this._inputManager.Ou()}isReady(){var q,c;let U,J=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const Q=this.getEngine(),s=Q.currentRenderPassId;Q.currentRenderPassId=(null===(q=this.activeCamera)||void 0===q?void 0:q.renderPassId)??s;let g=!0;for(this._pendingData.length>0&&(g=!1),null===(c=this.prePassRenderer)||void 0===c||c.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&g&&(g=this.depthPeelingRenderer.isReady()),J&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),U=0;U<this.meshes.length;U++){const q=this.meshes[U];if(!q.Gc||0===q.Gc.length)continue;if(!q.isReady(!0)){g=!1;continue}const c=q.hasThinInstances||"InstancedMesh"===q.getClassName()||"InstancedLinesMesh"===q.getClassName()||Q.getCaps().instancedArrays&&q.instances.length>0;for(const U of this._isReadyForMeshStage)U.action(q,c)||(g=!1);if(!J)continue;const s=q.material||this.defaultMaterial;if(s)if(s._storeEffectOnSubMeshes)for(const U of q.Gc){const q=U.zq();q&&q.hasRenderTargetTextures&&null!=q.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(q)&&(this._processedMaterials.push(q),this._materialsRenderTargets.concatWithNoDuplicate(q.getRenderTargetTextures()))}else s.hasRenderTargetTextures&&null!=s.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(s)&&(this._processedMaterials.push(s),this._materialsRenderTargets.concatWithNoDuplicate(s.getRenderTargetTextures()))}if(J)for(U=0;U<this._materialsRenderTargets.length;++U){this._materialsRenderTargets.data[U].isReadyForRendering()||(g=!1)}for(U=0;U<this.geometries.length;U++){2===this.geometries[U].delayLoadState&&(g=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const X of this.activeCameras)X.isReady(!0)||(g=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(g=!1));for(const X of this.qK)X.isReady()||(g=!1);if(this.layers)for(const X of this.layers)X.isReady()||(g=!1);if(this.effectLayers)for(const X of this.effectLayers)X.isLayerReady()||(g=!1);return Q.areAllEffectsReady()||(g=!1),Q.currentRenderPassId=s,g}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(q){this.onBeforeRenderObservable.add(q)}unregisterBeforeRender(q){this.onBeforeRenderObservable.removeCallback(q)}registerAfterRender(q){this.onAfterRenderObservable.add(q)}unregisterAfterRender(q){this.onAfterRenderObservable.removeCallback(q)}_executeOnceBeforeRender(q){const c=()=>{q(),setTimeout((()=>{this.unregisterBeforeRender(c)}))};this.registerBeforeRender(c)}executeOnceBeforeRender(q,c){void 0!==c?setTimeout((()=>{this._executeOnceBeforeRender(q)}),c):this._executeOnceBeforeRender(q)}addPendingData(q){this._pendingData.push(q)}removePendingData(q){const c=this.isLoading,U=this._pendingData.indexOf(q);-1!==U&&this._pendingData.splice(U,1),c&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(q),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(c)}async whenReadyAsync(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return await new Promise((c=>{this.executeWhenReady((()=>{c()}),q)}))}_checkIsReady(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(q)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(q)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=Q.d.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(q,c,U,J){U||J||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===q.updateFlag&&this._projectionUpdateFlag===c.updateFlag||(this._viewUpdateFlag=q.updateFlag,this._projectionUpdateFlag=c.updateFlag,this._viewMatrix=q,this._projectionMatrix=c,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?N.d.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=N.d.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(U,J):this._sceneUbo.useUbo&&(this._sceneUbo.vc("viewProjection",this._transformMatrix),this._sceneUbo.vc("view",this._viewMatrix),this._sceneUbo.vc("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(q){const c=new u.d(this._engine,void 0,!1,q??"mc");return c.addUniform("viewProjection",16),c.addUniform("view",16),c.addUniform("projection",16),c.addUniform("vEyePosition",4),c}setSceneUniformBuffer(q){this._sceneUbo=q,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return P.d.UniqueId}sD(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._blockEntityCollection&&(this.meshes.push(q),q._resyncLightSources(),q.parent||q._addToSceneRootNodes(),J.e.SetImmediate((()=>{this.onNewMeshAddedObservable.notifyObservers(q)})),c)){const c=q.getChildMeshes();for(const q of c)this.sD(q)}}QD(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const U=this.meshes.indexOf(q);if(-1!==U&&(this.meshes.splice(U,1),q.parent||q._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(q),this.onMeshRemovedObservable.notifyObservers(q),c){const c=q.getChildMeshes();for(const q of c)this.QD(q)}return U}addTransformNode(q){this._blockEntityCollection||q.Cq()===this&&-1!==q._indexInSceneTransformNodesArray||(q._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(q),q.parent||q._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(q))}removeTransformNode(q){const c=q._indexInSceneTransformNodesArray;if(-1!==c){if(c!==this.transformNodes.length-1){const q=this.transformNodes[this.transformNodes.length-1];this.transformNodes[c]=q,q._indexInSceneTransformNodesArray=c}q._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),q.parent||q._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(q),c}removeSkeleton(q){const c=this.skeletons.indexOf(q);return-1!==c&&(this.skeletons.splice(c,1),this.onSkeletonRemovedObservable.notifyObservers(q),this._executeActiveContainerCleanup(this._activeSkeletons)),c}removeMorphTargetManager(q){const c=this.morphTargetManagers.indexOf(q);return-1!==c&&this.morphTargetManagers.splice(c,1),c}removeLight(q){const c=this.lights.indexOf(q);if(-1!==c){for(const c of this.meshes)c._removeLightSource(q,!1);this.lights.splice(c,1),this.sortLightsByPriority(),q.parent||q._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(q),c}removeCamera(q){const c=this.cameras.indexOf(q);if(-1!==c&&(this.cameras.splice(c,1),q.parent||q._removeFromSceneRootNodes()),this.activeCameras){const c=this.activeCameras.indexOf(q);-1!==c&&this.activeCameras.splice(c,1)}return this.activeCamera===q&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(q),c}removeParticleSystem(q){const c=this.qK.indexOf(q);return-1!==c&&(this.qK.splice(c,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),c}removeAnimation(q){const c=this.animations.indexOf(q);return-1!==c&&this.animations.splice(c,1),c}stopAnimation(q,c,U){}removeAnimationGroup(q){const c=this.animationGroups.indexOf(q);return-1!==c&&this.animationGroups.splice(c,1),c}removeMultiMaterial(q){const c=this.multiMaterials.indexOf(q);return-1!==c&&this.multiMaterials.splice(c,1),this.onMultiMaterialRemovedObservable.notifyObservers(q),c}removeMaterial(q){const c=q._indexInSceneMaterialArray;if(-1!==c&&c<this.materials.length){if(c!==this.materials.length-1){const q=this.materials[this.materials.length-1];this.materials[c]=q,q._indexInSceneMaterialArray=c}q._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(q),c}removeActionManager(q){const c=this.actionManagers.indexOf(q);return-1!==c&&this.actionManagers.splice(c,1),c}removeTexture(q){const c=this.textures.indexOf(q);return-1!==c&&this.textures.splice(c,1),this.onTextureRemovedObservable.notifyObservers(q),c}addLight(q){if(!this._blockEntityCollection){this.lights.push(q),this.sortLightsByPriority(),q.parent||q._addToSceneRootNodes();for(const c of this.meshes)-1===c.lightSources.indexOf(q)&&(c.lightSources.push(q),c._resyncLightSources());J.e.SetImmediate((()=>{this.onNewLightAddedObservable.notifyObservers(q)}))}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(L.b.CompareLightsPriority)}addCamera(q){this._blockEntityCollection||(this.cameras.push(q),J.e.SetImmediate((()=>{this.onNewCameraAddedObservable.notifyObservers(q)})),q.parent||q._addToSceneRootNodes())}addSkeleton(q){this._blockEntityCollection||(this.skeletons.push(q),J.e.SetImmediate((()=>{this.onNewSkeletonAddedObservable.notifyObservers(q)})))}addParticleSystem(q){this._blockEntityCollection||this.qK.push(q)}addAnimation(q){this._blockEntityCollection||this.animations.push(q)}addAnimationGroup(q){this._blockEntityCollection||this.animationGroups.push(q)}addMultiMaterial(q){this._blockEntityCollection||(this.multiMaterials.push(q),J.e.SetImmediate((()=>{this.onNewMultiMaterialAddedObservable.notifyObservers(q)})))}addMaterial(q){this._blockEntityCollection||q.Cq()===this&&-1!==q._indexInSceneMaterialArray||(q._indexInSceneMaterialArray=this.materials.length,this.materials.push(q),J.e.SetImmediate((()=>{this.onNewMaterialAddedObservable.notifyObservers(q)})))}addMorphTargetManager(q){this._blockEntityCollection||this.morphTargetManagers.push(q)}addGeometry(q){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[q.uniqueId]=this.geometries.length),this.geometries.push(q))}addActionManager(q){this.actionManagers.push(q)}addTexture(q){this._blockEntityCollection||(this.textures.push(q),this.onNewTextureAddedObservable.notifyObservers(q))}switchActiveCamera(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Ou(),this.activeCamera=q,c&&q.attachControl())}setActiveCameraById(q){const c=this.getCameraById(q);return c?(this.activeCamera=c,c):null}setActiveCameraByName(q){const c=this.getCameraByName(q);return c?(this.activeCamera=c,c):null}getAnimationGroupByName(q){for(let c=0;c<this.animationGroups.length;c++)if(this.animationGroups[c].name===q)return this.animationGroups[c];return null}_getMaterial(q,c){for(let U=0;U<this.materials.length;U++){const q=this.materials[U];if(c(q))return q}if(q)for(let U=0;U<this.multiMaterials.length;U++){const q=this.multiMaterials[U];if(c(q))return q}return null}getMaterialByUniqueID(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.getMaterialByUniqueId(q,c)}getMaterialByUniqueId(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.uniqueId===q))}getMaterialById(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.id===q))}getMaterialByName(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(c,(c=>c.name===q))}getLastMaterialById(q){let c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let U=this.materials.length-1;U>=0;U--)if(this.materials[U].id===q)return this.materials[U];if(c)for(let U=this.multiMaterials.length-1;U>=0;U--)if(this.multiMaterials[U].id===q)return this.multiMaterials[U];return null}getTextureByUniqueId(q){for(let c=0;c<this.textures.length;c++)if(this.textures[c].uniqueId===q)return this.textures[c];return null}getTextureByName(q){for(let c=0;c<this.textures.length;c++)if(this.textures[c].name===q)return this.textures[c];return null}getCameraById(q){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].id===q)return this.cameras[c];return null}getCameraByUniqueId(q){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].uniqueId===q)return this.cameras[c];return null}getCameraByName(q){for(let c=0;c<this.cameras.length;c++)if(this.cameras[c].name===q)return this.cameras[c];return null}getBoneById(q){for(let c=0;c<this.skeletons.length;c++){const U=this.skeletons[c];for(let c=0;c<U.bones.length;c++)if(U.bones[c].id===q)return U.bones[c]}return null}getBoneByName(q){for(let c=0;c<this.skeletons.length;c++){const U=this.skeletons[c];for(let c=0;c<U.bones.length;c++)if(U.bones[c].name===q)return U.bones[c]}return null}getLightByName(q){for(let c=0;c<this.lights.length;c++)if(this.lights[c].name===q)return this.lights[c];return null}getLightById(q){for(let c=0;c<this.lights.length;c++)if(this.lights[c].id===q)return this.lights[c];return null}getLightByUniqueId(q){for(let c=0;c<this.lights.length;c++)if(this.lights[c].uniqueId===q)return this.lights[c];return null}getParticleSystemById(q){for(let c=0;c<this.qK.length;c++)if(this.qK[c].id===q)return this.qK[c];return null}getGeometryById(q){for(let c=0;c<this.geometries.length;c++)if(this.geometries[c].id===q)return this.geometries[c];return null}_getGeometryByUniqueId(q){if(this._geometriesByUniqueId){const c=this._geometriesByUniqueId[q];if(void 0!==c)return this.geometries[c]}else for(let c=0;c<this.geometries.length;c++)if(this.geometries[c].uniqueId===q)return this.geometries[c];return null}getFrameGraphByName(q){for(let c=0;c<this.frameGraphs.length;c++)if(this.frameGraphs[c].name===q)return this.frameGraphs[c];return null}pushGeometry(q,c){return!(!c&&this._getGeometryByUniqueId(q.uniqueId))&&(this.addGeometry(q),J.e.SetImmediate((()=>{this.onNewGeometryAddedObservable.notifyObservers(q)})),!0)}removeGeometry(q){let c;if(this._geometriesByUniqueId){if(c=this._geometriesByUniqueId[q.uniqueId],void 0===c)return!1}else if(c=this.geometries.indexOf(q),c<0)return!1;if(c!==this.geometries.length-1){const q=this.geometries[this.geometries.length-1];q&&(this.geometries[c]=q,this._geometriesByUniqueId&&(this._geometriesByUniqueId[q.uniqueId]=c))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[q.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(q),!0}getGeometries(){return this.geometries}getMeshById(q){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].id===q)return this.meshes[c];return null}getMeshesById(q){return this.meshes.filter((function(c){return c.id===q}))}getTransformNodeById(q){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].id===q)return this.transformNodes[c];return null}getTransformNodeByUniqueId(q){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].uniqueId===q)return this.transformNodes[c];return null}getTransformNodesById(q){return this.transformNodes.filter((function(c){return c.id===q}))}getMeshByUniqueId(q){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].uniqueId===q)return this.meshes[c];return null}getLastMeshById(q){for(let c=this.meshes.length-1;c>=0;c--)if(this.meshes[c].id===q)return this.meshes[c];return null}getLastTransformNodeById(q){for(let c=this.transformNodes.length-1;c>=0;c--)if(this.transformNodes[c].id===q)return this.transformNodes[c];return null}getLastEntryById(q){let c;for(c=this.meshes.length-1;c>=0;c--)if(this.meshes[c].id===q)return this.meshes[c];for(c=this.transformNodes.length-1;c>=0;c--)if(this.transformNodes[c].id===q)return this.transformNodes[c];for(c=this.cameras.length-1;c>=0;c--)if(this.cameras[c].id===q)return this.cameras[c];for(c=this.lights.length-1;c>=0;c--)if(this.lights[c].id===q)return this.lights[c];return null}getNodeById(q){const c=this.getMeshById(q);if(c)return c;const U=this.getTransformNodeById(q);if(U)return U;const J=this.getLightById(q);if(J)return J;const Q=this.getCameraById(q);if(Q)return Q;const s=this.getBoneById(q);return s||null}getNodeByName(q){const c=this.getMeshByName(q);if(c)return c;const U=this.getTransformNodeByName(q);if(U)return U;const J=this.getLightByName(q);if(J)return J;const Q=this.getCameraByName(q);if(Q)return Q;const s=this.getBoneByName(q);return s||null}getMeshByName(q){for(let c=0;c<this.meshes.length;c++)if(this.meshes[c].name===q)return this.meshes[c];return null}getTransformNodeByName(q){for(let c=0;c<this.transformNodes.length;c++)if(this.transformNodes[c].name===q)return this.transformNodes[c];return null}getLastSkeletonById(q){for(let c=this.skeletons.length-1;c>=0;c--)if(this.skeletons[c].id===q)return this.skeletons[c];return null}getSkeletonByUniqueId(q){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].uniqueId===q)return this.skeletons[c];return null}getSkeletonById(q){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].id===q)return this.skeletons[c];return null}getSkeletonByName(q){for(let c=0;c<this.skeletons.length;c++)if(this.skeletons[c].name===q)return this.skeletons[c];return null}getMorphTargetManagerById(q){for(let c=0;c<this.morphTargetManagers.length;c++)if(this.morphTargetManagers[c].uniqueId===q)return this.morphTargetManagers[c];return null}getMorphTargetById(q){for(let c=0;c<this.morphTargetManagers.length;++c){const U=this.morphTargetManagers[c];for(let c=0;c<U.numTargets;++c){const J=U.getTarget(c);if(J.id===q)return J}}return null}getMorphTargetByName(q){for(let c=0;c<this.morphTargetManagers.length;++c){const U=this.morphTargetManagers[c];for(let c=0;c<U.numTargets;++c){const J=U.getTarget(c);if(J.name===q)return J}}return null}getPostProcessByName(q){for(let c=0;c<this.postProcesses.length;++c){const U=this.postProcesses[c];if(U.name===q)return U}return null}isActiveMesh(q){return-1!==this._activeMeshes.indexOf(q)}get uid(){return this._uid||(this._uid=J.e.RandomId()),this._uid}addExternalData(q,c){return this._externalData||(this._externalData=new X),this._externalData.add(q,c)}getExternalData(q){return this._externalData?this._externalData.get(q):null}getOrAddExternalDataWithFactory(q,c){return this._externalData||(this._externalData=new X),this._externalData.getOrAddWithFactory(q,c)}removeExternalData(q){return this._externalData.remove(q)}_evaluateSubMesh(q,c,U,J){if(J||q.isInFrustum(this._frustumPlanes)){for(const J of this._evaluateSubMeshStage)J.action(c,q);const U=q.zq();null!==U&&void 0!==U&&(U.hasRenderTargetTextures&&null!=U.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(U)&&(this._processedMaterials.push(U),this._materialsRenderTargets.concatWithNoDuplicate(U.getRenderTargetTextures())),this._renderingManager.dispatch(q,c,U))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(q){this._preventFreeActiveMeshesAndRenderingGroups!==q&&(q&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=q)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let q=0;q<this.activeCameras.length;q++){const c=this.activeCameras[q];c&&c._activeMeshes&&c._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let q=0;q<this.textures.length;q++){const c=this.textures[q];c&&c.renderList&&c.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let q=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=arguments.length>1?arguments[1]:void 0,U=arguments.length>2?arguments[2]:void 0,J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],Q=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=Q,this._skipEvaluateActiveMeshesCompletely=q,J)for(let q=0;q<this._activeMeshes.length;q++)this._activeMeshes.data[q]._freeze();c&&c()}else U&&U("No active camera found")})),this}unfreezeActiveMeshes(){for(let q=0;q<this.meshes.length;q++){const c=this.meshes[q];c._internalAbstractMeshDataInfo&&(c._internalAbstractMeshDataInfo._isActive=!1)}for(let q=0;q<this._activeMeshes.length;q++)this._activeMeshes.data[q]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(q){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>q.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var q;if(this._activeMeshes.length>0)null===(q=this.activeCamera)||void 0===q||q._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const q=this._activeMeshes.length;for(let c=0;c<q;c++){this._activeMeshes.data[c].o()}}if(this._activeParticleSystems){const q=this._activeParticleSystems.length;for(let c=0;c<q;c++)this._activeParticleSystems.data[c].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const J of this._beforeEvaluateActiveMeshStage)J.action();const c=this.getActiveMeshCandidates(),U=c.length;for(let J=0;J<U;J++){const q=c.data[J];let U=q._internalAbstractMeshDataInfo._currentLOD.get(this.activeCamera);if(U?U[1]=-1:(U=[q,-1],q._internalAbstractMeshDataInfo._currentLOD.set(this.activeCamera,U)),q.isBlocked)continue;if(this._totalVertices.addCount(q.getTotalVertices(),!1),!q.isReady()||!q.isEnabled()||q.ac.hasAZeroComponent)continue;q.o(),q.actionManager&&q.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(q);let Q=this.customLODSelector?this.customLODSelector(q,this.activeCamera):q.getLOD(this.activeCamera);if(U[0]=Q,U[1]=this._frameId,void 0!==Q&&null!==Q&&(Q!==q&&0!==Q.billboardMode&&Q.o(),q._preActivate(),q.isVisible&&q.visibility>0&&0!==(q.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||q.Tg||q.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(q),this.activeCamera._activeMeshes.push(q),Q!==q&&Q._activate(this._renderId,!1);for(const c of this._preActiveMeshStage)c.action(q);q._activate(this._renderId,!1)&&(q.isAnInstance?q._internalAbstractMeshDataInfo._actAsRegularMesh&&(Q=q):Q._internalAbstractMeshDataInfo._onlyForInstances=!1,Q._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(q,Q)),q._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let q=0;q<this.qK.length;q++){const c=this.qK[q];if(!c.isStarted()||!c.j)continue;const U=c.j;U.position&&!U.isEnabled()||(this._activeParticleSystems.push(c),c.animate(),this._renderingManager.dispatchParticles(c))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(q){this._skeletonsEnabled&&q.skeleton&&(this._activeSkeletons.pushNoDuplicate(q.skeleton)&&(q.skeleton.prepare(),this._activeBones.addCount(q.skeleton.bones.length,!1)),q.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(q)&&this.frameGraph&&q.applySkeleton(q.skeleton))}_activeMesh(q,c){this._prepareSkeleton(c);let U=q.hasInstances||q.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||c.Tg;if(c&&c.Gc&&c.Gc.length>0){const J=this.getActiveSubMeshCandidates(c),Q=J.length;U=U||1===Q;for(let s=0;s<Q;s++){const Q=J.data[s];this._evaluateSubMesh(Q,c,q,U)}}}updateTransformMatrix(q){const c=this.activeCamera;if(c)if(c._renderingMultiview){const U=c._rigCameras[0],J=c._rigCameras[1];this.setTransformMatrix(U.getViewMatrix(),U.getProjectionMatrix(q),J.getViewMatrix(),J.getProjectionMatrix(q))}else this.setTransformMatrix(c.getViewMatrix(),c.getProjectionMatrix(q))}_bindFrameBuffer(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._useCurrentFrameBuffer||(q&&q._multiviewTexture?q._multiviewTexture._bindFrameBuffer():q&&q.outputRenderTarget?q.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer()),c&&this._clearFrameBuffer(q)}_clearFrameBuffer(q){if(q&&q._multiviewTexture);else if(q&&q.outputRenderTarget&&!q._renderingMultiview){const c=q.outputRenderTarget;c.onClearObservable.hasObservers()?c.onClearObservable.notifyObservers(this._engine):c.skipInitialClear||q.isRightCamera||(this.Gu&&this._engine.clear(c.clearColor||this._clearColor,!c._cleared,!0,!0),c._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(q,c){var U;let Q=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(q&&q._skipRendering)return;const s=this._engine;if(this._activeCamera=q,!this.activeCamera)throw new Error("Active camera not set");if(s.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&Q){let c=!0;q._renderingMultiview&&q.outputRenderTarget&&(c=q.outputRenderTarget.skipInitialClear,this.Gu&&(this._defaultFrameBufferCleared=!1,q.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),q._renderingMultiview&&q.outputRenderTarget&&(q.outputRenderTarget.skipInitialClear=c)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let J=0;J<this._softwareSkinnedMeshes.length;J++){const q=this._softwareSkinnedMeshes.data[J];q.applySkeleton(q.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),q.customRenderTargets&&q.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(q.customRenderTargets),c&&c.customRenderTargets&&c.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(c.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const J of this._gatherActiveCameraRenderTargetsStage)J.action(this._renderTargets);let g=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){J.e.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let q=0;q<this._renderTargets.length;q++){const c=this._renderTargets.data[q];if(c._shouldRender()){this._renderId++;const q=c.activeCamera&&c.activeCamera!==this.activeCamera;c.render(q,this.dumpNextRenderTargets),g=!0}}J.e.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const q of this._cameraDrawRenderTargetStage)g=q.action(this.activeCamera)||g;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(U=q.outputRenderTarget)||void 0===U?void 0:U.renderPassId)??q.renderPassId??0,g&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||q._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const J of this._beforeCameraDrawStage)J.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),s.snapshotRendering&&1===s.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const J of this._afterCameraDrawStage)J.action(this.activeCamera);if(this.postProcessManager&&!q._multiviewTexture){const c=q.outputRenderTarget?q.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(q.isIntermediate,c)}for(const J of this._afterCameraPostProcessStage)J.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(q){let c=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===q.cameraRigMode||q._renderingMultiview)return q._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(q,void 0,c),void this.onAfterRenderCameraObservable.notifyObservers(q);if(q._useMultiviewToSingleView)this._renderMultiviewToSingleView(q);else{this.onBeforeCameraRenderObservable.notifyObservers(q);for(let c=0;c<q._rigCameras.length;c++)this._renderForCamera(q._rigCameras[c],q)}this._activeCamera=q,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(q)}_checkIntersections(){for(let q=0;q<this._meshesForIntersections.length;q++){const c=this._meshesForIntersections.data[q];if(c.actionManager)for(let q=0;c.actionManager&&q<c.actionManager.actions.length;q++){const U=c.actionManager.actions[q];if(12===U.trigger||13===U.trigger){const q=U.getTriggerParameter(),J=q.mesh?q.mesh:q,Q=J.intersectsMesh(c,q.usePreciseIntersection),s=c._intersectionsInProgress.indexOf(J);Q&&-1===s?12===U.trigger?(U._executeCurrent(r.CreateNew(c,void 0,J)),c._intersectionsInProgress.push(J)):13===U.trigger&&c._intersectionsInProgress.push(J):!Q&&s>-1&&(13===U.trigger&&U._executeCurrent(r.CreateNew(c,void 0,J)),c.actionManager.hasSpecificTrigger(13,(q=>{const c=q.mesh?q.mesh:q;return J===c}))&&13!==U.trigger||c._intersectionsInProgress.splice(s,1))}}}}_advancePhysicsEngineStep(q){}_animate(q){}animate(){if(this._engine.isDeterministicLockStep()){let q=Math.max(qq.MinDeltaTime,Math.min(this._engine.getDeltaTime(),qq.MaxDeltaTime))+this._timeAccumulator;const c=this._engine.getTimeStep(),U=1e3/c/1e3;let J=0;const Q=this._engine.getLockstepMaxSteps();let s=Math.floor(q/c);for(s=Math.min(s,Q);q>0&&J<s;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=c*U,this._animate(c),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(c),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,J++,q-=c;this._timeAccumulator=q<0?0:q}else{const q=this.useConstantAnimationDeltaTime?16:Math.max(qq.MinDeltaTime,Math.min(this._engine.getDeltaTime(),qq.MaxDeltaTime));this._animationRatio=.06*q,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(q)}}_clear(){(this.autoClearDepthAndStencil||this.Gu)&&this._engine.clear(this._clearColor,this.Gu||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(q){var c;if(null===q||void 0===q||!q.outputRenderTarget||null!==q&&void 0!==q&&q.isRigCamera||(q.outputRenderTarget._cleared=!1),null!==q&&void 0!==q&&null!==(c=q.rigCameras)&&void 0!==c&&c.length)for(let U=0;U<q.rigCameras.length;++U){const c=q.rigCameras[U].outputRenderTarget;c&&(c._cleared=!1)}}resetDrawCache(q){if(this.meshes)for(const c of this.meshes)c.resetDrawCache(q)}_renderWithFrameGraph(){var q;let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),c)for(const Q of this.cameras)if(Q.update(),0!==Q.cameraRigMode)for(let q=0;q<Q._rigCameras.length;q++)Q._rigCameras[q].update();this.onBeforeRenderObservable.notifyObservers(this);for(const Q of this._beforeClearStage)Q.action();const U=this.getActiveMeshCandidates(),J=U.length;for(let Q=0;Q<J;Q++){const q=U.data[Q];q.isBlocked||(this._totalVertices.addCount(q.getTotalVertices(),!1),q.isReady()&&q.isEnabled()&&!q.ac.hasAZeroComponent&&(q.o(),q.actionManager&&q.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(q)))}if(this.particlesEnabled)for(let Q=0;Q<this.qK.length;Q++){const q=this.qK[Q];if(!q.isStarted()||!q.j)continue;const c=q.j;c.position&&!c.isEnabled()||(this._activeParticleSystems.push(q),q.animate())}null===(q=this.frameGraph)||void 0===q||q.execute()}_renderRenderTarget(q,c){let U=arguments.length>2&&void 0!==arguments[2]&&arguments[2],J=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._intermediateRendering=!0,q._shouldRender()){if(this._renderId++,this.activeCamera=c,!this.activeCamera)throw new Error("Active camera not set");this._engine.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),q.render(U,J)}this._intermediateRendering=!1}render(){var q;let c=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],U=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){if(this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(q=this.activeCameras)&&void 0!==q&&q.length)for(const q of this.activeCameras)this._checkCameraRenderTarget(q);this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),U||this.animate();for(const q of this._beforeCameraUpdateStage)q.action();if(c)if(this.activeCameras&&this.activeCameras.length>0)for(let q=0;q<this.activeCameras.length;q++){const c=this.activeCameras[q];if(c.update(),0!==c.cameraRigMode)for(let q=0;q<c._rigCameras.length;q++)c._rigCameras[q].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let q=0;q<this.activeCamera._rigCameras.length;q++)this.activeCamera._rigCameras[q].update();if(this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(c,U);else{var Q;this.onBeforeRenderObservable.notifyObservers(this),this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const q=null!==(Q=this.activeCameras)&&void 0!==Q&&Q.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){J.e.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0);for(let c=0;c<this.customRenderTargets.length;c++){const U=this.customRenderTargets[c],J=U.activeCamera||this.activeCamera;this._renderRenderTarget(U,J,q!==J,this.dumpNextRenderTargets)}J.e.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._renderId++}this._engine.currentRenderPassId=(null===q||void 0===q?void 0:q.renderPassId)??0,this.activeCamera=q,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const c of this._beforeClearStage)c.action();this._clearFrameBuffer(this.activeCamera);for(const c of this._gatherRenderTargetsStage)c.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let c=0;c<this.activeCameras.length;c++)this._processSubCameras(this.activeCameras[c],c>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const q of this._afterRenderStage)q.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let q=0;q<this._toBeDisposed.length;q++){const c=this._toBeDisposed[q];c&&c.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let q=0;q<this.materials.length;q++)this.materials[q].freeze()}unfreezeMaterials(){for(let q=0;q<this.materials.length;q++)this.materials[q].unfreeze()}dispose(){if(this.u)return;if(this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations){for(const q of this._activeAnimatables)q.onAnimationEndObservable.clear(),q.onAnimationEnd=null;this.stopAllAnimations()}this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const q=this._activeRequests.slice();for(const Q of q)Q.abort();this._activeRequests.length=0;try{this.Cc.notifyObservers(this)}catch(J){A.c.Error("An error occurred while calling onDisposeObservable!",J)}this.Ou();if(this._engine.getInputElement())for(let Q=0;Q<this.cameras.length;Q++)this.cameras[Q].Ou();this._disposeList(this.animationGroups),this._disposeList(this.lights),this.Xu&&this.Xu.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.meshes,(q=>q.dispose(!0))),this._disposeList(this.transformNodes,(q=>q.dispose(!0)));const c=this.cameras;this._disposeList(c),this._disposeList(this.qK),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let U=this._engine.scenes.indexOf(this);if(U>-1&&this._engine.scenes.splice(U,1),a.c._LastCreatedScene===this){a.c._LastCreatedScene=null;let q=a.c.Instances.length-1;for(;q>=0;){const c=a.c.Instances[q];if(c.scenes.length>0){a.c._LastCreatedScene=c.scenes[this._engine.scenes.length-1];break}q--}}U=this._engine._virtualScenes.indexOf(this),U>-1&&this._engine._virtualScenes.splice(U,1),this._engine.wipeCaches(!0),this.Cc.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this.onEnvironmentTextureChangedObservable.clear(),this.onMeshUnderPointerUpdatedObservable.clear(),this._isDisposed=!0}_disposeList(q,c){const U=q.slice(0);c=c??(q=>q.dispose());for(const J of U)c(J);q.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let q=0;q<this.meshes.length;q++){const c=this.meshes[q].Dc;c&&c.clearCachedData()}}cleanCachedTextureBuffer(){for(const q of this.textures){q._buffer&&(q._buffer=null)}}getWorldExtends(q){const c=new W.p(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),U=new W.p(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);q=q||(()=>!0);const J=this.meshes.filter(q);for(const Q of J){if(Q.o(!0),!Q.Gc||0===Q.Gc.length||Q.infiniteDistance)continue;const q=Q.getBoundingInfo(),J=q.boundingBox.minimumWorld,s=q.boundingBox.maximumWorld;W.p.CheckExtends(J,c,U),W.p.CheckExtends(s,c,U)}return{min:c,max:U}}createPickingRay(q,c,U,J){throw(0,p.d)("Ray")}createPickingRayToRef(q,c,U,J,Q){throw(0,p.d)("Ray")}createPickingRayInCameraSpace(q,c,U){throw(0,p.d)("Ray")}createPickingRayInCameraSpaceToRef(q,c,U,J){throw(0,p.d)("Ray")}dU(q,c,U,J,Q,s){const g=(0,p.d)("Ray",!0);return g&&A.c.Warn(g),new K.c}pickWithBoundingInfo(q,c,U,J,Q){const s=(0,p.d)("Ray",!0);return s&&A.c.Warn(s),new K.c}pickWithRay(q,c,U,J){throw(0,p.d)("Ray")}multiPick(q,c,U,J,Q){throw(0,p.d)("Ray")}multiPickWithRay(q,c,U){throw(0,p.d)("Ray")}setPointerOverMesh(q,c,U){this._inputManager.setPointerOverMesh(q,c,U)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const q of this.geometries)q._rebuild();for(const q of this.meshes)q._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const q of this._components)q.rebuild();for(const q of this.qK)q.rebuild();if(this.spriteManagers)for(const q of this.spriteManagers)q.rebuild()}_rebuildTextures(){for(const q of this.textures)q._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(q,c,U){if(void 0===c)return q;const J=[];for(const Q in q){const s=q[Q];n.d&&n.d.MatchesQuery(s,c)&&(!U||U(s))&&J.push(s)}return J}getMeshesByTags(q,c){return this._getByTags(this.meshes,q,c)}getCamerasByTags(q,c){return this._getByTags(this.cameras,q,c)}getLightsByTags(q,c){return this._getByTags(this.lights,q,c)}getMaterialByTags(q,c){return this._getByTags(this.materials,q,c).concat(this._getByTags(this.multiMaterials,q,c))}getTransformNodesByTags(q,c){return this._getByTags(this.transformNodes,q,c)}setRenderingOrder(q){let c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,U=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,J=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(q,c,U,J)}setRenderingAutoClearDepthStencil(q,c){let U=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],J=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(q,c,U,J)}getAutoClearDepthStencilSetup(q){return this._renderingManager.getAutoClearDepthStencilSetup(q)}_forceBlockMaterialDirtyMechanism(q){this._blockMaterialDirtyMechanism=q}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(q){this._blockMaterialDirtyMechanism!==q&&(this._blockMaterialDirtyMechanism=q,q||this.markAllMaterialsAsDirty(127))}markAllMaterialsAsDirty(q,c){if(!this._blockMaterialDirtyMechanism)for(const U of this.materials)c&&!c(U)||U.PW(q)}_loadFile(q,c,U,J,Q,s,g){const X=(0,w.q)(q,c,U,J?this.offlineProvider:void 0,Q,s,g);return this._activeRequests.push(X),X.onCompleteObservable.add((q=>{this._activeRequests.splice(this._activeRequests.indexOf(q),1)})),X}async _loadFileAsync(q,c,U,J,Q){return await new Promise(((s,g)=>{this._loadFile(q,(q=>{s(q)}),c,U,J,((q,c)=>{g(c)}),Q)}))}_requestFile(q,c,U,J,Q,s,g){const X=(0,w.v)(q,c,U,J?this.offlineProvider:void 0,Q,s,g);return this._activeRequests.push(X),X.onCompleteObservable.add((q=>{this._activeRequests.splice(this._activeRequests.indexOf(q),1)})),X}async _requestFileAsync(q,c,U,J,Q){return await new Promise(((s,g)=>{this._requestFile(q,(q=>{s(q)}),c,U,J,(q=>{g(q)}),Q)}))}_readFile(q,c,U,J,Q){const s=(0,w.t)(q,c,U,J,Q);return this._activeRequests.push(s),s.onCompleteObservable.add((q=>{this._activeRequests.splice(this._activeRequests.indexOf(q),1)})),s}async _readFileAsync(q,c,U){return await new Promise(((J,Q)=>{this._readFile(q,(q=>{J(q)}),c,U,(q=>{Q(q)}))}))}getPerfCollector(){throw(0,p.d)("performanceViewerSceneExtension")}setActiveCameraByID(q){return this.setActiveCameraById(q)}getMaterialByID(q){return this.getMaterialById(q)}getLastMaterialByID(q){return this.getLastMaterialById(q)}getTextureByUniqueID(q){return this.getTextureByUniqueId(q)}getCameraByID(q){return this.getCameraById(q)}getCameraByUniqueID(q){return this.getCameraByUniqueId(q)}getBoneByID(q){return this.getBoneById(q)}getLightByID(q){return this.getLightById(q)}getLightByUniqueID(q){return this.getLightByUniqueId(q)}getParticleSystemByID(q){return this.getParticleSystemById(q)}getGeometryByID(q){return this.getGeometryById(q)}getMeshByID(q){return this.getMeshById(q)}getMeshByUniqueID(q){return this.getMeshByUniqueId(q)}getLastMeshByID(q){return this.getLastMeshById(q)}getMeshesByID(q){return this.getMeshesById(q)}getTransformNodeByID(q){return this.getTransformNodeById(q)}getTransformNodeByUniqueID(q){return this.getTransformNodeByUniqueId(q)}getTransformNodesByID(q){return this.getTransformNodesById(q)}getNodeByID(q){return this.getNodeById(q)}getLastEntryByID(q){return this.getLastEntryById(q)}getLastSkeletonByID(q){return this.getLastSkeletonById(q)}}qq.FOGMODE_NONE=0,qq.FOGMODE_EXP=1,qq.FOGMODE_EXP2=2,qq.FOGMODE_LINEAR=3,qq.MinDeltaTime=1,qq.MaxDeltaTime=1e3,qq._OriginalDefaultMaterialFactory=qq.DefaultMaterialFactory,(0,E.f)("BABYLON.Scene",qq)},11192:(q,c,U)=>{U.d(c,{d:()=>J,h:()=>Q});class J{}J.NAME_EFFECTLAYER="EffectLayer",J.NAME_LAYER="Layer",J.NAME_LENSFLARESYSTEM="LensFlareSystem",J.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",J.NAME_PARTICLESYSTEM="Lc",J.NAME_GAMEPAD="Gamepad",J.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",J.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",J.NAME_PREPASSRENDERER="PrePassRenderer",J.NAME_DEPTHRENDERER="DepthRenderer",J.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",J.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",J.NAME_SPRITE="Sprite",J.NAME_SUBSURFACE="SubSurface",J.NAME_OUTLINERENDERER="Outline",J.NAME_PROCEDURALTEXTURE="ProceduralTexture",J.NAME_SHADOWGENERATOR="ShadowGenerator",J.NAME_OCTREE="lc",J.NAME_PHYSICSENGINE="PhysicsEngine",J.NAME_AUDIO="Audio",J.NAME_FLUIDRENDERER="FluidRenderer",J.NAME_IBLCDFGENERATOR="iblCDFGenerator",J.STEP_ISREADYFORMESH_EFFECTLAYER=0,J.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,J.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,J.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,J.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,J.STEP_BEFORECAMERADRAW_PREPASS=0,J.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,J.STEP_BEFORECAMERADRAW_LAYER=2,J.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,J.STEP_BEFORERENDERTARGETDRAW_LAYER=1,J.STEP_BEFORERENDERINGMESH_PREPASS=0,J.STEP_BEFORERENDERINGMESH_OUTLINE=1,J.STEP_AFTERRENDERINGMESH_PREPASS=0,J.STEP_AFTERRENDERINGMESH_OUTLINE=1,J.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,J.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,J.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,J.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,J.STEP_BEFORECLEAR_PREPASS=1,J.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,J.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,J.STEP_AFTERRENDERTARGETDRAW_LAYER=1,J.STEP_AFTERCAMERADRAW_PREPASS=0,J.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,J.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,J.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,J.STEP_AFTERCAMERADRAW_LAYER=4,J.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,J.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,J.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,J.STEP_AFTERRENDER_AUDIO=0,J.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,J.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,J.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,J.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,J.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,J.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,J.STEP_POINTERMOVE_SPRITE=0,J.STEP_POINTERDOWN_SPRITE=0,J.STEP_POINTERUP_SPRITE=0;class Q extends Array{constructor(q){super(...q)}static Create(){return Object.create(Q.prototype)}registerStep(q,c,U){let J=0,Q=Number.MAX_VALUE;for(;J<this.length;J++){if(Q=this[J].index,q<Q)break}this.splice(J,0,{index:q,component:c,action:U.bind(c)})}clear(){this.length=0}}},11010:(q,c,U)=>{U.d(c,{d:()=>J});function J(q,c,U,J){var Q,s=arguments.length,g=s<3?c:null===J?J=Object.getOwnPropertyDescriptor(c,U):J;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(q,c,U,J);else for(var X=q.length-1;X>=0;X--)(Q=q[X])&&(g=(s<3?Q(g):s>3?Q(c,U,g):Q(c,U))||g);return s>3&&g&&Object.defineProperty(c,U,g),g}Object.create;Object.create}}]);