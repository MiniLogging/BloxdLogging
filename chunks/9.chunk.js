"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{2220:(Y,d,t)=>{t.r(d),t.d(d,{Dispose:()=>D,DumpData:()=>F,DumpDataAsync:()=>f,DumpFramebuffer:()=>o,DumpTools:()=>b});var x=t(2111),C=t(521),U=t(705),y=t(561);let B,W=null;async function o(Y,d,t,x){let C=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5?arguments[5]:void 0,y=arguments.length>6?arguments[6]:void 0;const B=await t.readPixels(0,0,Y,d);F(Y,d,new Uint8Array(B.buffer),x,C,U,!0,void 0,y)}function f(Y,d,t){let x=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",C=arguments.length>4?arguments[4]:void 0,U=arguments.length>5&&void 0!==arguments[5]&&arguments[5],y=arguments.length>6&&void 0!==arguments[6]&&arguments[6],B=arguments.length>7?arguments[7]:void 0;return new Promise((W=>{F(Y,d,t,(Y=>W(Y)),x,C,U,y,B)}))}function F(Y,d,o,f){let F=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",b=arguments.length>5?arguments[5]:void 0,m=arguments.length>6&&void 0!==arguments[6]&&arguments[6],M=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8?arguments[8]:void 0;(async function(){return W||(W=new Promise(((Y,d)=>{let C,U=null;const W={Tk:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};t.e(22).then(t.bind(t,11861)).then((o=>{let{ThinEngine:f}=o;try{C=new OffscreenCanvas(100,100),U=new f(C,!1,W)}catch(b){C=document.createElement("canvas"),U=new f(C,!1,W)}y.d.Instances.pop(),y.d.OnEnginesDisposedObservable.add((Y=>{U&&Y!==U&&!U.u&&0===y.d.Instances.length&&D()})),U.getCaps().parallelShaderCompile=void 0;const F=new x.b(U);t.e(33).then(t.bind(t,12857)).then((t=>{let{passPixelShader:y}=t;if(!U)return void d("Engine is not defined");const W=new x.e({Xj:U,name:y.name,fragmentShader:y.shader,samplerNames:["textureSampler"]});B={canvas:C,Xj:U,renderer:F,wrapper:W},Y(B)}))})).catch(d)}))),await W})().then((t=>{if(t.Xj.setSize(Y,d,!0),o instanceof Float32Array){const Y=new Uint8Array(o.length);let d=o.length;for(;d--;){const t=o[d];Y[d]=Math.round(255*(0,U.b)(t))}o=Y}const x=t.Xj.createRawTexture(o,Y,d,5,!1,!m,1);t.renderer.setViewport(),t.renderer.applyEffectWrapper(t.wrapper),t.wrapper.effect._bindTexture("textureSampler",x),t.renderer.draw(),M?C.e.ToBlob(t.canvas,(Y=>{const d=new FileReader;d.onload=Y=>{const d=Y.target.result;f&&f(d)},d.readAsArrayBuffer(Y)}),F,J):C.e.EncodeScreenshotCanvasData(t.canvas,f,F,b,J),x.dispose()}))}function D(){var Y;B?(B.wrapper.dispose(),B.renderer.dispose(),B.Xj.dispose()):null===(Y=W)||void 0===Y||Y.then((Y=>{Y.wrapper.dispose(),Y.renderer.dispose(),Y.Xj.dispose()}));W=null,B=null}const b={DumpData:F,DumpDataAsync:f,DumpFramebuffer:o,Dispose:D};C.e.DumpData=F,C.e.DumpDataAsync=f,C.e.DumpFramebuffer=o}}]);