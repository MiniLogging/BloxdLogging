"use strict";(self.uji65st81d=self.uji65st81d||[]).push([[9],{12315:(V,h,mV)=>{mV.d(h,{d:()=>H,g:()=>v,j:()=>D,i:()=>r,l:()=>T});class t{constructor(){this.children=[]}isValid(V){return!0}process(V,h,mV){let t="";if(this.line){let mV=this.line;const o=h.processor;if(o){var L,N,A,k,C,K;o.lineProcessor&&(mV=o.lineProcessor(mV,h.isFragment,h.processingContext));const t=(null===(L=h.processor)||void 0===L?void 0:L.attributeKeywordName)??"attribute",n=h.isFragment&&null!==(N=h.processor)&&void 0!==N&&N.varyingFragmentKeywordName?null===(A=h.processor)||void 0===A?void 0:A.varyingFragmentKeywordName:!h.isFragment&&null!==(k=h.processor)&&void 0!==k&&k.varyingVertexKeywordName?null===(C=h.processor)||void 0===C?void 0:C.varyingVertexKeywordName:"varying";if(!h.isFragment&&o.attributeProcessor&&this.line.startsWith(t))mV=o.attributeProcessor(this.line,V,h.processingContext);else if(o.varyingProcessor&&(null!==(K=o.varyingCheck)&&void 0!==K&&K.call(o,this.line,h.isFragment)||!o.varyingCheck&&this.line.startsWith(n)))mV=o.varyingProcessor(this.line,h.isFragment,V,h.processingContext);else if(o.uniformProcessor&&o.uniformRegexp&&o.uniformRegexp.test(this.line))h.lookForClosingBracketForUniformBuffer||(mV=o.uniformProcessor(this.line,h.isFragment,V,h.processingContext));else if(o.uniformBufferProcessor&&o.uniformBufferRegexp&&o.uniformBufferRegexp.test(this.line))h.lookForClosingBracketForUniformBuffer||(mV=o.uniformBufferProcessor(this.line,h.isFragment,h.processingContext),h.lookForClosingBracketForUniformBuffer=!0);else if(o.textureProcessor&&o.textureRegexp&&o.textureRegexp.test(this.line))mV=o.textureProcessor(this.line,h.isFragment,V,h.processingContext);else if((o.uniformProcessor||o.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!h.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?o.uniformProcessor&&(mV=o.uniformProcessor(this.line,h.isFragment,V,h.processingContext)):o.uniformBufferProcessor&&(mV=o.uniformBufferProcessor(this.line,h.isFragment,h.processingContext),h.lookForClosingBracketForUniformBuffer=!0)}h.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(h.lookForClosingBracketForUniformBuffer=!1,o.endOfUniformBufferProcessor&&(mV=o.endOfUniformBufferProcessor(this.line,h.isFragment,h.processingContext)))}t+=mV+"\n"}for(const o of this.children)t+=o.process(V,h,mV);return this.additionalDefineKey&&(V[this.additionalDefineKey]=this.additionalDefineValue||"true",mV[this.additionalDefineKey]=V[this.additionalDefineKey]),t}}class L{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(V){this._lines.length=0;for(const h of V){if(!h||"\r"===h)continue;if("#"===h[0]){this._lines.push(h);continue}const V=h.trim();if(!V)continue;if(V.startsWith("//")){this._lines.push(h);continue}const mV=V.indexOf(";");if(-1===mV)this._lines.push(V);else if(mV===V.length-1)V.length>1&&this._lines.push(V);else{const V=h.split(";");for(let h=0;h<V.length;h++){let mV=V[h];mV&&(mV=mV.trim(),mV&&this._lines.push(mV+(h!==V.length-1?";":"")))}}}}}class N extends t{process(V,h,mV){for(let t=0;t<this.children.length;t++){const L=this.children[t];if(L.isValid(V))return L.process(V,h,mV)}return""}}class A extends t{isValid(V){return this.testExpression.isTrue(V)}}class k{isTrue(V){return!0}static postfixToInfix(V){const h=[];for(const mV of V)if(void 0===k._OperatorPriority[mV])h.push(mV);else{const V=h[h.length-1],t=h[h.length-2];h.length-=2,h.push(`(${t}${mV}${V})`)}return h[h.length-1]}static infixToPostfix(V){const h=k._InfixToPostfixCache.get(V);if(h)return h.accessTime=Date.now(),h.result;if(!V.includes("&&")&&!V.includes("||")&&!V.includes(")")&&!V.includes("("))return[V];const mV=[];let t=-1;const L=()=>{o=o.trim(),""!==o&&(mV.push(o),o="")},N=V=>{t<k._Stack.length-1&&(k._Stack[++t]=V)},A=()=>k._Stack[t],C=()=>-1===t?"!!INVALID EXPRESSION!!":k._Stack[t--];let K=0,o="";for(;K<V.length;){const h=V.charAt(K),n=K<V.length-1?V.substring(K,2+K):"";if("("===h)o="",N(h);else if(")"===h){for(L();-1!==t&&"("!==A();)mV.push(C());C()}else if(k._OperatorPriority[n]>1){for(L();-1!==t&&k._OperatorPriority[A()]>=k._OperatorPriority[n];)mV.push(C());N(n),K++}else o+=h;K++}for(L();-1!==t;)"("===A()?C():mV.push(C());return k._InfixToPostfixCache.size>=k.InfixToPostfixCacheLimitSize&&k.ClearCache(),k._InfixToPostfixCache.set(V,{result:mV,accessTime:Date.now()}),mV}static ClearCache(){const V=Array.from(k._InfixToPostfixCache.entries()).sort(((V,h)=>V[1].accessTime-h[1].accessTime));for(let h=0;h<k.InfixToPostfixCacheCleanupSize;h++)k._InfixToPostfixCache.delete(V[h][0])}}k.InfixToPostfixCacheLimitSize=5e4,k.InfixToPostfixCacheCleanupSize=25e3,k._InfixToPostfixCache=new Map,k._OperatorPriority={")":0,"(":1,"||":2,"&&":3},k._Stack=["","","","","","","","","","","","","","","","","","","",""];class C extends k{constructor(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=V,this.not=h}isTrue(V){let h=void 0!==V[this.define];return this.not&&(h=!h),h}}class K extends k{isTrue(V){return this.leftOperand.isTrue(V)||this.rightOperand.isTrue(V)}}class o extends k{isTrue(V){return this.leftOperand.isTrue(V)&&this.rightOperand.isTrue(V)}}class n extends k{constructor(V,h,mV){super(),this.define=V,this.operand=h,this.testValue=mV}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(V){let h=!1;const mV=parseInt(void 0!=V[this.define]?V[this.define]:this.define),t=parseInt(void 0!=V[this.testValue]?V[this.testValue]:this.testValue);if(isNaN(mV)||isNaN(t))return!1;switch(this.operand){case">":h=mV>t;break;case"<":h=mV<t;break;case"<=":h=mV<=t;break;case">=":h=mV>=t;break;case"==":h=mV===t;break;case"!=":h=mV!==t}return h}}var q=mV(12288),x=mV(12320);const R=/defined\s*?\((.+?)\)/g,d=/defined\s*?\[(.+?)\]/g,s=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,M=/__decl__/,c=/light\{X\}.(\w*)/g,z=/\{X\}/g,Q=[],J=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function v(V){V.processor&&V.processor.initializeShaders&&V.processor.initializeShaders(V.processingContext)}function D(V,h,mV,t){var L;null!==(L=h.processor)&&void 0!==L&&L.preProcessShaderCode&&(V=h.processor.preProcessShaderCode(V,h.isFragment)),r(V,h,(V=>{h.processCodeAfterIncludes&&(V=h.processCodeAfterIncludes(h.isFragment?"fragment":"vertex",V,h.defines));const L=function(V,h,mV){let t=function(V,h){var mV;if(null!==(mV=h.processor)&&void 0!==mV&&mV.noPrecision)return V;const t=h.shouldUseHighPrecisionShader;-1===V.indexOf("precision highp float")?V=t?"precision highp float;\n"+V:"precision mediump float;\n"+V:t||(V=V.replace("precision highp float","precision mediump float"));return V}(V,h);if(!h.processor)return t;if(0===h.processor.shaderLanguage&&-1!==t.indexOf("#version 3")&&(t=t.replace("#version 300 es",""),!h.processor.parseGLES3))return t;const L=h.defines,N=I(h,mV);h.processor.preProcessor&&(t=h.processor.preProcessor(t,L,N,h.isFragment,h.processingContext));const A={};t=O(t,N,h,A),h.processor.postProcessor&&(t=h.processor.postProcessor(t,L,h.isFragment,h.processingContext,mV?{drawBuffersExtensionDisabled:!mV.getCaps().drawBuffersExtension}:{},N,A));null!==mV&&void 0!==mV&&mV._features.needShaderCodeInlining&&(t=mV.inlineShaderCode(t));return t}(V,h,t);mV(L,V)}))}function H(V,h,mV){return mV.processor&&mV.processor.finalizeShaders?mV.processor.finalizeShaders(V,h,mV.processingContext):{vertexCode:V,fragmentCode:h}}function j(V){const h=/defined\((.+)\)/.exec(V);if(h&&h.length)return new C(h[1].trim(),"!"===V[0]);const mV=["==","!=",">=","<=","<",">"];let t="",L=0;for(t of mV)if(L=V.indexOf(t),L>-1)break;if(-1===L)return new C(V);const N=V.substring(0,L).trim(),A=V.substring(L+t.length).trim();return new n(N,t,A)}function l(V,h){const mV=new A,t=V.substring(0,h);let L=V.substring(h);return L=L.substring(0,(L.indexOf("//")+1||L.length+1)-1).trim(),mV.testExpression="#ifdef"===t?new C(L):"#ifndef"===t?new C(L,!0):function(V){V=V.replace(R,"defined[$1]");const h=k.infixToPostfix(V),mV=[];for(const L of h)if("||"!==L&&"&&"!==L)mV.push(L);else if(mV.length>=2){let V=mV[mV.length-1],h=mV[mV.length-2];mV.length-=2;const t="&&"==L?new o:new K;"string"===typeof V&&(V=V.replace(d,"defined($1)")),"string"===typeof h&&(h=h.replace(d,"defined($1)")),t.leftOperand="string"===typeof h?j(h):h,t.rightOperand="string"===typeof V?j(V):V,mV.push(t)}let t=mV[mV.length-1];return"string"===typeof t&&(t=t.replace(d,"defined($1)")),"string"===typeof t?j(t):t}(L),mV}function G(V,h,mV,L){let N=V.currentLine;for(;y(V,mV,L);){N=V.currentLine;const A=N.substring(0,5).toLowerCase();if("#else"===A){const mV=new t;return h.children.push(mV),void y(V,mV,L)}if("#elif"===A){const V=l(N,5);h.children.push(V),mV=V}}}function y(V,h,mV){for(;V.canRead;){V.lineIndex++;const L=V.currentLine;if(L.indexOf("#")>=0){const t=J.exec(L);if(t&&t.length){switch(t[0]){case"#ifdef":{const t=new N;h.children.push(t);const A=l(L,6);t.children.push(A),G(V,t,A,mV);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const t=new N;h.children.push(t);const A=l(L,7);t.children.push(A),G(V,t,A,mV);break}case"#if":{const t=new N,A=l(L,3);h.children.push(t),t.children.push(A),G(V,t,A,mV);break}}continue}}const A=new t;if(A.line=L,h.children.push(A),"#"===L[0]&&"d"===L[1]){const V=L.replace(";","").split(" ");A.additionalDefineKey=V[1],3===V.length&&(A.additionalDefineValue=V[2])}}return!1}function O(V,h,mV,N){const A=new t,k=new L;return k.lineIndex=-1,k.lines=V.split("\n"),y(k,A,N),A.process(h,mV,N)}function I(V,h){var mV;const t=V.defines,L={};for(const N of t){const V=N.replace("#define","").replace(";","").trim().split(" ");L[V[0]]=V.length>1?V[1]:""}return 0===(null===(mV=V.processor)||void 0===mV?void 0:mV.shaderLanguage)&&(L.GL_ES="true"),L.__VERSION__=V.version,L[V.platformName]="true",(0,x.h)(L,null===h||void 0===h?void 0:h.isNDCHalfZRange,null===h||void 0===h?void 0:h.bh,null===h||void 0===h?void 0:h.useExactSrgbConversions),L}function r(V,h,mV){let t;for(Q.length=0;null!==(t=s.exec(V));)Q.push(t);let L=String(V),N=[V],A=!1;for(const k of Q){let V=k[1];if(-1!==V.indexOf("__decl__")&&(V=V.replace(M,""),h.supportsUniformBuffers&&(V=V.replace("Vertex","Ubo").replace("Fragment","Ubo")),V+="Declaration"),!h.includesShadersStore[V]){const t=h.shadersRepository+"ShadersInclude/"+V+".fx";return void T.loadFile(t,(t=>{h.includesShadersStore[V]=t,r(N.join(""),h,mV)}))}{let mV=h.includesShadersStore[V];if(k[2]){const V=k[3].split(",");for(let h=0;h<V.length;h+=2){const t=new RegExp(V[h],"g"),L=V[h+1];mV=mV.replace(t,L)}}if(k[4]){const V=k[5];if(-1!==V.indexOf("..")){const t=V.split(".."),L=parseInt(t[0]);let N=parseInt(t[1]),A=mV.slice(0);mV="",isNaN(N)&&(N=h.indexParameters[t[1]]);for(let V=L;V<N;V++)h.supportsUniformBuffers||(A=A.replace(c,((V,h)=>h+"{X}"))),mV+=A.replace(z,V.toString())+"\n"}else h.supportsUniformBuffers||(mV=mV.replace(c,((V,h)=>h+"{X}"))),mV=mV.replace(z,V)}const t=[];for(const V of N){const h=V.split(k[0]);for(let V=0;V<h.length-1;V++)t.push(h[V]),t.push(mV);t.push(h[h.length-1])}N=t,A=A||mV.indexOf("#include<")>=0||mV.indexOf("#include <")>=0}}Q.length=0,L=N.join(""),A?r(L.toString(),h,mV):mV(L)}const T={loadFile:(V,h,mV,t,L,N)=>{throw(0,q.c)("FileTools")}}},12320:(V,h,mV)=>{mV.d(h,{d:()=>L,g:()=>N,h:()=>k,k:()=>A,m:()=>C});var t=mV(12288);mV(12261);const L={};function N(V,h){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(h?h+"\n":"")+V}function A(V,h,mV,N,A,k,C){const K=C||L.loadFile;if(K){return K(V,h,mV,N,A,k)}throw(0,t.c)("FileTools")}function k(V,h,mV,t){if(V)return h?V.IS_NDC_HALF_ZRANGE="":delete V.IS_NDC_HALF_ZRANGE,mV?V.USE_REVERSE_DEPTHBUFFER="":delete V.USE_REVERSE_DEPTHBUFFER,void(t?V.USE_EXACT_SRGB_CONVERSIONS="":delete V.USE_EXACT_SRGB_CONVERSIONS);{let V="";return h&&(V+="#define IS_NDC_HALF_ZRANGE"),mV&&(V&&(V+="\n"),V+="#define USE_REVERSE_DEPTHBUFFER"),t&&(V&&(V+="\n"),V+="#define USE_EXACT_SRGB_CONVERSIONS"),V}}function C(V,h){let mV=arguments.length>2&&void 0!==arguments[2]&&arguments[2],t=arguments.length>3?arguments[3]:void 0;switch(V){case 3:{const V=(ArrayBuffer,new Int8Array(h));return t&&V.set(new Int8Array(t)),V}case 0:{const V=(ArrayBuffer,new Uint8Array(h));return t&&V.set(new Uint8Array(t)),V}case 4:{const V=h instanceof ArrayBuffer?new Int16Array(h):new Int16Array(mV?h/2:h);return t&&V.set(new Int16Array(t)),V}case 5:case 8:case 9:case 10:case 2:{const V=h instanceof ArrayBuffer?new Uint16Array(h):new Uint16Array(mV?h/2:h);return t&&V.set(new Uint16Array(t)),V}case 6:{const V=h instanceof ArrayBuffer?new Int32Array(h):new Int32Array(mV?h/4:h);return t&&V.set(new Int32Array(t)),V}case 7:case 11:case 12:case 13:case 14:case 15:{const V=h instanceof ArrayBuffer?new Uint32Array(h):new Uint32Array(mV?h/4:h);return t&&V.set(new Uint32Array(t)),V}case 1:{const V=h instanceof ArrayBuffer?new Float32Array(h):new Float32Array(mV?h/4:h);return t&&V.set(new Float32Array(t)),V}}const L=(ArrayBuffer,new Uint8Array(h));return t&&L.set(new Uint8Array(t)),L}},12342:(V,h,mV)=>{mV.d(h,{b:()=>t});class t{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?t.ShadersRepository:t.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?t.ShadersStore:t.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?t.IncludesShadersStore:t.IncludesShadersStoreWGSL}}t.ShadersRepository="src/Shaders/",t.ShadersStore={},t.IncludesShadersStore={},t.ShadersRepositoryWGSL="src/ShadersWGSL/",t.ShadersStoreWGSL={},t.IncludesShadersStoreWGSL={}},12347:(V,h,mV)=>{mV.d(h,{d:()=>q,e:()=>z,g:()=>R,h:()=>x,j:()=>d,k:()=>c,l:()=>n,m:()=>K,n:()=>o,o:()=>C,s:()=>k});class t{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.dh._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(V){V&&this.program&&V(this.program)}setEngine(V){this.dh=V}_fillEffectInformation(V,h,mV,t,L,N,A,k){const C=this.dh;if(C.supportsUniformBuffers)for(const o in h)V.bindUniformBlock(o,h[o]);let K;for(this.dh.getUniforms(this,mV).forEach(((V,h)=>{t[mV[h]]=V})),this._uniforms=t,K=0;K<L.length;K++){null==V.getUniform(L[K])&&(L.splice(K,1),K--)}L.forEach(((V,h)=>{N[V]=h}));for(const o of C.getAttributes(this,A))k.push(o)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(V,h){const mV=this._valueCache[V],t=h.updateFlag;return(void 0===mV||mV!==t)&&(this._valueCache[V]=t,!0)}_cacheFloat2(V,h,mV){let t=this._valueCache[V];if(!t||2!==t.length)return t=[h,mV],this._valueCache[V]=t,!0;let L=!1;return t[0]!==h&&(t[0]=h,L=!0),t[1]!==mV&&(t[1]=mV,L=!0),L}_cacheFloat3(V,h,mV,t){let L=this._valueCache[V];if(!L||3!==L.length)return L=[h,mV,t],this._valueCache[V]=L,!0;let N=!1;return L[0]!==h&&(L[0]=h,N=!0),L[1]!==mV&&(L[1]=mV,N=!0),L[2]!==t&&(L[2]=t,N=!0),N}_cacheFloat4(V,h,mV,t,L){let N=this._valueCache[V];if(!N||4!==N.length)return N=[h,mV,t,L],this._valueCache[V]=N,!0;let A=!1;return N[0]!==h&&(N[0]=h,A=!0),N[1]!==mV&&(N[1]=mV,A=!0),N[2]!==t&&(N[2]=t,A=!0),N[3]!==L&&(N[3]=L,A=!0),A}setInt(V,h){const mV=this._valueCache[V];void 0!==mV&&mV===h||this.dh.setInt(this._uniforms[V],h)&&(this._valueCache[V]=h)}setInt2(V,h,mV){this._cacheFloat2(V,h,mV)&&(this.dh.setInt2(this._uniforms[V],h,mV)||(this._valueCache[V]=null))}setInt3(V,h,mV,t){this._cacheFloat3(V,h,mV,t)&&(this.dh.setInt3(this._uniforms[V],h,mV,t)||(this._valueCache[V]=null))}setInt4(V,h,mV,t,L){this._cacheFloat4(V,h,mV,t,L)&&(this.dh.setInt4(this._uniforms[V],h,mV,t,L)||(this._valueCache[V]=null))}setIntArray(V,h){this._valueCache[V]=null,this.dh.setIntArray(this._uniforms[V],h)}setIntArray2(V,h){this._valueCache[V]=null,this.dh.setIntArray2(this._uniforms[V],h)}setIntArray3(V,h){this._valueCache[V]=null,this.dh.setIntArray3(this._uniforms[V],h)}setIntArray4(V,h){this._valueCache[V]=null,this.dh.setIntArray4(this._uniforms[V],h)}setUInt(V,h){const mV=this._valueCache[V];void 0!==mV&&mV===h||this.dh.setUInt(this._uniforms[V],h)&&(this._valueCache[V]=h)}setUInt2(V,h,mV){this._cacheFloat2(V,h,mV)&&(this.dh.setUInt2(this._uniforms[V],h,mV)||(this._valueCache[V]=null))}setUInt3(V,h,mV,t){this._cacheFloat3(V,h,mV,t)&&(this.dh.setUInt3(this._uniforms[V],h,mV,t)||(this._valueCache[V]=null))}setUInt4(V,h,mV,t,L){this._cacheFloat4(V,h,mV,t,L)&&(this.dh.setUInt4(this._uniforms[V],h,mV,t,L)||(this._valueCache[V]=null))}setUIntArray(V,h){this._valueCache[V]=null,this.dh.setUIntArray(this._uniforms[V],h)}setUIntArray2(V,h){this._valueCache[V]=null,this.dh.setUIntArray2(this._uniforms[V],h)}setUIntArray3(V,h){this._valueCache[V]=null,this.dh.setUIntArray3(this._uniforms[V],h)}setUIntArray4(V,h){this._valueCache[V]=null,this.dh.setUIntArray4(this._uniforms[V],h)}setArray(V,h){this._valueCache[V]=null,this.dh.setArray(this._uniforms[V],h)}setArray2(V,h){this._valueCache[V]=null,this.dh.setArray2(this._uniforms[V],h)}setArray3(V,h){this._valueCache[V]=null,this.dh.setArray3(this._uniforms[V],h)}setArray4(V,h){this._valueCache[V]=null,this.dh.setArray4(this._uniforms[V],h)}setMatrices(V,h){h&&(this._valueCache[V]=null,this.dh.setMatrices(this._uniforms[V],h))}setMatrix(V,h){this._cacheMatrix(V,h)&&(this.dh.setMatrices(this._uniforms[V],h.sk())||(this._valueCache[V]=null))}setMatrix3x3(V,h){this._valueCache[V]=null,this.dh.setMatrix3x3(this._uniforms[V],h)}setMatrix2x2(V,h){this._valueCache[V]=null,this.dh.setMatrix2x2(this._uniforms[V],h)}setFloat(V,h){const mV=this._valueCache[V];void 0!==mV&&mV===h||this.dh.setFloat(this._uniforms[V],h)&&(this._valueCache[V]=h)}setVector2(V,h){this._cacheFloat2(V,h.x,h.y)&&(this.dh.setFloat2(this._uniforms[V],h.x,h.y)||(this._valueCache[V]=null))}setFloat2(V,h,mV){this._cacheFloat2(V,h,mV)&&(this.dh.setFloat2(this._uniforms[V],h,mV)||(this._valueCache[V]=null))}setVector3(V,h){this._cacheFloat3(V,h.x,h.y,h.z)&&(this.dh.setFloat3(this._uniforms[V],h.x,h.y,h.z)||(this._valueCache[V]=null))}setFloat3(V,h,mV,t){this._cacheFloat3(V,h,mV,t)&&(this.dh.setFloat3(this._uniforms[V],h,mV,t)||(this._valueCache[V]=null))}setVector4(V,h){this._cacheFloat4(V,h.x,h.y,h.z,h.w)&&(this.dh.setFloat4(this._uniforms[V],h.x,h.y,h.z,h.w)||(this._valueCache[V]=null))}setQuaternion(V,h){this._cacheFloat4(V,h.x,h.y,h.z,h.w)&&(this.dh.setFloat4(this._uniforms[V],h.x,h.y,h.z,h.w)||(this._valueCache[V]=null))}setFloat4(V,h,mV,t,L){this._cacheFloat4(V,h,mV,t,L)&&(this.dh.setFloat4(this._uniforms[V],h,mV,t,L)||(this._valueCache[V]=null))}setColor3(V,h){this._cacheFloat3(V,h.r,h.g,h.b)&&(this.dh.setFloat3(this._uniforms[V],h.r,h.g,h.b)||(this._valueCache[V]=null))}setColor4(V,h,mV){this._cacheFloat4(V,h.r,h.g,h.b,mV)&&(this.dh.setFloat4(this._uniforms[V],h.r,h.g,h.b,mV)||(this._valueCache[V]=null))}setDirectColor4(V,h){this._cacheFloat4(V,h.r,h.g,h.b,h.a)&&(this.dh.setFloat4(this._uniforms[V],h.r,h.g,h.b,h.a)||(this._valueCache[V]=null))}_getVertexShaderCode(){return this.vertexShader?this.dh._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.dh._getShaderSource(this.fragmentShader):null}}var L=mV(12320);const N=new WeakMap,A={_webGLVersion:2,cachedPipelines:{}};function k(V){let h=N.get(V);if(!h){if(!V)return A;h={_webGLVersion:V.TEXTURE_BINDING_3D?2:1,_context:V,parallelShaderCompile:V.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},N.set(V,h)}return h}function C(V){N.delete(V)}function K(V,h,mV,t,L,N){const A=k(t);N||(N=A._createShaderProgramInjection??q);return N(V,M(h,"vertex",t,A._contextWasLost),M(mV,"fragment",t,A._contextWasLost),t,L,A.validateShaderPrograms)}function o(V,h,mV,t,L){let N=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,A=arguments.length>6?arguments[6]:void 0;const C=k(L);A||(A=C._createShaderProgramInjection??q);const K=C._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return A(V,s(h,"vertex",t,K,L,C._contextWasLost),s(mV,"fragment",t,K,L,C._contextWasLost),L,N,C.validateShaderPrograms)}function n(V,h){const mV=new t,L=k(V);return L.parallelShaderCompile&&!L.disableParallelShaderCompile&&(mV.isParallelCompiled=!0),mV.context=L._context,mV}function q(V,h,mV,t){let L=arguments.length>5?arguments[5]:void 0;const N=t.createProgram();if(V.program=N,!N)throw new Error("Unable to create program");return t.attachShader(N,h),t.attachShader(N,mV),t.linkProgram(N),V.context=t,V.vertexShader=h,V.fragmentShader=mV,V.isParallelCompiled||R(V,t,L),N}function x(V,h,mV){const t=V;if(t._isDisposed)return!1;const L=k(h);return!!(L&&L.parallelShaderCompile&&L.parallelShaderCompile.COMPLETION_STATUS_KHR&&t.program&&h.getProgramParameter(t.program,L.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(R(t,h,mV),!0)}function R(V,h,mV){const t=V.context,L=V.vertexShader,N=V.fragmentShader,A=V.program;if(!t.getProgramParameter(A,t.LINK_STATUS)){if(!h.getShaderParameter(L,h.COMPILE_STATUS)){const mV=h.getShaderInfoLog(L);if(mV)throw V.vertexCompilationError=mV,new Error("VERTEX SHADER "+mV)}if(!h.getShaderParameter(N,h.COMPILE_STATUS)){const mV=h.getShaderInfoLog(N);if(mV)throw V.fragmentCompilationError=mV,new Error("FRAGMENT SHADER "+mV)}const mV=t.getProgramInfoLog(A);if(mV)throw V.programLinkError=mV,new Error(mV)}if(mV){t.validateProgram(A);if(!t.getProgramParameter(A,t.VALIDATE_STATUS)){const h=t.getProgramInfoLog(A);if(h)throw V.programValidationError=h,new Error(h)}}t.deleteShader(L),t.deleteShader(N),V.vertexShader=void 0,V.fragmentShader=void 0,V.onCompiled&&(V.onCompiled(),V.onCompiled=void 0)}function d(V,h,mV,t,L,N,A,C,n){let q=arguments.length>10?arguments[10]:void 0,x=arguments.length>11?arguments[11]:void 0,R=arguments.length>12?arguments[12]:void 0;const d=k(V.context);x||(x=d.createRawShaderProgramInjection??K),R||(R=d.createShaderProgramInjection??o);const s=V;s.program=t?x(s,h,mV,s.context,n):R(s,h,mV,C,s.context,n),s.program.__SPECTOR_rebuildProgram=A,q()}function s(V,h,mV,t,N,A){return M((0,L.g)(V,mV,t),h,N,A)}function M(V,h,mV,t){const L=mV.createShader("vertex"===h?mV.VERTEX_SHADER:mV.FRAGMENT_SHADER);if(!L){let V=mV.NO_ERROR,L=mV.NO_ERROR;for(;(L=mV.getError())!==mV.NO_ERROR;)V=L;throw new Error(`Something went wrong while creating a gl ${h} shader object. gl error=${V}, gl isContextLost=${mV.isContextLost()}, _contextWasLost=${t}`)}return mV.shaderSource(L,V),mV.compileShader(L),L}function c(V,h){h.useProgram(V)}function z(V,h){const mV=V;if(!mV.isParallelCompiled)return void h(V);const t=mV.onCompiled;mV.onCompiled=()=>{null===t||void 0===t||t(),h(V)}}},12344:(V,h,mV)=>{mV.d(h,{c:()=>n,d:()=>x,h:()=>K,l:()=>o});var t=mV(12261),L=mV(12347),N=mV(12342),A=mV(12264),k=mV(12315),C=mV(12320);function K(V,h){return(0,L.s)(h).cachedPipelines[V]}function o(V){const h=V._name,mV=V.context;if(h&&mV){const V=(0,L.s)(mV),t=V.cachedPipelines[h];null===t||void 0===t||t.dispose(),delete V.cachedPipelines[h]}}function n(V,h,mV,L,N,A,C){let K,o;const n=(0,t.k)()?null===A||void 0===A?void 0:A.getHostDocument():null;K="string"===typeof h?h:h.vertexSource?"source:"+h.vertexSource:h.vertexElement?(null===n||void 0===n?void 0:n.getElementById(h.vertexElement))||h.vertexElement:h.vertex||h,o="string"===typeof h?h:h.fragmentSource?"source:"+h.fragmentSource:h.fragmentElement?(null===n||void 0===n?void 0:n.getElementById(h.fragmentElement))||h.fragmentElement:h.fragment||h;const x=[void 0,void 0],R=()=>{if(x[0]&&x[1]){V.isFragment=!0;const[t,K]=x;(0,k.j)(K,V,((A,K)=>{C&&(C._fragmentSourceCodeBeforeMigration=K),mV&&(A=mV("fragment",A));const o=(0,k.d)(t,A,V);V=null;const n=function(V,h,mV,t){if(mV){return{vertexSourceCode:(1===t?"//":"")+"#define SHADER_NAME vertex:"+(mV.vertexElement||mV.vertex||mV.spectorName||mV)+"\n"+V,fragmentSourceCode:(1===t?"//":"")+"#define SHADER_NAME fragment:"+(mV.fragmentElement||mV.fragment||mV.spectorName||mV)+"\n"+h}}return{vertexSourceCode:V,fragmentSourceCode:h}}(o.vertexCode,o.fragmentCode,h,N);null===L||void 0===L||L(n.vertexSourceCode,n.fragmentSourceCode)}),A)}};q(K,"Vertex","",(h=>{(0,k.g)(V),(0,k.j)(h,V,((V,t)=>{C&&(C._rawVertexSourceCode=h,C._vertexSourceCodeBeforeMigration=t),mV&&(V=mV("vertex",V)),x[0]=V,R()}),A)}),N),q(o,"Fragment","Pixel",(V=>{C&&(C._rawFragmentSourceCode=V),x[1]=V,R()}),N)}function q(V,h,mV,L,A,k){if("undefined"!==typeof HTMLElement&&V instanceof HTMLElement){return void L((0,t.c)(V))}if("source:"===V.substring(0,7))return void L(V.substring(7));if("base64:"===V.substring(0,7)){return void L(window.atob(V.substring(7)))}const K=N.b.GetShadersStore(A);if(K[V+h+"Shader"])return void L(K[V+h+"Shader"]);if(mV&&K[V+mV+"Shader"])return void L(K[V+mV+"Shader"]);let o;if(o="."===V[0]||"/"===V[0]||V.indexOf("http")>-1?V:N.b.GetShadersRepository(A)+V,!(k=k||C.k))throw new Error("loadFileInjection is not defined");k(o+"."+h.toLowerCase()+".fx",L)}const x=(V,h,mV,t)=>{try{const N=V.context?(0,L.s)(V.context):null;N&&(N.disableParallelShaderCompile=V.disableParallelCompilation);const A=V.existingPipelineContext||h(V.shaderProcessingContext);return A._name=V.name,V.name&&N&&(N.cachedPipelines[V.name]=A),mV(A,V.vertex,V.fragment,!!V.createAsRaw,"","",V.rebuildRebind,V.defines,V.transformFeedbackVaryings,"",(()=>{t(A,(()=>{var h;null===(h=V.onRenderingStateCompiled)||void 0===h||h.call(V,A)}))})),A}catch(N){throw A.e.Error("Error compiling effect"),N}}},12338:(V,h,mV)=>{mV.r(h),mV.d(h,{Effect:()=>C});var t=mV(12258),L=mV(12264),N=mV(12342),A=mV(12344),k=mV(12322);class C{static get ShadersRepository(){return N.b.ShadersRepository}static set ShadersRepository(V){N.b.ShadersRepository=V}get A(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new t.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(V,h,mV){let L=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4?arguments[4]:void 0,k=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,n=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9?arguments[9]:void 0,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",R=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,d=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new t.d,this.onErrorObservable=new t.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=V,this._key=x;const s=this._key.replace(/\r/g,"").replace(/\n/g,"|");let M;if(h.attributes){const V=h;if(this._engine=mV,this._attributesNames=V.attributes,this._uniformsNames=V.uniformsNames.concat(V.samplers),this._samplerList=V.samplers.slice(),this.defines=V.defines,this.onError=V.onError,this.onCompiled=V.onCompiled,this._fallbacks=V.fallbacks,this._indexParameters=V.indexParameters,this._transformFeedbackVaryings=V.transformFeedbackVaryings||null,this._multiTarget=!!V.multiTarget,this._shaderLanguage=V.shaderLanguage??0,this._disableParallelShaderCompilation=!!V.disableParallelShaderCompilation,V.uniformBuffersNames){this._uniformBuffersNamesList=V.uniformBuffersNames.slice();for(let h=0;h<V.uniformBuffersNames.length;h++)this._uniformBuffersNames[V.uniformBuffersNames[h]]=h}this._processFinalCode=V.processFinalCode??null,this._processCodeAfterIncludes=V.processCodeAfterIncludes??void 0,d=V.extraInitializationsAsync,M=V.existingPipelineContext}else this._engine=N,this.defines=null==k?"":k,this._uniformsNames=mV.concat(L),this._samplerList=L?L.slice():[],this._attributesNames=h,this._uniformBuffersNamesList=[],this._shaderLanguage=R,this.onError=n,this.onCompiled=o,this._indexParameters=q,this._fallbacks=K;"WEBGL2"===this._engine.shaderPlatformName&&(M=(0,A.h)(s,this._engine._gl)??M),this._attributeLocationByName={},this.uniqueId=C._UniqueIdSeed++,M?(this._pipelineContext=M,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,d),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.A||this.dispose(!0)}))}async _processShaderCodeAsync(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3?arguments[3]:void 0;t&&await t(),this._processingContext=mV||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const L={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:V??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:N.b.GetShadersRepository(this._shaderLanguage),includesShadersStore:N.b.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,bh:this._engine.bh,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,A.c)(L,this.name,this._processFinalCode,((V,mV)=>{this._vertexSourceCode=V,this._fragmentSourceCode=mV,this._prepareEffect(h)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.A||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(V){return this._attributes[V]}getAttributeLocationByName(V){return this._attributeLocationByName[V]}getAttributesCount(){return this._attributes.length}getUniformIndex(V){return this._uniformsNames.indexOf(V)}getUniform(V){return this._uniforms[V]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((V=>{this.executeWhenCompiled(V)}))}executeWhenCompiled(V){this.isReady()?V(this):(this.onCompileObservable.add((h=>{V(h)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(V){(0,k.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(h=>{this._processCompilationErrors(h,V)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var V;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(V=this._pipelineContext)||void 0===V?void 0:V._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,bh:this._engine.bh,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(V,h,mV,t){this._isReady=!1,this._vertexSourceCodeOverride=V,this._fragmentSourceCodeOverride=h,this.onError=(V,h)=>{t&&t(h)},this.onCompiled=()=>{var V,h;const t=this.getEngine().scenes;if(t)for(let mV=0;mV<t.length;mV++)t[mV].markAllMaterialsAsDirty(127);null===(V=(h=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===V||V.call(h,mV)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(V){if(this._pipelineContext=V,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let h=0;h<this._attributesNames.length;h++){const V=this._attributesNames[h];this._attributeLocationByName[V]=this._attributes[h]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),C.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h=this._pipelineContext;this._isReady=!1;try{const mV=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),t=mV?null:this.defines,L=mV?this._vertexSourceCodeOverride:this._vertexSourceCode,N=mV?this._fragmentSourceCodeOverride:this._fragmentSourceCode,k=this._engine;this._pipelineContext=(0,A.d)({existingPipelineContext:V?h:null,vertex:L,fragment:N,context:"WEBGL2"===k.shaderPlatformName||"WEBGL1"===k.shaderPlatformName?k._gl:void 0,rebuildRebind:(V,h,mV,t)=>this._rebuildProgram(V,h,mV,t),defines:t,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:mV,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:mV=>{h&&!V&&this._engine._deletePipelineContext(h),mV&&this._onRenderingStateCompiled(mV)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(h)}catch(mV){this._processCompilationErrors(mV,h)}}_getShaderCodeAndErrorLine(V,h,mV){const t=mV?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let L=null;if(h&&V){const N=h.match(t);if(N&&2===N.length){const h=parseInt(N[1]),t=V.split("\n",-1);t.length>=h&&(L=`Offending line [${h}] in ${mV?"fragment":"vertex"} code: ${t[h-1]}`)}}return[V,L]}_processCompilationErrors(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=V.message;const mV=this._attributesNames,t=this._fallbacks;if(L.e.Error("Unable to compile effect:"),L.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),L.e.Error(`Attributes: ${mV.join(" ")}`),L.e.Error("Defines:\n"+this.defines),C.LogShaderCodeOnCompilationError){var N,A;let V=null,h=null,mV=null;var k;if(null!==(N=this._pipelineContext)&&void 0!==N&&N._getVertexShaderCode()&&([mV,V]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),mV&&(L.e.Error("Vertex code:"),L.e.Error(mV))),null!==(A=this._pipelineContext)&&void 0!==A&&A._getFragmentShaderCode())[mV,h]=this._getShaderCodeAndErrorLine(null===(k=this._pipelineContext)||void 0===k?void 0:k._getFragmentShaderCode(),this._compilationError,!0),mV&&(L.e.Error("Fragment code:"),L.e.Error(mV));V&&L.e.Error(V),h&&L.e.Error(h)}L.e.Error("Error: "+this._compilationError);const K=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};h&&(this._pipelineContext=h,this._isReady=!0,K()),t?(this._pipelineContext=null,t.hasMoreFallbacks?(this._allFallbacksProcessed=!1,L.e.Error("Trying next fallback."),this.defines=t.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,K(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,h||K())}get isSupported(){return""===this._compilationError}_bindTexture(V,h){this._engine._bindTexture(this._samplers[V],h,V)}setTexture(V,h){this._engine.setTexture(this._samplers[V],this._uniforms[V],h,V)}setTextureArray(V,h){const mV=V+"Ex";if(-1===this._samplerList.indexOf(mV+"0")){const t=this._samplerList.indexOf(V);for(let V=1;V<h.length;V++){const h=mV+(V-1).toString();this._samplerList.splice(t+V,0,h)}let L=0;for(const V of this._samplerList)this._samplers[V]=L,L+=1}this._engine.setTextureArray(this._samplers[V],this._uniforms[V],h,V)}bindUniformBuffer(V,h){const mV=this._uniformBuffersNames[h];void 0===mV||C._BaseCache[mV]===V&&this._engine._features.useUBOBindingCache||(C._BaseCache[mV]=V,this._engine.bindUniformBufferBase(V,mV,h))}bindUniformBlock(V,h){this._engine.bindUniformBlock(this._pipelineContext,V,h)}setInt(V,h){return this._pipelineContext.setInt(V,h),this}setInt2(V,h,mV){return this._pipelineContext.setInt2(V,h,mV),this}setInt3(V,h,mV,t){return this._pipelineContext.setInt3(V,h,mV,t),this}setInt4(V,h,mV,t,L){return this._pipelineContext.setInt4(V,h,mV,t,L),this}setIntArray(V,h){return this._pipelineContext.setIntArray(V,h),this}setIntArray2(V,h){return this._pipelineContext.setIntArray2(V,h),this}setIntArray3(V,h){return this._pipelineContext.setIntArray3(V,h),this}setIntArray4(V,h){return this._pipelineContext.setIntArray4(V,h),this}setUInt(V,h){return this._pipelineContext.setUInt(V,h),this}setUInt2(V,h,mV){return this._pipelineContext.setUInt2(V,h,mV),this}setUInt3(V,h,mV,t){return this._pipelineContext.setUInt3(V,h,mV,t),this}setUInt4(V,h,mV,t,L){return this._pipelineContext.setUInt4(V,h,mV,t,L),this}setUIntArray(V,h){return this._pipelineContext.setUIntArray(V,h),this}setUIntArray2(V,h){return this._pipelineContext.setUIntArray2(V,h),this}setUIntArray3(V,h){return this._pipelineContext.setUIntArray3(V,h),this}setUIntArray4(V,h){return this._pipelineContext.setUIntArray4(V,h),this}setFloatArray(V,h){return this._pipelineContext.setArray(V,h),this}setFloatArray2(V,h){return this._pipelineContext.setArray2(V,h),this}setFloatArray3(V,h){return this._pipelineContext.setArray3(V,h),this}setFloatArray4(V,h){return this._pipelineContext.setArray4(V,h),this}setArray(V,h){return this._pipelineContext.setArray(V,h),this}setArray2(V,h){return this._pipelineContext.setArray2(V,h),this}setArray3(V,h){return this._pipelineContext.setArray3(V,h),this}setArray4(V,h){return this._pipelineContext.setArray4(V,h),this}setMatrices(V,h){return this._pipelineContext.setMatrices(V,h),this}setMatrix(V,h){return this._pipelineContext.setMatrix(V,h),this}setMatrix3x3(V,h){return this._pipelineContext.setMatrix3x3(V,h),this}setMatrix2x2(V,h){return this._pipelineContext.setMatrix2x2(V,h),this}setFloat(V,h){return this._pipelineContext.setFloat(V,h),this}setBool(V,h){return this._pipelineContext.setInt(V,h?1:0),this}setVector2(V,h){return this._pipelineContext.setVector2(V,h),this}setFloat2(V,h,mV){return this._pipelineContext.setFloat2(V,h,mV),this}setVector3(V,h){return this._pipelineContext.setVector3(V,h),this}setFloat3(V,h,mV,t){return this._pipelineContext.setFloat3(V,h,mV,t),this}setVector4(V,h){return this._pipelineContext.setVector4(V,h),this}setQuaternion(V,h){return this._pipelineContext.setQuaternion(V,h),this}setFloat4(V,h,mV,t,L){return this._pipelineContext.setFloat4(V,h,mV,t,L),this}setColor3(V,h){return this._pipelineContext.setColor3(V,h),this}setColor4(V,h,mV){return this._pipelineContext.setColor4(V,h,mV),this}setDirectColor4(V,h){return this._pipelineContext.setDirectColor4(V,h),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(C.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,A.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;h&&(N.b.GetShadersStore(t)[`${V}PixelShader`]=h),mV&&(N.b.GetShadersStore(t)[`${V}VertexShader`]=mV)}static ResetCache(){C._BaseCache={}}}C.LogShaderCodeOnCompilationError=!0,C.PersistentMode=!1,C.AutomaticallyClearCodeCache=!1,C._UniqueIdSeed=0,C._BaseCache={},C.ShadersStore=N.b.ShadersStore,C.IncludesShadersStore=N.b.IncludesShadersStore},12288:(V,h,mV)=>{mV.d(h,{c:()=>L});const t={};function L(V){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!t[V])return t[V]=!0,`${V} needs to be imported before as it contains a side-effect required by your code.`}},12261:(V,h,mV)=>{function t(){return"undefined"!==typeof window}function L(){return"undefined"!==typeof navigator}function N(){return"undefined"!==typeof document}function A(V){let h="",mV=V.firstChild;for(;mV;)3===mV.nodeType&&(h+=mV.textContent),mV=mV.nextSibling;return h}mV.d(h,{c:()=>A,f:()=>N,h:()=>L,k:()=>t})},12264:(V,h,mV)=>{mV.d(h,{e:()=>t});class t{static _CheckLimit(V,h){let mV=t._LogLimitOutputs[V];return mV?mV.current++:(mV={limit:h,current:1},t._LogLimitOutputs[V]=mV),mV.current<=mV.limit}static _GenerateLimitMessage(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const mV=t._LogLimitOutputs[V];if(!mV||!t.MessageLimitReached)return;const L=this._Levels[h];mV.current===mV.limit&&t[L.name](t.MessageLimitReached.replace(/%LIMIT%/g,""+mV.limit).replace(/%TYPE%/g,L.name??""))}static _AddLogEntry(V){t._LogCache=V+t._LogCache,t.OnNewCacheEntry&&t.OnNewCacheEntry(V)}static _FormatMessage(V){const h=V=>V<10?"0"+V:""+V,mV=new Date;return"["+h(mV.getHours())+":"+h(mV.getMinutes())+":"+h(mV.getSeconds())+"]: "+V}static _LogDisabled(V,h){}static _LogEnabled(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,h=arguments.length>1?arguments[1]:void 0,mV=arguments.length>2?arguments[2]:void 0;const L=Array.isArray(h)?h[0]:h;if(void 0!==mV&&!t._CheckLimit(L,mV))return;const N=t._FormatMessage(L),A=this._Levels[V],k=Array.isArray(h)?h.slice(1):[];A.logFunc&&A.logFunc("BJS - "+N,...k);const C=`<div style='color:${A.color}'>${N}</div><br>`;t._AddLogEntry(C),t._GenerateLimitMessage(L,V)}static get LogCache(){return t._LogCache}static ClearLogCache(){t._LogCache="",t._LogLimitOutputs={},t.errorsCount=0}static set LogLevels(V){t.Log=t._LogDisabled,t.Warn=t._LogDisabled,t.Error=t._LogDisabled;const h=[t.MessageLogLevel,t.WarningLogLevel,t.ErrorLogLevel];for(const mV of h)if((V&mV)===mV){const V=this._Levels[mV];t[V.name]=t._LogEnabled.bind(t,mV)}}}t.NoneLogLevel=0,t.MessageLogLevel=1,t.WarningLogLevel=2,t.ErrorLogLevel=4,t.AllLogLevel=7,t.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",t._LogCache="",t._LogLimitOutputs={},t._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],t.errorsCount=0,t.Log=t._LogEnabled.bind(t,t.MessageLogLevel),t.Warn=t._LogEnabled.bind(t,t.WarningLogLevel),t.Error=t._LogEnabled.bind(t,t.ErrorLogLevel)},12258:(V,h,mV)=>{mV.d(h,{d:()=>A});const t="undefined"!==typeof WeakRef;class L{constructor(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0;this.initialize(V,h,mV,t)}initialize(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1],mV=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0;return this.mask=V,this.skipNextObservers=h,this.target=mV,this.currentTarget=t,this}}class N{constructor(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=V,this.mask=h,this.scope=mV,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(V)}}class A{static FromPromise(V,h){const mV=new A;return V.then((V=>{mV.notifyObservers(V)})).catch((V=>{if(!h)throw V;h.notifyObservers(V)})),mV}get observers(){return this._observers}constructor(V){let h=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=h,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new L(0),V&&(this._onObserverAdded=V)}add(V){let h=arguments.length>2&&void 0!==arguments[2]&&arguments[2],mV=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!V)return null;const L=new N(V,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);L.unregisterOnNextCall=mV,h?this._observers.unshift(L):this._observers.push(L),this._onObserverAdded&&this._onObserverAdded(L),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(L,this._lastNotifiedValue);const A=t?new WeakRef(this):{deref:()=>this};return L._remove=function(){let V=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const h=A.deref();h&&(V?h.remove(L):h._remove(L))},L}addOnce(V){return this.add(V,void 0,void 0,void 0,!0)}remove(V){if(!V)return!1;V._remove=null;return-1!==this._observers.indexOf(V)&&(this._deferUnregister(V),!0)}removeCallback(V,h){for(let mV=0;mV<this._observers.length;mV++){const t=this._observers[mV];if(!t._willBeUnregistered&&(t.callback===V&&(!h||h===t.scope)))return this._deferUnregister(t),!0}return!1}_deferUnregister(V){V._willBeUnregistered||(this._numObserversMarkedAsDeleted++,V.unregisterOnNextCall=!1,V._willBeUnregistered=!0,setTimeout((()=>{this._remove(V)}),0))}_remove(V){let h=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!V)return!1;const mV=this._observers.indexOf(V);return-1!==mV&&(h&&this._numObserversMarkedAsDeleted--,this._observers.splice(mV,1),!0)}makeObserverTopPriority(V){this._remove(V,!1),this._observers.unshift(V)}makeObserverBottomPriority(V){this._remove(V,!1),this._observers.push(V)}notifyObservers(V){let h=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,mV=arguments.length>2?arguments[2]:void 0,t=arguments.length>3?arguments[3]:void 0,L=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=V),!this._observers.length)return!0;const N=this._eventState;N.mask=h,N.target=mV,N.currentTarget=t,N.skipNextObservers=!1,N.lastReturnValue=V,N.userInfo=L;for(const A of this._observers)if(!A._willBeUnregistered&&(A.mask&h&&(A.unregisterOnNextCall&&this._deferUnregister(A),A.scope?N.lastReturnValue=A.callback.apply(A.scope,[V,N]):N.lastReturnValue=A.callback(V,N)),N.skipNextObservers))return!1;return!0}notifyObserver(V,h){let mV=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=h),V._willBeUnregistered)return;const t=this._eventState;t.mask=mV,t.skipNextObservers=!1,V.unregisterOnNextCall&&this._deferUnregister(V),V.callback(h,t)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const V=this._observers.pop();V&&(V._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const V=new A;return V._observers=this._observers.slice(0),V}hasSpecificMask(){let V=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const h of this._observers)if(h.mask&V||h.mask===V)return!0;return!1}}},12322:(V,h,mV)=>{mV.d(h,{b:()=>L,f:()=>A});let t=[];class L{static SetImmediate(V){0===t.length&&setTimeout((()=>{const V=t;t=[];for(const h of V)h()}),1),t.push(V)}}function N(V,h,mV){try{if(V())return h(),!0}catch(t){return null===mV||void 0===mV||mV(t),!0}return!1}const A=function(V,h,mV){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,L=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,A=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&N(V,h,mV))return null;const k=setInterval((()=>{N(V,h,mV)?clearInterval(k):(L-=t,L<0&&(clearInterval(k),null===mV||void 0===mV||mV(new Error("Operation timed out after maximum retries. "+(A||"")),!0)))}),t);return()=>clearInterval(k)}}}]);