"use strict";(self["80dd64vgxnn"]=self["80dd64vgxnn"]||[]).push([[9],{12620:(mm,o,u)=>{u.d(o,{c:()=>P,e:()=>N,k:()=>S,i:()=>y,m:()=>I});class f{constructor(){this.children=[]}isValid(mm){return!0}process(mm,o,u){let f="";if(this.line){let u=this.line;const z=o.processor;if(z){var B,O,r,w,p,K;z.lineProcessor&&(u=z.lineProcessor(u,o.isFragment,o.processingContext));const f=(null===(B=o.processor)||void 0===B?void 0:B.attributeKeywordName)??"attribute",Y=o.isFragment&&null!==(O=o.processor)&&void 0!==O&&O.varyingFragmentKeywordName?null===(r=o.processor)||void 0===r?void 0:r.varyingFragmentKeywordName:!o.isFragment&&null!==(w=o.processor)&&void 0!==w&&w.varyingVertexKeywordName?null===(p=o.processor)||void 0===p?void 0:p.varyingVertexKeywordName:"varying";if(!o.isFragment&&z.attributeProcessor&&this.line.startsWith(f))u=z.attributeProcessor(this.line,mm,o.processingContext);else if(z.varyingProcessor&&(null!==(K=z.varyingCheck)&&void 0!==K&&K.call(z,this.line,o.isFragment)||!z.varyingCheck&&this.line.startsWith(Y)))u=z.varyingProcessor(this.line,o.isFragment,mm,o.processingContext);else if(z.uniformProcessor&&z.uniformRegexp&&z.uniformRegexp.test(this.line))o.lookForClosingBracketForUniformBuffer||(u=z.uniformProcessor(this.line,o.isFragment,mm,o.processingContext));else if(z.uniformBufferProcessor&&z.uniformBufferRegexp&&z.uniformBufferRegexp.test(this.line))o.lookForClosingBracketForUniformBuffer||(u=z.uniformBufferProcessor(this.line,o.isFragment,o.processingContext),o.lookForClosingBracketForUniformBuffer=!0);else if(z.textureProcessor&&z.textureRegexp&&z.textureRegexp.test(this.line))u=z.textureProcessor(this.line,o.isFragment,mm,o.processingContext);else if((z.uniformProcessor||z.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!o.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?z.uniformProcessor&&(u=z.uniformProcessor(this.line,o.isFragment,mm,o.processingContext)):z.uniformBufferProcessor&&(u=z.uniformBufferProcessor(this.line,o.isFragment,o.processingContext),o.lookForClosingBracketForUniformBuffer=!0)}o.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(o.lookForClosingBracketForUniformBuffer=!1,z.endOfUniformBufferProcessor&&(u=z.endOfUniformBufferProcessor(this.line,o.isFragment,o.processingContext)))}f+=u+"\n"}for(const z of this.children)f+=z.process(mm,o,u);return this.additionalDefineKey&&(mm[this.additionalDefineKey]=this.additionalDefineValue||"true",u[this.additionalDefineKey]=mm[this.additionalDefineKey]),f}}class B{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(mm){this._lines.length=0;for(const o of mm){if(!o||"\r"===o)continue;if("#"===o[0]){this._lines.push(o);continue}const mm=o.trim();if(!mm)continue;if(mm.startsWith("//")){this._lines.push(o);continue}const u=mm.indexOf(";");if(-1===u)this._lines.push(mm);else if(u===mm.length-1)mm.length>1&&this._lines.push(mm);else{const mm=o.split(";");for(let o=0;o<mm.length;o++){let u=mm[o];u&&(u=u.trim(),u&&this._lines.push(u+(o!==mm.length-1?";":"")))}}}}}class O extends f{process(mm,o,u){for(let f=0;f<this.children.length;f++){const B=this.children[f];if(B.isValid(mm))return B.process(mm,o,u)}return""}}class r extends f{isValid(mm){return this.testExpression.isTrue(mm)}}class w{isTrue(mm){return!0}static postfixToInfix(mm){const o=[];for(const u of mm)if(void 0===w._OperatorPriority[u])o.push(u);else{const mm=o[o.length-1],f=o[o.length-2];o.length-=2,o.push(`(${f}${u}${mm})`)}return o[o.length-1]}static infixToPostfix(mm){const o=w._InfixToPostfixCache.get(mm);if(o)return o.accessTime=Date.now(),o.result;if(!mm.includes("&&")&&!mm.includes("||")&&!mm.includes(")")&&!mm.includes("("))return[mm];const u=[];let f=-1;const B=()=>{z=z.trim(),""!==z&&(u.push(z),z="")},O=mm=>{f<w._Stack.length-1&&(w._Stack[++f]=mm)},r=()=>w._Stack[f],p=()=>-1===f?"!!INVALID EXPRESSION!!":w._Stack[f--];let K=0,z="";for(;K<mm.length;){const o=mm.charAt(K),Y=K<mm.length-1?mm.substring(K,2+K):"";if("("===o)z="",O(o);else if(")"===o){for(B();-1!==f&&"("!==r();)u.push(p());p()}else if(w._OperatorPriority[Y]>1){for(B();-1!==f&&w._OperatorPriority[r()]>=w._OperatorPriority[Y];)u.push(p());O(Y),K++}else z+=o;K++}for(B();-1!==f;)"("===r()?p():u.push(p());return w._InfixToPostfixCache.size>=w.InfixToPostfixCacheLimitSize&&w.ClearCache(),w._InfixToPostfixCache.set(mm,{result:u,accessTime:Date.now()}),u}static ClearCache(){const mm=Array.from(w._InfixToPostfixCache.entries()).sort(((mm,o)=>mm[1].accessTime-o[1].accessTime));for(let o=0;o<w.InfixToPostfixCacheCleanupSize;o++)w._InfixToPostfixCache.delete(mm[o][0])}}w.InfixToPostfixCacheLimitSize=5e4,w.InfixToPostfixCacheCleanupSize=25e3,w._InfixToPostfixCache=new Map,w._OperatorPriority={")":0,"(":1,"||":2,"&&":3},w._Stack=["","","","","","","","","","","","","","","","","","","",""];class p extends w{constructor(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=mm,this.not=o}isTrue(mm){let o=void 0!==mm[this.define];return this.not&&(o=!o),o}}class K extends w{isTrue(mm){return this.leftOperand.isTrue(mm)||this.rightOperand.isTrue(mm)}}class z extends w{isTrue(mm){return this.leftOperand.isTrue(mm)&&this.rightOperand.isTrue(mm)}}class Y extends w{constructor(mm,o,u){super(),this.define=mm,this.operand=o,this.testValue=u}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(mm){let o=!1;const u=parseInt(void 0!=mm[this.define]?mm[this.define]:this.define),f=parseInt(void 0!=mm[this.testValue]?mm[this.testValue]:this.testValue);if(isNaN(u)||isNaN(f))return!1;switch(this.operand){case">":o=u>f;break;case"<":o=u<f;break;case"<=":o=u<=f;break;case">=":o=u>=f;break;case"==":o=u===f;break;case"!=":o=u!==f}return o}}var q=u(12589),x=u(12629);const H=/defined\s*?\((.+?)\)/g,E=/defined\s*?\[(.+?)\]/g,M=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,l=/__decl__/,t=/light\{X\}.(\w*)/g,Q=/\{X\}/g,b=[],J=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function N(mm){mm.processor&&mm.processor.initializeShaders&&mm.processor.initializeShaders(mm.processingContext)}function S(mm,o,u,f){var B;null!==(B=o.processor)&&void 0!==B&&B.preProcessShaderCode&&(mm=o.processor.preProcessShaderCode(mm,o.isFragment)),y(mm,o,(mm=>{o.processCodeAfterIncludes&&(mm=o.processCodeAfterIncludes(o.isFragment?"fragment":"vertex",mm,o.defines));const B=function(mm,o,u){let f=function(mm,o){var u;if(null!==(u=o.processor)&&void 0!==u&&u.noPrecision)return mm;const f=o.shouldUseHighPrecisionShader;-1===mm.indexOf("precision highp float")?mm=f?"precision highp float;\n"+mm:"precision mediump float;\n"+mm:f||(mm=mm.replace("precision highp float","precision mediump float"));return mm}(mm,o);if(!o.processor)return f;if(0===o.processor.shaderLanguage&&-1!==f.indexOf("#version 3")&&(f=f.replace("#version 300 es",""),!o.processor.parseGLES3))return f;const B=o.defines,O=A(o,u);o.processor.preProcessor&&(f=o.processor.preProcessor(f,B,O,o.isFragment,o.processingContext));const r={};f=c(f,O,o,r),o.processor.postProcessor&&(f=o.processor.postProcessor(f,B,o.isFragment,o.processingContext,u?{drawBuffersExtensionDisabled:!u.getCaps().drawBuffersExtension}:{},O,r));null!==u&&void 0!==u&&u._features.needShaderCodeInlining&&(f=u.inlineShaderCode(f));return f}(mm,o,f);u(B,mm)}))}function P(mm,o,u){return u.processor&&u.processor.finalizeShaders?u.processor.finalizeShaders(mm,o,u.processingContext):{vertexCode:mm,fragmentCode:o}}function R(mm){const o=/defined\((.+)\)/.exec(mm);if(o&&o.length)return new p(o[1].trim(),"!"===mm[0]);const u=["==","!=",">=","<=","<",">"];let f="",B=0;for(f of u)if(B=mm.indexOf(f),B>-1)break;if(-1===B)return new p(mm);const O=mm.substring(0,B).trim(),r=mm.substring(B+f.length).trim();return new Y(O,f,r)}function g(mm,o){const u=new r,f=mm.substring(0,o);let B=mm.substring(o);return B=B.substring(0,(B.indexOf("//")+1||B.length+1)-1).trim(),u.testExpression="#ifdef"===f?new p(B):"#ifndef"===f?new p(B,!0):function(mm){mm=mm.replace(H,"defined[$1]");const o=w.infixToPostfix(mm),u=[];for(const B of o)if("||"!==B&&"&&"!==B)u.push(B);else if(u.length>=2){let mm=u[u.length-1],o=u[u.length-2];u.length-=2;const f="&&"==B?new z:new K;"string"===typeof mm&&(mm=mm.replace(E,"defined($1)")),"string"===typeof o&&(o=o.replace(E,"defined($1)")),f.leftOperand="string"===typeof o?R(o):o,f.rightOperand="string"===typeof mm?R(mm):mm,u.push(f)}let f=u[u.length-1];return"string"===typeof f&&(f=f.replace(E,"defined($1)")),"string"===typeof f?R(f):f}(B),u}function W(mm,o,u,B){let O=mm.currentLine;for(;F(mm,u,B);){O=mm.currentLine;const r=O.substring(0,5).toLowerCase();if("#else"===r){const u=new f;return o.children.push(u),void F(mm,u,B)}if("#elif"===r){const mm=g(O,5);o.children.push(mm),u=mm}}}function F(mm,o,u){for(;mm.canRead;){mm.lineIndex++;const B=mm.currentLine;if(B.indexOf("#")>=0){const f=J.exec(B);if(f&&f.length){switch(f[0]){case"#ifdef":{const f=new O;o.children.push(f);const r=g(B,6);f.children.push(r),W(mm,f,r,u);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const f=new O;o.children.push(f);const r=g(B,7);f.children.push(r),W(mm,f,r,u);break}case"#if":{const f=new O,r=g(B,3);o.children.push(f),f.children.push(r),W(mm,f,r,u);break}}continue}}const r=new f;if(r.line=B,o.children.push(r),"#"===B[0]&&"d"===B[1]){const mm=B.replace(";","").split(" ");r.additionalDefineKey=mm[1],3===mm.length&&(r.additionalDefineValue=mm[2])}}return!1}function c(mm,o,u,O){const r=new f,w=new B;return w.lineIndex=-1,w.lines=mm.split("\n"),F(w,r,O),r.process(o,u,O)}function A(mm,o){var u;const f=mm.defines,B={};for(const O of f){const mm=O.replace("#define","").replace(";","").trim().split(" ");B[mm[0]]=mm.length>1?mm[1]:""}return 0===(null===(u=mm.processor)||void 0===u?void 0:u.shaderLanguage)&&(B.GL_ES="true"),B.__VERSION__=mm.version,B[mm.platformName]="true",(0,x.g)(B,null===o||void 0===o?void 0:o.isNDCHalfZRange,null===o||void 0===o?void 0:o.tf,null===o||void 0===o?void 0:o.useExactSrgbConversions),B}function y(mm,o,u){let f;for(b.length=0;null!==(f=M.exec(mm));)b.push(f);let B=String(mm),O=[mm],r=!1;for(const w of b){let mm=w[1];if(-1!==mm.indexOf("__decl__")&&(mm=mm.replace(l,""),o.supportsUniformBuffers&&(mm=mm.replace("Vertex","Ubo").replace("Fragment","Ubo")),mm+="Declaration"),!o.includesShadersStore[mm]){const f=o.shadersRepository+"ShadersInclude/"+mm+".fx";return void I.loadFile(f,(f=>{o.includesShadersStore[mm]=f,y(O.join(""),o,u)}))}{let u=o.includesShadersStore[mm];if(w[2]){const mm=w[3].split(",");for(let o=0;o<mm.length;o+=2){const f=new RegExp(mm[o],"g"),B=mm[o+1];u=u.replace(f,B)}}if(w[4]){const mm=w[5];if(-1!==mm.indexOf("..")){const f=mm.split(".."),B=parseInt(f[0]);let O=parseInt(f[1]),r=u.slice(0);u="",isNaN(O)&&(O=o.indexParameters[f[1]]);for(let mm=B;mm<O;mm++)o.supportsUniformBuffers||(r=r.replace(t,((mm,o)=>o+"{X}"))),u+=r.replace(Q,mm.toString())+"\n"}else o.supportsUniformBuffers||(u=u.replace(t,((mm,o)=>o+"{X}"))),u=u.replace(Q,mm)}const f=[];for(const mm of O){const o=mm.split(w[0]);for(let mm=0;mm<o.length-1;mm++)f.push(o[mm]),f.push(u);f.push(o[o.length-1])}O=f,r=r||u.indexOf("#include<")>=0||u.indexOf("#include <")>=0}}b.length=0,B=O.join(""),r?y(B.toString(),o,u):u(B)}const I={loadFile:(mm,o,u,f,B,O)=>{throw(0,q.d)("FileTools")}}},12629:(mm,o,u)=>{u.d(o,{e:()=>B,f:()=>O,g:()=>w,h:()=>r,j:()=>p});var f=u(12589);u(12562);const B={};function O(mm,o){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(o?o+"\n":"")+mm}function r(mm,o,u,O,r,w,p){const K=p||B.loadFile;if(K){return K(mm,o,u,O,r,w)}throw(0,f.d)("FileTools")}function w(mm,o,u,f){if(mm)return o?mm.IS_NDC_HALF_ZRANGE="":delete mm.IS_NDC_HALF_ZRANGE,u?mm.USE_REVERSE_DEPTHBUFFER="":delete mm.USE_REVERSE_DEPTHBUFFER,void(f?mm.USE_EXACT_SRGB_CONVERSIONS="":delete mm.USE_EXACT_SRGB_CONVERSIONS);{let mm="";return o&&(mm+="#define IS_NDC_HALF_ZRANGE"),u&&(mm&&(mm+="\n"),mm+="#define USE_REVERSE_DEPTHBUFFER"),f&&(mm&&(mm+="\n"),mm+="#define USE_EXACT_SRGB_CONVERSIONS"),mm}}function p(mm,o){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=arguments.length>3?arguments[3]:void 0;switch(mm){case 3:{const mm=(ArrayBuffer,new Int8Array(o));return f&&mm.set(new Int8Array(f)),mm}case 0:{const mm=(ArrayBuffer,new Uint8Array(o));return f&&mm.set(new Uint8Array(f)),mm}case 4:{const mm=o instanceof ArrayBuffer?new Int16Array(o):new Int16Array(u?o/2:o);return f&&mm.set(new Int16Array(f)),mm}case 5:case 8:case 9:case 10:case 2:{const mm=o instanceof ArrayBuffer?new Uint16Array(o):new Uint16Array(u?o/2:o);return f&&mm.set(new Uint16Array(f)),mm}case 6:{const mm=o instanceof ArrayBuffer?new Int32Array(o):new Int32Array(u?o/4:o);return f&&mm.set(new Int32Array(f)),mm}case 7:case 11:case 12:case 13:case 14:case 15:{const mm=o instanceof ArrayBuffer?new Uint32Array(o):new Uint32Array(u?o/4:o);return f&&mm.set(new Uint32Array(f)),mm}case 1:{const mm=o instanceof ArrayBuffer?new Float32Array(o):new Float32Array(u?o/4:o);return f&&mm.set(new Float32Array(f)),mm}}const B=(ArrayBuffer,new Uint8Array(o));return f&&B.set(new Uint8Array(f)),B}},12652:(mm,o,u)=>{u.d(o,{e:()=>f});class f{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?f.ShadersRepository:f.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?f.ShadersStore:f.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?f.IncludesShadersStore:f.IncludesShadersStoreWGSL}}f.ShadersRepository="src/Shaders/",f.ShadersStore={},f.IncludesShadersStore={},f.ShadersRepositoryWGSL="src/ShadersWGSL/",f.ShadersStoreWGSL={},f.IncludesShadersStoreWGSL={}},12662:(mm,o,u)=>{u.d(o,{e:()=>q,f:()=>Q,g:()=>H,i:()=>x,m:()=>E,n:()=>t,p:()=>Y,r:()=>K,u:()=>z,y:()=>p,B:()=>w});class f{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.Mo._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(mm){mm&&this.program&&mm(this.program)}setEngine(mm){this.Mo=mm}_fillEffectInformation(mm,o,u,f,B,O,r,w){const p=this.Mo;if(p.supportsUniformBuffers)for(const z in o)mm.bindUniformBlock(z,o[z]);let K;for(this.Mo.getUniforms(this,u).forEach(((mm,o)=>{f[u[o]]=mm})),this._uniforms=f,K=0;K<B.length;K++){null==mm.getUniform(B[K])&&(B.splice(K,1),K--)}B.forEach(((mm,o)=>{O[mm]=o}));for(const z of p.getAttributes(this,r))w.push(z)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(mm,o){const u=this._valueCache[mm],f=o.updateFlag;return(void 0===u||u!==f)&&(this._valueCache[mm]=f,!0)}_cacheFloat2(mm,o,u){let f=this._valueCache[mm];if(!f||2!==f.length)return f=[o,u],this._valueCache[mm]=f,!0;let B=!1;return f[0]!==o&&(f[0]=o,B=!0),f[1]!==u&&(f[1]=u,B=!0),B}_cacheFloat3(mm,o,u,f){let B=this._valueCache[mm];if(!B||3!==B.length)return B=[o,u,f],this._valueCache[mm]=B,!0;let O=!1;return B[0]!==o&&(B[0]=o,O=!0),B[1]!==u&&(B[1]=u,O=!0),B[2]!==f&&(B[2]=f,O=!0),O}_cacheFloat4(mm,o,u,f,B){let O=this._valueCache[mm];if(!O||4!==O.length)return O=[o,u,f,B],this._valueCache[mm]=O,!0;let r=!1;return O[0]!==o&&(O[0]=o,r=!0),O[1]!==u&&(O[1]=u,r=!0),O[2]!==f&&(O[2]=f,r=!0),O[3]!==B&&(O[3]=B,r=!0),r}setInt(mm,o){const u=this._valueCache[mm];void 0!==u&&u===o||this.Mo.setInt(this._uniforms[mm],o)&&(this._valueCache[mm]=o)}setInt2(mm,o,u){this._cacheFloat2(mm,o,u)&&(this.Mo.setInt2(this._uniforms[mm],o,u)||(this._valueCache[mm]=null))}setInt3(mm,o,u,f){this._cacheFloat3(mm,o,u,f)&&(this.Mo.setInt3(this._uniforms[mm],o,u,f)||(this._valueCache[mm]=null))}setInt4(mm,o,u,f,B){this._cacheFloat4(mm,o,u,f,B)&&(this.Mo.setInt4(this._uniforms[mm],o,u,f,B)||(this._valueCache[mm]=null))}setIntArray(mm,o){this._valueCache[mm]=null,this.Mo.setIntArray(this._uniforms[mm],o)}setIntArray2(mm,o){this._valueCache[mm]=null,this.Mo.setIntArray2(this._uniforms[mm],o)}setIntArray3(mm,o){this._valueCache[mm]=null,this.Mo.setIntArray3(this._uniforms[mm],o)}setIntArray4(mm,o){this._valueCache[mm]=null,this.Mo.setIntArray4(this._uniforms[mm],o)}setUInt(mm,o){const u=this._valueCache[mm];void 0!==u&&u===o||this.Mo.setUInt(this._uniforms[mm],o)&&(this._valueCache[mm]=o)}setUInt2(mm,o,u){this._cacheFloat2(mm,o,u)&&(this.Mo.setUInt2(this._uniforms[mm],o,u)||(this._valueCache[mm]=null))}setUInt3(mm,o,u,f){this._cacheFloat3(mm,o,u,f)&&(this.Mo.setUInt3(this._uniforms[mm],o,u,f)||(this._valueCache[mm]=null))}setUInt4(mm,o,u,f,B){this._cacheFloat4(mm,o,u,f,B)&&(this.Mo.setUInt4(this._uniforms[mm],o,u,f,B)||(this._valueCache[mm]=null))}setUIntArray(mm,o){this._valueCache[mm]=null,this.Mo.setUIntArray(this._uniforms[mm],o)}setUIntArray2(mm,o){this._valueCache[mm]=null,this.Mo.setUIntArray2(this._uniforms[mm],o)}setUIntArray3(mm,o){this._valueCache[mm]=null,this.Mo.setUIntArray3(this._uniforms[mm],o)}setUIntArray4(mm,o){this._valueCache[mm]=null,this.Mo.setUIntArray4(this._uniforms[mm],o)}setArray(mm,o){this._valueCache[mm]=null,this.Mo.setArray(this._uniforms[mm],o)}setArray2(mm,o){this._valueCache[mm]=null,this.Mo.setArray2(this._uniforms[mm],o)}setArray3(mm,o){this._valueCache[mm]=null,this.Mo.setArray3(this._uniforms[mm],o)}setArray4(mm,o){this._valueCache[mm]=null,this.Mo.setArray4(this._uniforms[mm],o)}setMatrices(mm,o){o&&(this._valueCache[mm]=null,this.Mo.setMatrices(this._uniforms[mm],o))}setMatrix(mm,o){this._cacheMatrix(mm,o)&&(this.Mo.setMatrices(this._uniforms[mm],o.df())||(this._valueCache[mm]=null))}setMatrix3x3(mm,o){this._valueCache[mm]=null,this.Mo.setMatrix3x3(this._uniforms[mm],o)}setMatrix2x2(mm,o){this._valueCache[mm]=null,this.Mo.setMatrix2x2(this._uniforms[mm],o)}setFloat(mm,o){const u=this._valueCache[mm];void 0!==u&&u===o||this.Mo.setFloat(this._uniforms[mm],o)&&(this._valueCache[mm]=o)}setVector2(mm,o){this._cacheFloat2(mm,o.x,o.y)&&(this.Mo.setFloat2(this._uniforms[mm],o.x,o.y)||(this._valueCache[mm]=null))}setFloat2(mm,o,u){this._cacheFloat2(mm,o,u)&&(this.Mo.setFloat2(this._uniforms[mm],o,u)||(this._valueCache[mm]=null))}setVector3(mm,o){this._cacheFloat3(mm,o.x,o.y,o.z)&&(this.Mo.setFloat3(this._uniforms[mm],o.x,o.y,o.z)||(this._valueCache[mm]=null))}setFloat3(mm,o,u,f){this._cacheFloat3(mm,o,u,f)&&(this.Mo.setFloat3(this._uniforms[mm],o,u,f)||(this._valueCache[mm]=null))}setVector4(mm,o){this._cacheFloat4(mm,o.x,o.y,o.z,o.w)&&(this.Mo.setFloat4(this._uniforms[mm],o.x,o.y,o.z,o.w)||(this._valueCache[mm]=null))}setQuaternion(mm,o){this._cacheFloat4(mm,o.x,o.y,o.z,o.w)&&(this.Mo.setFloat4(this._uniforms[mm],o.x,o.y,o.z,o.w)||(this._valueCache[mm]=null))}setFloat4(mm,o,u,f,B){this._cacheFloat4(mm,o,u,f,B)&&(this.Mo.setFloat4(this._uniforms[mm],o,u,f,B)||(this._valueCache[mm]=null))}setColor3(mm,o){this._cacheFloat3(mm,o.r,o.g,o.b)&&(this.Mo.setFloat3(this._uniforms[mm],o.r,o.g,o.b)||(this._valueCache[mm]=null))}setColor4(mm,o,u){this._cacheFloat4(mm,o.r,o.g,o.b,u)&&(this.Mo.setFloat4(this._uniforms[mm],o.r,o.g,o.b,u)||(this._valueCache[mm]=null))}setDirectColor4(mm,o){this._cacheFloat4(mm,o.r,o.g,o.b,o.a)&&(this.Mo.setFloat4(this._uniforms[mm],o.r,o.g,o.b,o.a)||(this._valueCache[mm]=null))}_getVertexShaderCode(){return this.vertexShader?this.Mo._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.Mo._getShaderSource(this.fragmentShader):null}}var B=u(12629);const O=new WeakMap,r={_webGLVersion:2,cachedPipelines:{}};function w(mm){let o=O.get(mm);if(!o){if(!mm)return r;o={_webGLVersion:mm.TEXTURE_BINDING_3D?2:1,_context:mm,parallelShaderCompile:mm.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},O.set(mm,o)}return o}function p(mm){O.delete(mm)}function K(mm,o,u,f,B,O){const r=w(f);O||(O=r._createShaderProgramInjection??q);return O(mm,l(o,"vertex",f,r._contextWasLost),l(u,"fragment",f,r._contextWasLost),f,B,r.validateShaderPrograms)}function z(mm,o,u,f,B){let O=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,r=arguments.length>6?arguments[6]:void 0;const p=w(B);r||(r=p._createShaderProgramInjection??q);const K=p._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return r(mm,M(o,"vertex",f,K,B,p._contextWasLost),M(u,"fragment",f,K,B,p._contextWasLost),B,O,p.validateShaderPrograms)}function Y(mm,o){const u=new f,B=w(mm);return B.parallelShaderCompile&&!B.disableParallelShaderCompile&&(u.isParallelCompiled=!0),u.context=B._context,u}function q(mm,o,u,f){let B=arguments.length>5?arguments[5]:void 0;const O=f.createProgram();if(mm.program=O,!O)throw new Error("Unable to create program");return f.attachShader(O,o),f.attachShader(O,u),f.linkProgram(O),mm.context=f,mm.vertexShader=o,mm.fragmentShader=u,mm.isParallelCompiled||H(mm,f,B),O}function x(mm,o,u){const f=mm;if(f._isDisposed)return!1;const B=w(o);return!!(B&&B.parallelShaderCompile&&B.parallelShaderCompile.COMPLETION_STATUS_KHR&&f.program&&o.getProgramParameter(f.program,B.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(H(f,o,u),!0)}function H(mm,o,u){const f=mm.context,B=mm.vertexShader,O=mm.fragmentShader,r=mm.program;if(!f.getProgramParameter(r,f.LINK_STATUS)){if(!o.getShaderParameter(B,o.COMPILE_STATUS)){const u=o.getShaderInfoLog(B);if(u)throw mm.vertexCompilationError=u,new Error("VERTEX SHADER "+u)}if(!o.getShaderParameter(O,o.COMPILE_STATUS)){const u=o.getShaderInfoLog(O);if(u)throw mm.fragmentCompilationError=u,new Error("FRAGMENT SHADER "+u)}const u=f.getProgramInfoLog(r);if(u)throw mm.programLinkError=u,new Error(u)}if(u){f.validateProgram(r);if(!f.getProgramParameter(r,f.VALIDATE_STATUS)){const o=f.getProgramInfoLog(r);if(o)throw mm.programValidationError=o,new Error(o)}}f.deleteShader(B),f.deleteShader(O),mm.vertexShader=void 0,mm.fragmentShader=void 0,mm.onCompiled&&(mm.onCompiled(),mm.onCompiled=void 0)}function E(mm,o,u,f,B,O,r,p,Y){let q=arguments.length>10?arguments[10]:void 0,x=arguments.length>11?arguments[11]:void 0,H=arguments.length>12?arguments[12]:void 0;const E=w(mm.context);x||(x=E.createRawShaderProgramInjection??K),H||(H=E.createShaderProgramInjection??z);const M=mm;M.program=f?x(M,o,u,M.context,Y):H(M,o,u,p,M.context,Y),M.program.__SPECTOR_rebuildProgram=r,q()}function M(mm,o,u,f,O,r){return l((0,B.f)(mm,u,f),o,O,r)}function l(mm,o,u,f){const B=u.createShader("vertex"===o?u.VERTEX_SHADER:u.FRAGMENT_SHADER);if(!B){let mm=u.NO_ERROR,B=u.NO_ERROR;for(;(B=u.getError())!==u.NO_ERROR;)mm=B;throw new Error(`Something went wrong while creating a gl ${o} shader object. gl error=${mm}, gl isContextLost=${u.isContextLost()}, _contextWasLost=${f}`)}return u.shaderSource(B,mm),u.compileShader(B),B}function t(mm,o){o.useProgram(mm)}function Q(mm,o){const u=mm;if(!u.isParallelCompiled)return void o(mm);const f=u.onCompiled;u.onCompiled=()=>{null===f||void 0===f||f(),o(mm)}}},12655:(mm,o,u)=>{u.d(o,{c:()=>Y,f:()=>x,i:()=>K,l:()=>z});var f=u(12562),B=u(12662),O=u(12652),r=u(12565),w=u(12620),p=u(12629);function K(mm,o){return(0,B.B)(o).cachedPipelines[mm]}function z(mm){const o=mm._name,u=mm.context;if(o&&u){const mm=(0,B.B)(u),f=mm.cachedPipelines[o];null===f||void 0===f||f.dispose(),delete mm.cachedPipelines[o]}}function Y(mm,o,u,B,O,r,p){let K,z;const Y=(0,f.j)()?null===r||void 0===r?void 0:r.getHostDocument():null;K="string"===typeof o?o:o.vertexSource?"source:"+o.vertexSource:o.vertexElement?(null===Y||void 0===Y?void 0:Y.getElementById(o.vertexElement))||o.vertexElement:o.vertex||o,z="string"===typeof o?o:o.fragmentSource?"source:"+o.fragmentSource:o.fragmentElement?(null===Y||void 0===Y?void 0:Y.getElementById(o.fragmentElement))||o.fragmentElement:o.fragment||o;const x=[void 0,void 0],H=()=>{if(x[0]&&x[1]){mm.isFragment=!0;const[f,K]=x;(0,w.k)(K,mm,((r,K)=>{p&&(p._fragmentSourceCodeBeforeMigration=K),u&&(r=u("fragment",r));const z=(0,w.c)(f,r,mm);mm=null;const Y=function(mm,o,u,f){if(u){return{vertexSourceCode:(1===f?"//":"")+"#define SHADER_NAME vertex:"+(u.vertexElement||u.vertex||u.spectorName||u)+"\n"+mm,fragmentSourceCode:(1===f?"//":"")+"#define SHADER_NAME fragment:"+(u.fragmentElement||u.fragment||u.spectorName||u)+"\n"+o}}return{vertexSourceCode:mm,fragmentSourceCode:o}}(z.vertexCode,z.fragmentCode,o,O);null===B||void 0===B||B(Y.vertexSourceCode,Y.fragmentSourceCode)}),r)}};q(K,"Vertex","",(o=>{(0,w.e)(mm),(0,w.k)(o,mm,((mm,f)=>{p&&(p._rawVertexSourceCode=o,p._vertexSourceCodeBeforeMigration=f),u&&(mm=u("vertex",mm)),x[0]=mm,H()}),r)}),O),q(z,"Fragment","Pixel",(mm=>{p&&(p._rawFragmentSourceCode=mm),x[1]=mm,H()}),O)}function q(mm,o,u,B,r,w){if("undefined"!==typeof HTMLElement&&mm instanceof HTMLElement){return void B((0,f.b)(mm))}if("source:"===mm.substring(0,7))return void B(mm.substring(7));if("base64:"===mm.substring(0,7)){return void B(window.atob(mm.substring(7)))}const K=O.e.GetShadersStore(r);if(K[mm+o+"Shader"])return void B(K[mm+o+"Shader"]);if(u&&K[mm+u+"Shader"])return void B(K[mm+u+"Shader"]);let z;if(z="."===mm[0]||"/"===mm[0]||mm.indexOf("http")>-1?mm:O.e.GetShadersRepository(r)+mm,!(w=w||p.h))throw new Error("loadFileInjection is not defined");w(z+"."+o.toLowerCase()+".fx",B)}const x=(mm,o,u,f)=>{try{const O=mm.context?(0,B.B)(mm.context):null;O&&(O.disableParallelShaderCompile=mm.disableParallelCompilation);const r=mm.existingPipelineContext||o(mm.shaderProcessingContext);return r._name=mm.name,mm.name&&O&&(O.cachedPipelines[mm.name]=r),u(r,mm.vertex,mm.fragment,!!mm.createAsRaw,"","",mm.rebuildRebind,mm.defines,mm.transformFeedbackVaryings,"",(()=>{f(r,(()=>{var o;null===(o=mm.onRenderingStateCompiled)||void 0===o||o.call(mm,r)}))})),r}catch(O){throw r.e.Error("Error compiling effect"),O}}},12644:(mm,o,u)=>{u.r(o),u.d(o,{Effect:()=>p});var f=u(12556),B=u(12565),O=u(12652),r=u(12655),w=u(12634);class p{static get ShadersRepository(){return O.e.ShadersRepository}static set ShadersRepository(mm){O.e.ShadersRepository=mm}get q(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new f.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(mm,o,u){let B=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,O=arguments.length>4?arguments[4]:void 0,w=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,K=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,z=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,q=arguments.length>9?arguments[9]:void 0,x=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",H=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,E=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new f.d,this.onErrorObservable=new f.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=mm,this._key=x;const M=this._key.replace(/\r/g,"").replace(/\n/g,"|");let l;if(o.attributes){const mm=o;if(this._engine=u,this._attributesNames=mm.attributes,this._uniformsNames=mm.uniformsNames.concat(mm.samplers),this._samplerList=mm.samplers.slice(),this.defines=mm.defines,this.onError=mm.onError,this.onCompiled=mm.onCompiled,this._fallbacks=mm.fallbacks,this._indexParameters=mm.indexParameters,this._transformFeedbackVaryings=mm.transformFeedbackVaryings||null,this._multiTarget=!!mm.multiTarget,this._shaderLanguage=mm.shaderLanguage??0,this._disableParallelShaderCompilation=!!mm.disableParallelShaderCompilation,mm.uniformBuffersNames){this._uniformBuffersNamesList=mm.uniformBuffersNames.slice();for(let o=0;o<mm.uniformBuffersNames.length;o++)this._uniformBuffersNames[mm.uniformBuffersNames[o]]=o}this._processFinalCode=mm.processFinalCode??null,this._processCodeAfterIncludes=mm.processCodeAfterIncludes??void 0,E=mm.extraInitializationsAsync,l=mm.existingPipelineContext}else this._engine=O,this.defines=null==w?"":w,this._uniformsNames=u.concat(B),this._samplerList=B?B.slice():[],this._attributesNames=o,this._uniformBuffersNamesList=[],this._shaderLanguage=H,this.onError=Y,this.onCompiled=z,this._indexParameters=q,this._fallbacks=K;"WEBGL2"===this._engine.shaderPlatformName&&(l=(0,r.i)(M,this._engine._gl)??l),this._attributeLocationByName={},this.uniqueId=p._UniqueIdSeed++,l?(this._pipelineContext=l,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,E),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.q||this.dispose(!0)}))}async _processShaderCodeAsync(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,f=arguments.length>3?arguments[3]:void 0;f&&await f(),this._processingContext=u||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const B={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:mm??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:O.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:O.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,tf:this._engine.tf,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,r.c)(B,this.name,this._processFinalCode,((mm,u)=>{this._vertexSourceCode=mm,this._fragmentSourceCode=u,this._prepareEffect(o)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.q||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(mm){return this._attributes[mm]}getAttributeLocationByName(mm){return this._attributeLocationByName[mm]}getAttributesCount(){return this._attributes.length}getUniformIndex(mm){return this._uniformsNames.indexOf(mm)}getUniform(mm){return this._uniforms[mm]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((mm=>{this.executeWhenCompiled(mm)}))}executeWhenCompiled(mm){this.isReady()?mm(this):(this.onCompileObservable.add((o=>{mm(o)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(mm){(0,w.g)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(o=>{this._processCompilationErrors(o,mm)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var mm;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(mm=this._pipelineContext)||void 0===mm?void 0:mm._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var mm;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(mm=this._pipelineContext)||void 0===mm?void 0:mm._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,tf:this._engine.tf,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(mm,o,u,f){this._isReady=!1,this._vertexSourceCodeOverride=mm,this._fragmentSourceCodeOverride=o,this.onError=(mm,o)=>{f&&f(o)},this.onCompiled=()=>{var mm,o;const f=this.getEngine().scenes;if(f)for(let u=0;u<f.length;u++)f[u].markAllMaterialsAsDirty(127);null===(mm=(o=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===mm||mm.call(o,u)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(mm){if(this._pipelineContext=mm,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let o=0;o<this._attributesNames.length;o++){const mm=this._attributesNames[o];this._attributeLocationByName[mm]=this._attributes[o]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),p.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o=this._pipelineContext;this._isReady=!1;try{const u=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),f=u?null:this.defines,B=u?this._vertexSourceCodeOverride:this._vertexSourceCode,O=u?this._fragmentSourceCodeOverride:this._fragmentSourceCode,w=this._engine;this._pipelineContext=(0,r.f)({existingPipelineContext:mm?o:null,vertex:B,fragment:O,context:"WEBGL2"===w.shaderPlatformName||"WEBGL1"===w.shaderPlatformName?w._gl:void 0,rebuildRebind:(mm,o,u,f)=>this._rebuildProgram(mm,o,u,f),defines:f,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:u,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:u=>{o&&!mm&&this._engine._deletePipelineContext(o),u&&this._onRenderingStateCompiled(u)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(o)}catch(u){this._processCompilationErrors(u,o)}}_getShaderCodeAndErrorLine(mm,o,u){const f=u?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let B=null;if(o&&mm){const O=o.match(f);if(O&&2===O.length){const o=parseInt(O[1]),f=mm.split("\n",-1);f.length>=o&&(B=`Offending line [${o}] in ${u?"fragment":"vertex"} code: ${f[o-1]}`)}}return[mm,B]}_processCompilationErrors(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=mm.message;const u=this._attributesNames,f=this._fallbacks;if(B.e.Error("Unable to compile effect:"),B.e.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),B.e.Error(`Attributes: ${u.join(" ")}`),B.e.Error("Defines:\n"+this.defines),p.LogShaderCodeOnCompilationError){var O,r;let mm=null,o=null,u=null;var w;if(null!==(O=this._pipelineContext)&&void 0!==O&&O._getVertexShaderCode()&&([u,mm]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),u&&(B.e.Error("Vertex code:"),B.e.Error(u))),null!==(r=this._pipelineContext)&&void 0!==r&&r._getFragmentShaderCode())[u,o]=this._getShaderCodeAndErrorLine(null===(w=this._pipelineContext)||void 0===w?void 0:w._getFragmentShaderCode(),this._compilationError,!0),u&&(B.e.Error("Fragment code:"),B.e.Error(u));mm&&B.e.Error(mm),o&&B.e.Error(o)}B.e.Error("Error: "+this._compilationError);const K=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};o&&(this._pipelineContext=o,this._isReady=!0,K()),f?(this._pipelineContext=null,f.hasMoreFallbacks?(this._allFallbacksProcessed=!1,B.e.Error("Trying next fallback."),this.defines=f.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,K(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,o||K())}get isSupported(){return""===this._compilationError}_bindTexture(mm,o){this._engine._bindTexture(this._samplers[mm],o,mm)}setTexture(mm,o){this._engine.setTexture(this._samplers[mm],this._uniforms[mm],o,mm)}setTextureArray(mm,o){const u=mm+"Ex";if(-1===this._samplerList.indexOf(u+"0")){const f=this._samplerList.indexOf(mm);for(let mm=1;mm<o.length;mm++){const o=u+(mm-1).toString();this._samplerList.splice(f+mm,0,o)}let B=0;for(const mm of this._samplerList)this._samplers[mm]=B,B+=1}this._engine.setTextureArray(this._samplers[mm],this._uniforms[mm],o,mm)}bindUniformBuffer(mm,o){const u=this._uniformBuffersNames[o];void 0===u||p._BaseCache[u]===mm&&this._engine._features.useUBOBindingCache||(p._BaseCache[u]=mm,this._engine.bindUniformBufferBase(mm,u,o))}bindUniformBlock(mm,o){this._engine.bindUniformBlock(this._pipelineContext,mm,o)}setInt(mm,o){return this._pipelineContext.setInt(mm,o),this}setInt2(mm,o,u){return this._pipelineContext.setInt2(mm,o,u),this}setInt3(mm,o,u,f){return this._pipelineContext.setInt3(mm,o,u,f),this}setInt4(mm,o,u,f,B){return this._pipelineContext.setInt4(mm,o,u,f,B),this}setIntArray(mm,o){return this._pipelineContext.setIntArray(mm,o),this}setIntArray2(mm,o){return this._pipelineContext.setIntArray2(mm,o),this}setIntArray3(mm,o){return this._pipelineContext.setIntArray3(mm,o),this}setIntArray4(mm,o){return this._pipelineContext.setIntArray4(mm,o),this}setUInt(mm,o){return this._pipelineContext.setUInt(mm,o),this}setUInt2(mm,o,u){return this._pipelineContext.setUInt2(mm,o,u),this}setUInt3(mm,o,u,f){return this._pipelineContext.setUInt3(mm,o,u,f),this}setUInt4(mm,o,u,f,B){return this._pipelineContext.setUInt4(mm,o,u,f,B),this}setUIntArray(mm,o){return this._pipelineContext.setUIntArray(mm,o),this}setUIntArray2(mm,o){return this._pipelineContext.setUIntArray2(mm,o),this}setUIntArray3(mm,o){return this._pipelineContext.setUIntArray3(mm,o),this}setUIntArray4(mm,o){return this._pipelineContext.setUIntArray4(mm,o),this}setFloatArray(mm,o){return this._pipelineContext.setArray(mm,o),this}setFloatArray2(mm,o){return this._pipelineContext.setArray2(mm,o),this}setFloatArray3(mm,o){return this._pipelineContext.setArray3(mm,o),this}setFloatArray4(mm,o){return this._pipelineContext.setArray4(mm,o),this}setArray(mm,o){return this._pipelineContext.setArray(mm,o),this}setArray2(mm,o){return this._pipelineContext.setArray2(mm,o),this}setArray3(mm,o){return this._pipelineContext.setArray3(mm,o),this}setArray4(mm,o){return this._pipelineContext.setArray4(mm,o),this}setMatrices(mm,o){return this._pipelineContext.setMatrices(mm,o),this}setMatrix(mm,o){return this._pipelineContext.setMatrix(mm,o),this}setMatrix3x3(mm,o){return this._pipelineContext.setMatrix3x3(mm,o),this}setMatrix2x2(mm,o){return this._pipelineContext.setMatrix2x2(mm,o),this}setFloat(mm,o){return this._pipelineContext.setFloat(mm,o),this}setBool(mm,o){return this._pipelineContext.setInt(mm,o?1:0),this}setVector2(mm,o){return this._pipelineContext.setVector2(mm,o),this}setFloat2(mm,o,u){return this._pipelineContext.setFloat2(mm,o,u),this}setVector3(mm,o){return this._pipelineContext.setVector3(mm,o),this}setFloat3(mm,o,u,f){return this._pipelineContext.setFloat3(mm,o,u,f),this}setVector4(mm,o){return this._pipelineContext.setVector4(mm,o),this}setQuaternion(mm,o){return this._pipelineContext.setQuaternion(mm,o),this}setFloat4(mm,o,u,f,B){return this._pipelineContext.setFloat4(mm,o,u,f,B),this}setColor3(mm,o){return this._pipelineContext.setColor3(mm,o),this}setColor4(mm,o,u){return this._pipelineContext.setColor4(mm,o,u),this}setDirectColor4(mm,o){return this._pipelineContext.setDirectColor4(mm,o),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(p.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,r.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;o&&(O.e.GetShadersStore(f)[`${mm}PixelShader`]=o),u&&(O.e.GetShadersStore(f)[`${mm}VertexShader`]=u)}static ResetCache(){p._BaseCache={}}}p.LogShaderCodeOnCompilationError=!0,p.PersistentMode=!1,p.AutomaticallyClearCodeCache=!1,p._UniqueIdSeed=0,p._BaseCache={},p.ShadersStore=O.e.ShadersStore,p.IncludesShadersStore=O.e.IncludesShadersStore},12589:(mm,o,u)=>{u.d(o,{d:()=>B});const f={};function B(mm){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!f[mm])return f[mm]=!0,`${mm} needs to be imported before as it contains a side-effect required by your code.`}},12562:(mm,o,u)=>{function f(){return"undefined"!==typeof window}function B(){return"undefined"!==typeof navigator}function O(){return"undefined"!==typeof document}function r(mm){let o="",u=mm.firstChild;for(;u;)3===u.nodeType&&(o+=u.textContent),u=u.nextSibling;return o}u.d(o,{b:()=>r,e:()=>O,g:()=>B,j:()=>f})},12565:(mm,o,u)=>{u.d(o,{e:()=>f});class f{static _CheckLimit(mm,o){let u=f._LogLimitOutputs[mm];return u?u.current++:(u={limit:o,current:1},f._LogLimitOutputs[mm]=u),u.current<=u.limit}static _GenerateLimitMessage(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const u=f._LogLimitOutputs[mm];if(!u||!f.MessageLimitReached)return;const B=this._Levels[o];u.current===u.limit&&f[B.name](f.MessageLimitReached.replace(/%LIMIT%/g,""+u.limit).replace(/%TYPE%/g,B.name??""))}static _AddLogEntry(mm){f._LogCache=mm+f._LogCache,f.OnNewCacheEntry&&f.OnNewCacheEntry(mm)}static _FormatMessage(mm){const o=mm=>mm<10?"0"+mm:""+mm,u=new Date;return"["+o(u.getHours())+":"+o(u.getMinutes())+":"+o(u.getSeconds())+"]: "+mm}static _LogDisabled(mm,o){}static _LogEnabled(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,o=arguments.length>1?arguments[1]:void 0,u=arguments.length>2?arguments[2]:void 0;const B=Array.isArray(o)?o[0]:o;if(void 0!==u&&!f._CheckLimit(B,u))return;const O=f._FormatMessage(B),r=this._Levels[mm],w=Array.isArray(o)?o.slice(1):[];r.logFunc&&r.logFunc("BJS - "+O,...w);const p=`<div style='color:${r.color}'>${O}</div><br>`;f._AddLogEntry(p),f._GenerateLimitMessage(B,mm)}static get LogCache(){return f._LogCache}static ClearLogCache(){f._LogCache="",f._LogLimitOutputs={},f.errorsCount=0}static set LogLevels(mm){f.Log=f._LogDisabled,f.Warn=f._LogDisabled,f.Error=f._LogDisabled;const o=[f.MessageLogLevel,f.WarningLogLevel,f.ErrorLogLevel];for(const u of o)if((mm&u)===u){const mm=this._Levels[u];f[mm.name]=f._LogEnabled.bind(f,u)}}}f.NoneLogLevel=0,f.MessageLogLevel=1,f.WarningLogLevel=2,f.ErrorLogLevel=4,f.AllLogLevel=7,f.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",f._LogCache="",f._LogLimitOutputs={},f._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],f.errorsCount=0,f.Log=f._LogEnabled.bind(f,f.MessageLogLevel),f.Warn=f._LogEnabled.bind(f,f.WarningLogLevel),f.Error=f._LogEnabled.bind(f,f.ErrorLogLevel)},12556:(mm,o,u)=>{u.d(o,{d:()=>r});const f="undefined"!==typeof WeakRef;class B{constructor(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2?arguments[2]:void 0,f=arguments.length>3?arguments[3]:void 0;this.initialize(mm,o,u,f)}initialize(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1],u=arguments.length>2?arguments[2]:void 0,f=arguments.length>3?arguments[3]:void 0;return this.mask=mm,this.skipNextObservers=o,this.target=u,this.currentTarget=f,this}}class O{constructor(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=mm,this.mask=o,this.scope=u,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(mm)}}class r{static FromPromise(mm,o){const u=new r;return mm.then((mm=>{u.notifyObservers(mm)})).catch((mm=>{if(!o)throw mm;o.notifyObservers(mm)})),u}get observers(){return this._observers}constructor(mm){let o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=o,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new B(0),mm&&(this._onObserverAdded=mm)}add(mm){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],u=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!mm)return null;const B=new O(mm,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);B.unregisterOnNextCall=u,o?this._observers.unshift(B):this._observers.push(B),this._onObserverAdded&&this._onObserverAdded(B),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(B,this._lastNotifiedValue);const r=f?new WeakRef(this):{deref:()=>this};return B._remove=function(){let mm=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const o=r.deref();o&&(mm?o.remove(B):o._remove(B))},B}addOnce(mm){return this.add(mm,void 0,void 0,void 0,!0)}remove(mm){if(!mm)return!1;mm._remove=null;return-1!==this._observers.indexOf(mm)&&(this._deferUnregister(mm),!0)}removeCallback(mm,o){for(let u=0;u<this._observers.length;u++){const f=this._observers[u];if(!f._willBeUnregistered&&(f.callback===mm&&(!o||o===f.scope)))return this._deferUnregister(f),!0}return!1}_deferUnregister(mm){mm._willBeUnregistered||(this._numObserversMarkedAsDeleted++,mm.unregisterOnNextCall=!1,mm._willBeUnregistered=!0,setTimeout((()=>{this._remove(mm)}),0))}_remove(mm){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!mm)return!1;const u=this._observers.indexOf(mm);return-1!==u&&(o&&this._numObserversMarkedAsDeleted--,this._observers.splice(u,1),!0)}makeObserverTopPriority(mm){this._remove(mm,!1),this._observers.unshift(mm)}makeObserverBottomPriority(mm){this._remove(mm,!1),this._observers.push(mm)}notifyObservers(mm){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,u=arguments.length>2?arguments[2]:void 0,f=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=mm),!this._observers.length)return!0;const O=this._eventState;O.mask=o,O.target=u,O.currentTarget=f,O.skipNextObservers=!1,O.lastReturnValue=mm,O.userInfo=B;for(const r of this._observers)if(!r._willBeUnregistered&&(r.mask&o&&(r.unregisterOnNextCall&&this._deferUnregister(r),r.scope?O.lastReturnValue=r.callback.apply(r.scope,[mm,O]):O.lastReturnValue=r.callback(mm,O)),O.skipNextObservers))return!1;return!0}notifyObserver(mm,o){let u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=o),mm._willBeUnregistered)return;const f=this._eventState;f.mask=u,f.skipNextObservers=!1,mm.unregisterOnNextCall&&this._deferUnregister(mm),mm.callback(o,f)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const mm=this._observers.pop();mm&&(mm._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const mm=new r;return mm._observers=this._observers.slice(0),mm}hasSpecificMask(){let mm=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const o of this._observers)if(o.mask&mm||o.mask===mm)return!0;return!1}}},12634:(mm,o,u)=>{u.d(o,{c:()=>B,g:()=>r});let f=[];class B{static SetImmediate(mm){0===f.length&&setTimeout((()=>{const mm=f;f=[];for(const o of mm)o()}),1),f.push(mm)}}function O(mm,o,u){try{if(mm())return o(),!0}catch(f){return null===u||void 0===u||u(f),!0}return!1}const r=function(mm,o,u){let f=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,r=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&O(mm,o,u))return null;const w=setInterval((()=>{O(mm,o,u)?clearInterval(w):(B-=f,B<0&&(clearInterval(w),null===u||void 0===u||u(new Error("Operation timed out after maximum retries. "+(r||"")),!0)))}),f);return()=>clearInterval(w)}}}]);