"use strict";(self["269hv5nclphh"]=self["269hv5nclphh"]||[]).push([[9],{12281:(E,H,d)=>{d.d(H,{c:()=>P,d:()=>p,f:()=>f,e:()=>u,g:()=>o});class n{constructor(){this.children=[]}isValid(E){return!0}process(E,H,d){let n="";if(this.line){let d=this.line;const S=H.processor;if(S){var Z,I,g,l,r,t;S.lineProcessor&&(d=S.lineProcessor(d,H.isFragment,H.processingContext));const n=(null===(Z=H.processor)||void 0===Z?void 0:Z.attributeKeywordName)??"attribute",M=H.isFragment&&null!==(I=H.processor)&&void 0!==I&&I.varyingFragmentKeywordName?null===(g=H.processor)||void 0===g?void 0:g.varyingFragmentKeywordName:!H.isFragment&&null!==(l=H.processor)&&void 0!==l&&l.varyingVertexKeywordName?null===(r=H.processor)||void 0===r?void 0:r.varyingVertexKeywordName:"varying";if(!H.isFragment&&S.attributeProcessor&&this.line.startsWith(n))d=S.attributeProcessor(this.line,E,H.processingContext);else if(S.varyingProcessor&&(null!==(t=S.varyingCheck)&&void 0!==t&&t.call(S,this.line,H.isFragment)||!S.varyingCheck&&this.line.startsWith(M)))d=S.varyingProcessor(this.line,H.isFragment,E,H.processingContext);else if(S.uniformProcessor&&S.uniformRegexp&&S.uniformRegexp.test(this.line))H.lookForClosingBracketForUniformBuffer||(d=S.uniformProcessor(this.line,H.isFragment,E,H.processingContext));else if(S.uniformBufferProcessor&&S.uniformBufferRegexp&&S.uniformBufferRegexp.test(this.line))H.lookForClosingBracketForUniformBuffer||(d=S.uniformBufferProcessor(this.line,H.isFragment,H.processingContext),H.lookForClosingBracketForUniformBuffer=!0);else if(S.textureProcessor&&S.textureRegexp&&S.textureRegexp.test(this.line))d=S.textureProcessor(this.line,H.isFragment,E,H.processingContext);else if((S.uniformProcessor||S.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!H.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?S.uniformProcessor&&(d=S.uniformProcessor(this.line,H.isFragment,E,H.processingContext)):S.uniformBufferProcessor&&(d=S.uniformBufferProcessor(this.line,H.isFragment,H.processingContext),H.lookForClosingBracketForUniformBuffer=!0)}H.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(H.lookForClosingBracketForUniformBuffer=!1,S.endOfUniformBufferProcessor&&(d=S.endOfUniformBufferProcessor(this.line,H.isFragment,H.processingContext)))}n+=d+"\n"}for(const S of this.children)n+=S.process(E,H,d);return this.additionalDefineKey&&(E[this.additionalDefineKey]=this.additionalDefineValue||"true",d[this.additionalDefineKey]=E[this.additionalDefineKey]),n}}class Z{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(E){this._lines.length=0;for(const H of E){if(!H||"\r"===H)continue;if("#"===H[0]){this._lines.push(H);continue}const E=H.trim();if(!E)continue;if(E.startsWith("//")){this._lines.push(H);continue}const d=E.indexOf(";");if(-1===d)this._lines.push(E);else if(d===E.length-1)E.length>1&&this._lines.push(E);else{const E=H.split(";");for(let H=0;H<E.length;H++){let d=E[H];d&&(d=d.trim(),d&&this._lines.push(d+(H!==E.length-1?";":"")))}}}}}class I extends n{process(E,H,d){for(let n=0;n<this.children.length;n++){const Z=this.children[n];if(Z.isValid(E))return Z.process(E,H,d)}return""}}class g extends n{isValid(E){return this.testExpression.isTrue(E)}}class l{isTrue(E){return!0}static postfixToInfix(E){const H=[];for(const d of E)if(void 0===l._OperatorPriority[d])H.push(d);else{const E=H[H.length-1],n=H[H.length-2];H.length-=2,H.push(`(${n}${d}${E})`)}return H[H.length-1]}static infixToPostfix(E){const H=l._InfixToPostfixCache.get(E);if(H)return H.accessTime=Date.now(),H.result;if(!E.includes("&&")&&!E.includes("||")&&!E.includes(")")&&!E.includes("("))return[E];const d=[];let n=-1;const Z=()=>{S=S.trim(),""!==S&&(d.push(S),S="")},I=E=>{n<l._Stack.length-1&&(l._Stack[++n]=E)},g=()=>l._Stack[n],r=()=>-1===n?"!!INVALID EXPRESSION!!":l._Stack[n--];let t=0,S="";for(;t<E.length;){const H=E.charAt(t),M=t<E.length-1?E.substring(t,2+t):"";if("("===H)S="",I(H);else if(")"===H){for(Z();-1!==n&&"("!==g();)d.push(r());r()}else if(l._OperatorPriority[M]>1){for(Z();-1!==n&&l._OperatorPriority[g()]>=l._OperatorPriority[M];)d.push(r());I(M),t++}else S+=H;t++}for(Z();-1!==n;)"("===g()?r():d.push(r());return l._InfixToPostfixCache.size>=l.InfixToPostfixCacheLimitSize&&l.ClearCache(),l._InfixToPostfixCache.set(E,{result:d,accessTime:Date.now()}),d}static ClearCache(){const E=Array.from(l._InfixToPostfixCache.entries()).sort(((E,H)=>E[1].accessTime-H[1].accessTime));for(let H=0;H<l.InfixToPostfixCacheCleanupSize;H++)l._InfixToPostfixCache.delete(E[H][0])}}l.InfixToPostfixCacheLimitSize=5e4,l.InfixToPostfixCacheCleanupSize=25e3,l._InfixToPostfixCache=new Map,l._OperatorPriority={")":0,"(":1,"||":2,"&&":3},l._Stack=["","","","","","","","","","","","","","","","","","","",""];class r extends l{constructor(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=E,this.not=H}isTrue(E){let H=void 0!==E[this.define];return this.not&&(H=!H),H}}class t extends l{isTrue(E){return this.leftOperand.isTrue(E)||this.rightOperand.isTrue(E)}}class S extends l{isTrue(E){return this.leftOperand.isTrue(E)&&this.rightOperand.isTrue(E)}}class M extends l{constructor(E,H,d){super(),this.define=E,this.operand=H,this.testValue=d}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(E){let H=!1;const d=parseInt(void 0!=E[this.define]?E[this.define]:this.define),n=parseInt(void 0!=E[this.testValue]?E[this.testValue]:this.testValue);if(isNaN(d)||isNaN(n))return!1;switch(this.operand){case">":H=d>n;break;case"<":H=d<n;break;case"<=":H=d<=n;break;case">=":H=d>=n;break;case"==":H=d===n;break;case"!=":H=d!==n}return H}}var V=d(12256),C=d(12283);const w=/defined\s*?\((.+?)\)/g,R=/defined\s*?\[(.+?)\]/g,Q=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,L=/__decl__/,D=/light\{X\}.(\w*)/g,e=/\{X\}/g,s=[],i=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function p(E){E.processor&&E.processor.initializeShaders&&E.processor.initializeShaders(E.processingContext)}function f(E,H,d,n){var Z;null!==(Z=H.processor)&&void 0!==Z&&Z.preProcessShaderCode&&(E=H.processor.preProcessShaderCode(E,H.isFragment)),u(E,H,(E=>{H.processCodeAfterIncludes&&(E=H.processCodeAfterIncludes(H.isFragment?"fragment":"vertex",E,H.defines));const Z=function(E,H,d){let n=function(E,H){var d;if(null!==(d=H.processor)&&void 0!==d&&d.noPrecision)return E;const n=H.shouldUseHighPrecisionShader;-1===E.indexOf("precision highp float")?E=n?"precision highp float;\n"+E:"precision mediump float;\n"+E:n||(E=E.replace("precision highp float","precision mediump float"));return E}(E,H);if(!H.processor)return n;if(0===H.processor.shaderLanguage&&-1!==n.indexOf("#version 3")&&(n=n.replace("#version 300 es",""),!H.processor.parseGLES3))return n;const Z=H.defines,I=c(H,d);H.processor.preProcessor&&(n=H.processor.preProcessor(n,Z,I,H.isFragment,H.processingContext));const g={};n=Y(n,I,H,g),H.processor.postProcessor&&(n=H.processor.postProcessor(n,Z,H.isFragment,H.processingContext,d?{drawBuffersExtensionDisabled:!d.getCaps().drawBuffersExtension}:{},I,g));null!==d&&void 0!==d&&d._features.needShaderCodeInlining&&(n=d.inlineShaderCode(n));return n}(E,H,n);d(Z,E)}))}function P(E,H,d){return d.processor&&d.processor.finalizeShaders?d.processor.finalizeShaders(E,H,d.processingContext):{vertexCode:E,fragmentCode:H}}function j(E){const H=/defined\((.+)\)/.exec(E);if(H&&H.length)return new r(H[1].trim(),"!"===E[0]);const d=["==","!=",">=","<=","<",">"];let n="",Z=0;for(n of d)if(Z=E.indexOf(n),Z>-1)break;if(-1===Z)return new r(E);const I=E.substring(0,Z).trim(),g=E.substring(Z+n.length).trim();return new M(I,n,g)}function X(E,H){const d=new g,n=E.substring(0,H);let Z=E.substring(H);return Z=Z.substring(0,(Z.indexOf("//")+1||Z.length+1)-1).trim(),d.testExpression="#ifdef"===n?new r(Z):"#ifndef"===n?new r(Z,!0):function(E){E=E.replace(w,"defined[$1]");const H=l.infixToPostfix(E),d=[];for(const Z of H)if("||"!==Z&&"&&"!==Z)d.push(Z);else if(d.length>=2){let E=d[d.length-1],H=d[d.length-2];d.length-=2;const n="&&"==Z?new S:new t;"string"===typeof E&&(E=E.replace(R,"defined($1)")),"string"===typeof H&&(H=H.replace(R,"defined($1)")),n.leftOperand="string"===typeof H?j(H):H,n.rightOperand="string"===typeof E?j(E):E,d.push(n)}let n=d[d.length-1];return"string"===typeof n&&(n=n.replace(R,"defined($1)")),"string"===typeof n?j(n):n}(Z),d}function W(E,H,d,Z){let I=E.currentLine;for(;U(E,d,Z);){I=E.currentLine;const g=I.substring(0,5).toLowerCase();if("#else"===g){const d=new n;return H.children.push(d),void U(E,d,Z)}if("#elif"===g){const E=X(I,5);H.children.push(E),d=E}}}function U(E,H,d){for(;E.canRead;){E.lineIndex++;const Z=E.currentLine;if(Z.indexOf("#")>=0){const n=i.exec(Z);if(n&&n.length){switch(n[0]){case"#ifdef":{const n=new I;H.children.push(n);const g=X(Z,6);n.children.push(g),W(E,n,g,d);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const n=new I;H.children.push(n);const g=X(Z,7);n.children.push(g),W(E,n,g,d);break}case"#if":{const n=new I,g=X(Z,3);H.children.push(n),n.children.push(g),W(E,n,g,d);break}}continue}}const g=new n;if(g.line=Z,H.children.push(g),"#"===Z[0]&&"d"===Z[1]){const E=Z.replace(";","").split(" ");g.additionalDefineKey=E[1],3===E.length&&(g.additionalDefineValue=E[2])}}return!1}function Y(E,H,d,I){const g=new n,l=new Z;return l.lineIndex=-1,l.lines=E.split("\n"),U(l,g,I),g.process(H,d,I)}function c(E,H){var d;const n=E.defines,Z={};for(const I of n){const E=I.replace("#define","").replace(";","").trim().split(" ");Z[E[0]]=E.length>1?E[1]:""}return 0===(null===(d=E.processor)||void 0===d?void 0:d.shaderLanguage)&&(Z.GL_ES="true"),Z.__VERSION__=E.version,Z[E.platformName]="true",(0,C.d)(Z,null===H||void 0===H?void 0:H.isNDCHalfZRange,null===H||void 0===H?void 0:H.o,null===H||void 0===H?void 0:H.useExactSrgbConversions),Z}function u(E,H,d){let n;for(s.length=0;null!==(n=Q.exec(E));)s.push(n);let Z=String(E),I=[E],g=!1;for(const l of s){let E=l[1];if(-1!==E.indexOf("__decl__")&&(E=E.replace(L,""),H.supportsUniformBuffers&&(E=E.replace("Vertex","Ubo").replace("Fragment","Ubo")),E+="Declaration"),!H.includesShadersStore[E]){const n=H.shadersRepository+"ShadersInclude/"+E+".fx";return void o.loadFile(n,(n=>{H.includesShadersStore[E]=n,u(I.join(""),H,d)}))}{let d=H.includesShadersStore[E];if(l[2]){const E=l[3].split(",");for(let H=0;H<E.length;H+=2){const n=new RegExp(E[H],"g"),Z=E[H+1];d=d.replace(n,Z)}}if(l[4]){const E=l[5];if(-1!==E.indexOf("..")){const n=E.split(".."),Z=parseInt(n[0]);let I=parseInt(n[1]),g=d.slice(0);d="",isNaN(I)&&(I=H.indexParameters[n[1]]);for(let E=Z;E<I;E++)H.supportsUniformBuffers||(g=g.replace(D,((E,H)=>H+"{X}"))),d+=g.replace(e,E.toString())+"\n"}else H.supportsUniformBuffers||(d=d.replace(D,((E,H)=>H+"{X}"))),d=d.replace(e,E)}const n=[];for(const E of I){const H=E.split(l[0]);for(let E=0;E<H.length-1;E++)n.push(H[E]),n.push(d);n.push(H[H.length-1])}I=n,g=g||d.indexOf("#include<")>=0||d.indexOf("#include <")>=0}}s.length=0,Z=I.join(""),g?u(Z.toString(),H,d):d(Z)}const o={loadFile:(E,H,d,n,Z,I)=>{throw(0,V.c)("FileTools")}}},12283:(E,H,d)=>{d.d(H,{b:()=>Z,c:()=>I,d:()=>l,h:()=>g,j:()=>r});var n=d(12256);d(12234);const Z={};function I(E,H){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(H?H+"\n":"")+E}function g(E,H,d,I,g,l,r){const t=r||Z.loadFile;if(t){return t(E,H,d,I,g,l)}throw(0,n.c)("FileTools")}function l(E,H,d,n){if(E)return H?E.IS_NDC_HALF_ZRANGE="":delete E.IS_NDC_HALF_ZRANGE,d?E.USE_REVERSE_DEPTHBUFFER="":delete E.USE_REVERSE_DEPTHBUFFER,void(n?E.USE_EXACT_SRGB_CONVERSIONS="":delete E.USE_EXACT_SRGB_CONVERSIONS);{let E="";return H&&(E+="#define IS_NDC_HALF_ZRANGE"),d&&(E&&(E+="\n"),E+="#define USE_REVERSE_DEPTHBUFFER"),n&&(E&&(E+="\n"),E+="#define USE_EXACT_SRGB_CONVERSIONS"),E}}function r(E,H){let d=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;switch(E){case 3:{const E=(ArrayBuffer,new Int8Array(H));return n&&E.set(new Int8Array(n)),E}case 0:{const E=(ArrayBuffer,new Uint8Array(H));return n&&E.set(new Uint8Array(n)),E}case 4:{const E=H instanceof ArrayBuffer?new Int16Array(H):new Int16Array(d?H/2:H);return n&&E.set(new Int16Array(n)),E}case 5:case 8:case 9:case 10:case 2:{const E=H instanceof ArrayBuffer?new Uint16Array(H):new Uint16Array(d?H/2:H);return n&&E.set(new Uint16Array(n)),E}case 6:{const E=H instanceof ArrayBuffer?new Int32Array(H):new Int32Array(d?H/4:H);return n&&E.set(new Int32Array(n)),E}case 7:case 11:case 12:case 13:case 14:case 15:{const E=H instanceof ArrayBuffer?new Uint32Array(H):new Uint32Array(d?H/4:H);return n&&E.set(new Uint32Array(n)),E}case 1:{const E=H instanceof ArrayBuffer?new Float32Array(H):new Float32Array(d?H/4:H);return n&&E.set(new Float32Array(n)),E}}const Z=(ArrayBuffer,new Uint8Array(H));return n&&Z.set(new Uint8Array(n)),Z}},12307:(E,H,d)=>{d.d(H,{e:()=>n});class n{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?n.ShadersRepository:n.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?n.ShadersStore:n.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?n.IncludesShadersStore:n.IncludesShadersStoreWGSL}}n.ShadersRepository="src/Shaders/",n.ShadersStore={},n.IncludesShadersStore={},n.ShadersRepositoryWGSL="src/ShadersWGSL/",n.ShadersStoreWGSL={},n.IncludesShadersStoreWGSL={}},12316:(E,H,d)=>{d.d(H,{b:()=>V,c:()=>e,f:()=>w,g:()=>C,j:()=>R,n:()=>D,p:()=>M,t:()=>t,x:()=>S,z:()=>r,B:()=>l});class n{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.CH._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(E){E&&this.program&&E(this.program)}setEngine(E){this.CH=E}_fillEffectInformation(E,H,d,n,Z,I,g,l){const r=this.CH;if(r.supportsUniformBuffers)for(const S in H)E.bindUniformBlock(S,H[S]);let t;for(this.CH.getUniforms(this,d).forEach(((E,H)=>{n[d[H]]=E})),this._uniforms=n,t=0;t<Z.length;t++){null==E.getUniform(Z[t])&&(Z.splice(t,1),t--)}Z.forEach(((E,H)=>{I[E]=H}));for(const S of r.getAttributes(this,g))l.push(S)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(E,H){const d=this._valueCache[E],n=H.updateFlag;return(void 0===d||d!==n)&&(this._valueCache[E]=n,!0)}_cacheFloat2(E,H,d){let n=this._valueCache[E];if(!n||2!==n.length)return n=[H,d],this._valueCache[E]=n,!0;let Z=!1;return n[0]!==H&&(n[0]=H,Z=!0),n[1]!==d&&(n[1]=d,Z=!0),Z}_cacheFloat3(E,H,d,n){let Z=this._valueCache[E];if(!Z||3!==Z.length)return Z=[H,d,n],this._valueCache[E]=Z,!0;let I=!1;return Z[0]!==H&&(Z[0]=H,I=!0),Z[1]!==d&&(Z[1]=d,I=!0),Z[2]!==n&&(Z[2]=n,I=!0),I}_cacheFloat4(E,H,d,n,Z){let I=this._valueCache[E];if(!I||4!==I.length)return I=[H,d,n,Z],this._valueCache[E]=I,!0;let g=!1;return I[0]!==H&&(I[0]=H,g=!0),I[1]!==d&&(I[1]=d,g=!0),I[2]!==n&&(I[2]=n,g=!0),I[3]!==Z&&(I[3]=Z,g=!0),g}setInt(E,H){const d=this._valueCache[E];void 0!==d&&d===H||this.CH.setInt(this._uniforms[E],H)&&(this._valueCache[E]=H)}setInt2(E,H,d){this._cacheFloat2(E,H,d)&&(this.CH.setInt2(this._uniforms[E],H,d)||(this._valueCache[E]=null))}setInt3(E,H,d,n){this._cacheFloat3(E,H,d,n)&&(this.CH.setInt3(this._uniforms[E],H,d,n)||(this._valueCache[E]=null))}setInt4(E,H,d,n,Z){this._cacheFloat4(E,H,d,n,Z)&&(this.CH.setInt4(this._uniforms[E],H,d,n,Z)||(this._valueCache[E]=null))}setIntArray(E,H){this._valueCache[E]=null,this.CH.setIntArray(this._uniforms[E],H)}setIntArray2(E,H){this._valueCache[E]=null,this.CH.setIntArray2(this._uniforms[E],H)}setIntArray3(E,H){this._valueCache[E]=null,this.CH.setIntArray3(this._uniforms[E],H)}setIntArray4(E,H){this._valueCache[E]=null,this.CH.setIntArray4(this._uniforms[E],H)}setUInt(E,H){const d=this._valueCache[E];void 0!==d&&d===H||this.CH.setUInt(this._uniforms[E],H)&&(this._valueCache[E]=H)}setUInt2(E,H,d){this._cacheFloat2(E,H,d)&&(this.CH.setUInt2(this._uniforms[E],H,d)||(this._valueCache[E]=null))}setUInt3(E,H,d,n){this._cacheFloat3(E,H,d,n)&&(this.CH.setUInt3(this._uniforms[E],H,d,n)||(this._valueCache[E]=null))}setUInt4(E,H,d,n,Z){this._cacheFloat4(E,H,d,n,Z)&&(this.CH.setUInt4(this._uniforms[E],H,d,n,Z)||(this._valueCache[E]=null))}setUIntArray(E,H){this._valueCache[E]=null,this.CH.setUIntArray(this._uniforms[E],H)}setUIntArray2(E,H){this._valueCache[E]=null,this.CH.setUIntArray2(this._uniforms[E],H)}setUIntArray3(E,H){this._valueCache[E]=null,this.CH.setUIntArray3(this._uniforms[E],H)}setUIntArray4(E,H){this._valueCache[E]=null,this.CH.setUIntArray4(this._uniforms[E],H)}setArray(E,H){this._valueCache[E]=null,this.CH.setArray(this._uniforms[E],H)}setArray2(E,H){this._valueCache[E]=null,this.CH.setArray2(this._uniforms[E],H)}setArray3(E,H){this._valueCache[E]=null,this.CH.setArray3(this._uniforms[E],H)}setArray4(E,H){this._valueCache[E]=null,this.CH.setArray4(this._uniforms[E],H)}setMatrices(E,H){H&&(this._valueCache[E]=null,this.CH.setMatrices(this._uniforms[E],H))}setMatrix(E,H){this._cacheMatrix(E,H)&&(this.CH.setMatrices(this._uniforms[E],H.kd())||(this._valueCache[E]=null))}setMatrix3x3(E,H){this._valueCache[E]=null,this.CH.setMatrix3x3(this._uniforms[E],H)}setMatrix2x2(E,H){this._valueCache[E]=null,this.CH.setMatrix2x2(this._uniforms[E],H)}setFloat(E,H){const d=this._valueCache[E];void 0!==d&&d===H||this.CH.setFloat(this._uniforms[E],H)&&(this._valueCache[E]=H)}setVector2(E,H){this._cacheFloat2(E,H.x,H.y)&&(this.CH.setFloat2(this._uniforms[E],H.x,H.y)||(this._valueCache[E]=null))}setFloat2(E,H,d){this._cacheFloat2(E,H,d)&&(this.CH.setFloat2(this._uniforms[E],H,d)||(this._valueCache[E]=null))}setVector3(E,H){this._cacheFloat3(E,H.x,H.y,H.z)&&(this.CH.setFloat3(this._uniforms[E],H.x,H.y,H.z)||(this._valueCache[E]=null))}setFloat3(E,H,d,n){this._cacheFloat3(E,H,d,n)&&(this.CH.setFloat3(this._uniforms[E],H,d,n)||(this._valueCache[E]=null))}setVector4(E,H){this._cacheFloat4(E,H.x,H.y,H.z,H.w)&&(this.CH.setFloat4(this._uniforms[E],H.x,H.y,H.z,H.w)||(this._valueCache[E]=null))}setQuaternion(E,H){this._cacheFloat4(E,H.x,H.y,H.z,H.w)&&(this.CH.setFloat4(this._uniforms[E],H.x,H.y,H.z,H.w)||(this._valueCache[E]=null))}setFloat4(E,H,d,n,Z){this._cacheFloat4(E,H,d,n,Z)&&(this.CH.setFloat4(this._uniforms[E],H,d,n,Z)||(this._valueCache[E]=null))}setColor3(E,H){this._cacheFloat3(E,H.r,H.g,H.b)&&(this.CH.setFloat3(this._uniforms[E],H.r,H.g,H.b)||(this._valueCache[E]=null))}setColor4(E,H,d){this._cacheFloat4(E,H.r,H.g,H.b,d)&&(this.CH.setFloat4(this._uniforms[E],H.r,H.g,H.b,d)||(this._valueCache[E]=null))}setDirectColor4(E,H){this._cacheFloat4(E,H.r,H.g,H.b,H.a)&&(this.CH.setFloat4(this._uniforms[E],H.r,H.g,H.b,H.a)||(this._valueCache[E]=null))}_getVertexShaderCode(){return this.vertexShader?this.CH._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.CH._getShaderSource(this.fragmentShader):null}}var Z=d(12283);const I=new WeakMap,g={_webGLVersion:2,cachedPipelines:{}};function l(E){let H=I.get(E);if(!H){if(!E)return g;H={_webGLVersion:E.TEXTURE_BINDING_3D?2:1,_context:E,parallelShaderCompile:E.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},I.set(E,H)}return H}function r(E){I.delete(E)}function t(E,H,d,n,Z,I){const g=l(n);I||(I=g._createShaderProgramInjection??V);return I(E,L(H,"vertex",n,g._contextWasLost),L(d,"fragment",n,g._contextWasLost),n,Z,g.validateShaderPrograms)}function S(E,H,d,n,Z){let I=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,g=arguments.length>6?arguments[6]:void 0;const r=l(Z);g||(g=r._createShaderProgramInjection??V);const t=r._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return g(E,Q(H,"vertex",n,t,Z,r._contextWasLost),Q(d,"fragment",n,t,Z,r._contextWasLost),Z,I,r.validateShaderPrograms)}function M(E,H){const d=new n,Z=l(E);return Z.parallelShaderCompile&&!Z.disableParallelShaderCompile&&(d.isParallelCompiled=!0),d.context=Z._context,d}function V(E,H,d,n){let Z=arguments.length>5?arguments[5]:void 0;const I=n.createProgram();if(E.program=I,!I)throw new Error("Unable to create program");return n.attachShader(I,H),n.attachShader(I,d),n.linkProgram(I),E.context=n,E.vertexShader=H,E.fragmentShader=d,E.isParallelCompiled||w(E,n,Z),I}function C(E,H,d){const n=E;if(n._isDisposed)return!1;const Z=l(H);return!!(Z&&Z.parallelShaderCompile&&Z.parallelShaderCompile.COMPLETION_STATUS_KHR&&n.program&&H.getProgramParameter(n.program,Z.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(w(n,H,d),!0)}function w(E,H,d){const n=E.context,Z=E.vertexShader,I=E.fragmentShader,g=E.program;if(!n.getProgramParameter(g,n.LINK_STATUS)){if(!H.getShaderParameter(Z,H.COMPILE_STATUS)){const d=H.getShaderInfoLog(Z);if(d)throw E.vertexCompilationError=d,new Error("VERTEX SHADER "+d)}if(!H.getShaderParameter(I,H.COMPILE_STATUS)){const d=H.getShaderInfoLog(I);if(d)throw E.fragmentCompilationError=d,new Error("FRAGMENT SHADER "+d)}const d=n.getProgramInfoLog(g);if(d)throw E.programLinkError=d,new Error(d)}if(d){n.validateProgram(g);if(!n.getProgramParameter(g,n.VALIDATE_STATUS)){const H=n.getProgramInfoLog(g);if(H)throw E.programValidationError=H,new Error(H)}}n.deleteShader(Z),n.deleteShader(I),E.vertexShader=void 0,E.fragmentShader=void 0,E.onCompiled&&(E.onCompiled(),E.onCompiled=void 0)}function R(E,H,d,n,Z,I,g,r,M){let V=arguments.length>10?arguments[10]:void 0,C=arguments.length>11?arguments[11]:void 0,w=arguments.length>12?arguments[12]:void 0;const R=l(E.context);C||(C=R.createRawShaderProgramInjection??t),w||(w=R.createShaderProgramInjection??S);const Q=E;Q.program=n?C(Q,H,d,Q.context,M):w(Q,H,d,r,Q.context,M),Q.program.__SPECTOR_rebuildProgram=g,V()}function Q(E,H,d,n,I,g){return L((0,Z.c)(E,d,n),H,I,g)}function L(E,H,d,n){const Z=d.createShader("vertex"===H?d.VERTEX_SHADER:d.FRAGMENT_SHADER);if(!Z){let E=d.NO_ERROR,Z=d.NO_ERROR;for(;(Z=d.getError())!==d.NO_ERROR;)E=Z;throw new Error(`Something went wrong while creating a gl ${H} shader object. gl error=${E}, gl isContextLost=${d.isContextLost()}, _contextWasLost=${n}`)}return d.shaderSource(Z,E),d.compileShader(Z),Z}function D(E,H){H.useProgram(E)}function e(E,H){const d=E;if(!d.isParallelCompiled)return void H(E);const n=d.onCompiled;d.onCompiled=()=>{null===n||void 0===n||n(),H(E)}}},12309:(E,H,d)=>{d.d(H,{d:()=>M,h:()=>C,l:()=>t,n:()=>S});var n=d(12234),Z=d(12316),I=d(12307),g=d(12237),l=d(12281),r=d(12283);function t(E,H){return(0,Z.B)(H).cachedPipelines[E]}function S(E){const H=E._name,d=E.context;if(H&&d){const E=(0,Z.B)(d),n=E.cachedPipelines[H];null===n||void 0===n||n.dispose(),delete E.cachedPipelines[H]}}function M(E,H,d,Z,I,g,r){let t,S;const M=(0,n.i)()?null===g||void 0===g?void 0:g.getHostDocument():null;t="string"===typeof H?H:H.vertexSource?"source:"+H.vertexSource:H.vertexElement?(null===M||void 0===M?void 0:M.getElementById(H.vertexElement))||H.vertexElement:H.vertex||H,S="string"===typeof H?H:H.fragmentSource?"source:"+H.fragmentSource:H.fragmentElement?(null===M||void 0===M?void 0:M.getElementById(H.fragmentElement))||H.fragmentElement:H.fragment||H;const C=[void 0,void 0],w=()=>{if(C[0]&&C[1]){E.isFragment=!0;const[n,t]=C;(0,l.f)(t,E,((g,t)=>{r&&(r._fragmentSourceCodeBeforeMigration=t),d&&(g=d("fragment",g));const S=(0,l.c)(n,g,E);E=null;const M=function(E,H,d,n){if(d){return{vertexSourceCode:(1===n?"//":"")+"#define SHADER_NAME vertex:"+(d.vertexElement||d.vertex||d.spectorName||d)+"\n"+E,fragmentSourceCode:(1===n?"//":"")+"#define SHADER_NAME fragment:"+(d.fragmentElement||d.fragment||d.spectorName||d)+"\n"+H}}return{vertexSourceCode:E,fragmentSourceCode:H}}(S.vertexCode,S.fragmentCode,H,I);null===Z||void 0===Z||Z(M.vertexSourceCode,M.fragmentSourceCode)}),g)}};V(t,"Vertex","",(H=>{(0,l.d)(E),(0,l.f)(H,E,((E,n)=>{r&&(r._rawVertexSourceCode=H,r._vertexSourceCodeBeforeMigration=n),d&&(E=d("vertex",E)),C[0]=E,w()}),g)}),I),V(S,"Fragment","Pixel",(E=>{r&&(r._rawFragmentSourceCode=E),C[1]=E,w()}),I)}function V(E,H,d,Z,g,l){if("undefined"!==typeof HTMLElement&&E instanceof HTMLElement){return void Z((0,n.b)(E))}if("source:"===E.substring(0,7))return void Z(E.substring(7));if("base64:"===E.substring(0,7)){return void Z(window.atob(E.substring(7)))}const t=I.e.GetShadersStore(g);if(t[E+H+"Shader"])return void Z(t[E+H+"Shader"]);if(d&&t[E+d+"Shader"])return void Z(t[E+d+"Shader"]);let S;if(S="."===E[0]||"/"===E[0]||E.indexOf("http")>-1?E:I.e.GetShadersRepository(g)+E,!(l=l||r.h))throw new Error("loadFileInjection is not defined");l(S+"."+H.toLowerCase()+".fx",Z)}const C=(E,H,d,n)=>{try{const I=E.context?(0,Z.B)(E.context):null;I&&(I.disableParallelShaderCompile=E.disableParallelCompilation);const g=E.existingPipelineContext||H(E.shaderProcessingContext);return g._name=E.name,E.name&&I&&(I.cachedPipelines[E.name]=g),d(g,E.vertex,E.fragment,!!E.createAsRaw,"","",E.rebuildRebind,E.defines,E.transformFeedbackVaryings,"",(()=>{n(g,(()=>{var H;null===(H=E.onRenderingStateCompiled)||void 0===H||H.call(E,g)}))})),g}catch(I){throw g.b.Error("Error compiling effect"),I}}},12298:(E,H,d)=>{d.r(H),d.d(H,{Effect:()=>r});var n=d(12230),Z=d(12237),I=d(12307),g=d(12309),l=d(12287);class r{static get ShadersRepository(){return I.e.ShadersRepository}static set ShadersRepository(E){I.e.ShadersRepository=E}get M(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new n.e),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(E,H,d){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,I=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,t=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,S=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,M=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,V=arguments.length>9?arguments[9]:void 0,C=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",w=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,R=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new n.e,this.onErrorObservable=new n.e,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=E,this._key=C;const Q=this._key.replace(/\r/g,"").replace(/\n/g,"|");let L;if(H.attributes){const E=H;if(this._engine=d,this._attributesNames=E.attributes,this._uniformsNames=E.uniformsNames.concat(E.samplers),this._samplerList=E.samplers.slice(),this.defines=E.defines,this.onError=E.onError,this.onCompiled=E.onCompiled,this._fallbacks=E.fallbacks,this._indexParameters=E.indexParameters,this._transformFeedbackVaryings=E.transformFeedbackVaryings||null,this._multiTarget=!!E.multiTarget,this._shaderLanguage=E.shaderLanguage??0,this._disableParallelShaderCompilation=!!E.disableParallelShaderCompilation,E.uniformBuffersNames){this._uniformBuffersNamesList=E.uniformBuffersNames.slice();for(let H=0;H<E.uniformBuffersNames.length;H++)this._uniformBuffersNames[E.uniformBuffersNames[H]]=H}this._processFinalCode=E.processFinalCode??null,this._processCodeAfterIncludes=E.processCodeAfterIncludes??void 0,R=E.extraInitializationsAsync,L=E.existingPipelineContext}else this._engine=I,this.defines=null==l?"":l,this._uniformsNames=d.concat(Z),this._samplerList=Z?Z.slice():[],this._attributesNames=H,this._uniformBuffersNamesList=[],this._shaderLanguage=w,this.onError=M,this.onCompiled=S,this._indexParameters=V,this._fallbacks=t;"WEBGL2"===this._engine.shaderPlatformName&&(L=(0,g.l)(Q,this._engine._gl)??L),this._attributeLocationByName={},this.uniqueId=r._UniqueIdSeed++,L?(this._pipelineContext=L,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,R),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.M||this.dispose(!0)}))}async _processShaderCodeAsync(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;n&&await n(),this._processingContext=d||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const Z={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:E??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:I.e.GetShadersRepository(this._shaderLanguage),includesShadersStore:I.e.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,g.d)(Z,this.name,this._processFinalCode,((E,d)=>{this._vertexSourceCode=E,this._fragmentSourceCode=d,this._prepareEffect(H)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.M||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(E){return this._attributes[E]}getAttributeLocationByName(E){return this._attributeLocationByName[E]}getAttributesCount(){return this._attributes.length}getUniformIndex(E){return this._uniformsNames.indexOf(E)}getUniform(E){return this._uniforms[E]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((E=>{this.executeWhenCompiled(E)}))}executeWhenCompiled(E){this.isReady()?E(this):(this.onCompileObservable.add((H=>{E(H)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(E){(0,l.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(H=>{this._processCompilationErrors(H,E)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var E;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(E=this._pipelineContext)||void 0===E?void 0:E._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var E;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(E=this._pipelineContext)||void 0===E?void 0:E._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(E,H,d,n){this._isReady=!1,this._vertexSourceCodeOverride=E,this._fragmentSourceCodeOverride=H,this.onError=(E,H)=>{n&&n(H)},this.onCompiled=()=>{var E,H;const n=this.getEngine().scenes;if(n)for(let d=0;d<n.length;d++)n[d].markAllMaterialsAsDirty(127);null===(E=(H=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===E||E.call(H,d)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(E){if(this._pipelineContext=E,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let H=0;H<this._attributesNames.length;H++){const E=this._attributesNames[H];this._attributeLocationByName[E]=this._attributes[H]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),r.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H=this._pipelineContext;this._isReady=!1;try{const d=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),n=d?null:this.defines,Z=d?this._vertexSourceCodeOverride:this._vertexSourceCode,I=d?this._fragmentSourceCodeOverride:this._fragmentSourceCode,l=this._engine;this._pipelineContext=(0,g.h)({existingPipelineContext:E?H:null,vertex:Z,fragment:I,context:"WEBGL2"===l.shaderPlatformName||"WEBGL1"===l.shaderPlatformName?l._gl:void 0,rebuildRebind:(E,H,d,n)=>this._rebuildProgram(E,H,d,n),defines:n,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:d,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:d=>{H&&!E&&this._engine._deletePipelineContext(H),d&&this._onRenderingStateCompiled(d)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(H)}catch(d){this._processCompilationErrors(d,H)}}_getShaderCodeAndErrorLine(E,H,d){const n=d?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let Z=null;if(H&&E){const I=H.match(n);if(I&&2===I.length){const H=parseInt(I[1]),n=E.split("\n",-1);n.length>=H&&(Z=`Offending line [${H}] in ${d?"fragment":"vertex"} code: ${n[H-1]}`)}}return[E,Z]}_processCompilationErrors(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=E.message;const d=this._attributesNames,n=this._fallbacks;if(Z.b.Error("Unable to compile effect:"),Z.b.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),Z.b.Error(`Attributes: ${d.join(" ")}`),Z.b.Error("Defines:\n"+this.defines),r.LogShaderCodeOnCompilationError){var I,g;let E=null,H=null,d=null;var l;if(null!==(I=this._pipelineContext)&&void 0!==I&&I._getVertexShaderCode()&&([d,E]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),d&&(Z.b.Error("Vertex code:"),Z.b.Error(d))),null!==(g=this._pipelineContext)&&void 0!==g&&g._getFragmentShaderCode())[d,H]=this._getShaderCodeAndErrorLine(null===(l=this._pipelineContext)||void 0===l?void 0:l._getFragmentShaderCode(),this._compilationError,!0),d&&(Z.b.Error("Fragment code:"),Z.b.Error(d));E&&Z.b.Error(E),H&&Z.b.Error(H)}Z.b.Error("Error: "+this._compilationError);const t=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};H&&(this._pipelineContext=H,this._isReady=!0,t()),n?(this._pipelineContext=null,n.hasMoreFallbacks?(this._allFallbacksProcessed=!1,Z.b.Error("Trying next fallback."),this.defines=n.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,t(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,H||t())}get isSupported(){return""===this._compilationError}_bindTexture(E,H){this._engine._bindTexture(this._samplers[E],H,E)}setTexture(E,H){this._engine.setTexture(this._samplers[E],this._uniforms[E],H,E)}setTextureArray(E,H){const d=E+"Ex";if(-1===this._samplerList.indexOf(d+"0")){const n=this._samplerList.indexOf(E);for(let E=1;E<H.length;E++){const H=d+(E-1).toString();this._samplerList.splice(n+E,0,H)}let Z=0;for(const E of this._samplerList)this._samplers[E]=Z,Z+=1}this._engine.setTextureArray(this._samplers[E],this._uniforms[E],H,E)}bindUniformBuffer(E,H){const d=this._uniformBuffersNames[H];void 0===d||r._BaseCache[d]===E&&this._engine._features.useUBOBindingCache||(r._BaseCache[d]=E,this._engine.bindUniformBufferBase(E,d,H))}bindUniformBlock(E,H){this._engine.bindUniformBlock(this._pipelineContext,E,H)}setInt(E,H){return this._pipelineContext.setInt(E,H),this}setInt2(E,H,d){return this._pipelineContext.setInt2(E,H,d),this}setInt3(E,H,d,n){return this._pipelineContext.setInt3(E,H,d,n),this}setInt4(E,H,d,n,Z){return this._pipelineContext.setInt4(E,H,d,n,Z),this}setIntArray(E,H){return this._pipelineContext.setIntArray(E,H),this}setIntArray2(E,H){return this._pipelineContext.setIntArray2(E,H),this}setIntArray3(E,H){return this._pipelineContext.setIntArray3(E,H),this}setIntArray4(E,H){return this._pipelineContext.setIntArray4(E,H),this}setUInt(E,H){return this._pipelineContext.setUInt(E,H),this}setUInt2(E,H,d){return this._pipelineContext.setUInt2(E,H,d),this}setUInt3(E,H,d,n){return this._pipelineContext.setUInt3(E,H,d,n),this}setUInt4(E,H,d,n,Z){return this._pipelineContext.setUInt4(E,H,d,n,Z),this}setUIntArray(E,H){return this._pipelineContext.setUIntArray(E,H),this}setUIntArray2(E,H){return this._pipelineContext.setUIntArray2(E,H),this}setUIntArray3(E,H){return this._pipelineContext.setUIntArray3(E,H),this}setUIntArray4(E,H){return this._pipelineContext.setUIntArray4(E,H),this}setFloatArray(E,H){return this._pipelineContext.setArray(E,H),this}setFloatArray2(E,H){return this._pipelineContext.setArray2(E,H),this}setFloatArray3(E,H){return this._pipelineContext.setArray3(E,H),this}setFloatArray4(E,H){return this._pipelineContext.setArray4(E,H),this}setArray(E,H){return this._pipelineContext.setArray(E,H),this}setArray2(E,H){return this._pipelineContext.setArray2(E,H),this}setArray3(E,H){return this._pipelineContext.setArray3(E,H),this}setArray4(E,H){return this._pipelineContext.setArray4(E,H),this}setMatrices(E,H){return this._pipelineContext.setMatrices(E,H),this}setMatrix(E,H){return this._pipelineContext.setMatrix(E,H),this}setMatrix3x3(E,H){return this._pipelineContext.setMatrix3x3(E,H),this}setMatrix2x2(E,H){return this._pipelineContext.setMatrix2x2(E,H),this}setFloat(E,H){return this._pipelineContext.setFloat(E,H),this}setBool(E,H){return this._pipelineContext.setInt(E,H?1:0),this}setVector2(E,H){return this._pipelineContext.setVector2(E,H),this}setFloat2(E,H,d){return this._pipelineContext.setFloat2(E,H,d),this}setVector3(E,H){return this._pipelineContext.setVector3(E,H),this}setFloat3(E,H,d,n){return this._pipelineContext.setFloat3(E,H,d,n),this}setVector4(E,H){return this._pipelineContext.setVector4(E,H),this}setQuaternion(E,H){return this._pipelineContext.setQuaternion(E,H),this}setFloat4(E,H,d,n,Z){return this._pipelineContext.setFloat4(E,H,d,n,Z),this}setColor3(E,H){return this._pipelineContext.setColor3(E,H),this}setColor4(E,H,d){return this._pipelineContext.setColor4(E,H,d),this}setDirectColor4(E,H){return this._pipelineContext.setDirectColor4(E,H),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(r.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,g.n)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;H&&(I.e.GetShadersStore(n)[`${E}PixelShader`]=H),d&&(I.e.GetShadersStore(n)[`${E}VertexShader`]=d)}static ResetCache(){r._BaseCache={}}}r.LogShaderCodeOnCompilationError=!0,r.PersistentMode=!1,r.AutomaticallyClearCodeCache=!1,r._UniqueIdSeed=0,r._BaseCache={},r.ShadersStore=I.e.ShadersStore,r.IncludesShadersStore=I.e.IncludesShadersStore},12256:(E,H,d)=>{d.d(H,{c:()=>Z});const n={};function Z(E){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!n[E])return n[E]=!0,`${E} needs to be imported before as it contains a side-effect required by your code.`}},12234:(E,H,d)=>{function n(){return"undefined"!==typeof window}function Z(){return"undefined"!==typeof navigator}function I(){return"undefined"!==typeof document}function g(E){let H="",d=E.firstChild;for(;d;)3===d.nodeType&&(H+=d.textContent),d=d.nextSibling;return H}d.d(H,{b:()=>g,c:()=>I,g:()=>Z,i:()=>n})},12237:(E,H,d)=>{d.d(H,{b:()=>n});class n{static _CheckLimit(E,H){let d=n._LogLimitOutputs[E];return d?d.current++:(d={limit:H,current:1},n._LogLimitOutputs[E]=d),d.current<=d.limit}static _GenerateLimitMessage(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const d=n._LogLimitOutputs[E];if(!d||!n.MessageLimitReached)return;const Z=this._Levels[H];d.current===d.limit&&n[Z.name](n.MessageLimitReached.replace(/%LIMIT%/g,""+d.limit).replace(/%TYPE%/g,Z.name??""))}static _AddLogEntry(E){n._LogCache=E+n._LogCache,n.OnNewCacheEntry&&n.OnNewCacheEntry(E)}static _FormatMessage(E){const H=E=>E<10?"0"+E:""+E,d=new Date;return"["+H(d.getHours())+":"+H(d.getMinutes())+":"+H(d.getSeconds())+"]: "+E}static _LogDisabled(E,H){}static _LogEnabled(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,H=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;const Z=Array.isArray(H)?H[0]:H;if(void 0!==d&&!n._CheckLimit(Z,d))return;const I=n._FormatMessage(Z),g=this._Levels[E],l=Array.isArray(H)?H.slice(1):[];g.logFunc&&g.logFunc("BJS - "+I,...l);const r=`<div style='color:${g.color}'>${I}</div><br>`;n._AddLogEntry(r),n._GenerateLimitMessage(Z,E)}static get LogCache(){return n._LogCache}static ClearLogCache(){n._LogCache="",n._LogLimitOutputs={},n.errorsCount=0}static set LogLevels(E){n.Log=n._LogDisabled,n.Warn=n._LogDisabled,n.Error=n._LogDisabled;const H=[n.MessageLogLevel,n.WarningLogLevel,n.ErrorLogLevel];for(const d of H)if((E&d)===d){const E=this._Levels[d];n[E.name]=n._LogEnabled.bind(n,d)}}}n.NoneLogLevel=0,n.MessageLogLevel=1,n.WarningLogLevel=2,n.ErrorLogLevel=4,n.AllLogLevel=7,n.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",n._LogCache="",n._LogLimitOutputs={},n._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],n.errorsCount=0,n.Log=n._LogEnabled.bind(n,n.MessageLogLevel),n.Warn=n._LogEnabled.bind(n,n.WarningLogLevel),n.Error=n._LogEnabled.bind(n,n.ErrorLogLevel)},12230:(E,H,d)=>{d.d(H,{e:()=>g});const n="undefined"!==typeof WeakRef;class Z{constructor(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;this.initialize(E,H,d,n)}initialize(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1],d=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;return this.mask=E,this.skipNextObservers=H,this.target=d,this.currentTarget=n,this}}class I{constructor(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=E,this.mask=H,this.scope=d,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(E)}}class g{static FromPromise(E,H){const d=new g;return E.then((E=>{d.notifyObservers(E)})).catch((E=>{if(!H)throw E;H.notifyObservers(E)})),d}get observers(){return this._observers}constructor(E){let H=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=H,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new Z(0),E&&(this._onObserverAdded=E)}add(E){let H=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!E)return null;const Z=new I(E,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);Z.unregisterOnNextCall=d,H?this._observers.unshift(Z):this._observers.push(Z),this._onObserverAdded&&this._onObserverAdded(Z),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(Z,this._lastNotifiedValue);const g=n?new WeakRef(this):{deref:()=>this};return Z._remove=function(){let E=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const H=g.deref();H&&(E?H.remove(Z):H._remove(Z))},Z}addOnce(E){return this.add(E,void 0,void 0,void 0,!0)}remove(E){if(!E)return!1;E._remove=null;return-1!==this._observers.indexOf(E)&&(this._deferUnregister(E),!0)}removeCallback(E,H){for(let d=0;d<this._observers.length;d++){const n=this._observers[d];if(!n._willBeUnregistered&&(n.callback===E&&(!H||H===n.scope)))return this._deferUnregister(n),!0}return!1}_deferUnregister(E){E._willBeUnregistered||(this._numObserversMarkedAsDeleted++,E.unregisterOnNextCall=!1,E._willBeUnregistered=!0,setTimeout((()=>{this._remove(E)}),0))}_remove(E){let H=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!E)return!1;const d=this._observers.indexOf(E);return-1!==d&&(H&&this._numObserversMarkedAsDeleted--,this._observers.splice(d,1),!0)}makeObserverTopPriority(E){this._remove(E,!1),this._observers.unshift(E)}makeObserverBottomPriority(E){this._remove(E,!1),this._observers.push(E)}notifyObservers(E){let H=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,d=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,Z=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=E),!this._observers.length)return!0;const I=this._eventState;I.mask=H,I.target=d,I.currentTarget=n,I.skipNextObservers=!1,I.lastReturnValue=E,I.userInfo=Z;for(const g of this._observers)if(!g._willBeUnregistered&&(g.mask&H&&(g.unregisterOnNextCall&&this._deferUnregister(g),g.scope?I.lastReturnValue=g.callback.apply(g.scope,[E,I]):I.lastReturnValue=g.callback(E,I)),I.skipNextObservers))return!1;return!0}notifyObserver(E,H){let d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=H),E._willBeUnregistered)return;const n=this._eventState;n.mask=d,n.skipNextObservers=!1,E.unregisterOnNextCall&&this._deferUnregister(E),E.callback(H,n)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const E=this._observers.pop();E&&(E._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const E=new g;return E._observers=this._observers.slice(0),E}hasSpecificMask(){let E=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const H of this._observers)if(H.mask&E||H.mask===E)return!0;return!1}}},12287:(E,H,d)=>{d.d(H,{b:()=>Z,d:()=>g});let n=[];class Z{static SetImmediate(E){0===n.length&&setTimeout((()=>{const E=n;n=[];for(const H of E)H()}),1),n.push(E)}}function I(E,H,d){try{if(E())return H(),!0}catch(n){return null===d||void 0===d||d(n),!0}return!1}const g=function(E,H,d){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,Z=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,g=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&I(E,H,d))return null;const l=setInterval((()=>{I(E,H,d)?clearInterval(l):(Z-=n,Z<0&&(clearInterval(l),null===d||void 0===d||d(new Error("Operation timed out after maximum retries. "+(g||"")),!0)))}),n);return()=>clearInterval(l)}}}]);