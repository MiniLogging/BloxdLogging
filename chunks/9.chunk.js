"use strict";(self["6xhfpmwgjr5"]=self["6xhfpmwgjr5"]||[]).push([[9],{12307:(P,a,R)=>{R.d(a,{d:()=>H,e:()=>d,k:()=>G,h:()=>Y,o:()=>J});class S{constructor(){this.children=[]}isValid(P){return!0}process(P,a,R){let S="";if(this.line){let R=this.line;const h=a.processor;if(h){var A,Z,p,j,U,Q;h.lineProcessor&&(R=h.lineProcessor(R,a.isFragment,a.processingContext));const S=(null===(A=a.processor)||void 0===A?void 0:A.attributeKeywordName)??"attribute",l=a.isFragment&&null!==(Z=a.processor)&&void 0!==Z&&Z.varyingFragmentKeywordName?null===(p=a.processor)||void 0===p?void 0:p.varyingFragmentKeywordName:!a.isFragment&&null!==(j=a.processor)&&void 0!==j&&j.varyingVertexKeywordName?null===(U=a.processor)||void 0===U?void 0:U.varyingVertexKeywordName:"varying";if(!a.isFragment&&h.attributeProcessor&&this.line.startsWith(S))R=h.attributeProcessor(this.line,P,a.processingContext);else if(h.varyingProcessor&&(null!==(Q=h.varyingCheck)&&void 0!==Q&&Q.call(h,this.line,a.isFragment)||!h.varyingCheck&&this.line.startsWith(l)))R=h.varyingProcessor(this.line,a.isFragment,P,a.processingContext);else if(h.uniformProcessor&&h.uniformRegexp&&h.uniformRegexp.test(this.line))a.lookForClosingBracketForUniformBuffer||(R=h.uniformProcessor(this.line,a.isFragment,P,a.processingContext));else if(h.uniformBufferProcessor&&h.uniformBufferRegexp&&h.uniformBufferRegexp.test(this.line))a.lookForClosingBracketForUniformBuffer||(R=h.uniformBufferProcessor(this.line,a.isFragment,a.processingContext),a.lookForClosingBracketForUniformBuffer=!0);else if(h.textureProcessor&&h.textureRegexp&&h.textureRegexp.test(this.line))R=h.textureProcessor(this.line,a.isFragment,P,a.processingContext);else if((h.uniformProcessor||h.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!a.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?h.uniformProcessor&&(R=h.uniformProcessor(this.line,a.isFragment,P,a.processingContext)):h.uniformBufferProcessor&&(R=h.uniformBufferProcessor(this.line,a.isFragment,a.processingContext),a.lookForClosingBracketForUniformBuffer=!0)}a.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(a.lookForClosingBracketForUniformBuffer=!1,h.endOfUniformBufferProcessor&&(R=h.endOfUniformBufferProcessor(this.line,a.isFragment,a.processingContext)))}S+=R+"\n"}for(const h of this.children)S+=h.process(P,a,R);return this.additionalDefineKey&&(P[this.additionalDefineKey]=this.additionalDefineValue||"true",R[this.additionalDefineKey]=P[this.additionalDefineKey]),S}}class A{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(P){this._lines.length=0;for(const a of P){if(!a||"\r"===a)continue;if("#"===a[0]){this._lines.push(a);continue}const P=a.trim();if(!P)continue;if(P.startsWith("//")){this._lines.push(a);continue}const R=P.indexOf(";");if(-1===R)this._lines.push(P);else if(R===P.length-1)P.length>1&&this._lines.push(P);else{const P=a.split(";");for(let a=0;a<P.length;a++){let R=P[a];R&&(R=R.trim(),R&&this._lines.push(R+(a!==P.length-1?";":"")))}}}}}class Z extends S{process(P,a,R){for(let S=0;S<this.children.length;S++){const A=this.children[S];if(A.isValid(P))return A.process(P,a,R)}return""}}class p extends S{isValid(P){return this.testExpression.isTrue(P)}}class j{isTrue(P){return!0}static postfixToInfix(P){const a=[];for(const R of P)if(void 0===j._OperatorPriority[R])a.push(R);else{const P=a[a.length-1],S=a[a.length-2];a.length-=2,a.push(`(${S}${R}${P})`)}return a[a.length-1]}static infixToPostfix(P){const a=j._InfixToPostfixCache.get(P);if(a)return a.accessTime=Date.now(),a.result;if(!P.includes("&&")&&!P.includes("||")&&!P.includes(")")&&!P.includes("("))return[P];const R=[];let S=-1;const A=()=>{h=h.trim(),""!==h&&(R.push(h),h="")},Z=P=>{S<j._Stack.length-1&&(j._Stack[++S]=P)},p=()=>j._Stack[S],U=()=>-1===S?"!!INVALID EXPRESSION!!":j._Stack[S--];let Q=0,h="";for(;Q<P.length;){const a=P.charAt(Q),l=Q<P.length-1?P.substring(Q,2+Q):"";if("("===a)h="",Z(a);else if(")"===a){for(A();-1!==S&&"("!==p();)R.push(U());U()}else if(j._OperatorPriority[l]>1){for(A();-1!==S&&j._OperatorPriority[p()]>=j._OperatorPriority[l];)R.push(U());Z(l),Q++}else h+=a;Q++}for(A();-1!==S;)"("===p()?U():R.push(U());return j._InfixToPostfixCache.size>=j.InfixToPostfixCacheLimitSize&&j.ClearCache(),j._InfixToPostfixCache.set(P,{result:R,accessTime:Date.now()}),R}static ClearCache(){const P=Array.from(j._InfixToPostfixCache.entries()).sort(((P,a)=>P[1].accessTime-a[1].accessTime));for(let a=0;a<j.InfixToPostfixCacheCleanupSize;a++)j._InfixToPostfixCache.delete(P[a][0])}}j.InfixToPostfixCacheLimitSize=5e4,j.InfixToPostfixCacheCleanupSize=25e3,j._InfixToPostfixCache=new Map,j._OperatorPriority={")":0,"(":1,"||":2,"&&":3},j._Stack=["","","","","","","","","","","","","","","","","","","",""];class U extends j{constructor(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=P,this.not=a}isTrue(P){let a=void 0!==P[this.define];return this.not&&(a=!a),a}}class Q extends j{isTrue(P){return this.leftOperand.isTrue(P)||this.rightOperand.isTrue(P)}}class h extends j{isTrue(P){return this.leftOperand.isTrue(P)&&this.rightOperand.isTrue(P)}}class l extends j{constructor(P,a,R){super(),this.define=P,this.operand=a,this.testValue=R}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(P){let a=!1;const R=parseInt(void 0!=P[this.define]?P[this.define]:this.define),S=parseInt(void 0!=P[this.testValue]?P[this.testValue]:this.testValue);if(isNaN(R)||isNaN(S))return!1;switch(this.operand){case">":a=R>S;break;case"<":a=R<S;break;case"<=":a=R<=S;break;case">=":a=R>=S;break;case"==":a=R===S;break;case"!=":a=R!==S}return a}}var V=R(12266),f=R(12314);const O=/defined\s*?\((.+?)\)/g,q=/defined\s*?\[(.+?)\]/g,y=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,t=/__decl__/,W=/light\{X\}.(\w*)/g,k=/\{X\}/g,x=[],s=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function d(P){P.processor&&P.processor.initializeShaders&&P.processor.initializeShaders(P.processingContext)}function G(P,a,R,S){var A;null!==(A=a.processor)&&void 0!==A&&A.preProcessShaderCode&&(P=a.processor.preProcessShaderCode(P,a.isFragment)),Y(P,a,(P=>{a.processCodeAfterIncludes&&(P=a.processCodeAfterIncludes(a.isFragment?"fragment":"vertex",P,a.defines));const A=function(P,a,R){let S=function(P,a){var R;if(null!==(R=a.processor)&&void 0!==R&&R.noPrecision)return P;const S=a.shouldUseHighPrecisionShader;-1===P.indexOf("precision highp float")?P=S?"precision highp float;\n"+P:"precision mediump float;\n"+P:S||(P=P.replace("precision highp float","precision mediump float"));return P}(P,a);if(!a.processor)return S;if(0===a.processor.shaderLanguage&&-1!==S.indexOf("#version 3")&&(S=S.replace("#version 300 es",""),!a.processor.parseGLES3))return S;const A=a.defines,Z=u(a,R);a.processor.preProcessor&&(S=a.processor.preProcessor(S,A,Z,a.isFragment,a.processingContext));const p={};S=c(S,Z,a,p),a.processor.postProcessor&&(S=a.processor.postProcessor(S,A,a.isFragment,a.processingContext,R?{drawBuffersExtensionDisabled:!R.getCaps().drawBuffersExtension}:{},Z,p));null!==R&&void 0!==R&&R._features.needShaderCodeInlining&&(S=R.inlineShaderCode(S));return S}(P,a,S);R(A,P)}))}function H(P,a,R){return R.processor&&R.processor.finalizeShaders?R.processor.finalizeShaders(P,a,R.processingContext):{vertexCode:P,fragmentCode:a}}function mP(P){const a=/defined\((.+)\)/.exec(P);if(a&&a.length)return new U(a[1].trim(),"!"===P[0]);const R=["==","!=",">=","<=","<",">"];let S="",A=0;for(S of R)if(A=P.indexOf(S),A>-1)break;if(-1===A)return new U(P);const Z=P.substring(0,A).trim(),p=P.substring(A+S.length).trim();return new l(Z,S,p)}function N(P,a){const R=new p,S=P.substring(0,a);let A=P.substring(a);return A=A.substring(0,(A.indexOf("//")+1||A.length+1)-1).trim(),R.testExpression="#ifdef"===S?new U(A):"#ifndef"===S?new U(A,!0):function(P){P=P.replace(O,"defined[$1]");const a=j.infixToPostfix(P),R=[];for(const A of a)if("||"!==A&&"&&"!==A)R.push(A);else if(R.length>=2){let P=R[R.length-1],a=R[R.length-2];R.length-=2;const S="&&"==A?new h:new Q;"string"===typeof P&&(P=P.replace(q,"defined($1)")),"string"===typeof a&&(a=a.replace(q,"defined($1)")),S.leftOperand="string"===typeof a?mP(a):a,S.rightOperand="string"===typeof P?mP(P):P,R.push(S)}let S=R[R.length-1];return"string"===typeof S&&(S=S.replace(q,"defined($1)")),"string"===typeof S?mP(S):S}(A),R}function D(P,a,R,A){let Z=P.currentLine;for(;L(P,R,A);){Z=P.currentLine;const p=Z.substring(0,5).toLowerCase();if("#else"===p){const R=new S;return a.children.push(R),void L(P,R,A)}if("#elif"===p){const P=N(Z,5);a.children.push(P),R=P}}}function L(P,a,R){for(;P.canRead;){P.lineIndex++;const A=P.currentLine;if(A.indexOf("#")>=0){const S=s.exec(A);if(S&&S.length){switch(S[0]){case"#ifdef":{const S=new Z;a.children.push(S);const p=N(A,6);S.children.push(p),D(P,S,p,R);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const S=new Z;a.children.push(S);const p=N(A,7);S.children.push(p),D(P,S,p,R);break}case"#if":{const S=new Z,p=N(A,3);a.children.push(S),S.children.push(p),D(P,S,p,R);break}}continue}}const p=new S;if(p.line=A,a.children.push(p),"#"===A[0]&&"d"===A[1]){const P=A.replace(";","").split(" ");p.additionalDefineKey=P[1],3===P.length&&(p.additionalDefineValue=P[2])}}return!1}function c(P,a,R,Z){const p=new S,j=new A;return j.lineIndex=-1,j.lines=P.split("\n"),L(j,p,Z),p.process(a,R,Z)}function u(P,a){var R;const S=P.defines,A={};for(const Z of S){const P=Z.replace("#define","").replace(";","").trim().split(" ");A[P[0]]=P.length>1?P[1]:""}return 0===(null===(R=P.processor)||void 0===R?void 0:R.shaderLanguage)&&(A.GL_ES="true"),A.__VERSION__=P.version,A[P.platformName]="true",(0,f.h)(A,null===a||void 0===a?void 0:a.isNDCHalfZRange,null===a||void 0===a?void 0:a.Cp,null===a||void 0===a?void 0:a.useExactSrgbConversions),A}function Y(P,a,R){let S;for(x.length=0;null!==(S=y.exec(P));)x.push(S);let A=String(P),Z=[P],p=!1;for(const j of x){let P=j[1];if(-1!==P.indexOf("__decl__")&&(P=P.replace(t,""),a.supportsUniformBuffers&&(P=P.replace("Vertex","Ubo").replace("Fragment","Ubo")),P+="Declaration"),!a.includesShadersStore[P]){const S=a.shadersRepository+"ShadersInclude/"+P+".fx";return void J.loadFile(S,(S=>{a.includesShadersStore[P]=S,Y(Z.join(""),a,R)}))}{let R=a.includesShadersStore[P];if(j[2]){const P=j[3].split(",");for(let a=0;a<P.length;a+=2){const S=new RegExp(P[a],"g"),A=P[a+1];R=R.replace(S,A)}}if(j[4]){const P=j[5];if(-1!==P.indexOf("..")){const S=P.split(".."),A=parseInt(S[0]);let Z=parseInt(S[1]),p=R.slice(0);R="",isNaN(Z)&&(Z=a.indexParameters[S[1]]);for(let P=A;P<Z;P++)a.supportsUniformBuffers||(p=p.replace(W,((P,a)=>a+"{X}"))),R+=p.replace(k,P.toString())+"\n"}else a.supportsUniformBuffers||(R=R.replace(W,((P,a)=>a+"{X}"))),R=R.replace(k,P)}const S=[];for(const P of Z){const a=P.split(j[0]);for(let P=0;P<a.length-1;P++)S.push(a[P]),S.push(R);S.push(a[a.length-1])}Z=S,p=p||R.indexOf("#include<")>=0||R.indexOf("#include <")>=0}}x.length=0,A=Z.join(""),p?Y(A.toString(),a,R):R(A)}const J={loadFile:(P,a,R,S,A,Z)=>{throw(0,V.c)("FileTools")}}},12314:(P,a,R)=>{R.d(a,{d:()=>A,e:()=>Z,h:()=>j,i:()=>p,l:()=>U});var S=R(12266);R(12240);const A={};function Z(P,a){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(a?a+"\n":"")+P}function p(P,a,R,Z,p,j,U){const Q=U||A.loadFile;if(Q){return Q(P,a,R,Z,p,j)}throw(0,S.c)("FileTools")}function j(P,a,R,S){if(P)return a?P.IS_NDC_HALF_ZRANGE="":delete P.IS_NDC_HALF_ZRANGE,R?P.USE_REVERSE_DEPTHBUFFER="":delete P.USE_REVERSE_DEPTHBUFFER,void(S?P.USE_EXACT_SRGB_CONVERSIONS="":delete P.USE_EXACT_SRGB_CONVERSIONS);{let P="";return a&&(P+="#define IS_NDC_HALF_ZRANGE"),R&&(P&&(P+="\n"),P+="#define USE_REVERSE_DEPTHBUFFER"),S&&(P&&(P+="\n"),P+="#define USE_EXACT_SRGB_CONVERSIONS"),P}}function U(P,a){let R=arguments.length>2&&void 0!==arguments[2]&&arguments[2],S=arguments.length>3?arguments[3]:void 0;switch(P){case 3:{const P=(ArrayBuffer,new Int8Array(a));return S&&P.set(new Int8Array(S)),P}case 0:{const P=(ArrayBuffer,new Uint8Array(a));return S&&P.set(new Uint8Array(S)),P}case 4:{const P=a instanceof ArrayBuffer?new Int16Array(a):new Int16Array(R?a/2:a);return S&&P.set(new Int16Array(S)),P}case 5:case 8:case 9:case 10:case 2:{const P=a instanceof ArrayBuffer?new Uint16Array(a):new Uint16Array(R?a/2:a);return S&&P.set(new Uint16Array(S)),P}case 6:{const P=a instanceof ArrayBuffer?new Int32Array(a):new Int32Array(R?a/4:a);return S&&P.set(new Int32Array(S)),P}case 7:case 11:case 12:case 13:case 14:case 15:{const P=a instanceof ArrayBuffer?new Uint32Array(a):new Uint32Array(R?a/4:a);return S&&P.set(new Uint32Array(S)),P}case 1:{const P=a instanceof ArrayBuffer?new Float32Array(a):new Float32Array(R?a/4:a);return S&&P.set(new Float32Array(S)),P}}const A=(ArrayBuffer,new Uint8Array(a));return S&&A.set(new Uint8Array(S)),A}},12336:(P,a,R)=>{R.d(a,{c:()=>S});class S{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersRepository:S.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.ShadersStore:S.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?S.IncludesShadersStore:S.IncludesShadersStoreWGSL}}S.ShadersRepository="src/Shaders/",S.ShadersStore={},S.IncludesShadersStore={},S.ShadersRepositoryWGSL="src/ShadersWGSL/",S.ShadersStoreWGSL={},S.IncludesShadersStoreWGSL={}},12344:(P,a,R)=>{R.d(a,{e:()=>V,g:()=>k,h:()=>O,j:()=>f,m:()=>q,o:()=>W,p:()=>l,t:()=>Q,v:()=>h,z:()=>U,B:()=>j});class S{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.fa._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(P){P&&this.program&&P(this.program)}setEngine(P){this.fa=P}_fillEffectInformation(P,a,R,S,A,Z,p,j){const U=this.fa;if(U.supportsUniformBuffers)for(const h in a)P.bindUniformBlock(h,a[h]);let Q;for(this.fa.getUniforms(this,R).forEach(((P,a)=>{S[R[a]]=P})),this._uniforms=S,Q=0;Q<A.length;Q++){null==P.getUniform(A[Q])&&(A.splice(Q,1),Q--)}A.forEach(((P,a)=>{Z[P]=a}));for(const h of U.getAttributes(this,p))j.push(h)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(P,a){const R=this._valueCache[P],S=a.updateFlag;return(void 0===R||R!==S)&&(this._valueCache[P]=S,!0)}_cacheFloat2(P,a,R){let S=this._valueCache[P];if(!S||2!==S.length)return S=[a,R],this._valueCache[P]=S,!0;let A=!1;return S[0]!==a&&(S[0]=a,A=!0),S[1]!==R&&(S[1]=R,A=!0),A}_cacheFloat3(P,a,R,S){let A=this._valueCache[P];if(!A||3!==A.length)return A=[a,R,S],this._valueCache[P]=A,!0;let Z=!1;return A[0]!==a&&(A[0]=a,Z=!0),A[1]!==R&&(A[1]=R,Z=!0),A[2]!==S&&(A[2]=S,Z=!0),Z}_cacheFloat4(P,a,R,S,A){let Z=this._valueCache[P];if(!Z||4!==Z.length)return Z=[a,R,S,A],this._valueCache[P]=Z,!0;let p=!1;return Z[0]!==a&&(Z[0]=a,p=!0),Z[1]!==R&&(Z[1]=R,p=!0),Z[2]!==S&&(Z[2]=S,p=!0),Z[3]!==A&&(Z[3]=A,p=!0),p}setInt(P,a){const R=this._valueCache[P];void 0!==R&&R===a||this.fa.setInt(this._uniforms[P],a)&&(this._valueCache[P]=a)}setInt2(P,a,R){this._cacheFloat2(P,a,R)&&(this.fa.setInt2(this._uniforms[P],a,R)||(this._valueCache[P]=null))}setInt3(P,a,R,S){this._cacheFloat3(P,a,R,S)&&(this.fa.setInt3(this._uniforms[P],a,R,S)||(this._valueCache[P]=null))}setInt4(P,a,R,S,A){this._cacheFloat4(P,a,R,S,A)&&(this.fa.setInt4(this._uniforms[P],a,R,S,A)||(this._valueCache[P]=null))}setIntArray(P,a){this._valueCache[P]=null,this.fa.setIntArray(this._uniforms[P],a)}setIntArray2(P,a){this._valueCache[P]=null,this.fa.setIntArray2(this._uniforms[P],a)}setIntArray3(P,a){this._valueCache[P]=null,this.fa.setIntArray3(this._uniforms[P],a)}setIntArray4(P,a){this._valueCache[P]=null,this.fa.setIntArray4(this._uniforms[P],a)}setUInt(P,a){const R=this._valueCache[P];void 0!==R&&R===a||this.fa.setUInt(this._uniforms[P],a)&&(this._valueCache[P]=a)}setUInt2(P,a,R){this._cacheFloat2(P,a,R)&&(this.fa.setUInt2(this._uniforms[P],a,R)||(this._valueCache[P]=null))}setUInt3(P,a,R,S){this._cacheFloat3(P,a,R,S)&&(this.fa.setUInt3(this._uniforms[P],a,R,S)||(this._valueCache[P]=null))}setUInt4(P,a,R,S,A){this._cacheFloat4(P,a,R,S,A)&&(this.fa.setUInt4(this._uniforms[P],a,R,S,A)||(this._valueCache[P]=null))}setUIntArray(P,a){this._valueCache[P]=null,this.fa.setUIntArray(this._uniforms[P],a)}setUIntArray2(P,a){this._valueCache[P]=null,this.fa.setUIntArray2(this._uniforms[P],a)}setUIntArray3(P,a){this._valueCache[P]=null,this.fa.setUIntArray3(this._uniforms[P],a)}setUIntArray4(P,a){this._valueCache[P]=null,this.fa.setUIntArray4(this._uniforms[P],a)}setArray(P,a){this._valueCache[P]=null,this.fa.setArray(this._uniforms[P],a)}setArray2(P,a){this._valueCache[P]=null,this.fa.setArray2(this._uniforms[P],a)}setArray3(P,a){this._valueCache[P]=null,this.fa.setArray3(this._uniforms[P],a)}setArray4(P,a){this._valueCache[P]=null,this.fa.setArray4(this._uniforms[P],a)}setMatrices(P,a){a&&(this._valueCache[P]=null,this.fa.setMatrices(this._uniforms[P],a))}setMatrix(P,a){this._cacheMatrix(P,a)&&(this.fa.setMatrices(this._uniforms[P],a.pj())||(this._valueCache[P]=null))}setMatrix3x3(P,a){this._valueCache[P]=null,this.fa.setMatrix3x3(this._uniforms[P],a)}setMatrix2x2(P,a){this._valueCache[P]=null,this.fa.setMatrix2x2(this._uniforms[P],a)}setFloat(P,a){const R=this._valueCache[P];void 0!==R&&R===a||this.fa.setFloat(this._uniforms[P],a)&&(this._valueCache[P]=a)}setVector2(P,a){this._cacheFloat2(P,a.x,a.y)&&(this.fa.setFloat2(this._uniforms[P],a.x,a.y)||(this._valueCache[P]=null))}setFloat2(P,a,R){this._cacheFloat2(P,a,R)&&(this.fa.setFloat2(this._uniforms[P],a,R)||(this._valueCache[P]=null))}setVector3(P,a){this._cacheFloat3(P,a.x,a.y,a.z)&&(this.fa.setFloat3(this._uniforms[P],a.x,a.y,a.z)||(this._valueCache[P]=null))}setFloat3(P,a,R,S){this._cacheFloat3(P,a,R,S)&&(this.fa.setFloat3(this._uniforms[P],a,R,S)||(this._valueCache[P]=null))}setVector4(P,a){this._cacheFloat4(P,a.x,a.y,a.z,a.w)&&(this.fa.setFloat4(this._uniforms[P],a.x,a.y,a.z,a.w)||(this._valueCache[P]=null))}setQuaternion(P,a){this._cacheFloat4(P,a.x,a.y,a.z,a.w)&&(this.fa.setFloat4(this._uniforms[P],a.x,a.y,a.z,a.w)||(this._valueCache[P]=null))}setFloat4(P,a,R,S,A){this._cacheFloat4(P,a,R,S,A)&&(this.fa.setFloat4(this._uniforms[P],a,R,S,A)||(this._valueCache[P]=null))}setColor3(P,a){this._cacheFloat3(P,a.r,a.g,a.b)&&(this.fa.setFloat3(this._uniforms[P],a.r,a.g,a.b)||(this._valueCache[P]=null))}setColor4(P,a,R){this._cacheFloat4(P,a.r,a.g,a.b,R)&&(this.fa.setFloat4(this._uniforms[P],a.r,a.g,a.b,R)||(this._valueCache[P]=null))}setDirectColor4(P,a){this._cacheFloat4(P,a.r,a.g,a.b,a.a)&&(this.fa.setFloat4(this._uniforms[P],a.r,a.g,a.b,a.a)||(this._valueCache[P]=null))}_getVertexShaderCode(){return this.vertexShader?this.fa._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.fa._getShaderSource(this.fragmentShader):null}}var A=R(12314);const Z=new WeakMap,p={_webGLVersion:2,cachedPipelines:{}};function j(P){let a=Z.get(P);if(!a){if(!P)return p;a={_webGLVersion:P.TEXTURE_BINDING_3D?2:1,_context:P,parallelShaderCompile:P.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},Z.set(P,a)}return a}function U(P){Z.delete(P)}function Q(P,a,R,S,A,Z){const p=j(S);Z||(Z=p._createShaderProgramInjection??V);return Z(P,t(a,"vertex",S,p._contextWasLost),t(R,"fragment",S,p._contextWasLost),S,A,p.validateShaderPrograms)}function h(P,a,R,S,A){let Z=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,p=arguments.length>6?arguments[6]:void 0;const U=j(A);p||(p=U._createShaderProgramInjection??V);const Q=U._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return p(P,y(a,"vertex",S,Q,A,U._contextWasLost),y(R,"fragment",S,Q,A,U._contextWasLost),A,Z,U.validateShaderPrograms)}function l(P,a){const R=new S,A=j(P);return A.parallelShaderCompile&&!A.disableParallelShaderCompile&&(R.isParallelCompiled=!0),R.context=A._context,R}function V(P,a,R,S){let A=arguments.length>5?arguments[5]:void 0;const Z=S.createProgram();if(P.program=Z,!Z)throw new Error("Unable to create program");return S.attachShader(Z,a),S.attachShader(Z,R),S.linkProgram(Z),P.context=S,P.vertexShader=a,P.fragmentShader=R,P.isParallelCompiled||O(P,S,A),Z}function f(P,a,R){const S=P;if(S._isDisposed)return!1;const A=j(a);return!!(A&&A.parallelShaderCompile&&A.parallelShaderCompile.COMPLETION_STATUS_KHR&&S.program&&a.getProgramParameter(S.program,A.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(O(S,a,R),!0)}function O(P,a,R){const S=P.context,A=P.vertexShader,Z=P.fragmentShader,p=P.program;if(!S.getProgramParameter(p,S.LINK_STATUS)){if(!a.getShaderParameter(A,a.COMPILE_STATUS)){const R=a.getShaderInfoLog(A);if(R)throw P.vertexCompilationError=R,new Error("VERTEX SHADER "+R)}if(!a.getShaderParameter(Z,a.COMPILE_STATUS)){const R=a.getShaderInfoLog(Z);if(R)throw P.fragmentCompilationError=R,new Error("FRAGMENT SHADER "+R)}const R=S.getProgramInfoLog(p);if(R)throw P.programLinkError=R,new Error(R)}if(R){S.validateProgram(p);if(!S.getProgramParameter(p,S.VALIDATE_STATUS)){const a=S.getProgramInfoLog(p);if(a)throw P.programValidationError=a,new Error(a)}}S.deleteShader(A),S.deleteShader(Z),P.vertexShader=void 0,P.fragmentShader=void 0,P.onCompiled&&(P.onCompiled(),P.onCompiled=void 0)}function q(P,a,R,S,A,Z,p,U,l){let V=arguments.length>10?arguments[10]:void 0,f=arguments.length>11?arguments[11]:void 0,O=arguments.length>12?arguments[12]:void 0;const q=j(P.context);f||(f=q.createRawShaderProgramInjection??Q),O||(O=q.createShaderProgramInjection??h);const y=P;y.program=S?f(y,a,R,y.context,l):O(y,a,R,U,y.context,l),y.program.__SPECTOR_rebuildProgram=p,V()}function y(P,a,R,S,Z,p){return t((0,A.e)(P,R,S),a,Z,p)}function t(P,a,R,S){const A=R.createShader("vertex"===a?R.VERTEX_SHADER:R.FRAGMENT_SHADER);if(!A){let P=R.NO_ERROR,A=R.NO_ERROR;for(;(A=R.getError())!==R.NO_ERROR;)P=A;throw new Error(`Something went wrong while creating a gl ${a} shader object. gl error=${P}, gl isContextLost=${R.isContextLost()}, _contextWasLost=${S}`)}return R.shaderSource(A,P),R.compileShader(A),A}function W(P,a){a.useProgram(P)}function k(P,a){const R=P;if(!R.isParallelCompiled)return void a(P);const S=R.onCompiled;R.onCompiled=()=>{null===S||void 0===S||S(),a(P)}}},12338:(P,a,R)=>{R.d(a,{d:()=>l,e:()=>f,g:()=>Q,j:()=>h});var S=R(12240),A=R(12344),Z=R(12336),p=R(12248),j=R(12307),U=R(12314);function Q(P,a){return(0,A.B)(a).cachedPipelines[P]}function h(P){const a=P._name,R=P.context;if(a&&R){const P=(0,A.B)(R),S=P.cachedPipelines[a];null===S||void 0===S||S.dispose(),delete P.cachedPipelines[a]}}function l(P,a,R,A,Z,p,U){let Q,h;const l=(0,S.k)()?null===p||void 0===p?void 0:p.getHostDocument():null;Q="string"===typeof a?a:a.vertexSource?"source:"+a.vertexSource:a.vertexElement?(null===l||void 0===l?void 0:l.getElementById(a.vertexElement))||a.vertexElement:a.vertex||a,h="string"===typeof a?a:a.fragmentSource?"source:"+a.fragmentSource:a.fragmentElement?(null===l||void 0===l?void 0:l.getElementById(a.fragmentElement))||a.fragmentElement:a.fragment||a;const f=[void 0,void 0],O=()=>{if(f[0]&&f[1]){P.isFragment=!0;const[S,Q]=f;(0,j.k)(Q,P,((p,Q)=>{U&&(U._fragmentSourceCodeBeforeMigration=Q),R&&(p=R("fragment",p));const h=(0,j.d)(S,p,P);P=null;const l=function(P,a,R,S){if(R){return{vertexSourceCode:(1===S?"//":"")+"#define SHADER_NAME vertex:"+(R.vertexElement||R.vertex||R.spectorName||R)+"\n"+P,fragmentSourceCode:(1===S?"//":"")+"#define SHADER_NAME fragment:"+(R.fragmentElement||R.fragment||R.spectorName||R)+"\n"+a}}return{vertexSourceCode:P,fragmentSourceCode:a}}(h.vertexCode,h.fragmentCode,a,Z);null===A||void 0===A||A(l.vertexSourceCode,l.fragmentSourceCode)}),p)}};V(Q,"Vertex","",(a=>{(0,j.e)(P),(0,j.k)(a,P,((P,S)=>{U&&(U._rawVertexSourceCode=a,U._vertexSourceCodeBeforeMigration=S),R&&(P=R("vertex",P)),f[0]=P,O()}),p)}),Z),V(h,"Fragment","Pixel",(P=>{U&&(U._rawFragmentSourceCode=P),f[1]=P,O()}),Z)}function V(P,a,R,A,p,j){if("undefined"!==typeof HTMLElement&&P instanceof HTMLElement){return void A((0,S.d)(P))}if("source:"===P.substring(0,7))return void A(P.substring(7));if("base64:"===P.substring(0,7)){return void A(window.atob(P.substring(7)))}const Q=Z.c.GetShadersStore(p);if(Q[P+a+"Shader"])return void A(Q[P+a+"Shader"]);if(R&&Q[P+R+"Shader"])return void A(Q[P+R+"Shader"]);let h;if(h="."===P[0]||"/"===P[0]||P.indexOf("http")>-1?P:Z.c.GetShadersRepository(p)+P,!(j=j||U.i))throw new Error("loadFileInjection is not defined");j(h+"."+a.toLowerCase()+".fx",A)}const f=(P,a,R,S)=>{try{const Z=P.context?(0,A.B)(P.context):null;Z&&(Z.disableParallelShaderCompile=P.disableParallelCompilation);const p=P.existingPipelineContext||a(P.shaderProcessingContext);return p._name=P.name,P.name&&Z&&(Z.cachedPipelines[P.name]=p),R(p,P.vertex,P.fragment,!!P.createAsRaw,"","",P.rebuildRebind,P.defines,P.transformFeedbackVaryings,"",(()=>{S(p,(()=>{var a;null===(a=P.onRenderingStateCompiled)||void 0===a||a.call(P,p)}))})),p}catch(Z){throw p.c.Error("Error compiling effect"),Z}}},12330:(P,a,R)=>{R.r(a),R.d(a,{Effect:()=>U});var S=R(12232),A=R(12248),Z=R(12336),p=R(12338),j=R(12318);class U{static get ShadersRepository(){return Z.c.ShadersRepository}static set ShadersRepository(P){Z.c.ShadersRepository=P}get U(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new S.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(P,a,R){let A=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,Z=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Q=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,V=arguments.length>9?arguments[9]:void 0,f=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",O=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,q=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new S.b,this.onErrorObservable=new S.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=P,this._key=f;const y=this._key.replace(/\r/g,"").replace(/\n/g,"|");let t;if(a.attributes){const P=a;if(this._engine=R,this._attributesNames=P.attributes,this._uniformsNames=P.uniformsNames.concat(P.samplers),this._samplerList=P.samplers.slice(),this.defines=P.defines,this.onError=P.onError,this.onCompiled=P.onCompiled,this._fallbacks=P.fallbacks,this._indexParameters=P.indexParameters,this._transformFeedbackVaryings=P.transformFeedbackVaryings||null,this._multiTarget=!!P.multiTarget,this._shaderLanguage=P.shaderLanguage??0,this._disableParallelShaderCompilation=!!P.disableParallelShaderCompilation,P.uniformBuffersNames){this._uniformBuffersNamesList=P.uniformBuffersNames.slice();for(let a=0;a<P.uniformBuffersNames.length;a++)this._uniformBuffersNames[P.uniformBuffersNames[a]]=a}this._processFinalCode=P.processFinalCode??null,this._processCodeAfterIncludes=P.processCodeAfterIncludes??void 0,q=P.extraInitializationsAsync,t=P.existingPipelineContext}else this._engine=Z,this.defines=null==j?"":j,this._uniformsNames=R.concat(A),this._samplerList=A?A.slice():[],this._attributesNames=a,this._uniformBuffersNamesList=[],this._shaderLanguage=O,this.onError=l,this.onCompiled=h,this._indexParameters=V,this._fallbacks=Q;"WEBGL2"===this._engine.shaderPlatformName&&(t=(0,p.g)(y,this._engine._gl)??t),this._attributeLocationByName={},this.uniqueId=U._UniqueIdSeed++,t?(this._pipelineContext=t,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,q),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.U||this.dispose(!0)}))}async _processShaderCodeAsync(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,S=arguments.length>3?arguments[3]:void 0;S&&await S(),this._processingContext=R||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const A={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:P??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:Z.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:Z.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,Cp:this._engine.Cp,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,p.d)(A,this.name,this._processFinalCode,((P,R)=>{this._vertexSourceCode=P,this._fragmentSourceCode=R,this._prepareEffect(a)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.U||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(P){return this._attributes[P]}getAttributeLocationByName(P){return this._attributeLocationByName[P]}getAttributesCount(){return this._attributes.length}getUniformIndex(P){return this._uniformsNames.indexOf(P)}getUniform(P){return this._uniforms[P]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((P=>{this.executeWhenCompiled(P)}))}executeWhenCompiled(P){this.isReady()?P(this):(this.onCompileObservable.add((a=>{P(a)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(P){(0,j.f)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(a=>{this._processCompilationErrors(a,P)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var P;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(P=this._pipelineContext)||void 0===P?void 0:P._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var P;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(P=this._pipelineContext)||void 0===P?void 0:P._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,Cp:this._engine.Cp,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(P,a,R,S){this._isReady=!1,this._vertexSourceCodeOverride=P,this._fragmentSourceCodeOverride=a,this.onError=(P,a)=>{S&&S(a)},this.onCompiled=()=>{var P,a;const S=this.getEngine().scenes;if(S)for(let R=0;R<S.length;R++)S[R].markAllMaterialsAsDirty(127);null===(P=(a=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===P||P.call(a,R)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(P){if(this._pipelineContext=P,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let a=0;a<this._attributesNames.length;a++){const P=this._attributesNames[a];this._attributeLocationByName[P]=this._attributes[a]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),U.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=this._pipelineContext;this._isReady=!1;try{const R=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),S=R?null:this.defines,A=R?this._vertexSourceCodeOverride:this._vertexSourceCode,Z=R?this._fragmentSourceCodeOverride:this._fragmentSourceCode,j=this._engine;this._pipelineContext=(0,p.e)({existingPipelineContext:P?a:null,vertex:A,fragment:Z,context:"WEBGL2"===j.shaderPlatformName||"WEBGL1"===j.shaderPlatformName?j._gl:void 0,rebuildRebind:(P,a,R,S)=>this._rebuildProgram(P,a,R,S),defines:S,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:R,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:R=>{a&&!P&&this._engine._deletePipelineContext(a),R&&this._onRenderingStateCompiled(R)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(a)}catch(R){this._processCompilationErrors(R,a)}}_getShaderCodeAndErrorLine(P,a,R){const S=R?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let A=null;if(a&&P){const Z=a.match(S);if(Z&&2===Z.length){const a=parseInt(Z[1]),S=P.split("\n",-1);S.length>=a&&(A=`Offending line [${a}] in ${R?"fragment":"vertex"} code: ${S[a-1]}`)}}return[P,A]}_processCompilationErrors(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=P.message;const R=this._attributesNames,S=this._fallbacks;if(A.c.Error("Unable to compile effect:"),A.c.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),A.c.Error(`Attributes: ${R.join(" ")}`),A.c.Error("Defines:\n"+this.defines),U.LogShaderCodeOnCompilationError){var Z,p;let P=null,a=null,R=null;var j;if(null!==(Z=this._pipelineContext)&&void 0!==Z&&Z._getVertexShaderCode()&&([R,P]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),R&&(A.c.Error("Vertex code:"),A.c.Error(R))),null!==(p=this._pipelineContext)&&void 0!==p&&p._getFragmentShaderCode())[R,a]=this._getShaderCodeAndErrorLine(null===(j=this._pipelineContext)||void 0===j?void 0:j._getFragmentShaderCode(),this._compilationError,!0),R&&(A.c.Error("Fragment code:"),A.c.Error(R));P&&A.c.Error(P),a&&A.c.Error(a)}A.c.Error("Error: "+this._compilationError);const Q=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};a&&(this._pipelineContext=a,this._isReady=!0,Q()),S?(this._pipelineContext=null,S.hasMoreFallbacks?(this._allFallbacksProcessed=!1,A.c.Error("Trying next fallback."),this.defines=S.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,Q(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,a||Q())}get isSupported(){return""===this._compilationError}_bindTexture(P,a){this._engine._bindTexture(this._samplers[P],a,P)}setTexture(P,a){this._engine.setTexture(this._samplers[P],this._uniforms[P],a,P)}setTextureArray(P,a){const R=P+"Ex";if(-1===this._samplerList.indexOf(R+"0")){const S=this._samplerList.indexOf(P);for(let P=1;P<a.length;P++){const a=R+(P-1).toString();this._samplerList.splice(S+P,0,a)}let A=0;for(const P of this._samplerList)this._samplers[P]=A,A+=1}this._engine.setTextureArray(this._samplers[P],this._uniforms[P],a,P)}bindUniformBuffer(P,a){const R=this._uniformBuffersNames[a];void 0===R||U._BaseCache[R]===P&&this._engine._features.useUBOBindingCache||(U._BaseCache[R]=P,this._engine.bindUniformBufferBase(P,R,a))}bindUniformBlock(P,a){this._engine.bindUniformBlock(this._pipelineContext,P,a)}setInt(P,a){return this._pipelineContext.setInt(P,a),this}setInt2(P,a,R){return this._pipelineContext.setInt2(P,a,R),this}setInt3(P,a,R,S){return this._pipelineContext.setInt3(P,a,R,S),this}setInt4(P,a,R,S,A){return this._pipelineContext.setInt4(P,a,R,S,A),this}setIntArray(P,a){return this._pipelineContext.setIntArray(P,a),this}setIntArray2(P,a){return this._pipelineContext.setIntArray2(P,a),this}setIntArray3(P,a){return this._pipelineContext.setIntArray3(P,a),this}setIntArray4(P,a){return this._pipelineContext.setIntArray4(P,a),this}setUInt(P,a){return this._pipelineContext.setUInt(P,a),this}setUInt2(P,a,R){return this._pipelineContext.setUInt2(P,a,R),this}setUInt3(P,a,R,S){return this._pipelineContext.setUInt3(P,a,R,S),this}setUInt4(P,a,R,S,A){return this._pipelineContext.setUInt4(P,a,R,S,A),this}setUIntArray(P,a){return this._pipelineContext.setUIntArray(P,a),this}setUIntArray2(P,a){return this._pipelineContext.setUIntArray2(P,a),this}setUIntArray3(P,a){return this._pipelineContext.setUIntArray3(P,a),this}setUIntArray4(P,a){return this._pipelineContext.setUIntArray4(P,a),this}setFloatArray(P,a){return this._pipelineContext.setArray(P,a),this}setFloatArray2(P,a){return this._pipelineContext.setArray2(P,a),this}setFloatArray3(P,a){return this._pipelineContext.setArray3(P,a),this}setFloatArray4(P,a){return this._pipelineContext.setArray4(P,a),this}setArray(P,a){return this._pipelineContext.setArray(P,a),this}setArray2(P,a){return this._pipelineContext.setArray2(P,a),this}setArray3(P,a){return this._pipelineContext.setArray3(P,a),this}setArray4(P,a){return this._pipelineContext.setArray4(P,a),this}setMatrices(P,a){return this._pipelineContext.setMatrices(P,a),this}setMatrix(P,a){return this._pipelineContext.setMatrix(P,a),this}setMatrix3x3(P,a){return this._pipelineContext.setMatrix3x3(P,a),this}setMatrix2x2(P,a){return this._pipelineContext.setMatrix2x2(P,a),this}setFloat(P,a){return this._pipelineContext.setFloat(P,a),this}setBool(P,a){return this._pipelineContext.setInt(P,a?1:0),this}setVector2(P,a){return this._pipelineContext.setVector2(P,a),this}setFloat2(P,a,R){return this._pipelineContext.setFloat2(P,a,R),this}setVector3(P,a){return this._pipelineContext.setVector3(P,a),this}setFloat3(P,a,R,S){return this._pipelineContext.setFloat3(P,a,R,S),this}setVector4(P,a){return this._pipelineContext.setVector4(P,a),this}setQuaternion(P,a){return this._pipelineContext.setQuaternion(P,a),this}setFloat4(P,a,R,S,A){return this._pipelineContext.setFloat4(P,a,R,S,A),this}setColor3(P,a){return this._pipelineContext.setColor3(P,a),this}setColor4(P,a,R){return this._pipelineContext.setColor4(P,a,R),this}setDirectColor4(P,a){return this._pipelineContext.setDirectColor4(P,a),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(U.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,p.j)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;a&&(Z.c.GetShadersStore(S)[`${P}PixelShader`]=a),R&&(Z.c.GetShadersStore(S)[`${P}VertexShader`]=R)}static ResetCache(){U._BaseCache={}}}U.LogShaderCodeOnCompilationError=!0,U.PersistentMode=!1,U.AutomaticallyClearCodeCache=!1,U._UniqueIdSeed=0,U._BaseCache={},U.ShadersStore=Z.c.ShadersStore,U.IncludesShadersStore=Z.c.IncludesShadersStore},12266:(P,a,R)=>{R.d(a,{c:()=>A});const S={};function A(P){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!S[P])return S[P]=!0,`${P} needs to be imported before as it contains a side-effect required by your code.`}},12240:(P,a,R)=>{function S(){return"undefined"!==typeof window}function A(){return"undefined"!==typeof navigator}function Z(){return"undefined"!==typeof document}function p(P){let a="",R=P.firstChild;for(;R;)3===R.nodeType&&(a+=R.textContent),R=R.nextSibling;return a}R.d(a,{d:()=>p,f:()=>Z,h:()=>A,k:()=>S})},12248:(P,a,R)=>{R.d(a,{c:()=>S});class S{static _CheckLimit(P,a){let R=S._LogLimitOutputs[P];return R?R.current++:(R={limit:a,current:1},S._LogLimitOutputs[P]=R),R.current<=R.limit}static _GenerateLimitMessage(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const R=S._LogLimitOutputs[P];if(!R||!S.MessageLimitReached)return;const A=this._Levels[a];R.current===R.limit&&S[A.name](S.MessageLimitReached.replace(/%LIMIT%/g,""+R.limit).replace(/%TYPE%/g,A.name??""))}static _AddLogEntry(P){S._LogCache=P+S._LogCache,S.OnNewCacheEntry&&S.OnNewCacheEntry(P)}static _FormatMessage(P){const a=P=>P<10?"0"+P:""+P,R=new Date;return"["+a(R.getHours())+":"+a(R.getMinutes())+":"+a(R.getSeconds())+"]: "+P}static _LogDisabled(P,a){}static _LogEnabled(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1?arguments[1]:void 0,R=arguments.length>2?arguments[2]:void 0;const A=Array.isArray(a)?a[0]:a;if(void 0!==R&&!S._CheckLimit(A,R))return;const Z=S._FormatMessage(A),p=this._Levels[P],j=Array.isArray(a)?a.slice(1):[];p.logFunc&&p.logFunc("BJS - "+Z,...j);const U=`<div style='color:${p.color}'>${Z}</div><br>`;S._AddLogEntry(U),S._GenerateLimitMessage(A,P)}static get LogCache(){return S._LogCache}static ClearLogCache(){S._LogCache="",S._LogLimitOutputs={},S.errorsCount=0}static set LogLevels(P){S.Log=S._LogDisabled,S.Warn=S._LogDisabled,S.Error=S._LogDisabled;const a=[S.MessageLogLevel,S.WarningLogLevel,S.ErrorLogLevel];for(const R of a)if((P&R)===R){const P=this._Levels[R];S[P.name]=S._LogEnabled.bind(S,R)}}}S.NoneLogLevel=0,S.MessageLogLevel=1,S.WarningLogLevel=2,S.ErrorLogLevel=4,S.AllLogLevel=7,S.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",S._LogCache="",S._LogLimitOutputs={},S._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],S.errorsCount=0,S.Log=S._LogEnabled.bind(S,S.MessageLogLevel),S.Warn=S._LogEnabled.bind(S,S.WarningLogLevel),S.Error=S._LogEnabled.bind(S,S.ErrorLogLevel)},12232:(P,a,R)=>{R.d(a,{b:()=>p});const S="undefined"!==typeof WeakRef;class A{constructor(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;this.initialize(P,a,R,S)}initialize(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0;return this.mask=P,this.skipNextObservers=a,this.target=R,this.currentTarget=S,this}}class Z{constructor(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=P,this.mask=a,this.scope=R,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(P)}}class p{static FromPromise(P,a){const R=new p;return P.then((P=>{R.notifyObservers(P)})).catch((P=>{if(!a)throw P;a.notifyObservers(P)})),R}get observers(){return this._observers}constructor(P){let a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=a,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new A(0),P&&(this._onObserverAdded=P)}add(P){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],R=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!P)return null;const A=new Z(P,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);A.unregisterOnNextCall=R,a?this._observers.unshift(A):this._observers.push(A),this._onObserverAdded&&this._onObserverAdded(A),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(A,this._lastNotifiedValue);const p=S?new WeakRef(this):{deref:()=>this};return A._remove=function(){let P=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const a=p.deref();a&&(P?a.remove(A):a._remove(A))},A}addOnce(P){return this.add(P,void 0,void 0,void 0,!0)}remove(P){if(!P)return!1;P._remove=null;return-1!==this._observers.indexOf(P)&&(this._deferUnregister(P),!0)}removeCallback(P,a){for(let R=0;R<this._observers.length;R++){const S=this._observers[R];if(!S._willBeUnregistered&&(S.callback===P&&(!a||a===S.scope)))return this._deferUnregister(S),!0}return!1}_deferUnregister(P){P._willBeUnregistered||(this._numObserversMarkedAsDeleted++,P.unregisterOnNextCall=!1,P._willBeUnregistered=!0,setTimeout((()=>{this._remove(P)}),0))}_remove(P){let a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!P)return!1;const R=this._observers.indexOf(P);return-1!==R&&(a&&this._numObserversMarkedAsDeleted--,this._observers.splice(R,1),!0)}makeObserverTopPriority(P){this._remove(P,!1),this._observers.unshift(P)}makeObserverBottomPriority(P){this._remove(P,!1),this._observers.push(P)}notifyObservers(P){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,R=arguments.length>2?arguments[2]:void 0,S=arguments.length>3?arguments[3]:void 0,A=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=P),!this._observers.length)return!0;const Z=this._eventState;Z.mask=a,Z.target=R,Z.currentTarget=S,Z.skipNextObservers=!1,Z.lastReturnValue=P,Z.userInfo=A;for(const p of this._observers)if(!p._willBeUnregistered&&(p.mask&a&&(p.unregisterOnNextCall&&this._deferUnregister(p),p.scope?Z.lastReturnValue=p.callback.apply(p.scope,[P,Z]):Z.lastReturnValue=p.callback(P,Z)),Z.skipNextObservers))return!1;return!0}notifyObserver(P,a){let R=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=a),P._willBeUnregistered)return;const S=this._eventState;S.mask=R,S.skipNextObservers=!1,P.unregisterOnNextCall&&this._deferUnregister(P),P.callback(a,S)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const P=this._observers.pop();P&&(P._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const P=new p;return P._observers=this._observers.slice(0),P}hasSpecificMask(){let P=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const a of this._observers)if(a.mask&P||a.mask===P)return!0;return!1}}},12318:(P,a,R)=>{R.d(a,{b:()=>A,f:()=>p});let S=[];class A{static SetImmediate(P){0===S.length&&setTimeout((()=>{const P=S;S=[];for(const a of P)a()}),1),S.push(P)}}function Z(P,a,R){try{if(P())return a(),!0}catch(S){return null===R||void 0===R||R(S),!0}return!1}const p=function(P,a,R){let S=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,A=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,p=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&Z(P,a,R))return null;const j=setInterval((()=>{Z(P,a,R)?clearInterval(j):(A-=S,A<0&&(clearInterval(j),null===R||void 0===R||R(new Error("Operation timed out after maximum retries. "+(p||"")),!0)))}),S);return()=>clearInterval(j)}}}]);