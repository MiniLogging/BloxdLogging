"use strict";(self["2fwzcez286e"]=self["2fwzcez286e"]||[]).push([[9],{12874:(B,u,F)=>{F.d(u,{e:()=>O,i:()=>U,m:()=>y,k:()=>j,q:()=>o});class Z{constructor(){this.children=[]}isValid(B){return!0}process(B,u,F){let Z="";if(this.line){let F=this.line;const Y=u.processor;if(Y){var V,p,G,R,e,s;Y.lineProcessor&&(F=Y.lineProcessor(F,u.isFragment,u.processingContext));const Z=(null===(V=u.processor)||void 0===V?void 0:V.attributeKeywordName)??"attribute",Q=u.isFragment&&null!==(p=u.processor)&&void 0!==p&&p.varyingFragmentKeywordName?null===(G=u.processor)||void 0===G?void 0:G.varyingFragmentKeywordName:!u.isFragment&&null!==(R=u.processor)&&void 0!==R&&R.varyingVertexKeywordName?null===(e=u.processor)||void 0===e?void 0:e.varyingVertexKeywordName:"varying";if(!u.isFragment&&Y.attributeProcessor&&this.line.startsWith(Z))F=Y.attributeProcessor(this.line,B,u.processingContext);else if(Y.varyingProcessor&&(null!==(s=Y.varyingCheck)&&void 0!==s&&s.call(Y,this.line,u.isFragment)||!Y.varyingCheck&&this.line.startsWith(Q)))F=Y.varyingProcessor(this.line,u.isFragment,B,u.processingContext);else if(Y.uniformProcessor&&Y.uniformRegexp&&Y.uniformRegexp.test(this.line))u.lookForClosingBracketForUniformBuffer||(F=Y.uniformProcessor(this.line,u.isFragment,B,u.processingContext));else if(Y.uniformBufferProcessor&&Y.uniformBufferRegexp&&Y.uniformBufferRegexp.test(this.line))u.lookForClosingBracketForUniformBuffer||(F=Y.uniformBufferProcessor(this.line,u.isFragment,u.processingContext),u.lookForClosingBracketForUniformBuffer=!0);else if(Y.textureProcessor&&Y.textureRegexp&&Y.textureRegexp.test(this.line))F=Y.textureProcessor(this.line,u.isFragment,B,u.processingContext);else if((Y.uniformProcessor||Y.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!u.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?Y.uniformProcessor&&(F=Y.uniformProcessor(this.line,u.isFragment,B,u.processingContext)):Y.uniformBufferProcessor&&(F=Y.uniformBufferProcessor(this.line,u.isFragment,u.processingContext),u.lookForClosingBracketForUniformBuffer=!0)}u.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(u.lookForClosingBracketForUniformBuffer=!1,Y.endOfUniformBufferProcessor&&(F=Y.endOfUniformBufferProcessor(this.line,u.isFragment,u.processingContext)))}Z+=F+"\n"}for(const Y of this.children)Z+=Y.process(B,u,F);return this.additionalDefineKey&&(B[this.additionalDefineKey]=this.additionalDefineValue||"true",F[this.additionalDefineKey]=B[this.additionalDefineKey]),Z}}class V{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(B){this._lines.length=0;for(const u of B){if(!u||"\r"===u)continue;if("#"===u[0]){this._lines.push(u);continue}const B=u.trim();if(!B)continue;if(B.startsWith("//")){this._lines.push(u);continue}const F=B.indexOf(";");if(-1===F)this._lines.push(B);else if(F===B.length-1)B.length>1&&this._lines.push(B);else{const B=u.split(";");for(let u=0;u<B.length;u++){let F=B[u];F&&(F=F.trim(),F&&this._lines.push(F+(u!==B.length-1?";":"")))}}}}}class p extends Z{process(B,u,F){for(let Z=0;Z<this.children.length;Z++){const V=this.children[Z];if(V.isValid(B))return V.process(B,u,F)}return""}}class G extends Z{isValid(B){return this.testExpression.isTrue(B)}}class R{isTrue(B){return!0}static postfixToInfix(B){const u=[];for(const F of B)if(void 0===R._OperatorPriority[F])u.push(F);else{const B=u[u.length-1],Z=u[u.length-2];u.length-=2,u.push(`(${Z}${F}${B})`)}return u[u.length-1]}static infixToPostfix(B){const u=R._InfixToPostfixCache.get(B);if(u)return u.accessTime=Date.now(),u.result;if(!B.includes("&&")&&!B.includes("||")&&!B.includes(")")&&!B.includes("("))return[B];const F=[];let Z=-1;const V=()=>{Y=Y.trim(),""!==Y&&(F.push(Y),Y="")},p=B=>{Z<R._Stack.length-1&&(R._Stack[++Z]=B)},G=()=>R._Stack[Z],e=()=>-1===Z?"!!INVALID EXPRESSION!!":R._Stack[Z--];let s=0,Y="";for(;s<B.length;){const u=B.charAt(s),Q=s<B.length-1?B.substring(s,2+s):"";if("("===u)Y="",p(u);else if(")"===u){for(V();-1!==Z&&"("!==G();)F.push(e());e()}else if(R._OperatorPriority[Q]>1){for(V();-1!==Z&&R._OperatorPriority[G()]>=R._OperatorPriority[Q];)F.push(e());p(Q),s++}else Y+=u;s++}for(V();-1!==Z;)"("===G()?e():F.push(e());return R._InfixToPostfixCache.size>=R.InfixToPostfixCacheLimitSize&&R.ClearCache(),R._InfixToPostfixCache.set(B,{result:F,accessTime:Date.now()}),F}static ClearCache(){const B=Array.from(R._InfixToPostfixCache.entries()).sort(((B,u)=>B[1].accessTime-u[1].accessTime));for(let u=0;u<R.InfixToPostfixCacheCleanupSize;u++)R._InfixToPostfixCache.delete(B[u][0])}}R.InfixToPostfixCacheLimitSize=5e4,R.InfixToPostfixCacheCleanupSize=25e3,R._InfixToPostfixCache=new Map,R._OperatorPriority={")":0,"(":1,"||":2,"&&":3},R._Stack=["","","","","","","","","","","","","","","","","","","",""];class e extends R{constructor(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=B,this.not=u}isTrue(B){let u=void 0!==B[this.define];return this.not&&(u=!u),u}}class s extends R{isTrue(B){return this.leftOperand.isTrue(B)||this.rightOperand.isTrue(B)}}class Y extends R{isTrue(B){return this.leftOperand.isTrue(B)&&this.rightOperand.isTrue(B)}}class Q extends R{constructor(B,u,F){super(),this.define=B,this.operand=u,this.testValue=F}toString(){return`${this.define} ${this.operand} ${this.testValue}`}isTrue(B){let u=!1;const F=parseInt(void 0!=B[this.define]?B[this.define]:this.define),Z=parseInt(void 0!=B[this.testValue]?B[this.testValue]:this.testValue);if(isNaN(F)||isNaN(Z))return!1;switch(this.operand){case">":u=F>Z;break;case"<":u=F<Z;break;case"<=":u=F<=Z;break;case">=":u=F>=Z;break;case"==":u=F===Z;break;case"!=":u=F!==Z}return u}}var t=F(12843),v=F(12878);const D=/defined\s*?\((.+?)\)/g,L=/defined\s*?\[(.+?)\]/g,q=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,W=/__decl__/,X=/light\{X\}.(\w*)/g,f=/\{X\}/g,C=[],x=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function U(B){B.processor&&B.processor.initializeShaders&&B.processor.initializeShaders(B.processingContext)}function y(B,u,F,Z){var V;null!==(V=u.processor)&&void 0!==V&&V.preProcessShaderCode&&(B=u.processor.preProcessShaderCode(B,u.isFragment)),j(B,u,(B=>{u.processCodeAfterIncludes&&(B=u.processCodeAfterIncludes(u.isFragment?"fragment":"vertex",B,u.defines));const V=function(B,u,F){let Z=function(B,u){var F;if(null!==(F=u.processor)&&void 0!==F&&F.noPrecision)return B;const Z=u.shouldUseHighPrecisionShader;-1===B.indexOf("precision highp float")?B=Z?"precision highp float;\n"+B:"precision mediump float;\n"+B:Z||(B=B.replace("precision highp float","precision mediump float"));return B}(B,u);if(!u.processor)return Z;if(0===u.processor.shaderLanguage&&-1!==Z.indexOf("#version 3")&&(Z=Z.replace("#version 300 es",""),!u.processor.parseGLES3))return Z;const V=u.defines,p=M(u,F);u.processor.preProcessor&&(Z=u.processor.preProcessor(Z,V,p,u.isFragment,u.processingContext));const G={};Z=z(Z,p,u,G),u.processor.postProcessor&&(Z=u.processor.postProcessor(Z,V,u.isFragment,u.processingContext,F?{drawBuffersExtensionDisabled:!F.getCaps().drawBuffersExtension}:{},p,G));null!==F&&void 0!==F&&F._features.needShaderCodeInlining&&(Z=F.inlineShaderCode(Z));return Z}(B,u,Z);F(V,B)}))}function O(B,u,F){return F.processor&&F.processor.finalizeShaders?F.processor.finalizeShaders(B,u,F.processingContext):{vertexCode:B,fragmentCode:u}}function g(B){const u=/defined\((.+)\)/.exec(B);if(u&&u.length)return new e(u[1].trim(),"!"===B[0]);const F=["==","!=",">=","<=","<",">"];let Z="",V=0;for(Z of F)if(V=B.indexOf(Z),V>-1)break;if(-1===V)return new e(B);const p=B.substring(0,V).trim(),G=B.substring(V+Z.length).trim();return new Q(p,Z,G)}function J(B,u){const F=new G,Z=B.substring(0,u);let V=B.substring(u);return V=V.substring(0,(V.indexOf("//")+1||V.length+1)-1).trim(),F.testExpression="#ifdef"===Z?new e(V):"#ifndef"===Z?new e(V,!0):function(B){B=B.replace(D,"defined[$1]");const u=R.infixToPostfix(B),F=[];for(const V of u)if("||"!==V&&"&&"!==V)F.push(V);else if(F.length>=2){let B=F[F.length-1],u=F[F.length-2];F.length-=2;const Z="&&"==V?new Y:new s;"string"===typeof B&&(B=B.replace(L,"defined($1)")),"string"===typeof u&&(u=u.replace(L,"defined($1)")),Z.leftOperand="string"===typeof u?g(u):u,Z.rightOperand="string"===typeof B?g(B):B,F.push(Z)}let Z=F[F.length-1];return"string"===typeof Z&&(Z=Z.replace(L,"defined($1)")),"string"===typeof Z?g(Z):Z}(V),F}function a(B,u,F,V){let p=B.currentLine;for(;T(B,F,V);){p=B.currentLine;const G=p.substring(0,5).toLowerCase();if("#else"===G){const F=new Z;return u.children.push(F),void T(B,F,V)}if("#elif"===G){const B=J(p,5);u.children.push(B),F=B}}}function T(B,u,F){for(;B.canRead;){B.lineIndex++;const V=B.currentLine;if(V.indexOf("#")>=0){const Z=x.exec(V);if(Z&&Z.length){switch(Z[0]){case"#ifdef":{const Z=new p;u.children.push(Z);const G=J(V,6);Z.children.push(G),a(B,Z,G,F);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const Z=new p;u.children.push(Z);const G=J(V,7);Z.children.push(G),a(B,Z,G,F);break}case"#if":{const Z=new p,G=J(V,3);u.children.push(Z),Z.children.push(G),a(B,Z,G,F);break}}continue}}const G=new Z;if(G.line=V,u.children.push(G),"#"===V[0]&&"d"===V[1]){const B=V.replace(";","").split(" ");G.additionalDefineKey=B[1],3===B.length&&(G.additionalDefineValue=B[2])}}return!1}function z(B,u,F,p){const G=new Z,R=new V;return R.lineIndex=-1,R.lines=B.split("\n"),T(R,G,p),G.process(u,F,p)}function M(B,u){var F;const Z=B.defines,V={};for(const p of Z){const B=p.replace("#define","").replace(";","").trim().split(" ");V[B[0]]=B.length>1?B[1]:""}return 0===(null===(F=B.processor)||void 0===F?void 0:F.shaderLanguage)&&(V.GL_ES="true"),V.__VERSION__=B.version,V[B.platformName]="true",(0,v.h)(V,null===u||void 0===u?void 0:u.isNDCHalfZRange,null===u||void 0===u?void 0:u.o,null===u||void 0===u?void 0:u.useExactSrgbConversions),V}function j(B,u,F){let Z;for(C.length=0;null!==(Z=q.exec(B));)C.push(Z);let V=String(B),p=[B],G=!1;for(const R of C){let B=R[1];if(-1!==B.indexOf("__decl__")&&(B=B.replace(W,""),u.supportsUniformBuffers&&(B=B.replace("Vertex","Ubo").replace("Fragment","Ubo")),B+="Declaration"),!u.includesShadersStore[B]){const Z=u.shadersRepository+"ShadersInclude/"+B+".fx";return void o.loadFile(Z,(Z=>{u.includesShadersStore[B]=Z,j(p.join(""),u,F)}))}{let F=u.includesShadersStore[B];if(R[2]){const B=R[3].split(",");for(let u=0;u<B.length;u+=2){const Z=new RegExp(B[u],"g"),V=B[u+1];F=F.replace(Z,V)}}if(R[4]){const B=R[5];if(-1!==B.indexOf("..")){const Z=B.split(".."),V=parseInt(Z[0]);let p=parseInt(Z[1]),G=F.slice(0);F="",isNaN(p)&&(p=u.indexParameters[Z[1]]);for(let B=V;B<p;B++)u.supportsUniformBuffers||(G=G.replace(X,((B,u)=>u+"{X}"))),F+=G.replace(f,B.toString())+"\n"}else u.supportsUniformBuffers||(F=F.replace(X,((B,u)=>u+"{X}"))),F=F.replace(f,B)}const Z=[];for(const B of p){const u=B.split(R[0]);for(let B=0;B<u.length-1;B++)Z.push(u[B]),Z.push(F);Z.push(u[u.length-1])}p=Z,G=G||F.indexOf("#include<")>=0||F.indexOf("#include <")>=0}}C.length=0,V=p.join(""),G?j(V.toString(),u,F):F(V)}const o={loadFile:(B,u,F,Z,V,p)=>{throw(0,t.e)("FileTools")}}},12878:(B,u,F)=>{F.d(u,{c:()=>V,f:()=>p,h:()=>R,l:()=>G,p:()=>e});var Z=F(12843);F(12816);const V={};function p(B,u){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(u?u+"\n":"")+B}function G(B,u,F,p,G,R,e){const s=e||V.loadFile;if(s){return s(B,u,F,p,G,R)}throw(0,Z.e)("FileTools")}function R(B,u,F,Z){if(B)return u?B.IS_NDC_HALF_ZRANGE="":delete B.IS_NDC_HALF_ZRANGE,F?B.USE_REVERSE_DEPTHBUFFER="":delete B.USE_REVERSE_DEPTHBUFFER,void(Z?B.USE_EXACT_SRGB_CONVERSIONS="":delete B.USE_EXACT_SRGB_CONVERSIONS);{let B="";return u&&(B+="#define IS_NDC_HALF_ZRANGE"),F&&(B&&(B+="\n"),B+="#define USE_REVERSE_DEPTHBUFFER"),Z&&(B&&(B+="\n"),B+="#define USE_EXACT_SRGB_CONVERSIONS"),B}}function e(B,u){let F=arguments.length>2&&void 0!==arguments[2]&&arguments[2],Z=arguments.length>3?arguments[3]:void 0;switch(B){case 3:{const B=(ArrayBuffer,new Int8Array(u));return Z&&B.set(new Int8Array(Z)),B}case 0:{const B=(ArrayBuffer,new Uint8Array(u));return Z&&B.set(new Uint8Array(Z)),B}case 4:{const B=u instanceof ArrayBuffer?new Int16Array(u):new Int16Array(F?u/2:u);return Z&&B.set(new Int16Array(Z)),B}case 5:case 8:case 9:case 10:case 2:{const B=u instanceof ArrayBuffer?new Uint16Array(u):new Uint16Array(F?u/2:u);return Z&&B.set(new Uint16Array(Z)),B}case 6:{const B=u instanceof ArrayBuffer?new Int32Array(u):new Int32Array(F?u/4:u);return Z&&B.set(new Int32Array(Z)),B}case 7:case 11:case 12:case 13:case 14:case 15:{const B=u instanceof ArrayBuffer?new Uint32Array(u):new Uint32Array(F?u/4:u);return Z&&B.set(new Uint32Array(Z)),B}case 1:{const B=u instanceof ArrayBuffer?new Float32Array(u):new Float32Array(F?u/4:u);return Z&&B.set(new Float32Array(Z)),B}}const V=(ArrayBuffer,new Uint8Array(u));return Z&&V.set(new Uint8Array(Z)),V}},12897:(B,u,F)=>{F.d(u,{c:()=>Z});class Z{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.ShadersRepository:Z.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.ShadersStore:Z.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?Z.IncludesShadersStore:Z.IncludesShadersStoreWGSL}}Z.ShadersRepository="src/Shaders/",Z.ShadersStore={},Z.IncludesShadersStore={},Z.ShadersRepositoryWGSL="src/ShadersWGSL/",Z.ShadersStoreWGSL={},Z.IncludesShadersStoreWGSL={}},12909:(B,u,F)=>{F.d(u,{c:()=>t,g:()=>f,h:()=>D,l:()=>v,p:()=>L,q:()=>X,u:()=>Q,w:()=>s,z:()=>Y,D:()=>e,G:()=>R});class Z{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.vu._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(B){B&&this.program&&B(this.program)}setEngine(B){this.vu=B}_fillEffectInformation(B,u,F,Z,V,p,G,R){const e=this.vu;if(e.supportsUniformBuffers)for(const Y in u)B.bindUniformBlock(Y,u[Y]);let s;for(this.vu.getUniforms(this,F).forEach(((B,u)=>{Z[F[u]]=B})),this._uniforms=Z,s=0;s<V.length;s++){null==B.getUniform(V[s])&&(V.splice(s,1),s--)}V.forEach(((B,u)=>{p[B]=u}));for(const Y of e.getAttributes(this,G))R.push(Y)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(B,u){const F=this._valueCache[B],Z=u.updateFlag;return(void 0===F||F!==Z)&&(this._valueCache[B]=Z,!0)}_cacheFloat2(B,u,F){let Z=this._valueCache[B];if(!Z||2!==Z.length)return Z=[u,F],this._valueCache[B]=Z,!0;let V=!1;return Z[0]!==u&&(Z[0]=u,V=!0),Z[1]!==F&&(Z[1]=F,V=!0),V}_cacheFloat3(B,u,F,Z){let V=this._valueCache[B];if(!V||3!==V.length)return V=[u,F,Z],this._valueCache[B]=V,!0;let p=!1;return V[0]!==u&&(V[0]=u,p=!0),V[1]!==F&&(V[1]=F,p=!0),V[2]!==Z&&(V[2]=Z,p=!0),p}_cacheFloat4(B,u,F,Z,V){let p=this._valueCache[B];if(!p||4!==p.length)return p=[u,F,Z,V],this._valueCache[B]=p,!0;let G=!1;return p[0]!==u&&(p[0]=u,G=!0),p[1]!==F&&(p[1]=F,G=!0),p[2]!==Z&&(p[2]=Z,G=!0),p[3]!==V&&(p[3]=V,G=!0),G}setInt(B,u){const F=this._valueCache[B];void 0!==F&&F===u||this.vu.setInt(this._uniforms[B],u)&&(this._valueCache[B]=u)}setInt2(B,u,F){this._cacheFloat2(B,u,F)&&(this.vu.setInt2(this._uniforms[B],u,F)||(this._valueCache[B]=null))}setInt3(B,u,F,Z){this._cacheFloat3(B,u,F,Z)&&(this.vu.setInt3(this._uniforms[B],u,F,Z)||(this._valueCache[B]=null))}setInt4(B,u,F,Z,V){this._cacheFloat4(B,u,F,Z,V)&&(this.vu.setInt4(this._uniforms[B],u,F,Z,V)||(this._valueCache[B]=null))}setIntArray(B,u){this._valueCache[B]=null,this.vu.setIntArray(this._uniforms[B],u)}setIntArray2(B,u){this._valueCache[B]=null,this.vu.setIntArray2(this._uniforms[B],u)}setIntArray3(B,u){this._valueCache[B]=null,this.vu.setIntArray3(this._uniforms[B],u)}setIntArray4(B,u){this._valueCache[B]=null,this.vu.setIntArray4(this._uniforms[B],u)}setUInt(B,u){const F=this._valueCache[B];void 0!==F&&F===u||this.vu.setUInt(this._uniforms[B],u)&&(this._valueCache[B]=u)}setUInt2(B,u,F){this._cacheFloat2(B,u,F)&&(this.vu.setUInt2(this._uniforms[B],u,F)||(this._valueCache[B]=null))}setUInt3(B,u,F,Z){this._cacheFloat3(B,u,F,Z)&&(this.vu.setUInt3(this._uniforms[B],u,F,Z)||(this._valueCache[B]=null))}setUInt4(B,u,F,Z,V){this._cacheFloat4(B,u,F,Z,V)&&(this.vu.setUInt4(this._uniforms[B],u,F,Z,V)||(this._valueCache[B]=null))}setUIntArray(B,u){this._valueCache[B]=null,this.vu.setUIntArray(this._uniforms[B],u)}setUIntArray2(B,u){this._valueCache[B]=null,this.vu.setUIntArray2(this._uniforms[B],u)}setUIntArray3(B,u){this._valueCache[B]=null,this.vu.setUIntArray3(this._uniforms[B],u)}setUIntArray4(B,u){this._valueCache[B]=null,this.vu.setUIntArray4(this._uniforms[B],u)}setArray(B,u){this._valueCache[B]=null,this.vu.setArray(this._uniforms[B],u)}setArray2(B,u){this._valueCache[B]=null,this.vu.setArray2(this._uniforms[B],u)}setArray3(B,u){this._valueCache[B]=null,this.vu.setArray3(this._uniforms[B],u)}setArray4(B,u){this._valueCache[B]=null,this.vu.setArray4(this._uniforms[B],u)}setMatrices(B,u){u&&(this._valueCache[B]=null,this.vu.setMatrices(this._uniforms[B],u))}setMatrix(B,u){this._cacheMatrix(B,u)&&(this.vu.setMatrices(this._uniforms[B],u.DR())||(this._valueCache[B]=null))}setMatrix3x3(B,u){this._valueCache[B]=null,this.vu.setMatrix3x3(this._uniforms[B],u)}setMatrix2x2(B,u){this._valueCache[B]=null,this.vu.setMatrix2x2(this._uniforms[B],u)}setFloat(B,u){const F=this._valueCache[B];void 0!==F&&F===u||this.vu.setFloat(this._uniforms[B],u)&&(this._valueCache[B]=u)}setVector2(B,u){this._cacheFloat2(B,u.x,u.y)&&(this.vu.setFloat2(this._uniforms[B],u.x,u.y)||(this._valueCache[B]=null))}setFloat2(B,u,F){this._cacheFloat2(B,u,F)&&(this.vu.setFloat2(this._uniforms[B],u,F)||(this._valueCache[B]=null))}setVector3(B,u){this._cacheFloat3(B,u.x,u.y,u.z)&&(this.vu.setFloat3(this._uniforms[B],u.x,u.y,u.z)||(this._valueCache[B]=null))}setFloat3(B,u,F,Z){this._cacheFloat3(B,u,F,Z)&&(this.vu.setFloat3(this._uniforms[B],u,F,Z)||(this._valueCache[B]=null))}setVector4(B,u){this._cacheFloat4(B,u.x,u.y,u.z,u.w)&&(this.vu.setFloat4(this._uniforms[B],u.x,u.y,u.z,u.w)||(this._valueCache[B]=null))}setQuaternion(B,u){this._cacheFloat4(B,u.x,u.y,u.z,u.w)&&(this.vu.setFloat4(this._uniforms[B],u.x,u.y,u.z,u.w)||(this._valueCache[B]=null))}setFloat4(B,u,F,Z,V){this._cacheFloat4(B,u,F,Z,V)&&(this.vu.setFloat4(this._uniforms[B],u,F,Z,V)||(this._valueCache[B]=null))}setColor3(B,u){this._cacheFloat3(B,u.r,u.g,u.b)&&(this.vu.setFloat3(this._uniforms[B],u.r,u.g,u.b)||(this._valueCache[B]=null))}setColor4(B,u,F){this._cacheFloat4(B,u.r,u.g,u.b,F)&&(this.vu.setFloat4(this._uniforms[B],u.r,u.g,u.b,F)||(this._valueCache[B]=null))}setDirectColor4(B,u){this._cacheFloat4(B,u.r,u.g,u.b,u.a)&&(this.vu.setFloat4(this._uniforms[B],u.r,u.g,u.b,u.a)||(this._valueCache[B]=null))}_getVertexShaderCode(){return this.vertexShader?this.vu._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.vu._getShaderSource(this.fragmentShader):null}}var V=F(12878);const p=new WeakMap,G={_webGLVersion:2,cachedPipelines:{}};function R(B){let u=p.get(B);if(!u){if(!B)return G;u={_webGLVersion:B.TEXTURE_BINDING_3D?2:1,_context:B,parallelShaderCompile:B.getExtension("KHR_parallel_shader_compile")||void 0,cachedPipelines:{}},p.set(B,u)}return u}function e(B){p.delete(B)}function s(B,u,F,Z,V,p){const G=R(Z);p||(p=G._createShaderProgramInjection??t);return p(B,W(u,"vertex",Z,G._contextWasLost),W(F,"fragment",Z,G._contextWasLost),Z,V,G.validateShaderPrograms)}function Y(B,u,F,Z,V){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,G=arguments.length>6?arguments[6]:void 0;const e=R(V);G||(G=e._createShaderProgramInjection??t);const s=e._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return G(B,q(u,"vertex",Z,s,V,e._contextWasLost),q(F,"fragment",Z,s,V,e._contextWasLost),V,p,e.validateShaderPrograms)}function Q(B,u){const F=new Z,V=R(B);return V.parallelShaderCompile&&!V.disableParallelShaderCompile&&(F.isParallelCompiled=!0),F.context=V._context,F}function t(B,u,F,Z){let V=arguments.length>5?arguments[5]:void 0;const p=Z.createProgram();if(B.program=p,!p)throw new Error("Unable to create program");return Z.attachShader(p,u),Z.attachShader(p,F),Z.linkProgram(p),B.context=Z,B.vertexShader=u,B.fragmentShader=F,B.isParallelCompiled||D(B,Z,V),p}function v(B,u,F){const Z=B;if(Z._isDisposed)return!1;const V=R(u);return!!(V&&V.parallelShaderCompile&&V.parallelShaderCompile.COMPLETION_STATUS_KHR&&Z.program&&u.getProgramParameter(Z.program,V.parallelShaderCompile.COMPLETION_STATUS_KHR))&&(D(Z,u,F),!0)}function D(B,u,F){const Z=B.context,V=B.vertexShader,p=B.fragmentShader,G=B.program;if(!Z.getProgramParameter(G,Z.LINK_STATUS)){if(!u.getShaderParameter(V,u.COMPILE_STATUS)){const F=u.getShaderInfoLog(V);if(F)throw B.vertexCompilationError=F,new Error("VERTEX SHADER "+F)}if(!u.getShaderParameter(p,u.COMPILE_STATUS)){const F=u.getShaderInfoLog(p);if(F)throw B.fragmentCompilationError=F,new Error("FRAGMENT SHADER "+F)}const F=Z.getProgramInfoLog(G);if(F)throw B.programLinkError=F,new Error(F)}if(F){Z.validateProgram(G);if(!Z.getProgramParameter(G,Z.VALIDATE_STATUS)){const u=Z.getProgramInfoLog(G);if(u)throw B.programValidationError=u,new Error(u)}}Z.deleteShader(V),Z.deleteShader(p),B.vertexShader=void 0,B.fragmentShader=void 0,B.onCompiled&&(B.onCompiled(),B.onCompiled=void 0)}function L(B,u,F,Z,V,p,G,e,Q){let t=arguments.length>10?arguments[10]:void 0,v=arguments.length>11?arguments[11]:void 0,D=arguments.length>12?arguments[12]:void 0;const L=R(B.context);v||(v=L.createRawShaderProgramInjection??s),D||(D=L.createShaderProgramInjection??Y);const q=B;q.program=Z?v(q,u,F,q.context,Q):D(q,u,F,e,q.context,Q),q.program.__SPECTOR_rebuildProgram=G,t()}function q(B,u,F,Z,p,G){return W((0,V.f)(B,F,Z),u,p,G)}function W(B,u,F,Z){const V=F.createShader("vertex"===u?F.VERTEX_SHADER:F.FRAGMENT_SHADER);if(!V){let B=F.NO_ERROR,V=F.NO_ERROR;for(;(V=F.getError())!==F.NO_ERROR;)B=V;throw new Error(`Something went wrong while creating a gl ${u} shader object. gl error=${B}, gl isContextLost=${F.isContextLost()}, _contextWasLost=${Z}`)}return F.shaderSource(V,B),F.compileShader(V),V}function X(B,u){u.useProgram(B)}function f(B,u){const F=B;if(!F.isParallelCompiled)return void u(B);const Z=F.onCompiled;F.onCompiled=()=>{null===Z||void 0===Z||Z(),u(B)}}},12903:(B,u,F)=>{F.d(u,{c:()=>Q,e:()=>v,i:()=>s,l:()=>Y});var Z=F(12816),V=F(12909),p=F(12897),G=F(12822),R=F(12874),e=F(12878);function s(B,u){return(0,V.G)(u).cachedPipelines[B]}function Y(B){const u=B._name,F=B.context;if(u&&F){const B=(0,V.G)(F),Z=B.cachedPipelines[u];null===Z||void 0===Z||Z.dispose(),delete B.cachedPipelines[u]}}function Q(B,u,F,V,p,G,e){let s,Y;const Q=(0,Z.j)()?null===G||void 0===G?void 0:G.getHostDocument():null;s="string"===typeof u?u:u.vertexSource?"source:"+u.vertexSource:u.vertexElement?(null===Q||void 0===Q?void 0:Q.getElementById(u.vertexElement))||u.vertexElement:u.vertex||u,Y="string"===typeof u?u:u.fragmentSource?"source:"+u.fragmentSource:u.fragmentElement?(null===Q||void 0===Q?void 0:Q.getElementById(u.fragmentElement))||u.fragmentElement:u.fragment||u;const v=[void 0,void 0],D=()=>{if(v[0]&&v[1]){B.isFragment=!0;const[Z,s]=v;(0,R.m)(s,B,((G,s)=>{e&&(e._fragmentSourceCodeBeforeMigration=s),F&&(G=F("fragment",G));const Y=(0,R.e)(Z,G,B);B=null;const Q=function(B,u,F,Z){if(F){return{vertexSourceCode:(1===Z?"//":"")+"#define SHADER_NAME vertex:"+(F.vertexElement||F.vertex||F.spectorName||F)+"\n"+B,fragmentSourceCode:(1===Z?"//":"")+"#define SHADER_NAME fragment:"+(F.fragmentElement||F.fragment||F.spectorName||F)+"\n"+u}}return{vertexSourceCode:B,fragmentSourceCode:u}}(Y.vertexCode,Y.fragmentCode,u,p);null===V||void 0===V||V(Q.vertexSourceCode,Q.fragmentSourceCode)}),G)}};t(s,"Vertex","",(u=>{(0,R.i)(B),(0,R.m)(u,B,((B,Z)=>{e&&(e._rawVertexSourceCode=u,e._vertexSourceCodeBeforeMigration=Z),F&&(B=F("vertex",B)),v[0]=B,D()}),G)}),p),t(Y,"Fragment","Pixel",(B=>{e&&(e._rawFragmentSourceCode=B),v[1]=B,D()}),p)}function t(B,u,F,V,G,R){if("undefined"!==typeof HTMLElement&&B instanceof HTMLElement){return void V((0,Z.c)(B))}if("source:"===B.substring(0,7))return void V(B.substring(7));if("base64:"===B.substring(0,7)){return void V(window.atob(B.substring(7)))}const s=p.c.GetShadersStore(G);if(s[B+u+"Shader"])return void V(s[B+u+"Shader"]);if(F&&s[B+F+"Shader"])return void V(s[B+F+"Shader"]);let Y;if(Y="."===B[0]||"/"===B[0]||B.indexOf("http")>-1?B:p.c.GetShadersRepository(G)+B,!(R=R||e.l))throw new Error("loadFileInjection is not defined");R(Y+"."+u.toLowerCase()+".fx",V)}const v=(B,u,F,Z)=>{try{const p=B.context?(0,V.G)(B.context):null;p&&(p.disableParallelShaderCompile=B.disableParallelCompilation);const G=B.existingPipelineContext||u(B.shaderProcessingContext);return G._name=B.name,B.name&&p&&(p.cachedPipelines[B.name]=G),F(G,B.vertex,B.fragment,!!B.createAsRaw,"","",B.rebuildRebind,B.defines,B.transformFeedbackVaryings,"",(()=>{Z(G,(()=>{var u;null===(u=B.onRenderingStateCompiled)||void 0===u||u.call(B,G)}))})),G}catch(p){throw G.d.Error("Error compiling effect"),p}}},12891:(B,u,F)=>{F.r(u),F.d(u,{Effect:()=>e});var Z=F(12807),V=F(12822),p=F(12897),G=F(12903),R=F(12882);class e{static get ShadersRepository(){return p.c.ShadersRepository}static set ShadersRepository(B){p.c.ShadersRepository=B}get G(){return this._isDisposed}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new Z.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(B,u,F){let V=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0,R=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Q=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,t=arguments.length>9?arguments[9]:void 0,v=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,L=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new Z.b,this.onErrorObservable=new Z.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._disableParallelShaderCompilation=!1,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=B,this._key=v;const q=this._key.replace(/\r/g,"").replace(/\n/g,"|");let W;if(u.attributes){const B=u;if(this._engine=F,this._attributesNames=B.attributes,this._uniformsNames=B.uniformsNames.concat(B.samplers),this._samplerList=B.samplers.slice(),this.defines=B.defines,this.onError=B.onError,this.onCompiled=B.onCompiled,this._fallbacks=B.fallbacks,this._indexParameters=B.indexParameters,this._transformFeedbackVaryings=B.transformFeedbackVaryings||null,this._multiTarget=!!B.multiTarget,this._shaderLanguage=B.shaderLanguage??0,this._disableParallelShaderCompilation=!!B.disableParallelShaderCompilation,B.uniformBuffersNames){this._uniformBuffersNamesList=B.uniformBuffersNames.slice();for(let u=0;u<B.uniformBuffersNames.length;u++)this._uniformBuffersNames[B.uniformBuffersNames[u]]=u}this._processFinalCode=B.processFinalCode??null,this._processCodeAfterIncludes=B.processCodeAfterIncludes??void 0,L=B.extraInitializationsAsync,W=B.existingPipelineContext}else this._engine=p,this.defines=null==R?"":R,this._uniformsNames=F.concat(V),this._samplerList=V?V.slice():[],this._attributesNames=u,this._uniformBuffersNamesList=[],this._shaderLanguage=D,this.onError=Q,this.onCompiled=Y,this._indexParameters=t,this._fallbacks=s;"WEBGL2"===this._engine.shaderPlatformName&&(W=(0,G.i)(q,this._engine._gl)??W),this._attributeLocationByName={},this.uniqueId=e._UniqueIdSeed++,W?(this._pipelineContext=W,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,L),this._engine.onReleaseEffectsObservable.addOnce((()=>{this.G||this.dispose(!0)}))}async _processShaderCodeAsync(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,Z=arguments.length>3?arguments[3]:void 0;Z&&await Z(),this._processingContext=F||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const V={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:B??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:p.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:p.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,G.c)(V,this.name,this._processFinalCode,((B,F)=>{this._vertexSourceCode=B,this._fragmentSourceCode=F,this._prepareEffect(u)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.G||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(B){return this._attributes[B]}getAttributeLocationByName(B){return this._attributeLocationByName[B]}getAttributesCount(){return this._attributes.length}getUniformIndex(B){return this._uniformsNames.indexOf(B)}getUniform(B){return this._uniforms[B]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}async whenCompiledAsync(){return await new Promise((B=>{this.executeWhenCompiled(B)}))}executeWhenCompiled(B){this.isReady()?B(this):(this.onCompileObservable.add((u=>{B(u)})),this._pipelineContext&&!this._pipelineContext.isAsync||this._checkIsReady(null))}_checkIsReady(B){(0,R.d)((()=>this._isReadyInternal()||this._isDisposed),(()=>{}),(u=>{this._processCompilationErrors(u,B)}),16,12e4,!0,` - Effect: ${"string"===typeof this.name?this.name:this.key}`)}get vertexSourceCode(){var B;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(B=this._pipelineContext)||void 0===B?void 0:B._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var B;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(B=this._pipelineContext)||void 0===B?void 0:B._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,o:this._engine.o,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(B,u,F,Z){this._isReady=!1,this._vertexSourceCodeOverride=B,this._fragmentSourceCodeOverride=u,this.onError=(B,u)=>{Z&&Z(u)},this.onCompiled=()=>{var B,u;const Z=this.getEngine().scenes;if(Z)for(let F=0;F<Z.length;F++)Z[F].markAllMaterialsAsDirty(127);null===(B=(u=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===B||B.call(u,F)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(B){if(this._pipelineContext=B,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let u=0;u<this._attributesNames.length;u++){const B=this._attributesNames[u];this._attributeLocationByName[B]=this._attributes[u]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),e.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=this._pipelineContext;this._isReady=!1;try{const F=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),Z=F?null:this.defines,V=F?this._vertexSourceCodeOverride:this._vertexSourceCode,p=F?this._fragmentSourceCodeOverride:this._fragmentSourceCode,R=this._engine;this._pipelineContext=(0,G.e)({existingPipelineContext:B?u:null,vertex:V,fragment:p,context:"WEBGL2"===R.shaderPlatformName||"WEBGL1"===R.shaderPlatformName?R._gl:void 0,rebuildRebind:(B,u,F,Z)=>this._rebuildProgram(B,u,F,Z),defines:Z,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:F,disableParallelCompilation:this._disableParallelShaderCompilation,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:F=>{u&&!B&&this._engine._deletePipelineContext(u),F&&this._onRenderingStateCompiled(F)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContextAsync.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(u)}catch(F){this._processCompilationErrors(F,u)}}_getShaderCodeAndErrorLine(B,u,F){const Z=F?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let V=null;if(u&&B){const p=u.match(Z);if(p&&2===p.length){const u=parseInt(p[1]),Z=B.split("\n",-1);Z.length>=u&&(V=`Offending line [${u}] in ${F?"fragment":"vertex"} code: ${Z[u-1]}`)}}return[B,V]}_processCompilationErrors(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=B.message;const F=this._attributesNames,Z=this._fallbacks;if(V.d.Error("Unable to compile effect:"),V.d.Error(`Uniforms: ${this._uniformsNames.join(" ")}`),V.d.Error(`Attributes: ${F.join(" ")}`),V.d.Error("Defines:\n"+this.defines),e.LogShaderCodeOnCompilationError){var p,G;let B=null,u=null,F=null;var R;if(null!==(p=this._pipelineContext)&&void 0!==p&&p._getVertexShaderCode()&&([F,B]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),F&&(V.d.Error("Vertex code:"),V.d.Error(F))),null!==(G=this._pipelineContext)&&void 0!==G&&G._getFragmentShaderCode())[F,u]=this._getShaderCodeAndErrorLine(null===(R=this._pipelineContext)||void 0===R?void 0:R._getFragmentShaderCode(),this._compilationError,!0),F&&(V.d.Error("Fragment code:"),V.d.Error(F));B&&V.d.Error(B),u&&V.d.Error(u)}V.d.Error("Error: "+this._compilationError);const s=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this._engine.onEffectErrorObservable.notifyObservers({effect:this,errors:this._compilationError})};u&&(this._pipelineContext=u,this._isReady=!0,s()),Z?(this._pipelineContext=null,Z.hasMoreFallbacks?(this._allFallbacksProcessed=!1,V.d.Error("Trying next fallback."),this.defines=Z.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,s(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,u||s())}get isSupported(){return""===this._compilationError}_bindTexture(B,u){this._engine._bindTexture(this._samplers[B],u,B)}setTexture(B,u){this._engine.setTexture(this._samplers[B],this._uniforms[B],u,B)}setTextureArray(B,u){const F=B+"Ex";if(-1===this._samplerList.indexOf(F+"0")){const Z=this._samplerList.indexOf(B);for(let B=1;B<u.length;B++){const u=F+(B-1).toString();this._samplerList.splice(Z+B,0,u)}let V=0;for(const B of this._samplerList)this._samplers[B]=V,V+=1}this._engine.setTextureArray(this._samplers[B],this._uniforms[B],u,B)}bindUniformBuffer(B,u){const F=this._uniformBuffersNames[u];void 0===F||e._BaseCache[F]===B&&this._engine._features.useUBOBindingCache||(e._BaseCache[F]=B,this._engine.bindUniformBufferBase(B,F,u))}bindUniformBlock(B,u){this._engine.bindUniformBlock(this._pipelineContext,B,u)}setInt(B,u){return this._pipelineContext.setInt(B,u),this}setInt2(B,u,F){return this._pipelineContext.setInt2(B,u,F),this}setInt3(B,u,F,Z){return this._pipelineContext.setInt3(B,u,F,Z),this}setInt4(B,u,F,Z,V){return this._pipelineContext.setInt4(B,u,F,Z,V),this}setIntArray(B,u){return this._pipelineContext.setIntArray(B,u),this}setIntArray2(B,u){return this._pipelineContext.setIntArray2(B,u),this}setIntArray3(B,u){return this._pipelineContext.setIntArray3(B,u),this}setIntArray4(B,u){return this._pipelineContext.setIntArray4(B,u),this}setUInt(B,u){return this._pipelineContext.setUInt(B,u),this}setUInt2(B,u,F){return this._pipelineContext.setUInt2(B,u,F),this}setUInt3(B,u,F,Z){return this._pipelineContext.setUInt3(B,u,F,Z),this}setUInt4(B,u,F,Z,V){return this._pipelineContext.setUInt4(B,u,F,Z,V),this}setUIntArray(B,u){return this._pipelineContext.setUIntArray(B,u),this}setUIntArray2(B,u){return this._pipelineContext.setUIntArray2(B,u),this}setUIntArray3(B,u){return this._pipelineContext.setUIntArray3(B,u),this}setUIntArray4(B,u){return this._pipelineContext.setUIntArray4(B,u),this}setFloatArray(B,u){return this._pipelineContext.setArray(B,u),this}setFloatArray2(B,u){return this._pipelineContext.setArray2(B,u),this}setFloatArray3(B,u){return this._pipelineContext.setArray3(B,u),this}setFloatArray4(B,u){return this._pipelineContext.setArray4(B,u),this}setArray(B,u){return this._pipelineContext.setArray(B,u),this}setArray2(B,u){return this._pipelineContext.setArray2(B,u),this}setArray3(B,u){return this._pipelineContext.setArray3(B,u),this}setArray4(B,u){return this._pipelineContext.setArray4(B,u),this}setMatrices(B,u){return this._pipelineContext.setMatrices(B,u),this}setMatrix(B,u){return this._pipelineContext.setMatrix(B,u),this}setMatrix3x3(B,u){return this._pipelineContext.setMatrix3x3(B,u),this}setMatrix2x2(B,u){return this._pipelineContext.setMatrix2x2(B,u),this}setFloat(B,u){return this._pipelineContext.setFloat(B,u),this}setBool(B,u){return this._pipelineContext.setInt(B,u?1:0),this}setVector2(B,u){return this._pipelineContext.setVector2(B,u),this}setFloat2(B,u,F){return this._pipelineContext.setFloat2(B,u,F),this}setVector3(B,u){return this._pipelineContext.setVector3(B,u),this}setFloat3(B,u,F,Z){return this._pipelineContext.setFloat3(B,u,F,Z),this}setVector4(B,u){return this._pipelineContext.setVector4(B,u),this}setQuaternion(B,u){return this._pipelineContext.setQuaternion(B,u),this}setFloat4(B,u,F,Z,V){return this._pipelineContext.setFloat4(B,u,F,Z,V),this}setColor3(B,u){return this._pipelineContext.setColor3(B,u),this}setColor4(B,u,F){return this._pipelineContext.setColor4(B,u,F),this}setDirectColor4(B,u){return this._pipelineContext.setDirectColor4(B,u),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])this._refCount=0;else{if(e.PersistentMode)return;this._refCount--}this._refCount>0||this._isDisposed||(this._pipelineContext&&(0,G.l)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;u&&(p.c.GetShadersStore(Z)[`${B}PixelShader`]=u),F&&(p.c.GetShadersStore(Z)[`${B}VertexShader`]=F)}static ResetCache(){e._BaseCache={}}}e.LogShaderCodeOnCompilationError=!0,e.PersistentMode=!1,e.AutomaticallyClearCodeCache=!1,e._UniqueIdSeed=0,e._BaseCache={},e.ShadersStore=p.c.ShadersStore,e.IncludesShadersStore=p.c.IncludesShadersStore},12843:(B,u,F)=>{F.d(u,{e:()=>V});const Z={};function V(B){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!Z[B])return Z[B]=!0,`${B} needs to be imported before as it contains a side-effect required by your code.`}},12816:(B,u,F)=>{function Z(){return"undefined"!==typeof window}function V(){return"undefined"!==typeof navigator}function p(){return"undefined"!==typeof document}function G(B){let u="",F=B.firstChild;for(;F;)3===F.nodeType&&(u+=F.textContent),F=F.nextSibling;return u}F.d(u,{c:()=>G,g:()=>p,h:()=>V,j:()=>Z})},12822:(B,u,F)=>{F.d(u,{d:()=>Z});class Z{static _CheckLimit(B,u){let F=Z._LogLimitOutputs[B];return F?F.current++:(F={limit:u,current:1},Z._LogLimitOutputs[B]=F),F.current<=F.limit}static _GenerateLimitMessage(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const F=Z._LogLimitOutputs[B];if(!F||!Z.MessageLimitReached)return;const V=this._Levels[u];F.current===F.limit&&Z[V.name](Z.MessageLimitReached.replace(/%LIMIT%/g,""+F.limit).replace(/%TYPE%/g,V.name??""))}static _AddLogEntry(B){Z._LogCache=B+Z._LogCache,Z.OnNewCacheEntry&&Z.OnNewCacheEntry(B)}static _FormatMessage(B){const u=B=>B<10?"0"+B:""+B,F=new Date;return"["+u(F.getHours())+":"+u(F.getMinutes())+":"+u(F.getSeconds())+"]: "+B}static _LogDisabled(B,u){}static _LogEnabled(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,u=arguments.length>1?arguments[1]:void 0,F=arguments.length>2?arguments[2]:void 0;const V=Array.isArray(u)?u[0]:u;if(void 0!==F&&!Z._CheckLimit(V,F))return;const p=Z._FormatMessage(V),G=this._Levels[B],R=Array.isArray(u)?u.slice(1):[];G.logFunc&&G.logFunc("BJS - "+p,...R);const e=`<div style='color:${G.color}'>${p}</div><br>`;Z._AddLogEntry(e),Z._GenerateLimitMessage(V,B)}static get LogCache(){return Z._LogCache}static ClearLogCache(){Z._LogCache="",Z._LogLimitOutputs={},Z.errorsCount=0}static set LogLevels(B){Z.Log=Z._LogDisabled,Z.Warn=Z._LogDisabled,Z.Error=Z._LogDisabled;const u=[Z.MessageLogLevel,Z.WarningLogLevel,Z.ErrorLogLevel];for(const F of u)if((B&F)===F){const B=this._Levels[F];Z[B.name]=Z._LogEnabled.bind(Z,F)}}}Z.NoneLogLevel=0,Z.MessageLogLevel=1,Z.WarningLogLevel=2,Z.ErrorLogLevel=4,Z.AllLogLevel=7,Z.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",Z._LogCache="",Z._LogLimitOutputs={},Z._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],Z.errorsCount=0,Z.Log=Z._LogEnabled.bind(Z,Z.MessageLogLevel),Z.Warn=Z._LogEnabled.bind(Z,Z.WarningLogLevel),Z.Error=Z._LogEnabled.bind(Z,Z.ErrorLogLevel)},12807:(B,u,F)=>{F.d(u,{b:()=>G});const Z="undefined"!==typeof WeakRef;class V{constructor(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;this.initialize(B,u,F,Z)}initialize(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1],F=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0;return this.mask=B,this.skipNextObservers=u,this.target=F,this.currentTarget=Z,this}}class p{constructor(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=B,this.mask=u,this.scope=F,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._remove&&this._remove(B)}}class G{static FromPromise(B,u){const F=new G;return B.then((B=>{F.notifyObservers(B)})).catch((B=>{if(!u)throw B;u.notifyObservers(B)})),F}get observers(){return this._observers}constructor(B){let u=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=u,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new V(0),B&&(this._onObserverAdded=B)}add(B){let u=arguments.length>2&&void 0!==arguments[2]&&arguments[2],F=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!B)return null;const V=new p(B,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);V.unregisterOnNextCall=F,u?this._observers.unshift(V):this._observers.push(V),this._onObserverAdded&&this._onObserverAdded(V),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(V,this._lastNotifiedValue);const G=Z?new WeakRef(this):{deref:()=>this};return V._remove=function(){let B=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const u=G.deref();u&&(B?u.remove(V):u._remove(V))},V}addOnce(B){return this.add(B,void 0,void 0,void 0,!0)}remove(B){if(!B)return!1;B._remove=null;return-1!==this._observers.indexOf(B)&&(this._deferUnregister(B),!0)}removeCallback(B,u){for(let F=0;F<this._observers.length;F++){const Z=this._observers[F];if(!Z._willBeUnregistered&&(Z.callback===B&&(!u||u===Z.scope)))return this._deferUnregister(Z),!0}return!1}_deferUnregister(B){B._willBeUnregistered||(this._numObserversMarkedAsDeleted++,B.unregisterOnNextCall=!1,B._willBeUnregistered=!0,setTimeout((()=>{this._remove(B)}),0))}_remove(B){let u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!B)return!1;const F=this._observers.indexOf(B);return-1!==F&&(u&&this._numObserversMarkedAsDeleted--,this._observers.splice(F,1),!0)}makeObserverTopPriority(B){this._remove(B,!1),this._observers.unshift(B)}makeObserverBottomPriority(B){this._remove(B,!1),this._observers.push(B)}notifyObservers(B){let u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,F=arguments.length>2?arguments[2]:void 0,Z=arguments.length>3?arguments[3]:void 0,V=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=B),!this._observers.length)return!0;const p=this._eventState;p.mask=u,p.target=F,p.currentTarget=Z,p.skipNextObservers=!1,p.lastReturnValue=B,p.userInfo=V;for(const G of this._observers)if(!G._willBeUnregistered&&(G.mask&u&&(G.unregisterOnNextCall&&this._deferUnregister(G),G.scope?p.lastReturnValue=G.callback.apply(G.scope,[B,p]):p.lastReturnValue=G.callback(B,p)),p.skipNextObservers))return!1;return!0}notifyObserver(B,u){let F=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=u),B._willBeUnregistered)return;const Z=this._eventState;Z.mask=F,Z.skipNextObservers=!1,B.unregisterOnNextCall&&this._deferUnregister(B),B.callback(u,Z)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const B=this._observers.pop();B&&(B._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const B=new G;return B._observers=this._observers.slice(0),B}hasSpecificMask(){let B=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const u of this._observers)if(u.mask&B||u.mask===B)return!0;return!1}}},12882:(B,u,F)=>{F.d(u,{b:()=>V,d:()=>G});let Z=[];class V{static SetImmediate(B){0===Z.length&&setTimeout((()=>{const B=Z;Z=[];for(const u of B)u()}),1),Z.push(B)}}function p(B,u,F){try{if(B())return u(),!0}catch(Z){return null===F||void 0===F||F(Z),!0}return!1}const G=function(B,u,F){let Z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16,V=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3e4,G=arguments.length>6?arguments[6]:void 0;if((!(arguments.length>5&&void 0!==arguments[5])||arguments[5])&&p(B,u,F))return null;const R=setInterval((()=>{p(B,u,F)?clearInterval(R):(V-=Z,V<0&&(clearInterval(R),null===F||void 0===F||F(new Error("Operation timed out after maximum retries. "+(G||"")),!0)))}),Z);return()=>clearInterval(R)}}}]);