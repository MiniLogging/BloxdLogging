/*! For license information please see nrkk14.9.0dbdc449.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10646:function(d,t){!function(d){"use strict";var t=function(d,A){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,t){d.__proto__=t}||function(d,t){for(var A in t)Object.prototype.hasOwnProperty.call(t,A)&&(d[A]=t[A])},t(d,A)};function A(d,A){if("function"!==typeof A&&null!==A)throw new TypeError("Class extends value "+String(A)+" is not a constructor or null");function w(){this.constructor=d}t(d,A),d.prototype=null===A?Object.create(A):(w.prototype=A.prototype,new w)}function w(d,t,A,w){var N,p=arguments.length,B=p<3?t:null===w?w=Object.getOwnPropertyDescriptor(t,A):w;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)B=Reflect.decorate(d,t,A,w);else for(var X=d.length-1;X>=0;X--)(N=d[X])&&(B=(p<3?N(B):p>3?N(t,A,B):N(t,A))||B);return p>3&&B&&Object.defineProperty(t,A,B),B}function N(d,t,A){if(A||2===arguments.length)for(var w,N=0,p=t.length;N<p;N++)!w&&N in t||(w||(w=Array.prototype.slice.call(t,0,N)),w[N]=t[N]);return d.concat(w||Array.prototype.slice.call(t))}var p,B=255,X=213;d.OPERATION=void 0,(p=d.OPERATION||(d.OPERATION={}))[p.ADD=128]="ADD",p[p.REPLACE=0]="REPLACE",p[p.DELETE=64]="DELETE",p[p.DELETE_AND_ADD=192]="DELETE_AND_ADD",p[p.TOUCH=1]="TOUCH",p[p.CLEAR=10]="CLEAR";var W=function(){function t(d,t,A){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=d,this.setParent(t,A)}return t.prototype.setParent=function(d,t,A){var w=this;if(this.indexes||(this.indexes=this.ref instanceof ud?this.ref._definition.indexes:{}),this.parent=d,this.parentIndex=A,t)if(this.root=t,this.ref instanceof ud){var N=this.ref._definition;for(var p in N.schema){var B=this.ref[p];if(B&&B.$changes){var X=N.indexes[p];B.$changes.setParent(this.ref,t,X)}}}else"object"===typeof this.ref&&this.ref.forEach((function(d,t){if(d instanceof ud){var A=d.$changes,N=w.ref.$changes.indexes[t];A.setParent(w.ref,w.root,N)}}))},t.prototype.operation=function(d){this.changes.set(--this.currentCustomOperation,d)},t.prototype.change=function(t,A){void 0===A&&(A=d.OPERATION.ADD);var w="number"===typeof t?t:this.indexes[t];this.assertValidIndex(w,t);var N=this.changes.get(w);N&&N.op!==d.OPERATION.DELETE&&N.op!==d.OPERATION.TOUCH||this.changes.set(w,{op:N&&N.op===d.OPERATION.DELETE?d.OPERATION.DELETE_AND_ADD:A,index:w}),this.allChanges.add(w),this.changed=!0,this.touchParents()},t.prototype.touch=function(t){var A="number"===typeof t?t:this.indexes[t];this.assertValidIndex(A,t),this.changes.has(A)||this.changes.set(A,{op:d.OPERATION.TOUCH,index:A}),this.allChanges.add(A),this.touchParents()},t.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},t.prototype.getType=function(d){if(this.ref._definition)return(t=this.ref._definition).schema[t.fieldsByIndex[d]];var t,A=(t=this.parent._definition).schema[t.fieldsByIndex[this.parentIndex]];return Object.values(A)[0]},t.prototype.getChildrenFilter=function(){var d=this.parent._definition.childFilters;return d&&d[this.parentIndex]},t.prototype.getValue=function(d){return this.ref.getByIndex(d)},t.prototype.delete=function(t){var A="number"===typeof t?t:this.indexes[t];if(void 0!==A){var w=this.getValue(A);this.changes.set(A,{op:d.OPERATION.DELETE,index:A}),this.allChanges.delete(A),delete this.caches[A],w&&w.$changes&&(w.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(t," (").concat(A,")"))},t.prototype.discard=function(t,A){var w=this;void 0===t&&(t=!1),void 0===A&&(A=!1),this.ref instanceof ud||this.changes.forEach((function(t){if(t.op===d.OPERATION.DELETE){var A=w.ref.getIndex(t.index);delete w.indexes[A]}})),this.changes.clear(),this.changed=t,A&&this.allChanges.clear(),this.currentCustomOperation=0},t.prototype.discardAll=function(){var d=this;this.changes.forEach((function(t){var A=d.getValue(t.index);A&&A.$changes&&A.$changes.discardAll()})),this.discard()},t.prototype.cache=function(d,t){this.caches[d]=t},t.prototype.clone=function(){return new t(this.ref,this.parent,this.root)},t.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},t.prototype.assertValidIndex=function(d,t){if(void 0===d)throw new Error('ChangeTree: missing index for field "'.concat(t,'"'))},t}();function a(d,t,A,w){return d[t]||(d[t]=[]),d[t].push(A),null===w||void 0===w||w.forEach((function(d,t){return A(d,t)})),function(){return i(d[t],d[t].indexOf(A))}}function D(t){var A=this,w="string"!==typeof this.$changes.getType();this.$items.forEach((function(N,p){t.push({refId:A.$changes.refId,op:d.OPERATION.DELETE,field:p,value:void 0,previousValue:N}),w&&A.$changes.root.removeRef(N.$changes.refId)}))}function i(d,t){if(-1===t||t>=d.length)return!1;for(var A=d.length-1,w=t;w<A;w++)d[w]=d[w+1];return d.length=A,!0}var k=function(d,t){var A=d.toString(),w=t.toString();return A<w?-1:A>w?1:0};function b(d){return d.$proxy=!0,d=new Proxy(d,{get:function(d,t){return"symbol"===typeof t||isNaN(t)?d[t]:d.at(t)},set:function(d,t,A){if("symbol"===typeof t||isNaN(t))d[t]=A;else{var w=Array.from(d.$items.keys()),N=parseInt(w[t]||t);void 0===A||null===A?d.deleteAt(N):d.setAt(N,A)}return!0},deleteProperty:function(d,t){return"number"===typeof t?d.deleteAt(t):delete d[t],!0}})}var Q=function(){function t(){for(var d=[],t=0;t<arguments.length;t++)d[t]=arguments[t];this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,d)}return t.prototype.Ge=function(t,A){return void 0===A&&(A=!0),a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.ADD,t,A?this.$items:void 0)},t.prototype.bb=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.REPLACE,t)},t.is=function(d){return Array.isArray(d)||void 0!==d.array},Object.defineProperty(t.prototype,"length",{get:function(){return this.$items.size},set:function(d){0===d?this.clear():this.splice(d,this.length-d)},enumerable:!1,configurable:!0}),t.prototype.push=function(){for(var d,t=this,A=[],w=0;w<arguments.length;w++)A[w]=arguments[w];return A.forEach((function(A){d=t.$refId++,t.setAt(d,A)})),d},t.prototype.pop=function(){var d=Array.from(this.$indexes.values()).pop();if(void 0!==d){this.$changes.delete(d),this.$indexes.delete(d);var t=this.$items.get(d);return this.$items.delete(d),t}},t.prototype.at=function(d){var t=Array.from(this.$items.keys())[d];return this.$items.get(t)},t.prototype.setAt=function(t,A){var w,N;if(void 0!==A&&null!==A){if(this.$items.get(t)!==A){void 0!==A.$changes&&A.$changes.setParent(this,this.$changes.root,t);var p=null!==(N=null===(w=this.$changes.indexes[t])||void 0===w?void 0:w.op)&&void 0!==N?N:d.OPERATION.ADD;this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,A),this.$changes.change(t,p)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},t.prototype.deleteAt=function(d){var t=Array.from(this.$items.keys())[d];return void 0!==t&&this.$deleteAt(t)},t.prototype.$deleteAt=function(d){return this.$changes.delete(d),this.$indexes.delete(d),this.$items.delete(d)},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&D.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:d.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.concat=function(){for(var d,A=[],w=0;w<arguments.length;w++)A[w]=arguments[w];return new(t.bind.apply(t,N([void 0],(d=Array.from(this.$items.values())).concat.apply(d,A),!1)))},t.prototype.join=function(d){return Array.from(this.$items.values()).join(d)},t.prototype.reverse=function(){var d=this,t=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(A,w){d.setAt(t[w],A)})),this},t.prototype.shift=function(){var d=Array.from(this.$items.keys()).shift();if(void 0!==d){var t=this.$items.get(d);return this.$deleteAt(d),t}},t.prototype.slice=function(d,A){var w=new t;return w.push.apply(w,Array.from(this.$items.values()).slice(d,A)),w},t.prototype.sort=function(d){var t=this;void 0===d&&(d=k);var A=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(d).forEach((function(d,w){t.setAt(A[w],d)})),this},t.prototype.splice=function(d,t){void 0===t&&(t=this.length-d);for(var A=Array.from(this.$items.keys()),w=[],N=d;N<d+t;N++)w.push(this.$items.get(A[N])),this.$deleteAt(A[N]);return w},t.prototype.unshift=function(){for(var d=this,t=[],A=0;A<arguments.length;A++)t[A]=arguments[A];var w=this.length,N=t.length,p=Array.from(this.$items.values());return t.forEach((function(t,A){d.setAt(A,t)})),p.forEach((function(t,A){d.setAt(N+A,t)})),w+N},t.prototype.indexOf=function(d,t){return Array.from(this.$items.values()).indexOf(d,t)},t.prototype.lastIndexOf=function(d,t){return void 0===t&&(t=this.length-1),Array.from(this.$items.values()).lastIndexOf(d,t)},t.prototype.every=function(d,t){return Array.from(this.$items.values()).every(d,t)},t.prototype.some=function(d,t){return Array.from(this.$items.values()).some(d,t)},t.prototype.forEach=function(d,t){Array.from(this.$items.values()).forEach(d,t)},t.prototype.map=function(d,t){return Array.from(this.$items.values()).map(d,t)},t.prototype.filter=function(d,t){return Array.from(this.$items.values()).filter(d,t)},t.prototype.reduce=function(d,t){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},t.prototype.reduceRight=function(d,t){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},t.prototype.find=function(d,t){return Array.from(this.$items.values()).find(d,t)},t.prototype.findIndex=function(d,t){return Array.from(this.$items.values()).findIndex(d,t)},t.prototype.fill=function(d,t,A){throw new Error("ArraySchema#fill() not implemented")},t.prototype.copyWithin=function(d,t,A){throw new Error("ArraySchema#copyWithin() not implemented")},t.prototype.toString=function(){return this.$items.toString()},t.prototype.toLocaleString=function(){return this.$items.toLocaleString()},t.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},t.prototype.includes=function(d,t){return Array.from(this.$items.values()).includes(d,t)},t.prototype.flatMap=function(d,t){throw new Error("ArraySchema#flatMap() is not supported.")},t.prototype.flat=function(d){throw new Error("ArraySchema#flat() is not supported.")},t.prototype.findLast=function(){var d=Array.from(this.$items.values());return d.findLast.apply(d,arguments)},t.prototype.findLastIndex=function(){var d=Array.from(this.$items.values());return d.findLastIndex.apply(d,arguments)},t.prototype.setIndex=function(d,t){this.$indexes.set(d,t)},t.prototype.getIndex=function(d){return this.$indexes.get(d)},t.prototype.getByIndex=function(d){return this.$items.get(this.$indexes.get(d))},t.prototype.deleteByIndex=function(d){var t=this.$indexes.get(d);this.$items.delete(t),this.$indexes.delete(d)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){return this.toArray().map((function(d){return"function"===typeof d.toJSON?d.toJSON():d}))},t.prototype.clone=function(d){return d?new(t.bind.apply(t,N([void 0],Array.from(this.$items.values()),!1))):new(t.bind.apply(t,N([void 0],this.map((function(d){return d.$changes?d.clone():d})),!1)))},t}();function P(d){return d.$proxy=!0,d=new Proxy(d,{get:function(d,t){return"symbol"!==typeof t&&"undefined"===typeof d[t]?d.get(t):d[t]},set:function(d,t,A){return"symbol"!==typeof t&&-1===t.indexOf("$")&&"Ge"!==t&&"bb"!==t&&"onChange"!==t?d.set(t,A):d[t]=A,!0},deleteProperty:function(d,t){return d.delete(t),!0}})}var J=function(){function t(d){var A=this;if(this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,d)if(d instanceof Map||d instanceof t)d.forEach((function(d,t){return A.set(t,d)}));else for(var w in d)this.set(w,d[w])}return t.prototype.Ge=function(t,A){return void 0===A&&(A=!0),a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.ADD,t,A?this.$items:void 0)},t.prototype.bb=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.REPLACE,t)},t.is=function(d){return void 0!==d.map},t.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(t.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(t,Symbol.species,{get:function(){return t},enumerable:!1,configurable:!0}),t.prototype.set=function(t,A){if(void 0===A||null===A)throw new Error("MapSchema#set('".concat(t,"', ").concat(A,"): trying to set ").concat(A," value on '").concat(t,"'."));t=t.toString();var w="undefined"!==typeof this.$changes.indexes[t],N=w?this.$changes.indexes[t]:this.$refId++,p=w?d.OPERATION.REPLACE:d.OPERATION.ADD,B=void 0!==A.$changes;if(B&&A.$changes.setParent(this,this.$changes.root,N),w){if(!B&&this.$items.get(t)===A)return;B&&this.$items.get(t)!==A&&(p=d.OPERATION.ADD)}else this.$changes.indexes[t]=N,this.$indexes.set(N,t);return this.$items.set(t,A),this.$changes.change(t,p),this},t.prototype.get=function(d){return this.$items.get(d)},t.prototype.delete=function(d){return this.$changes.delete(d),this.$items.delete(d)},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&D.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:d.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(d){return this.$items.has(d)},t.prototype.forEach=function(d){this.$items.forEach(d)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.keys=function(){return this.$items.keys()},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(d,t){this.$indexes.set(d,t)},t.prototype.getIndex=function(d){return this.$indexes.get(d)},t.prototype.getByIndex=function(d){return this.$items.get(this.$indexes.get(d))},t.prototype.deleteByIndex=function(d){var t=this.$indexes.get(d);this.$items.delete(t),this.$indexes.delete(d)},t.prototype.toJSON=function(){var d={};return this.forEach((function(t,A){d[A]="function"===typeof t.toJSON?t.toJSON():t})),d},t.prototype.clone=function(d){var A;return d?A=Object.assign(new t,this):(A=new t,this.forEach((function(d,t){d.$changes?A.set(t,d.clone()):A.set(t,d)}))),A},t}(),U={};function T(d,t){U[d]=t}function F(d){return U[d]}var q=function(){function d(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return d.create=function(t){var A=new d;return A.schema=Object.assign({},t&&t.schema||{}),A.indexes=Object.assign({},t&&t.indexes||{}),A.fieldsByIndex=Object.assign({},t&&t.fieldsByIndex||{}),A.descriptors=Object.assign({},t&&t.descriptors||{}),A.deprecated=Object.assign({},t&&t.deprecated||{}),A},d.prototype.addField=function(d,t){var A=this.getNextFieldIndex();this.fieldsByIndex[A]=d,this.indexes[d]=A,this.schema[d]=Array.isArray(t)?{array:t[0]}:t},d.prototype.hasField=function(d){return void 0!==this.indexes[d]},d.prototype.addFilter=function(d,t){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[d]]=t,this.indexesWithFilters.push(this.indexes[d]),!0},d.prototype.addChildrenFilter=function(d,t){var A=this.indexes[d],w=this.schema[d];if(F(Object.keys(w)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[A]=t,!0;console.warn("@filterChildren: field '".concat(d,"' can't have children. Ignoring filter."))},d.prototype.getChildrenFilter=function(d){return this.childFilters&&this.childFilters[this.indexes[d]]},d.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},d}();function H(d){return d._context&&d._context.useFilters}var f=function(){function d(){this.types={},this.schemas=new Map,this.useFilters=!1}return d.prototype.has=function(d){return this.schemas.has(d)},d.prototype.get=function(d){return this.types[d]},d.prototype.add=function(d,t){void 0===t&&(t=this.schemas.size),d._definition=q.create(d._definition),d._typeid=t,this.types[t]=d,this.schemas.set(d,t)},d.create=function(t){return void 0===t&&(t={}),function(A){return t.context||(t.context=new d),m(A,t)}},d}(),v=new f;function m(d,t){return void 0===t&&(t={}),function(A,w){var p=t.context||v,B=A.constructor;if(B._context=p,!d)throw new Error("".concat(B.name,': @type() reference provided for "').concat(w,"\" is undefined. Make sure you don't have any circular dependencies."));p.has(B)||p.add(B);var X=B._definition;if(X.addField(w,d),X.descriptors[w]){if(X.deprecated[w])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(w,"' definition on '").concat(B.name,"'.\nCheck @type() annotation"))}catch(U){var W=U.stack.split("\n")[4].trim();throw new Error("".concat(U.message," ").concat(W))}}var a=Q.is(d),D=!a&&J.is(d);if("string"!==typeof d&&!ud.is(d)){var i=Object.values(d)[0];"string"===typeof i||p.has(i)||p.add(i)}if(t.manual)X.descriptors[w]={enumerable:!0,configurable:!0,writable:!0};else{var k="_".concat(w);X.descriptors[k]={enumerable:!1,configurable:!1,writable:!0},X.descriptors[w]={get:function(){return this[k]},set:function(d){d!==this[k]&&(void 0!==d&&null!==d?(!a||d instanceof Q||(d=new(Q.bind.apply(Q,N([void 0],d,!1)))),!D||d instanceof J||(d=new J(d)),void 0===d.$proxy&&(D?d=P(d):a&&(d=b(d))),this.$changes.change(w),d.$changes&&d.$changes.setParent(this,this.$changes.root,this._definition.indexes[w])):this[k]&&this.$changes.delete(w),this[k]=d)},enumerable:!0,configurable:!0}}}}function j(d){return function(t,A){var w=t.constructor;w._definition.addFilter(A,d)&&(w._context.useFilters=!0)}}function n(d){return function(t,A){var w=t.constructor;w._definition.addChildrenFilter(A,d)&&(w._context.useFilters=!0)}}function R(d){return void 0===d&&(d=!0),function(t,A){var w=t.constructor._definition;w.deprecated[A]=!0,d&&(w.descriptors[A]={get:function(){throw new Error("".concat(A," is deprecated."))},set:function(d){},enumerable:!1,configurable:!0})}}function Z(d,t,A){for(var w in void 0===A&&(A={}),A.context||(A.context=d._context||A.context||v),t)m(t[w],A)(d.prototype,w);return d}function L(d){for(var t=0,A=0,w=0,N=d.length;w<N;w++)(t=d.charCodeAt(w))<128?A+=1:t<2048?A+=2:t<55296||t>=57344?A+=3:(w++,A+=4);return A}function I(d,t,A){for(var w=0,N=0,p=A.length;N<p;N++)(w=A.charCodeAt(N))<128?d[t++]=w:w<2048?(d[t++]=192|w>>6,d[t++]=128|63&w):w<55296||w>=57344?(d[t++]=224|w>>12,d[t++]=128|w>>6&63,d[t++]=128|63&w):(N++,w=65536+((1023&w)<<10|1023&A.charCodeAt(N)),d[t++]=240|w>>18,d[t++]=128|w>>12&63,d[t++]=128|w>>6&63,d[t++]=128|63&w)}function u(d,t){d.push(255&t)}function V(d,t){d.push(255&t)}function h(d,t){d.push(255&t),d.push(t>>8&255)}function l(d,t){d.push(255&t),d.push(t>>8&255)}function y(d,t){d.push(255&t),d.push(t>>8&255),d.push(t>>16&255),d.push(t>>24&255)}function s(d,t){var A=t>>24,w=t>>16,N=t>>8,p=t;d.push(255&p),d.push(255&N),d.push(255&w),d.push(255&A)}function Y(d,t){var A=Math.floor(t/Math.pow(2,32));s(d,t>>>0),s(d,A)}function r(d,t){var A=t/Math.pow(2,32)|0;s(d,t>>>0),s(d,A)}function K(d,t){e(d,t)}function G(d,t){M(d,t)}var O=new Int32Array(2),z=new Float32Array(O.buffer),c=new Float64Array(O.buffer);function e(d,t){z[0]=t,y(d,O[0])}function M(d,t){c[0]=t,y(d,O[0]),y(d,O[1])}function x(d,t){return V(d,t?1:0)}function o(d,t){t||(t="");var A=L(t),w=0;if(A<32)d.push(160|A),w=1;else if(A<256)d.push(217),V(d,A),w=2;else if(A<65536)d.push(218),l(d,A),w=3;else{if(!(A<4294967296))throw new Error("String too long");d.push(219),s(d,A),w=5}return I(d,d.length,t),w+A}function C(d,t){return isNaN(t)?C(d,0):isFinite(t)?t!==(0|t)?(d.push(203),M(d,t),9):t>=0?t<128?(V(d,t),1):t<256?(d.push(204),V(d,t),2):t<65536?(d.push(205),l(d,t),3):t<4294967296?(d.push(206),s(d,t),5):(d.push(207),r(d,t),9):t>=-32?(d.push(224|t+32),1):t>=-128?(d.push(208),u(d,t),2):t>=-32768?(d.push(209),h(d,t),3):t>=-2147483648?(d.push(210),y(d,t),5):(d.push(211),Y(d,t),9):C(d,t>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var E=Object.freeze({__proto__:null,utf8Write:I,int8:u,uint8:V,int16:h,uint16:l,int32:y,uint32:s,int64:Y,uint64:r,float32:K,float64:G,writeFloat32:e,writeFloat64:M,boolean:x,string:o,number:C});function g(d,t,A){for(var w="",N=0,p=t,B=t+A;p<B;p++){var X=d[p];0!==(128&X)?192!==(224&X)?224!==(240&X)?240!==(248&X)?console.error("Invalid byte "+X.toString(16)):(N=(7&X)<<18|(63&d[++p])<<12|(63&d[++p])<<6|63&d[++p])>=65536?(N-=65536,w+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):w+=String.fromCharCode(N):w+=String.fromCharCode((15&X)<<12|(63&d[++p])<<6|63&d[++p]):w+=String.fromCharCode((31&X)<<6|63&d[++p]):w+=String.fromCharCode(X)}return w}function S(d,t){return dd(d,t)<<24>>24}function dd(d,t){return d[t.offset++]}function td(d,t){return Ad(d,t)<<16>>16}function Ad(d,t){return d[t.offset++]|d[t.offset++]<<8}function wd(d,t){return d[t.offset++]|d[t.offset++]<<8|d[t.offset++]<<16|d[t.offset++]<<24}function Nd(d,t){return wd(d,t)>>>0}function pd(d,t){return kd(d,t)}function Bd(d,t){return bd(d,t)}function Xd(d,t){var A=Nd(d,t);return wd(d,t)*Math.pow(2,32)+A}function Wd(d,t){var A=Nd(d,t);return Nd(d,t)*Math.pow(2,32)+A}var ad=new Int32Array(2),Dd=new Float32Array(ad.buffer),id=new Float64Array(ad.buffer);function kd(d,t){return ad[0]=wd(d,t),Dd[0]}function bd(d,t){return ad[0]=wd(d,t),ad[1]=wd(d,t),id[0]}function Qd(d,t){return dd(d,t)>0}function Pd(d,t){var A,w=d[t.offset++];w<192?A=31&w:217===w?A=dd(d,t):218===w?A=Ad(d,t):219===w&&(A=Nd(d,t));var N=g(d,t.offset,A);return t.offset+=A,N}function Jd(d,t){var A=d[t.offset];return A<192&&A>160||217===A||218===A||219===A}function Ud(d,t){var A=d[t.offset++];return A<128?A:202===A?kd(d,t):203===A?bd(d,t):204===A?dd(d,t):205===A?Ad(d,t):206===A?Nd(d,t):207===A?Wd(d,t):208===A?S(d,t):209===A?td(d,t):210===A?wd(d,t):211===A?Xd(d,t):A>223?-1*(255-A+1):void 0}function Td(d,t){var A=d[t.offset];return A<128||A>=202&&A<=211}function Fd(d,t){return d[t.offset]<160}function qd(d,t){return d[t.offset-1]===B&&(d[t.offset]<128||d[t.offset]>=202&&d[t.offset]<=211)}var Hd=Object.freeze({__proto__:null,int8:S,uint8:dd,int16:td,uint16:Ad,int32:wd,uint32:Nd,float32:pd,float64:Bd,int64:Xd,uint64:Wd,readFloat32:kd,readFloat64:bd,boolean:Qd,string:Pd,stringCheck:Jd,number:Ud,numberCheck:Td,arrayCheck:Fd,switchStructureCheck:qd}),fd=function(){function t(d){var t=this;this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,d&&d.forEach((function(d){return t.add(d)}))}return t.prototype.Ge=function(t,A){return void 0===A&&(A=!0),a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.ADD,t,A?this.$items:void 0)},t.prototype.bb=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.REPLACE,t)},t.is=function(d){return void 0!==d.collection},t.prototype.add=function(d){var t=this.$refId++;return void 0!==d.$changes&&d.$changes.setParent(this,this.$changes.root,t),this.$changes.indexes[t]=t,this.$indexes.set(t,t),this.$items.set(t,d),this.$changes.change(t),t},t.prototype.at=function(d){var t=Array.from(this.$items.keys())[d];return this.$items.get(t)},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(d){for(var t,A,w=this.$items.entries();(A=w.next())&&!A.done;)if(d===A.value[1]){t=A.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&D.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:d.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(d){return Array.from(this.$items.values()).some((function(t){return t===d}))},t.prototype.forEach=function(d){var t=this;this.$items.forEach((function(A,w,N){return d(A,w,t)}))},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(d,t){this.$indexes.set(d,t)},t.prototype.getIndex=function(d){return this.$indexes.get(d)},t.prototype.getByIndex=function(d){return this.$items.get(this.$indexes.get(d))},t.prototype.deleteByIndex=function(d){var t=this.$indexes.get(d);this.$items.delete(t),this.$indexes.delete(d)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var d=[];return this.forEach((function(t,A){d.push("function"===typeof t.toJSON?t.toJSON():t)})),d},t.prototype.clone=function(d){var A;return d?A=Object.assign(new t,this):(A=new t,this.forEach((function(d){d.$changes?A.add(d.clone()):A.add(d)}))),A},t}(),vd=function(){function t(d){var t=this;this.$changes=new W(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,d&&d.forEach((function(d){return t.add(d)}))}return t.prototype.Ge=function(t,A){return void 0===A&&(A=!0),a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.ADD,t,A?this.$items:void 0)},t.prototype.bb=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.DELETE,t)},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.REPLACE,t)},t.is=function(d){return void 0!==d.set},t.prototype.add=function(t){var A,w;if(this.has(t))return!1;var N=this.$refId++;void 0!==t.$changes&&t.$changes.setParent(this,this.$changes.root,N);var p=null!==(w=null===(A=this.$changes.indexes[N])||void 0===A?void 0:A.op)&&void 0!==w?w:d.OPERATION.ADD;return this.$changes.indexes[N]=N,this.$indexes.set(N,N),this.$items.set(N,t),this.$changes.change(N,p),N},t.prototype.entries=function(){return this.$items.entries()},t.prototype.delete=function(d){for(var t,A,w=this.$items.entries();(A=w.next())&&!A.done;)if(d===A.value[1]){t=A.value[0];break}return void 0!==t&&(this.$changes.delete(t),this.$indexes.delete(t),this.$items.delete(t))},t.prototype.clear=function(t){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),t&&D.call(this,t),this.$items.clear(),this.$changes.operation({index:0,op:d.OPERATION.CLEAR}),this.$changes.touchParents()},t.prototype.has=function(d){for(var t,A=this.$items.values(),w=!1;(t=A.next())&&!t.done;)if(d===t.value){w=!0;break}return w},t.prototype.forEach=function(d){var t=this;this.$items.forEach((function(A,w,N){return d(A,w,t)}))},t.prototype.values=function(){return this.$items.values()},Object.defineProperty(t.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),t.prototype.setIndex=function(d,t){this.$indexes.set(d,t)},t.prototype.getIndex=function(d){return this.$indexes.get(d)},t.prototype.getByIndex=function(d){return this.$items.get(this.$indexes.get(d))},t.prototype.deleteByIndex=function(d){var t=this.$indexes.get(d);this.$items.delete(t),this.$indexes.delete(d)},t.prototype.toArray=function(){return Array.from(this.$items.values())},t.prototype.toJSON=function(){var d=[];return this.forEach((function(t,A){d.push("function"===typeof t.toJSON?t.toJSON():t)})),d},t.prototype.clone=function(d){var A;return d?A=Object.assign(new t,this):(A=new t,this.forEach((function(d){d.$changes?A.add(d.clone()):A.add(d)}))),A},t}(),md=function(){function d(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return d.prototype.addRefId=function(d){this.refIds.has(d)||(this.refIds.add(d),this.containerIndexes.set(d,new Set))},d.get=function(t){return void 0===t.$filterState&&(t.$filterState=new d),t.$filterState},d}(),jd=function(){function d(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return d.prototype.getNextUniqueId=function(){return this.nextUniqueId++},d.prototype.addRef=function(d,t,A){void 0===A&&(A=!0),this.refs.set(d,t),A&&(this.refCounts[d]=(this.refCounts[d]||0)+1)},d.prototype.removeRef=function(d){this.refCounts[d]=this.refCounts[d]-1,this.deletedRefs.add(d)},d.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},d.prototype.garbageCollectDeletedRefs=function(){var d=this;this.deletedRefs.forEach((function(t){if(!(d.refCounts[t]>0)){var A=d.refs.get(t);if(A instanceof ud)for(var w in A._definition.schema)"string"!==typeof A._definition.schema[w]&&A[w]&&A[w].$changes&&d.removeRef(A[w].$changes.refId);else{var N=A.$changes.parent._definition,p=N.schema[N.fieldsByIndex[A.$changes.parentIndex]];"function"===typeof Object.values(p)[0]&&Array.from(A.values()).forEach((function(t){return d.removeRef(t.$changes.refId)}))}d.refs.delete(t),delete d.refCounts[t]}})),this.deletedRefs.clear()},d}(),nd=function(d){function t(){return null!==d&&d.apply(this,arguments)||this}return A(t,d),t}(Error);function Rd(d,t,A,w){var N,p=!1;switch(t){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":N="number",isNaN(d)&&console.log('trying to encode "NaN" in '.concat(A.constructor.name,"#").concat(w));break;case"string":N="string",p=!0;break;case"boolean":return}if(typeof d!==N&&(!p||p&&null!==d)){var B="'".concat(JSON.stringify(d),"'").concat(d&&d.constructor&&" (".concat(d.constructor.name,")")||"");throw new nd("a '".concat(N,"' was expected, but ").concat(B," was provided in ").concat(A.constructor.name,"#").concat(w))}}function Zd(d,t,A,w){if(!(d instanceof t))throw new nd("a '".concat(t.name,"' was expected, but '").concat(d.constructor.name,"' was provided in ").concat(A.constructor.name,"#").concat(w))}function Ld(d,t,A,w,N){Rd(A,d,w,N);var p=E[d];if(!p)throw new nd("a '".concat(d,"' was expected, but ").concat(A," was provided in ").concat(w.constructor.name,"#").concat(N));p(t,A)}function Id(d,t,A){return Hd[d](t,A)}var ud=function(){function t(){for(var d=[],t=0;t<arguments.length;t++)d[t]=arguments[t];Object.defineProperties(this,{$changes:{value:new W(this,void 0,new jd),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var A=this._definition.descriptors;A&&Object.defineProperties(this,A),d[0]&&this.assign(d[0])}return t.onError=function(d){console.error(d)},t.is=function(d){return d._definition&&void 0!==d._definition.schema},t.prototype.onChange=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.REPLACE,t)},t.prototype.bb=function(t){return a(this.$callbacks||(this.$callbacks=[]),d.OPERATION.DELETE,t)},t.prototype.assign=function(d){return Object.assign(this,d),this},Object.defineProperty(t.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),t.prototype.setDirty=function(d,t){this.$changes.change(d,t)},t.prototype.listen=function(d,t,A){var w=this;return void 0===A&&(A=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[d]||(this.$callbacks[d]=[]),this.$callbacks[d].push(t),A&&void 0!==this[d]&&t(this[d],void 0),function(){return i(w.$callbacks[d],w.$callbacks[d].indexOf(t))}},t.prototype.decode=function(A,w,N){var p;void 0===w&&(w={offset:0}),void 0===N&&(N=this);var X=[],W=this.$changes.root,a=A.length,D=0;for(W.refs.set(D,this);w.offset<a;){var i=A[w.offset++];if(i!=B){var k=N.$changes,b=void 0!==N._definition,P=b?i>>6<<6:i;if(P!==d.OPERATION.CLEAR){var U=b?i%(P||255):Ud(A,w),T=b?N._definition.fieldsByIndex[U]:"",q=k.getType(U),H=void 0,f=void 0,v=void 0;if(b?f=N["_".concat(T)]:(f=N.getByIndex(U),(P&d.OPERATION.ADD)===d.OPERATION.ADD?(v=N instanceof J?Pd(A,w):U,N.setIndex(U,v)):v=N.getIndex(U)),(P&d.OPERATION.DELETE)===d.OPERATION.DELETE&&(P!==d.OPERATION.DELETE_AND_ADD&&N.deleteByIndex(U),f&&f.$changes&&W.removeRef(f.$changes.refId),H=null),void 0!==T){if(P===d.OPERATION.DELETE);else if(t.is(q)){var m=Ud(A,w);if(H=W.refs.get(m),P!==d.OPERATION.REPLACE){var j=this.getSchemaType(A,w,q);H||((H=this.createTypeInstance(j)).$changes.refId=m,f&&(H.$callbacks=f.$callbacks,f.$changes.refId&&m!==f.$changes.refId&&W.removeRef(f.$changes.refId))),W.addRef(m,H,H!==f)}}else if("string"===typeof q)H=Id(q,A,w);else{var n=F(Object.keys(q)[0]),R=Ud(A,w),Z=W.refs.has(R)?f||W.refs.get(R):new n.constructor;if((H=Z.clone(!0)).$changes.refId=R,f&&(H.$callbacks=f.$callbacks,f.$changes.refId&&R!==f.$changes.refId)){W.removeRef(f.$changes.refId);for(var L=f.entries(),I=void 0;(I=L.next())&&!I.done;){var u=(p=I.value)[0],V=p[1];X.push({refId:R,op:d.OPERATION.DELETE,field:u,value:void 0,previousValue:V})}}W.addRef(R,H,Z!==f)}if(null!==H&&void 0!==H)if(H.$changes&&H.$changes.setParent(k.ref,k.root,U),N instanceof t)N[T]=H;else if(N instanceof J)u=v,N.$items.set(u,H),N.$changes.allChanges.add(U);else if(N instanceof Q)N.setAt(U,H);else if(N instanceof fd){var h=N.add(H);N.setIndex(U,h)}else N instanceof vd&&!1!==(h=N.add(H))&&N.setIndex(U,h);f!==H&&X.push({refId:D,op:P,field:T,dynamicIndex:v,value:H,previousValue:f})}else{console.warn("@colyseus/schema: definition mismatch");for(var l={offset:w.offset};w.offset<a&&(!qd(A,w)||(l.offset=w.offset+1,!W.refs.has(Ud(A,l))));)w.offset++}}else N.clear(X)}else{D=Ud(A,w);var y=W.refs.get(D);if(!y)throw new Error('"refId" not found: '.concat(D));N=y}}return this._triggerChanges(X),W.garbageCollectDeletedRefs(),X},t.prototype.encode=function(A,w,N){void 0===A&&(A=!1),void 0===w&&(w=[]),void 0===N&&(N=!1);for(var p=this.$changes,X=new WeakSet,W=[p],a=1,D=0;D<a;D++){var i=W[D],k=i.ref,b=k instanceof t;i.ensureRefId(),X.add(i),i!==p&&(i.changed||A)&&(V(w,B),C(w,i.refId));for(var Q=A?Array.from(i.allChanges):Array.from(i.changes.values()),P=0,U=Q.length;P<U;P++){var T=A?{op:d.OPERATION.ADD,index:Q[P]}:Q[P],q=T.index,H=b?k._definition.fieldsByIndex&&k._definition.fieldsByIndex[q]:q,f=w.length;if(T.op!==d.OPERATION.TOUCH)if(b)V(w,q|T.op);else{if(V(w,T.op),T.op===d.OPERATION.CLEAR)continue;C(w,q)}if(b||(T.op&d.OPERATION.ADD)!=d.OPERATION.ADD||k instanceof J&&o(w,i.ref.$indexes.get(q)),T.op!==d.OPERATION.DELETE){var v=i.getType(q),m=i.getValue(q);if(m&&m.$changes&&!X.has(m.$changes)&&(W.push(m.$changes),m.$changes.ensureRefId(),a++),T.op!==d.OPERATION.TOUCH){if(t.is(v))Zd(m,v,k,H),C(w,m.$changes.refId),(T.op&d.OPERATION.ADD)===d.OPERATION.ADD&&this.tryEncodeTypeId(w,v,m.constructor);else if("string"===typeof v)Ld(v,w,m,k,H);else{var j=F(Object.keys(v)[0]);Zd(k["_".concat(H)],j.constructor,k,H),C(w,m.$changes.refId)}N&&i.cache(q,w.slice(f))}}}A||N||i.discard()}return w},t.prototype.encodeAll=function(d){return this.encode(!0,[],d)},t.prototype.applyFilters=function(A,w){var N,p;void 0===w&&(w=!1);for(var X=this,W=new Set,a=md.get(A),D=[this.$changes],i=1,k=[],b=function(b){var Q=D[b];if(W.has(Q.refId))return"continue";var P=Q.ref,U=P instanceof t;V(k,B),C(k,Q.refId);var T=a.refIds.has(Q),F=w||!T;a.addRefId(Q);var q=a.containerIndexes.get(Q),H=F?Array.from(Q.allChanges):Array.from(Q.changes.values());!w&&U&&P._definition.indexesWithFilters&&P._definition.indexesWithFilters.forEach((function(t){!q.has(t)&&Q.allChanges.has(t)&&(F?H.push(t):H.push({op:d.OPERATION.ADD,index:t}))}));for(var f=0,v=H.length;f<v;f++){var m=F?{op:d.OPERATION.ADD,index:H[f]}:H[f];if(m.op!==d.OPERATION.CLEAR){var j=m.index;if(m.op!==d.OPERATION.DELETE){var n=Q.getValue(j),R=Q.getType(j);if(U){if((Z=P._definition.filters&&P._definition.filters[j])&&!Z.call(P,A,n,X)){n&&n.$changes&&W.add(n.$changes.refId);continue}}else{var Z,L=Q.parent;if((Z=Q.getChildrenFilter())&&!Z.call(L,A,P.$indexes.get(j),n,X)){n&&n.$changes&&W.add(n.$changes.refId);continue}}if(n.$changes&&(D.push(n.$changes),i++),m.op!==d.OPERATION.TOUCH)if(m.op===d.OPERATION.ADD||U)k.push.apply(k,null!==(N=Q.caches[j])&&void 0!==N?N:[]),q.add(j);else if(q.has(j))k.push.apply(k,null!==(p=Q.caches[j])&&void 0!==p?p:[]);else{if(q.add(j),V(k,d.OPERATION.ADD),C(k,j),P instanceof J){var I=Q.ref.$indexes.get(j);o(k,I)}n.$changes?C(k,n.$changes.refId):E[R](k,n)}else n.$changes&&!U&&(V(k,d.OPERATION.ADD),C(k,j),P instanceof J&&(I=Q.ref.$indexes.get(j),o(k,I)),C(k,n.$changes.refId))}else U?V(k,m.op|j):(V(k,m.op),C(k,j))}else V(k,m.op)}},Q=0;Q<i;Q++)b(Q);return k},t.prototype.clone=function(){var d,t=new this.constructor,A=this._definition.schema;for(var w in A)"object"===typeof this[w]&&"function"===typeof(null===(d=this[w])||void 0===d?void 0:d.clone)?t[w]=this[w].clone():t[w]=this[w];return t},t.prototype.toJSON=function(){var d=this._definition.schema,t=this._definition.deprecated,A={};for(var w in d)t[w]||null===this[w]||"undefined"===typeof this[w]||(A[w]="function"===typeof this[w].toJSON?this[w].toJSON():this["_".concat(w)]);return A},t.prototype.discardAllChanges=function(){this.$changes.discardAll()},t.prototype.getByIndex=function(d){return this[this._definition.fieldsByIndex[d]]},t.prototype.deleteByIndex=function(d){this[this._definition.fieldsByIndex[d]]=void 0},t.prototype.tryEncodeTypeId=function(d,t,A){t._typeid!==A._typeid&&(V(d,X),C(d,A._typeid))},t.prototype.getSchemaType=function(d,t,A){var w;return d[t.offset]===X&&(t.offset++,w=this.constructor._context.get(Ud(d,t))),w||A},t.prototype.createTypeInstance=function(d){var t=new d;return t.$changes.root=this.$changes.root,t},t.prototype._triggerChanges=function(A){for(var w,N,p,B,X,W,a,D,i,k=new Set,b=this.$changes.root.refs,Q=function(Q){var P=A[Q],J=P.refId,U=b.get(J),T=U.$callbacks;if((P.op&d.OPERATION.DELETE)===d.OPERATION.DELETE&&P.previousValue instanceof t&&(null===(N=null===(w=P.previousValue.$callbacks)||void 0===w?void 0:w[d.OPERATION.DELETE])||void 0===N||N.forEach((function(d){return d()}))),!T)return"continue";if(U instanceof t){if(!k.has(J))try{null===(p=null===T||void 0===T?void 0:T[d.OPERATION.REPLACE])||void 0===p||p.forEach((function(d){return d()}))}catch(F){t.onError(F)}try{T.hasOwnProperty(P.field)&&(null===(B=T[P.field])||void 0===B||B.forEach((function(d){return d(P.value,P.previousValue)})))}catch(F){t.onError(F)}}else P.op===d.OPERATION.ADD&&void 0===P.previousValue?null===(X=T[d.OPERATION.ADD])||void 0===X||X.forEach((function(d){var t;return d(P.value,null!==(t=P.dynamicIndex)&&void 0!==t?t:P.field)})):P.op===d.OPERATION.DELETE?void 0!==P.previousValue&&(null===(W=T[d.OPERATION.DELETE])||void 0===W||W.forEach((function(d){var t;return d(P.previousValue,null!==(t=P.dynamicIndex)&&void 0!==t?t:P.field)}))):P.op===d.OPERATION.DELETE_AND_ADD&&(void 0!==P.previousValue&&(null===(a=T[d.OPERATION.DELETE])||void 0===a||a.forEach((function(d){var t;return d(P.previousValue,null!==(t=P.dynamicIndex)&&void 0!==t?t:P.field)}))),null===(D=T[d.OPERATION.ADD])||void 0===D||D.forEach((function(d){var t;return d(P.value,null!==(t=P.dynamicIndex)&&void 0!==t?t:P.field)}))),P.value!==P.previousValue&&(null===(i=T[d.OPERATION.REPLACE])||void 0===i||i.forEach((function(d){var t;return d(P.value,null!==(t=P.dynamicIndex)&&void 0!==t?t:P.field)})));k.add(J)},P=0;P<A.length;P++)Q(P)},t._definition=q.create(),t}();function Vd(d){for(var t=[d.$changes],A=1,w={},N=w,p=function(d){var A=t[d];A.changes.forEach((function(d){var t=A.ref,w=d.index,p=t._definition?t._definition.fieldsByIndex[w]:t.$indexes.get(w);N[p]=A.getValue(w)}))},B=0;B<A;B++)p(B);return w}var hd={context:new f},ld=function(d){function t(){return null!==d&&d.apply(this,arguments)||this}return A(t,d),w([m("string",hd)],t.prototype,"name",void 0),w([m("string",hd)],t.prototype,"type",void 0),w([m("number",hd)],t.prototype,"referencedType",void 0),t}(ud),yd=function(d){function t(){var t=null!==d&&d.apply(this,arguments)||this;return t.fields=new Q,t}return A(t,d),w([m("number",hd)],t.prototype,"id",void 0),w([m([ld],hd)],t.prototype,"fields",void 0),t}(ud),sd=function(d){function t(){var t=null!==d&&d.apply(this,arguments)||this;return t.types=new Q,t}return A(t,d),t.encode=function(d){var A=d.constructor,w=new t;w.rootType=A._typeid;var N=function(d,t){for(var A in t){var N=new ld;N.name=A;var p=void 0;if("string"===typeof t[A])p=t[A];else{var B=t[A],X=void 0;ud.is(B)?(p="ref",X=t[A]):"string"===typeof B[p=Object.keys(B)[0]]?p+=":"+B[p]:X=B[p],N.referencedType=X?X._typeid:-1}N.type=p,d.fields.push(N)}w.types.push(d)},p=A._context.types;for(var B in p){var X=new yd;X.id=Number(B),N(X,p[B]._definition.schema)}return w.encodeAll()},t.decode=function(d,w){var N=new f,p=new t;p.decode(d,w);var B=p.types.reduce((function(d,t){var w=function(d){function t(){return null!==d&&d.apply(this,arguments)||this}return A(t,d),t}(ud),p=t.id;return d[p]=w,N.add(w,p),d}),{});p.types.forEach((function(d){var t=B[d.id];d.fields.forEach((function(d){var A;if(void 0!==d.referencedType){var w=d.type,p=B[d.referencedType];if(!p){var X=d.type.split(":");w=X[0],p=X[1]}"ref"===w?m(p,{context:N})(t.prototype,d.name):m(((A={})[w]=p,A),{context:N})(t.prototype,d.name)}else m(d.type,{context:N})(t.prototype,d.name)}))}));var X=B[p.rootType],W=new X;for(var a in X._definition.schema){var D=X._definition.schema[a];"string"!==typeof D&&(W[a]="function"===typeof D?new D:new(F(Object.keys(D)[0]).constructor))}return W},w([m([yd],hd)],t.prototype,"types",void 0),w([m("number",hd)],t.prototype,"rootType",void 0),t}(ud);T("map",{constructor:J}),T("array",{constructor:Q}),T("set",{constructor:vd}),T("collection",{constructor:fd}),d.ArraySchema=Q,d.CollectionSchema=fd,d.Context=f,d.MapSchema=J,d.Reflection=sd,d.ReflectionField=ld,d.ReflectionType=yd,d.Schema=ud,d.SchemaDefinition=q,d.SetSchema=vd,d.decode=Hd,d.defineTypes=Z,d.deprecated=R,d.dumpChanges=Vd,d.encode=E,d.filter=j,d.filterChildren=n,d.hasFilter=H,d.registerType=T,d.type=m,Object.defineProperty(d,"__esModule",{value:!0})}(t)},12279:d=>{d.exports=function(d){return null!=d&&null!=d.constructor&&"function"===typeof d.constructor.isBuffer&&d.constructor.isBuffer(d)}},12262:(d,t,A)=>{"use strict";var w=A(12270),N=A(12276),p=A(12279);A.g.__TYPEDARRAY_POOL||(A.g.__TYPEDARRAY_POOL={UINT8:N([32,0]),UINT16:N([32,0]),UINT32:N([32,0]),INT8:N([32,0]),INT16:N([32,0]),INT32:N([32,0]),FLOAT:N([32,0]),DOUBLE:N([32,0]),DATA:N([32,0]),UINT8C:N([32,0]),BUFFER:N([32,0])});var B="undefined"!==typeof Uint8ClampedArray,X=A.g.__TYPEDARRAY_POOL;X.UINT8C||(X.UINT8C=N([32,0])),X.BUFFER||(X.BUFFER=N([32,0]));var W=X.DATA,a=X.BUFFER;function D(d){if(d){var t=d.length||d.byteLength,A=w.log2(t);W[A].push(d)}}function i(d){d=w.nextPow2(d);var t=w.log2(d),A=W[t];return A.length>0?A.pop():new ArrayBuffer(d)}function k(d){return new Uint8Array(i(d),0,d)}function b(d){return new Uint16Array(i(2*d),0,d)}function Q(d){return new Uint32Array(i(4*d),0,d)}function P(d){return new Int8Array(i(d),0,d)}function J(d){return new Int16Array(i(2*d),0,d)}function U(d){return new Int32Array(i(4*d),0,d)}function T(d){return new Float32Array(i(4*d),0,d)}function F(d){return new Float64Array(i(8*d),0,d)}function q(d){return B?new Uint8ClampedArray(i(d),0,d):k(d)}function H(d){return new DataView(i(d),0,d)}t.free=function(d){if(p(d))a[w.log2(d.length)].push(d);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(d)&&(d=d.buffer),!d)return;var t=d.length||d.byteLength,A=0|w.log2(t);W[A].push(d)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeInt8=t.freeInt16=t.freeInt32=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(d){D(d.buffer)},t.freeArrayBuffer=D,t.freeBuffer=function(d){a[w.log2(d.length)].push(d)},t.malloc=function(d,t){if(void 0===t||"arraybuffer"===t)return i(d);switch(t){case"uint8":return k(d);case"uint16":return b(d);case"uint32":return Q(d);case"int8":return P(d);case"int16":return J(d);case"int32":return U(d);case"float":case"float32":return T(d);case"double":case"float64":return F(d);case"uint8_clamped":return q(d);case"buffer":throw"Buffer not supported";case"data":case"dataview":return H(d);default:return null}return null},t.mallocArrayBuffer=i,t.mallocUint8=k,t.mallocUint16=b,t.mallocUint32=Q,t.mallocInt8=P,t.mallocInt16=J,t.mallocInt32=U,t.mallocFloat32=t.mallocFloat=T,t.mallocFloat64=t.mallocDouble=F,t.mallocUint8Clamped=q,t.mallocDataView=H,t.clearCache=function(){for(var d=0;d<32;++d)X.UINT8[d].length=0,X.UINT16[d].length=0,X.UINT32[d].length=0,X.INT8[d].length=0,X.INT16[d].length=0,X.INT32[d].length=0,X.FLOAT[d].length=0,X.DOUBLE[d].length=0,X.UINT8C[d].length=0,W[d].length=0,a[d].length=0}},12361:(d,t,A)=>{d.exports=N;var w=A(148);function N(d,t){if(!(this instanceof N))return new N(d,t);var A=w.create();w.add(A,d,t),this.base=w.min(w.create(),d,A),this.Og=w.clone(t),this.max=w.max(w.create(),d,A),this.mag=w.length(this.Og)}var p=N.prototype;p.width=function(){return this.Og[0]},p.height=function(){return this.Og[1]},p.depth=function(){return this.Og[2]},p.x0=function(){return this.base[0]},p.y0=function(){return this.base[1]},p.z0=function(){return this.base[2]},p.x1=function(){return this.max[0]},p.y1=function(){return this.max[1]},p.z1=function(){return this.max[2]},p.translate=function(d){return w.add(this.max,this.max,d),w.add(this.base,this.base,d),this},p.setPosition=function(d){return w.add(this.max,d,this.Og),w.j(this.base,d),this},p.expand=function(d){var t=w.create(),A=w.create();return w.max(t,d.max,this.max),w.min(A,d.base,this.base),w.Uc(t,t,A),new N(A,t)},p.intersects=function(d){return!(d.base[0]>this.max[0])&&(!(d.base[1]>this.max[1])&&(!(d.base[2]>this.max[2])&&(!(d.max[0]<this.base[0])&&(!(d.max[1]<this.base[1])&&!(d.max[2]<this.base[2])))))},p.touches=function(d){var t=this.union(d);return null!==t&&(0==t.width()||0==t.height()||0==t.depth())},p.union=function(d){if(!this.intersects(d))return null;var t=Math.max(d.base[0],this.base[0]),A=Math.max(d.base[1],this.base[1]),w=Math.max(d.base[2],this.base[2]);return new N([t,A,w],[Math.min(d.max[0],this.max[0])-t,Math.min(d.max[1],this.max[1])-A,Math.min(d.max[2],this.max[2])-w])}},12270:(d,t)=>{"use strict";function A(d){var t=32;return(d&=-d)&&t--,65535&d&&(t-=16),16711935&d&&(t-=8),252645135&d&&(t-=4),858993459&d&&(t-=2),1431655765&d&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(d){return(d>0)-(d<0)},t.abs=function(d){var t=d>>31;return(d^t)-t},t.min=function(d,t){return t^(d^t)&-(d<t)},t.max=function(d,t){return d^(d^t)&-(d<t)},t.isPow2=function(d){return!(d&d-1)&&!!d},t.log2=function(d){var t,A;return t=(d>65535)<<4,t|=A=((d>>>=t)>255)<<3,t|=A=((d>>>=A)>15)<<2,(t|=A=((d>>>=A)>3)<<1)|(d>>>=A)>>1},t.log10=function(d){return d>=1e9?9:d>=1e8?8:d>=1e7?7:d>=1e6?6:d>=1e5?5:d>=1e4?4:d>=1e3?3:d>=100?2:d>=10?1:0},t.popCount=function(d){return 16843009*((d=(858993459&(d-=d>>>1&1431655765))+(d>>>2&858993459))+(d>>>4)&252645135)>>>24},t.countTrailingZeros=A,t.nextPow2=function(d){return d+=0===d,--d,d|=d>>>1,d|=d>>>2,d|=d>>>4,d|=d>>>8,(d|=d>>>16)+1},t.prevPow2=function(d){return d|=d>>>1,d|=d>>>2,d|=d>>>4,d|=d>>>8,(d|=d>>>16)-(d>>>1)},t.parity=function(d){return d^=d>>>16,d^=d>>>8,d^=d>>>4,27030>>>(d&=15)&1};var w=new Array(256);!function(d){for(var t=0;t<256;++t){var A=t,w=t,N=7;for(A>>>=1;A;A>>>=1)w<<=1,w|=1&A,--N;d[t]=w<<N&255}}(w),t.reverse=function(d){return w[255&d]<<24|w[d>>>8&255]<<16|w[d>>>16&255]<<8|w[d>>>24&255]},t.interleave2=function(d,t){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(d,t){return(d=65535&((d=16711935&((d=252645135&((d=858993459&((d=d>>>t&1431655765)|d>>>1))|d>>>2))|d>>>4))|d>>>16))<<16>>16},t.interleave3=function(d,t,A){return d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2),(d|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<2},t.deinterleave3=function(d,t){return(d=1023&((d=4278190335&((d=251719695&((d=3272356035&((d=d>>>t&1227133513)|d>>>2))|d>>>4))|d>>>8))|d>>>16))<<22>>22},t.nextCombination=function(d){var t=d|d-1;return t+1|(~t&-~t)-1>>>A(d)+1}},12256:(d,t,A)=>{"use strict";d.exports=function(d,t,A){switch(arguments.length){case 1:return w=[],a(N=d,N,D,!0),w;case 2:return"function"===typeof t?a(d,d,t,!0):function(d,t){return w=[],a(d,t,D,!1),w}(d,t);case 3:return a(d,t,A,!1);default:throw new Error("box-intersect: Invalid arguments")}var N};var w,N=A(12262),p=A(12282),B=A(12288);function X(d,t){for(var A=0;A<d;++A)if(!(t[A]<=t[A+d]))return!0;return!1}function W(d,t,A,w){for(var N=0,p=0,B=0,W=d.length;B<W;++B){var a=d[B];if(!X(t,a)){for(var D=0;D<2*t;++D)A[N++]=a[D];w[p++]=B}}return p}function a(d,t,A,w){var X=d.length,a=t.length;if(!(X<=0||a<=0)){var D=d[0].length>>>1;if(!(D<=0)){var i,k=N.mallocDouble(2*D*X),b=N.mallocInt32(X);if((X=W(d,D,k,b))>0){if(1===D&&w)p.init(X),i=p.sweepComplete(D,A,0,X,k,b,0,X,k,b);else{var Q=N.mallocDouble(2*D*a),P=N.mallocInt32(a);(a=W(t,D,Q,P))>0&&(p.init(X+a),i=1===D?p.sweepBipartite(D,A,0,X,k,b,0,a,Q,P):B(D,A,w,X,k,b,a,Q,P),N.free(Q),N.free(P))}N.free(k),N.free(b)}return i}}}function D(d,t){w.push([d,t])}},12293:(d,t)=>{"use strict";var A="d",w="ax",N="fp",p="es",B="rs",X="re",W="rb",a="bs",D="be",i="bb",k=[A,w,"vv",B,X,W,"ri",a,D,i,"bi"];function b(d){var t="bruteForce"+(d?"Full":"Partial"),w=[],B=k.slice();d||B.splice(3,0,N);var X=["function "+t+"("+B.join()+"){"];function W(t,N){var B=function(d,t,w){var N="bruteForce"+(d?"Red":"Blue")+(t?"Flip":"")+(w?"Full":""),B=["function ",N,"(",k.join(),"){","var ",p,"=2*",A,";"],X="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",W="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(w?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return d?B.push(X,"Q",":",W):B.push(W,"Q",":",X),w?B.push("if(y1<x0||x1<y0)continue;"):t?B.push("if(y0<=x0||x1<y0)continue;"):B.push("if(y0<x0||x1<y0)continue;"),B.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),t?B.push("yi,xi"):B.push("xi,yi"),B.push(");if(rv!==void 0)return rv;}}}"),{name:N,code:B.join("")}}(t,N,d);w.push(B.code),X.push("return "+B.name+"("+k.join()+");")}X.push("if(re-rs>be-bs){"),d?(W(!0,!1),X.push("}else{"),W(!1,!1)):(X.push("if(fp){"),W(!0,!0),X.push("}else{"),W(!0,!1),X.push("}}else{if(fp){"),W(!1,!0),X.push("}else{"),W(!1,!1),X.push("}")),X.push("}}return "+t);var a=w.join("")+X.join("");return new Function(a)()}t.partial=b(!1),t.full=b(!0)},12288:(d,t,A)=>{"use strict";d.exports=function(d,t,A,p,D,R,Z,L,I){!function(d,t){var A=8*N.log2(t+1)*(d+1)|0,p=N.nextPow2(q*A);f.length<p&&(w.free(f),f=w.mallocInt32(p));var B=N.nextPow2(H*A);v.length<B&&(w.free(v),v=w.mallocDouble(B))}(d,p+Z);var u,V=0,h=2*d;m(V++,0,0,p,0,Z,A?16:0,-1/0,1/0),A||m(V++,0,0,Z,0,p,1,-1/0,1/0);for(;V>0;){var l=(V-=1)*q,y=f[l],s=f[l+1],Y=f[l+2],r=f[l+3],K=f[l+4],G=f[l+5],O=V*H,z=v[O],c=v[O+1],e=1&G,M=!!(16&G),x=D,o=R,C=L,E=I;if(e&&(x=L,o=I,C=D,E=R),!(2&G&&s>=(Y=J(d,y,s,Y,x,o,c)))&&!(4&G&&(s=U(d,y,s,Y,x,o,z))>=Y)){var g=Y-s,S=K-r;if(M){if(d*g*(g+S)<b){if(void 0!==(u=W.scanComplete(d,y,t,s,Y,x,o,r,K,C,E)))return u;continue}}else{if(d*Math.min(g,S)<i){if(void 0!==(u=B(d,y,t,e,s,Y,x,o,r,K,C,E)))return u;continue}if(d*g*S<k){if(void 0!==(u=W.scanBipartite(d,y,t,e,s,Y,x,o,r,K,C,E)))return u;continue}}var dd=Q(d,y,s,Y,x,o,z,c);if(s<dd)if(d*(dd-s)<i){if(void 0!==(u=X(d,y+1,t,s,dd,x,o,r,K,C,E)))return u}else if(y===d-2){if(void 0!==(u=e?W.sweepBipartite(d,t,r,K,C,E,s,dd,x,o):W.sweepBipartite(d,t,s,dd,x,o,r,K,C,E)))return u}else m(V++,y+1,s,dd,r,K,e,-1/0,1/0),m(V++,y+1,r,K,s,dd,1^e,-1/0,1/0);if(dd<Y){var td=a(d,y,r,K,C,E),Ad=C[h*td+y],wd=P(d,y,td,K,C,E,Ad);if(wd<K&&m(V++,y,dd,Y,wd,K,(4|e)+(M?16:0),Ad,c),r<td&&m(V++,y,dd,Y,r,td,(2|e)+(M?16:0),z,Ad),td+1===wd){if(void 0!==(u=M?n(d,y,t,dd,Y,x,o,td,C,E[td]):j(d,y,t,e,dd,Y,x,o,td,C,E[td])))return u}else if(td<wd){var Nd;if(M){if(dd<(Nd=T(d,y,dd,Y,x,o,Ad))){var pd=P(d,y,dd,Nd,x,o,Ad);if(y===d-2){if(dd<pd&&void 0!==(u=W.sweepComplete(d,t,dd,pd,x,o,td,wd,C,E)))return u;if(pd<Nd&&void 0!==(u=W.sweepBipartite(d,t,pd,Nd,x,o,td,wd,C,E)))return u}else dd<pd&&m(V++,y+1,dd,pd,td,wd,16,-1/0,1/0),pd<Nd&&(m(V++,y+1,pd,Nd,td,wd,0,-1/0,1/0),m(V++,y+1,td,wd,pd,Nd,1,-1/0,1/0))}}else dd<(Nd=e?F(d,y,dd,Y,x,o,Ad):T(d,y,dd,Y,x,o,Ad))&&(y===d-2?u=e?W.sweepBipartite(d,t,td,wd,C,E,dd,Nd,x,o):W.sweepBipartite(d,t,dd,Nd,x,o,td,wd,C,E):(m(V++,y+1,dd,Nd,td,wd,e,-1/0,1/0),m(V++,y+1,td,wd,dd,Nd,1^e,-1/0,1/0)))}}}}};var w=A(12262),N=A(12270),p=A(12293),B=p.partial,X=p.full,W=A(12282),a=A(12296),D=A(12304),i=128,k=1<<22,b=1<<22,Q=D("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),P=D("lo===p0",["p0"]),J=D("lo<p0",["p0"]),U=D("hi<=p0",["p0"]),T=D("lo<=p0&&p0<=hi",["p0"]),F=D("lo<p0&&p0<=hi",["p0"]),q=6,H=2,f=w.mallocInt32(1024),v=w.mallocDouble(1024);function m(d,t,A,w,N,p,B,X,W){var a=q*d;f[a]=t,f[a+1]=A,f[a+2]=w,f[a+3]=N,f[a+4]=p,f[a+5]=B;var D=H*d;v[D]=X,v[D+1]=W}function j(d,t,A,w,N,p,B,X,W,a,D){var i=2*d,k=W*i,b=a[k+t];d:for(var Q=N,P=N*i;Q<p;++Q,P+=i){var J=B[P+t],U=B[P+t+d];if(!(b<J||U<b)&&(!w||b!==J)){for(var T,F=X[Q],q=t+1;q<d;++q){J=B[P+q],U=B[P+q+d];var H=a[k+q],f=a[k+q+d];if(U<H||f<J)continue d}if(void 0!==(T=w?A(D,F):A(F,D)))return T}}}function n(d,t,A,w,N,p,B,X,W,a){var D=2*d,i=X*D,k=W[i+t];d:for(var b=w,Q=w*D;b<N;++b,Q+=D){var P=B[b];if(P!==a){var J=p[Q+t],U=p[Q+t+d];if(!(k<J||U<k)){for(var T=t+1;T<d;++T){J=p[Q+T],U=p[Q+T+d];var F=W[i+T],q=W[i+T+d];if(U<F||q<J)continue d}var H=A(P,a);if(void 0!==H)return H}}}}},12296:(d,t,A)=>{"use strict";d.exports=function(d,t,A,B,X,W){if(B<=A+1)return A;var a=A,D=B,i=B+A>>>1,k=2*d,b=i,Q=X[k*i+t];for(;a<D;){if(D-a<N){p(d,t,a,D,X,W),Q=X[k*i+t];break}var P=D-a,J=Math.random()*P+a|0,U=X[k*J+t],T=Math.random()*P+a|0,F=X[k*T+t],q=Math.random()*P+a|0,H=X[k*q+t];U<=F?H>=F?(b=T,Q=F):U>=H?(b=J,Q=U):(b=q,Q=H):F>=H?(b=T,Q=F):H>=U?(b=J,Q=U):(b=q,Q=H);for(var f=k*(D-1),v=k*b,m=0;m<k;++m,++f,++v){var j=X[f];X[f]=X[v],X[v]=j}var n=W[D-1];W[D-1]=W[b],W[b]=n;for(f=k*(D-1),v=k*(b=w(d,t,a,D-1,X,W,Q)),m=0;m<k;++m,++f,++v){j=X[f];X[f]=X[v],X[v]=j}n=W[D-1];if(W[D-1]=W[b],W[b]=n,i<b){for(D=b-1;a<D&&X[k*(D-1)+t]===Q;)D-=1;D+=1}else{if(!(b<i))break;for(a=b+1;a<D&&X[k*a+t]===Q;)a+=1}}return w(d,t,A,i,X,W,X[k*i+t])};var w=A(12304)("lo<p0",["p0"]),N=8;function p(d,t,A,w,N,p){for(var B=2*d,X=B*(A+1)+t,W=A+1;W<w;++W,X+=B)for(var a=N[X],D=W,i=B*(W-1);D>A&&N[i+t]>a;--D,i-=B){for(var k=i,b=i+B,Q=0;Q<B;++Q,++k,++b){var P=N[k];N[k]=N[b],N[b]=P}var J=p[D];p[D]=p[D-1],p[D-1]=J}}},12304:d=>{"use strict";d.exports=function(d,A){var w="abcdef".split("").concat(A),N=[];d.indexOf("lo")>=0&&N.push("lo=e[k+n]");d.indexOf("hi")>=0&&N.push("hi=e[k+o]");return w.push(t.replace("_",N.join()).replace("$",d)),Function.apply(void 0,w)};var t="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12284:d=>{"use strict";d.exports=function(d,w){w<=4*t?A(0,w-1,d):a(0,w-1,d)};var t=32;function A(d,t,A){for(var w=2*(d+1),N=d+1;N<=t;++N){for(var p=A[w++],B=A[w++],X=N,W=w-2;X-- >d;){var a=A[W-2],D=A[W-1];if(a<p)break;if(a===p&&D<B)break;A[W]=a,A[W+1]=D,W-=2}A[W]=p,A[W+1]=B}}function w(d,t,A){t*=2;var w=A[d*=2],N=A[d+1];A[d]=A[t],A[d+1]=A[t+1],A[t]=w,A[t+1]=N}function N(d,t,A){t*=2,A[d*=2]=A[t],A[d+1]=A[t+1]}function p(d,t,A,w){t*=2,A*=2;var N=w[d*=2],p=w[d+1];w[d]=w[t],w[d+1]=w[t+1],w[t]=w[A],w[t+1]=w[A+1],w[A]=N,w[A+1]=p}function B(d,t,A,w,N){t*=2,N[d*=2]=N[t],N[t]=A,N[d+1]=N[t+1],N[t+1]=w}function X(d,t,A){t*=2;var w=A[d*=2],N=A[t];return!(w<N)&&(w!==N||A[d+1]>A[t+1])}function W(d,t,A,w){var N=w[d*=2];return N<t||N===t&&w[d+1]<A}function a(d,D,i){var k=(D-d+1)/6|0,b=d+k,Q=D-k,P=d+D>>1,J=P-k,U=P+k,T=b,F=J,q=P,H=U,f=Q,v=d+1,m=D-1,j=0;X(T,F,i)&&(j=T,T=F,F=j),X(H,f,i)&&(j=H,H=f,f=j),X(T,q,i)&&(j=T,T=q,q=j),X(F,q,i)&&(j=F,F=q,q=j),X(T,H,i)&&(j=T,T=H,H=j),X(q,H,i)&&(j=q,q=H,H=j),X(F,f,i)&&(j=F,F=f,f=j),X(F,q,i)&&(j=F,F=q,q=j),X(H,f,i)&&(j=H,H=f,f=j);for(var n=i[2*F],R=i[2*F+1],Z=i[2*H],L=i[2*H+1],I=2*T,u=2*q,V=2*f,h=2*b,l=2*P,y=2*Q,s=0;s<2;++s){var Y=i[I+s],r=i[u+s],K=i[V+s];i[h+s]=Y,i[l+s]=r,i[y+s]=K}N(J,d,i),N(U,D,i);for(var G=v;G<=m;++G)if(W(G,n,R,i))G!==v&&w(G,v,i),++v;else if(!W(G,Z,L,i))for(;;){if(W(m,Z,L,i)){W(m,n,R,i)?(p(G,v,m,i),++v,--m):(w(G,m,i),--m);break}if(--m<G)break}B(d,v-1,n,R,i),B(D,m+1,Z,L,i),v-2-d<=t?A(d,v-2,i):a(d,v-2,i),D-(m+2)<=t?A(m+2,D,i):a(m+2,D,i),m-v<=t?A(v,m,i):a(v,m,i)}},12282:(d,t,A)=>{"use strict";d.exports={init:function(d){var t=N.nextPow2(d);W.length<t&&(w.free(W),W=w.mallocInt32(t));a.length<t&&(w.free(a),a=w.mallocInt32(t));D.length<t&&(w.free(D),D=w.mallocInt32(t));i.length<t&&(w.free(i),i=w.mallocInt32(t));k.length<t&&(w.free(k),k=w.mallocInt32(t));b.length<t&&(w.free(b),b=w.mallocInt32(t));var A=8*t;Q.length<A&&(w.free(Q),Q=w.mallocDouble(A))},sweepBipartite:function(d,t,A,w,N,X,k,b,U,T){for(var F=0,q=2*d,H=d-1,f=q-1,v=A;v<w;++v){var m=X[v],j=q*v;Q[F++]=N[j+H],Q[F++]=-(m+1),Q[F++]=N[j+f],Q[F++]=m}for(v=k;v<b;++v){m=T[v]+B;var n=q*v;Q[F++]=U[n+H],Q[F++]=-m,Q[F++]=U[n+f],Q[F++]=m}var R=F>>>1;p(Q,R);var Z=0,L=0;for(v=0;v<R;++v){var I=0|Q[2*v+1];if(I>=B)P(D,i,L--,I=I-B|0);else if(I>=0)P(W,a,Z--,I);else if(I<=-B){I=-I-B|0;for(var u=0;u<Z;++u){if(void 0!==(V=t(W[u],I)))return V}J(D,i,L++,I)}else{I=-I-1|0;for(u=0;u<L;++u){var V;if(void 0!==(V=t(I,D[u])))return V}J(W,a,Z++,I)}}},sweepComplete:function(d,t,A,w,N,B,X,U,T,F){for(var q=0,H=2*d,f=d-1,v=H-1,m=A;m<w;++m){var j=B[m]+1<<1,n=H*m;Q[q++]=N[n+f],Q[q++]=-j,Q[q++]=N[n+v],Q[q++]=j}for(m=X;m<U;++m){j=F[m]+1<<1;var R=H*m;Q[q++]=T[R+f],Q[q++]=1|-j,Q[q++]=T[R+v],Q[q++]=1|j}var Z=q>>>1;p(Q,Z);var L=0,I=0,u=0;for(m=0;m<Z;++m){var V=0|Q[2*m+1],h=1&V;if(m<Z-1&&V>>1===Q[2*m+3]>>1&&(h=2,m+=1),V<0){for(var l=-(V>>1)-1,y=0;y<u;++y){if(void 0!==(s=t(k[y],l)))return s}if(0!==h)for(y=0;y<L;++y){if(void 0!==(s=t(W[y],l)))return s}if(1!==h)for(y=0;y<I;++y){var s;if(void 0!==(s=t(D[y],l)))return s}0===h?J(W,a,L++,l):1===h?J(D,i,I++,l):2===h&&J(k,b,u++,l)}else{l=(V>>1)-1;0===h?P(W,a,L--,l):1===h?P(D,i,I--,l):2===h&&P(k,b,u--,l)}}},scanBipartite:function(d,t,A,w,N,X,D,i,k,b,U,T){var F=0,q=2*d,H=t,f=t+d,v=1,m=1;w?m=B:v=B;for(var j=N;j<X;++j){var n=j+v,R=q*j;Q[F++]=D[R+H],Q[F++]=-n,Q[F++]=D[R+f],Q[F++]=n}for(j=k;j<b;++j){n=j+m;var Z=q*j;Q[F++]=U[Z+H],Q[F++]=-n}var L=F>>>1;p(Q,L);var I=0;for(j=0;j<L;++j){var u=0|Q[2*j+1];if(u<0){var V=!1;if((n=-u)>=B?(V=!w,n-=B):(V=!!w,n-=1),V)J(W,a,I++,n);else{var h=T[n],l=q*n,y=U[l+t+1],s=U[l+t+1+d];d:for(var Y=0;Y<I;++Y){var r=W[Y],K=q*r;if(!(s<D[K+t+1]||D[K+t+1+d]<y)){for(var G=t+2;G<d;++G)if(U[l+G+d]<D[K+G]||D[K+G+d]<U[l+G])continue d;var O,z=i[r];if(void 0!==(O=w?A(h,z):A(z,h)))return O}}}}else P(W,a,I--,u-v)}},scanComplete:function(d,t,A,w,N,X,a,D,i,k,b){for(var P=0,J=2*d,U=t,T=t+d,F=w;F<N;++F){var q=F+B,H=J*F;Q[P++]=X[H+U],Q[P++]=-q,Q[P++]=X[H+T],Q[P++]=q}for(F=D;F<i;++F){q=F+1;var f=J*F;Q[P++]=k[f+U],Q[P++]=-q}var v=P>>>1;p(Q,v);var m=0;for(F=0;F<v;++F){var j=0|Q[2*F+1];if(j<0){if((q=-j)>=B)W[m++]=q-B;else{var n=b[q-=1],R=J*q,Z=k[R+t+1],L=k[R+t+1+d];d:for(var I=0;I<m;++I){var u=W[I],V=a[u];if(V===n)break;var h=J*u;if(!(L<X[h+t+1]||X[h+t+1+d]<Z)){for(var l=t+2;l<d;++l)if(k[R+l+d]<X[h+l]||X[h+l+d]<k[R+l])continue d;var y=A(V,n);if(void 0!==y)return y}}}}else{for(q=j-B,I=m-1;I>=0;--I)if(W[I]===q){for(l=I+1;l<m;++l)W[l-1]=W[l];break}--m}}}};var w=A(12262),N=A(12270),p=A(12284),B=1<<28,X=1024,W=w.mallocInt32(X),a=w.mallocInt32(X),D=w.mallocInt32(X),i=w.mallocInt32(X),k=w.mallocInt32(X),b=w.mallocInt32(X),Q=w.mallocDouble(8192);function P(d,t,A,w){var N=t[w],p=d[A-1];d[N]=p,t[p]=N}function J(d,t,A,w){d[A]=w,t[w]=A}},12422:d=>{"use strict";d.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12413:(d,t,A)=>{var w=A(12422),N=A(12428),p=Object.hasOwnProperty,B=Object.create(null);for(var X in w)p.call(w,X)&&(B[w[X]]=X);var W=d.exports={to:{},get:{}};function a(d,t,A){return Math.min(Math.max(t,d),A)}function D(d){var t=Math.round(d).toString(16).toUpperCase();return t.length<2?"0"+t:t}W.get=function(d){var t,A;switch(d.substring(0,3).toLowerCase()){case"hsl":t=W.get.hsl(d),A="hsl";break;case"hwb":t=W.get.hwb(d),A="hwb";break;default:t=W.get.rgb(d),A="rgb"}return t?{model:A,value:t}:null},W.get.rgb=function(d){if(!d)return null;var t,A,N,B=[0,0,0,1];if(t=d.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(N=t[2],t=t[1],A=0;A<3;A++){var X=2*A;B[A]=parseInt(t.slice(X,X+2),16)}N&&(B[3]=parseInt(N,16)/255)}else if(t=d.match(/^#([a-f0-9]{3,4})$/i)){for(N=(t=t[1])[3],A=0;A<3;A++)B[A]=parseInt(t[A]+t[A],16);N&&(B[3]=parseInt(N+N,16)/255)}else if(t=d.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(A=0;A<3;A++)B[A]=parseInt(t[A+1],0);t[4]&&(t[5]?B[3]=.01*parseFloat(t[4]):B[3]=parseFloat(t[4]))}else{if(!(t=d.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(t=d.match(/^(\w+)$/))?"transparent"===t[1]?[0,0,0,0]:p.call(w,t[1])?((B=w[t[1]])[3]=1,B):null:null;for(A=0;A<3;A++)B[A]=Math.round(2.55*parseFloat(t[A+1]));t[4]&&(t[5]?B[3]=.01*parseFloat(t[4]):B[3]=parseFloat(t[4]))}for(A=0;A<3;A++)B[A]=a(B[A],0,255);return B[3]=a(B[3],0,1),B},W.get.hsl=function(d){if(!d)return null;var t=d.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var A=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,a(parseFloat(t[2]),0,100),a(parseFloat(t[3]),0,100),a(isNaN(A)?1:A,0,1)]}return null},W.get.hwb=function(d){if(!d)return null;var t=d.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(t){var A=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,a(parseFloat(t[2]),0,100),a(parseFloat(t[3]),0,100),a(isNaN(A)?1:A,0,1)]}return null},W.to.hex=function(){var d=N(arguments);return"#"+D(d[0])+D(d[1])+D(d[2])+(d[3]<1?D(Math.round(255*d[3])):"")},W.to.rgb=function(){var d=N(arguments);return d.length<4||1===d[3]?"rgb("+Math.round(d[0])+", "+Math.round(d[1])+", "+Math.round(d[2])+")":"rgba("+Math.round(d[0])+", "+Math.round(d[1])+", "+Math.round(d[2])+", "+d[3]+")"},W.to.rgb.percent=function(){var d=N(arguments),t=Math.round(d[0]/255*100),A=Math.round(d[1]/255*100),w=Math.round(d[2]/255*100);return d.length<4||1===d[3]?"rgb("+t+"%, "+A+"%, "+w+"%)":"rgba("+t+"%, "+A+"%, "+w+"%, "+d[3]+")"},W.to.hsl=function(){var d=N(arguments);return d.length<4||1===d[3]?"hsl("+d[0]+", "+d[1]+"%, "+d[2]+"%)":"hsla("+d[0]+", "+d[1]+"%, "+d[2]+"%, "+d[3]+")"},W.to.hwb=function(){var d=N(arguments),t="";return d.length>=4&&1!==d[3]&&(t=", "+d[3]),"hwb("+d[0]+", "+d[1]+"%, "+d[2]+"%"+t+")"},W.to.keyword=function(d){return B[d.slice(0,3)]}},12405:(d,t,A)=>{const w=A(12413),N=A(12434),p=["keyword","gray","hex"],B={};for(const b of Object.keys(N))B[[...N[b].labels].sort().join("")]=b;const X={};function W(d,t){if(!(this instanceof W))return new W(d,t);if(t&&t in p&&(t=null),t&&!(t in N))throw new Error("Unknown model: "+t);let A,a;if(null==d)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(d instanceof W)this.model=d.model,this.color=[...d.color],this.valpha=d.valpha;else if("string"===typeof d){const t=w.get(d);if(null===t)throw new Error("Unable to parse color from string: "+d);this.model=t.model,a=N[this.model].channels,this.color=t.value.slice(0,a),this.valpha="number"===typeof t.value[a]?t.value[a]:1}else if(d.length>0){this.model=t||"rgb",a=N[this.model].channels;const A=Array.prototype.slice.call(d,0,a);this.color=k(A,a),this.valpha="number"===typeof d[a]?d[a]:1}else if("number"===typeof d)this.model="rgb",this.color=[d>>16&255,d>>8&255,255&d],this.valpha=1;else{this.valpha=1;const t=Object.keys(d);"alpha"in d&&(t.splice(t.indexOf("alpha"),1),this.valpha="number"===typeof d.alpha?d.alpha:0);const w=t.sort().join("");if(!(w in B))throw new Error("Unable to parse color from object: "+JSON.stringify(d));this.model=B[w];const{labels:p}=N[this.model],X=[];for(A=0;A<p.length;A++)X.push(d[p[A]]);this.color=k(X)}if(X[this.model])for(a=N[this.model].channels,A=0;A<a;A++){const d=X[this.model][A];d&&(this.color[A]=d(this.color[A]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}W.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(d){let t=this.model in w.to?this:this.rgb();t=t.round("number"===typeof d?d:1);const A=1===t.valpha?t.color:[...t.color,this.valpha];return w.to[t.model](A)},percentString(d){const t=this.rgb().round("number"===typeof d?d:1),A=1===t.valpha?t.color:[...t.color,this.valpha];return w.to.rgb.percent(A)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const d={},{channels:t}=N[this.model],{labels:A}=N[this.model];for(let w=0;w<t;w++)d[A[w]]=this.color[w];return 1!==this.valpha&&(d.alpha=this.valpha),d},unitArray(){const d=this.rgb().color;return d[0]/=255,d[1]/=255,d[2]/=255,1!==this.valpha&&d.push(this.valpha),d},unitObject(){const d=this.rgb().object();return d.r/=255,d.g/=255,d.b/=255,1!==this.valpha&&(d.alpha=this.valpha),d},round(d){return d=Math.max(d||0,0),new W([...this.color.map(a(d)),this.valpha],this.model)},alpha(d){return void 0!==d?new W([...this.color,Math.max(0,Math.min(1,d))],this.model):this.valpha},red:D("rgb",0,i(255)),green:D("rgb",1,i(255)),blue:D("rgb",2,i(255)),hue:D(["hsl","hsv","hsl","hwb","hcg"],0,(d=>(d%360+360)%360)),saturationl:D("hsl",1,i(100)),lightness:D("hsl",2,i(100)),saturationv:D("hsv",1,i(100)),value:D("hsv",2,i(100)),chroma:D("hcg",1,i(100)),gray:D("hcg",2,i(100)),white:D("hwb",1,i(100)),wblack:D("hwb",2,i(100)),cyan:D("cmyk",0,i(100)),magenta:D("cmyk",1,i(100)),yellow:D("cmyk",2,i(100)),black:D("cmyk",3,i(100)),x:D("xyz",0,i(95.047)),y:D("xyz",1,i(100)),z:D("xyz",2,i(108.833)),l:D("lab",0,i(100)),a:D("lab",1),b:D("lab",2),keyword(d){return void 0!==d?new W(d):N[this.model].keyword(this.color)},hex(d){return void 0!==d?new W(d):w.to.hex(this.rgb().round().color)},hexa(d){if(void 0!==d)return new W(d);const t=this.rgb().round().color;let A=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===A.length&&(A="0"+A),w.to.hex(t)+A},rgbNumber(){const d=this.rgb().color;return(255&d[0])<<16|(255&d[1])<<8|255&d[2]},luminosity(){const d=this.rgb().color,t=[];for(const[A,w]of d.entries()){const d=w/255;t[A]=d<=.04045?d/12.92:((d+.055)/1.055)**2.4}return.2126*t[0]+.7152*t[1]+.0722*t[2]},contrast(d){const t=this.luminosity(),A=d.luminosity();return t>A?(t+.05)/(A+.05):(A+.05)/(t+.05)},level(d){const t=this.contrast(d);return t>=7?"AAA":t>=4.5?"AA":""},isDark(){const d=this.rgb().color;return(2126*d[0]+7152*d[1]+722*d[2])/1e4<128},isLight(){return!this.isDark()},negate(){const d=this.rgb();for(let t=0;t<3;t++)d.color[t]=255-d.color[t];return d},lighten(d){const t=this.hsl();return t.color[2]+=t.color[2]*d,t},darken(d){const t=this.hsl();return t.color[2]-=t.color[2]*d,t},saturate(d){const t=this.hsl();return t.color[1]+=t.color[1]*d,t},desaturate(d){const t=this.hsl();return t.color[1]-=t.color[1]*d,t},whiten(d){const t=this.hwb();return t.color[1]+=t.color[1]*d,t},blacken(d){const t=this.hwb();return t.color[2]+=t.color[2]*d,t},grayscale(){const d=this.rgb().color,t=.3*d[0]+.59*d[1]+.11*d[2];return W.rgb(t,t,t)},fade(d){return this.alpha(this.valpha-this.valpha*d)},opaquer(d){return this.alpha(this.valpha+this.valpha*d)},rotate(d){const t=this.hsl();let A=t.color[0];return A=(A+d)%360,A=A<0?360+A:A,t.color[0]=A,t},mix(d,t){if(!d||!d.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof d);const A=d.rgb(),w=this.rgb(),N=void 0===t?.5:t,p=2*N-1,B=A.alpha()-w.alpha(),X=((p*B===-1?p:(p+B)/(1+p*B))+1)/2,a=1-X;return W.rgb(X*A.red()+a*w.red(),X*A.green()+a*w.green(),X*A.blue()+a*w.blue(),A.alpha()*N+w.alpha()*(1-N))}};for(const b of Object.keys(N)){if(p.includes(b))continue;const{channels:d}=N[b];W.prototype[b]=function(){if(this.model===b)return new W(this);for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];return t.length>0?new W(t,b):new W([...(w=N[this.model][b].raw(this.color),Array.isArray(w)?w:[w]),this.valpha],b);var w},W[b]=function(){for(var t=arguments.length,A=new Array(t),w=0;w<t;w++)A[w]=arguments[w];let N=A[0];return"number"===typeof N&&(N=k(A,d)),new W(N,b)}}function a(d){return function(t){return function(d,t){return Number(d.toFixed(t))}(t,d)}}function D(d,t,A){d=Array.isArray(d)?d:[d];for(const w of d)(X[w]||(X[w]=[]))[t]=A;return d=d[0],function(w){let N;return void 0!==w?(A&&(w=A(w)),N=this[d](),N.color[t]=w,N):(N=this[d]().color[t],A&&(N=A(N)),N)}}function i(d){return function(t){return Math.max(0,Math.min(d,t))}}function k(d,t){for(let A=0;A<t;A++)"number"!==typeof d[A]&&(d[A]=0);return d}d.exports=W},12438:(d,t,A)=>{const w=A(12445),N={};for(const B of Object.keys(w))N[w[B]]=B;const p={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};d.exports=p;for(const B of Object.keys(p)){if(!("channels"in p[B]))throw new Error("missing channels property: "+B);if(!("labels"in p[B]))throw new Error("missing channel labels property: "+B);if(p[B].labels.length!==p[B].channels)throw new Error("channel and label counts mismatch: "+B);const{channels:d,labels:t}=p[B];delete p[B].channels,delete p[B].labels,Object.defineProperty(p[B],"channels",{value:d}),Object.defineProperty(p[B],"labels",{value:t})}p.rgb.hsl=function(d){const t=d[0]/255,A=d[1]/255,w=d[2]/255,N=Math.min(t,A,w),p=Math.max(t,A,w),B=p-N;let X,W;p===N?X=0:t===p?X=(A-w)/B:A===p?X=2+(w-t)/B:w===p&&(X=4+(t-A)/B),X=Math.min(60*X,360),X<0&&(X+=360);const a=(N+p)/2;return W=p===N?0:a<=.5?B/(p+N):B/(2-p-N),[X,100*W,100*a]},p.rgb.hsv=function(d){let t,A,w,N,p;const B=d[0]/255,X=d[1]/255,W=d[2]/255,a=Math.max(B,X,W),D=a-Math.min(B,X,W),i=function(d){return(a-d)/6/D+.5};return 0===D?(N=0,p=0):(p=D/a,t=i(B),A=i(X),w=i(W),B===a?N=w-A:X===a?N=1/3+t-w:W===a&&(N=2/3+A-t),N<0?N+=1:N>1&&(N-=1)),[360*N,100*p,100*a]},p.rgb.hwb=function(d){const t=d[0],A=d[1];let w=d[2];const N=p.rgb.hsl(d)[0],B=1/255*Math.min(t,Math.min(A,w));return w=1-1/255*Math.max(t,Math.max(A,w)),[N,100*B,100*w]},p.rgb.cmyk=function(d){const t=d[0]/255,A=d[1]/255,w=d[2]/255,N=Math.min(1-t,1-A,1-w);return[100*((1-t-N)/(1-N)||0),100*((1-A-N)/(1-N)||0),100*((1-w-N)/(1-N)||0),100*N]},p.rgb.keyword=function(d){const t=N[d];if(t)return t;let A,p=1/0;for(const N of Object.keys(w)){const t=w[N],W=(X=t,((B=d)[0]-X[0])**2+(B[1]-X[1])**2+(B[2]-X[2])**2);W<p&&(p=W,A=N)}var B,X;return A},p.keyword.rgb=function(d){return w[d]},p.rgb.xyz=function(d){let t=d[0]/255,A=d[1]/255,w=d[2]/255;t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,A=A>.04045?((A+.055)/1.055)**2.4:A/12.92,w=w>.04045?((w+.055)/1.055)**2.4:w/12.92;return[100*(.4124*t+.3576*A+.1805*w),100*(.2126*t+.7152*A+.0722*w),100*(.0193*t+.1192*A+.9505*w)]},p.rgb.lab=function(d){const t=p.rgb.xyz(d);let A=t[0],w=t[1],N=t[2];A/=95.047,w/=100,N/=108.883,A=A>.008856?A**(1/3):7.787*A+16/116,w=w>.008856?w**(1/3):7.787*w+16/116,N=N>.008856?N**(1/3):7.787*N+16/116;return[116*w-16,500*(A-w),200*(w-N)]},p.hsl.rgb=function(d){const t=d[0]/360,A=d[1]/100,w=d[2]/100;let N,p,B;if(0===A)return B=255*w,[B,B,B];N=w<.5?w*(1+A):w+A-w*A;const X=2*w-N,W=[0,0,0];for(let a=0;a<3;a++)p=t+1/3*-(a-1),p<0&&p++,p>1&&p--,B=6*p<1?X+6*(N-X)*p:2*p<1?N:3*p<2?X+(N-X)*(2/3-p)*6:X,W[a]=255*B;return W},p.hsl.hsv=function(d){const t=d[0];let A=d[1]/100,w=d[2]/100,N=A;const p=Math.max(w,.01);w*=2,A*=w<=1?w:2-w,N*=p<=1?p:2-p;return[t,100*(0===w?2*N/(p+N):2*A/(w+A)),100*((w+A)/2)]},p.hsv.rgb=function(d){const t=d[0]/60,A=d[1]/100;let w=d[2]/100;const N=Math.floor(t)%6,p=t-Math.floor(t),B=255*w*(1-A),X=255*w*(1-A*p),W=255*w*(1-A*(1-p));switch(w*=255,N){case 0:return[w,W,B];case 1:return[X,w,B];case 2:return[B,w,W];case 3:return[B,X,w];case 4:return[W,B,w];case 5:return[w,B,X]}},p.hsv.hsl=function(d){const t=d[0],A=d[1]/100,w=d[2]/100,N=Math.max(w,.01);let p,B;B=(2-A)*w;const X=(2-A)*N;return p=A*N,p/=X<=1?X:2-X,p=p||0,B/=2,[t,100*p,100*B]},p.hwb.rgb=function(d){const t=d[0]/360;let A=d[1]/100,w=d[2]/100;const N=A+w;let p;N>1&&(A/=N,w/=N);const B=Math.floor(6*t),X=1-w;p=6*t-B,0!==(1&B)&&(p=1-p);const W=A+p*(X-A);let a,D,i;switch(B){default:case 6:case 0:a=X,D=W,i=A;break;case 1:a=W,D=X,i=A;break;case 2:a=A,D=X,i=W;break;case 3:a=A,D=W,i=X;break;case 4:a=W,D=A,i=X;break;case 5:a=X,D=A,i=W}return[255*a,255*D,255*i]},p.cmyk.rgb=function(d){const t=d[0]/100,A=d[1]/100,w=d[2]/100,N=d[3]/100;return[255*(1-Math.min(1,t*(1-N)+N)),255*(1-Math.min(1,A*(1-N)+N)),255*(1-Math.min(1,w*(1-N)+N))]},p.xyz.rgb=function(d){const t=d[0]/100,A=d[1]/100,w=d[2]/100;let N,p,B;return N=3.2406*t+-1.5372*A+-.4986*w,p=-.9689*t+1.8758*A+.0415*w,B=.0557*t+-.204*A+1.057*w,N=N>.0031308?1.055*N**(1/2.4)-.055:12.92*N,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,B=B>.0031308?1.055*B**(1/2.4)-.055:12.92*B,N=Math.min(Math.max(0,N),1),p=Math.min(Math.max(0,p),1),B=Math.min(Math.max(0,B),1),[255*N,255*p,255*B]},p.xyz.lab=function(d){let t=d[0],A=d[1],w=d[2];t/=95.047,A/=100,w/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,A=A>.008856?A**(1/3):7.787*A+16/116,w=w>.008856?w**(1/3):7.787*w+16/116;return[116*A-16,500*(t-A),200*(A-w)]},p.lab.xyz=function(d){let t,A,w;A=(d[0]+16)/116,t=d[1]/500+A,w=A-d[2]/200;const N=A**3,p=t**3,B=w**3;return A=N>.008856?N:(A-16/116)/7.787,t=p>.008856?p:(t-16/116)/7.787,w=B>.008856?B:(w-16/116)/7.787,t*=95.047,A*=100,w*=108.883,[t,A,w]},p.lab.lch=function(d){const t=d[0],A=d[1],w=d[2];let N;N=360*Math.atan2(w,A)/2/Math.PI,N<0&&(N+=360);return[t,Math.sqrt(A*A+w*w),N]},p.lch.lab=function(d){const t=d[0],A=d[1],w=d[2]/360*2*Math.PI;return[t,A*Math.cos(w),A*Math.sin(w)]},p.rgb.ansi16=function(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[A,w,N]=d;let B=null===t?p.rgb.hsv(d)[2]:t;if(B=Math.round(B/50),0===B)return 30;let X=30+(Math.round(N/255)<<2|Math.round(w/255)<<1|Math.round(A/255));return 2===B&&(X+=60),X},p.hsv.ansi16=function(d){return p.rgb.ansi16(p.hsv.rgb(d),d[2])},p.rgb.ansi256=function(d){const t=d[0],A=d[1],w=d[2];if(t===A&&A===w)return t<8?16:t>248?231:Math.round((t-8)/247*24)+232;return 16+36*Math.round(t/255*5)+6*Math.round(A/255*5)+Math.round(w/255*5)},p.ansi16.rgb=function(d){let t=d%10;if(0===t||7===t)return d>50&&(t+=3.5),t=t/10.5*255,[t,t,t];const A=.5*(1+~~(d>50));return[(1&t)*A*255,(t>>1&1)*A*255,(t>>2&1)*A*255]},p.ansi256.rgb=function(d){if(d>=232){const t=10*(d-232)+8;return[t,t,t]}let t;d-=16;return[Math.floor(d/36)/5*255,Math.floor((t=d%36)/6)/5*255,t%6/5*255]},p.rgb.hex=function(d){const t=(((255&Math.round(d[0]))<<16)+((255&Math.round(d[1]))<<8)+(255&Math.round(d[2]))).toString(16).toUpperCase();return"000000".substring(t.length)+t},p.hex.rgb=function(d){const t=d.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!t)return[0,0,0];let A=t[0];3===t[0].length&&(A=A.split("").map((d=>d+d)).join(""));const w=parseInt(A,16);return[w>>16&255,w>>8&255,255&w]},p.rgb.hcg=function(d){const t=d[0]/255,A=d[1]/255,w=d[2]/255,N=Math.max(Math.max(t,A),w),p=Math.min(Math.min(t,A),w),B=N-p;let X,W;return X=B<1?p/(1-B):0,W=B<=0?0:N===t?(A-w)/B%6:N===A?2+(w-t)/B:4+(t-A)/B,W/=6,W%=1,[360*W,100*B,100*X]},p.hsl.hcg=function(d){const t=d[1]/100,A=d[2]/100,w=A<.5?2*t*A:2*t*(1-A);let N=0;return w<1&&(N=(A-.5*w)/(1-w)),[d[0],100*w,100*N]},p.hsv.hcg=function(d){const t=d[1]/100,A=d[2]/100,w=t*A;let N=0;return w<1&&(N=(A-w)/(1-w)),[d[0],100*w,100*N]},p.hcg.rgb=function(d){const t=d[0]/360,A=d[1]/100,w=d[2]/100;if(0===A)return[255*w,255*w,255*w];const N=[0,0,0],p=t%1*6,B=p%1,X=1-B;let W=0;switch(Math.floor(p)){case 0:N[0]=1,N[1]=B,N[2]=0;break;case 1:N[0]=X,N[1]=1,N[2]=0;break;case 2:N[0]=0,N[1]=1,N[2]=B;break;case 3:N[0]=0,N[1]=X,N[2]=1;break;case 4:N[0]=B,N[1]=0,N[2]=1;break;default:N[0]=1,N[1]=0,N[2]=X}return W=(1-A)*w,[255*(A*N[0]+W),255*(A*N[1]+W),255*(A*N[2]+W)]},p.hcg.hsv=function(d){const t=d[1]/100,A=t+d[2]/100*(1-t);let w=0;return A>0&&(w=t/A),[d[0],100*w,100*A]},p.hcg.hsl=function(d){const t=d[1]/100,A=d[2]/100*(1-t)+.5*t;let w=0;return A>0&&A<.5?w=t/(2*A):A>=.5&&A<1&&(w=t/(2*(1-A))),[d[0],100*w,100*A]},p.hcg.hwb=function(d){const t=d[1]/100,A=t+d[2]/100*(1-t);return[d[0],100*(A-t),100*(1-A)]},p.hwb.hcg=function(d){const t=d[1]/100,A=1-d[2]/100,w=A-t;let N=0;return w<1&&(N=(A-w)/(1-w)),[d[0],100*w,100*N]},p.apple.rgb=function(d){return[d[0]/65535*255,d[1]/65535*255,d[2]/65535*255]},p.rgb.apple=function(d){return[d[0]/255*65535,d[1]/255*65535,d[2]/255*65535]},p.gray.rgb=function(d){return[d[0]/100*255,d[0]/100*255,d[0]/100*255]},p.gray.hsl=function(d){return[0,0,d[0]]},p.gray.hsv=p.gray.hsl,p.gray.hwb=function(d){return[0,100,d[0]]},p.gray.cmyk=function(d){return[0,0,0,d[0]]},p.gray.lab=function(d){return[d[0],0,0]},p.gray.hex=function(d){const t=255&Math.round(d[0]/100*255),A=((t<<16)+(t<<8)+t).toString(16).toUpperCase();return"000000".substring(A.length)+A},p.rgb.gray=function(d){return[(d[0]+d[1]+d[2])/3/255*100]}},12434:(d,t,A)=>{const w=A(12438),N=A(12449),p={};Object.keys(w).forEach((d=>{p[d]={},Object.defineProperty(p[d],"channels",{value:w[d].channels}),Object.defineProperty(p[d],"labels",{value:w[d].labels});const t=N(d);Object.keys(t).forEach((A=>{const w=t[A];p[d][A]=function(d){const t=function(){for(var t=arguments.length,A=new Array(t),w=0;w<t;w++)A[w]=arguments[w];const N=A[0];if(void 0===N||null===N)return N;N.length>1&&(A=N);const p=d(A);if("object"===typeof p)for(let d=p.length,B=0;B<d;B++)p[B]=Math.round(p[B]);return p};return"conversion"in d&&(t.conversion=d.conversion),t}(w),p[d][A].raw=function(d){const t=function(){for(var t=arguments.length,A=new Array(t),w=0;w<t;w++)A[w]=arguments[w];const N=A[0];return void 0===N||null===N?N:(N.length>1&&(A=N),d(A))};return"conversion"in d&&(t.conversion=d.conversion),t}(w)}))})),d.exports=p},12449:(d,t,A)=>{const w=A(12438);function N(d){const t=function(){const d={},t=Object.keys(w);for(let A=t.length,w=0;w<A;w++)d[t[w]]={distance:-1,parent:null};return d}(),A=[d];for(t[d].distance=0;A.length;){const d=A.pop(),N=Object.keys(w[d]);for(let w=N.length,p=0;p<w;p++){const w=N[p],B=t[w];-1===B.distance&&(B.distance=t[d].distance+1,B.parent=d,A.unshift(w))}}return t}function p(d,t){return function(A){return t(d(A))}}function B(d,t){const A=[t[d].parent,d];let N=w[t[d].parent][d],B=t[d].parent;for(;t[B].parent;)A.unshift(t[B].parent),N=p(w[t[B].parent][B],N),B=t[B].parent;return N.conversion=A,N}d.exports=function(d){const t=N(d),A={},w=Object.keys(t);for(let N=w.length,p=0;p<N;p++){const d=w[p];null!==t[d].parent&&(A[d]=B(d,t))}return A}},12445:d=>{"use strict";d.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10648:function(d,t,A){"use strict";var w=this&&this.__createBinding||(Object.create?function(d,t,A,w){void 0===w&&(w=A);var N=Object.getOwnPropertyDescriptor(t,A);N&&!("get"in N?!t.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return t[A]}}),Object.defineProperty(d,w,N)}:function(d,t,A,w){void 0===w&&(w=A),d[w]=t[A]}),N=this&&this.__setModuleDefault||(Object.create?function(d,t){Object.defineProperty(d,"default",{enumerable:!0,value:t})}:function(d,t){d.default=t}),p=this&&this.__importStar||function(d){if(d&&d.__esModule)return d;var t={};if(null!=d)for(var A in d)"default"!==A&&Object.prototype.hasOwnProperty.call(d,A)&&w(t,d,A);return N(t,d),t},B=this&&this.__awaiter||function(d,t,A,w){return new(A||(A=Promise))((function(N,p){function B(d){try{W(w.next(d))}catch(t){p(t)}}function X(d){try{W(w.throw(d))}catch(t){p(t)}}function W(d){var t;d.done?N(d.value):(t=d.value,t instanceof A?t:new A((function(d){d(t)}))).then(B,X)}W((w=w.apply(d,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Auth=t.Platform=void 0;const X=p(A(10589)),W=A(10655),a="colyseus-auth-token";!function(d){d.ios="ios",d.android="android"}(t.Platform||(t.Platform={}));t.Auth=class{constructor(d){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=d.replace("ws","http"),(0,W.getItem)(a,(d=>this.token=d))}get hasToken(){return!!this.token}login(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return B(this,void 0,void 0,(function*(){const t=Object.assign({},d);this.hasToken&&(t.token=this.token);const A=yield this.request("post","/auth",t);this.token=A.token,(0,W.setItem)(a,this.token);for(let d in A)this.hasOwnProperty(d)&&(this[d]=A[d]);return this.registerPingService(),this}))}save(){return B(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return B(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return B(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return B(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(d){return B(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:d})}))}acceptFriendRequest(d){return B(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:d})}))}declineFriendRequest(d){return B(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:d})}))}blockUser(d){return B(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:d})}))}unblockUser(d){return B(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:d})}))}request(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return B(this,void 0,void 0,(function*(){N.Accept="application/json",this.hasToken&&(N.Authorization="Bearer "+this.token);const p=[];for(const d in A)p.push(`${d}=${A[d]}`);const B=p.length>0?`?${p.join("&")}`:"",W={headers:N};return w&&(W.body=w),(yield X[d](`${this.endpoint}${t}${B}`,W)).data}))}logout(){this.token=void 0,(0,W.removeItem)(a),this.unregisterPingService()}registerPingService(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),d)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10586:function(d,t,A){"use strict";var w,N=this&&this.__awaiter||function(d,t,A,w){return new(A||(A=Promise))((function(N,p){function B(d){try{W(w.next(d))}catch(t){p(t)}}function X(d){try{W(w.throw(d))}catch(t){p(t)}}function W(d){var t;d.done?N(d.value):(t=d.value,t instanceof A?t:new A((function(d){d(t)}))).then(B,X)}W((w=w.apply(d,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Client=t.MatchMakeError=void 0;const p=A(10589),B=A(10597),X=A(10603);class W extends Error{constructor(d,t){super(d),this.code=t,Object.setPrototypeOf(this,W.prototype)}}t.MatchMakeError=W;const a="undefined"!==typeof window&&"undefined"!==typeof(null===(w=null===window||void 0===window?void 0:window.location)||void 0===w?void 0:w.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";t.Client=class{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a;if("string"===typeof d){const t=new URL(d),A="https:"===t.protocol||"wss:"===t.protocol,w=Number(t.port||(A?443:80));this.settings={hostname:t.hostname,pathname:"/"!==t.pathname?t.pathname:"",port:w,secure:A}}else void 0===d.port&&(d.port=d.secure?443:80),void 0===d.pathname&&(d.pathname=""),this.settings=d}joinOrCreate(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",d,t,A)}))}create(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",d,t,A)}))}join(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",d,t,A)}))}joinById(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;return N(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",d,t,A)}))}reconnect(d,t){return N(this,void 0,void 0,(function*(){if("string"===typeof d&&"string"===typeof t)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[A,w]=d.split(":");return yield this.createMatchMakeRequest("reconnect",A,{reconnectionToken:w},t)}))}getAvailableRooms(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return N(this,void 0,void 0,(function*(){return(yield(0,p.get)(this.getHttpEndpoint(`${d}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(d,t,A){return N(this,void 0,void 0,(function*(){const w=this.createRoom(d.room.name,t);w.roomId=d.room.roomId,w.sessionId=d.sessionId;const p={sessionId:w.sessionId};d.reconnectionToken&&(p.reconnectionToken=d.reconnectionToken);const X=A||w;return w.connect(this.buildEndpoint(d.room,p),d.devMode&&(()=>N(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${w.roomId}'...`);let A=0;const p=()=>N(this,void 0,void 0,(function*(){A++;try{yield this.consumeSeatReservation(d,t,X),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${w.roomId}'`)}catch(N){A<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${A} out of 8)`),setTimeout(p,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(p,2e3)}))),X),new Promise(((d,t)=>{const A=(d,A)=>t(new B.ServerError(d,A));X.onError.once(A),X.onJoin.once((()=>{X.onError.remove(A),d(X)}))}))}))}createMatchMakeRequest(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},w=arguments.length>3?arguments[3]:void 0,B=arguments.length>4?arguments[4]:void 0;return N(this,void 0,void 0,(function*(){const N=(yield(0,p.post)(this.getHttpEndpoint(`${d}/${t}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(A)})).data;if(N.error)throw new W(N.error,N.code);return"reconnect"===d&&(N.reconnectionToken=A.reconnectionToken),yield this.consumeSeatReservation(N,w,B)}))}createRoom(d,t){return new X.Room(d,t)}buildEndpoint(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=[];for(const N in t)t.hasOwnProperty(N)&&A.push(`${N}=${t[N]}`);let w=this.settings.secure?"wss://":"ws://";return d.publicAddress?w+=`${d.publicAddress}`:w+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${w}/${d.processId}/${d.roomId}?${A.join("&")}`}getHttpEndpoint(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${d}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10612:(d,t,A)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Connection=void 0;const w=A(10620);t.Connection=class{constructor(){this.events={},this.transport=new w.WebSocketTransport(this.events)}send(d){this.transport.send(d)}connect(d){this.transport.connect(d)}close(d,t){this.transport.close(d,t)}get isOpen(){return this.transport.isOpen}}},10630:(d,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.utf8Length=t.utf8Read=t.ErrorCode=t.Protocol=void 0,function(d){d[d.HANDSHAKE=9]="HANDSHAKE",d[d.JOIN_ROOM=10]="JOIN_ROOM",d[d.ERROR=11]="ERROR",d[d.LEAVE_ROOM=12]="LEAVE_ROOM",d[d.ROOM_DATA=13]="ROOM_DATA",d[d.ROOM_STATE=14]="ROOM_STATE",d[d.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",d[d.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",d[d.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(t.Protocol||(t.Protocol={})),function(d){d[d.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",d[d.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",d[d.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",d[d.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",d[d.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",d[d.AUTH_FAILED=4215]="AUTH_FAILED",d[d.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(t.ErrorCode||(t.ErrorCode={})),t.utf8Read=function(d,t){const A=d[t++];for(var w="",N=0,p=t,B=t+A;p<B;p++){var X=d[p];if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(N=(7&X)<<18|(63&d[++p])<<12|(63&d[++p])<<6|63&d[++p])>=65536?(N-=65536,w+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):w+=String.fromCharCode(N)}else w+=String.fromCharCode((15&X)<<12|(63&d[++p])<<6|63&d[++p]);else w+=String.fromCharCode((31&X)<<6|63&d[++p]);else w+=String.fromCharCode(X)}return w},t.utf8Length=function(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=0,A=0;for(let w=0,N=d.length;w<N;w++)t=d.charCodeAt(w),t<128?A+=1:t<2048?A+=2:t<55296||t>=57344?A+=3:(w++,A+=4);return A+1}},10603:function(d,t,A){"use strict";var w=this&&this.__createBinding||(Object.create?function(d,t,A,w){void 0===w&&(w=A);var N=Object.getOwnPropertyDescriptor(t,A);N&&!("get"in N?!t.__esModule:N.writable||N.configurable)||(N={enumerable:!0,get:function(){return t[A]}}),Object.defineProperty(d,w,N)}:function(d,t,A,w){void 0===w&&(w=A),d[w]=t[A]}),N=this&&this.__setModuleDefault||(Object.create?function(d,t){Object.defineProperty(d,"default",{enumerable:!0,value:t})}:function(d,t){d.default=t}),p=this&&this.__importStar||function(d){if(d&&d.__esModule)return d;var t={};if(null!=d)for(var A in d)"default"!==A&&Object.prototype.hasOwnProperty.call(d,A)&&w(t,d,A);return N(t,d),t};Object.defineProperty(t,"__esModule",{value:!0}),t.Room=void 0;const B=p(A(10608)),X=A(10612),W=A(10630),a=A(10634),D=A(10636),i=A(10641),k=A(10646),b=A(10597);class Q{constructor(d,t){this.onStateChange=(0,i.createSignal)(),this.onError=(0,i.createSignal)(),this.onLeave=(0,i.createSignal)(),this.onJoin=(0,i.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,D.createNanoEvents)(),this.roomId=null,this.name=d,t&&(this.serializer=new((0,a.getSerializer)("schema")),this.rootSchema=t,this.serializer.state=new t),this.onError(((d,t)=>{var A;return null===(A=console.warn)||void 0===A?void 0:A.call(console,`colyseus.js - onError => (${d}) ${t}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const w=new X.Connection;A.connection=w,w.events.onmessage=Q.prototype.onMessageCallback.bind(A),w.events.onclose=function(d){var w;if(!A.hasJoined)return null===(w=console.warn)||void 0===w||w.call(console,`Room connection was closed unexpectedly (${d.code}): ${d.reason}`),void A.onError.invoke(d.code,d.reason);d.code===b.CloseCode.DEVMODE_RESTART&&t?t():(A.onLeave.invoke(d.code),A.destroy())},w.events.onerror=function(d){var t;null===(t=console.warn)||void 0===t||t.call(console,`Room, onError (${d.code}): ${d.reason}`),A.onError.invoke(d.code,d.reason)},w.connect(d)}leave(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((t=>{this.onLeave((d=>t(d))),this.connection?d?this.connection.send([W.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(b.CloseCode.CONSENTED)}))}onMessage(d,t){return this.onMessageHandlers.on(this.getMessageHandlerKey(d),t)}send(d,t){const A=[W.Protocol.ROOM_DATA];let w;if("string"===typeof d?k.encode.string(A,d):k.encode.number(A,d),void 0!==t){const d=B.encode(t);w=new Uint8Array(A.length+d.byteLength),w.set(new Uint8Array(A),0),w.set(new Uint8Array(d),A.length)}else w=new Uint8Array(A);this.connection.send(w.buffer)}sendBytes(d,t){const A=[W.Protocol.ROOM_DATA_BYTES];let w;"string"===typeof d?k.encode.string(A,d):k.encode.number(A,d),w=new Uint8Array(A.length+(t.byteLength||t.length)),w.set(new Uint8Array(A),0),w.set(new Uint8Array(t),A.length),this.connection.send(w.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(d){const t=Array.from(new Uint8Array(d.data)),A=t[0];if(A===W.Protocol.JOIN_ROOM){let d=1;const A=(0,W.utf8Read)(t,d);if(d+=(0,W.utf8Length)(A),this.serializerId=(0,W.utf8Read)(t,d),d+=(0,W.utf8Length)(this.serializerId),!this.serializer){const d=(0,a.getSerializer)(this.serializerId);this.serializer=new d}t.length>d&&this.serializer.handshake&&this.serializer.handshake(t,{offset:d}),this.reconnectionToken=`${this.roomId}:${A}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([W.Protocol.JOIN_ROOM])}else if(A===W.Protocol.ERROR){const d={offset:1},A=k.decode.number(t,d),w=k.decode.string(t,d);this.onError.invoke(A,w)}else if(A===W.Protocol.LEAVE_ROOM)this.leave();else if(A===W.Protocol.ROOM_DATA_SCHEMA){const d={offset:1},A=this.serializer.getState().constructor._context.get(k.decode.number(t,d)),w=new A;w.decode(t,d),this.dispatchMessage(A,w)}else if(A===W.Protocol.ROOM_STATE)t.shift(),this.setState(t);else if(A===W.Protocol.ROOM_STATE_PATCH)t.shift(),this.patch(t);else if(A===W.Protocol.ROOM_DATA){const A={offset:1},w=k.decode.stringCheck(t,A)?k.decode.string(t,A):k.decode.number(t,A),N=t.length>A.offset?B.decode(d.data,A.offset):void 0;this.dispatchMessage(w,N)}else if(A===W.Protocol.ROOM_DATA_BYTES){const d={offset:1},A=k.decode.stringCheck(t,d)?k.decode.string(t,d):k.decode.number(t,d);this.dispatchMessage(A,new Uint8Array(t.slice(d.offset)))}}setState(d){this.serializer.setState(d),this.onStateChange.invoke(this.serializer.getState())}patch(d){this.serializer.patch(d),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(d,t){var A;const w=this.getMessageHandlerKey(d);this.onMessageHandlers.events[w]?this.onMessageHandlers.emit(w,t):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",d,t):null===(A=console.warn)||void 0===A||A.call(console,`colyseus.js: onMessage() not registered for type '${d}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(d){switch(typeof d){case"function":return`$${d._typeid}`;case"string":return d;case"number":return`i${d}`;default:throw new Error("invalid message type.")}}}t.Room=Q},10655:(d,t)=>{"use strict";let A;function w(){return A||(A="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(d,t){this.cache[d]=t},getItem:function(d){this.cache[d]},removeItem:function(d){delete this.cache[d]}}),A}Object.defineProperty(t,"__esModule",{value:!0}),t.getItem=t.removeItem=t.setItem=void 0,t.setItem=function(d,t){w().setItem(d,t)},t.removeItem=function(d){w().removeItem(d)},t.getItem=function(d,t){const A=w().getItem(d);"undefined"!==typeof Promise&&A instanceof Promise?A.then((d=>t(d))):t(A)}},10636:(d,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createNanoEvents=void 0;t.createNanoEvents=()=>({emit(d){let t=this.events[d]||[];for(var A=arguments.length,w=new Array(A>1?A-1:0),N=1;N<A;N++)w[N-1]=arguments[N];for(let p=0,B=t.length;p<B;p++)t[p](...w)},events:{},on(d,t){var A;return(null===(A=this.events[d])||void 0===A?void 0:A.push(t))||(this.events[d]=[t]),()=>{var A;this.events[d]=null===(A=this.events[d])||void 0===A?void 0:A.filter((d=>t!==d))}}})},10641:(d,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSignal=t.EventEmitter=void 0;class A{constructor(){this.handlers=[]}register(d){return this.handlers.push(d),this}invoke(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];this.handlers.forEach((d=>d.apply(this,t)))}invokeAsync(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];return Promise.all(this.handlers.map((d=>d.apply(this,t))))}remove(d){const t=this.handlers.indexOf(d);this.handlers[t]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}t.EventEmitter=A,t.createSignal=function(){const d=new A;function t(t){return d.register(t,null===this)}return t.once=t=>{const A=function(){for(var w=arguments.length,N=new Array(w),p=0;p<w;p++)N[p]=arguments[p];t.apply(this,N),d.remove(A)};d.register(A)},t.remove=t=>d.remove(t),t.invoke=function(){return d.invoke(...arguments)},t.invokeAsync=function(){return d.invokeAsync(...arguments)},t.clear=()=>d.clear(),t}},10597:(d,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerError=t.CloseCode=void 0,function(d){d[d.CONSENTED=4e3]="CONSENTED",d[d.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(t.CloseCode||(t.CloseCode={}));class A extends Error{constructor(d,t){super(t),this.name="ServerError",this.code=d}}t.ServerError=A},10569:(d,t,A)=>{"use strict";t.d=void 0,A(10577);var w=A(10586);Object.defineProperty(t,"d",{enumerable:!0,get:function(){return w.Client}});var N=A(10630);var p=A(10603);var B=A(10648);const X=A(10663);const W=A(10669),a=A(10634);(0,a.registerSerializer)("schema",X.SchemaSerializer),(0,a.registerSerializer)("none",W.NoneSerializer)},10577:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=d=>null!==d&&"object"===typeof d&&d.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10608:(d,t)=>{"use strict";function A(d,t){if(this._offset=t,d instanceof ArrayBuffer)this._buffer=d,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(d))throw new Error("Invalid argument");this._buffer=d.buffer,this._view=new DataView(this._buffer,d.byteOffset,d.byteLength)}}Object.defineProperty(t,"__esModule",{value:!0}),t.decode=t.encode=void 0,A.prototype._array=function(d){for(var t=new Array(d),A=0;A<d;A++)t[A]=this._parse();return t},A.prototype._map=function(d){for(var t={},A=0;A<d;A++)t[this._parse()]=this._parse();return t},A.prototype._str=function(d){var t=function(d,t,A){for(var w="",N=0,p=t,B=t+A;p<B;p++){var X=d.getUint8(p);if(0!==(128&X))if(192!==(224&X))if(224!==(240&X)){if(240!==(248&X))throw new Error("Invalid byte "+X.toString(16));(N=(7&X)<<18|(63&d.getUint8(++p))<<12|(63&d.getUint8(++p))<<6|63&d.getUint8(++p))>=65536?(N-=65536,w+=String.fromCharCode(55296+(N>>>10),56320+(1023&N))):w+=String.fromCharCode(N)}else w+=String.fromCharCode((15&X)<<12|(63&d.getUint8(++p))<<6|63&d.getUint8(++p));else w+=String.fromCharCode((31&X)<<6|63&d.getUint8(++p));else w+=String.fromCharCode(X)}return w}(this._view,this._offset,d);return this._offset+=d,t},A.prototype._bin=function(d){var t=this._buffer.slice(this._offset,this._offset+d);return this._offset+=d,t},A.prototype._parse=function(){var d,t=this._view.getUint8(this._offset++),A=0,w=0,N=0,p=0;if(t<192)return t<128?t:t<144?this._map(15&t):t<160?this._array(15&t):this._str(31&t);if(t>223)return-1*(255-t+1);switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 196:return A=this._view.getUint8(this._offset),this._offset+=1,this._bin(A);case 197:return A=this._view.getUint16(this._offset),this._offset+=2,this._bin(A);case 198:return A=this._view.getUint32(this._offset),this._offset+=4,this._bin(A);case 199:if(A=this._view.getUint8(this._offset),w=this._view.getInt8(this._offset+1),this._offset+=2,-1===w){var B=this._view.getUint32(this._offset);return N=this._view.getInt32(this._offset+4),p=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*N+p)+B/1e6)}return[w,this._bin(A)];case 200:return A=this._view.getUint16(this._offset),w=this._view.getInt8(this._offset+2),this._offset+=3,[w,this._bin(A)];case 201:return A=this._view.getUint32(this._offset),w=this._view.getInt8(this._offset+4),this._offset+=5,[w,this._bin(A)];case 202:return d=this._view.getFloat32(this._offset),this._offset+=4,d;case 203:return d=this._view.getFloat64(this._offset),this._offset+=8,d;case 204:return d=this._view.getUint8(this._offset),this._offset+=1,d;case 205:return d=this._view.getUint16(this._offset),this._offset+=2,d;case 206:return d=this._view.getUint32(this._offset),this._offset+=4,d;case 207:return N=this._view.getUint32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,N+p;case 208:return d=this._view.getInt8(this._offset),this._offset+=1,d;case 209:return d=this._view.getInt16(this._offset),this._offset+=2,d;case 210:return d=this._view.getInt32(this._offset),this._offset+=4,d;case 211:return N=this._view.getInt32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,N+p;case 212:return w=this._view.getInt8(this._offset),this._offset+=1,0===w?void(this._offset+=1):[w,this._bin(1)];case 213:return w=this._view.getInt8(this._offset),this._offset+=1,[w,this._bin(2)];case 214:return w=this._view.getInt8(this._offset),this._offset+=1,-1===w?(d=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*d)):[w,this._bin(4)];case 215:return w=this._view.getInt8(this._offset),this._offset+=1,0===w?(N=this._view.getInt32(this._offset)*Math.pow(2,32),p=this._view.getUint32(this._offset+4),this._offset+=8,new Date(N+p)):-1===w?(N=this._view.getUint32(this._offset),p=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&N)+p)+(N>>>2)/1e6)):[w,this._bin(8)];case 216:return w=this._view.getInt8(this._offset),this._offset+=1,[w,this._bin(16)];case 217:return A=this._view.getUint8(this._offset),this._offset+=1,this._str(A);case 218:return A=this._view.getUint16(this._offset),this._offset+=2,this._str(A);case 219:return A=this._view.getUint32(this._offset),this._offset+=4,this._str(A);case 220:return A=this._view.getUint16(this._offset),this._offset+=2,this._array(A);case 221:return A=this._view.getUint32(this._offset),this._offset+=4,this._array(A);case 222:return A=this._view.getUint16(this._offset),this._offset+=2,this._map(A);case 223:return A=this._view.getUint32(this._offset),this._offset+=4,this._map(A)}throw new Error("Could not parse")},t.decode=function(d){var t=new A(d,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),w=t._parse();if(t._offset!==d.byteLength)throw new Error(d.byteLength-t._offset+" trailing bytes");return w};function w(d,t,A){for(var w=0,N=0,p=A.length;N<p;N++)(w=A.charCodeAt(N))<128?d.setUint8(t++,w):w<2048?(d.setUint8(t++,192|w>>6),d.setUint8(t++,128|63&w)):w<55296||w>=57344?(d.setUint8(t++,224|w>>12),d.setUint8(t++,128|w>>6&63),d.setUint8(t++,128|63&w)):(N++,w=65536+((1023&w)<<10|1023&A.charCodeAt(N)),d.setUint8(t++,240|w>>18),d.setUint8(t++,128|w>>12&63),d.setUint8(t++,128|w>>6&63),d.setUint8(t++,128|63&w))}function N(d,t,A){var w=typeof A,p=0,B=0,X=0,W=0,a=0,D=0;if("string"===w){if(a=function(d){for(var t=0,A=0,w=0,N=d.length;w<N;w++)(t=d.charCodeAt(w))<128?A+=1:t<2048?A+=2:t<55296||t>=57344?A+=3:(w++,A+=4);return A}(A),a<32)d.push(160|a),D=1;else if(a<256)d.push(217,a),D=2;else if(a<65536)d.push(218,a>>8,a),D=3;else{if(!(a<4294967296))throw new Error("String too long");d.push(219,a>>24,a>>16,a>>8,a),D=5}return t.push({_str:A,_length:a,_offset:d.length}),D+a}if("number"===w)return Math.floor(A)===A&&isFinite(A)?A>=0?A<128?(d.push(A),1):A<256?(d.push(204,A),2):A<65536?(d.push(205,A>>8,A),3):A<4294967296?(d.push(206,A>>24,A>>16,A>>8,A),5):(X=A/Math.pow(2,32)|0,W=A>>>0,d.push(207,X>>24,X>>16,X>>8,X,W>>24,W>>16,W>>8,W),9):A>=-32?(d.push(A),1):A>=-128?(d.push(208,A),2):A>=-32768?(d.push(209,A>>8,A),3):A>=-2147483648?(d.push(210,A>>24,A>>16,A>>8,A),5):(X=Math.floor(A/Math.pow(2,32)),W=A>>>0,d.push(211,X>>24,X>>16,X>>8,X,W>>24,W>>16,W>>8,W),9):(d.push(203),t.push({_float:A,_length:8,_offset:d.length}),9);if("object"===w){if(null===A)return d.push(192),1;if(Array.isArray(A)){if((a=A.length)<16)d.push(144|a),D=1;else if(a<65536)d.push(220,a>>8,a),D=3;else{if(!(a<4294967296))throw new Error("Array too large");d.push(221,a>>24,a>>16,a>>8,a),D=5}for(p=0;p<a;p++)D+=N(d,t,A[p]);return D}if(A instanceof Date){var i=A.getTime(),k=Math.floor(i/1e3),b=1e6*(i-1e3*k);return k>=0&&b>=0&&k<=17179869183?0===b&&k<=4294967295?(d.push(214,255,k>>24,k>>16,k>>8,k),6):(X=k/4294967296,W=4294967295&k,d.push(215,255,b>>22,b>>14,b>>6,X,W>>24,W>>16,W>>8,W),10):(X=Math.floor(k/4294967296),W=k>>>0,d.push(199,12,255,b>>24,b>>16,b>>8,b,X>>24,X>>16,X>>8,X,W>>24,W>>16,W>>8,W),15)}if(A instanceof ArrayBuffer){if((a=A.byteLength)<256)d.push(196,a),D=2;else if(a<65536)d.push(197,a>>8,a),D=3;else{if(!(a<4294967296))throw new Error("Buffer too large");d.push(198,a>>24,a>>16,a>>8,a),D=5}return t.push({_bin:A,_length:a,_offset:d.length}),D+a}if("function"===typeof A.toJSON)return N(d,t,A.toJSON());var Q=[],P="",J=Object.keys(A);for(p=0,B=J.length;p<B;p++)void 0!==A[P=J[p]]&&"function"!==typeof A[P]&&Q.push(P);if((a=Q.length)<16)d.push(128|a),D=1;else if(a<65536)d.push(222,a>>8,a),D=3;else{if(!(a<4294967296))throw new Error("Object too large");d.push(223,a>>24,a>>16,a>>8,a),D=5}for(p=0;p<a;p++)D+=N(d,t,P=Q[p]),D+=N(d,t,A[P]);return D}if("boolean"===w)return d.push(A?195:194),1;if("undefined"===w)return d.push(192),1;if("function"===typeof A.toJSON)return N(d,t,A.toJSON());throw new Error("Could not encode")}t.encode=function(d){var t=[],A=[],p=N(t,A,d),B=new ArrayBuffer(p),X=new DataView(B),W=0,a=0,D=-1;A.length>0&&(D=A[0]._offset);for(var i,k=0,b=0,Q=0,P=t.length;Q<P;Q++)if(X.setUint8(a+Q,t[Q]),Q+1===D){if(k=(i=A[W])._length,b=a+D,i._bin)for(var J=new Uint8Array(i._bin),U=0;U<k;U++)X.setUint8(b+U,J[U]);else i._str?w(X,b,i._str):void 0!==i._float&&X.setFloat64(b,i._float);a+=k,A[++W]&&(D=A[W]._offset)}return B}},10669:(d,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoneSerializer=void 0;t.NoneSerializer=class{setState(d){}getState(){return null}patch(d){}teardown(){}handshake(d){}}},10663:(d,t,A)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaSerializer=void 0;const w=A(10646);t.SchemaSerializer=class{setState(d){return this.state.decode(d)}getState(){return this.state}patch(d){return this.state.decode(d)}teardown(){var d,t;null===(t=null===(d=this.state)||void 0===d?void 0:d.$changes)||void 0===t||t.root.clearRefs()}handshake(d,t){if(this.state){(new w.Reflection).decode(d,t)}else this.state=w.Reflection.decode(d,t)}}},10634:(d,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSerializer=t.registerSerializer=void 0;const A={};t.registerSerializer=function(d,t){A[d]=t},t.getSerializer=function(d){const t=A[d];if(!t)throw new Error("missing serializer: "+d);return t}},10620:function(d,t,A){"use strict";var w=this&&this.__importDefault||function(d){return d&&d.__esModule?d:{default:d}};Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketTransport=void 0;const N=w(A(10623)),p=globalThis.WebSocket||N.default;t.WebSocketTransport=class{constructor(d){this.events=d}send(d){d instanceof ArrayBuffer?this.ws.send(d):Array.isArray(d)&&this.ws.send(new Uint8Array(d).buffer)}connect(d){this.ws=new p(d,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(d,t){this.ws.close(d,t)}get isOpen(){return this.ws.readyState===p.OPEN}}},10623:d=>{"use strict";d.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12276:d=>{"use strict";function t(d,A,w){var N=0|d[w];if(N<=0)return[];var p,B=new Array(N);if(w===d.length-1)for(p=0;p<N;++p)B[p]=A;else for(p=0;p<N;++p)B[p]=t(d,A,w+1);return B}d.exports=function(d,A){switch("undefined"===typeof A&&(A=0),typeof d){case"number":if(d>0)return function(d,t){var A,w;for(A=new Array(d),w=0;w<d;++w)A[w]=t;return A}(0|d,A);break;case"object":if("number"===typeof d.length)return t(d,A,0)}return[]}},12225:(d,t,A)=>{d.exports=function(){var d=this;this.components={},this.comps=this.components;var t=this.components,A=1,N={},p=[],B=[],X={timeout:!1,removals:[],multiComps:[]};function W(d,A){var w=t[A],p=N[A],B=p.hash[d];B&&(p.remove(d),w.bb&&(w.multi?(B.forEach((t=>{t&&w.bb(d,t)})),B.length=0):w.bb(d,B)),X.removals.push(p),a())}function a(){X.timeout||(X.timeout=!0,setTimeout(D,1))}function D(){X.timeout=!1,i()}function i(){X.multiComps.length&&function(d){for(var t=0;t<d.length;t++){var{entID:A,data:w}=d[t],N=w.hash[A];if(N){for(var p=0;p<N.length;p++)N[p]||(N.splice(p,1),p--);0===N.length&&(w.remove(A),X.removals.push(w))}}d.length=0}(X.multiComps),X.removals.length&&function(d){for(var t=0;t<d.length;t++){d[t].flush()}d.length=0}(X.removals)}this.Ai=N,this._systems=p,this._renderSystems=B,this.Rg=function(t){var w=A++;return Array.isArray(t)&&t.forEach((t=>d.ye(w,t))),w},this.deleteEntity=function(t){return Object.keys(N).forEach((d=>{N[d].hash[t]&&W(t,d)})),d},this.rh=function(d){if(!d)throw new Error("Missing component definition");var A=d.name;if(!A)throw new Error("Component definition must have a name property.");if("string"!==typeof A)throw new Error("Component name must be a string.");if(""===A)throw new Error("Component name must be a non-empty string.");if(N[A])throw new Error(`Component ${A} already exists.`);var X={};return X.name=A,X.multi=!!d.multi,X.order=isNaN(d.order)?99:d.order,X.stateConstructor=d.stateConstructor||null,X.state=d.state||{},X.Ge=d.Ge||null,X.bb=d.bb||null,X.system=d.system||null,X.gg=d.gg||null,t[A]=X,N[A]=new w,N[A]._pendingMultiCleanup=!1,N[A]._multiCleanupIDs=X.multi?[]:null,X.system&&(p.push(A),p.sort(((d,A)=>t[d].order-t[A].order))),X.gg&&(B.push(A),B.sort(((d,A)=>t[d].order-t[A].order))),A},this.overwriteComponent=function(d,A){var w=t[d];if(!w)throw new Error(`Unknown component: ${d}`);if(!A)throw new Error("Missing component definition");if(w.name!==A.name)throw new Error("Overwriting component must use the same name property.");var X={};X.name=d,X.multi=!!A.multi,X.order=isNaN(A.order)?99:A.order,X.state=A.state||{},X.Ge=A.Ge||null,X.bb=A.bb||null,X.system=A.system||null,X.gg=A.gg||null,t[d]=X,N[d]._pendingMultiCleanup=!1,N[d]._multiCleanupIDs=X.multi?[]:null;var W=p.indexOf(d);X.system&&W<0&&p.push(d),!X.system&&W>=0&&p.splice(W,1),p.sort(((d,A)=>t[d].order-t[A].order));var a=B.indexOf(d);X.gg&&a<0&&B.push(d),!X.gg&&a>=0&&B.splice(a,1),B.sort(((d,A)=>t[d].order-t[A].order));var D=X.state;return this.ng(d).forEach((d=>{for(var t in D)t in d||(d[t]=D[t]);X.Ge&&X.Ge(d.fg,d)})),d},this.deleteComponent=function(A){var w=N[A];if(!w)throw new Error(`Unknown component: ${A}`);w.flush(),w.list.forEach((d=>{d&&W(d.fg||d[0].fg,A)}));var X=p.indexOf(A),a=B.indexOf(A);return X>-1&&p.splice(X,1),a>-1&&B.splice(a,1),N[A].dispose(),delete N[A],delete t[A],d},this.ye=function(d,A,w){var p,B=t[A],X=N[A];if(!X)throw new Error(`Unknown component: ${A}.`);if(X.hash[d]&&!B.multi)throw new Error(`Entity ${d} already has component: ${A}.`);if(B.stateConstructor){if(!(p=new B.stateConstructor).hasOwnProperty("fg"))throw new Error(`Component ${B.name} stateConstructor type does not have property __id`)}else p=Object.assign({},{fg:d},B.state,w);if(p.fg=d,B.multi){var W=X.hash[d];W||(W=[],X.add(d,W)),W.push(p)}else X.add(d,p);return B.Ge&&B.Ge(d,p),this},this.Ne=function(d,t){var A=N[t];if(!A)throw new Error(`Unknown component: ${t}.`);return!!A.hash[d]},this.De=function(t,A){if(!N[A])throw new Error(`Unknown component: ${A}.`);return W(t,A),d},this.getState=function(d,t){var A=N[t];if(!A)throw new Error(`Unknown component: ${t}.`);return A.hash[d]},this.ng=function(d){var t=N[d];if(!t)throw new Error(`Unknown component: ${d}.`);return i(),t.list},this.yk=function(d){if(!N[d])throw new Error(`Unknown component: ${d}.`);var t=N[d].hash;return d=>t[d]},this.Bk=function(d){if(!N[d])throw new Error(`Unknown component: ${d}.`);var t=N[d].hash;return d=>!!t[d]},this.Md=function(A){i();for(var w=0;w<p.length;w++){var B=p[w],X=t[B],W=N[B];X.system(A,W.list),i()}return d},this.render=function(A){i();for(var w=0;w<B.length;w++){var p=B[w],X=t[p],W=N[p];X.gg(A,W.list),i()}return d},this.removeMultiComponent=function(A,w,p){var B=t[w],W=N[w];if(!W)throw new Error(`Unknown component: ${w}.`);if(!B.multi)throw new Error("removeMultiComponent called on non-multi component");return function(d,t,A,w){var N=A.hash[d];if(N){var p=N[w];p&&(N[w]=null,t.bb&&t.bb(d,p),X.multiComps.push({entID:d,data:A}),a())}}(A,B,W,p),d}};var w=A(12227)},12227:d=>{function t(d,t){var A=d._map[t];if(delete d.hash[t],delete d._map[t],A===d.list.length-1)d.list.pop();else{var w=d.list.pop();if(d.list[A]=w,null===w||null===w[0]){var N=d.list.length;for(var p in d._map)if(d._map[p]===N)return void(d._map[p]=A)}else{var B=w.fg||w[0].fg;d._map[B]=A}}}d.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(d,t){if("number"===typeof this._map[d]){var A=this._map[d];this.hash[d]=t,this.list[A]=t}else this._map[d]=this.list.length,this.hash[d]=t,this.list.push(t)}remove(d){var t=this._map[d];this.hash[d]=null,this.list[t]=null,this._pendingRemovals.push(d)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var d=0;d<this._pendingRemovals.length;d++){var A=this._pendingRemovals[d];null===this.hash[A]&&t(this,A)}this._pendingRemovals.length=0}}},12513:d=>{"use strict";d.exports=function(d,t,A,w,N,p){var B=+t[0],X=+t[1],W=+t[2],a=+A[0],D=+A[1],i=+A[2],k=Math.sqrt(a*a+D*D+i*i);if(0===k)throw new Error("Can't raycast along a zero vector");return function(d,t,A,w,N,p,B,X,W,a){for(var D=0,i=Math.floor,k=0|i(t),b=0|i(A),Q=0|i(w),P=N>0?1:-1,J=p>0?1:-1,U=B>0?1:-1,T=Math.abs(1/N),F=Math.abs(1/p),q=Math.abs(1/B),H=T<1/0?T*(P>0?k+1-t:t-k):1/0,f=F<1/0?F*(J>0?b+1-A:A-b):1/0,v=q<1/0?q*(U>0?Q+1-w:w-Q):1/0,m=-1;D<=X;){var j=d(k,b,Q);if(j)return W&&(W[0]=t+D*N,W[1]=A+D*p,W[2]=w+D*B),a&&(a[0]=a[1]=a[2]=0,0===m&&(a[0]=-P),1===m&&(a[1]=-J),2===m&&(a[2]=-U)),j;H<f?H<v?(k+=P,D=H,H+=T,m=0):(Q+=U,D=v,v+=q,m=2):f<v?(b+=J,D=f,f+=F,m=1):(Q+=U,D=v,v+=q,m=2)}return W&&(W[0]=t+D*N,W[1]=A+D*p,W[2]=w+D*B),a&&(a[0]=a[1]=a[2]=0),0}(d,B,X,W,a/=k,D/=k,i/=k,w="undefined"===typeof w?64:+w,N,p)}},12556:(d,t,A)=>{"use strict";A.d(t,{b:()=>p});var w=A(765);function N(){this.sj=!1,this.stopPropagation=!1,this.tj=!1,this.disabled=!1}class p{constructor(d,t){this.version="0.7.0";var A=Object.assign({},new N,t||{});this.element=d||document,this.sj=!!A.sj,this.stopPropagation=!!A.stopPropagation,this.tj=!!A.tj,this.disabled=!!A.disabled,this.filterEvents=(d,t)=>!0,this.down=new w.EventEmitter,this.up=new w.EventEmitter,this.state={},this.Xf={dx:0,dy:0,pk:0,Wf:0,qk:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?X(this):document.addEventListener("DOMContentLoaded",(d=>{X(this)}),{once:!0})}bind(d){for(var t=arguments.length,A=new Array(t>1?t-1:0),w=1;w<t;w++)A[w-1]=arguments[w];A.forEach((t=>{var A=this._keyBindmap[t]||[];A.includes(d)||(A.push(d),this._keyBindmap[t]=A)})),this.state[d]=!!this.state[d],this.pressCount[d]=this.pressCount[d]||0,this.releaseCount[d]=this.releaseCount[d]||0}unbind(d){for(var t in this._keyBindmap){var A=this._keyBindmap[t],w=A.indexOf(d);w>-1&&A.splice(w,1)}}getBindings(){var d={};for(var t in this._keyBindmap){this._keyBindmap[t].forEach((A=>{d[A]=d[A]||[],d[A].push(t)}))}return d}Md(){B(this.Xf),B(this.pressCount),B(this.releaseCount)}}function B(d){for(var t in d)d[t]=0}function X(d){window.addEventListener("keydown",Q.bind(null,d,!0),!1),window.addEventListener("keyup",Q.bind(null,d,!1),!1);var t={passive:!0};d.element.addEventListener("touchstart",i.bind(void 0,d),{passive:!1}),d.element.addEventListener("touchend",b.bind(void 0,d),t),d.element.addEventListener("mousedown",P.bind(null,d,!0),t),window.document.addEventListener("mouseup",P.bind(null,d,!1),t),d.element.addEventListener("touchmove",J.bind(null,d),t),d.element.addEventListener("mousemove",J.bind(null,d),t),window.PointerEvent,d.element.addEventListener("wheel",U.bind(null,d),t),d.element.addEventListener("contextmenu",T.bind(null,d),!1),window.addEventListener("blur",F.bind(null,d),!1)}var W=0,a=0,D=null;function i(d,t){t.preventDefault(),k(t)}function k(d){let t=!1;for(let A=0;A<d.touches.length;++A)if(d.touches[A].identifier===D){t=!0;break}if(!t){const t=d.changedTouches[0];W=t.clientX,a=t.clientY,D=t.identifier}}function b(d,t){for(var A=t.changedTouches,w=0;w<A.length;++w)A[w].identifier===D&&(D=null)}function Q(d,t,A){q(A.code,t,d,A)}function P(d,t,A){if("pointerId"in A)if(t){if(null!==d._touches.currID)return;d._touches.currID=A.pointerId}else{if(d._touches.currID!==A.pointerId)return;d._touches.currID=null}return q("Mouse"+("button"in A?A.button+1:1),t,d,A),!1}function J(d,t){var A=t.movementX||t.mozMovementX||0,w=t.movementY||t.mozMovementY||0;if(t.touches&&0===(A|w)){var N=function(d){k(d);for(let t=0;t<d.changedTouches.length;++t)if(d.changedTouches[t].identifier==D){const A=d.changedTouches[t],w=[A.clientX-W,A.clientY-a];return W=A.clientX,a=A.clientY,w}return console.error(`Did not find touch id ${D}`),[0,0]}(t);A=N[0],w=N[1]}d.Xf.dx+=A,d.Xf.dy+=w}function U(d,t){var A=1;switch(t.deltaMode){case 0:A=1;break;case 1:A=12;break;case 2:A=d.element.clientHeight||window.innerHeight}d.Xf.pk+=(t.deltaX||0)*A,d.Xf.Wf+=(t.deltaY||0)*A,d.Xf.qk+=(t.deltaZ||0)*A}function T(d,t){if(!d.tj)return t.preventDefault(),!1}function F(d){for(var t in d._keyStates)d._keyStates[t]&&(/^Mouse\d/.test(t)||q(t,!1,d,{code:t,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function q(d,t,A,w){var N=A._keyBindmap[d];N&&(H(A._keyStates[d],t)&&(A._keyStates[d]=t,N.forEach((d=>{(!A.filterEvents||A.filterEvents(w,d))&&function(d,t,A,w){var N=t?A.pressCount:A.releaseCount;N[d]=(N[d]||0)+1;var p=A._bindPressCount[d]||0;(p+=t?1:-1)<0&&(p=0);A._bindPressCount[d]=p;var B=A.state[d];if(H(B,p)){A.state[d]=p>0;var X=t?A.down:A.up;A.disabled||X.emit(d,w)}}(d,t,A,w)}))),"button"in w||(A.sj&&!w.defaultPrevented&&w.preventDefault(),A.stopPropagation&&w.stopPropagation()))}function H(d,t){return d?!t:t}},10713:d=>{"use strict";d.exports=function(d){for(var t=new Array(d),A=0;A<d;++A)t[A]=A;return t}},10721:d=>{function t(d){return!!d.constructor&&"function"===typeof d.constructor.isBuffer&&d.constructor.isBuffer(d)}d.exports=function(d){return null!=d&&(t(d)||function(d){return"function"===typeof d.readFloatLE&&"function"===typeof d.slice&&t(d.slice(0,0))}(d)||!!d._isBuffer)}},12516:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});class w{constructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Yh=!1,this.Zh=!1,this.Vh=30,this.Wh=0,this.fi=!1,this.fullscreen=!1,this._h=function(d){},this.ai=function(){},this.di=function(){},this.cb=function(){},this.bi=function(d){},this.onFullscreenChanged=function(d){},a((()=>{!function(d,t){d._nowObject=performance||Date,d._lastTick=0,d._renderAccum=0,d._rt=0,d._frameCB=X.bind(null,d),requestAnimationFrame(d._frameCB),t>0&&(d._intervalCB=B.bind(null,d),d._interval=setInterval(d._intervalCB,Math.max(t,1e3/d.Vh/2)))}(this,t),function(d,t){if(!t)return;var A=!1,w=!1;document.addEventListener("pointerlockchange",(w=>{A=document.pointerLockElement===t,d.bi(A)})),document.addEventListener("fullscreenchange",(A=>{w=document.fullscreenElement===t,d.onFullscreenChanged(w)})),Object.defineProperty(d,"fi",{get:()=>A,set:d=>{d&&!A?W(t):A&&!d&&function(d){d.exitPointerLock&&d.exitPointerLock()}(document)}}),Object.defineProperty(d,"fullscreen",{get:()=>w,set:d=>{d&&!w?t.requestFullscreen():w&&!d&&document.exitFullscreen()}}),t.addEventListener("click",(N=>{d.Yh&&!A&&W(t),d.Zh&&!w&&t.requestFullscreen()}));var N=()=>d.cb();if(window.ResizeObserver){new ResizeObserver(N).observe(t)}else window.addEventListener("resize",N)}(this,d),this.di()}))}}var N=3,p=20;function B(d){for(var t=1e3/d.Vh,A=d._nowObject.now()+p,w=0;d._nowObject.now()>=d._lastTick+t&&d._nowObject.now()<A&&++w<=N;)d._h(t),d._lastTick+=t;var B=5*(t+5),X=d._nowObject.now();if(X-d._lastTick>B)for(;X>=d._lastTick+t;)d._lastTick+=t}function X(d){requestAnimationFrame(d._frameCB),B(d);var t=d._nowObject.now(),A=t-d._rt;if(d._rt=t,d.Wh>0){d._renderAccum+=A;var w=1e3/d.Wh;if(d._renderAccum<w)return;d._renderAccum=Math.min(d._renderAccum-w,w)}var N=1e3/d.Vh,p=(t-d._lastTick)/N;d.ai(A,p,N)}function W(d){d.requestPointerLock&&d.requestPointerLock()}var a=d=>{if("loading"===document.readyState){var t=()=>{document.removeEventListener("readystatechange",t),d()};document.addEventListener("readystatechange",t)}else setTimeout(d,1)}},10707:(d,t,A)=>{var w=A(10713),N=A(10721),p="undefined"!==typeof Float64Array;function B(d,t){return d[0]-t[0]}function X(){var d,t=this.stride,A=new Array(t.length);for(d=0;d<A.length;++d)A[d]=[Math.abs(t[d]),d];A.sort(B);var w=new Array(A.length);for(d=0;d<w.length;++d)w[d]=A[d][1];return w}function W(d,t){var A=["View",t,"d",d].join("");t<0&&(A="View_Nil"+d);var N="generic"===d;if(-1===t){var p="function "+A+"(a){this.data=a;};var proto="+A+".prototype;proto.dtype='"+d+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+A+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+A+"(a){return new "+A+"(a);}";return new Function(p)()}if(0===t){p="function "+A+"(a,d) {this.data = a;this.offset = d};var proto="+A+".prototype;proto.dtype='"+d+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+A+"_copy() {return new "+A+"(this.data,this.offset)};proto.pick=function "+A+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+A+"_get(){return "+(N?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+A+"_set(v){return "+(N?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+A+"(a,b,c,d){return new "+A+"(a,d)}";return new Function("TrivialArray",p)(a[d][0])}p=["'use strict'"];var B=w(t),W=B.map((function(d){return"i"+d})),D="this.offset+"+B.map((function(d){return"this.stride["+d+"]*i"+d})).join("+"),i=B.map((function(d){return"b"+d})).join(","),k=B.map((function(d){return"c"+d})).join(",");p.push("function "+A+"(a,"+i+","+k+",d){this.data=a","this.shape=["+i+"]","this.stride=["+k+"]","this.offset=d|0}","var proto="+A+".prototype","proto.dtype='"+d+"'","proto.dimension="+t),p.push("Object.defineProperty(proto,'size',{get:function "+A+"_size(){return "+B.map((function(d){return"this.shape["+d+"]"})).join("*"),"}})"),1===t?p.push("proto.order=[0]"):(p.push("Object.defineProperty(proto,'order',{get:"),t<4?(p.push("function "+A+"_order(){"),2===t?p.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&p.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):p.push("ORDER})")),p.push("proto.set=function "+A+"_set("+W.join(",")+",v){"),N?p.push("return this.data.set("+D+",v)}"):p.push("return this.data["+D+"]=v}"),p.push("proto.get=function "+A+"_get("+W.join(",")+"){"),N?p.push("return this.data.get("+D+")}"):p.push("return this.data["+D+"]}"),p.push("proto.index=function "+A+"_index(",W.join(),"){return "+D+"}"),p.push("proto.hi=function "+A+"_hi("+W.join(",")+"){return new "+A+"(this.data,"+B.map((function(d){return["(typeof i",d,"!=='number'||i",d,"<0)?this.shape[",d,"]:i",d,"|0"].join("")})).join(",")+","+B.map((function(d){return"this.stride["+d+"]"})).join(",")+",this.offset)}");var b=B.map((function(d){return"a"+d+"=this.shape["+d+"]"})),Q=B.map((function(d){return"c"+d+"=this.stride["+d+"]"}));p.push("proto.lo=function "+A+"_lo("+W.join(",")+"){var b=this.offset,d=0,"+b.join(",")+","+Q.join(","));for(var P=0;P<t;++P)p.push("if(typeof i"+P+"==='number'&&i"+P+">=0){d=i"+P+"|0;b+=c"+P+"*d;a"+P+"-=d}");p.push("return new "+A+"(this.data,"+B.map((function(d){return"a"+d})).join(",")+","+B.map((function(d){return"c"+d})).join(",")+",b)}"),p.push("proto.step=function "+A+"_step("+W.join(",")+"){var "+B.map((function(d){return"a"+d+"=this.shape["+d+"]"})).join(",")+","+B.map((function(d){return"b"+d+"=this.stride["+d+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(P=0;P<t;++P)p.push("if(typeof i"+P+"==='number'){d=i"+P+"|0;if(d<0){c+=b"+P+"*(a"+P+"-1);a"+P+"=ceil(-a"+P+"/d)}else{a"+P+"=ceil(a"+P+"/d)}b"+P+"*=d}");p.push("return new "+A+"(this.data,"+B.map((function(d){return"a"+d})).join(",")+","+B.map((function(d){return"b"+d})).join(",")+",c)}");var J=new Array(t),U=new Array(t);for(P=0;P<t;++P)J[P]="a[i"+P+"]",U[P]="b[i"+P+"]";p.push("proto.transpose=function "+A+"_transpose("+W+"){"+W.map((function(d,t){return d+"=("+d+"===undefined?"+t+":"+d+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+A+"(this.data,"+J.join(",")+","+U.join(",")+",this.offset)}"),p.push("proto.pick=function "+A+"_pick("+W+"){var a=[],b=[],c=this.offset");for(P=0;P<t;++P)p.push("if(typeof i"+P+"==='number'&&i"+P+">=0){c=(c+this.stride["+P+"]*i"+P+")|0}else{a.push(this.shape["+P+"]);b.push(this.stride["+P+"])}");return p.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),p.push("return function construct_"+A+"(data,shape,stride,offset){return new "+A+"(data,"+B.map((function(d){return"shape["+d+"]"})).join(",")+","+B.map((function(d){return"stride["+d+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",p.join("\n"))(a[d],X)}var a={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};d.exports=function(d,t,A,w){if(void 0===d)return(0,a.array[0])([]);"number"===typeof d&&(d=[d]),void 0===t&&(t=[d.length]);var B=t.length;if(void 0===A){A=new Array(B);for(var X=B-1,D=1;X>=0;--X)A[X]=D,D*=t[X]}if(void 0===w){w=0;for(X=0;X<B;++X)A[X]<0&&(w-=(t[X]-1)*A[X])}for(var i=function(d){if(N(d))return"buffer";if(p)switch(Object.prototype.toString.call(d)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(d)?"array":"generic"}(d),k=a[i];k.length<=B+1;)k.push(W(i,k.length-1));return(0,k[B+1])(d,t,A,w)}},10684:d=>{var t;self,t=()=>(()=>{"use strict";var d={d:(t,A)=>{for(var w in A)d.o(A,w)&&!d.o(t,w)&&Object.defineProperty(t,w,{enumerable:!0,get:A[w]})},o:(d,t)=>Object.prototype.hasOwnProperty.call(d,t)},t={};d.d(t,{default:()=>V});var A,w=function(d,t){var A=t.x-d.x,w=t.y-d.y;return Math.sqrt(A*A+w*w)},N=function(d){return d*(Math.PI/180)},p=new Map,B=function(d){p.has(d)&&clearTimeout(p.get(d)),p.set(d,setTimeout(d,100))},X=function(d,t,A){for(var w,N=t.split(/[ ,]+/g),p=0;p<N.length;p+=1)w=N[p],d.addEventListener?d.addEventListener(w,A,!1):d.attachEvent&&d.attachEvent(w,A)},W=function(d,t,A){for(var w,N=t.split(/[ ,]+/g),p=0;p<N.length;p+=1)w=N[p],d.removeEventListener?d.removeEventListener(w,A):d.detachEvent&&d.detachEvent(w,A)},a=function(d){return d.preventDefault(),d.type.match(/^touch/)?d.changedTouches:d},D=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},i=function(d,t){t.top||t.right||t.bottom||t.left?(d.style.top=t.top,d.style.right=t.right,d.style.bottom=t.bottom,d.style.left=t.left):(d.style.left=t.x+"px",d.style.top=t.y+"px")},k=function(d,t,A){var w=b(d);for(var N in w)if(w.hasOwnProperty(N))if("string"==typeof t)w[N]=t+" "+A;else{for(var p="",B=0,X=t.length;B<X;B+=1)p+=t[B]+" "+A+", ";w[N]=p.slice(0,-2)}return w},b=function(d){var t={};return t[d]="",["webkit","Moz","o"].forEach((function(A){t[A+d.charAt(0).toUpperCase()+d.slice(1)]=""})),t},Q=function(d,t){for(var A in t)t.hasOwnProperty(A)&&(d[A]=t[A]);return d},P=function(d,t){if(d.length)for(var A=0,w=d.length;A<w;A+=1)t(d[A]);else t(d)},J="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,U=window.matchMedia("(any-hover: none)").matches,T=!!("ontouchstart"in window),F=!!window.PointerEvent,q=!!window.MSPointerEvent,H={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},f={start:"mousedown",move:"mousemove",end:"mouseup"},v={};function m(){}J&&!U?A=H:F?A={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:q?A={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:T?(A=H,v=f):A=f,m.prototype.on=function(d,t){var A,w=this,N=d.split(/[ ,]+/g);w._handlers_=w._handlers_||{};for(var p=0;p<N.length;p+=1)A=N[p],w._handlers_[A]=w._handlers_[A]||[],w._handlers_[A].push(t);return w},m.prototype.off=function(d,t){var A=this;return A._handlers_=A._handlers_||{},void 0===d?A._handlers_={}:void 0===t?A._handlers_[d]=null:A._handlers_[d]&&A._handlers_[d].indexOf(t)>=0&&A._handlers_[d].splice(A._handlers_[d].indexOf(t),1),A},m.prototype.trigger=function(d,t){var A,w=this,N=d.split(/[ ,]+/g);w._handlers_=w._handlers_||{};for(var p=0;p<N.length;p+=1)A=N[p],w._handlers_[A]&&w._handlers_[A].length&&w._handlers_[A].forEach((function(d){d.call(w,{type:A,target:w},t)}))},m.prototype.config=function(d){var t=this;t.options=t.defaults||{},d&&(t.options=function(d,t){var A={};for(var w in d)d.hasOwnProperty(w)&&t.hasOwnProperty(w)?A[w]=t[w]:d.hasOwnProperty(w)&&(A[w]=d[w]);return A}(t.options,d))},m.prototype.bindEvt=function(d,t){var w=this;return w._domHandlers_=w._domHandlers_||{},w._domHandlers_[t]=function(){"function"==typeof w["on"+t]?w["on"+t].apply(w,arguments):console.warn('[WARNING] : Missing "on'+t+'" handler.')},X(d,A[t],w._domHandlers_[t]),v[t]&&X(d,v[t],w._domHandlers_[t]),w},m.prototype.unbindEvt=function(d,t){var w=this;return w._domHandlers_=w._domHandlers_||{},W(d,A[t],w._domHandlers_[t]),v[t]&&W(d,v[t],w._domHandlers_[t]),delete w._domHandlers_[t],this};const j=m;function n(d,t){return this.identifier=t.identifier,this.position=t.position,this.frontPosition=t.frontPosition,this.collection=d,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(t),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=n.id,n.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}n.prototype=new j,n.constructor=n,n.id=0,n.prototype.buildEl=function(d){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},n.prototype.stylize=function(){if(this.options.dataOnly)return this;var d=this.options.fadeTime+"ms",t=function(){var d=b("borderRadius");for(var t in d)d.hasOwnProperty(t)&&(d[t]="50%");return d}(),A=k("transition","opacity",d),w={};return w.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},w.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},w.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},Q(w.el,A),"circle"===this.options.shape&&Q(w.back,t),Q(w.front,t),this.applyStyles(w),this},n.prototype.applyStyles=function(d){for(var t in this.ui)if(this.ui.hasOwnProperty(t))for(var A in d[t])this.ui[t].style[A]=d[t][A];return this},n.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},n.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},n.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},n.prototype.show=function(d){var t=this;return t.options.dataOnly||(clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.addToDom(),t.restCallback(),setTimeout((function(){t.ui.el.style.opacity=1}),0),t.showTimeout=setTimeout((function(){t.trigger("shown",t.instance),"function"==typeof d&&d.call(this)}),t.options.fadeTime)),t},n.prototype.hide=function(d){var t=this;if(t.options.dataOnly)return t;if(t.ui.el.style.opacity=t.options.restOpacity,clearTimeout(t.removeTimeout),clearTimeout(t.showTimeout),clearTimeout(t.restTimeout),t.removeTimeout=setTimeout((function(){var A="dynamic"===t.options.mode?"none":"block";t.ui.el.style.display=A,"function"==typeof d&&d.call(t),t.trigger("hidden",t.instance)}),t.options.fadeTime),t.options.restJoystick){var A=t.options.restJoystick,w={};w.x=!0===A||!1!==A.x?0:t.instance.frontPosition.x,w.y=!0===A||!1!==A.y?0:t.instance.frontPosition.y,t.setPosition(d,w)}return t},n.prototype.setPosition=function(d,t){var A=this;A.frontPosition={x:t.x,y:t.y};var w=A.options.fadeTime+"ms",N={};N.front=k("transition",["transform"],w);var p={front:{}};p.front={transform:"translate("+A.frontPosition.x+"px,"+A.frontPosition.y+"px)"},A.applyStyles(N),A.applyStyles(p),A.restTimeout=setTimeout((function(){"function"==typeof d&&d.call(A),A.restCallback()}),A.options.fadeTime)},n.prototype.restCallback=function(){var d=this,t={};t.front=k("transition","none",""),d.applyStyles(t),d.trigger("rested",d.instance)},n.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},n.prototype.computeDirection=function(d){var t,A,w,N=d.angle.radian,p=Math.PI/4,B=Math.PI/2;if(N>p&&N<3*p&&!d.lockX?t="up":N>-p&&N<=p&&!d.lockY?t="left":N>3*-p&&N<=-p&&!d.lockX?t="down":d.lockY||(t="right"),d.lockY||(A=N>-B&&N<B?"left":"right"),d.lockX||(w=N>0?"up":"down"),d.force>this.options.threshold){var X,W={};for(X in this.direction)this.direction.hasOwnProperty(X)&&(W[X]=this.direction[X]);var a={};for(X in this.direction={x:A,y:w,angle:t},d.direction=this.direction,W)W[X]===this.direction[X]&&(a[X]=!0);if(a.x&&a.y&&a.angle)return d;a.x&&a.y||this.trigger("plain",d),a.x||this.trigger("plain:"+A,d),a.y||this.trigger("plain:"+w,d),a.angle||this.trigger("dir dir:"+t,d)}else this.resetDirection();return d};const R=n;function Z(d,t){var A=this;A.nipples=[],A.idles=[],A.actives=[],A.ids=[],A.pressureIntervals={},A.manager=d,A.id=Z.id,Z.id+=1,A.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},A.config(t),"static"!==A.options.mode&&"semi"!==A.options.mode||(A.options.multitouch=!1),A.options.multitouch||(A.options.maxNumberOfNipples=1);var w=getComputedStyle(A.options.zone.parentElement);return w&&"flex"===w.display&&(A.parentIsFlex=!0),A.updateBox(),A.prepareNipples(),A.uj(),A.begin(),A.nipples}Z.prototype=new j,Z.constructor=Z,Z.id=0,Z.prototype.prepareNipples=function(){var d=this,t=d.nipples;t.on=d.on.bind(d),t.off=d.off.bind(d),t.options=d.options,t.destroy=d.destroy.bind(d),t.ids=d.ids,t.id=d.id,t.processOnMove=d.processOnMove.bind(d),t.processOnEnd=d.processOnEnd.bind(d),t.get=function(d){if(void 0===d)return t[0];for(var A=0,w=t.length;A<w;A+=1)if(t[A].identifier===d)return t[A];return!1}},Z.prototype.uj=function(){var d=this;d.bindEvt(d.options.zone,"start"),d.options.zone.style.touchAction="none",d.options.zone.style.msTouchAction="none"},Z.prototype.begin=function(){var d=this,t=d.options;if("static"===t.mode){var A=d.createNipple(t.position,d.manager.getIdentifier());A.add(),d.idles.push(A)}},Z.prototype.createNipple=function(d,t){var A=this,w=A.manager.scroll,N={},p=A.options,B=A.parentIsFlex?w.x:w.x+A.box.left,X=A.parentIsFlex?w.y:w.y+A.box.top;if(d.x&&d.y)N={x:d.x-B,y:d.y-X};else if(d.top||d.right||d.bottom||d.left){var W=document.createElement("DIV");W.style.display="hidden",W.style.top=d.top,W.style.right=d.right,W.style.bottom=d.bottom,W.style.left=d.left,W.style.position="absolute",p.zone.appendChild(W);var a=W.getBoundingClientRect();p.zone.removeChild(W),N=d,d={x:a.left+w.x,y:a.top+w.y}}var D=new R(A,{color:p.color,size:p.size,threshold:p.threshold,fadeTime:p.fadeTime,dataOnly:p.dataOnly,restJoystick:p.restJoystick,restOpacity:p.restOpacity,mode:p.mode,identifier:t,position:d,zone:p.zone,frontPosition:{x:0,y:0},shape:p.shape});return p.dataOnly||(i(D.ui.el,N),i(D.ui.front,D.frontPosition)),A.nipples.push(D),A.trigger("added "+D.identifier+":added",D),A.manager.trigger("added "+D.identifier+":added",D),A.bindNipple(D),D},Z.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},Z.prototype.bindNipple=function(d){var t,A=this,w=function(d,w){t=d.type+" "+w.id+":"+d.type,A.trigger(t,w)};d.on("destroyed",A.onDestroyed.bind(A)),d.on("shown hidden rested dir plain",w),d.on("dir:up dir:right dir:down dir:left",w),d.on("plain:up plain:right plain:down plain:left",w)},Z.prototype.pressureFn=function(d,t,A){var w=this,N=0;clearInterval(w.pressureIntervals[A]),w.pressureIntervals[A]=setInterval(function(){var A=d.force||d.pressure||d.webkitForce||0;A!==N&&(t.trigger("pressure",A),w.trigger("pressure "+t.identifier+":pressure",A),N=A)}.bind(w),100)},Z.prototype.onstart=function(d){var t=this,A=t.options,w=d;return d=a(d),t.updateBox(),P(d,(function(N){t.actives.length<A.maxNumberOfNipples?t.processOnStart(N):w.type.match(/^touch/)&&(Object.keys(t.manager.ids).forEach((function(A){if(Object.values(w.touches).findIndex((function(d){return d.identifier===A}))<0){var N=[d[0]];N.identifier=A,t.processOnEnd(N)}})),t.actives.length<A.maxNumberOfNipples&&t.processOnStart(N))})),t.manager.bindDocument(),!1},Z.prototype.processOnStart=function(d){var t,A=this,N=A.options,p=A.manager.getIdentifier(d),B=d.force||d.pressure||d.webkitForce||0,X={x:d.pageX,y:d.pageY},W=A.getOrCreate(p,X);W.identifier!==p&&A.manager.removeIdentifier(W.identifier),W.identifier=p;var a=function(t){t.trigger("start",t),A.trigger("start "+t.id+":start",t),t.show(),B>0&&A.pressureFn(d,t,t.identifier),A.processOnMove(d)};if((t=A.idles.indexOf(W))>=0&&A.idles.splice(t,1),A.actives.push(W),A.ids.push(W.identifier),"semi"!==N.mode)a(W);else{if(!(w(X,W.position)<=N.catchDistance))return W.destroy(),void A.processOnStart(d);a(W)}return W},Z.prototype.getOrCreate=function(d,t){var A,w=this,N=w.options;return/(semi|static)/.test(N.mode)?(A=w.idles[0])?(w.idles.splice(0,1),A):"semi"===N.mode?w.createNipple(t,d):(console.warn("Coudln't find the needed nipple."),!1):A=w.createNipple(t,d)},Z.prototype.processOnMove=function(d){var t=this,A=t.options,p=t.manager.getIdentifier(d),B=t.nipples.get(p),X=t.manager.scroll;if(function(d){return isNaN(d.buttons)?0!==d.pressure:0!==d.buttons}(d)){if(!B)return console.error("Found zombie joystick with ID "+p),void t.manager.removeIdentifier(p);if(A.dynamicPage){var W=B.el.getBoundingClientRect();B.position={x:X.x+W.left,y:X.y+W.top}}B.identifier=p;var a=B.options.size/2,D={x:d.pageX,y:d.pageY};A.lockX&&(D.y=B.position.y),A.lockY&&(D.x=B.position.x);var i,k,b,Q,P,J,U,T,F,q,H=w(D,B.position),f=(i=D,b=(k=B.position).x-i.x,Q=k.y-i.y,function(d){return d*(180/Math.PI)}(Math.atan2(Q,b))),v=N(f),m=H/a,j={distance:H,position:D};if("circle"===B.options.shape?(P=Math.min(H,a),U=B.position,T=P,q={x:0,y:0},F=N(F=f),q.x=U.x-T*Math.cos(F),q.y=U.y-T*Math.sin(F),J=q):(J=function(d,t,A){return{x:Math.min(Math.max(d.x,t.x-A),t.x+A),y:Math.min(Math.max(d.y,t.y-A),t.y+A)}}(D,B.position,a),P=w(J,B.position)),A.follow){if(H>a){var n=D.x-J.x,R=D.y-J.y;B.position.x+=n,B.position.y+=R,B.el.style.top=B.position.y-(t.box.top+X.y)+"px",B.el.style.left=B.position.x-(t.box.left+X.x)+"px",H=w(D,B.position)}}else D=J,H=P;var Z=D.x-B.position.x,L=D.y-B.position.y;B.frontPosition={x:Z,y:L},A.dataOnly||(B.ui.front.style.transform="translate("+Z+"px,"+L+"px)");var I={identifier:B.identifier,position:D,force:m,pressure:d.force||d.pressure||d.webkitForce||0,distance:H,angle:{radian:v,degree:f},vector:{x:Z/a,y:-L/a},raw:j,instance:B,lockX:A.lockX,lockY:A.lockY};(I=B.computeDirection(I)).angle={radian:N(180-f),degree:180-f},B.trigger("move",I),t.trigger("move "+B.id+":move",I)}else this.processOnEnd(d)},Z.prototype.processOnEnd=function(d){var t=this,A=t.options,w=t.manager.getIdentifier(d),N=t.nipples.get(w),p=t.manager.removeIdentifier(N.identifier);N&&(A.dataOnly||N.hide((function(){"dynamic"===A.mode&&(N.trigger("removed",N),t.trigger("removed "+N.id+":removed",N),t.manager.trigger("removed "+N.id+":removed",N),N.destroy())})),clearInterval(t.pressureIntervals[N.identifier]),N.resetDirection(),N.trigger("end",N),t.trigger("end "+N.id+":end",N),t.ids.indexOf(N.identifier)>=0&&t.ids.splice(t.ids.indexOf(N.identifier),1),t.actives.indexOf(N)>=0&&t.actives.splice(t.actives.indexOf(N),1),/(semi|static)/.test(A.mode)?t.idles.push(N):t.nipples.indexOf(N)>=0&&t.nipples.splice(t.nipples.indexOf(N),1),t.manager.unbindDocument(),/(semi|static)/.test(A.mode)&&(t.manager.ids[p.id]=p.identifier))},Z.prototype.onDestroyed=function(d,t){var A=this;A.nipples.indexOf(t)>=0&&A.nipples.splice(A.nipples.indexOf(t),1),A.actives.indexOf(t)>=0&&A.actives.splice(A.actives.indexOf(t),1),A.idles.indexOf(t)>=0&&A.idles.splice(A.idles.indexOf(t),1),A.ids.indexOf(t.identifier)>=0&&A.ids.splice(A.ids.indexOf(t.identifier),1),A.manager.removeIdentifier(t.identifier),A.manager.unbindDocument()},Z.prototype.destroy=function(){var d=this;for(var t in d.unbindEvt(d.options.zone,"start"),d.nipples.forEach((function(d){d.destroy()})),d.pressureIntervals)d.pressureIntervals.hasOwnProperty(t)&&clearInterval(d.pressureIntervals[t]);d.trigger("destroyed",d.nipples),d.manager.unbindDocument(),d.off()};const L=Z;function I(d){var t=this;t.ids={},t.index=0,t.collections=[],t.scroll=D(),t.config(d),t.prepareCollections();var A=function(){var d;t.collections.forEach((function(A){A.forEach((function(A){d=A.el.getBoundingClientRect(),A.position={x:t.scroll.x+d.left,y:t.scroll.y+d.top}}))}))};X(window,"resize",(function(){B(A)}));var w=function(){t.scroll=D()};return X(window,"scroll",(function(){B(w)})),t.collections}I.prototype=new j,I.constructor=I,I.prototype.prepareCollections=function(){var d=this;d.collections.create=d.create.bind(d),d.collections.on=d.on.bind(d),d.collections.off=d.off.bind(d),d.collections.destroy=d.destroy.bind(d),d.collections.get=function(t){var A;return d.collections.every((function(d){return!(A=d.get(t))})),A}},I.prototype.create=function(d){return this.createCollection(d)},I.prototype.createCollection=function(d){var t=this,A=new L(t,d);return t.bindCollection(A),t.collections.push(A),A},I.prototype.bindCollection=function(d){var t,A=this,w=function(d,w){t=d.type+" "+w.id+":"+d.type,A.trigger(t,w)};d.on("destroyed",A.onDestroyed.bind(A)),d.on("shown hidden rested dir plain",w),d.on("dir:up dir:right dir:down dir:left",w),d.on("plain:up plain:right plain:down plain:left",w)},I.prototype.bindDocument=function(){var d=this;d.binded||(d.bindEvt(document,"move").bindEvt(document,"end"),d.binded=!0)},I.prototype.unbindDocument=function(d){var t=this;Object.keys(t.ids).length&&!0!==d||(t.unbindEvt(document,"move").unbindEvt(document,"end"),t.binded=!1)},I.prototype.getIdentifier=function(d){var t;return d?void 0===(t=void 0===d.identifier?d.pointerId:d.identifier)&&(t=this.latest||0):t=this.index,void 0===this.ids[t]&&(this.ids[t]=this.index,this.index+=1),this.latest=t,this.ids[t]},I.prototype.removeIdentifier=function(d){var t={};for(var A in this.ids)if(this.ids[A]===d){t.id=A,t.identifier=this.ids[A],delete this.ids[A];break}return t},I.prototype.onmove=function(d){return this.onAny("move",d),!1},I.prototype.onend=function(d){return this.onAny("end",d),!1},I.prototype.oncancel=function(d){return this.onAny("end",d),!1},I.prototype.onAny=function(d,t){var A,w=this,N="processOn"+d.charAt(0).toUpperCase()+d.slice(1);t=a(t);var p=function(d,t,A){A.ids.indexOf(t)>=0&&(A[N](d),d._found_=!0)};return P(t,(function(d){A=w.getIdentifier(d),P(w.collections,p.bind(null,d,A)),d._found_||w.removeIdentifier(A)})),!1},I.prototype.destroy=function(){var d=this;d.unbindDocument(!0),d.ids={},d.index=0,d.collections.forEach((function(d){d.destroy()})),d.off()},I.prototype.onDestroyed=function(d,t){var A=this;if(A.collections.indexOf(t)<0)return!1;A.collections.splice(A.collections.indexOf(t),1)};var u=new I;const V={create:function(d){return u.create(d)},factory:u};return t.default})(),d.exports=t()},10914:(d,t,A)=>{"use strict";const{Deflate:w,deflate:N,deflateRaw:p,gzip:B}=A(10921),{Inflate:X,inflate:W,inflateRaw:a,ungzip:D}=A(10977),i=A(10959);d.exports.Deflate=w,d.exports.deflate=N,d.exports.deflateRaw=p,d.exports.gzip=B,d.exports.Inflate=X,d.exports.inflate=W,d.exports.inflateRaw=a,d.exports.ungzip=D,d.exports.constants=i},10921:(d,t,A)=>{"use strict";const w=A(10925),N=A(10963),p=A(10970),B=A(10952),X=A(10973),W=Object.prototype.toString,{Z_NO_FLUSH:a,Z_SYNC_FLUSH:D,Z_FULL_FLUSH:i,Z_FINISH:k,Z_OK:b,Z_STREAM_END:Q,Z_DEFAULT_COMPRESSION:P,Z_DEFAULT_STRATEGY:J,Z_DEFLATED:U}=A(10959);function T(d){this.options=N.assign({level:P,method:U,Ja:16384,windowBits:15,memLevel:8,strategy:J},d||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let A=w.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(A!==b)throw new Error(B[A]);if(t.header&&w.deflateSetHeader(this.strm,t.header),t.dictionary){let d;if(d="string"===typeof t.dictionary?p.string2buf(t.dictionary):"[object ArrayBuffer]"===W.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,A=w.deflateSetDictionary(this.strm,d),A!==b)throw new Error(B[A]);this._dict_set=!0}}function F(d,t){const A=new T(t);if(A.push(d,!0),A.err)throw A.msg||B[A.err];return A.result}T.prototype.push=function(d,t){const A=this.strm,N=this.options.Ja;let B,X;if(this.ended)return!1;for(X=t===~~t?t:!0===t?k:a,"string"===typeof d?A.input=p.string2buf(d):"[object ArrayBuffer]"===W.call(d)?A.input=new Uint8Array(d):A.input=d,A.next_in=0,A.avail_in=A.input.length;;)if(0===A.avail_out&&(A.output=new Uint8Array(N),A.next_out=0,A.avail_out=N),(X===D||X===i)&&A.avail_out<=6)this.onData(A.output.subarray(0,A.next_out)),A.avail_out=0;else{if(B=w.deflate(A,X),B===Q)return A.next_out>0&&this.onData(A.output.subarray(0,A.next_out)),B=w.deflateEnd(this.strm),this.onEnd(B),this.ended=!0,B===b;if(0!==A.avail_out){if(X>0&&A.next_out>0)this.onData(A.output.subarray(0,A.next_out)),A.avail_out=0;else if(0===A.avail_in)break}else this.onData(A.output)}return!0},T.prototype.onData=function(d){this.chunks.push(d)},T.prototype.onEnd=function(d){d===b&&(this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},d.exports.Deflate=T,d.exports.deflate=F,d.exports.deflateRaw=function(d,t){return(t=t||{}).raw=!0,F(d,t)},d.exports.gzip=function(d,t){return(t=t||{}).gzip=!0,F(d,t)},d.exports.constants=A(10959)},10977:(d,t,A)=>{"use strict";const w=A(10981),N=A(10963),p=A(10970),B=A(10952),X=A(10973),W=A(10996),a=Object.prototype.toString,{Z_NO_FLUSH:D,Z_FINISH:i,Z_OK:k,Z_STREAM_END:b,Z_NEED_DICT:Q,Z_STREAM_ERROR:P,Z_DATA_ERROR:J,Z_MEM_ERROR:U}=A(10959);function T(d){this.options=N.assign({Ja:65536,windowBits:15,to:""},d||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||d&&d.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new X,this.strm.avail_out=0;let A=w.inflateInit2(this.strm,t.windowBits);if(A!==k)throw new Error(B[A]);if(this.header=new W,w.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=p.string2buf(t.dictionary):"[object ArrayBuffer]"===a.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(A=w.inflateSetDictionary(this.strm,t.dictionary),A!==k)))throw new Error(B[A])}function F(d,t){const A=new T(t);if(A.push(d),A.err)throw A.msg||B[A.err];return A.result}T.prototype.push=function(d,t){const A=this.strm,N=this.options.Ja,B=this.options.dictionary;let X,W,T;if(this.ended)return!1;for(W=t===~~t?t:!0===t?i:D,"[object ArrayBuffer]"===a.call(d)?A.input=new Uint8Array(d):A.input=d,A.next_in=0,A.avail_in=A.input.length;;){for(0===A.avail_out&&(A.output=new Uint8Array(N),A.next_out=0,A.avail_out=N),X=w.inflate(A,W),X===Q&&B&&(X=w.inflateSetDictionary(A,B),X===k?X=w.inflate(A,W):X===J&&(X=Q));A.avail_in>0&&X===b&&A.state.wrap>0&&0!==d[A.next_in];)w.inflateReset(A),X=w.inflate(A,W);switch(X){case P:case J:case Q:case U:return this.onEnd(X),this.ended=!0,!1}if(T=A.avail_out,A.next_out&&(0===A.avail_out||X===b))if("string"===this.options.to){let d=p.utf8border(A.output,A.next_out),t=A.next_out-d,w=p.buf2string(A.output,d);A.next_out=t,A.avail_out=N-t,t&&A.output.set(A.output.subarray(d,d+t),0),this.onData(w)}else this.onData(A.output.length===A.next_out?A.output:A.output.subarray(0,A.next_out));if(X!==k||0!==T){if(X===b)return X=w.inflateEnd(this.strm),this.onEnd(X),this.ended=!0,!0;if(0===A.avail_in)break}}return!0},T.prototype.onData=function(d){this.chunks.push(d)},T.prototype.onEnd=function(d){d===k&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=N.flattenChunks(this.chunks)),this.chunks=[],this.err=d,this.msg=this.strm.msg},d.exports.Inflate=T,d.exports.inflate=F,d.exports.inflateRaw=function(d,t){return(t=t||{}).raw=!0,F(d,t)},d.exports.ungzip=F,d.exports.constants=A(10959)},10963:d=>{"use strict";const t=(d,t)=>Object.prototype.hasOwnProperty.call(d,t);d.exports.assign=function(d){const A=Array.prototype.slice.call(arguments,1);for(;A.length;){const w=A.shift();if(w){if("object"!==typeof w)throw new TypeError(w+"must be non-object");for(const A in w)t(w,A)&&(d[A]=w[A])}}return d},d.exports.flattenChunks=d=>{let t=0;for(let w=0,N=d.length;w<N;w++)t+=d[w].length;const A=new Uint8Array(t);for(let w=0,N=0,p=d.length;w<p;w++){let t=d[w];A.set(t,N),N+=t.length}return A}},10970:d=>{"use strict";let t=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(w){t=!1}const A=new Uint8Array(256);for(let N=0;N<256;N++)A[N]=N>=252?6:N>=248?5:N>=240?4:N>=224?3:N>=192?2:1;A[254]=A[254]=1,d.exports.string2buf=d=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(d);let t,A,w,N,p,B=d.length,X=0;for(N=0;N<B;N++)A=d.charCodeAt(N),55296===(64512&A)&&N+1<B&&(w=d.charCodeAt(N+1),56320===(64512&w)&&(A=65536+(A-55296<<10)+(w-56320),N++)),X+=A<128?1:A<2048?2:A<65536?3:4;for(t=new Uint8Array(X),p=0,N=0;p<X;N++)A=d.charCodeAt(N),55296===(64512&A)&&N+1<B&&(w=d.charCodeAt(N+1),56320===(64512&w)&&(A=65536+(A-55296<<10)+(w-56320),N++)),A<128?t[p++]=A:A<2048?(t[p++]=192|A>>>6,t[p++]=128|63&A):A<65536?(t[p++]=224|A>>>12,t[p++]=128|A>>>6&63,t[p++]=128|63&A):(t[p++]=240|A>>>18,t[p++]=128|A>>>12&63,t[p++]=128|A>>>6&63,t[p++]=128|63&A);return t};d.exports.buf2string=(d,w)=>{const N=w||d.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(d.subarray(0,w));let p,B;const X=new Array(2*N);for(B=0,p=0;p<N;){let t=d[p++];if(t<128){X[B++]=t;continue}let w=A[t];if(w>4)X[B++]=65533,p+=w-1;else{for(t&=2===w?31:3===w?15:7;w>1&&p<N;)t=t<<6|63&d[p++],w--;w>1?X[B++]=65533:t<65536?X[B++]=t:(t-=65536,X[B++]=55296|t>>10&1023,X[B++]=56320|1023&t)}}return((d,A)=>{if(A<65534&&d.subarray&&t)return String.fromCharCode.apply(null,d.length===A?d:d.subarray(0,A));let w="";for(let t=0;t<A;t++)w+=String.fromCharCode(d[t]);return w})(X,B)},d.exports.utf8border=(d,t)=>{(t=t||d.length)>d.length&&(t=d.length);let w=t-1;for(;w>=0&&128===(192&d[w]);)w--;return w<0||0===w?t:w+A[d[w]]>t?w:t}},10939:d=>{"use strict";d.exports=(d,t,A,w)=>{let N=65535&d,p=d>>>16&65535,B=0;for(;0!==A;){B=A>2e3?2e3:A,A-=B;do{N=N+t[w++]|0,p=p+N|0}while(--B);N%=65521,p%=65521}return N|p<<16}},10959:d=>{"use strict";d.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},10948:d=>{"use strict";const t=new Uint32Array((()=>{let d,t=[];for(var A=0;A<256;A++){d=A;for(var w=0;w<8;w++)d=1&d?3988292384^d>>>1:d>>>1;t[A]=d}return t})());d.exports=(d,A,w,N)=>{const p=t,B=N+w;d^=-1;for(let t=N;t<B;t++)d=d>>>8^p[255&(d^A[t])];return~d}},10925:(d,t,A)=>{"use strict";const{_tr_init:w,_tr_stored_block:N,_tr_flush_block:p,_tr_tally:B,_tr_align:X}=A(10933),W=A(10939),a=A(10948),D=A(10952),{Z_NO_FLUSH:i,Z_PARTIAL_FLUSH:k,Z_FULL_FLUSH:b,Z_FINISH:Q,Z_BLOCK:P,Z_OK:J,Z_STREAM_END:U,Z_STREAM_ERROR:T,Z_DATA_ERROR:F,Z_BUF_ERROR:q,Z_DEFAULT_COMPRESSION:H,Z_FILTERED:f,Z_HUFFMAN_ONLY:v,Z_RLE:m,Z_FIXED:j,Z_DEFAULT_STRATEGY:n,Z_UNKNOWN:R,Z_DEFLATED:Z}=A(10959),L=258,I=262,u=103,V=113,h=666,l=(d,t)=>(d.msg=D[t],t),y=d=>(d<<1)-(d>4?9:0),s=d=>{let t=d.length;for(;--t>=0;)d[t]=0};let Y=(d,t,A)=>(t<<d.hash_shift^A)&d.hash_mask;const r=d=>{const t=d.state;let A=t.pending;A>d.avail_out&&(A=d.avail_out),0!==A&&(d.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+A),d.next_out),d.next_out+=A,t.pending_out+=A,d.total_out+=A,d.avail_out-=A,t.pending-=A,0===t.pending&&(t.pending_out=0))},K=(d,t)=>{p(d,d.block_start>=0?d.block_start:-1,d.strstart-d.block_start,t),d.block_start=d.strstart,r(d.strm)},G=(d,t)=>{d.pending_buf[d.pending++]=t},O=(d,t)=>{d.pending_buf[d.pending++]=t>>>8&255,d.pending_buf[d.pending++]=255&t},z=(d,t,A,w)=>{let N=d.avail_in;return N>w&&(N=w),0===N?0:(d.avail_in-=N,t.set(d.input.subarray(d.next_in,d.next_in+N),A),1===d.state.wrap?d.adler=W(d.adler,t,N,A):2===d.state.wrap&&(d.adler=a(d.adler,t,N,A)),d.next_in+=N,d.total_in+=N,N)},c=(d,t)=>{let A,w,N=d.max_chain_length,p=d.strstart,B=d.prev_length,X=d.nice_match;const W=d.strstart>d.w_size-I?d.strstart-(d.w_size-I):0,a=d.window,D=d.w_mask,i=d.prev,k=d.strstart+L;let b=a[p+B-1],Q=a[p+B];d.prev_length>=d.good_match&&(N>>=2),X>d.lookahead&&(X=d.lookahead);do{if(A=t,a[A+B]===Q&&a[A+B-1]===b&&a[A]===a[p]&&a[++A]===a[p+1]){p+=2,A++;do{}while(a[++p]===a[++A]&&a[++p]===a[++A]&&a[++p]===a[++A]&&a[++p]===a[++A]&&a[++p]===a[++A]&&a[++p]===a[++A]&&a[++p]===a[++A]&&a[++p]===a[++A]&&p<k);if(w=L-(k-p),p=k-L,w>B){if(d.match_start=t,B=w,w>=X)break;b=a[p+B-1],Q=a[p+B]}}}while((t=i[t&D])>W&&0!==--N);return B<=d.lookahead?B:d.lookahead},e=d=>{const t=d.w_size;let A,w,N,p,B;do{if(p=d.window_size-d.lookahead-d.strstart,d.strstart>=t+(t-I)){d.window.set(d.window.subarray(t,t+t),0),d.match_start-=t,d.strstart-=t,d.block_start-=t,w=d.hash_size,A=w;do{N=d.head[--A],d.head[A]=N>=t?N-t:0}while(--w);w=t,A=w;do{N=d.prev[--A],d.prev[A]=N>=t?N-t:0}while(--w);p+=t}if(0===d.strm.avail_in)break;if(w=z(d.strm,d.window,d.strstart+d.lookahead,p),d.lookahead+=w,d.lookahead+d.insert>=3)for(B=d.strstart-d.insert,d.ins_h=d.window[B],d.ins_h=Y(d,d.ins_h,d.window[B+1]);d.insert&&(d.ins_h=Y(d,d.ins_h,d.window[B+3-1]),d.prev[B&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=B,B++,d.insert--,!(d.lookahead+d.insert<3)););}while(d.lookahead<I&&0!==d.strm.avail_in)},M=(d,t)=>{let A,w;for(;;){if(d.lookahead<I){if(e(d),d.lookahead<I&&t===i)return 1;if(0===d.lookahead)break}if(A=0,d.lookahead>=3&&(d.ins_h=Y(d,d.ins_h,d.window[d.strstart+3-1]),A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),0!==A&&d.strstart-A<=d.w_size-I&&(d.match_length=c(d,A)),d.match_length>=3)if(w=B(d,d.strstart-d.match_start,d.match_length-3),d.lookahead-=d.match_length,d.match_length<=d.max_lazy_match&&d.lookahead>=3){d.match_length--;do{d.strstart++,d.ins_h=Y(d,d.ins_h,d.window[d.strstart+3-1]),A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart}while(0!==--d.match_length);d.strstart++}else d.strstart+=d.match_length,d.match_length=0,d.ins_h=d.window[d.strstart],d.ins_h=Y(d,d.ins_h,d.window[d.strstart+1]);else w=B(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++;if(w&&(K(d,!1),0===d.strm.avail_out))return 1}return d.insert=d.strstart<2?d.strstart:2,t===Q?(K(d,!0),0===d.strm.avail_out?3:4):d.last_lit&&(K(d,!1),0===d.strm.avail_out)?1:2},x=(d,t)=>{let A,w,N;for(;;){if(d.lookahead<I){if(e(d),d.lookahead<I&&t===i)return 1;if(0===d.lookahead)break}if(A=0,d.lookahead>=3&&(d.ins_h=Y(d,d.ins_h,d.window[d.strstart+3-1]),A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart),d.prev_length=d.match_length,d.prev_match=d.match_start,d.match_length=2,0!==A&&d.prev_length<d.max_lazy_match&&d.strstart-A<=d.w_size-I&&(d.match_length=c(d,A),d.match_length<=5&&(d.strategy===f||3===d.match_length&&d.strstart-d.match_start>4096)&&(d.match_length=2)),d.prev_length>=3&&d.match_length<=d.prev_length){N=d.strstart+d.lookahead-3,w=B(d,d.strstart-1-d.prev_match,d.prev_length-3),d.lookahead-=d.prev_length-1,d.prev_length-=2;do{++d.strstart<=N&&(d.ins_h=Y(d,d.ins_h,d.window[d.strstart+3-1]),A=d.prev[d.strstart&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=d.strstart)}while(0!==--d.prev_length);if(d.match_available=0,d.match_length=2,d.strstart++,w&&(K(d,!1),0===d.strm.avail_out))return 1}else if(d.match_available){if(w=B(d,0,d.window[d.strstart-1]),w&&K(d,!1),d.strstart++,d.lookahead--,0===d.strm.avail_out)return 1}else d.match_available=1,d.strstart++,d.lookahead--}return d.match_available&&(w=B(d,0,d.window[d.strstart-1]),d.match_available=0),d.insert=d.strstart<2?d.strstart:2,t===Q?(K(d,!0),0===d.strm.avail_out?3:4):d.last_lit&&(K(d,!1),0===d.strm.avail_out)?1:2};function o(d,t,A,w,N){this.good_length=d,this.max_lazy=t,this.nice_length=A,this.max_chain=w,this.func=N}const C=[new o(0,0,0,0,((d,t)=>{let A=65535;for(A>d.pending_buf_size-5&&(A=d.pending_buf_size-5);;){if(d.lookahead<=1){if(e(d),0===d.lookahead&&t===i)return 1;if(0===d.lookahead)break}d.strstart+=d.lookahead,d.lookahead=0;const w=d.block_start+A;if((0===d.strstart||d.strstart>=w)&&(d.lookahead=d.strstart-w,d.strstart=w,K(d,!1),0===d.strm.avail_out))return 1;if(d.strstart-d.block_start>=d.w_size-I&&(K(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,t===Q?(K(d,!0),0===d.strm.avail_out?3:4):(d.strstart>d.block_start&&(K(d,!1),d.strm.avail_out),1)})),new o(4,4,8,4,M),new o(4,5,16,8,M),new o(4,6,32,32,M),new o(4,4,16,16,x),new o(8,16,32,32,x),new o(8,16,128,128,x),new o(8,32,128,256,x),new o(32,128,258,1024,x),new o(32,258,258,4096,x)];function E(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),s(this.dyn_ltree),s(this.dyn_dtree),s(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),s(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),s(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const g=d=>{if(!d||!d.state)return l(d,T);d.total_in=d.total_out=0,d.data_type=R;const t=d.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:V,d.adler=2===t.wrap?0:1,t.last_flush=i,w(t),J},S=d=>{const t=g(d);var A;return t===J&&((A=d.state).window_size=2*A.w_size,s(A.head),A.max_lazy_match=C[A.level].max_lazy,A.good_match=C[A.level].good_length,A.nice_match=C[A.level].nice_length,A.max_chain_length=C[A.level].max_chain,A.strstart=0,A.block_start=0,A.lookahead=0,A.insert=0,A.match_length=A.prev_length=2,A.match_available=0,A.ins_h=0),t},dd=(d,t,A,w,N,p)=>{if(!d)return T;let B=1;if(t===H&&(t=6),w<0?(B=0,w=-w):w>15&&(B=2,w-=16),N<1||N>9||A!==Z||w<8||w>15||t<0||t>9||p<0||p>j)return l(d,T);8===w&&(w=9);const X=new E;return d.state=X,X.strm=d,X.wrap=B,X.gzhead=null,X.w_bits=w,X.w_size=1<<X.w_bits,X.w_mask=X.w_size-1,X.hash_bits=N+7,X.hash_size=1<<X.hash_bits,X.hash_mask=X.hash_size-1,X.hash_shift=~~((X.hash_bits+3-1)/3),X.window=new Uint8Array(2*X.w_size),X.head=new Uint16Array(X.hash_size),X.prev=new Uint16Array(X.w_size),X.lit_bufsize=1<<N+6,X.pending_buf_size=4*X.lit_bufsize,X.pending_buf=new Uint8Array(X.pending_buf_size),X.d_buf=1*X.lit_bufsize,X.l_buf=3*X.lit_bufsize,X.level=t,X.strategy=p,X.method=A,S(d)};d.exports.deflateInit=(d,t)=>dd(d,t,Z,15,8,n),d.exports.deflateInit2=dd,d.exports.deflateReset=S,d.exports.deflateResetKeep=g,d.exports.deflateSetHeader=(d,t)=>d&&d.state?2!==d.state.wrap?T:(d.state.gzhead=t,J):T,d.exports.deflate=(d,t)=>{let A,w;if(!d||!d.state||t>P||t<0)return d?l(d,T):T;const p=d.state;if(!d.output||!d.input&&0!==d.avail_in||p.status===h&&t!==Q)return l(d,0===d.avail_out?q:T);p.strm=d;const W=p.last_flush;if(p.last_flush=t,42===p.status)if(2===p.wrap)d.adler=0,G(p,31),G(p,139),G(p,8),p.gzhead?(G(p,(p.gzhead.text?1:0)+(p.gzhead.hcrc?2:0)+(p.gzhead.extra?4:0)+(p.gzhead.name?8:0)+(p.gzhead.comment?16:0)),G(p,255&p.gzhead.time),G(p,p.gzhead.time>>8&255),G(p,p.gzhead.time>>16&255),G(p,p.gzhead.time>>24&255),G(p,9===p.level?2:p.strategy>=v||p.level<2?4:0),G(p,255&p.gzhead.os),p.gzhead.extra&&p.gzhead.extra.length&&(G(p,255&p.gzhead.extra.length),G(p,p.gzhead.extra.length>>8&255)),p.gzhead.hcrc&&(d.adler=a(d.adler,p.pending_buf,p.pending,0)),p.gzindex=0,p.status=69):(G(p,0),G(p,0),G(p,0),G(p,0),G(p,0),G(p,9===p.level?2:p.strategy>=v||p.level<2?4:0),G(p,3),p.status=V);else{let t=Z+(p.w_bits-8<<4)<<8,A=-1;A=p.strategy>=v||p.level<2?0:p.level<6?1:6===p.level?2:3,t|=A<<6,0!==p.strstart&&(t|=32),t+=31-t%31,p.status=V,O(p,t),0!==p.strstart&&(O(p,d.adler>>>16),O(p,65535&d.adler)),d.adler=1}if(69===p.status)if(p.gzhead.extra){for(A=p.pending;p.gzindex<(65535&p.gzhead.extra.length)&&(p.pending!==p.pending_buf_size||(p.gzhead.hcrc&&p.pending>A&&(d.adler=a(d.adler,p.pending_buf,p.pending-A,A)),r(d),A=p.pending,p.pending!==p.pending_buf_size));)G(p,255&p.gzhead.extra[p.gzindex]),p.gzindex++;p.gzhead.hcrc&&p.pending>A&&(d.adler=a(d.adler,p.pending_buf,p.pending-A,A)),p.gzindex===p.gzhead.extra.length&&(p.gzindex=0,p.status=73)}else p.status=73;if(73===p.status)if(p.gzhead.name){A=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>A&&(d.adler=a(d.adler,p.pending_buf,p.pending-A,A)),r(d),A=p.pending,p.pending===p.pending_buf_size)){w=1;break}w=p.gzindex<p.gzhead.name.length?255&p.gzhead.name.charCodeAt(p.gzindex++):0,G(p,w)}while(0!==w);p.gzhead.hcrc&&p.pending>A&&(d.adler=a(d.adler,p.pending_buf,p.pending-A,A)),0===w&&(p.gzindex=0,p.status=91)}else p.status=91;if(91===p.status)if(p.gzhead.comment){A=p.pending;do{if(p.pending===p.pending_buf_size&&(p.gzhead.hcrc&&p.pending>A&&(d.adler=a(d.adler,p.pending_buf,p.pending-A,A)),r(d),A=p.pending,p.pending===p.pending_buf_size)){w=1;break}w=p.gzindex<p.gzhead.comment.length?255&p.gzhead.comment.charCodeAt(p.gzindex++):0,G(p,w)}while(0!==w);p.gzhead.hcrc&&p.pending>A&&(d.adler=a(d.adler,p.pending_buf,p.pending-A,A)),0===w&&(p.status=u)}else p.status=u;if(p.status===u&&(p.gzhead.hcrc?(p.pending+2>p.pending_buf_size&&r(d),p.pending+2<=p.pending_buf_size&&(G(p,255&d.adler),G(p,d.adler>>8&255),d.adler=0,p.status=V)):p.status=V),0!==p.pending){if(r(d),0===d.avail_out)return p.last_flush=-1,J}else if(0===d.avail_in&&y(t)<=y(W)&&t!==Q)return l(d,q);if(p.status===h&&0!==d.avail_in)return l(d,q);if(0!==d.avail_in||0!==p.lookahead||t!==i&&p.status!==h){let A=p.strategy===v?((d,t)=>{let A;for(;;){if(0===d.lookahead&&(e(d),0===d.lookahead)){if(t===i)return 1;break}if(d.match_length=0,A=B(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++,A&&(K(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,t===Q?(K(d,!0),0===d.strm.avail_out?3:4):d.last_lit&&(K(d,!1),0===d.strm.avail_out)?1:2})(p,t):p.strategy===m?((d,t)=>{let A,w,N,p;const X=d.window;for(;;){if(d.lookahead<=L){if(e(d),d.lookahead<=L&&t===i)return 1;if(0===d.lookahead)break}if(d.match_length=0,d.lookahead>=3&&d.strstart>0&&(N=d.strstart-1,w=X[N],w===X[++N]&&w===X[++N]&&w===X[++N])){p=d.strstart+L;do{}while(w===X[++N]&&w===X[++N]&&w===X[++N]&&w===X[++N]&&w===X[++N]&&w===X[++N]&&w===X[++N]&&w===X[++N]&&N<p);d.match_length=L-(p-N),d.match_length>d.lookahead&&(d.match_length=d.lookahead)}if(d.match_length>=3?(A=B(d,1,d.match_length-3),d.lookahead-=d.match_length,d.strstart+=d.match_length,d.match_length=0):(A=B(d,0,d.window[d.strstart]),d.lookahead--,d.strstart++),A&&(K(d,!1),0===d.strm.avail_out))return 1}return d.insert=0,t===Q?(K(d,!0),0===d.strm.avail_out?3:4):d.last_lit&&(K(d,!1),0===d.strm.avail_out)?1:2})(p,t):C[p.level].func(p,t);if(3!==A&&4!==A||(p.status=h),1===A||3===A)return 0===d.avail_out&&(p.last_flush=-1),J;if(2===A&&(t===k?X(p):t!==P&&(N(p,0,0,!1),t===b&&(s(p.head),0===p.lookahead&&(p.strstart=0,p.block_start=0,p.insert=0))),r(d),0===d.avail_out))return p.last_flush=-1,J}return t!==Q?J:p.wrap<=0?U:(2===p.wrap?(G(p,255&d.adler),G(p,d.adler>>8&255),G(p,d.adler>>16&255),G(p,d.adler>>24&255),G(p,255&d.total_in),G(p,d.total_in>>8&255),G(p,d.total_in>>16&255),G(p,d.total_in>>24&255)):(O(p,d.adler>>>16),O(p,65535&d.adler)),r(d),p.wrap>0&&(p.wrap=-p.wrap),0!==p.pending?J:U)},d.exports.deflateEnd=d=>{if(!d||!d.state)return T;const t=d.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==u&&t!==V&&t!==h?l(d,T):(d.state=null,t===V?l(d,F):J)},d.exports.deflateSetDictionary=(d,t)=>{let A=t.length;if(!d||!d.state)return T;const w=d.state,N=w.wrap;if(2===N||1===N&&42!==w.status||w.lookahead)return T;if(1===N&&(d.adler=W(d.adler,t,A,0)),w.wrap=0,A>=w.w_size){0===N&&(s(w.head),w.strstart=0,w.block_start=0,w.insert=0);let d=new Uint8Array(w.w_size);d.set(t.subarray(A-w.w_size,A),0),t=d,A=w.w_size}const p=d.avail_in,B=d.next_in,X=d.input;for(d.avail_in=A,d.next_in=0,d.input=t,e(w);w.lookahead>=3;){let d=w.strstart,t=w.lookahead-2;do{w.ins_h=Y(w,w.ins_h,w.window[d+3-1]),w.prev[d&w.w_mask]=w.head[w.ins_h],w.head[w.ins_h]=d,d++}while(--t);w.strstart=d,w.lookahead=2,e(w)}return w.strstart+=w.lookahead,w.block_start=w.strstart,w.insert=w.lookahead,w.lookahead=0,w.match_length=w.prev_length=2,w.match_available=0,d.next_in=B,d.input=X,d.avail_in=p,w.wrap=N,J},d.exports.deflateInfo="pako deflate (from Nodeca project)"},10996:d=>{"use strict";d.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},10985:d=>{"use strict";d.exports=function(d,t){let A,w,N,p,B,X,W,a,D,i,k,b,Q,P,J,U,T,F,q,H,f,v,m,j;const n=d.state;A=d.next_in,m=d.input,w=A+(d.avail_in-5),N=d.next_out,j=d.output,p=N-(t-d.avail_out),B=N+(d.avail_out-257),X=n.dmax,W=n.wsize,a=n.whave,D=n.wnext,i=n.window,k=n.hold,b=n.bits,Q=n.lencode,P=n.distcode,J=(1<<n.lenbits)-1,U=(1<<n.distbits)-1;d:do{b<15&&(k+=m[A++]<<b,b+=8,k+=m[A++]<<b,b+=8),T=Q[k&J];t:for(;;){if(F=T>>>24,k>>>=F,b-=F,F=T>>>16&255,0===F)j[N++]=65535&T;else{if(!(16&F)){if(0===(64&F)){T=Q[(65535&T)+(k&(1<<F)-1)];continue t}if(32&F){n.mode=12;break d}d.msg="invalid literal/length code",n.mode=30;break d}q=65535&T,F&=15,F&&(b<F&&(k+=m[A++]<<b,b+=8),q+=k&(1<<F)-1,k>>>=F,b-=F),b<15&&(k+=m[A++]<<b,b+=8,k+=m[A++]<<b,b+=8),T=P[k&U];A:for(;;){if(F=T>>>24,k>>>=F,b-=F,F=T>>>16&255,!(16&F)){if(0===(64&F)){T=P[(65535&T)+(k&(1<<F)-1)];continue A}d.msg="invalid distance code",n.mode=30;break d}if(H=65535&T,F&=15,b<F&&(k+=m[A++]<<b,b+=8,b<F&&(k+=m[A++]<<b,b+=8)),H+=k&(1<<F)-1,H>X){d.msg="invalid distance too far back",n.mode=30;break d}if(k>>>=F,b-=F,F=N-p,H>F){if(F=H-F,F>a&&n.sane){d.msg="invalid distance too far back",n.mode=30;break d}if(f=0,v=i,0===D){if(f+=W-F,F<q){q-=F;do{j[N++]=i[f++]}while(--F);f=N-H,v=j}}else if(D<F){if(f+=W+D-F,F-=D,F<q){q-=F;do{j[N++]=i[f++]}while(--F);if(f=0,D<q){F=D,q-=F;do{j[N++]=i[f++]}while(--F);f=N-H,v=j}}}else if(f+=D-F,F<q){q-=F;do{j[N++]=i[f++]}while(--F);f=N-H,v=j}for(;q>2;)j[N++]=v[f++],j[N++]=v[f++],j[N++]=v[f++],q-=3;q&&(j[N++]=v[f++],q>1&&(j[N++]=v[f++]))}else{f=N-H;do{j[N++]=j[f++],j[N++]=j[f++],j[N++]=j[f++],q-=3}while(q>2);q&&(j[N++]=j[f++],q>1&&(j[N++]=j[f++]))}break}}break}}while(A<w&&N<B);q=b>>3,A-=q,b-=q<<3,k&=(1<<b)-1,d.next_in=A,d.next_out=N,d.avail_in=A<w?w-A+5:5-(A-w),d.avail_out=N<B?B-N+257:257-(N-B),n.hold=k,n.bits=b}},10981:(d,t,A)=>{"use strict";const w=A(10939),N=A(10948),p=A(10985),B=A(10989),{Z_FINISH:X,Z_BLOCK:W,Z_TREES:a,Z_OK:D,Z_STREAM_END:i,Z_NEED_DICT:k,Z_STREAM_ERROR:b,Z_DATA_ERROR:Q,Z_MEM_ERROR:P,Z_BUF_ERROR:J,Z_DEFLATED:U}=A(10959),T=12,F=30,q=d=>(d>>>24&255)+(d>>>8&65280)+((65280&d)<<8)+((255&d)<<24);function H(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const f=d=>{if(!d||!d.state)return b;const t=d.state;return d.total_in=d.total_out=t.total=0,d.msg="",t.wrap&&(d.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,D},v=d=>{if(!d||!d.state)return b;const t=d.state;return t.wsize=0,t.whave=0,t.wnext=0,f(d)},m=(d,t)=>{let A;if(!d||!d.state)return b;const w=d.state;return t<0?(A=0,t=-t):(A=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?b:(null!==w.window&&w.wbits!==t&&(w.window=null),w.wrap=A,w.wbits=t,v(d))},j=(d,t)=>{if(!d)return b;const A=new H;d.state=A,A.window=null;const w=m(d,t);return w!==D&&(d.state=null),w};let n,R,Z=!0;const L=d=>{if(Z){n=new Int32Array(512),R=new Int32Array(32);let t=0;for(;t<144;)d.lens[t++]=8;for(;t<256;)d.lens[t++]=9;for(;t<280;)d.lens[t++]=7;for(;t<288;)d.lens[t++]=8;for(B(1,d.lens,0,288,n,0,d.work,{bits:9}),t=0;t<32;)d.lens[t++]=5;B(2,d.lens,0,32,R,0,d.work,{bits:5}),Z=!1}d.lencode=n,d.lenbits=9,d.distcode=R,d.distbits=5},I=(d,t,A,w)=>{let N;const p=d.state;return null===p.window&&(p.wsize=1<<p.wbits,p.wnext=0,p.whave=0,p.window=new Uint8Array(p.wsize)),w>=p.wsize?(p.window.set(t.subarray(A-p.wsize,A),0),p.wnext=0,p.whave=p.wsize):(N=p.wsize-p.wnext,N>w&&(N=w),p.window.set(t.subarray(A-w,A-w+N),p.wnext),(w-=N)?(p.window.set(t.subarray(A-w,A),0),p.wnext=w,p.whave=p.wsize):(p.wnext+=N,p.wnext===p.wsize&&(p.wnext=0),p.whave<p.wsize&&(p.whave+=N))),0};d.exports.inflateReset=v,d.exports.inflateReset2=m,d.exports.inflateResetKeep=f,d.exports.inflateInit=d=>j(d,15),d.exports.inflateInit2=j,d.exports.inflate=(d,t)=>{let A,H,f,v,m,j,n,R,Z,u,V,h,l,y,s,Y,r,K,G,O,z,c,e=0;const M=new Uint8Array(4);let x,o;const C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!d||!d.state||!d.output||!d.input&&0!==d.avail_in)return b;A=d.state,A.mode===T&&(A.mode=13),m=d.next_out,f=d.output,n=d.avail_out,v=d.next_in,H=d.input,j=d.avail_in,R=A.hold,Z=A.bits,u=j,V=n,c=D;d:for(;;)switch(A.mode){case 1:if(0===A.wrap){A.mode=13;break}for(;Z<16;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(2&A.wrap&&35615===R){A.check=0,M[0]=255&R,M[1]=R>>>8&255,A.check=N(A.check,M,2,0),R=0,Z=0,A.mode=2;break}if(A.flags=0,A.head&&(A.head.done=!1),!(1&A.wrap)||(((255&R)<<8)+(R>>8))%31){d.msg="incorrect header check",A.mode=F;break}if((15&R)!==U){d.msg="unknown compression method",A.mode=F;break}if(R>>>=4,Z-=4,z=8+(15&R),0===A.wbits)A.wbits=z;else if(z>A.wbits){d.msg="invalid window size",A.mode=F;break}A.dmax=1<<A.wbits,d.adler=A.check=1,A.mode=512&R?10:T,R=0,Z=0;break;case 2:for(;Z<16;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(A.flags=R,(255&A.flags)!==U){d.msg="unknown compression method",A.mode=F;break}if(57344&A.flags){d.msg="unknown header flags set",A.mode=F;break}A.head&&(A.head.text=R>>8&1),512&A.flags&&(M[0]=255&R,M[1]=R>>>8&255,A.check=N(A.check,M,2,0)),R=0,Z=0,A.mode=3;case 3:for(;Z<32;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}A.head&&(A.head.time=R),512&A.flags&&(M[0]=255&R,M[1]=R>>>8&255,M[2]=R>>>16&255,M[3]=R>>>24&255,A.check=N(A.check,M,4,0)),R=0,Z=0,A.mode=4;case 4:for(;Z<16;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}A.head&&(A.head.xflags=255&R,A.head.os=R>>8),512&A.flags&&(M[0]=255&R,M[1]=R>>>8&255,A.check=N(A.check,M,2,0)),R=0,Z=0,A.mode=5;case 5:if(1024&A.flags){for(;Z<16;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}A.length=R,A.head&&(A.head.extra_len=R),512&A.flags&&(M[0]=255&R,M[1]=R>>>8&255,A.check=N(A.check,M,2,0)),R=0,Z=0}else A.head&&(A.head.extra=null);A.mode=6;case 6:if(1024&A.flags&&(h=A.length,h>j&&(h=j),h&&(A.head&&(z=A.head.extra_len-A.length,A.head.extra||(A.head.extra=new Uint8Array(A.head.extra_len)),A.head.extra.set(H.subarray(v,v+h),z)),512&A.flags&&(A.check=N(A.check,H,h,v)),j-=h,v+=h,A.length-=h),A.length))break d;A.length=0,A.mode=7;case 7:if(2048&A.flags){if(0===j)break d;h=0;do{z=H[v+h++],A.head&&z&&A.length<65536&&(A.head.name+=String.fromCharCode(z))}while(z&&h<j);if(512&A.flags&&(A.check=N(A.check,H,h,v)),j-=h,v+=h,z)break d}else A.head&&(A.head.name=null);A.length=0,A.mode=8;case 8:if(4096&A.flags){if(0===j)break d;h=0;do{z=H[v+h++],A.head&&z&&A.length<65536&&(A.head.comment+=String.fromCharCode(z))}while(z&&h<j);if(512&A.flags&&(A.check=N(A.check,H,h,v)),j-=h,v+=h,z)break d}else A.head&&(A.head.comment=null);A.mode=9;case 9:if(512&A.flags){for(;Z<16;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(R!==(65535&A.check)){d.msg="header crc mismatch",A.mode=F;break}R=0,Z=0}A.head&&(A.head.hcrc=A.flags>>9&1,A.head.done=!0),d.adler=A.check=0,A.mode=T;break;case 10:for(;Z<32;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}d.adler=A.check=q(R),R=0,Z=0,A.mode=11;case 11:if(0===A.havedict)return d.next_out=m,d.avail_out=n,d.next_in=v,d.avail_in=j,A.hold=R,A.bits=Z,k;d.adler=A.check=1,A.mode=T;case T:if(t===W||t===a)break d;case 13:if(A.last){R>>>=7&Z,Z-=7&Z,A.mode=27;break}for(;Z<3;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}switch(A.last=1&R,R>>>=1,Z-=1,3&R){case 0:A.mode=14;break;case 1:if(L(A),A.mode=20,t===a){R>>>=2,Z-=2;break d}break;case 2:A.mode=17;break;case 3:d.msg="invalid block type",A.mode=F}R>>>=2,Z-=2;break;case 14:for(R>>>=7&Z,Z-=7&Z;Z<32;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if((65535&R)!==(R>>>16^65535)){d.msg="invalid stored block lengths",A.mode=F;break}if(A.length=65535&R,R=0,Z=0,A.mode=15,t===a)break d;case 15:A.mode=16;case 16:if(h=A.length,h){if(h>j&&(h=j),h>n&&(h=n),0===h)break d;f.set(H.subarray(v,v+h),m),j-=h,v+=h,n-=h,m+=h,A.length-=h;break}A.mode=T;break;case 17:for(;Z<14;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(A.nlen=257+(31&R),R>>>=5,Z-=5,A.ndist=1+(31&R),R>>>=5,Z-=5,A.ncode=4+(15&R),R>>>=4,Z-=4,A.nlen>286||A.ndist>30){d.msg="too many length or distance symbols",A.mode=F;break}A.have=0,A.mode=18;case 18:for(;A.have<A.ncode;){for(;Z<3;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}A.lens[C[A.have++]]=7&R,R>>>=3,Z-=3}for(;A.have<19;)A.lens[C[A.have++]]=0;if(A.lencode=A.lendyn,A.lenbits=7,x={bits:A.lenbits},c=B(0,A.lens,0,19,A.lencode,0,A.work,x),A.lenbits=x.bits,c){d.msg="invalid code lengths set",A.mode=F;break}A.have=0,A.mode=19;case 19:for(;A.have<A.nlen+A.ndist;){for(;e=A.lencode[R&(1<<A.lenbits)-1],s=e>>>24,Y=e>>>16&255,r=65535&e,!(s<=Z);){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(r<16)R>>>=s,Z-=s,A.lens[A.have++]=r;else{if(16===r){for(o=s+2;Z<o;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(R>>>=s,Z-=s,0===A.have){d.msg="invalid bit length repeat",A.mode=F;break}z=A.lens[A.have-1],h=3+(3&R),R>>>=2,Z-=2}else if(17===r){for(o=s+3;Z<o;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}R>>>=s,Z-=s,z=0,h=3+(7&R),R>>>=3,Z-=3}else{for(o=s+7;Z<o;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}R>>>=s,Z-=s,z=0,h=11+(127&R),R>>>=7,Z-=7}if(A.have+h>A.nlen+A.ndist){d.msg="invalid bit length repeat",A.mode=F;break}for(;h--;)A.lens[A.have++]=z}}if(A.mode===F)break;if(0===A.lens[256]){d.msg="invalid code -- missing end-of-block",A.mode=F;break}if(A.lenbits=9,x={bits:A.lenbits},c=B(1,A.lens,0,A.nlen,A.lencode,0,A.work,x),A.lenbits=x.bits,c){d.msg="invalid literal/lengths set",A.mode=F;break}if(A.distbits=6,A.distcode=A.distdyn,x={bits:A.distbits},c=B(2,A.lens,A.nlen,A.ndist,A.distcode,0,A.work,x),A.distbits=x.bits,c){d.msg="invalid distances set",A.mode=F;break}if(A.mode=20,t===a)break d;case 20:A.mode=21;case 21:if(j>=6&&n>=258){d.next_out=m,d.avail_out=n,d.next_in=v,d.avail_in=j,A.hold=R,A.bits=Z,p(d,V),m=d.next_out,f=d.output,n=d.avail_out,v=d.next_in,H=d.input,j=d.avail_in,R=A.hold,Z=A.bits,A.mode===T&&(A.back=-1);break}for(A.back=0;e=A.lencode[R&(1<<A.lenbits)-1],s=e>>>24,Y=e>>>16&255,r=65535&e,!(s<=Z);){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(Y&&0===(240&Y)){for(K=s,G=Y,O=r;e=A.lencode[O+((R&(1<<K+G)-1)>>K)],s=e>>>24,Y=e>>>16&255,r=65535&e,!(K+s<=Z);){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}R>>>=K,Z-=K,A.back+=K}if(R>>>=s,Z-=s,A.back+=s,A.length=r,0===Y){A.mode=26;break}if(32&Y){A.back=-1,A.mode=T;break}if(64&Y){d.msg="invalid literal/length code",A.mode=F;break}A.extra=15&Y,A.mode=22;case 22:if(A.extra){for(o=A.extra;Z<o;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}A.length+=R&(1<<A.extra)-1,R>>>=A.extra,Z-=A.extra,A.back+=A.extra}A.was=A.length,A.mode=23;case 23:for(;e=A.distcode[R&(1<<A.distbits)-1],s=e>>>24,Y=e>>>16&255,r=65535&e,!(s<=Z);){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(0===(240&Y)){for(K=s,G=Y,O=r;e=A.distcode[O+((R&(1<<K+G)-1)>>K)],s=e>>>24,Y=e>>>16&255,r=65535&e,!(K+s<=Z);){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}R>>>=K,Z-=K,A.back+=K}if(R>>>=s,Z-=s,A.back+=s,64&Y){d.msg="invalid distance code",A.mode=F;break}A.offset=r,A.extra=15&Y,A.mode=24;case 24:if(A.extra){for(o=A.extra;Z<o;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}A.offset+=R&(1<<A.extra)-1,R>>>=A.extra,Z-=A.extra,A.back+=A.extra}if(A.offset>A.dmax){d.msg="invalid distance too far back",A.mode=F;break}A.mode=25;case 25:if(0===n)break d;if(h=V-n,A.offset>h){if(h=A.offset-h,h>A.whave&&A.sane){d.msg="invalid distance too far back",A.mode=F;break}h>A.wnext?(h-=A.wnext,l=A.wsize-h):l=A.wnext-h,h>A.length&&(h=A.length),y=A.window}else y=f,l=m-A.offset,h=A.length;h>n&&(h=n),n-=h,A.length-=h;do{f[m++]=y[l++]}while(--h);0===A.length&&(A.mode=21);break;case 26:if(0===n)break d;f[m++]=A.length,n--,A.mode=21;break;case 27:if(A.wrap){for(;Z<32;){if(0===j)break d;j--,R|=H[v++]<<Z,Z+=8}if(V-=n,d.total_out+=V,A.total+=V,V&&(d.adler=A.check=A.flags?N(A.check,f,V,m-V):w(A.check,f,V,m-V)),V=n,(A.flags?R:q(R))!==A.check){d.msg="incorrect data check",A.mode=F;break}R=0,Z=0}A.mode=28;case 28:if(A.wrap&&A.flags){for(;Z<32;){if(0===j)break d;j--,R+=H[v++]<<Z,Z+=8}if(R!==(4294967295&A.total)){d.msg="incorrect length check",A.mode=F;break}R=0,Z=0}A.mode=29;case 29:c=i;break d;case F:c=Q;break d;case 31:return P;default:return b}return d.next_out=m,d.avail_out=n,d.next_in=v,d.avail_in=j,A.hold=R,A.bits=Z,(A.wsize||V!==d.avail_out&&A.mode<F&&(A.mode<27||t!==X))&&I(d,d.output,d.next_out,V-d.avail_out)?(A.mode=31,P):(u-=d.avail_in,V-=d.avail_out,d.total_in+=u,d.total_out+=V,A.total+=V,A.wrap&&V&&(d.adler=A.check=A.flags?N(A.check,f,V,d.next_out-V):w(A.check,f,V,d.next_out-V)),d.data_type=A.bits+(A.last?64:0)+(A.mode===T?128:0)+(20===A.mode||15===A.mode?256:0),(0===u&&0===V||t===X)&&c===D&&(c=J),c)},d.exports.inflateEnd=d=>{if(!d||!d.state)return b;let t=d.state;return t.window&&(t.window=null),d.state=null,D},d.exports.inflateGetHeader=(d,t)=>{if(!d||!d.state)return b;const A=d.state;return 0===(2&A.wrap)?b:(A.head=t,t.done=!1,D)},d.exports.inflateSetDictionary=(d,t)=>{const A=t.length;let N,p,B;return d&&d.state?(N=d.state,0!==N.wrap&&11!==N.mode?b:11===N.mode&&(p=1,p=w(p,t,A,0),p!==N.check)?Q:(B=I(d,t,A,A),B?(N.mode=31,P):(N.havedict=1,D))):b},d.exports.inflateInfo="pako inflate (from Nodeca project)"},10989:d=>{"use strict";const t=15,A=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),w=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),N=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),p=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);d.exports=(d,B,X,W,a,D,i,k)=>{const b=k.bits;let Q,P,J,U,T,F,q=0,H=0,f=0,v=0,m=0,j=0,n=0,R=0,Z=0,L=0,I=null,u=0;const V=new Uint16Array(16),h=new Uint16Array(16);let l,y,s,Y=null,r=0;for(q=0;q<=t;q++)V[q]=0;for(H=0;H<W;H++)V[B[X+H]]++;for(m=b,v=t;v>=1&&0===V[v];v--);if(m>v&&(m=v),0===v)return a[D++]=20971520,a[D++]=20971520,k.bits=1,0;for(f=1;f<v&&0===V[f];f++);for(m<f&&(m=f),R=1,q=1;q<=t;q++)if(R<<=1,R-=V[q],R<0)return-1;if(R>0&&(0===d||1!==v))return-1;for(h[1]=0,q=1;q<t;q++)h[q+1]=h[q]+V[q];for(H=0;H<W;H++)0!==B[X+H]&&(i[h[B[X+H]]++]=H);if(0===d?(I=Y=i,F=19):1===d?(I=A,u-=257,Y=w,r-=257,F=256):(I=N,Y=p,F=-1),L=0,H=0,q=f,T=D,j=m,n=0,J=-1,Z=1<<m,U=Z-1,1===d&&Z>852||2===d&&Z>592)return 1;for(;;){l=q-n,i[H]<F?(y=0,s=i[H]):i[H]>F?(y=Y[r+i[H]],s=I[u+i[H]]):(y=96,s=0),Q=1<<q-n,P=1<<j,f=P;do{P-=Q,a[T+(L>>n)+P]=l<<24|y<<16|s}while(0!==P);for(Q=1<<q-1;L&Q;)Q>>=1;if(0!==Q?(L&=Q-1,L+=Q):L=0,H++,0===--V[q]){if(q===v)break;q=B[X+i[H]]}if(q>m&&(L&U)!==J){for(0===n&&(n=m),T+=f,j=q-n,R=1<<j;j+n<v&&(R-=V[j+n],!(R<=0));)j++,R<<=1;if(Z+=1<<j,1===d&&Z>852||2===d&&Z>592)return 1;J=L&U,a[J]=m<<24|j<<16|T-D}}return 0!==L&&(a[T+L]=q-n<<24|64<<16),k.bits=m,0}},10952:d=>{"use strict";d.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10933:d=>{"use strict";function t(d){let t=d.length;for(;--t>=0;)d[t]=0}const A=256,w=286,N=30,p=15,B=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),X=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),W=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),a=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),D=new Array(576);t(D);const i=new Array(60);t(i);const k=new Array(512);t(k);const b=new Array(256);t(b);const Q=new Array(29);t(Q);const P=new Array(N);function J(d,t,A,w,N){this.static_tree=d,this.extra_bits=t,this.extra_base=A,this.elems=w,this.max_length=N,this.has_stree=d&&d.length}let U,T,F;function q(d,t){this.dyn_tree=d,this.max_code=0,this.stat_desc=t}t(P);const H=d=>d<256?k[d]:k[256+(d>>>7)],f=(d,t)=>{d.pending_buf[d.pending++]=255&t,d.pending_buf[d.pending++]=t>>>8&255},v=(d,t,A)=>{d.bi_valid>16-A?(d.bi_buf|=t<<d.bi_valid&65535,f(d,d.bi_buf),d.bi_buf=t>>16-d.bi_valid,d.bi_valid+=A-16):(d.bi_buf|=t<<d.bi_valid&65535,d.bi_valid+=A)},m=(d,t,A)=>{v(d,A[2*t],A[2*t+1])},j=(d,t)=>{let A=0;do{A|=1&d,d>>>=1,A<<=1}while(--t>0);return A>>>1},n=(d,t,A)=>{const w=new Array(16);let N,B,X=0;for(N=1;N<=p;N++)w[N]=X=X+A[N-1]<<1;for(B=0;B<=t;B++){let t=d[2*B+1];0!==t&&(d[2*B]=j(w[t]++,t))}},R=d=>{let t;for(t=0;t<w;t++)d.dyn_ltree[2*t]=0;for(t=0;t<N;t++)d.dyn_dtree[2*t]=0;for(t=0;t<19;t++)d.bl_tree[2*t]=0;d.dyn_ltree[512]=1,d.opt_len=d.static_len=0,d.last_lit=d.matches=0},Z=d=>{d.bi_valid>8?f(d,d.bi_buf):d.bi_valid>0&&(d.pending_buf[d.pending++]=d.bi_buf),d.bi_buf=0,d.bi_valid=0},L=(d,t,A,w)=>{const N=2*t,p=2*A;return d[N]<d[p]||d[N]===d[p]&&w[t]<=w[A]},I=(d,t,A)=>{const w=d.heap[A];let N=A<<1;for(;N<=d.heap_len&&(N<d.heap_len&&L(t,d.heap[N+1],d.heap[N],d.depth)&&N++,!L(t,w,d.heap[N],d.depth));)d.heap[A]=d.heap[N],A=N,N<<=1;d.heap[A]=w},u=(d,t,w)=>{let N,p,W,a,D=0;if(0!==d.last_lit)do{N=d.pending_buf[d.d_buf+2*D]<<8|d.pending_buf[d.d_buf+2*D+1],p=d.pending_buf[d.l_buf+D],D++,0===N?m(d,p,t):(W=b[p],m(d,W+A+1,t),a=B[W],0!==a&&(p-=Q[W],v(d,p,a)),N--,W=H(N),m(d,W,w),a=X[W],0!==a&&(N-=P[W],v(d,N,a)))}while(D<d.last_lit);m(d,256,t)},V=(d,t)=>{const A=t.dyn_tree,w=t.stat_desc.static_tree,N=t.stat_desc.has_stree,B=t.stat_desc.elems;let X,W,a,D=-1;for(d.heap_len=0,d.heap_max=573,X=0;X<B;X++)0!==A[2*X]?(d.heap[++d.heap_len]=D=X,d.depth[X]=0):A[2*X+1]=0;for(;d.heap_len<2;)a=d.heap[++d.heap_len]=D<2?++D:0,A[2*a]=1,d.depth[a]=0,d.opt_len--,N&&(d.static_len-=w[2*a+1]);for(t.max_code=D,X=d.heap_len>>1;X>=1;X--)I(d,A,X);a=B;do{X=d.heap[1],d.heap[1]=d.heap[d.heap_len--],I(d,A,1),W=d.heap[1],d.heap[--d.heap_max]=X,d.heap[--d.heap_max]=W,A[2*a]=A[2*X]+A[2*W],d.depth[a]=(d.depth[X]>=d.depth[W]?d.depth[X]:d.depth[W])+1,A[2*X+1]=A[2*W+1]=a,d.heap[1]=a++,I(d,A,1)}while(d.heap_len>=2);d.heap[--d.heap_max]=d.heap[1],((d,t)=>{const A=t.dyn_tree,w=t.max_code,N=t.stat_desc.static_tree,B=t.stat_desc.has_stree,X=t.stat_desc.extra_bits,W=t.stat_desc.extra_base,a=t.stat_desc.max_length;let D,i,k,b,Q,P,J=0;for(b=0;b<=p;b++)d.bl_count[b]=0;for(A[2*d.heap[d.heap_max]+1]=0,D=d.heap_max+1;D<573;D++)i=d.heap[D],b=A[2*A[2*i+1]+1]+1,b>a&&(b=a,J++),A[2*i+1]=b,i>w||(d.bl_count[b]++,Q=0,i>=W&&(Q=X[i-W]),P=A[2*i],d.opt_len+=P*(b+Q),B&&(d.static_len+=P*(N[2*i+1]+Q)));if(0!==J){do{for(b=a-1;0===d.bl_count[b];)b--;d.bl_count[b]--,d.bl_count[b+1]+=2,d.bl_count[a]--,J-=2}while(J>0);for(b=a;0!==b;b--)for(i=d.bl_count[b];0!==i;)k=d.heap[--D],k>w||(A[2*k+1]!==b&&(d.opt_len+=(b-A[2*k+1])*A[2*k],A[2*k+1]=b),i--)}})(d,t),n(A,D,d.bl_count)},h=(d,t,A)=>{let w,N,p=-1,B=t[1],X=0,W=7,a=4;for(0===B&&(W=138,a=3),t[2*(A+1)+1]=65535,w=0;w<=A;w++)N=B,B=t[2*(w+1)+1],++X<W&&N===B||(X<a?d.bl_tree[2*N]+=X:0!==N?(N!==p&&d.bl_tree[2*N]++,d.bl_tree[32]++):X<=10?d.bl_tree[34]++:d.bl_tree[36]++,X=0,p=N,0===B?(W=138,a=3):N===B?(W=6,a=3):(W=7,a=4))},l=(d,t,A)=>{let w,N,p=-1,B=t[1],X=0,W=7,a=4;for(0===B&&(W=138,a=3),w=0;w<=A;w++)if(N=B,B=t[2*(w+1)+1],!(++X<W&&N===B)){if(X<a)do{m(d,N,d.bl_tree)}while(0!==--X);else 0!==N?(N!==p&&(m(d,N,d.bl_tree),X--),m(d,16,d.bl_tree),v(d,X-3,2)):X<=10?(m(d,17,d.bl_tree),v(d,X-3,3)):(m(d,18,d.bl_tree),v(d,X-11,7));X=0,p=N,0===B?(W=138,a=3):N===B?(W=6,a=3):(W=7,a=4)}};let y=!1;const s=(d,t,A,w)=>{v(d,0+(w?1:0),3),((d,t,A,w)=>{Z(d),w&&(f(d,A),f(d,~A)),d.pending_buf.set(d.window.subarray(t,t+A),d.pending),d.pending+=A})(d,t,A,!0)};d.exports._tr_init=d=>{y||((()=>{let d,t,A,a,q;const H=new Array(16);for(A=0,a=0;a<28;a++)for(Q[a]=A,d=0;d<1<<B[a];d++)b[A++]=a;for(b[A-1]=a,q=0,a=0;a<16;a++)for(P[a]=q,d=0;d<1<<X[a];d++)k[q++]=a;for(q>>=7;a<N;a++)for(P[a]=q<<7,d=0;d<1<<X[a]-7;d++)k[256+q++]=a;for(t=0;t<=p;t++)H[t]=0;for(d=0;d<=143;)D[2*d+1]=8,d++,H[8]++;for(;d<=255;)D[2*d+1]=9,d++,H[9]++;for(;d<=279;)D[2*d+1]=7,d++,H[7]++;for(;d<=287;)D[2*d+1]=8,d++,H[8]++;for(n(D,287,H),d=0;d<N;d++)i[2*d+1]=5,i[2*d]=j(d,5);U=new J(D,B,257,w,p),T=new J(i,X,0,N,p),F=new J(new Array(0),W,0,19,7)})(),y=!0),d.l_desc=new q(d.dyn_ltree,U),d.d_desc=new q(d.dyn_dtree,T),d.bl_desc=new q(d.bl_tree,F),d.bi_buf=0,d.bi_valid=0,R(d)},d.exports._tr_stored_block=s,d.exports._tr_flush_block=(d,t,w,N)=>{let p,B,X=0;d.level>0?(2===d.strm.data_type&&(d.strm.data_type=(d=>{let t,w=4093624447;for(t=0;t<=31;t++,w>>>=1)if(1&w&&0!==d.dyn_ltree[2*t])return 0;if(0!==d.dyn_ltree[18]||0!==d.dyn_ltree[20]||0!==d.dyn_ltree[26])return 1;for(t=32;t<A;t++)if(0!==d.dyn_ltree[2*t])return 1;return 0})(d)),V(d,d.l_desc),V(d,d.d_desc),X=(d=>{let t;for(h(d,d.dyn_ltree,d.l_desc.max_code),h(d,d.dyn_dtree,d.d_desc.max_code),V(d,d.bl_desc),t=18;t>=3&&0===d.bl_tree[2*a[t]+1];t--);return d.opt_len+=3*(t+1)+5+5+4,t})(d),p=d.opt_len+3+7>>>3,B=d.static_len+3+7>>>3,B<=p&&(p=B)):p=B=w+5,w+4<=p&&-1!==t?s(d,t,w,N):4===d.strategy||B===p?(v(d,2+(N?1:0),3),u(d,D,i)):(v(d,4+(N?1:0),3),((d,t,A,w)=>{let N;for(v(d,t-257,5),v(d,A-1,5),v(d,w-4,4),N=0;N<w;N++)v(d,d.bl_tree[2*a[N]+1],3);l(d,d.dyn_ltree,t-1),l(d,d.dyn_dtree,A-1)})(d,d.l_desc.max_code+1,d.d_desc.max_code+1,X+1),u(d,d.dyn_ltree,d.dyn_dtree)),R(d),N&&Z(d)},d.exports._tr_tally=(d,t,w)=>(d.pending_buf[d.d_buf+2*d.last_lit]=t>>>8&255,d.pending_buf[d.d_buf+2*d.last_lit+1]=255&t,d.pending_buf[d.l_buf+d.last_lit]=255&w,d.last_lit++,0===t?d.dyn_ltree[2*w]++:(d.matches++,t--,d.dyn_ltree[2*(b[w]+A+1)]++,d.dyn_dtree[2*H(t)]++),d.last_lit===d.lit_bufsize-1),d.exports._tr_align=d=>{v(d,2,3),m(d,256,D),(d=>{16===d.bi_valid?(f(d,d.bi_buf),d.bi_buf=0,d.bi_valid=0):d.bi_valid>=8&&(d.pending_buf[d.pending++]=255&d.bi_buf,d.bi_buf>>=8,d.bi_valid-=8)})(d)}},10973:d=>{"use strict";d.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11981:d=>{function t(d,t,A){for(var w=d.length,N=-1/0,p=1/0,B=0;B<w;B++){var X=(A[0][B]-d[B])/t[B],W=(A[1][B]-d[B])/t[B];if(X>W){var a=X;X=W,W=a}if(W<N||X>p)return 1/0;X>N&&(N=X),W<p&&(p=W)}return N>p?1/0:N}d.exports=function(d,A,w,N){var p=t(A,w,N);if(p===1/0)d=null;else{d=d||[];for(var B=0;B<A.length;B++)d[B]=A[B]+w[B]*p}return d},d.exports.distance=t},12470:(d,t,A)=>{"use strict";A.d(t,{b:()=>B});var w=A(32);const N=w.useLayoutEffect;const p=function(d){var t=(0,w.useRef)(d);return N((function(){t.current=d})),t};var B=function(d){var t=p(d);(0,w.useEffect)((function(){var d=function(d){var A;if(null!=t.current&&(A=t.current(d)),d.defaultPrevented&&(d.returnValue=""),"string"===typeof A)return d.returnValue=A,A};return window.addEventListener("beforeunload",d),function(){window.removeEventListener("beforeunload",d)}}),[])}},12428:(d,t,A)=>{"use strict";var w=A(12430),N=Array.prototype.concat,p=Array.prototype.slice,B=d.exports=function(d){for(var t=[],A=0,B=d.length;A<B;A++){var X=d[A];w(X)?t=N.call(t,p.call(X)):t.push(X)}return t};B.wrap=function(d){return function(){return d(B(arguments))}}},12430:d=>{d.exports=function(d){return!(!d||"string"===typeof d)&&(d instanceof Array||Array.isArray(d)||d.length>=0&&(d.splice instanceof Function||Object.getOwnPropertyDescriptor(d,d.length-1)&&"String"!==d.constructor.name))}},12367:d=>{"use strict";var t=[],A=[],w=[],N=[],p=[],B=[],X=[],W=[],a=[],D=[],i=[],k=[];d.exports=function(d,b,Q,P,J,U){for(var T=X,F=a,q=D,H=k,f=0;f<3;f++)T[f]=+Q[f],q[f]=+b.max[f],F[f]=+b.base[f];U||(U=1e-10);var v=function(d,X,a,D,k,b){var Q=t,P=A,J=w,U=N,T=p,F=B,q=W,H=Math.floor,f=0,v=0,m=0,j=0,n=0;if(R(),0===m)return 0;for(j=I();v<=m;){if(Z(j)&&L())return f;j=I()}for(f+=m,n=0;n<3;n++)D[n]+=a[n],k[n]+=a[n];return f;function R(){if(v=0,0!==(m=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])))for(var d=0;d<3;d++){var t=a[d]>=0;U[d]=t?1:-1;var A=t?k[d]:D[d];Q[d]=t?D[d]:k[d],P[d]=u(A,U[d]),J[d]=V(Q[d],U[d]),q[d]=a[d]/m,T[d]=Math.abs(1/q[d]);var w=t?P[d]+1-A:A-P[d];F[d]=T[d]<1/0?T[d]*w:1/0}}function Z(t){for(var A=U[0],w=0===t?P[0]:J[0],N=P[0]+A,p=U[1],B=1===t?P[1]:J[1],X=P[1]+p,W=U[2],a=2===t?P[2]:J[2],D=P[2]+W,i=w;i!=N;i+=A)for(var k=B;k!=X;k+=p)for(var b=a;b!=D;b+=W)if(d(i,k,b))return!0;return!1}function L(){f+=v;var d=U[j],t=v/m,A=i;for(n=0;n<3;n++){var w=a[n]*t;D[n]+=w,k[n]+=w,A[n]=a[n]-w}if(d>0?k[j]=Math.round(k[j]):D[j]=Math.round(D[j]),X(f,j,d,A))return!0;for(n=0;n<3;n++)a[n]=A[n];return R(),0===m}function I(){var d=F[0]<F[1]?F[0]<F[2]?0:2:F[1]<F[2]?1:2,t=F[d]-v;for(v=F[d],P[d]+=U[d],F[d]+=T[d],n=0;n<3;n++)Q[n]+=t*q[n],J[n]=V(Q[n],U[n]);return d}function u(d,t){return H(d-t*b)}function V(d,t){return H(d+t*b)}}(d,P,T,F,q,U);if(!J){for(f=0;f<3;f++)H[f]=Q[f]>0?q[f]-b.max[f]:F[f]-b.base[f];b.translate(H)}return v}},10697:(d,t,A)=>{var w=A(10702);function N(d){for(var t,A,N=0,p=d.length,B=0;B<d.length;){for(t=d[B],A=0;B<p&&d[B]===t;)++B,++A;N+=w.log2(A)/7|0,N+=w.log2(t>>>0)/7|0,N+=2}return N}t.size=N,t.encode=function(d,t){t||(t=new Uint8Array(N(d)));for(var A,w,p=0,B=t.length,X=0;X<d.length;){for(A=d[X],w=0;X<d.length&&d[X]===A;)++X,++w;for(;p<B&&w>=128;)t[p++]=128+(127&w),w>>>=7;if(p>=B)throw new Error("RLE buffer overflow");for(t[p++]=w,A>>>=0;p<B&&A>=128;)t[p++]=128+(127&A),A>>>=7;if(p>=B)throw new Error("RLE buffer overflow");t[p++]=A}return t},t.decode=function(d,t){for(var A,w,N,p,B=t.length,X=d.length,W=0,a=0;a<X;){for(A=0,w=0;a<X&&d[a]>=128;)A+=(127&d[a++])<<w,w+=7;if(A+=d[a++]<<w,a>=X)throw new Error("RLE buffer underrun");if(W+A>B)throw new Error("Chunk buffer overflow");for(N=0,w=0;a<X&&d[a]>=128;)N+=(127&d[a++])<<w,w+=7;if(a>=X)throw new Error("RLE buffer underrun");for(N+=d[a++]<<w,p=0;p<A;++p)t[W++]=N}return t}},10702:(d,t)=>{"use strict";function A(d){var t=32;return(d&=-d)&&t--,65535&d&&(t-=16),16711935&d&&(t-=8),252645135&d&&(t-=4),858993459&d&&(t-=2),1431655765&d&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(d){return(d>0)-(d<0)},t.abs=function(d){var t=d>>31;return(d^t)-t},t.min=function(d,t){return t^(d^t)&-(d<t)},t.max=function(d,t){return d^(d^t)&-(d<t)},t.isPow2=function(d){return!(d&d-1)&&!!d},t.log2=function(d){var t,A;return t=(d>65535)<<4,t|=A=((d>>>=t)>255)<<3,t|=A=((d>>>=A)>15)<<2,(t|=A=((d>>>=A)>3)<<1)|(d>>>=A)>>1},t.log10=function(d){return d>=1e9?9:d>=1e8?8:d>=1e7?7:d>=1e6?6:d>=1e5?5:d>=1e4?4:d>=1e3?3:d>=100?2:d>=10?1:0},t.popCount=function(d){return 16843009*((d=(858993459&(d-=d>>>1&1431655765))+(d>>>2&858993459))+(d>>>4)&252645135)>>>24},t.countTrailingZeros=A,t.nextPow2=function(d){return d+=0===d,--d,d|=d>>>1,d|=d>>>2,d|=d>>>4,d|=d>>>8,(d|=d>>>16)+1},t.prevPow2=function(d){return d|=d>>>1,d|=d>>>2,d|=d>>>4,d|=d>>>8,(d|=d>>>16)-(d>>>1)},t.parity=function(d){return d^=d>>>16,d^=d>>>8,d^=d>>>4,27030>>>(d&=15)&1};var w=new Array(256);!function(d){for(var t=0;t<256;++t){var A=t,w=t,N=7;for(A>>>=1;A;A>>>=1)w<<=1,w|=1&A,--N;d[t]=w<<N&255}}(w),t.reverse=function(d){return w[255&d]<<24|w[d>>>8&255]<<16|w[d>>>16&255]<<8|w[d>>>24&255]},t.interleave2=function(d,t){return(d=1431655765&((d=858993459&((d=252645135&((d=16711935&((d&=65535)|d<<8))|d<<4))|d<<2))|d<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(d,t){return(d=65535&((d=16711935&((d=252645135&((d=858993459&((d=d>>>t&1431655765)|d>>>1))|d>>>2))|d>>>4))|d>>>16))<<16>>16},t.interleave3=function(d,t,A){return d=1227133513&((d=3272356035&((d=251719695&((d=4278190335&((d&=1023)|d<<16))|d<<8))|d<<4))|d<<2),(d|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(A=1227133513&((A=3272356035&((A=251719695&((A=4278190335&((A&=1023)|A<<16))|A<<8))|A<<4))|A<<2))<<2},t.deinterleave3=function(d,t){return(d=1023&((d=4278190335&((d=251719695&((d=3272356035&((d=d>>>t&1227133513)|d>>>2))|d>>>4))|d>>>8))|d>>>16))<<22>>22},t.nextCombination=function(d){var t=d|d-1;return t+1|(~t&-~t)-1>>>A(d)+1}},12561:(d,t,A)=>{"use strict";A.d(t,{d:()=>i});var w=A(12361),N=A(148);class p{constructor(d,t,A,p,B,X,W){this.jg=new w(d.base,d.Og),this.mass=t,this.friction=A,this.restitution=p,this.Zc=B,this.Jk=X,this.ad=!!W,this.Ng=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.xl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.mf=N.create(),this.dg=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=N.create(),this._impulses=N.create(),this._sleepFrameCount=10}loadFromCopy(d){N.j(this.jg.base,d.jg.base),N.j(this.jg.Og,d.jg.Og),N.j(this.jg.max,d.jg.max),this.jg.mag=d.jg.mag,this.mass=d.mass,this.friction=d.friction,this.restitution=d.restitution,this.Zc=d.Zc,this.Jk=d.Jk,this.ad=d.ad,this.Ng=d.Ng,this.fluidDrag=d.fluidDrag,this.xl=d.xl,this.preventFallOffEdge=d.preventFallOffEdge,this.rolledBackLastTick=d.rolledBackLastTick,N.j(this.mf,d.mf),N.j(this.dg,d.dg),this.inFluid=d.inFluid,this._ratioInFluid=d._ratioInFluid,N.j(this._forces,d._forces),N.j(this._impulses,d._impulses),this._sleepFrameCount=d._sleepFrameCount}setPosition(d){B(d),N.Uc(d,d,this.jg.base),this.jg.translate(d),this.rf()}eb(){return N.clone(this.jg.base)}applyForce(d){B(d),N.add(this._forces,this._forces,d),this.rf()}applyImpulse(d){B(d),N.add(this._impulses,this._impulses,d),this.rf()}rf(){this._sleepFrameCount=10}atRestX(){return this.dg[0]}atRestY(){return this.dg[1]}atRestZ(){return this.dg[2]}}var B=d=>{};var X=A(12361),W=A(148),a=A(12367);function D(){this.Ng=.1,this.fluidDrag=.4,this.md=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function i(d,t,A){d=Object.assign(new D,d),this.gravity=d.gravity||[0,-10,0],this.Ng=d.Ng||.1,this.md=d.md||2,this.fluidDrag=d.fluidDrag||.4,this.minBounceImpulse=d.minBounceImpulse,this.bodies=[],this.ek=d.ek,this.testSolid=t,this.testFluid=A}i.prototype.Qk=function(d,t,A,w,N,B){d=d||new X([0,0,0],[1,1,1]),"undefined"==typeof t&&(t=1),"undefined"==typeof A&&(A=1),"undefined"==typeof w&&(w=0),"undefined"==typeof N&&(N=1);var W=new p(d,t,A,w,N,B);return this.bodies.push(W),W},i.prototype.Rk=function(d){var t=this.bodies.indexOf(d);t<0||(this.bodies.splice(t,1),d.jg=d.Jk=null)};var k=W.create(),b=W.create(),Q=W.create(),P=W.create(),J=W.create(),U=W.create(),T=W.create(),F=new X([0,0,0],[1,1,1]),q=new p(F,1,1,0,1,(()=>{}),!1);function H(d,t,A){return t=A,t*=1-(1-d.ratioInFluid)**2}i.prototype.Md=function(d){d/=1e3;var t=Y(0,W.squaredLength(this.gravity));this.bodies.forEach((A=>function(d,t,A,w){W.j(J,t.dg),d.ek&&q.loadFromCopy(t);if(t.mass<=0)return W.set(t.mf,0,0,0),W.set(t._forces,0,0,0),void W.set(t._impulses,0,0,0);var N=w||0===t.Zc;if(function(d,t,A,w){if(t._sleepFrameCount>0)return!1;if(w)return!0;var N=!1,p=.5*A*A*t.Zc;return W.scale(s,d.gravity,p),a(d.testSolid,t.jg,s,(function(){return N=!0,!0}),!0),N}(d,t,A,N))return;t._sleepFrameCount--,function(d,t){var A=t.jg,w=Math.floor(A.base[0]),N=Math.floor(A.base[2]),p=Math.floor(A.base[1]),B=Math.floor(A.max[1]);if(!d.testFluid(w,p,N))return t.inFluid=!1,void(t.ratioInFluid=0);var X=1,a=p+1;for(;a<=B&&d.testFluid(w,a,N);)X++,a++;var D=(p+X-A.base[1])/A.Og[1];D>1&&(D=1);var i=A.Og[0]*A.Og[1]*A.Og[2]*D,k=v;W.scale(k,d.gravity,-d.md*i*t.Zc),t.applyForce(k),t.inFluid=!0,t.ratioInFluid=D}(d,t),K(t._forces),K(t._impulses),K(t.mf),K(t.dg),W.scale(k,t._forces,1/t.mass),W.xd(k,k,d.gravity,t.Zc),W.scale(b,t._impulses,1/t.mass),W.xd(b,b,k,A),W.add(t.mf,t.mf,b),t.friction&&(m(d,0,t,b,A),m(d,1,t,b,A),m(d,2,t,b,A));var p=t.fluidDrag>=0?t.fluidDrag:d.fluidDrag,B=t.Ng>=0?t.Ng:d.Ng,X=B,D=B;t.inFluid&&(X=H(t,X,t.fluidDragHoriz>=0?t.fluidDragHoriz:p),D=H(t,D,t.fluidDragVert>=0?t.fluidDragVert:p));X=Math.max(1-X*A/t.mass,0),D=Math.max(1-D*A/t.mass,0),W.set(f,X,D,X),W.multiply(t.mf,t.mf,f),W.scale(Q,t.mf,A),W.set(t._forces,0,0,0),W.set(t._impulses,0,0,0),t.ad&&r(R,t.jg);W.j(U,Q),W.set(T,0,0,0),t.preventFallOffEdge&&function(d,t,A,w){if(!t.dg[1]||A[1]>0)return;var N=h;r(N,t.jg);for(var p=0;p<3;p+=2){W.set(V,0,0,0),V[p]=A[p];var B=!0;(B=(B=(B=(B=B&&!y(d,N.base[0]+V[0]+1e-5,N.base[1],N.base[2]+V[2]+1e-5))&&!y(d,N.max[0]+V[0]-1e-5,N.base[1],N.base[2]+V[2]+1e-5))&&!y(d,N.base[0]+V[0]+1e-5,N.base[1],N.max[2]+V[2]-1e-5))&&!y(d,N.max[0]+V[0]-1e-5,N.base[1],N.max[2]+V[2]-1e-5))?(w[p]=A[p]>0?1:-1,A[p]=0):0===p&&(W.set(l,A[0],0,0),n(d,N,l,w,t.slideOnCollision))}}(d,t,Q,T);n(d,t.jg,Q,t.dg,t.slideOnCollision),t.ad&&function(d,t,A,w){if(t.dg[1]>=0&&!t.inFluid)return;var N=0!==t.dg[0],p=0!==t.dg[2];if(!N&&!p)return;var B=Math.abs(w[0]/w[2]),X=4;if(!N&&B>X)return;if(!p&&B<1/X)return;W.add(L,A.base,w);var D=d.testSolid;a(D,A,w,(function(d,t,A,w){if(1!==t)return!0;w[t]=0}));var i=A.base[1],k=t.inFluid?1.951:1.001,b=Math.floor(i+k)-i;W.set(I,0,b,0);var Q=!1;if(a(D,A,I,(function(d,t,A,w){return Q=!0,!0})),Q)return;W.Uc(u,L,A.base),u[1]=0,n(d,A,u,Z,!0);var P=Y(A.base[0],L[0]),J=Y(A.base[2],L[2]);if(N&&!P&&(!J||!p))return;if(p&&(!P||!N)&&!J)return;var U=!0;if(U=U&&!y(d,A.base[0]+1e-5,A.base[1],A.base[2]+1e-5),U=U&&!y(d,A.max[0]-1e-5,A.base[1],A.base[2]+1e-5),U=U&&!y(d,A.base[0]+1e-5,A.base[1],A.max[2]-1e-5),U=U&&!y(d,A.max[0]-1e-5,A.base[1],A.max[2]-1e-5),U)return;r(t.jg,A),t.dg[0]=Z[0],t.dg[2]=Z[2],t.xl&&t.xl()}(d,t,R,U);for(var i=0;i<3;++i)t.dg[i]=t.dg[i]||T[i],P[i]=0,t.dg[i]&&(J[i]||(P[i]=-t.mf[i]),t.mf[i]=0);var F=W.length(P);F>.001&&(W.scale(P,P,t.mass),t.Jk&&t.Jk(P),t.restitution>0&&F>d.minBounceImpulse&&(W.scale(P,P,t.restitution),t.applyImpulse(P)));var j=W.squaredLength(t.mf);j>1e-5&&t.rf();d.ek&&d.ek(t)?(t.loadFromCopy(q),t.rolledBackLastTick=!0):t.rolledBackLastTick=!1}(this,A,d,t)))};var f=W.create([0,0,0]);var v=W.create();function m(d,t,A,w,N){var p=A.dg[t],B=w[t];if(!A.alwaysApplyHorizFriction||1!==t){if(0===p)return;if(p*B<=0)return}W.j(j,A.mf),j[t]=0;var X=W.length(j);if(!Y(X,0)){var a=Math.abs(A.friction*d.gravity[t]*N),D=X>a?(X-a)/X:0;A.mf[(t+1)%3]*=D,A.mf[(t+2)%3]*=D}}var j=W.create();function n(d,t,A,w,N){return W.set(w,0,0,0),a(d.testSolid,t,A,(function(d,t,A,p){w[t]=A,p[t]=0,N||(p[0]=0,p[1]=0,p[2]=0)}))}var R=new X([],[]),Z=W.create(),L=W.create(),I=W.create(),u=W.create();var V=W.create(),h=new X([],[]),l=W.create();function y(d,t,A,w){return d.testSolid(Math.floor(t),Math.floor(A-1),Math.floor(w))}var s=W.create();function Y(d,t){return Math.abs(d-t)<1e-5}function r(d,t){for(var A=0;A<3;A++)d.base[A]=t.base[A],d.max[A]=t.max[A],d.Og[A]=t.Og[A]}var K=function(d){}},10907:d=>{"use strict";d.exports=function(d,t,A,w){var N=self||window;try{try{var p;try{p=new N.Blob([d])}catch(a){(p=new(N.BlobBuilder||N.WebKitBlobBuilder||N.MozBlobBuilder||N.MSBlobBuilder)).append(d),p=p.getBlob()}var B=N.URL||N.webkitURL,X=B.createObjectURL(p),W=new N[t](X,A);return B.revokeObjectURL(X),W}catch(a){return new N[t]("data:application/javascript,".concat(encodeURIComponent(d)),A)}}catch(a){if(!w)throw Error("Inline worker is not supported");return new N[t](w,A)}}},11968:(d,t,A)=>{"use strict";function w(d,t,A,w,N){var p={};return Object.keys(w).forEach((function(d){p[d]=w[d]})),p.enumerable=!!p.enumerable,p.configurable=!!p.configurable,("value"in p||p.initializer)&&(p.writable=!0),p=A.slice().reverse().reduce((function(A,w){return w(d,t,A)||A}),p),N&&void 0!==p.initializer&&(p.value=p.initializer?p.initializer.call(N):void 0,p.initializer=void 0),void 0===p.initializer&&(Object.defineProperty(d,t,p),p=null),p}A.d(t,{b:()=>w})},11961:(d,t,A)=>{"use strict";function w(d,t,A,w){A&&Object.defineProperty(d,t,{enumerable:A.enumerable,configurable:A.configurable,writable:A.writable,value:A.initializer?A.initializer.call(w):void 0})}A.d(t,{b:()=>w})},12029:(d,t,A)=>{"use strict";A.d(t,{d:()=>F,f:()=>J,g:()=>U,h:()=>k,i:()=>P,l:()=>Q,o:()=>b});var w=A(11076),N=A(11094),p=A(11087),B=A(10885),X=A(12037),W=A(11326),a=A(11268),D=A(10767),i=A(11097);const k=Object.freeze(new w.f(0,0,0,0)),b=Object.freeze(w.l.Zero()),Q=Object.freeze(w.j.Zero()),P=Object.freeze(a.e.Zero()),J=Object.freeze(N.e.Black()),U=Object.freeze(new N.i(0,0,0,0)),T={key:0,repeatCount:0,loopMode:2};class F{static _PrepareAnimation(d,t,A,p,B,X,W,D){let i;if(!isNaN(parseFloat(B))&&isFinite(B)?i=F.ANIMATIONTYPE_FLOAT:B instanceof w.f?i=F.ANIMATIONTYPE_QUATERNION:B instanceof w.l?i=F.ANIMATIONTYPE_VECTOR3:B instanceof w.j?i=F.ANIMATIONTYPE_VECTOR2:B instanceof N.e?i=F.ANIMATIONTYPE_COLOR3:B instanceof N.i?i=F.ANIMATIONTYPE_COLOR4:B instanceof a.e&&(i=F.ANIMATIONTYPE_SIZE),void 0==i)return null;const k=new F(d,t,A,i,W),b=[{frame:0,value:B},{frame:p,value:X}];return k.setKeys(b),void 0!==D&&k.setEasingFunction(D),k}static CreateAnimation(d,t,A,w){const N=new F(d+"Animation",d,A,t,F.ANIMATIONLOOPMODE_CONSTANT);return N.setEasingFunction(w),N}static CreateAndStartAnimation(d,t,A,w,N,p,B,X,W,a,D){const i=F._PrepareAnimation(d,A,w,N,p,B,X,W);return i?(t.va&&(D=t.va()),D?D.beginDirectAnimation(t,[i],0,N,1===i.loopMode,1,a):null):null}static CreateAndStartHierarchyAnimation(d,t,A,w,N,p,B,X,W,a,D){const i=F._PrepareAnimation(d,w,N,p,B,X,W,a);if(!i)return null;return t.va().beginDirectHierarchyAnimation(t,A,[i],0,p,1===i.loopMode,1,D)}static CreateMergeAndStartAnimation(d,t,A,w,N,p,B,X,W,a){const D=F._PrepareAnimation(d,A,w,N,p,B,X,W);return D?(t.animations.push(D),t.va().beginAnimation(t,0,N,1===D.loopMode,1,a)):null}static MakeAnimationAdditive(d,t,A){let N;N="object"===typeof t?t:{referenceFrame:t??0,range:A,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let p=d;if(N.cloneOriginalAnimation&&(p=d.clone(),p.name=N.clonedAnimationName||p.name),!p._keys.length)return p;const B=N.referenceFrame&&N.referenceFrame>=0?N.referenceFrame:0;let X=0;const W=p._keys[0];let a=p._keys.length-1;const D=p._keys[a],i={referenceValue:W.value,referencePosition:w.h.gb[0],referenceQuaternion:w.h.Quaternion[0],referenceScaling:w.h.gb[1],keyPosition:w.h.gb[2],keyQuaternion:w.h.Quaternion[1],keyScaling:w.h.gb[3]};let k=W.frame,b=D.frame;if(N.range){const d=p.getRange(N.range);d&&(k=d.from,b=d.to)}else k=N.fromFrame??k,b=N.toFrame??b;if(k!==W.frame&&(X=p.createKeyForFrame(k)),b!==D.frame&&(a=p.createKeyForFrame(b)),1===p._keys.length){const d=p._getKeyValue(p._keys[0]);i.referenceValue=d.clone?d.clone():d}else if(B<=W.frame){const d=p._getKeyValue(W.value);i.referenceValue=d.clone?d.clone():d}else if(B>=D.frame){const d=p._getKeyValue(D.value);i.referenceValue=d.clone?d.clone():d}else{T.key=0;const d=p._interpolate(B,T);i.referenceValue=d.clone?d.clone():d}p.dataType===F.ANIMATIONTYPE_QUATERNION?i.referenceValue.normalize().conjugateInPlace():p.dataType===F.ANIMATIONTYPE_MATRIX&&(i.referenceValue.decompose(i.referenceScaling,i.referenceQuaternion,i.referencePosition),i.referenceQuaternion.normalize().conjugateInPlace());let Q=Number.MAX_VALUE;const P=N.clipKeys?[]:null;for(let J=X;J<=a;J++){let d=p._keys[J];if((P||N.cloneOriginalAnimation)&&(d={frame:d.frame,value:d.value.clone?d.value.clone():d.value,inTangent:d.inTangent,outTangent:d.outTangent,interpolation:d.interpolation,lockedTangent:d.lockedTangent},P&&(Q===Number.MAX_VALUE&&(Q=d.frame),d.frame-=Q,P.push(d))),!J||p.dataType===F.ANIMATIONTYPE_FLOAT||d.value!==W.value)switch(p.dataType){case F.ANIMATIONTYPE_MATRIX:d.value.decompose(i.keyScaling,i.keyQuaternion,i.keyPosition),i.keyPosition.ni(i.referencePosition),i.keyScaling.divideInPlace(i.referenceScaling),i.referenceQuaternion.multiplyToRef(i.keyQuaternion,i.keyQuaternion),w.c.ComposeToRef(i.keyScaling,i.keyQuaternion,i.keyPosition,d.value);break;case F.ANIMATIONTYPE_QUATERNION:i.referenceValue.multiplyToRef(d.value,d.value);break;case F.ANIMATIONTYPE_VECTOR2:case F.ANIMATIONTYPE_VECTOR3:case F.ANIMATIONTYPE_COLOR3:case F.ANIMATIONTYPE_COLOR4:d.value.subtractToRef(i.referenceValue,d.value);break;case F.ANIMATIONTYPE_SIZE:d.value.width-=i.referenceValue.width,d.value.height-=i.referenceValue.height;break;default:d.value-=i.referenceValue}}return P&&p.setKeys(P,!0),p}static TransitionTo(d,t,A,w,N,p,B){let X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(B<=0)return A[d]=t,X&&X(),null;const W=N*(B/1e3);p.setKeys([{frame:0,value:A[d].clone?A[d].clone():A[d]},{frame:W,value:t}]),A.animations||(A.animations=[]),A.animations.push(p);const a=w.beginAnimation(A,0,W,!1);return a.onAnimationEnd=X,a}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const d of this._runtimeAnimations)if(!d.isStopped())return!0;return!1}constructor(d,t,A,w,N,p){this.name=d,this.targetProperty=t,this.framePerSecond=A,this.dataType=w,this.loopMode=N,this.enableBlending=p,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=t.split("."),this.dataType=w,this.loopMode=void 0===N?F.ANIMATIONLOOPMODE_CYCLE:N,this.uniqueId=F._UniqueIdGenerator++}toString(d){let t="Name: "+this.name+", property: "+this.targetProperty;if(t+=", datatype: "+["Float","gb","Quaternion","Matrix","jb","Vector2"][this.dataType],t+=", nKeys: "+(this._keys?this._keys.length:"none"),t+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),d){t+=", Ranges: {";let d=!0;for(const A in this._ranges)d&&(t+=", ",d=!1),t+=A;t+="}"}return t}addEvent(d){this._events.push(d),this._events.sort(((d,t)=>d.frame-t.frame))}removeEvents(d){for(let t=0;t<this._events.length;t++)this._events[t].frame===d&&(this._events.splice(t,1),t--)}getEvents(){return this._events}createRange(d,t,A){this._ranges[d]||(this._ranges[d]=new X.d(d,t,A))}deleteRange(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this._ranges[d];if(A){if(t){const d=A.from,t=A.to;for(let A=this._keys.length-1;A>=0;A--)this._keys[A].frame>=d&&this._keys[A].frame<=t&&this._keys.splice(A,1)}this._ranges[d]=null}}getRange(d){return this._ranges[d]}getKeys(){return this._keys}getHighestFrame(){let d=0;for(let t=0,A=this._keys.length;t<A;t++)d<this._keys[t].frame&&(d=this._keys[t].frame);return d}getEasingFunction(){return this._easingFunction}setEasingFunction(d){this._easingFunction=d}floatInterpolateFunction(d,t,A){return(0,p.o)(d,t,A)}floatInterpolateFunctionWithTangents(d,t,A,w,N){return(0,p.f)(d,t,A,w,N)}quaternionInterpolateFunction(d,t,A){return w.f.Slerp(d,t,A)}quaternionInterpolateFunctionWithTangents(d,t,A,N,p){return w.f.Hermite(d,t,A,N,p).normalize()}vector3InterpolateFunction(d,t,A){return w.l.Lerp(d,t,A)}vector3InterpolateFunctionWithTangents(d,t,A,N,p){return w.l.Hermite(d,t,A,N,p)}vector2InterpolateFunction(d,t,A){return w.j.Lerp(d,t,A)}vector2InterpolateFunctionWithTangents(d,t,A,N,p){return w.j.Hermite(d,t,A,N,p)}sizeInterpolateFunction(d,t,A){return a.e.Lerp(d,t,A)}color3InterpolateFunction(d,t,A){return N.e.Lerp(d,t,A)}color3InterpolateFunctionWithTangents(d,t,A,w,p){return N.e.Hermite(d,t,A,w,p)}color4InterpolateFunction(d,t,A){return N.i.Lerp(d,t,A)}color4InterpolateFunctionWithTangents(d,t,A,w,p){return N.i.Hermite(d,t,A,w,p)}_getKeyValue(d){return"function"===typeof d?d():d}evaluate(d){return T.key=0,this._interpolate(d,T)}_interpolate(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.loopMode===F.ANIMATIONLOOPMODE_CONSTANT&&t.repeatCount>0)return t.highLimitValue.clone?t.highLimitValue.clone():t.highLimitValue;const w=this._keys,N=w.length;let p=t.key;for(;p>=0&&d<w[p].frame;)--p;for(;p+1<=N-1&&d>=w[p+1].frame;)++p;if(t.key=p,p<0)return A?void 0:this._getKeyValue(w[0].value);if(p+1>N-1)return A?void 0:this._getKeyValue(w[N-1].value);const B=w[p],X=w[p+1];if(A&&(d===B.frame||d===X.frame))return;const W=this._getKeyValue(B.value),a=this._getKeyValue(X.value);if(1===B.interpolation)return X.frame>d?W:a;const D=void 0!==B.outTangent&&void 0!==X.inTangent,i=X.frame-B.frame;let T=(d-B.frame)/i;const q=B.easingFunction||this.getEasingFunction();switch(null!==q&&(T=q.ease(T)),this.dataType){case F.ANIMATIONTYPE_FLOAT:{const d=D?this.floatInterpolateFunctionWithTangents(W,B.outTangent*i,a,X.inTangent*i,T):this.floatInterpolateFunction(W,a,T);switch(t.loopMode){case F.ANIMATIONLOOPMODE_CYCLE:case F.ANIMATIONLOOPMODE_CONSTANT:case F.ANIMATIONLOOPMODE_YOYO:return d;case F.ANIMATIONLOOPMODE_RELATIVE:case F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(t.offsetValue??0)*t.repeatCount+d}break}case F.ANIMATIONTYPE_QUATERNION:{const d=D?this.quaternionInterpolateFunctionWithTangents(W,B.outTangent.scale(i),a,X.inTangent.scale(i),T):this.quaternionInterpolateFunction(W,a,T);switch(t.loopMode){case F.ANIMATIONLOOPMODE_CYCLE:case F.ANIMATIONLOOPMODE_CONSTANT:case F.ANIMATIONLOOPMODE_YOYO:return d;case F.ANIMATIONLOOPMODE_RELATIVE:case F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return d.addInPlace((t.offsetValue||k).scale(t.repeatCount))}return d}case F.ANIMATIONTYPE_VECTOR3:{const d=D?this.vector3InterpolateFunctionWithTangents(W,B.outTangent.scale(i),a,X.inTangent.scale(i),T):this.vector3InterpolateFunction(W,a,T);switch(t.loopMode){case F.ANIMATIONLOOPMODE_CYCLE:case F.ANIMATIONLOOPMODE_CONSTANT:case F.ANIMATIONLOOPMODE_YOYO:return d;case F.ANIMATIONLOOPMODE_RELATIVE:case F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return d.add((t.offsetValue||b).scale(t.repeatCount))}break}case F.ANIMATIONTYPE_VECTOR2:{const d=D?this.vector2InterpolateFunctionWithTangents(W,B.outTangent.scale(i),a,X.inTangent.scale(i),T):this.vector2InterpolateFunction(W,a,T);switch(t.loopMode){case F.ANIMATIONLOOPMODE_CYCLE:case F.ANIMATIONLOOPMODE_CONSTANT:case F.ANIMATIONLOOPMODE_YOYO:return d;case F.ANIMATIONLOOPMODE_RELATIVE:case F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return d.add((t.offsetValue||Q).scale(t.repeatCount))}break}case F.ANIMATIONTYPE_SIZE:switch(t.loopMode){case F.ANIMATIONLOOPMODE_CYCLE:case F.ANIMATIONLOOPMODE_CONSTANT:case F.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(W,a,T);case F.ANIMATIONLOOPMODE_RELATIVE:case F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(W,a,T).add((t.offsetValue||P).scale(t.repeatCount))}break;case F.ANIMATIONTYPE_COLOR3:{const d=D?this.color3InterpolateFunctionWithTangents(W,B.outTangent.scale(i),a,X.inTangent.scale(i),T):this.color3InterpolateFunction(W,a,T);switch(t.loopMode){case F.ANIMATIONLOOPMODE_CYCLE:case F.ANIMATIONLOOPMODE_CONSTANT:case F.ANIMATIONLOOPMODE_YOYO:return d;case F.ANIMATIONLOOPMODE_RELATIVE:case F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return d.add((t.offsetValue||J).scale(t.repeatCount))}break}case F.ANIMATIONTYPE_COLOR4:{const d=D?this.color4InterpolateFunctionWithTangents(W,B.outTangent.scale(i),a,X.inTangent.scale(i),T):this.color4InterpolateFunction(W,a,T);switch(t.loopMode){case F.ANIMATIONLOOPMODE_CYCLE:case F.ANIMATIONLOOPMODE_CONSTANT:case F.ANIMATIONLOOPMODE_YOYO:return d;case F.ANIMATIONLOOPMODE_RELATIVE:case F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return d.add((t.offsetValue||U).scale(t.repeatCount))}break}case F.ANIMATIONTYPE_MATRIX:switch(t.loopMode){case F.ANIMATIONLOOPMODE_CYCLE:case F.ANIMATIONLOOPMODE_CONSTANT:case F.ANIMATIONLOOPMODE_YOYO:return F.AllowMatricesInterpolation?this.matrixInterpolateFunction(W,a,T,t.workValue):W;case F.ANIMATIONLOOPMODE_RELATIVE:case F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return W}}return 0}matrixInterpolateFunction(d,t,A,N){return F.AllowMatrixDecomposeForInterpolation?N?(w.c.DecomposeLerpToRef(d,t,A,N),N):w.c.DecomposeLerp(d,t,A):N?(w.c.LerpToRef(d,t,A,N),N):w.c.Lerp(d,t,A)}clone(){const d=new F(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(d.enableBlending=this.enableBlending,d.blendingSpeed=this.blendingSpeed,this._keys&&d.setKeys(this._keys),this._ranges){d._ranges={};for(const t in this._ranges){const A=this._ranges[t];A&&(d._ranges[t]=A.clone())}}return d}setKeys(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=t?d:d.slice(0)}createKeyForFrame(d){T.key=0;const t=this._interpolate(d,T,!0);if(!t)return this._keys[T.key].frame===d?T.key:T.key+1;const A={frame:d,value:t.clone?t.clone():t};return this._keys.splice(T.key+1,0,A),T.key+1}serialize(){const d={};d.name=this.name,d.property=this.targetProperty,d.framePerSecond=this.framePerSecond,d.dataType=this.dataType,d.loopBehavior=this.loopMode,d.enableBlending=this.enableBlending,d.blendingSpeed=this.blendingSpeed;const t=this.dataType;d.keys=[];const A=this.getKeys();for(let w=0;w<A.length;w++){const N=A[w],p={};switch(p.frame=N.frame,t){case F.ANIMATIONTYPE_FLOAT:p.values=[N.value],void 0!==N.inTangent&&p.values.push(N.inTangent),void 0!==N.outTangent&&(void 0===N.inTangent&&p.values.push(void 0),p.values.push(N.outTangent)),void 0!==N.interpolation&&(void 0===N.inTangent&&p.values.push(void 0),void 0===N.outTangent&&p.values.push(void 0),p.values.push(N.interpolation));break;case F.ANIMATIONTYPE_QUATERNION:case F.ANIMATIONTYPE_MATRIX:case F.ANIMATIONTYPE_VECTOR3:case F.ANIMATIONTYPE_COLOR3:case F.ANIMATIONTYPE_COLOR4:p.values=N.value.gj(),void 0!=N.inTangent&&p.values.push(N.inTangent.gj()),void 0!=N.outTangent&&(void 0===N.inTangent&&p.values.push(void 0),p.values.push(N.outTangent.gj())),void 0!==N.interpolation&&(void 0===N.inTangent&&p.values.push(void 0),void 0===N.outTangent&&p.values.push(void 0),p.values.push(N.interpolation))}d.keys.push(p)}d.ranges=[];for(const w in this._ranges){const t=this._ranges[w];if(!t)continue;const A={};A.name=w,A.from=t.from,A.to=t.to,d.ranges.push(A)}return d}static _UniversalLerp(d,t,A){const w=d.constructor;return w.Lerp?w.Lerp(d,t,A):w.Slerp?w.Slerp(d,t,A):d.toFixed?d*(1-A)+A*t:t}static Parse(d){const t=new F(d.name,d.property,d.framePerSecond,d.dataType,d.loopBehavior),A=d.dataType,p=[];let B,X;for(d.enableBlending&&(t.enableBlending=d.enableBlending),d.blendingSpeed&&(t.blendingSpeed=d.blendingSpeed),X=0;X<d.keys.length;X++){const t=d.keys[X];let W,a,D;switch(A){case F.ANIMATIONTYPE_FLOAT:B=t.values[0],t.values.length>=2&&(W=t.values[1]),t.values.length>=3&&(a=t.values[2]),t.values.length>=4&&(D=t.values[3]);break;case F.ANIMATIONTYPE_QUATERNION:if(B=w.f.Lg(t.values),t.values.length>=8){const d=w.f.Lg(t.values.slice(4,8));d.equals(w.f.Zero())||(W=d)}if(t.values.length>=12){const d=w.f.Lg(t.values.slice(8,12));d.equals(w.f.Zero())||(a=d)}t.values.length>=13&&(D=t.values[12]);break;case F.ANIMATIONTYPE_MATRIX:B=w.c.Lg(t.values),t.values.length>=17&&(D=t.values[16]);break;case F.ANIMATIONTYPE_COLOR3:B=N.e.Lg(t.values),t.values[3]&&(W=N.e.Lg(t.values[3])),t.values[4]&&(a=N.e.Lg(t.values[4])),t.values[5]&&(D=t.values[5]);break;case F.ANIMATIONTYPE_COLOR4:B=N.i.Lg(t.values),t.values[4]&&(W=N.i.Lg(t.values[4])),t.values[5]&&(a=N.i.Lg(t.values[5])),t.values[6]&&(D=N.i.Lg(t.values[6]));break;case F.ANIMATIONTYPE_VECTOR3:default:B=w.l.Lg(t.values),t.values[3]&&(W=w.l.Lg(t.values[3])),t.values[4]&&(a=w.l.Lg(t.values[4])),t.values[5]&&(D=t.values[5])}const i={};i.frame=t.frame,i.value=B,void 0!=W&&(i.inTangent=W),void 0!=a&&(i.outTangent=a),void 0!=D&&(i.interpolation=D),p.push(i)}if(t.setKeys(p),d.ranges)for(X=0;X<d.ranges.length;X++)B=d.ranges[X],t.createRange(B.name,B.from,B.to);return t}static AppendSerializedAnimations(d,t){i.d.AppendSerializedAnimations(d,t)}static ParseFromFileAsync(d,t){return new Promise(((A,w)=>{const N=new D.b;N.addEventListener("readystatechange",(()=>{if(4==N.readyState)if(200==N.status){let t=JSON.parse(N.responseText);if(t.animations&&(t=t.animations),t.length){const d=[];for(const A of t)d.push(this.Parse(A));A(d)}else{const w=this.Parse(t);d&&(w.name=d),A(w)}}else w("Unable to load the animation")})),N.open("GET",t),N.send()}))}static ParseFromSnippetAsync(d){return new Promise(((t,A)=>{const w=new D.b;w.addEventListener("readystatechange",(()=>{if(4==w.readyState)if(200==w.status){const A=JSON.parse(JSON.parse(w.responseText).jsonPayload);if(A.animations){const w=JSON.parse(A.animations),N=[];for(const t of w.animations){const A=this.Parse(t);A.snippetId=d,N.push(A)}t(N)}else{const w=JSON.parse(A.animation),N=this.Parse(w);N.snippetId=d,t(N)}}else A("Unable to load the snippet "+d)})),w.open("GET",this.SnippetUrl+"/"+d.replace(/#/g,"/")),w.send()}))}}F._UniqueIdGenerator=0,F.AllowMatricesInterpolation=!1,F.AllowMatrixDecomposeForInterpolation=!0,F.SnippetUrl="https://snippet.babylonjs.com",F.ANIMATIONTYPE_FLOAT=0,F.ANIMATIONTYPE_VECTOR3=1,F.ANIMATIONTYPE_QUATERNION=2,F.ANIMATIONTYPE_MATRIX=3,F.ANIMATIONTYPE_COLOR3=4,F.ANIMATIONTYPE_COLOR4=7,F.ANIMATIONTYPE_VECTOR2=5,F.ANIMATIONTYPE_SIZE=6,F.ANIMATIONLOOPMODE_RELATIVE=0,F.ANIMATIONLOOPMODE_CYCLE=1,F.ANIMATIONLOOPMODE_CONSTANT=2,F.ANIMATIONLOOPMODE_YOYO=4,F.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,F.CreateFromSnippetAsync=F.ParseFromSnippetAsync,(0,B.g)("BABYLON.Animation",F),W.d._AnimationRangeFactory=(d,t,A)=>new X.d(d,t,A)},12037:(d,t,A)=>{"use strict";A.d(t,{d:()=>w});class w{constructor(d,t,A){this.name=d,this.from=t,this.to=A}clone(){return new w(this.name,this.from,this.to)}}},11616:(d,t,A)=>{"use strict";var w=A(10730),N=A(10740),p=A(10824),B=A(10737);p.c.AudioEngineFactory=(d,t,A)=>new X(d,t,A);class X{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new w.b,this.onAudioLockedObservable=new w.b,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,B.l)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const N=document.createElement("audio");this._hostElement=d,this._audioContext=t,this._audioDestination=A;try{N&&N.canPlayType&&(N.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||N.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(p){}try{N&&N.canPlayType&&N.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(p){}}lock(){this._triggerSuspendedState()}unlock(){var d,t;if("running"===(null===(d=this._audioContext)||void 0===d?void 0:d.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(t=this._audioContext)||void 0===t||t.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var d;null===(d=this._audioContext)||void 0===d||d.addEventListener("statechange",(()=>{var d;this.unlocked&&"running"!==(null===(d=this._audioContext)||void 0===d?void 0:d.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var d;return null!==(d=this._audioContext)&&void 0!==d&&d.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(d){this.canUseWebAudio=!1,N.e.Error("Web Audio: "+d.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const d=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",t=document.createElement("style");t.appendChild(document.createTextNode(d)),document.getElementsByTagName("head")[0].appendChild(t),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(d){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=d)}connectToAnalyser(d){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=d,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},12026:(d,t,A)=>{"use strict";A.d(t,{b:()=>B});var w=A(11076),N=A(11081),p=A(11326);class B extends p.d{get _matrix(){return this._compose(),this.Pj}set _matrix(d){(d.updateFlag!==this.Pj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.Pj.p(d),this._markAsDirtyAndDecompose())}constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(d,t.va(),!1),this.name=d,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=t,this.Pj=(null===N||void 0===N?void 0:N.clone())??w.c.Identity(),this._restMatrix=p??this.Pj.clone(),this._bindMatrix=B??this.Pj.clone(),this._index=X,this._absoluteMatrix=new w.c,this._absoluteBindMatrix=new w.c,this._absoluteInverseBindMatrix=new w.c,this._finalMatrix=new w.c,t.bones.push(this),this.setParent(A,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(d){this.setParent(d)}setParent(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==d){if(this.parent){const d=this.parent.children.indexOf(this);-1!==d&&this.parent.children.splice(d,1)}this._parentNode=d,this.parent&&this.parent.children.push(this),t&&this._updateAbsoluteBindMatrices(),this.Cg()}}getLocalMatrix(){return this._compose(),this.Pj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(d){this._restMatrix.p(d)}setRestPose(d){this.setRestMatrix(d)}getBindPose(){return this.getBindMatrix()}setBindMatrix(d){this.Fj(d)}setBindPose(d){this.setBindMatrix(d)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const d=w.h.gb[0],t=w.h.Quaternion[0],A=w.h.gb[1];this.getRestMatrix().decompose(d,t,A),this._linkedTransformNode.position.p(A),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??w.f.Identity(),this._linkedTransformNode.rotationQuaternion.p(t),this._linkedTransformNode.Gf.p(d)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(d){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=d,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Cf}set position(d){this._decompose(),this.Cf.p(d),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(d){this.setRotation(d)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(d){this.setRotationQuaternion(d)}get Gf(){return this.getScale()}set Gf(d){this.setScale(d)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=w.l.Zero(),this._localRotation=w.f.Zero(),this.Cf=w.l.Zero()),this.Pj.decompose(this._localScaling,this._localRotation,this.Cf))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,w.c.ComposeToRef(this._localScaling,this._localRotation,this.Cf,this.Pj)):this._needToCompose=!1)}Fj(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(d),t&&this._updateAbsoluteBindMatrices(),A?this._matrix=d:this.Cg()}_updateAbsoluteBindMatrices(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(d||(d=this._bindMatrix),this.parent?d.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(d),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),t)for(let A=0;A<this.children.length;A++)this.children[A]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}Cg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.Cg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.Cg(),this._needToDecompose=!0}_updatePosition(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0,N=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const p=this.getLocalMatrix();if(0==t)N?(p.addAtIndex(12,d.x),p.addAtIndex(13,d.y),p.addAtIndex(14,d.z)):p.setTranslationFromFloats(d.x,d.y,d.z);else{let t=null;A&&(t=A.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const X=B._TmpMats[0],W=B._TmpVecs[0];this.parent?A&&t?(X.p(this.parent.getAbsoluteMatrix()),X.multiplyToRef(t,X)):X.p(this.parent.getAbsoluteMatrix()):w.c.IdentityToRef(X),N&&X.setTranslationFromFloats(0,0,0),X.invert(),w.l.TransformCoordinatesToRef(d,X,W),N?(p.addAtIndex(12,W.x),p.addAtIndex(13,W.y),p.addAtIndex(14,W.z)):p.setTranslationFromFloats(W.x,W.y,W.z)}this._markAsDirtyAndDecompose()}translate(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this._updatePosition(d,t,A,!0)}setPosition(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this._updatePosition(d,t,A,!1)}setAbsolutePosition(d,t){this.setPosition(d,1,t)}scale(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=this.getLocalMatrix(),X=B._TmpMats[0];w.c.ScalingToRef(d,t,A,X),X.multiplyToRef(p,p),X.invert();for(const w of this.children){const N=w.getLocalMatrix();N.multiplyToRef(X,N),N.multiplyAtIndex(12,d),N.multiplyAtIndex(13,t),N.multiplyAtIndex(14,A),w._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),N)for(const w of this.children)w.scale(d,t,A,N)}setScale(d){this._decompose(),this._localScaling.p(d),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(d){this._decompose(),d.p(this._localScaling)}setYawPitchRoll(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4?arguments[4]:void 0;if(0===N){const X=B._TmpQuat;return w.f.RotationYawPitchRollToRef(d,t,A,X),void this.setRotationQuaternion(X,N,p)}const X=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(X,p))return;const W=B._TmpMats[1];w.c.RotationYawPitchRollToRef(d,t,A,W),X.multiplyToRef(W,W),this._rotateWithMatrix(W,N,p)}rotate(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;const p=B._TmpMats[0];p.setTranslationFromFloats(0,0,0),w.c.RotationAxisToRef(d,t,p),this._rotateWithMatrix(p,A,N)}setAxisAngle(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,N=arguments.length>3?arguments[3]:void 0;if(0===A){const p=B._TmpQuat;return w.f.RotationAxisToRef(d,t,p),void this.setRotationQuaternion(p,A,N)}const p=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(p,N))return;const X=B._TmpMats[1];w.c.RotationAxisToRef(d,t,X),p.multiplyToRef(X,X),this._rotateWithMatrix(X,A,N)}setRotation(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(d.y,d.x,d.z,t,A)}setRotationQuaternion(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;if(0===t)return this._decompose(),this._localRotation.p(d),void this._markAsDirtyAndCompose();const N=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,A))return;const p=B._TmpMats[1];w.c.FromQuaternionToRef(d,p),N.multiplyToRef(p,p),this._rotateWithMatrix(p,t,A)}setRotationMatrix(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;if(0===t){const N=B._TmpQuat;return w.f.FromRotationMatrixToRef(d,N),void this.setRotationQuaternion(N,t,A)}const N=B._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(N,A))return;const p=B._TmpMats[1];p.p(d),N.multiplyToRef(d,p),this._rotateWithMatrix(p,t,A)}_rotateWithMatrix(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;const w=this.getLocalMatrix(),N=w.m[12],p=w.m[13],X=w.m[14],W=this.getParent(),a=B._TmpMats[3],D=B._TmpMats[4];W&&1==t?(A?(a.p(A.getWorldMatrix()),W.getAbsoluteMatrix().multiplyToRef(a,a)):a.p(W.getAbsoluteMatrix()),D.p(a),D.invert(),w.multiplyToRef(a,w),w.multiplyToRef(d,w),w.multiplyToRef(D,w)):1==t&&A?(a.p(A.getWorldMatrix()),D.p(a),D.invert(),w.multiplyToRef(a,w),w.multiplyToRef(d,w),w.multiplyToRef(D,w)):w.multiplyToRef(d,w),w.setTranslationFromFloats(N,p,X),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(d,t){const A=B._TmpMats[2];return d.p(this.getAbsoluteMatrix()),t?(d.multiplyToRef(t.getWorldMatrix(),d),w.c.ScalingToRef(t.Gf.x,t.Gf.y,t.Gf.z,A)):w.c.IdentityToRef(A),d.invert(),!isNaN(d.m[0])&&(A.multiplyAtIndex(0,this._scalingDeterminant),d.multiplyToRef(A,d),!0)}eb(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=w.l.Zero();return this.getPositionToRef(d,t,A),A}getPositionToRef(){let d=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const d=this.getLocalMatrix();t.x=d.m[12],t.y=d.m[13],t.z=d.m[14]}else{let A=null;d&&(A=d.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let w=B._TmpMats[0];d&&A?(w.p(this.getAbsoluteMatrix()),w.multiplyToRef(A,w)):w=this.getAbsoluteMatrix(),t.x=w.m[12],t.y=w.m[13],t.z=w.m[14]}}getAbsolutePosition(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=w.l.Zero();return this.getPositionToRef(1,d,t),t}getAbsolutePositionToRef(d,t){this.getPositionToRef(1,d,t)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.Pj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.Pj);const d=this._skeleton.getPoseMatrix();d&&this._absoluteMatrix.multiplyToRef(d,this._absoluteMatrix)}const d=this.children,t=d.length;for(let A=0;A<t;A++)d[A].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}me(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=w.l.Zero();return this.getDirectionToRef(d,t,A),A}getDirectionToRef(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,N=null;t&&(N=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=B._TmpMats[0];p.p(this.getAbsoluteMatrix()),t&&N&&p.multiplyToRef(N,p),w.l.TransformNormalToRef(d,p,A),A.normalize()}getRotation(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=w.l.Zero();return this.getRotationToRef(d,t,A),A}getRotationToRef(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;const w=B._TmpQuat;this.getRotationQuaternionToRef(d,t,w),w.toEulerAnglesToRef(A)}getRotationQuaternion(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=w.f.Identity();return this.getRotationQuaternionToRef(d,t,A),A}getRotationQuaternionToRef(){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),t.p(this._localRotation);else{const A=B._TmpMats[0],w=this.getAbsoluteMatrix();d?w.multiplyToRef(d.getWorldMatrix(),A):A.p(w),A.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyAtIndex(1,this._scalingDeterminant),A.multiplyAtIndex(2,this._scalingDeterminant),A.decompose(void 0,t,void 0)}}getRotationMatrix(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;const A=w.c.Identity();return this.getRotationMatrixToRef(d,t,A),A}getRotationMatrixToRef(){let d=arguments.length>1?arguments[1]:void 0,t=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(t);else{const A=B._TmpMats[0],w=this.getAbsoluteMatrix();d?w.multiplyToRef(d.getWorldMatrix(),A):A.p(w),A.multiplyAtIndex(0,this._scalingDeterminant),A.multiplyAtIndex(1,this._scalingDeterminant),A.multiplyAtIndex(2,this._scalingDeterminant),A.getRotationMatrixToRef(t)}}getAbsolutePositionFromLocal(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=w.l.Zero();return this.getAbsolutePositionFromLocalToRef(d,t,A),A}getAbsolutePositionFromLocalToRef(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,N=null;t&&(N=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=B._TmpMats[0];p.p(this.getAbsoluteMatrix()),t&&N&&p.multiplyToRef(N,p),w.l.TransformCoordinatesToRef(d,p,A)}getLocalPositionFromAbsolute(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=w.l.Zero();return this.getLocalPositionFromAbsoluteToRef(d,t,A),A}getLocalPositionFromAbsoluteToRef(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,N=null;t&&(N=t.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const p=B._TmpMats[0];p.p(this.getAbsoluteMatrix()),t&&N&&p.multiplyToRef(N,p),p.invert(),w.l.TransformCoordinatesToRef(d,p,A)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}B._TmpVecs=(0,N.b)(2,w.l.Zero),B._TmpQuat=w.f.Identity(),B._TmpMats=(0,N.b)(5,w.c.Identity)},11120:(d,t,A)=>{"use strict";A.d(t,{d:()=>p,f:()=>B});var w=A(11128),N=A(10740);class p{get u(){return this._isDisposed}constructor(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7?arguments[7]:void 0,a=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,d&&d.va?this._engine=d.va().getEngine():this._engine=d,this._updatable=A,this._instanced=B,this._divisor=W||1,this._label=a,t instanceof w.c?(this._data=null,this._buffer=t):(this._data=t,this._buffer=null),this.byteStride=X?N:N*Float32Array.BYTES_PER_ELEMENT,p||this.create()}createVertexBuffer(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],X=arguments.length>6?arguments[6]:void 0;const W=p?t:t*Float32Array.BYTES_PER_ELEMENT,a=w?p?w:w*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new B(this._engine,this,d,this._updatable,!0,a,void 0===N?this._instanced:N,W,A,void 0,void 0,!0,this._divisor||X)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!d&&this._buffer||(d=d||this._data,d&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,d),this._data=d):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(d,this._label),this._data=d):this._buffer=this._engine.createVertexBuffer(d,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.Yc>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.Yc,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.Yc,void 0,this._label));N.e.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(d){this.create(d)}updateDirectly(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,d,w?t:t*Float32Array.BYTES_PER_ELEMENT,A?A*this.byteStride:void 0),this._data=0===t&&void 0===A?d:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class B{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(d){const t=0!=d;this._instanceDivisor=d,t!==this._instanced&&(this._instanced=t,this._computeHashCode())}get _maxVerticesCount(){const d=this.getData();return d?Array.isArray(d)?d.length/(this.byteStride/4)-this.byteOffset/4:(d.byteLength-this.byteOffset)/this.byteStride:0}constructor(d,t,A,w,N,X,W,a,D,i){let k=arguments.length>10&&void 0!==arguments[10]&&arguments[10],b=arguments.length>11&&void 0!==arguments[11]&&arguments[11],Q=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,P=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let J=!1;if(this.ud=d,"object"===typeof w&&null!==w?(J=w.updatable??!1,N=w.postponeInternalCreation,X=w.stride,W=w.instanced,a=w.offset,D=w.size,i=w.type,k=w.normalized??!1,b=w.useBytes??!1,Q=w.divisor??1,P=w.takeBufferOwnership??!1,this._label=w.label):J=!!w,t instanceof p?(this._buffer=t,this._ownsBuffer=P):(this._buffer=new p(d,t,J,X,N,W,b,Q,this._label),this._ownsBuffer=!0),this.uniqueId=B._Counter++,this._kind=A,void 0===i){const d=this.getData();this.type=d?B.GetDataType(d):B.FLOAT}else this.type=i;const U=B.GetTypeByteLength(this.type);b?(this._size=D||(X?X/U:B.DeduceStride(A)),this.byteStride=X||this._buffer.byteStride||this._size*U,this.byteOffset=a||0):(this._size=D||X||B.DeduceStride(A),this.byteStride=X?X*U:this._buffer.byteStride||this._size*U,this.byteOffset=(a||0)*U),this.normalized=k,this._instanced=void 0!==W&&W,this._instanceDivisor=W?Q:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var d;null===(d=this._buffer)||void 0===d||d._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(d,t){const A=this.getData();return A?B.GetFloatData(A,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,d,t):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/B.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/B.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*B.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(d){this._buffer.create(d),this._alignBuffer()}update(d){this._buffer.update(d),this._alignBuffer()}updateDirectly(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(d,t,void 0,A),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(d,t){B.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,d,this.normalized,t)}_alignBuffer(){}static DeduceStride(d){switch(d){case B.UVKind:case B.UV2Kind:case B.UV3Kind:case B.UV4Kind:case B.UV5Kind:case B.UV6Kind:return 2;case B.NormalKind:case B.PositionKind:return 3;case B.ColorKind:case B.ColorInstanceKind:case B.MatricesIndicesKind:case B.MatricesIndicesExtraKind:case B.MatricesWeightsKind:case B.MatricesWeightsExtraKind:case B.TangentKind:return 4;default:throw new Error("Invalid kind '"+d+"'")}}static GetDataType(d){return d instanceof Int8Array?B.BYTE:d instanceof Uint8Array?B.UNSIGNED_BYTE:d instanceof Int16Array?B.SHORT:d instanceof Uint16Array?B.UNSIGNED_SHORT:d instanceof Int32Array?B.INT:d instanceof Uint32Array?B.UNSIGNED_INT:B.FLOAT}static GetTypeByteLength(d){switch(d){case B.BYTE:case B.UNSIGNED_BYTE:return 1;case B.SHORT:case B.UNSIGNED_SHORT:return 2;case B.INT:case B.UNSIGNED_INT:case B.FLOAT:return 4;default:throw new Error(`Invalid type '${d}'`)}}static ForEach(d,t,A,w,N,p,X,W){if(d instanceof Array){let N=t/4;const B=A/4;for(let t=0;t<p;t+=w){for(let A=0;A<w;A++)W(d[N+A],t+A);N+=B}}else{const a=d instanceof ArrayBuffer?new DataView(d):new DataView(d.buffer,d.byteOffset,d.byteLength),D=B.GetTypeByteLength(N);for(let d=0;d<p;d+=w){let p=t;for(let t=0;t<w;t++){W(B._GetFloatValue(a,N,p,X),d+t),p+=D}t+=A}}}static _GetFloatValue(d,t,A,w){switch(t){case B.BYTE:{let t=d.getInt8(A);return w&&(t=Math.max(t/127,-1)),t}case B.UNSIGNED_BYTE:{let t=d.getUint8(A);return w&&(t/=255),t}case B.SHORT:{let t=d.getInt16(A,!0);return w&&(t=Math.max(t/32767,-1)),t}case B.UNSIGNED_SHORT:{let t=d.getUint16(A,!0);return w&&(t/=65535),t}case B.INT:return d.getInt32(A,!0);case B.UNSIGNED_INT:return d.getUint32(A,!0);case B.FLOAT:return d.getFloat32(A,!0);default:throw new Error(`Invalid component type ${t}`)}}static GetFloatData(d,t,A,w,p,X,W,a){const D=t*B.GetTypeByteLength(A),i=W*t;if(A!==B.FLOAT||p!==D){const N=new Float32Array(i);return B.ForEach(d,w,p,t,A,i,X,((d,t)=>N[t]=d)),N}if(!(d instanceof Array||d instanceof Float32Array)||0!==w||d.length!==i){if(d instanceof Array){const t=w/4;return d.slice(t,t+i)}if(d instanceof ArrayBuffer)return new Float32Array(d,w,i);{const t=d.byteOffset+w;if(0!==(3&t)&&(N.e.Warn("Float array must be aligned to 4-bytes border"),a=!0),a){const A=new Uint8Array(i*Float32Array.BYTES_PER_ELEMENT),w=new Uint8Array(d.buffer,t,A.length);return A.set(w),new Float32Array(A.buffer)}return new Float32Array(d.buffer,t,i)}}return a?d.slice():d}}B._Counter=0,B.BYTE=5120,B.UNSIGNED_BYTE=5121,B.SHORT=5122,B.UNSIGNED_SHORT=5123,B.INT=5124,B.UNSIGNED_INT=5125,B.FLOAT=5126,B.PositionKind="position",B.NormalKind="normal",B.TangentKind="tangent",B.UVKind="uv",B.UV2Kind="uv2",B.UV3Kind="uv3",B.UV4Kind="uv4",B.UV5Kind="uv5",B.UV6Kind="uv6",B.ColorKind="color",B.ColorInstanceKind="instanceColor",B.MatricesIndicesKind="matricesIndices",B.MatricesWeightsKind="matricesWeights",B.MatricesIndicesExtraKind="matricesIndicesExtra",B.MatricesWeightsExtraKind="matricesWeightsExtra"},11128:(d,t,A)=>{"use strict";A.d(t,{c:()=>w});class w{get underlyingResource(){return null}constructor(){this.references=0,this.Yc=0,this.is32Bits=!1,this.uniqueId=w._Counter++}}w._Counter=0},12456:(d,t,A)=>{"use strict";A.d(t,{e:()=>u});var w=A(11041),N=A(11047),p=A(10730),B=A(11076),X=A(11326),W=A(11309),a=A(11151),D=A(10756),i=A(11079);class k{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(d){this._zoomStopsAnimation=d}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(d){this._idleRotationSpeed=d}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(d){this._idleRotationWaitTime=d}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(d){this._idleRotationSpinupTime=d}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(d){this._attachedCamera=d;const t=this._attachedCamera.va();this._onPrePointerObservableObserver=t.onPrePointerObservable.add((d=>{d.type!==a.e.POINTERDOWN?d.type===a.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=d.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const d=D.d.Now;let t=0;null!=this._lastFrameTime&&(t=d-this._lastFrameTime),this._lastFrameTime=d,this._applyUserInteraction();const A=d-this._lastInteractionTime-this._idleRotationWaitTime,w=Math.max(Math.min(A/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*w,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(t/1e3))}))}detach(){if(!this._attachedCamera)return;const d=this._attachedCamera.va();this._onPrePointerObservableObserver&&d.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(d){this._lastInteractionTime=d??D.d.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<i.b}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let d=!1;return this._lastFrameRadius===this._attachedCamera.i&&0!==this._attachedCamera.inertialRadiusOffset&&(d=!0),this._lastFrameRadius=this._attachedCamera.i,this._zoomStopsAnimation?d:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=D.d.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}A(11554);class b{constructor(){this._easingMode=b.EASINGMODE_EASEIN}setEasingMode(d){const t=Math.min(Math.max(d,0),2);this._easingMode=t}getEasingMode(){return this._easingMode}easeInCore(d){throw new Error("You must implement this method")}ease(d){switch(this._easingMode){case b.EASINGMODE_EASEIN:return this.easeInCore(d);case b.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-d)}return d>=.5?.5*(1-this.easeInCore(2*(1-d)))+.5:.5*this.easeInCore(2*d)}}b.EASINGMODE_EASEIN=0,b.EASINGMODE_EASEOUT=1,b.EASINGMODE_EASEINOUT=2;var Q=A(12029);class P{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(d){if(this._autoTransitionRange===d)return;this._autoTransitionRange=d;const t=this._attachedCamera;t&&(d?this._onMeshTargetChangedObserver=t.onMeshTargetChangedObservable.add((d=>{if(d&&(d.Nj(!0),d.getBoundingInfo)){const t=d.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*t,this.upperRadiusTransitionRange=.05*t}})):this._onMeshTargetChangedObserver&&t.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(d){this._attachedCamera=d,this._onAfterCheckInputsObserver=d.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(d){return!!this._attachedCamera&&(this._attachedCamera.i===d&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(d){if(!this._attachedCamera)return;this._radiusBounceTransition||(P.EasingFunction.setEasingMode(P.EasingMode),this._radiusBounceTransition=Q.d.CreateAnimation("i",Q.d.ANIMATIONTYPE_FLOAT,60,P.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const t=Q.d.TransitionTo("i",this._attachedCamera.i+d,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));t&&this._animatables.push(t)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}P.EasingFunction=new class extends b{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=d}easeInCore(d){const t=Math.max(0,this.amplitude);return Math.pow(d,3)-d*t*Math.sin(3.141592653589793*d)}}(.3),P.EasingMode=b.EASINGMODE_EASEOUT;class J{constructor(){this.onTargetFramingAnimationEndObservable=new p.b,this._mode=J.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(d){this._mode=d}get mode(){return this._mode}set radiusScale(d){this._radiusScale=d}get radiusScale(){return this._radiusScale}set positionScale(d){this._positionScale=d}get positionScale(){return this._positionScale}set defaultElevation(d){this._defaultElevation=d}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(d){this._elevationReturnTime=d}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(d){this._elevationReturnWaitTime=d}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(d){this._zoomStopsAnimation=d}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(d){this._framingTime=d}get framingTime(){return this._framingTime}init(){}attach(d){this._attachedCamera=d;const t=this._attachedCamera.va();J.EasingFunction.setEasingMode(J.EasingMode),this._onPrePointerObservableObserver=t.onPrePointerObservable.add((d=>{d.type!==a.e.POINTERDOWN?d.type===a.e.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=d.onMeshTargetChangedObservable.add((d=>{d&&d.getBoundingInfo&&this.zoomOnMesh(d,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=d.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const d=this._attachedCamera.va();this._onPrePointerObservableObserver&&d.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d.Nj(!0);const w=d.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(w.minimumWorld,w.maximumWorld,t,A)}zoomOnMeshHierarchy(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;d.Nj(!0);const w=d.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(w.min,w.max,t,A)}zoomOnMeshesHierarchy(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new B.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),N=new B.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let p=0;p<d.length;p++){const t=d[p].getHierarchyBoundingVectors(!0);B.l.CheckExtends(t.min,w,N),B.l.CheckExtends(t.max,w,N)}this.zoomOnBoundingInfo(w,N,t,A)}zoomOnBoundingInfo(d,t){let A,w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const p=d.y,X=p+(t.y-p)*this._positionScale,W=t.Uc(d).scale(.5);if(w)A=new B.l(0,X,0);else{const t=d.add(W);A=new B.l(t.x,X,t.z)}this._vectorTransition||(this._vectorTransition=Q.d.CreateAnimation("target",Q.d.ANIMATIONTYPE_VECTOR3,60,J.EasingFunction)),this._betaIsAnimating=!0;let a=Q.d.TransitionTo("target",A,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);a&&this._animatables.push(a);let D=0;if(this._mode===J.FitFrustumSidesMode){const A=this._calculateLowerRadiusFromModelBoundingSphere(d,t);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=W.length()+this._attachedCamera.Ui),D=A}else this._mode===J.IgnoreBoundsSizeMode&&(D=this._calculateLowerRadiusFromModelBoundingSphere(d,t),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Ui));if(this.autoCorrectCameraLimitsAndSensibility){const A=t.Uc(d).length();this._attachedCamera.panningSensibility=5e3/A,this._attachedCamera.wheelPrecision=100/D}return this._radiusTransition||(this._radiusTransition=Q.d.CreateAnimation("i",Q.d.ANIMATIONTYPE_FLOAT,60,J.EasingFunction)),a=Q.d.TransitionTo("i",D,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),N&&N(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),a&&this._animatables.push(a),!0}_calculateLowerRadiusFromModelBoundingSphere(d,t){const A=this._attachedCamera;if(!A)return 0;let w=A._calculateLowerRadiusFromModelBoundingSphere(d,t,this._radiusScale);return A.lowerRadiusLimit&&this._mode===J.IgnoreBoundsSizeMode&&(w=w<A.lowerRadiusLimit?A.lowerRadiusLimit:w),A.upperRadiusLimit&&(w=w>A.upperRadiusLimit?A.upperRadiusLimit:w),w}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const d=D.d.Now-this._lastInteractionTime,t=.5*Math.PI-this._defaultElevation,A=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>A&&d>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=Q.d.CreateAnimation("beta",Q.d.ANIMATIONTYPE_FLOAT,60,J.EasingFunction));const d=Q.d.TransitionTo("beta",t,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));d&&this._animatables.push(d)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=D.d.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}J.EasingFunction=new class extends b{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=d}easeInCore(d){return this.exponent<=0?d:(Math.exp(this.exponent*d)-1)/(Math.exp(this.exponent)-1)}},J.EasingMode=b.EASINGMODE_EASEINOUT,J.IgnoreBoundsSizeMode=0,J.FitFrustumSidesMode=1;var U=A(11320),T=A(12012),F=A(12018),q=A(10727);class H{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(d){d=q.g.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),A=t.getInputElement();let w=0,N=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=p=>{var B,X;const W=p.event,D="touch"===W.pointerType;if(p.type!==a.e.POINTERMOVE&&-1===this.buttons.indexOf(W.button))return;const i=W.target;if(this._altKey=W.altKey,this._ctrlKey=W.ctrlKey,this._metaKey=W.metaKey,this._shiftKey=W.shiftKey,this._buttonsPressed=W.buttons,t.isPointerLock){const d=W.movementX,t=W.movementY;this.onTouch(null,d,t),this._pointA=null,this._pointB=null}else{if(p.type!==a.e.POINTERDOWN&&p.type!==a.e.POINTERDOUBLETAP&&D&&(null===(B=this._pointA)||void 0===B?void 0:B.pointerId)!==W.pointerId&&(null===(X=this._pointB)||void 0===X?void 0:X.pointerId)!==W.pointerId)return;if(p.type!==a.e.POINTERDOWN||-1!==this._currentActiveButton&&!D)if(p.type===a.e.POINTERDOUBLETAP)this.onDoubleTap(W.pointerType);else if(p.type!==a.e.POINTERUP||this._currentActiveButton!==W.button&&!D){if(p.type===a.e.POINTERMOVE)if(d||W.preventDefault(),this._pointA&&null===this._pointB){const d=W.clientX-this._pointA.x,t=W.clientY-this._pointA.y;this._pointA.x=W.clientX,this._pointA.y=W.clientY,this.onTouch(this._pointA,d,t)}else if(this._pointA&&this._pointB){const d=this._pointA.pointerId===W.pointerId?this._pointA:this._pointB;d.x=W.clientX,d.y=W.clientY;const t=this._pointA.x-this._pointB.x,A=this._pointA.y-this._pointB.y,B=t*t+A*A,X={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:W.pointerId,type:p.type};this.onMultiTouch(this._pointA,this._pointB,w,B,N,X),N=X,w=B}}else{try{null===i||void 0===i||i.releasePointerCapture(W.pointerId)}catch(k){}D||(this._pointB=null),t._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==W.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==W.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==w||N)&&(this.onMultiTouch(this._pointA,this._pointB,w,0,N,null),w=0,N=null),this._currentActiveButton=-1,this.onButtonUp(W),d||W.preventDefault()}else{try{null===i||void 0===i||i.setPointerCapture(W.pointerId)}catch(k){}if(null===this._pointA)this._pointA={x:W.clientX,y:W.clientY,pointerId:W.pointerId,type:W.pointerType};else{if(null!==this._pointB)return;this._pointB={x:W.clientX,y:W.clientY,pointerId:W.pointerId,type:W.pointerType}}-1!==this._currentActiveButton||D||(this._currentActiveButton=W.button),this.onButtonDown(W),d||(W.preventDefault(),A&&A.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,a.e.POINTERDOWN|a.e.POINTERUP|a.e.POINTERMOVE|a.e.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,w=0,N=null,this.onLostFocus()},this._contextMenuBind=d=>this.onContextMenu(d),A&&A.addEventListener("contextmenu",this._contextMenuBind,!1);const p=this.camera.va().getEngine().getHostWindow();p&&q.g.RegisterTopRootEvents(p,[{name:"blur",handler:this._onLostFocus}])}Qi(){if(this._onLostFocus){const d=this.camera.va().getEngine().getHostWindow();d&&q.g.UnregisterTopRootEvents(d,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const d=this.camera.va().getEngine().getInputElement();d&&d.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(d){}onTouch(d,t,A){}onMultiTouch(d,t,A,w,N,p){}onContextMenu(d){d.preventDefault()}onButtonDown(d){}onButtonUp(d){}onLostFocus(){}}(0,w.b)([(0,N.J)()],H.prototype,"buttons",void 0);class f extends H{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(d,t){if(0!==this.panningSensibility&&d&&t){const A=t.x-d.x,w=t.y-d.y;this.camera.inertialPanningX+=-A/this.panningSensibility,this.camera.inertialPanningY+=w/this.panningSensibility}}_computePinchZoom(d,t){const A=this.camera.i||f.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.i=A*Math.sqrt(d)/Math.sqrt(t):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(t-d)*A*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(t-d)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(d,t,A){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-t/this.panningSensibility,this.camera.inertialPanningY+=A/this.panningSensibility):(this.camera.inertialAlphaOffset-=t/this.angularSensibilityX,this.camera.inertialBetaOffset-=A/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(d,t,A,w,N,p){0===A&&null===N||0===w&&null===p||(this.multiTouchPanAndZoom?(this._computePinchZoom(A,w),this._computeMultiTouchPanning(N,p)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(w)-Math.sqrt(A))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(A,w),this._isPinching=!0):this._computeMultiTouchPanning(N,p)):this.multiTouchPanning?this._computeMultiTouchPanning(N,p):this.pinchZoom&&this._computePinchZoom(A,w))}onButtonDown(d){this._isPanClick=d.button===this.camera._panningMouseButton}onButtonUp(d){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}f.MinimumRadiusForPinch=.001,(0,w.b)([(0,N.J)()],f.prototype,"buttons",void 0),(0,w.b)([(0,N.J)()],f.prototype,"angularSensibilityX",void 0),(0,w.b)([(0,N.J)()],f.prototype,"angularSensibilityY",void 0),(0,w.b)([(0,N.J)()],f.prototype,"pinchPrecision",void 0),(0,w.b)([(0,N.J)()],f.prototype,"pinchDeltaPercentage",void 0),(0,w.b)([(0,N.J)()],f.prototype,"useNaturalPinchZoom",void 0),(0,w.b)([(0,N.J)()],f.prototype,"pinchZoom",void 0),(0,w.b)([(0,N.J)()],f.prototype,"panningSensibility",void 0),(0,w.b)([(0,N.J)()],f.prototype,"multiTouchPanning",void 0),(0,w.b)([(0,N.J)()],f.prototype,"multiTouchPanAndZoom",void 0),F.b.ArcRotateCameraPointersInput=f;var v=A(11156);class m{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(d){d=q.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const A=t.event;if(!A.metaKey)if(t.type===v.b.KEYDOWN){if(this._ctrlPressed=A.ctrlKey,this._altPressed=A.altKey,-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysReset.indexOf(A.keyCode)){-1===this._keys.indexOf(A.keyCode)&&this._keys.push(A.keyCode),A.preventDefault&&(d||A.preventDefault())}}else if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysReset.indexOf(A.keyCode)){const t=this._keys.indexOf(A.keyCode);t>=0&&this._keys.splice(t,1),A.preventDefault&&(d||A.preventDefault())}})))}Qi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const d=this.camera;for(let t=0;t<this._keys.length;t++){const A=this._keys[t];-1!==this.keysLeft.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?d.inertialPanningX-=1/this.panningSensibility:d.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?d.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?d.inertialRadiusOffset+=1/this.zoomingSensibility:d.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?d.inertialPanningX+=1/this.panningSensibility:d.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(A)?this._ctrlPressed&&this.camera._useCtrlForPanning?d.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?d.inertialRadiusOffset-=1/this.zoomingSensibility:d.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(A)&&d.useInputToRestoreState&&d.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,w.b)([(0,N.J)()],m.prototype,"keysUp",void 0),(0,w.b)([(0,N.J)()],m.prototype,"keysDown",void 0),(0,w.b)([(0,N.J)()],m.prototype,"keysLeft",void 0),(0,w.b)([(0,N.J)()],m.prototype,"keysRight",void 0),(0,w.b)([(0,N.J)()],m.prototype,"keysReset",void 0),(0,w.b)([(0,N.J)()],m.prototype,"panningSensibility",void 0),(0,w.b)([(0,N.J)()],m.prototype,"zoomingSensibility",void 0),(0,w.b)([(0,N.J)()],m.prototype,"useAltToZoom",void 0),(0,w.b)([(0,N.J)()],m.prototype,"angularSpeed",void 0),F.b.ArcRotateCameraKeyboardMoveInput=m;var j=A(11181),n=A(11159),R=A(11087);class Z{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new B.l(0,0,0),this._globalOffset=new B.l(0,0,0),this._inertialPanning=B.l.Zero()}_computeDeltaFromMouseWheelLegacyEvent(d,t){let A=0;const w=.01*d*this.wheelDeltaPercentage*t;return A=d>0?w/(1+this.wheelDeltaPercentage):w*(1+this.wheelDeltaPercentage),A}attachControl(d){d=q.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==a.e.POINTERWHEEL)return;const A=t.event;let w=0;const N=A.deltaMode===n.e.DOM_DELTA_LINE?40:1,p=-A.deltaY*N;if(this.customComputeDeltaFromMouseWheel)w=this.customComputeDeltaFromMouseWheel(p,this,A);else if(this.wheelDeltaPercentage){if(w=this._computeDeltaFromMouseWheelLegacyEvent(p,this.camera.i),w>0){let d=this.camera.i,t=this.camera.inertialRadiusOffset+w;for(let A=0;A<20&&Math.abs(t)>.001;A++)d-=t,t*=this.camera.inertia;d=(0,R.e)(d,0,Number.MAX_VALUE),w=this._computeDeltaFromMouseWheelLegacyEvent(p,d)}}else w=p/(40*this.wheelPrecision);w&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(w)):this.camera.inertialRadiusOffset+=w),A.preventDefault&&(d||A.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,a.e.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Dj(0)}Qi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const d=this.camera;0+d.inertialAlphaOffset+d.inertialBetaOffset+d.inertialRadiusOffset&&(this._updateHitPlane(),d.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(d.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const d=this.camera,t=d.target.Uc(d.position);this._hitPlane=j.b.FromPositionAndNormal(d.target,t)}_getPosition(){const d=this.camera,t=d.va(),A=t.createPickingRay(t.pointerX,t.pointerY,B.c.Identity(),d,!1);0===d.targetScreenOffset.x&&0===d.targetScreenOffset.y||(this._viewOffset.set(d.targetScreenOffset.x,d.targetScreenOffset.y,0),d.getViewMatrix().invertToRef(d._cameraTransformMatrix),this._globalOffset=B.l.TransformNormal(this._viewOffset,d._cameraTransformMatrix),A.origin.addInPlace(this._globalOffset));let w=0;return this._hitPlane&&(w=A.intersectsPlane(this._hitPlane)??0),A.origin.addInPlace(A.direction.scaleInPlace(w))}_zoomToMouse(d){const t=this.camera,A=1-t.inertia;if(t.lowerRadiusLimit){const w=t.lowerRadiusLimit??0;t.i-(t.inertialRadiusOffset+d)/A<w&&(d=(t.i-w)*A-t.inertialRadiusOffset)}if(t.upperRadiusLimit){const w=t.upperRadiusLimit??0;t.i-(t.inertialRadiusOffset+d)/A>w&&(d=(t.i-w)*A-t.inertialRadiusOffset)}const w=d/A/t.i,N=this._getPosition(),p=B.h.gb[6];N.subtractToRef(t.target,p),p.scaleInPlace(w),p.scaleInPlace(A),this._inertialPanning.addInPlace(p),t.inertialRadiusOffset+=d}_zeroIfClose(d){Math.abs(d.x)<i.b&&(d.x=0),Math.abs(d.y)<i.b&&(d.y=0),Math.abs(d.z)<i.b&&(d.z=0)}}(0,w.b)([(0,N.J)()],Z.prototype,"wheelPrecision",void 0),(0,w.b)([(0,N.J)()],Z.prototype,"zoomToMouseLocation",void 0),(0,w.b)([(0,N.J)()],Z.prototype,"wheelDeltaPercentage",void 0),F.b.ArcRotateCameraMouseWheelInput=Z;class L extends F.e{constructor(d){super(d)}addMouseWheel(){return this.add(new Z),this}addPointers(){return this.add(new f),this}addKeyboard(){return this.add(new m),this}}var I=A(10885);X.d.AddNodeConstructor("ArcRotateCamera",((d,t)=>()=>new u(d,0,0,1,B.l.Zero(),t)));class u extends T.c{get target(){return this._target}set target(d){this.setTarget(d)}get targetHost(){return this._targetHost}set targetHost(d){d&&this.setTarget(d)}getTarget(){return this.target}get position(){return this._position}set position(d){this.setPosition(d)}set upVector(d){this._upToYMatrix||(this._yToUpMatrix=new B.c,this._upToYMatrix=new B.c,this._upVector=B.l.Zero()),d.normalize(),this._upVector.p(d),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){B.c.RotationAlignToRef(B.l.UpReadOnly,this._upVector,this._yToUpMatrix),B.c.RotationAlignToRef(this._upVector,B.l.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const d=this.inputs.attached.pointers;return d?d.angularSensibilityX:0}set angularSensibilityX(d){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityX=d)}get angularSensibilityY(){const d=this.inputs.attached.pointers;return d?d.angularSensibilityY:0}set angularSensibilityY(d){const t=this.inputs.attached.pointers;t&&(t.angularSensibilityY=d)}get pinchPrecision(){const d=this.inputs.attached.pointers;return d?d.pinchPrecision:0}set pinchPrecision(d){const t=this.inputs.attached.pointers;t&&(t.pinchPrecision=d)}get pinchDeltaPercentage(){const d=this.inputs.attached.pointers;return d?d.pinchDeltaPercentage:0}set pinchDeltaPercentage(d){const t=this.inputs.attached.pointers;t&&(t.pinchDeltaPercentage=d)}get useNaturalPinchZoom(){const d=this.inputs.attached.pointers;return!!d&&d.useNaturalPinchZoom}set useNaturalPinchZoom(d){const t=this.inputs.attached.pointers;t&&(t.useNaturalPinchZoom=d)}get panningSensibility(){const d=this.inputs.attached.pointers;return d?d.panningSensibility:0}set panningSensibility(d){const t=this.inputs.attached.pointers;t&&(t.panningSensibility=d)}get keysUp(){const d=this.inputs.attached.keyboard;return d?d.keysUp:[]}set keysUp(d){const t=this.inputs.attached.keyboard;t&&(t.keysUp=d)}get keysDown(){const d=this.inputs.attached.keyboard;return d?d.keysDown:[]}set keysDown(d){const t=this.inputs.attached.keyboard;t&&(t.keysDown=d)}get keysLeft(){const d=this.inputs.attached.keyboard;return d?d.keysLeft:[]}set keysLeft(d){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=d)}get keysRight(){const d=this.inputs.attached.keyboard;return d?d.keysRight:[]}set keysRight(d){const t=this.inputs.attached.keyboard;t&&(t.keysRight=d)}get wheelPrecision(){const d=this.inputs.attached.mousewheel;return d?d.wheelPrecision:0}set wheelPrecision(d){const t=this.inputs.attached.mousewheel;t&&(t.wheelPrecision=d)}get zoomToMouseLocation(){const d=this.inputs.attached.mousewheel;return!!d&&d.zoomToMouseLocation}set zoomToMouseLocation(d){const t=this.inputs.attached.mousewheel;t&&(t.zoomToMouseLocation=d)}get wheelDeltaPercentage(){const d=this.inputs.attached.mousewheel;return d?d.wheelDeltaPercentage:0}set wheelDeltaPercentage(d){const t=this.inputs.attached.mousewheel;t&&(t.wheelDeltaPercentage=d)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(d){d!==this.useBouncingBehavior&&(d?(this._bouncingBehavior=new P,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(d){d!==this.useFramingBehavior&&(d?(this._framingBehavior=new J,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(d){d!==this.useAutoRotationBehavior&&(d?(this._autoRotationBehavior=new k,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(d,t,A,w,N,X){var W;let a=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(d,B.l.Zero(),X,a),W=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=B.l.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=B.j.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new B.c,this.panningAxis=new B.l(1,1,0),this._transformedDirection=new B.l,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new p.b,this.checkCollisions=!1,this.collisionRadius=new B.l(.5,.5,.5),this._previousPosition=B.l.Zero(),this._collisionVelocity=B.l.Zero(),this._newPosition=B.l.Zero(),this._computationVector=B.l.Zero(),this._onCollisionPositionChange=function(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A?(W.setPosition(t),W.Jk&&W.Jk(A)):W._previousPosition.p(W._position);const w=Math.cos(W.alpha),N=Math.sin(W.alpha),p=Math.cos(W.beta);let B=Math.sin(W.beta);0===B&&(B=1e-4);const X=W._getTargetPosition();W._computationVector.wf(W.i*w*B,W.i*p,W.i*N*B),X.addToRef(W._computationVector,W._newPosition),W._position.p(W._newPosition);let a=W.upVector;W.allowUpsideDown&&W.beta<0&&(a=a.clone(),a=a.negate()),W._computeViewMatrix(W._position,X,a),W._viewMatrix.addAtIndex(12,W.targetScreenOffset.x),W._viewMatrix.addAtIndex(13,W.targetScreenOffset.y),W._collisionTriggered=!1},this._target=B.l.Zero(),N&&this.setTarget(N),this.alpha=t,this.beta=A,this.i=w,this.getViewMatrix(),this.inputs=new L(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new B.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.i=void 0,this._cache.targetScreenOffset=B.j.Zero()}_updateCache(d){d||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.i=this.i,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const d=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?d.addToRef(this._targetBoundingCenter,this._target):this._target.p(d)}const d=this._getLockedTargetPosition();return d||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.i,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>i.b&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.i=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.i===this.i&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const N=arguments;t=q.g.BackCompatCameraNoPreventDefault(N),this._useCtrlForPanning=A,this._panningMouseButton=w,"boolean"===typeof N[0]&&(N.length>1&&(this._useCtrlForPanning=N[1]),N.length>2&&(this._panningMouseButton=N[2])),this.inputs.attachElement(t),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Qi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const d=this._scene.getEngine().getDeltaTime()/1e3,t=1-Math.pow(2,-d/this.restoreStateInterpolationFactor);this.setTarget(B.l.Lerp(this.getTarget(),this._storedTarget,t)),B.f.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,B.h.Quaternion[0]),B.f.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,B.h.Quaternion[1]),B.f.SlerpToRef(B.h.Quaternion[1],B.h.Quaternion[0],t,B.h.Quaternion[2]),B.h.Quaternion[2].normalize(),B.h.Quaternion[2].toAlphaBetaGammaToRef(B.h.gb[0]),this.alpha=B.h.gb[0].x,this.beta=B.h.gb[0].y,this.i+=(this._storedRadius-this.i)*t,B.j.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,t,this.targetScreenOffset),(B.l.DistanceSquared(this.getTarget(),this._storedTarget)<i.b&&B.h.Quaternion[2].equalsWithEpsilon(B.h.Quaternion[0])&&Math.pow(this._storedRadius-this.i,2)<i.b&&B.j.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<i.b||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const d=this.invertRotation?-1:1,t=this._calculateHandednessMultiplier();let A=this.inertialAlphaOffset*t;this.beta<0&&(A*=-1),this.alpha+=A*d,this.beta+=this.inertialBetaOffset*d,this.i-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<i.b&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<i.b&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*i.b&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const d=new B.l(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),d.multiplyInPlace(this.panningAxis),B.l.TransformNormalToRef(d,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const d=this.upVector,t=B.l.CrossToRef(this._transformedDirection,d,this._transformedDirection);B.l.CrossToRef(d,t,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);B.l.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const d=B.h.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(d),d.transposeToRef(d),B.l.TransformCoordinatesToRef(this._transformedDirection,d,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*i.b&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*i.b&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.i<this.lowerRadiusLimit&&(this.i=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.i>this.upperRadiusLimit&&(this.i=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.l.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.i=this._computationVector.length(),0===this.i&&(this.i=1e-4);const d=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const t=Math.round((d-this.alpha)/(2*Math.PI));this.alpha+=2*t*Math.PI,this.beta=Math.acos(this._computationVector.y/this.i),this._checkLimits()}setPosition(d){this._position.equals(d)||(this._position.p(d),this.rebuildAnglesAndRadius())}setTarget(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(w=this.overrideCloneAlphaBetaRadius??w,d.Nj)t&&d.getBoundingInfo?this._targetBoundingCenter=d.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,d.Nj(),this._targetHost=d,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const t=d,w=this._getTargetPosition();if(w&&!A&&w.equals(t))return;this._targetHost=null,this._target=t,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}w||this.rebuildAnglesAndRadius()}_getViewMatrix(){const d=Math.cos(this.alpha),t=Math.sin(this.alpha),A=Math.cos(this.beta);let w=Math.sin(this.beta);0===w&&(w=1e-4),0===this.i&&(this.i=1e-4);const N=this._getTargetPosition();if(this._computationVector.wf(this.i*d*w,this.i*A,this.i*t*w),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||B.l.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),N.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const d=this.va().collisionCoordinator;this._collider||(this._collider=d.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,d.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let d=this.upVector;this.allowUpsideDown&&w<0&&(d=d.negate()),this._computeViewMatrix(this._position,N,d),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=N,this._viewMatrix}zoomOn(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d=d||this.va().meshes;const A=W.d.MinMax(d);let w=this._calculateLowerRadiusFromModelBoundingSphere(A.min,A.max);w=Math.max(Math.min(w,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.i=w*this.zoomOnFactor,this.focusOn({min:A.min,max:A.max,distance:w},t)}focusOn(d){let t,A,w=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===d.min){const w=d||this.va().meshes;t=W.d.MinMax(w),A=B.l.Distance(t.min,t.max)}else{t=d,A=d.distance}this._target=W.d.Center(t),w||(this.maxZ=2*A)}createRigCamera(d,t){let A=0;switch(this.cameraRigMode){case U.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.d.RIG_MODE_VR:A=this._cameraRigParams.stereoHalfAngle*(0===t?1:-1);break;case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:A=this._cameraRigParams.stereoHalfAngle*(0===t?-1:1)}const w=new u(d,this.alpha+A,this.beta,this.i,this._target,this.va());return w._cameraRigParams={},w.isRigCamera=!0,w.rigParent=this,w.upVector=this.upVector,w.mode=this.mode,w.orthoLeft=this.orthoLeft,w.orthoRight=this.orthoRight,w.orthoBottom=this.orthoBottom,w.orthoTop=this.orthoTop,w}_updateRigCameras(){const d=this._rigCameras[0],t=this._rigCameras[1];switch(d.beta=t.beta=this.beta,this.cameraRigMode){case U.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case U.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case U.d.RIG_MODE_STEREOSCOPIC_INTERLACED:case U.d.RIG_MODE_VR:d.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case U.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:d.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,t.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const w=B.l.Distance(d,t),N=this.va().getEngine().getAspectRatio(this),p=Math.tan(this.fov/2),X=p*N,W=.5*w*A,a=W*Math.sqrt(1+1/(X*X)),D=W*Math.sqrt(1+1/(p*p));return Math.max(a,D)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,w.b)([(0,N.J)()],u.prototype,"alpha",void 0),(0,w.b)([(0,N.J)()],u.prototype,"beta",void 0),(0,w.b)([(0,N.J)()],u.prototype,"i",void 0),(0,w.b)([(0,N.J)()],u.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,w.b)([(0,N.H)("target")],u.prototype,"_target",void 0),(0,w.b)([(0,N.x)("targetHost")],u.prototype,"_targetHost",void 0),(0,w.b)([(0,N.J)()],u.prototype,"inertialAlphaOffset",void 0),(0,w.b)([(0,N.J)()],u.prototype,"inertialBetaOffset",void 0),(0,w.b)([(0,N.J)()],u.prototype,"inertialRadiusOffset",void 0),(0,w.b)([(0,N.J)()],u.prototype,"lowerAlphaLimit",void 0),(0,w.b)([(0,N.J)()],u.prototype,"upperAlphaLimit",void 0),(0,w.b)([(0,N.J)()],u.prototype,"lowerBetaLimit",void 0),(0,w.b)([(0,N.J)()],u.prototype,"upperBetaLimit",void 0),(0,w.b)([(0,N.J)()],u.prototype,"lowerRadiusLimit",void 0),(0,w.b)([(0,N.J)()],u.prototype,"upperRadiusLimit",void 0),(0,w.b)([(0,N.J)()],u.prototype,"inertialPanningX",void 0),(0,w.b)([(0,N.J)()],u.prototype,"inertialPanningY",void 0),(0,w.b)([(0,N.J)()],u.prototype,"pinchToPanMaxDistance",void 0),(0,w.b)([(0,N.J)()],u.prototype,"panningDistanceLimit",void 0),(0,w.b)([(0,N.H)()],u.prototype,"panningOriginTarget",void 0),(0,w.b)([(0,N.J)()],u.prototype,"panningInertia",void 0),(0,w.b)([(0,N.J)()],u.prototype,"zoomToMouseLocation",null),(0,w.b)([(0,N.J)()],u.prototype,"zoomOnFactor",void 0),(0,w.b)([(0,N.F)()],u.prototype,"targetScreenOffset",void 0),(0,w.b)([(0,N.J)()],u.prototype,"allowUpsideDown",void 0),(0,w.b)([(0,N.J)()],u.prototype,"useInputToRestoreState",void 0),(0,w.b)([(0,N.J)()],u.prototype,"restoreStateInterpolationFactor",void 0),(0,I.g)("BABYLON.ArcRotateCamera",u)},11320:(d,t,A)=>{"use strict";A.d(t,{d:()=>J});var w=A(11041),N=A(11047),p=A(11054),B=A(10727),X=A(10730),W=A(11076),a=A(11326),D=A(10740),i=A(10885),k=A(10761),b=A(11333),Q=A(11173),P=A(11097);class J extends a.d{get position(){return this._position}set position(d){this._position=d}set upVector(d){this._upVector=d}get upVector(){return this._upVector}get screenArea(){let d=0,t=0;if(this.mode===J.PERSPECTIVE_CAMERA)this.fovMode===J.FOVMODE_VERTICAL_FIXED?(t=2*this.Ui*Math.tan(this.fov/2),d=this.getEngine().getAspectRatio(this)*t):(d=2*this.Ui*Math.tan(this.fov/2),t=d/this.getEngine().getAspectRatio(this));else{const A=this.getEngine().getRenderWidth()/2,w=this.getEngine().getRenderHeight()/2;d=(this.orthoRight??A)-(this.orthoLeft??-A),t=(this.orthoTop??w)-(this.orthoBottom??-w)}return d*t}set orthoLeft(d){this._orthoLeft=d;for(const t of this._rigCameras)t.orthoLeft=d}get orthoLeft(){return this._orthoLeft}set orthoRight(d){this._orthoRight=d;for(const t of this._rigCameras)t.orthoRight=d}get orthoRight(){return this._orthoRight}set orthoBottom(d){this._orthoBottom=d;for(const t of this._rigCameras)t.orthoBottom=d}get orthoBottom(){return this._orthoBottom}set orthoTop(d){this._orthoTop=d;for(const t of this._rigCameras)t.orthoTop=d}get orthoTop(){return this._orthoTop}set mode(d){this._mode=d;for(const t of this._rigCameras)t.mode=d}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(d,t,A){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(d,A,!1),this._position=W.l.Zero(),this._upVector=W.l.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Ui=1,this.maxZ=1e4,this.inertia=.9,this._mode=J.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new b.d(0,0,1,1),this.layerMask=268435455,this.fovMode=J.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=J.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new X.b,this.onProjectionMatrixChangedObservable=new X.b,this.onAfterCheckInputsObservable=new X.b,this.onRestoreStateObservable=new X.b,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new W.c,this._postProcesses=new Array,this._activeMeshes=new p.d(256),this._globalPosition=W.l.Zero(),this._computedViewMatrix=W.c.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=W.c.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=W.f.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),w&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=t,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${d}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"jh"}toString(d){let t="Name: "+this.name;if(t+=", type: "+this.getClassName(),this.animations)for(let A=0;A<this.animations.length;A++)t+=", animation[0]: "+this.animations[A].toString(d);return t}applyVerticalCorrection(){const d=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-d.x:d.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(d){return-1!==this._activeMeshes.indexOf(d)}isReady(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(d)for(const t of this._postProcesses)if(t&&!t.isReady())return!1;return super.isReady(d)}_initCache(){super._initCache(),this._cache.position=new W.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new W.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Ui=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(d){d||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let d=this._cache.mode===this.mode&&this._cache.Ui===this.Ui&&this._cache.maxZ===this.maxZ;if(!d)return!1;const t=this.getEngine();return this.mode===J.PERSPECTIVE_CAMERA?d=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===t.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(d=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===t.getRenderWidth()&&this._cache.renderHeight===t.getRenderHeight(),this.oblique&&(d=d&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),d}attachControl(d,t){}Qi(d){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==J.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let d=0;d<this._postProcesses.length;d++)if(null!==this._postProcesses[d])return this._postProcesses[d];return null}_cascadePostProcessesToRigCams(){const d=this._getFirstPostProcess();d&&d.markTextureDirty();for(let t=0,A=this._rigCameras.length;t<A;t++){const d=this._rigCameras[t],A=d._rigPostProcess;if(A){"pass"===A.getEffectName()&&(d.isIntermediate=0===this._postProcesses.length),d._postProcesses=this._postProcesses.slice(0).concat(A),A.markTextureDirty()}else d._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!d.isReusable()&&this._postProcesses.indexOf(d)>-1?(D.e.Error("You're trying to reuse a post process not defined as reusable."),0):(null==t||t<0?this._postProcesses.push(d):null===this._postProcesses[t]?this._postProcesses[t]=d:this._postProcesses.splice(t,0,d),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.Cg(),this._postProcesses.indexOf(d))}detachPostProcess(d){const t=this._postProcesses.indexOf(d);-1!==t&&(this._postProcesses[t]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.Cg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return W.c.Identity()}getViewMatrix(d){return!d&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(d){this._doNotComputeProjectionMatrix=!0,void 0!==d&&(this._projectionMatrix=d)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(d){if(this._doNotComputeProjectionMatrix||!d&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Ui=this.Ui,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const t=this.getEngine(),A=this.va(),w=t.useReverseDepthBuffer;if(this.mode===J.PERSPECTIVE_CAMERA){let d;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=t.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Ui<=0&&(this.Ui=.1),d=A.useRightHandedSystem?W.c.PerspectiveFovRHToRef:W.c.PerspectiveFovLHToRef,d(this.fov,t.getAspectRatio(this),w?this.maxZ:this.Ui,w?this.Ui:this.maxZ,this._projectionMatrix,this.fovMode===J.FOVMODE_VERTICAL_FIXED,t.isNDCHalfZRange,this.projectionPlaneTilt,w)}else{var N,p,B;const d=t.getRenderWidth()/2,X=t.getRenderHeight()/2;A.useRightHandedSystem?this.oblique?W.c.ObliqueOffCenterRHToRef(this.orthoLeft??-d,this.orthoRight??d,this.orthoBottom??-X,this.orthoTop??X,w?this.maxZ:this.Ui,w?this.Ui:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):W.c.OrthoOffCenterRHToRef(this.orthoLeft??-d,this.orthoRight??d,this.orthoBottom??-X,this.orthoTop??X,w?this.maxZ:this.Ui,w?this.Ui:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange):this.oblique?W.c.ObliqueOffCenterLHToRef(this.orthoLeft??-d,this.orthoRight??d,this.orthoBottom??-X,this.orthoTop??X,w?this.maxZ:this.Ui,w?this.Ui:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,t.isNDCHalfZRange):W.c.OrthoOffCenterLHToRef(this.orthoLeft??-d,this.orthoRight??d,this.orthoBottom??-X,this.orthoTop??X,w?this.maxZ:this.Ui,w?this.Ui:this.maxZ,this._projectionMatrix,t.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(N=this.oblique)||void 0===N?void 0:N.angle,this._cache.obliqueLength=null===(p=this.oblique)||void 0===p?void 0:p.length,this._cache.obliqueOffset=null===(B=this.oblique)||void 0===B?void 0:B.offset,this._cache.renderWidth=t.getRenderWidth(),this._cache.renderHeight=t.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(d){return(this.i||(this.target?W.l.Distance(this.position,this.target):this.position.length()))+d}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?Q.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=Q.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),t&&this.rigCameras.length>0){let t=!1;return this.rigCameras.forEach((A=>{A._updateFrustumPlanes(),t=t||d.isInFrustum(A._frustumPlanes)})),t}return d.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(d){return this._updateFrustumPlanes(),d.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,k.b)("Ray")}getForwardRayToRef(d){throw(0,k.b)("Ray")}dispose(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const d=this._rigCameras.pop();d&&d.dispose()}if(this._parentContainer){const d=this._parentContainer.cameras.indexOf(this);d>-1&&this._parentContainer.cameras.splice(d,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==J.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let d=this._postProcesses.length;for(;--d>=0;){const t=this._postProcesses[d];t&&t.dispose(this)}}let A=this.customRenderTargets.length;for(;--A>=0;)this.customRenderTargets[A].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(d,t)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(d,t){if(this.cameraRigMode!==d){for(;this._rigCameras.length>0;){const d=this._rigCameras.pop();d&&d.dispose()}if(this.cameraRigMode=d,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=t.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=B.g.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==J.RIG_MODE_NONE){const d=this.createRigCamera(this.name+"_L",0);d&&(d._isLeftCamera=!0);const t=this.createRigCamera(this.name+"_R",1);t&&(t._isRightCamera=!0),d&&t&&(this._rigCameras.push(d),this._rigCameras.push(t))}this._setRigMode(t),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(d){}_getVRProjectionMatrix(){return W.c.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Ui,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(d,t){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[d]=t,"interaxialDistance"===d&&(this._cameraRigParams.stereoHalfAngle=B.g.ToRadians(t/.0637))}createRigCamera(d,t){return null}_updateRigCameras(){for(let d=0;d<this._rigCameras.length;d++)this._rigCameras[d].Ui=this.Ui,this._rigCameras[d].maxZ=this.maxZ,this._rigCameras[d].fov=this.fov,this._rigCameras[d].upVector.p(this.upVector);this.cameraRigMode===J.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const d=P.d.Serialize(this);return d.uniqueId=this.uniqueId,d.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(d),this.inputs&&this.inputs.serialize(d),P.d.AppendSerializedAnimations(this,d),d.ranges=this.serializeAnimationRanges(),d.isEnabled=this.isEnabled(),d}clone(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=P.d.Clone(J.GetConstructorFromName(this.getClassName(),d,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return A.name=d,A.parent=t,this.onClonedObservable.notifyObservers(A),A}me(d){const t=W.l.Zero();return this.getDirectionToRef(d,t),t}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(d,t){W.l.TransformNormalToRef(d,this.getWorldMatrix(),t)}static GetConstructorFromName(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const p=a.d.Construct(d,t,A,{interaxial_distance:w,isStereoscopicSideBySide:N});return p||(()=>J._CreateDefaultParsedCamera(t,A))}Nj(){return this.getWorldMatrix()}static Parse(d,t){const A=d.type,w=J.GetConstructorFromName(A,d.name,t,d.interaxial_distance,d.isStereoscopicSideBySide),N=P.d.Parse(w,d,t);if(void 0!==d.parentId&&(N._waitingParentId=d.parentId),void 0!==d.parentInstanceIndex&&(N._waitingParentInstanceIndex=d.parentInstanceIndex),N.inputs&&(N.inputs.parse(d),N._setupInputs()),d.upVector&&(N.upVector=W.l.Lg(d.upVector)),N.setPosition&&(N.position.wf(0,0,0),N.setPosition(W.l.Lg(d.position))),d.target&&N.setTarget&&N.setTarget(W.l.Lg(d.target)),d.cameraRigMode){const t=d.interaxial_distance?{interaxialDistance:d.interaxial_distance}:{};N.setCameraRigMode(d.cameraRigMode,t)}if(d.animations){for(let t=0;t<d.animations.length;t++){const A=d.animations[t],w=(0,i.d)("BABYLON.Animation");w&&N.animations.push(w.Parse(A))}a.d.ParseAnimationRanges(N,d,t)}return d.autoAnimate&&t.beginAnimation(N,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),void 0!==d.isEnabled&&N.Mf(d.isEnabled),N}_calculateHandednessMultiplier(){let d=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(d*=-1),d}}J._CreateDefaultParsedCamera=(d,t)=>{throw(0,k.b)("UniversalCamera")},J.PERSPECTIVE_CAMERA=0,J.ORTHOGRAPHIC_CAMERA=1,J.FOVMODE_VERTICAL_FIXED=0,J.FOVMODE_HORIZONTAL_FIXED=1,J.RIG_MODE_NONE=0,J.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,J.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,J.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,J.RIG_MODE_STEREOSCOPIC_INTERLACED=14,J.RIG_MODE_VR=20,J.RIG_MODE_CUSTOM=22,J.ForceAttachControlToAlwaysPreventDefault=!1,(0,w.b)([(0,N.H)("position")],J.prototype,"_position",void 0),(0,w.b)([(0,N.H)("upVector")],J.prototype,"_upVector",void 0),(0,w.b)([(0,N.J)()],J.prototype,"orthoLeft",null),(0,w.b)([(0,N.J)()],J.prototype,"orthoRight",null),(0,w.b)([(0,N.J)()],J.prototype,"orthoBottom",null),(0,w.b)([(0,N.J)()],J.prototype,"orthoTop",null),(0,w.b)([(0,N.J)()],J.prototype,"fov",void 0),(0,w.b)([(0,N.J)()],J.prototype,"projectionPlaneTilt",void 0),(0,w.b)([(0,N.J)()],J.prototype,"Ui",void 0),(0,w.b)([(0,N.J)()],J.prototype,"maxZ",void 0),(0,w.b)([(0,N.J)()],J.prototype,"inertia",void 0),(0,w.b)([(0,N.J)()],J.prototype,"mode",null),(0,w.b)([(0,N.J)()],J.prototype,"layerMask",void 0),(0,w.b)([(0,N.J)()],J.prototype,"fovMode",void 0),(0,w.b)([(0,N.J)()],J.prototype,"cameraRigMode",void 0),(0,w.b)([(0,N.J)()],J.prototype,"interaxialDistance",void 0),(0,w.b)([(0,N.J)()],J.prototype,"isStereoscopicSideBySide",void 0)},12018:(d,t,A)=>{"use strict";A.d(t,{b:()=>B,e:()=>X});var w=A(10740),N=A(11097),p=A(11320),B={};class X{constructor(d){this.attachedToElement=!1,this.attached={},this.camera=d,this.checkInputs=()=>{}}add(d){const t=d.getSimpleName();this.attached[t]?w.e.Warn("camera input of type "+t+" already exists on camera"):(this.attached[t]=d,d.camera=this.camera,d.checkInputs&&(this.checkInputs=this._addCheckInputs(d.checkInputs.bind(d))),this.attachedToElement&&d.attachControl(this.noPreventDefault))}remove(d){for(const t in this.attached){const A=this.attached[t];if(A===d)return A.Qi(),A.camera=null,delete this.attached[t],void this.rebuildInputCheck()}}removeByType(d){for(const t in this.attached){const A=this.attached[t];A.getClassName()===d&&(A.Qi(),A.camera=null,delete this.attached[t],this.rebuildInputCheck())}}_addCheckInputs(d){const t=this.checkInputs;return()=>{t(),d()}}attachInput(d){this.attachedToElement&&d.attachControl(this.noPreventDefault)}attachElement(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){d=!p.d.ForceAttachControlToAlwaysPreventDefault&&d,this.attachedToElement=!0,this.noPreventDefault=d;for(const t in this.attached)this.attached[t].attachControl(d)}}detachElement(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const t in this.attached)this.attached[t].Qi(),d&&(this.attached[t].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const d in this.attached){const t=this.attached[d];t.checkInputs&&(this.checkInputs=this._addCheckInputs(t.checkInputs.bind(t)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(d){const t={};for(const A in this.attached){const d=this.attached[A],w=N.d.Serialize(d);t[d.getClassName()]=w}d.inputsmgr=t}parse(d){const t=d.inputsmgr;if(t){this.clear();for(const d in t){const A=B[d];if(A){const w=t[d],p=N.d.Parse((()=>new A),w,null);this.add(p)}}}else for(const A in this.attached){const t=B[this.attached[A].getClassName()];if(t){const w=N.d.Parse((()=>new t),d,null);this.remove(this.attached[A]),this.add(w)}}}}},12009:(d,t,A)=>{"use strict";A.d(t,{c:()=>f});var w=A(11041),N=A(11047),p=A(11076),B=A(12012),X=A(12018),W=A(11156),a=A(10727);class D{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(d){d=a.g.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((t=>{const A=t.event;if(!A.metaKey)if(t.type===W.b.KEYDOWN){if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysUpward.indexOf(A.keyCode)||-1!==this.keysDownward.indexOf(A.keyCode)||-1!==this.keysRotateLeft.indexOf(A.keyCode)||-1!==this.keysRotateRight.indexOf(A.keyCode)||-1!==this.keysRotateUp.indexOf(A.keyCode)||-1!==this.keysRotateDown.indexOf(A.keyCode)){-1===this._keys.indexOf(A.keyCode)&&this._keys.push(A.keyCode),d||A.preventDefault()}}else if(-1!==this.keysUp.indexOf(A.keyCode)||-1!==this.keysDown.indexOf(A.keyCode)||-1!==this.keysLeft.indexOf(A.keyCode)||-1!==this.keysRight.indexOf(A.keyCode)||-1!==this.keysUpward.indexOf(A.keyCode)||-1!==this.keysDownward.indexOf(A.keyCode)||-1!==this.keysRotateLeft.indexOf(A.keyCode)||-1!==this.keysRotateRight.indexOf(A.keyCode)||-1!==this.keysRotateUp.indexOf(A.keyCode)||-1!==this.keysRotateDown.indexOf(A.keyCode)){const t=this._keys.indexOf(A.keyCode);t>=0&&this._keys.splice(t,1),d||A.preventDefault()}})))}Qi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const d=this.camera;for(let t=0;t<this._keys.length;t++){const A=this._keys[t],w=d._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(A)?d._localDirection.wf(-w,0,0):-1!==this.keysUp.indexOf(A)?d._localDirection.wf(0,0,w):-1!==this.keysRight.indexOf(A)?d._localDirection.wf(w,0,0):-1!==this.keysDown.indexOf(A)?d._localDirection.wf(0,0,-w):-1!==this.keysUpward.indexOf(A)?d._localDirection.wf(0,w,0):-1!==this.keysDownward.indexOf(A)?d._localDirection.wf(0,-w,0):-1!==this.keysRotateLeft.indexOf(A)?(d._localDirection.wf(0,0,0),d.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(A)?(d._localDirection.wf(0,0,0),d.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(A)?(d._localDirection.wf(0,0,0),d.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(A)&&(d._localDirection.wf(0,0,0),d.cameraRotation.x+=this._getLocalRotation()),d.va().useRightHandedSystem&&(d._localDirection.z*=-1),d.getViewMatrix().invertToRef(d._cameraTransformMatrix),p.l.TransformNormalToRef(d._localDirection,d._cameraTransformMatrix,d._transformedDirection),d.cameraDirection.addInPlace(d._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const d=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*d}}(0,w.b)([(0,N.J)()],D.prototype,"keysUp",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysUpward",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysDown",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysDownward",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysLeft",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysRight",void 0),(0,w.b)([(0,N.J)()],D.prototype,"rotationSpeed",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysRotateLeft",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysRotateRight",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysRotateUp",void 0),(0,w.b)([(0,N.J)()],D.prototype,"keysRotateDown",void 0),X.b.FreeCameraKeyboardMoveInput=D;var i=A(10730),k=A(11151);class b{constructor(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=d,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new i.b,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(d){d=a.g.BackCompatCameraNoPreventDefault(arguments);const t=this.camera.getEngine(),A=t.getInputElement();this._pointerInput||(this._pointerInput=w=>{const N=w.event,p="touch"===N.pointerType;if(!this.touchEnabled&&p)return;if(w.type!==k.e.POINTERMOVE&&-1===this.buttons.indexOf(N.button))return;const B=N.target;if(w.type===k.e.POINTERDOWN){if(p&&-1!==this._activePointerId||!p&&-1!==this._currentActiveButton)return;this._activePointerId=N.pointerId;try{null===B||void 0===B||B.setPointerCapture(N.pointerId)}catch(X){}-1===this._currentActiveButton&&(this._currentActiveButton=N.button),this._previousPosition={x:N.clientX,y:N.clientY},d||(N.preventDefault(),A&&A.focus()),t.isPointerLock&&this._onMouseMove&&this._onMouseMove(w.event)}else if(w.type===k.e.POINTERUP){if(p&&this._activePointerId!==N.pointerId||!p&&this._currentActiveButton!==N.button)return;try{null===B||void 0===B||B.releasePointerCapture(N.pointerId)}catch(X){}this._currentActiveButton=-1,this._previousPosition=null,d||N.preventDefault(),this._activePointerId=-1}else if(w.type===k.e.POINTERMOVE&&(this._activePointerId===N.pointerId||!p))if(t.isPointerLock&&this._onMouseMove)this._onMouseMove(w.event);else if(this._previousPosition){const t=this.camera._calculateHandednessMultiplier(),A=(N.clientX-this._previousPosition.x)*t,w=N.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=A/this.angularSensibility,this.camera.cameraRotation.x+=w/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:A,offsetY:w}),this._previousPosition={x:N.clientX,y:N.clientY},d||N.preventDefault()}}),this._onMouseMove=A=>{if(!t.isPointerLock)return;const w=this.camera._calculateHandednessMultiplier(),N=A.movementX*w;this.camera.cameraRotation.y+=N/this.angularSensibility;const p=A.movementY;this.camera.cameraRotation.x+=p/this.angularSensibility,this._previousPosition=null,d||A.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,k.e.POINTERDOWN|k.e.POINTERUP|k.e.POINTERMOVE),A&&(this._contextMenuBind=d=>this.onContextMenu(d),A.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(d){d.preventDefault()}Qi(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const d=this.camera.getEngine().getInputElement();d&&d.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,w.b)([(0,N.J)()],b.prototype,"buttons",void 0),(0,w.b)([(0,N.J)()],b.prototype,"angularSensibility",void 0),X.b.FreeCameraMouseInput=b;var Q,P=A(11159);class J{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new i.b,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(d){d=a.g.BackCompatCameraNoPreventDefault(arguments),this._wheel=t=>{if(t.type!==k.e.POINTERWHEEL)return;const A=t.event,w=A.deltaMode===P.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*w*A.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*w*A.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*w*A.deltaZ/this._normalize,A.preventDefault&&(d||A.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,k.e.POINTERWHEEL)}Qi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,w.b)([(0,N.J)()],J.prototype,"wheelPrecisionX",void 0),(0,w.b)([(0,N.J)()],J.prototype,"wheelPrecisionY",void 0),(0,w.b)([(0,N.J)()],J.prototype,"wheelPrecisionZ",void 0),function(d){d[d.MoveRelative=0]="MoveRelative",d[d.RotateRelative=1]="RotateRelative",d[d.MoveScene=2]="MoveScene"}(Q||(Q={}));class U extends J{constructor(){super(...arguments),this._moveRelative=p.l.Zero(),this._rotateRelative=p.l.Zero(),this._moveScene=p.l.Zero(),this._wheelXAction=Q.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=Q.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(d){null===d&&this._wheelXAction!==Q.MoveRelative||(this._wheelXAction=Q.MoveRelative,this._wheelXActionCoordinate=d)}get wheelXMoveRelative(){return this._wheelXAction!==Q.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(d){null===d&&this._wheelYAction!==Q.MoveRelative||(this._wheelYAction=Q.MoveRelative,this._wheelYActionCoordinate=d)}get wheelYMoveRelative(){return this._wheelYAction!==Q.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(d){null===d&&this._wheelZAction!==Q.MoveRelative||(this._wheelZAction=Q.MoveRelative,this._wheelZActionCoordinate=d)}get wheelZMoveRelative(){return this._wheelZAction!==Q.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(d){null===d&&this._wheelXAction!==Q.RotateRelative||(this._wheelXAction=Q.RotateRelative,this._wheelXActionCoordinate=d)}get wheelXRotateRelative(){return this._wheelXAction!==Q.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(d){null===d&&this._wheelYAction!==Q.RotateRelative||(this._wheelYAction=Q.RotateRelative,this._wheelYActionCoordinate=d)}get wheelYRotateRelative(){return this._wheelYAction!==Q.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(d){null===d&&this._wheelZAction!==Q.RotateRelative||(this._wheelZAction=Q.RotateRelative,this._wheelZActionCoordinate=d)}get wheelZRotateRelative(){return this._wheelZAction!==Q.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(d){null===d&&this._wheelXAction!==Q.MoveScene||(this._wheelXAction=Q.MoveScene,this._wheelXActionCoordinate=d)}get wheelXMoveScene(){return this._wheelXAction!==Q.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(d){null===d&&this._wheelYAction!==Q.MoveScene||(this._wheelYAction=Q.MoveScene,this._wheelYActionCoordinate=d)}get wheelYMoveScene(){return this._wheelYAction!==Q.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(d){null===d&&this._wheelZAction!==Q.MoveScene||(this._wheelZAction=Q.MoveScene,this._wheelZActionCoordinate=d)}get wheelZMoveScene(){return this._wheelZAction!==Q.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Dj(0),this._rotateRelative.Dj(0),this._moveScene.Dj(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const d=p.c.Zero();this.camera.getViewMatrix().invertToRef(d);const t=p.l.Zero();p.l.TransformNormalToRef(this._moveRelative,d,t),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(t),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(d,t,A){if(0===d)return;if(null===t||null===A)return;let w=null;switch(t){case Q.MoveRelative:w=this._moveRelative;break;case Q.RotateRelative:w=this._rotateRelative;break;case Q.MoveScene:w=this._moveScene}switch(A){case 0:w.set(d,0,0);break;case 1:w.set(0,d,0);break;case 2:w.set(0,0,d)}}}(0,w.b)([(0,N.J)()],U.prototype,"wheelXMoveRelative",null),(0,w.b)([(0,N.J)()],U.prototype,"wheelYMoveRelative",null),(0,w.b)([(0,N.J)()],U.prototype,"wheelZMoveRelative",null),(0,w.b)([(0,N.J)()],U.prototype,"wheelXRotateRelative",null),(0,w.b)([(0,N.J)()],U.prototype,"wheelYRotateRelative",null),(0,w.b)([(0,N.J)()],U.prototype,"wheelZRotateRelative",null),(0,w.b)([(0,N.J)()],U.prototype,"wheelXMoveScene",null),(0,w.b)([(0,N.J)()],U.prototype,"wheelYMoveScene",null),(0,w.b)([(0,N.J)()],U.prototype,"wheelZMoveScene",null),X.b.FreeCameraMouseWheelInput=U;class T{constructor(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=d,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=a.g.IsSafari()}attachControl(d){d=a.g.BackCompatCameraNoPreventDefault(arguments);let t=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=A=>{const w=A.event,N="mouse"===w.pointerType||this._isSafari&&"undefined"===typeof w.pointerType;if(this.allowMouse||!N)if(A.type===k.e.POINTERDOWN){if(d||w.preventDefault(),this._pointerPressed.push(w.pointerId),1!==this._pointerPressed.length)return;t={x:w.clientX,y:w.clientY}}else if(A.type===k.e.POINTERUP){d||w.preventDefault();const A=this._pointerPressed.indexOf(w.pointerId);if(-1===A)return;if(this._pointerPressed.splice(A,1),0!=A)return;t=null,this._offsetX=null,this._offsetY=null}else if(A.type===k.e.POINTERMOVE){if(d||w.preventDefault(),!t)return;if(0!=this._pointerPressed.indexOf(w.pointerId))return;this._offsetX=w.clientX-t.x,this._offsetY=-(w.clientY-t.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,k.e.POINTERDOWN|k.e.POINTERUP|k.e.POINTERMOVE),this._onLostFocus){const d=this.camera.getEngine().getInputElement();d&&d.addEventListener("blur",this._onLostFocus)}}Qi(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const d=this.camera.getEngine().getInputElement();d&&d.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const d=this.camera,t=d._calculateHandednessMultiplier();d.cameraRotation.y=t*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)d.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const t=d._computeLocalCameraSpeed(),A=new p.l(0,0,0!==this.touchMoveSensibility?t*this._offsetY/this.touchMoveSensibility:0);p.c.RotationYawPitchRollToRef(d.rotation.y,d.rotation.x,0,d._cameraRotationMatrix),d.cameraDirection.addInPlace(p.l.TransformCoordinates(A,d._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,w.b)([(0,N.J)()],T.prototype,"touchAngularSensibility",void 0),(0,w.b)([(0,N.J)()],T.prototype,"touchMoveSensibility",void 0),X.b.FreeCameraTouchInput=T;class F extends X.e{constructor(d){super(d),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new D),this}addMouse(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new b(d),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new U,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new T),this}clear(){super.clear(),this._mouseInput=null}}var q=A(10885),H=A(10824);class f extends B.c{get angularSensibility(){const d=this.inputs.attached.mouse;return d?d.angularSensibility:0}set angularSensibility(d){const t=this.inputs.attached.mouse;t&&(t.angularSensibility=d)}get keysUp(){const d=this.inputs.attached.keyboard;return d?d.keysUp:[]}set keysUp(d){const t=this.inputs.attached.keyboard;t&&(t.keysUp=d)}get keysUpward(){const d=this.inputs.attached.keyboard;return d?d.keysUpward:[]}set keysUpward(d){const t=this.inputs.attached.keyboard;t&&(t.keysUpward=d)}get keysDown(){const d=this.inputs.attached.keyboard;return d?d.keysDown:[]}set keysDown(d){const t=this.inputs.attached.keyboard;t&&(t.keysDown=d)}get keysDownward(){const d=this.inputs.attached.keyboard;return d?d.keysDownward:[]}set keysDownward(d){const t=this.inputs.attached.keyboard;t&&(t.keysDownward=d)}get keysLeft(){const d=this.inputs.attached.keyboard;return d?d.keysLeft:[]}set keysLeft(d){const t=this.inputs.attached.keyboard;t&&(t.keysLeft=d)}get keysRight(){const d=this.inputs.attached.keyboard;return d?d.keysRight:[]}set keysRight(d){const t=this.inputs.attached.keyboard;t&&(t.keysRight=d)}get keysRotateLeft(){const d=this.inputs.attached.keyboard;return d?d.keysRotateLeft:[]}set keysRotateLeft(d){const t=this.inputs.attached.keyboard;t&&(t.keysRotateLeft=d)}get keysRotateRight(){const d=this.inputs.attached.keyboard;return d?d.keysRotateRight:[]}set keysRotateRight(d){const t=this.inputs.attached.keyboard;t&&(t.keysRotateRight=d)}get keysRotateUp(){const d=this.inputs.attached.keyboard;return d?d.keysRotateUp:[]}set keysRotateUp(d){const t=this.inputs.attached.keyboard;t&&(t.keysRotateUp=d)}get keysRotateDown(){const d=this.inputs.attached.keyboard;return d?d.keysRotateDown:[]}set keysRotateDown(d){const t=this.inputs.attached.keyboard;t&&(t.keysRotateDown=d)}constructor(d,t,A){var w;super(d,t,A,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),w=this,this.ellipsoid=new p.l(.5,1,.5),this.ellipsoidOffset=new p.l(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=p.l.Zero(),this._diffPosition=p.l.Zero(),this._newPosition=p.l.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;w._newPosition.p(t),w._newPosition.subtractToRef(w._oldPosition,w._diffPosition),w._diffPosition.length()>H.c.CollisionsEpsilon&&(w.position.addToRef(w._diffPosition,w._deferredPositionUpdate),w._deferOnly?w._deferredUpdated=!0:w.position.p(w._deferredPositionUpdate),w.Jk&&A&&w.Jk(A))},this.inputs=new F(this),this.inputs.addKeyboard().addMouse()}attachControl(d,t){t=a.g.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(t)}Qi(){this.inputs.detachElement(),this.cameraDirection=new p.l(0,0,0),this.cameraRotation=new p.j(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(d){this._collisionMask=isNaN(d)?-1:d}_collideWithWorld(d){let t;t=this.parent?p.l.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,t.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const A=this.va().collisionCoordinator;this._collider||(this._collider=A.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let w=d;this.applyGravity&&(w=d.add(this.va().gravity)),A.getNewPosition(this._oldPosition,w,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=p.l.Zero(),this._transformedDirection=p.l.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(d){this._needMoveForGravity=d}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"kb"}}(0,w.b)([(0,N.H)()],f.prototype,"ellipsoid",void 0),(0,w.b)([(0,N.H)()],f.prototype,"ellipsoidOffset",void 0),(0,w.b)([(0,N.J)()],f.prototype,"checkCollisions",void 0),(0,w.b)([(0,N.J)()],f.prototype,"applyGravity",void 0),(0,q.g)("BABYLON.FreeCamera",f)},12012:(d,t,A)=>{"use strict";A.d(t,{c:()=>a});var w=A(11041),N=A(11047),p=A(11320),B=A(11076),X=A(11079),W=A(11359);A(11326).d.AddNodeConstructor("TargetCamera",((d,t)=>()=>new a(d,B.l.Zero(),t)));class a extends p.d{constructor(d,t,A){super(d,t,A,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=B.l.Zero(),this._tmpTargetVector=B.l.Zero(),this.cameraDirection=new B.l(0,0,0),this.cameraRotation=new B.j(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new B.f,this.rotation=new B.l(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=B.l.Zero(),this._initialFocalDistance=1,this._viewMatrix=B.c.Zero(),this._camMatrix=B.c.Zero(),this._cameraTransformMatrix=B.c.Zero(),this._cameraRotationMatrix=B.c.Zero(),this._referencePoint=new B.l(0,0,1),this._transformedReferencePoint=B.l.Zero(),this._deferredPositionUpdate=new B.l,this._deferredRotationQuaternionUpdate=new B.f,this._deferredRotationUpdate=new B.l,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=B.l.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(d){this.getWorldMatrix();const t=this.getTarget().Uc(this.position);return t.normalize(),t.scaleInPlace(d),this.globalPosition.add(t)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const d=this.lockedTarget;d.Nj().getTranslationToRef(d.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.wf(0,0,0),this.cameraRotation.wf(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new B.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new B.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new B.f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(d){d||super._updateCache();const t=this._getLockedTargetPosition();t?this._cache.lockedTarget?this._cache.lockedTarget.p(t):this._cache.lockedTarget=t.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const d=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(d):!d)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const d=this.getEngine();return this.speed*Math.sqrt(d.getDeltaTime()/(100*d.getFps()))}setTarget(d){this.upVector.normalize(),this._initialFocalDistance=d.Uc(this.position).length(),this.position.z===d.z&&(this.position.z+=X.b),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),B.c.LookAtLHToRef(this.position,d,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const t=d.Uc(this.position);t.x>=0?this.rotation.y=-Math.atan(t.z/t.x)+Math.PI/2:this.rotation.y=-Math.atan(t.z/t.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&B.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(d){this.setTarget(d)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(B.h.Matrix[0]),B.l.TransformNormalToRef(this.cameraDirection,B.h.Matrix[0],B.h.gb[0]),this._deferredPositionUpdate.addInPlace(B.h.gb[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const d=this.invertRotation?-this.inverseRotationSpeed:1,t=this._decideIfNeedsToMove(),A=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),t&&this._updatePosition(),A){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*d,this._deferredRotationUpdate.y+=this.cameraRotation.y*d,!this.noRotationConstraint){const d=1.570796;this._deferredRotationUpdate.x>d&&(this._deferredRotationUpdate.x=d),this._deferredRotationUpdate.x<-d&&(this._deferredRotationUpdate.x=-d)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(B.f.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}t&&(Math.abs(this.cameraDirection.x)<this.speed*X.b&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*X.b&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*X.b&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),A&&(Math.abs(this.cameraRotation.x)<this.speed*X.b&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*X.b&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):B.c.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return B.l.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),B.l.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?W.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(B.f.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),W.e.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(d,t,A){if(this.ignoreParentScaling){if(this.parent){const w=this.parent.getWorldMatrix();B.l.TransformCoordinatesToRef(d,w,this._globalPosition),B.l.TransformCoordinatesToRef(t,w,this._tmpTargetVector),B.l.TransformNormalToRef(A,w,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(d),this._tmpTargetVector.p(t),this._tmpUpVector.p(A);this.va().useRightHandedSystem?B.c.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):B.c.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?B.c.LookAtRHToRef(d,t,A,this._viewMatrix):B.c.LookAtLHToRef(d,t,A,this._viewMatrix),this.parent){const d=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(d,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(d)}createRigCamera(d,t){if(this.cameraRigMode!==p.d.RIG_MODE_NONE){const t=new a(d,this.position.clone(),this.va());return t.isRigCamera=!0,t.rigParent=this,this.cameraRigMode===p.d.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new B.f),t._cameraRigParams={},t.rotationQuaternion=new B.f),t.mode=this.mode,t.orthoLeft=this.orthoLeft,t.orthoRight=this.orthoRight,t.orthoTop=this.orthoTop,t.orthoBottom=this.orthoBottom,t}return null}_updateRigCameras(){const d=this._rigCameras[0],t=this._rigCameras[1];switch(this.Nj(),this.cameraRigMode){case p.d.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case p.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case p.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case p.d.RIG_MODE_STEREOSCOPIC_OVERUNDER:case p.d.RIG_MODE_STEREOSCOPIC_INTERLACED:{const A=this.cameraRigMode===p.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,w=this.cameraRigMode===p.d.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*A,d),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*w,t);break}case p.d.RIG_MODE_VR:d.rotationQuaternion?(d.rotationQuaternion.p(this.rotationQuaternion),t.rotationQuaternion.p(this.rotationQuaternion)):(d.rotation.p(this.rotation),t.rotation.p(this.rotation)),d.position.p(this.position),t.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(d,t){this.getTarget().subtractToRef(this.position,a._TargetFocalPoint),a._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const A=a._TargetFocalPoint.addInPlace(this.position);B.c.TranslationToRef(-A.x,-A.y,-A.z,a._TargetTransformMatrix),a._TargetTransformMatrix.multiplyToRef(B.c.RotationAxis(t.upVector,d),a._RigCamTransformMatrix),B.c.TranslationToRef(A.x,A.y,A.z,a._TargetTransformMatrix),a._RigCamTransformMatrix.multiplyToRef(a._TargetTransformMatrix,a._RigCamTransformMatrix),B.l.TransformCoordinatesToRef(this.position,a._RigCamTransformMatrix,t.position),t.setTarget(A)}getClassName(){return"TargetCamera"}}a._RigCamTransformMatrix=new B.c,a._TargetTransformMatrix=new B.c,a._TargetFocalPoint=new B.l,(0,w.b)([(0,N.H)()],a.prototype,"rotation",void 0),(0,w.b)([(0,N.J)()],a.prototype,"speed",void 0),(0,w.b)([(0,N.x)("lockedTargetId")],a.prototype,"lockedTarget",void 0)},11214:(d,t,A)=>{"use strict";A.d(t,{e:()=>w});class w{constructor(d,t,A){this.bu=d,this.bv=t,this.distance=A,this.faceId=0,this.subMeshId=0}}},11115:(d,t,A)=>{"use strict";A.d(t,{c:()=>p});var w=A(11076),N=A(11120);class p{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var d;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||A&&!this.pickedMesh.isVerticesDataPresent(N.f.NormalKind))return null;let p,B=this.pickedMesh.xf();0===(null===(d=B)||void 0===d?void 0:d.length)&&(B=null);const X=w.h.gb[0],W=w.h.gb[1],a=w.h.gb[2];if(A){const d=this.pickedMesh.getVerticesData(N.f.NormalKind);let t=B?w.l.FromArrayToRef(d,3*B[3*this.faceId],X):X.wf(d[3*this.faceId*3],d[3*this.faceId*3+1],d[3*this.faceId*3+2]),A=B?w.l.FromArrayToRef(d,3*B[3*this.faceId+1],W):W.wf(d[3*(3*this.faceId+1)],d[3*(3*this.faceId+1)+1],d[3*(3*this.faceId+1)+2]),D=B?w.l.FromArrayToRef(d,3*B[3*this.faceId+2],a):a.wf(d[3*(3*this.faceId+2)],d[3*(3*this.faceId+2)+1],d[3*(3*this.faceId+2)+2]);t=t.scale(this.bu),A=A.scale(this.bv),D=D.scale(1-this.bu-this.bv),p=new w.l(t.x+A.x+D.x,t.y+A.y+D.y,t.z+A.z+D.z)}else{const d=this.pickedMesh.getVerticesData(N.f.PositionKind),t=B?w.l.FromArrayToRef(d,3*B[3*this.faceId],X):X.wf(d[3*this.faceId*3],d[3*this.faceId*3+1],d[3*this.faceId*3+2]),A=B?w.l.FromArrayToRef(d,3*B[3*this.faceId+1],W):W.wf(d[3*(3*this.faceId+1)],d[3*(3*this.faceId+1)+1],d[3*(3*this.faceId+1)+2]),D=B?w.l.FromArrayToRef(d,3*B[3*this.faceId+2],a):a.wf(d[3*(3*this.faceId+2)],d[3*(3*this.faceId+2)+1],d[3*(3*this.faceId+2)+2]),i=t.Uc(A),k=D.Uc(A);p=w.l.Cross(i,k)}const D=(d,t)=>{let A=d.getWorldMatrix();d.nonUniformScaling&&(w.h.Matrix[0].p(A),A=w.h.Matrix[0],A.setTranslationFromFloats(0,0,0),A.invert(),A.transposeToRef(w.h.Matrix[1]),A=w.h.Matrix[1]),w.l.TransformNormalToRef(t,A,t)};if(t&&D(this.pickedMesh,p),this.ray){const d=w.h.gb[0].p(p);t||D(this.pickedMesh,d),w.l.Dot(d,this.ray.direction)>0&&p.negateInPlace()}return p.normalize(),p}getTextureCoordinates(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N.f.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(d))return null;const t=this.pickedMesh.xf();if(!t)return null;const A=this.pickedMesh.getVerticesData(d);if(!A)return null;let p=w.j.Lg(A,2*t[3*this.faceId]),B=w.j.Lg(A,2*t[3*this.faceId+1]),X=w.j.Lg(A,2*t[3*this.faceId+2]);return p=p.scale(this.bu),B=B.scale(this.bv),X=X.scale(1-this.bu-this.bv),new w.j(p.x+B.x+X.x,p.y+B.y+X.y)}}},11271:(d,t,A)=>{"use strict";A.d(t,{e:()=>w});let w=!1},12525:(d,t,A)=>{"use strict";A.d(t,{e:()=>p});var w=A(11054),N=A(12531);class p{constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=A,this.ji=[],this._maxBlockCapacity=t||64,this._selectionContent=new w.b(1024),this._creationFunc=d}update(d,t,A){N.c._CreateBlocks(d,t,A,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}ii(d){for(let t=0;t<this.qh.length;t++){this.qh[t].addEntry(d)}}Ug(d){for(let t=0;t<this.qh.length;t++){this.qh[t].removeEntry(d)}}select(d,t){this._selectionContent.reset();for(let A=0;A<this.qh.length;A++){this.qh[A].select(d,this._selectionContent,t)}return t?this._selectionContent.concat(this.ji):this._selectionContent.concatWithNoDuplicate(this.ji),this._selectionContent}intersects(d,t,A){this._selectionContent.reset();for(let w=0;w<this.qh.length;w++){this.qh[w].intersects(d,t,this._selectionContent,A)}return A?this._selectionContent.concat(this.ji):this._selectionContent.concatWithNoDuplicate(this.ji),this._selectionContent}intersectsRay(d){this._selectionContent.reset();for(let t=0;t<this.qh.length;t++){this.qh[t].intersectsRay(d,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.ji),this._selectionContent}}p.CreationFuncForMeshes=(d,t)=>{const A=d.getBoundingInfo();!d.isBlocked&&A.boundingBox.intersectsMinMax(t.oi,t.pi)&&t.entries.push(d)},p.CreationFuncForSubMeshes=(d,t)=>{d.getBoundingInfo().boundingBox.intersectsMinMax(t.oi,t.pi)&&t.entries.push(d)}},12531:(d,t,A)=>{"use strict";A.d(t,{c:()=>p});var w=A(11076),N=A(11223);class p{constructor(d,t,A,w,N,p){this.entries=[],this.qi=new Array,this._capacity=A,this._depth=w,this._maxDepth=N,this._creationFunc=p,this._minPoint=d,this._maxPoint=t,this.qi.push(d.clone()),this.qi.push(t.clone()),this.qi.push(d.clone()),this.qi[2].x=t.x,this.qi.push(d.clone()),this.qi[3].y=t.y,this.qi.push(d.clone()),this.qi[4].z=t.z,this.qi.push(t.clone()),this.qi[5].z=d.z,this.qi.push(t.clone()),this.qi[6].x=d.x,this.qi.push(t.clone()),this.qi[7].y=d.y}get Yc(){return this._capacity}get oi(){return this._minPoint}get pi(){return this._maxPoint}addEntry(d){if(this.qh)for(let t=0;t<this.qh.length;t++){this.qh[t].addEntry(d)}else this._creationFunc(d,this),this.entries.length>this.Yc&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(d){if(this.qh){for(let t=0;t<this.qh.length;t++){this.qh[t].removeEntry(d)}return}const t=this.entries.indexOf(d);t>-1&&this.entries.splice(t,1)}addEntries(d){for(let t=0;t<d.length;t++){const A=d[t];this.addEntry(A)}}select(d,t,A){if(N.c.IsInFrustum(this.qi,d)){if(this.qh){for(let w=0;w<this.qh.length;w++){this.qh[w].select(d,t,A)}return}A?t.concat(this.entries):t.concatWithNoDuplicate(this.entries)}}intersects(d,t,A,w){if(N.c.IntersectsSphere(this._minPoint,this._maxPoint,d,t)){if(this.qh){for(let N=0;N<this.qh.length;N++){this.qh[N].intersects(d,t,A,w)}return}w?A.concat(this.entries):A.concatWithNoDuplicate(this.entries)}}intersectsRay(d,t){if(d.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.qh){for(let A=0;A<this.qh.length;A++){this.qh[A].intersectsRay(d,t)}return}t.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){p._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(d,t,A,N,B,X,W,a){W.qh=new Array;const D=new w.l((t.x-d.x)/2,(t.y-d.y)/2,(t.z-d.z)/2);for(let w=0;w<2;w++)for(let t=0;t<2;t++)for(let i=0;i<2;i++){const k=d.add(D.multiplyByFloats(w,t,i)),b=d.add(D.multiplyByFloats(w+1,t+1,i+1)),Q=new p(k,b,N,B+1,X,a);Q.addEntries(A),W.qh.push(Q)}}}},12540:(d,t,A)=>{"use strict";A.d(t,{b:()=>D});var w=A(11061),N=A(11076),p=A(11350),B=A(11723),X=A(11146),W=A(12525),a=A(10775);w.e.prototype.createOrUpdateSelectionOctree=function(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,A=this._getComponent(X.e.NAME_OCTREE);A||(A=new D(this),this.o(A)),this.gi||(this.gi=new W.e(W.e.CreationFuncForMeshes,d,t));const w=this.getWorldExtends();return this.gi.update(w.min,w.max,this.meshes),this.gi},Object.defineProperty(w.e.prototype,"selectionOctree",{get:function(){return this.gi},enumerable:!0,configurable:!0}),p.d.prototype.createOrUpdateSubmeshesOctree=function(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const A=this.va();let w=A._getComponent(X.e.NAME_OCTREE);w||(w=new D(A),A.o(w)),this._submeshesOctree||(this._submeshesOctree=new W.e(W.e.CreationFuncForSubMeshes,d,t)),this.Nj(!0);const N=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(N.minimumWorld,N.maximumWorld,this.If),this._submeshesOctree};class D{constructor(d){this.name=X.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new B.d(N.l.Zero(),new N.l(1,1,1)),(d=d||a.e.LastCreatedScene)&&(this.Hf=d,this.Hf.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Hf.getActiveSubMeshCandidates=d=>this.getActiveSubMeshCandidates(d),this.Hf.getCollidingSubMeshCandidates=(d,t)=>this.getCollidingSubMeshCandidates(d,t),this.Hf.getIntersectingSubMeshCandidates=(d,t)=>this.getIntersectingSubMeshCandidates(d,t))}register(){this.Hf.onMeshRemovedObservable.add((d=>{const t=this.Hf.selectionOctree;if(void 0!==t&&null!==t){const A=t.ji.indexOf(d);-1!==A&&t.ji.splice(A,1)}})),this.Hf.onMeshImportedObservable.add((d=>{const t=this.Hf.selectionOctree;void 0!==t&&null!==t&&t.ii(d)}))}getActiveMeshCandidates(){var d;return(null===(d=this.Hf.gi)||void 0===d?void 0:d.select(this.Hf.frustumPlanes))||this.Hf._getDefaultMeshCandidates()}getActiveSubMeshCandidates(d){if(d._submeshesOctree&&d.useOctreeForRenderingSelection){return d._submeshesOctree.select(this.Hf.frustumPlanes)}return this.Hf._getDefaultSubMeshCandidates(d)}getIntersectingSubMeshCandidates(d,t){if(d._submeshesOctree&&d.useOctreeForPicking){B.d.TransformToRef(t,d.getWorldMatrix(),this._tempRay);return d._submeshesOctree.intersectsRay(this._tempRay)}return this.Hf._getDefaultSubMeshCandidates(d)}getCollidingSubMeshCandidates(d,t){if(d._submeshesOctree&&d.useOctreeForCollisions){const A=t._velocityWorldLength+Math.max(t._radius.x,t._radius.y,t._radius.z);return d._submeshesOctree.intersects(t._basePointWorld,A)}return this.Hf._getDefaultSubMeshCandidates(d)}rebuild(){}dispose(){}}},11223:(d,t,A)=>{"use strict";A.d(t,{c:()=>B});var w=A(11081),N=A(11076),p=A(11079);class B{constructor(d,t,A){this.vectors=(0,w.b)(8,N.l.Zero),this.center=N.l.Zero(),this.centerWorld=N.l.Zero(),this.extendSize=N.l.Zero(),this.extendSizeWorld=N.l.Zero(),this.directions=(0,w.b)(3,N.l.Zero),this.vectorsWorld=(0,w.b)(8,N.l.Zero),this.minimumWorld=N.l.Zero(),this.maximumWorld=N.l.Zero(),this.minimum=N.l.Zero(),this.maximum=N.l.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(d,t,A)}reConstruct(d,t,A){const w=d.x,p=d.y,B=d.z,X=t.x,W=t.y,a=t.z,D=this.vectors;this.minimum.wf(w,p,B),this.maximum.wf(X,W,a),D[0].wf(w,p,B),D[1].wf(X,W,a),D[2].wf(X,p,B),D[3].wf(w,W,B),D[4].wf(w,p,a),D[5].wf(X,W,B),D[6].wf(w,W,a),D[7].wf(X,p,a),t.addToRef(d,this.center).scaleInPlace(.5),t.subtractToRef(d,this.extendSize).scaleInPlace(.5),this._worldMatrix=A||N.c.IdentityReadOnly,this._update(this._worldMatrix)}scale(d){const t=B._TmpVector3,A=this.maximum.subtractToRef(this.minimum,t[0]),w=A.length();A.normalizeFromLength(w);const N=w*d,p=A.scaleInPlace(.5*N),X=this.center.subtractToRef(p,t[1]),W=this.center.addToRef(p,t[2]);return this.reConstruct(X,W,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(d){const t=this.minimumWorld,A=this.maximumWorld,w=this.directions,p=this.vectorsWorld,B=this.vectors;if(d.isIdentity()){t.p(this.minimum),A.p(this.maximum);for(let d=0;d<8;++d)p[d].p(B[d]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{t.Dj(Number.MAX_VALUE),A.Dj(-Number.MAX_VALUE);for(let w=0;w<8;++w){const X=p[w];N.l.TransformCoordinatesToRef(B[w],d,X),t.minimizeInPlace(X),A.maximizeInPlace(X)}A.subtractToRef(t,this.extendSizeWorld).scaleInPlace(.5),A.addToRef(t,this.centerWorld).scaleInPlace(.5)}N.l.FromArrayToRef(d.m,0,w[0]),N.l.FromArrayToRef(d.m,4,w[1]),N.l.FromArrayToRef(d.m,8,w[2]),this._worldMatrix=d}isInFrustum(d){return B.IsInFrustum(this.vectorsWorld,d)}isCompletelyInFrustum(d){return B.IsCompletelyInFrustum(this.vectorsWorld,d)}intersectsPoint(d){const t=this.minimumWorld,A=this.maximumWorld,w=t.x,N=t.y,B=t.z,X=A.x,W=A.y,a=A.z,D=d.x,i=d.y,k=d.z,b=-p.b;return!(X-D<b||b>D-w)&&(!(W-i<b||b>i-N)&&!(a-k<b||b>k-B))}intersectsSphere(d){return B.IntersectsSphere(this.minimumWorld,this.maximumWorld,d.centerWorld,d.radiusWorld)}intersectsMinMax(d,t){const A=this.minimumWorld,w=this.maximumWorld,N=A.x,p=A.y,B=A.z,X=w.x,W=w.y,a=w.z,D=d.x,i=d.y,k=d.z,b=t.x,Q=t.y,P=t.z;return!(X<D||N>b)&&(!(W<i||p>Q)&&!(a<k||B>P))}dispose(){var d,t;null===(d=this._drawWrapperFront)||void 0===d||d.dispose(),null===(t=this._drawWrapperBack)||void 0===t||t.dispose()}static Intersects(d,t){return d.intersectsMinMax(t.minimumWorld,t.maximumWorld)}static IntersectsSphere(d,t,A,w){const p=B._TmpVector3[0];N.l.ClampToRef(A,d,t,p);return N.l.DistanceSquared(A,p)<=w*w}static IsCompletelyInFrustum(d,t){for(let A=0;A<6;++A){const w=t[A];for(let t=0;t<8;++t)if(w.dotCoordinate(d[t])<0)return!1}return!0}static IsInFrustum(d,t){for(let A=0;A<6;++A){let w=!0;const N=t[A];for(let t=0;t<8;++t)if(N.dotCoordinate(d[t])>=0){w=!1;break}if(w)return!1}return!0}}B._TmpVector3=(0,w.b)(3,N.l.Zero)},11221:(d,t,A)=>{"use strict";A.d(t,{b:()=>i});var w=A(11081),N=A(11076),p=A(11223),B=A(11230);const X={min:0,max:0},W={min:0,max:0},a=(d,t,A)=>{const w=N.l.Dot(t.centerWorld,d),p=Math.abs(N.l.Dot(t.directions[0],d))*t.extendSize.x+Math.abs(N.l.Dot(t.directions[1],d))*t.extendSize.y+Math.abs(N.l.Dot(t.directions[2],d))*t.extendSize.z;A.min=w-p,A.max=w+p},D=(d,t,A)=>(a(d,t,X),a(d,A,W),!(X.min>W.max||W.min>X.max));class i{constructor(d,t,A){this._isLocked=!1,this.boundingBox=new p.c(d,t,A),this.boundingSphere=new B.c(d,t,A)}reConstruct(d,t,A){this.boundingBox.reConstruct(d,t,A),this.boundingSphere.reConstruct(d,t,A)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(d){this._isLocked=d}update(d){this._isLocked||(this.boundingBox._update(d),this.boundingSphere._update(d))}centerOn(d,t){const A=i._TmpVector3[0].p(d).ni(t),w=i._TmpVector3[1].p(d).addInPlace(t);return this.boundingBox.reConstruct(A,w,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(A,w,this.boundingBox.getWorldMatrix()),this}encapsulate(d){const t=N.l.Minimize(this.minimum,d),A=N.l.Maximize(this.maximum,d);return this.reConstruct(t,A,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(d){const t=N.h.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(t);const A=N.h.gb[0];return N.l.TransformCoordinatesToRef(d.boundingBox.minimumWorld,t,A),this.encapsulate(A),N.l.TransformCoordinatesToRef(d.boundingBox.maximumWorld,t,A),this.encapsulate(A),this}scale(d){return this.boundingBox.scale(d),this.boundingSphere.scale(d),this}isInFrustum(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===t||3===t)&&this.boundingSphere.isCenterInFrustum(d))return!0;if(!this.boundingSphere.isInFrustum(d))return!1;return!(1!==t&&3!==t)||this.boundingBox.isInFrustum(d)}get diagonalLength(){const d=this.boundingBox;return d.maximumWorld.subtractToRef(d.minimumWorld,i._TmpVector3[0]).length()}isCompletelyInFrustum(d){return this.boundingBox.isCompletelyInFrustum(d)}_checkCollision(d){return d._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(d){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(d)&&!!this.boundingBox.intersectsPoint(d))}intersects(d,t){if(!B.c.Intersects(this.boundingSphere,d.boundingSphere))return!1;if(!p.c.Intersects(this.boundingBox,d.boundingBox))return!1;if(!t)return!0;const A=this.boundingBox,w=d.boundingBox;return!!D(A.directions[0],A,w)&&(!!D(A.directions[1],A,w)&&(!!D(A.directions[2],A,w)&&(!!D(w.directions[0],A,w)&&(!!D(w.directions[1],A,w)&&(!!D(w.directions[2],A,w)&&(!!D(N.l.Cross(A.directions[0],w.directions[0]),A,w)&&(!!D(N.l.Cross(A.directions[0],w.directions[1]),A,w)&&(!!D(N.l.Cross(A.directions[0],w.directions[2]),A,w)&&(!!D(N.l.Cross(A.directions[1],w.directions[0]),A,w)&&(!!D(N.l.Cross(A.directions[1],w.directions[1]),A,w)&&(!!D(N.l.Cross(A.directions[1],w.directions[2]),A,w)&&(!!D(N.l.Cross(A.directions[2],w.directions[0]),A,w)&&(!!D(N.l.Cross(A.directions[2],w.directions[1]),A,w)&&!!D(N.l.Cross(A.directions[2],w.directions[2]),A,w))))))))))))))}}i._TmpVector3=(0,w.b)(2,N.l.Zero)},11230:(d,t,A)=>{"use strict";A.d(t,{c:()=>p});var w=A(11081),N=A(11076);class p{constructor(d,t,A){this.center=N.l.Zero(),this.centerWorld=N.l.Zero(),this.minimum=N.l.Zero(),this.maximum=N.l.Zero(),this.reConstruct(d,t,A)}reConstruct(d,t,A){this.minimum.p(d),this.maximum.p(t);const w=N.l.Distance(d,t);t.addToRef(d,this.center).scaleInPlace(.5),this.i=.5*w,this._update(A||N.c.IdentityReadOnly)}scale(d){const t=this.i*d,A=p._TmpVector3,w=A[0].Dj(t),N=this.center.subtractToRef(w,A[1]),B=this.center.addToRef(w,A[2]);return this.reConstruct(N,B,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(d){if(d.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.i;else{N.l.TransformCoordinatesToRef(this.center,d,this.centerWorld);const t=p._TmpVector3[0];N.l.TransformNormalFromFloatsToRef(1,1,1,d,t),this.radiusWorld=Math.max(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z))*this.i}}isInFrustum(d){const t=this.centerWorld,A=this.radiusWorld;for(let w=0;w<6;w++)if(d[w].dotCoordinate(t)<=-A)return!1;return!0}isCenterInFrustum(d){const t=this.centerWorld;for(let A=0;A<6;A++)if(d[A].dotCoordinate(t)<0)return!1;return!0}intersectsPoint(d){const t=N.l.DistanceSquared(this.centerWorld,d);return!(this.radiusWorld*this.radiusWorld<t)}static Intersects(d,t){const A=N.l.DistanceSquared(d.centerWorld,t.centerWorld),w=d.radiusWorld+t.radiusWorld;return!(w*w<A)}static CreateFromCenterAndRadius(d,t,A){this._TmpVector3[0].p(d),this._TmpVector3[1].wf(0,0,t),this._TmpVector3[2].p(d),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].ni(this._TmpVector3[1]);const w=new p(this._TmpVector3[0],this._TmpVector3[2]);return w._worldMatrix=A||N.c.Identity(),w}}p._TmpVector3=(0,w.b)(3,N.l.Zero)},11723:(d,t,A)=>{"use strict";A.d(t,{d:()=>b});var w=A(11061),N=A(11320),p=A(11079),B=A(11076),X=A(11081),W=A(11214),a=A(11115),D=A(10775),i=A(11165);const k={internalPickerForMesh:void 0};class b{constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:p.b;this.origin=d,this.direction=t,this.length=A,this.epsilon=w}clone(){return new b(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const w=b._TmpVector3[0].wf(d.x-A,d.y-A,d.z-A),N=b._TmpVector3[1].wf(t.x+A,t.y+A,t.z+A);let p,B,X,W,a=0,D=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<w.x||this.origin.x>N.x)return!1}else if(p=1/this.direction.x,B=(w.x-this.origin.x)*p,X=(N.x-this.origin.x)*p,X===-1/0&&(X=1/0),B>X&&(W=B,B=X,X=W),a=Math.max(B,a),D=Math.min(X,D),a>D)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<w.y||this.origin.y>N.y)return!1}else if(p=1/this.direction.y,B=(w.y-this.origin.y)*p,X=(N.y-this.origin.y)*p,X===-1/0&&(X=1/0),B>X&&(W=B,B=X,X=W),a=Math.max(B,a),D=Math.min(X,D),a>D)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<w.z||this.origin.z>N.z)return!1}else if(p=1/this.direction.z,B=(w.z-this.origin.z)*p,X=(N.z-this.origin.z)*p,X===-1/0&&(X=1/0),B>X&&(W=B,B=X,X=W),a=Math.max(B,a),D=Math.min(X,D),a>D)return!1;return!0}intersectsBox(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(d.minimum,d.maximum,t)}intersectsSphere(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=d.center.x-this.origin.x,w=d.center.y-this.origin.y,N=d.center.z-this.origin.z,p=A*A+w*w+N*N,B=d.i+t,X=B*B;if(p<=X)return!0;const W=A*this.direction.x+w*this.direction.y+N*this.direction.z;if(W<0)return!1;return p-W*W<=X}intersectsTriangle(d,t,A){const w=b._TmpVector3[0],N=b._TmpVector3[1],p=b._TmpVector3[2],X=b._TmpVector3[3],a=b._TmpVector3[4];t.subtractToRef(d,w),A.subtractToRef(d,N),B.l.CrossToRef(this.direction,N,p);const D=B.l.Dot(w,p);if(0===D)return null;const i=1/D;this.origin.subtractToRef(d,X);const k=B.l.Dot(X,p)*i;if(k<-this.epsilon||k>1+this.epsilon)return null;B.l.CrossToRef(X,w,a);const Q=B.l.Dot(this.direction,a)*i;if(Q<-this.epsilon||k+Q>1+this.epsilon)return null;const P=B.l.Dot(N,a)*i;return P>this.length?null:new W.e(1-k-Q,k,P)}intersectsPlane(d){let t;const A=B.l.Dot(d.ab,this.direction);if(Math.abs(A)<9.99999997475243e-7)return null;{const w=B.l.Dot(d.ab,this.origin);return t=(-d.d-w)/A,t<0?t<-9.99999997475243e-7?null:0:t}}intersectsAxis(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(d){case"y":{const d=(this.origin.y-t)/this.direction.y;return d>0?null:new B.l(this.origin.x+this.direction.x*-d,t,this.origin.z+this.direction.z*-d)}case"x":{const d=(this.origin.x-t)/this.direction.x;return d>0?null:new B.l(t,this.origin.y+this.direction.y*-d,this.origin.z+this.direction.z*-d)}case"z":{const d=(this.origin.z-t)/this.direction.z;return d>0?null:new B.l(this.origin.x+this.direction.x*-d,this.origin.y+this.direction.y*-d,t)}default:return null}}intersectsMesh(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=B.h.Matrix[0];return d.getWorldMatrix().invertToRef(X),this._tmpRay?b.TransformToRef(this,X,this._tmpRay):this._tmpRay=b.Transform(this,X),d.intersects(this._tmpRay,t,A,w,N,p)}intersectsMeshes(d,t,A){A?A.length=0:A=[];for(let w=0;w<d.length;w++){const N=this.intersectsMesh(d[w],t);N.hit&&A.push(N)}return A.sort(this._comparePickingInfo),A}_comparePickingInfo(d,t){return d.distance<t.distance?-1:d.distance>t.distance?1:0}intersectionSegment(d,t,A){const w=this.origin,N=B.h.gb[0],p=B.h.gb[1],X=B.h.gb[2],W=B.h.gb[3];t.subtractToRef(d,N),this.direction.scaleToRef(b._Rayl,X),w.addToRef(X,p),d.subtractToRef(w,W);const a=B.l.Dot(N,N),D=B.l.Dot(N,X),i=B.l.Dot(X,X),k=B.l.Dot(N,W),Q=B.l.Dot(X,W),P=a*i-D*D;let J,U,T=P,F=P;P<b._Smallnum?(J=0,T=1,U=Q,F=i):(J=D*Q-i*k,U=a*Q-D*k,J<0?(J=0,U=Q,F=i):J>T&&(J=T,U=Q+D,F=i)),U<0?(U=0,-k<0?J=0:-k>a?J=T:(J=-k,T=a)):U>F&&(U=F,-k+D<0?J=0:-k+D>a?J=T:(J=-k+D,T=a));const q=Math.abs(J)<b._Smallnum?0:J/T,H=Math.abs(U)<b._Smallnum?0:U/F,f=B.h.gb[4];X.scaleToRef(H,f);const v=B.h.gb[5];N.scaleToRef(q,v),v.addInPlace(W);const m=B.h.gb[6];v.subtractToRef(f,m);return H>0&&H<=this.length&&m.lengthSquared()<A*A?v.length():-1}update(d,t,A,w,N,p,X){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){b._RayDistant||(b._RayDistant=b.Zero()),b._RayDistant.unprojectRayToRef(d,t,A,w,B.c.IdentityReadOnly,p,X);const W=B.h.Matrix[0];N.invertToRef(W),b.TransformToRef(b._RayDistant,W,this)}else this.unprojectRayToRef(d,t,A,w,N,p,X);return this}static Zero(){return new b(B.l.Zero(),B.l.Zero())}static CreateNew(d,t,A,w,N,p,B){return b.Zero().update(d,t,A,w,N,p,B)}static CreateNewFromTo(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.c.IdentityReadOnly;const w=new b(new B.l(0,0,0),new B.l(0,0,0));return b.CreateFromToToRef(d,t,w,A)}static CreateFromToToRef(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:B.c.IdentityReadOnly;A.origin.p(d);const N=t.subtractToRef(d,A.direction),p=Math.sqrt(N.x*N.x+N.y*N.y+N.z*N.z);return A.length=p,A.direction.normalize(),b.TransformToRef(A,w,A)}static Transform(d,t){const A=new b(new B.l(0,0,0),new B.l(0,0,0));return b.TransformToRef(d,t,A),A}static TransformToRef(d,t,A){B.l.TransformCoordinatesToRef(d.origin,t,A.origin),B.l.TransformNormalToRef(d.direction,t,A.direction),A.length=d.length,A.epsilon=d.epsilon;const w=A.direction,N=w.length();if(0!==N&&1!==N){const d=1/N;w.x*=d,w.y*=d,w.z*=d,A.length*=N}return A}unprojectRayToRef(d,t,A,w,N,p,X){const W=B.h.Matrix[0];N.multiplyToRef(p,W),W.multiplyToRef(X,W),W.invert();const a=D.e.LastCreatedEngine,i=B.h.gb[0];i.x=d/A*2-1,i.y=-(t/w*2-1),i.z=null!==a&&void 0!==a&&a.useReverseDepthBuffer?1:null!==a&&void 0!==a&&a.isNDCHalfZRange?0:-1;const k=B.h.gb[1].wf(i.x,i.y,1-1e-8),b=B.h.gb[2],Q=B.h.gb[3];B.l._UnprojectFromInvertedMatrixToRef(i,W,b),B.l._UnprojectFromInvertedMatrixToRef(k,W,Q),this.origin.p(b),Q.subtractToRef(b,this.direction),this.direction.normalize()}}function Q(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=b.Zero();return P(d,t,A,w,B,N,p),B}function P(d,t,A,w,N,p){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const a=d.getEngine();if(!p&&!(p=d.activeCamera))return d;const D=p.viewport,i=a.getRenderHeight(),{x:k,y:b,width:Q,height:P}=D.toGlobal(a.getRenderWidth(),i),J=1/a.getHardwareScalingLevel();return t=t*J-k,A=A*J-(i-b-P),N.update(t,A,Q,P,w||B.c.IdentityReadOnly,X?B.c.IdentityReadOnly:p.getViewMatrix(),p.getProjectionMatrix(),W),d}function J(d,t,A,w,N){if(!a.c)return d;const p=d.getEngine();if(!N&&!(N=d.activeCamera))throw new Error("Active camera not set");const X=N.viewport,W=p.getRenderHeight(),{x:D,y:i,width:k,height:b}=X.toGlobal(p.getRenderWidth(),W),Q=B.c.Identity(),P=1/p.getHardwareScalingLevel();return t=t*P-D,A=A*P-(W-i-b),w.update(t,A,k,b,Q,Q,N.getProjectionMatrix()),d}function U(d,t,A,w,N,p,B,X){const W=t(w,A.enableDistantPicking),a=A.intersects(W,N,B,p,w,X);return a&&a.hit?!N&&null!=d&&a.distance>=d.distance?null:a:null}function T(d,t,A,w,N,p){let X=null;const W=!!(d.activeCameras&&d.activeCameras.length>1&&d.cameraToUseForPointers!==d.activeCamera),D=d.cameraToUseForPointers||d.activeCamera,i=k.internalPickerForMesh||U;for(let a=0;a<d.meshes.length;a++){const k=d.meshes[a];if(A){if(!A(k,-1))continue}else if(!k.isEnabled()||!k.isVisible||!k.Be)continue;const b=W&&k.isWorldMatrixCameraDependent(),Q=k.Nj(b,D);if(k.hasThinInstances&&k.thinInstanceEnablePicking){const d=i(X,t,k,Q,!0,!0,p);if(d){if(N)return d;const W=B.h.Matrix[1],a=k.thinInstanceGetWorldMatrices();for(let d=0;d<a.length;d++){if(A&&!A(k,d))continue;a[d].multiplyToRef(Q,W);const B=i(X,t,k,W,w,N,p,!0);if(B&&(X=B,X.thinInstanceIndex=d,w))return X}}}else{const d=i(X,t,k,Q,w,N,p);if(d&&(X=d,w))return X}}return X||new a.c}function F(d,t,A,w){if(!a.c)return null;const N=[],p=!!(d.activeCameras&&d.activeCameras.length>1&&d.cameraToUseForPointers!==d.activeCamera),X=d.cameraToUseForPointers||d.activeCamera,W=k.internalPickerForMesh||U;for(let a=0;a<d.meshes.length;a++){const D=d.meshes[a];if(A){if(!A(D,-1))continue}else if(!D.isEnabled()||!D.isVisible||!D.Be)continue;const i=p&&D.isWorldMatrixCameraDependent(),k=D.Nj(i,X);if(D.hasThinInstances&&D.thinInstanceEnablePicking){if(W(null,t,D,k,!0,!0,w)){const d=B.h.Matrix[1],p=D.thinInstanceGetWorldMatrices();for(let B=0;B<p.length;B++){if(A&&!A(D,B))continue;p[B].multiplyToRef(k,d);const X=W(null,t,D,d,!1,!1,w,!0);X&&(X.thinInstanceIndex=B,N.push(X))}}}else{const d=W(null,t,D,k,!1,!1,w);d&&N.push(d)}}return N}function q(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;w||(w=d.getWorldMatrix()),t.length=A,N?t.origin.p(N):t.origin.p(d.position);const p=B.h.gb[2];p.set(0,0,d._scene.useRightHandedSystem?-1:1);const X=B.h.gb[3];return B.l.TransformNormalToRef(p,w,X),B.l.NormalizeToRef(X,t.direction),t}var H,f;b._TmpVector3=(0,X.b)(6,B.l.Zero),b._RayDistant=b.Zero(),b._Smallnum=1e-8,b._Rayl=1e9,H=w.e,(f=N.d)&&(f.prototype.getForwardRay=function(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;return q(this,new b(B.l.Zero(),B.l.Zero(),d),d,t,A)},f.prototype.getForwardRayToRef=function(d){return q(this,d,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),H&&(i.d._IsPickingAvailable=!0,H.prototype.createPickingRay=function(d,t,A,w){return Q(this,d,t,A,w,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),w.e.prototype.createPickingRayToRef=function(d,t,A,w,N){return P(this,d,t,A,w,N,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},w.e.prototype.createPickingRayInCameraSpace=function(d,t,A){return function(d,t,A,w){const N=b.Zero();return J(d,t,A,N,w),N}(this,d,t,A)},w.e.prototype.createPickingRayInCameraSpaceToRef=function(d,t,A,w){return J(this,d,t,A,w)},w.e.prototype.pickWithBoundingInfo=function(d,t,A,w,N){return function(d,t,A,w,N,p){if(!a.c)return null;const X=T(d,(w=>(d._tempPickingRay||(d._tempPickingRay=b.Zero()),P(d,t,A,w,d._tempPickingRay,p||null),d._tempPickingRay)),w,N,!0);return X&&(X.ray=Q(d,t,A,B.c.Identity(),p||null)),X}(this,d,t,A,w,N)},w.e.prototype.Rc=function(d,t,A,w,N,p){return function(d,t,A,w,N,p,X){const W=T(d,((w,N)=>(d._tempPickingRay||(d._tempPickingRay=b.Zero()),P(d,t,A,w,d._tempPickingRay,p||null,!1,N),d._tempPickingRay)),w,N,!1,X);return W&&(W.ray=Q(d,t,A,B.c.Identity(),p||null)),W}(this,d,t,A,w,N,p)},w.e.prototype.pickWithRay=function(d,t,A,w){return function(d,t,A,w,N){const p=T(d,(A=>(d._pickWithRayInverseMatrix||(d._pickWithRayInverseMatrix=B.c.Identity()),A.invertToRef(d._pickWithRayInverseMatrix),d._cachedRayForTransform||(d._cachedRayForTransform=b.Zero()),b.TransformToRef(t,d._pickWithRayInverseMatrix,d._cachedRayForTransform),d._cachedRayForTransform)),A,w,!1,N);return p&&(p.ray=t),p}(this,d,t,A,w)},w.e.prototype.multiPick=function(d,t,A,w,N){return function(d,t,A,w,N,p){return F(d,(w=>Q(d,t,A,w,N||null)),w,p)}(this,d,t,A,w,N)},w.e.prototype.multiPickWithRay=function(d,t,A){return function(d,t,A,w){return F(d,(A=>(d._pickWithRayInverseMatrix||(d._pickWithRayInverseMatrix=B.c.Identity()),A.invertToRef(d._pickWithRayInverseMatrix),d._cachedRayForTransform||(d._cachedRayForTransform=b.Zero()),b.TransformToRef(t,d._pickWithRayInverseMatrix,d._cachedRayForTransform),d._cachedRayForTransform)),A,w)}(this,d,t,A)}},11607:(d,t,A)=>{"use strict";var w=A(10861),N=A(10740),p=A(10779),B=A(10894),X=A(10824),W=A(10869);X.c.prototype._partialLoadFile=function(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(d,(d=>{A[t]=d,A._internalCount++,6===A._internalCount&&w(A)}),void 0,void 0,!0,((d,t)=>{N&&d&&N(d.status+" "+d.statusText,t)}))},X.c.prototype._cascadeLoadFiles=function(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=[];N._internalCount=0;for(let p=0;p<6;p++)this._partialLoadFile(A[p],p,N,t,w)},X.c.prototype._cascadeLoadImgs=function(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5?arguments[5]:void 0;const B=[];B._internalCount=0;for(let X=0;X<6;X++)this._partialLoadImg(w[X],X,B,d,t,A,N,p)},X.c.prototype._partialLoadImg=function(d,t,A,w,N,X){let W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0;const D=(0,B.c)();(0,p.o)(d,(d=>{A[t]=d,A._internalCount++,w&&w.removePendingData(D),6===A._internalCount&&X&&X(N,A)}),((d,t)=>{w&&w.removePendingData(D),W&&W(d,t)}),w?w.offlineProvider:null,a),w&&w.addPendingData(D)},X.c.prototype.createCubeTextureBase=function(d,t,A,p){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6?arguments[6]:void 0,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]&&arguments[8],k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,J=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,U=arguments.length>14&&void 0!==arguments[14]&&arguments[14],T=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const F=Q||new w.c(this,7);F.isCube=!0,F.url=d,F.generateMipMaps=!p,F._lodGenerationScale=k,F._lodGenerationOffset=b,F._useSRGBBuffer=!!U&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!p),F!==Q&&(F.label=d.substring(0,60)),this._doNotHandleContextLost||(F._extension=D,F._files=A,F._buffer=T);const q=d;this._transformTextureUrl&&!Q&&(d=this._transformTextureUrl(d));const H=d.split("?")[0],f=H.lastIndexOf("."),v=D||(f>-1?H.substring(f).toLowerCase():""),m=(0,W.d)(v),j=(w,W)=>{d===q?X&&w&&X(w.status+" "+w.statusText,W):(N.e.Warn(`Failed to load ${d}, falling back to the ${q}`),this.createCubeTextureBase(q,t,A,!!p,B,X,a,D,i,k,b,F,P,J,U,T))};if(m)m.then((w=>{const p=d=>{P&&P(F,d),w.loadCubeData(d,F,i,B,X)};T?p(T):A&&6===A.length?w.supportCascades?this._cascadeLoadFiles(t,(d=>p(d.map((d=>new Uint8Array(d))))),A,X):X?X("Textures type does not support cascades."):N.e.Warn("Texture loader does not support cascades."):this._loadFile(d,(d=>p(new Uint8Array(d))),void 0,void 0,!0,j)}));else{if(!A||0===A.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(t,F,((d,t)=>{J&&J(d,t)}),A,X)}return this._internalTexturesCache.push(F),F}},11535:(d,t,A)=>{"use strict";A(10824).c.prototype.createDepthStencilTexture=function(d,t,A){if(t.isCube){const A=d.width||d;return this._createDepthStencilCubeTexture(A,t)}return this._createDepthStencilTexture(d,t,A)}},11506:(d,t,A)=>{"use strict";A(11476).ThinEngine.prototype.setAlphaMode=function(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==d){switch(d){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}t||(this.depthCullingState.depthMask=0===d),this._alphaMode=d}else if(!t){const t=0===d;this.depthCullingState.depthMask!==t&&(this.depthCullingState.depthMask=t)}}},11471:(d,t,A)=>{"use strict";var w=A(11476);w.ThinEngine.prototype.updateDynamicIndexBuffer=function(d,t){let A;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(d),A=d.is32Bits?t instanceof Uint32Array?t:new Uint32Array(t):t instanceof Uint16Array?t:new Uint16Array(t),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,A,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},w.ThinEngine.prototype.updateDynamicVertexBuffer=function(d,t,A,w){this.bindArrayBuffer(d),void 0===A&&(A=0);const N=t.byteLength||t.length;void 0===w||w>=N&&0===A?t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,A,new Float32Array(t)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,A,t):t instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(t).subarray(A,A+w)):(t=t instanceof ArrayBuffer?new Uint8Array(t,A,w):new Uint8Array(t.buffer,t.byteOffset+A,w),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t)),this._resetVertexBufferBinding()}},11519:(d,t,A)=>{"use strict";var w=A(10861),N=A(10740),p=A(11476),B=A(11526);class X extends B.b{constructor(d,t,A,w,N){super(d,t,A,w),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=N}_cloneRenderTargetWrapper(){let d=null;return this._colorTextureArray&&this._depthStencilTextureArray?(d=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),d.texture.isReady=!0):d=super._cloneRenderTargetWrapper(),d}_swapRenderTargetWrapper(d){super._swapRenderTargetWrapper(d),d._framebuffer=this._framebuffer,d._depthStencilBuffer=this._depthStencilBuffer,d._MSAAFramebuffer=this._MSAAFramebuffer,d._colorTextureArray=this._colorTextureArray,d._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,p=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const d=this._engine,t=d._currentFramebuffer,A=this._context;d._bindUnboundFramebuffer(this._framebuffer),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,null),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.DEPTH_ATTACHMENT,A.RENDERBUFFER,null),A.framebufferRenderbuffer(A.FRAMEBUFFER,A.STENCIL_ATTACHMENT,A.RENDERBUFFER,null),d._bindUnboundFramebuffer(t),A.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(d,t,A,w,N,p)}shareDepth(d){super.shareDepth(d);const t=this._context,A=this._depthStencilBuffer,w=d._MSAAFramebuffer||d._framebuffer,N=this._engine;d._depthStencilBuffer&&d._depthStencilBuffer!==A&&t.deleteRenderbuffer(d._depthStencilBuffer),d._depthStencilBuffer=A;const p=d._generateStencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;N._bindUnboundFramebuffer(w),t.framebufferRenderbuffer(t.FRAMEBUFFER,p,t.RENDERBUFFER,A),N._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!d._hardwareTexture)return;const N=this._framebuffer,p=this._engine,B=p._currentFramebuffer;if(p._bindUnboundFramebuffer(N),p.webGLVersion>1){const N=this._context,p=N["COLOR_ATTACHMENT"+t];var X;if(d.is2DArray||d.is3D)A=A??(null===(X=this.layerIndices)||void 0===X?void 0:X[t])??0,N.framebufferTextureLayer(N.FRAMEBUFFER,p,d._hardwareTexture.underlyingResource,w,A);else if(d.isCube){var W;A=A??(null===(W=this.faceIndices)||void 0===W?void 0:W[t])??0,N.framebufferTexture2D(N.FRAMEBUFFER,p,N.TEXTURE_CUBE_MAP_POSITIVE_X+A,d._hardwareTexture.underlyingResource,w)}else N.framebufferTexture2D(N.FRAMEBUFFER,p,N.TEXTURE_2D,d._hardwareTexture.underlyingResource,w)}else{const N=this._context,p=N["COLOR_ATTACHMENT"+t+"_WEBGL"],B=void 0!==A?N.TEXTURE_CUBE_MAP_POSITIVE_X+A:N.TEXTURE_2D;N.framebufferTexture2D(N.FRAMEBUFFER,p,B,d._hardwareTexture.underlyingResource,w)}p._bindUnboundFramebuffer(B)}setTexture(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(d,t,A),this._bindTextureRenderTarget(d,t)}setLayerAndFaceIndices(d,t){var A;if(super.setLayerAndFaceIndices(d,t),!this.textures||!this.layerIndices||!this.faceIndices)return;const w=(null===(A=this._attachments)||void 0===A?void 0:A.length)??this.textures.length;for(let N=0;N<w;N++){const d=this.textures[N];d&&(d.is2DArray||d.is3D?this._bindTextureRenderTarget(d,N,this.layerIndices[N]):d.isCube?this._bindTextureRenderTarget(d,N,this.faceIndices[N]):this._bindTextureRenderTarget(d,N))}}setLayerAndFaceIndex(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(d,t,A),!this.textures||!this.layerIndices||!this.faceIndices)return;const w=this.textures[d];w.is2DArray||w.is3D?this._bindTextureRenderTarget(this.textures[d],d,this.layerIndices[d]):w.isCube&&this._bindTextureRenderTarget(this.textures[d],d,this.faceIndices[d])}dispose(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const t=this._context;d||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(t.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(t.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(t.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(d)}}A(11535);p.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(d,t,A){const w=new X(d,t,A,this,this._gl);return this._renderTargetWrapperCache.push(w),w},p.ThinEngine.prototype.createRenderTargetTexture=function(d,t){const A=this._createHardwareRenderTargetWrapper(!1,!1,d);let w,N,p=!0,B=!1,X=!1,W=1;void 0!==t&&"object"===typeof t&&(p=t.generateDepthBuffer??!0,B=!!t.generateStencilBuffer,X=!!t.noColorAttachment,w=t.colorAttachment,W=t.samples??1,N=t.label);const a=w||(X?null:this._createInternalTexture(d,t,!0,5)),D=d.width||d,i=d.height||d,k=this._currentFramebuffer,b=this._gl,Q=b.createFramebuffer();if(this._bindUnboundFramebuffer(Q),A._depthStencilBuffer=this._setupFramebufferDepthAttachments(B,p,D,i),!a||a.is2DArray||a.is3D||b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,a._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(k),A.label=N??"RenderTargetWrapper",A._framebuffer=Q,A._generateDepthBuffer=p,A._generateStencilBuffer=B,A.setTextures(a),w){if(A._samples=w.samples,w.samples>1){const d=w._hardwareTexture.getMSAARenderBuffer(0);A._MSAAFramebuffer=b.createFramebuffer(),this._bindUnboundFramebuffer(A._MSAAFramebuffer),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,d),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(A,W);return A},p.ThinEngine.prototype._createDepthStencilTexture=function(d,t,A){const p=this._gl,B=d.layers||0,X=d.depth||0;let W=p.TEXTURE_2D;0!==B?W=p.TEXTURE_2D_ARRAY:0!==X&&(W=p.TEXTURE_3D);const a=new w.c(this,12);if(a.label=t.label,!this._caps.depthTextureExtension)return N.e.Error("Depth texture is not supported by your browser or hardware."),a;const D={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t};if(this._bindTextureDirectly(W,a,!0),this._setupDepthStencilTexture(a,d,0!==D.comparisonFunction&&D.bilinearFiltering,D.comparisonFunction,D.samples),void 0!==D.depthTextureFormat){if(15!==D.depthTextureFormat&&16!==D.depthTextureFormat&&17!==D.depthTextureFormat&&13!==D.depthTextureFormat&&14!==D.depthTextureFormat&&18!==D.depthTextureFormat)return N.e.Error(`Depth texture ${D.depthTextureFormat} format is not supported.`),a;a.format=D.depthTextureFormat}else a.format=D.generateStencil?13:16;const i=17===a.format||13===a.format||18===a.format;let k=p.UNSIGNED_INT;15===a.format?k=p.UNSIGNED_SHORT:17===a.format||13===a.format?k=p.UNSIGNED_INT_24_8:14===a.format?k=p.FLOAT:18===a.format&&(k=p.FLOAT_32_UNSIGNED_INT_24_8_REV);const b=i?p.DEPTH_STENCIL:p.DEPTH_COMPONENT,Q=this._getInternalFormatFromDepthTextureFormat(a.format,!0,i);return a.is2DArray?p.texImage3D(W,0,Q,a.width,a.height,B,0,b,k,null):a.is3D?p.texImage3D(W,0,Q,a.width,a.height,X,0,b,k,null):p.texImage2D(W,0,Q,a.width,a.height,0,b,k,null),this._bindTextureDirectly(W,null),this._internalTexturesCache.push(a),A._depthStencilBuffer&&(p.deleteRenderbuffer(A._depthStencilBuffer),A._depthStencilBuffer=null),this._bindUnboundFramebuffer(A._MSAAFramebuffer??A._framebuffer),A._generateStencilBuffer=i,A._depthStencilTextureWithStencil=i,A._depthStencilBuffer=this._setupFramebufferDepthAttachments(A._generateStencilBuffer,A._generateDepthBuffer,A.width,A.height,A.samples,a.format),this._bindUnboundFramebuffer(null),a},p.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(d,t){var A;if(this.webGLVersion<2||!d)return 1;if(d.samples===t)return t;const w=this._gl;t=Math.min(t,this.getCaps().maxMSAASamples),d._depthStencilBuffer&&(w.deleteRenderbuffer(d._depthStencilBuffer),d._depthStencilBuffer=null),d._MSAAFramebuffer&&(w.deleteFramebuffer(d._MSAAFramebuffer),d._MSAAFramebuffer=null);const N=null===(A=d.texture)||void 0===A?void 0:A._hardwareTexture;if(null===N||void 0===N||N.releaseMSAARenderBuffers(),d.texture&&t>1&&"function"===typeof w.renderbufferStorageMultisample){const A=w.createFramebuffer();if(!A)throw new Error("Unable to create multi sampled framebuffer");d._MSAAFramebuffer=A,this._bindUnboundFramebuffer(d._MSAAFramebuffer);const p=this._createRenderBuffer(d.texture.width,d.texture.height,t,-1,this._getRGBABufferInternalSizedFormat(d.texture.type,d.texture.format,d.texture._useSRGBBuffer),w.COLOR_ATTACHMENT0,!1);if(!p)throw new Error("Unable to create multi sampled framebuffer");null===N||void 0===N||N.addMSAARenderBuffer(p)}this._bindUnboundFramebuffer(d._MSAAFramebuffer??d._framebuffer),d.texture&&(d.texture.samples=t),d._samples=t;const p=d._depthStencilTexture?d._depthStencilTexture.format:void 0;return d._depthStencilBuffer=this._setupFramebufferDepthAttachments(d._generateStencilBuffer,d._generateDepthBuffer,d.width,d.height,t,p),this._bindUnboundFramebuffer(null),t},p.ThinEngine.prototype._setupDepthStencilTexture=function(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const p=t.width??t,B=t.height??t,X=t.layers||0,W=t.depth||0;d.baseWidth=p,d.baseHeight=B,d.width=p,d.height=B,d.is2DArray=X>0,d.depth=X||W,d.isReady=!0,d.samples=N,d.generateMipMaps=!1,d.samplingMode=A?2:1,d.type=0,d._comparisonFunction=w;const a=this._gl,D=this._getTextureTarget(d),i=this._getSamplingParameters(d.samplingMode,!1);a.texParameteri(D,a.TEXTURE_MAG_FILTER,i.mag),a.texParameteri(D,a.TEXTURE_MIN_FILTER,i.min),a.texParameteri(D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===w?(a.texParameteri(D,a.TEXTURE_COMPARE_FUNC,515),a.texParameteri(D,a.TEXTURE_COMPARE_MODE,a.NONE)):(a.texParameteri(D,a.TEXTURE_COMPARE_FUNC,w),a.texParameteri(D,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE)))}},10798:(d,t,A)=>{"use strict";A.d(t,{b:()=>m,e:()=>f,g:()=>v,h:()=>u,l:()=>V});class w{constructor(){this.children=[]}isValid(d){return!0}process(d,t){let A="";if(this.line){let a=this.line;const D=t.processor;if(D){var w,N,p,B,X,W;D.lineProcessor&&(a=D.lineProcessor(a,t.isFragment,t.processingContext));const A=(null===(w=t.processor)||void 0===w?void 0:w.attributeKeywordName)??"attribute",i=t.isFragment&&null!==(N=t.processor)&&void 0!==N&&N.varyingFragmentKeywordName?null===(p=t.processor)||void 0===p?void 0:p.varyingFragmentKeywordName:!t.isFragment&&null!==(B=t.processor)&&void 0!==B&&B.varyingVertexKeywordName?null===(X=t.processor)||void 0===X?void 0:X.varyingVertexKeywordName:"varying";if(!t.isFragment&&D.attributeProcessor&&this.line.startsWith(A))a=D.attributeProcessor(this.line,d,t.processingContext);else if(D.varyingProcessor&&(null!==(W=D.varyingCheck)&&void 0!==W&&W.call(D,this.line,t.isFragment)||!D.varyingCheck&&this.line.startsWith(i)))a=D.varyingProcessor(this.line,t.isFragment,d,t.processingContext);else if(D.uniformProcessor&&D.uniformRegexp&&D.uniformRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(a=D.uniformProcessor(this.line,t.isFragment,d,t.processingContext));else if(D.uniformBufferProcessor&&D.uniformBufferRegexp&&D.uniformBufferRegexp.test(this.line))t.lookForClosingBracketForUniformBuffer||(a=D.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0);else if(D.textureProcessor&&D.textureRegexp&&D.textureRegexp.test(this.line))a=D.textureProcessor(this.line,t.isFragment,d,t.processingContext);else if((D.uniformProcessor||D.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!t.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?D.uniformProcessor&&(a=D.uniformProcessor(this.line,t.isFragment,d,t.processingContext)):D.uniformBufferProcessor&&(a=D.uniformBufferProcessor(this.line,t.isFragment,t.processingContext),t.lookForClosingBracketForUniformBuffer=!0)}t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,D.endOfUniformBufferProcessor&&(a=D.endOfUniformBufferProcessor(this.line,t.isFragment,t.processingContext)))}A+=a+"\n"}return this.children.forEach((w=>{A+=w.process(d,t)})),this.additionalDefineKey&&(d[this.additionalDefineKey]=this.additionalDefineValue||"true"),A}}class N{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(d){this._lines.length=0;for(const t of d){if(!t||"\r"===t)continue;if("#"===t[0]){this._lines.push(t);continue}const d=t.trim();if(!d)continue;if(d.startsWith("//")){this._lines.push(t);continue}const A=d.indexOf(";");if(-1===A)this._lines.push(d);else if(A===d.length-1)d.length>1&&this._lines.push(d);else{const d=t.split(";");for(let t=0;t<d.length;t++){let A=d[t];A&&(A=A.trim(),A&&this._lines.push(A+(t!==d.length-1?";":"")))}}}}}class p extends w{process(d,t){for(let A=0;A<this.children.length;A++){const w=this.children[A];if(w.isValid(d))return w.process(d,t)}return""}}class B extends w{isValid(d){return this.testExpression.isTrue(d)}}class X{isTrue(d){return!0}static postfixToInfix(d){const t=[];for(const A of d)if(void 0===X._OperatorPriority[A])t.push(A);else{const d=t[t.length-1],w=t[t.length-2];t.length-=2,t.push(`(${w}${A}${d})`)}return t[t.length-1]}static infixToPostfix(d){const t=X._InfixToPostfixCache.get(d);if(t)return t.accessTime=Date.now(),t.result;if(!d.includes("&&")&&!d.includes("||")&&!d.includes(")")&&!d.includes("("))return[d];const A=[];let w=-1;const N=()=>{D=D.trim(),""!==D&&(A.push(D),D="")},p=d=>{w<X._Stack.length-1&&(X._Stack[++w]=d)},B=()=>X._Stack[w],W=()=>-1===w?"!!INVALID EXPRESSION!!":X._Stack[w--];let a=0,D="";for(;a<d.length;){const t=d.charAt(a),i=a<d.length-1?d.substring(a,2+a):"";if("("===t)D="",p(t);else if(")"===t){for(N();-1!==w&&"("!==B();)A.push(W());W()}else if(X._OperatorPriority[i]>1){for(N();-1!==w&&X._OperatorPriority[B()]>=X._OperatorPriority[i];)A.push(W());p(i),a++}else D+=t;a++}for(N();-1!==w;)"("===B()?W():A.push(W());return X._InfixToPostfixCache.size>=X.InfixToPostfixCacheLimitSize&&X.ClearCache(),X._InfixToPostfixCache.set(d,{result:A,accessTime:Date.now()}),A}static ClearCache(){const d=Array.from(X._InfixToPostfixCache.entries()).sort(((d,t)=>d[1].accessTime-t[1].accessTime));for(let t=0;t<X.InfixToPostfixCacheCleanupSize;t++)X._InfixToPostfixCache.delete(d[t][0])}}X.InfixToPostfixCacheLimitSize=5e4,X.InfixToPostfixCacheCleanupSize=25e3,X._InfixToPostfixCache=new Map,X._OperatorPriority={")":0,"(":1,"||":2,"&&":3},X._Stack=["","","","","","","","","","","","","","","","","","","",""];class W extends X{constructor(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=d,this.not=t}isTrue(d){let t=void 0!==d[this.define];return this.not&&(t=!t),t}}class a extends X{isTrue(d){return this.leftOperand.isTrue(d)||this.rightOperand.isTrue(d)}}class D extends X{isTrue(d){return this.leftOperand.isTrue(d)&&this.rightOperand.isTrue(d)}}class i extends X{constructor(d,t,A){super(),this.define=d,this.operand=t,this.testValue=A}isTrue(d){let t=d[this.define];void 0===t&&(t=this.define);let A=!1;const w=parseInt(t),N=parseInt(this.testValue);switch(this.operand){case">":A=w>N;break;case"<":A=w<N;break;case"<=":A=w<=N;break;case">=":A=w>=N;break;case"==":A=w===N;break;case"!=":A=w!==N}return A}}var k=A(10761),b=A(10807);const Q=/defined\s*?\((.+?)\)/g,P=/defined\s*?\[(.+?)\]/g,J=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,U=/__decl__/,T=/light\{X\}.(\w*)/g,F=/\{X\}/g,q=[],H=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function f(d){d.processor&&d.processor.initializeShaders&&d.processor.initializeShaders(d.processingContext)}function v(d,t,A,w){var N;null!==(N=t.processor)&&void 0!==N&&N.preProcessShaderCode&&(d=t.processor.preProcessShaderCode(d,t.isFragment)),u(d,t,(d=>{t.processCodeAfterIncludes&&(d=t.processCodeAfterIncludes(t.isFragment?"fragment":"vertex",d,t.defines));const N=function(d,t,A){let w=function(d,t){var A;if(null!==(A=t.processor)&&void 0!==A&&A.noPrecision)return d;const w=t.shouldUseHighPrecisionShader;-1===d.indexOf("precision highp float")?d=w?"precision highp float;\n"+d:"precision mediump float;\n"+d:w||(d=d.replace("precision highp float","precision mediump float"));return d}(d,t);if(!t.processor)return w;if(0===t.processor.shaderLanguage&&-1!==w.indexOf("#version 3")&&(w=w.replace("#version 300 es",""),!t.processor.parseGLES3))return w;const N=t.defines,p=I(t,A);t.processor.preProcessor&&(w=t.processor.preProcessor(w,N,p,t.isFragment,t.processingContext));w=L(w,p,t),t.processor.postProcessor&&(w=t.processor.postProcessor(w,N,t.isFragment,t.processingContext,A?{drawBuffersExtensionDisabled:!A.getCaps().drawBuffersExtension}:{}));null!==A&&void 0!==A&&A._features.needShaderCodeInlining&&(w=A.inlineShaderCode(w));return w}(d,t,w);A(N,d)}))}function m(d,t,A){return A.processor&&A.processor.finalizeShaders?A.processor.finalizeShaders(d,t,A.processingContext):{vertexCode:d,fragmentCode:t}}function j(d){const t=/defined\((.+)\)/.exec(d);if(t&&t.length)return new W(t[1].trim(),"!"===d[0]);const A=["==","!=",">=","<=","<",">"];let w="",N=0;for(w of A)if(N=d.indexOf(w),N>-1)break;if(-1===N)return new W(d);const p=d.substring(0,N).trim(),B=d.substring(N+w.length).trim();return new i(p,w,B)}function n(d,t){const A=new B,w=d.substring(0,t);let N=d.substring(t);return N=N.substring(0,(N.indexOf("//")+1||N.length+1)-1).trim(),A.testExpression="#ifdef"===w?new W(N):"#ifndef"===w?new W(N,!0):function(d){d=d.replace(Q,"defined[$1]");const t=X.infixToPostfix(d),A=[];for(const N of t)if("||"!==N&&"&&"!==N)A.push(N);else if(A.length>=2){let d=A[A.length-1],t=A[A.length-2];A.length-=2;const w="&&"==N?new D:new a;"string"===typeof d&&(d=d.replace(P,"defined($1)")),"string"===typeof t&&(t=t.replace(P,"defined($1)")),w.leftOperand="string"===typeof t?j(t):t,w.rightOperand="string"===typeof d?j(d):d,A.push(w)}let w=A[A.length-1];return"string"===typeof w&&(w=w.replace(P,"defined($1)")),"string"===typeof w?j(w):w}(N),A}function R(d,t,A){let N=d.currentLine;for(;Z(d,A);){N=d.currentLine;const p=N.substring(0,5).toLowerCase();if("#else"===p){const A=new w;return t.children.push(A),void Z(d,A)}if("#elif"===p){const d=n(N,5);t.children.push(d),A=d}}}function Z(d,t){for(;d.canRead;){d.lineIndex++;const A=d.currentLine;if(A.indexOf("#")>=0){const w=H.exec(A);if(w&&w.length){switch(w[0]){case"#ifdef":{const w=new p;t.children.push(w);const N=n(A,6);w.children.push(N),R(d,w,N);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const w=new p;t.children.push(w);const N=n(A,7);w.children.push(N),R(d,w,N);break}case"#if":{const w=new p,N=n(A,3);t.children.push(w),w.children.push(N),R(d,w,N);break}}continue}}const N=new w;if(N.line=A,t.children.push(N),"#"===A[0]&&"d"===A[1]){const d=A.replace(";","").split(" ");N.additionalDefineKey=d[1],3===d.length&&(N.additionalDefineValue=d[2])}}return!1}function L(d,t,A){const p=new w,B=new N;return B.lineIndex=-1,B.lines=d.split("\n"),Z(B,p),p.process(t,A)}function I(d,t){var A;const w=d.defines,N={};for(const p of w){const d=p.replace("#define","").replace(";","").trim().split(" ");N[d[0]]=d.length>1?d[1]:""}return 0===(null===(A=d.processor)||void 0===A?void 0:A.shaderLanguage)&&(N.GL_ES="true"),N.__VERSION__=d.version,N[d.platformName]="true",(0,b.e)(N,null===t||void 0===t?void 0:t.isNDCHalfZRange,null===t||void 0===t?void 0:t.useReverseDepthBuffer,null===t||void 0===t?void 0:t.useExactSrgbConversions),N}function u(d,t,A){let w;for(q.length=0;null!==(w=J.exec(d));)q.push(w);let N=String(d),p=[d],B=!1;for(const X of q){let d=X[1];if(-1!==d.indexOf("__decl__")&&(d=d.replace(U,""),t.supportsUniformBuffers&&(d=d.replace("Vertex","Ubo").replace("Fragment","Ubo")),d+="Declaration"),!t.includesShadersStore[d]){const w=t.shadersRepository+"ShadersInclude/"+d+".fx";return void V.loadFile(w,(w=>{t.includesShadersStore[d]=w,u(p.join(""),t,A)}))}{let A=t.includesShadersStore[d];if(X[2]){const d=X[3].split(",");for(let t=0;t<d.length;t+=2){const w=new RegExp(d[t],"g"),N=d[t+1];A=A.replace(w,N)}}if(X[4]){const d=X[5];if(-1!==d.indexOf("..")){const w=d.split(".."),N=parseInt(w[0]);let p=parseInt(w[1]),B=A.slice(0);A="",isNaN(p)&&(p=t.indexParameters[w[1]]);for(let d=N;d<p;d++)t.supportsUniformBuffers||(B=B.replace(T,((d,t)=>t+"{X}"))),A+=B.replace(F,d.toString())+"\n"}else t.supportsUniformBuffers||(A=A.replace(T,((d,t)=>t+"{X}"))),A=A.replace(F,d)}const w=[];for(const d of p){const t=d.split(X[0]);for(let d=0;d<t.length-1;d++)w.push(t[d]),w.push(A);w.push(t[t.length-1])}p=w,B=B||A.indexOf("#include<")>=0||A.indexOf("#include <")>=0}}q.length=0,N=p.join(""),B?u(N.toString(),t,A):A(N)}const V={loadFile:(d,t,A,w,N,p)=>{throw(0,k.b)("FileTools")}}},11496:(d,t,A)=>{"use strict";A.d(t,{e:()=>w});class w{get underlyingResource(){return this._webGLTexture}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=t,!d&&(d=t.createTexture(),!d))throw new Error("Unable to create webGL texture");this.set(d)}setUsage(){}set(d){this._webGLTexture=d}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(d){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(d)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const d of this._MSAARenderBuffers)this._context.deleteRenderbuffer(d);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var d;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(d=this._MSAARenderBuffers)||void 0===d?void 0:d[t])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10807:(d,t,A)=>{"use strict";A.d(t,{c:()=>N,d:()=>p,e:()=>X,g:()=>B,j:()=>W});var w=A(10761);A(10737);const N={};function p(d,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(t?t+"\n":"")+d}function B(d,t,A,p,B,X,W){const a=W||N.loadFile;if(a){return a(d,t,A,p,B,X)}throw(0,w.b)("FileTools")}function X(d,t,A,w){if(d)return t?d.IS_NDC_HALF_ZRANGE="":delete d.IS_NDC_HALF_ZRANGE,A?d.USE_REVERSE_DEPTHBUFFER="":delete d.USE_REVERSE_DEPTHBUFFER,void(w?d.USE_EXACT_SRGB_CONVERSIONS="":delete d.USE_EXACT_SRGB_CONVERSIONS);{let d="";return t&&(d+="#define IS_NDC_HALF_ZRANGE"),A&&(d&&(d+="\n"),d+="#define USE_REVERSE_DEPTHBUFFER"),w&&(d&&(d+="\n"),d+="#define USE_EXACT_SRGB_CONVERSIONS"),d}}function W(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;switch(d){case 3:{const d=(ArrayBuffer,new Int8Array(t));return w&&d.set(new Int8Array(w)),d}case 0:{const d=(ArrayBuffer,new Uint8Array(t));return w&&d.set(new Uint8Array(w)),d}case 4:{const d=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(A?t/2:t);return w&&d.set(new Int16Array(w)),d}case 5:case 8:case 9:case 10:case 2:{const d=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(A?t/2:t);return w&&d.set(new Uint16Array(w)),d}case 6:{const d=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(A?t/4:t);return w&&d.set(new Int32Array(w)),d}case 7:case 11:case 12:case 13:case 14:case 15:{const d=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(A?t/4:t);return w&&d.set(new Uint32Array(w)),d}case 1:{const d=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(A?t/4:t);return w&&d.set(new Float32Array(w)),d}}const N=(ArrayBuffer,new Uint8Array(t));return w&&N.set(new Uint8Array(w)),N}},10824:(d,t,A)=>{"use strict";A.d(t,{c:()=>F});var w=A(10775),N=A(10740),p=A(10829),B=A(10856),X=A(10756);class W{constructor(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,d&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(d){this._zOffset!==d&&(this._zOffset=d,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(d){this._zOffsetUnits!==d&&(this._zOffsetUnits=d,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(d){this._cullFace!==d&&(this._cullFace=d,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(d){this._cull!==d&&(this._cull=d,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(d){this._depthFunc!==d&&(this._depthFunc=d,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(d){this._depthMask!==d&&(this._depthMask=d,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(d){this._depthTest!==d&&(this._depthTest=d,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(d){this._frontFace!==d&&(this._frontFace=d,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(d){this.isDirty&&(this._isCullDirty&&(this.cull?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(d.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(d.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(d.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(d.enable(d.POLYGON_OFFSET_FILL),d.polygonOffset(this.zOffset,this.zOffsetUnits)):d.disable(d.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(d.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class a{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(d){this._func!==d&&(this._func=d,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(d){this._funcRef!==d&&(this._funcRef=d,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(d){this._funcMask!==d&&(this._funcMask=d,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(d){this._opStencilFail!==d&&(this._opStencilFail=d,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(d){this._opDepthFail!==d&&(this._opDepthFail=d,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(d){this._opStencilDepthPass!==d&&(this._opStencilDepthPass=d,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(d){this._mask!==d&&(this._mask=d,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(d){this._enabled!==d&&(this._enabled=d,this._isStencilTestDirty=!0)}constructor(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,d&&this.reset()}reset(){var d;this.stencilMaterial=void 0,null===(d=this.stencilGlobal)||void 0===d||d.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(d){var t;if(!d)return;const A=!this.useStencilGlobalOnly&&!(null===(t=this.stencilMaterial)||void 0===t||!t.enabled);this.enabled=A?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=A?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=A?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=A?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=A?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=A?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=A?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=A?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(d.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(d.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(d.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class D{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=D.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=D.KEEP,this.opDepthFail=D.KEEP,this.opStencilDepthPass=D.REPLACE}get stencilFunc(){return this.func}set stencilFunc(d){this.func=d}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(d){this.funcRef=d}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(d){this.funcMask=d}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(d){this.opStencilFail=d}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(d){this.opDepthFail=d}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(d){this.opStencilDepthPass=d}get stencilMask(){return this.mask}set stencilMask(d){this.mask=d}get stencilTest(){return this.enabled}set stencilTest(d){this.enabled=d}}D.ALWAYS=519,D.KEEP=7680,D.REPLACE=7681;class i{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(d){this._alphaBlend!==d&&(this._alphaBlend=d,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(d,t,A,w){this._blendConstants[0]===d&&this._blendConstants[1]===t&&this._blendConstants[2]===A&&this._blendConstants[3]===w||(this._blendConstants[0]=d,this._blendConstants[1]=t,this._blendConstants[2]=A,this._blendConstants[3]=w,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(d,t,A,w){this._blendFunctionParameters[0]===d&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===A&&this._blendFunctionParameters[3]===w||(this._blendFunctionParameters[0]=d,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=A,this._blendFunctionParameters[3]=w,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(d,t){this._blendEquationParameters[0]===d&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=d,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(d){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?d.enable(d.BLEND):d.disable(d.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(d.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(d.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(d.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var k=A(10761),b=A(10861),Q=A(10737),P=A(10730),J=A(10807),U=A(10869);function T(d,t){if((0,Q.l)()){const{requestAnimationFrame:A}=t||window;if("function"===typeof A)return A(d)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(d);return setTimeout(d,16)}class F{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(d){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(d){d!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=d,this._depthCullingState.depthFunc=d?518:515)}setColorWrite(d){d!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=d)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(d){if(d)return this.isNDCHalfZRange?d.IS_NDC_HALF_ZRANGE="":delete d.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?d.USE_REVERSE_DEPTHBUFFER="":delete d.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?d.USE_EXACT_SRGB_CONVERSIONS="":delete d.USE_EXACT_SRGB_CONVERSIONS);{let d="";return this.isNDCHalfZRange&&(d+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(d&&(d+="\n"),d+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(d&&(d+="\n"),d+="#define USE_EXACT_SRGB_CONVERSIONS"),d}}_rebuildInternalTextures(){const d=this._internalTexturesCache.slice();for(const t of d)t._rebuild()}_rebuildRenderTargetWrappers(){const d=this._renderTargetWrapperCache.slice();for(const t of d)t._rebuild()}_rebuildEffects(){for(const d in this._compiledEffects){const t=this._compiledEffects[d];t._pipelineContext=null,t._prepareEffect()}p.e.ResetCache()}_rebuildGraphicsResources(){var d;this.wipeCaches(!0),this._rebuildEffects(),null===(d=this._rebuildComputeEffects)||void 0===d||d.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){N.e.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(d){setTimeout((async()=>{this._clearEmptyResources();const t=this._depthCullingState.depthTest,A=this._depthCullingState.depthFunc,w=this._depthCullingState.depthMask,N=this._stencilState.stencilTest;await d(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=t,this._depthCullingState.depthFunc=A,this._depthCullingState.depthMask=w,this._stencilState.stencilTest=N,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(d){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(d){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const d=new Uint8Array(4),t=[d,d,d,d,d,d];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(d){if(!d)return this._activeRenderLoops.length=0,void this._cancelFrame();const t=this._activeRenderLoops.indexOf(d);t>=0&&(this._activeRenderLoops.splice(t,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const d=this._frameHandler;if(this._frameHandler=0,(0,Q.l)()){const{cancelAnimationFrame:t}=this.getHostWindow()||window;if("function"===typeof t)return t(d)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(d);return clearTimeout(d)}}cj(){this.onBeginFrameObservable.notifyObservers(this)}dj(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let d=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(d=!1),d&&(this.cj(),this._renderViews()||this._renderFrame(),this.dj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let d=0;d<this._activeRenderLoops.length;d++){(0,this._activeRenderLoops[d])()}}_renderViews(){return!1}_queueNewFrame(d,t){return T(d,t)}runRenderLoop(d){-1===this._activeRenderLoops.indexOf(d)&&(this._activeRenderLoops.push(d),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(d){this._depthCullingState.depthTest=d}setZOffset(d){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-d:d}getZOffset(){const d=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-d:d}setZOffsetUnits(d){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-d:d}getZOffsetUnits(){const d=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-d:d}getHostWindow(){return(0,Q.l)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(d){this._compatibilityMode=!0}_rebuildTextures(){for(const d of this.scenes)d._rebuildTextures();for(const d of this._virtualScenes)d._rebuildTextures()}_releaseRenderTargetWrapper(d){const t=this._renderTargetWrapperCache.indexOf(d);-1!==t&&this._renderTargetWrapperCache.splice(t,1)}get currentViewport(){return this._cachedViewport}setViewport(d,t,A){const w=t||this.getRenderWidth(),N=A||this.getRenderHeight(),p=d.x||0,B=d.y||0;this._cachedViewport=d,this._viewport(p*w,B*N,w*d.width,N*d.height)}createCanvasImage(){return document.createElement("img")}get description(){let d=this.name+this.version;return this._caps.parallelShaderCompile&&(d+=" - Parallel shader compilation"),d}_createTextureBase(d,t,A,p){let B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7?arguments[7]:void 0,D=arguments.length>8?arguments[8]:void 0,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,P=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,J=arguments.length>13?arguments[13]:void 0,T=arguments.length>14?arguments[14]:void 0,q=arguments.length>15?arguments[15]:void 0;const H="data:"===(d=d||"").substr(0,5),f="blob:"===d.substr(0,5),v=H&&-1!==d.indexOf(";base64,"),m=k||new b.c(this,1);m!==k&&(m.label=d.substring(0,60));const j=d;!this._transformTextureUrl||v||k||i||(d=this._transformTextureUrl(d)),j!==d&&(m._originalUrl=j);const n=d.lastIndexOf(".");let R=P||(n>-1?d.substring(n).toLowerCase():"");R.indexOf("?")>-1&&(R=R.split("?")[0]);const Z=(0,U.d)(R,J);p&&p.addPendingData(m),m.url=d,m.generateMipMaps=!t,m.samplingMode=B,m.invertY=A,m._useSRGBBuffer=this._getUseSRGBBuffer(!!q,t),this._doNotHandleContextLost||(m._buffer=i);let L=null;X&&!k&&(L=m.onLoadedObservable.add(X)),k||this._internalTexturesCache.push(m);const I=(A,k)=>{p&&p.removePendingData(m),d===j?(L&&m.onLoadedObservable.remove(L),w.e.UseFallbackTexture&&d!==w.e.FallbackTexture&&this._createTextureBase(w.e.FallbackTexture,t,m.invertY,p,B,null,W,a,D,i,m),A=(A||"Unknown error")+(w.e.UseFallbackTexture?" - Fallback texture was used":""),m.onErrorObservable.notifyObservers({message:A,exception:k}),W&&W(A,k)):(N.e.Warn(`Failed to load ${d}, falling back to ${j}`),this._createTextureBase(j,t,m.invertY,p,B,X,W,a,D,i,m,Q,P,J,T,q))};if(Z){const t=async d=>{(await Z).loadData(d,m,((d,t,A,w,N,X)=>{X?I("TextureLoader failed to load data"):a(m,R,p,{width:d,height:t},m.invertY,!A,w,(()=>(N(),!1)),B)}),T)};i?i instanceof ArrayBuffer?t(new Uint8Array(i)):ArrayBuffer.isView(i)?t(i):W&&W("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(d,(d=>t(new Uint8Array(d))),void 0,p?p.offlineProvider:void 0,!0,((d,t)=>{I("Unable to load "+(d&&d.responseURL,t))}))}else{const A=d=>{f&&!this._doNotHandleContextLost&&(m._buffer=d),a(m,R,p,d,m.invertY,t,!1,D,B)};!H||v?i&&("string"===typeof i.decoding||i.close)?A(i):F._FileToolsLoadImage(d||"",A,I,p?p.offlineProvider:null,J,m.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof i||i instanceof ArrayBuffer||ArrayBuffer.isView(i)||i instanceof Blob?F._FileToolsLoadImage(i,A,I,p?p.offlineProvider:null,J,m.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):i&&A(i)}return m}_rebuildBuffers(){for(const d of this._uniformBuffers)d._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,Q.f)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const d in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,d)&&(this._boundTexturesCache[d]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(d){this._name=d}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(d){this._hardwareScalingLevel=d,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(d){this._doNotHandleContextLost=d}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(d,t,A){var N,p;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new W,this._stencilStateComposer=new a,this._stencilState=new D,this._alphaState=new i,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new P.b,this.onCanvasFocusObservable=new P.b,this.onNewSceneAddedObservable=new P.b,this.onResizeObservable=new P.b,this.onCanvasPointerOutObservable=new P.b,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new P.b,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new P.b,this.onAfterShaderCompilationObservable=new P.b,this.onBeginFrameObservable=new P.b,this.onEndFrameObservable=new P.b,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new P.b,this.onContextRestoredObservable=new P.b,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.hj=new P.b,w.e.Instances.push(this),this.startTime=X.d.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,B.c.SetMatrixPrecision(!!t.useHighPrecisionMatrix),(0,Q.j)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=A??!1,t.antialias=d??t.antialias,t.deterministicLockstep=t.deterministicLockstep??!1,t.lockstepMaxSteps=t.lockstepMaxSteps??4,t.timeStep=t.timeStep??1/60,t.audioEngine=t.audioEngine??!0,t.stencil=t.stencil??!0,this._audioContext=(null===(N=t.audioEngineOptions)||void 0===N?void 0:N.audioContext)??null,this._audioDestination=(null===(p=t.audioEngineOptions)||void 0===p?void 0:p.audioDestination)??null,this.premultipliedAlpha=t.premultipliedAlpha??!0,this._doNotHandleContextLost=!!t.doNotHandleContextLost,this._isStencilEnable=!!t.stencil,this.useExactSrgbConversions=t.useExactSrgbConversions??!1;const k=(0,Q.l)()&&window.devicePixelRatio||1,b=t.limitDeviceRatio||k;A=A||t.adaptToDeviceRatio||!1,this._hardwareScalingLevel=A?1/Math.min(b,k):1,this._lastDevicePixelRatio=k,this._creationOptions=t}resize(){let d,t,A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const d=(0,Q.l)()&&window.devicePixelRatio||1,t=this._lastDevicePixelRatio/d;this._lastDevicePixelRatio=d,this._hardwareScalingLevel*=t}if((0,Q.l)()&&(0,Q.f)())if(this._renderingCanvas){const A=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};d=this._renderingCanvas.clientWidth||A.width||this._renderingCanvas.width||100,t=this._renderingCanvas.clientHeight||A.height||this._renderingCanvas.height||100}else d=window.innerWidth,t=window.innerHeight;else d=this._renderingCanvas?this._renderingCanvas.width:100,t=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(d/this._hardwareScalingLevel,t/this._hardwareScalingLevel,A)}setSize(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(d|=0,t|=0,!A&&this._renderingCanvas.width===d&&this._renderingCanvas.height===t)return!1;if(this._renderingCanvas.width=d,this._renderingCanvas.height=t,this.scenes){for(let d=0;d<this.scenes.length;d++){const t=this.scenes[d];for(let d=0;d<t.cameras.length;d++){t.cameras[d]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(d,t,A,w,N,p,B,X,W,a,D){throw(0,k.b)("engine.rawTexture")}createRawCubeTexture(d,t,A,w,N,p,B,X){throw(0,k.b)("engine.rawTexture")}createRawTexture3D(d,t,A,w,N,p,B,X,W,a,D){throw(0,k.b)("engine.rawTexture")}createRawTexture2DArray(d,t,A,w,N,p,B,X,W,a,D){throw(0,k.b)("engine.rawTexture")}_sharedInit(d){this._renderingCanvas=d}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const d=navigator.userAgent;this.hostInformation.isMobile=-1!==d.indexOf("Mobile")||-1!==d.indexOf("Mac")&&(0,Q.f)()&&"ontouchend"in document},this._checkForMobile(),(0,Q.l)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(d){return document.createElement("video")}_reportDrawCall(){var d;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(d=this._drawCalls)||void 0===d||d.addCount(t,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(d,t){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(d,t){return createImageBitmap(d,t)}resizeImageBitmap(d,t,A){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(d){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(d,t){if("undefined"===typeof document)return new OffscreenCanvas(d,t);const A=document.createElement("canvas");return A.width=d,A.height=t,A}createCanvas(d,t){return F._CreateCanvas(d,t)}static _FileToolsLoadImage(d,t,A,w,N,p){throw(0,k.b)("FileTools")}_loadFile(d,t,A,w,N,p){const B=(0,J.g)(d,t,A,w,N,p);return this._activeRequests.push(B),B.onCompleteObservable.add((()=>{const d=this._activeRequests.indexOf(B);-1!==d&&this._activeRequests.splice(d,1)})),B}static _FileToolsLoadFile(d,t,A,w,N,p){if(J.c.loadFile)return J.c.loadFile(d,t,A,w,N,p);throw(0,k.b)("FileTools")}dispose(){var d;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(d=this.releaseComputeEffects)||void 0===d||d.call(this),p.e.ResetCache();for(const A of this._activeRequests)A.abort();this._boundRenderFunction=null,this.hj.notifyObservers(this),this.hj.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,Q.l)()&&window.removeEventListener("resize",this._checkForMobile);const t=w.e.Instances.indexOf(this);t>=0&&w.e.Instances.splice(t,1),w.e.Instances.length||(w.e.OnEnginesDisposedObservable.notifyObservers(this),w.e.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(d){throw(0,k.b)("LoadingScreen")}static MarkAllMaterialsAsDirty(d,t){for(let A=0;A<w.e.Instances.length;A++){const N=w.e.Instances[A];for(let A=0;A<N.scenes.length;A++)N.scenes[A].markAllMaterialsAsDirty(d,t)}}}F._RenderPassIdCounter=0,F._RescalePostProcessFactory=null,F.CollisionsEpsilon=.001,F.QueueNewFrame=T},11515:(d,t,A)=>{"use strict";A.d(t,{c:()=>m});var w=A(10861),N=A(10775),p=A(11476),B=A(10756);class X{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new W(d)}sampleFrame(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B.d.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const t=d-this._lastFrameTimeMs;this._rollingFrameTime.add(t)}this._lastFrameTimeMs=d}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const d=this._rollingFrameTime.history(0);return 0===d?0:1e3/d}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class W{constructor(d){this._samples=new Array(d),this.reset()}add(d){let t;if(this.isSaturated()){const d=this._samples[this._pos];t=d-this.average,this.average-=t/(this._sampleCount-1),this._m2-=t*(d-this.average)}else this._sampleCount++;t=d-this.average,this.average+=t/this._sampleCount,this._m2+=t*(d-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=d,this._pos++,this._pos%=this._samples.length}history(d){if(d>=this._sampleCount||d>=this._samples.length)return 0;const t=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(t-d)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(d){const t=this._samples.length;return(d%t+t)%t}}var a=A(11488),D=A(10740),i=A(11496),k=(A(11506),A(10896));function b(d,t,A,w){let N,p=1;1===w?N=new Float32Array(t*A*4):2===w?(N=new Uint16Array(t*A*4),p=15360):N=7===w?new Uint32Array(t*A*4):new Uint8Array(t*A*4);for(let B=0;B<t;B++)for(let w=0;w<A;w++){const A=3*(w*t+B),X=4*(w*t+B);N[X+0]=d[A+0],N[X+1]=d[A+1],N[X+2]=d[A+2],N[X+3]=p}return N}function Q(d){return function(t,A,N,p,B,X,W,a){let D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const k=d?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,b=d?10:11,Q=new w.c(this,b);Q.baseWidth=A,Q.baseHeight=N,Q.baseDepth=p,Q.width=A,Q.height=N,Q.depth=p,Q.format=B,Q.type=i,Q.generateMipMaps=X,Q.samplingMode=a,d?Q.is3D=!0:Q.is2DArray=!0,this._doNotHandleContextLost||(Q._bufferView=t),d?this.updateRawTexture3D(Q,t,B,W,D,i):this.updateRawTexture2DArray(Q,t,B,W,D,i),this._bindTextureDirectly(k,Q,!0);const P=this._getSamplingParameters(a,X);return this._gl.texParameteri(k,this._gl.TEXTURE_MAG_FILTER,P.mag),this._gl.texParameteri(k,this._gl.TEXTURE_MIN_FILTER,P.min),X&&this._gl.generateMipmap(k),this._bindTextureDirectly(k,null),this._internalTexturesCache.push(Q),Q}}function P(d){return function(t,A,w,N){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const X=d?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,W=this._getWebGLTextureType(B),a=this._getInternalFormat(w),D=this._getRGBABufferInternalSizedFormat(B,w);this._bindTextureDirectly(X,t,!0),this._unpackFlipY(void 0===N||!!N),this._doNotHandleContextLost||(t._bufferView=A,t.format=w,t.invertY=N,t._compression=p),t.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),p&&A?this._gl.compressedTexImage3D(X,0,this.getCaps().s3tc[p],t.width,t.height,t.depth,0,A):this._gl.texImage3D(X,0,D,t.width,t.height,t.depth,0,a,W,A),t.generateMipMaps&&this._gl.generateMipmap(X),this._bindTextureDirectly(X,null),t.isReady=!0}}p.ThinEngine.prototype.updateRawTexture=function(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!d)return;const X=this._getRGBABufferInternalSizedFormat(p,A,B),W=this._getInternalFormat(A),a=this._getWebGLTextureType(p);this._bindTextureDirectly(this._gl.TEXTURE_2D,d,!0),this._unpackFlipY(void 0===w||!!w),this._doNotHandleContextLost||(d._bufferView=t,d.format=A,d.type=p,d.invertY=w,d._compression=N),d.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),N&&t?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[N],d.width,d.height,0,t):this._gl.texImage2D(this._gl.TEXTURE_2D,0,X,d.width,d.height,0,W,a,t),d.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),d.isReady=!0},p.ThinEngine.prototype.createRawTexture=function(d,t,A,N,p,B,X){let W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const i=new w.c(this,3);i.baseWidth=t,i.baseHeight=A,i.width=t,i.height=A,i.format=N,i.generateMipMaps=p,i.samplingMode=X,i.invertY=B,i._compression=W,i.type=a,i._useSRGBBuffer=this._getUseSRGBBuffer(D,!p),this._doNotHandleContextLost||(i._bufferView=d),this.updateRawTexture(i,d,N,B,W,a,i._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,i,!0);const k=this._getSamplingParameters(X,p);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,k.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,k.min),p&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(i),i},p.ThinEngine.prototype.createRawCubeTexture=function(d,t,A,N,p,B,X){let W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const a=this._gl,i=new w.c(this,8);i.isCube=!0,i.format=A,i.type=N,this._doNotHandleContextLost||(i._bufferViewArray=d);const b=this._getWebGLTextureType(N);let Q=this._getInternalFormat(A);Q===a.RGB&&(Q=a.RGBA),b!==a.FLOAT||this._caps.textureFloatLinearFiltering?b!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?b!==a.FLOAT||this._caps.textureFloatRender?b!==a.HALF_FLOAT||this._caps.colorBufferFloat||(p=!1,D.e.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(p=!1,D.e.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(p=!1,X=1,D.e.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(p=!1,X=1,D.e.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const P=t,J=P;i.width=P,i.height=J,i.invertY=B,i._compression=W;if(!this.needPOTTextures||(0,k.i)(i.width)&&(0,k.i)(i.height)||(p=!1),d)this.updateRawCubeTexture(i,d,A,N,B,W);else{const d=this._getRGBABufferInternalSizedFormat(N),t=0;this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,i,!0);for(let A=0;A<6;A++)W?a.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+A,t,this.getCaps().s3tc[W],i.width,i.height,0,void 0):a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+A,t,d,i.width,i.height,0,Q,b,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,i,!0),d&&p&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const U=this._getSamplingParameters(X,p);return a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,U.mag),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,U.min),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),this._bindTextureDirectly(a.TEXTURE_CUBE_MAP,null),i.generateMipMaps=p,i.samplingMode=X,i.isReady=!0,i},p.ThinEngine.prototype.updateRawCubeTexture=function(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;d._bufferViewArray=t,d.format=A,d.type=w,d.invertY=N,d._compression=p;const X=this._gl,W=this._getWebGLTextureType(w);let a=this._getInternalFormat(A);const D=this._getRGBABufferInternalSizedFormat(w);let i=!1;a===X.RGB&&(a=X.RGBA,i=!0),this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,d,!0),this._unpackFlipY(void 0===N||!!N),d.width%4!==0&&X.pixelStorei(X.UNPACK_ALIGNMENT,1);for(let k=0;k<6;k++){let A=t[k];p?X.compressedTexImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+k,B,this.getCaps().s3tc[p],d.width,d.height,0,A):(i&&(A=b(A,d.width,d.height,w)),X.texImage2D(X.TEXTURE_CUBE_MAP_POSITIVE_X+k,B,D,d.width,d.height,0,a,W,A))}(!this.needPOTTextures||(0,k.i)(d.width)&&(0,k.i)(d.height))&&d.generateMipMaps&&0===B&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),d.isReady=!0},p.ThinEngine.prototype.createRawCubeTextureFromUrl=function(d,t,A,w,N,p,B,X){let W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,D=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,i=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const k=this._gl,Q=this.createRawCubeTexture(null,A,w,N,!p,i,D,null);null===t||void 0===t||t.addPendingData(Q),Q.url=d,Q.isReady=!1,this._internalTexturesCache.push(Q);const P=d=>{const A=Q.width,p=B(d);if(p){if(X){const d=this._getWebGLTextureType(N);let t=this._getInternalFormat(w);const B=this._getRGBABufferInternalSizedFormat(N);let W=!1;t===k.RGB&&(t=k.RGBA,W=!0),this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,Q,!0),this._unpackFlipY(!1);const a=X(p);for(let w=0;w<a.length;w++){const p=A>>w;for(let A=0;A<6;A++){let X=a[w][A];W&&(X=b(X,p,p,N)),k.texImage2D(A,w,B,p,p,0,t,d,X)}}this._bindTextureDirectly(k.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(Q,p,w,N,i);Q.isReady=!0,null===t||void 0===t||t.removePendingData(Q),Q.onLoadedObservable.notifyObservers(Q),Q.onLoadedObservable.clear(),W&&W()}};return this._loadFile(d,(d=>{P(d)}),void 0,null===t||void 0===t?void 0:t.offlineProvider,!0,((d,A)=>{null===t||void 0===t||t.removePendingData(Q),a&&d&&a(d.status+" "+d.statusText,A)})),Q},p.ThinEngine.prototype.createRawTexture2DArray=Q(!1),p.ThinEngine.prototype.createRawTexture3D=Q(!0),p.ThinEngine.prototype.updateRawTexture2DArray=P(!1),p.ThinEngine.prototype.updateRawTexture3D=P(!0);var J=A(10807);p.ThinEngine.prototype._readTexturePixelsSync=function(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const D=this._gl;if(!D)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const d=D.createFramebuffer();if(!d)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=d}var i,k;(D.bindFramebuffer(D.FRAMEBUFFER,this._dummyFramebuffer),w>-1)?D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_CUBE_MAP_POSITIVE_X+w,null===(i=d._hardwareTexture)||void 0===i?void 0:i.underlyingResource,N):D.framebufferTexture2D(D.FRAMEBUFFER,D.COLOR_ATTACHMENT0,D.TEXTURE_2D,null===(k=d._hardwareTexture)||void 0===k?void 0:k.underlyingResource,N);let b=void 0!==d.type?this._getWebGLTextureType(d.type):D.UNSIGNED_BYTE;if(X)p||(p=(0,J.j)(d.type,4*t*A));else if(b===D.UNSIGNED_BYTE)p||(p=new Uint8Array(4*t*A)),b=D.UNSIGNED_BYTE;else p||(p=new Float32Array(4*t*A)),b=D.FLOAT;return B&&this.flushFramebuffer(),D.readPixels(W,a,t,A,D.RGBA,b,p),D.bindFramebuffer(D.FRAMEBUFFER,this._currentFramebuffer),p},p.ThinEngine.prototype._readTexturePixels=function(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],X=arguments.length>7&&void 0!==arguments[7]&&arguments[7],W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(d,t,A,w,N,p,B,X,W,a))};A(11471);p.ThinEngine.prototype._createDepthStencilCubeTexture=function(d,t){const A=new w.c(this,12);if(A.isCube=!0,1===this.webGLVersion)return D.e.Error("Depth cube texture is not supported by WebGL 1."),A;const N={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...t},p=this._gl;this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,A,!0),this._setupDepthStencilTexture(A,d,N.bilinearFiltering,N.comparisonFunction);for(let w=0;w<6;w++)N.generateStencil?p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+w,0,p.DEPTH24_STENCIL8,d,d,0,p.DEPTH_STENCIL,p.UNSIGNED_INT_24_8,null):p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+w,0,p.DEPTH_COMPONENT24,d,d,0,p.DEPTH_COMPONENT,p.UNSIGNED_INT,null);return this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(A),A},p.ThinEngine.prototype._setCubeMapTextureParams=function(d,t,A){const w=this._gl;w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MAG_FILTER,w.LINEAR),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MIN_FILTER,t?w.LINEAR_MIPMAP_LINEAR:w.LINEAR),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_WRAP_S,w.CLAMP_TO_EDGE),w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_WRAP_T,w.CLAMP_TO_EDGE),d.samplingMode=t?3:2,t&&this.getCaps().textureMaxLevel&&void 0!==A&&A>0&&(w.texParameteri(w.TEXTURE_CUBE_MAP,w.TEXTURE_MAX_LEVEL,A),d._maxLodLevel=A),this._bindTextureDirectly(w.TEXTURE_CUBE_MAP,null)},p.ThinEngine.prototype.createCubeTexture=function(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8],a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,Q=arguments.length>13&&void 0!==arguments[13]&&arguments[13],P=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const J=this._gl;return this.createCubeTextureBase(d,t,A,!!w,N,p,B,X,W,a,i,b,(d=>this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,d,!0)),((d,t)=>{const A=this.needPOTTextures?(0,k.g)(t[0].width,this._caps.maxCubemapTextureSize):t[0].width,p=A,X=[J.TEXTURE_CUBE_MAP_POSITIVE_X,J.TEXTURE_CUBE_MAP_POSITIVE_Y,J.TEXTURE_CUBE_MAP_POSITIVE_Z,J.TEXTURE_CUBE_MAP_NEGATIVE_X,J.TEXTURE_CUBE_MAP_NEGATIVE_Y,J.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(J.TEXTURE_CUBE_MAP,d,!0),this._unpackFlipY(!1);const W=B?this._getInternalFormat(B,d._useSRGBBuffer):d._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:J.RGBA;let a=B?this._getInternalFormat(B):J.RGBA;d._useSRGBBuffer&&1===this.webGLVersion&&(a=W);for(let w=0;w<X.length;w++)if(t[w].width!==A||t[w].height!==p){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void D.e.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=A,this._workingCanvas.height=p,this._workingContext.drawImage(t[w],0,0,t[w].width,t[w].height,0,0,A,p),J.texImage2D(X[w],0,W,a,J.UNSIGNED_BYTE,this._workingCanvas)}else J.texImage2D(X[w],0,W,a,J.UNSIGNED_BYTE,t[w]);w||J.generateMipmap(J.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(d,!w),d.width=A,d.height=p,d.isReady=!0,B&&(d.format=B),d.onLoadedObservable.notifyObservers(d),d.onLoadedObservable.clear(),N&&N()}),!!Q,P)},p.ThinEngine.prototype.generateMipMapsForCubemap=function(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(d.generateMipMaps){const A=this._gl;this._bindTextureDirectly(A.TEXTURE_CUBE_MAP,d,!0),A.generateMipmap(A.TEXTURE_CUBE_MAP),t&&this._bindTextureDirectly(A.TEXTURE_CUBE_MAP,null)}};A(11519);p.ThinEngine.prototype.setDepthStencilTexture=function(d,t,A,w){void 0!==d&&(t&&(this._boundUniforms[d]=t),A&&A.depthStencilTexture?this._setTexture(d,A,!1,!0,w):this._setTexture(d,null,void 0,void 0,w))},p.ThinEngine.prototype.createRenderTargetCubeTexture=function(d,t){const A=this._createHardwareRenderTargetWrapper(!1,!0,d),N={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...t};N.generateStencilBuffer=N.generateDepthBuffer&&N.generateStencilBuffer,(1!==N.type||this._caps.textureFloatLinearFiltering)&&(2!==N.type||this._caps.textureHalfFloatLinearFiltering)||(N.samplingMode=1);const p=this._gl,B=new w.c(this,5);this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,B,!0);const X=this._getSamplingParameters(N.samplingMode,N.generateMipMaps);1!==N.type||this._caps.textureFloat||(N.type=0,D.e.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_MAG_FILTER,X.mag),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_MIN_FILTER,X.min),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_CUBE_MAP,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE);for(let w=0;w<6;w++)p.texImage2D(p.TEXTURE_CUBE_MAP_POSITIVE_X+w,0,this._getRGBABufferInternalSizedFormat(N.type,N.format),d,d,0,this._getInternalFormat(N.format),this._getWebGLTextureType(N.type),null);const W=p.createFramebuffer();return this._bindUnboundFramebuffer(W),A._depthStencilBuffer=this._setupFramebufferDepthAttachments(N.generateStencilBuffer,N.generateDepthBuffer,d,d),N.generateMipMaps&&p.generateMipmap(p.TEXTURE_CUBE_MAP),this._bindTextureDirectly(p.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),A._framebuffer=W,A._generateDepthBuffer=N.generateDepthBuffer,A._generateStencilBuffer=N.generateStencilBuffer,B.width=d,B.height=d,B.isReady=!0,B.isCube=!0,B.samples=1,B.generateMipMaps=N.generateMipMaps,B.samplingMode=N.samplingMode,B.type=N.type,B.format=N.format,this._internalTexturesCache.push(B),A.setTextures(B),A};var U=A(11541),T=A(11266),F=A(11560);p.ThinEngine.prototype.createPrefilteredCubeTexture=function(d,t,A,N){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6?arguments[6]:void 0,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(d,t,null,!1,(d=>{if(!d)return void(p&&p(null));const B=d.texture;if(a?d.info.sphericalPolynomial&&(B._sphericalPolynomial=d.info.sphericalPolynomial):B._sphericalPolynomial=new U.f,B._source=9,this.getCaps().textureLOD)return void(p&&p(B));const X=this._gl,W=d.width;if(!W)return;const i=[];for(let p=0;p<3;p++){const a=1-p/2,k=N,b=Math.log2(W)*A+N,Q=k+(b-k)*a,P=Math.round(Math.min(Math.max(Q,0),b)),J=new w.c(this,2);if(J.type=B.type,J.format=B.format,J.width=Math.pow(2,Math.max(Math.log2(W)-P,0)),J.height=J.width,J.isCube=!0,J._cachedWrapU=0,J._cachedWrapV=0,this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,J,!0),J.samplingMode=2,X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MAG_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_MIN_FILTER,X.LINEAR),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(X.TEXTURE_CUBE_MAP,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),d.isDDS){const t=d.info,A=d.data;this._unpackFlipY(t.isCompressed),F.d.UploadDDSLevels(this,J,A,t,!0,6,P)}else D.e.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(X.TEXTURE_CUBE_MAP,null);const U=new T.e(t);U._isCube=!0,U._texture=J,J.isReady=!0,i.push(U)}B._lodTextureHigh=i[2],B._lodTextureMid=i[1],B._lodTextureLow=i[0],p&&p(B)}),B,X,W,a,A,N)},p.ThinEngine.prototype.createUniformBuffer=function(d,t){const A=this._gl.createBuffer();if(!A)throw new Error("Unable to create uniform buffer");const w=new a.b(A);return this.bindUniformBuffer(w),d instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,d,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(d),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),w.references=1,w},p.ThinEngine.prototype.createDynamicUniformBuffer=function(d,t){const A=this._gl.createBuffer();if(!A)throw new Error("Unable to create dynamic uniform buffer");const w=new a.b(A);return this.bindUniformBuffer(w),d instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,d,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(d),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),w.references=1,w},p.ThinEngine.prototype.updateUniformBuffer=function(d,t,A,w){this.bindUniformBuffer(d),void 0===A&&(A=0),void 0===w?t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,A,t):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,A,new Float32Array(t)):t instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,t.subarray(A,A+w)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(t).subarray(A,A+w)),this.bindUniformBuffer(null)},p.ThinEngine.prototype.bindUniformBuffer=function(d){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,d?d.underlyingResource:null)},p.ThinEngine.prototype.bindUniformBufferBase=function(d,t,A){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,t,d?d.underlyingResource:null)},p.ThinEngine.prototype.bindUniformBlock=function(d,t,A){const w=d.program,N=this._gl.getUniformBlockIndex(w,t);4294967295!==N&&this._gl.uniformBlockBinding(w,N,A)};var q=A(10737),H=A(10824);H.c.prototype.displayLoadingUI=function(){if(!(0,q.l)())return;const d=this.loadingScreen;d&&d.displayLoadingUI()},H.c.prototype.hideLoadingUI=function(){if(!(0,q.l)())return;const d=this._loadingScreen;d&&d.hideLoadingUI()},Object.defineProperty(H.c.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=H.c.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(d){this._loadingScreen=d},enumerable:!0,configurable:!0}),Object.defineProperty(H.c.prototype,"loadingUIText",{set:function(d){this.loadingScreen.loadingUIText=d},enumerable:!0,configurable:!0}),Object.defineProperty(H.c.prototype,"loadingUIBackgroundColor",{set:function(d){this.loadingScreen.loadingUIBackgroundColor=d},enumerable:!0,configurable:!0}),H.c.prototype.getInputElement=function(){return this._renderingCanvas},H.c.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},H.c.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},H.c.prototype.getAspectRatio=function(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const A=d.viewport;return this.getRenderWidth(t)*A.width/(this.getRenderHeight(t)*A.height)},H.c.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},H.c.prototype._verifyPointerLock=function(){var d;null===(d=this._onPointerLockChange)||void 0===d||d.call(this)},H.c.prototype.setAlphaEquation=function(d){if(this._alphaEquation!==d){switch(d){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=d}},H.c.prototype.getInputElement=function(){return this._renderingCanvas},H.c.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},H.c.prototype.setDepthFunction=function(d){this._depthCullingState.depthFunc=d},H.c.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},H.c.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},H.c.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},H.c.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},H.c.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},H.c.prototype.setDepthWrite=function(d){this._depthCullingState.depthMask=d},H.c.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},H.c.prototype.setStencilBuffer=function(d){this._stencilState.stencilTest=d},H.c.prototype.getStencilMask=function(){return this._stencilState.stencilMask},H.c.prototype.setStencilMask=function(d){this._stencilState.stencilMask=d},H.c.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},H.c.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},H.c.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},H.c.prototype.setStencilFunction=function(d){this._stencilState.stencilFunc=d},H.c.prototype.setStencilFunctionReference=function(d){this._stencilState.stencilFuncRef=d},H.c.prototype.setStencilFunctionMask=function(d){this._stencilState.stencilFuncMask=d},H.c.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},H.c.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},H.c.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},H.c.prototype.setStencilOperationFail=function(d){this._stencilState.stencilOpStencilFail=d},H.c.prototype.setStencilOperationDepthFail=function(d){this._stencilState.stencilOpDepthFail=d},H.c.prototype.setStencilOperationPass=function(d){this._stencilState.stencilOpStencilDepthPass=d},H.c.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},H.c.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},H.c.prototype.setAlphaConstants=function(d,t,A,w){this._alphaState.setAlphaBlendConstants(d,t,A,w)},H.c.prototype.getAlphaMode=function(){return this._alphaMode},H.c.prototype.getAlphaEquation=function(){return this._alphaEquation},H.c.prototype.getRenderPassNames=function(){return this._renderPassNames},H.c.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},H.c.prototype.createRenderPassId=function(d){const t=++H.c._RenderPassIdCounter;return this._renderPassNames[t]=d??"NONAME",t},H.c.prototype.releaseRenderPassId=function(d){this._renderPassNames[d]=void 0;for(let t=0;t<this.scenes.length;++t){const A=this.scenes[t];for(let t=0;t<A.meshes.length;++t){const w=A.meshes[t];if(w.If)for(let t=0;t<w.If.length;++t){w.If[t]._removeDrawWrapper(d)}}}};A(11535);function f(d){if(d.requestPointerLock){const t=d.requestPointerLock();t instanceof Promise?t.then((()=>{d.focus()})).catch((()=>{})):d.focus()}}var v=A(10901);A(11616);class m extends p.ThinEngine{static get NpmPackage(){return H.c.NpmPackage}static get Version(){return H.c.Version}static get Instances(){return N.e.Instances}static get LastCreatedEngine(){return N.e.LastCreatedEngine}static get LastCreatedScene(){return N.e.LastCreatedScene}static DefaultLoadingScreenFactory(d){return H.c.DefaultLoadingScreenFactory(d)}get _supportsHardwareTextureRescaling(){return!!m._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(d,t,A){if(super(d,t,A,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new X,this._drawCalls=new v.d,d&&(this._features.supportRenderPasses=!0,A=this._creationOptions,d.getContext)){const t=d;this._sharedInit(t)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(d){super._sharedInit(d),function(d,t,A){d._onCanvasFocus=()=>{d.onCanvasFocusObservable.notifyObservers(d)},d._onCanvasBlur=()=>{d.onCanvasBlurObservable.notifyObservers(d)},d._onCanvasContextMenu=t=>{d.disableContextMenu&&t.preventDefault()},t.addEventListener("focus",d._onCanvasFocus),t.addEventListener("blur",d._onCanvasBlur),t.addEventListener("contextmenu",d._onCanvasContextMenu),d._onBlur=()=>{d.disablePerformanceMonitorInBackground&&d.performanceMonitor.disable(),d._windowIsBackground=!0},d._onFocus=()=>{d.disablePerformanceMonitorInBackground&&d.performanceMonitor.enable(),d._windowIsBackground=!1},d._onCanvasPointerOut=A=>{document.elementFromPoint(A.clientX,A.clientY)!==t&&d.onCanvasPointerOutObservable.notifyObservers(A)};const w=d.getHostWindow();w&&"function"===typeof w.addEventListener&&(w.addEventListener("blur",d._onBlur),w.addEventListener("focus",d._onFocus)),t.addEventListener("pointerout",d._onCanvasPointerOut),A.doNotHandleTouchAction||function(d){d&&d.setAttribute&&(d.setAttribute("touch-action","none"),d.style.touchAction="none",d.style.webkitTapHighlightColor="transparent")}(t),!H.c.audioEngine&&A.audioEngine&&H.c.AudioEngineFactory&&(H.c.audioEngine=H.c.AudioEngineFactory(d.getRenderingCanvas(),d.getAudioContext(),d.getAudioDestination())),(0,q.f)()&&(d._onFullscreenChange=()=>{d.isFullscreen=!!document.fullscreenElement,d.isFullscreen&&d._pointerLockRequested&&t&&f(t)},document.addEventListener("fullscreenchange",d._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",d._onFullscreenChange,!1),d._onPointerLockChange=()=>{d.isPointerLock=document.pointerLockElement===t},document.addEventListener("pointerlockchange",d._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",d._onPointerLockChange,!1)),d.enableOfflineSupport=void 0!==H.c.OfflineProviderFactory,d._deterministicLockstep=!!A.deterministicLockstep,d._lockstepMaxSteps=A.lockstepMaxSteps||0,d._timeStep=A.timeStep||1/60}(this,d,this._creationOptions)}resizeImageBitmap(d,t,A){return function(d,t,A,w){const N=d.createCanvas(A,w).getContext("2d");if(!N)throw new Error("Unable to get 2d context for resizeImageBitmap");return N.drawImage(t,0,0),N.getImageData(0,0,A,w).data}(this,d,t,A)}_createImageBitmapFromSource(d,t){return function(d,t,A){return new Promise(((w,N)=>{const p=new Image;p.onload=()=>{p.decode().then((()=>{d.createImageBitmap(p,A).then((d=>{w(d)}))}))},p.onerror=()=>{N(`Error loading image ${p.src}`)},p.src=t}))}(this,d,t)}switchFullscreen(d){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(d)}enterFullscreen(d){this.isFullscreen||(this._pointerLockRequested=d,this._renderingCanvas&&function(d){const t=d.requestFullscreen||d.webkitRequestFullscreen;t&&t.call(d)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const d=document;document.exitFullscreen?document.exitFullscreen():d.webkitCancelFullScreen&&d.webkitCancelFullScreen()}()}setDitheringState(d){d?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(d){d?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(d,t,A,w){const N=this._cachedViewport;return this._cachedViewport=null,this._viewport(d,t,A,w),N}scissorClear(d,t,A,w,N){this.enableScissor(d,t,A,w),this.clear(N,!0,!0,!0),this.disableScissor()}enableScissor(d,t,A,w){const N=this._gl;N.enable(N.SCISSOR_TEST),N.scissor(d,t,A,w)}disableScissor(){const d=this._gl;d.disable(d.SCISSOR_TEST)}_loadFileAsync(d,t,A){return new Promise(((w,N)=>{this._loadFile(d,(d=>{w(d)}),void 0,t,A,((d,t)=>{N(t)}))}))}getVertexShaderSource(d){const t=this._gl.getAttachedShaders(d);return t?this._gl.getShaderSource(t[0]):null}getFragmentShaderSource(d){const t=this._gl.getAttachedShaders(d);return t?this._gl.getShaderSource(t[1]):null}set framebufferDimensionsObject(d){this._framebufferDimensionsObject=d,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const d of this.scenes)d.resetCachedMaterial(),d._rebuildGeometries();for(const d of this._virtualScenes)d.resetCachedMaterial(),d._rebuildGeometries();super._rebuildBuffers()}getFontOffset(d){return function(d){const t=document.createElement("span");t.textContent="Hg",t.style.font=d;const A=document.createElement("div");A.style.display="inline-block",A.style.width="1px",A.style.height="0px",A.style.verticalAlign="bottom";const w=document.createElement("div");w.style.whiteSpace="nowrap",w.appendChild(t),w.appendChild(A),document.body.appendChild(w);let N=0,p=0;try{p=A.getBoundingClientRect().top-t.getBoundingClientRect().top,A.style.verticalAlign="baseline",N=A.getBoundingClientRect().top-t.getBoundingClientRect().top}finally{document.body.removeChild(w)}return{ascent:N,height:p,descent:p-N}}(d)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:d}=this.customAnimationFrameRequester;d&&d(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let d=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(d=!1),d&&(this.cj(),this._renderViews()||this._renderFrame(),this.dj())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&f(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}cj(){this._measureFps(),super.cj()}_deletePipelineContext(d){const t=d;t&&t.program&&t.transformFeedback&&(this.deleteTransformFeedback(t.transformFeedback),t.transformFeedback=null),super._deletePipelineContext(d)}createShaderProgram(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;N=N||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const B=super.createShaderProgram(d,t,A,w,N,p);return this.onAfterShaderCompilationObservable.notifyObservers(this),B}_createShaderProgram(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const p=w.createProgram();if(d.program=p,!p)throw new Error("Unable to create program");if(w.attachShader(p,t),w.attachShader(p,A),this.webGLVersion>1&&N){const t=this.createTransformFeedback();this.bindTransformFeedback(t),this.setTranformFeedbackVaryings(p,N),d.transformFeedback=t}return w.linkProgram(p),this.webGLVersion>1&&N&&this.bindTransformFeedback(null),d.context=w,d.vertexShader=t,d.fragmentShader=A,d.isParallelCompiled||this._finalizePipelineContext(d),p}_releaseTexture(d){super._releaseTexture(d)}_releaseRenderTargetWrapper(d){super._releaseRenderTargetWrapper(d),this.scenes.forEach((t=>{t.postProcesses.forEach((t=>{t._outputTexture===d&&(t._outputTexture=null)})),t.cameras.forEach((t=>{t._postProcesses.forEach((t=>{t&&t._outputTexture===d&&(t._outputTexture=null)}))}))}))}_rescaleTexture(d,t,A,w,N){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const p=this.createRenderTargetTexture({width:t.width,height:t.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&m._RescalePostProcessFactory&&(this._rescalePostProcess=m._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const B=()=>{this._rescalePostProcess.onApply=function(t){t._bindTexture("textureSampler",d)};let B=A;B||(B=this.scenes[this.scenes.length-1]),B.postProcessManager.directRender([this._rescalePostProcess],p,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,t,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,w,0,0,t.width,t.height,0),this.unBindFramebuffer(p),p.dispose(),N&&N()},X=this._rescalePostProcess.getEffect();X?X.executeWhenCompiled(B):this._rescalePostProcess.onEffectCreatedObservable.addOnce((d=>{d.executeWhenCompiled(B)}))}}wrapWebGLTexture(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const B=new i.e(d,this._gl),X=new w.c(this,0,!0);return X._hardwareTexture=B,X.baseWidth=N,X.baseHeight=p,X.width=N,X.height=p,X.isReady=!0,X.useMipMaps=t,this.updateTextureSamplingMode(A,X),X}_uploadImageToTexture(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=this._gl,p=this._getWebGLTextureType(d.type),B=this._getInternalFormat(d.format),X=this._getRGBABufferInternalSizedFormat(d.type,B),W=d.isCube?N.TEXTURE_CUBE_MAP:N.TEXTURE_2D;this._bindTextureDirectly(W,d,!0),this._unpackFlipY(d.invertY);let a=N.TEXTURE_2D;d.isCube&&(a=N.TEXTURE_CUBE_MAP_POSITIVE_X+A),N.texImage2D(a,w,X,B,p,t),this._bindTextureDirectly(W,null,!0)}updateTextureComparisonFunction(d,t){if(1===this.webGLVersion)return void D.e.Error("WebGL 1 does not support texture comparison.");const A=this._gl;d.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,d,!0),0===t?(A.texParameteri(A.TEXTURE_CUBE_MAP,A.TEXTURE_COMPARE_FUNC,515),A.texParameteri(A.TEXTURE_CUBE_MAP,A.TEXTURE_COMPARE_MODE,A.NONE)):(A.texParameteri(A.TEXTURE_CUBE_MAP,A.TEXTURE_COMPARE_FUNC,t),A.texParameteri(A.TEXTURE_CUBE_MAP,A.TEXTURE_COMPARE_MODE,A.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,d,!0),0===t?(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_FUNC,515),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.NONE)):(A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_FUNC,t),A.texParameteri(A.TEXTURE_2D,A.TEXTURE_COMPARE_MODE,A.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),d._comparisonFunction=t}createInstancesBuffer(d){const t=this._gl.createBuffer();if(!t)throw new Error("Unable to create instance buffer");const A=new a.b(t);return A.Yc=d,this.bindArrayBuffer(A),this._gl.bufferData(this._gl.ARRAY_BUFFER,d,this._gl.DYNAMIC_DRAW),A.references=1,A}deleteInstancesBuffer(d){this._gl.deleteBuffer(d)}_clientWaitAsync(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const w=this._gl;return new Promise(((N,p)=>{const B=()=>{const X=w.clientWaitSync(d,t,0);X!=w.WAIT_FAILED?X!=w.TIMEOUT_EXPIRED?N():setTimeout(B,A):p()};B()}))}_readPixelsAsync(d,t,A,w,N,p,B){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const X=this._gl,W=X.createBuffer();X.bindBuffer(X.PIXEL_PACK_BUFFER,W),X.bufferData(X.PIXEL_PACK_BUFFER,B.byteLength,X.STREAM_READ),X.readPixels(d,t,A,w,N,p,0),X.bindBuffer(X.PIXEL_PACK_BUFFER,null);const a=X.fenceSync(X.SYNC_GPU_COMMANDS_COMPLETE,0);return a?(X.flush(),this._clientWaitAsync(a,0,10).then((()=>(X.deleteSync(a),X.bindBuffer(X.PIXEL_PACK_BUFFER,W),X.getBufferSubData(X.PIXEL_PACK_BUFFER,0,B),X.bindBuffer(X.PIXEL_PACK_BUFFER,null),X.deleteBuffer(W),B)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(d,t){1===N.e.Instances.length&&H.c.audioEngine&&(H.c.audioEngine.dispose(),H.c.audioEngine=null);const A=d.getHostWindow();A&&"function"===typeof A.removeEventListener&&(A.removeEventListener("blur",d._onBlur),A.removeEventListener("focus",d._onFocus)),t&&(t.removeEventListener("focus",d._onCanvasFocus),t.removeEventListener("blur",d._onCanvasBlur),t.removeEventListener("pointerout",d._onCanvasPointerOut),t.removeEventListener("contextmenu",d._onCanvasContextMenu)),(0,q.f)()&&(document.removeEventListener("fullscreenchange",d._onFullscreenChange),document.removeEventListener("mozfullscreenchange",d._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",d._onFullscreenChange),document.removeEventListener("msfullscreenchange",d._onFullscreenChange),document.removeEventListener("pointerlockchange",d._onPointerLockChange),document.removeEventListener("mspointerlockchange",d._onPointerLockChange),document.removeEventListener("mozpointerlockchange",d._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",d._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}m.ALPHA_DISABLE=0,m.ALPHA_ADD=1,m.ALPHA_COMBINE=2,m.ALPHA_SUBTRACT=3,m.ALPHA_MULTIPLY=4,m.ALPHA_MAXIMIZED=5,m.ALPHA_ONEONE=6,m.ALPHA_PREMULTIPLIED=7,m.ALPHA_PREMULTIPLIED_PORTERDUFF=8,m.ALPHA_INTERPOLATE=9,m.ALPHA_SCREENMODE=10,m.DELAYLOADSTATE_NONE=0,m.DELAYLOADSTATE_LOADED=1,m.DELAYLOADSTATE_LOADING=2,m.DELAYLOADSTATE_NOTLOADED=4,m.NEVER=512,m.ALWAYS=519,m.LESS=513,m.EQUAL=514,m.LEQUAL=515,m.GREATER=516,m.GEQUAL=518,m.NOTEQUAL=517,m.KEEP=7680,m.REPLACE=7681,m.INCR=7682,m.DECR=7683,m.INVERT=5386,m.INCR_WRAP=34055,m.DECR_WRAP=34056,m.TEXTURE_CLAMP_ADDRESSMODE=0,m.TEXTURE_WRAP_ADDRESSMODE=1,m.TEXTURE_MIRROR_ADDRESSMODE=2,m.TEXTUREFORMAT_ALPHA=0,m.TEXTUREFORMAT_LUMINANCE=1,m.TEXTUREFORMAT_LUMINANCE_ALPHA=2,m.TEXTUREFORMAT_RGB=4,m.TEXTUREFORMAT_RGBA=5,m.TEXTUREFORMAT_RED=6,m.TEXTUREFORMAT_R=6,m.TEXTUREFORMAT_RG=7,m.TEXTUREFORMAT_RED_INTEGER=8,m.TEXTUREFORMAT_R_INTEGER=8,m.TEXTUREFORMAT_RG_INTEGER=9,m.TEXTUREFORMAT_RGB_INTEGER=10,m.TEXTUREFORMAT_RGBA_INTEGER=11,m.TEXTURETYPE_UNSIGNED_BYTE=0,m.TEXTURETYPE_UNSIGNED_INT=0,m.TEXTURETYPE_FLOAT=1,m.TEXTURETYPE_HALF_FLOAT=2,m.TEXTURETYPE_BYTE=3,m.TEXTURETYPE_SHORT=4,m.TEXTURETYPE_UNSIGNED_SHORT=5,m.TEXTURETYPE_INT=6,m.TEXTURETYPE_UNSIGNED_INTEGER=7,m.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,m.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,m.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,m.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,m.TEXTURETYPE_UNSIGNED_INT_24_8=12,m.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,m.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,m.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,m.TEXTURE_NEAREST_SAMPLINGMODE=1,m.TEXTURE_BILINEAR_SAMPLINGMODE=2,m.TEXTURE_TRILINEAR_SAMPLINGMODE=3,m.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,m.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,m.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,m.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,m.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,m.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,m.TEXTURE_NEAREST_LINEAR=7,m.TEXTURE_NEAREST_NEAREST=1,m.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,m.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,m.TEXTURE_LINEAR_LINEAR=2,m.TEXTURE_LINEAR_NEAREST=12,m.TEXTURE_EXPLICIT_MODE=0,m.TEXTURE_SPHERICAL_MODE=1,m.TEXTURE_PLANAR_MODE=2,m.TEXTURE_CUBIC_MODE=3,m.TEXTURE_PROJECTION_MODE=4,m.TEXTURE_SKYBOX_MODE=5,m.TEXTURE_INVCUBIC_MODE=6,m.TEXTURE_EQUIRECTANGULAR_MODE=7,m.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,m.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,m.SCALEMODE_FLOOR=1,m.SCALEMODE_NEAREST=2,m.SCALEMODE_CEILING=3},10775:(d,t,A)=>{"use strict";A.d(t,{e:()=>N});var w=A(10730);class N{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}N.Instances=[],N.OnEnginesDisposedObservable=new w.b,N._LastCreatedScene=null,N.UseFallbackTexture=!0,N.FallbackTexture=""},12548:(d,t,A)=>{"use strict";A(10740);var w=A(11515);A(10861),A(11128),A(10856),A(11526),A(11484);w.c},10856:(d,t,A)=>{"use strict";A.d(t,{c:()=>w});class w{static SetMatrixPrecision(d){if(w.MatrixTrackPrecisionChange=!1,d&&!w.MatrixUse64Bits&&w.MatrixTrackedMatrices)for(let t=0;t<w.MatrixTrackedMatrices.length;++t){const d=w.MatrixTrackedMatrices[t],A=d.Oj;d.Oj=new Array(16);for(let t=0;t<16;++t)d.Oj[t]=A[t]}w.MatrixUse64Bits=d,w.MatrixCurrentType=w.MatrixUse64Bits?Array:Float32Array,w.MatrixTrackedMatrices=null}}w.MatrixUse64Bits=!1,w.MatrixTrackPrecisionChange=!0,w.MatrixCurrentType=Float32Array,w.MatrixTrackedMatrices=[]},11526:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});class w{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var d;return(null===(d=this._textures)||void 0===d?void 0:d[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(d){var t,A;if(!this._textures)return-1;const w=this._textures[d],N=(null===(t=this._layerIndices)||void 0===t?void 0:t[d])??0,p=(null===(A=this._faceIndices)||void 0===A?void 0:A[d])??0;return w.isCube?6*N+p:w.is3D?0:N}get samples(){return this._samples}setSamples(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===d&&!A)return d;const w=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,d,t):this._engine.updateRenderTargetTextureSampleCount(this,d);return this._samples=d,w}constructor(d,t,A,w,N){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=d,this._isCube=t,this._size=A,this._engine=w,this._depthStencilTexture=null,this.label=N}setTextures(d){Array.isArray(d)?this._textures=d:this._textures=d?[d]:null}setTexture(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[t]!==d&&(this._textures[t]&&A&&this._textures[t].dispose(),this._textures[t]=d)}setLayerAndFaceIndices(d,t){this._layerIndices=d,this._faceIndices=t}setLayerAndFaceIndex(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==t&&t>=0&&(this._layerIndices[d]=t),void 0!==A&&A>=0&&(this._faceIndices[d]=A)}createDepthStencilTexture(){var d;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,B=arguments.length>5?arguments[5]:void 0;return null===(d=this._depthStencilTexture)||void 0===d||d.dispose(),this._depthStencilTextureWithStencil=w,this._depthStencilTextureLabel=B,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:A,comparisonFunction:t,generateStencil:w,isCube:this._isCube,samples:N,depthTextureFormat:p,label:B},this),this._depthStencilTexture}_shareDepth(d){this.shareDepth(d)}shareDepth(d){this._depthStencilTexture&&(d._depthStencilTexture&&d._depthStencilTexture.dispose(),d._depthStencilTexture=this._depthStencilTexture,d._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(d){this.texture&&this.texture._swapAndDie(d),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let d=null;if(this._isMulti){const t=this.textures;if(t&&t.length>0){let A=!1,w=t.length,N=-1;const p=t[t.length-1]._source;14!==p&&12!==p||(A=!0,N=t[t.length-1].format,w--);const B=[],X=[],W=[],a=[],D=[],i=[],k=[],b={};for(let d=0;d<w;++d){const A=t[d];B.push(A.samplingMode),X.push(A.type),W.push(A.format);void 0!==b[A.uniqueId]?(a.push(-1),k.push(0)):(b[A.uniqueId]=d,A.is2DArray?(a.push(35866),k.push(A.depth)):A.isCube?(a.push(34067),k.push(0)):A.is3D?(a.push(32879),k.push(A.depth)):(a.push(3553),k.push(0))),this._faceIndices&&D.push(this._faceIndices[d]??0),this._layerIndices&&i.push(this._layerIndices[d]??0)}const Q={samplingModes:B,generateMipMaps:t[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:A,depthTextureFormat:N,types:X,formats:W,textureCount:w,targetTypes:a,faceIndex:D,layerIndex:i,layerCounts:k,label:this.label},P={width:this.width,height:this.height,depth:this.depth};d=this._engine.createMultipleRenderTarget(P,Q);for(let J=0;J<w;++J){if(-1!==a[J])continue;const A=b[t[J].uniqueId];d.setTexture(d.textures[A],J)}}}else{var t,A,w,N;const B={};if(B.generateDepthBuffer=this._generateDepthBuffer,B.generateMipMaps=(null===(t=this.texture)||void 0===t?void 0:t.generateMipMaps)??!1,B.generateStencilBuffer=this._generateStencilBuffer,B.samplingMode=null===(A=this.texture)||void 0===A?void 0:A.samplingMode,B.type=null===(w=this.texture)||void 0===w?void 0:w.type,B.format=null===(N=this.texture)||void 0===N?void 0:N.format,B.noColorAttachment=!this._textures,B.label=this.label,this.isCube)d=this._engine.createRenderTargetCubeTexture(this.width,B);else{var p;const t={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(p=this.texture)||void 0===p?void 0:p.depth:void 0};d=this._engine.createRenderTargetTexture(t,B)}d.texture&&(d.texture.isReady=!0)}return d}_swapRenderTargetWrapper(d){if(this._textures&&d._textures)for(let t=0;t<this._textures.length;++t)this._textures[t]._swapAndDie(d._textures[t],!1),d._textures[t].isReady=!0;this._depthStencilTexture&&d._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(d._depthStencilTexture),d._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const d=this._cloneRenderTargetWrapper();if(d){if(this._depthStencilTexture){const t=this._depthStencilTexture.samplingMode,A=this._depthStencilTexture.format,w=2===t||3===t||11===t;d.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,w,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,A,this._depthStencilTextureLabel)}this.samples>1&&d.setSamples(this.samples),d._swapRenderTargetWrapper(this),d.dispose()}}releaseTextures(){if(this._textures)for(let t=0;t<(null===(d=this._textures)||void 0===d?void 0:d.length);++t){var d;this._textures[t].dispose()}this._textures=null}dispose(){var d;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(d=this._depthStencilTexture)||void 0===d||d.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10837:(d,t,A)=>{"use strict";A.d(t,{c:()=>w});class w{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?w.ShadersRepository:w.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?w.ShadersStore:w.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?w.IncludesShadersStore:w.IncludesShadersStoreWGSL}}w.ShadersRepository="src/Shaders/",w.ShadersStore={},w.IncludesShadersStore={},w.ShadersRepositoryWGSL="src/ShadersWGSL/",w.ShadersStoreWGSL={},w.IncludesShadersStoreWGSL={}},10851:(d,t,A)=>{"use strict";A.d(t,{c:()=>k,e:()=>T,g:()=>b,j:()=>Q,n:()=>U,o:()=>i,r:()=>a,v:()=>D,y:()=>W,z:()=>X});class w{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.ud._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(d){d&&this.program&&d(this.program)}setEngine(d){this.ud=d}_fillEffectInformation(d,t,A,w,N,p,B,X){const W=this.ud;if(W.supportsUniformBuffers)for(const D in t)d.bindUniformBlock(D,t[D]);let a;for(this.ud.getUniforms(this,A).forEach(((d,t)=>{w[A[t]]=d})),this._uniforms=w,a=0;a<N.length;a++){null==d.getUniform(N[a])&&(N.splice(a,1),a--)}N.forEach(((d,t)=>{p[d]=t}));for(const D of W.getAttributes(this,B))X.push(D)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(d,t){const A=this._valueCache[d],w=t.updateFlag;return(void 0===A||A!==w)&&(this._valueCache[d]=w,!0)}_cacheFloat2(d,t,A){let w=this._valueCache[d];if(!w||2!==w.length)return w=[t,A],this._valueCache[d]=w,!0;let N=!1;return w[0]!==t&&(w[0]=t,N=!0),w[1]!==A&&(w[1]=A,N=!0),N}_cacheFloat3(d,t,A,w){let N=this._valueCache[d];if(!N||3!==N.length)return N=[t,A,w],this._valueCache[d]=N,!0;let p=!1;return N[0]!==t&&(N[0]=t,p=!0),N[1]!==A&&(N[1]=A,p=!0),N[2]!==w&&(N[2]=w,p=!0),p}_cacheFloat4(d,t,A,w,N){let p=this._valueCache[d];if(!p||4!==p.length)return p=[t,A,w,N],this._valueCache[d]=p,!0;let B=!1;return p[0]!==t&&(p[0]=t,B=!0),p[1]!==A&&(p[1]=A,B=!0),p[2]!==w&&(p[2]=w,B=!0),p[3]!==N&&(p[3]=N,B=!0),B}setInt(d,t){const A=this._valueCache[d];void 0!==A&&A===t||this.ud.setInt(this._uniforms[d],t)&&(this._valueCache[d]=t)}setInt2(d,t,A){this._cacheFloat2(d,t,A)&&(this.ud.setInt2(this._uniforms[d],t,A)||(this._valueCache[d]=null))}setInt3(d,t,A,w){this._cacheFloat3(d,t,A,w)&&(this.ud.setInt3(this._uniforms[d],t,A,w)||(this._valueCache[d]=null))}setInt4(d,t,A,w,N){this._cacheFloat4(d,t,A,w,N)&&(this.ud.setInt4(this._uniforms[d],t,A,w,N)||(this._valueCache[d]=null))}setIntArray(d,t){this._valueCache[d]=null,this.ud.setIntArray(this._uniforms[d],t)}setIntArray2(d,t){this._valueCache[d]=null,this.ud.setIntArray2(this._uniforms[d],t)}setIntArray3(d,t){this._valueCache[d]=null,this.ud.setIntArray3(this._uniforms[d],t)}setIntArray4(d,t){this._valueCache[d]=null,this.ud.setIntArray4(this._uniforms[d],t)}setUInt(d,t){const A=this._valueCache[d];void 0!==A&&A===t||this.ud.setUInt(this._uniforms[d],t)&&(this._valueCache[d]=t)}setUInt2(d,t,A){this._cacheFloat2(d,t,A)&&(this.ud.setUInt2(this._uniforms[d],t,A)||(this._valueCache[d]=null))}setUInt3(d,t,A,w){this._cacheFloat3(d,t,A,w)&&(this.ud.setUInt3(this._uniforms[d],t,A,w)||(this._valueCache[d]=null))}setUInt4(d,t,A,w,N){this._cacheFloat4(d,t,A,w,N)&&(this.ud.setUInt4(this._uniforms[d],t,A,w,N)||(this._valueCache[d]=null))}setUIntArray(d,t){this._valueCache[d]=null,this.ud.setUIntArray(this._uniforms[d],t)}setUIntArray2(d,t){this._valueCache[d]=null,this.ud.setUIntArray2(this._uniforms[d],t)}setUIntArray3(d,t){this._valueCache[d]=null,this.ud.setUIntArray3(this._uniforms[d],t)}setUIntArray4(d,t){this._valueCache[d]=null,this.ud.setUIntArray4(this._uniforms[d],t)}setArray(d,t){this._valueCache[d]=null,this.ud.setArray(this._uniforms[d],t)}setArray2(d,t){this._valueCache[d]=null,this.ud.setArray2(this._uniforms[d],t)}setArray3(d,t){this._valueCache[d]=null,this.ud.setArray3(this._uniforms[d],t)}setArray4(d,t){this._valueCache[d]=null,this.ud.setArray4(this._uniforms[d],t)}setMatrices(d,t){t&&(this._valueCache[d]=null,this.ud.setMatrices(this._uniforms[d],t))}setMatrix(d,t){this._cacheMatrix(d,t)&&(this.ud.setMatrices(this._uniforms[d],t.gj())||(this._valueCache[d]=null))}setMatrix3x3(d,t){this._valueCache[d]=null,this.ud.setMatrix3x3(this._uniforms[d],t)}setMatrix2x2(d,t){this._valueCache[d]=null,this.ud.setMatrix2x2(this._uniforms[d],t)}setFloat(d,t){const A=this._valueCache[d];void 0!==A&&A===t||this.ud.setFloat(this._uniforms[d],t)&&(this._valueCache[d]=t)}setVector2(d,t){this._cacheFloat2(d,t.x,t.y)&&(this.ud.setFloat2(this._uniforms[d],t.x,t.y)||(this._valueCache[d]=null))}setFloat2(d,t,A){this._cacheFloat2(d,t,A)&&(this.ud.setFloat2(this._uniforms[d],t,A)||(this._valueCache[d]=null))}setVector3(d,t){this._cacheFloat3(d,t.x,t.y,t.z)&&(this.ud.setFloat3(this._uniforms[d],t.x,t.y,t.z)||(this._valueCache[d]=null))}setFloat3(d,t,A,w){this._cacheFloat3(d,t,A,w)&&(this.ud.setFloat3(this._uniforms[d],t,A,w)||(this._valueCache[d]=null))}setVector4(d,t){this._cacheFloat4(d,t.x,t.y,t.z,t.w)&&(this.ud.setFloat4(this._uniforms[d],t.x,t.y,t.z,t.w)||(this._valueCache[d]=null))}setQuaternion(d,t){this._cacheFloat4(d,t.x,t.y,t.z,t.w)&&(this.ud.setFloat4(this._uniforms[d],t.x,t.y,t.z,t.w)||(this._valueCache[d]=null))}setFloat4(d,t,A,w,N){this._cacheFloat4(d,t,A,w,N)&&(this.ud.setFloat4(this._uniforms[d],t,A,w,N)||(this._valueCache[d]=null))}setColor3(d,t){this._cacheFloat3(d,t.r,t.g,t.b)&&(this.ud.setFloat3(this._uniforms[d],t.r,t.g,t.b)||(this._valueCache[d]=null))}setColor4(d,t,A){this._cacheFloat4(d,t.r,t.g,t.b,A)&&(this.ud.setFloat4(this._uniforms[d],t.r,t.g,t.b,A)||(this._valueCache[d]=null))}setDirectColor4(d,t){this._cacheFloat4(d,t.r,t.g,t.b,t.a)&&(this.ud.setFloat4(this._uniforms[d],t.r,t.g,t.b,t.a)||(this._valueCache[d]=null))}_getVertexShaderCode(){return this.vertexShader?this.ud._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.ud._getShaderSource(this.fragmentShader):null}}var N=A(10807);const p=new WeakMap,B={_webGLVersion:2,cachedPipelines:{}};function X(d){let t=p.get(d);if(!t){if(!d)return B;t={_webGLVersion:d.TEXTURE_BINDING_3D?2:1,_context:d,cachedPipelines:{}},p.set(d,t)}return t}function W(d){p.delete(d)}function a(d,t,A,w,N,p){const B=X(w);p||(p=B._createShaderProgramInjection??k);return p(d,J(t,"vertex",w,B._contextWasLost),J(A,"fragment",w,B._contextWasLost),w,N,B.validateShaderPrograms)}function D(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6?arguments[6]:void 0;const W=X(N);B||(B=W._createShaderProgramInjection??k);const a=W._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return B(d,P(t,"vertex",w,a,N,W._contextWasLost),P(A,"fragment",w,a,N,W._contextWasLost),N,p,W.validateShaderPrograms)}function i(d,t){const A=new w,N=X(d);return N.parallelShaderCompile&&(A.isParallelCompiled=!0),A.context=N._context,A}function k(d,t,A,w){let N=arguments.length>5?arguments[5]:void 0;const p=w.createProgram();if(d.program=p,!p)throw new Error("Unable to create program");return w.attachShader(p,t),w.attachShader(p,A),w.linkProgram(p),d.context=w,d.vertexShader=t,d.fragmentShader=A,d.isParallelCompiled||b(d,w,N),p}function b(d,t,A){const w=d.context,N=d.vertexShader,p=d.fragmentShader,B=d.program;if(!w.getProgramParameter(B,w.LINK_STATUS)){if(!t.getShaderParameter(N,t.COMPILE_STATUS)){const A=t.getShaderInfoLog(N);if(A)throw d.vertexCompilationError=A,new Error("VERTEX SHADER "+A)}if(!t.getShaderParameter(p,t.COMPILE_STATUS)){const A=t.getShaderInfoLog(p);if(A)throw d.fragmentCompilationError=A,new Error("FRAGMENT SHADER "+A)}const A=w.getProgramInfoLog(B);if(A)throw d.programLinkError=A,new Error(A)}if(A){w.validateProgram(B);if(!w.getProgramParameter(B,w.VALIDATE_STATUS)){const t=w.getProgramInfoLog(B);if(t)throw d.programValidationError=t,new Error(t)}}w.deleteShader(N),w.deleteShader(p),d.vertexShader=void 0,d.fragmentShader=void 0,d.onCompiled&&(d.onCompiled(),d.onCompiled=void 0)}function Q(d,t,A,w,N,p,B,W,i){let k=arguments.length>10?arguments[10]:void 0,b=arguments.length>11?arguments[11]:void 0,Q=arguments.length>12?arguments[12]:void 0;const P=X(d.context);b||(b=P.createRawShaderProgramInjection??a),Q||(Q=P.createShaderProgramInjection??D);const J=d;J.program=w?b(J,t,A,J.context,i):Q(J,t,A,W,J.context,i),J.program.__SPECTOR_rebuildProgram=B,k()}function P(d,t,A,w,p,B){return J((0,N.d)(d,A,w),t,p,B)}function J(d,t,A,w){const N=A.createShader("vertex"===t?A.VERTEX_SHADER:A.FRAGMENT_SHADER);if(!N){let d=A.NO_ERROR,N=A.NO_ERROR;for(;(N=A.getError())!==A.NO_ERROR;)d=N;throw new Error(`Something went wrong while creating a gl ${t} shader object. gl error=${d}, gl isContextLost=${A.isContextLost()}, _contextWasLost=${w}`)}return A.shaderSource(N,d),A.compileShader(N),N}function U(d,t){t.useProgram(d)}function T(d,t){const A=d;if(!A.isParallelCompiled)return void t(d);const w=A.onCompiled;A.onCompiled=()=>{null===w||void 0===w||w(),t(d)}}},11476:(d,t,A)=>{"use strict";A.r(t),A.d(t,{ThinEngine:()=>F});var w=A(10851),N=A(11484),p=A(10740),B=A(10737);class X{constructor(){this.shaderLanguage=0}postProcessor(d,t,A,w,N){if(N.drawBuffersExtensionDisabled){const t=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;d=d.replace(t,"")}return d}}const W=/(flat\s)?\s*varying\s*.*/;class a{constructor(){this.shaderLanguage=0}attributeProcessor(d){return d.replace("attribute","in")}varyingCheck(d,t){return W.test(d)}varyingProcessor(d,t){return d.replace("varying",t?"in":"out")}postProcessor(d,t,A){const w=-1!==d.search(/#extension.+GL_EXT_draw_buffers.+require/);if(d=(d=d.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),A){const t=-1!==d.search(/layout *\(location *= *0\) *out/g);d=(d=(d=(d=(d=(d=(d=d.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(w||t?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+d}return d}}var D=A(11488),i=A(10896),k=A(10824),b=A(11496),Q=A(10861),P=A(10829),J=A(10807),U=A(10845);class T{}class F extends k.c{get name(){return this._name}set name(d){this._name=d}get version(){return this._webGLVersion}static get ShadersRepository(){return P.e.ShadersRepository}static set ShadersRepository(d){P.e.ShadersRepository=d}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(d){this._framebufferDimensionsObject=d}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(d,t,A,N){if(A=A||{},super(t??A.antialias,A,N),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!d)return;let B=null;if(d.getContext){if(B=d,this._renderingCanvas=B,void 0===A.hh&&(A.hh=!1),void 0===A.xrCompatible&&(A.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const d=navigator.userAgent;for(const t of F.ExceptionList){const w=t.key,N=t.targets;if(new RegExp(w).test(d)){if(t.capture&&t.captureConstraint){const A=t.capture,w=t.captureConstraint,N=new RegExp(A).exec(d);if(N&&N.length>0){if(parseInt(N[N.length-1])>=w)continue}}for(const d of N)switch(d){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":A.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=d=>{d.preventDefault(),this._contextWasLost=!0,p.e.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},B.addEventListener("webglcontextlost",this._onContextLost,!1),B.addEventListener("webglcontextrestored",this._onContextRestored,!1),A.powerPreference=A.powerPreference||"high-performance"),this._badDesktopOS&&(A.xrCompatible=!1),!A.disableWebGL2Support)try{this._gl=B.getContext("webgl2",A)||B.getContext("experimental-webgl2",A),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(i){}if(!this._gl){if(!B)throw new Error("The provided canvas is null or undefined.");try{this._gl=B.getContext("webgl",A)||B.getContext("experimental-webgl",A)}catch(i){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=d,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const t=this._gl.getContextAttributes();t&&(A.stencil=t.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==A.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=A.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let w=0;w<this._caps.maxVertexAttribs;w++)this._currentBufferPointers[w]=new T;this._shaderProcessor=this.webGLVersion>1?new a:new X;const W=`Babylon.js v${F.Version}`;p.e.Log(W+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",W);const D=(0,w.z)(this._gl);D.validateShaderPrograms=this.validateShaderPrograms,D.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(d){return null}areAllEffectsReady(){for(const d in this._compiledEffects){if(!this._compiledEffects[d].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const d=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=d&&(this._glRenderer=this._gl.getParameter(d.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(d.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const d=this._gl.getExtension("WEBGL_draw_buffers");if(null!==d){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=d.drawBuffersWEBGL.bind(d),this._caps.maxDrawBuffers=this._gl.getParameter(d.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let t=0;t<16;t++)this._gl["COLOR_ATTACHMENT"+t+"_WEBGL"]=d["COLOR_ATTACHMENT"+t+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const d=this._gl.getExtension("WEBGL_depth_texture");null!=d&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=d.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const d=this._gl.getExtension("OES_vertex_array_object");null!=d&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=d.createVertexArrayOES.bind(d),this._gl.bindVertexArray=d.bindVertexArrayOES.bind(d),this._gl.deleteVertexArray=d.deleteVertexArrayOES.bind(d))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const d=this._gl.getExtension("ANGLE_instanced_arrays");null!=d?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=d.drawArraysInstancedANGLE.bind(d),this._gl.drawElementsInstanced=d.drawElementsInstancedANGLE.bind(d),this._gl.vertexAttribDivisor=d.vertexAttribDivisorANGLE.bind(d)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const d=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),t=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);d&&t&&(this._caps.highPrecisionShaderSupported=0!==d.precision&&0!==t.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const d=this._gl.getExtension("EXT_blend_minmax");null!=d&&(this._caps.blendMinMax=!0,this._gl.MAX=d.MAX_EXT,this._gl.MIN=d.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const d=this._gl.getExtension("EXT_sRGB");null!=d&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:d.SRGB_EXT,SRGB8:d.SRGB_ALPHA_EXT,SRGB8_ALPHA8:d.SRGB_ALPHA_EXT})}if(this._creationOptions){const d=this._creationOptions.forceSRGBBufferSupportState;void 0!==d&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&d)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let t=0;t<this._maxSimultaneousTextures;t++)this._nextFreeTextureSlots.push(t);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const d=this._workingCanvas.getContext("2d");d&&(this._workingContext=d)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const d=this.getGlInfo();return d&&d.renderer?d.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=N;let p=0;if(t&&d){let t=!0;if(this._currentRenderTarget){var B;const A=null===(B=this._currentRenderTarget.texture)||void 0===B?void 0:B.format;if(8===A||9===A||10===A||11===A){var X;const A=null===(X=this._currentRenderTarget.texture)||void 0===X?void 0:X.type;7===A||5===A?(F._TempClearColorUint32[0]=255*d.r,F._TempClearColorUint32[1]=255*d.g,F._TempClearColorUint32[2]=255*d.b,F._TempClearColorUint32[3]=255*d.a,this._gl.clearBufferuiv(this._gl.COLOR,0,F._TempClearColorUint32),t=!1):(F._TempClearColorInt32[0]=255*d.r,F._TempClearColorInt32[1]=255*d.g,F._TempClearColorInt32[2]=255*d.b,F._TempClearColorInt32[3]=255*d.a,this._gl.clearBufferiv(this._gl.COLOR,0,F._TempClearColorInt32),t=!1)}}t&&(this._gl.clearColor(d.r,d.g,d.b,void 0!==d.a?d.a:1),p|=this._gl.COLOR_BUFFER_BIT)}A&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),p|=this._gl.DEPTH_BUFFER_BIT),w&&(this._gl.clearStencil(0),p|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(p)}_viewport(d,t,A,w){d===this._viewportCached.x&&t===this._viewportCached.y&&A===this._viewportCached.z&&w===this._viewportCached.w||(this._viewportCached.x=d,this._viewportCached.y=t,this._viewportCached.z=A,this._viewportCached.w=w,this._gl.viewport(d,t,A,w))}dj(){super.dj(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const W=d;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=d,this._bindUnboundFramebuffer(W._framebuffer);const a=this._gl;var D;if(!d.isMulti)if(d.is2DArray||d.is3D)a.framebufferTextureLayer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,null===(D=d.texture._hardwareTexture)||void 0===D?void 0:D.underlyingResource,B,X),W._currentLOD=B;else if(d.isCube){var i;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(i=d.texture._hardwareTexture)||void 0===i?void 0:i.underlyingResource,B)}else if(W._currentLOD!==B){var k;a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,null===(k=d.texture._hardwareTexture)||void 0===k?void 0:k.underlyingResource,B),W._currentLOD=B}const b=d._depthStencilTexture;if(b){d.is3D&&(d.texture.width===b.width&&d.texture.height===b.height&&d.texture.depth===b.depth||p.e.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const A=d._depthStencilTextureWithStencil?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;var Q;if(d.is2DArray||d.is3D)a.framebufferTextureLayer(a.FRAMEBUFFER,A,null===(Q=b._hardwareTexture)||void 0===Q?void 0:Q.underlyingResource,B,X);else if(d.isCube){var P;a.framebufferTexture2D(a.FRAMEBUFFER,A,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,null===(P=b._hardwareTexture)||void 0===P?void 0:P.underlyingResource,B)}else{var J;a.framebufferTexture2D(a.FRAMEBUFFER,A,a.TEXTURE_2D,null===(J=b._hardwareTexture)||void 0===J?void 0:J.underlyingResource,B)}}W._MSAAFramebuffer&&this._bindUnboundFramebuffer(W._MSAAFramebuffer),this._cachedViewport&&!N?this.setViewport(this._cachedViewport,A,w):(A||(A=d.width,B&&(A/=Math.pow(2,B))),w||(w=d.height,B&&(w/=Math.pow(2,B))),this._viewport(0,0,A,w)),this.wipeCaches()}setState(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==d||A)&&(this._depthCullingState.cull=d);const X=this.cullBackFaces??N??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==X||A)&&(this._depthCullingState.cullFace=X),this.setZOffset(t),this.setZOffsetUnits(B);const W=w?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==W||A)&&(this._depthCullingState.frontFace=W),this._stencilStateComposer.stencilMaterial=p}_bindUnboundFramebuffer(d){this._currentFramebuffer!==d&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,d),this._currentFramebuffer=d)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(d){const t=this._getTextureTarget(d);this._bindTextureDirectly(t,d,!0),this._gl.generateMipmap(t),this._bindTextureDirectly(t,null)}unBindFramebuffer(d){var t;let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1],w=arguments.length>2?arguments[2]:void 0;const N=d;this._currentRenderTarget=null;const p=this._gl;if(N._MSAAFramebuffer){if(d.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(d,A,w);p.bindFramebuffer(p.READ_FRAMEBUFFER,N._MSAAFramebuffer),p.bindFramebuffer(p.DRAW_FRAMEBUFFER,N._framebuffer),p.blitFramebuffer(0,0,d.width,d.height,0,0,d.width,d.height,p.COLOR_BUFFER_BIT,p.NEAREST)}null===(t=d.texture)||void 0===t||!t.generateMipMaps||A||d.isCube||this.generateMipmaps(d.texture),w&&(N._MSAAFramebuffer&&this._bindUnboundFramebuffer(N._framebuffer),w()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(d,t,A){return this._createVertexBuffer(d,this._gl.STATIC_DRAW)}_createVertexBuffer(d,t){const A=this._gl.createBuffer();if(!A)throw new Error("Unable to create vertex buffer");const w=new D.b(A);return this.bindArrayBuffer(w),"number"!==typeof d?d instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(d),t),w.Yc=4*d.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,d,t),w.Yc=d.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(d),t),w.Yc=d),this._resetVertexBufferBinding(),w.references=1,w}createDynamicVertexBuffer(d,t){return this._createVertexBuffer(d,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(d,t,A){const w=this._gl.createBuffer(),N=new D.b(w);if(!w)throw new Error("Unable to create index buffer");this.bindIndexBuffer(N);const p=this._normalizeIndexData(d);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,p,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),N.references=1,N.is32Bits=4===p.BYTES_PER_ELEMENT,N}_normalizeIndexData(d){if(2===d.BYTES_PER_ELEMENT)return d;if(this._caps.uintIndices){if(d instanceof Uint32Array)return d;for(let t=0;t<d.length;t++)if(d[t]>=65535)return new Uint32Array(d);return new Uint16Array(d)}return new Uint16Array(d)}bindArrayBuffer(d){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(d,this._gl.ARRAY_BUFFER)}bindUniformBlock(d,t,A){const w=d.program,N=this._gl.getUniformBlockIndex(w,t);this._gl.uniformBlockBinding(w,N,A)}bindIndexBuffer(d){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(d,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(d,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==d)&&(this._gl.bindBuffer(t,d?d.underlyingResource:null),this._currentBoundBuffer[t]=d)}updateArrayBuffer(d){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,d)}_vertexAttribPointer(d,t,A,w,N,p,B){const X=this._currentBufferPointers[t];if(!X)return;let W=!1;X.active?(X.buffer!==d&&(X.buffer=d,W=!0),X.size!==A&&(X.size=A,W=!0),X.type!==w&&(X.type=w,W=!0),X.normalized!==N&&(X.normalized=N,W=!0),X.stride!==p&&(X.stride=p,W=!0),X.offset!==B&&(X.offset=B,W=!0)):(W=!0,X.active=!0,X.index=t,X.size=A,X.type=w,X.normalized=N,X.stride=p,X.offset=B,X.buffer=d),(W||this._vaoRecordInProgress)&&(this.bindArrayBuffer(d),w===this._gl.UNSIGNED_INT||w===this._gl.INT?this._gl.vertexAttribIPointer(t,A,w,p,B):this._gl.vertexAttribPointer(t,A,w,N,p,B))}_bindIndexBufferWithCache(d){null!=d&&this._cachedIndexBuffer!==d&&(this._cachedIndexBuffer=d,this.bindIndexBuffer(d),this._uintIndicesCurrentlySet=d.is32Bits)}_bindVertexBuffersAttributes(d,t,A){const w=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let N=0;N<w.length;N++){const p=t.getAttributeLocation(N);if(p>=0){const t=w[N];let B=null;if(A&&(B=A[t]),B||(B=d[t]),!B)continue;this._gl.enableVertexAttribArray(p),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[p]=!0);const X=B.getBuffer();X&&(this._vertexAttribPointer(X,p,B.getSize(),B.type,B.normalized,B.byteStride,B.byteOffset),B.getIsInstanced()&&(this._gl.vertexAttribDivisor(p,B.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(p),this._currentInstanceBuffers.push(X))))}}}recordVertexArrayObject(d,t,A,w){const N=this._gl.createVertexArray();if(!N)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(N),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(d,A,w),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),N}bindVertexArrayObject(d,t){this._cachedVertexArrayObject!==d&&(this._cachedVertexArrayObject=d,this._gl.bindVertexArray(d),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(d,t,A,w,N){if(this._cachedVertexBuffers!==d||this._cachedEffectForVertexBuffers!==N){this._cachedVertexBuffers=d,this._cachedEffectForVertexBuffers=N;const t=N.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let p=0;for(let B=0;B<t;B++)if(B<A.length){const t=N.getAttributeLocation(B);t>=0&&(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0,this._vertexAttribPointer(d,t,A[B],this._gl.FLOAT,!1,w,p)),p+=4*A[B]}}this._bindIndexBufferWithCache(t)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(d,t,A,w){this._cachedVertexBuffers===d&&this._cachedEffectForVertexBuffers===A||(this._cachedVertexBuffers=d,this._cachedEffectForVertexBuffers=A,this._bindVertexBuffersAttributes(d,A,w)),this._bindIndexBufferWithCache(t)}unbindInstanceAttributes(){let d;for(let t=0,A=this._currentInstanceLocations.length;t<A;t++){const A=this._currentInstanceBuffers[t];d!=A&&A.references&&(d=A,this.bindArrayBuffer(A));const w=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(w,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(d){this._gl.deleteVertexArray(d)}_releaseBuffer(d){return d.references--,0===d.references&&(this._deleteBuffer(d),!0)}_deleteBuffer(d){this._gl.deleteBuffer(d.underlyingResource)}updateAndBindInstancesBuffer(d,t,A){if(this.bindArrayBuffer(d),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==A[0].index)this.bindInstancesBuffer(d,A,!0);else for(let w=0;w<4;w++){const t=A[w];this._vertexAttribArraysEnabled[t]||(this._gl.enableVertexAttribArray(t),this._vertexAttribArraysEnabled[t]=!0),this._vertexAttribPointer(d,t,4,this._gl.FLOAT,!1,64,16*w),this._gl.vertexAttribDivisor(t,1),this._currentInstanceLocations.push(t),this._currentInstanceBuffers.push(d)}}bindInstancesBuffer(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(d);let w=0;if(A)for(let N=0;N<t.length;N++){w+=4*t[N].attributeSize}for(let N=0;N<t.length;N++){const A=t[N];void 0===A.index&&(A.index=this._currentEffect.getAttributeLocationByName(A.attributeName)),A.index<0||(this._vertexAttribArraysEnabled[A.index]||(this._gl.enableVertexAttribArray(A.index),this._vertexAttribArraysEnabled[A.index]=!0),this._vertexAttribPointer(d,A.index,A.attributeSize,A.attributeType||this._gl.FLOAT,A.normalized||!1,w,A.offset),this._gl.vertexAttribDivisor(A.index,void 0===A.divisor?1:A.divisor),this._currentInstanceLocations.push(A.index),this._currentInstanceBuffers.push(d))}}disableInstanceAttributeByName(d){if(!this._currentEffect)return;const t=this._currentEffect.getAttributeLocationByName(d);this.disableInstanceAttribute(t)}disableInstanceAttribute(d){let t,A=!1;for(;-1!==(t=this._currentInstanceLocations.indexOf(d));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),A=!0,t=this._currentInstanceLocations.indexOf(d);A&&(this._gl.vertexAttribDivisor(d,0),this.disableAttributeByIndex(d))}disableAttributeByIndex(d){this._gl.disableVertexAttribArray(d),this._vertexAttribArraysEnabled[d]=!1,this._currentBufferPointers[d].active=!1}draw(d,t,A,w){this.drawElementsType(d?0:1,t,A,w)}drawPointClouds(d,t,A){this.drawArraysType(2,d,t,A)}drawUnIndexed(d,t,A,w){this.drawArraysType(d?0:1,t,A,w)}drawElementsType(d,t,A,w){this.applyStates(),this._reportDrawCall();const N=this._drawMode(d),p=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,B=this._uintIndicesCurrentlySet?4:2;w?this._gl.drawElementsInstanced(N,A,p,t*B,w):this._gl.drawElements(N,A,p,t*B)}drawArraysType(d,t,A,w){this.applyStates(),this._reportDrawCall();const N=this._drawMode(d);w?this._gl.drawArraysInstanced(N,t,A,w):this._gl.drawArrays(N,t,A)}_drawMode(d){switch(d){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(d){this._compiledEffects[d._key]&&delete this._compiledEffects[d._key];const t=d.getPipelineContext();t&&this._deletePipelineContext(t)}_deletePipelineContext(d){const t=d;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,(0,U.o)(t),this._gl.deleteProgram(t.program))}_getGlobalDefines(d){return(0,J.e)(d,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(d,t,A,N,p,B,X,W,a){let D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10?arguments[10]:void 0;const k="string"===typeof d?d:d.vertexToken||d.vertexSource||d.vertexElement||d.vertex,b="string"===typeof d?d:d.fragmentToken||d.fragmentSource||d.fragmentElement||d.fragment,Q=this._getGlobalDefines();let J=p??t.defines??"";Q&&(J+=Q);const U=k+"+"+b+"@"+J;if(this._compiledEffects[U]){const d=this._compiledEffects[U];return X&&d.isReady()&&X(d),d._refCount++,d}this._gl&&(0,w.z)(this._gl);const T=new P.e(d,t,A,N,this,p,B,X,W,a,U,t.shaderLanguage??D,t.extraInitializationsAsync??i);return this._compiledEffects[U]=T,T}_getShaderSource(d){return this._gl.getShaderSource(d)}createRawShaderProgram(d,t,A,N){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const B=(0,w.z)(this._gl);return B._contextWasLost=this._contextWasLost,B.validateShaderPrograms=this.validateShaderPrograms,(0,w.r)(d,t,A,N||this._gl,p)}createShaderProgram(d,t,A,N,p){let B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const X=(0,w.z)(this._gl);return X._contextWasLost=this._contextWasLost,X.validateShaderPrograms=this.validateShaderPrograms,(0,w.v)(d,t,A,N,p||this._gl,B)}inlineShaderCode(d){return d}createPipelineContext(d){if(this._gl){(0,w.z)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const t=(0,w.o)(this._gl,d);return t.ud=this,t}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(d){return(0,w.g)(d,this._gl,this.validateShaderPrograms)}_preparePipelineContext(d,t,A,N,p,B,X,W,a,D,i){const k=(0,w.z)(this._gl);return k._contextWasLost=this._contextWasLost,k.validateShaderPrograms=this.validateShaderPrograms,k._createShaderProgramInjection=this._createShaderProgram.bind(this),k.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),k.createShaderProgramInjection=this.createShaderProgram.bind(this),k.loadFileInjection=this._loadFile.bind(this),(0,w.j)(d,t,A,N,p,B,X,W,a,D,i)}_createShaderProgram(d,t,A,N){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,w.c)(d,t,A,N,p)}_isRenderingStateCompiled(d){const t=d;return!this._isDisposed&&!t._isDisposed&&(!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0))}_executeWhenRenderingStateIsCompiled(d,t){(0,w.e)(d,t)}getUniforms(d,t){const A=new Array,w=d;for(let N=0;N<t.length;N++)A.push(this._gl.getUniformLocation(w.program,t[N]));return A}getAttributes(d,t){const A=[],w=d;for(let p=0;p<t.length;p++)try{A.push(this._gl.getAttribLocation(w.program,t[p]))}catch(N){A.push(-1)}return A}enableEffect(d){(d=null!==d&&(0,N.c)(d)?d.effect:d)&&d!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(d),this._currentEffect=d,d.onBind&&d.onBind(d),d._onBindObservable&&d._onBindObservable.notifyObservers(d))}setInt(d,t){return!!d&&(this._gl.uniform1i(d,t),!0)}setInt2(d,t,A){return!!d&&(this._gl.uniform2i(d,t,A),!0)}setInt3(d,t,A,w){return!!d&&(this._gl.uniform3i(d,t,A,w),!0)}setInt4(d,t,A,w,N){return!!d&&(this._gl.uniform4i(d,t,A,w,N),!0)}setIntArray(d,t){return!!d&&(this._gl.uniform1iv(d,t),!0)}setIntArray2(d,t){return!(!d||t.length%2!==0)&&(this._gl.uniform2iv(d,t),!0)}setIntArray3(d,t){return!(!d||t.length%3!==0)&&(this._gl.uniform3iv(d,t),!0)}setIntArray4(d,t){return!(!d||t.length%4!==0)&&(this._gl.uniform4iv(d,t),!0)}setUInt(d,t){return!!d&&(this._gl.uniform1ui(d,t),!0)}setUInt2(d,t,A){return!!d&&(this._gl.uniform2ui(d,t,A),!0)}setUInt3(d,t,A,w){return!!d&&(this._gl.uniform3ui(d,t,A,w),!0)}setUInt4(d,t,A,w,N){return!!d&&(this._gl.uniform4ui(d,t,A,w,N),!0)}setUIntArray(d,t){return!!d&&(this._gl.uniform1uiv(d,t),!0)}setUIntArray2(d,t){return!(!d||t.length%2!==0)&&(this._gl.uniform2uiv(d,t),!0)}setUIntArray3(d,t){return!(!d||t.length%3!==0)&&(this._gl.uniform3uiv(d,t),!0)}setUIntArray4(d,t){return!(!d||t.length%4!==0)&&(this._gl.uniform4uiv(d,t),!0)}setArray(d,t){return!!d&&(!(t.length<1)&&(this._gl.uniform1fv(d,t),!0))}setArray2(d,t){return!(!d||t.length%2!==0)&&(this._gl.uniform2fv(d,t),!0)}setArray3(d,t){return!(!d||t.length%3!==0)&&(this._gl.uniform3fv(d,t),!0)}setArray4(d,t){return!(!d||t.length%4!==0)&&(this._gl.uniform4fv(d,t),!0)}setMatrices(d,t){return!!d&&(this._gl.uniformMatrix4fv(d,!1,t),!0)}setMatrix3x3(d,t){return!!d&&(this._gl.uniformMatrix3fv(d,!1,t),!0)}setMatrix2x2(d,t){return!!d&&(this._gl.uniformMatrix2fv(d,!1,t),!0)}setFloat(d,t){return!!d&&(this._gl.uniform1f(d,t),!0)}setFloat2(d,t,A){return!!d&&(this._gl.uniform2f(d,t,A),!0)}setFloat3(d,t,A,w){return!!d&&(this._gl.uniform3f(d,t,A,w),!0)}setFloat4(d,t,A,w,N){return!!d&&(this._gl.uniform4f(d,t,A,w,N),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const d=this._colorWrite;this._gl.colorMask(d,d,d,d)}}wipeCaches(d){this.preventCacheWipeBetweenFrames&&!d||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),d&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(d,t){const A=this._gl;let w=A.NEAREST,N=A.NEAREST;switch(d){case 11:w=A.LINEAR,N=t?A.LINEAR_MIPMAP_NEAREST:A.LINEAR;break;case 3:w=A.LINEAR,N=t?A.LINEAR_MIPMAP_LINEAR:A.LINEAR;break;case 8:w=A.NEAREST,N=t?A.NEAREST_MIPMAP_LINEAR:A.NEAREST;break;case 4:w=A.NEAREST,N=t?A.NEAREST_MIPMAP_NEAREST:A.NEAREST;break;case 5:w=A.NEAREST,N=t?A.LINEAR_MIPMAP_NEAREST:A.LINEAR;break;case 6:w=A.NEAREST,N=t?A.LINEAR_MIPMAP_LINEAR:A.LINEAR;break;case 7:w=A.NEAREST,N=A.LINEAR;break;case 1:w=A.NEAREST,N=A.NEAREST;break;case 9:w=A.LINEAR,N=t?A.NEAREST_MIPMAP_NEAREST:A.NEAREST;break;case 10:w=A.LINEAR,N=t?A.NEAREST_MIPMAP_LINEAR:A.NEAREST;break;case 2:w=A.LINEAR,N=A.LINEAR;break;case 12:w=A.LINEAR,N=A.NEAREST}return{min:N,mag:w}}_createTexture(){const d=this._gl.createTexture();if(!d)throw new Error("Unable to create texture");return d}_createHardwareTexture(){return new b.e(this._createTexture(),this._gl)}_createInternalTexture(d,t){let A,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=!1,B=0,X=3,W=5,a=!1,D=1;void 0!==t&&"object"===typeof t?(N=!!t.generateMipMaps,B=void 0===t.type?0:t.type,X=void 0===t.samplingMode?3:t.samplingMode,W=void 0===t.format?5:t.format,a=void 0!==t.useSRGBBuffer&&t.useSRGBBuffer,D=t.samples??1,A=t.label):N=!!t,a&&(a=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==B||this._caps.textureFloatLinearFiltering)&&(2!==B||this._caps.textureHalfFloatLinearFiltering)||(X=1),1!==B||this._caps.textureFloat||(B=0,p.e.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const i=this._gl,k=new Q.c(this,w),b=d.width||d,P=d.height||d,J=d.depth||0,U=d.layers||0,T=this._getSamplingParameters(X,N),F=0!==U?i.TEXTURE_2D_ARRAY:0!==J?i.TEXTURE_3D:i.TEXTURE_2D,q=this._getRGBABufferInternalSizedFormat(B,W,a),H=this._getInternalFormat(W),f=this._getWebGLTextureType(B);return this._bindTextureDirectly(F,k),0!==U?(k.is2DArray=!0,i.texImage3D(F,0,q,b,P,U,0,H,f,null)):0!==J?(k.is3D=!0,i.texImage3D(F,0,q,b,P,J,0,H,f,null)):i.texImage2D(F,0,q,b,P,0,H,f,null),i.texParameteri(F,i.TEXTURE_MAG_FILTER,T.mag),i.texParameteri(F,i.TEXTURE_MIN_FILTER,T.min),i.texParameteri(F,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(F,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),N&&this._gl.generateMipmap(F),this._bindTextureDirectly(F,null),k._useSRGBBuffer=a,k.baseWidth=b,k.baseHeight=P,k.width=b,k.height=P,k.depth=U,k.isReady=!0,k.samples=D,k.generateMipMaps=N,k.samplingMode=X,k.type=B,k.format=W,k.label=A,this._internalTexturesCache.push(k),k}_getUseSRGBBuffer(d,t){return d&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||t)}createTexture(d,t,A,w){var N=this;let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,i=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,k=arguments.length>11?arguments[11]:void 0,b=arguments.length>12?arguments[12]:void 0,P=arguments.length>13?arguments[13]:void 0,J=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(d,t,A,w,p,B,X,(function(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];return N._prepareWebGLTexture(...t,D)}),((d,t,A,N,p,B)=>{const X=this._gl,W=A.width===d&&A.height===t;p._creationFlags=P??0;const a=this._getTexImageParametersForCreateTexture(p.format,p._useSRGBBuffer);if(W)return X.texImage2D(X.TEXTURE_2D,0,a.internalFormat,a.format,a.type,A),!1;const D=this._caps.maxTextureSize;if(A.width>D||A.height>D||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=d,this._workingCanvas.height=t,this._workingContext.drawImage(A,0,0,A.width,A.height,0,0,d,t),X.texImage2D(X.TEXTURE_2D,0,a.internalFormat,a.format,a.type,this._workingCanvas),p.width=d,p.height=t,!1);{const d=new Q.c(this,2);this._bindTextureDirectly(X.TEXTURE_2D,d,!0),X.texImage2D(X.TEXTURE_2D,0,a.internalFormat,a.format,a.type,A),this._rescaleTexture(d,p,w,a.format,(()=>{this._releaseTexture(d),this._bindTextureDirectly(X.TEXTURE_2D,p,!0),B()}))}return!0}),W,a,D,i,k,b,J)}_getTexImageParametersForCreateTexture(d,t){let A,w;return 1===this.webGLVersion?(A=this._getInternalFormat(d,t),w=A):(A=this._getInternalFormat(d,!1),w=this._getRGBABufferInternalSizedFormat(0,d,t)),{internalFormat:w,format:A,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(d,t,A,w,N){}_unpackFlipY(d){this._unpackFlipYCached!==d&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,d?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=d))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(d){return d.isCube?this._gl.TEXTURE_CUBE_MAP:d.is3D?this._gl.TEXTURE_3D:d.is2DArray||d.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=this._getTextureTarget(t),N=this._getSamplingParameters(d,t.useMipMaps||A);this._setTextureParameterInteger(w,this._gl.TEXTURE_MAG_FILTER,N.mag,t),this._setTextureParameterInteger(w,this._gl.TEXTURE_MIN_FILTER,N.min),A&&(t.generateMipMaps=!0,this._gl.generateMipmap(w)),this._bindTextureDirectly(w,null),t.samplingMode=d}updateTextureDimensions(d,t,A){}updateTextureWrappingMode(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=this._getTextureTarget(d);null!==t&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),d),d._cachedWrapU=t),null!==A&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(A),d),d._cachedWrapV=A),(d.is2DArray||d.is3D)&&null!==w&&(this._setTextureParameterInteger(N,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(w),d),d._cachedWrapR=w),this._bindTextureDirectly(N,null)}_uploadCompressedDataToTextureDirectly(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const X=this._gl;let W=X.TEXTURE_2D;if(d.isCube&&(W=X.TEXTURE_CUBE_MAP_POSITIVE_X+p),d._useSRGBBuffer)switch(t){case 37492:case 36196:this._caps.etc2?t=X.COMPRESSED_SRGB8_ETC2:d._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?t=X.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:d._useSRGBBuffer=!1;break;case 36492:t=X.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:t=X.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?t=X.COMPRESSED_SRGB_S3TC_DXT1_EXT:d._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?t=X.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:d._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?t=X.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:d._useSRGBBuffer=!1;break;default:d._useSRGBBuffer=!1}this._gl.compressedTexImage2D(W,B,t,A,w,0,N)}_uploadDataToTextureDirectly(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=this._gl,X=this._getWebGLTextureType(d.type),W=this._getInternalFormat(d.format),a=void 0===N?this._getRGBABufferInternalSizedFormat(d.type,d.format,d._useSRGBBuffer):this._getInternalFormat(N,d._useSRGBBuffer);this._unpackFlipY(d.invertY);let D=B.TEXTURE_2D;d.isCube&&(D=B.TEXTURE_CUBE_MAP_POSITIVE_X+A);const i=Math.round(Math.log(d.width)*Math.LOG2E),k=Math.round(Math.log(d.height)*Math.LOG2E),b=p?d.width:Math.pow(2,Math.max(i-w,0)),Q=p?d.height:Math.pow(2,Math.max(k-w,0));B.texImage2D(D,w,a,b,Q,0,W,X,t)}updateTextureData(d,t,A,w,N,p){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=this._gl,D=this._getWebGLTextureType(d.type),i=this._getInternalFormat(d.format);this._unpackFlipY(d.invertY);let k=a.TEXTURE_2D,b=a.TEXTURE_2D;d.isCube&&(b=a.TEXTURE_CUBE_MAP_POSITIVE_X+B,k=a.TEXTURE_CUBE_MAP),this._bindTextureDirectly(k,d,!0),a.texSubImage2D(b,X,A,w,N,p,i,D,t),W&&this._gl.generateMipmap(b),this._bindTextureDirectly(k,null)}_uploadArrayBufferViewToTexture(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=this._gl,p=d.isCube?N.TEXTURE_CUBE_MAP:N.TEXTURE_2D;this._bindTextureDirectly(p,d,!0),this._uploadDataToTextureDirectly(d,t,A,w),this._bindTextureDirectly(p,null,!0)}_prepareWebGLTextureContinuation(d,t,A,w,N){const p=this._gl;if(!p)return;const B=this._getSamplingParameters(N,!A);p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,B.mag),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,B.min),A||w||p.generateMipmap(p.TEXTURE_2D),this._bindTextureDirectly(p.TEXTURE_2D,null),t&&t.removePendingData(d),d.onLoadedObservable.notifyObservers(d),d.onLoadedObservable.clear()}_prepareWebGLTexture(d,t,A,w,N,p,B,X,W,a){const D=this.getCaps().maxTextureSize,k=Math.min(D,this.needPOTTextures?(0,i.g)(w.width,D):w.width),b=Math.min(D,this.needPOTTextures?(0,i.g)(w.height,D):w.height),Q=this._gl;Q&&(d._hardwareTexture?(this._bindTextureDirectly(Q.TEXTURE_2D,d,!0),this._unpackFlipY(void 0===N||!!N),d.baseWidth=w.width,d.baseHeight=w.height,d.width=k,d.height=b,d.isReady=!0,d.type=-1!==d.type?d.type:0,d.format=-1!==d.format?d.format:a??(".jpg"!==t||d._useSRGBBuffer?5:4),X(k,b,w,t,d,(()=>{this._prepareWebGLTextureContinuation(d,A,p,B,W)}))||this._prepareWebGLTextureContinuation(d,A,p,B,W)):A&&A.removePendingData(d))}_getInternalFormatFromDepthTextureFormat(d,t,A){const w=this._gl;if(!t)return w.STENCIL_INDEX8;let N=A?w.DEPTH_STENCIL:w.DEPTH_COMPONENT;return this.webGLVersion>1?15===d?N=w.DEPTH_COMPONENT16:16===d?N=w.DEPTH_COMPONENT24:17===d||13===d?N=A?w.DEPTH24_STENCIL8:w.DEPTH_COMPONENT24:14===d?N=w.DEPTH_COMPONENT32F:18===d&&(N=A?w.DEPTH32F_STENCIL8:w.DEPTH_COMPONENT32F):N=w.DEPTH_COMPONENT16,N}_setupFramebufferDepthAttachments(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,p=arguments.length>5?arguments[5]:void 0;const B=this._gl;p=p??(d?13:14);const X=this._getInternalFormatFromDepthTextureFormat(p,t,d);return d&&t?this._createRenderBuffer(A,w,N,B.DEPTH_STENCIL,X,B.DEPTH_STENCIL_ATTACHMENT):t?this._createRenderBuffer(A,w,N,X,X,B.DEPTH_ATTACHMENT):d?this._createRenderBuffer(A,w,N,X,X,B.STENCIL_ATTACHMENT):null}_createRenderBuffer(d,t,A,w,N,p){let B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const X=this._gl.createRenderbuffer();return this._updateRenderBuffer(X,d,t,A,w,N,p,B)}_updateRenderBuffer(d,t,A,w,N,p,B){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const W=this._gl;return W.bindRenderbuffer(W.RENDERBUFFER,d),w>1&&W.renderbufferStorageMultisample?W.renderbufferStorageMultisample(W.RENDERBUFFER,w,p,t,A):W.renderbufferStorage(W.RENDERBUFFER,N,t,A),W.framebufferRenderbuffer(W.FRAMEBUFFER,B,W.RENDERBUFFER,d),X&&W.bindRenderbuffer(W.RENDERBUFFER,null),d}_releaseTexture(d){this._deleteTexture(d._hardwareTexture),this.unbindAllTextures();const t=this._internalTexturesCache.indexOf(d);-1!==t&&this._internalTexturesCache.splice(t,1),d._lodTextureHigh&&d._lodTextureHigh.dispose(),d._lodTextureMid&&d._lodTextureMid.dispose(),d._lodTextureLow&&d._lodTextureLow.dispose(),d._irradianceTexture&&d._irradianceTexture.dispose()}_deleteTexture(d){null===d||void 0===d||d.release()}_setProgram(d){this._currentProgram!==d&&((0,w.n)(d,this._gl),this._currentProgram=d)}bindSamplers(d){const t=d.getPipelineContext();this._setProgram(t.program);const A=d.getSamplers();for(let w=0;w<A.length;w++){const t=d.getUniform(A[w]);t&&(this._boundUniforms[w]=t)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=!1;const B=t&&t._associatedChannel>-1;A&&B&&(this._activeChannel=t._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==t||w){if(this._activateCurrentTexture(),t&&t.isMultiview)throw p.e.Error(["_bindTextureDirectly called with a multiview texture!",d,t]),"_bindTextureDirectly called with a multiview texture!";var X;this._gl.bindTexture(d,(null===t||void 0===t||null===(X=t._hardwareTexture)||void 0===X?void 0:X.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)}else A&&(N=!0,this._activateCurrentTexture());return B&&!A&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),N}_bindTexture(d,t,A){if(void 0===d)return;t&&(t._associatedChannel=d),this._activeChannel=d;const w=t?this._getTextureTarget(t):this._gl.TEXTURE_2D;this._bindTextureDirectly(w,t)}unbindAllTextures(){for(let d=0;d<this._maxSimultaneousTextures;d++)this._activeChannel=d,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(d,t,A,w){void 0!==d&&(t&&(this._boundUniforms[d]=t),this._setTexture(d,A))}_bindSamplerUniformToChannel(d,t){const A=this._boundUniforms[d];A&&A._currentState!==t&&(this._gl.uniform1i(A,t),A._currentState=t)}_getTextureWrapMode(d){switch(d){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(d,t){let A,w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!t)return null!=this._boundTexturesCache[d]&&(this._activeChannel=d,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video){this._activeChannel=d;const A=t.getInternalTexture();A&&(A._associatedChannel=d),t.update()}else if(4===t.delayLoadState)return t.delayLoad(),!1;A=N?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!w&&A&&(A._associatedChannel=d);let p=!0;this._boundTexturesCache[d]===A&&(w||this._bindSamplerUniformToChannel(A._associatedChannel,d),p=!1),this._activeChannel=d;const B=this._getTextureTarget(A);if(p&&this._bindTextureDirectly(B,A,w),A&&!A.isMultiview){if(A.isCube&&A._cachedCoordinatesMode!==t.coordinatesMode){A._cachedCoordinatesMode=t.coordinatesMode;const d=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=d,t.wrapV=d}A._cachedWrapU!==t.wrapU&&(A._cachedWrapU=t.wrapU,this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),A)),A._cachedWrapV!==t.wrapV&&(A._cachedWrapV=t.wrapV,this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),A)),A.is3D&&A._cachedWrapR!==t.wrapR&&(A._cachedWrapR=t.wrapR,this._setTextureParameterInteger(B,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),A)),this._setAnisotropicLevel(B,A,t.anisotropicFilteringLevel)}return!0}setTextureArray(d,t,A,w){if(void 0!==d&&t){this._textureUnits&&this._textureUnits.length===A.length||(this._textureUnits=new Int32Array(A.length));for(let t=0;t<A.length;t++){const w=A[t].getInternalTexture();w?(this._textureUnits[t]=d+t,w._associatedChannel=d+t):this._textureUnits[t]=-1}this._gl.uniform1iv(t,this._textureUnits);for(let d=0;d<A.length;d++)this._setTexture(this._textureUnits[d],A[d],!0)}}_setAnisotropicLevel(d,t,A){const w=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(A=1),w&&t._cachedAnisotropicFilteringLevel!==A&&(this._setTextureParameterFloat(d,w.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(A,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=A)}_setTextureParameterFloat(d,t,A,w){this._bindTextureDirectly(d,w,!0,!0),this._gl.texParameterf(d,t,A)}_setTextureParameterInteger(d,t,A,w){w&&this._bindTextureDirectly(d,w,!0,!0),this._gl.texParameteri(d,t,A)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let d=0;d<this._caps.maxVertexAttribs;d++)this.disableAttributeByIndex(d)}else for(let d=0,t=this._vertexAttribArraysEnabled.length;d<t;d++)d>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[d]||this.disableAttributeByIndex(d)}releaseEffects(){const d=Object.keys(this._compiledEffects);for(const t of d){this._compiledEffects[t].dispose()}this._compiledEffects={}}dispose(){var d;((0,B.l)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(d=this._gl.getExtension("WEBGL_lose_context"))||void 0===d||d.loseContext());(0,w.y)(this._gl)}attachContextLostEvent(d){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",d,!1)}attachContextRestoredEvent(d){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",d,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(d){const t=this._gl;for(;t.getError()!==t.NO_ERROR;);let A=!0;const w=t.createTexture();t.bindTexture(t.TEXTURE_2D,w),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(d),1,1,0,t.RGBA,this._getWebGLTextureType(d),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const N=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,N),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,w,0);const p=t.checkFramebufferStatus(t.FRAMEBUFFER);if(A=A&&p===t.FRAMEBUFFER_COMPLETE,A=A&&t.getError()===t.NO_ERROR,A&&(t.clear(t.COLOR_BUFFER_BIT),A=A&&t.getError()===t.NO_ERROR),A){t.bindFramebuffer(t.FRAMEBUFFER,null);const d=t.RGBA,w=t.UNSIGNED_BYTE,N=new Uint8Array(4);t.readPixels(0,0,1,1,d,w,N),A=A&&t.getError()===t.NO_ERROR}for(t.deleteTexture(w),t.deleteFramebuffer(N),t.bindFramebuffer(t.FRAMEBUFFER,null);!A&&t.getError()!==t.NO_ERROR;);return A}_getWebGLTextureType(d){if(1===this._webGLVersion){switch(d){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(d){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(d){case 0:A=this._gl.ALPHA;break;case 1:A=this._gl.LUMINANCE;break;case 2:A=this._gl.LUMINANCE_ALPHA;break;case 6:A=this._gl.RED;break;case 7:A=this._gl.RG;break;case 4:A=t?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:A=t?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(d){case 8:A=this._gl.RED_INTEGER;break;case 9:A=this._gl.RG_INTEGER;break;case 10:A=this._gl.RGB_INTEGER;break;case 11:A=this._gl.RGBA_INTEGER}return A}_getRGBABufferInternalSizedFormat(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return A?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(d){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return A?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return A?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return A?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(d,t,A,w){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const B=N?4:3,X=N?this._gl.RGBA:this._gl.RGB,W=new Uint8Array(w*A*B);return p&&this.flushFramebuffer(),this._gl.readPixels(d,t,A,w,X,this._gl.UNSIGNED_BYTE,W),Promise.resolve(W)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const d=k.c._CreateCanvas(1,1),t=d.getContext("webgl")||d.getContext("experimental-webgl");this._IsSupported=null!=t&&!!window.WebGLRenderingContext}catch(d){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const d=k.c._CreateCanvas(1,1),t=d.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||d.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!t}catch(d){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}F._TempClearColorUint32=new Uint32Array(4),F._TempClearColorInt32=new Int32Array(4),F.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],F._ConcatenateShader=J.d,F._IsSupported=null,F._HasMajorPerformanceCaveat=null},11159:(d,t,A)=>{"use strict";var w;A.d(t,{e:()=>N}),function(d){d[d.PointerMove=0]="PointerMove",d[d.PointerDown=1]="PointerDown",d[d.PointerUp=2]="PointerUp"}(w||(w={}));class N{}N.DOM_DELTA_PIXEL=0,N.DOM_DELTA_LINE=1,N.DOM_DELTA_PAGE=2},11156:(d,t,A)=>{"use strict";A.d(t,{b:()=>w,c:()=>p,f:()=>N});class w{}w.KEYDOWN=1,w.KEYUP=2;class N{constructor(d,t){this.type=d,this.event=t}}class p extends N{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(d){this.skipOnKeyboardObservable=d}constructor(d,t){super(d,t),this.type=d,this.event=t,this.skipOnKeyboardObservable=!1}}},11151:(d,t,A)=>{"use strict";A.d(t,{e:()=>N,g:()=>B,i:()=>X});var w=A(11076);class N{}N.POINTERDOWN=1,N.POINTERUP=2,N.POINTERMOVE=4,N.POINTERWHEEL=8,N.POINTERPICK=16,N.POINTERTAP=32,N.POINTERDOUBLETAP=64;class p{constructor(d,t){this.type=d,this.event=t}}class B extends p{constructor(d,t,A,N){super(d,t),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new w.j(A,N)}}class X extends p{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(d,t),this._pickInfo=A,this._inputManager=w}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10724:(d,t,A)=>{"use strict";A.r(t),A.d(t,{SceneInstrumentation:()=>p});var w=A(10727),N=A(10901);class p{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(d){d!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=d,d?(this._onBeforeActiveMeshesEvaluationObserver=this.Hf.onBeforeActiveMeshesEvaluationObservable.add((()=>{w.g.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Hf.onAfterActiveMeshesEvaluationObservable.add((()=>{w.g.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Hf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Hf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(d){d!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=d,d?(this._onBeforeRenderTargetsRenderObserver=this.Hf.onBeforeRenderTargetsRenderObservable.add((()=>{w.g.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Hf.onAfterRenderTargetsRenderObservable.add((()=>{w.g.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Hf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Hf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(d){d!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=d,d?(this._onBeforeParticlesRenderingObserver=this.Hf.onBeforeParticlesRenderingObservable.add((()=>{w.g.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Hf.onAfterParticlesRenderingObservable.add((()=>{w.g.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Hf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Hf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(d){d!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=d,this.Hf.spriteManagers&&(d?(this._onBeforeSpritesRenderingObserver=this.Hf.onBeforeSpritesRenderingObservable.add((()=>{w.g.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Hf.onAfterSpritesRenderingObservable.add((()=>{w.g.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Hf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Hf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(d){d!==this._capturePhysicsTime&&this.Hf.onBeforePhysicsObservable&&(this._capturePhysicsTime=d,d?(this._onBeforePhysicsObserver=this.Hf.onBeforePhysicsObservable.add((()=>{w.g.StartPerformanceCounter("lb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Hf.onAfterPhysicsObservable.add((()=>{w.g.EndPerformanceCounter("lb"),this._physicsTime.endMonitoring()}))):(this.Hf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Hf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(d){d!==this._captureAnimationsTime&&(this._captureAnimationsTime=d,d?this._onAfterAnimationsObserver=this.Hf.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Hf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(d){this._captureFrameTime=d}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(d){this._captureInterFrameTime=d}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(d){d!==this._captureRenderTime&&(this._captureRenderTime=d,d?(this._onBeforeDrawPhaseObserver=this.Hf.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),w.g.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Hf.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),w.g.EndPerformanceCounter("Main render")}))):(this.Hf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Hf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(d){d!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=d,d?(this._onBeforeCameraRenderObserver=this.Hf.onBeforeCameraRenderObservable.add((d=>{this._cameraRenderTime.beginMonitoring(),w.g.StartPerformanceCounter(`Rendering camera ${d.name}`)})),this._onAfterCameraRenderObserver=this.Hf.onAfterCameraRenderObservable.add((d=>{this._cameraRenderTime.endMonitoring(!1),w.g.EndPerformanceCounter(`Rendering camera ${d.name}`)}))):(this.Hf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Hf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Hf.getEngine()._drawCalls}constructor(d){this.Hf=d,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new N.d,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new N.d,this._captureFrameTime=!1,this._frameTime=new N.d,this._captureRenderTime=!1,this._renderTime=new N.d,this._captureInterFrameTime=!1,this._interFrameTime=new N.d,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new N.d,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new N.d,this._capturePhysicsTime=!1,this._physicsTime=new N.d,this._captureAnimationsTime=!1,this._animationsTime=new N.d,this._captureCameraRenderTime=!1,this._cameraRenderTime=new N.d,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=d.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(w.g.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Hf.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=d.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(w.g.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.dj(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.dj(),this._captureParticlesRenderTime&&this._particlesRenderTime.dj(),this._captureSpritesRenderTime&&this._spritesRenderTime.dj(),this._captureRenderTime&&this._renderTime.dj(),this._captureCameraRenderTime&&this._cameraRenderTime.dj()}))}dispose(){this.Hf.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Hf.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Hf.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Hf.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Hf.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Hf.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Hf.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Hf.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Hf.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Hf.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Hf.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Hf.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Hf.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Hf.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Hf.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Hf.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Hf.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Hf=null}}},12107:(d,t,A)=>{"use strict";A.d(t,{d:()=>D});var w=A(11041),N=A(11047),p=A(11076),B=A(11326),X=A(12069),W=A(12114),a=A(10885);B.d.AddNodeConstructor("Light_Type_1",((d,t)=>()=>new D(d,p.l.Zero(),t)));class D extends W.b{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(d){this._shadowFrustumSize=d,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(d){this._shadowOrthoScale=d,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(d){this._orthoLeft=d}get orthoRight(){return this._orthoRight}set orthoRight(d){this._orthoRight=d}get orthoTop(){return this._orthoTop}set orthoTop(d){this._orthoTop=d}get orthoBottom(){return this._orthoBottom}set orthoBottom(d){this._orthoBottom=d}constructor(d,t,A){super(d,A),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=t.scale(-1),this.direction=t}getClassName(){return"mb"}getTypeID(){return X.c.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(d,t,A){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(d):this._setDefaultAutoExtendShadowProjectionMatrix(d,t,A)}_setDefaultFixedFrustumShadowProjectionMatrix(d){const t=this.va().activeCamera;t&&p.c.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:t.Ui,void 0!==this.shadowMaxZ?this.shadowMaxZ:t.maxZ,d,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(d,t,A){const w=this.va().activeCamera;if(!w)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const d=p.l.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let w=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(let B=0;B<A.length;B++){const X=A[B];if(!X)continue;const W=X.getBoundingInfo().boundingBox;for(let A=0;A<W.vectorsWorld.length;A++)p.l.TransformCoordinatesToRef(W.vectorsWorld[A],t,d),d.x<this._orthoLeft&&(this._orthoLeft=d.x),d.y<this._orthoBottom&&(this._orthoBottom=d.y),d.x>this._orthoRight&&(this._orthoRight=d.x),d.y>this._orthoTop&&(this._orthoTop=d.y),this.autoCalcShadowZBounds&&(d.z<w&&(w=d.z),d.z>N&&(N=d.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=w,this._shadowMaxZ=N)}const N=this._orthoRight-this._orthoLeft,B=this._orthoTop-this._orthoBottom,X=void 0!==this.shadowMinZ?this.shadowMinZ:w.Ui,W=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,a=this.va().getEngine().useReverseDepthBuffer;p.c.OrthoOffCenterLHToRef(this._orthoLeft-N*this.shadowOrthoScale,this._orthoRight+N*this.shadowOrthoScale,this._orthoBottom-B*this.shadowOrthoScale,this._orthoTop+B*this.shadowOrthoScale,a?W:X,a?X:W,d,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(d,t){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,t),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,t),this)}transferToNodeMaterialEffect(d,t){return this.computeTransformedInformation()?(d.setFloat3(t,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(d.setFloat3(t,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(d){const t=this._scene.getEngine();return!t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}getDepthMaxZ(d){const t=this._scene.getEngine();return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:1}prepareLightSpecificDefines(d,t){d["DIRLIGHT"+t]=!0}}(0,w.b)([(0,N.J)()],D.prototype,"shadowFrustumSize",null),(0,w.b)([(0,N.J)()],D.prototype,"shadowOrthoScale",null),(0,w.b)([(0,N.J)()],D.prototype,"autoUpdateExtends",void 0),(0,w.b)([(0,N.J)()],D.prototype,"autoCalcShadowZBounds",void 0),(0,w.b)([(0,N.J)("orthoLeft")],D.prototype,"_orthoLeft",void 0),(0,w.b)([(0,N.J)("orthoRight")],D.prototype,"_orthoRight",void 0),(0,w.b)([(0,N.J)("orthoTop")],D.prototype,"_orthoTop",void 0),(0,w.b)([(0,N.J)("orthoBottom")],D.prototype,"_orthoBottom",void 0),(0,a.g)("BABYLON.DirectionalLight",D)},12462:(d,t,A)=>{"use strict";A.d(t,{d:()=>D});var w=A(11041),N=A(11047),p=A(11076),B=A(11094),X=A(11326),W=A(12069),a=A(10885);X.d.AddNodeConstructor("Light_Type_3",((d,t)=>()=>new D(d,p.l.Zero(),t)));class D extends W.c{constructor(d,t,A){super(d,A),this.groundColor=new B.e(0,0,0),this.direction=t||p.l.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"nb"}setDirectionToTarget(d){return this.direction=p.l.Normalize(d.Uc(p.l.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(d,t){const A=p.l.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",A.x,A.y,A.z,0,t),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Yi),t),this}transferToNodeMaterialEffect(d,t){const A=p.l.Normalize(this.direction);return d.setFloat3(t,A.x,A.y,A.z),this}Nj(){return this._worldMatrix||(this._worldMatrix=p.c.Identity()),this._worldMatrix}getTypeID(){return W.c.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(d,t){d["HEMILIGHT"+t]=!0}}(0,w.b)([(0,N.i)()],D.prototype,"groundColor",void 0),(0,w.b)([(0,N.H)()],D.prototype,"direction",void 0),(0,a.g)("BABYLON.HemisphericLight",D)},12069:(d,t,A)=>{"use strict";A.d(t,{c:()=>k});var w=A(11041),N=A(11047),p=A(11076),B=A(11094),X=A(11326),W=A(11108),a=A(10885),D=A(11196),i=A(11097);class k extends X.d{get range(){return this._range}set range(d){this._range=d,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(d){this._intensityMode=d,this._computePhotometricScale()}get i(){return this._radius}set i(d){this._radius=d,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(d){this._shadowEnabled!==d&&(this._shadowEnabled=d,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(d){this._includedOnlyMeshes=d,this._hookArrayForIncludedOnly(d)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(d){this._excludedMeshes=d,this._hookArrayForExcluded(d)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(d){this._excludeWithLayerMask=d,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(d){this._includeOnlyWithLayerMask=d,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(d){this._lightmapMode!==d&&(this._lightmapMode=d,this._markMeshesAsLightDirty())}getViewMatrix(d){return null}getProjectionMatrix(d,t){return null}constructor(d,t){super(d,t,!1),this.kh=new B.e(1,1,1),this.mh=new B.e(1,1,1),this.falloffType=k.FALLOFF_DEFAULT,this.Yi=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=k.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new W.e(this.va().getEngine(),void 0,void 0,d),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(d,t){return this}_bindLight(d,t,A,w){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const p=d.toString();let X=!1;if(this._uniformBuffer.bindToEffect(A,"Light"+p),this._renderId!==t.getRenderId()||this._lastUseSpecular!==w||!this._uniformBuffer.useUbo){this._renderId=t.getRenderId(),this._lastUseSpecular=w;const d=this.getScaledIntensity();this.transferToEffect(A,p),this.kh.scaleToRef(d,B.j.jb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",B.j.jb[0],this.range,p),w&&(this.mh.scaleToRef(d,B.j.jb[1]),this._uniformBuffer.updateColor4("vLightSpecular",B.j.jb[1],this.i,p)),X=!0}if(this.transferTexturesToEffect(A,p),t.shadowsEnabled&&this.shadowEnabled&&N){const d=this.getShadowGenerator(t.activeCamera)??this.getShadowGenerator();d&&(d.bindShadowLight(p,A),X=!0)}X?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(d){let t="Name: "+this.name;if(t+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let A=0;A<this.animations.length;A++)t+=", animation[0]: "+this.animations[A].toString(d);return t}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}Mf(d){super.Mf(d),this._resyncMeshes()}getShadowGenerator(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(d)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return p.l.Zero()}canAffectMesh(d){return!d||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(d))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(d))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&d.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&d.layerMask)))}dispose(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const d=this._shadowGenerators.values();for(let t=d.next();!0!==t.done;t=d.next()){t.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const d=this._parentContainer.lights.indexOf(this);d>-1&&this._parentContainer.lights.splice(d,1),this._parentContainer=null}for(const A of this.va().meshes)A._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(d,t)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Yi}clone(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=k.GetConstructorFromName(this.getTypeID(),d,this.va());if(!A)return null;const w=i.d.Clone(A,this);return d&&(w.name=d),t&&(w.parent=t),w.Mf(this.isEnabled()),this.onClonedObservable.notifyObservers(w),w}serialize(){const d=i.d.Serialize(this);return d.uniqueId=this.uniqueId,d.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(d),this.excludedMeshes.length>0&&(d.excludedMeshesIds=[],this.excludedMeshes.forEach((t=>{d.excludedMeshesIds.push(t.id)}))),this.includedOnlyMeshes.length>0&&(d.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((t=>{d.includedOnlyMeshesIds.push(t.id)}))),i.d.AppendSerializedAnimations(this,d),d.ranges=this.serializeAnimationRanges(),d.isEnabled=this.isEnabled(),d}static GetConstructorFromName(d,t,A){const w=X.d.Construct("Light_Type_"+d,t,A);return w||null}static Parse(d,t){const A=k.GetConstructorFromName(d.type,d.name,t);if(!A)return null;const w=i.d.Parse(A,d,t);if(d.excludedMeshesIds&&(w._excludedMeshesIds=d.excludedMeshesIds),d.includedOnlyMeshesIds&&(w._includedOnlyMeshesIds=d.includedOnlyMeshesIds),void 0!==d.parentId&&(w._waitingParentId=d.parentId),void 0!==d.parentInstanceIndex&&(w._waitingParentInstanceIndex=d.parentInstanceIndex),void 0!==d.falloffType&&(w.falloffType=d.falloffType),void 0!==d.lightmapMode&&(w.lightmapMode=d.lightmapMode),d.animations){for(let t=0;t<d.animations.length;t++){const A=d.animations[t],N=(0,a.d)("BABYLON.Animation");N&&w.animations.push(N.Parse(A))}X.d.ParseAnimationRanges(w,d,t)}return d.autoAnimate&&t.beginAnimation(w,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),void 0!==d.isEnabled&&w.Mf(d.isEnabled),w}_hookArrayForExcluded(d){var t=this;const A=d.push;d.push=function(){for(var w=arguments.length,N=new Array(w),p=0;p<w;p++)N[p]=arguments[p];const B=A.apply(d,N);for(const d of N)d._resyncLightSource(t);return B};const w=d.splice;d.splice=(t,A)=>{const N=w.apply(d,[t,A]);for(const d of N)d._resyncLightSource(this);return N};for(const N of d)N._resyncLightSource(this)}_hookArrayForIncludedOnly(d){var t=this;const A=d.push;d.push=function(){for(var w=arguments.length,N=new Array(w),p=0;p<w;p++)N[p]=arguments[p];const B=A.apply(d,N);return t._resyncMeshes(),B};const w=d.splice;d.splice=(t,A)=>{const N=w.apply(d,[t,A]);return this._resyncMeshes(),N},this._resyncMeshes()}_resyncMeshes(){for(const d of this.va().meshes)d._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const d of this.va().meshes)-1!==d.lightSources.indexOf(this)&&d._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let d=0;const t=this.getTypeID();let A=this.intensityMode;switch(A===k.INTENSITYMODE_AUTOMATIC&&(A=t===k.LIGHTTYPEID_DIRECTIONALLIGHT?k.INTENSITYMODE_ILLUMINANCE:k.INTENSITYMODE_LUMINOUSINTENSITY),t){case k.LIGHTTYPEID_POINTLIGHT:case k.LIGHTTYPEID_SPOTLIGHT:switch(A){case k.INTENSITYMODE_LUMINOUSPOWER:d=1/(4*Math.PI);break;case k.INTENSITYMODE_LUMINOUSINTENSITY:d=1;break;case k.INTENSITYMODE_LUMINANCE:d=this.i*this.i}break;case k.LIGHTTYPEID_DIRECTIONALLIGHT:switch(A){case k.INTENSITYMODE_ILLUMINANCE:d=1;break;case k.INTENSITYMODE_LUMINANCE:{let t=this.i;t=Math.max(t,.001);d=2*Math.PI*(1-Math.cos(t));break}}break;case k.LIGHTTYPEID_HEMISPHERICLIGHT:d=1}return d}_reorderLightsInScene(){const d=this.va();0!=this._renderPriority&&(d.requireLightSorting=!0),this.va().sortLightsByPriority()}}k.FALLOFF_DEFAULT=D.b.FALLOFF_DEFAULT,k.FALLOFF_PHYSICAL=D.b.FALLOFF_PHYSICAL,k.FALLOFF_GLTF=D.b.FALLOFF_GLTF,k.FALLOFF_STANDARD=D.b.FALLOFF_STANDARD,k.LIGHTMAP_DEFAULT=D.b.LIGHTMAP_DEFAULT,k.LIGHTMAP_SPECULAR=D.b.LIGHTMAP_SPECULAR,k.LIGHTMAP_SHADOWSONLY=D.b.LIGHTMAP_SHADOWSONLY,k.INTENSITYMODE_AUTOMATIC=D.b.INTENSITYMODE_AUTOMATIC,k.INTENSITYMODE_LUMINOUSPOWER=D.b.INTENSITYMODE_LUMINOUSPOWER,k.INTENSITYMODE_LUMINOUSINTENSITY=D.b.INTENSITYMODE_LUMINOUSINTENSITY,k.INTENSITYMODE_ILLUMINANCE=D.b.INTENSITYMODE_ILLUMINANCE,k.INTENSITYMODE_LUMINANCE=D.b.INTENSITYMODE_LUMINANCE,k.LIGHTTYPEID_POINTLIGHT=D.b.LIGHTTYPEID_POINTLIGHT,k.LIGHTTYPEID_DIRECTIONALLIGHT=D.b.LIGHTTYPEID_DIRECTIONALLIGHT,k.LIGHTTYPEID_SPOTLIGHT=D.b.LIGHTTYPEID_SPOTLIGHT,k.LIGHTTYPEID_HEMISPHERICLIGHT=D.b.LIGHTTYPEID_HEMISPHERICLIGHT,(0,w.b)([(0,N.i)()],k.prototype,"diffuse",void 0),(0,w.b)([(0,N.i)()],k.prototype,"specular",void 0),(0,w.b)([(0,N.J)()],k.prototype,"falloffType",void 0),(0,w.b)([(0,N.J)()],k.prototype,"intensity",void 0),(0,w.b)([(0,N.J)()],k.prototype,"range",null),(0,w.b)([(0,N.J)()],k.prototype,"intensityMode",null),(0,w.b)([(0,N.J)()],k.prototype,"i",null),(0,w.b)([(0,N.J)()],k.prototype,"_renderPriority",void 0),(0,w.b)([(0,N.c)("_reorderLightsInScene")],k.prototype,"renderPriority",void 0),(0,w.b)([(0,N.J)("shadowEnabled")],k.prototype,"_shadowEnabled",void 0),(0,w.b)([(0,N.J)("excludeWithLayerMask")],k.prototype,"_excludeWithLayerMask",void 0),(0,w.b)([(0,N.J)("includeOnlyWithLayerMask")],k.prototype,"_includeOnlyWithLayerMask",void 0),(0,w.b)([(0,N.J)("lightmapMode")],k.prototype,"_lightmapMode",void 0)},11196:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});class w{static CompareLightsPriority(d,t){return d.shadowEnabled!==t.shadowEnabled?(t.shadowEnabled?1:0)-(d.shadowEnabled?1:0):t.renderPriority-d.renderPriority}}w.FALLOFF_DEFAULT=0,w.FALLOFF_PHYSICAL=1,w.FALLOFF_GLTF=2,w.FALLOFF_STANDARD=3,w.LIGHTMAP_DEFAULT=0,w.LIGHTMAP_SPECULAR=1,w.LIGHTMAP_SHADOWSONLY=2,w.INTENSITYMODE_AUTOMATIC=0,w.INTENSITYMODE_LUMINOUSPOWER=1,w.INTENSITYMODE_LUMINOUSINTENSITY=2,w.INTENSITYMODE_ILLUMINANCE=3,w.INTENSITYMODE_LUMINANCE=4,w.LIGHTTYPEID_POINTLIGHT=0,w.LIGHTTYPEID_DIRECTIONALLIGHT=1,w.LIGHTTYPEID_SPOTLIGHT=2,w.LIGHTTYPEID_HEMISPHERICLIGHT=3},12114:(d,t,A)=>{"use strict";A.d(t,{b:()=>W});var w=A(11041),N=A(11047),p=A(11076),B=A(12069),X=A(11359);class W extends B.c{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=p.c.Identity(),this._projectionMatrix=p.c.Identity()}_setPosition(d){this._position=d}get position(){return this._position}set position(d){this._setPosition(d)}_setDirection(d){this._direction=d}get direction(){return this._direction}set direction(d){this._setDirection(d)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(d){this._shadowMinZ=d,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(d){this._shadowMaxZ=d,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=p.l.Zero()),p.l.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=p.l.Zero()),p.l.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(d){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(d){return this.direction=p.l.Normalize(d.Uc(this.position)),this.direction}getRotation(){this.direction.normalize();const d=p.l.Cross(this.direction,X.e.Y),t=p.l.Cross(d,this.direction);return p.l.RotationFromAxis(d,t,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=p.l.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}Nj(d){return!d&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=p.c.Identity()),p.c.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(d){return void 0!==this.shadowMinZ?this.shadowMinZ:d.Ui}getDepthMaxZ(d){return void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ}setShadowProjectionMatrix(d,t,A){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(t,A,d):this._setDefaultShadowProjectionMatrix(d,t,A),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(d){const t=p.h.gb[0];let A=this.position;this.computeTransformedInformation()&&(A=this.transformedPosition),p.l.NormalizeToRef(this.getShadowDirection(d),t),1===Math.abs(p.l.Dot(t,p.l.Up()))&&(t.z=1e-13);const w=p.h.gb[1];return A.addToRef(t,w),p.c.LookAtLHToRef(A,w,p.l.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(d,t){return this.setShadowProjectionMatrix(this._projectionMatrix,d??this._viewMatrix,t??[]),this._projectionMatrix}}(0,w.b)([(0,N.H)()],W.prototype,"position",null),(0,w.b)([(0,N.H)()],W.prototype,"direction",null),(0,w.b)([(0,N.J)()],W.prototype,"shadowMinZ",null),(0,w.b)([(0,N.J)()],W.prototype,"shadowMaxZ",null)},11714:(d,t,A)=>{"use strict";A.d(t,{d:()=>B,e:()=>p,i:()=>X});const w={},N={};function p(d,t){w[d]=t}function B(d,t){N[d]=t}function X(d){return N[d]?N[d]:null}},11420:(d,t,A)=>{"use strict";A.d(t,{c:()=>V,e:()=>f});var w,N=A(10727),p=A(10730),B=A(11061),X=A(10775),W=A(10740),a=A(11347),D=A(10779),i=A(10787),k=A(10894),b=A(10824);!function(d){d[d.Clean=0]="Clean",d[d.Stop=1]="Stop",d[d.Sync=2]="Sync",d[d.NoSync=3]="NoSync"}(w||(w={}));const Q=new p.b,P={};let J=!1;function U(){return P[".babylon"]}function T(d){const t=P[d];return t||(W.e.Warn("Unable to find a plugin to load "+d+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),U())}function F(d,t,A){let w="Unable to load from "+(d.rawData?"binary data":d.url);return t?w+=`: ${t}`:A&&(w+=`: ${A}`),w}function q(d,t,A,w,N,p,B,X,W){var a;const i="data:"===(k=d.url).substring(0,5)?k.substring(5):null;var k;if(d.rawData&&!B)throw"When using ArrayBufferView to load data the file extension must be provided.";const J=B?T(B):i?function(d){for(const t in P){const A=P[t].plugin;if(A.canDirectLoad&&A.canDirectLoad(d))return P[t]}return U()}(d.url):function(d){const t=d.indexOf("?");-1!==t&&(d=d.substring(0,t));const A=d.lastIndexOf(".");return T(d.substring(A,d.length).toLowerCase())}(d.url);if(!J)throw new Error(`No plugin or fallback for ${B??d.url}`);if(!1===(null===W||void 0===W||null===(a=W[J.plugin.name])||void 0===a?void 0:a.enabled))throw new Error(`The '${J.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(d.rawData&&!J.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(d=>{if(J.plugin.createPlugin){const t=J.plugin.createPlugin(W??{});return t instanceof Promise?(t.then(d).catch((d=>{N("Error instantiating plugin.",d)})),null):(d(t),t)}return d(J.plugin),J.plugin})((W=>{var a;if(!W)throw`The loader plugin corresponding to the '${B}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(Q.notifyObservers(W),i&&(W.canDirectLoad&&W.canDirectLoad(d.url)||!(0,D.g)(d.url))){if(W.directLoad){const d=W.directLoad(t,i);d instanceof Promise?d.then((d=>{A(W,d)})).catch((d=>{N("Error in directLoad of _loadData: "+d,d)})):A(W,d)}else A(W,i);return}const k=J.isBinary,P=(d,w)=>{t.u?N("Scene has been disposed"):A(W,d,w)};let U=null,T=!1;null===(a=W.hj)||void 0===a||a.add((()=>{T=!0,U&&(U.abort(),U=null),p()}));const F=()=>{if(T)return;const A=(d,t)=>{N(null===d||void 0===d?void 0:d.statusText,t)};if(!W.loadFile&&d.rawData)throw"Plugin does not support loading ArrayBufferView.";U=W.loadFile?W.loadFile(t,d.rawData||d.file||d.url,d.rootUrl,P,w,k,A,X):t._loadFile(d.file||d.url,P,w,!0,k,A)},q=t.getEngine();let H=q.enableOfflineSupport;if(H){let A=!1;for(const w of t.disableOfflineSupportExceptionRules)if(w.test(d.url)){A=!0;break}H=!A}H&&b.c.OfflineProviderFactory?t.offlineProvider=b.c.OfflineProviderFactory(d.url,F,q.disableManifestCheck):F()}))}function H(d,t){let A,w,p=null,B=null;if(t)if(t.name)A=`file:${t.name}`,w=t.name,p=t;else if(ArrayBuffer.isView(t))A="",w=(0,k.c)(),B=t;else if(t.startsWith("data:"))A=t,w="";else if(d){const p=t;if("/"===p.substring(0,1))return N.g.Error("Wrong sceneFilename parameter"),null;A=d+p,w=p}else A=t,w=N.g.GetFilename(t),d=N.g.GetFolderPath(t);else A=d,w=N.g.GetFilename(d),d=N.g.GetFolderPath(d);return{url:A,rootUrl:d,name:w,file:p,rawData:B}}function f(d){if("string"===typeof d.extensions){const t=d.extensions;P[t.toLowerCase()]={plugin:d,isBinary:!1}}else{const t=d.extensions;Object.keys(t).forEach((A=>{P[A.toLowerCase()]={plugin:d,isBinary:t[A].isBinary}}))}}function v(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:X.e.LastCreatedScene,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",k=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!w)return W.e.Error("No scene available to import mesh to"),null;const b=H(t,A);if(!b)return null;const Q={};w.addPendingData(Q);const P=()=>{w.removePendingData(Q)},J=(d,t)=>{const A=F(b,d,t);B?B(w,A,new i.h(A,i.e.SceneLoaderError,t)):W.e.Error(A),P()},U=p?d=>{try{p(d)}catch(t){J("Error in onProgress callback: "+t,t)}}:void 0,T=(d,t,A,p,B,X,W,a)=>{if(w.importedMeshesFiles.push(b.url),N)try{N(d,t,A,p,B,X,W,a)}catch(D){J("Error in onSuccess callback: "+D,D)}w.removePendingData(Q)};return q(b,w,((t,A,N)=>{if(t.rewriteRootURL&&(b.rootUrl=t.rewriteRootURL(b.rootUrl,N)),t.importMesh){const N=[],p=[],B=[];if(!t.importMesh(d,w,A,b.rootUrl,N,p,B,J))return;w.loadingPluginName=t.name,T(N,p,B,[],[],[],[],[])}else{t.importMeshAsync(d,w,A,b.rootUrl,U,b.name).then((d=>{w.loadingPluginName=t.name,T(d.meshes,d.nj,d.skeletons,d.animationGroups,d.transformNodes,d.geometries,d.lights,d.spriteManagers)})).catch((d=>{J(d.message,d)}))}}),U,J,P,a,D,k)}function m(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.e.LastCreatedEngine,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return A?n(d,t,new B.e(A),w,p,W,a,D,i):(N.g.Error("No engine available"),null)}function j(d,t,A,w,N,p,B){return new Promise(((X,W)=>{m(d,t,A,(d=>{X(d)}),w,((d,t,A)=>{W(A||new Error(t))}),N,p,B)}))}function n(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.e.LastCreatedScene,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",k=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!A)return W.e.Error("No scene available to append to"),null;const b=H(d,t);if(!b)return null;const Q={};A.addPendingData(Q);const P=()=>{A.removePendingData(Q)};a.b.ShowLoadingScreen&&!J&&(J=!0,A.getEngine().displayLoadingUI(),A.executeWhenReady((()=>{A.getEngine().hideLoadingUI(),J=!1})));const U=(d,t)=>{const w=F(b,d,t);p?p(A,w,new i.h(w,i.e.SceneLoaderError,t)):W.e.Error(w),P()},T=N?d=>{try{N(d)}catch(t){U("Error in onProgress callback",t)}}:void 0,f=()=>{if(w)try{w(A)}catch(d){U("Error in onSuccess callback",d)}A.removePendingData(Q)};return q(b,A,((d,t)=>{if(d.load){if(!d.load(A,t,b.rootUrl,U))return;A.loadingPluginName=d.name,f()}else{d.loadAsync(A,t,b.rootUrl,T,b.name).then((()=>{A.loadingPluginName=d.name,f()})).catch((d=>{U(d.message,d)}))}}),T,U,P,B,D,k)}function R(d,t,A,w,N,p,B){return new Promise(((X,W)=>{n(d,t,A,(d=>{X(d)}),w,((d,t,A)=>{W(A||new Error(t))}),N,p,B)}))}function Z(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.e.LastCreatedScene,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!A)return W.e.Error("No scene available to load asset container to"),null;const k=H(d,t);if(!k)return null;const b={};A.addPendingData(b);const Q=()=>{A.removePendingData(b)},P=(d,t)=>{const w=F(k,d,t);p?p(A,w,new i.h(w,i.e.SceneLoaderError,t)):W.e.Error(w),Q()},J=N?d=>{try{N(d)}catch(t){P("Error in onProgress callback",t)}}:void 0,U=d=>{if(w)try{w(d)}catch(t){P("Error in onSuccess callback",t)}A.removePendingData(b)};return q(k,A,((d,t)=>{if(d.loadAssetContainer){const w=d.loadAssetContainer(A,t,k.rootUrl,P);if(!w)return;w.populateRootNodes(),A.loadingPluginName=d.name,U(w)}else if(d.loadAssetContainerAsync){d.loadAssetContainerAsync(A,t,k.rootUrl,J,k.name).then((t=>{t.populateRootNodes(),A.loadingPluginName=d.name,U(t)})).catch((d=>{P(d.message,d)}))}else P("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),J,P,Q,B,a,D)}function L(d,t,A,w,N,p,B){return new Promise(((X,W)=>{Z(d,t,A,(d=>{X(d)}),w,((d,t,A)=>{W(A||new Error(t))}),N,p,B)}))}function I(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X.e.LastCreatedScene,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,D=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,i=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,k=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",b=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!A)return void W.e.Error("No scene available to load animations to");if(w){for(const d of A.animatables)d.reset();A.stopAllAnimations(),A.animationGroups.slice().forEach((d=>{d.dispose()}));A.getNodes().forEach((d=>{d.animations&&(d.animations=[])}))}else switch(N){case 0:A.animationGroups.slice().forEach((d=>{d.dispose()}));break;case 1:A.animationGroups.forEach((d=>{d.stop()}));break;case 2:A.animationGroups.forEach((d=>{d.reset(),d.restart()}));break;case 3:break;default:return void W.e.Error("Unknown animation group loading mode value '"+N+"'")}const Q=A.animatables.length;Z(d,t,A,(d=>{d.mergeAnimationsTo(A,A.animatables.slice(Q),p),d.dispose(),A.onAnimationFileImportedObservable.notifyObservers(A),B&&B(A)}),a,D,i,k,b)}function u(d,t,A,w,N,p,B,X,W,a){return new Promise(((D,i)=>{I(d,t,A,w,N,p,(d=>{D(d)}),B,((d,t,A)=>{i(A||new Error(t))}),X,W,a)}))}class V{static get ForceFullSceneLoadingForIncremental(){return a.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(d){a.b.ForceFullSceneLoadingForIncremental=d}static get ShowLoadingScreen(){return a.b.ShowLoadingScreen}static set ShowLoadingScreen(d){a.b.ShowLoadingScreen=d}static get loggingLevel(){return a.b.loggingLevel}static set loggingLevel(d){a.b.loggingLevel=d}static get CleanBoneMatrixWeights(){return a.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(d){a.b.CleanBoneMatrixWeights=d}static GetDefaultPlugin(){return U()}static GetPluginForExtension(d){var t;return null===(t=T(d))||void 0===t?void 0:t.plugin}static IsPluginForExtensionAvailable(d){return function(d){return!!P[d]}(d)}static RegisterPlugin(d){f(d)}static ImportMesh(d,t,A,w,N,p,B,X,W){return v(d,t,A,w,N,p,B,X,W)}static ImportMeshAsync(d,t,A,w,N,p,B){return function(d,t,A,w,N,p,B,X){return new Promise(((W,a)=>{v(d,t,A,w,((d,t,A,w,N,p,B,X)=>{W({meshes:d,nj:t,skeletons:A,animationGroups:w,transformNodes:N,geometries:p,lights:B,spriteManagers:X})}),N,((d,t,A)=>{a(A||new Error(t))}),p,B,X)}))}(d,t,A,w,N,p,B)}static Load(d,t,A,w,N,p,B,X){return m(d,t,A,w,N,p,B,X)}static LoadAsync(d,t,A,w,N,p){return j(d,t,A,w,N,p)}static Append(d,t,A,w,N,p,B,X){return n(d,t,A,w,N,p,B,X)}static AppendAsync(d,t,A,w,N,p){return R(d,t,A,w,N,p)}static LoadAssetContainer(d,t,A,w,N,p,B,X){return Z(d,t,A,w,N,p,B,X)}static LoadAssetContainerAsync(d,t,A,w,N,p){return L(d,t,A,w,N,p)}static ImportAnimations(d,t,A,w,N,p,B,X,W,a,D){I(d,t,A,w,N,p,B,X,W,a,D)}static ImportAnimationsAsync(d,t,A,w,N,p,B,X,W,a,D){return u(d,t,A,w,N,p,X,a,D)}}V.NO_LOGGING=0,V.MINIMAL_LOGGING=1,V.SUMMARY_LOGGING=2,V.DETAILED_LOGGING=3,V.OnPluginActivatedObservable=Q},11347:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});class w{static get ForceFullSceneLoadingForIncremental(){return w._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(d){w._ForceFullSceneLoadingForIncremental=d}static get ShowLoadingScreen(){return w._ShowLoadingScreen}static set ShowLoadingScreen(d){w._ShowLoadingScreen=d}static get loggingLevel(){return w._LoggingLevel}static set loggingLevel(d){w._LoggingLevel=d}static get CleanBoneMatrixWeights(){return w._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(d){w._CleanBoneMatrixWeights=d}}w._ForceFullSceneLoadingForIncremental=!1,w._ShowLoadingScreen=!0,w._CleanBoneMatrixWeights=!1,w._LoggingLevel=0},12048:(d,t,A)=>{"use strict";A.d(t,{c:()=>K});var w=A(11041),N=A(11047),p=A(10740),B=A(11054),X=A(12040),W=A(11061),a=A(11076),D=A(11120),i=A(11257),k=A(11296);class b extends i.b{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class Q extends k.e{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(d,"PBRBRDF",90,new b,t),this._useEnergyConservation=Q.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=Q.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=Q.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=Q.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=Q.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=Q.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=Q.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=Q.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=d._dirtyCallbacks[16],this._enable(!0)}prepareDefines(d){d.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,d.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,d.SPHERICAL_HARMONICS=this._useSphericalHarmonics,d.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}Q.DEFAULT_USE_ENERGY_CONSERVATION=!0,Q.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,Q.DEFAULT_USE_SPHERICAL_HARMONICS=!0,Q.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],Q.prototype,"useEnergyConservation",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],Q.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],Q.prototype,"useSphericalHarmonics",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],Q.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var P=A(11198),J=A(11094),U=A(11092),T=A(11203),F=A(11260),q=A(11264),H=A(11280),f=(A(12052),A(11285)),v=A(11246);class m extends i.b{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class j extends k.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(d,"PBRClearCoat",100,new m,t),this._isEnabled=!1,this.isEnabled=!1,this.Yi=1,this.roughness=0,this._indexOfRefraction=j._DefaultIndexOfRefraction,this.indexOfRefraction=j._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=J.e.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=d._dirtyCallbacks[1]}isReadyForSubMesh(d,t,A){if(!this._isEnabled)return!0;const w=this._material._disableBumpMap;if(d._areTexturesDirty&&t.texturesEnabled){if(this._texture&&H.d.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&H.d.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(A.getCaps().standardDerivatives&&this._bumpTexture&&H.d.ClearCoatBumpTextureEnabled&&!w&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&H.d.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(d,t){this._isEnabled?(d.CLEARCOAT=!0,d.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,d.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,d._areTexturesDirty&&t.texturesEnabled&&(this._texture&&H.d.ClearCoatTextureEnabled?(0,v.O)(this._texture,d,"CLEARCOAT_TEXTURE"):d.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&H.d.ClearCoatTextureEnabled?(0,v.O)(this._textureRoughness,d,"CLEARCOAT_TEXTURE_ROUGHNESS"):d.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&H.d.ClearCoatBumpTextureEnabled?(0,v.O)(this._bumpTexture,d,"CLEARCOAT_BUMP"):d.CLEARCOAT_BUMP=!1,d.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===j._DefaultIndexOfRefraction,this._isTintEnabled?(d.CLEARCOAT_TINT=!0,this._tintTexture&&H.d.ClearCoatTintTextureEnabled?((0,v.O)(this._tintTexture,d,"CLEARCOAT_TINT_TEXTURE"),d.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):d.CLEARCOAT_TINT_TEXTURE=!1):(d.CLEARCOAT_TINT=!1,d.CLEARCOAT_TINT_TEXTURE=!1))):(d.CLEARCOAT=!1,d.CLEARCOAT_TEXTURE=!1,d.CLEARCOAT_TEXTURE_ROUGHNESS=!1,d.CLEARCOAT_BUMP=!1,d.CLEARCOAT_TINT=!1,d.CLEARCOAT_TINT_TEXTURE=!1,d.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,d.CLEARCOAT_DEFAULTIOR=!1,d.CLEARCOAT_TEXTUREDIRECTUV=0,d.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,d.CLEARCOAT_BUMPDIRECTUV=0,d.CLEARCOAT_REMAP_F0=!1,d.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,d.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(d,t,A,w){if(!this._isEnabled)return;const N=w.materialDefines,p=this._material.isFrozen,B=this._material._disableBumpMap,X=this._material._invertNormalMapX,W=this._material._invertNormalMapY;if(!d.useUbo||!p||!d.isSync){var a,D,i,k;if((this._texture||this._textureRoughness)&&H.d.ClearCoatTextureEnabled)d.updateFloat4("vClearCoatInfos",(null===(a=this._texture)||void 0===a?void 0:a.coordinatesIndex)??0,(null===(D=this._texture)||void 0===D?void 0:D.level)??0,(null===(i=this._textureRoughness)||void 0===i?void 0:i.coordinatesIndex)??0,(null===(k=this._textureRoughness)||void 0===k?void 0:k.level)??0),this._texture&&(0,v.r)(this._texture,d,"clearCoat"),this._textureRoughness&&!N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,v.r)(this._textureRoughness,d,"clearCoatRoughness");this._bumpTexture&&A.getCaps().standardDerivatives&&H.d.ClearCoatTextureEnabled&&!B&&(d.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,v.r)(this._bumpTexture,d,"clearCoatBump"),t._mirroredCameraPosition?d.updateFloat2("vClearCoatTangentSpaceParams",X?1:-1,W?1:-1):d.updateFloat2("vClearCoatTangentSpaceParams",X?-1:1,W?-1:1)),this._tintTexture&&H.d.ClearCoatTintTextureEnabled&&(d.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,v.r)(this._tintTexture,d,"clearCoatTint")),d.updateFloat2("vClearCoatParams",this.Yi,this.roughness);const w=1-this._indexOfRefraction,p=1+this._indexOfRefraction,b=Math.pow(-w/p,2),Q=1/this._indexOfRefraction;d.updateFloat4("vClearCoatRefractionParams",b,Q,w,p),this._isTintEnabled&&(d.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),d.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}t.texturesEnabled&&(this._texture&&H.d.ClearCoatTextureEnabled&&d.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!N.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&H.d.ClearCoatTextureEnabled&&d.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&A.getCaps().standardDerivatives&&H.d.ClearCoatBumpTextureEnabled&&!B&&d.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&H.d.ClearCoatTintTextureEnabled&&d.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(d){return this._texture===d||(this._textureRoughness===d||(this._bumpTexture===d||this._tintTexture===d))}getActiveTextures(d){this._texture&&d.push(this._texture),this._textureRoughness&&d.push(this._textureRoughness),this._bumpTexture&&d.push(this._bumpTexture),this._tintTexture&&d.push(this._tintTexture)}getAnimatables(d){this._texture&&this._texture.animations&&this._texture.animations.length>0&&d.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&d.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&d.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&d.push(this._tintTexture)}dispose(d){var t,A,w,N;d&&(null===(t=this._texture)||void 0===t||t.dispose(),null===(A=this._textureRoughness)||void 0===A||A.dispose(),null===(w=this._bumpTexture)||void 0===w||w.dispose(),null===(N=this._tintTexture)||void 0===N||N.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(d,t,A){return d.CLEARCOAT_BUMP&&t.addFallback(A++,"CLEARCOAT_BUMP"),d.CLEARCOAT_TINT&&t.addFallback(A++,"CLEARCOAT_TINT"),d.CLEARCOAT&&t.addFallback(A++,"CLEARCOAT"),A}getSamplers(d){d.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}j._DefaultIndexOfRefraction=1.5,(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isEnabled",void 0),(0,w.b)([(0,N.J)()],j.prototype,"intensity",void 0),(0,w.b)([(0,N.J)()],j.prototype,"roughness",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"indexOfRefraction",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"texture",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useRoughnessFromMainTexture",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"textureRoughness",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"remapF0OnInterfaceChange",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"bumpTexture",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"isTintEnabled",void 0),(0,w.b)([(0,N.i)()],j.prototype,"tintColor",void 0),(0,w.b)([(0,N.J)()],j.prototype,"tintColorAtDistance",void 0),(0,w.b)([(0,N.J)()],j.prototype,"tintThickness",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"tintTexture",void 0);class n extends i.b{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class R extends k.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(d,"PBRIridescence",110,new n,t),this._isEnabled=!1,this.isEnabled=!1,this.Yi=1,this.minimumThickness=R._DefaultMinimumThickness,this.maximumThickness=R._DefaultMaximumThickness,this.indexOfRefraction=R._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=d._dirtyCallbacks[1]}isReadyForSubMesh(d,t){if(!this._isEnabled)return!0;if(d._areTexturesDirty&&t.texturesEnabled){if(this._texture&&H.d.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&H.d.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(d,t){this._isEnabled?(d.IRIDESCENCE=!0,d._areTexturesDirty&&t.texturesEnabled&&(this._texture&&H.d.IridescenceTextureEnabled?(0,v.O)(this._texture,d,"IRIDESCENCE_TEXTURE"):d.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&H.d.IridescenceTextureEnabled?(0,v.O)(this._thicknessTexture,d,"IRIDESCENCE_THICKNESS_TEXTURE"):d.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(d.IRIDESCENCE=!1,d.IRIDESCENCE_TEXTURE=!1,d.IRIDESCENCE_THICKNESS_TEXTURE=!1,d.IRIDESCENCE_TEXTUREDIRECTUV=0,d.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(d,t){if(!this._isEnabled)return;const A=this._material.isFrozen;if(!d.useUbo||!A||!d.isSync){var w,N,p,B;if((this._texture||this._thicknessTexture)&&H.d.IridescenceTextureEnabled)d.updateFloat4("vIridescenceInfos",(null===(w=this._texture)||void 0===w?void 0:w.coordinatesIndex)??0,(null===(N=this._texture)||void 0===N?void 0:N.level)??0,(null===(p=this._thicknessTexture)||void 0===p?void 0:p.coordinatesIndex)??0,(null===(B=this._thicknessTexture)||void 0===B?void 0:B.level)??0),this._texture&&(0,v.r)(this._texture,d,"iridescence"),this._thicknessTexture&&(0,v.r)(this._thicknessTexture,d,"iridescenceThickness");d.updateFloat4("vIridescenceParams",this.Yi,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}t.texturesEnabled&&(this._texture&&H.d.IridescenceTextureEnabled&&d.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&H.d.IridescenceTextureEnabled&&d.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(d){return this._texture===d||this._thicknessTexture===d}getActiveTextures(d){this._texture&&d.push(this._texture),this._thicknessTexture&&d.push(this._thicknessTexture)}getAnimatables(d){this._texture&&this._texture.animations&&this._texture.animations.length>0&&d.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&d.push(this._thicknessTexture)}dispose(d){var t,A;d&&(null===(t=this._texture)||void 0===t||t.dispose(),null===(A=this._thicknessTexture)||void 0===A||A.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(d,t,A){return d.IRIDESCENCE&&t.addFallback(A++,"IRIDESCENCE"),A}getSamplers(d){d.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}R._DefaultMinimumThickness=100,R._DefaultMaximumThickness=400,R._DefaultIndexOfRefraction=1.3,(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isEnabled",void 0),(0,w.b)([(0,N.J)()],R.prototype,"intensity",void 0),(0,w.b)([(0,N.J)()],R.prototype,"minimumThickness",void 0),(0,w.b)([(0,N.J)()],R.prototype,"maximumThickness",void 0),(0,w.b)([(0,N.J)()],R.prototype,"indexOfRefraction",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"texture",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"thicknessTexture",void 0);class Z extends i.b{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class L extends k.e{set angle(d){this.direction.x=Math.cos(d),this.direction.y=Math.sin(d)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(d,"PBRAnisotropic",110,new Z,t),this._isEnabled=!1,this.isEnabled=!1,this.Yi=1,this.direction=new a.j(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=d._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=d._dirtyCallbacks[16]}isReadyForSubMesh(d,t){return!this._isEnabled||!(d._areTexturesDirty&&t.texturesEnabled&&this._texture&&H.d.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(d,t,A){this._isEnabled?(d.ANISOTROPIC=this._isEnabled,this._isEnabled&&!A.isVerticesDataPresent(D.f.TangentKind)&&(d._needUVs=!0,d.MAINUV1=!0),d._areTexturesDirty&&t.texturesEnabled&&(this._texture&&H.d.AnisotropicTextureEnabled?(0,v.O)(this._texture,d,"ANISOTROPIC_TEXTURE"):d.ANISOTROPIC_TEXTURE=!1),d._areMiscDirty&&(d.ANISOTROPIC_LEGACY=this._legacy)):(d.ANISOTROPIC=!1,d.ANISOTROPIC_TEXTURE=!1,d.ANISOTROPIC_TEXTUREDIRECTUV=0,d.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(d,t){if(!this._isEnabled)return;const A=this._material.isFrozen;d.useUbo&&A&&d.isSync||(this._texture&&H.d.AnisotropicTextureEnabled&&(d.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,v.r)(this._texture,d,"anisotropy")),d.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Yi)),t.texturesEnabled&&this._texture&&H.d.AnisotropicTextureEnabled&&d.setTexture("anisotropySampler",this._texture)}hasTexture(d){return this._texture===d}getActiveTextures(d){this._texture&&d.push(this._texture)}getAnimatables(d){this._texture&&this._texture.animations&&this._texture.animations.length>0&&d.push(this._texture)}dispose(d){d&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(d,t,A){return d.ANISOTROPIC&&t.addFallback(A++,"ANISOTROPIC"),A}getSamplers(d){d.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(d,t,A){super.parse(d,t,A),void 0===d.legacy&&(this.legacy=!0)}}(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"isEnabled",void 0),(0,w.b)([(0,N.J)()],L.prototype,"intensity",void 0),(0,w.b)([(0,N.F)()],L.prototype,"direction",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"texture",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsMiscDirty")],L.prototype,"legacy",void 0);class I extends i.b{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class u extends k.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(d,"Sheen",120,new I,t),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Yi=1,this.color=J.e.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=d._dirtyCallbacks[1]}isReadyForSubMesh(d,t){if(!this._isEnabled)return!0;if(d._areTexturesDirty&&t.texturesEnabled){if(this._texture&&H.d.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&H.d.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(d,t){this._isEnabled?(d.SHEEN=!0,d.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,d.SHEEN_ROUGHNESS=null!==this._roughness,d.SHEEN_ALBEDOSCALING=this._albedoScaling,d.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,d._areTexturesDirty&&t.texturesEnabled&&(this._texture&&H.d.SheenTextureEnabled?((0,v.O)(this._texture,d,"SHEEN_TEXTURE"),d.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):d.SHEEN_TEXTURE=!1,this._textureRoughness&&H.d.SheenTextureEnabled?(0,v.O)(this._textureRoughness,d,"SHEEN_TEXTURE_ROUGHNESS"):d.SHEEN_TEXTURE_ROUGHNESS=!1)):(d.SHEEN=!1,d.SHEEN_TEXTURE=!1,d.SHEEN_TEXTURE_ROUGHNESS=!1,d.SHEEN_LINKWITHALBEDO=!1,d.SHEEN_ROUGHNESS=!1,d.SHEEN_ALBEDOSCALING=!1,d.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,d.SHEEN_GAMMATEXTURE=!1,d.SHEEN_TEXTUREDIRECTUV=0,d.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(d,t,A,w){if(!this._isEnabled)return;const N=w.materialDefines,p=this._material.isFrozen;if(!d.useUbo||!p||!d.isSync){var B,X,W,a;if((this._texture||this._textureRoughness)&&H.d.SheenTextureEnabled)d.updateFloat4("vSheenInfos",(null===(B=this._texture)||void 0===B?void 0:B.coordinatesIndex)??0,(null===(X=this._texture)||void 0===X?void 0:X.level)??0,(null===(W=this._textureRoughness)||void 0===W?void 0:W.coordinatesIndex)??0,(null===(a=this._textureRoughness)||void 0===a?void 0:a.level)??0),this._texture&&(0,v.r)(this._texture,d,"sheen"),this._textureRoughness&&!N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,v.r)(this._textureRoughness,d,"sheenRoughness");d.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Yi),null!==this._roughness&&d.updateFloat("vSheenRoughness",this._roughness)}t.texturesEnabled&&(this._texture&&H.d.SheenTextureEnabled&&d.setTexture("sheenSampler",this._texture),this._textureRoughness&&!N.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&H.d.SheenTextureEnabled&&d.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(d){return this._texture===d||this._textureRoughness===d}getActiveTextures(d){this._texture&&d.push(this._texture),this._textureRoughness&&d.push(this._textureRoughness)}getAnimatables(d){this._texture&&this._texture.animations&&this._texture.animations.length>0&&d.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&d.push(this._textureRoughness)}dispose(d){var t,A;d&&(null===(t=this._texture)||void 0===t||t.dispose(),null===(A=this._textureRoughness)||void 0===A||A.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(d,t,A){return d.SHEEN&&t.addFallback(A++,"SHEEN"),A}getSamplers(d){d.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"isEnabled",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"linkSheenWithAlbedo",void 0),(0,w.b)([(0,N.J)()],u.prototype,"intensity",void 0),(0,w.b)([(0,N.i)()],u.prototype,"color",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"texture",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"useRoughnessFromMainTexture",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"roughness",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"textureRoughness",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],u.prototype,"albedoScaling",void 0);class V extends i.b{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class h extends k.e{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(d){this._scene.enableSubSurfaceForPrePass()&&d&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(d))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(d){this._volumeIndexOfRefraction=d>=1?d:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(d,"PBRSubSurface",130,new V,t),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=J.e.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=J.e.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=d.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=d._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=d._dirtyCallbacks[32]}isReadyForSubMesh(d,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(d._areTexturesDirty&&t.texturesEnabled){if(this._thicknessTexture&&H.d.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&H.d.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&H.d.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const d=this._getRefractionTexture(t);if(d&&H.d.RefractionTextureEnabled&&!d.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(d,t){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return d.SUBSURFACE=!1,d.SS_DISPERSION=!1,d.SS_TRANSLUCENCY=!1,d.SS_SCATTERING=!1,d.SS_REFRACTION=!1,d.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,d.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,d.SS_THICKNESSANDMASK_TEXTURE=!1,d.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,d.SS_HAS_THICKNESS=!1,d.SS_REFRACTIONINTENSITY_TEXTURE=!1,d.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,d.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,d.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,d.SS_REFRACTIONMAP_3D=!1,d.SS_REFRACTIONMAP_OPPOSITEZ=!1,d.SS_LODINREFRACTIONALPHA=!1,d.SS_GAMMAREFRACTION=!1,d.SS_RGBDREFRACTION=!1,d.SS_LINEARSPECULARREFRACTION=!1,d.SS_LINKREFRACTIONTOTRANSPARENCY=!1,d.SS_ALBEDOFORREFRACTIONTINT=!1,d.SS_ALBEDOFORTRANSLUCENCYTINT=!1,d.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,d.SS_USE_THICKNESS_AS_DEPTH=!1,d.SS_USE_GLTF_TEXTURES=!1,d.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(d.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(d._areTexturesDirty){if(d.SUBSURFACE=!0,d.SS_DISPERSION=this._isDispersionEnabled,d.SS_TRANSLUCENCY=this._isTranslucencyEnabled,d.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,d.SS_SCATTERING=this._isScatteringEnabled,d.SS_THICKNESSANDMASK_TEXTURE=!1,d.SS_REFRACTIONINTENSITY_TEXTURE=!1,d.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,d.SS_HAS_THICKNESS=!1,d.SS_USE_GLTF_TEXTURES=!1,d.SS_REFRACTION=!1,d.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,d.SS_REFRACTIONMAP_3D=!1,d.SS_GAMMAREFRACTION=!1,d.SS_RGBDREFRACTION=!1,d.SS_LINEARSPECULARREFRACTION=!1,d.SS_REFRACTIONMAP_OPPOSITEZ=!1,d.SS_LODINREFRACTIONALPHA=!1,d.SS_LINKREFRACTIONTOTRANSPARENCY=!1,d.SS_ALBEDOFORREFRACTIONTINT=!1,d.SS_ALBEDOFORTRANSLUCENCYTINT=!1,d.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,d.SS_USE_THICKNESS_AS_DEPTH=!1,d.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,d._areTexturesDirty&&t.texturesEnabled&&(this._thicknessTexture&&H.d.ThicknessTextureEnabled&&(0,v.O)(this._thicknessTexture,d,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&H.d.RefractionIntensityTextureEnabled&&(0,v.O)(this._refractionIntensityTexture,d,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&H.d.TranslucencyIntensityTextureEnabled&&(0,v.O)(this._translucencyIntensityTexture,d,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&H.d.TranslucencyColorTextureEnabled&&(0,v.O)(this._translucencyColorTexture,d,"SS_TRANSLUCENCYCOLOR_TEXTURE")),d.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,d.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,d.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,d.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&t.texturesEnabled){const A=this._getRefractionTexture(t);A&&H.d.RefractionTextureEnabled&&(d.SS_REFRACTION=!0,d.SS_REFRACTIONMAP_3D=A.isCube,d.SS_GAMMAREFRACTION=A.gammaSpace,d.SS_RGBDREFRACTION=A.isRGBD,d.SS_LINEARSPECULARREFRACTION=A.linearSpecularLOD,d.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&A.isCube?!A.invertZ:A.invertZ,d.SS_LODINREFRACTIONALPHA=A.lodLevelInAlpha,d.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,d.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,d.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=A.isCube&&A.boundingBoxSize,d.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(d.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(d,t,A,w){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)d.updateFloat2("vThicknessParam",0,0);else{w.getRenderingMesh().getWorldMatrix().decompose(a.h.gb[0]);const t=Math.max(Math.abs(a.h.gb[0].x),Math.abs(a.h.gb[0].y),Math.abs(a.h.gb[0].z));d.updateFloat2("vThicknessParam",this.minimumThickness*t,(this.maximumThickness-this.minimumThickness)*t)}}bindForSubMesh(d,t,A,w){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const N=w.materialDefines,p=this._material.isFrozen,B=this._material.realTimeFiltering,X=N.LODBASEDMICROSFURACE,W=this._getRefractionTexture(t);if(!d.useUbo||!p||!d.isSync){if(this._thicknessTexture&&H.d.ThicknessTextureEnabled&&(d.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,v.r)(this._thicknessTexture,d,"thickness")),this._refractionIntensityTexture&&H.d.RefractionIntensityTextureEnabled&&N.SS_REFRACTIONINTENSITY_TEXTURE&&(d.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,v.r)(this._refractionIntensityTexture,d,"refractionIntensity")),this._translucencyColorTexture&&H.d.TranslucencyColorTextureEnabled&&N.SS_TRANSLUCENCYCOLOR_TEXTURE&&(d.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,v.r)(this._translucencyColorTexture,d,"translucencyColor")),this._translucencyIntensityTexture&&H.d.TranslucencyIntensityTextureEnabled&&N.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(d.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,v.r)(this._translucencyIntensityTexture,d,"translucencyIntensity")),W&&H.d.RefractionTextureEnabled){d.Fj("refractionMatrix",W.getRefractionTextureMatrix());let t=1;W.isCube||W.depth&&(t=W.depth);const A=W.getSize().width,w=this.volumeIndexOfRefraction;if(d.updateFloat4("vRefractionInfos",W.level,1/w,t,this._invertRefractionY?-1:1),d.updateFloat4("vRefractionMicrosurfaceInfos",A,W.lodGenerationScale,W.lodGenerationOffset,1/this.indexOfRefraction),B&&d.updateFloat2("vRefractionFilteringInfo",A,Math.log2(A)),W.boundingBoxSize){const t=W;d.updateVector3("vRefractionPosition",t.boundingBoxPosition),d.updateVector3("vRefractionSize",t.boundingBoxSize)}}this._isScatteringEnabled&&d.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),d.updateColor3("vDiffusionDistance",this.diffusionDistance),d.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),d.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),d.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),d.updateFloat("dispersion",this.dispersion)}t.texturesEnabled&&(this._thicknessTexture&&H.d.ThicknessTextureEnabled&&d.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&H.d.RefractionIntensityTextureEnabled&&N.SS_REFRACTIONINTENSITY_TEXTURE&&d.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&H.d.TranslucencyIntensityTextureEnabled&&N.SS_TRANSLUCENCYINTENSITY_TEXTURE&&d.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&H.d.TranslucencyColorTextureEnabled&&N.SS_TRANSLUCENCYCOLOR_TEXTURE&&d.setTexture("translucencyColorSampler",this._translucencyColorTexture),W&&H.d.RefractionTextureEnabled&&(X?d.setTexture("refractionSampler",W):(d.setTexture("refractionSampler",W._lodTextureMid||W),d.setTexture("refractionSamplerLow",W._lodTextureLow||W),d.setTexture("refractionSamplerHigh",W._lodTextureHigh||W))))}_getRefractionTexture(d){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?d.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(d){H.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&d.push(this._refractionTexture)}hasTexture(d){return this._thicknessTexture===d||(this._refractionTexture===d||(this._refractionIntensityTexture===d||(this._translucencyIntensityTexture===d||this._translucencyColorTexture===d)))}hasRenderTargetTextures(){return!!(H.d.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(d){this._thicknessTexture&&d.push(this._thicknessTexture),this._refractionTexture&&d.push(this._refractionTexture),this._translucencyColorTexture&&d.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&d.push(this._translucencyIntensityTexture)}getAnimatables(d){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&d.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&d.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&d.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&d.push(this._translucencyIntensityTexture)}dispose(d){d&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(d,t,A){return d.SS_SCATTERING&&t.addFallback(A++,"SS_SCATTERING"),d.SS_TRANSLUCENCY&&t.addFallback(A++,"SS_TRANSLUCENCY"),A}getSamplers(d){d.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isRefractionEnabled",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isTranslucencyEnabled",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"isDispersionEnabled",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markScenePrePassDirty")],h.prototype,"isScatteringEnabled",void 0),(0,w.b)([(0,N.J)()],h.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,w.b)([(0,N.J)()],h.prototype,"refractionIntensity",void 0),(0,w.b)([(0,N.J)()],h.prototype,"translucencyIntensity",void 0),(0,w.b)([(0,N.J)()],h.prototype,"useAlbedoToTintRefraction",void 0),(0,w.b)([(0,N.J)()],h.prototype,"useAlbedoToTintTranslucency",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"thicknessTexture",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"refractionTexture",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"indexOfRefraction",void 0),(0,w.b)([(0,N.J)()],h.prototype,"_volumeIndexOfRefraction",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"volumeIndexOfRefraction",null),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"invertRefractionY",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"linkRefractionWithTransparency",void 0),(0,w.b)([(0,N.J)()],h.prototype,"minimumThickness",void 0),(0,w.b)([(0,N.J)()],h.prototype,"maximumThickness",void 0),(0,w.b)([(0,N.J)()],h.prototype,"useThicknessAsDepth",void 0),(0,w.b)([(0,N.i)()],h.prototype,"tintColor",void 0),(0,w.b)([(0,N.J)()],h.prototype,"tintColorAtDistance",void 0),(0,w.b)([(0,N.J)()],h.prototype,"dispersion",void 0),(0,w.b)([(0,N.i)()],h.prototype,"diffusionDistance",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useMaskFromThicknessTexture",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"refractionIntensityTexture",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"translucencyIntensityTexture",void 0),(0,w.b)([(0,N.i)()],h.prototype,"translucencyColor",void 0),(0,w.b)([(0,N.C)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"translucencyColorTexture",void 0),(0,w.b)([(0,N.J)(),(0,N.c)("_markAllSubMeshesAsTexturesDirty")],h.prototype,"useGltfStyleTextures",void 0);var l=A(11293),y=A(11254),s=A(11300);const Y={effect:null,subMesh:null};class r extends i.b{constructor(d){super(d),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class K extends F.b{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(d){this._realTimeFiltering=d,this.Cg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(d){this._realTimeFilteringQuality=d,this.Cg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(d){d!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=d||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(d,t){super(d,t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||K.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new a.m(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=K.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=J.e.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new J.e(0,0,0),this._albedoColor=new J.e(1,1,1),this._reflectivityColor=new J.e(1,1,1),this._reflectionColor=new J.e(1,1,1),this._emissiveColor=new J.e(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=K.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new B.d(16),this._globalAmbientColor=new J.e(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new Q(this),this.clearCoat=new j(this),this.iridescence=new R(this),this.anisotropy=new L(this),this.sheen=new u(this),this.subSurface=new h(this),this.detailMap=new l.b(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),H.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,X.c)(this.va()),this.prePassConfiguration=new P.c}get hasRenderTargetTextures(){return!!(H.d.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var d;return this._transparencyMode===K.PBRMATERIAL_OPAQUE||this._transparencyMode===K.PBRMATERIAL_ALPHATEST||(null===(d=this.subSurface)||void 0===d?void 0:d.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var d;return!!this._forceAlphaTest||(null===(d=this.subSurface)||void 0===d||!d.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===K.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.uc&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==K.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.uc||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(d,t,A){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const w=t._drawWrapper;if(w.effect&&this.isFrozen&&w._wasPreviouslyReady&&w._wasPreviouslyUsingInstances===A)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new r(this._eventInfo.defineNames));const N=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const B=this.va(),X=B.getEngine();if(N._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,B.texturesEnabled)){if(this._albedoTexture&&H.d.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&H.d.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&H.d.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const d=this._getReflectionTexture();if(d&&H.d.ReflectionTextureEnabled){if(!d.isReadyOrNotBlocking())return!1;var W;if(d.irradianceTexture){if(!d.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!d.sphericalPolynomial&&null!==(W=d.getInternalTexture())&&void 0!==W&&W._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&H.d.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&H.d.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(H.d.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(X.getCaps().standardDerivatives&&this._bumpTexture&&H.d.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&H.d.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=N,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(N._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;X.getCaps().standardDerivatives||d.isVerticesDataPresent(D.f.NormalKind)||(d.createNormals(!0),p.e.Warn("PBRMaterial: Normals have been created for the mesh: "+d.name));const a=t.effect,i=N._areLightsDisposed;let k=this._prepareEffect(d,N,this.onCompiled,this.onError,A,null,t.getRenderingMesh().hasThinInstances),b=!1;if(k)if(this._onEffectCreatedObservable&&(Y.effect=k,Y.subMesh=t,this._onEffectCreatedObservable.notifyObservers(Y)),this.allowShaderHotSwapping&&a&&!k.isReady()){if(k=a,N.markAsUnprocessed(),b=this.isFrozen,i)return N._areLightsDisposed=!0,!1}else B.resetCachedMaterial(),t.setEffect(k,N,this._materialContext);return!(!t.effect||!t.effect.isReady())&&(N._renderId=B.getRenderId(),w._wasPreviouslyReady=!b,w._wasPreviouslyUsingInstances=!!A,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(d,t){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(d,t,p,B,X),!t.isDirty)return null;t.markAsProcessed();const W=this.va().getEngine(),a=new f.b;let i=0;t.USESPHERICALINVERTEX&&a.addFallback(i++,"USESPHERICALINVERTEX"),t.FOG&&a.addFallback(i,"FOG"),t.SPECULARAA&&a.addFallback(i,"SPECULARAA"),t.POINTSIZE&&a.addFallback(i,"POINTSIZE"),t.LOGARITHMICDEPTH&&a.addFallback(i,"LOGARITHMICDEPTH"),t.PARALLAX&&a.addFallback(i,"PARALLAX"),t.PARALLAX_RHS&&a.addFallback(i,"PARALLAX_RHS"),t.PARALLAXOCCLUSION&&a.addFallback(i++,"PARALLAXOCCLUSION"),t.ENVIRONMENTBRDF&&a.addFallback(i++,"ENVIRONMENTBRDF"),t.TANGENT&&a.addFallback(i++,"TANGENT"),t.BUMP&&a.addFallback(i++,"BUMP"),i=(0,v.s)(t,a,this._maxSimultaneousLights,i++),t.SPECULARTERM&&a.addFallback(i++,"SPECULARTERM"),t.USESPHERICALFROMREFLECTIONMAP&&a.addFallback(i++,"USESPHERICALFROMREFLECTIONMAP"),t.USEIRRADIANCEMAP&&a.addFallback(i++,"USEIRRADIANCEMAP"),t.LIGHTMAP&&a.addFallback(i++,"LIGHTMAP"),t.NORMAL&&a.addFallback(i++,"NORMAL"),t.AMBIENT&&a.addFallback(i++,"AMBIENT"),t.EMISSIVE&&a.addFallback(i++,"EMISSIVE"),t.VERTEXCOLOR&&a.addFallback(i++,"VERTEXCOLOR"),t.MORPHTARGETS&&a.addFallback(i++,"MORPHTARGETS"),t.MULTIVIEW&&a.addFallback(0,"MULTIVIEW");const k=[D.f.PositionKind];t.NORMAL&&k.push(D.f.NormalKind),t.TANGENT&&k.push(D.f.TangentKind);for(let A=1;A<=6;++A)t["UV"+A]&&k.push(`uv${1===A?"":A}`);t.VERTEXCOLOR&&k.push(D.f.ColorKind),(0,v.v)(k,d,t,a),(0,v.y)(k,t),(0,v.B)(k,d,t),(0,v.u)(k,d,t);let b="pbr";const Q=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],J=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],T=["Material","Scene","Mesh"],F={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:t.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=a,this._eventInfo.fallbackRank=i,this._eventInfo.defines=t,this._eventInfo.uniforms=Q,this._eventInfo.attributes=k,this._eventInfo.samplers=J,this._eventInfo.uniformBuffersNames=T,this._eventInfo.customCode=void 0,this._eventInfo.mesh=d,this._eventInfo.indexParameters=F,this._callbackPluginEventGeneric(128,this._eventInfo),s.c.AddUniformsAndSamplers(Q,J),P.c.AddUniforms(Q),P.c.AddSamplers(J),(0,y.e)(Q),U.c&&(U.c.PrepareUniforms(Q,t),U.c.PrepareSamplers(J,t)),(0,v.bb)({uniformsNames:Q,uniformBuffersNames:T,samplers:J,defines:t,maxSimultaneousLights:this._maxSimultaneousLights});const q={};this.customShaderNameResolve&&(b=this.customShaderNameResolve(b,Q,T,J,t,k,q));const H=t.toString(),m=W.createEffect(b,{attributes:k,uniformsNames:Q,uniformBuffersNames:T,samplers:J,defines:H,fallbacks:a,onCompiled:w,onError:N,indexParameters:F,processFinalCode:q.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:t.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([A.e(21),A.e(43)]).then(A.bind(A,13297)),Promise.all([A.e(22),A.e(44)]).then(A.bind(A,13314))]):await Promise.all([Promise.all([A.e(25),A.e(45)]).then(A.bind(A,13320)),Promise.all([A.e(27),A.e(46)]).then(A.bind(A,13336))]),this._shadersLoaded=!0}},W);return this._eventInfo.customCode=void 0,m}_prepareDefines(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const p=this.va(),B=p.getEngine();(0,v.L)(p,d,t,!0,this._maxSimultaneousLights,this._disableLighting),t._needNormals=!0,(0,v.S)(p,t);const X=this.needAlphaBlendingForMesh(d)&&this.va().useOrderIndependentTransparency;if((0,v.Z)(p,t,this.canRenderToMRT&&!X),(0,v.V)(p,t,X),s.c.PrepareDefines(B.currentRenderPassId,d,t),t.METALLICWORKFLOW=this.isMetallicWorkflow(),t._areTexturesDirty){t._needUVs=!1;for(let d=1;d<=6;++d)t["MAINUV"+d]=!1;if(p.texturesEnabled){t.ALBEDODIRECTUV=0,t.AMBIENTDIRECTUV=0,t.OPACITYDIRECTUV=0,t.EMISSIVEDIRECTUV=0,t.REFLECTIVITYDIRECTUV=0,t.MICROSURFACEMAPDIRECTUV=0,t.METALLIC_REFLECTANCEDIRECTUV=0,t.REFLECTANCEDIRECTUV=0,t.BUMPDIRECTUV=0,t.LIGHTMAPDIRECTUV=0,B.getCaps().textureLOD&&(t.LODBASEDMICROSFURACE=!0),this._albedoTexture&&H.d.DiffuseTextureEnabled?((0,v.O)(this._albedoTexture,t,"ALBEDO"),t.GAMMAALBEDO=this._albedoTexture.gammaSpace):t.ALBEDO=!1,this._ambientTexture&&H.d.AmbientTextureEnabled?((0,v.O)(this._ambientTexture,t,"AMBIENT"),t.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):t.AMBIENT=!1,this._opacityTexture&&H.d.OpacityTextureEnabled?((0,v.O)(this._opacityTexture,t,"OPACITY"),t.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):t.OPACITY=!1;const d=this._getReflectionTexture();if(d&&H.d.ReflectionTextureEnabled){switch(t.REFLECTION=!0,t.GAMMAREFLECTION=d.gammaSpace,t.RGBDREFLECTION=d.isRGBD,t.LODINREFLECTIONALPHA=d.lodLevelInAlpha,t.LINEARSPECULARREFLECTION=d.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(t.NUM_SAMPLES=""+this.realTimeFilteringQuality,B._features.needTypeSuffixInShaderConstants&&(t.NUM_SAMPLES=t.NUM_SAMPLES+"u"),t.REALTIME_FILTERING=!0):t.REALTIME_FILTERING=!1,t.INVERTCUBICMAP=d.coordinatesMode===q.c.INVCUBIC_MODE,t.REFLECTIONMAP_3D=d.isCube,t.REFLECTIONMAP_OPPOSITEZ=t.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!d.invertZ:d.invertZ,t.REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,d.coordinatesMode){case q.c.EXPLICIT_MODE:t.REFLECTIONMAP_EXPLICIT=!0;break;case q.c.PLANAR_MODE:t.REFLECTIONMAP_PLANAR=!0;break;case q.c.PROJECTION_MODE:t.REFLECTIONMAP_PROJECTION=!0;break;case q.c.SKYBOX_MODE:t.REFLECTIONMAP_SKYBOX=!0;break;case q.c.SPHERICAL_MODE:t.REFLECTIONMAP_SPHERICAL=!0;break;case q.c.EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case q.c.FIXED_EQUIRECTANGULAR_MODE:t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case q.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case q.c.CUBIC_MODE:case q.c.INVCUBIC_MODE:default:t.REFLECTIONMAP_CUBIC=!0,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!!d.boundingBoxSize}d.coordinatesMode!==q.c.SKYBOX_MODE&&(d.irradianceTexture?(t.USEIRRADIANCEMAP=!0,t.USESPHERICALFROMREFLECTIONMAP=!1):d.isCube&&(t.USESPHERICALFROMREFLECTIONMAP=!0,t.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||B.getCaps().maxVaryingVectors<=8?t.USESPHERICALINVERTEX=!1:t.USESPHERICALINVERTEX=!0))}else t.REFLECTION=!1,t.REFLECTIONMAP_3D=!1,t.REFLECTIONMAP_SPHERICAL=!1,t.REFLECTIONMAP_PLANAR=!1,t.REFLECTIONMAP_CUBIC=!1,t.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,t.REFLECTIONMAP_PROJECTION=!1,t.REFLECTIONMAP_SKYBOX=!1,t.REFLECTIONMAP_EXPLICIT=!1,t.REFLECTIONMAP_EQUIRECTANGULAR=!1,t.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,t.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,t.INVERTCUBICMAP=!1,t.USESPHERICALFROMREFLECTIONMAP=!1,t.USEIRRADIANCEMAP=!1,t.USESPHERICALINVERTEX=!1,t.REFLECTIONMAP_OPPOSITEZ=!1,t.LODINREFLECTIONALPHA=!1,t.GAMMAREFLECTION=!1,t.RGBDREFLECTION=!1,t.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&H.d.LightmapTextureEnabled?((0,v.O)(this._lightmapTexture,t,"LIGHTMAP"),t.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,t.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,t.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):t.LIGHTMAP=!1,this._emissiveTexture&&H.d.EmissiveTextureEnabled?((0,v.O)(this._emissiveTexture,t,"EMISSIVE"),t.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):t.EMISSIVE=!1,H.d.SpecularTextureEnabled?(this._metallicTexture?((0,v.O)(this._metallicTexture,t,"REFLECTIVITY"),t.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,t.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,t.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,t.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,t.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,v.O)(this._reflectivityTexture,t,"REFLECTIVITY"),t.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,t.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,t.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):t.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(t.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,v.O)(this._metallicReflectanceTexture,t,"METALLIC_REFLECTANCE"),t.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):t.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,v.O)(this._reflectanceTexture,t,"REFLECTANCE"),t.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):t.REFLECTANCE=!1):(t.METALLIC_REFLECTANCE=!1,t.REFLECTANCE=!1),this._microSurfaceTexture?(0,v.O)(this._microSurfaceTexture,t,"MICROSURFACEMAP"):t.MICROSURFACEMAP=!1):(t.REFLECTIVITY=!1,t.MICROSURFACEMAP=!1),B.getCaps().standardDerivatives&&this._bumpTexture&&H.d.BumpTextureEnabled&&!this._disableBumpMap?((0,v.O)(this._bumpTexture,t,"BUMP"),this._useParallax&&this._albedoTexture&&H.d.DiffuseTextureEnabled?(t.PARALLAX=!0,t.PARALLAX_RHS=p.useRightHandedSystem,t.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):t.PARALLAX=!1,t.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(t.BUMP=!1,t.PARALLAX=!1,t.PARALLAX_RHS=!1,t.PARALLAXOCCLUSION=!1,t.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&H.d.ReflectionTextureEnabled?(t.ENVIRONMENTBRDF=!0,t.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(t.ENVIRONMENTBRDF=!1,t.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?t.ALPHAFROMALBEDO=!0:t.ALPHAFROMALBEDO=!1}t.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===K.LIGHTFALLOFF_STANDARD?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===K.LIGHTFALLOFF_GLTF?(t.USEPHYSICALLIGHTFALLOFF=!1,t.USEGLTFLIGHTFALLOFF=!0):(t.USEPHYSICALLIGHTFALLOFF=!0,t.USEGLTFLIGHTFALLOFF=!1),t.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Tg&&this._twoSidedLighting?t.TWOSIDEDLIGHTING=!0:t.TWOSIDEDLIGHTING=!1,t.SPECULARAA=B.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(t._areTexturesDirty||t._areMiscDirty)&&(t.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,t.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,t.ALPHABLEND=this.needAlphaBlendingForMesh(d),t.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,t.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),t._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(t),t.FORCENORMALFORWARD=this._forceNormalForward,t.RADIANCEOCCLUSION=this._useRadianceOcclusion,t.HORIZONOCCLUSION=this._useHorizonOcclusion,t._areMiscDirty&&((0,v.R)(d,p,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(d)||this._forceAlphaTest,t,this._applyDecalMapAfterDetailMap),t.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!d.isVerticesDataPresent(D.f.NormalKind),t.DEBUGMODE=this._debugMode),(0,v.I)(p,B,this,t,!!A,w,N),this._eventInfo.defines=t,this._eventInfo.mesh=d,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,v.E)(d,t,!0,!0,!0,this._transparencyMode!==K.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(d,t,A){const w={clipPlane:!1,useInstances:!1,...A};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const A=new r(this._eventInfo.defineNames),N=this._prepareEffect(d,A,void 0,void 0,w.useInstances,w.clipPlane,d.hasThinInstances);this._onEffectCreatedObservable&&(Y.effect=N,Y.subMesh=null,this._onEffectCreatedObservable.notifyObservers(Y)),N.isReady()?t&&t(this):N.onCompileObservable.add((()=>{t&&t(this)}))})()}buildUniformLayout(){const d=this._uniformBuffer;d.addUniform("vAlbedoInfos",2),d.addUniform("vAmbientInfos",4),d.addUniform("vOpacityInfos",2),d.addUniform("vEmissiveInfos",2),d.addUniform("vLightmapInfos",2),d.addUniform("vReflectivityInfos",3),d.addUniform("vMicroSurfaceSamplerInfos",2),d.addUniform("vReflectionInfos",2),d.addUniform("vReflectionFilteringInfo",2),d.addUniform("vReflectionPosition",3),d.addUniform("vReflectionSize",3),d.addUniform("vBumpInfos",3),d.addUniform("albedoMatrix",16),d.addUniform("ambientMatrix",16),d.addUniform("opacityMatrix",16),d.addUniform("emissiveMatrix",16),d.addUniform("lightmapMatrix",16),d.addUniform("reflectivityMatrix",16),d.addUniform("microSurfaceSamplerMatrix",16),d.addUniform("bumpMatrix",16),d.addUniform("vTangentSpaceParams",2),d.addUniform("reflectionMatrix",16),d.addUniform("vReflectionColor",3),d.addUniform("vAlbedoColor",4),d.addUniform("vLightingIntensity",4),d.addUniform("vReflectionMicrosurfaceInfos",3),d.addUniform("pointSize",1),d.addUniform("vReflectivityColor",4),d.addUniform("vEmissiveColor",3),d.addUniform("vAmbientColor",3),d.addUniform("vDebugMode",2),d.addUniform("vMetallicReflectanceFactors",4),d.addUniform("vMetallicReflectanceInfos",2),d.addUniform("metallicReflectanceMatrix",16),d.addUniform("vReflectanceInfos",2),d.addUniform("reflectanceMatrix",16),d.addUniform("vSphericalL00",3),d.addUniform("vSphericalL1_1",3),d.addUniform("vSphericalL10",3),d.addUniform("vSphericalL11",3),d.addUniform("vSphericalL2_2",3),d.addUniform("vSphericalL2_1",3),d.addUniform("vSphericalL20",3),d.addUniform("vSphericalL21",3),d.addUniform("vSphericalL22",3),d.addUniform("vSphericalX",3),d.addUniform("vSphericalY",3),d.addUniform("vSphericalZ",3),d.addUniform("vSphericalXX_ZZ",3),d.addUniform("vSphericalYY_ZZ",3),d.addUniform("vSphericalZZ",3),d.addUniform("vSphericalXY",3),d.addUniform("vSphericalYZ",3),d.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(d,t,A){const w=this.va(),N=A.materialDefines;if(!N)return;const p=A.effect;if(!p)return;this._activeEffect=p,t.getMeshUniformBuffer().bindToEffect(p,"Mesh"),t.transferToEffect(d);const B=w.getEngine();this._uniformBuffer.bindToEffect(p,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,w,t,d,this.isFrozen),s.c.Bind(B.currentRenderPassId,this._activeEffect,t,d),this._eventInfo.subMesh=A,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),N.OBJECTSPACE_NORMALMAP&&(d.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const X=this._mustRebind(w,p,A,t.visibility);(0,v.c)(t,this._activeEffect,this.prePassConfiguration);let a=null;const D=this._uniformBuffer;if(X){if(this.bindViewProjection(p),a=this._getReflectionTexture(),!D.useUbo||!this.isFrozen||!D.isSync||A._drawWrapper._forceRebindOnNextCall){var i;if(w.texturesEnabled){if(this._albedoTexture&&H.d.DiffuseTextureEnabled&&(D.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,v.r)(this._albedoTexture,D,"albedo")),this._ambientTexture&&H.d.AmbientTextureEnabled&&(D.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,v.r)(this._ambientTexture,D,"ambient")),this._opacityTexture&&H.d.OpacityTextureEnabled&&(D.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,v.r)(this._opacityTexture,D,"opacity")),a&&H.d.ReflectionTextureEnabled){if(D.Fj("reflectionMatrix",a.getReflectionTextureMatrix()),D.updateFloat2("vReflectionInfos",a.level,0),a.boundingBoxSize){const d=a;D.updateVector3("vReflectionPosition",d.boundingBoxPosition),D.updateVector3("vReflectionSize",d.boundingBoxSize)}if(this.realTimeFiltering){const d=a.getSize().width;D.updateFloat2("vReflectionFilteringInfo",d,Math.log2(d))}if(!N.USEIRRADIANCEMAP){const d=a.sphericalPolynomial;if(N.USESPHERICALFROMREFLECTIONMAP&&d)if(N.SPHERICAL_HARMONICS){const t=d.preScaledHarmonics;D.updateVector3("vSphericalL00",t.l00),D.updateVector3("vSphericalL1_1",t.l1_1),D.updateVector3("vSphericalL10",t.l10),D.updateVector3("vSphericalL11",t.l11),D.updateVector3("vSphericalL2_2",t.l2_2),D.updateVector3("vSphericalL2_1",t.l2_1),D.updateVector3("vSphericalL20",t.l20),D.updateVector3("vSphericalL21",t.l21),D.updateVector3("vSphericalL22",t.l22)}else D.updateFloat3("vSphericalX",d.x.x,d.x.y,d.x.z),D.updateFloat3("vSphericalY",d.y.x,d.y.y,d.y.z),D.updateFloat3("vSphericalZ",d.z.x,d.z.y,d.z.z),D.updateFloat3("vSphericalXX_ZZ",d.xx.x-d.zz.x,d.xx.y-d.zz.y,d.xx.z-d.zz.z),D.updateFloat3("vSphericalYY_ZZ",d.yy.x-d.zz.x,d.yy.y-d.zz.y,d.yy.z-d.zz.z),D.updateFloat3("vSphericalZZ",d.zz.x,d.zz.y,d.zz.z),D.updateFloat3("vSphericalXY",d.xy.x,d.xy.y,d.xy.z),D.updateFloat3("vSphericalYZ",d.yz.x,d.yz.y,d.yz.z),D.updateFloat3("vSphericalZX",d.zx.x,d.zx.y,d.zx.z)}D.updateFloat3("vReflectionMicrosurfaceInfos",a.getSize().width,a.lodGenerationScale,a.lodGenerationOffset)}this._emissiveTexture&&H.d.EmissiveTextureEnabled&&(D.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,v.r)(this._emissiveTexture,D,"emissive")),this._lightmapTexture&&H.d.LightmapTextureEnabled&&(D.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,v.r)(this._lightmapTexture,D,"lightmap")),H.d.SpecularTextureEnabled&&(this._metallicTexture?(D.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,v.r)(this._metallicTexture,D,"reflectivity")):this._reflectivityTexture&&(D.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,v.r)(this._reflectivityTexture,D,"reflectivity")),this._metallicReflectanceTexture&&(D.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,v.r)(this._metallicReflectanceTexture,D,"metallicReflectance")),this._reflectanceTexture&&N.REFLECTANCE&&(D.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,v.r)(this._reflectanceTexture,D,"reflectance")),this._microSurfaceTexture&&(D.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,v.r)(this._microSurfaceTexture,D,"microSurfaceSampler"))),this._bumpTexture&&B.getCaps().standardDerivatives&&H.d.BumpTextureEnabled&&!this._disableBumpMap&&(D.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,v.r)(this._bumpTexture,D,"bump"),w._mirroredCameraPosition?D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):D.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&D.updateFloat("pointSize",this.pointSize),N.METALLICWORKFLOW){var k;J.j.jb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,J.j.jb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,D.updateColor4("vReflectivityColor",J.j.jb[0],1);const d=(null===(k=this.subSurface)||void 0===k?void 0:k._indexOfRefraction)??1.5,t=1,A=Math.pow((d-t)/(d+t),2);this._metallicReflectanceColor.scaleToRef(A*this._metallicF0Factor,J.j.jb[0]);const w=this._metallicF0Factor;D.updateColor4("vMetallicReflectanceFactors",J.j.jb[0],w)}else D.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);D.updateColor3("vEmissiveColor",H.d.EmissiveTextureEnabled?this._emissiveColor:J.e.BlackReadOnly),D.updateColor3("vReflectionColor",this._reflectionColor),!N.SS_REFRACTION&&null!==(i=this.subSurface)&&void 0!==i&&i._linkRefractionWithTransparency?D.updateColor4("vAlbedoColor",this._albedoColor,1):D.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*w.environmentIntensity,this._lightingInfos.w=this._specularIntensity,D.updateVector4("vLightingIntensity",this._lightingInfos),w.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),D.updateColor3("vAmbientColor",this._globalAmbientColor),D.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}w.texturesEnabled&&(this._albedoTexture&&H.d.DiffuseTextureEnabled&&D.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&H.d.AmbientTextureEnabled&&D.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&H.d.OpacityTextureEnabled&&D.setTexture("opacitySampler",this._opacityTexture),a&&H.d.ReflectionTextureEnabled&&(N.LODBASEDMICROSFURACE?D.setTexture("reflectionSampler",a):(D.setTexture("reflectionSampler",a._lodTextureMid||a),D.setTexture("reflectionSamplerLow",a._lodTextureLow||a),D.setTexture("reflectionSamplerHigh",a._lodTextureHigh||a)),N.USEIRRADIANCEMAP&&D.setTexture("irradianceSampler",a.irradianceTexture)),N.ENVIRONMENTBRDF&&D.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&H.d.EmissiveTextureEnabled&&D.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&H.d.LightmapTextureEnabled&&D.setTexture("lightmapSampler",this._lightmapTexture),H.d.SpecularTextureEnabled&&(this._metallicTexture?D.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&D.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&D.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&N.REFLECTANCE&&D.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&D.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&B.getCaps().standardDerivatives&&H.d.BumpTextureEnabled&&!this._disableBumpMap&&D.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.va().depthPeelingRenderer.bind(p),this._eventInfo.subMesh=A,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,y.g)(this._activeEffect,this,w),this.bindEyePosition(p)}else w.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(X||!this.isFrozen){var b;if(w.lightsEnabled&&!this._disableLighting&&(0,v.h)(w,t,this._activeEffect,N,this._maxSimultaneousLights),(w.fogEnabled&&t.applyFog&&w.fogMode!==W.e.FOGMODE_NONE||a||this.subSurface.refractionTexture||t.receiveShadows||N.PREPASS)&&this.bindView(p),(0,v.e)(w,t,this._activeEffect,!0),N.NUM_MORPH_INFLUENCERS&&(0,v.l)(t,this._activeEffect),N.BAKED_VERTEX_ANIMATION_TEXTURE)null===(b=t.bakedVertexAnimationManager)||void 0===b||b.bind(p,N.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,v.k)(N,this._activeEffect,w)}this._afterBind(t,this._activeEffect,A),D.update()}getAnimatables(){const d=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&d.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&d.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&d.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&d.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&d.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?d.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&d.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&d.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&d.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&d.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&d.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&d.push(this._microSurfaceTexture),d}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const d=super.getActiveTextures();return this._albedoTexture&&d.push(this._albedoTexture),this._ambientTexture&&d.push(this._ambientTexture),this._opacityTexture&&d.push(this._opacityTexture),this._reflectionTexture&&d.push(this._reflectionTexture),this._emissiveTexture&&d.push(this._emissiveTexture),this._reflectivityTexture&&d.push(this._reflectivityTexture),this._metallicTexture&&d.push(this._metallicTexture),this._metallicReflectanceTexture&&d.push(this._metallicReflectanceTexture),this._reflectanceTexture&&d.push(this._reflectanceTexture),this._microSurfaceTexture&&d.push(this._microSurfaceTexture),this._bumpTexture&&d.push(this._bumpTexture),this._lightmapTexture&&d.push(this._lightmapTexture),d}hasTexture(d){return!!super.hasTexture(d)||(this._albedoTexture===d||(this._ambientTexture===d||(this._opacityTexture===d||(this._reflectionTexture===d||(this._emissiveTexture===d||(this._reflectivityTexture===d||(this._metallicTexture===d||(this._metallicReflectanceTexture===d||(this._reflectanceTexture===d||(this._microSurfaceTexture===d||(this._bumpTexture===d||this._lightmapTexture===d)))))))))))}setPrePassRenderer(){var d;if(null===(d=this.subSurface)||void 0===d||!d.isScatteringEnabled)return!1;const t=this.va().enableSubSurfaceForPrePass();return t&&(t.enabled=!0),!0}dispose(d,t){var A,w,N,p,B,X,W,a,D,i,k,b;(this._breakShaderLoadedCheck=!0,t)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(A=this._albedoTexture)||void 0===A||A.dispose(),null===(w=this._ambientTexture)||void 0===w||w.dispose(),null===(N=this._opacityTexture)||void 0===N||N.dispose(),null===(p=this._reflectionTexture)||void 0===p||p.dispose(),null===(B=this._emissiveTexture)||void 0===B||B.dispose(),null===(X=this._metallicTexture)||void 0===X||X.dispose(),null===(W=this._reflectivityTexture)||void 0===W||W.dispose(),null===(a=this._bumpTexture)||void 0===a||a.dispose(),null===(D=this._lightmapTexture)||void 0===D||D.dispose(),null===(i=this._metallicReflectanceTexture)||void 0===i||i.dispose(),null===(k=this._reflectanceTexture)||void 0===k||k.dispose(),null===(b=this._microSurfaceTexture)||void 0===b||b.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(d,t)}}K.PBRMATERIAL_OPAQUE=T.c.MATERIAL_OPAQUE,K.PBRMATERIAL_ALPHATEST=T.c.MATERIAL_ALPHATEST,K.PBRMATERIAL_ALPHABLEND=T.c.MATERIAL_ALPHABLEND,K.PBRMATERIAL_ALPHATESTANDBLEND=T.c.MATERIAL_ALPHATESTANDBLEND,K.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,K.LIGHTFALLOFF_PHYSICAL=0,K.LIGHTFALLOFF_GLTF=1,K.LIGHTFALLOFF_STANDARD=2,K.ForceGLSL=!1,(0,w.b)([(0,N.s)()],K.prototype,"_imageProcessingConfiguration",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsMiscDirty")],K.prototype,"debugMode",void 0)},10869:(d,t,A)=>{"use strict";A.d(t,{d:()=>B});var w=A(10740);const N=new Map;function p(d,t){(function(d){return N.delete(d)})(d)&&w.e.Warn(`Extension with the name '${name}' already exists`),N.set(d,t)}function B(d,t){"image/ktx"!==t&&"image/ktx2"!==t||(d=".ktx"),N.has(d)||(d.endsWith(".dds")&&p(".dds",(()=>A.e(12).then(A.bind(A,12756)).then((d=>new d._DDSTextureLoader)))),d.endsWith(".basis")&&p(".basis",(()=>A.e(13).then(A.bind(A,12761)).then((d=>new d._BasisTextureLoader)))),d.endsWith(".env")&&p(".env",(()=>A.e(14).then(A.bind(A,12766)).then((d=>new d._ENVTextureLoader)))),d.endsWith(".hdr")&&p(".hdr",(()=>A.e(15).then(A.bind(A,12773)).then((d=>new d._HDRTextureLoader)))),(d.endsWith(".ktx")||d.endsWith(".ktx2"))&&(p(".ktx",(()=>A.e(16).then(A.bind(A,12779)).then((d=>new d._KTXTextureLoader)))),p(".ktx2",(()=>A.e(16).then(A.bind(A,12779)).then((d=>new d._KTXTextureLoader))))),d.endsWith(".tga")&&p(".tga",(()=>A.e(17).then(A.bind(A,12783)).then((d=>new d._TGATextureLoader)))),d.endsWith(".exr")&&p(".exr",(()=>A.e(18).then(A.bind(A,12789)).then((d=>new d._ExrTextureLoader)))));const w=N.get(d);return w?Promise.resolve(w(t)):null}},11266:(d,t,A)=>{"use strict";A.d(t,{e:()=>k});var w=A(11041),N=A(11047),p=A(10730),B=A(11076),X=A(10775),W=A(10894),a=(A(10779),A(11268));class D{get wrapU(){return this._wrapU}set wrapU(d){this._wrapU=d}get wrapV(){return this._wrapV}set wrapV(d){this._wrapV=d}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(d){this._texture&&(this._texture.isCube=d)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(d){this._texture&&(this._texture.is3D=d)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(d){this._texture&&(this._texture.is2DArray=d)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(d){return void 0!==(null===d||void 0===d?void 0:d.shareDepth)}constructor(d){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=a.e.Zero(),this._cachedBaseSize=a.e.Zero(),this._initialSamplingMode=2,this._texture=D._IsRenderTargetWrapper(d)?d.texture:d,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(d){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(d,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var i=A(11097);class k extends D{set uc(d){this._hasAlpha!==d&&(this._hasAlpha=d,this._scene&&this._scene.markAllMaterialsAsDirty(1,(d=>d.hasTexture(this))))}get uc(){return this._hasAlpha}set getAlphaFromRGB(d){this._getAlphaFromRGB!==d&&(this._getAlphaFromRGB=d,this._scene&&this._scene.markAllMaterialsAsDirty(1,(d=>d.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(d){this._coordinatesIndex!==d&&(this._coordinatesIndex=d,this._scene&&this._scene.markAllMaterialsAsDirty(1,(d=>d.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(d){this._coordinatesMode!==d&&(this._coordinatesMode=d,this._scene&&this._scene.markAllMaterialsAsDirty(1,(d=>d.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(d){this._wrapU=d}get wrapV(){return this._wrapV}set wrapV(d){this._wrapV=d}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(d){this._texture?this._texture.isCube=d:this._isCube=d}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(d){this._texture&&(this._texture.is3D=d)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(d){this._texture&&(this._texture.is2DArray=d)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(d){var t;if(this._texture){if(this._texture._gammaSpace===d)return;this._texture._gammaSpace=d}else{if(this._gammaSpace===d)return;this._gammaSpace=d}null===(t=this.va())||void 0===t||t.markAllMaterialsAsDirty(1,(d=>d.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(d){var t;d!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=d),null===(t=this.va())||void 0===t||t.markAllMaterialsAsDirty(1,(d=>d.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(d){this._texture&&(this._texture._lodGenerationOffset=d)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(d){this._texture&&(this._texture._lodGenerationScale=d)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(d){this._texture&&(this._texture._linearSpecularLOD=d)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(d){this._texture&&(this._texture._irradianceTexture=d)}get uid(){return this._uid||(this._uid=(0,W.c)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(d){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(d)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=k.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.hj=new p.b,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,d?k._IsScene(d)?this._scene=d:this._engine=d:this._scene=X.e.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=t,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return B.c.IdentityReadOnly}getReflectionTextureMatrix(){return B.c.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(d){}get canRescale(){return!1}_getFromCache(d,t,A,w,N,p){const B=this._getEngine();if(!B)return null;const X=B._getUseSRGBBuffer(!!N,t),W=B.getLoadedTexturesCache();for(let a=0;a<W.length;a++){const B=W[a];if((void 0===N||X===B._useSRGBBuffer)&&(void 0===w||w===B.invertY)&&B.url===d&&B.generateMipMaps===!t&&(!A||A===B.samplingMode)&&(void 0===p||p===B.isCube))return B.incrementReferences(),B}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const d=this.va();d&&d.markAllMaterialsAsDirty(1)}readPixels(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const a=this._getEngine();if(!a)return null;const D=this.getSize();let i=D.width,k=D.height;0!==t&&(i/=Math.pow(2,t),k/=Math.pow(2,t),i=Math.round(i),k=Math.round(k)),X=Math.min(i,X),W=Math.min(k,W);try{return this._texture.isCube?a._readTexturePixels(this._texture,X,W,d,t,A,w,N,p,B):a._readTexturePixels(this._texture,X,W,-1,t,A,w,N,p,B)}catch(b){return null}}_readPixelsSync(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const p=this.getSize();let B=p.width,X=p.height;const W=this._getEngine();if(!W)return null;0!=t&&(B/=Math.pow(2,t),X/=Math.pow(2,t),B=Math.round(B),X=Math.round(X));try{return this._texture.isCube?W._readTexturePixelsSync(this._texture,B,X,d,t,A,w,N):W._readTexturePixelsSync(this._texture,B,X,-1,t,A,w,N)}catch(a){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const d=this._scene.textures.indexOf(this);if(d>=0&&this._scene.textures.splice(d,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const d=this._parentContainer.textures.indexOf(this);d>-1&&this._parentContainer.textures.splice(d,1),this._parentContainer=null}}this.hj.notifyObservers(this),this.hj.clear(),this.metadata=null,super.dispose()}serialize(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!d)return null;const t=i.d.Serialize(this);return i.d.AppendSerializedAnimations(this,t),t}static WhenAllReady(d,t){let A=d.length;if(0!==A)for(let w=0;w<d.length;w++){const N=d[w];if(N.isReady())0===--A&&t();else{const d=N.onLoadObservable;d?d.addOnce((()=>{0===--A&&t()})):0===--A&&t()}}else t()}static _IsScene(d){return"Scene"===d.getClassName()}}k.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,w.b)([(0,N.J)()],k.prototype,"uniqueId",void 0),(0,w.b)([(0,N.J)()],k.prototype,"name",void 0),(0,w.b)([(0,N.J)()],k.prototype,"metadata",void 0),(0,w.b)([(0,N.J)("uc")],k.prototype,"_hasAlpha",void 0),(0,w.b)([(0,N.J)("getAlphaFromRGB")],k.prototype,"_getAlphaFromRGB",void 0),(0,w.b)([(0,N.J)()],k.prototype,"level",void 0),(0,w.b)([(0,N.J)("coordinatesIndex")],k.prototype,"_coordinatesIndex",void 0),(0,w.b)([(0,N.J)()],k.prototype,"optimizeUVAllocation",void 0),(0,w.b)([(0,N.J)("coordinatesMode")],k.prototype,"_coordinatesMode",void 0),(0,w.b)([(0,N.J)()],k.prototype,"wrapU",null),(0,w.b)([(0,N.J)()],k.prototype,"wrapV",null),(0,w.b)([(0,N.J)()],k.prototype,"wrapR",void 0),(0,w.b)([(0,N.J)()],k.prototype,"anisotropicFilteringLevel",void 0),(0,w.b)([(0,N.J)()],k.prototype,"isCube",null),(0,w.b)([(0,N.J)()],k.prototype,"is3D",null),(0,w.b)([(0,N.J)()],k.prototype,"is2DArray",null),(0,w.b)([(0,N.J)()],k.prototype,"gammaSpace",null),(0,w.b)([(0,N.J)()],k.prototype,"invertZ",void 0),(0,w.b)([(0,N.J)()],k.prototype,"lodLevelInAlpha",void 0),(0,w.b)([(0,N.J)()],k.prototype,"lodGenerationOffset",null),(0,w.b)([(0,N.J)()],k.prototype,"lodGenerationScale",null),(0,w.b)([(0,N.J)()],k.prototype,"linearSpecularLOD",null),(0,w.b)([(0,N.C)()],k.prototype,"irradianceTexture",null),(0,w.b)([(0,N.J)()],k.prototype,"isRenderTarget",void 0)},12052:(d,t,A)=>{"use strict";var w=A(11568),N=A(11266);N.e.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(N.e.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=w.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((d=>{this._texture._sphericalPolynomial=d,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(d){this._texture&&(this._texture._sphericalPolynomial=d)},enumerable:!0,configurable:!0})},12083:(d,t,A)=>{"use strict";A.d(t,{e:()=>k});var w=A(11041),N=A(11047),p=A(10727),B=A(11076),X=A(11266),W=A(11264),a=A(10885),D=A(10730),i=A(11097);A(11607);class k extends X.e{set boundingBoxSize(d){if(this._boundingBoxSize&&this._boundingBoxSize.equals(d))return;this._boundingBoxSize=d;const t=this.va();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(d){this._rotationY=d,this.setReflectionTextureMatrix(B.c.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(d,t,A){let w="";return d.forEach((d=>w+=d)),new k(w,t,null,A,d)}static CreateFromPrefilteredData(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=t.useDelayedTextureLoading;t.useDelayedTextureLoading=!1;const p=new k(d,t,null,!1,null,null,null,void 0,!0,A,w);return t.useDelayedTextureLoading=N,p}constructor(d,t){var A;let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,i=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,k=arguments.length>8&&void 0!==arguments[8]&&arguments[8],b=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,Q=arguments.length>10&&void 0!==arguments[10]&&arguments[10],P=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,J=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,U=arguments.length>13?arguments[13]:void 0,T=arguments.length>14?arguments[14]:void 0;super(t),this.onLoadObservable=new D.b,this.boundingBoxPosition=B.l.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new B.c,this._buffer=null,this.name=d,this.url=d,this._noMipmap=N,this.uc=!1,this.isCube=!0,this._textureMatrix=B.c.Identity(),this.coordinatesMode=W.c.CUBIC_MODE;let F=null,q=null;null===w||Array.isArray(w)?(this._noMipmap=N,this._format=i,this._createPolynomials=Q,F=w,this._loaderOptions=U,this._useSRGBBuffer=T,this._lodScale=P,this._lodOffset=J):(F=w.extensions??null,this._noMipmap=w.noMipmap??!1,p=w.files??null,q=w.buffer??null,this._format=w.format??5,k=w.prefiltered??!1,b=w.forcedExtension??null,this._createPolynomials=w.createPolynomials??!1,this._lodScale=w.lodScale??.8,this._lodOffset=w.lodOffset??0,this._loaderOptions=w.loaderOptions,this._useSRGBBuffer=w.useSRGBBuffer,X=w.X??null,a=w.onError??null),(d||p)&&this.updateURL(d,b,X,k,a,F,null===(A=this.va())||void 0===A?void 0:A.useDelayedTextureLoading,p,q)}getClassName(){return"CubeTexture"}updateURL(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=d),this.url=d,t&&(this._forcedExtension=t);const a=d.lastIndexOf("."),D=t||(a>-1?d.substring(a).toLowerCase():""),i=0===D.indexOf(".dds"),k=0===D.indexOf(".env"),b=0===D.indexOf(".basis");if(k?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=w,w&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),X)this._files=X;else if(b||k||i||p||(p=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,p){for(let t=0;t<p.length;t++)this._files.push(d+p[t]);this._extensions=p}this._buffer=W,B?(this.delayLoadState=4,this._delayedOnLoad=A,this._delayedOnError=N):this._loadTexture(A,N)}delayLoad(d){4===this.delayLoadState&&(d&&(this._forcedExtension=d),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(d){var t,A;if(d.updateFlag===this._textureMatrix.updateFlag)return;d.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(A=this.va())||void 0===A||A.markAllMaterialsAsDirty(1,(d=>-1!==d.getActiveTextures().indexOf(this))));if(this._textureMatrix=d,null===(t=this.va())||void 0===t||!t.useRightHandedSystem)return;const w=B.h.gb[0],N=B.h.Quaternion[0],p=B.h.gb[1];this._textureMatrix.decompose(w,N,p),N.z*=-1,N.w*=-1,B.c.ComposeToRef(w,N,p,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var d;return null!==(d=this.va())&&void 0!==d&&d.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=this.va(),w=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const N=()=>{var t;(this.onLoadObservable.notifyObservers(this),w)&&(w.dispose(),null===(t=this.va())||void 0===t||t.markAllMaterialsAsDirty(1));d&&d()},B=(d,A)=>{this._loadingError=!0,this._errorObject={message:d,exception:A},t&&t(d,A),W.c.OnTextureLoadErrorObservable.notifyObservers(this)};var X;this._texture?this._texture.isReady?p.g.SetImmediate((()=>N())):this._texture.onLoadedObservable.add((()=>N())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,A,this._lodScale,this._lodOffset,d,B,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,A,this._files,this._noMipmap,d,B,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(X=this._texture)||void 0===X||X.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(d,t,A){const w=i.d.Parse((()=>{let w=!1;return d.prefiltered&&(w=d.prefiltered),new k(A+(d.url??d.name),t,d.extensions,!1,d.files||null,null,null,void 0,w,d.forcedExtension)}),d,t);if(d.boundingBoxPosition&&(w.boundingBoxPosition=B.l.Lg(d.boundingBoxPosition)),d.boundingBoxSize&&(w.boundingBoxSize=B.l.Lg(d.boundingBoxSize)),d.animations)for(let N=0;N<d.animations.length;N++){const t=d.animations[N],A=(0,a.d)("BABYLON.Animation");A&&w.animations.push(A.Parse(t))}return w}clone(){let d=0;const t=i.d.Clone((()=>{const t=new k(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return d=t.uniqueId,t}),this);return t.uniqueId=d,t}}(0,w.b)([(0,N.J)()],k.prototype,"url",void 0),(0,w.b)([(0,N.H)()],k.prototype,"boundingBoxPosition",void 0),(0,w.b)([(0,N.H)()],k.prototype,"boundingBoxSize",null),(0,w.b)([(0,N.J)("rotationY")],k.prototype,"rotationY",null),(0,w.b)([(0,N.J)("files")],k.prototype,"_files",void 0),(0,w.b)([(0,N.J)("forcedExtension")],k.prototype,"_forcedExtension",void 0),(0,w.b)([(0,N.J)("extensions")],k.prototype,"_extensions",void 0),(0,w.b)([(0,N.t)("textureMatrix")],k.prototype,"_textureMatrix",void 0),(0,w.b)([(0,N.t)("textureMatrixRefraction")],k.prototype,"_textureMatrixRefraction",void 0),W.c._CubeTextureParser=k.Parse,(0,a.g)("BABYLON.CubeTexture",k)},12491:(d,t,A)=>{"use strict";A.d(t,{d:()=>W});var w=A(10740),N=A(11264),p=A(10896),B=A(11476),X=A(10861);B.ThinEngine.prototype.createDynamicTexture=function(d,t,A,w){const N=new X.c(this,4);return N.baseWidth=d,N.baseHeight=t,A&&(d=this.needPOTTextures?(0,p.g)(d,this._caps.maxTextureSize):d,t=this.needPOTTextures?(0,p.g)(t,this._caps.maxTextureSize):t),N.width=d,N.height=t,N.isReady=!1,N.generateMipMaps=A,N.samplingMode=w,this.updateTextureSamplingMode(w,N),this._internalTexturesCache.push(N),N},B.ThinEngine.prototype.updateDynamicTexture=function(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!d)return;const B=this._gl,X=B.TEXTURE_2D,W=this._bindTextureDirectly(X,d,!0,p);this._unpackFlipY(void 0===A?d.invertY:A),w&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const a=this._getWebGLTextureType(d.type),D=this._getInternalFormat(N||d.format),i=this._getRGBABufferInternalSizedFormat(d.type,D);B.texImage2D(X,0,i,D,a,t),d.generateMipMaps&&B.generateMipmap(X),W||this._bindTextureDirectly(X,null),w&&B.pixelStorei(B.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),N&&(d.format=N),d._dynamicTextureSource=t,d._premulAlpha=w,d.invertY=A||!1,d.isReady=!0};class W extends N.c{constructor(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,X=arguments.length>6?arguments[6]:void 0;const W=!A||A._isScene;super(null,W?A:null===A||void 0===A?void 0:A.Hf,W?!w:A,X,p,void 0,void 0,void 0,void 0,B),this.name=d,this.wrapU=N.c.CLAMP_ADDRESSMODE,this.wrapV=N.c.CLAMP_ADDRESSMODE,this._generateMipMaps=w;const a=this._getEngine();if(!a)return;if(t.getContext)this._canvas=t,this._ownCanvas=!1,this._texture=a.createDynamicTexture(this._canvas.width,this._canvas.height,w,p);else{this._canvas=a.createCanvas(1,1),this._ownCanvas=!0;const d=t;d.width||0===d.width?this._texture=a.createDynamicTexture(d.width,d.height,w,p):this._texture=a.createDynamicTexture(t,t,w,p)}const D=this.getSize();this._canvas.width!==D.width&&(this._canvas.width=D.width),this._canvas.height!==D.height&&(this._canvas.height=D.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(d){this._canvas.width=d.width,this._canvas.height=d.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(d.width,d.height,this._generateMipMaps,this.samplingMode)}scale(d){const t=this.getSize();t.width*=d,t.height*=d,this._recreate(t)}scaleTo(d,t){const A=this.getSize();A.width=d,A.height=t,this._recreate(A)}getContext(){return this._context}clear(d){const t=this.getSize();d&&(this._context.fillStyle=d),this._context.clearRect(0,0,t.width,t.height)}update(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===d||d,t,this._format||void 0,void 0,A)}drawText(d,t,A,w,N,p,B){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const W=this.getSize();if(p&&(this._context.fillStyle=p,this._context.fillRect(0,0,W.width,W.height)),this._context.font=w,null===t||void 0===t){const A=this._context.measureText(d);t=(W.width-A.width)/2}if(null===A||void 0===A){const d=parseInt(w.replace(/\D/g,""));A=W.height/2+d/3.65}this._context.fillStyle=N||"",this._context.fillText(d,t,A),X&&this.update(B)}dispose(){var d,t;(super.dispose(),this._ownCanvas)&&(null===(d=this._canvas)||void 0===d||null===(t=d.remove)||void 0===t||t.call(d));this._canvas=null,this._context=null}clone(){const d=this.va();if(!d)return this;const t=this.getSize(),A=new W(this.name,t,d,this._generateMipMaps);return A.uc=this.uc,A.level=this.level,A.wrapU=this.wrapU,A.wrapV=this.wrapV,A}serialize(){const d=this.va();d&&!d.isReady()&&w.e.Warn("The scene must be ready before serializing the dynamic texture");const t=super.serialize();return W._IsCanvasElement(this._canvas)&&(t.base64String=this._canvas.toDataURL()),t.invertY=this._invertY,t.samplingMode=this.samplingMode,t}static _IsCanvasElement(d){return void 0!==d.toDataURL}_rebuild(){this.update()}}},10861:(d,t,A)=>{"use strict";A.d(t,{c:()=>B});var w,N=A(10730),p=A(10863);!function(d){d[d.Unknown=0]="Unknown",d[d.Url=1]="Url",d[d.Temp=2]="Temp",d[d.Raw=3]="Raw",d[d.Dynamic=4]="Dynamic",d[d.RenderTarget=5]="RenderTarget",d[d.MultiRenderTarget=6]="MultiRenderTarget",d[d.Cube=7]="Cube",d[d.CubeRaw=8]="CubeRaw",d[d.CubePrefiltered=9]="CubePrefiltered",d[d.Raw3D=10]="Raw3D",d[d.Raw2DArray=11]="Raw2DArray",d[d.DepthStencil=12]="DepthStencil",d[d.CubeRawRGBD=13]="CubeRawRGBD",d[d.Depth=14]="Depth"}(w||(w={}));class B extends p.d{get useMipMaps(){return this.generateMipMaps}set useMipMaps(d){this.generateMipMaps=d}get uniqueId(){return this._uniqueId}_setUniqueId(d){this._uniqueId=d}getEngine(){return this._engine}get source(){return this._source}constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new N.b,this.onErrorObservable=new N.b,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=d,this._source=t,this._uniqueId=B._Counter++,A||(this._hardwareTexture=d._createHardwareTexture())}incrementReferences(){this._references++}updateSize(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,d,t,A),this.width=d,this.height=t,this.depth=A,this.baseWidth=d,this.baseHeight=t,this.baseDepth=A,this._size=d*t*A}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const d=this.onRebuildCallback(this),t=t=>{t._swapAndDie(this,!1),this.isReady=d.isReady};return void(d.isAsync?d.proxy.then(t):t(d.proxy))}let d;switch(this.source){case 2:case 12:case 14:break;case 1:return void(d=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(d=>{d._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:d=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),d._swapAndDie(this,!1),this.isReady=!0;break;case 10:d=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),d._swapAndDie(this,!1),this.isReady=!0;break;case 11:d=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),d._swapAndDie(this,!1),this.isReady=!0;break;case 4:d=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),d._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(d=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{d._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:d=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),d._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return d=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(d=>{d&&d._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(d._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(d){var t;let A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(t=this._hardwareTexture)||void 0===t||t.setUsage(d._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),d._hardwareTexture=this._hardwareTexture,A&&(d._isRGBD=this._isRGBD),this._lodTextureHigh&&(d._lodTextureHigh&&d._lodTextureHigh.dispose(),d._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(d._lodTextureMid&&d._lodTextureMid.dispose(),d._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(d._lodTextureLow&&d._lodTextureLow.dispose(),d._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(d._irradianceTexture&&d._irradianceTexture.dispose(),d._irradianceTexture=this._irradianceTexture);const w=this._engine.getLoadedTexturesCache();let N=w.indexOf(this);-1!==N&&w.splice(N,1),N=w.indexOf(d),-1===N&&w.push(d)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}B._Counter=0},11499:(d,t,A)=>{"use strict";A.d(t,{b:()=>N});var w=A(11264);class N extends w.c{constructor(d,t,A,N,p){let B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=arguments.length>9?arguments[9]:void 0,i=arguments.length>10?arguments[10]:void 0;super(null,p,!B,X,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,D),this.format=N,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==a||(W=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==a||(W=1),this._texture=this._engine.createRawTexture(d,t,A,N,B,X,W,null,a,D??0,i??!1),this.wrapU=w.c.CLAMP_ADDRESSMODE,this.wrapV=w.c.CLAMP_ADDRESSMODE)}update(d){this._getEngine().updateRawTexture(this._texture,d,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const d=new N(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return d._texture=this._texture,this._texture.incrementReferences(),d}static CreateLuminanceTexture(d,t,A,w){return new N(d,t,A,1,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(d,t,A,w){return new N(d,t,A,2,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(d,t,A,w){return new N(d,t,A,0,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(d,t,A,w){return new N(d,t,A,4,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(d,t,A,w){return new N(d,t,A,5,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(d,t,A,w){return new N(d,t,A,5,w,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(d,t,A,p){let B=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:w.c.TRILINEAR_SAMPLINGMODE;return new N(d,t,A,6,p,B,X,W,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(d,t,A,p){let B=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],X=arguments.length>5&&void 0!==arguments[5]&&arguments[5],W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:w.c.TRILINEAR_SAMPLINGMODE;return new N(d,t,A,6,p,B,X,W,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11923:(d,t,A)=>{"use strict";A.d(t,{b:()=>N});var w=A(11264);class N extends w.c{get depth(){return this._depth}constructor(d,t,A,N,p,B){let X=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],W=arguments.length>7&&void 0!==arguments[7]&&arguments[7],a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:w.c.TRILINEAR_SAMPLINGMODE,D=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,i=arguments.length>10?arguments[10]:void 0;super(null,B,!X,W),this.format=p,this._texture=B.getEngine().createRawTexture2DArray(d,t,A,N,p,X,W,a,null,D,i),this._depth=N,this.is2DArray=!0}update(d){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,d,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(d,t,A,w,p){return new N(d,t,A,w,5,p,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11576:(d,t,A)=>{"use strict";A.d(t,{d:()=>k});var w=A(10730),N=A(11076),p=A(11264),B=A(11132),X=A(11137),W=A(11081),a=A(10896),D=A(10829),i=A(10740);D.e.prototype.setDepthStencilTexture=function(d,t){this._engine.setDepthStencilTexture(this._samplers[d],this._uniforms[d],t,d)};class k extends p.c{get renderList(){return this._renderList}set renderList(d){this._renderList!==d&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),d&&(this._unObserveRenderList=(0,W.h)(d,this._renderListHasChanged)),this._renderList=d)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(d){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(d)}set onBeforeRender(d){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(d)}set onAfterRender(d){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(d)}set onClear(d){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(d)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(d,t){let A;A=Array.isArray(d)?d:[d];for(let w=0;w<A.length;++w)for(let d=0;d<this._renderPassIds.length;++d)A[w].setMaterialForRenderPass(this._renderPassIds[d],void 0!==t?Array.isArray(t)?t[d]:t:void 0)}get isMulti(){var d;return(null===(d=this._renderTarget)||void 0===d?void 0:d.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(d){if(this._boundingBoxSize&&this._boundingBoxSize.equals(d))return;this._boundingBoxSize=d;const t=this.va();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var d;return(null===(d=this._renderTarget)||void 0===d?void 0:d._depthStencilTexture)??null}constructor(d,t,A){let B,W=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],D=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],k=arguments.length>7&&void 0!==arguments[7]?arguments[7]:p.c.TRILINEAR_SAMPLINGMODE,b=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],Q=arguments.length>9&&void 0!==arguments[9]&&arguments[9],P=arguments.length>10&&void 0!==arguments[10]&&arguments[10],J=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,U=arguments.length>12&&void 0!==arguments[12]&&arguments[12],T=arguments.length>13?arguments[13]:void 0,F=arguments.length>14?arguments[14]:void 0,q=arguments.length>15&&void 0!==arguments[15]&&arguments[15],H=arguments.length>16&&void 0!==arguments[16]&&arguments[16],f=!0;if("object"===typeof W){const d=W;W=!!d.generateMipMaps,a=d.doNotChangeAspectRatio??!0,D=d.type??0,i=!!d.isCube,k=d.samplingMode??p.c.TRILINEAR_SAMPLINGMODE,b=d.generateDepthBuffer??!0,Q=!!d.generateStencilBuffer,P=!!d.isMulti,J=d.format??5,U=!!d.delayAllocation,T=d.samples,F=d.creationFlags,q=!!d.noColorAttachment,H=!!d.useSRGBBuffer,B=d.colorAttachment,f=d.gammaSpace??f}if(super(null,A,!W,void 0,k,void 0,void 0,void 0,void 0,J),this._unObserveRenderList=null,this._renderListHasChanged=(d,t)=>{const A=this._renderList?this._renderList.length:0;var w;(0===t&&A>0||0===A)&&(null===(w=this.va())||void 0===w||w.meshes.forEach((d=>{d._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new w.b,this.onAfterUnbindObservable=new w.b,this.onBeforeRenderObservable=new w.b,this.onAfterRenderObservable=new w.b,this.onClearObservable=new w.b,this.onResizeObservable=new w.b,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=N.l.Zero(),this._dumpToolsLoading=!1,!(A=this.va()))return;const v=this.va().getEngine();this._gammaSpace=f,this._coordinatesMode=p.c.PROJECTION_MODE,this.renderList=[],this.name=d,this.isRenderTarget=!0,this._initialSizeParameter=t,this._renderPassIds=[],this._isCubeData=i,this._processSizeParameter(t),this.renderPassId=this._renderPassIds[0],this._resizeObserver=v.onResizeObservable.add((()=>{})),this._generateMipMaps=!!W,this._doNotChangeAspectRatio=a,this._renderingManager=new X.e(A),this._renderingManager._useSceneAutoClearSetup=!0,P||(this._renderTargetOptions={generateMipMaps:W,type:D,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:b,generateStencilBuffer:Q,samples:T,creationFlags:F,noColorAttachment:q,useSRGBBuffer:H,colorAttachment:B,label:this.name},this.samplingMode===p.c.NEAREST_SAMPLINGMODE&&(this.wrapU=p.c.CLAMP_ADDRESSMODE,this.wrapV=p.c.CLAMP_ADDRESSMODE),U||(i?(this._renderTarget=A.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=p.c.INVCUBIC_MODE,this._textureMatrix=N.c.Identity()):this._renderTarget=A.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==T&&(this.samples=T)))}createDepthStencilTexture(){var d;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2&&void 0!==arguments[2]&&arguments[2],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,B=arguments.length>5?arguments[5]:void 0;null===(d=this._renderTarget)||void 0===d||d.createDepthStencilTexture(t,A,w,N,p,B)}_releaseRenderPassId(){if(this._scene){const d=this._scene.getEngine();for(let t=0;t<this._renderPassIds.length;++t)d.releaseRenderPassId(this._renderPassIds[t])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const d=this._scene.getEngine(),t=this._isCubeData?6:this.getRenderLayers()||1;for(let A=0;A<t;++A)this._renderPassIds[A]=d.createRenderPassId(`RenderTargetTexture - ${this.name}#${A}`)}_processSizeParameter(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(d.ratio){this._sizeRatio=d.ratio;const t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=d;t&&this._createRenderPassId()}get samples(){var d;return(null===(d=this._renderTarget)||void 0===d?void 0:d.samples)??this._samples}set samples(d){this._renderTarget&&(this._samples=this._renderTarget.setSamples(d))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(d){this._refreshRate=d,this.resetRefreshCounter()}addPostProcess(d){if(!this._postProcessManager){const d=this.va();if(!d)return;this._postProcessManager=new B.b(d),this._postProcesses=new Array}this._postProcesses.push(d),this._postProcesses[0].Ri=!1}clearPostProcesses(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(d)for(const d of this._postProcesses)d.dispose();this._postProcesses=[]}}removePostProcess(d){if(!this._postProcesses)return;const t=this._postProcesses.indexOf(d);-1!==t&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].Ri=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const d=this._size.layers;if(d)return d;const t=this._size.depth;return t||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(d){const t=Math.max(1,this.getRenderSize()*d);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(d){var t;const A=this.isCube;null===(t=this._renderTarget)||void 0===t||t.dispose(),this._renderTarget=null;const w=this.va();w&&(this._processSizeParameter(d,!1),this._renderTarget=A?w.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):w.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(d,t)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(A.bind(A,12080)).then((d=>this._dumpTools=d))),this._render(!1,!1,!0)}_render(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=this.va();if(!w)return A;const N=w.getEngine();if(void 0!==this.useCameraPostProcesses&&(d=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let d=0;d<this._waitingRenderList.length;d++){const t=this._waitingRenderList[d],A=w.getMeshById(t);A&&this.renderList.push(A)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const d=this.va();if(!d)return A;const t=d.meshes;for(let A=0;A<t.length;A++){const d=t[A];this.renderListPredicate(d)&&this.renderList.push(d)}}const p=N.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const B=this.activeCamera??w.activeCamera,X=w.activeCamera;B&&(B!==w.activeCamera&&(w.setTransformMatrix(B.getViewMatrix(),B.getProjectionMatrix(!0)),w.activeCamera=B),N.setViewport(B.rigParent?B.rigParent.viewport:B.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let W=A;if(A){w.getViewMatrix()||w.updateTransformMatrix();const d=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let p=0;p<d&&W;p++){let d=null;const t=this.renderList?this.renderList:w.getActiveMeshes().data,B=this.renderList?this.renderList.length:w.getActiveMeshes().length;N.currentRenderPassId=this._renderPassIds[p],this.onBeforeRenderObservable.notifyObservers(p),this.getCustomRenderList&&(d=this.getCustomRenderList(p,t,B)),d||(d=t),this._doNotChangeAspectRatio||w.updateTransformMatrix(!0);for(let w=0;w<d.length&&W;++w){const t=d[w];if(t.isEnabled()&&!t.isBlocked&&t.isVisible&&t.If)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(t,this.refreshRate,A)){W=!1;continue}}else if(!t.isReady(!0)){W=!1;continue}}this.onAfterRenderObservable.notifyObservers(p),(this.is2DArray||this.is3D||this.isCube)&&(w.incrementRenderId(),w.resetCachedMaterial())}const t=this.particleSystemList||w.nj;for(const A of t)A.isReady()||(W=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let a=0;a<6;a++)this._renderToTarget(a,d,t,void 0,B),w.incrementRenderId(),w.resetCachedMaterial();else this._renderToTarget(0,d,t,void 0,B);else for(let a=0;a<this.getRenderLayers();a++)this._renderToTarget(0,d,t,a,B),w.incrementRenderId(),w.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),N.currentRenderPassId=p,w.activeCamera=X,X&&(this.activeCamera&&this.activeCamera!==w.activeCamera&&w.setTransformMatrix(X.getViewMatrix(),X.getProjectionMatrix(!0)),N.setViewport(X.viewport)),w.resetCachedMaterial(),W}_bestReflectionRenderTargetDimension(d,t){const A=d*t,w=(0,a.p)(A+16384/(128+A));return Math.min((0,a.c)(d),w)}_prepareRenderingManager(d,t,A,w){const N=this.va();if(!N)return;this._renderingManager.reset();const p=N.getRenderId();for(let X=0;X<t;X++){const t=d[X];if(t&&!t.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(t,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!t.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!t._internalAbstractMeshDataInfo._currentLODIsUpToDate&&A&&(t._internalAbstractMeshDataInfo._currentLOD=N.customLODSelector?N.customLODSelector(t,A):t.getLOD(A),t._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!t._internalAbstractMeshDataInfo._currentLOD)continue;let d,B=t._internalAbstractMeshDataInfo._currentLOD;if(B!==t&&0!==B.billboardMode&&B.Nj(),B._preActivateForIntermediateRendering(p),d=!(!w||!A)&&0===(t.layerMask&A.layerMask),t.isEnabled()&&t.isVisible&&t.If&&!d){if(B!==t&&B._activate(p,!0),t._activate(p,!0)&&t.If.length){t.isAnInstance?t._internalAbstractMeshDataInfo._actAsRegularMesh&&(B=t):B._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,B._internalAbstractMeshDataInfo._isActiveIntermediate=!0,N._prepareSkeleton(B);for(let d=0;d<B.If.length;d++){const t=B.If[d];this._renderingManager.dispatch(t,B)}}t._postActivate()}}}const B=this.particleSystemList||N.nj;for(let X=0;X<B.length;X++){const d=B[X],t=d.k;d.isStarted()&&t&&(!t.position||t.isEnabled())&&this._renderingManager.dispatchParticles(d)}}_bindFrameBuffer(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.va();if(!A)return;const w=A.getEngine();this._renderTarget&&w.bindFramebuffer(this._renderTarget,this.isCube?d:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(d,t){this._renderTarget&&d.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(t)}))}_prepareFrame(d,t,A,w){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):w&&d.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(t,A)}_renderToTarget(d,t,A){var w,N;let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const X=this.va();if(!X)return;const W=X.getEngine();this._prepareFrame(X,d,p,t),null===(w=W._debugPushGroup)||void 0===w||w.call(W,`render to face #${d} layer #${p}`,2),this.is2DArray||this.is3D?(W.currentRenderPassId=this._renderPassIds[p],this.onBeforeRenderObservable.notifyObservers(p)):(W.currentRenderPassId=this._renderPassIds[d],this.onBeforeRenderObservable.notifyObservers(d));if(W.snapshotRendering&&1===W.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(W):this.skipInitialClear||W.clear(this.clearColor||X.clearColor,!0,!0,!0);else{var a;let w=null;const N=this.renderList?this.renderList:X.getActiveMeshes().data,D=this.renderList?this.renderList.length:X.getActiveMeshes().length;this.getCustomRenderList&&(w=this.getCustomRenderList(this.is2DArray||this.is3D?p:d,N,D)),w?this._prepareRenderingManager(w,w.length,B,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(N,D,B,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),w=N);for(const t of X._beforeRenderTargetClearStage)t.action(this,d,p);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(W):this.skipInitialClear||W.clear(this.clearColor||X.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||X.updateTransformMatrix(!0);for(const t of X._beforeRenderTargetDrawStage)t.action(this,d,p);this._renderingManager.render(this.customRenderFunction,w,this.renderParticles,this.renderSprites);for(const t of X._afterRenderTargetDrawStage)t.action(this,d,p);const k=(null===(a=this._texture)||void 0===a?void 0:a.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,d,this._postProcesses,this.ignoreCameraViewport):t&&X.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,d);for(const t of X._afterRenderTargetPostProcessStage)t.action(this,d,p);this._texture&&(this._texture.generateMipMaps=k),this._doNotChangeAspectRatio||X.updateTransformMatrix(!0),A&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),W):i.e.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(N=W._debugPopGroup)||void 0===N||N.call(W,2),this._unbindFrameBuffer(W,d),this._texture&&this.isCube&&5===d&&W.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(d,t,A,w)}setRenderingAutoClearDepthStencil(d,t){this._renderingManager.setRenderingAutoClearDepthStencil(d,t),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const d=this.getSize(),t=new k(this.name,d,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.uc=this.uc,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;const d=super.serialize();if(d.renderTargetSize=this.getRenderSize(),d.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)d.renderList.push(this.renderList[t].id);return d}disposeFramebufferObjects(){var d;null===(d=this._renderTarget)||void 0===d||d.dispose(!0)}releaseInternalTexture(){var d;null===(d=this._renderTarget)||void 0===d||d.releaseTextures(),this._texture=null}dispose(){var d;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const t=this.va();if(!t)return;let A=t.customRenderTargets.indexOf(this);A>=0&&t.customRenderTargets.splice(A,1);for(const w of t.cameras)A=w.customRenderTargets.indexOf(this),A>=0&&w.customRenderTargets.splice(A,1);null===(d=this._renderTarget)||void 0===d||d.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===k.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=k.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}k.REFRESHRATE_RENDER_ONCE=0,k.REFRESHRATE_RENDER_ONEVERYFRAME=1,k.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,p.c._CreateRenderTargetTexture=(d,t,A,w,N)=>new k(d,t,A,w)},11264:(d,t,A)=>{"use strict";A.d(t,{c:()=>F});var w=A(11041),N=A(11047),p=A(10730),B=A(11076),X=A(11266),W=A(10885),a=A(10761),D=A(10815),i=A(10878),k=A(11181),b=A(10791);function Q(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=t.width,N=t.height;if(d instanceof Float32Array){let t=d.byteLength/d.BYTES_PER_ELEMENT;const A=new Uint8Array(t);for(;--t>=0;){let w=d[t];w<0?w=0:w>1&&(w=1),A[t]=255*w}d=A}const p=document.createElement("canvas");p.width=w,p.height=N;const B=p.getContext("2d");if(!B)return null;const X=B.createImageData(w,N);if(X.data.set(d),B.putImageData(X,0,0),A){const d=document.createElement("canvas");d.width=w,d.height=N;const t=d.getContext("2d");return t?(t.translate(0,N),t.scale(1,-1),t.drawImage(p,0,0),d.toDataURL("image/png")):null}return p.toDataURL("image/png")}function P(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const w=d.getInternalTexture();if(!w)return null;const N=d._readPixelsSync(t,A);return N?Q(N,d.getSize(),w.invertY):null}async function J(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const w=d.getInternalTexture();if(!w)return null;const N=await d.readPixels(t,A);return N?Q(N,d.getSize(),w.invertY):null}var U=A(11271),T=A(11097);class F extends X.e{static _CreateVideoTexture(d,t,A){arguments.length>5&&void 0!==arguments[5]||F.TRILINEAR_SAMPLINGMODE;throw(0,a.b)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(d){this._isBlocking=d}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(d,t,A,w){let N,B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:F.TRILINEAR_SAMPLINGMODE,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,W=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]&&arguments[8],k=arguments.length>9?arguments[9]:void 0,b=arguments.length>10?arguments[10]:void 0,Q=arguments.length>11?arguments[11]:void 0,P=arguments.length>12?arguments[12]:void 0,J=arguments.length>13?arguments[13]:void 0;super(t),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new p.b,this._isBlocking=!0,this.name=d||"",this.url=d;let T=!1,q=null,H=!0;"object"===typeof A&&null!==A?(N=A.noMipmap??!1,w=A.invertY??!U.e,B=A.samplingMode??F.TRILINEAR_SAMPLINGMODE,X=A.X??null,W=A.onError??null,a=A.buffer??null,i=A.deleteBuffer??!1,k=A.format,b=A.mimeType,Q=A.loaderOptions,P=A.creationFlags,T=A.useSRGBBuffer??!1,q=A.internalTexture??null,H=A.gammaSpace??H):N=!!A,this._gammaSpace=H,this._noMipmap=N,this._invertY=void 0===w?!U.e:w,this._initialSamplingMode=B,this._buffer=a,this._deleteBuffer=i,this._mimeType=b,this._loaderOptions=Q,this._creationFlags=P,this._useSRGBBuffer=T,this._forcedExtension=J,k&&(this._format=k);const f=this.va(),v=this._getEngine();if(!v)return;v.onBeforeTextureInitObservable.notifyObservers(this);const m=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),X&&X(),!this.isBlocking&&f&&f.resetCachedMaterial()},j=(d,t)=>{this._loadingError=!0,this._errorObject={message:d,exception:t},W&&W(d,t),F.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!q)return this._delayedOnLoad=m,void(this._delayedOnError=j);if(this._texture=q??this._getFromCache(this.url,N,B,this._invertY,T,this.isCube),this._texture)if(this._texture.isReady)D.c.SetImmediate((()=>m()));else{const d=this._texture.onLoadedObservable.add(m);this._texture.onErrorObservable.add((t=>{var A;j(t.message,t.exception),null===(A=this._texture)||void 0===A||A.onLoadedObservable.remove(d)}))}else if(f&&f.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=m,this._delayedOnError=j;else{try{this._texture=v.createTexture(this.url,N,this._invertY,f,B,m,j,this._buffer,void 0,this._format,this._forcedExtension,b,Q,P,T)}catch(n){throw j("error loading",n),n}i&&(this._buffer=null)}}updateURL(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(d=>d.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=d),this.url=d,this._buffer=t,this._forcedExtension=w,this.delayLoadState=4,A&&(this._delayedOnLoad=A),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const d=this.va();d&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?D.c.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=d.getEngine().createTexture(this.url,this._noMipmap,this._invertY,d,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(d,t,A,w){d*=this._cachedUScale,t*=this._cachedVScale,d-=this.uRotationCenter*this._cachedUScale,t-=this.vRotationCenter*this._cachedVScale,A-=this.wRotationCenter,B.l.TransformCoordinatesFromFloatsToRef(d,t,A,this._rowGenerationMatrix,w),w.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,w.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,w.z+=this.wRotationCenter}getTextureMatrix(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*d===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*d,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=B.c.Zero(),this._rowGenerationMatrix=new B.c,this._t0=B.l.Zero(),this._t1=B.l.Zero(),this._t2=B.l.Zero()),B.c.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(B.c.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,B.h.Matrix[0]),B.c.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,B.h.Matrix[1]),B.c.ScalingToRef(this._cachedUScale,this._cachedVScale,0,B.h.Matrix[2]),B.c.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,B.h.Matrix[3]),B.h.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(B.h.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(B.h.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(B.h.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.ni(this._t0),this._t2.ni(this._t0),B.c.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const t=this.va();if(!t)return this._cachedTextureMatrix;const A=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&A!==this._cachedIdentity3x2&&t.markAllMaterialsAsDirty(1,(d=>d.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const d=this.va();if(!d)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==F.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===d.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=B.c.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=B.c.Zero());const t=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case F.PLANAR_MODE:B.c.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case F.PROJECTION_MODE:{B.c.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const t=d.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=t.updateFlag,t.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:B.c.IdentityToRef(this._cachedReflectionTextureMatrix)}return t&&d.markAllMaterialsAsDirty(1,(d=>d.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const d={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return T.d.Clone((()=>new F(this._texture?this._texture.url:null,this.va(),d)),this)}serialize(){var d;const t=this.name;F.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const A=super.serialize(F._SerializeInternalTextureUniqueId);if(!A)return null;var w;((F.SerializeBuffers||F.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(A.base64String=this._buffer,A.name=A.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?A.base64String="data:image/png;base64,"+(0,b.k)(this._buffer):(F.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(A.base64String=!this._engine||this._engine._features.supportSyncTextureRead?P(this):J(this))),A.invertY=this._invertY,A.samplingMode=this.samplingMode,A._creationFlags=this._creationFlags,A._useSRGBBuffer=this._useSRGBBuffer,F._SerializeInternalTextureUniqueId)&&(A.internalTextureUniqueId=null===(w=this._texture)||void 0===w?void 0:w.uniqueId);return A.internalTextureLabel=null===(d=this._texture)||void 0===d?void 0:d.label,A.noMipmap=this._noMipmap,this.name=t,A}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(d,t,A){if(d.customType){const w=i.b.Instantiate(d.customType).Parse(d,t,A);return d.samplingMode&&w.updateSamplingMode&&w._samplingMode&&w._samplingMode!==d.samplingMode&&w.updateSamplingMode(d.samplingMode),w}if(d.isCube&&!d.isRenderTarget)return F._CubeTextureParser(d,t,A);const w=void 0!==d.internalTextureUniqueId;if(!d.name&&!d.isRenderTarget&&!w)return null;let N;if(w){const A=t.getEngine().getLoadedTexturesCache();for(const t of A)if(t.uniqueId===d.internalTextureUniqueId){N=t;break}}const p=t=>{if(t&&t._texture&&(t._texture._cachedWrapU=null,t._texture._cachedWrapV=null,t._texture._cachedWrapR=null),d.samplingMode){const A=d.samplingMode;t&&t.samplingMode!==A&&t.updateSamplingMode(A)}if(t&&d.animations)for(let A=0;A<d.animations.length;A++){const w=d.animations[A],N=(0,W.d)("BABYLON.Animation");N&&t.animations.push(N.Parse(w))}t&&t._texture&&(w&&!N&&t._texture._setUniqueId(d.internalTextureUniqueId),t._texture.label=d.internalTextureLabel)};return T.d.Parse((()=>{let w=!0;if(d.noMipmap&&(w=!1),d.mirrorPlane){const A=F._CreateMirror(d.name,d.renderTargetSize,t,w);return A._waitingRenderList=d.renderList,A.mirrorPlane=k.b.Lg(d.mirrorPlane),p(A),A}if(d.isRenderTarget){let A=null;if(d.isCube){if(t.reflectionProbes)for(let w=0;w<t.reflectionProbes.length;w++){const A=t.reflectionProbes[w];if(A.name===d.name)return A.cubeTexture}}else A=F._CreateRenderTargetTexture(d.name,d.renderTargetSize,t,w,d._creationFlags??0),A._waitingRenderList=d.renderList;return p(A),A}if(d.isVideo){const N=F._CreateVideoTexture(A+(d.url||d.name),A+(d.src||d.url),t,w,d.invertY,d.samplingMode,d.settings||{});return p(N),N}{let B;if(d.base64String&&!N)B=F.CreateFromBase64String(d.base64String,d.base64String,t,!w,d.invertY,d.samplingMode,(()=>{p(B)}),d._creationFlags??0,d._useSRGBBuffer??!1),B.name=d.name;else{let X;X=d.name&&(d.name.indexOf("://")>0||d.name.startsWith("data:"))?d.name:A+d.name,d.url&&(d.url.startsWith("data:")||F.UseSerializedUrlIfAny)&&(X=d.url);const W={noMipmap:!w,invertY:d.invertY,samplingMode:d.samplingMode,X:()=>{p(B)},internalTexture:N};B=new F(X,t,W)}return B}}),d,t)}static CreateFromBase64String(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:F.TRILINEAR_SAMPLINGMODE;return new F("data:"+t,A,w,N,p,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,d,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:F.TRILINEAR_SAMPLINGMODE,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,a=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,D=arguments.length>10?arguments[10]:void 0,i=arguments.length>11?arguments[11]:void 0;return"data:"!==d.substring(0,5)&&(d="data:"+d),new F(d,A,N,p,B,X,W,t,w,a,void 0,void 0,D,i)}}F.SerializeBuffers=!0,F.ForceSerializeBuffers=!1,F.OnTextureLoadErrorObservable=new p.b,F._SerializeInternalTextureUniqueId=!1,F._CubeTextureParser=(d,t,A)=>{throw(0,a.b)("CubeTexture")},F._CreateMirror=(d,t,A,w)=>{throw(0,a.b)("MirrorTexture")},F._CreateRenderTargetTexture=(d,t,A,w,N)=>{throw(0,a.b)("RenderTargetTexture")},F.NEAREST_SAMPLINGMODE=1,F.NEAREST_NEAREST_MIPLINEAR=8,F.BILINEAR_SAMPLINGMODE=2,F.LINEAR_LINEAR_MIPNEAREST=11,F.TRILINEAR_SAMPLINGMODE=3,F.LINEAR_LINEAR_MIPLINEAR=3,F.NEAREST_NEAREST_MIPNEAREST=4,F.NEAREST_LINEAR_MIPNEAREST=5,F.NEAREST_LINEAR_MIPLINEAR=6,F.NEAREST_LINEAR=7,F.NEAREST_NEAREST=1,F.LINEAR_NEAREST_MIPNEAREST=9,F.LINEAR_NEAREST_MIPLINEAR=10,F.LINEAR_LINEAR=2,F.LINEAR_NEAREST=12,F.EXPLICIT_MODE=0,F.SPHERICAL_MODE=1,F.PLANAR_MODE=2,F.CUBIC_MODE=3,F.PROJECTION_MODE=4,F.SKYBOX_MODE=5,F.INVCUBIC_MODE=6,F.EQUIRECTANGULAR_MODE=7,F.FIXED_EQUIRECTANGULAR_MODE=8,F.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,F.CLAMP_ADDRESSMODE=0,F.WRAP_ADDRESSMODE=1,F.MIRROR_ADDRESSMODE=2,F.UseSerializedUrlIfAny=!1,(0,w.b)([(0,N.J)()],F.prototype,"url",void 0),(0,w.b)([(0,N.J)()],F.prototype,"uOffset",void 0),(0,w.b)([(0,N.J)()],F.prototype,"vOffset",void 0),(0,w.b)([(0,N.J)()],F.prototype,"uScale",void 0),(0,w.b)([(0,N.J)()],F.prototype,"vScale",void 0),(0,w.b)([(0,N.J)()],F.prototype,"uAng",void 0),(0,w.b)([(0,N.J)()],F.prototype,"vAng",void 0),(0,w.b)([(0,N.J)()],F.prototype,"wAng",void 0),(0,w.b)([(0,N.J)()],F.prototype,"uRotationCenter",void 0),(0,w.b)([(0,N.J)()],F.prototype,"vRotationCenter",void 0),(0,w.b)([(0,N.J)()],F.prototype,"wRotationCenter",void 0),(0,w.b)([(0,N.J)()],F.prototype,"homogeneousRotationInUVTransform",void 0),(0,w.b)([(0,N.J)()],F.prototype,"isBlocking",null),(0,W.g)("BABYLON.Texture",F),T.d._TextureParser=F.Parse},10863:(d,t,A)=>{"use strict";A.d(t,{d:()=>w});class w{get wrapU(){return this._cachedWrapU}set wrapU(d){this._cachedWrapU=d}get wrapV(){return this._cachedWrapV}set wrapV(d){this._cachedWrapV=d}get wrapR(){return this._cachedWrapR}set wrapR(d){this._cachedWrapR=d}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(d){this._cachedAnisotropicFilteringLevel=d}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(d){this._comparisonFunction=d}get useMipMaps(){return this._useMipMaps}set useMipMaps(d){this._useMipMaps=d}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=d,this._cachedWrapV=t,this._cachedWrapR=A,this._cachedAnisotropicFilteringLevel=w,this.samplingMode=N,this._comparisonFunction=p,this}compareSampler(d){return this._cachedWrapU===d._cachedWrapU&&this._cachedWrapV===d._cachedWrapV&&this._cachedWrapR===d._cachedWrapR&&this._cachedAnisotropicFilteringLevel===d._cachedAnisotropicFilteringLevel&&this.samplingMode===d.samplingMode&&this._comparisonFunction===d._comparisonFunction&&this._useMipMaps===d._useMipMaps}}},11254:(d,t,A)=>{"use strict";function w(d){-1===d.indexOf("vClipPlane")&&d.push("vClipPlane"),-1===d.indexOf("vClipPlane2")&&d.push("vClipPlane2"),-1===d.indexOf("vClipPlane3")&&d.push("vClipPlane3"),-1===d.indexOf("vClipPlane4")&&d.push("vClipPlane4"),-1===d.indexOf("vClipPlane5")&&d.push("vClipPlane5"),-1===d.indexOf("vClipPlane6")&&d.push("vClipPlane6")}function N(d,t,A){const w=!!(d.clipPlane??t.clipPlane),N=!!(d.clipPlane2??t.clipPlane2),p=!!(d.clipPlane3??t.clipPlane3),B=!!(d.clipPlane4??t.clipPlane4),X=!!(d.clipPlane5??t.clipPlane5),W=!!(d.clipPlane6??t.clipPlane6);w&&A.push("#define CLIPPLANE"),N&&A.push("#define CLIPPLANE2"),p&&A.push("#define CLIPPLANE3"),B&&A.push("#define CLIPPLANE4"),X&&A.push("#define CLIPPLANE5"),W&&A.push("#define CLIPPLANE6")}function p(d,t,A){let w=!1;const N=!!(d.clipPlane??t.clipPlane),p=!!(d.clipPlane2??t.clipPlane2),B=!!(d.clipPlane3??t.clipPlane3),X=!!(d.clipPlane4??t.clipPlane4),W=!!(d.clipPlane5??t.clipPlane5),a=!!(d.clipPlane6??t.clipPlane6);return A.CLIPPLANE!==N&&(A.CLIPPLANE=N,w=!0),A.CLIPPLANE2!==p&&(A.CLIPPLANE2=p,w=!0),A.CLIPPLANE3!==B&&(A.CLIPPLANE3=B,w=!0),A.CLIPPLANE4!==X&&(A.CLIPPLANE4=X,w=!0),A.CLIPPLANE5!==W&&(A.CLIPPLANE5=W,w=!0),A.CLIPPLANE6!==a&&(A.CLIPPLANE6=a,w=!0),w}function B(d,t,A){let w=t.clipPlane??A.clipPlane;X(d,"vClipPlane",w),w=t.clipPlane2??A.clipPlane2,X(d,"vClipPlane2",w),w=t.clipPlane3??A.clipPlane3,X(d,"vClipPlane3",w),w=t.clipPlane4??A.clipPlane4,X(d,"vClipPlane4",w),w=t.clipPlane5??A.clipPlane5,X(d,"vClipPlane5",w),w=t.clipPlane6??A.clipPlane6,X(d,"vClipPlane6",w)}function X(d,t,A){A&&d.setFloat4(t,A.ab.x,A.ab.y,A.ab.z,A.d)}A.d(t,{e:()=>w,g:()=>B,j:()=>p,l:()=>N})},11099:(d,t,A)=>{"use strict";function w(d){d.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}A.d(t,{b:()=>w})},11484:(d,t,A)=>{"use strict";function w(d){return void 0===d.getPipelineContext}A.d(t,{c:()=>w})},11239:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});class w{static GetEffect(d){return void 0===d.getPipelineContext?d.effect:d}constructor(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=d.createDrawContext(),t&&(this.materialContext=d.createMaterialContext())}setEffect(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var w;(this.effect=d,void 0!==t&&(this.defines=t),A)&&(null===(w=this.drawContext)||void 0===w||w.reset())}dispose(){var d;null===(d=this.drawContext)||void 0===d||d.dispose()}}},10845:(d,t,A)=>{"use strict";A.d(t,{e:()=>i,g:()=>b,k:()=>a,o:()=>D});var w=A(10737),N=A(10851),p=A(10837),B=A(10740),X=A(10798),W=A(10807);function a(d,t){return(0,N.z)(t).cachedPipelines[d]}function D(d){const t=d._name,A=d.context;if(t&&A){const d=(0,N.z)(A),w=d.cachedPipelines[t];null===w||void 0===w||w.dispose(),delete d.cachedPipelines[t]}}function i(d,t,A,N,p,B,W){let a,D;const i=(0,w.l)()?null===B||void 0===B?void 0:B.getHostDocument():null;a="string"===typeof t?t:t.vertexSource?"source:"+t.vertexSource:t.vertexElement?(null===i||void 0===i?void 0:i.getElementById(t.vertexElement))||t.vertexElement:t.vertex||t,D="string"===typeof t?t:t.fragmentSource?"source:"+t.fragmentSource:t.fragmentElement?(null===i||void 0===i?void 0:i.getElementById(t.fragmentElement))||t.fragmentElement:t.fragment||t;const b=[void 0,void 0],Q=()=>{if(b[0]&&b[1]){d.isFragment=!0;const[w,a]=b;(0,X.g)(a,d,((B,a)=>{W&&(W._fragmentSourceCodeBeforeMigration=a),A&&(B=A("fragment",B));const D=(0,X.b)(w,B,d);d=null;const i=function(d,t,A,w){if(A){return{vertexSourceCode:(1===w?"//":"")+"#define SHADER_NAME vertex:"+(A.vertexElement||A.vertex||A.spectorName||A)+"\n"+d,fragmentSourceCode:(1===w?"//":"")+"#define SHADER_NAME fragment:"+(A.fragmentElement||A.fragment||A.spectorName||A)+"\n"+t}}return{vertexSourceCode:d,fragmentSourceCode:t}}(D.vertexCode,D.fragmentCode,t,p);null===N||void 0===N||N(i.vertexSourceCode,i.fragmentSourceCode)}),B)}};k(a,"Vertex","",(t=>{(0,X.e)(d),(0,X.g)(t,d,((d,w)=>{W&&(W._rawVertexSourceCode=t,W._vertexSourceCodeBeforeMigration=w),A&&(d=A("vertex",d)),b[0]=d,Q()}),B)}),p),k(D,"Fragment","Pixel",(d=>{W&&(W._rawFragmentSourceCode=d),b[1]=d,Q()}),p)}function k(d,t,A,N,B,X){if("undefined"!==typeof HTMLElement&&d instanceof HTMLElement){return void N((0,w.c)(d))}if("source:"===d.substring(0,7))return void N(d.substring(7));if("base64:"===d.substring(0,7)){return void N(window.atob(d.substring(7)))}const a=p.c.GetShadersStore(B);if(a[d+t+"Shader"])return void N(a[d+t+"Shader"]);if(A&&a[d+A+"Shader"])return void N(a[d+A+"Shader"]);let D;if(D="."===d[0]||"/"===d[0]||d.indexOf("http")>-1?d:p.c.GetShadersRepository(B)+d,!(X=X||W.g))throw new Error("loadFileInjection is not defined");X(D+"."+t.toLowerCase()+".fx",N)}const b=(d,t,A,w)=>{try{const p=d.existingPipelineContext||t(d.shaderProcessingContext);if(p._name=d.name,d.name&&d.context){(0,N.z)(d.context).cachedPipelines[d.name]=p}return A(p,d.vertex,d.fragment,!!d.createAsRaw,"","",d.rebuildRebind,d.defines,d.transformFeedbackVaryings,"",(()=>{w(p,(()=>{var t;null===(t=d.onRenderingStateCompiled)||void 0===t||t.call(d,p)}))})),p}catch(p){throw B.e.Error("Error compiling effect"),p}}},10829:(d,t,A)=>{"use strict";A.d(t,{e:()=>X});var w=A(10730),N=A(10740),p=A(10837),B=A(10845);class X{static get ShadersRepository(){return p.c.ShadersRepository}static set ShadersRepository(d){p.c.ShadersRepository=d}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new w.b),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0,W=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,D=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,i=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,k=arguments.length>9?arguments[9]:void 0,b=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",Q=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,P=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new w.b,this.onErrorObservable=new w.b,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=d,this._key=b;const J=this._key.replace(/\r/g,"").replace(/\n/g,"|");let U;if(t.attributes){const d=t;if(this._engine=A,this._attributesNames=d.attributes,this._uniformsNames=d.uniformsNames.concat(d.samplers),this._samplerList=d.samplers.slice(),this.defines=d.defines,this.onError=d.onError,this.onCompiled=d.onCompiled,this._fallbacks=d.fallbacks,this._indexParameters=d.indexParameters,this._transformFeedbackVaryings=d.transformFeedbackVaryings||null,this._multiTarget=!!d.multiTarget,this._shaderLanguage=d.shaderLanguage??0,d.uniformBuffersNames){this._uniformBuffersNamesList=d.uniformBuffersNames.slice();for(let t=0;t<d.uniformBuffersNames.length;t++)this._uniformBuffersNames[d.uniformBuffersNames[t]]=t}this._processFinalCode=d.processFinalCode??null,this._processCodeAfterIncludes=d.processCodeAfterIncludes??void 0,U=d.existingPipelineContext}else this._engine=p,this.defines=null==W?"":W,this._uniformsNames=A.concat(N),this._samplerList=N?N.slice():[],this._attributesNames=t,this._uniformBuffersNamesList=[],this._shaderLanguage=Q,this.onError=i,this.onCompiled=D,this._indexParameters=k,this._fallbacks=a;"WEBGL2"===this._engine.shaderPlatformName&&(U=(0,B.k)(J,this._engine._gl)??U),this._attributeLocationByName={},this.uniqueId=X._UniqueIdSeed++,U?(this._pipelineContext=U,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,P)}async _processShaderCodeAsync(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3?arguments[3]:void 0;w&&await w(),this._processingContext=A||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const N={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:d??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:p.c.GetShadersRepository(this._shaderLanguage),includesShadersStore:p.c.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,B.e)(N,this.name,this._processFinalCode,((d,A)=>{this._vertexSourceCode=d,this._fragmentSourceCode=A,this._prepareEffect(t)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(d){return this._attributes[d]}getAttributeLocationByName(d){return this._attributeLocationByName[d]}getAttributesCount(){return this._attributes.length}getUniformIndex(d){return this._uniformsNames.indexOf(d)}getUniform(d){return this._uniforms[d]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(d){this.isReady()?d(this):(this.onCompileObservable.add((t=>{d(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(d){try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,d)}this._isDisposed||setTimeout((()=>{this._checkIsReady(d)}),16)}get vertexSourceCode(){var d;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(d=this._pipelineContext)||void 0===d?void 0:d._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var d;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(d=this._pipelineContext)||void 0===d?void 0:d._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(d,t,A,w){this._isReady=!1,this._vertexSourceCodeOverride=d,this._fragmentSourceCodeOverride=t,this.onError=(d,t)=>{w&&w(t)},this.onCompiled=()=>{var d,t;const w=this.getEngine().scenes;if(w)for(let A=0;A<w.length;A++)w[A].markAllMaterialsAsDirty(63);null===(d=(t=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===d||d.call(t,A)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(d){if(this._pipelineContext=d,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let t=0;t<this._attributesNames.length;t++){const d=this._attributesNames[t];this._attributeLocationByName[d]=this._attributes[t]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),X.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this._pipelineContext;this._isReady=!1;try{const A=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),w=A?null:this.defines,N=A?this._vertexSourceCodeOverride:this._vertexSourceCode,p=A?this._fragmentSourceCodeOverride:this._fragmentSourceCode,X=this._engine;this._pipelineContext=(0,B.g)({existingPipelineContext:d?t:null,vertex:N,fragment:p,context:"WEBGL2"===X.shaderPlatformName?X._gl:void 0,rebuildRebind:(d,t,A,w)=>this._rebuildProgram(d,t,A,w),defines:w,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:A,parallelShaderCompile:X._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:A=>{t&&!d&&this._engine._deletePipelineContext(t),A&&this._onRenderingStateCompiled(A)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(t)}catch(A){this._processCompilationErrors(A,t)}}_getShaderCodeAndErrorLine(d,t,A){const w=A?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let N=null;if(t&&d){const p=t.match(w);if(p&&2===p.length){const t=parseInt(p[1]),w=d.split("\n",-1);w.length>=t&&(N=`Offending line [${t}] in ${A?"fragment":"vertex"} code: ${w[t-1]}`)}}return[d,N]}_processCompilationErrors(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=d.message;const A=this._attributesNames,w=this._fallbacks;if(N.e.Error("Unable to compile effect:"),N.e.Error("Uniforms: "+this._uniformsNames.map((function(d){return" "+d}))),N.e.Error("Attributes: "+A.map((function(d){return" "+d}))),N.e.Error("Defines:\n"+this.defines),X.LogShaderCodeOnCompilationError){var p,B;let d=null,t=null,A=null;var W;if(null!==(p=this._pipelineContext)&&void 0!==p&&p._getVertexShaderCode()&&([A,d]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),A&&(N.e.Error("Vertex code:"),N.e.Error(A))),null!==(B=this._pipelineContext)&&void 0!==B&&B._getFragmentShaderCode())[A,t]=this._getShaderCodeAndErrorLine(null===(W=this._pipelineContext)||void 0===W?void 0:W._getFragmentShaderCode(),this._compilationError,!0),A&&(N.e.Error("Fragment code:"),N.e.Error(A));d&&N.e.Error(d),t&&N.e.Error(t)}N.e.Error("Error: "+this._compilationError);const a=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};t&&(this._pipelineContext=t,this._isReady=!0,a()),w?(this._pipelineContext=null,w.hasMoreFallbacks?(this._allFallbacksProcessed=!1,N.e.Error("Trying next fallback."),this.defines=w.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,a(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,t||a())}get isSupported(){return""===this._compilationError}_bindTexture(d,t){this._engine._bindTexture(this._samplers[d],t,d)}setTexture(d,t){this._engine.setTexture(this._samplers[d],this._uniforms[d],t,d)}setTextureArray(d,t){const A=d+"Ex";if(-1===this._samplerList.indexOf(A+"0")){const w=this._samplerList.indexOf(d);for(let d=1;d<t.length;d++){const t=A+(d-1).toString();this._samplerList.splice(w+d,0,t)}let N=0;for(const d of this._samplerList)this._samplers[d]=N,N+=1}this._engine.setTextureArray(this._samplers[d],this._uniforms[d],t,d)}bindUniformBuffer(d,t){const A=this._uniformBuffersNames[t];void 0===A||X._BaseCache[A]===d&&this._engine._features.useUBOBindingCache||(X._BaseCache[A]=d,this._engine.bindUniformBufferBase(d,A,t))}bindUniformBlock(d,t){this._engine.bindUniformBlock(this._pipelineContext,d,t)}setInt(d,t){return this._pipelineContext.setInt(d,t),this}setInt2(d,t,A){return this._pipelineContext.setInt2(d,t,A),this}setInt3(d,t,A,w){return this._pipelineContext.setInt3(d,t,A,w),this}setInt4(d,t,A,w,N){return this._pipelineContext.setInt4(d,t,A,w,N),this}setIntArray(d,t){return this._pipelineContext.setIntArray(d,t),this}setIntArray2(d,t){return this._pipelineContext.setIntArray2(d,t),this}setIntArray3(d,t){return this._pipelineContext.setIntArray3(d,t),this}setIntArray4(d,t){return this._pipelineContext.setIntArray4(d,t),this}setUInt(d,t){return this._pipelineContext.setUInt(d,t),this}setUInt2(d,t,A){return this._pipelineContext.setUInt2(d,t,A),this}setUInt3(d,t,A,w){return this._pipelineContext.setUInt3(d,t,A,w),this}setUInt4(d,t,A,w,N){return this._pipelineContext.setUInt4(d,t,A,w,N),this}setUIntArray(d,t){return this._pipelineContext.setUIntArray(d,t),this}setUIntArray2(d,t){return this._pipelineContext.setUIntArray2(d,t),this}setUIntArray3(d,t){return this._pipelineContext.setUIntArray3(d,t),this}setUIntArray4(d,t){return this._pipelineContext.setUIntArray4(d,t),this}setFloatArray(d,t){return this._pipelineContext.setArray(d,t),this}setFloatArray2(d,t){return this._pipelineContext.setArray2(d,t),this}setFloatArray3(d,t){return this._pipelineContext.setArray3(d,t),this}setFloatArray4(d,t){return this._pipelineContext.setArray4(d,t),this}setArray(d,t){return this._pipelineContext.setArray(d,t),this}setArray2(d,t){return this._pipelineContext.setArray2(d,t),this}setArray3(d,t){return this._pipelineContext.setArray3(d,t),this}setArray4(d,t){return this._pipelineContext.setArray4(d,t),this}setMatrices(d,t){return this._pipelineContext.setMatrices(d,t),this}setMatrix(d,t){return this._pipelineContext.setMatrix(d,t),this}setMatrix3x3(d,t){return this._pipelineContext.setMatrix3x3(d,t),this}setMatrix2x2(d,t){return this._pipelineContext.setMatrix2x2(d,t),this}setFloat(d,t){return this._pipelineContext.setFloat(d,t),this}setBool(d,t){return this._pipelineContext.setInt(d,t?1:0),this}setVector2(d,t){return this._pipelineContext.setVector2(d,t),this}setFloat2(d,t,A){return this._pipelineContext.setFloat2(d,t,A),this}setVector3(d,t){return this._pipelineContext.setVector3(d,t),this}setFloat3(d,t,A,w){return this._pipelineContext.setFloat3(d,t,A,w),this}setVector4(d,t){return this._pipelineContext.setVector4(d,t),this}setQuaternion(d,t){return this._pipelineContext.setQuaternion(d,t),this}setFloat4(d,t,A,w,N){return this._pipelineContext.setFloat4(d,t,A,w,N),this}setColor3(d,t){return this._pipelineContext.setColor3(d,t),this}setColor4(d,t,A){return this._pipelineContext.setColor4(d,t,A),this}setDirectColor4(d,t){return this._pipelineContext.setDirectColor4(d,t),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,B.o)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;t&&(p.c.GetShadersStore(w)[`${d}PixelShader`]=t),A&&(p.c.GetShadersStore(w)[`${d}VertexShader`]=A)}static ResetCache(){X._BaseCache={}}}X.LogShaderCodeOnCompilationError=!0,X.AutomaticallyClearCodeCache=!1,X._UniqueIdSeed=0,X._BaseCache={},X.ShadersStore=p.c.ShadersStore,X.IncludesShadersStore=p.c.IncludesShadersStore},11285:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});class w{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this.Vk=null}unBindMesh(){this.Vk=null}addFallback(d,t){this._defines[d]||(d<this._currentRank&&(this._currentRank=d),d>this._maxRank&&(this._maxRank=d),this._defines[d]=new Array),this._defines[d].push(t)}addCPUSkinningFallback(d,t){this.Vk=t,d<this._currentRank&&(this._currentRank=d),d>this._maxRank&&(this._maxRank=d)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(d,t){if(this.Vk&&this.Vk.computeBonesUsingShaders&&this.Vk.numBoneInfluencers>0){this.Vk.computeBonesUsingShaders=!1,d=d.replace("#define NUM_BONE_INFLUENCERS "+this.Vk.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),t._bonesComputationForcedToCPU=!0;const A=this.Vk.va();for(let d=0;d<A.meshes.length;d++){const w=A.meshes[d];if(w.material){if(w.computeBonesUsingShaders&&0!==w.numBoneInfluencers)if(w.material.getEffect()===t)w.computeBonesUsingShaders=!1;else if(w.If)for(const d of w.If){if(d.effect===t){w.computeBonesUsingShaders=!1;break}}}else!this.Vk.material&&w.computeBonesUsingShaders&&w.numBoneInfluencers>0&&(w.computeBonesUsingShaders=!1)}}else{const t=this._defines[this._currentRank];if(t)for(let A=0;A<t.length;A++)d=d.replace("#define "+t[A],"");this._currentRank++}return d}}},11593:(d,t,A)=>{"use strict";A.d(t,{d:()=>a,g:()=>D});var w=A(11120),N=A(11333),p=A(10730),B=A(10829),X=A(11239);A(11599);const W={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class a{constructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:W;this._fullscreenViewport=new N.d(0,0,1,1);const A=t.xa??W.xa,p=t.indices??W.indices;this.ud=d,this._vertexBuffers={[w.f.PositionKind]:new w.f(d,A,w.f.PositionKind,!1,!1,2)},this._indexBuffer=d.createIndexBuffer(p),this._onContextRestoredObserver=d.onContextRestoredObservable.add((()=>{this._indexBuffer=d.createIndexBuffer(p);for(const d in this._vertexBuffers){this._vertexBuffers[d]._rebuild()}}))}setViewport(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.ud.setViewport(d)}bindBuffers(d){this.ud.bindBuffers(this._vertexBuffers,this._indexBuffer,d)}applyEffectWrapper(d){this.ud.setState(!0),this.ud.depthCullingState.depthTest=!1,this.ud.stencilState.stencilTest=!1,this.ud.enableEffect(d.drawWrapper),this.bindBuffers(d.effect),d.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.ud.depthCullingState.depthTest,this._savedStateStencilTest=this.ud.stencilState.stencilTest}restoreStates(){this.ud.depthCullingState.depthTest=this._savedStateDepthTest,this.ud.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.ud.drawElementsType(0,0,6)}_isRenderTargetTexture(d){return void 0!==d.renderTarget}render(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!d.effect.isReady())return;this.saveStates(),this.setViewport();const A=null===t?null:this._isRenderTargetTexture(t)?t.renderTarget:t;A&&this.ud.bindFramebuffer(A),this.applyEffectWrapper(d),this.draw(),A&&this.ud.unBindFramebuffer(A),this.restoreStates()}dispose(){const d=this._vertexBuffers[w.f.PositionKind];d&&(d.dispose(),delete this._vertexBuffers[w.f.PositionKind]),this._indexBuffer&&this.ud._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.ud.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class D{static RegisterShaderCodeProcessing(d,t){t?D._CustomShaderCodeProcessing[d??""]=t:delete D._CustomShaderCodeProcessing[d??""]}static _GetShaderCodeProcessing(d){return D._CustomShaderCodeProcessing[d]??D._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(d){this.options.name=d}isReady(){var d;return(null===(d=this._drawWrapper.effect)||void 0===d?void 0:d.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(d){this._drawWrapper.effect=d}constructor(d){this.alphaMode=0,this.onEffectCreatedObservable=new p.b(void 0,!0),this.onApplyObservable=new p.b,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...d,name:d.name||"effectWrapper",ud:d.ud,uniforms:d.uniforms||d.uniformNames||[],uniformNames:void 0,samplers:d.samplers||d.samplerNames||[],samplerNames:void 0,attributeNames:d.attributeNames||["position"],uniformBuffers:d.uniformBuffers||[],defines:d.defines||"",useShaderStore:d.useShaderStore||!1,vertexUrl:d.vertexUrl||d.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:d.fragmentShader||"pass",indexParameters:d.indexParameters,blockCompilation:d.blockCompilation||!1,shaderLanguage:d.shaderLanguage||0,onCompiled:d.onCompiled||void 0,extraInitializations:d.extraInitializations||void 0,extraInitializationsAsync:d.extraInitializationsAsync||void 0,useAsPostProcess:d.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),d.vertexUrl||d.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.ud.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new X.b(this.options.ud),this._webGPUReady=1===this.options.shaderLanguage;const t=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,t,this.options.extraInitializations)}_gatherImports(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(d&&this._webGPUReady?t.push(Promise.all([A.e(37).then(A.bind(A,13261))])):t.push(Promise.all([Promise.resolve().then(A.bind(A,11599))])))}_postConstructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,w&&this._importPromises.push(...w);const N=this.options.ud.isWebGPU&&!D.ForceGLSL;this._gatherImports(N,this._importPromises),void 0!==A&&A(N,this._importPromises),N&&this._webGPUReady&&(this.options.shaderLanguage=1),d||this.updateEffect(t)}updateEffect(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,W=arguments.length>7?arguments[7]:void 0;const a=D._GetShaderCodeProcessing(this.name);if(null!==a&&void 0!==a&&a.defineCustomBindings){var i,k;const w=(null===(i=t)||void 0===i?void 0:i.slice())??[];w.push(...this.options.uniforms);const N=(null===(k=A)||void 0===k?void 0:k.slice())??[];N.push(...this.options.samplers),d=a.defineCustomBindings(this.name,d,w,N),t=w,A=N}this.options.defines=d||"";const b=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let Q;Q=this.options.extraInitializationsAsync?async()=>{null===b||void 0===b||b(),await this.options.extraInitializationsAsync}:b,this.options.useShaderStore?this._drawWrapper.effect=this.options.ud.createEffect({vertex:X??this._shaderPath.vertex,fragment:W??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:t||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:A||this.options.samplers,defines:null!==d?d:"",fallbacks:null,onCompiled:N??this.options.onCompiled,onError:p??null,indexParameters:w||this.options.indexParameters,processCodeAfterIncludes:null!==a&&void 0!==a&&a.processCodeAfterIncludes?(d,t)=>a.processCodeAfterIncludes(this.name,d,t):null,processFinalCode:null!==a&&void 0!==a&&a.processFinalCode?(d,t)=>a.processFinalCode(this.name,d,t):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:Q},this.options.ud):this._drawWrapper.effect=new B.e(this._shaderPath,this.options.attributeNames,t||this.options.uniforms,A||this.options.samplerNames,this.options.ud,d,void 0,N||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,Q),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var d,t;this.options.useAsPostProcess&&(this.options.ud.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(d=D._GetShaderCodeProcessing(this.name))||void 0===d||null===(t=d.bindCustomBindings)||void 0===t||t.call(d,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}D.ForceGLSL=!1,D._CustomShaderCodeProcessing={}},11106:(d,t,A)=>{"use strict";A.d(t,{c:()=>p,f:()=>N});var w=A(11099);function N(d,t){t.EXPOSURE&&d.push("exposureLinear"),t.CONTRAST&&d.push("contrast"),t.COLORGRADING&&d.push("colorTransformSettings"),(t.VIGNETTE||t.DITHER)&&d.push("vInverseScreenSize"),t.VIGNETTE&&(d.push("vignetteSettings1"),d.push("vignetteSettings2")),t.COLORCURVES&&(0,w.b)(d),t.DITHER&&d.push("ditherIntensity")}function p(d,t){t.COLORGRADING&&d.push("txColorTransform")}},11092:(d,t,A)=>{"use strict";A.d(t,{c:()=>b});var w=A(11041),N=A(11047),p=A(10730),B=A(11094),X=A(11097),W=A(11099);class a{constructor(){this._dirty=!0,this._tempColor=new B.i(0,0,0,0),this._globalCurve=new B.i(0,0,0,0),this._highlightsCurve=new B.i(0,0,0,0),this._midtonesCurve=new B.i(0,0,0,0),this._shadowsCurve=new B.i(0,0,0,0),this._positiveCurve=new B.i(0,0,0,0),this._negativeCurve=new B.i(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(d){this._globalHue=d,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(d){this._globalDensity=d,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(d){this._globalSaturation=d,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(d){this._globalExposure=d,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(d){this._highlightsHue=d,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(d){this._highlightsDensity=d,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(d){this._highlightsSaturation=d,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(d){this._highlightsExposure=d,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(d){this._midtonesHue=d,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(d){this._midtonesDensity=d,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(d){this._midtonesSaturation=d,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(d){this._midtonesExposure=d,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(d){this._shadowsHue=d,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(d){this._shadowsDensity=d,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(d){this._shadowsSaturation=d,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(d){this._shadowsExposure=d,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";d._dirty&&(d._dirty=!1,d._getColorGradingDataToRef(d._globalHue,d._globalDensity,d._globalSaturation,d._globalExposure,d._globalCurve),d._getColorGradingDataToRef(d._highlightsHue,d._highlightsDensity,d._highlightsSaturation,d._highlightsExposure,d._tempColor),d._tempColor.multiplyToRef(d._globalCurve,d._highlightsCurve),d._getColorGradingDataToRef(d._midtonesHue,d._midtonesDensity,d._midtonesSaturation,d._midtonesExposure,d._tempColor),d._tempColor.multiplyToRef(d._globalCurve,d._midtonesCurve),d._getColorGradingDataToRef(d._shadowsHue,d._shadowsDensity,d._shadowsSaturation,d._shadowsExposure,d._tempColor),d._tempColor.multiplyToRef(d._globalCurve,d._shadowsCurve),d._highlightsCurve.subtractToRef(d._midtonesCurve,d._positiveCurve),d._midtonesCurve.subtractToRef(d._shadowsCurve,d._negativeCurve)),t&&(t.setFloat4(A,d._positiveCurve.r,d._positiveCurve.g,d._positiveCurve.b,d._positiveCurve.a),t.setFloat4(w,d._midtonesCurve.r,d._midtonesCurve.g,d._midtonesCurve.b,d._midtonesCurve.a),t.setFloat4(N,d._negativeCurve.r,d._negativeCurve.g,d._negativeCurve.b,d._negativeCurve.a))}_getColorGradingDataToRef(d,t,A,w,N){null!=d&&(d=a._Clamp(d,0,360),t=a._Clamp(t,-100,100),A=a._Clamp(A,-100,100),w=a._Clamp(w,-100,100),t=a._ApplyColorGradingSliderNonlinear(t),t*=.5,w=a._ApplyColorGradingSliderNonlinear(w),t<0&&(t*=-1,d=(d+180)%360),a._FromHSBToRef(d,t,50+.25*w,N),N.scaleToRef(2,N),N.a=1+.01*A)}static _ApplyColorGradingSliderNonlinear(d){d/=100;let t=Math.abs(d);return t=Math.pow(t,2),d<0&&(t*=-1),t*=100,t}static _FromHSBToRef(d,t,A,w){let N=a._Clamp(d,0,360);const p=a._Clamp(t/100,0,1),B=a._Clamp(A/100,0,1);if(0===p)w.r=B,w.g=B,w.b=B;else{N/=60;const d=Math.floor(N),t=N-d,A=B*(1-p),X=B*(1-p*t),W=B*(1-p*(1-t));switch(d){case 0:w.r=B,w.g=W,w.b=A;break;case 1:w.r=X,w.g=B,w.b=A;break;case 2:w.r=A,w.g=B,w.b=W;break;case 3:w.r=A,w.g=X,w.b=B;break;case 4:w.r=W,w.g=A,w.b=B;break;default:w.r=B,w.g=A,w.b=X}}w.a=1}static _Clamp(d,t,A){return Math.min(Math.max(d,t),A)}clone(){return X.d.Clone((()=>new a),this)}serialize(){return X.d.Serialize(this)}static Parse(d){return X.d.Parse((()=>new a),d,null,null)}}a.PrepareUniforms=W.b,(0,w.b)([(0,N.J)()],a.prototype,"_globalHue",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_globalDensity",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_globalSaturation",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_globalExposure",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_highlightsHue",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_highlightsDensity",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_highlightsSaturation",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_highlightsExposure",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_midtonesHue",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_midtonesDensity",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_midtonesSaturation",void 0),(0,w.b)([(0,N.J)()],a.prototype,"_midtonesExposure",void 0),X.d._ColorCurvesParser=a.Parse;var D=A(10896),i=A(11106),k=A(10885);class b{constructor(){this.colorCurves=new a,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=b.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new B.i(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=b.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new p.b}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(d){this._colorCurvesEnabled!==d&&(this._colorCurvesEnabled=d,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(d){this._colorGradingTexture!==d&&(this._colorGradingTexture=d,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(d){this._colorGradingEnabled!==d&&(this._colorGradingEnabled=d,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(d){this._colorGradingWithGreenDepth!==d&&(this._colorGradingWithGreenDepth=d,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(d){this._colorGradingBGR!==d&&(this._colorGradingBGR=d,this._updateParameters())}get exposure(){return this._exposure}set exposure(d){this._exposure!==d&&(this._exposure=d,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(d){this._toneMappingEnabled!==d&&(this._toneMappingEnabled=d,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(d){this._toneMappingType!==d&&(this._toneMappingType=d,this._updateParameters())}get contrast(){return this._contrast}set contrast(d){this._contrast!==d&&(this._contrast=d,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(d){this.vignetteCenterY=d}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(d){this.vignetteCenterX=d}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(d){this._vignetteBlendMode!==d&&(this._vignetteBlendMode=d,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(d){this._vignetteEnabled!==d&&(this._vignetteEnabled=d,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(d){this._ditheringEnabled!==d&&(this._ditheringEnabled=d,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(d){this._ditheringIntensity!==d&&(this._ditheringIntensity=d,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(d){this._skipFinalColorClamp!==d&&(this._skipFinalColorClamp=d,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(d){this._applyByPostProcess!==d&&(this._applyByPostProcess=d,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(d){this._isEnabled!==d&&(this._isEnabled=d,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(d){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return d.VIGNETTE=!1,d.TONEMAPPING=0,d.CONTRAST=!1,d.EXPOSURE=!1,d.COLORCURVES=!1,d.COLORGRADING=!1,d.COLORGRADING3D=!1,d.DITHER=!1,d.IMAGEPROCESSING=!1,d.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(d.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(d.VIGNETTE=this.vignetteEnabled,d.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===b._VIGNETTEMODE_MULTIPLY,d.VIGNETTEBLENDMODEOPAQUE=!d.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case b.TONEMAPPING_KHR_PBR_NEUTRAL:d.TONEMAPPING=3;break;case b.TONEMAPPING_ACES:d.TONEMAPPING=2;break;default:d.TONEMAPPING=1}else d.TONEMAPPING=0;d.CONTRAST=1!==this.contrast,d.EXPOSURE=1!==this.exposure,d.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,d.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,d.COLORGRADING?d.COLORGRADING3D=this.colorGradingTexture.is3D:d.COLORGRADING3D=!1,d.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,d.SAMPLER3DBGRMAP=this.colorGradingBGR,d.DITHER=this._ditheringEnabled,d.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,d.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,d.IMAGEPROCESSING=d.VIGNETTE||!!d.TONEMAPPING||d.CONTRAST||d.EXPOSURE||d.COLORCURVES||d.COLORGRADING||d.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(d,t){if(this._colorCurvesEnabled&&this.colorCurves&&a.Bind(this.colorCurves,d),this._vignetteEnabled||this._ditheringEnabled){const A=1/d.getEngine().getRenderWidth(),w=1/d.getEngine().getRenderHeight();if(d.setFloat2("vInverseScreenSize",A,w),this._ditheringEnabled&&d.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const N=null!=t?t:w/A;let p=Math.tan(.5*this.vignetteCameraFov),B=p*N;const X=Math.sqrt(B*p);B=(0,D.l)(B,X,this.vignetteStretch),p=(0,D.l)(p,X,this.vignetteStretch),d.setFloat4("vignetteSettings1",B,p,-B*this.vignetteCenterX,-p*this.vignetteCenterY);const W=-2*this.vignetteWeight;d.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,W)}}if(d.setFloat("exposureLinear",this.exposure),d.setFloat("contrast",this.contrast),this.colorGradingTexture){d.setTexture("txColorTransform",this.colorGradingTexture);const t=this.colorGradingTexture.getSize().height;d.setFloat4("colorTransformSettings",(t-1)/t,.5/t,t,this.colorGradingTexture.level)}}clone(){return X.d.Clone((()=>new b),this)}serialize(){return X.d.Serialize(this)}static Parse(d){const t=X.d.Parse((()=>new b),d,null,null);return void 0!==d.vignetteCentreX&&(t.vignetteCenterX=d.vignetteCentreX),void 0!==d.vignetteCentreY&&(t.vignetteCenterY=d.vignetteCentreY),t}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}b.TONEMAPPING_STANDARD=0,b.TONEMAPPING_ACES=1,b.TONEMAPPING_KHR_PBR_NEUTRAL=2,b.PrepareUniforms=i.f,b.PrepareSamplers=i.c,b._VIGNETTEMODE_MULTIPLY=0,b._VIGNETTEMODE_OPAQUE=1,(0,w.b)([(0,N.h)()],b.prototype,"colorCurves",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_colorCurvesEnabled",void 0),(0,w.b)([(0,N.C)("colorGradingTexture")],b.prototype,"_colorGradingTexture",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_colorGradingEnabled",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_colorGradingWithGreenDepth",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_colorGradingBGR",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_exposure",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_toneMappingEnabled",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_toneMappingType",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_contrast",void 0),(0,w.b)([(0,N.J)()],b.prototype,"vignetteStretch",void 0),(0,w.b)([(0,N.J)()],b.prototype,"vignetteCenterX",void 0),(0,w.b)([(0,N.J)()],b.prototype,"vignetteCenterY",void 0),(0,w.b)([(0,N.J)()],b.prototype,"vignetteWeight",void 0),(0,w.b)([(0,N.m)()],b.prototype,"vignetteColor",void 0),(0,w.b)([(0,N.J)()],b.prototype,"vignetteCameraFov",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_vignetteBlendMode",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_vignetteEnabled",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_ditheringEnabled",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_ditheringIntensity",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_skipFinalColorClamp",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_applyByPostProcess",void 0),(0,w.b)([(0,N.J)()],b.prototype,"_isEnabled",void 0),X.d._ImageProcessingConfigurationParser=b.Parse,(0,k.g)("BABYLON.ImageProcessingConfiguration",b)},11293:(d,t,A)=>{"use strict";A.d(t,{b:()=>i});var w=A(11041),N=A(11203),p=A(11047),B=A(11280),X=A(11257),W=A(11296),a=A(11246);class D extends X.b{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class i extends W.e{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(d,"DetailMap",140,new D,t),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=N.c.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=d._dirtyCallbacks[1]}isReadyForSubMesh(d,t,A){return!this._isEnabled||!(d._areTexturesDirty&&t.texturesEnabled&&A.getCaps().standardDerivatives&&this._texture&&B.d.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(d,t){if(this._isEnabled){d.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const A=t.getEngine();d._areTexturesDirty&&(A.getCaps().standardDerivatives&&this._texture&&B.d.DetailTextureEnabled&&this._isEnabled?((0,a.O)(this._texture,d,"DETAIL"),d.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):d.DETAIL=!1)}else d.DETAIL=!1}bindForSubMesh(d,t){if(!this._isEnabled)return;const A=this._material.isFrozen;d.useUbo&&A&&d.isSync||this._texture&&B.d.DetailTextureEnabled&&(d.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,a.r)(this._texture,d,"detail")),t.texturesEnabled&&this._texture&&B.d.DetailTextureEnabled&&d.setTexture("detailSampler",this._texture)}hasTexture(d){return this._texture===d}getActiveTextures(d){this._texture&&d.push(this._texture)}getAnimatables(d){this._texture&&this._texture.animations&&this._texture.animations.length>0&&d.push(this._texture)}dispose(d){var t;d&&(null===(t=this._texture)||void 0===t||t.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(d){d.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,w.b)([(0,p.C)("detailTexture"),(0,p.c)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"texture",void 0),(0,w.b)([(0,p.J)()],i.prototype,"diffuseBlendLevel",void 0),(0,w.b)([(0,p.J)()],i.prototype,"roughnessBlendLevel",void 0),(0,w.b)([(0,p.J)()],i.prototype,"bumpLevel",void 0),(0,w.b)([(0,p.J)(),(0,p.c)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"normalBlendMethod",void 0),(0,w.b)([(0,p.J)(),(0,p.c)("_markAllSubMeshesAsTexturesDirty")],i.prototype,"isEnabled",void 0)},11203:(d,t,A)=>{"use strict";A.d(t,{c:()=>J});var w=A(11041),N=A(11047),p=A(10727),B=A(10730),X=A(10775),W=A(11205),a=A(11108),D=A(10740),i=A(11181),k=A(11239),b=A(11097);class Q{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(d){this._func=d}get funcRef(){return this._funcRef}set funcRef(d){this._funcRef=d}get funcMask(){return this._funcMask}set funcMask(d){this._funcMask=d}get opStencilFail(){return this._opStencilFail}set opStencilFail(d){this._opStencilFail=d}get opDepthFail(){return this._opDepthFail}set opDepthFail(d){this._opDepthFail=d}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(d){this._opStencilDepthPass=d}get mask(){return this._mask}set mask(d){this._mask=d}get enabled(){return this._enabled}set enabled(d){this._enabled=d}getClassName(){return"MaterialStencilState"}copyTo(d){b.d.Clone((()=>d),this)}serialize(){return b.d.Serialize(this)}parse(d,t,A){b.d.Parse((()=>this),d,t,A)}}(0,w.b)([(0,N.J)()],Q.prototype,"func",null),(0,w.b)([(0,N.J)()],Q.prototype,"funcRef",null),(0,w.b)([(0,N.J)()],Q.prototype,"funcMask",null),(0,w.b)([(0,N.J)()],Q.prototype,"opStencilFail",null),(0,w.b)([(0,N.J)()],Q.prototype,"opDepthFail",null),(0,w.b)([(0,N.J)()],Q.prototype,"opStencilDepthPass",null),(0,w.b)([(0,N.J)()],Q.prototype,"mask",null),(0,w.b)([(0,N.J)()],Q.prototype,"enabled",null);var P=A(11246);class J{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(d){if(this._alpha===d)return;const t=this._alpha;this._alpha=d,1!==t&&1!==d||this.Cg(J.MiscDirtyFlag+J.PrePassDirtyFlag)}get alpha(){return this._alpha}set Tg(d){this._backFaceCulling!==d&&(this._backFaceCulling=d,this.Cg(J.TextureDirtyFlag))}get Tg(){return this._backFaceCulling}set cullBackFaces(d){this._cullBackFaces!==d&&(this._cullBackFaces=d,this.Cg(J.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(d){this._blockDirtyMechanism!==d&&(this._blockDirtyMechanism=d,d||this.bj())}atomicMaterialsUpdate(d){this.blockDirtyMechanism=!0;try{d(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(d){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(d)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new B.b),this._onBindObservable}set onBind(d){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(d)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new B.b),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new B.b),this._onEffectCreatedObservable}set alphaMode(d){this._alphaMode!==d&&(this._alphaMode=d,this.Cg(J.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(d){this._needDepthPrePass!==d&&(this._needDepthPrePass=d,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(d){this._fogEnabled!==d&&(this._fogEnabled=d,this.Cg(J.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case J.WireFrameFillMode:case J.LineListDrawMode:case J.LineLoopDrawMode:case J.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(d){this.fillMode=d?J.WireFrameFillMode:J.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case J.PointFillMode:case J.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(d){this.fillMode=d?J.PointFillMode:J.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(d){this._fillMode!==d&&(this._fillMode=d,this.Cg(J.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(d){const t=this.va().getEngine().getCaps().fragmentDepthSupported;d&&!t&&D.e.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=d&&t,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(d){this._drawWrapper=d}constructor(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.hj=new B.b,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new Q,this._useUBO=!1,this._fillMode=J.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=d;const N=t||X.e.LastCreatedScene;N&&(this._scene=N,this._dirtyCallbacks={},this._forceGLSL=w,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=d||p.g.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new k.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new a.e(this._scene.getEngine(),void 0,void 0,d),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),A||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),J.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var d;const t=this.va().getEngine();null===(d=this._uniformBuffer)||void 0===d||d.dispose(),t.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new a.e(t,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new a.e(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(d){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.bj(),this.checkReadyOnlyOnce=!0}unfreeze(){this.bj(),this.checkReadyOnlyOnce=!1}isReady(d,t){return!0}isReadyForSubMesh(d,t,A){const w=t.materialDefines;return!!w&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=w,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(d){return null!==this.sideOrientation?this.sideOrientation:d.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(d){this._transparencyMode!==d&&(this._transparencyMode=d,this._forceAlphaTest=d===J.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===J.MATERIAL_OPAQUE||this._transparencyMode===J.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(d){return d.visibility<1||!this._disableAlphaBlending&&(d.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(d){return!this.needAlphaBlendingForMesh(d)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}bj(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.va().meshes;for(const A of t)if(A.If)for(const t of A.If)if(t.Ha()===this)for(const A of t._drawWrappers)A&&this._materialContext===A.materialContext&&(A._wasPreviouslyReady=!1,A._wasPreviouslyUsingInstances=null,A._forceRebindOnNextCall=d);d&&this.Cg(J.AllDirtyFlag)}_preBind(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=this._scene.getEngine(),w=(null==t?this.sideOrientation:t)===J.ClockWiseSideOrientation;return A.enableEffect(d||this._getDrawWrapper()),A.setState(this.Tg,this.zOffset,!1,w,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),w}bind(d,t){}buildUniformLayout(){const d=this._uniformBuffer;this._eventInfo.ubo=d,this._callbackPluginEventGeneric(8,this._eventInfo),d.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(d,t,A){const w=A._drawWrapper;this._eventInfo.subMesh=A,this._callbackPluginEventBindForSubMesh(this._eventInfo),w._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(d){}bindView(d){this._useUBO?this._needToBindSceneUbo=!0:d.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(d){this._useUBO?this._needToBindSceneUbo=!0:(d.setMatrix("viewProjection",this.va().getTransformMatrix()),d.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(d,t){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(d,t)}_afterBind(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&t&&(this._needToBindSceneUbo=!1,(0,P.n)(t,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=d?d.visibility:1,this._onBindObservable&&d&&this._onBindObservable.notifyObservers(d),this.disableDepthWrite){const d=this._scene.getEngine();this._cachedDepthWriteState=d.getDepthWrite(),d.setDepthWrite(!1)}if(this.disableColorWrite){const d=this._scene.getEngine();this._cachedColorWriteState=d.getColorWrite(),d.setColorWrite(!1)}if(0!==this.depthFunction){const d=this._scene.getEngine();this._cachedDepthFunctionState=d.getDepthFunction()||0,d.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(d){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=d,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(d){return null}_clonePlugins(d,t){const A={};if(this._serializePlugins(A),J._ParsePlugins(A,d,this._scene,t),this.pluginManager)for(const w of this.pluginManager._plugins){const t=d.pluginManager.getPlugin(w.name);t&&w.copyTo(t)}}getBindedMeshes(){if(this.meshMap){const d=[];for(const t in this.meshMap){const A=this.meshMap[t];A&&d.push(A)}return d}return this._scene.meshes.filter((d=>d.material===this))}forceCompilation(d,t,A,w){const N={clipPlane:!1,useInstances:!1,...A},p=this.va(),B=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const X=()=>{if(!this._scene||!this._scene.getEngine())return;const A=p.clipPlane;if(N.clipPlane&&(p.clipPlane=new i.b(0,0,0,1)),this._storeEffectOnSubMeshes){let A=!0,p=null;if(d.If){const t=new W.c(0,0,0,0,0,d,void 0,!1,!1);t.materialDefines&&(t.materialDefines._renderId=-1),this.isReadyForSubMesh(d,t,N.useInstances)||(t.effect&&t.effect.getCompilationError()&&t.effect.allFallbacksProcessed()?p=t.effect.getCompilationError():(A=!1,setTimeout(X,16)))}A&&(this.allowShaderHotSwapping=B,p&&w&&w(p),t&&t(this))}else this.isReady()?(this.allowShaderHotSwapping=B,t&&t(this)):setTimeout(X,16);N.clipPlane&&(p.clipPlane=A)};X()}forceCompilationAsync(d,t){return new Promise(((A,w)=>{this.forceCompilation(d,(()=>{A()}),t,(d=>{w(d)}))}))}Cg(d){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(J._DirtyCallbackArray.length=0,d&J.TextureDirtyFlag&&J._DirtyCallbackArray.push(J._TextureDirtyCallBack),d&J.LightDirtyFlag&&J._DirtyCallbackArray.push(J._LightsDirtyCallBack),d&J.FresnelDirtyFlag&&J._DirtyCallbackArray.push(J._FresnelDirtyCallBack),d&J.AttributesDirtyFlag&&J._DirtyCallbackArray.push(J._AttributeDirtyCallBack),d&J.MiscDirtyFlag&&J._DirtyCallbackArray.push(J._MiscDirtyCallBack),d&J.PrePassDirtyFlag&&J._DirtyCallbackArray.push(J._PrePassDirtyCallBack),J._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(J._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const d=this.va().meshes;for(const t of d)if(t.If)for(const d of t.If)d.Ha()===this&&d.resetDrawCache()}_markAllSubMeshesAsDirty(d){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const t=this.va().meshes;for(const A of t)if(A.If)for(const t of A.If)if(t.Ha(!1)===this)for(const A of t._drawWrappers)A&&A.defines&&A.defines.markAllAsDirty&&this._materialContext===A.materialContext&&d(A.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const d=this.va().enablePrePassRenderer();d&&d.Cg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(J._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(J._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(J._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(J._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(J._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(J._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(J._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(J._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(J._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(J._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const d=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.hj.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(d)}))}}setPrePassRenderer(d){return!1}dispose(d,t,A){const w=this.va();if(w.stopAnimation(this),w.freeProcessedMaterials(),w.removeMaterial(this),this._eventInfo.forceDisposeTextures=t,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const d=this._parentContainer.materials.indexOf(this);d>-1&&this._parentContainer.materials.splice(d,1),this._parentContainer=null}if(!0!==A)if(this.meshMap)for(const N in this.meshMap){const t=this.meshMap[N];t&&(t.material=null,this.releaseVertexArrayObject(t,d))}else{const t=w.meshes;for(const A of t)A.material!==this||A.sourceMesh||(A.material=null,this.releaseVertexArrayObject(A,d))}this._uniformBuffer.dispose(),d&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.hj.notifyObservers(this),this.hj.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(d,t){const A=d.Aj;if(A)if(this._storeEffectOnSubMeshes){if(d.If)for(const w of d.If)A._releaseVertexArrayObject(w.effect),t&&w.effect&&w.effect.dispose()}else A._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const d=b.d.Serialize(this);return d.stencil=this.stencil.serialize(),d.uniqueId=this.uniqueId,this._serializePlugins(d),d}_serializePlugins(d){if(d.plugins={},this.pluginManager)for(const t of this.pluginManager._plugins)d.plugins[t.getClassName()]=t.serialize()}static Parse(d,t,A){if(d.customType){if("BABYLON.PBRMaterial"===d.customType&&d.overloadedAlbedo&&(d.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return D.e.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else d.customType="BABYLON.StandardMaterial";const w=p.g.Instantiate(d.customType).Parse(d,t,A);return w._loadedUniqueId=d.uniqueId,w}static _ParsePlugins(d,t,A,w){if(d.plugins)for(const X in d.plugins){var N,B;const W=d.plugins[X];let a=null===(N=t.pluginManager)||void 0===N?void 0:N.getPlugin(W.name);if(!a){const d=p.g.Instantiate("BABYLON."+X);d&&(a=new d(t))}null===(B=a)||void 0===B||B.parse(W,A,w)}}}J.TriangleFillMode=0,J.WireFrameFillMode=1,J.PointFillMode=2,J.PointListDrawMode=3,J.LineListDrawMode=4,J.LineLoopDrawMode=5,J.LineStripDrawMode=6,J.TriangleStripDrawMode=7,J.TriangleFanDrawMode=8,J.ClockWiseSideOrientation=0,J.CounterClockWiseSideOrientation=1,J.TextureDirtyFlag=1,J.LightDirtyFlag=2,J.FresnelDirtyFlag=4,J.AttributesDirtyFlag=8,J.MiscDirtyFlag=16,J.PrePassDirtyFlag=32,J.AllDirtyFlag=63,J.MATERIAL_OPAQUE=0,J.MATERIAL_ALPHATEST=1,J.MATERIAL_ALPHABLEND=2,J.MATERIAL_ALPHATESTANDBLEND=3,J.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,J.MATERIAL_NORMALBLENDMETHOD_RNM=1,J.OnEventObservable=new B.b,J._AllDirtyCallBack=d=>d.markAllAsDirty(),J._ImageProcessingDirtyCallBack=d=>d.markAsImageProcessingDirty(),J._TextureDirtyCallBack=d=>d.markAsTexturesDirty(),J._FresnelDirtyCallBack=d=>d.markAsFresnelDirty(),J._MiscDirtyCallBack=d=>d.markAsMiscDirty(),J._PrePassDirtyCallBack=d=>d.markAsPrePassDirty(),J._LightsDirtyCallBack=d=>d.markAsLightDirty(),J._AttributeDirtyCallBack=d=>d.markAsAttributesDirty(),J._FresnelAndMiscDirtyCallBack=d=>{J._FresnelDirtyCallBack(d),J._MiscDirtyCallBack(d)},J._TextureAndMiscDirtyCallBack=d=>{J._TextureDirtyCallBack(d),J._MiscDirtyCallBack(d)},J._DirtyCallbackArray=[],J._RunDirtyCallBacks=d=>{for(const t of J._DirtyCallbackArray)t(d)},(0,w.b)([(0,N.J)()],J.prototype,"id",void 0),(0,w.b)([(0,N.J)()],J.prototype,"uniqueId",void 0),(0,w.b)([(0,N.J)()],J.prototype,"name",void 0),(0,w.b)([(0,N.J)()],J.prototype,"metadata",void 0),(0,w.b)([(0,N.J)()],J.prototype,"checkReadyOnEveryCall",void 0),(0,w.b)([(0,N.J)()],J.prototype,"checkReadyOnlyOnce",void 0),(0,w.b)([(0,N.J)()],J.prototype,"state",void 0),(0,w.b)([(0,N.J)("alpha")],J.prototype,"_alpha",void 0),(0,w.b)([(0,N.J)("Tg")],J.prototype,"_backFaceCulling",void 0),(0,w.b)([(0,N.J)("cullBackFaces")],J.prototype,"_cullBackFaces",void 0),(0,w.b)([(0,N.J)()],J.prototype,"sideOrientation",void 0),(0,w.b)([(0,N.J)("alphaMode")],J.prototype,"_alphaMode",void 0),(0,w.b)([(0,N.J)()],J.prototype,"_needDepthPrePass",void 0),(0,w.b)([(0,N.J)()],J.prototype,"disableDepthWrite",void 0),(0,w.b)([(0,N.J)()],J.prototype,"disableColorWrite",void 0),(0,w.b)([(0,N.J)()],J.prototype,"forceDepthWrite",void 0),(0,w.b)([(0,N.J)()],J.prototype,"depthFunction",void 0),(0,w.b)([(0,N.J)()],J.prototype,"separateCullingPass",void 0),(0,w.b)([(0,N.J)("fogEnabled")],J.prototype,"_fogEnabled",void 0),(0,w.b)([(0,N.J)()],J.prototype,"pointSize",void 0),(0,w.b)([(0,N.J)()],J.prototype,"zOffset",void 0),(0,w.b)([(0,N.J)()],J.prototype,"zOffsetUnits",void 0),(0,w.b)([(0,N.J)()],J.prototype,"pointsCloud",null),(0,w.b)([(0,N.J)()],J.prototype,"fillMode",null),(0,w.b)([(0,N.J)()],J.prototype,"useLogarithmicDepth",null),(0,w.b)([(0,N.J)()],J.prototype,"transparencyMode",null)},11257:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});class w{constructor(d){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=d,d)for(const t in d)Object.prototype.hasOwnProperty.call(d,t)&&this._setDefaultValue(t)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||d,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const d of Object.keys(this))"_"!==d[0]&&this._keys.push(d);if(this._externalProperties)for(const d in this._externalProperties)-1===this._keys.indexOf(d)&&this._keys.push(d)}isEqual(d){if(this._keys.length!==d._keys.length)return!1;for(let t=0;t<this._keys.length;t++){const A=this._keys[t];if(this[A]!==d[A])return!1}return!0}cloneTo(d){this._keys.length!==d._keys.length&&(d._keys=this._keys.slice(0));for(let t=0;t<this._keys.length;t++){const A=this._keys[t];d[A]=this[A]}}reset(){this._keys.forEach((d=>this._setDefaultValue(d)))}_setDefaultValue(d){var t,A,w,N;const p=(null===(t=this._externalProperties)||void 0===t||null===(A=t[d])||void 0===A?void 0:A.type)??typeof this[d],B=null===(w=this._externalProperties)||void 0===w||null===(N=w[d])||void 0===N?void 0:N.default;switch(p){case"number":this[d]=B??0;break;case"string":this[d]=B??"";break;default:this[d]=B??!1}}toString(){let d="";for(let t=0;t<this._keys.length;t++){const A=this._keys[t],w=this[A];switch(typeof w){case"number":case"string":d+="#define "+A+" "+w+"\n";break;default:w&&(d+="#define "+A+"\n")}}return d}}},11280:(d,t,A)=>{"use strict";A.d(t,{d:()=>N});var w=A(10824);class N{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(d){this._DiffuseTextureEnabled!==d&&(this._DiffuseTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(d){this._DetailTextureEnabled!==d&&(this._DetailTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(d){this._DecalMapEnabled!==d&&(this._DecalMapEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(d){this._AmbientTextureEnabled!==d&&(this._AmbientTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(d){this._OpacityTextureEnabled!==d&&(this._OpacityTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(d){this._ReflectionTextureEnabled!==d&&(this._ReflectionTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(d){this._EmissiveTextureEnabled!==d&&(this._EmissiveTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(d){this._SpecularTextureEnabled!==d&&(this._SpecularTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(d){this._BumpTextureEnabled!==d&&(this._BumpTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(d){this._LightmapTextureEnabled!==d&&(this._LightmapTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(d){this._RefractionTextureEnabled!==d&&(this._RefractionTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(d){this._ColorGradingTextureEnabled!==d&&(this._ColorGradingTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(d){this._FresnelEnabled!==d&&(this._FresnelEnabled=d,w.c.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(d){this._ClearCoatTextureEnabled!==d&&(this._ClearCoatTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(d){this._ClearCoatBumpTextureEnabled!==d&&(this._ClearCoatBumpTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(d){this._ClearCoatTintTextureEnabled!==d&&(this._ClearCoatTintTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(d){this._SheenTextureEnabled!==d&&(this._SheenTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(d){this._AnisotropicTextureEnabled!==d&&(this._AnisotropicTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(d){this._ThicknessTextureEnabled!==d&&(this._ThicknessTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(d){this._RefractionIntensityTextureEnabled!==d&&(this._RefractionIntensityTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(d){this._TranslucencyIntensityTextureEnabled!==d&&(this._TranslucencyIntensityTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(d){this._TranslucencyColorTextureEnabled!==d&&(this._TranslucencyColorTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(d){this._IridescenceTextureEnabled!==d&&(this._IridescenceTextureEnabled=d,w.c.MarkAllMaterialsAsDirty(1))}}N._DiffuseTextureEnabled=!0,N._DetailTextureEnabled=!0,N._DecalMapEnabled=!0,N._AmbientTextureEnabled=!0,N._OpacityTextureEnabled=!0,N._ReflectionTextureEnabled=!0,N._EmissiveTextureEnabled=!0,N._SpecularTextureEnabled=!0,N._BumpTextureEnabled=!0,N._LightmapTextureEnabled=!0,N._RefractionTextureEnabled=!0,N._ColorGradingTextureEnabled=!0,N._FresnelEnabled=!0,N._ClearCoatTextureEnabled=!0,N._ClearCoatBumpTextureEnabled=!0,N._ClearCoatTintTextureEnabled=!0,N._SheenTextureEnabled=!0,N._AnisotropicTextureEnabled=!0,N._ThicknessTextureEnabled=!0,N._RefractionIntensityTextureEnabled=!0,N._TranslucencyIntensityTextureEnabled=!0,N._TranslucencyColorTextureEnabled=!0,N._IridescenceTextureEnabled=!0},11246:(d,t,A)=>{"use strict";A.d(t,{B:()=>i,E:()=>Z,I:()=>R,L:()=>j,O:()=>P,R:()=>m,S:()=>L,V:()=>I,Z:()=>u,bb:()=>h,c:()=>T,cb:()=>k,e:()=>D,h:()=>q,k:()=>a,l:()=>b,n:()=>Q,r:()=>J,s:()=>v,u:()=>U,v:()=>H,y:()=>f});var w=A(10740),N=A(11094),p=A(10775),B=A(11196),X=A(11254);const W=N.e.Black();function a(d,t,A){if(!d||d.LOGARITHMICDEPTH||d.indexOf&&d.indexOf("LOGARITHMICDEPTH")>=0){const d=A.activeCamera;1===d.mode&&w.e.Error("Logarithmic depth is not compatible with orthographic cameras!",20),t.setFloat("logarithmicDepthConstant",2/(Math.log(d.maxZ+1)/Math.LN2))}}function D(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];A&&d.fogEnabled&&(!t||t.applyFog)&&0!==d.fogMode&&(A.setFloat4("vFogInfos",d.fogMode,d.fogStart,d.fogEnd,d.fogDensity),w?(d.fogColor.toLinearSpaceToRef(W,d.getEngine().useExactSrgbConversions),A.setColor3("vFogColor",W)):A.setColor3("vFogColor",d.fogColor))}function i(d,t,A){const N=A.NUM_MORPH_INFLUENCERS;if(N>0&&p.e.LastCreatedEngine){const B=p.e.LastCreatedEngine.getCaps().maxVertexAttribs,X=t.morphTargetManager;if(null!==X&&void 0!==X&&X.isUsingTextureForTargets)return;const W=X&&X.supportsNormals&&A.NORMAL,a=X&&X.supportsTangents&&A.TANGENT,D=X&&X.supportsUVs&&A.UV1;for(let A=0;A<N;A++)d.push("position"+A),W&&d.push("normal"+A),a&&d.push("tangent"+A),D&&d.push("uv_"+A),d.length>B&&w.e.Error("Cannot add more vertex attributes for mesh "+t.name)}}function k(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d.push("world0"),d.push("world1"),d.push("world2"),d.push("world3"),t&&(d.push("previousWorld0"),d.push("previousWorld1"),d.push("previousWorld2"),d.push("previousWorld3"))}function b(d,t){const A=d.morphTargetManager;d&&A&&t.setFloatArray("morphTargetInfluences",A.influences)}function Q(d,t){t.bindToEffect(d,"Scene")}function P(d,t,A){t._needUVs=!0,t[A]=!0,d.optimizeUVAllocation&&d.getTextureMatrix().isIdentityAs3x2()?(t[A+"DIRECTUV"]=d.coordinatesIndex+1,t["MAINUV"+(d.coordinatesIndex+1)]=!0):t[A+"DIRECTUV"]=0}function J(d,t,A){const w=d.getTextureMatrix();t.Fj(A+"Matrix",w)}function U(d,t,A){A.BAKED_VERTEX_ANIMATION_TEXTURE&&A.INSTANCES&&d.push("bakedVertexAnimationSettingsInstanced")}function T(d,t,A){var w;if(t&&d&&(d.computeBonesUsingShaders&&t._bonesComputationForcedToCPU&&(d.computeBonesUsingShaders=!1),d.useBones&&d.computeBonesUsingShaders&&d.skeleton)){const N=d.skeleton;if(N.isUsingTextureForMatrices&&t.getUniformIndex("boneTextureWidth")>-1){const A=N.getTransformMatrixTexture(d);t.setTexture("boneSampler",A),t.setFloat("boneTextureWidth",4*(N.bones.length+1))}else{const p=N.getTransformMatrices(d);p&&(t.setMatrices("mBones",p),A&&d.va().prePassRenderer&&d.va().prePassRenderer.getIndex(2)&&(A.previousBones[d.uniqueId]||(A.previousBones[d.uniqueId]=p.slice()),t.setMatrices("mPreviousBones",A.previousBones[d.uniqueId]),w=p,A.previousBones[d.uniqueId].set(w)))}}}function F(d,t,A,w,N){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];d._bindLight(t,A,w,N,p)}function q(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const p=Math.min(t.lightSources.length,N);for(let B=0;B<p;B++){F(t.lightSources[B],B,d,A,"boolean"===typeof w?w:w.SPECULARTERM,t.receiveShadows)}}function H(d,t,A,w){A.NUM_BONE_INFLUENCERS>0&&(w.addCPUSkinningFallback(0,t),d.push("matricesIndices"),d.push("matricesWeights"),A.NUM_BONE_INFLUENCERS>4&&(d.push("matricesIndicesExtra"),d.push("matricesWeightsExtra")))}function f(d,t){(t.INSTANCES||t.THIN_INSTANCES)&&k(d,!!t.PREPASS_VELOCITY),t.INSTANCESCOLOR&&d.push("instanceColor")}function v(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=0;for(let p=0;p<A&&d["LIGHT"+p];p++)p>0&&(N=w+p,t.addFallback(N,"LIGHT"+p)),d.SHADOWS||(d["SHADOW"+p]&&t.addFallback(w,"SHADOW"+p),d["SHADOWPCF"+p]&&t.addFallback(w,"SHADOWPCF"+p),d["SHADOWPCSS"+p]&&t.addFallback(w,"SHADOWPCSS"+p),d["SHADOWPOISSON"+p]&&t.addFallback(w,"SHADOWPOISSON"+p),d["SHADOWESM"+p]&&t.addFallback(w,"SHADOWESM"+p),d["SHADOWCLOSEESM"+p]&&t.addFallback(w,"SHADOWCLOSEESM"+p));return N++}function m(d,t,A,w,N,p,B){let X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];B._areMiscDirty&&(B.LOGARITHMICDEPTH=A,B.POINTSIZE=w,B.FOG=N&&function(d,t){return t.fogEnabled&&d.applyFog&&0!==t.fogMode}(d,t),B.NONUNIFORMSCALING=d.nonUniformScaling,B.ALPHATEST=p,B.DECAL_AFTER_DETAIL=X)}function j(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!A._areLightsDirty)return A._needNormals;let B=0;const X={needNormals:A._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(d.lightsEnabled&&!p)for(const a of t.lightSources)if(n(d,t,a,B,A,w,X),B++,B===N)break;A.SPECULARTERM=X.specularEnabled,A.SHADOWS=X.shadowEnabled;for(let a=B;a<N;a++)void 0!==A["LIGHT"+a]&&(A["LIGHT"+a]=!1,A["HEMILIGHT"+a]=!1,A["POINTLIGHT"+a]=!1,A["DIRLIGHT"+a]=!1,A["SPOTLIGHT"+a]=!1,A["SHADOW"+a]=!1,A["SHADOWCSM"+a]=!1,A["SHADOWCSMDEBUG"+a]=!1,A["SHADOWCSMNUM_CASCADES"+a]=!1,A["SHADOWCSMUSESHADOWMAXZ"+a]=!1,A["SHADOWCSMNOBLEND"+a]=!1,A["SHADOWCSM_RIGHTHANDED"+a]=!1,A["SHADOWPCF"+a]=!1,A["SHADOWPCSS"+a]=!1,A["SHADOWPOISSON"+a]=!1,A["SHADOWESM"+a]=!1,A["SHADOWCLOSEESM"+a]=!1,A["SHADOWCUBE"+a]=!1,A["SHADOWLOWQUALITY"+a]=!1,A["SHADOWMEDIUMQUALITY"+a]=!1);const W=d.getEngine().getCaps();return void 0===A.SHADOWFLOAT&&(X.needRebuild=!0),A.SHADOWFLOAT=X.shadowEnabled&&(W.textureFloatRender&&W.textureFloatLinearFiltering||W.textureHalfFloatRender&&W.textureHalfFloatLinearFiltering),A.LIGHTMAPEXCLUDED=X.lightmapMode,X.needRebuild&&A.rebuild(),X.needNormals}function n(d,t,A,w,N,p,X){switch(X.needNormals=!0,void 0===N["LIGHT"+w]&&(X.needRebuild=!0),N["LIGHT"+w]=!0,N["SPOTLIGHT"+w]=!1,N["HEMILIGHT"+w]=!1,N["POINTLIGHT"+w]=!1,N["DIRLIGHT"+w]=!1,A.prepareLightSpecificDefines(N,w),N["LIGHT_FALLOFF_PHYSICAL"+w]=!1,N["LIGHT_FALLOFF_GLTF"+w]=!1,N["LIGHT_FALLOFF_STANDARD"+w]=!1,A.falloffType){case B.b.FALLOFF_GLTF:N["LIGHT_FALLOFF_GLTF"+w]=!0;break;case B.b.FALLOFF_PHYSICAL:N["LIGHT_FALLOFF_PHYSICAL"+w]=!0;break;case B.b.FALLOFF_STANDARD:N["LIGHT_FALLOFF_STANDARD"+w]=!0}if(p&&!A.mh.equalsFloats(0,0,0)&&(X.specularEnabled=!0),N["SHADOW"+w]=!1,N["SHADOWCSM"+w]=!1,N["SHADOWCSMDEBUG"+w]=!1,N["SHADOWCSMNUM_CASCADES"+w]=!1,N["SHADOWCSMUSESHADOWMAXZ"+w]=!1,N["SHADOWCSMNOBLEND"+w]=!1,N["SHADOWCSM_RIGHTHANDED"+w]=!1,N["SHADOWPCF"+w]=!1,N["SHADOWPCSS"+w]=!1,N["SHADOWPOISSON"+w]=!1,N["SHADOWESM"+w]=!1,N["SHADOWCLOSEESM"+w]=!1,N["SHADOWCUBE"+w]=!1,N["SHADOWLOWQUALITY"+w]=!1,N["SHADOWMEDIUMQUALITY"+w]=!1,t&&t.receiveShadows&&d.shadowsEnabled&&A.shadowEnabled){const t=A.getShadowGenerator(d.activeCamera)??A.getShadowGenerator();if(t){const d=t.getShadowMap();d&&d.renderList&&d.renderList.length>0&&(X.shadowEnabled=!0,t.prepareDefines(N,w))}}A.lightmapMode!=B.b.LIGHTMAP_DEFAULT?(X.lightmapMode=!0,N["LIGHTMAPEXCLUDED"+w]=!0,N["LIGHTMAPNOSPECULAR"+w]=A.lightmapMode==B.b.LIGHTMAP_SHADOWSONLY):(N["LIGHTMAPEXCLUDED"+w]=!1,N["LIGHTMAPNOSPECULAR"+w]=!1)}function R(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=function(d,t){let A=!1;if(d.activeCamera){const w=t.CAMERA_ORTHOGRAPHIC?1:0,N=t.CAMERA_PERSPECTIVE?1:0,p=1===d.activeCamera.mode?1:0,B=0===d.activeCamera.mode?1:0;(w^p||N^B)&&(t.CAMERA_ORTHOGRAPHIC=1===p,t.CAMERA_PERSPECTIVE=1===B,A=!0)}return A}(d,w);!1!==p&&(W=(0,X.j)(A,d,w)),w.DEPTHPREPASS!==!t.getColorWrite()&&(w.DEPTHPREPASS=!w.DEPTHPREPASS,W=!0),w.INSTANCES!==N&&(w.INSTANCES=N,W=!0),w.THIN_INSTANCES!==B&&(w.THIN_INSTANCES=B,W=!0),W&&w.markAsUnprocessed()}function Z(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!t._areAttributesDirty&&t._needNormals===t._normals&&t._needUVs===t._uvs)return!1;t._normals=t._needNormals,t._uvs=t._needUVs,t.NORMAL=t._needNormals&&d.isVerticesDataPresent("normal"),t._needNormals&&d.isVerticesDataPresent("tangent")&&(t.TANGENT=!0);for(let X=1;X<=6;++X)t["UV"+X]=!!t._needUVs&&d.isVerticesDataPresent(`uv${1===X?"":X}`);if(A){const A=d.useVertexColors&&d.isVerticesDataPresent("color");t.VERTEXCOLOR=A,t.VERTEXALPHA=d.hasVertexAlpha&&A&&p}return d.isVerticesDataPresent("instanceColor")&&(d.hasInstances||d.hasThinInstances)&&(t.INSTANCESCOLOR=!0),w&&function(d,t){if(d.useBones&&d.computeBonesUsingShaders&&d.skeleton){t.NUM_BONE_INFLUENCERS=d.numBoneInfluencers;const A=void 0!==t.BONETEXTURE;if(d.skeleton.isUsingTextureForMatrices&&A)t.BONETEXTURE=!0;else{t.BonesPerMesh=d.skeleton.bones.length+1,t.BONETEXTURE=!A&&void 0;const w=d.va().prePassRenderer;if(w&&w.enabled){const A=-1===w.excludedSkinnedMesh.indexOf(d);t.BONES_VELOCITY_ENABLED=A}}}else t.NUM_BONE_INFLUENCERS=0,t.BonesPerMesh=0,void 0!==t.BONETEXTURE&&(t.BONETEXTURE=!1)}(d,t),N&&function(d,t){const A=d.morphTargetManager;A?(t.MORPHTARGETS_UV=A.supportsUVs&&t.UV1,t.MORPHTARGETS_TANGENT=A.supportsTangents&&t.TANGENT,t.MORPHTARGETS_NORMAL=A.supportsNormals&&t.NORMAL,t.NUM_MORPH_INFLUENCERS=A.numMaxInfluencers||A.numInfluencers,t.MORPHTARGETS=t.NUM_MORPH_INFLUENCERS>0,t.MORPHTARGETS_TEXTURE=A.isUsingTextureForTargets):(t.MORPHTARGETS_UV=!1,t.MORPHTARGETS_TANGENT=!1,t.MORPHTARGETS_NORMAL=!1,t.MORPHTARGETS=!1,t.NUM_MORPH_INFLUENCERS=0)}(d,t),B&&function(d,t){const A=d.bakedVertexAnimationManager;t.BAKED_VERTEX_ANIMATION_TEXTURE=!(!A||!A.isEnabled)}(d,t),!0}function L(d,t){if(d.activeCamera){const A=t.MULTIVIEW;t.MULTIVIEW=null!==d.activeCamera.outputRenderTarget&&d.activeCamera.outputRenderTarget.getViewCount()>1,t.MULTIVIEW!=A&&t.markAsUnprocessed()}}function I(d,t,A){const w=t.ORDER_INDEPENDENT_TRANSPARENCY,N=t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;t.ORDER_INDEPENDENT_TRANSPARENCY=d.useOrderIndependentTransparency&&A,t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!d.getEngine().getCaps().textureFloatLinearFiltering,w===t.ORDER_INDEPENDENT_TRANSPARENCY&&N===t.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||t.markAsUnprocessed()}function u(d,t,A){const w=t.PREPASS;if(!t._arePrePassDirty)return;const N=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(d.prePassRenderer&&d.prePassRenderer.enabled&&A){t.PREPASS=!0,t.SCENE_MRT_COUNT=d.prePassRenderer.mrtCount,t.PREPASS_NORMAL_WORLDSPACE=d.prePassRenderer.generateNormalsInWorldSpace,t.PREPASS_COLOR=!0,t.PREPASS_COLOR_INDEX=0;for(let A=0;A<N.length;A++){const w=d.prePassRenderer.getIndex(N[A].type);-1!==w?(t[N[A].define]=!0,t[N[A].index]=w):t[N[A].define]=!1}}else{t.PREPASS=!1;for(let d=0;d<N.length;d++)t[N[d].define]=!1}t.PREPASS!=w&&(t.markAsUnprocessed(),t.markAsImageProcessingDirty())}function V(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];N&&N.push("Light"+d),p||(t.push("vLightData"+d,"vLightDiffuse"+d,"vLightSpecular"+d,"vLightDirection"+d,"vLightFalloff"+d,"vLightGround"+d,"lightMatrix"+d,"shadowsInfo"+d,"depthValues"+d),A.push("shadowTexture"+d),A.push("depthTexture"+d),t.push("viewFrustumZ"+d,"cascadeBlendFactor"+d,"lightSizeUVCorrection"+d,"depthCorrection"+d,"penumbraDarkness"+d,"frustumLengths"+d),w&&(A.push("projectionLightTexture"+d),t.push("textureProjectionMatrix"+d)))}function h(d,t,A){let w,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,p=null;if(d.uniformsNames){const B=d;w=B.uniformsNames,p=B.uniformBuffersNames,t=B.samplers,A=B.defines,N=B.maxSimultaneousLights||0}else w=d,t||(t=[]);for(let B=0;B<N&&A["LIGHT"+B];B++)V(B,w,t,A["PROJECTEDLIGHTTEXTURE"+B],p);A.NUM_MORPH_INFLUENCERS&&(w.push("morphTargetInfluences"),w.push("morphTargetCount")),A.BAKED_VERTEX_ANIMATION_TEXTURE&&(w.push("bakedVertexAnimationSettings"),w.push("bakedVertexAnimationTextureSizeInverted"),w.push("bakedVertexAnimationTime"),t.push("bakedVertexAnimationTexture"))}},11300:(d,t,A)=>{"use strict";A.d(t,{c:()=>p});var w,N=A(11076);!function(d){d[d.Zero=0]="Zero",d[d.One=1]="One",d[d.MaxViewZ=2]="MaxViewZ"}(w||(w={}));class p{static CreateConfiguration(d){return p._Configurations[d]={defines:{},previousWorldMatrices:{},previousViewProjection:N.c.Zero(),currentViewProjection:N.c.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},p._Configurations[d]}static DeleteConfiguration(d){delete p._Configurations[d]}static GetConfiguration(d){return p._Configurations[d]}static AddUniformsAndSamplers(d,t){d.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(d,t){for(const A of t)if(A.If)for(const t of A.If)t._removeDrawWrapper(d)}static PrepareDefines(d,t,A){if(!A._arePrePassDirty)return;const w=p._Configurations[d];if(!w)return;A.PREPASS=!0,A.PREPASS_COLOR=!1,A.PREPASS_COLOR_INDEX=-1;let N=0;for(let B=0;B<p.GeometryTextureDescriptions.length;B++){const d=p.GeometryTextureDescriptions[B],t=d.define,X=d.defineIndex,W=w.defines[X];void 0!==W?(A[t]=!0,A[X]=W,N++):(A[t]=!1,delete A[X])}A.SCENE_MRT_COUNT=N,A.BONES_VELOCITY_ENABLED=t.useBones&&t.computeBonesUsingShaders&&t.skeleton&&!t.skeleton.isUsingTextureForMatrices&&-1===w.excludedSkinnedMesh.indexOf(t)}static Bind(d,t,A,w){const N=p._Configurations[d];if(N&&(void 0!==N.defines.PREPASS_VELOCITY_INDEX||void 0!==N.defines.PREPASS_VELOCITY_LINEAR_INDEX)){N.previousWorldMatrices[A.uniqueId]||(N.previousWorldMatrices[A.uniqueId]=w.clone());const d=A.va();N.previousViewProjection||(N.previousViewProjection=d.getTransformMatrix().clone(),N.currentViewProjection=d.getTransformMatrix().clone());const p=d.getEngine();if(N.currentViewProjection.updateFlag!==d.getTransformMatrix().updateFlag?(N.lastUpdateFrameId=p.frameId,N.previousViewProjection.p(N.currentViewProjection),N.currentViewProjection.p(d.getTransformMatrix())):N.lastUpdateFrameId!==p.frameId&&(N.lastUpdateFrameId=p.frameId,N.previousViewProjection.p(N.currentViewProjection)),t.setMatrix("previousWorld",N.previousWorldMatrices[A.uniqueId]),t.setMatrix("previousViewProjection",N.previousViewProjection),N.previousWorldMatrices[A.uniqueId]=w.clone(),A.useBones&&A.computeBonesUsingShaders&&A.skeleton){const d=A.skeleton;if(!d.isUsingTextureForMatrices||-1===t.getUniformIndex("boneTextureWidth")){const w=d.getTransformMatrices(A);w&&(N.previousBones[A.uniqueId]||(N.previousBones[A.uniqueId]=w.slice()),t.setMatrices("mPreviousBones",N.previousBones[A.uniqueId]),N.previousBones[A.uniqueId].set(w))}}}}}p.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],p._Configurations={}},11296:(d,t,A)=>{"use strict";A.d(t,{e:()=>U});var w=A(11041),N=A(11047),p=A(11203),B=A(10775),X=A(10798),W=A(10837);const a=new RegExp("^([gimus]+)!");class D{constructor(d){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=d,this._scene=d.va(),this._engine=this._scene.getEngine()}_addPlugin(d){for(let w=0;w<this._plugins.length;++w)if(this._plugins[w].name===d.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!d.isCompatible(this._material.shaderLanguage))throw`The plugin "${d.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const t=d.getClassName();D._MaterialPluginClassToMainDefine[t]||(D._MaterialPluginClassToMainDefine[t]="MATERIALPLUGIN_"+ ++D._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(d,t)=>this._handlePluginEvent(d,t),this._plugins.push(d),this._plugins.sort(((d,t)=>d.priority-t.priority)),this._codeInjectionPoints={};const A={};A[D._MaterialPluginClassToMainDefine[t]]={type:"boolean",default:!0};for(const w of this._plugins)w.collectDefines(A),this._collectPointNames("vertex",w.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",w.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=A,!0}_activatePlugin(d){-1===this._activePlugins.indexOf(d)&&(this._activePlugins.push(d),this._activePlugins.sort(((d,t)=>d.priority-t.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),d.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(d),this._activePluginsForExtraEvents.sort(((d,t)=>d.priority-t.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(d){for(let t=0;t<this._plugins.length;++t)if(this._plugins[t].name===d)return this._plugins[t];return null}_handlePluginEventIsReadyForSubMesh(d){let t=!0;for(const A of this._activePlugins)t=t&&A.isReadyForSubMesh(d.defines,this._scene,this._engine,d.subMesh);d.isReadyForSubMesh=t}_handlePluginEventPrepareDefinesBeforeAttributes(d){for(const t of this._activePlugins)t.prepareDefinesBeforeAttributes(d.defines,this._scene,d.mesh)}_handlePluginEventPrepareDefines(d){for(const t of this._activePlugins)t.prepareDefines(d.defines,this._scene,d.mesh)}_handlePluginEventHardBindForSubMesh(d){for(const t of this._activePluginsForExtraEvents)t.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,d.subMesh)}_handlePluginEventBindForSubMesh(d){for(const t of this._activePlugins)t.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,d.subMesh)}_handlePluginEventHasRenderTargetTextures(d){let t=!1;for(const A of this._activePluginsForExtraEvents)if(t=A.hasRenderTargetTextures(),t)break;d.hasRenderTargetTextures=t}_handlePluginEventFillRenderTargetTextures(d){for(const t of this._activePluginsForExtraEvents)t.fillRenderTargetTextures(d.renderTargets)}_handlePluginEvent(d,t){switch(d){case 512:{const d=t;for(const t of this._activePlugins)t.getActiveTextures(d.activeTextures);break}case 256:{const d=t;for(const t of this._activePlugins)t.getAnimatables(d.animatables);break}case 1024:{const d=t;let A=!1;for(const t of this._activePlugins)if(A=t.hasTexture(d.texture),A)break;d.hasTexture=A;break}case 2:{const d=t;for(const t of this._plugins)t.dispose(d.forceDisposeTextures);break}case 4:t.defineNames=this._defineNamesFromPlugins;break;case 128:{const d=t;for(const t of this._activePlugins)d.fallbackRank=t.addFallbacks(d.defines,d.fallbacks,d.fallbackRank),t.getAttributes(d.attributes,this._scene,d.mesh);this._uniformList.length>0&&d.uniforms.push(...this._uniformList),this._samplerList.length>0&&d.samplers.push(...this._samplerList),this._uboList.length>0&&d.uniformBuffersNames.push(...this._uboList),d.customCode=this._injectCustomCode(d,d.customCode);break}case 8:{const d=t;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const A=1===this._material.shaderLanguage;for(const t of this._plugins){const w=t.getUniforms(this._material.shaderLanguage);if(w){if(w.ubo)for(const t of w.ubo){if(t.size&&t.type){const w=t.arraySize??0;if(d.ubo.addUniform(t.name,t.size,w),A){let d;switch(t.type){case"mat4":d="mat4x4f";break;case"float":d="f32";break;default:d=`${t.type}f`}this._uboDeclaration+=`uniform ${t.name}: ${d}${w>0?`[${w}]`:""};\n`}else this._uboDeclaration+=`${t.type} ${t.name}${w>0?`[${w}]`:""};\n`}this._uniformList.push(t.name)}w.vertex&&(this._vertexDeclaration+=w.vertex+"\n"),w.fragment&&(this._fragmentDeclaration+=w.fragment+"\n")}t.getSamplers(this._samplerList),t.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(d,t){if(t)for(const A in t)this._codeInjectionPoints[d]||(this._codeInjectionPoints[d]={}),this._codeInjectionPoints[d][A]=!0}_injectCustomCode(d,t){return(A,w)=>{var N;t&&(w=t(A,w)),this._uboDeclaration&&(w=w.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(w=w.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(w=w.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const p=null===(N=this._codeInjectionPoints)||void 0===N?void 0:N[A];if(!p)return w;let B=null;for(let t in p){let N="";for(const w of this._activePlugins){var D;let p=null===(D=w.getCustomCode(A,this._material.shaderLanguage))||void 0===D?void 0:D[t];if(p){if(w.resolveIncludes){if(null===B){const t=0;B={defines:[],indexParameters:d.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:W.c.GetShadersRepository(t),includesShadersStore:W.c.GetIncludesShadersStore(t),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}B.isFragment="fragment"===A,(0,X.h)(p,B,(d=>p=d))}N+=p+"\n"}}if(N.length>0)if("!"===t.charAt(0)){t=t.substring(1);let d="g";if("!"===t.charAt(0))d="",t=t.substring(1);else{const A=a.exec(t);A&&A.length>=2&&(d=A[1],t=t.substring(d.length+1))}d.indexOf("g")<0&&(d+="g");const A=w,p=new RegExp(t,d);let B=p.exec(A);for(;null!==B;){let d=N;for(let t=0;t<B.length;++t)d=d.replace("$"+t,B[t]);w=w.replace(B[0],d),B=p.exec(A)}}else{const d="#define "+t;w=w.replace(d,"\n"+N+"\n"+d)}}return w}}}D._MaterialPluginClassToMainDefine={},D._MaterialPluginCounter=0,B.e.OnEnginesDisposedObservable.add((()=>{Q()}));const i=[];let k=!1,b=null;function Q(){i.length=0,k=!1,p.c.OnEventObservable.remove(b),b=null}var P=A(11097),J=A(10885);class U{isCompatible(d){return 0===d}_enable(d){d&&this._pluginManager._activatePlugin(this)}constructor(d,t,A,w){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=d,this.name=t,this.priority=A,this.resolveIncludes=B,d.pluginManager||(d.pluginManager=new D(d),d.hj.add((()=>{d.pluginManager=void 0}))),this._pluginDefineNames=w,this._pluginManager=d.pluginManager,N&&this._pluginManager._addPlugin(this),p&&this._enable(!0),this.markAllDefinesAsDirty=d._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(d,t,A,w){return!0}hardBindForSubMesh(d,t,A,w){}bindForSubMesh(d,t,A,w){}dispose(d){}getCustomCode(d){return null}collectDefines(d){if(this._pluginDefineNames)for(const t of Object.keys(this._pluginDefineNames)){if("_"===t[0])continue;const A=typeof this._pluginDefineNames[t];d[t]={type:"number"===A?"number":"string"===A?"string":"boolean"===A?"boolean":"object",default:this._pluginDefineNames[t]}}}prepareDefinesBeforeAttributes(d,t,A){}prepareDefines(d,t,A){}hasTexture(d){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(d){}getActiveTextures(d){}getAnimatables(d){}addFallbacks(d,t,A){return A}getSamplers(d){}getAttributes(d,t,A){}getUniformBuffersNames(d){}getUniforms(){return{}}copyTo(d){P.d.Clone((()=>d),this)}serialize(){return P.d.Serialize(this)}parse(d,t,A){P.d.Parse((()=>this),d,t,A)}}(0,w.b)([(0,N.J)()],U.prototype,"name",void 0),(0,w.b)([(0,N.J)()],U.prototype,"priority",void 0),(0,w.b)([(0,N.J)()],U.prototype,"resolveIncludes",void 0),(0,w.b)([(0,N.J)()],U.prototype,"registerForExtraEvents",void 0),(0,J.g)("BABYLON.MaterialPluginBase",U)},11368:(d,t,A)=>{"use strict";A.d(t,{c:()=>B});var w=A(11203),N=A(11067),p=A(10885);class B extends w.c{get Kf(){return this._subMaterials}set Kf(d){this._subMaterials=d,this._hookArray(d)}getChildren(){return this.Kf}constructor(d,t){super(d,t,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Kf=[],this._storeEffectOnSubMeshes=!0}_hookArray(d){var t=this;const A=d.push;d.push=function(){for(var w=arguments.length,N=new Array(w),p=0;p<w;p++)N[p]=arguments[p];const B=A.apply(d,N);return t._markAllSubMeshesAsTexturesDirty(),B};const w=d.splice;d.splice=(t,A)=>{const N=w.apply(d,[t,A]);return this._markAllSubMeshesAsTexturesDirty(),N}}getSubMaterial(d){return d<0||d>=this.Kf.length?this.va().defaultMaterial:this.Kf[d]}getActiveTextures(){return super.getActiveTextures().concat(...this.Kf.map((d=>d?d.getActiveTextures():[])))}hasTexture(d){if(super.hasTexture(d))return!0;for(let A=0;A<this.Kf.length;A++){var t;if(null!==(t=this.Kf[A])&&void 0!==t&&t.hasTexture(d))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(d,t,A){for(let w=0;w<this.Kf.length;w++){const N=this.Kf[w];if(N){if(N._storeEffectOnSubMeshes){if(!N.isReadyForSubMesh(d,t,A))return!1;continue}if(!N.isReady(d))return!1}}return!0}clone(d,t){const A=new B(d,this.va());for(let w=0;w<this.Kf.length;w++){let N=null;const p=this.Kf[w];N=t&&p?p.clone(d+"-"+p.name):this.Kf[w],A.Kf.push(N)}return A}serialize(){const d={};d.name=this.name,d.id=this.id,d.uniqueId=this.uniqueId,N.c&&(d.tags=N.c.GetTags(this)),d.materialsUniqueIds=[],d.materials=[];for(let t=0;t<this.Kf.length;t++){const A=this.Kf[t];A?(d.materialsUniqueIds.push(A.uniqueId),d.materials.push(A.id)):(d.materialsUniqueIds.push(null),d.materials.push(null))}return d}dispose(d,t,A){const w=this.va();if(!w)return;if(A)for(let p=0;p<this.Kf.length;p++){const A=this.Kf[p];A&&A.dispose(d,t)}const N=w.multiMaterials.indexOf(this);N>=0&&w.multiMaterials.splice(N,1),super.dispose(d,t)}static ParseMultiMaterial(d,t){const A=new B(d.name,t);return A.id=d.id,A._loadedUniqueId=d.uniqueId,N.c&&N.c.AddTagsTo(A,d.tags),d.materialsUniqueIds?A._waitingSubMaterialsUniqueIds=d.materialsUniqueIds:d.materials.forEach((d=>A.Kf.push(t.getLastMaterialById(d)))),A}}(0,p.g)("BABYLON.MultiMaterial",B)},11198:(d,t,A)=>{"use strict";A.d(t,{c:()=>w});class w{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(d){d.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(d){}bindForSubMesh(d,t,A,w,N){if(t.prePassRenderer&&t.prePassRenderer.enabled&&t.prePassRenderer.currentRTisSceneRT&&(-1!==t.prePassRenderer.getIndex(2)||-1!==t.prePassRenderer.getIndex(11))){this.previousWorldMatrices[A.uniqueId]||(this.previousWorldMatrices[A.uniqueId]=w.clone()),this.previousViewProjection||(this.previousViewProjection=t.getTransformMatrix().clone(),this.currentViewProjection=t.getTransformMatrix().clone());const N=t.getEngine();this.currentViewProjection.updateFlag!==t.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=N.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(t.getTransformMatrix())):this._lastUpdateFrameId!==N.frameId&&(this._lastUpdateFrameId=N.frameId,this.previousViewProjection.p(this.currentViewProjection)),d.setMatrix("previousWorld",this.previousWorldMatrices[A.uniqueId]),d.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[A.uniqueId]=w.clone()}}}},11260:(d,t,A)=>{"use strict";A.d(t,{b:()=>p});var w=A(11076),N=A(11203);class p extends N.c{constructor(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(d,t,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new w.c,this._storeEffectOnSubMeshes=A}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(d,t){return!!d&&(!this._storeEffectOnSubMeshes||(!d.If||0===d.If.length||this.isReadyForSubMesh(d,d.If[0],t)))}_isReadyForSubMesh(d){const t=d.materialDefines;return!(this.checkReadyOnEveryCall||!d.effect||!t||t._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(d){this._activeEffect.setMatrix("world",d)}bindOnlyNormalMatrix(d){this._activeEffect.setMatrix("normalMatrix",d)}bind(d,t){t&&this.bindForSubMesh(d,t,t.If[0])}_afterBind(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;super._afterBind(d,t,A),this.va()._cachedEffect=t,A?A._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return A._drawWrapper._forceRebindOnNextCall||d.isCachedMaterialInvalid(this,t,w)}dispose(d,t,A){this._activeEffect=void 0,super.dispose(d,t,A)}}},11033:(d,t,A)=>{"use strict";A.d(t,{d:()=>n});var w=A(11041),N=A(11047),p=A(11054),B=A(11061),X=A(11076),W=A(11094),a=A(11120),D=A(11198),i=A(11092),k=A(11203),b=A(11257),Q=A(11260),P=A(11264),J=A(10885),U=A(11280),T=A(11285),F=A(11293),q=A(11254),H=A(11246),f=A(11097),v=A(11300);const m={effect:null,subMesh:null};class j extends b.b{constructor(d){super(d),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(d){const t=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const A of t)this[A]=A===d}}class n extends Q.b{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(d){this._attachImageProcessingConfiguration(d),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(d){d!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=d||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(d){this.imageProcessingConfiguration.colorCurvesEnabled=d}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(d){this.imageProcessingConfiguration.colorGradingEnabled=d}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(d){this._imageProcessingConfiguration.toneMappingEnabled=d}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(d){this._imageProcessingConfiguration.exposure=d}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(d){this._imageProcessingConfiguration.contrast=d}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(d){this._imageProcessingConfiguration.colorGradingTexture=d}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(d){this._imageProcessingConfiguration.colorCurves=d}get canRenderToMRT(){return!0}constructor(d,t){super(d,t,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||n.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new W.e(0,0,0),this.diffuseColor=new W.e(1,1,1),this.specularColor=new W.e(1,1,1),this.emissiveColor=new W.e(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new p.d(16),this._worldViewProjectionMatrix=X.c.Zero(),this._globalAmbientColor=new W.e(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new F.b(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new D.c,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(n.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(n.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"ob"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===k.c.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.uc&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==k.c.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.uc||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(d,t){let w=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const N=t._drawWrapper;if(N.effect&&this.isFrozen&&N._wasPreviouslyReady&&N._wasPreviouslyUsingInstances===w)return!0;t.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),t.materialDefines=new j(this._eventInfo.defineNames));const p=this.va(),B=t.materialDefines;if(this._isReadyForSubMesh(t))return!0;const X=p.getEngine();B._needNormals=(0,H.L)(p,d,B,!0,this._maxSimultaneousLights,this._disableLighting),(0,H.S)(p,B);const W=this.needAlphaBlendingForMesh(d)&&this.va().useOrderIndependentTransparency;if((0,H.Z)(p,B,this.canRenderToMRT&&!W),(0,H.V)(p,B,W),v.c.PrepareDefines(X.currentRenderPassId,d,B),B._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,B._needUVs=!1;for(let d=1;d<=6;++d)B["MAINUV"+d]=!1;if(p.texturesEnabled){if(B.DIFFUSEDIRECTUV=0,B.BUMPDIRECTUV=0,B.AMBIENTDIRECTUV=0,B.OPACITYDIRECTUV=0,B.EMISSIVEDIRECTUV=0,B.SPECULARDIRECTUV=0,B.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&n.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,H.O)(this._diffuseTexture,B,"DIFFUSE")}else B.DIFFUSE=!1;if(this._ambientTexture&&n.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,H.O)(this._ambientTexture,B,"AMBIENT")}else B.AMBIENT=!1;if(this._opacityTexture&&n.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,H.O)(this._opacityTexture,B,"OPACITY"),B.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else B.OPACITY=!1;if(this._reflectionTexture&&n.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(B._needNormals=!0,B.REFLECTION=!0,B.ROUGHNESS=this._roughness>0,B.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,B.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===P.c.INVCUBIC_MODE,B.REFLECTIONMAP_3D=this._reflectionTexture.isCube,B.REFLECTIONMAP_OPPOSITEZ=B.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,B.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case P.c.EXPLICIT_MODE:B.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case P.c.PLANAR_MODE:B.setReflectionMode("REFLECTIONMAP_PLANAR");break;case P.c.PROJECTION_MODE:B.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case P.c.SKYBOX_MODE:B.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case P.c.SPHERICAL_MODE:B.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case P.c.EQUIRECTANGULAR_MODE:B.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case P.c.FIXED_EQUIRECTANGULAR_MODE:B.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case P.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:B.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case P.c.CUBIC_MODE:case P.c.INVCUBIC_MODE:default:B.setReflectionMode("REFLECTIONMAP_CUBIC")}B.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else B.REFLECTION=!1,B.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&n.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,H.O)(this._emissiveTexture,B,"EMISSIVE")}else B.EMISSIVE=!1;if(this._lightmapTexture&&n.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,H.O)(this._lightmapTexture,B,"LIGHTMAP"),B.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,B.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else B.LIGHTMAP=!1;if(this._specularTexture&&n.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,H.O)(this._specularTexture,B,"SPECULAR"),B.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else B.SPECULAR=!1;if(p.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&n.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,H.O)(this._bumpTexture,B,"BUMP"),B.PARALLAX=this._useParallax,B.PARALLAX_RHS=p.useRightHandedSystem,B.PARALLAXOCCLUSION=this._useParallaxOcclusion,B.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else B.BUMP=!1,B.PARALLAX=!1,B.PARALLAX_RHS=!1,B.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&n.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;B._needUVs=!0,B.REFRACTION=!0,B.REFRACTIONMAP_3D=this._refractionTexture.isCube,B.RGBDREFRACTION=this._refractionTexture.isRGBD,B.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else B.REFRACTION=!1;B.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else B.DIFFUSE=!1,B.AMBIENT=!1,B.OPACITY=!1,B.REFLECTION=!1,B.EMISSIVE=!1,B.LIGHTMAP=!1,B.BUMP=!1,B.REFRACTION=!1;B.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),B.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,B.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,B.SPECULAROVERALPHA=this._useSpecularOverAlpha,B.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,B.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,B.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(d)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=B,this._eventInfo.subMesh=t,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(B._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(B),B.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,B.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}B._areFresnelDirty&&(n.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(B.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,B.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,B.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,B.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,B.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,B.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,B._needNormals=!0,B.FRESNEL=!0):B.FRESNEL=!1),(0,H.R)(d,p,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(d)||this._forceAlphaTest,B,this._applyDecalMapAfterDetailMap),(0,H.I)(p,X,this,B,w,null,t.getRenderingMesh().hasThinInstances),this._eventInfo.defines=B,this._eventInfo.mesh=d,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,H.E)(d,B,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let k=!1;if(B.isDirty){const w=B._areLightsDisposed;B.markAsProcessed();const N=new T.b;B.REFLECTION&&N.addFallback(0,"REFLECTION"),B.SPECULAR&&N.addFallback(0,"SPECULAR"),B.BUMP&&N.addFallback(0,"BUMP"),B.PARALLAX&&N.addFallback(1,"PARALLAX"),B.PARALLAX_RHS&&N.addFallback(1,"PARALLAX_RHS"),B.PARALLAXOCCLUSION&&N.addFallback(0,"PARALLAXOCCLUSION"),B.SPECULAROVERALPHA&&N.addFallback(0,"SPECULAROVERALPHA"),B.FOG&&N.addFallback(1,"FOG"),B.POINTSIZE&&N.addFallback(0,"POINTSIZE"),B.LOGARITHMICDEPTH&&N.addFallback(0,"LOGARITHMICDEPTH"),(0,H.s)(B,N,this._maxSimultaneousLights),B.SPECULARTERM&&N.addFallback(0,"SPECULARTERM"),B.DIFFUSEFRESNEL&&N.addFallback(1,"DIFFUSEFRESNEL"),B.OPACITYFRESNEL&&N.addFallback(2,"OPACITYFRESNEL"),B.REFLECTIONFRESNEL&&N.addFallback(3,"REFLECTIONFRESNEL"),B.EMISSIVEFRESNEL&&N.addFallback(4,"EMISSIVEFRESNEL"),B.FRESNEL&&N.addFallback(4,"FRESNEL"),B.MULTIVIEW&&N.addFallback(0,"MULTIVIEW");const W=[a.f.PositionKind];B.NORMAL&&W.push(a.f.NormalKind),B.TANGENT&&W.push(a.f.TangentKind);for(let d=1;d<=6;++d)B["UV"+d]&&W.push(`uv${1===d?"":d}`);B.VERTEXCOLOR&&W.push(a.f.ColorKind),(0,H.v)(W,d,B,N),(0,H.y)(W,B),(0,H.B)(W,d,B),(0,H.u)(W,d,B);let b="default";const Q=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],P=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],J=["Material","Scene","Mesh"],U={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:B.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=N,this._eventInfo.fallbackRank=0,this._eventInfo.defines=B,this._eventInfo.uniforms=Q,this._eventInfo.attributes=W,this._eventInfo.samplers=P,this._eventInfo.uniformBuffersNames=J,this._eventInfo.customCode=void 0,this._eventInfo.mesh=d,this._eventInfo.indexParameters=U,this._callbackPluginEventGeneric(128,this._eventInfo),v.c.AddUniformsAndSamplers(Q,P),D.c.AddUniforms(Q),D.c.AddSamplers(P),i.c&&(i.c.PrepareUniforms(Q,B),i.c.PrepareSamplers(P,B)),(0,H.bb)({uniformsNames:Q,uniformBuffersNames:J,samplers:P,defines:B,maxSimultaneousLights:this._maxSimultaneousLights}),(0,q.e)(Q);const F={};this.customShaderNameResolve&&(b=this.customShaderNameResolve(b,Q,J,P,B,W,F));const f=B.toString(),j=t.effect;let n=p.getEngine().createEffect(b,{attributes:W,uniformsNames:Q,uniformBuffersNames:J,samplers:P,defines:f,fallbacks:N,onCompiled:this.onCompiled,onError:this.onError,indexParameters:U,processFinalCode:F.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:B.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([A.e(21),A.e(19)]).then(A.bind(A,12791)),Promise.all([A.e(22),A.e(20)]).then(A.bind(A,12935))]):await Promise.all([Promise.all([A.e(25),A.e(24)]).then(A.bind(A,12988)),Promise.all([A.e(27),A.e(26)]).then(A.bind(A,13125))]),this._shadersLoaded=!0}},X);if(this._eventInfo.customCode=void 0,n)if(this._onEffectCreatedObservable&&(m.effect=n,m.subMesh=t,this._onEffectCreatedObservable.notifyObservers(m)),this.allowShaderHotSwapping&&j&&!n.isReady()){if(n=j,B.markAsUnprocessed(),k=this.isFrozen,w)return B._areLightsDisposed=!0,!1}else p.resetCachedMaterial(),t.setEffect(n,B,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(B._renderId=p.getRenderId(),N._wasPreviouslyReady=!k,N._wasPreviouslyUsingInstances=w,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const d=this._uniformBuffer;d.addUniform("diffuseLeftColor",4),d.addUniform("diffuseRightColor",4),d.addUniform("opacityParts",4),d.addUniform("reflectionLeftColor",4),d.addUniform("reflectionRightColor",4),d.addUniform("refractionLeftColor",4),d.addUniform("refractionRightColor",4),d.addUniform("emissiveLeftColor",4),d.addUniform("emissiveRightColor",4),d.addUniform("vDiffuseInfos",2),d.addUniform("vAmbientInfos",2),d.addUniform("vOpacityInfos",2),d.addUniform("vReflectionInfos",2),d.addUniform("vReflectionPosition",3),d.addUniform("vReflectionSize",3),d.addUniform("vEmissiveInfos",2),d.addUniform("vLightmapInfos",2),d.addUniform("vSpecularInfos",2),d.addUniform("vBumpInfos",3),d.addUniform("diffuseMatrix",16),d.addUniform("ambientMatrix",16),d.addUniform("opacityMatrix",16),d.addUniform("reflectionMatrix",16),d.addUniform("emissiveMatrix",16),d.addUniform("lightmapMatrix",16),d.addUniform("specularMatrix",16),d.addUniform("bumpMatrix",16),d.addUniform("vTangentSpaceParams",2),d.addUniform("pointSize",1),d.addUniform("alphaCutOff",1),d.addUniform("refractionMatrix",16),d.addUniform("vRefractionInfos",4),d.addUniform("vRefractionPosition",3),d.addUniform("vRefractionSize",3),d.addUniform("vSpecularColor",4),d.addUniform("vEmissiveColor",3),d.addUniform("vDiffuseColor",4),d.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(d,t,A){const w=this.va(),N=A.materialDefines;if(!N)return;const p=A.effect;if(!p)return;this._activeEffect=p,t.getMeshUniformBuffer().bindToEffect(p,"Mesh"),t.transferToEffect(d),this._uniformBuffer.bindToEffect(p,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,w,t,d,this.isFrozen),v.c.Bind(w.getEngine().currentRenderPassId,this._activeEffect,t,d),this._eventInfo.subMesh=A,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),N.OBJECTSPACE_NORMALMAP&&(d.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const X=this._mustRebind(w,p,A,t.visibility);(0,H.c)(t,p);const a=this._uniformBuffer;if(X){if(this.bindViewProjection(p),!a.useUbo||!this.isFrozen||!a.isSync||A._drawWrapper._forceRebindOnNextCall){if(n.FresnelEnabled&&N.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(a.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),a.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&a.updateColor4("opacityParts",new W.e(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(a.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),a.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(a.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),a.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(a.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),a.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),w.texturesEnabled){if(this._diffuseTexture&&n.DiffuseTextureEnabled&&(a.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,H.r)(this._diffuseTexture,a,"diffuse")),this._ambientTexture&&n.AmbientTextureEnabled&&(a.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,H.r)(this._ambientTexture,a,"ambient")),this._opacityTexture&&n.OpacityTextureEnabled&&(a.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,H.r)(this._opacityTexture,a,"opacity")),this._hasAlphaChannel()&&a.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&n.ReflectionTextureEnabled&&(a.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),a.Fj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const d=this._reflectionTexture;a.updateVector3("vReflectionPosition",d.boundingBoxPosition),a.updateVector3("vReflectionSize",d.boundingBoxSize)}if(this._emissiveTexture&&n.EmissiveTextureEnabled&&(a.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,H.r)(this._emissiveTexture,a,"emissive")),this._lightmapTexture&&n.LightmapTextureEnabled&&(a.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,H.r)(this._lightmapTexture,a,"lightmap")),this._specularTexture&&n.SpecularTextureEnabled&&(a.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,H.r)(this._specularTexture,a,"specular")),this._bumpTexture&&w.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&(a.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,H.r)(this._bumpTexture,a,"bump"),w._mirroredCameraPosition?a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):a.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&n.RefractionTextureEnabled){let d=1;if(this._refractionTexture.isCube||(a.Fj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(d=this._refractionTexture.depth)),a.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,d,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const d=this._refractionTexture;a.updateVector3("vRefractionPosition",d.boundingBoxPosition),a.updateVector3("vRefractionSize",d.boundingBoxSize)}}}this.pointsCloud&&a.updateFloat("pointSize",this.pointSize),a.updateColor4("vSpecularColor",this.specularColor,this.specularPower),a.updateColor3("vEmissiveColor",n.EmissiveTextureEnabled?this.emissiveColor:W.e.BlackReadOnly),a.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),w.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),a.updateColor3("vAmbientColor",this._globalAmbientColor)}w.texturesEnabled&&(this._diffuseTexture&&n.DiffuseTextureEnabled&&p.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&n.AmbientTextureEnabled&&p.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&n.OpacityTextureEnabled&&p.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&n.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?p.setTexture("reflectionCubeSampler",this._reflectionTexture):p.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&n.EmissiveTextureEnabled&&p.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&n.LightmapTextureEnabled&&p.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&n.SpecularTextureEnabled&&p.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&w.getEngine().getCaps().standardDerivatives&&n.BumpTextureEnabled&&p.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&n.RefractionTextureEnabled&&(this._refractionTexture.isCube?p.setTexture("refractionCubeSampler",this._refractionTexture):p.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(t)&&this.va().depthPeelingRenderer.bind(p),this._eventInfo.subMesh=A,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,q.g)(p,this,w),this.bindEyePosition(p)}else w.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(X||!this.isFrozen){var D;if(w.lightsEnabled&&!this._disableLighting&&(0,H.h)(w,t,p,N,this._maxSimultaneousLights),(w.fogEnabled&&t.applyFog&&w.fogMode!==B.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||t.receiveShadows||N.PREPASS)&&this.bindView(p),(0,H.e)(w,t,p),N.NUM_MORPH_INFLUENCERS&&(0,H.l)(t,p),N.BAKED_VERTEX_ANIMATION_TEXTURE)null===(D=t.bakedVertexAnimationManager)||void 0===D||D.bind(p,N.INSTANCES);this.useLogarithmicDepth&&(0,H.k)(N,p,w),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(t,this._activeEffect,A),a.update()}getAnimatables(){const d=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&d.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&d.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&d.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&d.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&d.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&d.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&d.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&d.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&d.push(this._refractionTexture),d}getActiveTextures(){const d=super.getActiveTextures();return this._diffuseTexture&&d.push(this._diffuseTexture),this._ambientTexture&&d.push(this._ambientTexture),this._opacityTexture&&d.push(this._opacityTexture),this._reflectionTexture&&d.push(this._reflectionTexture),this._emissiveTexture&&d.push(this._emissiveTexture),this._specularTexture&&d.push(this._specularTexture),this._bumpTexture&&d.push(this._bumpTexture),this._lightmapTexture&&d.push(this._lightmapTexture),this._refractionTexture&&d.push(this._refractionTexture),d}hasTexture(d){return!!super.hasTexture(d)||(this._diffuseTexture===d||(this._ambientTexture===d||(this._opacityTexture===d||(this._reflectionTexture===d||(this._emissiveTexture===d||(this._specularTexture===d||(this._bumpTexture===d||(this._lightmapTexture===d||this._refractionTexture===d))))))))}dispose(d,t){var A,w,N,p,B,X,W,a,D;t&&(null===(A=this._diffuseTexture)||void 0===A||A.dispose(),null===(w=this._ambientTexture)||void 0===w||w.dispose(),null===(N=this._opacityTexture)||void 0===N||N.dispose(),null===(p=this._reflectionTexture)||void 0===p||p.dispose(),null===(B=this._emissiveTexture)||void 0===B||B.dispose(),null===(X=this._specularTexture)||void 0===X||X.dispose(),null===(W=this._bumpTexture)||void 0===W||W.dispose(),null===(a=this._lightmapTexture)||void 0===a||a.dispose(),null===(D=this._refractionTexture)||void 0===D||D.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(d,t)}clone(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const w=f.d.Clone((()=>new n(d,this.va())),this,{cloneTexturesOnlyOnce:t});return w.name=d,w.id=d,this.stencil.copyTo(w.stencil),this._clonePlugins(w,A),w}static Parse(d,t,A){const w=f.d.Parse((()=>new n(d.name,t)),d,t,A);return d.stencil&&w.stencil.parse(d.stencil,t,A),k.c._ParsePlugins(d,w,t,A),w}static get DiffuseTextureEnabled(){return U.d.DiffuseTextureEnabled}static set DiffuseTextureEnabled(d){U.d.DiffuseTextureEnabled=d}static get DetailTextureEnabled(){return U.d.DetailTextureEnabled}static set DetailTextureEnabled(d){U.d.DetailTextureEnabled=d}static get AmbientTextureEnabled(){return U.d.AmbientTextureEnabled}static set AmbientTextureEnabled(d){U.d.AmbientTextureEnabled=d}static get OpacityTextureEnabled(){return U.d.OpacityTextureEnabled}static set OpacityTextureEnabled(d){U.d.OpacityTextureEnabled=d}static get ReflectionTextureEnabled(){return U.d.ReflectionTextureEnabled}static set ReflectionTextureEnabled(d){U.d.ReflectionTextureEnabled=d}static get EmissiveTextureEnabled(){return U.d.EmissiveTextureEnabled}static set EmissiveTextureEnabled(d){U.d.EmissiveTextureEnabled=d}static get SpecularTextureEnabled(){return U.d.SpecularTextureEnabled}static set SpecularTextureEnabled(d){U.d.SpecularTextureEnabled=d}static get BumpTextureEnabled(){return U.d.BumpTextureEnabled}static set BumpTextureEnabled(d){U.d.BumpTextureEnabled=d}static get LightmapTextureEnabled(){return U.d.LightmapTextureEnabled}static set LightmapTextureEnabled(d){U.d.LightmapTextureEnabled=d}static get RefractionTextureEnabled(){return U.d.RefractionTextureEnabled}static set RefractionTextureEnabled(d){U.d.RefractionTextureEnabled=d}static get ColorGradingTextureEnabled(){return U.d.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(d){U.d.ColorGradingTextureEnabled=d}static get FresnelEnabled(){return U.d.FresnelEnabled}static set FresnelEnabled(d){U.d.FresnelEnabled=d}}n.ForceGLSL=!1,(0,w.b)([(0,N.C)("diffuseTexture")],n.prototype,"_diffuseTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"diffuseTexture",void 0),(0,w.b)([(0,N.C)("ambientTexture")],n.prototype,"_ambientTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"ambientTexture",void 0),(0,w.b)([(0,N.C)("opacityTexture")],n.prototype,"_opacityTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"opacityTexture",void 0),(0,w.b)([(0,N.C)("reflectionTexture")],n.prototype,"_reflectionTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"reflectionTexture",void 0),(0,w.b)([(0,N.C)("emissiveTexture")],n.prototype,"_emissiveTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"emissiveTexture",void 0),(0,w.b)([(0,N.C)("specularTexture")],n.prototype,"_specularTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"specularTexture",void 0),(0,w.b)([(0,N.C)("bumpTexture")],n.prototype,"_bumpTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"bumpTexture",void 0),(0,w.b)([(0,N.C)("lightmapTexture")],n.prototype,"_lightmapTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"lightmapTexture",void 0),(0,w.b)([(0,N.C)("refractionTexture")],n.prototype,"_refractionTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"refractionTexture",void 0),(0,w.b)([(0,N.i)("ambient")],n.prototype,"ambientColor",void 0),(0,w.b)([(0,N.i)("diffuse")],n.prototype,"diffuseColor",void 0),(0,w.b)([(0,N.i)("specular")],n.prototype,"specularColor",void 0),(0,w.b)([(0,N.i)("emissive")],n.prototype,"emissiveColor",void 0),(0,w.b)([(0,N.J)()],n.prototype,"specularPower",void 0),(0,w.b)([(0,N.J)("useAlphaFromDiffuseTexture")],n.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],n.prototype,"useAlphaFromDiffuseTexture",void 0),(0,w.b)([(0,N.J)("useEmissiveAsIllumination")],n.prototype,"_useEmissiveAsIllumination",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useEmissiveAsIllumination",void 0),(0,w.b)([(0,N.J)("linkEmissiveWithDiffuse")],n.prototype,"_linkEmissiveWithDiffuse",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"linkEmissiveWithDiffuse",void 0),(0,w.b)([(0,N.J)("useSpecularOverAlpha")],n.prototype,"_useSpecularOverAlpha",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useSpecularOverAlpha",void 0),(0,w.b)([(0,N.J)("useReflectionOverAlpha")],n.prototype,"_useReflectionOverAlpha",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useReflectionOverAlpha",void 0),(0,w.b)([(0,N.J)("disableLighting")],n.prototype,"_disableLighting",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsLightsDirty")],n.prototype,"disableLighting",void 0),(0,w.b)([(0,N.J)("useObjectSpaceNormalMap")],n.prototype,"_useObjectSpaceNormalMap",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useObjectSpaceNormalMap",void 0),(0,w.b)([(0,N.J)("useParallax")],n.prototype,"_useParallax",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallax",void 0),(0,w.b)([(0,N.J)("useParallaxOcclusion")],n.prototype,"_useParallaxOcclusion",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useParallaxOcclusion",void 0),(0,w.b)([(0,N.J)()],n.prototype,"parallaxScaleBias",void 0),(0,w.b)([(0,N.J)("roughness")],n.prototype,"_roughness",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"roughness",void 0),(0,w.b)([(0,N.J)()],n.prototype,"indexOfRefraction",void 0),(0,w.b)([(0,N.J)()],n.prototype,"invertRefractionY",void 0),(0,w.b)([(0,N.J)()],n.prototype,"alphaCutOff",void 0),(0,w.b)([(0,N.J)("useLightmapAsShadowmap")],n.prototype,"_useLightmapAsShadowmap",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useLightmapAsShadowmap",void 0),(0,w.b)([(0,N.o)("diffuseFresnelParameters")],n.prototype,"_diffuseFresnelParameters",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"diffuseFresnelParameters",void 0),(0,w.b)([(0,N.o)("opacityFresnelParameters")],n.prototype,"_opacityFresnelParameters",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsFresnelAndMiscDirty")],n.prototype,"opacityFresnelParameters",void 0),(0,w.b)([(0,N.o)("reflectionFresnelParameters")],n.prototype,"_reflectionFresnelParameters",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"reflectionFresnelParameters",void 0),(0,w.b)([(0,N.o)("refractionFresnelParameters")],n.prototype,"_refractionFresnelParameters",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"refractionFresnelParameters",void 0),(0,w.b)([(0,N.o)("emissiveFresnelParameters")],n.prototype,"_emissiveFresnelParameters",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"emissiveFresnelParameters",void 0),(0,w.b)([(0,N.J)("useReflectionFresnelFromSpecular")],n.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsFresnelDirty")],n.prototype,"useReflectionFresnelFromSpecular",void 0),(0,w.b)([(0,N.J)("useGlossinessFromSpecularMapAlpha")],n.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,w.b)([(0,N.J)("maxSimultaneousLights")],n.prototype,"_maxSimultaneousLights",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsLightsDirty")],n.prototype,"maxSimultaneousLights",void 0),(0,w.b)([(0,N.J)("invertNormalMapX")],n.prototype,"_invertNormalMapX",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapX",void 0),(0,w.b)([(0,N.J)("invertNormalMapY")],n.prototype,"_invertNormalMapY",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"invertNormalMapY",void 0),(0,w.b)([(0,N.J)("twoSidedLighting")],n.prototype,"_twoSidedLighting",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsTexturesDirty")],n.prototype,"twoSidedLighting",void 0),(0,w.b)([(0,N.J)("applyDecalMapAfterDetailMap")],n.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,w.b)([(0,N.c)("_markAllSubMeshesAsMiscDirty")],n.prototype,"applyDecalMapAfterDetailMap",void 0),(0,J.g)("BABYLON.StandardMaterial",n),B.e.DefaultMaterialFactory=d=>new n("default material",d)},11108:(d,t,A)=>{"use strict";A.d(t,{e:()=>p});var w=A(10740),N=A(10727);class p{constructor(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=d,this._noUBO=!d.supportsUniformBuffers||N,this._dynamic=A,this._name=w??"no-name",this._data=t||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.Fj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.Fj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(d){let t;if(t=d<=2?d:4,this._uniformLocationPointer%t!==0){const d=this._uniformLocationPointer;this._uniformLocationPointer+=t-this._uniformLocationPointer%t;const A=this._uniformLocationPointer-d;for(let t=0;t<A;t++)this._data.push(0)}}addUniform(d,t){let A,w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[d]){if(w>0){if(t instanceof Array)throw"addUniform should not be use with Array in UBO: "+d;if(this._fillAlignment(4),this._uniformArraySizes[d]={strideSize:t,arraySize:w},16==t)t*=w;else{t=t*w+(4-t)*w}A=[];for(let d=0;d<t;d++)A.push(0)}else{if(t instanceof Array)A=t,t=A.length;else{A=[];for(let d=0;d<t;d++)A.push(0)}this._fillAlignment(t)}this._uniformSizes[d]=t,this._uniformLocations[d]=this._uniformLocationPointer,this._uniformLocationPointer+=t;for(let d=0;d<t;d++)this._data.push(A[d]);this._needSync=!0}}addMatrix(d,t){this.addUniform(d,Array.prototype.slice.call(t.gj()))}addFloat2(d,t,A){const w=[t,A];this.addUniform(d,w)}addFloat3(d,t,A,w){const N=[t,A,w];this.addUniform(d,N)}addColor3(d,t){const A=[t.r,t.g,t.b];this.addUniform(d,A)}addColor4(d,t,A){const w=[t.r,t.g,t.b,A];this.addUniform(d,w)}addVector3(d,t){const A=[t.x,t.y,t.z];this.addUniform(d,A)}addMatrix3x3(d){this.addUniform(d,12)}addMatrix2x2(d){this.addUniform(d,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const d=[];let t=0;for(const A in this._uniformLocations)if(d.push(A),10===++t)break;return d.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(d,t){for(let A=0;A<d.length;++A)if(d[A]!==t[A])return!1;return!0}_copyBuffer(d,t){for(let A=0;A<d.length;++A)t[A]=d[A]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(p._UpdatedUbosInFrame[this._name]||(p._UpdatedUbosInFrame[this._name]=0),p._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(d,t,A){this._checkNewFrame();let N=this._uniformLocations[d];if(void 0===N){if(this._buffer)return void w.e.Error("Cannot add an uniform after UBO has been created. uniformName="+d);this.addUniform(d,A),N=this._uniformLocations[d]}if(this._buffer||this.create(),this._dynamic)for(let w=0;w<A;w++)this._bufferData[N+w]=t[w];else{let d=!1;for(let w=0;w<A;w++)(16===A&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[N+w]!==Math.fround(t[w]))&&(d=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[N+w]=t[w]);this._needSync=this._needSync||d}}updateUniformArray(d,t,A){this._checkNewFrame();const p=this._uniformLocations[d];if(void 0===p)return void w.e.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const B=this._uniformArraySizes[d];if(this._dynamic)for(let w=0;w<A;w++)this._bufferData[p+w]=t[w];else{let d=!1,w=0,X=0;for(let W=0;W<A;W++)if(this._bufferData[p+4*X+w]!==N.g.FloatRound(t[W])&&(d=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[p+4*X+w]=t[W]),w++,w===B.strideSize){for(;w<4;w++)this._bufferData[p+4*X+w]=0;w=0,X++}this._needSync=this._needSync||d}}_cacheMatrix(d,t){this._checkNewFrame();const A=this._valueCache[d],w=t.updateFlag;return(void 0===A||A!==w)&&(this._valueCache[d]=w,!0)}_updateMatrix3x3ForUniform(d,t){for(let A=0;A<3;A++)p._TempBuffer[4*A]=t[3*A],p._TempBuffer[4*A+1]=t[3*A+1],p._TempBuffer[4*A+2]=t[3*A+2],p._TempBuffer[4*A+3]=0;this.updateUniform(d,p._TempBuffer,12)}_updateMatrix3x3ForEffect(d,t){this._currentEffect.setMatrix3x3(d,t)}_updateMatrix2x2ForEffect(d,t){this._currentEffect.setMatrix2x2(d,t)}_updateMatrix2x2ForUniform(d,t){for(let A=0;A<2;A++)p._TempBuffer[4*A]=t[2*A],p._TempBuffer[4*A+1]=t[2*A+1],p._TempBuffer[4*A+2]=0,p._TempBuffer[4*A+3]=0;this.updateUniform(d,p._TempBuffer,8)}_updateFloatForEffect(d,t){this._currentEffect.setFloat(d,t)}_updateFloatForUniform(d,t){p._TempBuffer[0]=t,this.updateUniform(d,p._TempBuffer,1)}_updateFloat2ForEffect(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(d+w,t,A)}_updateFloat2ForUniform(d,t,A){p._TempBuffer[0]=t,p._TempBuffer[1]=A,this.updateUniform(d,p._TempBuffer,2)}_updateFloat3ForEffect(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(d+N,t,A,w)}_updateFloat3ForUniform(d,t,A,w){p._TempBuffer[0]=t,p._TempBuffer[1]=A,p._TempBuffer[2]=w,this.updateUniform(d,p._TempBuffer,3)}_updateFloat4ForEffect(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(d+p,t,A,w,N)}_updateFloat4ForUniform(d,t,A,w,N){p._TempBuffer[0]=t,p._TempBuffer[1]=A,p._TempBuffer[2]=w,p._TempBuffer[3]=N,this.updateUniform(d,p._TempBuffer,4)}_updateFloatArrayForEffect(d,t){this._currentEffect.setFloatArray(d,t)}_updateFloatArrayForUniform(d,t){this.updateUniformArray(d,t,t.length)}_updateArrayForEffect(d,t){this._currentEffect.setArray(d,t)}_updateArrayForUniform(d,t){this.updateUniformArray(d,t,t.length)}_updateIntArrayForEffect(d,t){this._currentEffect.setIntArray(d,t)}_updateIntArrayForUniform(d,t){p._TempBufferInt32View.set(t),this.updateUniformArray(d,p._TempBuffer,t.length)}_updateUIntArrayForEffect(d,t){this._currentEffect.setUIntArray(d,t)}_updateUIntArrayForUniform(d,t){p._TempBufferUInt32View.set(t),this.updateUniformArray(d,p._TempBuffer,t.length)}_updateMatrixForEffect(d,t){this._currentEffect.setMatrix(d,t)}_updateMatrixForUniform(d,t){this._cacheMatrix(d,t)&&this.updateUniform(d,t.gj(),16)}_updateMatricesForEffect(d,t){this._currentEffect.setMatrices(d,t)}_updateMatricesForUniform(d,t){this.updateUniform(d,t,t.length)}_updateVector3ForEffect(d,t){this._currentEffect.setVector3(d,t)}_updateVector3ForUniform(d,t){p._TempBuffer[0]=t.x,p._TempBuffer[1]=t.y,p._TempBuffer[2]=t.z,this.updateUniform(d,p._TempBuffer,3)}_updateVector4ForEffect(d,t){this._currentEffect.setVector4(d,t)}_updateVector4ForUniform(d,t){p._TempBuffer[0]=t.x,p._TempBuffer[1]=t.y,p._TempBuffer[2]=t.z,p._TempBuffer[3]=t.w,this.updateUniform(d,p._TempBuffer,4)}_updateColor3ForEffect(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(d+A,t)}_updateColor3ForUniform(d,t){p._TempBuffer[0]=t.r,p._TempBuffer[1]=t.g,p._TempBuffer[2]=t.b,this.updateUniform(d,p._TempBuffer,3)}_updateColor4ForEffect(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(d+w,t,A)}_updateDirectColor4ForEffect(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(d+A,t)}_updateColor4ForUniform(d,t,A){p._TempBuffer[0]=t.r,p._TempBuffer[1]=t.g,p._TempBuffer[2]=t.b,p._TempBuffer[3]=A,this.updateUniform(d,p._TempBuffer,4)}_updateDirectColor4ForUniform(d,t){p._TempBuffer[0]=t.r,p._TempBuffer[1]=t.g,p._TempBuffer[2]=t.b,p._TempBuffer[3]=t.a,this.updateUniform(d,p._TempBuffer,4)}_updateIntForEffect(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(d+A,t)}_updateIntForUniform(d,t){p._TempBufferInt32View[0]=t,this.updateUniform(d,p._TempBuffer,1)}_updateInt2ForEffect(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(d+w,t,A)}_updateInt2ForUniform(d,t,A){p._TempBufferInt32View[0]=t,p._TempBufferInt32View[1]=A,this.updateUniform(d,p._TempBuffer,2)}_updateInt3ForEffect(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(d+N,t,A,w)}_updateInt3ForUniform(d,t,A,w){p._TempBufferInt32View[0]=t,p._TempBufferInt32View[1]=A,p._TempBufferInt32View[2]=w,this.updateUniform(d,p._TempBuffer,3)}_updateInt4ForEffect(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(d+p,t,A,w,N)}_updateInt4ForUniform(d,t,A,w,N){p._TempBufferInt32View[0]=t,p._TempBufferInt32View[1]=A,p._TempBufferInt32View[2]=w,p._TempBufferInt32View[3]=N,this.updateUniform(d,p._TempBuffer,4)}_updateUIntForEffect(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(d+A,t)}_updateUIntForUniform(d,t){p._TempBufferUInt32View[0]=t,this.updateUniform(d,p._TempBuffer,1)}_updateUInt2ForEffect(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(d+w,t,A)}_updateUInt2ForUniform(d,t,A){p._TempBufferUInt32View[0]=t,p._TempBufferUInt32View[1]=A,this.updateUniform(d,p._TempBuffer,2)}_updateUInt3ForEffect(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(d+N,t,A,w)}_updateUInt3ForUniform(d,t,A,w){p._TempBufferUInt32View[0]=t,p._TempBufferUInt32View[1]=A,p._TempBufferUInt32View[2]=w,this.updateUniform(d,p._TempBuffer,3)}_updateUInt4ForEffect(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(d+p,t,A,w,N)}_updateUInt4ForUniform(d,t,A,w,N){p._TempBufferUInt32View[0]=t,p._TempBufferUInt32View[1]=A,p._TempBufferUInt32View[2]=w,p._TempBufferUInt32View[3]=N,this.updateUniform(d,p._TempBuffer,4)}setTexture(d,t){this._currentEffect.setTexture(d,t)}setTextureArray(d,t){this._currentEffect.setTextureArray(d,t)}bindTexture(d,t){this._currentEffect._bindTexture(d,t)}updateUniformDirectly(d,t){this.updateUniform(d,t,t.length),this.update()}bindToEffect(d,t){this._currentEffect=d,this._currentEffectName=t}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(d){if(!this._buffers)return this._buffer===d;for(let t=0;t<this._buffers.length;++t){if(this._buffers[t][0]===d)return this._bufferIndex=t,this._buffer=d,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const d=this._engine._uniformBuffers,t=d.indexOf(this);if(-1!==t&&(d[t]=d[d.length-1],d.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let A=0;A<this._buffers.length;++A){const d=this._buffers[A][0];this._engine._releaseBuffer(d)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}p._UpdatedUbosInFrame={},p._MAX_UNIFORM_SIZE=256,p._TempBuffer=new Float32Array(p._MAX_UNIFORM_SIZE),p._TempBufferInt32View=new Int32Array(p._TempBuffer.buffer),p._TempBufferUInt32View=new Uint32Array(p._TempBuffer.buffer)},11359:(d,t,A)=>{"use strict";A.d(t,{e:()=>B,h:()=>w});var w,N,p=A(11076);!function(d){d[d.LOCAL=0]="LOCAL",d[d.WORLD=1]="WORLD",d[d.BONE=2]="BONE"}(w||(w={}));class B{}B.X=new p.l(1,0,0),B.Y=new p.l(0,1,0),B.Z=new p.l(0,0,1),function(d){d[d.X=0]="X",d[d.Y=1]="Y",d[d.Z=2]="Z"}(N||(N={}))},11094:(d,t,A)=>{"use strict";A.d(t,{e:()=>i,i:()=>k,j:()=>b});var w=A(11081),N=A(10885),p=A(11079),B=A(11087);function X(d){return Math.pow(d,p.k)}function W(d){return d<=.04045?.0773993808*d:Math.pow(.947867299*(d+.055),2.4)}function a(d){return Math.pow(d,p.i)}function D(d){return d<=.0031308?12.92*d:1.055*Math.pow(d,.41666)-.055}class i{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=d,this.g=t,this.b=A}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"jb"}getHashCode(){let d=255*this.r|0;return d=397*d^255*this.g,d=397*d^255*this.b,d}toArray(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d[t]=this.r,d[t+1]=this.g,d[t+2]=this.b,this}Xc(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.FromArrayToRef(d,t,this),this}toColor4(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new k(this.r,this.g,this.b,d)}gj(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(d){return new i(this.r*d.r,this.g*d.g,this.b*d.b)}multiplyToRef(d,t){return t.r=this.r*d.r,t.g=this.g*d.g,t.b=this.b*d.b,t}multiplyInPlace(d){return this.r*=d.r,this.g*=d.g,this.b*=d.b,this}multiplyByFloats(d,t,A){return new i(this.r*d,this.g*t,this.b*A)}divide(d){throw new ReferenceError("Can not divide a color")}divideToRef(d,t){throw new ReferenceError("Can not divide a color")}divideInPlace(d){throw new ReferenceError("Can not divide a color")}minimizeInPlace(d){return this.minimizeInPlaceFromFloats(d.r,d.g,d.b)}maximizeInPlace(d){return this.maximizeInPlaceFromFloats(d.r,d.g,d.b)}minimizeInPlaceFromFloats(d,t,A){return this.r=Math.min(d,this.r),this.g=Math.min(t,this.g),this.b=Math.min(A,this.b),this}maximizeInPlaceFromFloats(d,t,A){return this.r=Math.max(d,this.r),this.g=Math.max(t,this.g),this.b=Math.max(A,this.b),this}floorToRef(d){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(d){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(d){return d&&this.r===d.r&&this.g===d.g&&this.b===d.b}equalsFloats(d,t,A){return this.equalsToFloats(d,t,A)}equalsToFloats(d,t,A){return this.r===d&&this.g===t&&this.b===A}equalsWithEpsilon(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.b;return(0,B.z)(this.r,d.r,t)&&(0,B.z)(this.g,d.g,t)&&(0,B.z)(this.b,d.b,t)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(d){throw new ReferenceError("Can not negate a color")}scale(d){return new i(this.r*d,this.g*d,this.b*d)}scaleInPlace(d){return this.r*=d,this.g*=d,this.b*=d,this}scaleToRef(d,t){return t.r=this.r*d,t.g=this.g*d,t.b=this.b*d,t}scaleAndAddToRef(d,t){return t.r+=this.r*d,t.g+=this.g*d,t.b+=this.b*d,t}clampToRef(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;return A.r=(0,B.e)(this.r,d,t),A.g=(0,B.e)(this.g,d,t),A.b=(0,B.e)(this.b,d,t),A}add(d){return new i(this.r+d.r,this.g+d.g,this.b+d.b)}addInPlace(d){return this.r+=d.r,this.g+=d.g,this.b+=d.b,this}addInPlaceFromFloats(d,t,A){return this.r+=d,this.g+=t,this.b+=A,this}addToRef(d,t){return t.r=this.r+d.r,t.g=this.g+d.g,t.b=this.b+d.b,t}Uc(d){return new i(this.r-d.r,this.g-d.g,this.b-d.b)}subtractToRef(d,t){return t.r=this.r-d.r,t.g=this.g-d.g,t.b=this.b-d.b,t}ni(d){return this.r-=d.r,this.g-=d.g,this.b-=d.b,this}subtractFromFloats(d,t,A){return new i(this.r-d,this.g-t,this.b-A)}subtractFromFloatsToRef(d,t,A,w){return w.r=this.r-d,w.g=this.g-t,w.b=this.b-A,w}clone(){return new i(this.r,this.g,this.b)}p(d){return this.r=d.r,this.g=d.g,this.b=d.b,this}wf(d,t,A){return this.r=d,this.g=t,this.b=A,this}set(d,t,A){return this.wf(d,t,A)}Dj(d){return this.r=this.g=this.b=d,this}toHexString(){const d=Math.round(255*this.r),t=Math.round(255*this.g),A=Math.round(255*this.b);return"#"+(0,B.w)(d)+(0,B.w)(t)+(0,B.w)(A)}fromHexString(d){return"#"!==d.substring(0,1)||7!==d.length||(this.r=parseInt(d.substring(1,3),16)/255,this.g=parseInt(d.substring(3,5),16)/255,this.b=parseInt(d.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new i)}toHSVToRef(d){const t=this.r,A=this.g,w=this.b,N=Math.max(t,A,w),p=Math.min(t,A,w);let B=0,X=0;const W=N,a=N-p;return 0!==N&&(X=a/N),N!=p&&(N==t?(B=(A-w)/a,A<w&&(B+=6)):N==A?B=(w-t)/a+2:N==w&&(B=(t-A)/a+4),B*=60),d.r=B,d.g=X,d.b=W,d}toLinearSpace(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new i;return this.toLinearSpaceToRef(t,d),t}toLinearSpaceToRef(d){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(d.r=W(this.r),d.g=W(this.g),d.b=W(this.b)):(d.r=X(this.r),d.g=X(this.g),d.b=X(this.b)),this}toGammaSpace(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new i;return this.toGammaSpaceToRef(t,d),t}toGammaSpaceToRef(d){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(d.r=D(this.r),d.g=D(this.g),d.b=D(this.b)):(d.r=a(this.r),d.g=a(this.g),d.b=a(this.b)),this}static HSVtoRGBToRef(d,t,A,w){const N=A*t,p=d/60,B=N*(1-Math.abs(p%2-1));let X=0,W=0,a=0;p>=0&&p<=1?(X=N,W=B):p>=1&&p<=2?(X=B,W=N):p>=2&&p<=3?(W=N,a=B):p>=3&&p<=4?(W=B,a=N):p>=4&&p<=5?(X=B,a=N):p>=5&&p<=6&&(X=N,a=B);const D=A-N;return w.r=X+D,w.g=W+D,w.b=a+D,w}static FromHSV(d,t,A){const w=new i(0,0,0);return i.HSVtoRGBToRef(d,t,A,w),w}static FromHexString(d){return new i(0,0,0).fromHexString(d)}static Lg(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new i(d[t],d[t+1],d[t+2])}static FromArrayToRef(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;A.r=d[t],A.g=d[t+1],A.b=d[t+2]}static FromInts(d,t,A){return new i(d/255,t/255,A/255)}static Lerp(d,t,A){const w=new i(0,0,0);return i.LerpToRef(d,t,A,w),w}static LerpToRef(d,t,A,w){w.r=d.r+(t.r-d.r)*A,w.g=d.g+(t.g-d.g)*A,w.b=d.b+(t.b-d.b)*A}static Hermite(d,t,A,w,N){const p=N*N,B=N*p,X=2*B-3*p+1,W=-2*B+3*p,a=B-2*p+N,D=B-p,k=d.r*X+A.r*W+t.r*a+w.r*D,b=d.g*X+A.g*W+t.g*a+w.g*D,Q=d.b*X+A.b*W+t.b*a+w.b*D;return new i(k,b,Q)}static Hermite1stDerivative(d,t,A,w,N){const p=i.Black();return this.Hermite1stDerivativeToRef(d,t,A,w,N,p),p}static Hermite1stDerivativeToRef(d,t,A,w,N,p){const B=N*N;p.r=6*(B-N)*d.r+(3*B-4*N+1)*t.r+6*(-B+N)*A.r+(3*B-2*N)*w.r,p.g=6*(B-N)*d.g+(3*B-4*N+1)*t.g+6*(-B+N)*A.g+(3*B-2*N)*w.g,p.b=6*(B-N)*d.b+(3*B-4*N+1)*t.b+6*(-B+N)*A.b+(3*B-2*N)*w.b}static Red(){return new i(1,0,0)}static Green(){return new i(0,1,0)}static Blue(){return new i(0,0,1)}static Black(){return new i(0,0,0)}static get BlackReadOnly(){return i._BlackReadOnly}static White(){return new i(1,1,1)}static Purple(){return new i(.5,0,.5)}static Magenta(){return new i(1,0,1)}static Yellow(){return new i(1,1,0)}static Gray(){return new i(.5,.5,.5)}static Teal(){return new i(0,1,1)}static Random(){return new i(Math.random(),Math.random(),Math.random())}}i._BlackReadOnly=i.Black(),Object.defineProperties(i.prototype,{dimension:{value:[3]},rank:{value:1}});class k{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=d,this.g=t,this.b=A,this.a=w}gj(){return[this.r,this.g,this.b,this.a]}toArray(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d[t]=this.r,d[t+1]=this.g,d[t+2]=this.b,d[t+3]=this.a,this}Xc(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=d[t],this.g=d[t+1],this.b=d[t+2],this.a=d[t+3],this}equals(d){return d&&this.r===d.r&&this.g===d.g&&this.b===d.b&&this.a===d.a}add(d){return new k(this.r+d.r,this.g+d.g,this.b+d.b,this.a+d.a)}addToRef(d,t){return t.r=this.r+d.r,t.g=this.g+d.g,t.b=this.b+d.b,t.a=this.a+d.a,t}addInPlace(d){return this.r+=d.r,this.g+=d.g,this.b+=d.b,this.a+=d.a,this}addInPlaceFromFloats(d,t,A,w){return this.r+=d,this.g+=t,this.b+=A,this.a+=w,this}Uc(d){return new k(this.r-d.r,this.g-d.g,this.b-d.b,this.a-d.a)}subtractToRef(d,t){return t.r=this.r-d.r,t.g=this.g-d.g,t.b=this.b-d.b,t.a=this.a-d.a,t}ni(d){return this.r-=d.r,this.g-=d.g,this.b-=d.b,this.a-=d.a,this}subtractFromFloats(d,t,A,w){return new k(this.r-d,this.g-t,this.b-A,this.a-w)}subtractFromFloatsToRef(d,t,A,w,N){return N.r=this.r-d,N.g=this.g-t,N.b=this.b-A,N.a=this.a-w,N}scale(d){return new k(this.r*d,this.g*d,this.b*d,this.a*d)}scaleInPlace(d){return this.r*=d,this.g*=d,this.b*=d,this.a*=d,this}scaleToRef(d,t){return t.r=this.r*d,t.g=this.g*d,t.b=this.b*d,t.a=this.a*d,t}scaleAndAddToRef(d,t){return t.r+=this.r*d,t.g+=this.g*d,t.b+=this.b*d,t.a+=this.a*d,t}clampToRef(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;return A.r=(0,B.e)(this.r,d,t),A.g=(0,B.e)(this.g,d,t),A.b=(0,B.e)(this.b,d,t),A.a=(0,B.e)(this.a,d,t),A}multiply(d){return new k(this.r*d.r,this.g*d.g,this.b*d.b,this.a*d.a)}multiplyToRef(d,t){return t.r=this.r*d.r,t.g=this.g*d.g,t.b=this.b*d.b,t.a=this.a*d.a,t}multiplyInPlace(d){return this.r*=d.r,this.g*=d.g,this.b*=d.b,this.a*=d.a,this}multiplyByFloats(d,t,A,w){return new k(this.r*d,this.g*t,this.b*A,this.a*w)}divide(d){throw new ReferenceError("Can not divide a color")}divideToRef(d,t){throw new ReferenceError("Can not divide a color")}divideInPlace(d){throw new ReferenceError("Can not divide a color")}minimizeInPlace(d){return this.r=Math.min(this.r,d.r),this.g=Math.min(this.g,d.g),this.b=Math.min(this.b,d.b),this.a=Math.min(this.a,d.a),this}maximizeInPlace(d){return this.r=Math.max(this.r,d.r),this.g=Math.max(this.g,d.g),this.b=Math.max(this.b,d.b),this.a=Math.max(this.a,d.a),this}minimizeInPlaceFromFloats(d,t,A,w){return this.r=Math.min(d,this.r),this.g=Math.min(t,this.g),this.b=Math.min(A,this.b),this.a=Math.min(w,this.a),this}maximizeInPlaceFromFloats(d,t,A,w){return this.r=Math.max(d,this.r),this.g=Math.max(t,this.g),this.b=Math.max(A,this.b),this.a=Math.max(w,this.a),this}floorToRef(d){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(d){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(d){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.b;return(0,B.z)(this.r,d.r,t)&&(0,B.z)(this.g,d.g,t)&&(0,B.z)(this.b,d.b,t)&&(0,B.z)(this.a,d.a,t)}equalsToFloats(d,t,A,w){return this.r===d&&this.g===t&&this.b===A&&this.a===w}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"pb"}getHashCode(){let d=255*this.r|0;return d=397*d^255*this.g,d=397*d^255*this.b,d=397*d^255*this.a,d}clone(){return(new k).p(this)}p(d){return this.r=d.r,this.g=d.g,this.b=d.b,this.a=d.a,this}wf(d,t,A,w){return this.r=d,this.g=t,this.b=A,this.a=w,this}set(d,t,A,w){return this.wf(d,t,A,w)}Dj(d){return this.r=this.g=this.b=this.a=d,this}toHexString(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=Math.round(255*this.r),A=Math.round(255*this.g),w=Math.round(255*this.b);if(d)return"#"+(0,B.w)(t)+(0,B.w)(A)+(0,B.w)(w);const N=Math.round(255*this.a);return"#"+(0,B.w)(t)+(0,B.w)(A)+(0,B.w)(w)+(0,B.w)(N)}fromHexString(d){return"#"!==d.substring(0,1)||9!==d.length&&7!==d.length||(this.r=parseInt(d.substring(1,3),16)/255,this.g=parseInt(d.substring(3,5),16)/255,this.b=parseInt(d.substring(5,7),16)/255,9===d.length&&(this.a=parseInt(d.substring(7,9),16)/255)),this}toLinearSpace(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new k;return this.toLinearSpaceToRef(t,d),t}toLinearSpaceToRef(d){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(d.r=W(this.r),d.g=W(this.g),d.b=W(this.b)):(d.r=X(this.r),d.g=X(this.g),d.b=X(this.b)),d.a=this.a,this}toGammaSpace(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=new k;return this.toGammaSpaceToRef(t,d),t}toGammaSpaceToRef(d){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(d.r=D(this.r),d.g=D(this.g),d.b=D(this.b)):(d.r=a(this.r),d.g=a(this.g),d.b=a(this.b)),d.a=this.a,this}static FromHexString(d){return"#"!==d.substring(0,1)||9!==d.length&&7!==d.length?new k(0,0,0,0):new k(0,0,0,1).fromHexString(d)}static Lerp(d,t,A){return k.LerpToRef(d,t,A,new k)}static LerpToRef(d,t,A,w){return w.r=d.r+(t.r-d.r)*A,w.g=d.g+(t.g-d.g)*A,w.b=d.b+(t.b-d.b)*A,w.a=d.a+(t.a-d.a)*A,w}static Hermite(d,t,A,w,N){const p=N*N,B=N*p,X=2*B-3*p+1,W=-2*B+3*p,a=B-2*p+N,D=B-p,i=d.r*X+A.r*W+t.r*a+w.r*D,b=d.g*X+A.g*W+t.g*a+w.g*D,Q=d.b*X+A.b*W+t.b*a+w.b*D,P=d.a*X+A.a*W+t.a*a+w.a*D;return new k(i,b,Q,P)}static Hermite1stDerivative(d,t,A,w,N){const p=new k;return this.Hermite1stDerivativeToRef(d,t,A,w,N,p),p}static Hermite1stDerivativeToRef(d,t,A,w,N,p){const B=N*N;p.r=6*(B-N)*d.r+(3*B-4*N+1)*t.r+6*(-B+N)*A.r+(3*B-2*N)*w.r,p.g=6*(B-N)*d.g+(3*B-4*N+1)*t.g+6*(-B+N)*A.g+(3*B-2*N)*w.g,p.b=6*(B-N)*d.b+(3*B-4*N+1)*t.b+6*(-B+N)*A.b+(3*B-2*N)*w.b,p.a=6*(B-N)*d.a+(3*B-4*N+1)*t.a+6*(-B+N)*A.a+(3*B-2*N)*w.a}static FromColor3(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new k(d.r,d.g,d.b,t)}static Lg(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new k(d[t],d[t+1],d[t+2],d[t+3])}static FromArrayToRef(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;A.r=d[t],A.g=d[t+1],A.b=d[t+2],A.a=d[t+3]}static FromInts(d,t,A,w){return new k(d/255,t/255,A/255,w/255)}static CheckColors4(d,t){if(d.length===3*t){const t=[];for(let A=0;A<d.length;A+=3){const w=A/3*4;t[w]=d[A],t[w+1]=d[A+1],t[w+2]=d[A+2],t[w+3]=1}return t}return d}}Object.defineProperties(k.prototype,{dimension:{value:[4]},rank:{value:1}});class b{}b.jb=(0,w.b)(3,i.Black),b.pb=(0,w.b)(3,(()=>new k(0,0,0,0))),(0,N.g)("BABYLON.Color3",i),(0,N.g)("BABYLON.Color4",k)},11079:(d,t,A)=>{"use strict";A.d(t,{b:()=>B,f:()=>p,i:()=>w,k:()=>N});const w=1/2.2,N=2.2,p=(1+Math.sqrt(5))/2,B=.001},11173:(d,t,A)=>{"use strict";A.d(t,{e:()=>N});var w=A(11181);class N{static GetPlanes(d){const t=[];for(let A=0;A<6;A++)t.push(new w.b(0,0,0,0));return N.GetPlanesToRef(d,t),t}static GetNearPlaneToRef(d,t){const A=d.m;t.ab.x=A[3]+A[2],t.ab.y=A[7]+A[6],t.ab.z=A[11]+A[10],t.d=A[15]+A[14],t.normalize()}static GetFarPlaneToRef(d,t){const A=d.m;t.ab.x=A[3]-A[2],t.ab.y=A[7]-A[6],t.ab.z=A[11]-A[10],t.d=A[15]-A[14],t.normalize()}static GetLeftPlaneToRef(d,t){const A=d.m;t.ab.x=A[3]+A[0],t.ab.y=A[7]+A[4],t.ab.z=A[11]+A[8],t.d=A[15]+A[12],t.normalize()}static GetRightPlaneToRef(d,t){const A=d.m;t.ab.x=A[3]-A[0],t.ab.y=A[7]-A[4],t.ab.z=A[11]-A[8],t.d=A[15]-A[12],t.normalize()}static GetTopPlaneToRef(d,t){const A=d.m;t.ab.x=A[3]-A[1],t.ab.y=A[7]-A[5],t.ab.z=A[11]-A[9],t.d=A[15]-A[13],t.normalize()}static GetBottomPlaneToRef(d,t){const A=d.m;t.ab.x=A[3]+A[1],t.ab.y=A[7]+A[5],t.ab.z=A[11]+A[9],t.d=A[15]+A[13],t.normalize()}static GetPlanesToRef(d,t){N.GetNearPlaneToRef(d,t[0]),N.GetFarPlaneToRef(d,t[1]),N.GetLeftPlaneToRef(d,t[2]),N.GetRightPlaneToRef(d,t[3]),N.GetTopPlaneToRef(d,t[4]),N.GetBottomPlaneToRef(d,t[5])}static IsPointInFrustum(d,t){for(let A=0;A<6;A++)if(t[A].dotCoordinate(d)<0)return!1;return!0}}},11232:(d,t,A)=>{"use strict";A.d(t,{e:()=>X,g:()=>W});var w=A(11041),N=A(11076),p=A(11047);class B{static extractMinAndMaxIndexed(d,t,A,w,N,p){for(let B=A;B<A+w;B++){const A=3*t[B],w=d[A],X=d[A+1],W=d[A+2];N.minimizeInPlaceFromFloats(w,X,W),p.maximizeInPlaceFromFloats(w,X,W)}}static extractMinAndMax(d,t,A,w,N,p){for(let B=t,X=t*w;B<t+A;B++,X+=w){const t=d[X],A=d[X+1],w=d[X+2];N.minimizeInPlaceFromFloats(t,A,w),p.maximizeInPlaceFromFloats(t,A,w)}}}function X(d,t,A,w){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const X=new N.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),W=new N.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return B.extractMinAndMaxIndexed(d,t,A,w,X,W),p&&(X.x-=X.x*p.x+p.y,X.y-=X.y*p.x+p.y,X.z-=X.z*p.x+p.y,W.x+=W.x*p.x+p.y,W.y+=W.y*p.x+p.y,W.z+=W.z*p.x+p.y),{minimum:X,maximum:W}}function W(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0;const X=new N.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),W=new N.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return p||(p=3),B.extractMinAndMax(d,t,A,p,X,W),w&&(X.x-=X.x*w.x+w.y,X.y-=X.y*w.x+w.y,X.z-=X.z*w.x+w.y,W.x+=W.x*w.x+w.y,W.y+=W.y*w.x+w.y,W.z+=W.z*w.x+w.y),{minimum:X,maximum:W}}(0,w.b)([p.g.filter((function(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];let[w,N]=t;return!Array.isArray(w)&&!Array.isArray(N)}))],B,"extractMinAndMaxIndexed",null),(0,w.b)([p.g.filter((function(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];let[w]=t;return!Array.isArray(w)}))],B,"extractMinAndMax",null)},11548:(d,t,A)=>{"use strict";A.d(t,{e:()=>w.h});A(11359),A(11094),A(11079),A(11173),A(11554),A(11181),A(11268);var w=A(11076);A(11333)},11554:(d,t,A)=>{"use strict";A.d(t,{b:()=>X,d:()=>D,e:()=>i});var w,N=A(11087),p=A(11076),B=A(11079);!function(d){d[d.CW=0]="CW",d[d.CCW=1]="CCW"}(w||(w={}));class X{static Interpolate(d,t,A,w,N){const p=1-3*w+3*t,B=3*w-6*t,X=3*t;let W=d;for(let a=0;a<5;a++){const t=W*W;W-=(p*(t*W)+B*t+X*W-d)*(1/(3*p*t+2*B*W+X)),W=Math.min(1,Math.max(0,W))}return 3*Math.pow(1-W,2)*W*A+3*(1-W)*Math.pow(W,2)*N+Math.pow(W,3)}}class W{constructor(d){this._radians=d,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(d,t){const A=t.Uc(d),w=Math.atan2(A.y,A.x);return new W(w)}static BetweenTwoVectors(d,t){let A=d.lengthSquared()*t.lengthSquared();if(0===A)return new W(Math.PI/2);A=Math.sqrt(A);let w=d.dot(t)/A;w=(0,N.e)(w,-1,1);const p=Math.acos(w);return new W(p)}static FromRadians(d){return new W(d)}static FromDegrees(d){return new W(d*Math.PI/180)}}class a{constructor(d,t,A){this.startPoint=d,this.midPoint=t,this.endPoint=A;const w=Math.pow(t.x,2)+Math.pow(t.y,2),N=(Math.pow(d.x,2)+Math.pow(d.y,2)-w)/2,B=(w-Math.pow(A.x,2)-Math.pow(A.y,2))/2,X=(d.x-t.x)*(t.y-A.y)-(t.x-A.x)*(d.y-t.y);this.centerPoint=new p.j((N*(t.y-A.y)-B*(d.y-t.y))/X,((d.x-t.x)*B-(t.x-A.x)*N)/X),this.i=this.centerPoint.Uc(this.startPoint).length(),this.startAngle=W.BetweenTwoPoints(this.centerPoint,this.startPoint);const a=this.startAngle.degrees();let D=W.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),i=W.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();D-a>180&&(D-=360),D-a<-180&&(D+=360),i-D>180&&(i-=360),i-D<-180&&(i+=360),this.orientation=D-a<0?0:1,this.angle=W.FromDegrees(0===this.orientation?a-i:i-a)}}class D{constructor(d,t){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new p.j(d,t))}addLineTo(d,t){if(this.closed)return this;const A=new p.j(d,t),w=this._points[this._points.length-1];return this._points.push(A),this._length+=A.Uc(w).length(),this}addArcTo(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const B=this._points[this._points.length-1],X=new p.j(d,t),W=new p.j(A,w),D=new a(B,X,W);let i=D.angle.radians()/N;0===D.orientation&&(i*=-1);let k=D.startAngle.radians()+i;for(let p=0;p<N;p++){const d=Math.cos(k)*D.i+D.centerPoint.x,t=Math.sin(k)*D.i+D.centerPoint.y;this.addLineTo(d,t),k+=i}return this}addQuadraticCurveTo(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const p=(d,t,A,w)=>(1-d)*(1-d)*t+2*d*(1-d)*A+d*d*w,B=this._points[this._points.length-1];for(let X=0;X<=N;X++){const W=X/N,a=p(W,B.x,d,A),D=p(W,B.y,t,w);this.addLineTo(a,D)}return this}addBezierCurveTo(d,t,A,w,N,p){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const X=(d,t,A,w,N)=>(1-d)*(1-d)*(1-d)*t+3*d*(1-d)*(1-d)*A+3*d*d*(1-d)*w+d*d*d*N,W=this._points[this._points.length-1];for(let a=0;a<=B;a++){const D=a/B,i=X(D,W.x,d,A,N),k=X(D,W.y,t,w,p);this.addLineTo(i,k)}return this}isPointInside(d){let t=!1;const A=this._points.length;for(let w=A-1,N=0;N<A;w=N++){let A=this._points[w],p=this._points[N],B=p.x-A.x,X=p.y-A.y;if(Math.abs(X)>Number.EPSILON){if(X<0&&(A=this._points[N],B=-B,p=this._points[w],X=-X),d.y<A.y||d.y>p.y)continue;if(d.y===A.y&&d.x===A.x)return!0;{const w=X*(d.x-A.x)-B*(d.y-A.y);if(0===w)return!0;if(w<0)continue;t=!t}}else{if(d.y!==A.y)continue;if(p.x<=d.x&&d.x<=A.x||A.x<=d.x&&d.x<=p.x)return!0}}return t}close(){return this.closed=!0,this}length(){let d=this._length;if(this.closed){const t=this._points[this._points.length-1];d+=this._points[0].Uc(t).length()}return d}area(){const d=this._points.length;let t=0;for(let A=d-1,w=0;w<d;A=w++)t+=this._points[A].x*this._points[w].y-this._points[w].x*this._points[A].y;return.5*t}getPoints(){return this._points}getPointAtLengthPosition(d){if(d<0||d>1)return p.j.Zero();const t=d*this.length();let A=0;for(let w=0;w<this._points.length;w++){const d=(w+1)%this._points.length,N=this._points[w],B=this._points[d].Uc(N),X=B.length()+A;if(t>=A&&t<=X){const d=B.normalize(),w=t-A;return new p.j(N.x+d.x*w,N.y+d.y*w)}A=X}return p.j.Zero()}static StartingAt(d,t){return new D(d,t)}}class i{constructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=d,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:p.l.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:p.c.Identity()};for(let N=0;N<d.length;N++)this._curve[N]=d[N].clone();this._raw=A||!1,this._alignTangentsWithPath=w,this._compute(t,w)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(d){return this._updatePointAtData(d).point}getTangentAt(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(d,t),t?p.l.TransformCoordinates(p.l.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(d,t),t?p.l.TransformCoordinates(p.l.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(d,t),t?p.l.TransformCoordinates(p.l.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(d){return this.length()*d}getPreviousPointIndexAt(d){return this._updatePointAtData(d),this._pointAtData.previousPointArrayIndex}getSubPositionAt(d){return this._updatePointAtData(d),this._pointAtData.subPosition}getClosestPositionTo(d){let t=Number.MAX_VALUE,A=0;for(let w=0;w<this._curve.length-1;w++){const N=this._curve[w+0],B=this._curve[w+1].Uc(N).normalize(),X=this._distances[w+1]-this._distances[w+0],W=Math.min(Math.max(p.l.Dot(B,d.Uc(N).normalize()),0)*p.l.Distance(N,d)/X,1),a=p.l.Distance(N.add(B.scale(W*X)),d);a<t&&(t=a,A=(this._distances[w+0]+X*W)/this.length())}return A}slice(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(d<0&&(d=1- -1*d%1),t<0&&(t=1- -1*t%1),d>t){const A=d;d=t,t=A}const A=this.getCurve(),w=this.getPointAt(d);let N=this.getPreviousPointIndexAt(d);const p=this.getPointAt(t),B=this.getPreviousPointIndexAt(t)+1,X=[];return 0!==d&&(N++,X.push(w)),X.push(...A.slice(N,B)),1===t&&1!==d||X.push(p),new i(X,this.getNormalAt(d),this._raw,this._alignTangentsWithPath)}update(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let w=0;w<d.length;w++)this._curve[w].x=d[w].x,this._curve[w].y=d[w].y,this._curve[w].z=d[w].z;return this._compute(t,A),this}_compute(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const A=this._curve.length;if(A<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[A-1]=this._curve[A-1].Uc(this._curve[A-2]),this._raw||this._tangents[A-1].normalize();const w=this._tangents[0],N=this._normalVector(w,d);let B,X,W,a,D;this._normals[0]=N,this._raw||this._normals[0].normalize(),this._binormals[0]=p.l.Cross(w,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let i=1;i<A;i++)B=this._getLastNonNullVector(i),i<A-1&&(X=this._getFirstNonNullVector(i),this._tangents[i]=t?X:B.add(X),this._tangents[i].normalize()),this._distances[i]=this._distances[i-1]+this._curve[i].Uc(this._curve[i-1]).length(),W=this._tangents[i],D=this._binormals[i-1],this._normals[i]=p.l.Cross(D,W),this._raw||(0===this._normals[i].length()?(a=this._normals[i-1],this._normals[i]=a.clone()):this._normals[i].normalize()),this._binormals[i]=p.l.Cross(W,this._normals[i]),this._raw||this._binormals[i].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(d){let t=1,A=this._curve[d+t].Uc(this._curve[d]);for(;0===A.length()&&d+t+1<this._curve.length;)t++,A=this._curve[d+t].Uc(this._curve[d]);return A}_getLastNonNullVector(d){let t=1,A=this._curve[d].Uc(this._curve[d-t]);for(;0===A.length()&&d>t+1;)t++,A=this._curve[d].Uc(this._curve[d-t]);return A}_normalVector(d,t){let A,w=d.length();if(0===w&&(w=1),void 0===t||null===t){let t;t=(0,N.z)(Math.abs(d.y)/w,1,B.b)?(0,N.z)(Math.abs(d.x)/w,1,B.b)?(0,N.z)(Math.abs(d.z)/w,1,B.b)?p.l.Zero():new p.l(0,0,1):new p.l(1,0,0):new p.l(0,-1,0),A=p.l.Cross(d,t)}else A=p.l.Cross(d,t),p.l.CrossToRef(A,d,A);return A.normalize(),A}_updatePointAtData(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===d)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=d;const A=this.getPoints();if(d<=0)return this._setPointAtData(0,0,A[0],0,t);if(d>=1)return this._setPointAtData(1,1,A[A.length-1],A.length-1,t);let w,N=A[0],B=0;const X=d*this.length();for(let W=1;W<A.length;W++){w=A[W];const a=p.l.Distance(N,w);if(B+=a,B===X)return this._setPointAtData(d,1,w,W,t);if(B>X){const A=(B-X)/a,p=N.Uc(w),D=w.add(p.scaleInPlace(A));return this._setPointAtData(d,1-A,D,W-1,t)}N=w}return this._pointAtData}_setPointAtData(d,t,A,w,N){return this._pointAtData.point=A,this._pointAtData.position=d,this._pointAtData.subPosition=t,this._pointAtData.previousPointArrayIndex=w,this._pointAtData.interpolateReady=N,N&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=p.c.Identity();const d=this._pointAtData.previousPointArrayIndex;if(d!==this._tangents.length-1){const t=d+1,A=this._tangents[d].clone(),w=this._normals[d].clone(),N=this._binormals[d].clone(),B=this._tangents[t].clone(),X=this._normals[t].clone(),W=this._binormals[t].clone(),a=p.f.RotationQuaternionFromAxis(w,N,A),D=p.f.RotationQuaternionFromAxis(X,W,B);p.f.Slerp(a,D,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11181:(d,t,A)=>{"use strict";A.d(t,{b:()=>N});var w=A(11076);class N{constructor(d,t,A,N){this.ab=new w.l(d,t,A),this.d=N}gj(){return[this.ab.x,this.ab.y,this.ab.z,this.d]}clone(){return new N(this.ab.x,this.ab.y,this.ab.z,this.d)}getClassName(){return"Plane"}getHashCode(){let d=this.ab.getHashCode();return d=397*d^this.d,d}normalize(){const d=Math.sqrt(this.ab.x*this.ab.x+this.ab.y*this.ab.y+this.ab.z*this.ab.z);let t=0;return 0!==d&&(t=1/d),this.ab.x*=t,this.ab.y*=t,this.ab.z*=t,this.d*=t,this}transform(d){const t=N._TmpMatrix;d.invertToRef(t);const A=t.m,w=this.ab.x,p=this.ab.y,B=this.ab.z,X=this.d,W=w*A[0]+p*A[1]+B*A[2]+X*A[3],a=w*A[4]+p*A[5]+B*A[6]+X*A[7],D=w*A[8]+p*A[9]+B*A[10]+X*A[11],i=w*A[12]+p*A[13]+B*A[14]+X*A[15];return new N(W,a,D,i)}dotCoordinate(d){return this.ab.x*d.x+this.ab.y*d.y+this.ab.z*d.z+this.d}copyFromPoints(d,t,A){const w=t.x-d.x,N=t.y-d.y,p=t.z-d.z,B=A.x-d.x,X=A.y-d.y,W=A.z-d.z,a=N*W-p*X,D=p*B-w*W,i=w*X-N*B,k=Math.sqrt(a*a+D*D+i*i);let b;return b=0!==k?1/k:0,this.ab.x=a*b,this.ab.y=D*b,this.ab.z=i*b,this.d=-(this.ab.x*d.x+this.ab.y*d.y+this.ab.z*d.z),this}isFrontFacingTo(d,t){return w.l.Dot(this.ab,d)<=t}signedDistanceTo(d){return w.l.Dot(d,this.ab)+this.d}static Lg(d){return new N(d[0],d[1],d[2],d[3])}static FromPoints(d,t,A){const w=new N(0,0,0,0);return w.copyFromPoints(d,t,A),w}static FromPositionAndNormal(d,t){const A=new N(0,0,0,0);return this.FromPositionAndNormalToRef(d,t,A)}static FromPositionAndNormalToRef(d,t,A){return A.ab.p(t),A.ab.normalize(),A.d=-d.dot(A.ab),A}static SignedDistanceToPlaneFromPositionAndNormal(d,t,A){const N=-(t.x*d.x+t.y*d.y+t.z*d.z);return w.l.Dot(A,t)+N}}N._TmpMatrix=w.c.Identity()},11087:(d,t,A)=>{"use strict";function w(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(d-t)<=A}function N(d,t){return d===t?d:Math.random()*(t-d)+d}function p(d,t,A){return d+(t-d)*A}function B(d,t,A,w,N){const p=N*N,B=N*p;return d*(2*B-3*p+1)+A*(-2*B+3*p)+t*(B-2*p+N)+w*(B-p)}function X(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(A,Math.max(t,d))}function W(d){return d-=2*Math.PI*Math.floor((d+Math.PI)/(2*Math.PI))}function a(d){const t=d.toString(16);return d<=15?("0"+t).toUpperCase():t.toUpperCase()}function D(d){if(Math.log2)return Math.floor(Math.log2(d));if(d<0)return NaN;if(0===d)return-1/0;let t=0;if(d<1){for(;d<1;)t++,d*=2;t=-t}else if(d>1)for(;d>1;)t++,d=Math.floor(d/2);return t}function i(d,t){const A=d%t;return 0===A?t:i(t,A)}A.d(t,{e:()=>X,f:()=>B,j:()=>i,n:()=>D,o:()=>p,r:()=>W,t:()=>N,w:()=>a,z:()=>w})},11268:(d,t,A)=>{"use strict";A.d(t,{e:()=>w});class w{constructor(d,t){this.width=d,this.height=t}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let d=0|this.width;return d=397*d^this.height,d}p(d){this.width=d.width,this.height=d.height}wf(d,t){return this.width=d,this.height=t,this}set(d,t){return this.wf(d,t)}multiplyByFloats(d,t){return new w(this.width*d,this.height*t)}clone(){return new w(this.width,this.height)}equals(d){return!!d&&(this.width===d.width&&this.height===d.height)}get surface(){return this.width*this.height}static Zero(){return new w(0,0)}add(d){return new w(this.width+d.width,this.height+d.height)}Uc(d){return new w(this.width-d.width,this.height-d.height)}scale(d){return new w(this.width*d,this.height*d)}static Lerp(d,t,A){const N=d.width+(t.width-d.width)*A,p=d.height+(t.height-d.height)*A;return new w(N,p)}}},11076:(d,t,A)=>{"use strict";A.d(t,{c:()=>Q,f:()=>b,h:()=>J,j:()=>D,l:()=>i,m:()=>k});var w=A(11079),N=A(11081),p=A(10885),B=A(10856),X=A(10775),W=A(11087);const a=d=>parseInt(d.toString().replace(/\W/g,""));class D{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=d,this.y=t}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let d=a(this.x);return d=397*d^a(this.y),d}toArray(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d[t]=this.x,d[t+1]=this.y,this}Xc(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return D.FromArrayToRef(d,t,this),this}gj(){return[this.x,this.y]}p(d){return this.x=d.x,this.y=d.y,this}wf(d,t){return this.x=d,this.y=t,this}set(d,t){return this.wf(d,t)}Dj(d){return this.wf(d,d)}add(d){return new D(this.x+d.x,this.y+d.y)}addToRef(d,t){return t.x=this.x+d.x,t.y=this.y+d.y,t}addInPlace(d){return this.x+=d.x,this.y+=d.y,this}addInPlaceFromFloats(d,t){return this.x+=d,this.y+=t,this}addVector3(d){return new D(this.x+d.x,this.y+d.y)}Uc(d){return new D(this.x-d.x,this.y-d.y)}subtractToRef(d,t){return t.x=this.x-d.x,t.y=this.y-d.y,t}ni(d){return this.x-=d.x,this.y-=d.y,this}multiplyInPlace(d){return this.x*=d.x,this.y*=d.y,this}multiply(d){return new D(this.x*d.x,this.y*d.y)}multiplyToRef(d,t){return t.x=this.x*d.x,t.y=this.y*d.y,t}multiplyByFloats(d,t){return new D(this.x*d,this.y*t)}divide(d){return new D(this.x/d.x,this.y/d.y)}divideToRef(d,t){return t.x=this.x/d.x,t.y=this.y/d.y,t}divideInPlace(d){return this.x=this.x/d.x,this.y=this.y/d.y,this}minimizeInPlace(d){return this.minimizeInPlaceFromFloats(d.x,d.y)}maximizeInPlace(d){return this.maximizeInPlaceFromFloats(d.x,d.y)}minimizeInPlaceFromFloats(d,t){return this.x=Math.min(d,this.x),this.y=Math.min(t,this.y),this}maximizeInPlaceFromFloats(d,t){return this.x=Math.max(d,this.x),this.y=Math.max(t,this.y),this}subtractFromFloats(d,t){return new D(this.x-d,this.y-t)}subtractFromFloatsToRef(d,t,A){return A.x=this.x-d,A.y=this.y-t,A}negate(){return new D(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(d){return d.x=-this.x,d.y=-this.y,d}scaleInPlace(d){return this.x*=d,this.y*=d,this}scale(d){return new D(this.x*d,this.y*d)}scaleToRef(d,t){return t.x=this.x*d,t.y=this.y*d,t}scaleAndAddToRef(d,t){return t.x+=this.x*d,t.y+=this.y*d,t}equals(d){return d&&this.x===d.x&&this.y===d.y}equalsWithEpsilon(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.b;return d&&(0,W.z)(this.x,d.x,t)&&(0,W.z)(this.y,d.y,t)}equalsToFloats(d,t){return this.x===d&&this.y===t}floor(){return new D(Math.floor(this.x),Math.floor(this.y))}floorToRef(d){return d.x=Math.floor(this.x),d.y=Math.floor(this.y),d}fract(){return new D(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(d){return d.x=this.x-Math.floor(this.x),d.y=this.y-Math.floor(this.y),d}rotateToRef(d,t){const A=Math.cos(d),w=Math.sin(d),N=A*this.x-w*this.y,p=w*this.x+A*this.y;return t.x=N,t.y=p,t}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(d){return 0===d||1===d?this:this.scaleInPlace(1/d)}normalizeToNew(){const d=new D;return this.normalizeToRef(d),d}normalizeToRef(d){const t=this.length();return 0===t&&(d.x=this.x,d.y=this.y),this.scaleToRef(1/t,d)}clone(){return new D(this.x,this.y)}dot(d){return this.x*d.x+this.y*d.y}static Zero(){return new D(0,0)}static One(){return new D(1,1)}static Random(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new D((0,W.t)(d,t),(0,W.t)(d,t))}static RandomToRef(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).wf((0,W.t)(d,t),(0,W.t)(d,t))}static get ZeroReadOnly(){return D._ZeroReadOnly}static Lg(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new D(d[t],d[t+1])}static FromArrayToRef(d,t,A){return A.x=d[t],A.y=d[t+1],A}static FromFloatsToRef(d,t,A){return A.wf(d,t),A}static CatmullRom(d,t,A,w,N){const p=N*N,B=N*p,X=.5*(2*t.x+(-d.x+A.x)*N+(2*d.x-5*t.x+4*A.x-w.x)*p+(-d.x+3*t.x-3*A.x+w.x)*B),W=.5*(2*t.y+(-d.y+A.y)*N+(2*d.y-5*t.y+4*A.y-w.y)*p+(-d.y+3*t.y-3*A.y+w.y)*B);return new D(X,W)}static ClampToRef(d,t,A,w){return w.x=(0,W.e)(d.x,t.x,A.x),w.y=(0,W.e)(d.y,t.y,A.y),w}static Clamp(d,t,A){const w=(0,W.e)(d.x,t.x,A.x),N=(0,W.e)(d.y,t.y,A.y);return new D(w,N)}static Hermite(d,t,A,w,N){const p=N*N,B=N*p,X=2*B-3*p+1,W=-2*B+3*p,a=B-2*p+N,i=B-p,k=d.x*X+A.x*W+t.x*a+w.x*i,b=d.y*X+A.y*W+t.y*a+w.y*i;return new D(k,b)}static Hermite1stDerivative(d,t,A,w,N){return this.Hermite1stDerivativeToRef(d,t,A,w,N,new D)}static Hermite1stDerivativeToRef(d,t,A,w,N,p){const B=N*N;return p.x=6*(B-N)*d.x+(3*B-4*N+1)*t.x+6*(-B+N)*A.x+(3*B-2*N)*w.x,p.y=6*(B-N)*d.y+(3*B-4*N+1)*t.y+6*(-B+N)*A.y+(3*B-2*N)*w.y,p}static Lerp(d,t,A){return D.LerpToRef(d,t,A,new D)}static LerpToRef(d,t,A,w){return w.x=d.x+(t.x-d.x)*A,w.y=d.y+(t.y-d.y)*A,w}static Dot(d,t){return d.x*t.x+d.y*t.y}static Normalize(d){return D.NormalizeToRef(d,new D)}static NormalizeToRef(d,t){return d.normalizeToRef(t),t}static Minimize(d,t){const A=d.x<t.x?d.x:t.x,w=d.y<t.y?d.y:t.y;return new D(A,w)}static Maximize(d,t){const A=d.x>t.x?d.x:t.x,w=d.y>t.y?d.y:t.y;return new D(A,w)}static Transform(d,t){return D.TransformToRef(d,t,new D)}static TransformToRef(d,t,A){const w=t.m,N=d.x*w[0]+d.y*w[4]+w[12],p=d.x*w[1]+d.y*w[5]+w[13];return A.x=N,A.y=p,A}static PointInTriangle(d,t,A,w){const N=.5*(-A.y*w.x+t.y*(-A.x+w.x)+t.x*(A.y-w.y)+A.x*w.y),p=N<0?-1:1,B=(t.y*w.x-t.x*w.y+(w.y-t.y)*d.x+(t.x-w.x)*d.y)*p,X=(t.x*A.y-t.y*A.x+(t.y-A.y)*d.x+(A.x-t.x)*d.y)*p;return B>0&&X>0&&B+X<2*N*p}static Distance(d,t){return Math.sqrt(D.DistanceSquared(d,t))}static DistanceSquared(d,t){const A=d.x-t.x,w=d.y-t.y;return A*A+w*w}static Center(d,t){return D.CenterToRef(d,t,new D)}static CenterToRef(d,t,A){return A.wf((d.x+t.x)/2,(d.y+t.y)/2)}static DistanceOfPointFromSegment(d,t,A){const w=D.DistanceSquared(t,A);if(0===w)return D.Distance(d,t);const N=A.Uc(t),p=Math.max(0,Math.min(1,D.Dot(d.Uc(t),N)/w)),B=t.add(N.multiplyByFloats(p,p));return D.Distance(d,B)}}D._ZeroReadOnly=D.Zero(),Object.defineProperties(D.prototype,{dimension:{value:[2]},rank:{value:1}});class i{get x(){return this._x}set x(d){this._x=d,this._isDirty=!0}get y(){return this._y}set y(d){this._y=d,this._isDirty=!0}get z(){return this._z}set z(d){this._z=d,this._isDirty=!0}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=d,this._y=t,this._z=A}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"gb"}getHashCode(){let d=a(this._x);return d=397*d^a(this._y),d=397*d^a(this._z),d}gj(){return[this._x,this._y,this._z]}toArray(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d[t]=this._x,d[t+1]=this._y,d[t+2]=this._z,this}Xc(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.FromArrayToRef(d,t,this),this}toQuaternion(){return b.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(d){return this._x+=d._x,this._y+=d._y,this._z+=d._z,this._isDirty=!0,this}addInPlaceFromFloats(d,t,A){return this._x+=d,this._y+=t,this._z+=A,this._isDirty=!0,this}add(d){return new i(this._x+d._x,this._y+d._y,this._z+d._z)}addToRef(d,t){return t._x=this._x+d._x,t._y=this._y+d._y,t._z=this._z+d._z,t._isDirty=!0,t}ni(d){return this._x-=d._x,this._y-=d._y,this._z-=d._z,this._isDirty=!0,this}Uc(d){return new i(this._x-d._x,this._y-d._y,this._z-d._z)}subtractToRef(d,t){return this.subtractFromFloatsToRef(d._x,d._y,d._z,t)}subtractFromFloats(d,t,A){return new i(this._x-d,this._y-t,this._z-A)}subtractFromFloatsToRef(d,t,A,w){return w._x=this._x-d,w._y=this._y-t,w._z=this._z-A,w._isDirty=!0,w}negate(){return new i(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(d){return d._x=-1*this._x,d._y=-1*this._y,d._z=-1*this._z,d._isDirty=!0,d}scaleInPlace(d){return this._x*=d,this._y*=d,this._z*=d,this._isDirty=!0,this}scale(d){return new i(this._x*d,this._y*d,this._z*d)}scaleToRef(d,t){return t._x=this._x*d,t._y=this._y*d,t._z=this._z*d,t._isDirty=!0,t}getNormalToRef(d){const t=this.length();let A=Math.acos(this.y/t);const w=Math.atan2(this.z,this.x);A>Math.PI/2?A-=Math.PI/2:A+=Math.PI/2;const N=t*Math.sin(A)*Math.cos(w),p=t*Math.cos(A),B=t*Math.sin(A)*Math.sin(w);return d.set(N,p,B),d}applyRotationQuaternionToRef(d,t){const A=this._x,w=this._y,N=this._z,p=d._x,B=d._y,X=d._z,W=d._w,a=2*(B*N-X*w),D=2*(X*A-p*N),i=2*(p*w-B*A);return t._x=A+W*a+B*i-X*D,t._y=w+W*D+X*a-p*i,t._z=N+W*i+p*D-B*a,t._isDirty=!0,t}applyRotationQuaternionInPlace(d){return this.applyRotationQuaternionToRef(d,this)}applyRotationQuaternion(d){return this.applyRotationQuaternionToRef(d,new i)}scaleAndAddToRef(d,t){return t._x+=this._x*d,t._y+=this._y*d,t._z+=this._z*d,t._isDirty=!0,t}projectOnPlane(d,t){return this.projectOnPlaneToRef(d,t,new i)}projectOnPlaneToRef(d,t,A){const w=d.ab,N=d.d,p=P.gb[0];this.subtractToRef(t,p),p.normalize();const B=i.Dot(p,w);if(Math.abs(B)<1e-10)A.Dj(1/0);else{const d=-(i.Dot(t,w)+N)/B,X=p.scaleInPlace(d);t.addToRef(X,A)}return A}equals(d){return d&&this._x===d._x&&this._y===d._y&&this._z===d._z}equalsWithEpsilon(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.b;return d&&(0,W.z)(this._x,d._x,t)&&(0,W.z)(this._y,d._y,t)&&(0,W.z)(this._z,d._z,t)}equalsToFloats(d,t,A){return this._x===d&&this._y===t&&this._z===A}multiplyInPlace(d){return this._x*=d._x,this._y*=d._y,this._z*=d._z,this._isDirty=!0,this}multiply(d){return this.multiplyByFloats(d._x,d._y,d._z)}multiplyToRef(d,t){return t._x=this._x*d._x,t._y=this._y*d._y,t._z=this._z*d._z,t._isDirty=!0,t}multiplyByFloats(d,t,A){return new i(this._x*d,this._y*t,this._z*A)}divide(d){return new i(this._x/d._x,this._y/d._y,this._z/d._z)}divideToRef(d,t){return t._x=this._x/d._x,t._y=this._y/d._y,t._z=this._z/d._z,t._isDirty=!0,t}divideInPlace(d){return this._x=this._x/d._x,this._y=this._y/d._y,this._z=this._z/d._z,this._isDirty=!0,this}minimizeInPlace(d){return this.minimizeInPlaceFromFloats(d._x,d._y,d._z)}maximizeInPlace(d){return this.maximizeInPlaceFromFloats(d._x,d._y,d._z)}minimizeInPlaceFromFloats(d,t,A){return d<this._x&&(this.x=d),t<this._y&&(this.y=t),A<this._z&&(this.z=A),this}maximizeInPlaceFromFloats(d,t,A){return d>this._x&&(this.x=d),t>this._y&&(this.y=t),A>this._z&&(this.z=A),this}isNonUniformWithinEpsilon(d){const t=Math.abs(this._x),A=Math.abs(this._y);if(!(0,W.z)(t,A,d))return!0;const w=Math.abs(this._z);return!(0,W.z)(t,w,d)||!(0,W.z)(A,w,d)}get isNonUniform(){const d=Math.abs(this._x);if(d!==Math.abs(this._y))return!0;return d!==Math.abs(this._z)}floorToRef(d){return d._x=Math.floor(this._x),d._y=Math.floor(this._y),d._z=Math.floor(this._z),d._isDirty=!0,d}floor(){return new i(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(d){return d._x=this.x-Math.floor(this._x),d._y=this.y-Math.floor(this._y),d._z=this.z-Math.floor(this._z),d._isDirty=!0,d}fract(){return new i(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(d){if("xyz"===(d=d.toLowerCase()))return this;const t=P.gb[0].p(this);return this.x=t[d[0]],this.y=t[d[1]],this.z=t[d[2]],this}rotateByQuaternionToRef(d,t){return d.toRotationMatrix(P.Matrix[0]),i.TransformCoordinatesToRef(this,P.Matrix[0],t),t}rotateByQuaternionAroundPointToRef(d,t,A){return this.subtractToRef(t,P.gb[0]),P.gb[0].rotateByQuaternionToRef(d,P.gb[0]),t.addToRef(P.gb[0],A),A}cross(d){return i.CrossToRef(this,d,new i)}normalizeFromLength(d){return 0===d||1===d?this:this.scaleInPlace(1/d)}normalizeToNew(){return this.normalizeToRef(new i)}normalizeToRef(d){const t=this.length();return 0===t||1===t?(d._x=this._x,d._y=this._y,d._z=this._z,d._isDirty=!0,d):this.scaleToRef(1/t,d)}clone(){return new i(this._x,this._y,this._z)}p(d){return this.wf(d._x,d._y,d._z)}wf(d,t,A){return this._x=d,this._y=t,this._z=A,this._isDirty=!0,this}set(d,t,A){return this.wf(d,t,A)}Dj(d){return this._x=this._y=this._z=d,this._isDirty=!0,this}static GetClipFactor(d,t,A,w){const N=i.Dot(d,A);return(N-w)/(N-i.Dot(t,A))}static GetAngleBetweenVectors(d,t,A){const w=d.normalizeToRef(P.gb[1]),N=t.normalizeToRef(P.gb[2]);let p=i.Dot(w,N);p=(0,W.e)(p,-1,1);const B=Math.acos(p),X=P.gb[3];return i.CrossToRef(w,N,X),i.Dot(X,A)>0?isNaN(B)?0:B:isNaN(B)?-Math.PI:-Math.acos(p)}static GetAngleBetweenVectorsOnPlane(d,t,A){P.gb[0].p(d);const w=P.gb[0];P.gb[1].p(t);const N=P.gb[1];P.gb[2].p(A);const p=P.gb[2],B=P.gb[3],X=P.gb[4];w.normalize(),N.normalize(),p.normalize(),i.CrossToRef(p,w,B),i.CrossToRef(B,p,X);const a=Math.atan2(i.Dot(N,B),i.Dot(N,X));return(0,W.r)(a)}static PitchYawRollToMoveBetweenPointsToRef(d,t,A){const w=J.gb[0];return t.subtractToRef(d,w),A._y=Math.atan2(w.x,w.z)||0,A._x=Math.atan2(Math.sqrt(w.x**2+w.z**2),w.y)||0,A._z=0,A._isDirty=!0,A}static PitchYawRollToMoveBetweenPoints(d,t){const A=i.Zero();return i.PitchYawRollToMoveBetweenPointsToRef(d,t,A)}static SlerpToRef(d,t,A,N){A=(0,W.e)(A,0,1);const p=P.gb[0],B=P.gb[1];p.p(d);const X=p.length();p.normalizeFromLength(X),B.p(t);const a=B.length();B.normalizeFromLength(a);const D=i.Dot(p,B);let k,b;if(D<1-w.b){const d=Math.acos(D),t=1/Math.sin(d);k=Math.sin((1-A)*d)*t,b=Math.sin(A*d)*t}else k=1-A,b=A;return p.scaleInPlace(k),B.scaleInPlace(b),N.p(p).addInPlace(B),N.scaleInPlace((0,W.o)(X,a,A)),N}static SmoothToRef(d,t,A,w,N){return i.SlerpToRef(d,t,0===w?1:A/w,N),N}static Lg(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new i(d[t],d[t+1],d[t+2])}static FromFloatArray(d,t){return i.Lg(d,t)}static FromArrayToRef(d,t,A){return A._x=d[t],A._y=d[t+1],A._z=d[t+2],A._isDirty=!0,A}static FromFloatArrayToRef(d,t,A){return i.FromArrayToRef(d,t,A)}static FromFloatsToRef(d,t,A,w){return w.wf(d,t,A),w}static Zero(){return new i(0,0,0)}static One(){return new i(1,1,1)}static Up(){return new i(0,1,0)}static get UpReadOnly(){return i._UpReadOnly}static get DownReadOnly(){return i._DownReadOnly}static get RightReadOnly(){return i._RightReadOnly}static get LeftReadOnly(){return i._LeftReadOnly}static get LeftHandedForwardReadOnly(){return i._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return i._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return i._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return i._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return i._ZeroReadOnly}static get OneReadOnly(){return i._OneReadOnly}static Down(){return new i(0,-1,0)}static Forward(){return new i(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new i(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new i(1,0,0)}static Left(){return new i(-1,0,0)}static Random(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new i((0,W.t)(d,t),(0,W.t)(d,t),(0,W.t)(d,t))}static RandomToRef(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).wf((0,W.t)(d,t),(0,W.t)(d,t),(0,W.t)(d,t))}static TransformCoordinates(d,t){const A=i.Zero();return i.TransformCoordinatesToRef(d,t,A),A}static TransformCoordinatesToRef(d,t,A){return i.TransformCoordinatesFromFloatsToRef(d._x,d._y,d._z,t,A),A}static TransformCoordinatesFromFloatsToRef(d,t,A,w,N){const p=w.m,B=d*p[0]+t*p[4]+A*p[8]+p[12],X=d*p[1]+t*p[5]+A*p[9]+p[13],W=d*p[2]+t*p[6]+A*p[10]+p[14],a=1/(d*p[3]+t*p[7]+A*p[11]+p[15]);return N._x=B*a,N._y=X*a,N._z=W*a,N._isDirty=!0,N}static TransformNormal(d,t){const A=i.Zero();return i.TransformNormalToRef(d,t,A),A}static TransformNormalToRef(d,t,A){return this.TransformNormalFromFloatsToRef(d._x,d._y,d._z,t,A),A}static TransformNormalFromFloatsToRef(d,t,A,w,N){const p=w.m;return N._x=d*p[0]+t*p[4]+A*p[8],N._y=d*p[1]+t*p[5]+A*p[9],N._z=d*p[2]+t*p[6]+A*p[10],N._isDirty=!0,N}static CatmullRom(d,t,A,w,N){const p=N*N,B=N*p,X=.5*(2*t._x+(-d._x+A._x)*N+(2*d._x-5*t._x+4*A._x-w._x)*p+(-d._x+3*t._x-3*A._x+w._x)*B),W=.5*(2*t._y+(-d._y+A._y)*N+(2*d._y-5*t._y+4*A._y-w._y)*p+(-d._y+3*t._y-3*A._y+w._y)*B),a=.5*(2*t._z+(-d._z+A._z)*N+(2*d._z-5*t._z+4*A._z-w._z)*p+(-d._z+3*t._z-3*A._z+w._z)*B);return new i(X,W,a)}static Clamp(d,t,A){const w=new i;return i.ClampToRef(d,t,A,w),w}static ClampToRef(d,t,A,w){let N=d._x;N=N>A._x?A._x:N,N=N<t._x?t._x:N;let p=d._y;p=p>A._y?A._y:p,p=p<t._y?t._y:p;let B=d._z;return B=B>A._z?A._z:B,B=B<t._z?t._z:B,w.wf(N,p,B),w}static CheckExtends(d,t,A){t.minimizeInPlace(d),A.maximizeInPlace(d)}static Hermite(d,t,A,w,N){const p=N*N,B=N*p,X=2*B-3*p+1,W=-2*B+3*p,a=B-2*p+N,D=B-p,k=d._x*X+A._x*W+t._x*a+w._x*D,b=d._y*X+A._y*W+t._y*a+w._y*D,Q=d._z*X+A._z*W+t._z*a+w._z*D;return new i(k,b,Q)}static Hermite1stDerivative(d,t,A,w,N){const p=new i;return this.Hermite1stDerivativeToRef(d,t,A,w,N,p),p}static Hermite1stDerivativeToRef(d,t,A,w,N,p){const B=N*N;return p._x=6*(B-N)*d._x+(3*B-4*N+1)*t._x+6*(-B+N)*A._x+(3*B-2*N)*w._x,p._y=6*(B-N)*d._y+(3*B-4*N+1)*t._y+6*(-B+N)*A._y+(3*B-2*N)*w._y,p._z=6*(B-N)*d._z+(3*B-4*N+1)*t._z+6*(-B+N)*A._z+(3*B-2*N)*w._z,p._isDirty=!0,p}static Lerp(d,t,A){const w=new i(0,0,0);return i.LerpToRef(d,t,A,w),w}static LerpToRef(d,t,A,w){return w._x=d._x+(t._x-d._x)*A,w._y=d._y+(t._y-d._y)*A,w._z=d._z+(t._z-d._z)*A,w._isDirty=!0,w}static Dot(d,t){return d._x*t._x+d._y*t._y+d._z*t._z}dot(d){return this._x*d._x+this._y*d._y+this._z*d._z}static Cross(d,t){const A=new i;return i.CrossToRef(d,t,A),A}static CrossToRef(d,t,A){const w=d._y*t._z-d._z*t._y,N=d._z*t._x-d._x*t._z,p=d._x*t._y-d._y*t._x;return A.wf(w,N,p),A}static Normalize(d){const t=i.Zero();return i.NormalizeToRef(d,t),t}static NormalizeToRef(d,t){return d.normalizeToRef(t),t}static Project(d,t,A,w){const N=new i;return i.ProjectToRef(d,t,A,w,N),N}static ProjectToRef(d,t,A,w,N){var p;const B=w.width,W=w.height,a=w.x,D=w.y,k=P.Matrix[1],b=null===(p=X.e.LastCreatedEngine)||void 0===p?void 0:p.isNDCHalfZRange,J=b?1:.5,U=b?0:.5;Q.FromValuesToRef(B/2,0,0,0,0,-W/2,0,0,0,0,J,0,a+B/2,W/2+D,U,1,k);const T=P.Matrix[0];return t.multiplyToRef(A,T),T.multiplyToRef(k,T),i.TransformCoordinatesToRef(d,T,N),N}static Reflect(d,t){return this.ReflectToRef(d,t,new i)}static ReflectToRef(d,t,A){const w=J.gb[0];return w.p(t).scaleInPlace(2*i.Dot(d,t)),A.p(d).ni(w)}static _UnprojectFromInvertedMatrixToRef(d,t,A){i.TransformCoordinatesToRef(d,t,A);const w=t.m,N=d._x*w[3]+d._y*w[7]+d._z*w[11]+w[15];return(0,W.z)(N,1)&&A.scaleInPlace(1/N),A}static UnprojectFromTransform(d,t,A,w,N){return this.Unproject(d,t,A,w,N,Q.IdentityReadOnly)}static Unproject(d,t,A,w,N,p){const B=new i;return i.UnprojectToRef(d,t,A,w,N,p,B),B}static UnprojectToRef(d,t,A,w,N,p,B){return i.UnprojectFloatsToRef(d._x,d._y,d._z,t,A,w,N,p,B),B}static UnprojectFloatsToRef(d,t,A,w,N,p,B,W,a){var D;const k=P.Matrix[0];p.multiplyToRef(B,k),k.multiplyToRef(W,k),k.invert();const b=P.gb[0];return b.x=d/w*2-1,b.y=-(t/N*2-1),null!==(D=X.e.LastCreatedEngine)&&void 0!==D&&D.isNDCHalfZRange?b.z=A:b.z=2*A-1,i._UnprojectFromInvertedMatrixToRef(b,k,a),a}static Minimize(d,t){const A=new i;return A.p(d),A.minimizeInPlace(t),A}static Maximize(d,t){const A=new i;return A.p(d),A.maximizeInPlace(t),A}static Distance(d,t){return Math.sqrt(i.DistanceSquared(d,t))}static DistanceSquared(d,t){const A=d._x-t._x,w=d._y-t._y,N=d._z-t._z;return A*A+w*w+N*N}static ProjectOnTriangleToRef(d,t,A,N,p){const B=P.gb[0],X=P.gb[1],a=P.gb[2],D=P.gb[3],k=P.gb[4];A.subtractToRef(t,B),N.subtractToRef(t,X),N.subtractToRef(A,a);const b=B.length(),Q=X.length(),J=a.length();if(b<w.b||Q<w.b||J<w.b)return p.p(t),i.Distance(d,t);d.subtractToRef(t,k),i.CrossToRef(B,X,D);const U=D.length();if(U<w.b)return p.p(t),i.Distance(d,t);D.normalizeFromLength(U);let T=k.length();if(T<w.b)return p.p(t),0;k.normalizeFromLength(T);const F=i.Dot(D,k),q=P.gb[5],H=P.gb[6];q.p(D).scaleInPlace(-T*F),H.p(d).addInPlace(q);const f=P.gb[4],v=P.gb[5],m=P.gb[7],j=P.gb[8];f.p(B).scaleInPlace(1/b),j.p(X).scaleInPlace(1/Q),f.addInPlace(j).scaleInPlace(-1),v.p(B).scaleInPlace(-1/b),j.p(a).scaleInPlace(1/J),v.addInPlace(j).scaleInPlace(-1),m.p(a).scaleInPlace(-1/J),j.p(X).scaleInPlace(-1/Q),m.addInPlace(j).scaleInPlace(-1);const n=P.gb[9];let R;n.p(H).ni(t),i.CrossToRef(f,n,j),R=i.Dot(j,D);const Z=R;n.p(H).ni(A),i.CrossToRef(v,n,j),R=i.Dot(j,D);const L=R;n.p(H).ni(N),i.CrossToRef(m,n,j),R=i.Dot(j,D);const I=R,u=P.gb[10];let V,h;Z>0&&L<0?(u.p(B),V=t,h=A):L>0&&I<0?(u.p(a),V=A,h=N):(u.p(X).scaleInPlace(-1),V=N,h=t);const l=P.gb[9],y=P.gb[4];V.subtractToRef(H,j),h.subtractToRef(H,l),i.CrossToRef(j,l,y);if(!(i.Dot(y,D)<0))return p.p(H),Math.abs(T*F);const s=P.gb[5];i.CrossToRef(u,y,s),s.normalize();const Y=P.gb[9];Y.p(V).ni(H);const r=Y.length();if(r<w.b)return p.p(V),i.Distance(d,V);Y.normalizeFromLength(r);const K=i.Dot(s,Y),G=P.gb[7];G.p(H).addInPlace(s.scaleInPlace(r*K)),j.p(G).ni(V),T=u.length(),u.normalizeFromLength(T);let O=i.Dot(j,u)/Math.max(T,w.b);return O=(0,W.e)(O,0,1),G.p(V).addInPlace(u.scaleInPlace(O*T)),p.p(G),i.Distance(d,G)}static Center(d,t){return i.CenterToRef(d,t,i.Zero())}static CenterToRef(d,t,A){return A.wf((d._x+t._x)/2,(d._y+t._y)/2,(d._z+t._z)/2)}static RotationFromAxis(d,t,A){const w=new i;return i.RotationFromAxisToRef(d,t,A,w),w}static RotationFromAxisToRef(d,t,A,w){const N=P.Quaternion[0];return b.RotationQuaternionFromAxisToRef(d,t,A,N),N.toEulerAnglesToRef(w),w}}i._UpReadOnly=i.Up(),i._DownReadOnly=i.Down(),i._LeftHandedForwardReadOnly=i.Forward(!1),i._RightHandedForwardReadOnly=i.Forward(!0),i._LeftHandedBackwardReadOnly=i.Backward(!1),i._RightHandedBackwardReadOnly=i.Backward(!0),i._RightReadOnly=i.Right(),i._LeftReadOnly=i.Left(),i._ZeroReadOnly=i.Zero(),i._OneReadOnly=i.One(),Object.defineProperties(i.prototype,{dimension:{value:[3]},rank:{value:1}});class k{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=d,this.y=t,this.z=A,this.w=w}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let d=a(this.x);return d=397*d^a(this.y),d=397*d^a(this.z),d=397*d^a(this.w),d}gj(){return[this.x,this.y,this.z,this.w]}toArray(d,t){return void 0===t&&(t=0),d[t]=this.x,d[t+1]=this.y,d[t+2]=this.z,d[t+3]=this.w,this}Xc(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return k.FromArrayToRef(d,t,this),this}addInPlace(d){return this.x+=d.x,this.y+=d.y,this.z+=d.z,this.w+=d.w,this}addInPlaceFromFloats(d,t,A,w){return this.x+=d,this.y+=t,this.z+=A,this.w+=w,this}add(d){return new k(this.x+d.x,this.y+d.y,this.z+d.z,this.w+d.w)}addToRef(d,t){return t.x=this.x+d.x,t.y=this.y+d.y,t.z=this.z+d.z,t.w=this.w+d.w,t}ni(d){return this.x-=d.x,this.y-=d.y,this.z-=d.z,this.w-=d.w,this}Uc(d){return new k(this.x-d.x,this.y-d.y,this.z-d.z,this.w-d.w)}subtractToRef(d,t){return t.x=this.x-d.x,t.y=this.y-d.y,t.z=this.z-d.z,t.w=this.w-d.w,t}subtractFromFloats(d,t,A,w){return new k(this.x-d,this.y-t,this.z-A,this.w-w)}subtractFromFloatsToRef(d,t,A,w,N){return N.x=this.x-d,N.y=this.y-t,N.z=this.z-A,N.w=this.w-w,N}negate(){return new k(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(d){return d.x=-this.x,d.y=-this.y,d.z=-this.z,d.w=-this.w,d}scaleInPlace(d){return this.x*=d,this.y*=d,this.z*=d,this.w*=d,this}scale(d){return new k(this.x*d,this.y*d,this.z*d,this.w*d)}scaleToRef(d,t){return t.x=this.x*d,t.y=this.y*d,t.z=this.z*d,t.w=this.w*d,t}scaleAndAddToRef(d,t){return t.x+=this.x*d,t.y+=this.y*d,t.z+=this.z*d,t.w+=this.w*d,t}equals(d){return d&&this.x===d.x&&this.y===d.y&&this.z===d.z&&this.w===d.w}equalsWithEpsilon(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.b;return d&&(0,W.z)(this.x,d.x,t)&&(0,W.z)(this.y,d.y,t)&&(0,W.z)(this.z,d.z,t)&&(0,W.z)(this.w,d.w,t)}equalsToFloats(d,t,A,w){return this.x===d&&this.y===t&&this.z===A&&this.w===w}multiplyInPlace(d){return this.x*=d.x,this.y*=d.y,this.z*=d.z,this.w*=d.w,this}multiply(d){return new k(this.x*d.x,this.y*d.y,this.z*d.z,this.w*d.w)}multiplyToRef(d,t){return t.x=this.x*d.x,t.y=this.y*d.y,t.z=this.z*d.z,t.w=this.w*d.w,t}multiplyByFloats(d,t,A,w){return new k(this.x*d,this.y*t,this.z*A,this.w*w)}divide(d){return new k(this.x/d.x,this.y/d.y,this.z/d.z,this.w/d.w)}divideToRef(d,t){return t.x=this.x/d.x,t.y=this.y/d.y,t.z=this.z/d.z,t.w=this.w/d.w,t}divideInPlace(d){return this.divideToRef(d,this)}minimizeInPlace(d){return d.x<this.x&&(this.x=d.x),d.y<this.y&&(this.y=d.y),d.z<this.z&&(this.z=d.z),d.w<this.w&&(this.w=d.w),this}maximizeInPlace(d){return d.x>this.x&&(this.x=d.x),d.y>this.y&&(this.y=d.y),d.z>this.z&&(this.z=d.z),d.w>this.w&&(this.w=d.w),this}minimizeInPlaceFromFloats(d,t,A,w){return this.x=Math.min(d,this.x),this.y=Math.min(t,this.y),this.z=Math.min(A,this.z),this.w=Math.min(w,this.w),this}maximizeInPlaceFromFloats(d,t,A,w){return this.x=Math.max(d,this.x),this.y=Math.max(t,this.y),this.z=Math.max(A,this.z),this.w=Math.max(w,this.w),this}floorToRef(d){return d.x=Math.floor(this.x),d.y=Math.floor(this.y),d.z=Math.floor(this.z),d.w=Math.floor(this.w),d}floor(){return new k(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(d){return d.x=this.x-Math.floor(this.x),d.y=this.y-Math.floor(this.y),d.z=this.z-Math.floor(this.z),d.w=this.w-Math.floor(this.w),d}fract(){return new k(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(d){return 0===d||1===d?this:this.scaleInPlace(1/d)}normalizeToNew(){return this.normalizeToRef(new k)}normalizeToRef(d){const t=this.length();return 0===t||1===t?(d.x=this.x,d.y=this.y,d.z=this.z,d.w=this.w,d):this.scaleToRef(1/t,d)}toVector3(){return new i(this.x,this.y,this.z)}clone(){return new k(this.x,this.y,this.z,this.w)}p(d){return this.x=d.x,this.y=d.y,this.z=d.z,this.w=d.w,this}wf(d,t,A,w){return this.x=d,this.y=t,this.z=A,this.w=w,this}set(d,t,A,w){return this.wf(d,t,A,w)}Dj(d){return this.x=this.y=this.z=this.w=d,this}dot(d){return this.x*d.x+this.y*d.y+this.z*d.z+this.w*d.w}static Lg(d,t){return t||(t=0),new k(d[t],d[t+1],d[t+2],d[t+3])}static FromArrayToRef(d,t,A){return A.x=d[t],A.y=d[t+1],A.z=d[t+2],A.w=d[t+3],A}static FromFloatArrayToRef(d,t,A){return k.FromArrayToRef(d,t,A),A}static FromFloatsToRef(d,t,A,w,N){return N.x=d,N.y=t,N.z=A,N.w=w,N}static Zero(){return new k(0,0,0,0)}static One(){return new k(1,1,1,1)}static Random(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new k((0,W.t)(d,t),(0,W.t)(d,t),(0,W.t)(d,t),(0,W.t)(d,t))}static RandomToRef(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2?arguments[2]:void 0;return A.x=(0,W.t)(d,t),A.y=(0,W.t)(d,t),A.z=(0,W.t)(d,t),A.w=(0,W.t)(d,t),A}static Clamp(d,t,A){return k.ClampToRef(d,t,A,new k)}static ClampToRef(d,t,A,w){return w.x=(0,W.e)(d.x,t.x,A.x),w.y=(0,W.e)(d.y,t.y,A.y),w.z=(0,W.e)(d.z,t.z,A.z),w.w=(0,W.e)(d.w,t.w,A.w),w}static CheckExtends(d,t,A){t.minimizeInPlace(d),A.maximizeInPlace(d)}static get ZeroReadOnly(){return k._ZeroReadOnly}static Normalize(d){return k.NormalizeToRef(d,new k)}static NormalizeToRef(d,t){return d.normalizeToRef(t),t}static Minimize(d,t){const A=new k;return A.p(d),A.minimizeInPlace(t),A}static Maximize(d,t){const A=new k;return A.p(d),A.maximizeInPlace(t),A}static Distance(d,t){return Math.sqrt(k.DistanceSquared(d,t))}static DistanceSquared(d,t){const A=d.x-t.x,w=d.y-t.y,N=d.z-t.z,p=d.w-t.w;return A*A+w*w+N*N+p*p}static Center(d,t){return k.CenterToRef(d,t,new k)}static CenterToRef(d,t,A){return A.x=(d.x+t.x)/2,A.y=(d.y+t.y)/2,A.z=(d.z+t.z)/2,A.w=(d.w+t.w)/2,A}static TransformCoordinates(d,t){return k.TransformCoordinatesToRef(d,t,new k)}static TransformCoordinatesToRef(d,t,A){return k.TransformCoordinatesFromFloatsToRef(d._x,d._y,d._z,t,A),A}static TransformCoordinatesFromFloatsToRef(d,t,A,w,N){const p=w.m,B=d*p[0]+t*p[4]+A*p[8]+p[12],X=d*p[1]+t*p[5]+A*p[9]+p[13],W=d*p[2]+t*p[6]+A*p[10]+p[14],a=d*p[3]+t*p[7]+A*p[11]+p[15];return N.x=B,N.y=X,N.z=W,N.w=a,N}static TransformNormal(d,t){return k.TransformNormalToRef(d,t,new k)}static TransformNormalToRef(d,t,A){const w=t.m,N=d.x*w[0]+d.y*w[4]+d.z*w[8],p=d.x*w[1]+d.y*w[5]+d.z*w[9],B=d.x*w[2]+d.y*w[6]+d.z*w[10];return A.x=N,A.y=p,A.z=B,A.w=d.w,A}static TransformNormalFromFloatsToRef(d,t,A,w,N,p){const B=N.m;return p.x=d*B[0]+t*B[4]+A*B[8],p.y=d*B[1]+t*B[5]+A*B[9],p.z=d*B[2]+t*B[6]+A*B[10],p.w=w,p}static FromVector3(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new k(d._x,d._y,d._z,t)}static Dot(d,t){return d.x*t.x+d.y*t.y+d.z*t.z+d.w*t.w}}k._ZeroReadOnly=k.Zero(),Object.defineProperties(k.prototype,{dimension:{value:[4]},rank:{value:1}});class b{get x(){return this._x}set x(d){this._x=d,this._isDirty=!0}get y(){return this._y}set y(d){this._y=d,this._isDirty=!0}get z(){return this._z}set z(d){this._z=d,this._isDirty=!0}get w(){return this._w}set w(d){this._w=d,this._isDirty=!0}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=d,this._y=t,this._z=A,this._w=w}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let d=a(this._x);return d=397*d^a(this._y),d=397*d^a(this._z),d=397*d^a(this._w),d}gj(){return[this._x,this._y,this._z,this._w]}toArray(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return d[t]=this._x,d[t+1]=this._y,d[t+2]=this._z,d[t+3]=this._w,this}Xc(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return b.FromArrayToRef(d,t,this)}equals(d){return d&&this._x===d._x&&this._y===d._y&&this._z===d._z&&this._w===d._w}equalsWithEpsilon(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.b;return d&&(0,W.z)(this._x,d._x,t)&&(0,W.z)(this._y,d._y,t)&&(0,W.z)(this._z,d._z,t)&&(0,W.z)(this._w,d._w,t)}clone(){return new b(this._x,this._y,this._z,this._w)}p(d){return this._x=d._x,this._y=d._y,this._z=d._z,this._w=d._w,this._isDirty=!0,this}wf(d,t,A,w){return this._x=d,this._y=t,this._z=A,this._w=w,this._isDirty=!0,this}set(d,t,A,w){return this.wf(d,t,A,w)}Dj(d){return this.wf(d,d,d,d)}add(d){return new b(this._x+d._x,this._y+d._y,this._z+d._z,this._w+d._w)}addInPlace(d){return this._x+=d._x,this._y+=d._y,this._z+=d._z,this._w+=d._w,this._isDirty=!0,this}addToRef(d,t){return t._x=this._x+d._x,t._y=this._y+d._y,t._z=this._z+d._z,t._w=this._w+d._w,t._isDirty=!0,t}addInPlaceFromFloats(d,t,A,w){return this._x+=d,this._y+=t,this._z+=A,this._w+=w,this._isDirty=!0,this}subtractToRef(d,t){return t._x=this._x-d._x,t._y=this._y-d._y,t._z=this._z-d._z,t._w=this._w-d._w,t._isDirty=!0,t}subtractFromFloats(d,t,A,w){return this.subtractFromFloatsToRef(d,t,A,w,new b)}subtractFromFloatsToRef(d,t,A,w,N){return N._x=this._x-d,N._y=this._y-t,N._z=this._z-A,N._w=this._w-w,N._isDirty=!0,N}Uc(d){return new b(this._x-d._x,this._y-d._y,this._z-d._z,this._w-d._w)}ni(d){return this._x-=d._x,this._y-=d._y,this._z-=d._z,this._w-=d._w,this._isDirty=!0,this}scale(d){return new b(this._x*d,this._y*d,this._z*d,this._w*d)}scaleToRef(d,t){return t._x=this._x*d,t._y=this._y*d,t._z=this._z*d,t._w=this._w*d,t._isDirty=!0,t}scaleInPlace(d){return this._x*=d,this._y*=d,this._z*=d,this._w*=d,this._isDirty=!0,this}scaleAndAddToRef(d,t){return t._x+=this._x*d,t._y+=this._y*d,t._z+=this._z*d,t._w+=this._w*d,t._isDirty=!0,t}multiply(d){const t=new b(0,0,0,1);return this.multiplyToRef(d,t),t}multiplyToRef(d,t){const A=this._x*d._w+this._y*d._z-this._z*d._y+this._w*d._x,w=-this._x*d._z+this._y*d._w+this._z*d._x+this._w*d._y,N=this._x*d._y-this._y*d._x+this._z*d._w+this._w*d._z,p=-this._x*d._x-this._y*d._y-this._z*d._z+this._w*d._w;return t.wf(A,w,N,p),t}multiplyInPlace(d){return this.multiplyToRef(d,this)}multiplyByFloats(d,t,A,w){return this._x*=d,this._y*=t,this._z*=A,this._w*=w,this._isDirty=!0,this}divide(d){throw new ReferenceError("Can not divide a quaternion")}divideToRef(d,t){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(d){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new b)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(d){return d._x=-this._x,d._y=-this._y,d._z=-this._z,d._w=-this._w,d._isDirty=!0,d}equalsToFloats(d,t,A,w){return this._x===d&&this._y===t&&this._z===A&&this._w===w}floorToRef(d){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(d){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(d){return d.wf(-this._x,-this._y,-this._z,this._w),d}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new b(-this._x,-this._y,-this._z,this._w)}invert(){const d=this.conjugate(),t=this.lengthSquared();return 0==t||1==t||d.scaleInPlace(1/t),d}invertInPlace(){this.conjugateInPlace();const d=this.lengthSquared();return 0==d||1==d||this.scaleInPlace(1/d),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(d){return 0===d||1===d?this:this.scaleInPlace(1/d)}normalizeToNew(){const d=new b(0,0,0,1);return this.normalizeToRef(d),d}normalizeToRef(d){const t=this.length();return 0===t||1===t?d.wf(this._x,this._y,this._z,this._w):this.scaleToRef(1/t,d)}toEulerAngles(){const d=i.Zero();return this.toEulerAnglesToRef(d),d}toEulerAnglesToRef(d){const t=this._z,A=this._x,w=this._y,N=this._w,p=w*t-A*N,B=.4999999;if(p<-B)d._y=2*Math.atan2(w,N),d._x=Math.PI/2,d._z=0,d._isDirty=!0;else if(p>B)d._y=2*Math.atan2(w,N),d._x=-Math.PI/2,d._z=0,d._isDirty=!0;else{const B=N*N,X=t*t,W=A*A,a=w*w;d._z=Math.atan2(2*(A*w+t*N),-X-W+a+B),d._x=Math.asin(-2*p),d._y=Math.atan2(2*(t*A+w*N),X-W-a+B),d._isDirty=!0}return d}toAlphaBetaGammaToRef(d){const t=this._z,A=this._x,w=this._y,N=this._w,p=Math.sqrt(A*A+w*w),B=Math.sqrt(t*t+N*N),X=2*Math.atan2(p,B),W=2*Math.atan2(t,N),a=2*Math.atan2(w,A),D=(W+a)/2,i=(W-a)/2;return d.set(i,X,D),d}toRotationMatrix(d){return Q.FromQuaternionToRef(this,d),d}fromRotationMatrix(d){return b.FromRotationMatrixToRef(d,this),this}dot(d){return this._x*d._x+this._y*d._y+this._z*d._z+this._w*d._w}static FromRotationMatrix(d){const t=new b;return b.FromRotationMatrixToRef(d,t),t}static FromRotationMatrixToRef(d,t){const A=d.m,w=A[0],N=A[4],p=A[8],B=A[1],X=A[5],W=A[9],a=A[2],D=A[6],i=A[10],k=w+X+i;let b;return k>0?(b=.5/Math.sqrt(k+1),t._w=.25/b,t._x=(D-W)*b,t._y=(p-a)*b,t._z=(B-N)*b,t._isDirty=!0):w>X&&w>i?(b=2*Math.sqrt(1+w-X-i),t._w=(D-W)/b,t._x=.25*b,t._y=(N+B)/b,t._z=(p+a)/b,t._isDirty=!0):X>i?(b=2*Math.sqrt(1+X-w-i),t._w=(p-a)/b,t._x=(N+B)/b,t._y=.25*b,t._z=(W+D)/b,t._isDirty=!0):(b=2*Math.sqrt(1+i-w-X),t._w=(B-N)/b,t._x=(p+a)/b,t._y=(W+D)/b,t._z=.25*b,t._isDirty=!0),t}static Dot(d,t){return d._x*t._x+d._y*t._y+d._z*t._z+d._w*t._w}static AreClose(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const w=b.Dot(d,t);return 1-w*w<=A}static SmoothToRef(d,t,A,w,N){let p=0===w?1:A/w;return p=(0,W.e)(p,0,1),b.SlerpToRef(d,t,p,N),N}static Zero(){return new b(0,0,0,0)}static Inverse(d){return new b(-d._x,-d._y,-d._z,d._w)}static InverseToRef(d,t){return t.set(-d._x,-d._y,-d._z,d._w),t}static Identity(){return new b(0,0,0,1)}static IsIdentity(d){return d&&0===d._x&&0===d._y&&0===d._z&&1===d._w}static RotationAxis(d,t){return b.RotationAxisToRef(d,t,new b)}static RotationAxisToRef(d,t,A){A._w=Math.cos(t/2);const w=Math.sin(t/2)/d.length();return A._x=d._x*w,A._y=d._y*w,A._z=d._z*w,A._isDirty=!0,A}static Lg(d,t){return t||(t=0),new b(d[t],d[t+1],d[t+2],d[t+3])}static FromArrayToRef(d,t,A){return A._x=d[t],A._y=d[t+1],A._z=d[t+2],A._w=d[t+3],A._isDirty=!0,A}static FromFloatsToRef(d,t,A,w,N){return N.wf(d,t,A,w),N}static FromEulerAngles(d,t,A){const w=new b;return b.RotationYawPitchRollToRef(t,d,A,w),w}static FromEulerAnglesToRef(d,t,A,w){return b.RotationYawPitchRollToRef(t,d,A,w),w}static FromEulerVector(d){const t=new b;return b.RotationYawPitchRollToRef(d._y,d._x,d._z,t),t}static FromEulerVectorToRef(d,t){return b.RotationYawPitchRollToRef(d._y,d._x,d._z,t),t}static FromUnitVectorsToRef(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:w.b;const p=i.Dot(d,t)+1;return p<N?Math.abs(d.x)>Math.abs(d.z)?A.set(-d.y,d.x,0,0):A.set(0,-d.z,d.y,0):(i.CrossToRef(d,t,J.gb[0]),A.set(J.gb[0].x,J.gb[0].y,J.gb[0].z,p)),A.normalize()}static RotationYawPitchRoll(d,t,A){const w=new b;return b.RotationYawPitchRollToRef(d,t,A,w),w}static RotationYawPitchRollToRef(d,t,A,w){const N=.5*A,p=.5*t,B=.5*d,X=Math.sin(N),W=Math.cos(N),a=Math.sin(p),D=Math.cos(p),i=Math.sin(B),k=Math.cos(B);return w._x=k*a*W+i*D*X,w._y=i*D*W-k*a*X,w._z=k*D*X-i*a*W,w._w=k*D*W+i*a*X,w._isDirty=!0,w}static RotationAlphaBetaGamma(d,t,A){const w=new b;return b.RotationAlphaBetaGammaToRef(d,t,A,w),w}static RotationAlphaBetaGammaToRef(d,t,A,w){const N=.5*(A+d),p=.5*(A-d),B=.5*t;return w._x=Math.cos(p)*Math.sin(B),w._y=Math.sin(p)*Math.sin(B),w._z=Math.sin(N)*Math.cos(B),w._w=Math.cos(N)*Math.cos(B),w._isDirty=!0,w}static RotationQuaternionFromAxis(d,t,A){const w=new b(0,0,0,0);return b.RotationQuaternionFromAxisToRef(d,t,A,w),w}static RotationQuaternionFromAxisToRef(d,t,A,w){const N=P.Matrix[0];return d=d.normalizeToRef(P.gb[0]),t=t.normalizeToRef(P.gb[1]),A=A.normalizeToRef(P.gb[2]),Q.FromXYZAxesToRef(d,t,A,N),b.FromRotationMatrixToRef(N,w),w}static FromLookDirectionLH(d,t){const A=new b;return b.FromLookDirectionLHToRef(d,t,A),A}static FromLookDirectionLHToRef(d,t,A){const w=P.Matrix[0];return Q.LookDirectionLHToRef(d,t,w),b.FromRotationMatrixToRef(w,A),A}static FromLookDirectionRH(d,t){const A=new b;return b.FromLookDirectionRHToRef(d,t,A),A}static FromLookDirectionRHToRef(d,t,A){const w=P.Matrix[0];return Q.LookDirectionRHToRef(d,t,w),b.FromRotationMatrixToRef(w,A)}static Slerp(d,t,A){const w=b.Identity();return b.SlerpToRef(d,t,A,w),w}static SlerpToRef(d,t,A,w){let N,p,B=d._x*t._x+d._y*t._y+d._z*t._z+d._w*t._w,X=!1;if(B<0&&(X=!0,B=-B),B>.999999)p=1-A,N=X?-A:A;else{const d=Math.acos(B),t=1/Math.sin(d);p=Math.sin((1-A)*d)*t,N=X?-Math.sin(A*d)*t:Math.sin(A*d)*t}return w._x=p*d._x+N*t._x,w._y=p*d._y+N*t._y,w._z=p*d._z+N*t._z,w._w=p*d._w+N*t._w,w._isDirty=!0,w}static Hermite(d,t,A,w,N){const p=N*N,B=N*p,X=2*B-3*p+1,W=-2*B+3*p,a=B-2*p+N,D=B-p,i=d._x*X+A._x*W+t._x*a+w._x*D,k=d._y*X+A._y*W+t._y*a+w._y*D,Q=d._z*X+A._z*W+t._z*a+w._z*D,P=d._w*X+A._w*W+t._w*a+w._w*D;return new b(i,k,Q,P)}static Hermite1stDerivative(d,t,A,w,N){const p=new b;return this.Hermite1stDerivativeToRef(d,t,A,w,N,p),p}static Hermite1stDerivativeToRef(d,t,A,w,N,p){const B=N*N;return p._x=6*(B-N)*d._x+(3*B-4*N+1)*t._x+6*(-B+N)*A._x+(3*B-2*N)*w._x,p._y=6*(B-N)*d._y+(3*B-4*N+1)*t._y+6*(-B+N)*A._y+(3*B-2*N)*w._y,p._z=6*(B-N)*d._z+(3*B-4*N+1)*t._z+6*(-B+N)*A._z+(3*B-2*N)*w._z,p._w=6*(B-N)*d._w+(3*B-4*N+1)*t._w+6*(-B+N)*A._w+(3*B-2*N)*w._w,p._isDirty=!0,p}static Normalize(d){const t=b.Zero();return b.NormalizeToRef(d,t),t}static NormalizeToRef(d,t){return d.normalizeToRef(t),t}static Clamp(d,t,A){const w=new b;return b.ClampToRef(d,t,A,w),w}static ClampToRef(d,t,A,w){return w.wf((0,W.e)(d.x,t.x,A.x),(0,W.e)(d.y,t.y,A.y),(0,W.e)(d.z,t.z,A.z),(0,W.e)(d.w,t.w,A.w))}static Random(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new b((0,W.t)(d,t),(0,W.t)(d,t),(0,W.t)(d,t),(0,W.t)(d,t))}static RandomToRef(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).wf((0,W.t)(d,t),(0,W.t)(d,t),(0,W.t)(d,t),(0,W.t)(d,t))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(d,t){return Math.sqrt(b.DistanceSquared(d,t))}static DistanceSquared(d,t){const A=d.x-t.x,w=d.y-t.y,N=d.z-t.z,p=d.w-t.w;return A*A+w*w+N*N+p*p}static Center(d,t){return b.CenterToRef(d,t,b.Zero())}static CenterToRef(d,t,A){return A.wf((d.x+t.x)/2,(d.y+t.y)/2,(d.z+t.z)/2,(d.w+t.w)/2)}}Object.defineProperties(b.prototype,{dimension:{value:[4]},rank:{value:1}});class Q{static get Use64Bits(){return B.c.MatrixUse64Bits}get m(){return this.Oj}markAsUpdated(){this.updateFlag=Q._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=d,this._isIdentity3x2=d||A,this._isIdentityDirty=!this._isIdentity&&t,this._isIdentity3x2Dirty=!this._isIdentity3x2&&w}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,B.c.MatrixTrackPrecisionChange&&B.c.MatrixTrackedMatrices.push(this),this.Oj=new B.c.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const d=this.Oj;this._isIdentity=1===d[0]&&0===d[1]&&0===d[2]&&0===d[3]&&0===d[4]&&1===d[5]&&0===d[6]&&0===d[7]&&0===d[8]&&0===d[9]&&1===d[10]&&0===d[11]&&0===d[12]&&0===d[13]&&0===d[14]&&1===d[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.Oj[0]||1!==this.Oj[5]||1!==this.Oj[15]||0!==this.Oj[1]||0!==this.Oj[2]||0!==this.Oj[3]||0!==this.Oj[4]||0!==this.Oj[6]||0!==this.Oj[7]||0!==this.Oj[8]||0!==this.Oj[9]||0!==this.Oj[10]||0!==this.Oj[11]||0!==this.Oj[12]||0!==this.Oj[13]||0!==this.Oj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const d=this.Oj,t=d[0],A=d[1],w=d[2],N=d[3],p=d[4],B=d[5],X=d[6],W=d[7],a=d[8],D=d[9],i=d[10],k=d[11],b=d[12],Q=d[13],P=d[14],J=d[15],U=i*J-P*k,T=D*J-Q*k,F=D*P-Q*i,q=a*J-b*k,H=a*P-i*b,f=a*Q-b*D;return t*+(B*U-X*T+W*F)+A*-(p*U-X*q+W*H)+w*+(p*T-B*q+W*f)+N*-(p*F-B*H+X*f)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!d)return this.Oj;const A=this.Oj;for(let w=0;w<16;w++)d[t+w]=A[w];return this}gj(){return this.Oj}Xc(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Q.FromArrayToRef(d,t,this)}wf(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];return Q.FromArrayToRef(t,0,this)}set(){const d=this.Oj;for(let t=0;t<16;t++)d[t]=t<0||arguments.length<=t?void 0:arguments[t];return this.markAsUpdated(),this}Dj(d){const t=this.Oj;for(let A=0;A<16;A++)t[A]=d;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return Q.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(d){const t=new Q;return this.addToRef(d,t),t}addToRef(d,t){const A=this.Oj,w=t.Oj,N=d.m;for(let p=0;p<16;p++)w[p]=A[p]+N[p];return t.markAsUpdated(),t}addToSelf(d){const t=this.Oj,A=d.m;return t[0]+=A[0],t[1]+=A[1],t[2]+=A[2],t[3]+=A[3],t[4]+=A[4],t[5]+=A[5],t[6]+=A[6],t[7]+=A[7],t[8]+=A[8],t[9]+=A[9],t[10]+=A[10],t[11]+=A[11],t[12]+=A[12],t[13]+=A[13],t[14]+=A[14],t[15]+=A[15],this.markAsUpdated(),this}addInPlace(d){const t=this.Oj,A=d.m;for(let w=0;w<16;w++)t[w]+=A[w];return this.markAsUpdated(),this}addInPlaceFromFloats(){const d=this.Oj;for(let t=0;t<16;t++)d[t]+=t<0||arguments.length<=t?void 0:arguments[t];return this.markAsUpdated(),this}Uc(d){const t=this.Oj,A=d.m;for(let w=0;w<16;w++)t[w]-=A[w];return this.markAsUpdated(),this}subtractToRef(d,t){const A=this.Oj,w=d.m,N=t.Oj;for(let p=0;p<16;p++)N[p]=A[p]-w[p];return t.markAsUpdated(),t}ni(d){const t=this.Oj,A=d.m;for(let w=0;w<16;w++)t[w]-=A[w];return this.markAsUpdated(),this}subtractFromFloats(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];return this.subtractFromFloatsToRef(...t,new Q)}subtractFromFloatsToRef(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];const w=t.pop(),N=this.Oj,p=w.Oj,B=t;for(let X=0;X<16;X++)p[X]=N[X]-B[X];return w.markAsUpdated(),w}invertToRef(d){if(!0===this._isIdentity)return Q.IdentityToRef(d),d;const t=this.Oj,A=t[0],w=t[1],N=t[2],p=t[3],B=t[4],X=t[5],W=t[6],a=t[7],D=t[8],i=t[9],k=t[10],b=t[11],P=t[12],J=t[13],U=t[14],T=t[15],F=k*T-U*b,q=i*T-J*b,H=i*U-J*k,f=D*T-P*b,v=D*U-k*P,m=D*J-P*i,j=+(X*F-W*q+a*H),n=-(B*F-W*f+a*v),R=+(B*q-X*f+a*m),Z=-(B*H-X*v+W*m),L=A*j+w*n+N*R+p*Z;if(0===L)return d.p(this),d;const I=1/L,u=W*T-U*a,V=X*T-J*a,h=X*U-J*W,l=B*T-P*a,y=B*U-P*W,s=B*J-P*X,Y=W*b-k*a,r=X*b-i*a,K=X*k-i*W,G=B*b-D*a,O=B*k-D*W,z=B*i-D*X,c=-(w*F-N*q+p*H),e=+(A*F-N*f+p*v),M=-(A*q-w*f+p*m),x=+(A*H-w*v+N*m),o=+(w*u-N*V+p*h),C=-(A*u-N*l+p*y),E=+(A*V-w*l+p*s),g=-(A*h-w*y+N*s),S=-(w*Y-N*r+p*K),dd=+(A*Y-N*G+p*O),td=-(A*r-w*G+p*z),Ad=+(A*K-w*O+N*z);return Q.FromValuesToRef(j*I,c*I,o*I,S*I,n*I,e*I,C*I,dd*I,R*I,M*I,E*I,td*I,Z*I,x*I,g*I,Ad*I,d),d}addAtIndex(d,t){return this.Oj[d]+=t,this.markAsUpdated(),this}multiplyAtIndex(d,t){return this.Oj[d]*=t,this.markAsUpdated(),this}setTranslationFromFloats(d,t,A){return this.Oj[12]=d,this.Oj[13]=t,this.Oj[14]=A,this.markAsUpdated(),this}addTranslationFromFloats(d,t,A){return this.Oj[12]+=d,this.Oj[13]+=t,this.Oj[14]+=A,this.markAsUpdated(),this}setTranslation(d){return this.setTranslationFromFloats(d._x,d._y,d._z)}getTranslation(){return new i(this.Oj[12],this.Oj[13],this.Oj[14])}getTranslationToRef(d){return d.x=this.Oj[12],d.y=this.Oj[13],d.z=this.Oj[14],d}removeRotationAndScaling(){const d=this.m;return Q.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,d[12],d[13],d[14],d[15],this),this._updateIdentityStatus(0===d[12]&&0===d[13]&&0===d[14]&&1===d[15]),this}p(d){d.copyToArray(this.Oj);const t=d;return this.updateFlag=t.updateFlag,this._updateIdentityStatus(t._isIdentity,t._isIdentityDirty,t._isIdentity3x2,t._isIdentity3x2Dirty),this}copyToArray(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.Oj;return d[t]=A[0],d[t+1]=A[1],d[t+2]=A[2],d[t+3]=A[3],d[t+4]=A[4],d[t+5]=A[5],d[t+6]=A[6],d[t+7]=A[7],d[t+8]=A[8],d[t+9]=A[9],d[t+10]=A[10],d[t+11]=A[11],d[t+12]=A[12],d[t+13]=A[13],d[t+14]=A[14],d[t+15]=A[15],this}multiply(d){const t=new Q;return this.multiplyToRef(d,t),t}multiplyInPlace(d){const t=this.Oj,A=d.m;for(let w=0;w<16;w++)t[w]*=A[w];return this.markAsUpdated(),this}multiplyByFloats(){const d=this.Oj;for(let t=0;t<16;t++)d[t]*=t<0||arguments.length<=t?void 0:arguments[t];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];const w=t.pop(),N=this.Oj,p=w.Oj,B=t;for(let X=0;X<16;X++)p[X]=N[X]*B[X];return w.markAsUpdated(),w}multiplyToRef(d,t){return this._isIdentity?(t.p(d),t):d._isIdentity?(t.p(this),t):(this.multiplyToArray(d,t.Oj,0),t.markAsUpdated(),t)}multiplyToArray(d,t,A){const w=this.Oj,N=d.m,p=w[0],B=w[1],X=w[2],W=w[3],a=w[4],D=w[5],i=w[6],k=w[7],b=w[8],Q=w[9],P=w[10],J=w[11],U=w[12],T=w[13],F=w[14],q=w[15],H=N[0],f=N[1],v=N[2],m=N[3],j=N[4],n=N[5],R=N[6],Z=N[7],L=N[8],I=N[9],u=N[10],V=N[11],h=N[12],l=N[13],y=N[14],s=N[15];return t[A]=p*H+B*j+X*L+W*h,t[A+1]=p*f+B*n+X*I+W*l,t[A+2]=p*v+B*R+X*u+W*y,t[A+3]=p*m+B*Z+X*V+W*s,t[A+4]=a*H+D*j+i*L+k*h,t[A+5]=a*f+D*n+i*I+k*l,t[A+6]=a*v+D*R+i*u+k*y,t[A+7]=a*m+D*Z+i*V+k*s,t[A+8]=b*H+Q*j+P*L+J*h,t[A+9]=b*f+Q*n+P*I+J*l,t[A+10]=b*v+Q*R+P*u+J*y,t[A+11]=b*m+Q*Z+P*V+J*s,t[A+12]=U*H+T*j+F*L+q*h,t[A+13]=U*f+T*n+F*I+q*l,t[A+14]=U*v+T*R+F*u+q*y,t[A+15]=U*m+T*Z+F*V+q*s,this}divide(d){return this.divideToRef(d,new Q)}divideToRef(d,t){const A=this.Oj,w=d.m,N=t.Oj;for(let p=0;p<16;p++)N[p]=A[p]/w[p];return t.markAsUpdated(),t}divideInPlace(d){const t=this.Oj,A=d.m;for(let w=0;w<16;w++)t[w]/=A[w];return this.markAsUpdated(),this}minimizeInPlace(d){const t=this.Oj,A=d.m;for(let w=0;w<16;w++)t[w]=Math.min(t[w],A[w]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const d=this.Oj;for(let t=0;t<16;t++)d[t]=Math.min(d[t],t<0||arguments.length<=t?void 0:arguments[t]);return this.markAsUpdated(),this}maximizeInPlace(d){const t=this.Oj,A=d.m;for(let w=0;w<16;w++)t[w]=Math.min(t[w],A[w]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const d=this.Oj;for(let t=0;t<16;t++)d[t]=Math.min(d[t],t<0||arguments.length<=t?void 0:arguments[t]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new Q)}negateInPlace(){const d=this.Oj;for(let t=0;t<16;t++)d[t]=-d[t];return this.markAsUpdated(),this}negateToRef(d){const t=this.Oj,A=d.Oj;for(let w=0;w<16;w++)A[w]=-t[w];return d.markAsUpdated(),d}equals(d){const t=d;if(!t)return!1;if((this._isIdentity||t._isIdentity)&&!this._isIdentityDirty&&!t._isIdentityDirty)return this._isIdentity&&t._isIdentity;const A=this.m,w=t.m;return A[0]===w[0]&&A[1]===w[1]&&A[2]===w[2]&&A[3]===w[3]&&A[4]===w[4]&&A[5]===w[5]&&A[6]===w[6]&&A[7]===w[7]&&A[8]===w[8]&&A[9]===w[9]&&A[10]===w[10]&&A[11]===w[11]&&A[12]===w[12]&&A[13]===w[13]&&A[14]===w[14]&&A[15]===w[15]}equalsWithEpsilon(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=this.Oj,w=d.m;for(let N=0;N<16;N++)if(!(0,W.z)(A[N],w[N],t))return!1;return!0}equalsToFloats(){const d=this.Oj;for(let t=0;t<16;t++)if(d[t]!=(t<0||arguments.length<=t?void 0:arguments[t]))return!1;return!0}floor(){return this.floorToRef(new Q)}floorToRef(d){const t=this.Oj,A=d.Oj;for(let w=0;w<16;w++)A[w]=Math.floor(t[w]);return d.markAsUpdated(),d}fract(){return this.fractToRef(new Q)}fractToRef(d){const t=this.Oj,A=d.Oj;for(let w=0;w<16;w++)A[w]=t[w]-Math.floor(t[w]);return d.markAsUpdated(),d}clone(){const d=new Q;return d.p(this),d}getClassName(){return"Matrix"}getHashCode(){let d=a(this.Oj[0]);for(let t=1;t<16;t++)d=397*d^a(this.Oj[t]);return d}decomposeToTransformNode(d){return d.rotationQuaternion=d.rotationQuaternion||new b,this.decompose(d.Gf,d.rotationQuaternion,d.position)}decompose(d,t,A,w){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return A&&A.Dj(0),d&&d.Dj(1),t&&t.wf(0,0,0,1),!0;const p=this.Oj;if(A&&A.wf(p[12],p[13],p[14]),(d=d||P.gb[0]).x=Math.sqrt(p[0]*p[0]+p[1]*p[1]+p[2]*p[2]),d.y=Math.sqrt(p[4]*p[4]+p[5]*p[5]+p[6]*p[6]),d.z=Math.sqrt(p[8]*p[8]+p[9]*p[9]+p[10]*p[10]),w){const t=(N?w.absoluteScaling.x:w.Gf.x)<0?-1:1,A=(N?w.absoluteScaling.y:w.Gf.y)<0?-1:1,p=(N?w.absoluteScaling.z:w.Gf.z)<0?-1:1;d.x*=t,d.y*=A,d.z*=p}else this.determinant()<=0&&(d.y*=-1);if(0===d._x||0===d._y||0===d._z)return t&&t.wf(0,0,0,1),!1;if(t){const A=1/d._x,w=1/d._y,N=1/d._z;Q.FromValuesToRef(p[0]*A,p[1]*A,p[2]*A,0,p[4]*w,p[5]*w,p[6]*w,0,p[8]*N,p[9]*N,p[10]*N,0,0,0,0,1,P.Matrix[0]),b.FromRotationMatrixToRef(P.Matrix[0],t)}return!0}getRow(d){if(d<0||d>3)return null;const t=4*d;return new k(this.Oj[t+0],this.Oj[t+1],this.Oj[t+2],this.Oj[t+3])}getRowToRef(d,t){if(d>=0&&d<=3){const A=4*d;t.x=this.Oj[A+0],t.y=this.Oj[A+1],t.z=this.Oj[A+2],t.w=this.Oj[A+3]}return t}setRow(d,t){return this.setRowFromFloats(d,t.x,t.y,t.z,t.w)}transpose(){const d=new Q;return Q.TransposeToRef(this,d),d}transposeToRef(d){return Q.TransposeToRef(this,d),d}setRowFromFloats(d,t,A,w,N){if(d<0||d>3)return this;const p=4*d;return this.Oj[p+0]=t,this.Oj[p+1]=A,this.Oj[p+2]=w,this.Oj[p+3]=N,this.markAsUpdated(),this}scale(d){const t=new Q;return this.scaleToRef(d,t),t}scaleToRef(d,t){for(let A=0;A<16;A++)t.Oj[A]=this.Oj[A]*d;return t.markAsUpdated(),t}scaleAndAddToRef(d,t){for(let A=0;A<16;A++)t.Oj[A]+=this.Oj[A]*d;return t.markAsUpdated(),t}scaleInPlace(d){const t=this.Oj;for(let A=0;A<16;A++)t[A]*=d;return this.markAsUpdated(),this}toNormalMatrix(d){const t=P.Matrix[0];this.invertToRef(t),t.transposeToRef(d);const A=d.Oj;return Q.FromValuesToRef(A[0],A[1],A[2],0,A[4],A[5],A[6],0,A[8],A[9],A[10],0,0,0,0,1,d),d}getRotationMatrix(){const d=new Q;return this.getRotationMatrixToRef(d),d}getRotationMatrixToRef(d){const t=P.gb[0];if(!this.decompose(t))return Q.IdentityToRef(d),d;const A=this.Oj,w=1/t._x,N=1/t._y,p=1/t._z;return Q.FromValuesToRef(A[0]*w,A[1]*w,A[2]*w,0,A[4]*N,A[5]*N,A[6]*N,0,A[8]*p,A[9]*p,A[10]*p,0,0,0,0,1,d),d}toggleModelMatrixHandInPlace(){const d=this.Oj;return d[2]*=-1,d[6]*=-1,d[8]*=-1,d[9]*=-1,d[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const d=this.Oj;return d[8]*=-1,d[9]*=-1,d[10]*=-1,d[11]*=-1,this.markAsUpdated(),this}static Lg(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const A=new Q;return Q.FromArrayToRef(d,t,A),A}static FromArrayToRef(d,t,A){for(let w=0;w<16;w++)A.Oj[w]=d[w+t];return A.markAsUpdated(),A}static FromFloat32ArrayToRefScaled(d,t,A,w){return w.Oj[0]=d[0+t]*A,w.Oj[1]=d[1+t]*A,w.Oj[2]=d[2+t]*A,w.Oj[3]=d[3+t]*A,w.Oj[4]=d[4+t]*A,w.Oj[5]=d[5+t]*A,w.Oj[6]=d[6+t]*A,w.Oj[7]=d[7+t]*A,w.Oj[8]=d[8+t]*A,w.Oj[9]=d[9+t]*A,w.Oj[10]=d[10+t]*A,w.Oj[11]=d[11+t]*A,w.Oj[12]=d[12+t]*A,w.Oj[13]=d[13+t]*A,w.Oj[14]=d[14+t]*A,w.Oj[15]=d[15+t]*A,w.markAsUpdated(),w}static get IdentityReadOnly(){return Q._IdentityReadOnly}static FromValuesToRef(d,t,A,w,N,p,B,X,W,a,D,i,k,b,Q,P,J){const U=J.Oj;U[0]=d,U[1]=t,U[2]=A,U[3]=w,U[4]=N,U[5]=p,U[6]=B,U[7]=X,U[8]=W,U[9]=a,U[10]=D,U[11]=i,U[12]=k,U[13]=b,U[14]=Q,U[15]=P,J.markAsUpdated()}static FromValues(d,t,A,w,N,p,B,X,W,a,D,i,k,b,P,J){const U=new Q,T=U.Oj;return T[0]=d,T[1]=t,T[2]=A,T[3]=w,T[4]=N,T[5]=p,T[6]=B,T[7]=X,T[8]=W,T[9]=a,T[10]=D,T[11]=i,T[12]=k,T[13]=b,T[14]=P,T[15]=J,U.markAsUpdated(),U}static Compose(d,t,A){const w=new Q;return Q.ComposeToRef(d,t,A,w),w}static ComposeToRef(d,t,A,w){const N=w.Oj,p=t._x,B=t._y,X=t._z,W=t._w,a=p+p,D=B+B,i=X+X,k=p*a,b=p*D,Q=p*i,P=B*D,J=B*i,U=X*i,T=W*a,F=W*D,q=W*i,H=d._x,f=d._y,v=d._z;return N[0]=(1-(P+U))*H,N[1]=(b+q)*H,N[2]=(Q-F)*H,N[3]=0,N[4]=(b-q)*f,N[5]=(1-(k+U))*f,N[6]=(J+T)*f,N[7]=0,N[8]=(Q+F)*v,N[9]=(J-T)*v,N[10]=(1-(k+P))*v,N[11]=0,N[12]=A._x,N[13]=A._y,N[14]=A._z,N[15]=1,w.markAsUpdated(),w}static Identity(){const d=Q.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return d._updateIdentityStatus(!0),d}static IdentityToRef(d){return Q.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,d),d._updateIdentityStatus(!0),d}static Zero(){const d=Q.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return d._updateIdentityStatus(!1),d}static RotationX(d){const t=new Q;return Q.RotationXToRef(d,t),t}static Invert(d){const t=new Q;return d.invertToRef(t),t}static RotationXToRef(d,t){const A=Math.sin(d),w=Math.cos(d);return Q.FromValuesToRef(1,0,0,0,0,w,A,0,0,-A,w,0,0,0,0,1,t),t._updateIdentityStatus(1===w&&0===A),t}static RotationY(d){const t=new Q;return Q.RotationYToRef(d,t),t}static RotationYToRef(d,t){const A=Math.sin(d),w=Math.cos(d);return Q.FromValuesToRef(w,0,-A,0,0,1,0,0,A,0,w,0,0,0,0,1,t),t._updateIdentityStatus(1===w&&0===A),t}static RotationZ(d){const t=new Q;return Q.RotationZToRef(d,t),t}static RotationZToRef(d,t){const A=Math.sin(d),w=Math.cos(d);return Q.FromValuesToRef(w,A,0,0,-A,w,0,0,0,0,1,0,0,0,0,1,t),t._updateIdentityStatus(1===w&&0===A),t}static RotationAxis(d,t){const A=new Q;return Q.RotationAxisToRef(d,t,A),A}static RotationAxisToRef(d,t,A){const w=Math.sin(-t),N=Math.cos(-t),p=1-N;d=d.normalizeToRef(P.gb[0]);const B=A.Oj;return B[0]=d._x*d._x*p+N,B[1]=d._x*d._y*p-d._z*w,B[2]=d._x*d._z*p+d._y*w,B[3]=0,B[4]=d._y*d._x*p+d._z*w,B[5]=d._y*d._y*p+N,B[6]=d._y*d._z*p-d._x*w,B[7]=0,B[8]=d._z*d._x*p-d._y*w,B[9]=d._z*d._y*p+d._x*w,B[10]=d._z*d._z*p+N,B[11]=0,B[12]=0,B[13]=0,B[14]=0,B[15]=1,A.markAsUpdated(),A}static RotationAlignToRef(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const p=i.Dot(t,d),B=A.Oj;if(p<-1+w.b)B[0]=-1,B[1]=0,B[2]=0,B[3]=0,B[4]=0,B[5]=N?1:-1,B[6]=0,B[7]=0,B[8]=0,B[9]=0,B[10]=N?-1:1,B[11]=0;else{const A=i.Cross(t,d),w=1/(1+p);B[0]=A._x*A._x*w+p,B[1]=A._y*A._x*w-A._z,B[2]=A._z*A._x*w+A._y,B[3]=0,B[4]=A._x*A._y*w+A._z,B[5]=A._y*A._y*w+p,B[6]=A._z*A._y*w-A._x,B[7]=0,B[8]=A._x*A._z*w-A._y,B[9]=A._y*A._z*w+A._x,B[10]=A._z*A._z*w+p,B[11]=0}return B[12]=0,B[13]=0,B[14]=0,B[15]=1,A.markAsUpdated(),A}static RotationYawPitchRoll(d,t,A){const w=new Q;return Q.RotationYawPitchRollToRef(d,t,A,w),w}static RotationYawPitchRollToRef(d,t,A,w){return b.RotationYawPitchRollToRef(d,t,A,P.Quaternion[0]),P.Quaternion[0].toRotationMatrix(w),w}static Scaling(d,t,A){const w=new Q;return Q.ScalingToRef(d,t,A,w),w}static ScalingToRef(d,t,A,w){return Q.FromValuesToRef(d,0,0,0,0,t,0,0,0,0,A,0,0,0,0,1,w),w._updateIdentityStatus(1===d&&1===t&&1===A),w}static Translation(d,t,A){const w=new Q;return Q.TranslationToRef(d,t,A,w),w}static TranslationToRef(d,t,A,w){return Q.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,d,t,A,1,w),w._updateIdentityStatus(0===d&&0===t&&0===A),w}static Lerp(d,t,A){const w=new Q;return Q.LerpToRef(d,t,A,w),w}static LerpToRef(d,t,A,w){const N=w.Oj,p=d.m,B=t.m;for(let X=0;X<16;X++)N[X]=p[X]*(1-A)+B[X]*A;return w.markAsUpdated(),w}static DecomposeLerp(d,t,A){const w=new Q;return Q.DecomposeLerpToRef(d,t,A,w),w}static DecomposeLerpToRef(d,t,A,w){const N=P.gb[0],p=P.Quaternion[0],B=P.gb[1];d.decompose(N,p,B);const X=P.gb[2],W=P.Quaternion[1],a=P.gb[3];t.decompose(X,W,a);const D=P.gb[4];i.LerpToRef(N,X,A,D);const k=P.Quaternion[2];b.SlerpToRef(p,W,A,k);const J=P.gb[5];return i.LerpToRef(B,a,A,J),Q.ComposeToRef(D,k,J,w),w}static LookAtLH(d,t,A){const w=new Q;return Q.LookAtLHToRef(d,t,A,w),w}static LookAtLHToRef(d,t,A,w){const N=P.gb[0],p=P.gb[1],B=P.gb[2];t.subtractToRef(d,B),B.normalize(),i.CrossToRef(A,B,N);const X=N.lengthSquared();0===X?N.x=1:N.normalizeFromLength(Math.sqrt(X)),i.CrossToRef(B,N,p),p.normalize();const W=-i.Dot(N,d),a=-i.Dot(p,d),D=-i.Dot(B,d);return Q.FromValuesToRef(N._x,p._x,B._x,0,N._y,p._y,B._y,0,N._z,p._z,B._z,0,W,a,D,1,w),w}static LookAtRH(d,t,A){const w=new Q;return Q.LookAtRHToRef(d,t,A,w),w}static LookAtRHToRef(d,t,A,w){const N=P.gb[0],p=P.gb[1],B=P.gb[2];d.subtractToRef(t,B),B.normalize(),i.CrossToRef(A,B,N);const X=N.lengthSquared();0===X?N.x=1:N.normalizeFromLength(Math.sqrt(X)),i.CrossToRef(B,N,p),p.normalize();const W=-i.Dot(N,d),a=-i.Dot(p,d),D=-i.Dot(B,d);return Q.FromValuesToRef(N._x,p._x,B._x,0,N._y,p._y,B._y,0,N._z,p._z,B._z,0,W,a,D,1,w),w}static LookDirectionLH(d,t){const A=new Q;return Q.LookDirectionLHToRef(d,t,A),A}static LookDirectionLHToRef(d,t,A){const w=P.gb[0];w.p(d),w.scaleInPlace(-1);const N=P.gb[1];return i.CrossToRef(t,w,N),Q.FromValuesToRef(N._x,N._y,N._z,0,t._x,t._y,t._z,0,w._x,w._y,w._z,0,0,0,0,1,A),A}static LookDirectionRH(d,t){const A=new Q;return Q.LookDirectionRHToRef(d,t,A),A}static LookDirectionRHToRef(d,t,A){const w=P.gb[2];return i.CrossToRef(t,d,w),Q.FromValuesToRef(w._x,w._y,w._z,0,t._x,t._y,t._z,0,d._x,d._y,d._z,0,0,0,0,1,A),A}static OrthoLH(d,t,A,w,N){const p=new Q;return Q.OrthoLHToRef(d,t,A,w,p,N),p}static OrthoLHToRef(d,t,A,w,N,p){const B=2/d,X=2/t,W=2/(w-A),a=-(w+A)/(w-A);return Q.FromValuesToRef(B,0,0,0,0,X,0,0,0,0,W,0,0,0,a,1,N),p&&N.multiplyToRef(U,N),N._updateIdentityStatus(1===B&&1===X&&1===W&&0===a),N}static OrthoOffCenterLH(d,t,A,w,N,p,B){const X=new Q;return Q.OrthoOffCenterLHToRef(d,t,A,w,N,p,X,B),X}static OrthoOffCenterLHToRef(d,t,A,w,N,p,B,X){const W=2/(t-d),a=2/(w-A),D=2/(p-N),i=-(p+N)/(p-N),k=(d+t)/(d-t),b=(w+A)/(A-w);return Q.FromValuesToRef(W,0,0,0,0,a,0,0,0,0,D,0,k,b,i,1,B),X&&B.multiplyToRef(U,B),B.markAsUpdated(),B}static ObliqueOffCenterLHToRef(d,t,A,w,N,p,B,X,W,a,D){const i=-B*Math.cos(X),k=-B*Math.sin(X);return Q.TranslationToRef(0,0,-W,P.Matrix[1]),Q.FromValuesToRef(1,0,0,0,0,1,0,0,i,k,1,0,0,0,0,1,P.Matrix[0]),P.Matrix[1].multiplyToRef(P.Matrix[0],P.Matrix[0]),Q.TranslationToRef(0,0,W,P.Matrix[1]),P.Matrix[0].multiplyToRef(P.Matrix[1],P.Matrix[0]),Q.OrthoOffCenterLHToRef(d,t,A,w,N,p,a,D),P.Matrix[0].multiplyToRef(a,a),a}static OrthoOffCenterRH(d,t,A,w,N,p,B){const X=new Q;return Q.OrthoOffCenterRHToRef(d,t,A,w,N,p,X,B),X}static OrthoOffCenterRHToRef(d,t,A,w,N,p,B,X){return Q.OrthoOffCenterLHToRef(d,t,A,w,N,p,B,X),B.Oj[10]*=-1,B}static ObliqueOffCenterRHToRef(d,t,A,w,N,p,B,X,W,a,D){const i=B*Math.cos(X),k=B*Math.sin(X);return Q.TranslationToRef(0,0,W,P.Matrix[1]),Q.FromValuesToRef(1,0,0,0,0,1,0,0,i,k,1,0,0,0,0,1,P.Matrix[0]),P.Matrix[1].multiplyToRef(P.Matrix[0],P.Matrix[0]),Q.TranslationToRef(0,0,-W,P.Matrix[1]),P.Matrix[0].multiplyToRef(P.Matrix[1],P.Matrix[0]),Q.OrthoOffCenterRHToRef(d,t,A,w,N,p,a,D),P.Matrix[0].multiplyToRef(a,a),a}static PerspectiveLH(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const B=new Q,X=2*A/d,W=2*A/t,a=(w+A)/(w-A),D=-2*w*A/(w-A),i=Math.tan(p);return Q.FromValuesToRef(X,0,0,0,0,W,0,i,0,0,a,1,0,0,D,0,B),N&&B.multiplyToRef(U,B),B._updateIdentityStatus(!1),B}static PerspectiveFovLH(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const X=new Q;return Q.PerspectiveFovLHToRef(d,t,A,w,X,!0,N,p,B),X}static PerspectiveFovLHToRef(d,t,A,w,N){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=A,D=w,i=1/Math.tan(.5*d),k=p?i/t:i,b=p?i:i*t,P=W&&0===a?-1:0!==D?(D+a)/(D-a):1,J=W&&0===a?2*D:0!==D?-2*D*a/(D-a):-2*a,T=Math.tan(X);return Q.FromValuesToRef(k,0,0,0,0,b,0,T,0,0,P,1,0,0,J,0,N),B&&N.multiplyToRef(U,N),N._updateIdentityStatus(!1),N}static PerspectiveFovReverseLHToRef(d,t,A,w,N){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const W=1/Math.tan(.5*d),a=p?W/t:W,D=p?W:W*t,i=Math.tan(X);return Q.FromValuesToRef(a,0,0,0,0,D,0,i,0,0,-A,1,0,0,1,0,N),B&&N.multiplyToRef(U,N),N._updateIdentityStatus(!1),N}static PerspectiveFovRH(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const X=new Q;return Q.PerspectiveFovRHToRef(d,t,A,w,X,!0,N,p,B),X}static PerspectiveFovRHToRef(d,t,A,w,N){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,W=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const a=A,D=w,i=1/Math.tan(.5*d),k=p?i/t:i,b=p?i:i*t,P=W&&0===a?1:0!==D?-(D+a)/(D-a):-1,J=W&&0===a?2*D:0!==D?-2*D*a/(D-a):-2*a,T=Math.tan(X);return Q.FromValuesToRef(k,0,0,0,0,b,0,T,0,0,P,-1,0,0,J,0,N),B&&N.multiplyToRef(U,N),N._updateIdentityStatus(!1),N}static PerspectiveFovReverseRHToRef(d,t,A,w,N){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=arguments.length>6?arguments[6]:void 0,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const W=1/Math.tan(.5*d),a=p?W/t:W,D=p?W:W*t,i=Math.tan(X);return Q.FromValuesToRef(a,0,0,0,0,D,0,i,0,0,-A,-1,0,0,-1,0,N),B&&N.multiplyToRef(U,N),N._updateIdentityStatus(!1),N}static GetFinalMatrix(d,t,A,w,N,p){const B=d.width,X=d.height,W=d.x,a=d.y,D=Q.FromValues(B/2,0,0,0,0,-X/2,0,0,0,0,p-N,0,W+B/2,X/2+a,N,1),i=new Q;return t.multiplyToRef(A,i),i.multiplyToRef(w,i),i.multiplyToRef(D,i)}static GetAsMatrix2x2(d){const t=d.m,A=[t[0],t[1],t[4],t[5]];return B.c.MatrixUse64Bits?A:new Float32Array(A)}static GetAsMatrix3x3(d){const t=d.m,A=[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]];return B.c.MatrixUse64Bits?A:new Float32Array(A)}static Transpose(d){const t=new Q;return Q.TransposeToRef(d,t),t}static TransposeToRef(d,t){const A=d.m,w=A[0],N=A[4],p=A[8],B=A[12],X=A[1],W=A[5],a=A[9],D=A[13],i=A[2],k=A[6],b=A[10],Q=A[14],P=A[3],J=A[7],U=A[11],T=A[15],F=t.Oj;return F[0]=w,F[1]=N,F[2]=p,F[3]=B,F[4]=X,F[5]=W,F[6]=a,F[7]=D,F[8]=i,F[9]=k,F[10]=b,F[11]=Q,F[12]=P,F[13]=J,F[14]=U,F[15]=T,t.markAsUpdated(),t._updateIdentityStatus(d._isIdentity,d._isIdentityDirty),t}static Reflection(d){const t=new Q;return Q.ReflectionToRef(d,t),t}static ReflectionToRef(d,t){d.normalize();const A=d.ab.x,w=d.ab.y,N=d.ab.z,p=-2*A,B=-2*w,X=-2*N;return Q.FromValuesToRef(p*A+1,B*A,X*A,0,p*w,B*w+1,X*w,0,p*N,B*N,X*N+1,0,p*d.d,B*d.d,X*d.d,1,t),t}static FromXYZAxesToRef(d,t,A,w){return Q.FromValuesToRef(d._x,d._y,d._z,0,t._x,t._y,t._z,0,A._x,A._y,A._z,0,0,0,0,1,w),w}static FromQuaternionToRef(d,t){const A=d._x*d._x,w=d._y*d._y,N=d._z*d._z,p=d._x*d._y,B=d._z*d._w,X=d._z*d._x,W=d._y*d._w,a=d._y*d._z,D=d._x*d._w;return t.Oj[0]=1-2*(w+N),t.Oj[1]=2*(p+B),t.Oj[2]=2*(X-W),t.Oj[3]=0,t.Oj[4]=2*(p-B),t.Oj[5]=1-2*(N+A),t.Oj[6]=2*(a+D),t.Oj[7]=0,t.Oj[8]=2*(X+W),t.Oj[9]=2*(a-D),t.Oj[10]=1-2*(w+A),t.Oj[11]=0,t.Oj[12]=0,t.Oj[13]=0,t.Oj[14]=0,t.Oj[15]=1,t.markAsUpdated(),t}}Q._UpdateFlagSeed=0,Q._IdentityReadOnly=Q.Identity(),Object.defineProperties(Q.prototype,{dimension:{value:[4,4]},rank:{value:2}});class P{}P.gb=(0,N.f)(11,i.Zero),P.Matrix=(0,N.f)(2,Q.Identity),P.Quaternion=(0,N.f)(3,b.Zero);class J{}J.Vector2=(0,N.f)(3,D.Zero),J.gb=(0,N.f)(13,i.Zero),J.Vector4=(0,N.f)(3,k.Zero),J.Quaternion=(0,N.f)(3,b.Zero),J.Matrix=(0,N.f)(8,Q.Identity),(0,p.g)("BABYLON.Vector2",D),(0,p.g)("BABYLON.Vector3",i),(0,p.g)("BABYLON.Vector4",k),(0,p.g)("BABYLON.Matrix",Q);const U=Q.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11333:(d,t,A)=>{"use strict";A.d(t,{d:()=>w});class w{constructor(d,t,A,w){this.x=d,this.y=t,this.width=A,this.height=w}toGlobal(d,t){return new w(this.x*d,this.y*t,this.width*d,this.height*t)}toGlobalToRef(d,t,A){return A.x=this.x*d,A.y=this.y*t,A.width=this.width*d,A.height=this.height*t,this}clone(){return new w(this.x,this.y,this.width,this.height)}}},11541:(d,t,A)=>{"use strict";A.d(t,{c:()=>a,f:()=>D});var w=A(11076),N=A(11548);const p=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],B=[()=>1,d=>d.y,d=>d.z,d=>d.x,d=>d.x*d.y,d=>d.y*d.z,d=>3*d.z*d.z-1,d=>d.x*d.z,d=>d.x*d.x-d.y*d.y],X=(d,t)=>p[d]*B[d](t),W=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class a{constructor(){this.preScaled=!1,this.l00=w.l.Zero(),this.l1_1=w.l.Zero(),this.l10=w.l.Zero(),this.l11=w.l.Zero(),this.l2_2=w.l.Zero(),this.l2_1=w.l.Zero(),this.l20=w.l.Zero(),this.l21=w.l.Zero(),this.l22=w.l.Zero()}addLight(d,t,A){N.e.gb[0].set(t.r,t.g,t.b);const w=N.e.gb[0],p=N.e.gb[1];w.scaleToRef(A,p),p.scaleToRef(X(0,d),N.e.gb[2]),this.l00.addInPlace(N.e.gb[2]),p.scaleToRef(X(1,d),N.e.gb[2]),this.l1_1.addInPlace(N.e.gb[2]),p.scaleToRef(X(2,d),N.e.gb[2]),this.l10.addInPlace(N.e.gb[2]),p.scaleToRef(X(3,d),N.e.gb[2]),this.l11.addInPlace(N.e.gb[2]),p.scaleToRef(X(4,d),N.e.gb[2]),this.l2_2.addInPlace(N.e.gb[2]),p.scaleToRef(X(5,d),N.e.gb[2]),this.l2_1.addInPlace(N.e.gb[2]),p.scaleToRef(X(6,d),N.e.gb[2]),this.l20.addInPlace(N.e.gb[2]),p.scaleToRef(X(7,d),N.e.gb[2]),this.l21.addInPlace(N.e.gb[2]),p.scaleToRef(X(8,d),N.e.gb[2]),this.l22.addInPlace(N.e.gb[2])}scaleInPlace(d){this.l00.scaleInPlace(d),this.l1_1.scaleInPlace(d),this.l10.scaleInPlace(d),this.l11.scaleInPlace(d),this.l2_2.scaleInPlace(d),this.l2_1.scaleInPlace(d),this.l20.scaleInPlace(d),this.l21.scaleInPlace(d),this.l22.scaleInPlace(d)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(W[0]),this.l1_1.scaleInPlace(W[1]),this.l10.scaleInPlace(W[2]),this.l11.scaleInPlace(W[3]),this.l2_2.scaleInPlace(W[4]),this.l2_1.scaleInPlace(W[5]),this.l20.scaleInPlace(W[6]),this.l21.scaleInPlace(W[7]),this.l22.scaleInPlace(W[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(p[0]),this.l1_1.scaleInPlace(p[1]),this.l10.scaleInPlace(p[2]),this.l11.scaleInPlace(p[3]),this.l2_2.scaleInPlace(p[4]),this.l2_1.scaleInPlace(p[5]),this.l20.scaleInPlace(p[6]),this.l21.scaleInPlace(p[7]),this.l22.scaleInPlace(p[8])}updateFromArray(d){return w.l.FromArrayToRef(d[0],0,this.l00),w.l.FromArrayToRef(d[1],0,this.l1_1),w.l.FromArrayToRef(d[2],0,this.l10),w.l.FromArrayToRef(d[3],0,this.l11),w.l.FromArrayToRef(d[4],0,this.l2_2),w.l.FromArrayToRef(d[5],0,this.l2_1),w.l.FromArrayToRef(d[6],0,this.l20),w.l.FromArrayToRef(d[7],0,this.l21),w.l.FromArrayToRef(d[8],0,this.l22),this}updateFromFloatsArray(d){return w.l.FromFloatsToRef(d[0],d[1],d[2],this.l00),w.l.FromFloatsToRef(d[3],d[4],d[5],this.l1_1),w.l.FromFloatsToRef(d[6],d[7],d[8],this.l10),w.l.FromFloatsToRef(d[9],d[10],d[11],this.l11),w.l.FromFloatsToRef(d[12],d[13],d[14],this.l2_2),w.l.FromFloatsToRef(d[15],d[16],d[17],this.l2_1),w.l.FromFloatsToRef(d[18],d[19],d[20],this.l20),w.l.FromFloatsToRef(d[21],d[22],d[23],this.l21),w.l.FromFloatsToRef(d[24],d[25],d[26],this.l22),this}static Lg(d){return(new a).updateFromArray(d)}static FromPolynomial(d){const t=new a;return t.l00=d.xx.scale(.376127).add(d.yy.scale(.376127)).add(d.zz.scale(.376126)),t.l1_1=d.y.scale(.977204),t.l10=d.z.scale(.977204),t.l11=d.x.scale(.977204),t.l2_2=d.xy.scale(1.16538),t.l2_1=d.yz.scale(1.16538),t.l20=d.zz.scale(1.34567).Uc(d.xx.scale(.672834)).Uc(d.yy.scale(.672834)),t.l21=d.zx.scale(1.16538),t.l22=d.xx.scale(1.16538).Uc(d.yy.scale(1.16538)),t.l1_1.scaleInPlace(-1),t.l11.scaleInPlace(-1),t.l2_1.scaleInPlace(-1),t.l21.scaleInPlace(-1),t.scaleInPlace(Math.PI),t}}class D{constructor(){this.x=w.l.Zero(),this.y=w.l.Zero(),this.z=w.l.Zero(),this.xx=w.l.Zero(),this.yy=w.l.Zero(),this.zz=w.l.Zero(),this.xy=w.l.Zero(),this.yz=w.l.Zero(),this.zx=w.l.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=a.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(d){N.e.gb[0].wf(d.r,d.g,d.b);const t=N.e.gb[0];this.xx.addInPlace(t),this.yy.addInPlace(t),this.zz.addInPlace(t)}scaleInPlace(d){this.x.scaleInPlace(d),this.y.scaleInPlace(d),this.z.scaleInPlace(d),this.xx.scaleInPlace(d),this.yy.scaleInPlace(d),this.zz.scaleInPlace(d),this.yz.scaleInPlace(d),this.zx.scaleInPlace(d),this.xy.scaleInPlace(d)}updateFromHarmonics(d){return this._harmonics=d,this.x.p(d.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(d.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(d.l10),this.z.scaleInPlace(1.02333),this.xx.p(d.l00),N.e.gb[0].p(d.l20).scaleInPlace(.247708),N.e.gb[1].p(d.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).ni(N.e.gb[0]).addInPlace(N.e.gb[1]),this.yy.p(d.l00),this.yy.scaleInPlace(.886277).ni(N.e.gb[0]).ni(N.e.gb[1]),this.zz.p(d.l00),N.e.gb[0].p(d.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(N.e.gb[0]),this.yz.p(d.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(d.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(d.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(d){return(new D).updateFromHarmonics(d)}static Lg(d){const t=new D;return w.l.FromArrayToRef(d[0],0,t.x),w.l.FromArrayToRef(d[1],0,t.y),w.l.FromArrayToRef(d[2],0,t.z),w.l.FromArrayToRef(d[3],0,t.xx),w.l.FromArrayToRef(d[4],0,t.yy),w.l.FromArrayToRef(d[5],0,t.zz),w.l.FromArrayToRef(d[6],0,t.yz),w.l.FromArrayToRef(d[7],0,t.zx),w.l.FromArrayToRef(d[8],0,t.xy),t}}},11372:(d,t,A)=>{"use strict";A.d(t,{c:()=>a});var w=A(11076),N=A(11094),p=A(11309),B=A(11339),X=A(11271);A(11377);function W(d){let t=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const A=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],p=[];let W=[];const a=d.width||d.size||1,D=d.height||d.size||1,i=d.depth||d.size||1,k=d.wrap||!1;let b=void 0===d.topBaseAt?1:d.topBaseAt,Q=void 0===d.bottomBaseAt?0:d.bottomBaseAt;b=(b+4)%4,Q=(Q+4)%4;let P=[2,0,3,1][b],J=[2,0,1,3][Q],U=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(k){t=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],U=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let d=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],A=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const w=[17,18,19,16],N=[22,23,20,21];for(;P>0;)d.unshift(d.pop()),w.unshift(w.pop()),P--;for(;J>0;)A.unshift(A.pop()),N.unshift(N.pop()),J--;d=d.flat(),A=A.flat(),U=U.concat(d).concat(A),t.push(w[0],w[2],w[3],w[0],w[1],w[2]),t.push(N[0],N[2],N[3],N[0],N[1],N[2])}const T=[a/2,D/2,i/2];W=U.reduce(((d,t,A)=>d.concat(t*T[A%3])),[]);const F=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE,q=d.faceUV||new Array(6),H=d.faceColors,f=[];for(let B=0;B<6;B++)void 0===q[B]&&(q[B]=new w.m(0,0,1,1)),H&&void 0===H[B]&&(H[B]=new N.i(1,1,1,1));for(let w=0;w<6;w++)if(p.push(q[w].z,X.e?1-q[w].w:q[w].w),p.push(q[w].x,X.e?1-q[w].w:q[w].w),p.push(q[w].x,X.e?1-q[w].y:q[w].y),p.push(q[w].z,X.e?1-q[w].y:q[w].y),H)for(let d=0;d<4;d++)f.push(H[w].r,H[w].g,H[w].b,H[w].a);B.e._ComputeSides(F,W,t,A,p,d.frontUVs,d.backUVs);const v=new B.e;if(v.indices=t,v.xa=W,v.ya=A,v.Aa=p,H){const d=F===B.e.DOUBLESIDE?f.concat(f):f;v.za=d}return v}function a(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new p.d(d,A);t.sideOrientation=p.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return W(t).Ca(w,t.updatable),w}B.e.CreateBox=W,p.d.CreateBox=function(d,t){return a(d,{size:t,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11719:(d,t,A)=>{"use strict";A.d(t,{d:()=>X});var w=A(11309),N=A(11339),p=A(11271);function B(d){const t=[],A=[],w=[],B=[],X=d.i||.5,W=d.Uk||64,a=d.arc&&(d.arc<=0||d.arc>1)?1:d.arc||1,D=0===d.sideOrientation?0:d.sideOrientation||N.e.DEFAULTSIDE;t.push(0,0,0),B.push(.5,.5);const i=2*Math.PI*a,k=1===a?i/W:i/(W-1);let b=0;for(let N=0;N<W;N++){const d=Math.cos(b),A=Math.sin(b),w=(d+1)/2,N=(1-A)/2;t.push(X*d,X*A,0),B.push(w,p.e?1-N:N),b+=k}1===a&&(t.push(t[3],t[4],t[5]),B.push(B[2],p.e?1-B[3]:B[3]));const Q=t.length/3;for(let N=1;N<Q-1;N++)A.push(N+1,0,N);N.e.ComputeNormals(t,A,w),N.e._ComputeSides(D,t,A,w,B,d.frontUVs,d.backUVs);const P=new N.e;return P.indices=A,P.xa=t,P.ya=w,P.Aa=B,P}function X(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new w.d(d,A);t.sideOrientation=w.d._GetDefaultSideOrientation(t.sideOrientation),N._originalBuilderSideOrientation=t.sideOrientation;return B(t).Ca(N,t.updatable),N}N.e.rb=B,w.d.rb=function(d,t,A){return X(d,{i:t,Uk:A,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11377:(d,t,A)=>{"use strict";A.d(t,{e:()=>J,b:()=>T,h:()=>U});var w=A(11076),N=A(11094),p=A(11309),B=A(11339),X=A(11120);p.d._GroundMeshParser=(d,t)=>W.Parse(d,t);class W extends p.d{constructor(d,t){super(d,t),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=d,this._subdivisionsY=d,this.subdivide(d);const A=this;A.createOrUpdateSubmeshesOctree&&A.createOrUpdateSubmeshesOctree(t)}getHeightAtCoordinates(d,t){const A=this.getWorldMatrix(),N=w.h.Matrix[5];A.invertToRef(N);const p=w.h.gb[8];if(w.l.TransformCoordinatesFromFloatsToRef(d,0,t,N,p),d=p.x,t=p.z,d<this._minX||d>=this._maxX||t<=this._minZ||t>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const B=this._getFacetAt(d,t),X=-(B.x*d+B.z*t+B.w)/B.y;return w.l.TransformCoordinatesFromFloatsToRef(0,X,0,A,p),p.y}getNormalAtCoordinates(d,t){const A=new w.l(0,1,0);return this.getNormalAtCoordinatesToRef(d,t,A),A}getNormalAtCoordinatesToRef(d,t,A){const N=this.getWorldMatrix(),p=w.h.Matrix[5];N.invertToRef(p);const B=w.h.gb[8];if(w.l.TransformCoordinatesFromFloatsToRef(d,0,t,p,B),d=B.x,t=B.z,d<this._minX||d>this._maxX||t<this._minZ||t>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const X=this._getFacetAt(d,t);return w.l.TransformNormalFromFloatsToRef(X.x,X.y,X.z,N,A),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(d,t){const A=Math.floor((d+this._maxX)*this._subdivisionsX/this._width),w=Math.floor(-(t+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),N=this._heightQuads[w*this._subdivisionsX+A];let p;return p=t<N.slope.x*d+N.slope.y?N.facet1:N.facet2,p}_initHeightQuads(){const d=this._subdivisionsX,t=this._subdivisionsY;this._heightQuads=new Array;for(let A=0;A<t;A++)for(let t=0;t<d;t++){const N={slope:w.j.Zero(),facet1:new w.m(0,0,0,0),facet2:new w.m(0,0,0,0)};this._heightQuads[A*d+t]=N}return this}_computeHeightQuads(){const d=this.getVerticesData(X.f.PositionKind);if(!d)return this;const t=w.h.gb[3],A=w.h.gb[2],N=w.h.gb[1],p=w.h.gb[0],B=w.h.gb[4],W=w.h.gb[5],a=w.h.gb[6],D=w.h.gb[7],i=w.h.gb[8];let k=0,b=0,Q=0,P=0,J=0,U=0,T=0;const F=this._subdivisionsX,q=this._subdivisionsY;for(let X=0;X<q;X++)for(let q=0;q<F;q++){k=3*q,b=X*(F+1)*3,Q=(X+1)*(F+1)*3,t.x=d[b+k],t.y=d[b+k+1],t.z=d[b+k+2],A.x=d[b+k+3],A.y=d[b+k+4],A.z=d[b+k+5],N.x=d[Q+k],N.y=d[Q+k+1],N.z=d[Q+k+2],p.x=d[Q+k+3],p.y=d[Q+k+4],p.z=d[Q+k+5],P=(p.z-t.z)/(p.x-t.x),J=t.z-P*t.x,A.subtractToRef(t,B),N.subtractToRef(t,W),p.subtractToRef(t,a),w.l.CrossToRef(a,W,D),w.l.CrossToRef(B,a,i),D.normalize(),i.normalize(),U=-(D.x*t.x+D.y*t.y+D.z*t.z),T=-(i.x*A.x+i.y*A.y+i.z*A.z);const H=this._heightQuads[X*F+q];H.slope.wf(P,J),H.facet1.wf(D.x,D.y,D.z,U),H.facet2.wf(i.x,i.y,i.z,T)}return this}serialize(d){super.serialize(d),d.subdivisionsX=this._subdivisionsX,d.subdivisionsY=this._subdivisionsY,d.minX=this._minX,d.maxX=this._maxX,d.Ui=this._minZ,d.maxZ=this._maxZ,d.width=this._width,d.height=this._height}static Parse(d,t){const A=new W(d.name,t);return A._subdivisionsX=d.subdivisionsX||1,A._subdivisionsY=d.subdivisionsY||1,A._minX=d.minX,A._maxX=d.maxX,A._minZ=d.Ui,A._maxZ=d.maxZ,A._width=d.width,A._height=d.height,A}}var a=A(10727),D=A(10775),i=A(11079),k=A(11271);function b(d){const t=[],A=[],N=[],p=[];let X,W;const a=d.width||d.size||1,D=d.height||d.size||1,i=0|(d.subdivisionsX||d.subdivisions||1),b=0|(d.subdivisionsY||d.subdivisions||1);for(X=0;X<=b;X++)for(W=0;W<=i;W++){const d=new w.l(W*a/i-a/2,0,(b-X)*D/b-D/2),t=new w.l(0,1,0);A.push(d.x,d.y,d.z),N.push(t.x,t.y,t.z),p.push(W/i,k.e?X/b:1-X/b)}for(X=0;X<b;X++)for(W=0;W<i;W++)t.push(W+1+(X+1)*(i+1)),t.push(W+1+X*(i+1)),t.push(W+X*(i+1)),t.push(W+(X+1)*(i+1)),t.push(W+1+(X+1)*(i+1)),t.push(W+X*(i+1));const Q=new B.e;return Q.indices=t,Q.xa=A,Q.ya=N,Q.Aa=p,Q}function Q(d){const t=void 0!==d.xmin&&null!==d.xmin?d.xmin:-1,A=void 0!==d.zmin&&null!==d.zmin?d.zmin:-1,N=void 0!==d.xmax&&null!==d.xmax?d.xmax:1,p=void 0!==d.zmax&&null!==d.zmax?d.zmax:1,X=d.subdivisions||{w:1,h:1},W=d.precision||{w:1,h:1},a=[],D=[],i=[],k=[];let b,Q,P,J;X.h=X.h<1?1:X.h,X.w=X.w<1?1:X.w,W.w=W.w<1?1:W.w,W.h=W.h<1?1:W.h;const U=(N-t)/X.w,T=(p-A)/X.h;function F(d,t,A,N){const p=D.length/3,B=W.w+1;for(b=0;b<W.h;b++)for(Q=0;Q<W.w;Q++){const d=[p+Q+b*B,p+(Q+1)+b*B,p+(Q+1)+(b+1)*B,p+Q+(b+1)*B];a.push(d[1]),a.push(d[2]),a.push(d[3]),a.push(d[0]),a.push(d[1]),a.push(d[3])}const X=w.l.Zero(),P=new w.l(0,1,0);for(b=0;b<=W.h;b++)for(X.z=b*(N-t)/W.h+t,Q=0;Q<=W.w;Q++)X.x=Q*(A-d)/W.w+d,X.y=0,D.push(X.x,X.y,X.z),i.push(P.x,P.y,P.z),k.push(Q/W.w,b/W.h)}for(P=0;P<X.h;P++)for(J=0;J<X.w;J++)F(t+J*U,A+P*T,t+(J+1)*U,A+(P+1)*T);const q=new B.e;return q.indices=a,q.xa=D,q.ya=i,q.Aa=k,q}function P(d){const t=[],A=[],p=[],X=[];let W,a;const D=d.colorFilter||new N.e(.3,.59,.11),k=d.alphaFilter||0;let b=!1;if(d.minHeight>d.maxHeight){b=!0;const t=d.maxHeight;d.maxHeight=d.minHeight,d.minHeight=t}for(W=0;W<=d.subdivisions;W++)for(a=0;a<=d.subdivisions;a++){const t=new w.l(a*d.width/d.subdivisions-d.width/2,0,(d.subdivisions-W)*d.height/d.subdivisions-d.height/2),N=4*(((t.x+d.width/2)/d.width*(d.bufferWidth-1)|0)+((1-(t.z+d.height/2)/d.height)*(d.bufferHeight-1)|0)*d.bufferWidth);let B=d.buffer[N]/255,Q=d.buffer[N+1]/255,P=d.buffer[N+2]/255;const J=d.buffer[N+3]/255;b&&(B=1-B,Q=1-Q,P=1-P);const U=B*D.r+Q*D.g+P*D.b;t.y=J>=k?d.minHeight+(d.maxHeight-d.minHeight)*U:d.minHeight-i.b,d.heightBuffer&&(d.heightBuffer[W*(d.subdivisions+1)+a]=t.y),A.push(t.x,t.y,t.z),p.push(0,0,0),X.push(a/d.subdivisions,1-W/d.subdivisions)}for(W=0;W<d.subdivisions;W++)for(a=0;a<d.subdivisions;a++){const w=a+1+(W+1)*(d.subdivisions+1),N=a+1+W*(d.subdivisions+1),p=a+W*(d.subdivisions+1),B=a+(W+1)*(d.subdivisions+1),X=A[3*w+1]>=d.minHeight,D=A[3*N+1]>=d.minHeight,i=A[3*p+1]>=d.minHeight;X&&D&&i&&(t.push(w),t.push(N),t.push(p));A[3*B+1]>=d.minHeight&&X&&i&&(t.push(B),t.push(w),t.push(p))}B.e.ComputeNormals(A,t,p);const Q=new B.e;return Q.indices=t,Q.xa=A,Q.ya=p,Q.Aa=X,Q}function J(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const A=new W(d,arguments.length>2?arguments[2]:void 0);A._setReady(!1),A._subdivisionsX=t.subdivisionsX||t.subdivisions||1,A._subdivisionsY=t.subdivisionsY||t.subdivisions||1,A._width=t.width||1,A._height=t.height||1,A._maxX=A._width/2,A._maxZ=A._height/2,A._minX=-A._maxX,A._minZ=-A._maxZ;return b(t).Ca(A,t.updatable),A._setReady(!0),A}function U(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new p.d(d,A);return Q(t).Ca(w,t.updatable),w}function T(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=A.width||10,B=A.height||10,X=A.subdivisions||1,i=A.minHeight||0,k=A.maxHeight||1,b=A.colorFilter||new N.e(.3,.59,.11),Q=A.alphaFilter||0,J=A.updatable,U=A.onReady;w=w||D.e.LastCreatedScene;const T=new W(d,w);let F;T._subdivisionsX=X,T._subdivisionsY=X,T._width=p,T._height=B,T._maxX=T._width/2,T._maxZ=T._height/2,T._minX=-T._maxX,T._minZ=-T._maxZ,T._setReady(!1),A.passHeightBufferInCallback&&(F=new Float32Array((X+1)*(X+1)));const q=(d,t,A)=>{P({width:p,height:B,subdivisions:X,minHeight:i,maxHeight:k,colorFilter:b,buffer:d,bufferWidth:t,bufferHeight:A,alphaFilter:Q,heightBuffer:F}).Ca(T,J),U&&U(T,F),T._setReady(!0)};if("string"===typeof t){const d=d=>{var t;const A=d.width,N=d.height;if(w.u)return;const p=null===(t=w)||void 0===t?void 0:t.getEngine().resizeImageBitmap(d,A,N);q(p,A,N)};a.g.LoadImage(t,d,A.onError?A.onError:()=>{},w.offlineProvider)}else q(t.data,t.width,t.height);return T}B.e.CreateGround=b,B.e.CreateTiledGround=Q,B.e.CreateGroundFromHeightMap=P,p.d.CreateGround=(d,t,A,w,N,p)=>J(d,{width:t,height:A,subdivisions:w,updatable:p},N),p.d.CreateTiledGround=(d,t,A,w,N,p,B,X,W)=>U(d,{xmin:t,zmin:A,xmax:w,zmax:N,subdivisions:p,precision:B,updatable:W},X),p.d.CreateGroundFromHeightMap=(d,t,A,w,N,p,B,X,W,a,D)=>T(d,t,{width:A,height:w,subdivisions:N,minHeight:p,maxHeight:B,updatable:W,onReady:a,alphaFilter:D},X)},12487:(d,t,A)=>{"use strict";A.d(t,{c:()=>L,g:()=>R,k:()=>Z});var w=A(11076),N=A(11309),p=A(11339),B=A(11094),X=A(11120),W=A(12065),a=A(11203),D=A(11097),i=A(11061),k=A(11264),b=A(10885),Q=A(11285),P=A(10767),J=A(11260),U=A(10775),T=A(11254),F=A(11246);const q={effect:null,subMesh:null};class H extends J.b{constructor(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(d,t,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new w.c,this._cachedWorldViewProjectionMatrix=new w.c,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=A,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","ab","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...N}}get shaderPath(){return this._shaderPath}set shaderPath(d){this._shaderPath=d}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(d){-1===this._options.uniforms.indexOf(d)&&this._options.uniforms.push(d)}setTexture(d,t){return-1===this._options.samplers.indexOf(d)&&this._options.samplers.push(d),this._textures[d]=t,this}removeTexture(d){delete this._textures[d]}setTextureArray(d,t){return-1===this._options.samplers.indexOf(d)&&this._options.samplers.push(d),this._checkUniform(d),this._textureArrays[d]=t,this}setExternalTexture(d,t){return-1===this._options.externalTextures.indexOf(d)&&this._options.externalTextures.push(d),this._externalTextures[d]=t,this}setFloat(d,t){return this._checkUniform(d),this._floats[d]=t,this}setInt(d,t){return this._checkUniform(d),this._ints[d]=t,this}setUInt(d,t){return this._checkUniform(d),this._uints[d]=t,this}setFloats(d,t){return this._checkUniform(d),this._floatsArrays[d]=t,this}setColor3(d,t){return this._checkUniform(d),this._colors3[d]=t,this}setColor3Array(d,t){return this._checkUniform(d),this._colors3Arrays[d]=t.reduce(((d,t)=>(t.toArray(d,d.length),d)),[]),this}setColor4(d,t){return this._checkUniform(d),this._colors4[d]=t,this}setColor4Array(d,t){return this._checkUniform(d),this._colors4Arrays[d]=t.reduce(((d,t)=>(t.toArray(d,d.length),d)),[]),this}setVector2(d,t){return this._checkUniform(d),this._vectors2[d]=t,this}setVector3(d,t){return this._checkUniform(d),this._vectors3[d]=t,this}setVector4(d,t){return this._checkUniform(d),this._vectors4[d]=t,this}setQuaternion(d,t){return this._checkUniform(d),this._quaternions[d]=t,this}setQuaternionArray(d,t){return this._checkUniform(d),this._quaternionsArrays[d]=t.reduce(((d,t)=>(t.toArray(d,d.length),d)),[]),this}setMatrix(d,t){return this._checkUniform(d),this._matrices[d]=t,this}setMatrices(d,t){this._checkUniform(d);const A=new Float32Array(16*t.length);for(let w=0;w<t.length;w++){t[w].copyToArray(A,16*w)}return this._matrixArrays[d]=A,this}setMatrix3x3(d,t){return this._checkUniform(d),this._matrices3x3[d]=t,this}setMatrix2x2(d,t){return this._checkUniform(d),this._matrices2x2[d]=t,this}setArray2(d,t){return this._checkUniform(d),this._vectors2Arrays[d]=t,this}setArray3(d,t){return this._checkUniform(d),this._vectors3Arrays[d]=t,this}setArray4(d,t){return this._checkUniform(d),this._vectors4Arrays[d]=t,this}setUniformBuffer(d,t){return-1===this._options.uniformBuffers.indexOf(d)&&this._options.uniformBuffers.push(d),this._uniformBuffers[d]=t,this}setTextureSampler(d,t){return-1===this._options.samplerObjects.indexOf(d)&&this._options.samplerObjects.push(d),this._textureSamplers[d]=t,this}setStorageBuffer(d,t){return-1===this._options.storageBuffers.indexOf(d)&&this._options.storageBuffers.push(d),this._storageBuffers[d]=t,this}setDefine(d,t){const A=d.trimEnd()+" ",w=this.options.defines.findIndex((t=>t===d||t.startsWith(A)));return w>=0&&this.options.defines.splice(w,1),("boolean"!==typeof t||t)&&this.options.defines.push(A+t),this}isReadyForSubMesh(d,t,A){return this.isReady(d,A,t)}isReady(d,t,A){var w;const N=A&&this._storeEffectOnSubMeshes;if(this.isFrozen){const d=N?A._drawWrapper:this._drawWrapper;if(d.effect&&d._wasPreviouslyReady&&d._wasPreviouslyUsingInstances===t)return!0}const p=this.va(),B=p.getEngine(),W=[],a=[],D=new Q.b;let k=this._shaderPath,b=this._options.uniforms,P=this._options.uniformBuffers,J=this._options.samplers;B.getCaps().multiview&&p.activeCamera&&p.activeCamera.outputRenderTarget&&p.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,W.push("#define MULTIVIEW"),-1!==b.indexOf("viewProjection")&&-1===b.indexOf("viewProjectionR")&&b.push("viewProjectionR"));for(let X=0;X<this._options.defines.length;X++){const d=0===this._options.defines[X].indexOf("#define")?this._options.defines[X]:`#define ${this._options.defines[X]}`;W.push(d)}for(let X=0;X<this._options.attributes.length;X++)a.push(this._options.attributes[X]);if(d&&d.isVerticesDataPresent(X.f.ColorKind)&&(-1===a.indexOf(X.f.ColorKind)&&a.push(X.f.ColorKind),W.push("#define VERTEXCOLOR")),t&&(W.push("#define INSTANCES"),(0,F.cb)(a,this._materialHelperNeedsPreviousMatrices),null!==d&&void 0!==d&&d.hasThinInstances&&(W.push("#define THIN_INSTANCES"),d&&d.isVerticesDataPresent(X.f.ColorInstanceKind)&&(a.push(X.f.ColorInstanceKind),W.push("#define INSTANCESCOLOR")))),d&&d.useBones&&d.computeBonesUsingShaders&&d.skeleton){a.push(X.f.MatricesIndicesKind),a.push(X.f.MatricesWeightsKind),d.numBoneInfluencers>4&&(a.push(X.f.MatricesIndicesExtraKind),a.push(X.f.MatricesWeightsExtraKind));const t=d.skeleton;W.push("#define NUM_BONE_INFLUENCERS "+d.numBoneInfluencers),D.addCPUSkinningFallback(0,d),t.isUsingTextureForMatrices?(W.push("#define BONETEXTURE"),-1===b.indexOf("boneTextureWidth")&&b.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(W.push("#define BonesPerMesh "+(t.bones.length+1)),-1===b.indexOf("mBones")&&b.push("mBones"))}else W.push("#define NUM_BONE_INFLUENCERS 0");let U=0;const H=d?d.morphTargetManager:null;if(H){const d=H.supportsUVs&&-1!==W.indexOf("#define UV1"),t=H.supportsTangents&&-1!==W.indexOf("#define TANGENT"),A=H.supportsNormals&&-1!==W.indexOf("#define NORMAL");U=H.numMaxInfluencers||H.numInfluencers,d&&W.push("#define MORPHTARGETS_UV"),t&&W.push("#define MORPHTARGETS_TANGENT"),A&&W.push("#define MORPHTARGETS_NORMAL"),U>0&&W.push("#define MORPHTARGETS"),H.isUsingTextureForTargets&&(W.push("#define MORPHTARGETS_TEXTURE"),-1===b.indexOf("morphTargetTextureIndices")&&b.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),W.push("#define NUM_MORPH_INFLUENCERS "+U);for(let w=0;w<U;w++)a.push(X.f.PositionKind+w),A&&a.push(X.f.NormalKind+w),t&&a.push(X.f.TangentKind+w),d&&a.push(X.f.UVKind+"_"+w);U>0&&(b=b.slice(),b.push("morphTargetInfluences"),b.push("morphTargetCount"),b.push("morphTargetTextureInfo"),b.push("morphTargetTextureIndices"))}else W.push("#define NUM_MORPH_INFLUENCERS 0");if(d){const t=d.bakedVertexAnimationManager;t&&t.isEnabled&&(W.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===b.indexOf("bakedVertexAnimationSettings")&&b.push("bakedVertexAnimationSettings"),-1===b.indexOf("bakedVertexAnimationTextureSizeInverted")&&b.push("bakedVertexAnimationTextureSizeInverted"),-1===b.indexOf("bakedVertexAnimationTime")&&b.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,F.u)(a,d,W)}for(const X in this._textures)if(!this._textures[X].isReady())return!1;d&&this._shouldTurnAlphaTestOn(d)&&W.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,T.e)(b),(0,T.l)(this,p,W)),p.fogEnabled&&null!==d&&void 0!==d&&d.applyFog&&p.fogMode!==i.e.FOGMODE_NONE&&(W.push("#define FOG"),-1===b.indexOf("view")&&b.push("view"),-1===b.indexOf("vFogInfos")&&b.push("vFogInfos"),-1===b.indexOf("vFogColor")&&b.push("vFogColor")),this._useLogarithmicDepth&&(W.push("#define LOGARITHMICDEPTH"),-1===b.indexOf("logarithmicDepthConstant")&&b.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(b=b.slice(),P=P.slice(),J=J.slice(),k=this.customShaderNameResolve(this.name,b,P,J,W,a));const f=N?A._getDrawWrapper(void 0,!0):this._drawWrapper,v=(null===f||void 0===f?void 0:f.effect)??null,m=(null===f||void 0===f?void 0:f.defines)??null,j=W.join("\n");let n=v;return m!==j&&(n=B.createEffect(k,{attributes:a,uniformsNames:b,uniformBuffersNames:P,samplers:J,defines:j,fallbacks:D,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:U},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},B),N?A.setEffect(n,j,this._materialContext):f&&f.setEffect(n,j),this._onEffectCreatedObservable&&(q.effect=n,q.subMesh=A??(null===d||void 0===d?void 0:d.If[0])??null,this._onEffectCreatedObservable.notifyObservers(q))),f._wasPreviouslyUsingInstances=!!t,!((null===(w=n)||void 0===w||!w.isReady())??1)&&(v!==n&&p.resetCachedMaterial(),f._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(d,t){const A=this.va(),w=t??this.getEffect();w&&(-1!==this._options.uniforms.indexOf("world")&&w.setMatrix("world",d),-1!==this._options.uniforms.indexOf("worldView")&&(d.multiplyToRef(A.getViewMatrix(),this._cachedWorldViewMatrix),w.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(d.multiplyToRef(A.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),w.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&w.setMatrix("view",A.getViewMatrix()))}bindForSubMesh(d,t,A){var w;this.bind(d,t,null===(w=A._drawWrapperOverride)||void 0===w?void 0:w.effect,A)}bind(d,t,A,w){const N=w&&this._storeEffectOnSubMeshes,p=A??(N?w.effect:this.getEffect());if(!p)return;const B=this.va();this._activeEffect=p,this.bindOnlyWorldMatrix(d,A);const X=this._options.uniformBuffers;let W=!1;if(p&&X&&X.length>0&&B.getEngine().supportsUniformBuffers)for(let i=0;i<X.length;++i){switch(X[i]){case"Mesh":t&&(t.getMeshUniformBuffer().bindToEffect(p,"Mesh"),t.transferToEffect(d));break;case"Scene":(0,F.n)(p,B.getSceneUniformBuffer()),B.finalizeSceneUbo(),W=!0}}const a=t&&N?this._mustRebind(B,p,w,t.visibility):B.getCachedMaterial()!==this;if(p&&a){let d;for(d in W||-1===this._options.uniforms.indexOf("view")||p.setMatrix("view",B.getViewMatrix()),W||-1===this._options.uniforms.indexOf("projection")||p.setMatrix("projection",B.getProjectionMatrix()),W||-1===this._options.uniforms.indexOf("viewProjection")||(p.setMatrix("viewProjection",B.getTransformMatrix()),this._multiview&&p.setMatrix("viewProjectionR",B._transformMatrixR)),B.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&p.setVector3("cameraPosition",B.activeCamera.globalPosition),(0,F.c)(t,p),(0,T.g)(p,this,B),this._useLogarithmicDepth&&(0,F.k)(N?w.materialDefines:p.defines,p,B),t&&(0,F.e)(B,t,p),this._textures)p.setTexture(d,this._textures[d]);for(d in this._textureArrays)p.setTextureArray(d,this._textureArrays[d]);for(d in this._ints)p.setInt(d,this._ints[d]);for(d in this._uints)p.setUInt(d,this._uints[d]);for(d in this._floats)p.setFloat(d,this._floats[d]);for(d in this._floatsArrays)p.setArray(d,this._floatsArrays[d]);for(d in this._colors3)p.setColor3(d,this._colors3[d]);for(d in this._colors3Arrays)p.setArray3(d,this._colors3Arrays[d]);for(d in this._colors4){const t=this._colors4[d];p.setFloat4(d,t.r,t.g,t.b,t.a)}for(d in this._colors4Arrays)p.setArray4(d,this._colors4Arrays[d]);for(d in this._vectors2)p.setVector2(d,this._vectors2[d]);for(d in this._vectors3)p.setVector3(d,this._vectors3[d]);for(d in this._vectors4)p.setVector4(d,this._vectors4[d]);for(d in this._quaternions)p.setQuaternion(d,this._quaternions[d]);for(d in this._matrices)p.setMatrix(d,this._matrices[d]);for(d in this._matrixArrays)p.setMatrices(d,this._matrixArrays[d]);for(d in this._matrices3x3)p.setMatrix3x3(d,this._matrices3x3[d]);for(d in this._matrices2x2)p.setMatrix2x2(d,this._matrices2x2[d]);for(d in this._vectors2Arrays)p.setArray2(d,this._vectors2Arrays[d]);for(d in this._vectors3Arrays)p.setArray3(d,this._vectors3Arrays[d]);for(d in this._vectors4Arrays)p.setArray4(d,this._vectors4Arrays[d]);for(d in this._quaternionsArrays)p.setArray4(d,this._quaternionsArrays[d]);for(d in this._uniformBuffers){const t=this._uniformBuffers[d].getBuffer();t&&p.bindUniformBuffer(t,d)}const A=B.getEngine(),X=A.setExternalTexture;if(X)for(d in this._externalTextures)X.call(A,d,this._externalTextures[d]);const a=A.setTextureSampler;if(a)for(d in this._textureSamplers)a.call(A,d,this._textureSamplers[d]);const D=A.setStorageBuffer;if(D)for(d in this._storageBuffers)D.call(A,d,this._storageBuffers[d])}if(p&&t&&(a||!this.isFrozen)){const d=t.morphTargetManager;d&&d.numInfluencers>0&&(0,F.l)(t,p);const A=t.bakedVertexAnimationManager;if(A&&A.isEnabled){var D;const d=N?w._drawWrapper:this._drawWrapper;null===(D=t.bakedVertexAnimationManager)||void 0===D||D.bind(p,!!d._wasPreviouslyUsingInstances)}}this._afterBind(t,p,w)}getActiveTextures(){const d=super.getActiveTextures();for(const t in this._textures)d.push(this._textures[t]);for(const t in this._textureArrays){const A=this._textureArrays[t];for(let t=0;t<A.length;t++)d.push(A[t])}return d}hasTexture(d){if(super.hasTexture(d))return!0;for(const t in this._textures)if(this._textures[t]===d)return!0;for(const t in this._textureArrays){const A=this._textureArrays[t];for(let t=0;t<A.length;t++)if(A[t]===d)return!0}return!1}clone(d){const t=D.d.Clone((()=>new H(d,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);t.name=d,t.id=d,"object"===typeof t._shaderPath&&(t._shaderPath={...t._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((d=>{const t=this._options[d];Array.isArray(t)&&(this._options[d]=t.slice(0))})),this.stencil.copyTo(t.stencil);for(const A in this._textures)t.setTexture(A,this._textures[A]);for(const A in this._textureArrays)t.setTextureArray(A,this._textureArrays[A]);for(const A in this._externalTextures)t.setExternalTexture(A,this._externalTextures[A]);for(const A in this._ints)t.setInt(A,this._ints[A]);for(const A in this._uints)t.setUInt(A,this._uints[A]);for(const A in this._floats)t.setFloat(A,this._floats[A]);for(const A in this._floatsArrays)t.setFloats(A,this._floatsArrays[A]);for(const A in this._colors3)t.setColor3(A,this._colors3[A]);for(const A in this._colors3Arrays)t._colors3Arrays[A]=this._colors3Arrays[A];for(const A in this._colors4)t.setColor4(A,this._colors4[A]);for(const A in this._colors4Arrays)t._colors4Arrays[A]=this._colors4Arrays[A];for(const A in this._vectors2)t.setVector2(A,this._vectors2[A]);for(const A in this._vectors3)t.setVector3(A,this._vectors3[A]);for(const A in this._vectors4)t.setVector4(A,this._vectors4[A]);for(const A in this._quaternions)t.setQuaternion(A,this._quaternions[A]);for(const A in this._quaternionsArrays)t._quaternionsArrays[A]=this._quaternionsArrays[A];for(const A in this._matrices)t.setMatrix(A,this._matrices[A]);for(const A in this._matrixArrays)t._matrixArrays[A]=this._matrixArrays[A].slice();for(const A in this._matrices3x3)t.setMatrix3x3(A,this._matrices3x3[A]);for(const A in this._matrices2x2)t.setMatrix2x2(A,this._matrices2x2[A]);for(const A in this._vectors2Arrays)t.setArray2(A,this._vectors2Arrays[A]);for(const A in this._vectors3Arrays)t.setArray3(A,this._vectors3Arrays[A]);for(const A in this._vectors4Arrays)t.setArray4(A,this._vectors4Arrays[A]);for(const A in this._uniformBuffers)t.setUniformBuffer(A,this._uniformBuffers[A]);for(const A in this._textureSamplers)t.setTextureSampler(A,this._textureSamplers[A]);for(const A in this._storageBuffers)t.setStorageBuffer(A,this._storageBuffers[A]);return t}dispose(d,t,A){if(t){let d;for(d in this._textures)this._textures[d].dispose();for(d in this._textureArrays){const t=this._textureArrays[d];for(let d=0;d<t.length;d++)t[d].dispose()}}this._textures={},super.dispose(d,t,A)}serialize(){const d=D.d.Serialize(this);let t;for(t in d.customType="BABYLON.ShaderMaterial",d.uniqueId=this.uniqueId,d.options=this._options,d.shaderPath=this._shaderPath,d.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,d.stencil=this.stencil.serialize(),d.textures={},this._textures)d.textures[t]=this._textures[t].serialize();for(t in d.textureArrays={},this._textureArrays){d.textureArrays[t]=[];const A=this._textureArrays[t];for(let w=0;w<A.length;w++)d.textureArrays[t].push(A[w].serialize())}for(t in d.ints={},this._ints)d.ints[t]=this._ints[t];for(t in d.uints={},this._uints)d.uints[t]=this._uints[t];for(t in d.floats={},this._floats)d.floats[t]=this._floats[t];for(t in d.floatsArrays={},this._floatsArrays)d.floatsArrays[t]=this._floatsArrays[t];for(t in d.colors3={},this._colors3)d.colors3[t]=this._colors3[t].gj();for(t in d.colors3Arrays={},this._colors3Arrays)d.colors3Arrays[t]=this._colors3Arrays[t];for(t in d.colors4={},this._colors4)d.colors4[t]=this._colors4[t].gj();for(t in d.colors4Arrays={},this._colors4Arrays)d.colors4Arrays[t]=this._colors4Arrays[t];for(t in d.vectors2={},this._vectors2)d.vectors2[t]=this._vectors2[t].gj();for(t in d.vectors3={},this._vectors3)d.vectors3[t]=this._vectors3[t].gj();for(t in d.vectors4={},this._vectors4)d.vectors4[t]=this._vectors4[t].gj();for(t in d.quaternions={},this._quaternions)d.quaternions[t]=this._quaternions[t].gj();for(t in d.matrices={},this._matrices)d.matrices[t]=this._matrices[t].gj();for(t in d.matrixArray={},this._matrixArrays)d.matrixArray[t]=this._matrixArrays[t];for(t in d.matrices3x3={},this._matrices3x3)d.matrices3x3[t]=this._matrices3x3[t];for(t in d.matrices2x2={},this._matrices2x2)d.matrices2x2[t]=this._matrices2x2[t];for(t in d.vectors2Arrays={},this._vectors2Arrays)d.vectors2Arrays[t]=this._vectors2Arrays[t];for(t in d.vectors3Arrays={},this._vectors3Arrays)d.vectors3Arrays[t]=this._vectors3Arrays[t];for(t in d.vectors4Arrays={},this._vectors4Arrays)d.vectors4Arrays[t]=this._vectors4Arrays[t];for(t in d.quaternionsArrays={},this._quaternionsArrays)d.quaternionsArrays[t]=this._quaternionsArrays[t];return d}static Parse(d,t,A){const N=D.d.Parse((()=>new H(d.name,t,d.shaderPath,d.options,d.storeEffectOnSubMeshes)),d,t,A);let p;for(p in d.stencil&&N.stencil.parse(d.stencil,t,A),d.textures)N.setTexture(p,k.c.Parse(d.textures[p],t,A));for(p in d.textureArrays){const w=d.textureArrays[p],B=[];for(let d=0;d<w.length;d++)B.push(k.c.Parse(w[d],t,A));N.setTextureArray(p,B)}for(p in d.ints)N.setInt(p,d.ints[p]);for(p in d.uints)N.setUInt(p,d.uints[p]);for(p in d.floats)N.setFloat(p,d.floats[p]);for(p in d.floatsArrays)N.setFloats(p,d.floatsArrays[p]);for(p in d.colors3)N.setColor3(p,B.e.Lg(d.colors3[p]));for(p in d.colors3Arrays){const t=d.colors3Arrays[p].reduce(((d,t,A)=>(A%3===0?d.push([t]):d[d.length-1].push(t),d)),[]).map((d=>B.e.Lg(d)));N.setColor3Array(p,t)}for(p in d.colors4)N.setColor4(p,B.i.Lg(d.colors4[p]));for(p in d.colors4Arrays){const t=d.colors4Arrays[p].reduce(((d,t,A)=>(A%4===0?d.push([t]):d[d.length-1].push(t),d)),[]).map((d=>B.i.Lg(d)));N.setColor4Array(p,t)}for(p in d.vectors2)N.setVector2(p,w.j.Lg(d.vectors2[p]));for(p in d.vectors3)N.setVector3(p,w.l.Lg(d.vectors3[p]));for(p in d.vectors4)N.setVector4(p,w.m.Lg(d.vectors4[p]));for(p in d.quaternions)N.setQuaternion(p,w.f.Lg(d.quaternions[p]));for(p in d.matrices)N.setMatrix(p,w.c.Lg(d.matrices[p]));for(p in d.matrixArray)N._matrixArrays[p]=new Float32Array(d.matrixArray[p]);for(p in d.matrices3x3)N.setMatrix3x3(p,d.matrices3x3[p]);for(p in d.matrices2x2)N.setMatrix2x2(p,d.matrices2x2[p]);for(p in d.vectors2Arrays)N.setArray2(p,d.vectors2Arrays[p]);for(p in d.vectors3Arrays)N.setArray3(p,d.vectors3Arrays[p]);for(p in d.vectors4Arrays)N.setArray4(p,d.vectors4Arrays[p]);for(p in d.quaternionsArrays)N.setArray4(p,d.quaternionsArrays[p]);return N}static ParseFromFileAsync(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((N,p)=>{const B=new P.b;B.addEventListener("readystatechange",(()=>{if(4==B.readyState)if(200==B.status){const t=JSON.parse(B.responseText),p=this.Parse(t,A||U.e.LastCreatedScene,w);d&&(p.name=d),N(p)}else p("Unable to load the ShaderMaterial")})),B.open("GET",t),B.send()}))}static ParseFromSnippetAsync(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((w,N)=>{const p=new P.b;p.addEventListener("readystatechange",(()=>{if(4==p.readyState)if(200==p.status){const N=JSON.parse(JSON.parse(p.responseText).jsonPayload),B=JSON.parse(N.shaderMaterial),X=this.Parse(B,t||U.e.LastCreatedScene,A);X.snippetId=d,w(X)}else N("Unable to load the snippet "+d)})),p.open("GET",this.SnippetUrl+"/"+d.replace(/#/g,"/")),p.send()}))}}H.SnippetUrl="https://snippet.babylonjs.com",H.CreateFromSnippetAsync=H.ParseFromSnippetAsync,(0,b.g)("BABYLON.ShaderMaterial",H),N.d._LinesMeshParser=(d,t)=>f.Parse(d,t);class f extends N.d{_isShaderMaterial(d){return"ShaderMaterial"===d.getClassName()}constructor(d){let t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,w=arguments.length>5?arguments[5]:void 0,N=arguments.length>6?arguments[6]:void 0,p=arguments.length>7?arguments[7]:void 0;super(d,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t,arguments.length>4?arguments[4]:void 0),this.useVertexColor=w,this.useVertexAlpha=N,this.color=new B.e(1,1,1),this.alpha=1,this._shaderLanguage=0,t&&(this.color=t.color.clone(),this.alpha=t.alpha,this.useVertexColor=t.useVertexColor,this.useVertexAlpha=t.useVertexAlpha),this.intersectionThreshold=.1;const W={attributes:[X.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===N?W.needAlphaBlending=!1:W.defines.push("#define VERTEXALPHA"),w?(W.defines.push("#define VERTEXCOLOR"),W.attributes.push(X.f.ColorKind)):(W.uniforms.push("color"),this._color4=new B.i),p)this.material=p;else{this.va().getEngine().isWebGPU&&!f.ForceGLSL&&(this._shaderLanguage=1),W.shaderLanguage=this._shaderLanguage,W.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([A.e(23).then(A.bind(A,13341)),A.e(47).then(A.bind(A,13347))]):await Promise.all([A.e(28).then(A.bind(A,13350)),A.e(48).then(A.bind(A,13356))])},this.material=new H("colorShader",this.va(),"color",W,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(d){this._lineMaterial=d,this._lineMaterial.fillMode=a.c.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(d){}_bind(d,t){if(!this._geometry)return this;const A=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(t,A):this._geometry._bind(t,A,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:d,g:t,b:A}=this.color;this._color4.set(d,t,A,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(d,t,A){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const w=this.va().getEngine();return this._unIndexed?w.drawArraysType(a.c.LineListDrawMode,d.verticesStart,d.verticesCount,A):w.drawElementsType(a.c.LineListDrawMode,d.indexStart,d.indexCount,A),this}dispose(d){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(d)}clone(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;return new f(d,this.va(),t,this,A)}qd(d){const t=new v(d,this);if(this.instancedBuffers){t.instancedBuffers={};for(const d in this.instancedBuffers)t.instancedBuffers[d]=this.instancedBuffers[d]}return t}serialize(d){super.serialize(d),d.color=this.color.gj(),d.alpha=this.alpha}static Parse(d,t){const A=new f(d.name,t);return A.color=B.e.Lg(d.color),A.alpha=d.alpha,A}}f.ForceGLSL=!1;class v extends W.b{constructor(d,t){super(d,t),this.intersectionThreshold=t.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var m=A(10740);function j(d){const t=[],A=[],w=d.lines,N=d.za,B=[];let X=0;for(let p=0;p<w.length;p++){const d=w[p];for(let w=0;w<d.length;w++){const{x:W,y:a,z:D}=d[w];if(A.push(W,a,D),N){const d=N[p],{r:t,g:A,b:X,a:W}=d[w];B.push(t,A,X,W)}w>0&&(t.push(X-1),t.push(X)),X++}}const W=new p.e;return W.indices=t,W.xa=A,N&&(W.za=B),W}function n(d){const t=d.dashSize||3,A=d.gapSize||1,N=d.dashNb||200,B=d.points,X=[],W=[],a=w.l.Zero();let D=0,i=0,k=0,b=0,Q=0,P=0,J=0;for(J=0;J<B.length-1;J++)B[J+1].subtractToRef(B[J],a),D+=a.length();for(k=D/N,b=t*k/(t+A),J=0;J<B.length-1;J++){B[J+1].subtractToRef(B[J],a),i=Math.floor(a.length()/k),a.normalize();for(let d=0;d<i;d++)Q=k*d,X.push(B[J].x+Q*a.x,B[J].y+Q*a.y,B[J].z+Q*a.z),X.push(B[J].x+(Q+b)*a.x,B[J].y+(Q+b)*a.y,B[J].z+(Q+b)*a.z),W.push(P,P+1),P+=2}const U=new p.e;return U.xa=X,U.indices=W,U}function R(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=t.instance,N=t.lines,p=t.za;if(w){const d=w.getVerticesData(X.f.PositionKind);let t,A;p&&(t=w.getVerticesData(X.f.ColorKind));let B=0,W=0;for(let w=0;w<N.length;w++){const X=N[w];for(let N=0;N<X.length;N++)d[B]=X[N].x,d[B+1]=X[N].y,d[B+2]=X[N].z,p&&t&&(A=p[w],t[W]=A[N].r,t[W+1]=A[N].g,t[W+2]=A[N].b,t[W+3]=A[N].a,W+=4),B+=3}return w.updateVerticesData(X.f.PositionKind,d,!1,!1),p&&t&&w.updateVerticesData(X.f.ColorKind,t,!1,!1),w.refreshBoundingInfo(),w}const B=new f(d,A,null,void 0,void 0,!!p,t.useVertexAlpha,t.material);return j(t).Ca(B,t.updatable),B}function Z(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=t.za?[t.za]:null;return R(d,{lines:[t.points],updatable:t.updatable,instance:t.instance,za:w,useVertexAlpha:t.useVertexAlpha,material:t.material},A)}function L(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=t.points,B=t.instance,X=t.gapSize||1,W=t.dashSize||3;if(B){const d=d=>{const t=w.l.Zero(),A=d.length/6;let N=0,X=0,W=0,a=0,D=0,i=0,k=0,b=0;for(k=0;k<p.length-1;k++)p[k+1].subtractToRef(p[k],t),N+=t.length();W=N/A;const Q=B._creationDataStorage.dashSize;for(a=Q*W/(Q+B._creationDataStorage.gapSize),k=0;k<p.length-1;k++)for(p[k+1].subtractToRef(p[k],t),X=Math.floor(t.length()/W),t.normalize(),b=0;b<X&&i<d.length;)D=W*b,d[i]=p[k].x+D*t.x,d[i+1]=p[k].y+D*t.y,d[i+2]=p[k].z+D*t.z,d[i+3]=p[k].x+(D+a)*t.x,d[i+4]=p[k].y+(D+a)*t.y,d[i+5]=p[k].z+(D+a)*t.z,i+=6,b++;for(;i<d.length;)d[i]=p[k].x,d[i+1]=p[k].y,d[i+2]=p[k].z,i+=3};return(t.dashNb||t.dashSize||t.gapSize||t.useVertexAlpha||t.material)&&m.e.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),B.updateMeshPositions(d,!1),B}const a=new f(d,A,null,void 0,void 0,void 0,t.useVertexAlpha,t.material);return n(t).Ca(a,t.updatable),a._creationDataStorage=new N.f,a._creationDataStorage.dashSize=W,a._creationDataStorage.gapSize=X,a}p.e.CreateLineSystem=j,p.e.CreateDashedLines=n,N.d.sb=function(d,t){return Z(d,{points:t,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},N.d.CreateDashedLines=function(d,t,A,w,N){return L(d,{points:t,dashSize:A,gapSize:w,dashNb:N,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11424:(d,t,A)=>{"use strict";A.d(t,{b:()=>X,c:()=>W});var w=A(11309),N=A(11339),p=A(11271);function B(d){const t=[],A=[],w=[],B=[],X=d.width||d.size||1,W=d.height||d.size||1,a=0===d.sideOrientation?0:d.sideOrientation||N.e.DEFAULTSIDE,D=X/2,i=W/2;A.push(-D,-i,0),w.push(0,0,-1),B.push(0,p.e?1:0),A.push(D,-i,0),w.push(0,0,-1),B.push(1,p.e?1:0),A.push(D,i,0),w.push(0,0,-1),B.push(1,p.e?0:1),A.push(-D,i,0),w.push(0,0,-1),B.push(0,p.e?0:1),t.push(0),t.push(1),t.push(2),t.push(0),t.push(2),t.push(3),N.e._ComputeSides(a,A,t,w,B,d.frontUVs,d.backUVs);const k=new N.e;return k.indices=t,k.xa=A,k.ya=w,k.Aa=B,k}function X(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const N=new w.d(d,A);t.sideOrientation=w.d._GetDefaultSideOrientation(t.sideOrientation),N._originalBuilderSideOrientation=t.sideOrientation;return B(t).Ca(N,t.updatable),t.sourcePlane&&(N.translate(t.sourcePlane.ab,-t.sourcePlane.d),N.setDirection(t.sourcePlane.ab.scale(-1))),N}const W={Nf:X};N.e.Nf=B,w.d.Nf=(d,t,A,w,N)=>X(d,{size:t,width:t,height:t,sideOrientation:N,updatable:w},A)},11710:(d,t,A)=>{"use strict";A.d(t,{b:()=>W});var w=A(11076),N=A(11309),p=A(11339),B=A(11271);function X(d){const t=0|(d.segments||32),A=d.diameterX||d.diameter||1,N=d.diameterY||d.diameter||1,X=d.diameterZ||d.diameter||1,W=d.arc&&(d.arc<=0||d.arc>1)?1:d.arc||1,a=d.slice&&d.slice<=0?1:d.slice||1,D=0===d.sideOrientation?0:d.sideOrientation||p.e.DEFAULTSIDE,i=!!d.dedupTopBottomIndices,k=new w.l(A/2,N/2,X/2),b=2+t,Q=2*b,P=[],J=[],U=[],T=[];for(let p=0;p<=b;p++){const d=p/b,t=d*Math.PI*a;for(let A=0;A<=Q;A++){const N=A/Q,p=N*Math.PI*2*W,X=w.c.RotationZ(-t),a=w.c.RotationY(p),D=w.l.TransformCoordinates(w.l.Up(),X),i=w.l.TransformCoordinates(D,a),b=i.multiply(k),P=i.divide(k).normalize();J.push(b.x,b.y,b.z),U.push(P.x,P.y,P.z),T.push(N,B.e?1-d:d)}if(p>0){const d=J.length/3;for(let t=d-2*(Q+1);t+Q+2<d;t++)i?(p>1&&(P.push(t),P.push(t+1),P.push(t+Q+1)),(p<b||a<1)&&(P.push(t+Q+1),P.push(t+1),P.push(t+Q+2))):(P.push(t),P.push(t+1),P.push(t+Q+1),P.push(t+Q+1),P.push(t+1),P.push(t+Q+2))}}p.e._ComputeSides(D,J,P,U,T,d.frontUVs,d.backUVs);const F=new p.e;return F.indices=P,F.xa=J,F.ya=U,F.Aa=T,F}function W(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new N.d(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return X(t).Ca(w,t.updatable),w}p.e.CreateSphere=X,N.d.CreateSphere=(d,t,A,w,N,p)=>W(d,{segments:t,diameterX:A,diameterY:A,diameterZ:A,sideOrientation:p,updatable:N},w)},12099:(d,t,A)=>{"use strict";A.d(t,{d:()=>i});var w=A(10727),N=A(12104),p=A(11342),B=A(11120),X=A(11339),W=A(10740);function a(d,t,A,w,N){let p=null,B=null,X=null;try{let W;p=new d.Decoder,B=new d.DecoderBuffer,B.Init(t,t.byteLength);const a=p.GetEncodedGeometryType(B);switch(a){case d.TRIANGULAR_MESH:{const t=new d.Mesh;if(W=p.DecodeBufferToMesh(B,t),!W.ok()||0===t.ptr)throw new Error(W.error_msg());const A=3*t.num_faces(),N=4*A,a=d._malloc(N);try{p.GetTrianglesUInt32Array(t,N,a);const B=new Uint32Array(A);B.set(new Uint32Array(d.HEAPF32.buffer,a,A)),w(B)}finally{d._free(a)}X=t;break}case d.POINT_CLOUD:{const t=new d.PointCloud;if(W=p.DecodeBufferToPointCloud(B,t),!W.ok()||!t.ptr)throw new Error(W.error_msg());X=t;break}default:throw new Error(`Invalid geometry type ${a}`)}const D=X.num_points(),i=(t,A,w,p)=>{const B=p.data_type(),X=p.num_components(),W=p.normalized(),a=p.byte_stride(),i=p.byte_offset(),k={[d.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:d.HEAPF32},[d.DT_INT8]:{typedArrayConstructor:Int8Array,heap:d.HEAP8},[d.DT_INT16]:{typedArrayConstructor:Int16Array,heap:d.HEAP16},[d.DT_INT32]:{typedArrayConstructor:Int32Array,heap:d.HEAP32},[d.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:d.HEAPU8},[d.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:d.HEAPU16},[d.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:d.HEAPU32}}[B];if(!k)throw new Error(`Invalid data type ${B}`);const b=D*X,Q=b*k.typedArrayConstructor.BYTES_PER_ELEMENT,P=d._malloc(Q);try{t.GetAttributeDataArrayForAllPoints(A,p,B,Q,P);const d=new k.typedArrayConstructor(k.heap.buffer,P,b);N(w,d.slice(),X,i,a,W)}finally{d._free(P)}};if(A)for(const d in A){const t=A[d],w=p.GetAttributeByUniqueId(X,t);i(p,X,d,w)}else{const t={position:d.POSITION,ab:d.NORMAL,color:d.COLOR,uv:d.TEX_COORD};for(const d in t){const A=p.GetAttributeId(X,t[d]);if(-1!==A){const t=p.GetAttribute(X,A);i(p,X,d,t)}}}return D}finally{X&&d.destroy(X),B&&d.destroy(B),p&&d.destroy(p)}}function D(){let d;onmessage=t=>{const A=t.data;switch(A.id){case"init":{const t=A.decoder;t.url&&importScripts(t.url);const w=t.wasmBinary?{wasmBinary:t.wasmBinary}:{};d=DracoDecoderModule(w),postMessage({id:"initDone"});break}case"decodeMesh":if(!d)throw new Error("Draco decoder module is not available");d.then((d=>{const t=a(d,A.dataView,A.attributes,(d=>{postMessage({id:"indices",data:d},[d.buffer])}),((d,t,A,w,N,p)=>{postMessage({id:"attribute",kind:d,data:t,size:A,byteOffset:w,byteStride:N,normalized:p},[t.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:t})}))}}}class i{static get DecoderAvailable(){const d=i.Configuration.decoder;return!!(d.wasmUrl&&d.wasmBinaryUrl&&"object"===typeof WebAssembly||d.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return i._Default||(i._Default=new i),i._Default}static ResetDefault(d){i._Default&&(d||i._Default.dispose(),i._Default=null)}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.DefaultNumWorkers;const t=i.Configuration.decoder;if(t.workerPool||"object"===typeof d&&d.workerPool)this._workerPoolPromise=Promise.resolve(t.workerPool||d.workerPool);else{const A=t.wasmBinary||"object"===typeof d&&d.wasmBinary,p="number"===typeof d?d:d.numWorkers,B=p&&"function"===typeof Worker&&"function"===typeof URL,X=B||!B&&!t.jsModule,W=t.wasmUrl&&t.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:X?w.g.GetBabylonScriptURL(t.wasmUrl,!0):"",wasmBinaryPromise:A?Promise.resolve(A):w.g.LoadFileAsync(w.g.GetBabylonScriptURL(t.wasmBinaryUrl,!0))}:{url:X?w.g.GetBabylonScriptURL(t.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};B?this._workerPoolPromise=W.wasmBinaryPromise.then((d=>{const t=`${a}(${D})()`,A=URL.createObjectURL(new Blob([t],{type:"application/javascript"}));return new N.d(p,(()=>function(d,t,A){return new Promise(((w,N)=>{const p=t=>{d.removeEventListener("error",p),d.removeEventListener("message",B),N(t)},B=t=>{"initDone"===t.data.id&&(d.removeEventListener("error",p),d.removeEventListener("message",B),w(d))};if(d.addEventListener("error",p),d.addEventListener("message",B),t){const w=t.slice(0);d.postMessage({id:"init",decoder:{url:A,wasmBinary:w}},[w])}else d.postMessage({id:"init",decoder:{url:A}})}))}(new Worker(A),d,W.url)))})):this._decoderModulePromise=W.wasmBinaryPromise.then((async d=>{if("undefined"===typeof DracoDecoderModule&&!t.jsModule){if(!W.url)throw new Error("Draco decoder module is not available");await w.g.LoadBabylonScriptAsync(W.url)}return await(A=d,N=t.jsModule,new Promise((d=>{(N||DracoDecoderModule)({wasmBinary:A}).then((t=>{d({module:t})}))})));var A,N}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((d=>{d.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(d,t,A){const w=d instanceof ArrayBuffer?new Int8Array(d):new Int8Array(d.buffer,d.byteOffset,d.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((d=>new Promise(((N,p)=>{d.push(((d,B)=>{let X=null;const a=[],D=t=>{d.removeEventListener("error",D),d.removeEventListener("message",i),p(t),B()},i=t=>{const w=t.data;switch(w.id){case"decodeMeshDone":d.removeEventListener("error",D),d.removeEventListener("message",i),N({indices:X,attributes:a,totalVertices:w.totalVertices}),B();break;case"indices":X=w.data;break;case"attribute":a.push({kind:w.kind,data:w.data,size:w.size,byteOffset:w.byteOffset,byteStride:w.byteStride,normalized:(p=w.kind,k=w.normalized,A&&void 0!==A[p]?(k!==A[p]&&W.e.Warn(`Normalized flag from Draco data (${k}) does not match normalized flag from glTF accessor (${A[p]}). Using flag from glTF accessor.`),A[p]):k)})}var p,k};d.addEventListener("error",D),d.addEventListener("message",i);const k=w.slice();d.postMessage({id:"decodeMesh",dataView:k,attributes:t},[k.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((d=>{let A=null;const N=[],p=a(d.module,w,t,(d=>{A=d}),((d,t,A,w,p,B)=>{N.push({kind:d,data:t,size:A,byteOffset:w,byteStride:p,normalized:B})}));return{indices:A,attributes:N,totalVertices:p}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(d,t,A,w){const N=await this.decodeMeshToMeshDataAsync(A,w),X=new p.c(d,t);N.indices&&X.setIndices(N.indices);for(const p of N.attributes)X.setVerticesBuffer(new B.f(t.getEngine(),p.data,p.kind,!1,void 0,p.byteStride,void 0,p.byteOffset,p.size,void 0,p.normalized,!0),N.totalVertices);return X}async _decodeMeshToGeometryForGltfAsync(d,t,A,w,N){const X=await this.decodeMeshToMeshDataAsync(A,w,N),W=new p.c(d,t);X.indices&&W.setIndices(X.indices);for(const p of X.attributes)W.setVerticesBuffer(new B.f(t.getEngine(),p.data,p.kind,!1,void 0,p.byteStride,void 0,p.byteOffset,p.size,void 0,p.normalized,!0),X.totalVertices);return W}async decodeMeshAsync(d,t){const A=await this.decodeMeshToMeshDataAsync(d,t),w=new X.e;A.indices&&(w.indices=A.indices);for(const N of A.attributes){const d=B.f.GetFloatData(N.data,N.size,B.f.GetDataType(N.data),N.byteOffset,N.byteStride,N.normalized,A.totalVertices);w.set(d,N.kind)}return w}}i.Configuration={decoder:{wasmUrl:`${w.g._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${w.g._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${w.g._DefaultCdnUrl}/draco_decoder_gltf.js`}},i.DefaultNumWorkers=i.GetDefaultNumWorkers(),i._Default=null},11488:(d,t,A)=>{"use strict";A.d(t,{b:()=>N});var w=A(11128);class N extends w.c{constructor(d){super(),this._buffer=d}get underlyingResource(){return this._buffer}}},11350:(d,t,A)=>{"use strict";A.d(t,{d:()=>v});var w=A(11041),N=A(10730),p=A(11076),B=A(11120),X=A(11339),W=A(11353),a=A(11115),D=A(11221),i=A(11108);class k{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new p.l(0,0,0),this._diffPositionForCollisions=new p.l(0,0,0),this._collisionResponse=!0}}var b=A(10761),Q=A(11232),P=A(11094),J=A(11079),U=A(11359),T=A(10885),F=A(11047),q=A(10824);class H{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=p.l.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class f{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new H,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new k,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class v extends W.e{static get BILLBOARDMODE_NONE(){return W.e.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return W.e.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return W.e.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return W.e.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return W.e.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return W.e.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(d){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=d}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(d){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=d}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(d){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=d}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(d){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=d}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(d){this._internalAbstractMeshDataInfo._collisionRetryCount=d}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(d){this._internalAbstractMeshDataInfo._morphTargetManager!==d&&(this._internalAbstractMeshDataInfo._morphTargetManager=d,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(d){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==d&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=d,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(d){return!!super._updateNonUniformScalingState(d)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(d){this._internalAbstractMeshDataInfo._rawBoundingInfo=d}set Jk(d){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(d)}set onCollisionPositionChange(d){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(d)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(d){if(this._internalAbstractMeshDataInfo._visibility===d)return;const t=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=d,(1===t&&1!==d||1!==t&&1===d)&&this._markSubMeshesAsDirty((d=>{d.markAsMiscDirty(),d.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(d){this._internalAbstractMeshDataInfo._inheritVisibility=d}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let d=this._parentNode;for(;d;){const t=d.isVisible;if("undefined"!==typeof t)return t;d=d.parent}}return this._isVisible}set isVisible(d){this._isVisible=d}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(d){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=d}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(d){this._internalAbstractMeshDataInfo._renderingGroupId=d}get material(){return this._internalAbstractMeshDataInfo._material}set material(d){this._setMaterial(d)}_setMaterial(d){this._internalAbstractMeshDataInfo._material!==d&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=d,d&&d.meshMap&&(d.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.If&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(d){var t;return null===(t=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===t?void 0:t[d]}setMaterialForRenderPass(d,t){this.resetDrawCache(d),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[d]=t}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(d){this._internalAbstractMeshDataInfo._receiveShadows!==d&&(this._internalAbstractMeshDataInfo._receiveShadows=d,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(d){this._internalAbstractMeshDataInfo._hasVertexAlpha!==d&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=d,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(d){this._internalAbstractMeshDataInfo._useVertexColors!==d&&(this._internalAbstractMeshDataInfo._useVertexColors=d,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(d){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==d&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=d,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(d){this._internalAbstractMeshDataInfo._numBoneInfluencers!==d&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=d,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(d){this._internalAbstractMeshDataInfo._applyFog!==d&&(this._internalAbstractMeshDataInfo._applyFog=d,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(d){this._internalAbstractMeshDataInfo._enableDistantPicking=d}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(d){d!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=d,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(d){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(d)?-1:d}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(d){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=d}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(d){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(d)?-1:d}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(d){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=d}get lightSources(){return this._lightSources}set skeleton(d){const t=this._internalAbstractMeshDataInfo._skeleton;t&&t.needInitialSkinMatrix&&t._unregisterMeshWithPoseMatrix(this),d&&d.needInitialSkinMatrix&&d._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=d,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(d){var t;let A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(d,A,!1),t=this,this._internalAbstractMeshDataInfo=new f,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.Bi=v.Ci,this.onCollideObservable=new N.b,this.onCollisionPositionChangeObservable=new N.b,this.onMaterialChangedObservable=new N.b,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.Be=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=P.e.Red(),this.outlineWidth=.02,this.overlayColor=P.e.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.rg=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new p.l(.5,1,.5),this.ellipsoidOffset=new p.l(0,0,0),this.edgesWidth=1,this.edgesColor=new P.i(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,Gh:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new N.b,this._onCollisionPositionChange=function(d,A){let w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;A.subtractToRef(t._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,t._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),t._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>q.c.CollisionsEpsilon&&t.position.addInPlace(t._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),w&&t.onCollideObservable.notifyObservers(w),t.onCollisionPositionChangeObservable.notifyObservers(t.position)},A=this.va(),A.ii(this),this._resyncLightSources(),this._uniformBuffer=new i.e(this.va().getEngine(),void 0,void 0,d,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),A.performancePriority){case 2:this.Da=!0;case 1:this.rg=!0,this.Be=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(d){const t=this._uniformBuffer;t.Fj("world",d),t.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),t.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(d){let t="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");t+=", # of submeshes: "+(this.If?this.If.length:0);const A=this._internalAbstractMeshDataInfo._skeleton;return A&&(t+=", skeleton: "+A.name),d&&(t+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],t+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.Gh?"YES":"NO")),t}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==W.e.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(t||this.actionManager.isRecursive)){if(!d)return this.actionManager;if(this.actionManager.hasSpecificTrigger(d))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(d,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.If){for(const d of this.If)d._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const d of this.va().lights)d.isEnabled()&&d.canAffectMesh(this)&&this._lightSources.push(d);this._markSubMeshesAsLightDirty()}_resyncLightSource(d){const t=d.isEnabled()&&d.canAffectMesh(this),A=this._lightSources.indexOf(d);let w=!1;if(-1===A){if(!t)return;this._lightSources.push(d)}else{if(t)return;w=!0,this._lightSources.splice(A,1)}this._markSubMeshesAsLightDirty(w)}_unBindEffect(){for(const d of this.If)d.setEffect(null)}_removeLightSource(d,t){const A=this._lightSources.indexOf(d);-1!==A&&(this._lightSources.splice(A,1),this._markSubMeshesAsLightDirty(t))}_markSubMeshesAsDirty(d){if(this.If)for(const t of this.If)for(let A=0;A<t._drawWrappers.length;++A){const w=t._drawWrappers[A];w&&w.defines&&w.defines.markAllAsDirty&&d(w.defines)}}_markSubMeshesAsLightDirty(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((t=>t.markAsLightDirty(d)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((d=>d.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((d=>d.markAsMiscDirty()))}Cg(d){return this._currentRenderId=Number.MAX_VALUE,super.Cg(d),this._isDirty=!0,this}resetDrawCache(d){if(this.If)for(const t of this.If)t.resetDrawCache(d)}get isBlocked(){return!1}getLOD(d){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}xf(){return null}getVerticesData(d){return null}Ga(d,t,A,w){return this}updateVerticesData(d,t,A,w){return this}setIndices(d,t){return this}isVerticesDataPresent(d){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(d){return this._boundingInfo=d,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(d,t,A){return this._boundingInfo=new D.b(d,t,A),this._boundingInfo}normalizeToUnitCube(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(d,t,A)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(B.f.MatricesIndicesKind)&&this.isVerticesDataPresent(B.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(d){}_activate(d,t){return this._renderId=d,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===W.e.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(d,t,A){return this.position.addInPlace(this.calcMovePOV(d,t,A)),this}calcMovePOV(d,t,A){const w=new p.c;(this.rotationQuaternion?this.rotationQuaternion:p.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(w);const N=p.l.Zero(),B=this.definedFacingForward?-1:1;return p.l.TransformCoordinatesFromFloatsToRef(d*B,t,A*B,w,N),N}rotatePOV(d,t,A){return this.rotation.addInPlace(this.calcRotatePOV(d,t,A)),this}calcRotatePOV(d,t,A){const w=this.definedFacingForward?1:-1;return new p.l(d*w,t,A*w)}Fa(d,t){if(d){const A=(0,Q.g)(d,0,this.getTotalVertices(),t);this._boundingInfo?this._boundingInfo.reConstruct(A.minimum,A.maximum):this._boundingInfo=new D.b(A.minimum,A.maximum)}if(this.If)for(let A=0;A<this.If.length;A++)this.If[A].refreshBoundingInfo(d);this.Ea()}_refreshBoundingInfoDirect(d){if(this._boundingInfo?this._boundingInfo.reConstruct(d.minimum,d.maximum):this._boundingInfo=new D.b(d.minimum,d.maximum),this.If)for(let t=0;t<this.If.length;t++)this.If[t].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(d,t,A,w,N,X,W){!function(d,t,A,w,N,X,W){const a=p.h.gb[0],D=p.h.Matrix[0],i=p.h.Matrix[1],k=t===B.f.NormalKind?p.l.TransformNormalFromFloatsToRef:p.l.TransformCoordinatesFromFloatsToRef;for(let B=0,b=0;B<d.length;B+=3,b+=4){let t,Q;for(D.reset(),t=0;t<4;t++)Q=N[b+t],Q>0&&(p.c.FromFloat32ArrayToRefScaled(A,Math.floor(16*w[b+t]),Q,i),D.addToSelf(i));if(X&&W)for(t=0;t<4;t++)Q=W[b+t],Q>0&&(p.c.FromFloat32ArrayToRefScaled(A,Math.floor(16*X[b+t]),Q,i),D.addToSelf(i));k(d[B],d[B+1],d[B+2],D,a),a.toArray(d,B)}}(d,t,A,w,N,X,W)}_getData(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:B.f.PositionKind;const w=d.cache,N=d=>{if(w){const t=w._vertexData||(w._vertexData={});return t[d]||this.copyVerticesData(d,t),t[d]}return this.getVerticesData(d)};if(t||(t=N(A)),!t)return null;if(w?(w._outputData?w._outputData.set(t):w._outputData=new Float32Array(t),t=w._outputData):(d.applyMorph&&this.morphTargetManager||d.applySkeleton&&this.skeleton)&&(t=t.slice()),d.applyMorph&&this.morphTargetManager&&function(d,t,A){let w=null;switch(t){case B.f.PositionKind:w=d=>d.getPositions();break;case B.f.NormalKind:w=d=>d.getNormals();break;case B.f.TangentKind:w=d=>d.getTangents();break;case B.f.UVKind:w=d=>d.getUVs();break;default:return}for(let N=0;N<d.length;N++){let t=d[N];for(let p=0;p<A.numTargets;p++){const B=A.getTarget(p),X=B.influence;if(0!==X){const A=w(B);A&&(t+=(A[N]-d[N])*X)}}d[N]=t}}(t,A,this.morphTargetManager),d.applySkeleton&&this.skeleton){const d=N(B.f.MatricesIndicesKind),w=N(B.f.MatricesWeightsKind);if(w&&d){const p=this.numBoneInfluencers>4,X=p?N(B.f.MatricesIndicesExtraKind):null,W=p?N(B.f.MatricesWeightsExtraKind):null,a=this.skeleton.getTransformMatrices(this);v._ApplySkeleton(t,A,a,d,w,X,W)}}if(!1!==d.updatePositionsArray&&A===B.f.PositionKind){const d=this._internalAbstractMeshDataInfo._positions||[],A=d.length;if(d.length=t.length/3,A<d.length)for(let t=A;t<d.length;t++)d[t]=new p.l;for(let w=0,N=0;w<d.length;w++,N+=3)d[w].wf(t[N],t[N+1],t[N+2]);this._internalAbstractMeshDataInfo._positions=d}return t}getNormalsData(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:d,applyMorph:t,updatePositionsArray:!1},null,B.f.NormalKind)}Me(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:d,applyMorph:t,updatePositionsArray:!1},A,B.f.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new D.b(p.l.Zero(),p.l.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(d){if(!this.If)return this;const t=this.If.length;for(let A=0;A<t;A++){const w=this.If[A];(t>1||!w.IsGlobal)&&w.updateBoundingInfo(d)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(d){return this.getBoundingInfo().isInFrustum(d,this.Bi)}isCompletelyInFrustum(d){return this.getBoundingInfo().isCompletelyInFrustum(d)}intersectsMesh(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;const w=this.getBoundingInfo(),N=d.getBoundingInfo();if(w.intersects(N,t))return!0;if(A)for(const p of this.getChildMeshes())if(p.intersectsMesh(d,t,!0))return!0;return!1}intersectsPoint(d){return this.getBoundingInfo().intersectsPoint(d)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(d){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=d}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(d){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const t=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=t.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,t.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,d,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(d,t,A){var w;if(this._generatePointsArray(),!this._positions)return this;if(!d._lastColliderWorldVertices||!d._lastColliderTransformMatrix.equals(t)){d._lastColliderTransformMatrix=t.clone(),d._lastColliderWorldVertices=[],d._trianglePlanes=[];const A=d.verticesStart,w=d.verticesStart+d.verticesCount;for(let N=A;N<w;N++)d._lastColliderWorldVertices.push(p.l.TransformCoordinates(this._positions[N],t))}return A._collide(d._trianglePlanes,d._lastColliderWorldVertices,this.xf(),d.indexStart,d.indexStart+d.indexCount,d.verticesStart,!!d.Ha(),this,this._shouldConvertRHS(),7===(null===(w=d.Ha())||void 0===w?void 0:w.fillMode)),this}_processCollisionsForSubMeshes(d,t){const A=this._scene.getCollidingSubMeshCandidates(this,d),w=A.length;for(let N=0;N<w;N++){const p=A.data[N];w>1&&!p._checkCollision(d)||this._collideForSubMesh(p,t,d)}return this}_shouldConvertRHS(){return!1}_checkCollision(d){if(!this.getBoundingInfo()._checkCollision(d))return this;const t=p.h.Matrix[0],A=p.h.Matrix[1];return p.c.ScalingToRef(1/d._radius.x,1/d._radius.y,1/d._radius.z,t),this.worldMatrixFromCache.multiplyToRef(t,A),this._processCollisionsForSubMeshes(d,A),this}_generatePointsArray(){return!1}intersects(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0,B=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const X=new a.c,W=this.getClassName(),D="InstancedLinesMesh"===W||"LinesMesh"===W||"GreasedLineMesh"===W?this.intersectionThreshold:0,i=this.getBoundingInfo();if(!this.If)return X;if(!B&&(!d.intersectsSphere(i.boundingSphere,D)||!d.intersectsBox(i.boundingBox,D)))return X;if(w)return X.hit=!B,X.pickedMesh=B?null:this,X.distance=B?0:p.l.Distance(d.origin,i.boundingSphere.center),X.subMeshId=0,X;if(!this._generatePointsArray())return X;let k=null;const b=this._scene.getIntersectingSubMeshCandidates(this,d),Q=b.length;let P=!1;for(let p=0;p<Q;p++){const d=b.data[p].Ha();if(d&&(7==d.fillMode||0==d.fillMode||1==d.fillMode||2==d.fillMode||4==d.fillMode)){P=!0;break}}if(!P)return X.hit=!0,X.pickedMesh=this,X.distance=p.l.Distance(d.origin,i.boundingSphere.center),X.subMeshId=-1,X;for(let p=0;p<Q;p++){const w=b.data[p];if(Q>1&&!B&&!w.canIntersects(d))continue;const N=w.intersects(d,this._positions,this.xf(),t,A);if(N&&(t||!k||N.distance<k.distance)&&(k=N,k.subMeshId=p,t))break}if(k){const t=N??this.getWorldMatrix(),A=p.h.gb[0],w=p.h.gb[1];p.l.TransformCoordinatesToRef(d.origin,t,A),d.direction.scaleToRef(k.distance,w);const B=p.l.TransformNormal(w,t).addInPlace(A);return X.hit=!0,X.distance=p.l.Distance(A,B),X.pickedPoint=B,X.pickedMesh=this,X.bu=k.bu||0,X.bv=k.bv||0,X.subMeshFaceId=k.faceId,X.faceId=k.faceId+b.data[k.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),X.subMeshId=k.subMeshId,X}return X}clone(d,t,A){return null}releaseSubMeshes(){if(this.If)for(;this.If.length;)this.If[0].dispose();else this.If=[];return this}dispose(d){let t,A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const w=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),w.freeActiveMeshes(),w.freeRenderingGroups(),w.renderingManager.maintainStateBetweenFrames&&w.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((d=>d!==this&&d.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),t=0;t<this._intersectionsInProgress.length;t++){const d=this._intersectionsInProgress[t],A=d._intersectionsInProgress.indexOf(this);d._intersectionsInProgress.splice(A,1)}this._intersectionsInProgress.length=0;w.lights.forEach((d=>{let t=d.includedOnlyMeshes.indexOf(this);-1!==t&&d.includedOnlyMeshes.splice(t,1),t=d.excludedMeshes.indexOf(this),-1!==t&&d.excludedMeshes.splice(t,1);const A=d.getShadowGenerators();if(A){const d=A.values();for(let A=d.next();!0!==A.done;A=d.next()){const d=A.value.getShadowMap();d&&d.renderList&&(t=d.renderList.indexOf(this),-1!==t&&d.renderList.splice(t,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const N=w.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,N.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),N.wipeCaches(),w.Ug(this),this._parentContainer){const d=this._parentContainer.meshes.indexOf(this);d>-1&&this._parentContainer.meshes.splice(d,1),this._parentContainer=null}if(A&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!d)for(t=0;t<w.nj.length;t++)w.nj[t].k===this&&(w.nj[t].dispose(),t--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(d,A)}_initFacetData(){const d=this._internalAbstractMeshDataInfo._facetData;d.facetNormals||(d.facetNormals=[]),d.facetPositions||(d.facetPositions=[]),d.facetPartitioning||(d.facetPartitioning=new Array),d.facetNb=this.xf().length/3|0,d.partitioningSubdivisions=d.partitioningSubdivisions?d.partitioningSubdivisions:10,d.partitioningBBoxRatio=d.partitioningBBoxRatio?d.partitioningBBoxRatio:1.01;for(let t=0;t<d.facetNb;t++)d.facetNormals[t]=p.l.Zero(),d.facetPositions[t]=p.l.Zero();return d.facetDataEnabled=!0,this}updateFacetData(){const d=this._internalAbstractMeshDataInfo._facetData;d.facetDataEnabled||this._initFacetData();const t=this.getVerticesData(B.f.PositionKind),A=this.xf(),w=this.getVerticesData(B.f.NormalKind),N=this.getBoundingInfo();if(d.facetDepthSort&&!d.facetDepthSortEnabled){if(d.facetDepthSortEnabled=!0,A instanceof Uint16Array)d.depthSortedIndices=new Uint16Array(A);else if(A instanceof Uint32Array)d.depthSortedIndices=new Uint32Array(A);else{let t=!1;for(let d=0;d<A.length;d++)if(A[d]>65535){t=!0;break}d.depthSortedIndices=t?new Uint32Array(A):new Uint16Array(A)}if(d.facetDepthSortFunction=function(d,t){return t.sqDistance-d.sqDistance},!d.facetDepthSortFrom){const t=this.va().activeCamera;d.facetDepthSortFrom=t?t.position:p.l.Zero()}d.depthSortedFacets=[];for(let t=0;t<d.facetNb;t++){const A={ind:3*t,sqDistance:0};d.depthSortedFacets.push(A)}d.invertedMatrix=p.c.Identity(),d.facetDepthSortOrigin=p.l.Zero()}d.bbSize.x=N.maximum.x-N.minimum.x>J.b?N.maximum.x-N.minimum.x:J.b,d.bbSize.y=N.maximum.y-N.minimum.y>J.b?N.maximum.y-N.minimum.y:J.b,d.bbSize.z=N.maximum.z-N.minimum.z>J.b?N.maximum.z-N.minimum.z:J.b;let W=d.bbSize.x>d.bbSize.y?d.bbSize.x:d.bbSize.y;if(W=W>d.bbSize.z?W:d.bbSize.z,d.subDiv.max=d.partitioningSubdivisions,d.subDiv.X=Math.floor(d.subDiv.max*d.bbSize.x/W),d.subDiv.Y=Math.floor(d.subDiv.max*d.bbSize.y/W),d.subDiv.Z=Math.floor(d.subDiv.max*d.bbSize.z/W),d.subDiv.X=d.subDiv.X<1?1:d.subDiv.X,d.subDiv.Y=d.subDiv.Y<1?1:d.subDiv.Y,d.subDiv.Z=d.subDiv.Z<1?1:d.subDiv.Z,d.facetParameters.facetNormals=this.getFacetLocalNormals(),d.facetParameters.facetPositions=this.getFacetLocalPositions(),d.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),d.facetParameters.bInfo=N,d.facetParameters.bbSize=d.bbSize,d.facetParameters.subDiv=d.subDiv,d.facetParameters.ratio=this.partitioningBBoxRatio,d.facetParameters.depthSort=d.facetDepthSort,d.facetDepthSort&&d.facetDepthSortEnabled&&(this.Nj(!0),this._worldMatrix.invertToRef(d.invertedMatrix),p.l.TransformCoordinatesToRef(d.facetDepthSortFrom,d.invertedMatrix,d.facetDepthSortOrigin),d.facetParameters.distanceTo=d.facetDepthSortOrigin),d.facetParameters.depthSortedFacets=d.depthSortedFacets,w&&X.e.ComputeNormals(t,A,w,d.facetParameters),d.facetDepthSort&&d.facetDepthSortEnabled){d.depthSortedFacets.sort(d.facetDepthSortFunction);const t=d.depthSortedIndices.length/3|0;for(let w=0;w<t;w++){const t=d.depthSortedFacets[w].ind;d.depthSortedIndices[3*w]=A[t],d.depthSortedIndices[3*w+1]=A[t+1],d.depthSortedIndices[3*w+2]=A[t+2]}this.updateIndices(d.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const d=this._internalAbstractMeshDataInfo._facetData;return d.facetNormals||this.updateFacetData(),d.facetNormals}getFacetLocalPositions(){const d=this._internalAbstractMeshDataInfo._facetData;return d.facetPositions||this.updateFacetData(),d.facetPositions}getFacetLocalPartitioning(){const d=this._internalAbstractMeshDataInfo._facetData;return d.facetPartitioning||this.updateFacetData(),d.facetPartitioning}getFacetPosition(d){const t=p.l.Zero();return this.getFacetPositionToRef(d,t),t}getFacetPositionToRef(d,t){const A=this.getFacetLocalPositions()[d],w=this.getWorldMatrix();return p.l.TransformCoordinatesToRef(A,w,t),this}getFacetNormal(d){const t=p.l.Zero();return this.getFacetNormalToRef(d,t),t}getFacetNormalToRef(d,t){const A=this.getFacetLocalNormals()[d];return p.l.TransformNormalToRef(A,this.getWorldMatrix(),t),this}getFacetsAtLocalCoordinates(d,t,A){const w=this.getBoundingInfo(),N=this._internalAbstractMeshDataInfo._facetData,p=Math.floor((d-w.minimum.x*N.partitioningBBoxRatio)*N.subDiv.X*N.partitioningBBoxRatio/N.bbSize.x),B=Math.floor((t-w.minimum.y*N.partitioningBBoxRatio)*N.subDiv.Y*N.partitioningBBoxRatio/N.bbSize.y),X=Math.floor((A-w.minimum.z*N.partitioningBBoxRatio)*N.subDiv.Z*N.partitioningBBoxRatio/N.bbSize.z);return p<0||p>N.subDiv.max||B<0||B>N.subDiv.max||X<0||X>N.subDiv.max?null:N.facetPartitioning[p+N.subDiv.max*B+N.subDiv.max*N.subDiv.max*X]}getClosestFacetAtCoordinates(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const X=this.getWorldMatrix(),W=p.h.Matrix[5];X.invertToRef(W);const a=p.h.gb[8];p.l.TransformCoordinatesFromFloatsToRef(d,t,A,W,a);const D=this.getClosestFacetAtLocalCoordinates(a.x,a.y,a.z,w,N,B);return w&&p.l.TransformCoordinatesFromFloatsToRef(w.x,w.y,w.z,X,w),D}getClosestFacetAtLocalCoordinates(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4],p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=null,X=0,W=0,a=0,D=0,i=0,k=0,b=0,Q=0;const P=this.getFacetLocalPositions(),J=this.getFacetLocalNormals(),U=this.getFacetsAtLocalCoordinates(d,t,A);if(!U)return null;let T,F,q,H=Number.MAX_VALUE,f=H;for(let v=0;v<U.length;v++)T=U[v],F=J[T],q=P[T],D=(d-q.x)*F.x+(t-q.y)*F.y+(A-q.z)*F.z,(!N||N&&p&&D>=0||N&&!p&&D<=0)&&(D=F.x*q.x+F.y*q.y+F.z*q.z,i=-(F.x*d+F.y*t+F.z*A-D)/(F.x*F.x+F.y*F.y+F.z*F.z),k=d+F.x*i,b=t+F.y*i,Q=A+F.z*i,X=k-d,W=b-t,a=Q-A,f=X*X+W*W+a*a,f<H&&(H=f,B=T,w&&(w.x=k,w.y=b,w.z=Q)));return B}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const d=this._internalAbstractMeshDataInfo._facetData;return d.facetDataEnabled&&(d.facetDataEnabled=!1,d.facetPositions=[],d.facetNormals=[],d.facetPartitioning=new Array,d.facetParameters=null,d.depthSortedIndices=new Uint32Array(0)),this}updateIndices(d,t){return this}createNormals(d){const t=this.getVerticesData(B.f.PositionKind),A=this.xf();let w;return w=this.isVerticesDataPresent(B.f.NormalKind)?this.getVerticesData(B.f.NormalKind):[],X.e.ComputeNormals(t,A,w,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(B.f.NormalKind,w,d),this}alignWithNormal(d,t){t||(t=U.e.Y);const A=p.h.gb[0],w=p.h.gb[1];return p.l.CrossToRef(t,d,w),p.l.CrossToRef(d,w,A),this.rotationQuaternion?p.f.RotationQuaternionFromAxisToRef(A,d,w,this.rotationQuaternion):p.l.RotationFromAxisToRef(A,d,w,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,b.b)("EdgesRenderer")}enableEdgesRendering(d,t,A){throw(0,b.b)("EdgesRenderer")}oj(){return this._scene.nj.filter((d=>d.k===this))}}v.OCCLUSION_TYPE_NONE=0,v.OCCLUSION_TYPE_OPTIMISTIC=1,v.OCCLUSION_TYPE_STRICT=2,v.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,v.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,v.CULLINGSTRATEGY_STANDARD=0,v.Ci=1,v.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,v.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,w.b)([F.g.filter((function(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];let[w,N,p,B,X]=t;return!Array.isArray(w)&&!Array.isArray(N)&&!Array.isArray(p)&&!Array.isArray(B)&&!Array.isArray(X)}))],v,"_ApplySkeleton",null),(0,T.g)("BABYLON.AbstractMesh",v)},11342:(d,t,A)=>{"use strict";A.d(t,{c:()=>J});var w=A(11076),N=A(11094),p=A(11339),B=A(11120),X=A(11205),W=A(11347),a=A(11221),D=A(10727),i=A(11067),k=A(11232),b=A(10775),Q=A(11271),P=A(10740);class J{get boundingBias(){return this._boundingBias}set boundingBias(d){this._boundingBias?this._boundingBias.p(d):this._boundingBias=d.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(d){const t=new J(J.RandomId(),d.va());return t.Ca(d),t}get meshes(){return this._meshes}constructor(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=t||b.e.LastCreatedScene,this._scene&&(this.id=d,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=w,A?this.setAllVerticesData(A,w):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),N&&(this.Ca(N),N.Nj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let d=0;d<this._meshes.length;d++)if(!this._meshes[d].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const d=new Set;for(const t in this._vertexBuffers)d.add(this._vertexBuffers[t].getWrapperBuffer());d.forEach((d=>{d._rebuild()}))}setAllVerticesData(d,t){d.applyToGeometry(this,t),this._notifyUpdate()}Ga(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;A&&Array.isArray(t)&&(t=new Float32Array(t));const N=new B.f(this._engine,t,d,{updatable:A,postponeInternalCreation:0===this._meshes.length,stride:w,label:"Geometry_"+this.id+"_"+d});this.setVerticesBuffer(N)}removeVerticesData(d){this._vertexBuffers[d]&&(this._vertexBuffers[d].dispose(),delete this._vertexBuffers[d]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const N=d.getKind();this._vertexBuffers[N]&&A&&this._vertexBuffers[N].dispose(),d._buffer&&d._buffer._increaseReferences(),this._vertexBuffers[N]=d;const p=this._meshes,X=p.length;if(N===B.f.PositionKind){this._totalVertices=t??d._maxVerticesCount,this._updateExtend(d.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const A=this._extend&&this._extend.minimum||new w.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),N=this._extend&&this._extend.maximum||new w.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let d=0;d<X;d++){const t=p[d];t.buildBoundingInfo(A,N),t._createGlobalSubMesh(t.isUnIndexed),t.Nj(!0),t.synchronizeInstances()}}this._notifyUpdate(N)}updateVerticesDataDirectly(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=this.getVertexBuffer(d);N&&(N.updateDirectly(t,A,w),this._notifyUpdate(d))}updateVerticesData(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=this.getVertexBuffer(d);w&&(w.update(t),d===B.f.PositionKind&&this.Ea(A,t),this._notifyUpdate(d))}Ea(d,t){if(d&&this._updateExtend(t),this._resetPointsArrayCache(),d){const d=this._meshes;for(const t of d){t.hasBoundingInfo?t.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):t.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const d=t.If;for(const t of d)t.refreshBoundingInfo()}}}_bind(d,t,A,w){if(!d)return;void 0===t&&(t=this._indexBuffer);const N=this.getVertexBuffers();if(!N)return;if(t!=this._indexBuffer||!this._vertexArrayObjects&&!w)return void this._engine.bindBuffers(N,t,d,A);const p=w||this._vertexArrayObjects,B=this._engine;p[d.key]||(p[d.key]=B.recordVertexArrayObject(N,t,d,A)),B.bindVertexArrayObject(p[d.key],t)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(d,t,A){const w=this.getVertexBuffer(d);return w?w.getFloatData(this._totalVertices,A||t&&1!==this._meshes.length):null}copyVerticesData(d,t){const A=this.getVertexBuffer(d);if(!A)return;t[d]||(t[d]=new Float32Array(this._totalVertices*A.getSize()));const w=A.getData();w&&function(d,t,A,w,N,p,X,W){const a=t*B.f.GetTypeByteLength(A),D=X*t;if(W.length!==D)throw new Error("Output length is not valid");if(A===B.f.FLOAT&&N===a)if(d instanceof Array){const t=w/4;W.set(d,t)}else if(d instanceof ArrayBuffer){const t=new Float32Array(d,w,D);W.set(t)}else{const t=d.byteOffset+w;if(t%4)return P.e.Warn("CopyFloatData: copied misaligned data."),void W.set(new Float32Array(d.buffer.slice(t,t+4*D)));const A=new Float32Array(d.buffer,t,D);W.set(A)}else B.f.ForEach(d,w,N,t,A,D,p,((d,t)=>W[t]=d))}(w,A.getSize(),A.type,A.byteOffset,A.byteStride,A.normalized,this._totalVertices,t[d])}isVertexBufferUpdatable(d){const t=this._vertexBuffers[d];return!!t&&t.isUpdatable()}getVertexBuffer(d){return this.isReady()?this._vertexBuffers[d]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(d){return this._vertexBuffers?void 0!==this._vertexBuffers[d]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(d)}getVerticesDataKinds(){const d=[];let t;if(!this._vertexBuffers&&this._delayInfo)for(t in this._delayInfo)d.push(t);else for(t in this._vertexBuffers)d.push(t);return d}updateIndices(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const w=d.length!==this._indices.length;if(A||(this._indices=d.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,d,t),w)for(const d of this._meshes)d._createGlobalSubMesh(!0)}else this.setIndices(d,null,!0)}setIndexBuffer(d,t,A){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=d,this._totalVertices=t,this._totalIndices=A,d.is32Bits||(d.is32Bits=this._totalIndices>65535);for(const w of this._meshes)w._createGlobalSubMesh(!0),w.synchronizeInstances();this._notifyUpdate()}setIndices(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=d,this._indexBufferIsUpdatable=A,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,A,"Geometry_"+this.id+"_IndexBuffer")),void 0!=t&&(this._totalVertices=t);for(const N of this._meshes)N._createGlobalSubMesh(!w),N.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}xf(d,t){if(!this.isReady())return null;const A=this._indices;return t||d&&1!==this._meshes.length?A.slice():A}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;d&&this._vertexArrayObjects&&this._vertexArrayObjects[d.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[d.key]),delete this._vertexArrayObjects[d.key])}releaseForMesh(d,t){const A=this._meshes,w=A.indexOf(d);-1!==w&&(A.splice(w,1),this._vertexArrayObjects&&d._invalidateInstanceVertexArrayObject(),d._geometry=null,0===A.length&&t&&this.dispose())}Ca(d){if(d._geometry===this)return;const t=d._geometry;t&&t.releaseForMesh(d),this._vertexArrayObjects&&d._invalidateInstanceVertexArrayObject();const A=this._meshes;d._geometry=this,d._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),A.push(d),this.isReady()?this._applyToMesh(d):this._boundingInfo&&d.setBoundingInfo(this._boundingInfo)}_updateExtend(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!d&&(d=this.getVerticesData(B.f.PositionKind),!d))return;this._extend=(0,k.g)(d,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(d){const t=this._meshes.length;for(const A in this._vertexBuffers)1===t&&this._vertexBuffers[A].create(),A===B.f.PositionKind&&(this._extend||this._updateExtend(),d.buildBoundingInfo(this._extend.minimum,this._extend.maximum),d._createGlobalSubMesh(d.isUnIndexed),d.Ea());1===t&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),d._syncGeometryWithMorphTargetManager(),d.synchronizeInstances()}_notifyUpdate(d){this.onGeometryUpdated&&this.onGeometryUpdated(this,d),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const t of this._meshes)t._markSubMeshesAsAttributesDirty()}load(d,t){2!==this.delayLoadState&&(this.isReady()?t&&t():(this.delayLoadState=2,this._queueLoad(d,t)))}_queueLoad(d,t){this.delayLoadingFile&&(d.addPendingData(this),d._loadFile(this.delayLoadingFile,(A=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(A),this),this.delayLoadState=1,this._delayInfo=[],d.removePendingData(this);const w=this._meshes,N=w.length;for(let d=0;d<N;d++)this._applyToMesh(w[d]);t&&t()}),void 0,!0))}toLeftHanded(){const d=this.xf(!1);if(null!=d&&d.length>0){for(let t=0;t<d.length;t+=3){const A=d[t+0];d[t+0]=d[t+2],d[t+2]=A}this.setIndices(d)}const t=this.getVerticesData(B.f.PositionKind,!1);if(null!=t&&t.length>0){for(let d=0;d<t.length;d+=3)t[d+2]=-t[d+2];this.Ga(B.f.PositionKind,t,!1)}const A=this.getVerticesData(B.f.NormalKind,!1);if(null!=A&&A.length>0){for(let d=0;d<A.length;d+=3)A[d+2]=-A[d+2];this.Ga(B.f.NormalKind,A,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const d=this.getVerticesData(B.f.PositionKind);if(!d||0===d.length)return!1;for(let t=3*this._positionsCache.length,A=this._positionsCache.length;t<d.length;t+=3,++A)this._positionsCache[A]=w.l.Lg(d,t);for(let t=0,A=0;t<d.length;t+=3,++A)this._positionsCache[A].set(d[0+t],d[1+t],d[2+t]);return this._positionsCache.length=d.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const A in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[A]);this._vertexArrayObjects={};const d=this._meshes,t=d.length;for(let A=0;A<t;A++)d[A]._invalidateInstanceVertexArrayObject()}}dispose(){const d=this._meshes,t=d.length;let A;for(A=0;A<t;A++)this.releaseForMesh(d[A]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const w in this._vertexBuffers)this._vertexBuffers[w].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const d=this._parentContainer.geometries.indexOf(this);d>-1&&this._parentContainer.geometries.splice(d,1),this._parentContainer=null}this._isDisposed=!0}j(d){const t=new p.e;t.indices=[];const A=this.xf();if(A)for(let p=0;p<A.length;p++)t.indices.push(A[p]);let w,N=!1,B=!1;for(w in this._vertexBuffers){const d=this.getVerticesData(w);if(d&&(d instanceof Float32Array?t.set(new Float32Array(d),w):t.set(d.slice(0),w),!B)){const d=this.getVertexBuffer(w);d&&(N=d.isUpdatable(),B=!N)}}const X=new J(d,this._scene,t,N);for(w in X.delayLoadState=this.delayLoadState,X.delayLoadingFile=this.delayLoadingFile,X._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)X._delayInfo=X._delayInfo||[],X._delayInfo.push(w);return X._boundingInfo=new a.b(this._extend.minimum,this._extend.maximum),X}serialize(){const d={};return d.id=this.id,d.uniqueId=this.uniqueId,d.updatable=this._updatable,i.c&&i.c.HasTags(this)&&(d.tags=i.c.GetTags(this)),d}_toNumberArray(d){return Array.isArray(d)?d:Array.prototype.slice.call(d)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const d in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,d)&&(this._vertexBuffers[d]._buffer._data=null)}serializeVerticeData(){const d=this.serialize();return this.isVerticesDataPresent(B.f.PositionKind)&&(d.xa=this._toNumberArray(this.getVerticesData(B.f.PositionKind)),this.isVertexBufferUpdatable(B.f.PositionKind)&&(d.xa._updatable=!0)),this.isVerticesDataPresent(B.f.NormalKind)&&(d.ya=this._toNumberArray(this.getVerticesData(B.f.NormalKind)),this.isVertexBufferUpdatable(B.f.NormalKind)&&(d.ya._updatable=!0)),this.isVerticesDataPresent(B.f.TangentKind)&&(d.tangents=this._toNumberArray(this.getVerticesData(B.f.TangentKind)),this.isVertexBufferUpdatable(B.f.TangentKind)&&(d.tangents._updatable=!0)),this.isVerticesDataPresent(B.f.UVKind)&&(d.Aa=this._toNumberArray(this.getVerticesData(B.f.UVKind)),this.isVertexBufferUpdatable(B.f.UVKind)&&(d.Aa._updatable=!0)),this.isVerticesDataPresent(B.f.UV2Kind)&&(d.uvs2=this._toNumberArray(this.getVerticesData(B.f.UV2Kind)),this.isVertexBufferUpdatable(B.f.UV2Kind)&&(d.uvs2._updatable=!0)),this.isVerticesDataPresent(B.f.UV3Kind)&&(d.uvs3=this._toNumberArray(this.getVerticesData(B.f.UV3Kind)),this.isVertexBufferUpdatable(B.f.UV3Kind)&&(d.uvs3._updatable=!0)),this.isVerticesDataPresent(B.f.UV4Kind)&&(d.uvs4=this._toNumberArray(this.getVerticesData(B.f.UV4Kind)),this.isVertexBufferUpdatable(B.f.UV4Kind)&&(d.uvs4._updatable=!0)),this.isVerticesDataPresent(B.f.UV5Kind)&&(d.uvs5=this._toNumberArray(this.getVerticesData(B.f.UV5Kind)),this.isVertexBufferUpdatable(B.f.UV5Kind)&&(d.uvs5._updatable=!0)),this.isVerticesDataPresent(B.f.UV6Kind)&&(d.uvs6=this._toNumberArray(this.getVerticesData(B.f.UV6Kind)),this.isVertexBufferUpdatable(B.f.UV6Kind)&&(d.uvs6._updatable=!0)),this.isVerticesDataPresent(B.f.ColorKind)&&(d.za=this._toNumberArray(this.getVerticesData(B.f.ColorKind)),this.isVertexBufferUpdatable(B.f.ColorKind)&&(d.za._updatable=!0)),this.isVerticesDataPresent(B.f.MatricesIndicesKind)&&(d.matricesIndices=this._toNumberArray(this.getVerticesData(B.f.MatricesIndicesKind)),d.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(B.f.MatricesIndicesKind)&&(d.matricesIndices._updatable=!0)),this.isVerticesDataPresent(B.f.MatricesWeightsKind)&&(d.matricesWeights=this._toNumberArray(this.getVerticesData(B.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(B.f.MatricesWeightsKind)&&(d.matricesWeights._updatable=!0)),d.indices=this._toNumberArray(this.xf()),d}static ExtractFromMesh(d,t){const A=d._geometry;return A?A.j(t):null}static RandomId(){return D.g.RandomId()}static _GetGeometryByLoadedUniqueId(d,t){for(let A=0;A<t.geometries.length;A++)if(t.geometries[A]._loadedUniqueId===d)return t.geometries[A];return null}static _ImportGeometry(d,t){const A=t.va(),w=d.geometryUniqueId,p=d.geometryId;if(w||p){const d=w?this._GetGeometryByLoadedUniqueId(w,A):A.getGeometryById(p);d&&d.Ca(t)}else if(d instanceof ArrayBuffer){const A=t._binaryInfo;if(A.positionsAttrDesc&&A.positionsAttrDesc.count>0){const w=new Float32Array(d,A.positionsAttrDesc.offset,A.positionsAttrDesc.count);t.Ga(B.f.PositionKind,w,!1)}if(A.normalsAttrDesc&&A.normalsAttrDesc.count>0){const w=new Float32Array(d,A.normalsAttrDesc.offset,A.normalsAttrDesc.count);t.Ga(B.f.NormalKind,w,!1)}if(A.tangetsAttrDesc&&A.tangetsAttrDesc.count>0){const w=new Float32Array(d,A.tangetsAttrDesc.offset,A.tangetsAttrDesc.count);t.Ga(B.f.TangentKind,w,!1)}if(A.uvsAttrDesc&&A.uvsAttrDesc.count>0){const w=new Float32Array(d,A.uvsAttrDesc.offset,A.uvsAttrDesc.count);if(Q.e)for(let d=1;d<w.length;d+=2)w[d]=1-w[d];t.Ga(B.f.UVKind,w,!1)}if(A.uvs2AttrDesc&&A.uvs2AttrDesc.count>0){const w=new Float32Array(d,A.uvs2AttrDesc.offset,A.uvs2AttrDesc.count);if(Q.e)for(let d=1;d<w.length;d+=2)w[d]=1-w[d];t.Ga(B.f.UV2Kind,w,!1)}if(A.uvs3AttrDesc&&A.uvs3AttrDesc.count>0){const w=new Float32Array(d,A.uvs3AttrDesc.offset,A.uvs3AttrDesc.count);if(Q.e)for(let d=1;d<w.length;d+=2)w[d]=1-w[d];t.Ga(B.f.UV3Kind,w,!1)}if(A.uvs4AttrDesc&&A.uvs4AttrDesc.count>0){const w=new Float32Array(d,A.uvs4AttrDesc.offset,A.uvs4AttrDesc.count);if(Q.e)for(let d=1;d<w.length;d+=2)w[d]=1-w[d];t.Ga(B.f.UV4Kind,w,!1)}if(A.uvs5AttrDesc&&A.uvs5AttrDesc.count>0){const w=new Float32Array(d,A.uvs5AttrDesc.offset,A.uvs5AttrDesc.count);if(Q.e)for(let d=1;d<w.length;d+=2)w[d]=1-w[d];t.Ga(B.f.UV5Kind,w,!1)}if(A.uvs6AttrDesc&&A.uvs6AttrDesc.count>0){const w=new Float32Array(d,A.uvs6AttrDesc.offset,A.uvs6AttrDesc.count);if(Q.e)for(let d=1;d<w.length;d+=2)w[d]=1-w[d];t.Ga(B.f.UV6Kind,w,!1)}if(A.colorsAttrDesc&&A.colorsAttrDesc.count>0){const w=new Float32Array(d,A.colorsAttrDesc.offset,A.colorsAttrDesc.count);t.Ga(B.f.ColorKind,w,!1,A.colorsAttrDesc.stride)}if(A.matricesIndicesAttrDesc&&A.matricesIndicesAttrDesc.count>0){const w=new Int32Array(d,A.matricesIndicesAttrDesc.offset,A.matricesIndicesAttrDesc.count),N=[];for(let d=0;d<w.length;d++){const t=w[d];N.push(255&t),N.push((65280&t)>>8),N.push((16711680&t)>>16),N.push(t>>24&255)}t.Ga(B.f.MatricesIndicesKind,N,!1)}if(A.matricesIndicesExtraAttrDesc&&A.matricesIndicesExtraAttrDesc.count>0){const w=new Int32Array(d,A.matricesIndicesExtraAttrDesc.offset,A.matricesIndicesExtraAttrDesc.count),N=[];for(let d=0;d<w.length;d++){const t=w[d];N.push(255&t),N.push((65280&t)>>8),N.push((16711680&t)>>16),N.push(t>>24&255)}t.Ga(B.f.MatricesIndicesExtraKind,N,!1)}if(A.matricesWeightsAttrDesc&&A.matricesWeightsAttrDesc.count>0){const w=new Float32Array(d,A.matricesWeightsAttrDesc.offset,A.matricesWeightsAttrDesc.count);t.Ga(B.f.MatricesWeightsKind,w,!1)}if(A.indicesAttrDesc&&A.indicesAttrDesc.count>0){const w=new Int32Array(d,A.indicesAttrDesc.offset,A.indicesAttrDesc.count);t.setIndices(w,null)}if(A.subMeshesAttrDesc&&A.subMeshesAttrDesc.count>0){const w=new Int32Array(d,A.subMeshesAttrDesc.offset,5*A.subMeshesAttrDesc.count);t.If=[];for(let d=0;d<A.subMeshesAttrDesc.count;d++){const A=w[5*d+0],N=w[5*d+1],p=w[5*d+2],B=w[5*d+3],W=w[5*d+4];X.c.AddToMesh(A,N,p,B,W,t)}}}else if(d.xa&&d.ya&&d.indices){if(t.Ga(B.f.PositionKind,d.xa,d.xa._updatable),t.Ga(B.f.NormalKind,d.ya,d.ya._updatable),d.tangents&&t.Ga(B.f.TangentKind,d.tangents,d.tangents._updatable),d.Aa&&t.Ga(B.f.UVKind,d.Aa,d.Aa._updatable),d.uvs2&&t.Ga(B.f.UV2Kind,d.uvs2,d.uvs2._updatable),d.uvs3&&t.Ga(B.f.UV3Kind,d.uvs3,d.uvs3._updatable),d.uvs4&&t.Ga(B.f.UV4Kind,d.uvs4,d.uvs4._updatable),d.uvs5&&t.Ga(B.f.UV5Kind,d.uvs5,d.uvs5._updatable),d.uvs6&&t.Ga(B.f.UV6Kind,d.uvs6,d.uvs6._updatable),d.za&&t.Ga(B.f.ColorKind,N.i.CheckColors4(d.za,d.xa.length/3),d.za._updatable),d.matricesIndices)if(d.matricesIndices._isExpanded)delete d.matricesIndices._isExpanded,t.Ga(B.f.MatricesIndicesKind,d.matricesIndices,d.matricesIndices._updatable);else{const A=[];for(let t=0;t<d.matricesIndices.length;t++){const w=d.matricesIndices[t];A.push(255&w),A.push((65280&w)>>8),A.push((16711680&w)>>16),A.push(w>>24&255)}t.Ga(B.f.MatricesIndicesKind,A,d.matricesIndices._updatable)}if(d.matricesIndicesExtra)if(d.matricesIndicesExtra._isExpanded)delete d.matricesIndices._isExpanded,t.Ga(B.f.MatricesIndicesExtraKind,d.matricesIndicesExtra,d.matricesIndicesExtra._updatable);else{const A=[];for(let t=0;t<d.matricesIndicesExtra.length;t++){const w=d.matricesIndicesExtra[t];A.push(255&w),A.push((65280&w)>>8),A.push((16711680&w)>>16),A.push(w>>24&255)}t.Ga(B.f.MatricesIndicesExtraKind,A,d.matricesIndicesExtra._updatable)}d.matricesWeights&&(J._CleanMatricesWeights(d,t),t.Ga(B.f.MatricesWeightsKind,d.matricesWeights,d.matricesWeights._updatable)),d.matricesWeightsExtra&&t.Ga(B.f.MatricesWeightsExtraKind,d.matricesWeightsExtra,d.matricesWeights._updatable),t.setIndices(d.indices,null)}if(d.If){t.If=[];for(let A=0;A<d.If.length;A++){const w=d.If[A];X.c.AddToMesh(w.materialIndex,w.verticesStart,w.verticesCount,w.indexStart,w.indexCount,t)}}t._shouldGenerateFlatShading&&(t.convertToFlatShadedMesh(),t._shouldGenerateFlatShading=!1),t.Nj(!0),A.onMeshImportedObservable.notifyObservers(t)}static _CleanMatricesWeights(d,t){const A=.001;if(!W.b.CleanBoneMatrixWeights)return;let w=0;if(!(d.skeletonId>-1))return;{const A=t.va().getLastSkeletonById(d.skeletonId);if(!A)return;w=A.bones.length}const N=t.getVerticesData(B.f.MatricesIndicesKind),p=t.getVerticesData(B.f.MatricesIndicesExtraKind),X=d.matricesWeights,a=d.matricesWeightsExtra,D=d.numBoneInfluencer,i=X.length;for(let B=0;B<i;B+=4){let d=0,t=-1;for(let w=0;w<4;w++){const N=X[B+w];d+=N,N<A&&t<0&&(t=w)}if(a)for(let w=0;w<4;w++){const N=a[B+w];d+=N,N<A&&t<0&&(t=w+4)}if((t<0||t>D-1)&&(t=D-1),d>A){const t=1/d;for(let d=0;d<4;d++)X[B+d]*=t;if(a)for(let d=0;d<4;d++)a[B+d]*=t}else t>=4?(a[B+t-4]=1-d,p[B+t-4]=w):(X[B+t]=1-d,N[B+t]=w)}t.Ga(B.f.MatricesIndicesKind,N),d.matricesWeightsExtra&&t.Ga(B.f.MatricesIndicesExtraKind,p)}static Parse(d,t,A){const N=new J(d.id,t,void 0,d.updatable);return N._loadedUniqueId=d.uniqueId,i.c&&i.c.AddTagsTo(N,d.tags),d.delayLoadingFile?(N.delayLoadState=4,N.delayLoadingFile=A+d.delayLoadingFile,N._boundingInfo=new a.b(w.l.Lg(d.boundingBoxMinimum),w.l.Lg(d.boundingBoxMaximum)),N._delayInfo=[],d.hasUVs&&N._delayInfo.push(B.f.UVKind),d.hasUVs2&&N._delayInfo.push(B.f.UV2Kind),d.hasUVs3&&N._delayInfo.push(B.f.UV3Kind),d.hasUVs4&&N._delayInfo.push(B.f.UV4Kind),d.hasUVs5&&N._delayInfo.push(B.f.UV5Kind),d.hasUVs6&&N._delayInfo.push(B.f.UV6Kind),d.hasColors&&N._delayInfo.push(B.f.ColorKind),d.hasMatricesIndices&&N._delayInfo.push(B.f.MatricesIndicesKind),d.hasMatricesWeights&&N._delayInfo.push(B.f.MatricesWeightsKind),N._delayLoadingFunction=p.e.ImportVertexData):p.e.ImportVertexData(d,N),t.pushGeometry(N,!0),N}}},12065:(d,t,A)=>{"use strict";A.d(t,{b:()=>k});var w=A(11076),N=A(10740),p=A(11350),B=A(11309),X=A(10749),W=A(11353),a=A(11120),D=A(10727),i=A(10885);B.d._instancedMeshFactory=(d,t)=>{const A=new k(d,t);if(t.instancedBuffers){A.instancedBuffers={};for(const d in t.instancedBuffers)A.instancedBuffers[d]=t.instancedBuffers[d]}return A};class k extends p.d{constructor(d,t){super(d,t.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,t.Ej(this),this._sourceMesh=t,this._unIndexed=t._unIndexed,this.position.p(t.position),this.rotation.p(t.rotation),this.Gf.p(t.Gf),t.rotationQuaternion&&(this.rotationQuaternion=t.rotationQuaternion.clone()),this.animations=t.animations.slice();for(const A of t.getAnimationRanges())null!=A&&this.createAnimationRange(A.name,A.from,A.to);this.infiniteDistance=t.infiniteDistance,this.setPivotMatrix(t.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(d){var t;(null===(t=this._sourceMesh)||void 0===t?void 0:t.receiveShadows)!==d&&D.g.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(d){var t;(null===(t=this._sourceMesh)||void 0===t?void 0:t.material)!==d&&D.g.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(d){var t;(null===(t=this._sourceMesh)||void 0===t?void 0:t.visibility)!==d&&D.g.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(d){var t;(null===(t=this._sourceMesh)||void 0===t?void 0:t.skeleton)!==d&&D.g.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(d){this._sourceMesh&&d!==this._sourceMesh.renderingGroupId&&N.e.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}qd(d){return this._sourceMesh.qd(d)}isReady(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(d,!0)}getVerticesData(d,t,A){return this._sourceMesh.getVerticesData(d,t,A)}copyVerticesData(d,t){this._sourceMesh.copyVerticesData(d,t)}Ga(d,t,A,w){return this.sourceMesh&&this.sourceMesh.Ga(d,t,A,w),this.sourceMesh}updateVerticesData(d,t,A,w){return this.sourceMesh&&this.sourceMesh.updateVerticesData(d,t,A,w),this.sourceMesh}setIndices(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(d,t),this.sourceMesh}isVerticesDataPresent(d){return this._sourceMesh.isVerticesDataPresent(d)}xf(){return this._sourceMesh.xf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let d,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;d="object"===typeof t?t:{applySkeleton:t,applyMorph:A};const w=this._sourceMesh.Aj?this._sourceMesh.Aj.boundingBias:null;return this.Fa(this._sourceMesh._getData(d,null,a.f.PositionKind),w),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(d,t){if(super._activate(d,t),this._sourceMesh.If||N.e.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,d),t){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==W.e.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new w.c);const d=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,w.h.gb[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.Nj(!0)),this._currentLOD.position.p(w.h.gb[7]),this._currentLOD._masterMesh=d,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(d){if(!d)return this;const t=this.sourceMesh.getLODLevels();if(t&&0!==t.length){const t=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(d,t.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(d){return this.sourceMesh._preActivateForIntermediateRendering(d)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.If)for(let d=0;d<this._sourceMesh.If.length;d++)this._sourceMesh.If[d].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0;const w=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).qd(d);if(X.b.DeepCopy(this,w,["name","If","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","mj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),t&&(w.parent=t),!A)for(let N=0;N<this.va().meshes.length;N++){const d=this.va().meshes[N];d.parent===this&&d.clone(d.name,w)}return w.Nj(!0),this.onClonedObservable.notifyObservers(w),w}dispose(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.Cj(this),super.dispose(d,t)}_serializeAsParent(d){super._serializeAsParent(d),d.parentId=this._sourceMesh.uniqueId,d.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;const w=this.clone("Clone of "+(this.name||this.id),d||this.parent,!0,t&&t.newSourcedMesh);w&&A&&A(this,w);for(const N of this.getChildTransformNodes(!0))N.instantiateHierarchy(w,t,A);return w}}B.d.prototype.registerInstancedBuffer=function(d,t){var A,w;if(null===(A=this._userInstancedBuffersStorage)||void 0===A||null===(w=A.vertexBuffers[d])||void 0===w||w.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const d of this.instances)d.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[d]=null,this._userInstancedBuffersStorage.strides[d]=t,this._userInstancedBuffersStorage.sizes[d]=32*t,this._userInstancedBuffersStorage.data[d]=new Float32Array(this._userInstancedBuffersStorage.sizes[d]),this._userInstancedBuffersStorage.vertexBuffers[d]=new a.f(this.getEngine(),this._userInstancedBuffersStorage.data[d],d,!0,!1,t,!0);for(const N of this.instances)N.instancedBuffers[d]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},B.d.prototype._processInstancedBuffers=function(d,t){const A=d?d.length:0;for(const w in this.instancedBuffers){let N=this._userInstancedBuffersStorage.sizes[w];const p=this._userInstancedBuffersStorage.strides[w],B=(A+1)*p;for(;N<B;)N*=2;this._userInstancedBuffersStorage.data[w].length!=N&&(this._userInstancedBuffersStorage.data[w]=new Float32Array(N),this._userInstancedBuffersStorage.sizes[w]=N,this._userInstancedBuffersStorage.vertexBuffers[w]&&(this._userInstancedBuffersStorage.vertexBuffers[w].dispose(),this._userInstancedBuffersStorage.vertexBuffers[w]=null));const X=this._userInstancedBuffersStorage.data[w];let W=0;if(t){const d=this.instancedBuffers[w];d.toArray?d.toArray(X,W):d.copyToArray?d.copyToArray(X,W):X[W]=d,W+=p}for(let t=0;t<A;t++){const A=d[t].instancedBuffers[w];A.toArray?A.toArray(X,W):A.copyToArray?A.copyToArray(X,W):X[W]=A,W+=p}this._userInstancedBuffersStorage.vertexBuffers[w]?this._userInstancedBuffersStorage.vertexBuffers[w].updateDirectly(X,0):(this._userInstancedBuffersStorage.vertexBuffers[w]=new a.f(this.getEngine(),this._userInstancedBuffersStorage.data[w],w,!0,!1,p,!0),this._invalidateInstanceVertexArrayObject())}},B.d.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const d in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[d]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},B.d.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const d in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[d]&&this._userInstancedBuffersStorage.vertexBuffers[d].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,i.g)("BABYLON.InstancedMesh",k)},11309:(d,t,A)=>{"use strict";A.d(t,{d:()=>u,f:()=>n});var w=A(10730),N=A(10727),p=A(10749),B=A(11067),X=A(11314),W=A(11320),a=A(11076),D=A(11094),i=A(11326),k=A(11120),b=A(11339),Q=A(11342),P=A(11350),J=A(11205),U=A(11203),T=A(11368),F=A(11347),q=A(11097),H=A(10740),f=A(10885),v=A(10761),m=A(11146);class j{constructor(d,t){this.distanceOrScreenCoverage=d,this.mesh=t}}class n{}class R{constructor(){this.visibleInstances={},this.batchCache=new Z,this.batchCacheReplacementModeInFrozenMode=new Z,this.instancesBufferSize=2048}}class Z{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class L{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class I{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class u extends P.d{static _GetDefaultSideOrientation(d){return d||u.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(d){this._internalMeshDataInfo._useLODScreenCoverage=d,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(d){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==d&&(d&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(k.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(k.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=d,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new w.b),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new w.b),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new w.b),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new w.b),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new w.b),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(d){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(d)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(d){this._internalMeshDataInfo._forcedInstanceCount=d}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(d){this._internalMeshDataInfo._sideOrientation=d,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===d||!this._scene.useRightHandedSystem&&0===d}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(d){this.sideOrientation=d,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(d){this._internalMeshDataInfo._overrideRenderingFillMode=d}get material(){return this._internalAbstractMeshDataInfo._material}set material(d){d&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(d.sideOrientation=null),this._setMaterial(d)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(d){this._unIndexed!==d&&(this._unIndexed=d,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(d){this._instanceDataStorage.manualUpdate=d}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(d){this._instanceDataStorage.previousManualUpdate=d}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(d){this._instanceDataStorage.forceMatrixUpdates=d}_copySource(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const w=this.va();if(d._geometry&&d._geometry.Ca(this),p.b.DeepCopy(d,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","Aj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","mj","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=d,w.useClonedMeshMap&&(d._internalMeshDataInfo.meshMap||(d._internalMeshDataInfo.meshMap={}),d._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=d._originalBuilderSideOrientation,this._creationDataStorage=d._creationDataStorage,d._ranges){const t=d._ranges;for(const d in t)Object.prototype.hasOwnProperty.call(t,d)&&t[d]&&this.createAnimationRange(d,t[d].from,t[d].to)}if(d.metadata&&d.metadata.clone?this.metadata=d.metadata.clone():this.metadata=d.metadata,this._internalMetadata=d._internalMetadata,B.c&&B.c.HasTags(d)&&B.c.AddTagsTo(this,B.c.GetTags(d,!0)),this.Mf(d.isEnabled(!1)),this.parent=d.parent,this.setPivotMatrix(d.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+d.id,this.material=d.material,!t){const t=d.getDescendants(!0);for(let d=0;d<t.length;d++){const A=t[d];A.clone&&A.clone(this.name+"."+A.name,this)}}if(d.morphTargetManager&&(this.morphTargetManager=d.morphTargetManager),w.getPhysicsEngine){const t=w.getPhysicsEngine();if(A&&t)if(1===t.getPluginVersion()){const A=t.getImpostorForPhysicsObject(d);A&&(this.physicsImpostor=A.clone(this))}else 2===t.getPluginVersion()&&d.physicsBody&&d.physicsBody.clone(this)}for(let N=0;N<w.nj.length;N++){const t=w.nj[N];t.k===d&&t.clone(t.name,this)}this.skeleton=d.skeleton,this.refreshBoundingInfo(!0,!0),this.Nj(!0)}constructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4?arguments[4]:void 0,B=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(d,t),this._internalMeshDataInfo=new I,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new R,this._thinInstanceDataStorage=new L,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=u.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,t=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(d,t,A)=>{d&&A&&(this._uniformBuffer?this.transferToEffect(t):A.bindOnlyWorldMatrix(t))},N&&this._copySource(N,p,B),null!==A&&(this.parent=A),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=d=>{d.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new w.b(this._internalMeshDataInfo._onMeshReadyObserverAdded),N&&N.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;const w=0===this.getTotalVertices()||t&&t.doNotInstantiate&&(!0===t.doNotInstantiate||t.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),d||this.parent,!0):this.qd("instance of "+(this.name||this.id));w.parent=d||this.parent,w.position=this.position.clone(),w.Gf=this.Gf.clone(),this.rotationQuaternion?w.rotationQuaternion=this.rotationQuaternion.clone():w.rotation=this.rotation.clone(),A&&A(this,w);for(const N of this.getChildTransformNodes(!0))"InstancedMesh"===N.getClassName()&&"Mesh"===w.getClassName()&&N.sourceMesh===this?N.instantiateHierarchy(w,{doNotInstantiate:t&&t.doNotInstantiate||!1,newSourcedMesh:w},A):N.instantiateHierarchy(w,t,A);return w}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(d){let t=super.toString(d);if(t+=", n vertices: "+this.getTotalVertices(),t+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let A=0;A<this.animations.length;A++)t+=", animation[0]: "+this.animations[A].toString(d);if(d)if(this._geometry){const d=this.xf(),A=this.getVerticesData(k.f.PositionKind);A&&d&&(t+=", flat shading: "+(A.length/3===d.length?"YES":"NO"))}else t+=", flat shading: UNKNOWN";return t}_unBindEffect(){super._unBindEffect();for(const d of this.instances)d._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const d=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((t,A)=>t.distanceOrScreenCoverage<A.distanceOrScreenCoverage?d:t.distanceOrScreenCoverage>A.distanceOrScreenCoverage?-d:0))}addLODLevel(d,t){if(t&&t._masterMesh)return H.e.Warn("You cannot use a mesh as LOD level twice"),this;const A=new j(d,t);return this._internalMeshDataInfo._LODLevels.push(A),t&&(t._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(d){const t=this._internalMeshDataInfo;for(let A=0;A<t._LODLevels.length;A++){const w=t._LODLevels[A];if(w.distanceOrScreenCoverage===d)return w.mesh}return null}removeLODLevel(d){const t=this._internalMeshDataInfo;for(let A=0;A<t._LODLevels.length;A++)t._LODLevels[A].mesh===d&&(t._LODLevels.splice(A,1),d&&(d._masterMesh=null));return this._sortLODLevels(),this}getLOD(d,t){const A=this._internalMeshDataInfo;if(!A._LODLevels||0===A._LODLevels.length)return this;const w=t||this.getBoundingInfo().boundingSphere,N=d.mode===W.d.ORTHOGRAPHIC_CAMERA?d.Ui:w.centerWorld.Uc(d.globalPosition).length();let p=N,B=1;if(A._useLODScreenCoverage){const t=d.screenArea;let A=w.radiusWorld*d.Ui/N;A=A*A*Math.PI,p=A/t,B=-1}if(B*A._LODLevels[A._LODLevels.length-1].distanceOrScreenCoverage>B*p)return this.onLODLevelSelection&&this.onLODLevelSelection(p,this,this),this;for(let X=0;X<A._LODLevels.length;X++){const d=A._LODLevels[X];if(B*d.distanceOrScreenCoverage<B*p){if(d.mesh){if(4===d.mesh.delayLoadState)return d.mesh._checkDelayState(),this;if(2===d.mesh.delayLoadState)return this;d.mesh._preActivate(),d.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(p,this,d.mesh),d.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(p,this,this),this}get Aj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(d,t,A,w){var N,p;if(!this._geometry)return null;let B=w||null===(N=this._userInstancedBuffersStorage)||void 0===N||null===(p=N.vertexBuffers[d])||void 0===p?void 0:p.getFloatData(this.instances.length+1,A||t&&1!==this._geometry.meshes.length);return B||(B=this._geometry.getVerticesData(d,t,A)),B}copyVerticesData(d,t){this._geometry&&this._geometry.copyVerticesData(d,t)}getVertexBuffer(d,t){var A;return this._geometry?(t||null===(A=this._userInstancedBuffersStorage)||void 0===A?void 0:A.vertexBuffers[d])??this._geometry.getVertexBuffer(d):null}isVerticesDataPresent(d,t){var A;return this._geometry?!t&&void 0!==(null===(A=this._userInstancedBuffersStorage)||void 0===A?void 0:A.vertexBuffers[d])||this._geometry.isVerticesDataPresent(d):!!this._delayInfo&&-1!==this._delayInfo.indexOf(d)}isVertexBufferUpdatable(d,t){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(d);if(!t){var A;const t=null===(A=this._userInstancedBuffersStorage)||void 0===A?void 0:A.vertexBuffers[d];if(t)return t.isUpdatable()}return this._geometry.isVertexBufferUpdatable(d)}getVerticesDataKinds(d){if(!this._geometry){const d=[];return this._delayInfo&&this._delayInfo.forEach((function(t){d.push(t)})),d}const t=this._geometry.getVerticesDataKinds();if(!d&&this._userInstancedBuffersStorage)for(const A in this._userInstancedBuffersStorage.vertexBuffers)-1===t.indexOf(A)&&t.push(A);return t}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}xf(d,t){return this._geometry?this._geometry.xf(d,t):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(d))return!1;if(!this.If||0===this.If.length)return!0;if(!d)return!0;const A=this.getEngine(),w=this.va(),N=t||A.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.Nj();const p=this.material||w.defaultMaterial;if(p)if(p._storeEffectOnSubMeshes)for(const k of this.If){const d=k.Ha();if(d)if(d._storeEffectOnSubMeshes){if(!d.isReadyForSubMesh(this,k,N))return!1}else if(!d.isReady(this,N))return!1}else if(!p.isReady(this,N))return!1;const B=A.currentRenderPassId;for(const k of this.lightSources){const d=k.getShadowGenerators();if(!d)continue;const t=d.values();for(let w=t.next();!0!==w.done;w=t.next()){var X,W,a,D;const d=w.value;if(d&&(null===(X=d.getShadowMap())||void 0===X||!X.renderList||null!==(W=d.getShadowMap())&&void 0!==W&&W.renderList&&-1!==(null===(a=d.getShadowMap())||void 0===a||null===(D=a.renderList)||void 0===D?void 0:D.indexOf(this)))){const t=d.getShadowMap().renderPassIds??[A.currentRenderPassId];for(let w=0;w<t.length;++w){A.currentRenderPassId=t[w];for(const t of this.If){var i;if(!d.isReady(t,N,(null===(i=t.Ha())||void 0===i?void 0:i.needAlphaBlendingForMesh(this))??!1))return A.currentRenderPassId=B,!1}}A.currentRenderPassId=B}}}for(const k of this._internalMeshDataInfo._LODLevels)if(k.mesh&&!k.mesh.isReady(N))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}Eh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(d){this._instanceDataStorage.overridenInstanceCount=d}_preActivate(){const d=this._internalMeshDataInfo,t=this.va().getRenderId();return d._preActivateId===t||(d._preActivateId=t,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(d){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=d),this}_registerInstanceForRenderId(d,t){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:t,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[t]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=t,this._instanceDataStorage.visibleInstances[t]=new Array),this._instanceDataStorage.visibleInstances[t].push(d),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let d,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;d="object"===typeof t?t:{applySkeleton:t,applyMorph:A};const w=this.Aj?this.Aj.boundingBias:null;return this.Fa(this._getData(d,null,k.f.PositionKind),w),this}_createGlobalSubMesh(d){const t=this.getTotalVertices();if(!t||!this.xf())return null;if(this.If&&this.If.length>0){const A=this.xf();if(!A)return null;const w=A.length;let N=!1;if(d)N=!0;else for(const d of this.If){if(d.indexStart+d.indexCount>w){N=!0;break}if(d.verticesStart+d.verticesCount>t){N=!0;break}}if(!N)return this.If[0]}return this.releaseSubMeshes(),new J.c(0,0,t,0,this.getTotalIndices(),this)}subdivide(d){if(d<1)return;const t=this.getTotalIndices();let A=t/d|0,w=0;for(;A%3!==0;)A++;this.releaseSubMeshes();for(let N=0;N<d&&!(w>=t);N++)J.c.CreateFromIndices(0,w,N===d-1?t-w:A,this,void 0,!1),w+=A;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(d,t,A,w);else{const w=new b.e;w.set(t,d);const N=this.va();new Q.c(Q.c.RandomId(),N,w,A,this)}return this}removeVerticesData(d){this._geometry&&this._geometry.removeVerticesData(d)}markVerticesDataAsUpdatable(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this.getVertexBuffer(d);A&&A.isUpdatable()!==t&&this.Ga(d,this.getVerticesData(d),t)}setVerticesBuffer(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=Q.c.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(d,null,t),this}updateVerticesData(d,t,A,w){return this._geometry?(w?(this.makeGeometryUnique(),this.updateVerticesData(d,t,A,!1)):this._geometry.updateVerticesData(d,t,A),this):this}updateMeshPositions(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const A=this.getVerticesData(k.f.PositionKind);if(!A)return this;if(d(A),this.updateVerticesData(k.f.PositionKind,A,!1,!1),t){const d=this.xf(),t=this.getVerticesData(k.f.NormalKind);if(!t)return this;b.e.ComputeNormals(A,d,t),this.updateVerticesData(k.f.NormalKind,t,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const d=this._geometry,t=this._geometry.j(Q.c.RandomId());return d.releaseForMesh(this,!0),t.Ca(this),this}setIndexBuffer(d,t,A){let w=this._geometry;w||(w=new Q.c(Q.c.RandomId(),this.va(),void 0,void 0,this)),w.setIndexBuffer(d,t,A)}setIndices(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(d,t,A,w);else{const t=new b.e;t.indices=d;const w=this.va();new Q.c(Q.c.RandomId(),w,t,A,this)}return this}updateIndices(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(d,t,A),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(d,t,A){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const N=this.va().getEngine();let p;if(this._unIndexed)if(this._getRenderingFillMode(A)===U.c.WireFrameFillMode)p=d._getLinesIndexBuffer(this.xf(),N);else p=null;else switch(this._getRenderingFillMode(A)){case U.c.PointFillMode:p=null;break;case U.c.WireFrameFillMode:p=d._getLinesIndexBuffer(this.xf(),N);break;default:case U.c.TriangleFillMode:p=this._geometry.getIndexBuffer()}return this._bindDirect(t,p,w)}_bindDirect(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(d),A&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(d,t,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(d,t),this):this}_draw(d,t,A){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const w=this.va().getEngine();return this._unIndexed&&t!==U.c.WireFrameFillMode||t==U.c.PointFillMode?w.drawArraysType(t,d.verticesStart,d.verticesCount,this.forcedInstanceCount||A):t==U.c.WireFrameFillMode?w.drawElementsType(t,0,d._linesIndexCount,this.forcedInstanceCount||A):w.drawElementsType(t,d.indexStart,d.indexCount,this.forcedInstanceCount||A),this}registerBeforeRender(d){return this.onBeforeRenderObservable.add(d),this}unregisterBeforeRender(d){return this.onBeforeRenderObservable.removeCallback(d),this}registerAfterRender(d){return this.onAfterRenderObservable.add(d),this}unregisterAfterRender(d){return this.onAfterRenderObservable.removeCallback(d),this}_getInstancesRenderList(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(t)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[d]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[d]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const A=this.va(),w=A._isInIntermediateRendering(),N=w?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,p=this._instanceDataStorage.batchCache;if(p.mustReturn=!1,p.renderSelf[d]=t||!N&&this.isEnabled()&&this.isVisible,p.visibleInstances[d]=null,this._instanceDataStorage.visibleInstances&&!t){const t=this._instanceDataStorage.visibleInstances,N=A.getRenderId(),B=w?t.intermediateDefaultRenderId:t.defaultRenderId;p.visibleInstances[d]=t[N],!p.visibleInstances[d]&&B&&(p.visibleInstances[d]=t[B])}return p.hardwareInstancedRendering[d]=!t&&this._instanceDataStorage.hardwareInstancedRendering&&null!==p.visibleInstances[d]&&void 0!==p.visibleInstances[d],this._instanceDataStorage.previousBatch=p,p}_renderWithInstances(d,t,A,w,N){const p=A.visibleInstances[d._id],B=p?p.length:0,X=this._instanceDataStorage,W=X.instancesBufferSize;let D=X.instancesBuffer,i=X.instancesPreviousBuffer;const b=16*(B+1)*4;for(;X.instancesBufferSize<b;)X.instancesBufferSize*=2;X.instancesData&&W==X.instancesBufferSize||(X.instancesData=new Float32Array(X.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!X.instancesPreviousData||W!=X.instancesBufferSize)&&(X.instancesPreviousData=new Float32Array(X.instancesBufferSize/4));let Q=0,P=0;const J=A.renderSelf[d._id],U=!D||W!==X.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!X.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||X.isFrozen&&!U)P=(J?1:0)+B;else{const t=this.getWorldMatrix();if(J&&(this._scene.needsPreviousWorldMatrices&&(X.masterMeshPreviousWorldMatrix?(X.masterMeshPreviousWorldMatrix.copyToArray(X.instancesPreviousData,Q),X.masterMeshPreviousWorldMatrix.p(t)):(X.masterMeshPreviousWorldMatrix=t.clone(),X.masterMeshPreviousWorldMatrix.copyToArray(X.instancesPreviousData,Q))),t.copyToArray(X.instancesData,Q),Q+=16,P++),p){var T;if(u.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(T=d.Ha())&&void 0!==T&&T.needAlphaBlendingForMesh(d.getRenderingMesh())){const d=this._scene.activeCamera.globalPosition;for(let t=0;t<p.length;t++){const A=p[t];A._distanceToCamera=a.l.Distance(A.getBoundingInfo().boundingSphere.centerWorld,d)}p.sort(((d,t)=>d._distanceToCamera>t._distanceToCamera?-1:d._distanceToCamera<t._distanceToCamera?1:0))}for(let d=0;d<p.length;d++){const t=p[d],A=t.getWorldMatrix();A.copyToArray(X.instancesData,Q),this._scene.needsPreviousWorldMatrices&&(t._previousWorldMatrix?(t._previousWorldMatrix.copyToArray(X.instancesPreviousData,Q),t._previousWorldMatrix.p(A)):(t._previousWorldMatrix=A.clone(),t._previousWorldMatrix.copyToArray(X.instancesPreviousData,Q))),Q+=16,P++}}}return U?(D&&D.dispose(),i&&i.dispose(),D=new k.d(N,X.instancesData,!0,16,!1,!0),X.instancesBuffer=D,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=D.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=D.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=D.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=D.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(i=new k.d(N,X.instancesPreviousData,!0,16,!1,!0),X.instancesPreviousBuffer=i,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=i.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=i.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=i.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=i.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(D.updateDirectly(X.instancesData,0,P),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||i.updateDirectly(X.instancesPreviousData,0,P)),this._processInstancedBuffers(p,J),this.va()._activeIndices.addCount(d.indexCount*P,!1),N._currentDrawContext&&(N._currentDrawContext.useInstancing=!0),this._bind(d,w,t),this._draw(d,t,P),!this._scene.needsPreviousWorldMatrices||U||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||i.updateDirectly(X.instancesData,0,P),N.unbindInstanceAttributes(),this}_renderWithThinInstances(d,t,A,w){var N;const p=(null===(N=this._thinInstanceDataStorage)||void 0===N?void 0:N.instancesCount)??0;this.va()._activeIndices.addCount(d.indexCount*p,!1),w._currentDrawContext&&(w._currentDrawContext.useInstancing=!0),this._bind(d,A,t),this._draw(d,t,p),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,p):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),w.unbindInstanceAttributes()}_processInstancedBuffers(d,t){}_processRendering(d,t,A,w,N,p,B,X){const W=this.va(),a=W.getEngine();if(w=this._getRenderingFillMode(w),p&&t.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(t,w,A,a),this;if(p)this._renderWithInstances(t,w,N,A,a);else{a._currentDrawContext&&(a._currentDrawContext.useInstancing=!1);let A=0;N.renderSelf[t._id]&&(B&&B(!1,d.getWorldMatrix(),X),A++,this._draw(t,w,this._instanceDataStorage.overridenInstanceCount));const p=N.visibleInstances[t._id];if(p){const d=p.length;A+=d;for(let A=0;A<d;A++){const d=p[A].getWorldMatrix();B&&B(!0,d,X),this._draw(t,w)}}W._activeIndices.addCount(t.indexCount*A,!1)}return this}_rebuild(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(d&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const t in this._userInstancedBuffersStorage.vertexBuffers){const A=this._userInstancedBuffersStorage.vertexBuffers[t];A&&(d&&A.dispose(),this._userInstancedBuffersStorage.vertexBuffers[t]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(d)}_freeze(){if(this.If){for(let d=0;d<this.If.length;d++)this._getInstancesRenderList(d);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(d,t,A,w){let N=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const p=this._scene.getEngine(),B=p.currentRenderPassId;if(void 0!==d&&(p.currentRenderPassId=d),w)(!N||N&&w.isInFrustum(this._scene._frustumPlanes))&&this.render(w,!!t,A);else for(let X=0;X<this.If.length;X++){const d=this.If[X];(!N||N&&d.isInFrustum(this._scene._frustumPlanes))&&this.render(d,!!t,A)}return void 0!==d&&(p.currentRenderPassId=B),this}directRender(){if(!this.If)return this;for(const d of this.If)this.render(d,!1);return this}render(d,t,A){var w,N,p;const B=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const X=(null===(w=B.activeCameras)||void 0===w?void 0:w.length)??0;if((X>1&&B.activeCamera===B.activeCameras[0]||X<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const W=this._getInstancesRenderList(d._id,!!A);if(W.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const a=B.getEngine();let D=0,i=null;this.ignoreCameraMaxZ&&B.activeCamera&&!B._isInIntermediateRendering()&&(D=B.activeCamera.maxZ,i=B.activeCamera,B.activeCamera.maxZ=0,B.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const k=d.getRenderingMesh(),b=W.hardwareInstancedRendering[d._id]||k.hasThinInstances||!!this._userInstancedBuffersStorage&&!d.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,Q=this._instanceDataStorage,P=d.Ha();if(!P)return i&&(i.maxZ=D,B.updateTransformMatrix(!0)),this;if(Q.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===P){if(P._storeEffectOnSubMeshes&&(null===(N=d._drawWrapper)||void 0===N||!N._wasPreviouslyReady)||!P._storeEffectOnSubMeshes&&!P._getDrawWrapper()._wasPreviouslyReady)return i&&(i.maxZ=D,B.updateTransformMatrix(!0)),this}else{if(P._storeEffectOnSubMeshes){if(!P.isReadyForSubMesh(this,d,b))return i&&(i.maxZ=D,B.updateTransformMatrix(!0)),this}else if(!P.isReady(this,b))return i&&(i.maxZ=D,B.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=P}let J;t&&a.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),J=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?d._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const T=(null===(p=J)||void 0===p?void 0:p.effect)??null;for(const U of B._beforeRenderingMeshStage)U.action(this,d,W,T);if(!J||!T)return i&&(i.maxZ=D,B.updateTransformMatrix(!0)),this;const F=A||this;let q;if(Q.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Tg&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)q=Q.sideOrientation;else{const d=F._getWorldMatrixDeterminant();q=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),d<0&&(q=q===U.c.ClockWiseSideOrientation?U.c.CounterClockWiseSideOrientation:U.c.ClockWiseSideOrientation),Q.sideOrientation=q}const H=this._internalMeshDataInfo._effectiveMaterial._preBind(J,q);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&a.setDepthWrite(!0);const f=this._internalMeshDataInfo._effectiveMaterial,v=f.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),b||this._bind(d,T,v,!1);const m=F.getWorldMatrix();f._storeEffectOnSubMeshes?f.bindForSubMesh(m,this,d):f.bind(m,this),!f.Tg&&f.separateCullingPass&&(a.setState(!0,f.zOffset,!1,!H,f.cullBackFaces,f.stencil,f.zOffsetUnits),this._processRendering(this,d,T,v,W,b,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),a.setState(!0,f.zOffset,!1,H,f.cullBackFaces,f.stencil,f.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(d)),this._processRendering(this,d,T,v,W,b,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const U of B._afterRenderingMeshStage)U.action(this,d,W,T);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),i&&(i.maxZ=D,B.updateTransformMatrix(!0)),2!==B.performancePriority||Q.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(k.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(k.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const d=this.getVerticesData(k.f.MatricesWeightsKind),t=d.length;for(let A=0;A<t;A+=4){const t=d[A]+d[A+1]+d[A+2]+d[A+3];if(0===t)d[A]=1;else{const w=1/t;d[A]*=w,d[A+1]*=w,d[A+2]*=w,d[A+3]*=w}}this.Ga(k.f.MatricesWeightsKind,d)}_normalizeSkinWeightsAndExtra(){const d=this.getVerticesData(k.f.MatricesWeightsExtraKind),t=this.getVerticesData(k.f.MatricesWeightsKind),A=t.length;for(let w=0;w<A;w+=4){let A=t[w]+t[w+1]+t[w+2]+t[w+3];if(A+=d[w]+d[w+1]+d[w+2]+d[w+3],0===A)t[w]=1;else{const N=1/A;t[w]*=N,t[w+1]*=N,t[w+2]*=N,t[w+3]*=N,d[w]*=N,d[w+1]*=N,d[w+2]*=N,d[w+3]*=N}}this.Ga(k.f.MatricesWeightsKind,t),this.Ga(k.f.MatricesWeightsKind,d)}validateSkinning(){const d=this.getVerticesData(k.f.MatricesWeightsExtraKind),t=this.getVerticesData(k.f.MatricesWeightsKind);if(null===t||null==this.skeleton)return{skinned:!1,valid:!0,nm:"not skinned"};const A=t.length;let w=0,N=0,p=0,B=0;const X=null===d?4:8,W=[];for(let k=0;k<=X;k++)W[k]=0;for(let k=0;k<A;k+=4){let A=t[k],a=A,D=0===a?0:1;for(let N=1;N<X;N++){const p=N<4?t[k+N]:d[k+N-4];p>A&&w++,0!==p&&D++,a+=p,A=p}if(W[D]++,D>p&&(p=D),0===a)N++;else{const A=1/a;let w=0;for(let N=0;N<X;N++)w+=N<4?Math.abs(t[k+N]-t[k+N]*A):Math.abs(d[k+N-4]-d[k+N-4]*A);w>.001&&B++}}const a=this.skeleton.bones.length,D=this.getVerticesData(k.f.MatricesIndicesKind),i=this.getVerticesData(k.f.MatricesIndicesExtraKind);let b=0;for(let k=0;k<A;k+=4)for(let d=0;d<X;d++){const t=d<4?D[k+d]:i[k+d-4];(t>=a||t<0)&&b++}return{skinned:!0,valid:0===N&&0===B&&0===b,nm:"Number of Weights = "+A/4+"\nMaximum influences = "+p+"\nMissing Weights = "+N+"\nNot Sorted = "+w+"\nNot Normalized = "+B+"\nWeightCounts = ["+W+"]\nNumber of bones = "+a+"\nBad Bone Indices = "+b}}_checkDelayState(){const d=this.va();return this._geometry?this._geometry.load(d):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(d)),this}_queueLoad(d){d.addPendingData(this);const t=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return N.g.LoadFile(this.delayLoadingFile,(t=>{t instanceof ArrayBuffer?this._delayLoadingFunction(t,this):this._delayLoadingFunction(JSON.parse(t),this),this.instances.forEach((d=>{d.refreshBoundingInfo(),d._syncSubMeshes()})),this.delayLoadState=1,d.removePendingData(this)}),(()=>{}),d.offlineProvider,t),this}isInFrustum(d){return 2!==this.delayLoadState&&(!!super.isInFrustum(d)&&(this._checkDelayState(),!0))}setMaterialById(d){const t=this.va().materials;let A;for(A=t.length-1;A>-1;A--)if(t[A].id===d)return this.material=t[A],this;const w=this.va().multiMaterials;for(A=w.length-1;A>-1;A--)if(w[A].id===d)return this.material=w[A],this;return this}getAnimatables(){const d=[];return this.material&&d.push(this.material),this.skeleton&&d.push(this.skeleton),d}bakeTransformIntoVertices(d){if(!this.isVerticesDataPresent(k.f.PositionKind))return this;const t=this.If.splice(0);this._resetPointsArrayCache();let A=this.getVerticesData(k.f.PositionKind);const w=a.l.Zero();let N;for(N=0;N<A.length;N+=3)a.l.TransformCoordinatesFromFloatsToRef(A[N],A[N+1],A[N+2],d,w).toArray(A,N);if(this.Ga(k.f.PositionKind,A,this.getVertexBuffer(k.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(k.f.NormalKind)){for(A=this.getVerticesData(k.f.NormalKind),N=0;N<A.length;N+=3)a.l.TransformNormalFromFloatsToRef(A[N],A[N+1],A[N+2],d,w).normalize().toArray(A,N);this.Ga(k.f.NormalKind,A,this.getVertexBuffer(k.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(k.f.TangentKind)){for(A=this.getVerticesData(k.f.TangentKind),N=0;N<A.length;N+=4)a.l.TransformNormalFromFloatsToRef(A[N],A[N+1],A[N+2],d,w).normalize().toArray(A,N);this.Ga(k.f.TangentKind,A,this.getVertexBuffer(k.f.TangentKind).isUpdatable())}return d.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.If=t,this}bakeCurrentTransformIntoVertices(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.Nj(!0)),this.resetLocalMatrix(d),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0,A=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new u(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),d,this,t,A)}dispose(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const A=this._internalMeshDataInfo;if(A._onBeforeDrawObservable&&A._onBeforeDrawObservable.clear(),A._onBeforeBindObservable&&A._onBeforeBindObservable.clear(),A._onBeforeRenderObservable&&A._onBeforeRenderObservable.clear(),A._onAfterRenderObservable&&A._onAfterRenderObservable.clear(),A._onBetweenPassObservable&&A._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(A.meshMap)for(const d in A.meshMap){const t=A.meshMap[d];t&&(t._internalMeshDataInfo._source=null,A.meshMap[d]=void 0)}A._source&&A._source._internalMeshDataInfo.meshMap&&(A._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const d=this.va().meshes;for(const t of d){const d=t;d._internalMeshDataInfo&&d._internalMeshDataInfo._source&&d._internalMeshDataInfo._source===this&&(d._internalMeshDataInfo._source=null)}}A._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(d,t)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(d,t,A,w,p,B){let X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],W=arguments.length>7?arguments[7]:void 0;const a=this.va();return N.g.LoadImage(d,(d=>{const N=d.width,W=d.height,a=this.getEngine().createCanvas(N,W).getContext("2d");a.drawImage(d,0,0);const D=a.getImageData(0,0,N,W).data;this.applyDisplacementMapFromBuffer(D,N,W,t,A,p,B,X),w&&w(this)}),W||(()=>{}),a.offlineProvider),this}applyDisplacementMapFromBuffer(d,t,A,w,N,p,B){let X=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(k.f.PositionKind)||!this.isVerticesDataPresent(k.f.NormalKind)||!this.isVerticesDataPresent(k.f.UVKind))return H.e.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const W=this.getVerticesData(k.f.PositionKind,!0,!0),D=this.getVerticesData(k.f.NormalKind),i=this.getVerticesData(k.f.UVKind);let Q=a.l.Zero();const P=a.l.Zero(),J=a.j.Zero();p=p||a.j.Zero(),B=B||new a.j(1,1);for(let k=0;k<W.length;k+=3){a.l.FromArrayToRef(W,k,Q),a.l.FromArrayToRef(D,k,P),a.j.FromArrayToRef(i,k/3*2,J);const X=4*((Math.abs(J.x*B.x+p.x%1)*(t-1)%t|0)+(Math.abs(J.y*B.y+p.y%1)*(A-1)%A|0)*t),b=.3*(d[X]/255)+.59*(d[X+1]/255)+.11*(d[X+2]/255);P.normalize(),P.scaleInPlace(w+(N-w)*b),Q=Q.add(P),Q.toArray(W,k)}return b.e.ComputeNormals(W,this.xf(),D),X?(this.Ga(k.f.PositionKind,W),this.Ga(k.f.NormalKind,D),this.Ga(k.f.UVKind,i)):(this.updateVerticesData(k.f.PositionKind,W),this.updateVerticesData(k.f.NormalKind,D)),this}_getFlattenedNormals(d,t){const A=new Float32Array(3*d.length);let w=0;const N=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let p=0;p<d.length;p+=3){const B=a.l.Lg(t,3*d[p]),X=a.l.Lg(t,3*d[p+1]),W=a.l.Lg(t,3*d[p+2]),D=B.Uc(X),i=W.Uc(X),k=a.l.Normalize(a.l.Cross(D,i));N&&k.scaleInPlace(-1);for(let d=0;d<3;d++)A[w++]=k.x,A[w++]=k.y,A[w++]=k.z}return A}_convertToUnIndexedMesh(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.getVerticesDataKinds().filter((d=>{var t;return!(null!==(t=this.getVertexBuffer(d))&&void 0!==t&&t.getIsInstanced())})),A=this.xf(),w={},N=(d,t)=>{const w=new Float32Array(A.length*t);let N=0;for(let p=0;p<A.length;p++)for(let B=0;B<t;B++)w[N++]=d[A[p]*t+B];return w},p=this.getBoundingInfo(),B=this.Aj?this.If.slice(0):[];for(const X of t)w[X]=this.getVerticesData(X);for(const X of t){const t=this.getVertexBuffer(X),p=t.getSize();if(d&&X===k.f.NormalKind){const d=this._getFlattenedNormals(A,w[k.f.PositionKind]);this.Ga(k.f.NormalKind,d,t.isUpdatable(),p)}else this.Ga(X,N(w[X],p),t.isUpdatable(),p)}if(this.morphTargetManager){for(let t=0;t<this.morphTargetManager.numTargets;t++){const w=this.morphTargetManager.getTarget(t),p=w.getPositions();w.setPositions(N(p,3));const B=w.getNormals();B&&w.setNormals(d?this._getFlattenedNormals(A,p):N(B,3));const X=w.getTangents();X&&w.setTangents(N(X,3));const W=w.getUVs();W&&w.setUVs(N(W,2))}this.morphTargetManager.synchronize()}for(let X=0;X<A.length;X++)A[X]=X;this.setIndices(A),this._unIndexed=!0,this.releaseSubMeshes();for(const X of B){const d=X.getBoundingInfo();J.c.AddToMesh(X.materialIndex,X.indexStart,X.indexCount,X.indexStart,X.indexCount,this).setBoundingInfo(d)}return this.setBoundingInfo(p),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=b.e.ExtractFromMesh(this);let A;if(d&&this.isVerticesDataPresent(k.f.NormalKind)&&t.ya){for(A=0;A<t.ya.length;A++)t.ya[A]*=-1;this.Ga(k.f.NormalKind,t.ya,this.isVertexBufferUpdatable(k.f.NormalKind))}if(t.indices){let d;for(A=0;A<t.indices.length;A+=3)d=t.indices[A+1],t.indices[A+1]=t.indices[A+2],t.indices[A+2]=d;this.setIndices(t.indices,null,this.isVertexBufferUpdatable(k.f.PositionKind),!0)}return this}increaseVertices(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const t=b.e.ExtractFromMesh(this),A=t.indices&&!Array.isArray(t.indices)&&Array.from?Array.from(t.indices):t.indices,w=t.xa&&!Array.isArray(t.xa)&&Array.from?Array.from(t.xa):t.xa,N=t.Aa&&!Array.isArray(t.Aa)&&Array.from?Array.from(t.Aa):t.Aa,p=t.ya&&!Array.isArray(t.ya)&&Array.from?Array.from(t.ya):t.ya;if(A&&w){t.indices=A,t.xa=w,N&&(t.Aa=N),p&&(t.ya=p);const B=d+1,X=new Array;for(let d=0;d<B+1;d++)X[d]=new Array;let W,D;const i=new a.l(0,0,0),b=new a.l(0,0,0),Q=new a.j(0,0),P=new Array,J=new Array,U=new Array;let T,F,q,H=w.length;N&&(F=N.length),p&&(q=p.length);for(let d=0;d<A.length;d+=3){J[0]=A[d],J[1]=A[d+1],J[2]=A[d+2];for(let d=0;d<3;d++)if(W=J[d],D=J[(d+1)%3],void 0===U[W]&&void 0===U[D]?(U[W]=new Array,U[D]=new Array):(void 0===U[W]&&(U[W]=new Array),void 0===U[D]&&(U[D]=new Array)),void 0===U[W][D]&&void 0===U[D][W]){U[W][D]=[],i.x=(w[3*D]-w[3*W])/B,i.y=(w[3*D+1]-w[3*W+1])/B,i.z=(w[3*D+2]-w[3*W+2])/B,p&&(b.x=(p[3*D]-p[3*W])/B,b.y=(p[3*D+1]-p[3*W+1])/B,b.z=(p[3*D+2]-p[3*W+2])/B),N&&(Q.x=(N[2*D]-N[2*W])/B,Q.y=(N[2*D+1]-N[2*W+1])/B),U[W][D].push(W);for(let d=1;d<B;d++)U[W][D].push(w.length/3),w[H++]=w[3*W]+d*i.x,w[H++]=w[3*W+1]+d*i.y,w[H++]=w[3*W+2]+d*i.z,p&&(p[q++]=p[3*W]+d*b.x,p[q++]=p[3*W+1]+d*b.y,p[q++]=p[3*W+2]+d*b.z),N&&(N[F++]=N[2*W]+d*Q.x,N[F++]=N[2*W+1]+d*Q.y);U[W][D].push(D),U[D][W]=new Array,T=U[W][D].length;for(let d=0;d<T;d++)U[D][W][d]=U[W][D][T-1-d]}X[0][0]=A[d],X[1][0]=U[A[d]][A[d+1]][1],X[1][1]=U[A[d]][A[d+2]][1];for(let t=2;t<B;t++){X[t][0]=U[A[d]][A[d+1]][t],X[t][t]=U[A[d]][A[d+2]][t],i.x=(w[3*X[t][t]]-w[3*X[t][0]])/t,i.y=(w[3*X[t][t]+1]-w[3*X[t][0]+1])/t,i.z=(w[3*X[t][t]+2]-w[3*X[t][0]+2])/t,p&&(b.x=(p[3*X[t][t]]-p[3*X[t][0]])/t,b.y=(p[3*X[t][t]+1]-p[3*X[t][0]+1])/t,b.z=(p[3*X[t][t]+2]-p[3*X[t][0]+2])/t),N&&(Q.x=(N[2*X[t][t]]-N[2*X[t][0]])/t,Q.y=(N[2*X[t][t]+1]-N[2*X[t][0]+1])/t);for(let d=1;d<t;d++)X[t][d]=w.length/3,w[H++]=w[3*X[t][0]]+d*i.x,w[H++]=w[3*X[t][0]+1]+d*i.y,w[H++]=w[3*X[t][0]+2]+d*i.z,p&&(p[q++]=p[3*X[t][0]]+d*b.x,p[q++]=p[3*X[t][0]+1]+d*b.y,p[q++]=p[3*X[t][0]+2]+d*b.z),N&&(N[F++]=N[2*X[t][0]]+d*Q.x,N[F++]=N[2*X[t][0]+1]+d*Q.y)}X[B]=U[A[d+1]][A[d+2]],P.push(X[0][0],X[1][0],X[1][1]);for(let d=1;d<B;d++){let t;for(t=0;t<d;t++)P.push(X[d][t],X[d+1][t],X[d+1][t+1]),P.push(X[d][t],X[d+1][t+1],X[d][t+1]);P.push(X[d][t],X[d+1][t],X[d+1][t+1])}}t.indices=P,t.Ca(this,this.isVertexBufferUpdatable(k.f.PositionKind))}else H.e.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const d=b.e.ExtractFromMesh(this),t=d.Aa,A=d.indices,w=d.xa,N=d.za,p=d.matricesIndices,B=d.matricesWeights,X=d.matricesIndicesExtra,W=d.matricesWeightsExtra;if(void 0===A||void 0===w||null===A||null===w)H.e.Warn("VertexData contains empty entries");else{const a=new Array,D=new Array,i=new Array,Q=new Array,P=new Array,J=new Array,U=new Array,T=new Array;let F=new Array,q=0;const H={};let f,v;for(let d=0;d<A.length;d+=3){v=[A[d],A[d+1],A[d+2]],F=[];for(let d=0;d<3;d++){F[d]="";for(let t=0;t<3;t++)Math.abs(w[3*v[d]+t])<1e-8&&(w[3*v[d]+t]=0),F[d]+=w[3*v[d]+t]+"|"}if(F[0]!=F[1]&&F[0]!=F[2]&&F[1]!=F[2])for(let d=0;d<3;d++){if(f=H[F[d]],void 0===f){H[F[d]]=q,f=q++;for(let t=0;t<3;t++)a.push(w[3*v[d]+t]);if(null!==N&&void 0!==N)for(let t=0;t<4;t++)Q.push(N[4*v[d]+t]);if(null!==t&&void 0!==t)for(let A=0;A<2;A++)i.push(t[2*v[d]+A]);if(null!==p&&void 0!==p)for(let t=0;t<4;t++)P.push(p[4*v[d]+t]);if(null!==B&&void 0!==B)for(let t=0;t<4;t++)J.push(B[4*v[d]+t]);if(null!==X&&void 0!==X)for(let t=0;t<4;t++)U.push(X[4*v[d]+t]);if(null!==W&&void 0!==W)for(let t=0;t<4;t++)T.push(W[4*v[d]+t])}D.push(f)}}const m=new Array;b.e.ComputeNormals(a,D,m),d.xa=a,d.indices=D,d.ya=m,null!==t&&void 0!==t&&(d.Aa=i),null!==N&&void 0!==N&&(d.za=Q),null!==p&&void 0!==p&&(d.matricesIndices=P),null!==B&&void 0!==B&&(d.matricesWeights=J),null!==X&&void 0!==X&&(d.matricesIndicesExtra=U),null!==B&&void 0!==B&&(d.matricesWeightsExtra=T),d.Ca(this,this.isVertexBufferUpdatable(k.f.PositionKind))}}static _instancedMeshFactory(d,t){throw(0,v.b)("InstancedMesh")}static _PhysicsImpostorParser(d,t,A){throw(0,v.b)("PhysicsImpostor")}qd(d){const t=u._instancedMeshFactory(d,this);return t.parent=this.parent,t}synchronizeInstances(){for(let d=0;d<this.instances.length;d++){this.instances[d]._syncSubMeshes()}return this}optimizeIndices(d){const t=this.xf(),A=this.getVerticesData(k.f.PositionKind);if(!A||!t)return this;const w=[];for(let N=0;N<A.length;N+=3)w.push(a.l.Lg(A,N));const p=[];return N.d.SyncAsyncForLoop(w.length,40,(d=>{const t=w.length-1-d,A=w[t];for(let N=0;N<t;++N){const d=w[N];if(A.equals(d)){p[t]=N;break}}}),(()=>{for(let d=0;d<t.length;++d)t[d]=p[t[d]]||t[d];const A=this.If.slice(0);this.setIndices(t),this.If=A,d&&d(this)})),this}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d.name=this.name,d.id=this.id,d.uniqueId=this.uniqueId,d.type=this.getClassName(),B.c&&B.c.HasTags(this)&&(d.tags=B.c.GetTags(this)),d.position=this.position.gj(),this.rotationQuaternion?d.rotationQuaternion=this.rotationQuaternion.gj():this.rotation&&(d.rotation=this.rotation.gj()),d.Gf=this.Gf.gj(),this._postMultiplyPivotMatrix?d.pivotMatrix=this.getPivotMatrix().gj():d.localMatrix=this.getPivotMatrix().gj(),d.isEnabled=this.isEnabled(!1),d.isVisible=this.isVisible,d.infiniteDistance=this.infiniteDistance,d.pickable=this.Be,d.receiveShadows=this.receiveShadows,d.billboardMode=this.billboardMode,d.visibility=this.visibility,d.rg=this.rg,d.checkCollisions=this.checkCollisions,d.ellipsoid=this.ellipsoid.gj(),d.ellipsoidOffset=this.ellipsoidOffset.gj(),d.Da=this.Da,d.isBlocker=this.isBlocker,d.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(d),d.isUnIndexed=this.isUnIndexed;const t=this._geometry;if(t&&this.If){d.geometryUniqueId=t.uniqueId,d.geometryId=t.id,d.If=[];for(let t=0;t<this.If.length;t++){const A=this.If[t];d.If.push({materialIndex:A.materialIndex,verticesStart:A.verticesStart,verticesCount:A.verticesCount,indexStart:A.indexStart,indexCount:A.indexCount})}}if(this.material?this.material.doNotSerialize||(d.materialUniqueId=this.material.uniqueId,d.materialId=this.material.id):(this.material=null,d.materialUniqueId=this._scene.defaultMaterial.uniqueId,d.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(d.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(d.skeletonId=this.skeleton.id,d.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(m.e.NAME_PHYSICSENGINE)){const t=this.getPhysicsImpostor();t&&(d.physicsMass=t.getParam("mass"),d.physicsFriction=t.getParam("friction"),d.physicsRestitution=t.getParam("mass"),d.physicsImpostor=t.type)}this.metadata&&(d.metadata=this.metadata),d.instances=[];for(let A=0;A<this.instances.length;A++){const t=this.instances[A];if(t.doNotSerialize)continue;const w={name:t.name,id:t.id,isEnabled:t.isEnabled(!1),isVisible:t.isVisible,Be:t.Be,checkCollisions:t.checkCollisions,position:t.position.gj(),Gf:t.Gf.gj()};if(t.parent&&t.parent._serializeAsParent(w),t.rotationQuaternion?w.rotationQuaternion=t.rotationQuaternion.gj():t.rotation&&(w.rotation=t.rotation.gj()),this.va()._getComponent(m.e.NAME_PHYSICSENGINE)){const d=t.getPhysicsImpostor();d&&(w.physicsMass=d.getParam("mass"),w.physicsFriction=d.getParam("friction"),w.physicsRestitution=d.getParam("mass"),w.physicsImpostor=d.type)}t.metadata&&(w.metadata=t.metadata),t.actionManager&&(w.actions=t.actionManager.serialize(t.name)),d.instances.push(w),q.d.AppendSerializedAnimations(t,w),w.ranges=t.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(d.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const t={data:{},sizes:{},strides:{}};for(const d in this._userThinInstanceBuffersStorage.data)t.data[d]=Array.from(this._userThinInstanceBuffersStorage.data[d]),t.sizes[d]=this._userThinInstanceBuffersStorage.sizes[d],t.strides[d]=this._userThinInstanceBuffersStorage.strides[d];d.thinInstances.userThinInstance=t}return q.d.AppendSerializedAnimations(this,d),d.ranges=this.serializeAnimationRanges(),d.layerMask=this.layerMask,d.alphaIndex=this.alphaIndex,d.hasVertexAlpha=this.hasVertexAlpha,d.overlayAlpha=this.overlayAlpha,d.overlayColor=this.overlayColor.gj(),d.renderOverlay=this.renderOverlay,d.applyFog=this.applyFog,this.actionManager&&(d.actions=this.actionManager.serialize(this.name)),d}_syncGeometryWithMorphTargetManager(){if(!this.Aj)return;this._markSubMeshesAsAttributesDirty();const d=this._internalAbstractMeshDataInfo._morphTargetManager;if(d&&d.vertexCount){if(d.vertexCount!==this.getTotalVertices())return H.e.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(d.isUsingTextureForTargets)return;for(let t=0;t<d.numInfluencers;t++){const A=d.getActiveTarget(t),w=A.getPositions();if(!w)return void H.e.Error("Invalid morph target. Target must have positions.");this.Aj.Ga(k.f.PositionKind+t,w,!1,3);const N=A.getNormals();N&&this.Aj.Ga(k.f.NormalKind+t,N,!1,3);const p=A.getTangents();p&&this.Aj.Ga(k.f.TangentKind+t,p,!1,3);const B=A.getUVs();B&&this.Aj.Ga(k.f.UVKind+"_"+t,B,!1,2)}}else{let d=0;for(;this.Aj.isVerticesDataPresent(k.f.PositionKind+d);)this.Aj.removeVerticesData(k.f.PositionKind+d),this.Aj.isVerticesDataPresent(k.f.NormalKind+d)&&this.Aj.removeVerticesData(k.f.NormalKind+d),this.Aj.isVerticesDataPresent(k.f.TangentKind+d)&&this.Aj.removeVerticesData(k.f.TangentKind+d),this.Aj.isVerticesDataPresent(k.f.UVKind+d)&&this.Aj.removeVerticesData(k.f.UVKind+"_"+d),d++}}static Parse(d,t,A){let w;if(w=d.type&&"LinesMesh"===d.type?u._LinesMeshParser(d,t):d.type&&"GroundMesh"===d.type?u._GroundMeshParser(d,t):d.type&&"GoldbergMesh"===d.type?u._GoldbergMeshParser(d,t):d.type&&"GreasedLineMesh"===d.type?u._GreasedLineMeshParser(d,t):d.type&&"TrailMesh"===d.type?u._TrailMeshParser(d,t):new u(d.name,t),w.id=d.id,w._waitingParsedUniqueId=d.uniqueId,B.c&&B.c.AddTagsTo(w,d.tags),w.position=a.l.Lg(d.position),void 0!==d.metadata&&(w.metadata=d.metadata),d.rotationQuaternion?w.rotationQuaternion=a.f.Lg(d.rotationQuaternion):d.rotation&&(w.rotation=a.l.Lg(d.rotation)),w.Gf=a.l.Lg(d.Gf),d.localMatrix?w.setPreTransformMatrix(a.c.Lg(d.localMatrix)):d.pivotMatrix&&w.setPivotMatrix(a.c.Lg(d.pivotMatrix)),w.Mf(d.isEnabled),w.isVisible=d.isVisible,w.infiniteDistance=d.infiniteDistance,w.rg=!!d.rg,w.showBoundingBox=d.showBoundingBox,w.showSubMeshesBoundingBox=d.showSubMeshesBoundingBox,void 0!==d.applyFog&&(w.applyFog=d.applyFog),void 0!==d.pickable&&(w.Be=d.pickable),void 0!==d.alphaIndex&&(w.alphaIndex=d.alphaIndex),w.receiveShadows=d.receiveShadows,void 0!==d.billboardMode&&(w.billboardMode=d.billboardMode),void 0!==d.visibility&&(w.visibility=d.visibility),w.checkCollisions=d.checkCollisions,w.Da=!!d.Da,d.ellipsoid&&(w.ellipsoid=a.l.Lg(d.ellipsoid)),d.ellipsoidOffset&&(w.ellipsoidOffset=a.l.Lg(d.ellipsoidOffset)),null!=d.overrideMaterialSideOrientation&&(w.sideOrientation=d.overrideMaterialSideOrientation),void 0!==d.sideOrientation&&(w.sideOrientation=d.sideOrientation),void 0!==d.isBlocker&&(w.isBlocker=d.isBlocker),w._shouldGenerateFlatShading=d.useFlatShading,d.Gh&&(w._waitingData.Gh=d.Gh),void 0!==d.parentId&&(w._waitingParentId=d.parentId),void 0!==d.parentInstanceIndex&&(w._waitingParentInstanceIndex=d.parentInstanceIndex),void 0!==d.actions&&(w._waitingData.actions=d.actions),void 0!==d.overlayAlpha&&(w.overlayAlpha=d.overlayAlpha),void 0!==d.overlayColor&&(w.overlayColor=D.e.Lg(d.overlayColor)),void 0!==d.renderOverlay&&(w.renderOverlay=d.renderOverlay),w.isUnIndexed=!!d.isUnIndexed,w.hasVertexAlpha=d.hasVertexAlpha,d.delayLoadingFile?(w.delayLoadState=4,w.delayLoadingFile=A+d.delayLoadingFile,w.buildBoundingInfo(a.l.Lg(d.boundingBoxMinimum),a.l.Lg(d.boundingBoxMaximum)),d._binaryInfo&&(w._binaryInfo=d._binaryInfo),w._delayInfo=[],d.hasUVs&&w._delayInfo.push(k.f.UVKind),d.hasUVs2&&w._delayInfo.push(k.f.UV2Kind),d.hasUVs3&&w._delayInfo.push(k.f.UV3Kind),d.hasUVs4&&w._delayInfo.push(k.f.UV4Kind),d.hasUVs5&&w._delayInfo.push(k.f.UV5Kind),d.hasUVs6&&w._delayInfo.push(k.f.UV6Kind),d.hasColors&&w._delayInfo.push(k.f.ColorKind),d.hasMatricesIndices&&w._delayInfo.push(k.f.MatricesIndicesKind),d.hasMatricesWeights&&w._delayInfo.push(k.f.MatricesWeightsKind),w._delayLoadingFunction=Q.c._ImportGeometry,F.b.ForceFullSceneLoadingForIncremental&&w._checkDelayState()):Q.c._ImportGeometry(d,w),d.materialUniqueId?w._waitingMaterialId=d.materialUniqueId:d.materialId&&(w._waitingMaterialId=d.materialId),d.morphTargetManagerId>-1&&(w._waitingMorphTargetManagerId=d.morphTargetManagerId),void 0!==d.skeletonId&&null!==d.skeletonId&&(w.skeleton=t.getLastSkeletonById(d.skeletonId),d.numBoneInfluencers&&(w.numBoneInfluencers=d.numBoneInfluencers)),d.animations){for(let t=0;t<d.animations.length;t++){const A=d.animations[t],N=(0,f.d)("BABYLON.Animation");N&&w.animations.push(N.Parse(A))}i.d.ParseAnimationRanges(w,d,t)}if(d.autoAnimate&&t.beginAnimation(w,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),d.layerMask&&!isNaN(d.layerMask)?w.layerMask=Math.abs(parseInt(d.layerMask)):w.layerMask=268435455,d.physicsImpostor&&(w.physicsImpostor=u._PhysicsImpostorParser(t,w,d)),d.lodMeshIds&&(w._waitingData.lods={ids:d.lodMeshIds,distances:d.lodDistances?d.lodDistances:null,coverages:d.lodCoverages?d.lodCoverages:null}),d.instances)for(let N=0;N<d.instances.length;N++){const A=d.instances[N],p=w.qd(A.name);if(A.id&&(p.id=A.id),B.c&&(A.tags?B.c.AddTagsTo(p,A.tags):B.c.AddTagsTo(p,d.tags)),p.position=a.l.Lg(A.position),void 0!==A.metadata&&(p.metadata=A.metadata),void 0!==A.parentId&&(p._waitingParentId=A.parentId),void 0!==A.parentInstanceIndex&&(p._waitingParentInstanceIndex=A.parentInstanceIndex),void 0!==A.isEnabled&&null!==A.isEnabled&&p.Mf(A.isEnabled),void 0!==A.isVisible&&null!==A.isVisible&&(p.isVisible=A.isVisible),void 0!==A.Be&&null!==A.Be&&(p.Be=A.Be),A.rotationQuaternion?p.rotationQuaternion=a.f.Lg(A.rotationQuaternion):A.rotation&&(p.rotation=a.l.Lg(A.rotation)),p.Gf=a.l.Lg(A.Gf),void 0!=A.checkCollisions&&null!=A.checkCollisions&&(p.checkCollisions=A.checkCollisions),void 0!=A.pickable&&null!=A.pickable&&(p.Be=A.pickable),void 0!=A.showBoundingBox&&null!=A.showBoundingBox&&(p.showBoundingBox=A.showBoundingBox),void 0!=A.showSubMeshesBoundingBox&&null!=A.showSubMeshesBoundingBox&&(p.showSubMeshesBoundingBox=A.showSubMeshesBoundingBox),void 0!=A.alphaIndex&&null!=A.showSubMeshesBoundingBox&&(p.alphaIndex=A.alphaIndex),A.physicsImpostor&&(p.physicsImpostor=u._PhysicsImpostorParser(t,p,A)),void 0!==A.actions&&(p._waitingData.actions=A.actions),A.animations){for(let d=0;d<A.animations.length;d++){const t=A.animations[d],w=(0,f.d)("BABYLON.Animation");w&&p.animations.push(w.Parse(t))}i.d.ParseAnimationRanges(p,A,t),A.autoAnimate&&t.beginAnimation(p,A.autoAnimateFrom,A.autoAnimateTo,A.autoAnimateLoop,A.autoAnimateSpeed||1)}}if(d.thinInstances){const t=d.thinInstances;if(w.thinInstanceEnablePicking=!!t.enablePicking,t.matrixData?(w.Rj("matrix",new Float32Array(t.matrixData),16,!1),w._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,w._thinInstanceDataStorage.instancesCount=t.instancesCount):w._thinInstanceDataStorage.matrixBufferSize=t.matrixBufferSize,d.thinInstances.userThinInstance){const t=d.thinInstances.userThinInstance;for(const d in t.data)w.Rj(d,new Float32Array(t.data[d]),t.strides[d],!1),w._userThinInstanceBuffersStorage.sizes[d]=t.sizes[d]}}return w}setPositionsForCPUSkinning(){const d=this._internalMeshDataInfo;if(!d._sourcePositions){const t=this.getVerticesData(k.f.PositionKind);if(!t)return d._sourcePositions;d._sourcePositions=new Float32Array(t),this.isVertexBufferUpdatable(k.f.PositionKind)||this.Ga(k.f.PositionKind,t,!0)}return d._sourcePositions}setNormalsForCPUSkinning(){const d=this._internalMeshDataInfo;if(!d._sourceNormals){const t=this.getVerticesData(k.f.NormalKind);if(!t)return d._sourceNormals;d._sourceNormals=new Float32Array(t),this.isVertexBufferUpdatable(k.f.NormalKind)||this.Ga(k.f.NormalKind,t,!0)}return d._sourceNormals}applySkeleton(d){if(!this.Aj)return this;if(this.Aj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.Aj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(k.f.PositionKind))return this;if(!this.isVerticesDataPresent(k.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(k.f.MatricesWeightsKind))return this;const t=this.isVerticesDataPresent(k.f.NormalKind),A=this._internalMeshDataInfo;if(!A._sourcePositions){const d=this.If.slice();this.setPositionsForCPUSkinning(),this.If=d}t&&!A._sourceNormals&&this.setNormalsForCPUSkinning();let w=this.getVerticesData(k.f.PositionKind);if(!w)return this;w instanceof Float32Array||(w=new Float32Array(w));let N=this.getVerticesData(k.f.NormalKind);if(t){if(!N)return this;N instanceof Float32Array||(N=new Float32Array(N))}const p=this.getVerticesData(k.f.MatricesIndicesKind),B=this.getVerticesData(k.f.MatricesWeightsKind);if(!B||!p)return this;const X=this.numBoneInfluencers>4,W=X?this.getVerticesData(k.f.MatricesIndicesExtraKind):null,D=X?this.getVerticesData(k.f.MatricesWeightsExtraKind):null,i=d.getTransformMatrices(this),b=a.l.Zero(),Q=new a.c,P=new a.c;let J,U=0;for(let k=0;k<w.length;k+=3,U+=4){let d;for(J=0;J<4;J++)d=B[U+J],d>0&&(a.c.FromFloat32ArrayToRefScaled(i,Math.floor(16*p[U+J]),d,P),Q.addToSelf(P));if(X)for(J=0;J<4;J++)d=D[U+J],d>0&&(a.c.FromFloat32ArrayToRefScaled(i,Math.floor(16*W[U+J]),d,P),Q.addToSelf(P));a.l.TransformCoordinatesFromFloatsToRef(A._sourcePositions[k],A._sourcePositions[k+1],A._sourcePositions[k+2],Q,b),b.toArray(w,k),t&&(a.l.TransformNormalFromFloatsToRef(A._sourceNormals[k],A._sourceNormals[k+1],A._sourceNormals[k+2],Q,b),b.toArray(N,k)),Q.reset()}return this.updateVerticesData(k.f.PositionKind,w),t&&this.updateVerticesData(k.f.NormalKind,N),this}static MinMax(d){let t=null,A=null;return d.forEach((function(d){const w=d.getBoundingInfo().boundingBox;t&&A?(t.minimizeInPlace(w.minimumWorld),A.maximizeInPlace(w.maximumWorld)):(t=w.minimumWorld,A=w.maximumWorld)})),t&&A?{min:t,max:A}:{min:a.l.Zero(),max:a.l.Zero()}}static Center(d){const t=d instanceof Array?u.MinMax(d):d;return a.l.Center(t.min,t.max)}static MergeMeshes(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;return(0,X.k)(u._MergeMeshesCoroutine(d,t,A,w,N,p,!1))}static MergeMeshesAsync(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0;return(0,X.g)(u._MergeMeshesCoroutine(d,t,A,w,N,p,!0),(0,X.c)())}static*_MergeMeshesCoroutine(d){let t,A=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],w=arguments.length>2?arguments[2]:void 0,N=arguments.length>3?arguments[3]:void 0,p=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0;if(0===(d=d.filter(Boolean)).length)return null;if(!w){let A=0;for(t=0;t<d.length;t++)if(A+=d[t].getTotalVertices(),A>=65536)return H.e.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}B&&(p=!1);const W=new Array,a=new Array,D=new Array,i=d[0].sideOrientation;for(t=0;t<d.length;t++){const A=d[t];if(A.isAnInstance)return H.e.Warn("Cannot merge instance meshes."),null;if(i!==A.sideOrientation)return H.e.Warn("Cannot merge meshes with different sideOrientation values."),null;if(p&&D.push(A.getTotalIndices()),B)if(A.material){const d=A.material;if(d instanceof T.c){for(let t=0;t<d.Kf.length;t++)W.indexOf(d.Kf[t])<0&&W.push(d.Kf[t]);for(let t=0;t<A.If.length;t++)a.push(W.indexOf(d.Kf[A.If[t].materialIndex])),D.push(A.If[t].indexCount)}else{W.indexOf(d)<0&&W.push(d);for(let t=0;t<A.If.length;t++)a.push(W.indexOf(d)),D.push(A.If[t].indexCount)}}else for(let d=0;d<A.If.length;d++)a.push(0),D.push(A.If[d].indexCount)}const k=d[0],Q=d=>{const t=d.Nj(!0);return{vertexData:b.e.ExtractFromMesh(d,!1,!1),transform:t}},{vertexData:P,transform:U}=Q(k);X&&(yield);const F=new Array(d.length-1);for(let b=1;b<d.length;b++)F[b-1]=Q(d[b]),X&&(yield);const q=P._mergeCoroutine(U,F,w,X,!A);let f=q.next();for(;!f.done;)X&&(yield),f=q.next();const v=f.value;N||(N=new u(k.name+"_merged",k.va()));const m=v._applyToCoroutine(N,void 0,X);let j=m.next();for(;!j.done;)X&&(yield),j=m.next();if(N.checkCollisions=k.checkCollisions,N.sideOrientation=k.sideOrientation,A)for(t=0;t<d.length;t++)d[t].dispose();if(p||B){N.releaseSubMeshes(),t=0;let d=0;for(;t<D.length;)J.c.CreateFromIndices(0,d,D[t],N,void 0,!1),d+=D[t],t++;for(const t of N.If)t.refreshBoundingInfo();N.Nj(!0)}if(B){const d=new T.c(k.name+"_merged",k.va());d.Kf=W;for(let t=0;t<N.If.length;t++)N.If[t].materialIndex=a[t];N.material=d}else N.material=k.material;return N}Ej(d){d._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(d)}Cj(d){const t=d._indexInSourceMeshInstanceArray;if(-1!=t){if(t!==this.instances.length-1){const d=this.instances[this.instances.length-1];this.instances[t]=d,d._indexInSourceMeshInstanceArray=t}d._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===U.c.CounterClockWiseSideOrientation}_getRenderingFillMode(d){const t=this.va();return t.forcePointsCloud?U.c.PointFillMode:t.forceWireframe?U.c.WireFrameFillMode:this.overrideRenderingFillMode??d}setMaterialByID(d){return this.setMaterialById(d)}static CreateRibbon(d,t,A,w,N,p,B,X,W){throw new Error("Import MeshBuilder to populate this function")}static rb(d,t,A,w,N,p){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(d,t,A,w,N){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(d,t,A,w,N,p){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(d,t,A,w){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(d,t,A,w,N,p,B,X,W){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(d,t,A,w,N,p,B){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(d,t,A,w,N,p,B,X,W,a){throw new Error("Import MeshBuilder to populate this function")}static sb(d,t,A,w,N){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(d,t,A,w,N,p,B,X){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(d,t,A,w,N,p,B){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(d,t,A,w,N,p,B,X){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(d,t,A,w,N,p,B,X,W,a){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(d,t,A,w,N,p,B,X,W,a,D,i){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(d,t,A,w,N,p,B){throw new Error("Import MeshBuilder to populate this function")}static Nf(d,t,A,w,N){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(d,t,A,w,N,p){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(d,t,A,w,N,p,B,X,W){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(d,t,A,w,N,p,B,X,W,a,D){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(d,t,A,w,N,p,B,X,W,a){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(d,t,A){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(d,t,A){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(d,t,A,w,N,p){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(d,t,A){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(d){throw new Error("Import MeshBuilder to populate this function")}}u.FRONTSIDE=b.e.FRONTSIDE,u.BACKSIDE=b.e.BACKSIDE,u.DOUBLESIDE=b.e.DOUBLESIDE,u.DEFAULTSIDE=b.e.DEFAULTSIDE,u.NO_CAP=0,u.CAP_START=1,u.CAP_END=2,u.CAP_ALL=3,u.NO_FLIP=0,u.FLIP_TILE=1,u.ROTATE_TILE=2,u.FLIP_ROW=3,u.ROTATE_ROW=4,u.FLIP_N_ROTATE_TILE=5,u.FLIP_N_ROTATE_ROW=6,u.CENTER=0,u.LEFT=1,u.RIGHT=2,u.TOP=3,u.BOTTOM=4,u.INSTANCEDMESH_SORT_TRANSPARENT=!1,u._GroundMeshParser=(d,t)=>{throw(0,v.b)("GroundMesh")},u._GoldbergMeshParser=(d,t)=>{throw(0,v.b)("GoldbergMesh")},u._LinesMeshParser=(d,t)=>{throw(0,v.b)("LinesMesh")},u._GreasedLineMeshParser=(d,t)=>{throw(0,v.b)("GreasedLineMesh")},u._GreasedLineRibbonMeshParser=(d,t)=>{throw(0,v.b)("GreasedLineRibbonMesh")},u._TrailMeshParser=(d,t)=>{throw(0,v.b)("TrailMesh")},(0,f.g)("BABYLON.Mesh",u)},11339:(d,t,A)=>{"use strict";A.d(t,{e:()=>Q});var w=A(11041),N=A(11076),p=A(11120),B=A(10761),X=A(11094),W=A(10740),a=A(11047),D=A(11314),i=A(10787),k=A(11205);class b{}class Q{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,D.d)(this._applyToCoroutine.bind(this)),this.uniqueId=Q._UniqueIDGenerator,Q._UniqueIDGenerator++}set(d,t){switch(d.length||W.e.Warn(`Setting vertex data kind '${t}' with an empty array`),t){case p.f.PositionKind:this.xa=d;break;case p.f.NormalKind:this.ya=d;break;case p.f.TangentKind:this.tangents=d;break;case p.f.UVKind:this.Aa=d;break;case p.f.UV2Kind:this.uvs2=d;break;case p.f.UV3Kind:this.uvs3=d;break;case p.f.UV4Kind:this.uvs4=d;break;case p.f.UV5Kind:this.uvs5=d;break;case p.f.UV6Kind:this.uvs6=d;break;case p.f.ColorKind:this.za=d;break;case p.f.MatricesIndicesKind:this.matricesIndices=d;break;case p.f.MatricesWeightsKind:this.matricesWeights=d;break;case p.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=d;break;case p.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=d}}Ca(d,t){return this._applyTo(d,t,!1),this}applyToGeometry(d,t){return this._applyTo(d,t,!1),this}updateMesh(d){return this._update(d),this}updateGeometry(d){return this._update(d),this}*_applyToCoroutine(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;if(this.xa&&(d.Ga(p.f.PositionKind,this.xa,t),A&&(yield)),this.ya&&(d.Ga(p.f.NormalKind,this.ya,t),A&&(yield)),this.tangents&&(d.Ga(p.f.TangentKind,this.tangents,t),A&&(yield)),this.Aa&&(d.Ga(p.f.UVKind,this.Aa,t),A&&(yield)),this.uvs2&&(d.Ga(p.f.UV2Kind,this.uvs2,t),A&&(yield)),this.uvs3&&(d.Ga(p.f.UV3Kind,this.uvs3,t),A&&(yield)),this.uvs4&&(d.Ga(p.f.UV4Kind,this.uvs4,t),A&&(yield)),this.uvs5&&(d.Ga(p.f.UV5Kind,this.uvs5,t),A&&(yield)),this.uvs6&&(d.Ga(p.f.UV6Kind,this.uvs6,t),A&&(yield)),this.za&&(d.Ga(p.f.ColorKind,this.za,t),this.hasVertexAlpha&&void 0!==d.hasVertexAlpha&&(d.hasVertexAlpha=!0),A&&(yield)),this.matricesIndices&&(d.Ga(p.f.MatricesIndicesKind,this.matricesIndices,t),A&&(yield)),this.matricesWeights&&(d.Ga(p.f.MatricesWeightsKind,this.matricesWeights,t),A&&(yield)),this.matricesIndicesExtra&&(d.Ga(p.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,t),A&&(yield)),this.matricesWeightsExtra&&(d.Ga(p.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,t),A&&(yield)),this.indices?(d.setIndices(this.indices,null,t),A&&(yield)):d.setIndices([],null),d.If&&this.materialInfos&&this.materialInfos.length>1){const t=d;t.If=[];for(const d of this.materialInfos)new k.c(d.materialIndex,d.verticesStart,d.verticesCount,d.indexStart,d.indexCount,t)}return this}_update(d,t,A){return this.xa&&d.updateVerticesData(p.f.PositionKind,this.xa,t,A),this.ya&&d.updateVerticesData(p.f.NormalKind,this.ya,t,A),this.tangents&&d.updateVerticesData(p.f.TangentKind,this.tangents,t,A),this.Aa&&d.updateVerticesData(p.f.UVKind,this.Aa,t,A),this.uvs2&&d.updateVerticesData(p.f.UV2Kind,this.uvs2,t,A),this.uvs3&&d.updateVerticesData(p.f.UV3Kind,this.uvs3,t,A),this.uvs4&&d.updateVerticesData(p.f.UV4Kind,this.uvs4,t,A),this.uvs5&&d.updateVerticesData(p.f.UV5Kind,this.uvs5,t,A),this.uvs6&&d.updateVerticesData(p.f.UV6Kind,this.uvs6,t,A),this.za&&d.updateVerticesData(p.f.ColorKind,this.za,t,A),this.matricesIndices&&d.updateVerticesData(p.f.MatricesIndicesKind,this.matricesIndices,t,A),this.matricesWeights&&d.updateVerticesData(p.f.MatricesWeightsKind,this.matricesWeights,t,A),this.matricesIndicesExtra&&d.updateVerticesData(p.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,t,A),this.matricesWeightsExtra&&d.updateVerticesData(p.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,t,A),this.indices&&d.setIndices(this.indices,null),this}static _TransformVector3Coordinates(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.length;const p=N.h.gb[0],B=N.h.gb[1];for(let X=A;X<A+w;X+=3)N.l.FromArrayToRef(d,X,p),N.l.TransformCoordinatesToRef(p,t,B),d[X]=B.x,d[X+1]=B.y,d[X+2]=B.z}static _TransformVector3Normals(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.length;const p=N.h.gb[0],B=N.h.gb[1];for(let X=A;X<A+w;X+=3)N.l.FromArrayToRef(d,X,p),N.l.TransformNormalToRef(p,t,B),d[X]=B.x,d[X+1]=B.y,d[X+2]=B.z}static _TransformVector4Normals(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:d.length;const p=N.h.Vector4[0],B=N.h.Vector4[1];for(let X=A;X<A+w;X+=4)N.m.FromArrayToRef(d,X,p),N.m.TransformNormalToRef(p,t,B),d[X]=B.x,d[X+1]=B.y,d[X+2]=B.z,d[X+3]=B.w}static _FlipFaces(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:d.length;for(let w=t;w<t+A;w+=3){const t=d[w+1];d[w+1]=d[w+2],d[w+2]=t}}transform(d){const t=d.determinant()<0;return this.xa&&Q._TransformVector3Coordinates(this.xa,d),this.ya&&Q._TransformVector3Normals(this.ya,d),this.tangents&&Q._TransformVector4Normals(this.tangents,d),t&&this.indices&&Q._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const d=[];for(const t of this.materialInfos){const A=new Q;if(this.xa&&(A.xa=this.xa.slice(3*t.verticesStart,3*(t.verticesCount+t.verticesStart))),this.ya&&(A.ya=this.ya.slice(3*t.verticesStart,3*(t.verticesCount+t.verticesStart))),this.tangents&&(A.tangents=this.tangents.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.za&&(A.za=this.za.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.Aa&&(A.Aa=this.Aa.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs2&&(A.uvs2=this.uvs2.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs3&&(A.uvs3=this.uvs3.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs4&&(A.uvs4=this.uvs4.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs5&&(A.uvs5=this.uvs5.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.uvs6&&(A.uvs6=this.uvs6.slice(2*t.verticesStart,2*(t.verticesCount+t.verticesStart))),this.matricesIndices&&(A.matricesIndices=this.matricesIndices.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesIndicesExtra&&(A.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesWeights&&(A.matricesWeights=this.matricesWeights.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.matricesWeightsExtra&&(A.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*t.verticesStart,4*(t.verticesCount+t.verticesStart))),this.indices){A.indices=[];for(let d=t.indexStart;d<t.indexStart+t.indexCount;d++)A.indices.push(this.indices[d]-t.verticesStart)}const w=new b;w.indexStart=0,w.indexCount=A.indices?A.indices.length:0,w.materialIndex=t.materialIndex,w.verticesStart=0,w.verticesCount=(A.xa?A.xa.length:0)/3,A.materialInfos=[w],d.push(A)}return d}merge(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const p=Array.isArray(d)?d.map((d=>({vertexData:d}))):[{vertexData:d}];return(0,D.k)(this._mergeCoroutine(void 0,p,t,!1,A,w,N))}*_mergeCoroutine(d,t){var A,w;let N=arguments.length>2&&void 0!==arguments[2]&&arguments[2],B=arguments.length>3?arguments[3]:void 0,X=arguments.length>4?arguments[4]:void 0,W=arguments.length>5&&void 0!==arguments[5]&&arguments[5],a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let D=t.map((d=>d.vertexData)),i=this;if(a)for(const p of D)p&&(p._validate(),!this.ya&&p.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&p.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&p.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&p.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&p.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&p.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&p.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&p.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&p.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&p.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&p.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&p.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&p.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const p of D)if(p)if(a)this.ya&&!p.ya&&(p.ya=new Float32Array(p.xa.length)),this.tangents&&!p.tangents&&(p.tangents=new Float32Array(p.xa.length/3*4)),this.Aa&&!p.Aa&&(p.Aa=new Float32Array(p.xa.length/3*2)),this.uvs2&&!p.uvs2&&(p.uvs2=new Float32Array(p.xa.length/3*2)),this.uvs3&&!p.uvs3&&(p.uvs3=new Float32Array(p.xa.length/3*2)),this.uvs4&&!p.uvs4&&(p.uvs4=new Float32Array(p.xa.length/3*2)),this.uvs5&&!p.uvs5&&(p.uvs5=new Float32Array(p.xa.length/3*2)),this.uvs6&&!p.uvs6&&(p.uvs6=new Float32Array(p.xa.length/3*2)),this.za&&!p.za&&(p.za=new Float32Array(p.xa.length/3*4),p.za.fill(1)),this.matricesIndices&&!p.matricesIndices&&(p.matricesIndices=new Float32Array(p.xa.length/3*4)),this.matricesWeights&&!p.matricesWeights&&(p.matricesWeights=new Float32Array(p.xa.length/3*4)),this.matricesIndicesExtra&&!p.matricesIndicesExtra&&(p.matricesIndicesExtra=new Float32Array(p.xa.length/3*4)),this.matricesWeightsExtra&&!p.matricesWeightsExtra&&(p.matricesWeightsExtra=new Float32Array(p.xa.length/3*4));else if(p._validate(),!this.ya!==!p.ya||!this.tangents!==!p.tangents||!this.Aa!==!p.Aa||!this.uvs2!==!p.uvs2||!this.uvs3!==!p.uvs3||!this.uvs4!==!p.uvs4||!this.uvs5!==!p.uvs5||!this.uvs6!==!p.uvs6||!this.za!==!p.za||!this.matricesIndices!==!p.matricesIndices||!this.matricesWeights!==!p.matricesWeights||!this.matricesIndicesExtra!==!p.matricesIndicesExtra||!this.matricesWeightsExtra!==!p.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(W){let A=0,w=0,N=0;const p=[];let B=null;const X=[];for(const t of this.splitBasedOnMaterialID())X.push({vertexData:t,transform:d});for(const d of t)if(d.vertexData)for(const t of d.vertexData.splitBasedOnMaterialID())X.push({vertexData:t,transform:d.transform});X.sort(((d,t)=>{const A=d.vertexData.materialInfos?d.vertexData.materialInfos[0].materialIndex:0,w=t.vertexData.materialInfos?t.vertexData.materialInfos[0].materialIndex:0;return A>w?1:A===w?0:-1}));for(const d of X){const t=d.vertexData;if(A=t.materialInfos?t.materialInfos[0].materialIndex:0,B&&B.materialIndex===A)B.indexCount+=t.indices.length,B.verticesCount+=t.xa.length/3;else{const d=new b;d.materialIndex=A,d.indexStart=w,d.indexCount=t.indices.length,d.verticesStart=N,d.verticesCount=t.xa.length/3,p.push(d),B=d}w+=t.indices.length,N+=t.xa.length/3}const W=X.splice(0,1)[0];i=W.vertexData,d=W.transform,D=X.map((d=>d.vertexData)),t=X,this.materialInfos=p}const k=D.reduce(((d,t)=>{var A;return d+((null===(A=t.indices)||void 0===A?void 0:A.length)??0)}),(null===(A=i.indices)||void 0===A?void 0:A.length)??0);let P=X||D.some((d=>d.indices===i.indices))?null===(w=i.indices)||void 0===w?void 0:w.slice():i.indices;if(k>0){var J;let A=(null===(J=P)||void 0===J?void 0:J.length)??0;if(P||(P=new Array(k)),P.length!==k){if(Array.isArray(P))P.length=k;else{const d=N||P instanceof Uint32Array?new Uint32Array(k):new Uint16Array(k);d.set(P),P=d}d&&d.determinant()<0&&Q._FlipFaces(P,0,A)}let w=i.xa?i.xa.length/3:0;for(const{vertexData:d,transform:N}of t)if(d.indices){for(let t=0;t<d.indices.length;t++)P[A+t]=d.indices[t]+w;N&&N.determinant()<0&&Q._FlipFaces(P,A,d.indices.length),w+=d.xa.length/3,A+=d.indices.length,B&&(yield)}}return this.indices=P,this.xa=Q._MergeElement(p.f.PositionKind,i.xa,d,t.map((d=>[d.vertexData.xa,d.transform]))),B&&(yield),i.ya&&(this.ya=Q._MergeElement(p.f.NormalKind,i.ya,d,t.map((d=>[d.vertexData.ya,d.transform]))),B&&(yield)),i.tangents&&(this.tangents=Q._MergeElement(p.f.TangentKind,i.tangents,d,t.map((d=>[d.vertexData.tangents,d.transform]))),B&&(yield)),i.Aa&&(this.Aa=Q._MergeElement(p.f.UVKind,i.Aa,d,t.map((d=>[d.vertexData.Aa,d.transform]))),B&&(yield)),i.uvs2&&(this.uvs2=Q._MergeElement(p.f.UV2Kind,i.uvs2,d,t.map((d=>[d.vertexData.uvs2,d.transform]))),B&&(yield)),i.uvs3&&(this.uvs3=Q._MergeElement(p.f.UV3Kind,i.uvs3,d,t.map((d=>[d.vertexData.uvs3,d.transform]))),B&&(yield)),i.uvs4&&(this.uvs4=Q._MergeElement(p.f.UV4Kind,i.uvs4,d,t.map((d=>[d.vertexData.uvs4,d.transform]))),B&&(yield)),i.uvs5&&(this.uvs5=Q._MergeElement(p.f.UV5Kind,i.uvs5,d,t.map((d=>[d.vertexData.uvs5,d.transform]))),B&&(yield)),i.uvs6&&(this.uvs6=Q._MergeElement(p.f.UV6Kind,i.uvs6,d,t.map((d=>[d.vertexData.uvs6,d.transform]))),B&&(yield)),i.za&&(this.za=Q._MergeElement(p.f.ColorKind,i.za,d,t.map((d=>[d.vertexData.za,d.transform]))),(void 0!==i.hasVertexAlpha||t.some((d=>void 0!==d.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=i.hasVertexAlpha||t.some((d=>d.vertexData.hasVertexAlpha))),B&&(yield)),i.matricesIndices&&(this.matricesIndices=Q._MergeElement(p.f.MatricesIndicesKind,i.matricesIndices,d,t.map((d=>[d.vertexData.matricesIndices,d.transform]))),B&&(yield)),i.matricesWeights&&(this.matricesWeights=Q._MergeElement(p.f.MatricesWeightsKind,i.matricesWeights,d,t.map((d=>[d.vertexData.matricesWeights,d.transform]))),B&&(yield)),i.matricesIndicesExtra&&(this.matricesIndicesExtra=Q._MergeElement(p.f.MatricesIndicesExtraKind,i.matricesIndicesExtra,d,t.map((d=>[d.vertexData.matricesIndicesExtra,d.transform]))),B&&(yield)),i.matricesWeightsExtra&&(this.matricesWeightsExtra=Q._MergeElement(p.f.MatricesWeightsExtraKind,i.matricesWeightsExtra,d,t.map((d=>[d.vertexData.matricesWeightsExtra,d.transform])))),this}static _MergeElement(d,t,A,w){const N=w.filter((d=>null!==d[0]&&void 0!==d[0]));if(!t&&0==N.length)return t;if(!t)return this._MergeElement(d,N[0][0],N[0][1],N.slice(1));const B=N.reduce(((d,t)=>d+t[0].length),t.length),X=d===p.f.PositionKind?Q._TransformVector3Coordinates:d===p.f.NormalKind?Q._TransformVector3Normals:d===p.f.TangentKind?Q._TransformVector4Normals:()=>{};if(t instanceof Float32Array){const d=new Float32Array(B);d.set(t),A&&X(d,A,0,t.length);let w=t.length;for(const[t,A]of N)d.set(t,w),A&&X(d,A,w,t.length),w+=t.length;return d}{const d=new Array(B);for(let A=0;A<t.length;A++)d[A]=t[A];A&&X(d,A,0,t.length);let w=t.length;for(const[t,A]of N){for(let A=0;A<t.length;A++)d[w+A]=t[A];A&&X(d,A,w,t.length),w+=t.length}return d}}_validate(){if(!this.xa)throw new i.h("Positions are required",i.e.MeshInvalidPositionsError);const d=(d,t)=>{const A=p.f.DeduceStride(d);if(t.length%A!==0)throw new Error("The "+d+"s array count must be a multiple of "+A);return t.length/A},t=d(p.f.PositionKind,this.xa),A=(A,w)=>{const N=d(A,w);if(N!==t)throw new Error("The "+A+"s element count ("+N+") does not match the positions count ("+t+")")};this.ya&&A(p.f.NormalKind,this.ya),this.tangents&&A(p.f.TangentKind,this.tangents),this.Aa&&A(p.f.UVKind,this.Aa),this.uvs2&&A(p.f.UV2Kind,this.uvs2),this.uvs3&&A(p.f.UV3Kind,this.uvs3),this.uvs4&&A(p.f.UV4Kind,this.uvs4),this.uvs5&&A(p.f.UV5Kind,this.uvs5),this.uvs6&&A(p.f.UV6Kind,this.uvs6),this.za&&A(p.f.ColorKind,this.za),this.matricesIndices&&A(p.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&A(p.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&A(p.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&A(p.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const d=this.serialize();return Q.Parse(d)}serialize(){const d={};if(this.xa&&(d.xa=Array.from(this.xa)),this.ya&&(d.ya=Array.from(this.ya)),this.tangents&&(d.tangents=Array.from(this.tangents)),this.Aa&&(d.Aa=Array.from(this.Aa)),this.uvs2&&(d.uvs2=Array.from(this.uvs2)),this.uvs3&&(d.uvs3=Array.from(this.uvs3)),this.uvs4&&(d.uvs4=Array.from(this.uvs4)),this.uvs5&&(d.uvs5=Array.from(this.uvs5)),this.uvs6&&(d.uvs6=Array.from(this.uvs6)),this.za&&(d.za=Array.from(this.za),d.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(d.matricesIndices=Array.from(this.matricesIndices),d.matricesIndices._isExpanded=!0),this.matricesWeights&&(d.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(d.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),d.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(d.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),d.indices=Array.from(this.indices),this.materialInfos){d.materialInfos=[];for(const t of this.materialInfos){const A={indexStart:t.indexStart,indexCount:t.indexCount,materialIndex:t.materialIndex,verticesStart:t.verticesStart,verticesCount:t.verticesCount};d.materialInfos.push(A)}}return d}static ExtractFromMesh(d,t,A){return Q._ExtractFrom(d,t,A)}static ExtractFromGeometry(d,t,A){return Q._ExtractFrom(d,t,A)}static _ExtractFrom(d,t,A){const w=new Q;if(d.isVerticesDataPresent(p.f.PositionKind)&&(w.xa=d.getVerticesData(p.f.PositionKind,t,A)),d.isVerticesDataPresent(p.f.NormalKind)&&(w.ya=d.getVerticesData(p.f.NormalKind,t,A)),d.isVerticesDataPresent(p.f.TangentKind)&&(w.tangents=d.getVerticesData(p.f.TangentKind,t,A)),d.isVerticesDataPresent(p.f.UVKind)&&(w.Aa=d.getVerticesData(p.f.UVKind,t,A)),d.isVerticesDataPresent(p.f.UV2Kind)&&(w.uvs2=d.getVerticesData(p.f.UV2Kind,t,A)),d.isVerticesDataPresent(p.f.UV3Kind)&&(w.uvs3=d.getVerticesData(p.f.UV3Kind,t,A)),d.isVerticesDataPresent(p.f.UV4Kind)&&(w.uvs4=d.getVerticesData(p.f.UV4Kind,t,A)),d.isVerticesDataPresent(p.f.UV5Kind)&&(w.uvs5=d.getVerticesData(p.f.UV5Kind,t,A)),d.isVerticesDataPresent(p.f.UV6Kind)&&(w.uvs6=d.getVerticesData(p.f.UV6Kind,t,A)),d.isVerticesDataPresent(p.f.ColorKind)){const N=d.Aj||d,B=N.getVertexBuffer(p.f.ColorKind),X=N.getVerticesData(p.f.ColorKind,t,A);if(3===B.getSize()){const d=new Float32Array(4*X.length/3);for(let t=0,A=0;t<X.length;t+=3,A+=4)d[A]=X[t],d[A+1]=X[t+1],d[A+2]=X[t+2],d[A+3]=1;w.za=d}else{if(4!==B.getSize())throw new Error(`Unexpected number of color components: ${B.getSize()}`);w.za=X}}return d.isVerticesDataPresent(p.f.MatricesIndicesKind)&&(w.matricesIndices=d.getVerticesData(p.f.MatricesIndicesKind,t,A)),d.isVerticesDataPresent(p.f.MatricesWeightsKind)&&(w.matricesWeights=d.getVerticesData(p.f.MatricesWeightsKind,t,A)),d.isVerticesDataPresent(p.f.MatricesIndicesExtraKind)&&(w.matricesIndicesExtra=d.getVerticesData(p.f.MatricesIndicesExtraKind,t,A)),d.isVerticesDataPresent(p.f.MatricesWeightsExtraKind)&&(w.matricesWeightsExtra=d.getVerticesData(p.f.MatricesWeightsExtraKind,t,A)),w.indices=d.xf(t,A),w}static CreateRibbon(d){throw(0,B.b)("ribbonBuilder")}static CreateBox(d){throw(0,B.b)("boxBuilder")}static CreateTiledBox(d){throw(0,B.b)("tiledBoxBuilder")}static CreateTiledPlane(d){throw(0,B.b)("tiledPlaneBuilder")}static CreateSphere(d){throw(0,B.b)("sphereBuilder")}static CreateCylinder(d){throw(0,B.b)("cylinderBuilder")}static CreateTorus(d){throw(0,B.b)("torusBuilder")}static CreateLineSystem(d){throw(0,B.b)("linesBuilder")}static CreateDashedLines(d){throw(0,B.b)("linesBuilder")}static CreateGround(d){throw(0,B.b)("groundBuilder")}static CreateTiledGround(d){throw(0,B.b)("groundBuilder")}static CreateGroundFromHeightMap(d){throw(0,B.b)("groundBuilder")}static Nf(d){throw(0,B.b)("planeBuilder")}static rb(d){throw(0,B.b)("discBuilder")}static CreatePolygon(d,t,A,w,N,p,X){throw(0,B.b)("polygonBuilder")}static CreateIcoSphere(d){throw(0,B.b)("icoSphereBuilder")}static CreatePolyhedron(d){throw(0,B.b)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||N.l.Up();throw(0,B.b)("capsuleBuilder")}static CreateTorusKnot(d){throw(0,B.b)("torusKnotBuilder")}static ComputeNormals(d,t,A,w){let p=0,B=0,X=0,W=0,a=0,D=0,i=0,k=0,b=0,Q=0,P=0,J=0,U=0,T=0,F=0,q=0,H=0,f=0,v=0,m=0,j=!1,n=!1,R=!1,Z=!1,L=1,I=0,u=null;w&&(j=!!w.facetNormals,n=!!w.facetPositions,R=!!w.facetPartitioning,L=!0===w.useRightHandedSystem?-1:1,I=w.ratio||0,Z=!!w.depthSort,u=w.distanceTo,Z&&void 0===u&&(u=N.l.Zero()));let V=0,h=0,l=0,y=0;for(R&&w&&w.bbSize&&(V=w.subDiv.X*I/w.bbSize.x,h=w.subDiv.Y*I/w.bbSize.y,l=w.subDiv.Z*I/w.bbSize.z,y=w.subDiv.max*w.subDiv.max,w.facetPartitioning.length=0),p=0;p<d.length;p++)A[p]=0;const s=t.length/3|0;for(p=0;p<s;p++){if(J=3*t[3*p],U=J+1,T=J+2,F=3*t[3*p+1],q=F+1,H=F+2,f=3*t[3*p+2],v=f+1,m=f+2,B=d[J]-d[F],X=d[U]-d[q],W=d[T]-d[H],a=d[f]-d[F],D=d[v]-d[q],i=d[m]-d[H],k=L*(X*i-W*D),b=L*(W*a-B*i),Q=L*(B*D-X*a),P=Math.sqrt(k*k+b*b+Q*Q),P=0===P?1:P,k/=P,b/=P,Q/=P,j&&w&&(w.facetNormals[p].x=k,w.facetNormals[p].y=b,w.facetNormals[p].z=Q),n&&w&&(w.facetPositions[p].x=(d[J]+d[F]+d[f])/3,w.facetPositions[p].y=(d[U]+d[q]+d[v])/3,w.facetPositions[p].z=(d[T]+d[H]+d[m])/3),R&&w){const t=Math.floor((w.facetPositions[p].x-w.bInfo.minimum.x*I)*V),A=Math.floor((w.facetPositions[p].y-w.bInfo.minimum.y*I)*h),N=Math.floor((w.facetPositions[p].z-w.bInfo.minimum.z*I)*l),B=Math.floor((d[J]-w.bInfo.minimum.x*I)*V),X=Math.floor((d[U]-w.bInfo.minimum.y*I)*h),W=Math.floor((d[T]-w.bInfo.minimum.z*I)*l),a=Math.floor((d[F]-w.bInfo.minimum.x*I)*V),D=Math.floor((d[q]-w.bInfo.minimum.y*I)*h),i=Math.floor((d[H]-w.bInfo.minimum.z*I)*l),k=Math.floor((d[f]-w.bInfo.minimum.x*I)*V),b=Math.floor((d[v]-w.bInfo.minimum.y*I)*h),Q=Math.floor((d[m]-w.bInfo.minimum.z*I)*l),P=B+w.subDiv.max*X+y*W,j=a+w.subDiv.max*D+y*i,n=k+w.subDiv.max*b+y*Q,R=t+w.subDiv.max*A+y*N;w.facetPartitioning[R]=w.facetPartitioning[R]?w.facetPartitioning[R]:new Array,w.facetPartitioning[P]=w.facetPartitioning[P]?w.facetPartitioning[P]:new Array,w.facetPartitioning[j]=w.facetPartitioning[j]?w.facetPartitioning[j]:new Array,w.facetPartitioning[n]=w.facetPartitioning[n]?w.facetPartitioning[n]:new Array,w.facetPartitioning[P].push(p),j!=P&&w.facetPartitioning[j].push(p),n!=j&&n!=P&&w.facetPartitioning[n].push(p),R!=P&&R!=j&&R!=n&&w.facetPartitioning[R].push(p)}if(Z&&w&&w.facetPositions){const d=w.depthSortedFacets[p];d.ind=3*p,d.sqDistance=N.l.DistanceSquared(w.facetPositions[p],u)}A[J]+=k,A[U]+=b,A[T]+=Q,A[F]+=k,A[q]+=b,A[H]+=Q,A[f]+=k,A[v]+=b,A[m]+=Q}for(p=0;p<A.length/3;p++)k=A[3*p],b=A[3*p+1],Q=A[3*p+2],P=Math.sqrt(k*k+b*b+Q*Q),P=0===P?1:P,k/=P,b/=P,Q/=P,A[3*p]=k,A[3*p+1]=b,A[3*p+2]=Q}static _ComputeSides(d,t,A,w,p,B,X){const W=A.length,a=w.length;let D,i;switch(d=d||Q.DEFAULTSIDE){case Q.FRONTSIDE:break;case Q.BACKSIDE:for(D=0;D<W;D+=3){const d=A[D];A[D]=A[D+2],A[D+2]=d}for(i=0;i<a;i++)w[i]=-w[i];break;case Q.DOUBLESIDE:{const d=t.length,k=d/3;for(let A=0;A<d;A++)t[d+A]=t[A];for(D=0;D<W;D+=3)A[D+W]=A[D+2]+k,A[D+1+W]=A[D+1]+k,A[D+2+W]=A[D]+k;for(i=0;i<a;i++)w[a+i]=-w[i];const b=p.length;let Q=0;for(Q=0;Q<b;Q++)p[Q+b]=p[Q];for(B=B||new N.m(0,0,1,1),X=X||new N.m(0,0,1,1),Q=0,D=0;D<b/2;D++)p[Q]=B.x+(B.z-B.x)*p[Q],p[Q+1]=B.y+(B.w-B.y)*p[Q+1],p[Q+b]=X.x+(X.z-X.x)*p[Q+b],p[Q+b+1]=X.y+(X.w-X.y)*p[Q+b+1],Q+=2;break}}}static Parse(d){const t=new Q,A=d.xa;A&&t.set(A,p.f.PositionKind);const w=d.ya;w&&t.set(w,p.f.NormalKind);const N=d.tangents;N&&t.set(N,p.f.TangentKind);const B=d.Aa;B&&t.set(B,p.f.UVKind);const W=d.uvs2;W&&t.set(W,p.f.UV2Kind);const a=d.uvs3;a&&t.set(a,p.f.UV3Kind);const D=d.uvs4;D&&t.set(D,p.f.UV4Kind);const i=d.uvs5;i&&t.set(i,p.f.UV5Kind);const k=d.uvs6;k&&t.set(k,p.f.UV6Kind);const P=d.za;P&&(t.set(X.i.CheckColors4(P,A.length/3),p.f.ColorKind),void 0!==d.hasVertexAlpha&&(t.hasVertexAlpha=d.hasVertexAlpha));const J=d.matricesIndices;J&&t.set(J,p.f.MatricesIndicesKind);const U=d.matricesWeights;U&&t.set(U,p.f.MatricesWeightsKind);const T=d.indices;T&&(t.indices=T);const F=d.materialInfos;if(F){t.materialInfos=[];for(const d of F){const A=new b;A.indexCount=d.indexCount,A.indexStart=d.indexStart,A.verticesCount=d.verticesCount,A.verticesStart=d.verticesStart,A.materialIndex=d.materialIndex,t.materialInfos.push(A)}}return t}static ImportVertexData(d,t){const A=Q.Parse(d);t.setAllVerticesData(A,d.updatable)}}Q.FRONTSIDE=0,Q.BACKSIDE=1,Q.DOUBLESIDE=2,Q.DEFAULTSIDE=0,Q._UniqueIDGenerator=0,(0,w.b)([a.g.filter((function(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];let[w]=t;return!Array.isArray(w)}))],Q,"_TransformVector3Coordinates",null),(0,w.b)([a.g.filter((function(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];let[w]=t;return!Array.isArray(w)}))],Q,"_TransformVector3Normals",null),(0,w.b)([a.g.filter((function(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];let[w]=t;return!Array.isArray(w)}))],Q,"_TransformVector4Normals",null),(0,w.b)([a.g.filter((function(){for(var d=arguments.length,t=new Array(d),A=0;A<d;A++)t[A]=arguments[A];let[w]=t;return!Array.isArray(w)}))],Q,"_FlipFaces",null)},12479:(d,t,A)=>{"use strict";A.d(t,{d:()=>Pd});var w=A(11076),N=A(11309),p=A(11120),B=A(11339),X=A(11271);function W(d){let t=d.pathArray;const A=d.closeArray||!1,w=d.closePath||!1,N=d.invertUV||!1,W=Math.floor(t[0].length/2);let a=d.offset||W;a=a>W?W:Math.floor(a);const D=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE,i=d.Aa,k=d.za,b=[],Q=[],P=[],J=[],U=[],T=[],F=[],q=[];let H;const f=[],v=[];let m,j,n;if(t.length<2){const d=[],A=[];for(j=0;j<t[0].length-a;j++)d.push(t[0][j]),A.push(t[0][j+a]);t=[d,A]}let R=0;const Z=w?1:0,L=A?1:0;let I,u,V,h,l,y;for(H=t[0].length,m=0;m<t.length+L;m++){for(F[m]=0,U[m]=[0],I=m===t.length?t[0]:t[m],u=I.length,H=H<u?H:u,n=0;n<u;)b.push(I[n].x,I[n].y,I[n].z),n>0&&(V=I[n].Uc(I[n-1]).length(),h=V+F[m],U[m].push(h),F[m]=h),n++;w&&(n--,b.push(I[0].x,I[0].y,I[0].z),V=I[n].Uc(I[0]).length(),h=V+F[m],U[m].push(h),F[m]=h),f[m]=u+Z,v[m]=R,R+=u+Z}let s,Y,r=null,K=null;for(j=0;j<H+Z;j++)for(q[j]=0,T[j]=[0],m=0;m<t.length-1+L;m++)l=t[m],y=m===t.length-1?t[0]:t[m+1],j===H?(r=l[0],K=y[0]):(r=l[j],K=y[j]),V=K.Uc(r).length(),h=V+q[j],T[j].push(h),q[j]=h;if(i)for(m=0;m<i.length;m++)J.push(i[m].x,X.e?1-i[m].y:i[m].y);else for(m=0;m<t.length+L;m++)for(j=0;j<H+Z;j++)s=0!=F[m]?U[m][j]/F[m]:0,Y=0!=q[j]?T[j][m]/q[j]:0,N?J.push(Y,s):J.push(s,X.e?1-Y:Y);m=0;let G=0,O=f[m]-1,z=f[m+1]-1,c=O<z?O:z,e=v[1]-v[0];const M=f.length-1;for(;G<=c&&m<M;)Q.push(G,G+e,G+1),Q.push(G+e+1,G+1,G+e),G+=1,G===c&&(m++,e=v[m+1]-v[m],O=f[m]-1,z=f[m+1]-1,G=v[m],c=O<z?O+G:z+G);if(B.e.ComputeNormals(b,Q,P),w){let d=0,A=0;for(m=0;m<t.length;m++){d=3*v[m],A=m+1<t.length?3*(v[m+1]-1):P.length-3,P[d]=.5*(P[d]+P[A]),P[d+1]=.5*(P[d+1]+P[A+1]),P[d+2]=.5*(P[d+2]+P[A+2]);const w=Math.sqrt(P[d]*P[d]+P[d+1]*P[d+1]+P[d+2]*P[d+2]);P[d]/=w,P[d+1]/=w,P[d+2]/=w,P[A]=P[d],P[A+1]=P[d+1],P[A+2]=P[d+2]}}if(A){let d=3*v[0],A=3*v[t.length];for(j=0;j<H+Z;j++){P[d]=.5*(P[d]+P[A]),P[d+1]=.5*(P[d+1]+P[A+1]),P[d+2]=.5*(P[d+2]+P[A+2]);const t=Math.sqrt(P[d]*P[d]+P[d+1]*P[d+1]+P[d+2]*P[d+2]);P[d]/=t,P[d+1]/=t,P[d+2]/=t,P[A]=P[d],P[A+1]=P[d+1],P[A+2]=P[d+2],d+=3,A+=3}}B.e._ComputeSides(D,b,Q,P,J,d.frontUVs,d.backUVs);let x=null;if(k){x=new Float32Array(4*k.length);for(let d=0;d<k.length;d++)x[4*d]=k[d].r,x[4*d+1]=k[d].g,x[4*d+2]=k[d].b,x[4*d+3]=k[d].a}const o=new B.e,C=new Float32Array(b),E=new Float32Array(P),g=new Float32Array(J);return o.indices=Q,o.xa=C,o.ya=E,o.Aa=g,x&&o.set(x,p.f.ColorKind),w&&(o._idx=v),o}function a(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const a=t.pathArray,D=t.closeArray,i=t.closePath,k=N.d._GetDefaultSideOrientation(t.sideOrientation),b=t.instance,Q=t.updatable;if(b){const d=w.h.gb[0].Dj(Number.MAX_VALUE),A=w.h.gb[1].Dj(-Number.MAX_VALUE),W=t=>{let w=a[0].length;const p=b;let B=0;const X=p._originalBuilderSideOrientation===N.d.DOUBLESIDE?2:1;for(let N=1;N<=X;++N)for(let X=0;X<a.length;++X){const N=a[X],W=N.length;w=w<W?w:W;for(let p=0;p<w;++p){const w=N[p];t[B]=w.x,t[B+1]=w.y,t[B+2]=w.z,d.minimizeInPlaceFromFloats(w.x,w.y,w.z),A.maximizeInPlaceFromFloats(w.x,w.y,w.z),B+=3}if(p._creationDataStorage&&p._creationDataStorage.closePath){const d=N[0];t[B]=d.x,t[B+1]=d.y,t[B+2]=d.z,B+=3}}},D=b.getVerticesData(p.f.PositionKind);if(W(D),b.hasBoundingInfo?b.getBoundingInfo().reConstruct(d,A,b._worldMatrix):b.buildBoundingInfo(d,A,b._worldMatrix),b.updateVerticesData(p.f.PositionKind,D,!1,!1),t.za){const d=b.getVerticesData(p.f.ColorKind);for(let A=0,w=0;A<t.za.length;A++,w+=4){const N=t.za[A];d[w]=N.r,d[w+1]=N.g,d[w+2]=N.b,d[w+3]=N.a}b.updateVerticesData(p.f.ColorKind,d,!1,!1)}if(t.Aa){const d=b.getVerticesData(p.f.UVKind);for(let A=0;A<t.Aa.length;A++)d[2*A]=t.Aa[A].x,d[2*A+1]=X.e?1-t.Aa[A].y:t.Aa[A].y;b.updateVerticesData(p.f.UVKind,d,!1,!1)}if(!b.areNormalsFrozen||b.isFacetDataEnabled){const d=b.xf(),t=b.getVerticesData(p.f.NormalKind),A=b.isFacetDataEnabled?b.getFacetDataParameters():null;if(B.e.ComputeNormals(D,d,t,A),b._creationDataStorage&&b._creationDataStorage.closePath){let d=0,A=0;for(let w=0;w<a.length;w++)d=3*b._creationDataStorage.idx[w],A=w+1<a.length?3*(b._creationDataStorage.idx[w+1]-1):t.length-3,t[d]=.5*(t[d]+t[A]),t[d+1]=.5*(t[d+1]+t[A+1]),t[d+2]=.5*(t[d+2]+t[A+2]),t[A]=t[d],t[A+1]=t[d+1],t[A+2]=t[d+2]}b.areNormalsFrozen||b.updateVerticesData(p.f.NormalKind,t,!1,!1)}return b}{const w=new N.d(d,A);w._originalBuilderSideOrientation=k,w._creationDataStorage=new N.f;const p=W(t);return i&&(w._creationDataStorage.idx=p._idx),w._creationDataStorage.closePath=i,w._creationDataStorage.closeArray=D,p.Ca(w,Q),w}}B.e.CreateRibbon=W,N.d.CreateRibbon=function(d,t){return a(d,{pathArray:t,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var D=A(11719),i=A(11372),k=A(11094);function b(d){const t=d.pattern||N.d.NO_FLIP,A=d.tileWidth||d.tileSize||1,w=d.tileHeight||d.tileSize||1,p=d.alignHorizontal||0,X=d.alignVertical||0,W=d.width||d.size||1,a=Math.floor(W/A);let D=W-a*A;const i=d.height||d.size||1,k=Math.floor(i/w);let b=i-k*w;const Q=A*a/2,P=w*k/2;let J=0,U=0,T=0,F=0,q=0,H=0;if(D>0||b>0){switch(T=-Q,F=-P,q=Q,H=P,p){case N.d.CENTER:D/=2,T-=D,q+=D;break;case N.d.LEFT:q+=D,J=-D/2;break;case N.d.RIGHT:T-=D,J=D/2}switch(X){case N.d.CENTER:b/=2,F-=b,H+=b;break;case N.d.BOTTOM:H+=b,U=-b/2;break;case N.d.TOP:F-=b,U=b/2}}const f=[],v=[],m=[];m[0]=[0,0,1,0,1,1,0,1],m[1]=[0,0,1,0,1,1,0,1],t!==N.d.ROTATE_TILE&&t!==N.d.ROTATE_ROW||(m[1]=[1,1,0,1,0,0,1,0]),t!==N.d.FLIP_TILE&&t!==N.d.FLIP_ROW||(m[1]=[1,0,0,0,0,1,1,1]),t!==N.d.FLIP_N_ROTATE_TILE&&t!==N.d.FLIP_N_ROTATE_ROW||(m[1]=[0,1,1,1,1,0,0,0]);let j=[];const n=[],R=[];let Z=0;for(let B=0;B<k;B++)for(let d=0;d<a;d++)f.push(d*A-Q+J,B*w-P+U,0),f.push((d+1)*A-Q+J,B*w-P+U,0),f.push((d+1)*A-Q+J,(B+1)*w-P+U,0),f.push(d*A-Q+J,(B+1)*w-P+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),j=t===N.d.FLIP_TILE||t===N.d.ROTATE_TILE||t===N.d.FLIP_N_ROTATE_TILE?j.concat(m[(d%2+B%2)%2]):t===N.d.FLIP_ROW||t===N.d.ROTATE_ROW||t===N.d.FLIP_N_ROTATE_ROW?j.concat(m[B%2]):j.concat(m[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),Z+=4;if(D>0||b>0){const d=b>0&&(X===N.d.CENTER||X===N.d.TOP),B=b>0&&(X===N.d.CENTER||X===N.d.BOTTOM),W=D>0&&(p===N.d.CENTER||p===N.d.RIGHT),i=D>0&&(p===N.d.CENTER||p===N.d.LEFT);let m,L,I,u,V=[];if(d&&W&&(f.push(T+J,F+U,0),f.push(-Q+J,F+U,0),f.push(-Q+J,F+b+U,0),f.push(T+J,F+b+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,m=1-D/A,L=1-b/w,I=1,u=1,V=[m,L,I,L,I,u,m,u],t===N.d.ROTATE_ROW&&(V=[1-m,1-L,1-I,1-L,1-I,1-u,1-m,1-u]),t===N.d.FLIP_ROW&&(V=[1-m,L,1-I,L,1-I,u,1-m,u]),t===N.d.FLIP_N_ROTATE_ROW&&(V=[m,1-L,I,1-L,I,1-u,m,1-u]),j=j.concat(V),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),d&&i&&(f.push(Q+J,F+U,0),f.push(q+J,F+U,0),f.push(q+J,F+b+U,0),f.push(Q+J,F+b+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,m=0,L=1-b/w,I=D/A,u=1,V=[m,L,I,L,I,u,m,u],(t===N.d.ROTATE_ROW||t===N.d.ROTATE_TILE&&a%2===0)&&(V=[1-m,1-L,1-I,1-L,1-I,1-u,1-m,1-u]),(t===N.d.FLIP_ROW||t===N.d.FLIP_TILE&&a%2===0)&&(V=[1-m,L,1-I,L,1-I,u,1-m,u]),(t===N.d.FLIP_N_ROTATE_ROW||t===N.d.FLIP_N_ROTATE_TILE&&a%2===0)&&(V=[m,1-L,I,1-L,I,1-u,m,1-u]),j=j.concat(V),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&W&&(f.push(T+J,P+U,0),f.push(-Q+J,P+U,0),f.push(-Q+J,H+U,0),f.push(T+J,H+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,m=1-D/A,L=0,I=1,u=b/w,V=[m,L,I,L,I,u,m,u],(t===N.d.ROTATE_ROW&&k%2===1||t===N.d.ROTATE_TILE&&k%1===0)&&(V=[1-m,1-L,1-I,1-L,1-I,1-u,1-m,1-u]),(t===N.d.FLIP_ROW&&k%2===1||t===N.d.FLIP_TILE&&k%2===0)&&(V=[1-m,L,1-I,L,1-I,u,1-m,u]),(t===N.d.FLIP_N_ROTATE_ROW&&k%2===1||t===N.d.FLIP_N_ROTATE_TILE&&k%2===0)&&(V=[m,1-L,I,1-L,I,1-u,m,1-u]),j=j.concat(V),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),B&&i&&(f.push(Q+J,P+U,0),f.push(q+J,P+U,0),f.push(q+J,H+U,0),f.push(Q+J,H+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,m=0,L=0,I=D/A,u=b/w,V=[m,L,I,L,I,u,m,u],(t===N.d.ROTATE_ROW&&k%2===1||t===N.d.ROTATE_TILE&&(k+a)%2===1)&&(V=[1-m,1-L,1-I,1-L,1-I,1-u,1-m,1-u]),(t===N.d.FLIP_ROW&&k%2===1||t===N.d.FLIP_TILE&&(k+a)%2===1)&&(V=[1-m,L,1-I,L,1-I,u,1-m,u]),(t===N.d.FLIP_N_ROTATE_ROW&&k%2===1||t===N.d.FLIP_N_ROTATE_TILE&&(k+a)%2===1)&&(V=[m,1-L,I,1-L,I,1-u,m,1-u]),j=j.concat(V),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),d){const d=[];m=0,L=1-b/w,I=1,u=1,d[0]=[m,L,I,L,I,u,m,u],d[1]=[m,L,I,L,I,u,m,u],t!==N.d.ROTATE_TILE&&t!==N.d.ROTATE_ROW||(d[1]=[1-m,1-L,1-I,1-L,1-I,1-u,1-m,1-u]),t!==N.d.FLIP_TILE&&t!==N.d.FLIP_ROW||(d[1]=[1-m,L,1-I,L,1-I,u,1-m,u]),t!==N.d.FLIP_N_ROTATE_TILE&&t!==N.d.FLIP_N_ROTATE_ROW||(d[1]=[m,1-L,I,1-L,I,1-u,m,1-u]);for(let w=0;w<a;w++)f.push(w*A-Q+J,F+U,0),f.push((w+1)*A-Q+J,F+U,0),f.push((w+1)*A-Q+J,F+b+U,0),f.push(w*A-Q+J,F+b+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,j=t===N.d.FLIP_TILE||t===N.d.ROTATE_TILE||t===N.d.FLIP_N_ROTATE_TILE?j.concat(d[(w+1)%2]):t===N.d.FLIP_ROW||t===N.d.ROTATE_ROW||t===N.d.FLIP_N_ROTATE_ROW?j.concat(d[1]):j.concat(d[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(B){const d=[];m=0,L=0,I=1,u=b/w,d[0]=[m,L,I,L,I,u,m,u],d[1]=[m,L,I,L,I,u,m,u],t!==N.d.ROTATE_TILE&&t!==N.d.ROTATE_ROW||(d[1]=[1-m,1-L,1-I,1-L,1-I,1-u,1-m,1-u]),t!==N.d.FLIP_TILE&&t!==N.d.FLIP_ROW||(d[1]=[1-m,L,1-I,L,1-I,u,1-m,u]),t!==N.d.FLIP_N_ROTATE_TILE&&t!==N.d.FLIP_N_ROTATE_ROW||(d[1]=[m,1-L,I,1-L,I,1-u,m,1-u]);for(let w=0;w<a;w++)f.push(w*A-Q+J,H-b+U,0),f.push((w+1)*A-Q+J,H-b+U,0),f.push((w+1)*A-Q+J,H+U,0),f.push(w*A-Q+J,H+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,j=t===N.d.FLIP_TILE||t===N.d.ROTATE_TILE||t===N.d.FLIP_N_ROTATE_TILE?j.concat(d[(w+k)%2]):t===N.d.FLIP_ROW||t===N.d.ROTATE_ROW||t===N.d.FLIP_N_ROTATE_ROW?j.concat(d[k%2]):j.concat(d[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(W){const d=[];m=1-D/A,L=0,I=1,u=1,d[0]=[m,L,I,L,I,u,m,u],d[1]=[m,L,I,L,I,u,m,u],t!==N.d.ROTATE_TILE&&t!==N.d.ROTATE_ROW||(d[1]=[1-m,1-L,1-I,1-L,1-I,1-u,1-m,1-u]),t!==N.d.FLIP_TILE&&t!==N.d.FLIP_ROW||(d[1]=[1-m,L,1-I,L,1-I,u,1-m,u]),t!==N.d.FLIP_N_ROTATE_TILE&&t!==N.d.FLIP_N_ROTATE_ROW||(d[1]=[m,1-L,I,1-L,I,1-u,m,1-u]);for(let A=0;A<k;A++)f.push(T+J,A*w-P+U,0),f.push(T+D+J,A*w-P+U,0),f.push(T+D+J,(A+1)*w-P+U,0),f.push(T+J,(A+1)*w-P+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,j=t===N.d.FLIP_TILE||t===N.d.ROTATE_TILE||t===N.d.FLIP_N_ROTATE_TILE?j.concat(d[(A+1)%2]):t===N.d.FLIP_ROW||t===N.d.ROTATE_ROW||t===N.d.FLIP_N_ROTATE_ROW?j.concat(d[A%2]):j.concat(d[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(i){const d=[];m=0,L=0,I=D/w,u=1,d[0]=[m,L,I,L,I,u,m,u],d[1]=[m,L,I,L,I,u,m,u],t!==N.d.ROTATE_TILE&&t!==N.d.ROTATE_ROW||(d[1]=[1-m,1-L,1-I,1-L,1-I,1-u,1-m,1-u]),t!==N.d.FLIP_TILE&&t!==N.d.FLIP_ROW||(d[1]=[1-m,L,1-I,L,1-I,u,1-m,u]),t!==N.d.FLIP_N_ROTATE_TILE&&t!==N.d.FLIP_N_ROTATE_ROW||(d[1]=[m,1-L,I,1-L,I,1-u,m,1-u]);for(let A=0;A<k;A++)f.push(q-D+J,A*w-P+U,0),f.push(q+J,A*w-P+U,0),f.push(q+J,(A+1)*w-P+U,0),f.push(q-D+J,(A+1)*w-P+U,0),R.push(Z,Z+1,Z+3,Z+1,Z+2,Z+3),Z+=4,j=t===N.d.FLIP_TILE||t===N.d.ROTATE_TILE||t===N.d.FLIP_N_ROTATE_TILE?j.concat(d[(A+a)%2]):t===N.d.FLIP_ROW||t===N.d.ROTATE_ROW||t===N.d.FLIP_N_ROTATE_ROW?j.concat(d[A%2]):j.concat(d[0]),n.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),v.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const L=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE;B.e._ComputeSides(L,f,R,v,j,d.frontUVs,d.backUVs);const I=new B.e;I.indices=R,I.xa=f,I.ya=v,I.Aa=j;const u=L===B.e.DOUBLESIDE?n.concat(n):n;return I.za=u,I}function Q(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new N.d(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return b(t).Ca(w,t.updatable),w}function P(d){const t=d.faceUV||new Array(6),A=d.faceColors,p=d.pattern||N.d.NO_FLIP,W=d.width||d.size||1,a=d.height||d.size||1,D=d.depth||d.size||1,i=d.tileWidth||d.tileSize||1,Q=d.tileHeight||d.tileSize||1,P=d.alignHorizontal||0,J=d.alignVertical||0,U=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE;for(let N=0;N<6;N++)void 0===t[N]&&(t[N]=new w.m(0,0,1,1)),A&&void 0===A[N]&&(A[N]=new k.i(1,1,1,1));const T=W/2,F=a/2,q=D/2,H=[];for(let w=0;w<2;w++)H[w]=b({pattern:p,tileWidth:i,tileHeight:Q,width:W,height:a,alignVertical:J,alignHorizontal:P,sideOrientation:U});for(let w=2;w<4;w++)H[w]=b({pattern:p,tileWidth:i,tileHeight:Q,width:D,height:a,alignVertical:J,alignHorizontal:P,sideOrientation:U});let f=J;J===N.d.BOTTOM?f=N.d.TOP:J===N.d.TOP&&(f=N.d.BOTTOM);for(let w=4;w<6;w++)H[w]=b({pattern:p,tileWidth:i,tileHeight:Q,width:W,height:D,alignVertical:f,alignHorizontal:P,sideOrientation:U});let v=[],m=[],j=[],n=[];const R=[],Z=[],L=[],I=[];let u=0,V=0;for(let N=0;N<6;N++){const d=H[N].xa.length;Z[N]=[],L[N]=[];for(let t=0;t<d/3;t++)Z[N].push(new w.l(H[N].xa[3*t],H[N].xa[3*t+1],H[N].xa[3*t+2])),L[N].push(new w.l(H[N].ya[3*t],H[N].ya[3*t+1],H[N].ya[3*t+2]));u=H[N].Aa.length,I[N]=[];for(let A=0;A<u;A+=2)I[N][A]=t[N].x+(t[N].z-t[N].x)*H[N].Aa[A],I[N][A+1]=t[N].y+(t[N].w-t[N].y)*H[N].Aa[A+1],X.e&&(I[N][A+1]=1-I[N][A+1]);if(j=j.concat(I[N]),n=n.concat(H[N].indices.map((d=>d+V))),V+=Z[N].length,A)for(let t=0;t<4;t++)R.push(A[N].r,A[N].g,A[N].b,A[N].a)}const h=new w.l(0,0,q),l=w.c.RotationY(Math.PI);v=Z[0].map((d=>w.l.TransformNormal(d,l).add(h))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[]),m=L[0].map((d=>w.l.TransformNormal(d,l))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[]),v=v.concat(Z[1].map((d=>d.Uc(h))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[])),m=m.concat(L[1].map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[]));const y=new w.l(T,0,0),s=w.c.RotationY(-Math.PI/2);v=v.concat(Z[2].map((d=>w.l.TransformNormal(d,s).add(y))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[])),m=m.concat(L[2].map((d=>w.l.TransformNormal(d,s))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[]));const Y=w.c.RotationY(Math.PI/2);v=v.concat(Z[3].map((d=>w.l.TransformNormal(d,Y).Uc(y))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[])),m=m.concat(L[3].map((d=>w.l.TransformNormal(d,Y))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[]));const r=new w.l(0,F,0),K=w.c.RotationX(Math.PI/2);v=v.concat(Z[4].map((d=>w.l.TransformNormal(d,K).add(r))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[])),m=m.concat(L[4].map((d=>w.l.TransformNormal(d,K))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[]));const G=w.c.RotationX(-Math.PI/2);v=v.concat(Z[5].map((d=>w.l.TransformNormal(d,G).Uc(r))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[])),m=m.concat(L[5].map((d=>w.l.TransformNormal(d,G))).map((d=>[d.x,d.y,d.z])).reduce(((d,t)=>d.concat(t)),[])),B.e._ComputeSides(U,v,n,m,j);const O=new B.e;if(O.indices=n,O.xa=v,O.ya=m,O.Aa=j,A){const d=U===B.e.DOUBLESIDE?R.concat(R):R;O.za=d}return O}function J(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new N.d(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return P(t).Ca(w,t.updatable),w}B.e.CreateTiledPlane=b;B.e.CreateTiledBox=P;var U=A(11710),T=A(11061),F=A(11359);function q(d){const t=d.height||2;let A=0===d.diameterTop?0:d.diameterTop||d.diameter||1,p=0===d.diameterBottom?0:d.diameterBottom||d.diameter||1;A=A||1e-5,p=p||1e-5;const W=0|(d.Uk||24),a=0|(d.subdivisions||1),D=!!d.hasRings,i=!!d.enclose,b=0===d.cap?0:d.cap||N.d.CAP_ALL,Q=d.arc&&(d.arc<=0||d.arc>1)?1:d.arc||1,P=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE,J=d.faceUV||new Array(3),U=d.faceColors,T=2+(1+(1!==Q&&i?2:0))*(D?a:1);let q;for(q=0;q<T;q++)U&&void 0===U[q]&&(U[q]=new k.i(1,1,1,1));for(q=0;q<T;q++)J&&void 0===J[q]&&(J[q]=new w.m(0,0,1,1));const H=[],f=[],v=[],m=[],j=[],n=2*Math.PI*Q/W;let R,Z,L;const I=(p-A)/2/t,u=w.l.Zero(),V=w.l.Zero(),h=w.l.Zero(),l=w.l.Zero(),y=w.l.Zero(),s=F.e.Y;let Y,r,K,G=1,O=1,z=0,c=0;for(Y=0;Y<=a;Y++)for(Z=Y/a,L=(Z*(A-p)+p)/2,G=D&&0!==Y&&Y!==a?2:1,K=0;K<G;K++){for(D&&(O+=K),i&&(O+=2*K),r=0;r<=W;r++)R=r*n,u.x=Math.cos(-R)*L,u.y=-t/2+Z*t,u.z=Math.sin(-R)*L,0===A&&Y===a?(V.x=v[v.length-3*(W+1)],V.y=v[v.length-3*(W+1)+1],V.z=v[v.length-3*(W+1)+2]):(V.x=u.x,V.z=u.z,V.y=Math.sqrt(V.x*V.x+V.z*V.z)*I,V.normalize()),0===r&&(h.p(u),l.p(V)),f.push(u.x,u.y,u.z),v.push(V.x,V.y,V.z),c=D?z!==O?J[O].y:J[O].w:J[O].y+(J[O].w-J[O].y)*Z,m.push(J[O].x+(J[O].z-J[O].x)*r/W,X.e?1-c:c),U&&j.push(U[O].r,U[O].g,U[O].b,U[O].a);1!==Q&&i&&(f.push(u.x,u.y,u.z),f.push(0,u.y,0),f.push(0,u.y,0),f.push(h.x,h.y,h.z),w.l.CrossToRef(s,V,y),y.normalize(),v.push(y.x,y.y,y.z,y.x,y.y,y.z),w.l.CrossToRef(l,s,y),y.normalize(),v.push(y.x,y.y,y.z,y.x,y.y,y.z),c=D?z!==O?J[O+1].y:J[O+1].w:J[O+1].y+(J[O+1].w-J[O+1].y)*Z,m.push(J[O+1].x,X.e?1-c:c),m.push(J[O+1].z,X.e?1-c:c),c=D?z!==O?J[O+2].y:J[O+2].w:J[O+2].y+(J[O+2].w-J[O+2].y)*Z,m.push(J[O+2].x,X.e?1-c:c),m.push(J[O+2].z,X.e?1-c:c),U&&(j.push(U[O+1].r,U[O+1].g,U[O+1].b,U[O+1].a),j.push(U[O+1].r,U[O+1].g,U[O+1].b,U[O+1].a),j.push(U[O+2].r,U[O+2].g,U[O+2].b,U[O+2].a),j.push(U[O+2].r,U[O+2].g,U[O+2].b,U[O+2].a))),z!==O&&(z=O)}const e=1!==Q&&i?W+4:W;for(Y=0,O=0;O<a;O++){let d=0,t=0,A=0,w=0;for(r=0;r<W;r++)d=Y*(e+1)+r,t=(Y+1)*(e+1)+r,A=Y*(e+1)+(r+1),w=(Y+1)*(e+1)+(r+1),H.push(d,t,A),H.push(w,A,t);1!==Q&&i&&(H.push(d+2,t+2,A+2),H.push(w+2,A+2,t+2),H.push(d+4,t+4,A+4),H.push(w+4,A+4,t+4)),Y=D?Y+2:Y+1}const M=d=>{const N=d?A/2:p/2;if(0===N)return;let B,a,D;const i=d?J[T-1]:J[0];let k=null;U&&(k=d?U[T-1]:U[0]);const b=f.length/3,P=d?t/2:-t/2,F=new w.l(0,P,0);f.push(F.x,F.y,F.z),v.push(0,d?1:-1,0);const q=i.y+.5*(i.w-i.y);m.push(i.x+.5*(i.z-i.x),X.e?1-q:q),k&&j.push(k.r,k.g,k.b,k.a);const n=new w.j(.5,.5);for(D=0;D<=W;D++){B=2*Math.PI*D*Q/W;const t=Math.cos(-B),A=Math.sin(-B);a=new w.l(t*N,P,A*N);const p=new w.j(t*n.x+.5,A*n.y+.5);f.push(a.x,a.y,a.z),v.push(0,d?1:-1,0);const b=i.y+(i.w-i.y)*p.y;m.push(i.x+(i.z-i.x)*p.x,X.e?1-b:b),k&&j.push(k.r,k.g,k.b,k.a)}for(D=0;D<W;D++)d?(H.push(b),H.push(b+(D+2)),H.push(b+(D+1))):(H.push(b),H.push(b+(D+1)),H.push(b+(D+2)))};b!==N.d.CAP_START&&b!==N.d.CAP_ALL||M(!1),b!==N.d.CAP_END&&b!==N.d.CAP_ALL||M(!0),B.e._ComputeSides(P,f,H,v,m,d.frontUVs,d.backUVs);const x=new B.e;return x.indices=H,x.xa=f,x.ya=v,x.Aa=m,U&&(x.za=j),x}function H(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const w=new N.d(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return q(t).Ca(w,t.updatable),w}function f(d){const t=[],A=[],N=[],p=[],W=d.diameter||1,a=d.thickness||.5,D=0|(d.Uk||16),i=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE,k=D+1;for(let B=0;B<=D;B++){const d=B/D,i=B*Math.PI*2/D-Math.PI/2,b=w.c.Translation(W/2,0,0).multiply(w.c.RotationY(i));for(let W=0;W<=D;W++){const i=1-W/D,Q=W*Math.PI*2/D+Math.PI,P=Math.cos(Q),J=Math.sin(Q);let U=new w.l(P,J,0),T=U.scale(a/2);const F=new w.j(d,i);T=w.l.TransformCoordinates(T,b),U=w.l.TransformNormal(U,b),A.push(T.x,T.y,T.z),N.push(U.x,U.y,U.z),p.push(F.x,X.e?1-F.y:F.y);const q=(B+1)%k,H=(W+1)%k;t.push(B*k+W),t.push(B*k+H),t.push(q*k+W),t.push(B*k+H),t.push(q*k+H),t.push(q*k+W)}}B.e._ComputeSides(i,A,t,N,p,d.frontUVs,d.backUVs);const b=new B.e;return b.indices=t,b.xa=A,b.ya=N,b.Aa=p,b}function v(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const w=new N.d(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return f(t).Ca(w,t.updatable),w}B.e.CreateCylinder=q,N.d.CreateCylinder=(d,t,A,w,p,B,X,W,a)=>{void 0!==X&&X instanceof T.e||(void 0!==X&&(a=W||N.d.DEFAULTSIDE,W=X),X=B,B=1);return H(d,{height:t,diameterTop:A,diameterBottom:w,Uk:p,subdivisions:B,sideOrientation:a,updatable:W},X)};function m(d){const t=[],A=[],N=[],p=[],W=d.i||2,a=d.tube||.5,D=d.radialSegments||32,i=d.tubularSegments||32,k=d.p||2,b=d.q||3,Q=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE,P=d=>{const t=Math.cos(d),A=Math.sin(d),N=b/k*d,p=Math.cos(N),B=W*(2+p)*.5*t,X=W*(2+p)*A*.5,a=W*Math.sin(N)*.5;return new w.l(B,X,a)};let J,U;for(J=0;J<=D;J++){const d=J%D/D*2*k*Math.PI,t=P(d),N=P(d+.01),B=N.Uc(t);let W=N.add(t);const b=w.l.Cross(B,W);for(W=w.l.Cross(b,B),b.normalize(),W.normalize(),U=0;U<i;U++){const d=U%i/i*2*Math.PI,w=-a*Math.cos(d),N=a*Math.sin(d);A.push(t.x+w*W.x+N*b.x),A.push(t.y+w*W.y+N*b.y),A.push(t.z+w*W.z+N*b.z),p.push(J/D),p.push(X.e?1-U/i:U/i)}}for(J=0;J<D;J++)for(U=0;U<i;U++){const d=(U+1)%i,A=J*i+U,w=(J+1)*i+U,N=(J+1)*i+d,p=J*i+d;t.push(p),t.push(w),t.push(A),t.push(p),t.push(N),t.push(w)}B.e.ComputeNormals(A,t,N),B.e._ComputeSides(Q,A,t,N,p,d.frontUVs,d.backUVs);const T=new B.e;return T.indices=t,T.xa=A,T.ya=N,T.Aa=p,T}function j(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2?arguments[2]:void 0;const w=new N.d(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return m(t).Ca(w,t.updatable),w}B.e.CreateTorus=f,N.d.CreateTorus=(d,t,A,w,N,p,B)=>v(d,{diameter:t,thickness:A,Uk:w,sideOrientation:B,updatable:p},N);B.e.CreateTorusKnot=m,N.d.CreateTorusKnot=(d,t,A,w,N,p,B,X,W,a)=>j(d,{i:t,tube:A,radialSegments:w,tubularSegments:N,p:p,q:B,sideOrientation:a,updatable:W},X);var n=A(12487),R=A(10740),Z=A(11554),L=A(11079),I=A(10775);class u extends w.j{constructor(d,t){super(d.x,d.y),this.index=t}}class V{constructor(){this.elements=[]}add(d){const t=[];return d.forEach((d=>{const A=new u(d,this.elements.length);t.push(A),this.elements.push(A)})),t}computeBounds(){const d=new w.j(this.elements[0].x,this.elements[0].y),t=new w.j(this.elements[0].x,this.elements[0].y);return this.elements.forEach((A=>{A.x<d.x?d.x=A.x:A.x>t.x&&(t.x=A.x),A.y<d.y?d.y=A.y:A.y>t.y&&(t.y=A.y)})),{min:d,max:t,width:t.x-d.x,height:t.y-d.y}}}class h{_addToepoint(d){for(const t of d)this._epoints.push(t.x,t.y)}constructor(d,t,A){let w,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new V,this._outlinepoints=new V,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=N,this._name=d,this._scene=A||I.e.LastCreatedScene,w=t instanceof Z.d?t.getPoints():t,this._addToepoint(w),this._points.add(w),this._outlinepoints.add(w),"undefined"===typeof this.bjsEarcut&&R.e.Warn("Earcut was not found, the polygon will not be built.")}addHole(d){this._points.add(d);const t=new V;return t.add(d),this._holes.push(t),this._eholes.push(this._epoints.length/2),this._addToepoint(d),this}build(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const w=new N.d(this._name,this._scene),B=this.buildVertexData(t,A);return w.Ga(p.f.PositionKind,B.xa,d),w.Ga(p.f.NormalKind,B.ya,d),w.Ga(p.f.UVKind,B.Aa,d),w.setIndices(B.indices),w}buildVertexData(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const A=new B.e,w=[],N=[],p=[],X=this._points.computeBounds();this._points.elements.forEach((d=>{w.push(0,1,0),N.push(d.x,0,d.y),p.push((d.x-X.min.x)/X.width,(d.y-X.min.y)/X.height)}));const W=[],a=this.bjsEarcut(this._epoints,this._eholes,2);for(let B=0;B<a.length;B++)W.push(a[B]);if(d>0){const A=N.length/3;this._points.elements.forEach((t=>{w.push(0,-1,0),N.push(t.x,-d,t.y),p.push(1-(t.x-X.min.x)/X.width,1-(t.y-X.min.y)/X.height)}));const B=W.length;for(let d=0;d<B;d+=3){const t=W[d+0],w=W[d+1],N=W[d+2];W.push(N+A),W.push(w+A),W.push(t+A)}this._addSide(N,w,p,W,X,this._outlinepoints,d,!1,t),this._holes.forEach((A=>{this._addSide(N,w,p,W,X,A,d,!0,t)}))}return A.indices=W,A.xa=N,A.ya=w,A.Aa=p,A}_addSide(d,t,A,N,p,B,X,W,a){let D=d.length/3,i=0;for(let k=0;k<B.elements.length;k++){const b=B.elements[k],Q=B.elements[(k+1)%B.elements.length];d.push(b.x,0,b.y),d.push(b.x,-X,b.y),d.push(Q.x,0,Q.y),d.push(Q.x,-X,Q.y);const P=B.elements[(k+B.elements.length-1)%B.elements.length],J=B.elements[(k+2)%B.elements.length];let U=new w.l(-(Q.y-b.y),0,Q.x-b.x),T=new w.l(-(b.y-P.y),0,b.x-P.x),F=new w.l(-(J.y-Q.y),0,J.x-Q.x);W||(U=U.scale(-1),T=T.scale(-1),F=F.scale(-1));const q=U.normalizeToNew();let H=T.normalizeToNew(),f=F.normalizeToNew();const v=w.l.Dot(H,q);H=v>a?v<L.b-1?new w.l(b.x,0,b.y).Uc(new w.l(Q.x,0,Q.y)).normalize():T.add(U).normalize():q;const m=w.l.Dot(F,U);f=m>a?m<L.b-1?new w.l(Q.x,0,Q.y).Uc(new w.l(b.x,0,b.y)).normalize():F.add(U).normalize():q,A.push(i/p.width,0),A.push(i/p.width,1),i+=U.length(),A.push(i/p.width,0),A.push(i/p.width,1),t.push(H.x,H.y,H.z),t.push(H.x,H.y,H.z),t.push(f.x,f.y,f.z),t.push(f.x,f.y,f.z),W?(N.push(D),N.push(D+2),N.push(D+1),N.push(D+1),N.push(D+2),N.push(D+3)):(N.push(D),N.push(D+1),N.push(D+2),N.push(D+1),N.push(D+3),N.push(D+2)),D+=4}}}function l(d,t,A,N,W,a,D){const i=A||new Array(3),b=N,Q=[],P=D||!1;for(let p=0;p<3;p++)void 0===i[p]&&(i[p]=new w.m(0,0,1,1)),b&&void 0===b[p]&&(b[p]=new k.i(1,1,1,1));const J=d.getVerticesData(p.f.PositionKind),U=d.getVerticesData(p.f.NormalKind),T=d.getVerticesData(p.f.UVKind),F=d.xf(),q=J.length/9;let H=0,f=0,v=0,m=0,j=0;const n=[0];if(P)for(let w=q;w<J.length/3;w+=4)f=J[3*(w+2)]-J[3*w],v=J[3*(w+2)+2]-J[3*w+2],m=Math.sqrt(f*f+v*v),j+=m,n.push(j);let R=0,Z=0;for(let w=0;w<U.length;w+=3)Math.abs(U[w+1])<.001&&(Z=1),Math.abs(U[w+1]-1)<.001&&(Z=0),Math.abs(U[w+1]+1)<.001&&(Z=2),R=w/3,1===Z?(H=R-q,T[2*R]=H%4<1.5?P?i[Z].x+(i[Z].z-i[Z].x)*n[Math.floor(H/4)]/j:i[Z].x:P?i[Z].x+(i[Z].z-i[Z].x)*n[Math.floor(H/4)+1]/j:i[Z].z,T[2*R+1]=H%2===0?X.e?1-i[Z].w:i[Z].w:X.e?1-i[Z].y:i[Z].y):(T[2*R]=(1-T[2*R])*i[Z].x+T[2*R]*i[Z].z,T[2*R+1]=(1-T[2*R+1])*i[Z].y+T[2*R+1]*i[Z].w,X.e&&(T[2*R+1]=1-T[2*R+1])),b&&Q.push(b[Z].r,b[Z].g,b[Z].b,b[Z].a);B.e._ComputeSides(t,J,F,U,T,W,a);const L=new B.e;if(L.indices=F,L.xa=J,L.ya=U,L.Aa=T,b){const d=t===B.e.DOUBLESIDE?Q.concat(Q):Q;L.za=d}return L}function y(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation);const B=t.shape,X=t.holes||[],W=t.depth||0,a=t.smoothingThreshold||2,D=[];let i=[];for(let N=0;N<B.length;N++)D[N]=new w.j(B[N].x,B[N].z);D[0].equalsWithEpsilon(D[D.length-1],1e-8)&&D.pop();const k=new h(d,D,A||I.e.LastCreatedScene,p);for(let N=0;N<X.length;N++){i=[];for(let d=0;d<X[N].length;d++)i.push(new w.j(X[N][d].x,X[N][d].z));k.addHole(i)}const b=k.build(!1,W,a);b._originalBuilderSideOrientation=t.sideOrientation;return l(b,t.sideOrientation,t.faceUV,t.faceColors,t.frontUVs,t.backUVs,t.wrap).Ca(b,t.updatable),b}function s(d,t){return y(d,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function Y(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=t.path,p=t.shape,B=t.scale||1,X=t.rotation||0,W=0===t.cap?0:t.cap||N.d.NO_CAP,a=t.updatable,D=N.d._GetDefaultSideOrientation(t.sideOrientation),i=t.instance||null,k=t.invertUV||!1,b=t.closeShape||!1;return K(d,p,w,B,X,null,null,t.closePath||!1,b,W,!1,A,!!a,D,i,k,t.frontUVs||null,t.backUVs||null,t.firstNormal||null,!!t.adjustFrame)}function r(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=t.path,p=t.shape,B=t.scaleFunction||(()=>1),X=t.rotationFunction||(()=>0),W=t.closePath||t.ribbonCloseArray||!1,a=t.closeShape||t.ribbonClosePath||!1,D=0===t.cap?0:t.cap||N.d.NO_CAP,i=t.updatable,k=t.firstNormal||null,b=t.adjustFrame||!1;return K(d,p,w,null,null,B,X,W,a,D,!0,A,!!i,N.d._GetDefaultSideOrientation(t.sideOrientation),t.instance||null,t.invertUV||!1,t.frontUVs||null,t.backUVs||null,k,b)}function K(d,t,A,p,B,X,W,D,i,k,b,Q,P,J,U,T,F,q,H,f){const v=(d,t,A,p,B,X,W,a,D,i,k)=>{const b=A.getTangents(),Q=A.getNormals(),P=A.getBinormals(),J=A.getDistances();if(k)for(let N=0;N<b.length;N++)if(0==b[N].x&&0==b[N].y&&0==b[N].z&&b[N].p(b[N-1]),0==Q[N].x&&0==Q[N].y&&0==Q[N].z&&Q[N].p(Q[N-1]),0==P[N].x&&0==P[N].y&&0==P[N].z&&P[N].p(P[N-1]),N>0){let d=b[N-1];w.l.Dot(d,b[N])<0&&b[N].scaleInPlace(-1),d=Q[N-1],w.l.Dot(d,Q[N])<0&&Q[N].scaleInPlace(-1),d=P[N-1],w.l.Dot(d,P[N])<0&&P[N].scaleInPlace(-1)}let U=0;const T=i&&a?a:()=>null!==X?X:0,F=i&&W?W:()=>null!==B?B:1;let q=D===N.d.NO_CAP||D===N.d.CAP_END?0:2;const H=w.h.Matrix[0];for(let N=0;N<t.length;N++){const A=[],B=T(N,J[N]),X=F(N,J[N]);w.c.RotationAxisToRef(b[N],U,H);for(let p=0;p<d.length;p++){const B=b[N].scale(d[p].z).add(Q[N].scale(d[p].x)).add(P[N].scale(d[p].y)),W=w.l.Zero();w.l.TransformCoordinatesToRef(B,H,W),W.scaleInPlace(X).addInPlace(t[N]),A[p]=W}p[q]=A,U+=B,q++}const f=d=>{const t=Array(),A=w.l.Zero();let N;for(N=0;N<d.length;N++)A.addInPlace(d[N]);for(A.scaleInPlace(1/d.length),N=0;N<d.length;N++)t.push(A);return t};switch(D){case N.d.NO_CAP:break;case N.d.CAP_START:p[0]=f(p[2]),p[1]=p[2];break;case N.d.CAP_END:p[q]=p[q-1],p[q+1]=f(p[q-1]);break;case N.d.CAP_ALL:p[0]=f(p[2]),p[1]=p[2],p[q]=p[q-1],p[q+1]=f(p[q-1])}return p};let m,j;if(U){const d=U._creationDataStorage;return m=H?d.path3D.update(A,H):d.path3D.update(A),j=v(t,A,d.path3D,d.pathArray,p,B,X,W,d.cap,b,f),U=a("",{pathArray:j,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:U},Q||void 0)}m=H?new Z.e(A,H):new Z.e(A);j=v(t,A,m,new Array,p,B,X,W,k=k<0||k>3?0:k,b,f);const n=a(d,{pathArray:j,closeArray:D,closePath:i,updatable:P,sideOrientation:J,invertUV:T,frontUVs:F||void 0,backUVs:q||void 0},Q);return n._creationDataStorage.pathArray=j,n._creationDataStorage.path3D=m,n._creationDataStorage.cap=k,n}B.e.CreatePolygon=l,N.d.CreatePolygon=function(d,t,A,w,N,p){return y(d,{shape:t,holes:w,updatable:N,sideOrientation:p},A,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},N.d.ExtrudePolygon=function(d,t,A,w,N,p,B){return s(d,{shape:t,holes:N,depth:A,updatable:p,sideOrientation:B},w,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function G(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=t.arc?t.arc<=0||t.arc>1?1:t.arc:1,B=void 0===t.closed||t.closed,X=t.shape,W=t.i||1,D=t.Uk||64,i=t.clip||0,k=t.updatable,b=N.d._GetDefaultSideOrientation(t.sideOrientation),Q=t.cap||N.d.NO_CAP,P=2*Math.PI,J=[],U=t.invertUV||!1;let T=0,F=0;const q=P/D*p;let H,f;for(T=0;T<=D-i;T++){for(f=[],Q!=N.d.CAP_START&&Q!=N.d.CAP_ALL||(f.push(new w.l(0,X[0].y,0)),f.push(new w.l(Math.cos(T*q)*X[0].x*W,X[0].y,Math.sin(T*q)*X[0].x*W))),F=0;F<X.length;F++)H=new w.l(Math.cos(T*q)*X[F].x*W,X[F].y,Math.sin(T*q)*X[F].x*W),f.push(H);Q!=N.d.CAP_END&&Q!=N.d.CAP_ALL||(f.push(new w.l(Math.cos(T*q)*X[X.length-1].x*W,X[X.length-1].y,Math.sin(T*q)*X[X.length-1].x*W)),f.push(new w.l(0,X[X.length-1].y,0))),J.push(f)}return a(d,{pathArray:J,closeArray:B,sideOrientation:b,updatable:k,invertUV:U,frontUVs:t.frontUVs,backUVs:t.backUVs},A)}N.d.ExtrudeShape=function(d,t,A,w,p,B){let X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7?arguments[7]:void 0,a=arguments.length>8?arguments[8]:void 0,D=arguments.length>9?arguments[9]:void 0;return Y(d,{shape:t,path:A,scale:w,rotation:p,cap:0===B?0:B||N.d.NO_CAP,sideOrientation:a,instance:D,updatable:W},X)},N.d.ExtrudeShapeCustom=(d,t,A,w,p,B,X,W,a,D,i,k)=>r(d,{shape:t,path:A,scaleFunction:w,rotationFunction:p,ribbonCloseArray:B,ribbonClosePath:X,cap:0===W?0:W||N.d.NO_CAP,sideOrientation:i,instance:k,updatable:D},a);N.d.CreateLathe=(d,t,A,w,N,p,B)=>G(d,{shape:t,i:A,Uk:w,sideOrientation:B,updatable:p},N);var O=A(11424),z=A(11377);function c(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=t.path;let B=t.instance,X=1;void 0!==t.i?X=t.i:B&&(X=B._creationDataStorage.i);const W=t.Uk||64,D=t.radiusFunction||null;let i=t.cap||N.d.NO_CAP;const k=t.invertUV||!1,b=t.updatable,Q=N.d._GetDefaultSideOrientation(t.sideOrientation);t.arc=t.arc&&(t.arc<=0||t.arc>1)?1:t.arc||1;const P=(d,t,A,p,B,X,W,a)=>{const D=t.getTangents(),i=t.getNormals(),k=t.getDistances(),b=2*Math.PI/B*a,Q=X||(()=>p);let P,J,U,T;const F=w.h.Matrix[0];let q=W===N.d.NO_CAP||W===N.d.CAP_END?0:2;for(let N=0;N<d.length;N++){J=Q(N,k[N]),P=Array(),U=i[N];for(let t=0;t<B;t++)w.c.RotationAxisToRef(D[N],b*t,F),T=P[t]?P[t]:w.l.Zero(),w.l.TransformCoordinatesToRef(U,F,T),T.scaleInPlace(J).addInPlace(d[N]),P[t]=T;A[q]=P,q++}const H=(t,A)=>{const w=Array();for(let N=0;N<t;N++)w.push(d[A]);return w};switch(W){case N.d.NO_CAP:break;case N.d.CAP_START:A[0]=H(B,0),A[1]=A[2].slice(0);break;case N.d.CAP_END:A[q]=A[q-1].slice(0),A[q+1]=H(B,d.length-1);break;case N.d.CAP_ALL:A[0]=H(B,0),A[1]=A[2].slice(0),A[q]=A[q-1].slice(0),A[q+1]=H(B,d.length-1)}return A};let J,U;if(B){const d=B._creationDataStorage,A=t.arc||d.arc;return J=d.path3D.update(p),U=P(p,J,d.pathArray,X,d.Uk,D,d.cap,A),B=a("",{pathArray:U,instance:B}),d.path3D=J,d.pathArray=U,d.arc=A,d.i=X,B}J=new Z.e(p);i=i<0||i>3?0:i,U=P(p,J,new Array,X,W,D,i,t.arc);const T=a(d,{pathArray:U,closePath:!0,closeArray:!1,updatable:b,sideOrientation:Q,invertUV:k,frontUVs:t.frontUVs,backUVs:t.backUVs},A);return T._creationDataStorage.pathArray=U,T._creationDataStorage.path3D=J,T._creationDataStorage.Uk=W,T._creationDataStorage.cap=i,T._creationDataStorage.arc=t.arc,T._creationDataStorage.i=X,T}function e(d){const t=[];t[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},t[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},t[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},t[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},t[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},t[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},t[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},t[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},t[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},t[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},t[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},t[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},t[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},t[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},t[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const A=d.type&&(d.type<0||d.type>=t.length)?0:d.type||0,N=d.size,p=d.sizeX||N||1,W=d.sizeY||N||1,a=d.sizeZ||N||1,D=d.custom||t[A],i=D.face.length,b=d.faceUV||new Array(i),Q=d.faceColors,P=void 0===d.flat||d.flat,J=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE,U=[],T=[],F=[],q=[],H=[];let f=0,v=0;const m=[];let j,n,R,Z,L,I,u=0,V=0;if(P)for(V=0;V<i;V++)Q&&void 0===Q[V]&&(Q[V]=new k.i(1,1,1,1)),b&&void 0===b[V]&&(b[V]=new w.m(0,0,1,1));if(P)for(V=0;V<i;V++){const d=D.face[V].length;for(R=2*Math.PI/d,Z=.5*Math.tan(R/2),L=.5,u=0;u<d;u++)U.push(D.vertex[D.face[V][u]][0]*p,D.vertex[D.face[V][u]][1]*W,D.vertex[D.face[V][u]][2]*a),m.push(f),f++,j=b[V].x+(b[V].z-b[V].x)*(.5+Z),n=b[V].y+(b[V].w-b[V].y)*(L-.5),q.push(j,X.e?1-n:n),I=Z*Math.cos(R)-L*Math.sin(R),L=Z*Math.sin(R)+L*Math.cos(R),Z=I,Q&&H.push(Q[V].r,Q[V].g,Q[V].b,Q[V].a);for(u=0;u<d-2;u++)T.push(m[0+v],m[u+2+v],m[u+1+v]);v+=d}else{for(u=0;u<D.vertex.length;u++)U.push(D.vertex[u][0]*p,D.vertex[u][1]*W,D.vertex[u][2]*a),q.push(0,X.e?1:0);for(V=0;V<i;V++)for(u=0;u<D.face[V].length-2;u++)T.push(D.face[V][0],D.face[V][u+2],D.face[V][u+1])}B.e.ComputeNormals(U,T,F),B.e._ComputeSides(J,U,T,F,q,d.frontUVs,d.backUVs);const h=new B.e;return h.xa=U,h.indices=T,h.ya=F,h.Aa=q,Q&&P&&(h.za=H),h}function M(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new N.d(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return e(t).Ca(w,t.updatable),w}N.d.CreateTube=(d,t,A,w,N,p,B,X,W,a)=>c(d,{path:t,i:A,Uk:w,radiusFunction:N,arc:1,cap:p,updatable:X,sideOrientation:W,instance:a},B);function x(d){const t=d.sideOrientation||B.e.DEFAULTSIDE,A=d.i||1,N=void 0===d.flat||d.flat,p=0|(d.subdivisions||4),W=d.radiusX||A,a=d.radiusY||A,D=d.radiusZ||A,i=(1+Math.sqrt(5))/2,k=[-1,i,-0,1,i,0,-1,-i,0,1,-i,0,0,-1,-i,0,1,-i,0,-1,i,0,1,i,i,0,1,i,0,-1,-i,0,1,-i,0,-1],b=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],Q=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],P=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],J=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],U=[],T=[],F=[],q=[];let H=0;const f=new Array(3),v=new Array(3);let m;for(m=0;m<3;m++)f[m]=w.l.Zero(),v[m]=w.j.Zero();for(let B=0;B<20;B++){for(m=0;m<3;m++){const d=b[3*B+m];f[m].wf(k[3*Q[d]],k[3*Q[d]+1],k[3*Q[d]+2]),f[m].normalize(),v[m].wf(.134765625*P[2*d]+.05859375+-.0390625*J[B],.2333984375*P[2*d+1]+.025390625+.01953125*J[B])}const d=(d,t,A,B)=>{const i=w.l.Lerp(f[0],f[2],t/p),k=w.l.Lerp(f[1],f[2],t/p),b=p===t?f[2]:w.l.Lerp(i,k,d/(p-t));let Q;if(b.normalize(),N){const d=w.l.Lerp(f[0],f[2],B/p),t=w.l.Lerp(f[1],f[2],B/p);Q=w.l.Lerp(d,t,A/(p-B))}else Q=new w.l(b.x,b.y,b.z);Q.x/=W,Q.y/=a,Q.z/=D,Q.normalize();const P=w.j.Lerp(v[0],v[2],t/p),J=w.j.Lerp(v[1],v[2],t/p),m=p===t?v[2]:w.j.Lerp(P,J,d/(p-t));T.push(b.x*W,b.y*a,b.z*D),F.push(Q.x,Q.y,Q.z),q.push(m.x,X.e?1-m.y:m.y),U.push(H),H++};for(let t=0;t<p;t++)for(let A=0;A+t<p;A++)d(A,t,A+1/3,t+1/3),d(A+1,t,A+1/3,t+1/3),d(A,t+1,A+1/3,t+1/3),A+t+1<p&&(d(A+1,t,A+2/3,t+2/3),d(A+1,t+1,A+2/3,t+2/3),d(A,t+1,A+2/3,t+2/3))}B.e._ComputeSides(t,T,U,F,q,d.frontUVs,d.backUVs);const j=new B.e;return j.indices=U,j.xa=T,j.ya=F,j.Aa=q,j}function o(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const w=new N.d(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),w._originalBuilderSideOrientation=t.sideOrientation;return x(t).Ca(w,t.updatable),w}B.e.CreatePolyhedron=e,N.d.CreatePolyhedron=(d,t,A)=>M(d,t,A);B.e.CreateIcoSphere=x,N.d.CreateIcoSphere=(d,t,A)=>o(d,t,A);var C=A(11087);const E=new w.l(1,0,0),g=new w.l(-1,0,0),S=new w.l(0,1,0),dd=new w.l(0,-1,0),td=new w.l(0,0,1),Ad=new w.l(0,0,-1);class wd{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.l.Zero(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.l.Up(),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:w.j.Zero(),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,B=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,X=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,W=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=d,this.ab=t,this.uv=A,this.vertexIdx=N,this.vertexIdxForBones=p,this.localPositionOverride=B,this.localNormalOverride=X,this.matrixIndicesOverride=W,this.matrixWeightsOverride=a}clone(){var d,t,A,w;return new wd(this.position.clone(),this.ab.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(d=this.localPositionOverride)||void 0===d?void 0:d.slice(),null===(t=this.localNormalOverride)||void 0===t?void 0:t.slice(),null===(A=this.matrixIndicesOverride)||void 0===A?void 0:A.slice(),null===(w=this.matrixWeightsOverride)||void 0===w?void 0:w.slice())}}function Nd(d,t,A){var W,a,D,i;const k=!!t.skeleton,b=A.localMode||k,Q=t.xf(),P=k?t.Me(!0,!0):t.getVerticesData(p.f.PositionKind),J=k?t.getNormalsData(!0,!0):t.getVerticesData(p.f.NormalKind),U=b?k?t.getVerticesData(p.f.PositionKind):P:null,T=b?k?t.getVerticesData(p.f.NormalKind):J:null,F=t.getVerticesData(p.f.UVKind),q=k?t.getVerticesData(p.f.MatricesIndicesKind):null,H=k?t.getVerticesData(p.f.MatricesWeightsKind):null,f=k?t.getVerticesData(p.f.MatricesIndicesExtraKind):null,v=k?t.getVerticesData(p.f.MatricesWeightsExtraKind):null,m=A.position||w.l.Zero();let j=A.ab||w.l.Up();const n=A.size||w.l.One(),R=A.angle||0;if(!j){const d=new w.l(0,0,1),A=t.va().activeCamera,N=w.l.TransformCoordinates(d,A.getWorldMatrix());j=A.globalPosition.Uc(N)}const Z=-Math.atan2(j.z,j.x)-Math.PI/2,L=Math.sqrt(j.x*j.x+j.z*j.z),I=Math.atan2(j.y,L),u=new B.e;u.indices=[],u.xa=[],u.ya=[],u.Aa=[],u.matricesIndices=k?[]:null,u.matricesWeights=k?[]:null,u.matricesIndicesExtra=f?[]:null,u.matricesWeightsExtra=v?[]:null;let V=0;const h=(d,t)=>{const N=new wd;if(!Q||!P||!J)return N;const p=Q[d];if(N.vertexIdx=3*p,N.vertexIdxForBones=4*p,N.position=new w.l(P[3*p],P[3*p+1],P[3*p+2]),w.l.TransformCoordinatesToRef(N.position,t,N.position),N.ab=new w.l(J[3*p],J[3*p+1],J[3*p+2]),w.l.TransformNormalToRef(N.ab,t,N.ab),A.captureUVS&&F){const d=F[2*p+1];N.uv=new w.j(F[2*p],X.e?1-d:d)}return N},l=[0,0,0,0],y=(d,t)=>{if(0===d.length)return d;const A=.5*Math.abs(w.l.Dot(n,t)),N=(d,t,A,w)=>{for(let N=0;N<w;++N)if(d[A+N]===t)return A+N;return-1},p=(d,p)=>{const B=w.l.GetClipFactor(d.position,p.position,t,A);let X=l,W=l;if(q&&H){const t=d.matrixIndicesOverride?0:d.vertexIdxForBones,A=d.matrixIndicesOverride??q,w=d.matrixWeightsOverride??H,a=p.matrixIndicesOverride?0:p.vertexIdxForBones,D=p.matrixIndicesOverride??q,i=p.matrixWeightsOverride??H;X=[0,0,0,0],W=[0,0,0,0];let k=0;for(let d=0;d<4;++d)if(w[t+d]>0){const p=N(D,A[t+d],a,4);X[k]=A[t+d],W[k]=(0,C.o)(w[t+d],p>=0?i[p]:0,B),k++}for(let d=0;d<4&&k<4;++d){const w=D[a+d];-1===N(A,w,t,4)&&(X[k]=w,W[k]=(0,C.o)(0,i[a+d],B),k++)}const b=W[0]+W[1]+W[2]+W[3];W[0]/=b,W[1]/=b,W[2]/=b,W[3]/=b}const a=d.localPositionOverride?d.localPositionOverride[0]:(null===U||void 0===U?void 0:U[d.vertexIdx])??0,D=d.localPositionOverride?d.localPositionOverride[1]:(null===U||void 0===U?void 0:U[d.vertexIdx+1])??0,i=d.localPositionOverride?d.localPositionOverride[2]:(null===U||void 0===U?void 0:U[d.vertexIdx+2])??0,k=p.localPositionOverride?p.localPositionOverride[0]:(null===U||void 0===U?void 0:U[p.vertexIdx])??0,b=p.localPositionOverride?p.localPositionOverride[1]:(null===U||void 0===U?void 0:U[p.vertexIdx+1])??0,Q=p.localPositionOverride?p.localPositionOverride[2]:(null===U||void 0===U?void 0:U[p.vertexIdx+2])??0,P=d.localNormalOverride?d.localNormalOverride[0]:(null===T||void 0===T?void 0:T[d.vertexIdx])??0,J=d.localNormalOverride?d.localNormalOverride[1]:(null===T||void 0===T?void 0:T[d.vertexIdx+1])??0,F=d.localNormalOverride?d.localNormalOverride[2]:(null===T||void 0===T?void 0:T[d.vertexIdx+2])??0,f=P+((p.localNormalOverride?p.localNormalOverride[0]:(null===T||void 0===T?void 0:T[p.vertexIdx])??0)-P)*B,v=J+((p.localNormalOverride?p.localNormalOverride[1]:(null===T||void 0===T?void 0:T[p.vertexIdx+1])??0)-J)*B,m=F+((p.localNormalOverride?p.localNormalOverride[2]:(null===T||void 0===T?void 0:T[p.vertexIdx+2])??0)-F)*B,j=Math.sqrt(f*f+v*v+m*m);return new wd(w.l.Lerp(d.position,p.position,B),w.l.Lerp(d.ab,p.ab,B).normalize(),w.j.Lerp(d.uv,p.uv,B),-1,-1,U?[a+(k-a)*B,D+(b-D)*B,i+(Q-i)*B]:null,T?[f/j,v/j,m/j]:null,X,W)};let B=null;d.length>3&&(B=[]);for(let X=0;X<d.length;X+=3){let N=0,W=null,a=null,D=null,i=null;const k=w.l.Dot(d[X].position,t)-A>0,b=w.l.Dot(d[X+1].position,t)-A>0,Q=w.l.Dot(d[X+2].position,t)-A>0;switch(N=(k?1:0)+(b?1:0)+(Q?1:0),N){case 0:d.length>3?(B.push(d[X]),B.push(d[X+1]),B.push(d[X+2])):B=d;break;case 1:if(B=B??new Array,k&&(W=d[X+1],a=d[X+2],D=p(d[X],W),i=p(d[X],a)),b){W=d[X],a=d[X+2],D=p(d[X+1],W),i=p(d[X+1],a),B.push(D),B.push(a.clone()),B.push(W.clone()),B.push(a.clone()),B.push(D.clone()),B.push(i);break}Q&&(W=d[X],a=d[X+1],D=p(d[X+2],W),i=p(d[X+2],a)),W&&a&&D&&i&&(B.push(W.clone()),B.push(a.clone()),B.push(D),B.push(i),B.push(D.clone()),B.push(a.clone()));break;case 2:B=B??new Array,k||(W=d[X].clone(),a=p(W,d[X+1]),D=p(W,d[X+2]),B.push(W),B.push(a),B.push(D)),b||(W=d[X+1].clone(),a=p(W,d[X+2]),D=p(W,d[X]),B.push(W),B.push(a),B.push(D)),Q||(W=d[X+2].clone(),a=p(W,d[X]),D=p(W,d[X+1]),B.push(W),B.push(a),B.push(D))}}return B},s=t instanceof N.d?t:null,Y=null===s||void 0===s?void 0:s._thinInstanceDataStorage.matrixData,r=(null===s||void 0===s?void 0:s.Lj)||1,K=w.h.Matrix[0];K.p(w.c.IdentityReadOnly);for(let N=0;N<r;++N){if(null!==s&&void 0!==s&&s.hasThinInstances&&Y){const d=16*N;K.setRowFromFloats(0,Y[d+0],Y[d+1],Y[d+2],Y[d+3]),K.setRowFromFloats(1,Y[d+4],Y[d+5],Y[d+6],Y[d+7]),K.setRowFromFloats(2,Y[d+8],Y[d+9],Y[d+10],Y[d+11]),K.setRowFromFloats(3,Y[d+12],Y[d+13],Y[d+14],Y[d+15])}const d=w.c.RotationYawPitchRoll(Z,I,R).multiply(w.c.Translation(m.x,m.y,m.z)),p=w.c.Invert(d),B=t.getWorldMatrix(),W=K.multiply(B).multiply(p),a=new Array(3);for(let t=0;t<Q.length;t+=3){let d=a;if(d[0]=h(t,W),d[1]=h(t+1,W),d[2]=h(t+2,W),!(A.cullBackFaces&&-d[0].ab.z<=0&&-d[1].ab.z<=0&&-d[2].ab.z<=0)&&(d=y(d,E),d&&(d=y(d,g),d&&(d=y(d,S),d&&(d=y(d,dd),d&&(d=y(d,td),d&&(d=y(d,Ad),d)))))))for(let t=0;t<d.length;t++){const w=d[t];if(u.indices.push(V),b?(w.localPositionOverride?(u.xa[3*V]=w.localPositionOverride[0],u.xa[3*V+1]=w.localPositionOverride[1],u.xa[3*V+2]=w.localPositionOverride[2]):U&&(u.xa[3*V]=U[w.vertexIdx],u.xa[3*V+1]=U[w.vertexIdx+1],u.xa[3*V+2]=U[w.vertexIdx+2]),w.localNormalOverride?(u.ya[3*V]=w.localNormalOverride[0],u.ya[3*V+1]=w.localNormalOverride[1],u.ya[3*V+2]=w.localNormalOverride[2]):T&&(u.ya[3*V]=T[w.vertexIdx],u.ya[3*V+1]=T[w.vertexIdx+1],u.ya[3*V+2]=T[w.vertexIdx+2])):(w.position.toArray(u.xa,3*V),w.ab.toArray(u.ya,3*V)),u.matricesIndices&&u.matricesWeights&&(w.matrixIndicesOverride?(u.matricesIndices[4*V]=w.matrixIndicesOverride[0],u.matricesIndices[4*V+1]=w.matrixIndicesOverride[1],u.matricesIndices[4*V+2]=w.matrixIndicesOverride[2],u.matricesIndices[4*V+3]=w.matrixIndicesOverride[3]):(q&&(u.matricesIndices[4*V]=q[w.vertexIdxForBones],u.matricesIndices[4*V+1]=q[w.vertexIdxForBones+1],u.matricesIndices[4*V+2]=q[w.vertexIdxForBones+2],u.matricesIndices[4*V+3]=q[w.vertexIdxForBones+3]),f&&u.matricesIndicesExtra&&(u.matricesIndicesExtra[4*V]=f[w.vertexIdxForBones],u.matricesIndicesExtra[4*V+1]=f[w.vertexIdxForBones+1],u.matricesIndicesExtra[4*V+2]=f[w.vertexIdxForBones+2],u.matricesIndicesExtra[4*V+3]=f[w.vertexIdxForBones+3])),w.matrixWeightsOverride?(u.matricesWeights[4*V]=w.matrixWeightsOverride[0],u.matricesWeights[4*V+1]=w.matrixWeightsOverride[1],u.matricesWeights[4*V+2]=w.matrixWeightsOverride[2],u.matricesWeights[4*V+3]=w.matrixWeightsOverride[3]):(H&&(u.matricesWeights[4*V]=H[w.vertexIdxForBones],u.matricesWeights[4*V+1]=H[w.vertexIdxForBones+1],u.matricesWeights[4*V+2]=H[w.vertexIdxForBones+2],u.matricesWeights[4*V+3]=H[w.vertexIdxForBones+3]),v&&u.matricesWeightsExtra&&(u.matricesWeightsExtra[4*V]=v[w.vertexIdxForBones],u.matricesWeightsExtra[4*V+1]=v[w.vertexIdxForBones+1],u.matricesWeightsExtra[4*V+2]=v[w.vertexIdxForBones+2],u.matricesWeightsExtra[4*V+3]=v[w.vertexIdxForBones+3]))),A.captureUVS)w.uv.toArray(u.Aa,2*V);else{u.Aa.push(.5+w.position.x/n.x);const d=.5+w.position.y/n.y;u.Aa.push(X.e?1-d:d)}V++}}}0===u.indices.length&&(u.indices=null),0===u.xa.length&&(u.xa=null),0===u.ya.length&&(u.ya=null),0===u.Aa.length&&(u.Aa=null),0===(null===(W=u.matricesIndices)||void 0===W?void 0:W.length)&&(u.matricesIndices=null),0===(null===(a=u.matricesWeights)||void 0===a?void 0:a.length)&&(u.matricesWeights=null),0===(null===(D=u.matricesIndicesExtra)||void 0===D?void 0:D.length)&&(u.matricesIndicesExtra=null),0===(null===(i=u.matricesWeightsExtra)||void 0===i?void 0:i.length)&&(u.matricesWeightsExtra=null);const G=new N.d(d,t.va());return u.Ca(G),b?(G.skeleton=t.skeleton,G.parent=t):(G.position=m.clone(),G.rotation=new w.l(I,Z,R)),G.Nj(!0),G.refreshBoundingInfo(!0,!0),G}function pd(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,Uk:16,height:1,i:.25,capSubdivisions:6};const t=0|Math.max(d.subdivisions?d.subdivisions:2,1),A=0|Math.max(d.Uk?d.Uk:16,3),N=Math.max(d.height?d.height:1,0),p=Math.max(d.i?d.i:.25,0),W=0|Math.max(d.capSubdivisions?d.capSubdivisions:6,1),a=A,D=t,i=Math.max(d.radiusTop?d.radiusTop:p,0),k=Math.max(d.radiusBottom?d.radiusBottom:p,0),b=N-(i+k),Q=2*Math.PI,P=Math.max(d.topCapSubdivisions?d.topCapSubdivisions:W,1),J=Math.max(d.bottomCapSubdivisions?d.bottomCapSubdivisions:W,1),U=Math.acos((k-i)/N);let T=[];const F=[],q=[],H=[];let f=0;const v=[],m=.5*b,j=.5*Math.PI;let n,R;const Z=w.l.Zero(),L=w.l.Zero(),I=Math.cos(U),u=Math.sin(U),V=new w.j(i*u,m+i*I).Uc(new w.j(k*u,k*I-m)).length(),h=i*U+V+k*(j-U);let l=0;for(R=0;R<=P;R++){const d=[],t=j-U*(R/P);l+=i*U/P;const A=Math.cos(t),w=Math.sin(t),N=A*i;for(n=0;n<=a;n++){const t=n/a,p=t*Q+0,B=Math.sin(p),W=Math.cos(p);L.x=N*B,L.y=m+w*i,L.z=N*W,F.push(L.x,L.y,L.z),Z.set(A*B,w,A*W),q.push(Z.x,Z.y,Z.z),H.push(t,X.e?l/h:1-l/h),d.push(f),f++}v.push(d)}const y=N-i-k+I*i-I*k,s=u*(k-i)/y;for(R=1;R<=D;R++){const d=[];l+=V/D;const t=u*(R*(k-i)/D+i);for(n=0;n<=a;n++){const A=n/a,w=A*Q+0,N=Math.sin(w),p=Math.cos(w);L.x=t*N,L.y=m+I*i-R*y/D,L.z=t*p,F.push(L.x,L.y,L.z),Z.set(N,s,p).normalize(),q.push(Z.x,Z.y,Z.z),H.push(A,X.e?l/h:1-l/h),d.push(f),f++}v.push(d)}for(R=1;R<=J;R++){const d=[],t=j-U-(Math.PI-U)*(R/J);l+=k*U/J;const A=Math.cos(t),w=Math.sin(t),N=A*k;for(n=0;n<=a;n++){const t=n/a,p=t*Q+0,B=Math.sin(p),W=Math.cos(p);L.x=N*B,L.y=w*k-m,L.z=N*W,F.push(L.x,L.y,L.z),Z.set(A*B,w,A*W),q.push(Z.x,Z.y,Z.z),H.push(t,X.e?l/h:1-l/h),d.push(f),f++}v.push(d)}for(n=0;n<a;n++)for(R=0;R<P+D+J;R++){const d=v[R][n],t=v[R+1][n],A=v[R+1][n+1],w=v[R][n+1];T.push(d),T.push(t),T.push(w),T.push(t),T.push(A),T.push(w)}if(T=T.reverse(),d.orientation&&!d.orientation.equals(w.l.Up())){const t=new w.c;d.orientation.clone().scale(.5*Math.PI).cross(w.l.Up()).toQuaternion().toRotationMatrix(t);const A=w.l.Zero();for(let d=0;d<F.length;d+=3)A.set(F[d],F[d+1],F[d+2]),w.l.TransformCoordinatesToRef(A.clone(),t,A),F[d]=A.x,F[d+1]=A.y,F[d+2]=A.z}const Y=new B.e;return Y.xa=F,Y.ya=q,Y.Aa=H,Y.indices=T,Y}function Bd(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:w.l.Up(),subdivisions:2,Uk:16,height:1,i:.25,capSubdivisions:6,updatable:!1},A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=new N.d(d,A);return pd(t).Ca(p,t.updatable),p}N.d.CreateDecal=(d,t,A,w,N,p)=>Nd(d,t,{position:A,ab:w,size:N,angle:p});N.d.CreateCapsule=(d,t,A)=>Bd(d,t,A),B.e.CreateCapsule=pd;class Xd{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=d,this.y=t,d!==Math.floor(d)&&(d=Math.floor(d),R.e.Warn("x is not an integer, floor(x) used")),t!==Math.floor(t)&&(t=Math.floor(t),R.e.Warn("y is not an integer, floor(y) used"))}clone(){return new Xd(this.x,this.y)}rotate60About(d){const t=this.x;return this.x=d.x+d.y-this.y,this.y=t+this.y-d.x,this}rotateNeg60About(d){const t=this.x;return this.x=t+this.y-d.y,this.y=d.x+d.y-t,this}rotate120(d,t){d!==Math.floor(d)&&(d=Math.floor(d),R.e.Warn("m not an integer only floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),R.e.Warn("n not an integer only floor(n) used"));const A=this.x;return this.x=d-A-this.y,this.y=t+A,this}rotateNeg120(d,t){d!==Math.floor(d)&&(d=Math.floor(d),R.e.Warn("m is not an integer, floor(m) used")),t!==Math.floor(t)&&(t=Math.floor(t),R.e.Warn("n is not an integer,   floor(n) used"));const A=this.x;return this.x=this.y-t,this.y=d+t-A-this.y,this}toCartesianOrigin(d,t){const A=w.l.Zero();return A.x=d.x+2*this.x*t+this.y*t,A.y=d.y+Math.sqrt(3)*this.y*t,A}static Zero(){return new Xd(0,0)}}class Wd{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new ad("icosahedron","Regular",[[0,L.f,-1],[-L.f,1,0],[-1,0,-L.f],[1,0,-L.f],[L.f,1,0],[0,L.f,1],[-1,0,L.f],[-L.f,-1,0],[0,-L.f,-1],[L.f,-1,0],[1,0,L.f],[0,-L.f,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let d=12;const t={},A=this.m,w=this.n;let N,p,B,X,W,a=A,D=1,i=0;0!==w&&(a=(0,C.j)(A,w)),D=A/a,i=w/a;const k=Xd.Zero(),b=new Xd(A,w),Q=new Xd(-w,A+w),P=Xd.Zero(),J=Xd.Zero(),U=Xd.Zero();let T,F,q,H,f=[];const v=[],m=this.vertByDist,j=(A,w,N,p)=>{T=A+"|"+N,F=w+"|"+p,T in t||F in t?T in t&&!(F in t)?t[F]=t[T]:F in t&&!(T in t)&&(t[T]=t[F]):(t[T]=d,t[F]=d,d++),m[N][0]>2?v[t[T]]=[-m[N][0],m[N][1],t[T]]:v[t[T]]=[f[m[N][0]],m[N][1],t[T]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let n=0;n<20;n++){if(f=this.IDATA.face[n],B=f[2],X=f[1],W=f[0],q=k.x+"|"+k.y,T=n+"|"+q,T in t||(t[T]=B,v[B]=[f[m[q][0]],m[q][1]]),q=b.x+"|"+b.y,T=n+"|"+q,T in t||(t[T]=X,v[X]=[f[m[q][0]],m[q][1]]),q=Q.x+"|"+Q.y,T=n+"|"+q,T in t||(t[T]=W,v[W]=[f[m[q][0]],m[q][1]]),N=this.IDATA.edgematch[n][0],p=this.IDATA.edgematch[n][1],"B"===p)for(let d=1;d<a;d++)J.x=A-d*(D+i),J.y=w+d*D,U.x=-d*i,U.y=d*(D+i),q=J.x+"|"+J.y,H=U.x+"|"+U.y,j(n,N,q,H);if("O"===p)for(let d=1;d<a;d++)U.x=-d*i,U.y=d*(D+i),P.x=d*D,P.y=d*i,q=U.x+"|"+U.y,H=P.x+"|"+P.y,j(n,N,q,H);if(N=this.IDATA.edgematch[n][2],p=this.IDATA.edgematch[n][3],p&&"A"===p)for(let d=1;d<a;d++)P.x=d*D,P.y=d*i,J.x=A-(a-d)*(D+i),J.y=w+(a-d)*D,q=P.x+"|"+P.y,H=J.x+"|"+J.y,j(n,N,q,H);for(let A=0;A<this.vertices.length;A++)q=this.vertices[A].x+"|"+this.vertices[A].y,T=n+"|"+q,T in t||(t[T]=d++,m[q][0]>2?v[t[T]]=[-m[q][0],m[q][1],t[T]]:v[t[T]]=[f[m[q][0]],m[q][1],t[T]])}this.closestTo=v,this.vecToidx=t}calcCoeffs(){const d=this.m,t=this.n,A=Math.sqrt(3)/3,w=d*d+t*t+d*t;this.coau=(d+t)/w,this.cobu=-t/w,this.coav=-A*(d-t)/w,this.cobv=A*(2*d+t)/w}createInnerFacets(){const d=this.m,t=this.n;for(let A=0;A<t+d+1;A++)for(let d=this.min[A];d<this.max[A]+1;d++)d<this.max[A]&&d<this.max[A+1]+1&&this.innerFacets.push(["|"+d+"|"+A,"|"+d+"|"+(A+1),"|"+(d+1)+"|"+A]),A>0&&d<this.max[A-1]&&d+1<this.max[A]+1&&this.innerFacets.push(["|"+d+"|"+A,"|"+(d+1)+"|"+A,"|"+(d+1)+"|"+(A-1)])}edgeVecsABOB(){const d=this.m,t=this.n,A=new Xd(-t,d+t);for(let w=1;w<d+t;w++){const d=new Xd(this.min[w],w),t=new Xd(this.min[w-1],w-1),N=new Xd(this.min[w+1],w+1),p=d.clone(),B=t.clone(),X=N.clone();p.rotate60About(A),B.rotate60About(A),X.rotate60About(A);const W=new Xd(this.max[p.y],p.y),a=new Xd(this.max[p.y-1],p.y-1),D=new Xd(this.max[p.y-1]-1,p.y-1);p.x===W.x&&p.y===W.y||(p.x!==a.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([d,a,D]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([d,D,W])):p.y===X.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([d,t,a]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([d,a,N])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([d,t,a]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([d,a,W])))}}mapABOBtoOBOA(){const d=new Xd(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const A=[];for(let w=0;w<3;w++)d.x=this.isoVecsABOB[t][w].x,d.y=this.isoVecsABOB[t][w].y,0===this.vertexTypes[t][w]&&d.rotateNeg120(this.m,this.n),A.push(d.clone());this.isoVecsOBOA.push(A)}}mapABOBtoBAOA(){const d=new Xd(0,0);for(let t=0;t<this.isoVecsABOB.length;t++){const A=[];for(let w=0;w<3;w++)d.x=this.isoVecsABOB[t][w].x,d.y=this.isoVecsABOB[t][w].y,1===this.vertexTypes[t][w]&&d.rotate120(this.m,this.n),A.push(d.clone());this.isoVecsBAOA.push(A)}}MapToFace(d,t){const A=this.IDATA.face[d],N=A[2],p=A[1],B=A[0],X=w.l.Lg(this.IDATA.vertex[N]),W=w.l.Lg(this.IDATA.vertex[p]),a=w.l.Lg(this.IDATA.vertex[B]),D=W.Uc(X),i=a.Uc(X),k=D.scale(this.coau).add(i.scale(this.cobu)),b=D.scale(this.coav).add(i.scale(this.cobv)),Q=[];let P,J=w.h.gb[0];for(let w=0;w<this.cartesian.length;w++)J=k.scale(this.cartesian[w].x).add(b.scale(this.cartesian[w].y)).add(X),Q[w]=[J.x,J.y,J.z],P=d+"|"+this.vertices[w].x+"|"+this.vertices[w].y,t.vertex[this.vecToidx[P]]=[J.x,J.y,J.z]}build(d,t){const A=[],w=Xd.Zero(),N=new Xd(d,t),p=new Xd(-t,d+t);A.push(w,N,p);for(let q=t;q<d+1;q++)for(let t=0;t<d+1-q;t++)A.push(new Xd(t,q));if(t>0){const w=(0,C.j)(d,t),N=d/w,p=t/w;for(let X=1;X<w;X++)A.push(new Xd(X*N,X*p)),A.push(new Xd(-X*p,X*(N+p))),A.push(new Xd(d-X*(N+p),t+X*N));const B=d/t;for(let X=1;X<t;X++)for(let w=0;w<X*B;w++)A.push(new Xd(w,X)),A.push(new Xd(w,X).rotate120(d,t)),A.push(new Xd(w,X).rotateNeg120(d,t))}A.sort(((d,t)=>d.x-t.x)),A.sort(((d,t)=>d.y-t.y));const B=new Array(d+t+1),X=new Array(d+t+1);for(let q=0;q<B.length;q++)B[q]=1/0,X[q]=-1/0;let W=0,a=0;const D=A.length;for(let q=0;q<D;q++)a=A[q].x,W=A[q].y,B[W]=Math.min(a,B[W]),X[W]=Math.max(a,X[W]);const i=(A,w)=>{const N=A.clone();return"A"===w&&N.rotateNeg120(d,t),"B"===w&&N.rotate120(d,t),N.x<0?N.y:N.x+N.y},k=[],b=[],Q=[],P=[],J={},U=[];let T=-1,F=-1;for(let q=0;q<D;q++)k[q]=A[q].toCartesianOrigin(new Xd(0,0),.5),b[q]=i(A[q],"O"),Q[q]=i(A[q],"A"),P[q]=i(A[q],"B"),b[q]===Q[q]&&Q[q]===P[q]?(T=3,F=b[q]):b[q]===Q[q]?(T=4,F=b[q]):Q[q]===P[q]?(T=5,F=Q[q]):P[q]===b[q]&&(T=6,F=b[q]),b[q]<Q[q]&&b[q]<P[q]&&(T=2,F=b[q]),Q[q]<b[q]&&Q[q]<P[q]&&(T=1,F=Q[q]),P[q]<Q[q]&&P[q]<b[q]&&(T=0,F=P[q]),U.push([T,F,A[q].x,A[q].y]);U.sort(((d,t)=>d[2]-t[2])),U.sort(((d,t)=>d[3]-t[3])),U.sort(((d,t)=>d[1]-t[1])),U.sort(((d,t)=>d[0]-t[0]));for(let q=0;q<U.length;q++)J[U[q][2]+"|"+U[q][3]]=[U[q][0],U[q][1],q];return this.m=d,this.n=t,this.vertices=A,this.vertByDist=J,this.cartesian=k,this.min=B,this.max=X,this}}class ad{constructor(d,t,A,w){this.name=d,this.category=t,this.vertex=A,this.face=w}}class Dd extends ad{innerToData(d,t){for(let A=0;A<t.innerFacets.length;A++)this.face.push(t.innerFacets[A].map((A=>t.vecToidx[d+A])))}mapABOBtoDATA(d,t){const A=t.IDATA.edgematch[d][0];for(let w=0;w<t.isoVecsABOB.length;w++){const N=[];for(let p=0;p<3;p++)0===t.vertexTypes[w][p]?N.push(d+"|"+t.isoVecsABOB[w][p].x+"|"+t.isoVecsABOB[w][p].y):N.push(A+"|"+t.isoVecsABOB[w][p].x+"|"+t.isoVecsABOB[w][p].y);this.face.push([t.vecToidx[N[0]],t.vecToidx[N[1]],t.vecToidx[N[2]]])}}mapOBOAtoDATA(d,t){const A=t.IDATA.edgematch[d][0];for(let w=0;w<t.isoVecsOBOA.length;w++){const N=[];for(let p=0;p<3;p++)1===t.vertexTypes[w][p]?N.push(d+"|"+t.isoVecsOBOA[w][p].x+"|"+t.isoVecsOBOA[w][p].y):N.push(A+"|"+t.isoVecsOBOA[w][p].x+"|"+t.isoVecsOBOA[w][p].y);this.face.push([t.vecToidx[N[0]],t.vecToidx[N[1]],t.vecToidx[N[2]]])}}mapBAOAtoDATA(d,t){const A=t.IDATA.edgematch[d][2];for(let w=0;w<t.isoVecsBAOA.length;w++){const N=[];for(let p=0;p<3;p++)1===t.vertexTypes[w][p]?N.push(d+"|"+t.isoVecsBAOA[w][p].x+"|"+t.isoVecsBAOA[w][p].y):N.push(A+"|"+t.isoVecsBAOA[w][p].x+"|"+t.isoVecsBAOA[w][p].y);this.face.push([t.vecToidx[N[0]],t.vecToidx[N[1]],t.vecToidx[N[2]]])}}orderData(d){const t=[];for(let p=0;p<13;p++)t[p]=[];const A=d.closestTo;for(let p=0;p<A.length;p++)A[p][0]>-1?A[p][1]>0&&t[A[p][0]].push([p,A[p][1]]):t[12].push([p,A[p][0]]);const w=[];for(let p=0;p<12;p++)w[p]=p;let N=12;for(let p=0;p<12;p++){t[p].sort(((d,t)=>d[1]-t[1]));for(let d=0;d<t[p].length;d++)w[t[p][d][0]]=N++}for(let p=0;p<t[12].length;p++)w[t[12][p][0]]=N++;for(let p=0;p<this.vertex.length;p++)this.vertex[p].push(w[p]);this.vertex.sort(((d,t)=>d[3]-t[3]));for(let p=0;p<this.vertex.length;p++)this.vertex[p].pop();for(let p=0;p<this.face.length;p++)for(let d=0;d<this.face[p].length;d++)this.face[p][d]=w[this.face[p][d]];this.sharedNodes=t[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(d,t){const A=[],w=[];let N=t.pop();w.push(N);let p=this.face[N].indexOf(d);p=(p+2)%3;let B=this.face[N][p];A.push(B);let X=0;for(;t.length>0;)N=t[X],this.face[N].indexOf(B)>-1?(p=(this.face[N].indexOf(B)+1)%3,B=this.face[N][p],A.push(B),w.push(N),t.splice(X,1),X=0):X++;return this.adjacentFaces.push(A),w}toGoldbergPolyhedronData(){const d=new ad("GeoDual","Goldberg",[],[]);d.name="GD dual";const t=this.vertex.length,A=new Array(t);for(let W=0;W<t;W++)A[W]=[];for(let W=0;W<this.face.length;W++)for(let d=0;d<3;d++)A[this.face[W][d]].push(W);let w=0,N=0,p=0,B=[],X=[];this.adjacentFaces=[];for(let W=0;W<A.length;W++)d.face[W]=this.setOrder(W,A[W].concat([])),A[W].forEach((t=>{w=0,N=0,p=0,B=this.face[t];for(let d=0;d<3;d++)X=this.vertex[B[d]],w+=X[0],N+=X[1],p+=X[2];d.vertex[t]=[w/3,N/3,p/3]}));return d}static BuildGeodesicData(d){const t=new Dd("Geodesic-m-n","Geodesic",[[0,L.f,-1],[-L.f,1,0],[-1,0,-L.f],[1,0,-L.f],[L.f,1,0],[0,L.f,1],[-1,0,L.f],[-L.f,-1,0],[0,-L.f,-1],[L.f,-1,0],[1,0,L.f],[0,-L.f,1]],[]);d.setIndices(),d.calcCoeffs(),d.createInnerFacets(),d.edgeVecsABOB(),d.mapABOBtoOBOA(),d.mapABOBtoBAOA();for(let A=0;A<d.IDATA.face.length;A++)d.MapToFace(A,t),t.innerToData(A,d),"B"===d.IDATA.edgematch[A][1]&&t.mapABOBtoDATA(A,d),"O"===d.IDATA.edgematch[A][1]&&t.mapOBOAtoDATA(A,d),"A"===d.IDATA.edgematch[A][3]&&t.mapBAOAtoDATA(A,d);t.orderData(d);return t.vertex=t.vertex.map((function(d){const t=d[0],A=d[1],w=d[2],N=Math.sqrt(t*t+A*A+w*w);return d[0]*=1/N,d[1]*=1/N,d[2]*=1/N,d})),t}}N.d._GoldbergMeshParser=(d,t)=>id.Parse(d,t);class id extends N.d{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(d,t){return void 0===t?(d>this.goldbergData.nbUnsharedFaces-1&&(R.e.Warn("Maximum number of unshared faces used"),d=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+d):(d>11&&(R.e.Warn("Last pole used"),d=11),t>this.goldbergData.nbFacesAtPole-1&&(R.e.Warn("Maximum number of faces at a pole used"),t=this.goldbergData.nbFacesAtPole-1),12+d*this.goldbergData.nbFacesAtPole+t)}_changeGoldbergFaceColors(d){for(let A=0;A<d.length;A++){const t=d[A][0],w=d[A][1],N=d[A][2];for(let d=t;d<w+1;d++)this.goldbergData.faceColors[d]=N}const t=[];for(let A=0;A<12;A++)for(let d=0;d<5;d++)t.push(this.goldbergData.faceColors[A].r,this.goldbergData.faceColors[A].g,this.goldbergData.faceColors[A].b,this.goldbergData.faceColors[A].a);for(let A=12;A<this.goldbergData.faceColors.length;A++)for(let d=0;d<6;d++)t.push(this.goldbergData.faceColors[A].r,this.goldbergData.faceColors[A].g,this.goldbergData.faceColors[A].b,this.goldbergData.faceColors[A].a);return t}setGoldbergFaceColors(d){const t=this._changeGoldbergFaceColors(d);this.Ga(p.f.ColorKind,t)}updateGoldbergFaceColors(d){const t=this._changeGoldbergFaceColors(d);this.updateVerticesData(p.f.ColorKind,t)}_changeGoldbergFaceUVs(d){const t=this.getVerticesData(p.f.UVKind);for(let A=0;A<d.length;A++){const w=d[A][0],N=d[A][1],p=d[A][2],B=d[A][3],X=d[A][4],W=[],a=[];let D,i;for(let d=0;d<5;d++)D=p.x+B*Math.cos(X+d*Math.PI/2.5),i=p.y+B*Math.sin(X+d*Math.PI/2.5),D<0&&(D=0),D>1&&(D=1),W.push(D,i);for(let d=0;d<6;d++)D=p.x+B*Math.cos(X+d*Math.PI/3),i=p.y+B*Math.sin(X+d*Math.PI/3),D<0&&(D=0),D>1&&(D=1),a.push(D,i);for(let d=w;d<Math.min(12,N+1);d++)for(let A=0;A<5;A++)t[10*d+2*A]=W[2*A],t[10*d+2*A+1]=W[2*A+1];for(let d=Math.max(12,w);d<N+1;d++)for(let A=0;A<6;A++)t[12*d-24+2*A]=a[2*A],t[12*d-23+2*A]=a[2*A+1]}return t}setGoldbergFaceUVs(d){const t=this._changeGoldbergFaceUVs(d);this.Ga(p.f.UVKind,t)}updateGoldbergFaceUVs(d){const t=this._changeGoldbergFaceUVs(d);this.updateVerticesData(p.f.UVKind,t)}placeOnGoldbergFaceAt(d,t,A){const N=w.l.RotationFromAxis(this.goldbergData.faceXaxis[t],this.goldbergData.faceYaxis[t],this.goldbergData.faceZaxis[t]);d.rotation=N,d.position=this.goldbergData.faceCenters[t].add(this.goldbergData.faceXaxis[t].scale(A.x)).add(this.goldbergData.faceYaxis[t].scale(A.y)).add(this.goldbergData.faceZaxis[t].scale(A.z))}serialize(d){super.serialize(d),d.type="GoldbergMesh";const t={};if(t.adjacentFaces=this.goldbergData.adjacentFaces,t.nbSharedFaces=this.goldbergData.nbSharedFaces,t.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,t.nbFaces=this.goldbergData.nbFaces,t.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){t.faceColors=[];for(const d of this.goldbergData.faceColors)t.faceColors.push(d.gj())}if(this.goldbergData.faceCenters){t.faceCenters=[];for(const d of this.goldbergData.faceCenters)t.faceCenters.push(d.gj())}if(this.goldbergData.faceZaxis){t.faceZaxis=[];for(const d of this.goldbergData.faceZaxis)t.faceZaxis.push(d.gj())}if(this.goldbergData.faceYaxis){t.faceYaxis=[];for(const d of this.goldbergData.faceYaxis)t.faceYaxis.push(d.gj())}if(this.goldbergData.faceXaxis){t.faceXaxis=[];for(const d of this.goldbergData.faceXaxis)t.faceXaxis.push(d.gj())}d.goldbergData=t}static Parse(d,t){const A=d.goldbergData;A.faceColors=A.faceColors.map((d=>k.i.Lg(d))),A.faceCenters=A.faceCenters.map((d=>w.l.Lg(d))),A.faceZaxis=A.faceZaxis.map((d=>w.l.Lg(d))),A.faceXaxis=A.faceXaxis.map((d=>w.l.Lg(d))),A.faceYaxis=A.faceYaxis.map((d=>w.l.Lg(d)));const N=new id(d.name,t);return N.goldbergData=A,N}}var kd=A(11353);class bd{constructor(d){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=d}moveTo(d,t){this._currentPath=new Z.d(d,t),this._tempPaths.push(this._currentPath)}lineTo(d,t){this._currentPath.addLineTo(d,t)}quadraticCurveTo(d,t,A,w){this._currentPath.addQuadraticCurveTo(d,t,A,w,this._resolution)}bezierCurveTo(d,t,A,w,N,p){this._currentPath.addBezierCurveTo(d,t,A,w,N,p,this._resolution)}extractHoles(){for(const d of this._tempPaths)d.area()>0?this._holes.push(d):this._paths.push(d);if(!this._paths.length&&this._holes.length){const d=this._holes;this._holes=this._paths,this._paths=d}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function Qd(d,t,A,w,N,p){const B=p.glyphs[d]||p.glyphs["?"];if(!B)return null;const X=new bd(N);if(B.o){const d=B.o.split(" ");for(let N=0,p=d.length;N<p;){switch(d[N++]){case"m":{const p=parseInt(d[N++])*t+A,B=parseInt(d[N++])*t+w;X.moveTo(p,B);break}case"l":{const p=parseInt(d[N++])*t+A,B=parseInt(d[N++])*t+w;X.lineTo(p,B);break}case"q":{const p=parseInt(d[N++])*t+A,B=parseInt(d[N++])*t+w,W=parseInt(d[N++])*t+A,a=parseInt(d[N++])*t+w;X.quadraticCurveTo(W,a,p,B);break}case"b":{const p=parseInt(d[N++])*t+A,B=parseInt(d[N++])*t+w,W=parseInt(d[N++])*t+A,a=parseInt(d[N++])*t+w,D=parseInt(d[N++])*t+A,i=parseInt(d[N++])*t+w;X.bezierCurveTo(W,a,D,i,p,B);break}}}}return X.extractHoles(),{offsetX:B.ha*t,shapePath:X}}const Pd={CreateBox:i.c,CreateTiledBox:J,CreateSphere:U.b,rb:D.d,CreateIcoSphere:o,CreateRibbon:a,CreateCylinder:H,CreateTorus:v,CreateTorusKnot:j,CreateLineSystem:n.g,sb:n.k,CreateDashedLines:n.c,ExtrudeShape:Y,ExtrudeShapeCustom:r,CreateLathe:G,CreateTiledPlane:Q,Nf:O.b,CreateGround:z.e,CreateTiledGround:z.h,CreateGroundFromHeightMap:z.b,CreatePolygon:y,ExtrudePolygon:s,CreateTube:c,CreatePolyhedron:M,CreateGeodesic:function(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=t.m||1;w!==Math.floor(w)&&(w=Math.floor(w),R.e.Warn("m not an integer only floor(m) used"));let N=t.n||0;if(N!==Math.floor(N)&&(N=Math.floor(N),R.e.Warn("n not an integer only floor(n) used")),N>w){const d=N;N=w,w=d,R.e.Warn("n > m therefore m and n swapped")}const p=new Wd;return p.build(w,N),M(d,{custom:Dd.BuildGeodesicData(p),size:t.size,sizeX:t.sizeX,sizeY:t.sizeY,sizeZ:t.sizeZ,faceUV:t.faceUV,faceColors:t.faceColors,flat:t.flat,updatable:t.updatable,sideOrientation:t.sideOrientation,frontUVs:t.frontUVs,backUVs:t.backUVs},A)},CreateGoldberg:function(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const p=t.size,W=t.sizeX||p||1,a=t.sizeY||p||1,D=t.sizeZ||p||1;let i=t.m||1;i!==Math.floor(i)&&(i=Math.floor(i),R.e.Warn("m not an integer only floor(m) used"));let b=t.n||0;if(b!==Math.floor(b)&&(b=Math.floor(b),R.e.Warn("n not an integer only floor(n) used")),b>i){const d=b;b=i,i=d,R.e.Warn("n > m therefore m and n swapped")}const Q=new Wd;Q.build(i,b);const P=Dd.BuildGeodesicData(Q),J=P.toGoldbergPolyhedronData(),U=new id(d,A);t.sideOrientation=N.d._GetDefaultSideOrientation(t.sideOrientation),U._originalBuilderSideOrientation=t.sideOrientation;(function(d,t){const A=d.size,N=d.sizeX||A||1,p=d.sizeY||A||1,W=d.sizeZ||A||1,a=0===d.sideOrientation?0:d.sideOrientation||B.e.DEFAULTSIDE,D=[],i=[],k=[],b=[];let Q=1/0,P=-1/0,J=1/0,U=-1/0;for(let w=0;w<t.vertex.length;w++)Q=Math.min(Q,t.vertex[w][0]*N),P=Math.max(P,t.vertex[w][0]*N),J=Math.min(J,t.vertex[w][1]*p),U=Math.max(U,t.vertex[w][1]*p);let T=0;for(let B=0;B<t.face.length;B++){const d=t.face[B],A=w.l.Lg(t.vertex[d[0]]),a=w.l.Lg(t.vertex[d[2]]),F=w.l.Lg(t.vertex[d[1]]),q=a.Uc(A),H=F.Uc(A),f=w.l.Cross(H,q).normalize();for(let w=0;w<d.length;w++){k.push(f.x,f.y,f.z);const A=t.vertex[d[w]];D.push(A[0]*N,A[1]*p,A[2]*W);const B=(A[1]*p-J)/(U-J);b.push((A[0]*N-Q)/(P-Q),X.e?1-B:B)}for(let t=0;t<d.length-2;t++)i.push(T,T+t+2,T+t+1);T+=d.length}B.e._ComputeSides(a,D,i,k,b);const F=new B.e;return F.xa=D,F.indices=i,F.ya=k,F.Aa=b,F})(t,J).Ca(U,t.updatable),U.goldbergData.nbSharedFaces=P.sharedNodes,U.goldbergData.nbUnsharedFaces=P.poleNodes,U.goldbergData.adjacentFaces=P.adjacentFaces,U.goldbergData.nbFaces=U.goldbergData.nbSharedFaces+U.goldbergData.nbUnsharedFaces,U.goldbergData.nbFacesAtPole=(U.goldbergData.nbUnsharedFaces-12)/12;for(let N=0;N<P.vertex.length;N++)U.goldbergData.faceCenters.push(w.l.Lg(P.vertex[N])),U.goldbergData.faceCenters[N].x*=W,U.goldbergData.faceCenters[N].y*=a,U.goldbergData.faceCenters[N].z*=D,U.goldbergData.faceColors.push(new k.i(1,1,1,1));for(let N=0;N<J.face.length;N++){const d=J.face[N],t=w.l.Lg(J.vertex[d[0]]),A=w.l.Lg(J.vertex[d[2]]),p=w.l.Lg(J.vertex[d[1]]),B=A.Uc(t),X=p.Uc(t),W=w.l.Cross(X,B).normalize(),a=w.l.Cross(X,W).normalize();U.goldbergData.faceXaxis.push(X.normalize()),U.goldbergData.faceYaxis.push(W),U.goldbergData.faceZaxis.push(a)}return U},CreateDecal:Nd,CreateCapsule:Bd,CreateText:function(d,t,A){let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},B=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const W=function(d,t,A,w){const N=Array.from(d),p=t/w.resolution,B=(w.boundingBox.yMax-w.boundingBox.yMin+w.underlineThickness)*p,X=[];let W=0,a=0;for(let D=0;D<N.length;D++){const d=N[D];if("\n"===d)W=0,a-=B;else{const t=Qd(d,p,W,a,A,w);t&&(W+=t.offsetX,X.push(t.shapePath))}}return X}(t,p.size||50,p.resolution||8,A),a=[];let D=0;for(const Q of W){if(!Q.paths.length)continue;const t=Q.holes.slice();for(const A of Q.paths){var i,k;const W=[],b=[],Q=A.getPoints();for(const d of Q)b.push(new w.l(d.x,0,d.y));const P=t.slice();for(const d of P){const N=d.getPoints();let p=!1;for(const d of N)if(A.isPointInside(d)){p=!0;break}if(!p)continue;const B=[];for(const d of N)B.push(new w.l(d.x,0,d.y));W.push(B),t.splice(t.indexOf(d),1)}if(!W.length&&t.length)for(const d of t){const t=d.getPoints(),A=[];for(const d of t)A.push(new w.l(d.x,0,d.y));W.push(A)}const J=s(d,{shape:b,holes:W.length?W:void 0,depth:p.depth||1,faceUV:p.faceUV||(null===(i=p.perLetterFaceUV)||void 0===i?void 0:i.call(p,D)),faceColors:p.faceColors||(null===(k=p.perLetterFaceColors)||void 0===k?void 0:k.call(p,D)),sideOrientation:N.d._GetDefaultSideOrientation(p.sideOrientation||N.d.DOUBLESIDE)},B,X);a.push(J),D++}}const b=N.d.MergeMeshes(a,!0,!0);if(b){const t=b.getBoundingInfo().boundingBox;b.position.x+=-(t.minimumWorld.x+t.maximumWorld.x)/2,b.position.y+=-(t.minimumWorld.y+t.maximumWorld.y)/2,b.position.z+=-(t.minimumWorld.z+t.maximumWorld.z)/2+t.extendSize.z,b.name=d;const A=new kd.e("pivot",B);A.rotation.x=-Math.PI/2,b.parent=A,b.bakeCurrentTransformIntoVertices(),b.parent=null,A.dispose()}return b}}},11205:(d,t,A)=>{"use strict";A.d(t,{c:()=>W});var w=A(11120),N=A(11214),p=A(11221),B=A(11232),X=A(11239);class W{get materialDefines(){var d;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(d=this._getDrawWrapper())||void 0===d?void 0:d.defines}set materialDefines(d){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=d}_getDrawWrapper(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d=d??this._engine.currentRenderPassId;let A=this._drawWrappers[d];return!A&&t&&(this._drawWrappers[d]=A=new X.b(this.Vk.va().getEngine())),A}_removeDrawWrapper(d){var t;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(t=this._drawWrappers[d])||void 0===t||t.dispose());this._drawWrappers[d]=void 0}get effect(){var d;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(d=this._getDrawWrapper())||void 0===d?void 0:d.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(d){this._mainDrawWrapperOverride=d}setEffect(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2?arguments[2]:void 0,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const N=this._drawWrapper;N.setEffect(d,t,w),void 0!==A&&(N.materialContext=A),d||(N.defines=null,N.materialContext=void 0)}resetDrawCache(d){if(this._drawWrappers){if(void 0!==d)return void this._removeDrawWrapper(d);for(const d of this._drawWrappers)null===d||void 0===d||d.dispose()}this._drawWrappers=[]}static AddToMesh(d,t,A,w,N,p,B){return new W(d,t,A,w,N,p,B,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(d,t,A,w,N,p,B){let X=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],W=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=d,this.verticesStart=t,this.verticesCount=A,this.indexStart=w,this.indexCount=N,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this.Vk=p,this._renderingMesh=B||p,W&&p.If.push(this),this._engine=this.Vk.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=p.If.length-1,X&&(this.refreshBoundingInfo(),p.Nj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this.Vk.getTotalVertices()&&0===this.indexStart&&this.indexCount===this.Vk.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this.Vk.hasThinInstances?this.Vk.getBoundingInfo():this._boundingInfo}setBoundingInfo(d){return this._boundingInfo=d,this}getMesh(){return this.Vk}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this.Vk._internalAbstractMeshDataInfo._actAsRegularMesh?this.Vk:null}getEffectiveMesh(){const d=this.Vk._internalAbstractMeshDataInfo._actAsRegularMesh?this.Vk:null;return d||this._renderingMesh}Ha(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!t)return d?this.Vk.va().defaultMaterial:null;if(this._isMultiMaterial(t)){const d=t.getSubMaterial(this.materialIndex);return this._currentMaterial!==d&&(this._currentMaterial=d,this.resetDrawCache()),d}return t}_isMultiMaterial(d){return void 0!==d.getSubMaterial}refreshBoundingInfo(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.Aj)return this;if(d||(d=this._renderingMesh.getVerticesData(w.f.PositionKind)),!d)return this._boundingInfo=this.Vk.getBoundingInfo(),this;const t=this._renderingMesh.xf();let A;if(0===this.indexStart&&this.indexCount===t.length){const d=this._renderingMesh.getBoundingInfo();A={minimum:d.minimum.clone(),maximum:d.maximum.clone()}}else A=(0,B.e)(d,t,this.indexStart,this.indexCount,this._renderingMesh.Aj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(A.minimum,A.maximum):this._boundingInfo=new p.b(A.minimum,A.maximum),this}_checkCollision(d){return this.getBoundingInfo()._checkCollision(d)}updateBoundingInfo(d){let t=this.getBoundingInfo();return t||(this.refreshBoundingInfo(),t=this.getBoundingInfo()),t&&t.update(d),this}isInFrustum(d){const t=this.getBoundingInfo();return!!t&&t.isInFrustum(d,this.Vk.Bi)}isCompletelyInFrustum(d){const t=this.getBoundingInfo();return!!t&&t.isCompletelyInFrustum(d)}render(d){return this._renderingMesh.render(this,d,this.Vk._internalAbstractMeshDataInfo._actAsRegularMesh?this.Vk:void 0),this}_getLinesIndexBuffer(d,t){if(!this._linesIndexBuffer){const A=[];for(let t=this.indexStart;t<this.indexStart+this.indexCount;t+=3)A.push(d[t],d[t+1],d[t+1],d[t+2],d[t+2],d[t]);this._linesIndexBuffer=t.createIndexBuffer(A),this._linesIndexCount=A.length}return this._linesIndexBuffer}canIntersects(d){const t=this.getBoundingInfo();return!!t&&d.intersectsBox(t.boundingBox)}intersects(d,t,A,w,N){const p=this.Ha();if(!p)return null;let B=3,X=!1;switch(p.fillMode){case 3:case 5:case 6:case 8:return null;case 7:B=1,X=!0}return 4===p.fillMode?A.length?this._intersectLines(d,t,A,this.Vk.intersectionThreshold,w):this._intersectUnIndexedLines(d,t,A,this.Vk.intersectionThreshold,w):!A.length&&this.Vk._unIndexed?this._intersectUnIndexedTriangles(d,t,A,w,N):this._intersectTriangles(d,t,A,B,X,w,N)}_intersectLines(d,t,A,w,p){let B=null;for(let X=this.indexStart;X<this.indexStart+this.indexCount;X+=2){const W=t[A[X]],a=t[A[X+1]],D=d.intersectionSegment(W,a,w);if(!(D<0)&&((p||!B||D<B.distance)&&(B=new N.e(null,null,D),B.faceId=X/2,p)))break}return B}_intersectUnIndexedLines(d,t,A,w,p){let B=null;for(let X=this.verticesStart;X<this.verticesStart+this.verticesCount;X+=2){const A=t[X],W=t[X+1],a=d.intersectionSegment(A,W,w);if(!(a<0)&&((p||!B||a<B.distance)&&(B=new N.e(null,null,a),B.faceId=X/2,p)))break}return B}_intersectTriangles(d,t,A,w,N,p,B){let X=null,W=-1;for(let a=this.indexStart;a<this.indexStart+this.indexCount-(3-w);a+=w){W++;const w=A[a],D=A[a+1],i=A[a+2];if(N&&4294967295===i){a+=2;continue}const k=t[w],b=t[D],Q=t[i];if(!k||!b||!Q)continue;if(B&&!B(k,b,Q,d,w,D,i))continue;const P=d.intersectsTriangle(k,b,Q);if(P){if(P.distance<0)continue;if((p||!X||P.distance<X.distance)&&(X=P,X.faceId=W,p))break}}return X}_intersectUnIndexedTriangles(d,t,A,w,N){let p=null;for(let B=this.verticesStart;B<this.verticesStart+this.verticesCount;B+=3){const A=t[B],X=t[B+1],W=t[B+2];if(N&&!N(A,X,W,d,-1,-1,-1))continue;const a=d.intersectsTriangle(A,X,W);if(a){if(a.distance<0)continue;if((w||!p||a.distance<p.distance)&&(p=a,p.faceId=B/3,w))break}}return p}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(d,t){const A=new W(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,d,t,!1);if(!this.IsGlobal){const d=this.getBoundingInfo();if(!d)return A;A._boundingInfo=new p.b(d.minimum,d.maximum)}return A}dispose(){this._linesIndexBuffer&&(this.Vk.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const d=this.Vk.If.indexOf(this);this.Vk.If.splice(d,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(d,t,A,w,N){let p=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],B=Number.MAX_VALUE,X=-Number.MAX_VALUE;const a=(N||w).xf();for(let W=t;W<t+A;W++){const d=a[W];d<B&&(B=d),d>X&&(X=d)}return new W(d,B,X-B+1,t,A,w,N,p)}}},12092:(d,t,A)=>{"use strict";var w=A(11309),N=A(11120),p=A(11076),B=A(10740),X=A(11221);w.d.prototype.thinInstanceAdd=function(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return B.e.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(d)?d.length:1);const A=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(d))for(let w=0;w<d.length;++w)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,d[w],w===d.length-1&&t);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,d,t);return A},w.d.prototype.thinInstanceAddSelf=function(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(p.c.IdentityReadOnly,d)},w.d.prototype.thinInstanceRegisterAttribute=function(d,t){d===N.f.ColorKind&&(d=N.f.ColorInstanceKind),this.removeVerticesData(d),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[d]=t,this._userThinInstanceBuffersStorage.sizes[d]=t*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[d]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[d]),this._userThinInstanceBuffersStorage.vertexBuffers[d]=new N.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[d],d,!0,!1,t,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[d])},w.d.prototype.thinInstanceSetMatrixAt=function(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||d>=this._thinInstanceDataStorage.instancesCount)return!1;const w=this._thinInstanceDataStorage.matrixData;return t.copyToArray(w,16*d),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[d]=t),A&&(this.Qj("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},w.d.prototype.thinInstanceSetAttributeAt=function(d,t,A){let w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return d===N.f.ColorKind&&(d=N.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[d]||t>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(d,0),this._userThinInstanceBuffersStorage.data[d].set(A,t*this._userThinInstanceBuffersStorage.strides[d]),w&&this.Qj(d),!0)},Object.defineProperty(w.d.prototype,"Lj",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(d){var t;const A=this._thinInstanceDataStorage.matrixData??(null===(t=this.source)||void 0===t?void 0:t._thinInstanceDataStorage.matrixData);d<=(A?A.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=d)},enumerable:!0,configurable:!0}),w.d.prototype._thinInstanceCreateMatrixBuffer=function(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const w=new N.d(this.getEngine(),t,!A,16,!1,!0);for(let N=0;N<4;N++)this.setVerticesBuffer(w.createVertexBuffer(d+N,4*N,4));return w},w.d.prototype.Rj=function(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var p;if(A=A||16,"matrix"===d)null===(p=this._thinInstanceDataStorage.matrixBuffer)||void 0===p||p.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=t?t.length:32*A,this._thinInstanceDataStorage.matrixData=t,this._thinInstanceDataStorage.worldMatrices=null,null!==t?(this._thinInstanceDataStorage.instancesCount=t.length/A,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",t,w),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===d){var B;null===(B=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===B||B.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=t,null!==t&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",t,w))}else{var X;if(d===N.f.ColorKind&&(d=N.f.ColorInstanceKind),null===t)null!==(X=this._userThinInstanceBuffersStorage)&&void 0!==X&&X.data[d]&&(this.removeVerticesData(d),delete this._userThinInstanceBuffersStorage.data[d],delete this._userThinInstanceBuffersStorage.strides[d],delete this._userThinInstanceBuffersStorage.sizes[d],delete this._userThinInstanceBuffersStorage.vertexBuffers[d]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[d]=t,this._userThinInstanceBuffersStorage.strides[d]=A,this._userThinInstanceBuffersStorage.sizes[d]=t.length,this._userThinInstanceBuffersStorage.vertexBuffers[d]=new N.f(this.getEngine(),t,d,!w,!1,A,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[d])}},w.d.prototype.Qj=function(d){var t;if("matrix"===d)this.Kj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(d),null===(t=this._thinInstanceDataStorage.matrixBuffer)||void 0===t||t.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===d){var A;this.Kj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(d),null===(A=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===A||A.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var w;d===N.f.ColorKind&&(d=N.f.ColorInstanceKind),null!==(w=this._userThinInstanceBuffersStorage)&&void 0!==w&&w.vertexBuffers[d]&&(this.Kj&&!this._userThinInstanceBuffersStorage.vertexBuffers[d].isUpdatable()&&this._thinInstanceRecreateBuffer(d),this._userThinInstanceBuffersStorage.vertexBuffers[d].updateDirectly(this._userThinInstanceBuffersStorage.data[d],0))}},w.d.prototype.thinInstancePartialBufferUpdate=function(d,t,A){var w;"matrix"===d?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(t,A):(d===N.f.ColorKind&&(d=N.f.ColorInstanceKind),null!==(w=this._userThinInstanceBuffersStorage)&&void 0!==w&&w.vertexBuffers[d]&&this._userThinInstanceBuffersStorage.vertexBuffers[d].updateDirectly(t,A))},w.d.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const d=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let t=0;t<this._thinInstanceDataStorage.instancesCount;++t)this._thinInstanceDataStorage.worldMatrices[t]=p.c.Lg(d,16*t)}return this._thinInstanceDataStorage.worldMatrices},w.d.prototype.thinInstanceRefreshBoundingInfo=function(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const w=this._thinInstanceDataStorage.boundingVectors;if(d||!this.rawBoundingInfo){w.length=0,this.refreshBoundingInfo(t,A);const d=this.getBoundingInfo();this.rawBoundingInfo=new X.b(d.minimum,d.maximum)}const N=this.getBoundingInfo(),B=this._thinInstanceDataStorage.matrixData;if(0===w.length)for(let p=0;p<N.boundingBox.vectors.length;++p)w.push(N.boundingBox.vectors[p].clone());p.h.gb[0].Dj(Number.POSITIVE_INFINITY),p.h.gb[1].Dj(Number.NEGATIVE_INFINITY);for(let X=0;X<this._thinInstanceDataStorage.instancesCount;++X){p.c.FromArrayToRef(B,16*X,p.h.Matrix[0]);for(let d=0;d<w.length;++d)p.l.TransformCoordinatesToRef(w[d],p.h.Matrix[0],p.h.gb[2]),p.h.gb[0].minimizeInPlace(p.h.gb[2]),p.h.gb[1].maximizeInPlace(p.h.gb[2])}N.reConstruct(p.h.gb[0],p.h.gb[1]),this.Ea()},w.d.prototype._thinInstanceRecreateBuffer=function(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var A;if("matrix"===d)null===(A=this._thinInstanceDataStorage.matrixBuffer)||void 0===A||A.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,t);else if("previousMatrix"===d){var w;if(this._scene.needsPreviousWorldMatrices)null===(w=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===w||w.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,t)}else{var p;d===N.f.ColorKind&&(d=N.f.ColorInstanceKind),null===(p=this._userThinInstanceBuffersStorage.vertexBuffers[d])||void 0===p||p.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[d]=new N.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[d],d,!t,!1,this._userThinInstanceBuffersStorage.strides[d],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[d])}},w.d.prototype._thinInstanceUpdateBufferSize=function(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;d===N.f.ColorKind&&(d=N.f.ColorInstanceKind);const A="matrix"===d;if(!A&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[d]))return;const w=A?16:this._userThinInstanceBuffersStorage.strides[d],p=A?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[d];let B=A?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[d];const X=(this._thinInstanceDataStorage.instancesCount+t)*w;let W=p;for(;W<X;)W*=2;if(!B||p!=W){if(B){const d=new Float32Array(W);d.set(B,0),B=d}else B=new Float32Array(W);var a,D,i;if(A){if(null===(a=this._thinInstanceDataStorage.matrixBuffer)||void 0===a||a.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",B,!1),this._thinInstanceDataStorage.matrixData=B,this._thinInstanceDataStorage.matrixBufferSize=W,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(D=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===D||D.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",B,!1)}else null===(i=this._userThinInstanceBuffersStorage.vertexBuffers[d])||void 0===i||i.dispose(),this._userThinInstanceBuffersStorage.data[d]=B,this._userThinInstanceBuffersStorage.sizes[d]=W,this._userThinInstanceBuffersStorage.vertexBuffers[d]=new N.f(this.getEngine(),B,d,!0,!1,w,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[d])}},w.d.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},w.d.prototype._disposeThinInstanceSpecificData=function(){var d;null!==(d=this._thinInstanceDataStorage)&&void 0!==d&&d.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11353:(d,t,A)=>{"use strict";A.d(t,{e:()=>i});var w=A(11041),N=A(11047),p=A(11097),B=A(10730),X=A(11076),W=A(11326),a=A(10885);const D=X.c.Compose(X.l.One(),X.f.FromEulerAngles(0,Math.PI,0),X.l.Zero());class i extends W.d{get billboardMode(){return this._billboardMode}set billboardMode(d){this._billboardMode!==d&&(this._billboardMode=d,this._cache.useBillboardPosition=0!==(this._billboardMode&i.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(d){d!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=d,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==i.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(d){this._infiniteDistance!==d&&(this._infiniteDistance=d)}constructor(d){let t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(d,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new X.l(0,0,1),this._up=new X.l(0,1,0),this._right=new X.l(1,0,0),this._position=X.l.Zero(),this._rotation=X.l.Zero(),this._rotationQuaternion=null,this._scaling=X.l.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=i.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.Pj=X.c.Zero(),this._usePivotMatrix=!1,this._absolutePosition=X.l.Zero(),this._absoluteScaling=X.l.Zero(),this._absoluteRotationQuaternion=X.f.Identity(),this._pivotMatrix=X.c.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new B.b,this._nonUniformScaling=!1,t&&this.va().addTransformNode(this)}getClassName(){return"tb"}get position(){return this._position}set position(d){this._position=d,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(d){this._rotation=d,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Gf(){return this._scaling}set Gf(d){this._scaling=d,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(d){this._rotationQuaternion=d,d&&this._rotation.Dj(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return X.l.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return X.l.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return X.l.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(d){return this._poseMatrix?(this._poseMatrix.p(d),this):(this._poseMatrix=d.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=X.c.Identity()),this._poseMatrix}_isSynchronized(){const d=this._cache;return this._billboardMode===d.billboardMode&&this._billboardMode===i.BILLBOARDMODE_NONE&&(!d.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const d=this._cache;d.localMatrixUpdated=!1,d.billboardMode=-1,d.infiniteDistance=!1,d.useBillboardPosition=!1,d.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(d){return this.setPivotMatrix(d,!1)}setPivotMatrix(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(d),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=t,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=X.c.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;const w=this.clone("Clone of "+(this.name||this.id),d||this.parent,!0);w&&A&&A(this,w);for(const N of this.getChildTransformNodes(!0))N.instantiateHierarchy(w,t,A);return w}Gh(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return d?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Dj(0),this._rotationQuaternion=this._rotationQuaternion||X.f.Identity(),d.decompose(this._scaling,this._rotationQuaternion,this._position),this.Nj(!0)):(this._worldMatrix=d,this._absolutePosition.wf(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.Nj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.Nj(!0),this}get mj(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.Nj(),this._absolutePosition}setAbsolutePosition(d){if(!d)return this;let t,A,w;if(void 0===d.x){if(arguments.length<3)return this;t=arguments[0],A=arguments[1],w=arguments[2]}else t=d.x,A=d.y,w=d.z;if(this.parent){const d=X.h.Matrix[0];this.parent.getWorldMatrix().invertToRef(d),X.l.TransformCoordinatesFromFloatsToRef(t,A,w,d,this.position)}else this.position.x=t,this.position.y=A,this.position.z=w;return this._absolutePosition.p(d),this}setPositionWithLocalVector(d){return this.Nj(),this.position=X.l.TransformNormal(d,this.Pj),this}getPositionExpressedInLocalSpace(){this.Nj();const d=X.h.Matrix[0];return this.Pj.invertToRef(d),X.l.TransformNormal(this.position,d)}locallyTranslate(d){return this.Nj(!0),this.position=X.l.TransformCoordinates(d,this.Pj),this}lookAt(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const p=i._LookAtVectorCache,B=0===N?this.position:this.getAbsolutePosition();if(d.subtractToRef(B,p),this.setDirection(p,t,A,w),1===N&&this.parent)if(this.rotationQuaternion){const d=X.h.Matrix[0];this.rotationQuaternion.toRotationMatrix(d);const t=X.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(t),t.invert(),d.multiplyToRef(t,d),this.rotationQuaternion.fromRotationMatrix(d)}else{const d=X.h.Quaternion[0];X.f.FromEulerVectorToRef(this.rotation,d);const t=X.h.Matrix[0];d.toRotationMatrix(t);const A=X.h.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(A),A.invert(),t.multiplyToRef(A,t),d.fromRotationMatrix(t),d.toEulerAnglesToRef(this.rotation)}return this}me(d){const t=X.l.Zero();return this.getDirectionToRef(d,t),t}getDirectionToRef(d,t){return X.l.TransformNormalToRef(d,this.getWorldMatrix(),t),this}setDirection(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const N=-Math.atan2(d.z,d.x)+Math.PI/2,p=Math.sqrt(d.x*d.x+d.z*d.z),B=-Math.atan2(d.y,p);return this.rotationQuaternion?X.f.RotationYawPitchRollToRef(N+t,B+A,w,this.rotationQuaternion):(this.rotation.x=B+A,this.rotation.y=N+t,this.rotation.z=w),this}setPivotPoint(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.Nj(!0);const A=this.getWorldMatrix();if(1==t){const t=X.h.Matrix[0];A.invertToRef(t),d=X.l.TransformCoordinates(d,t)}return this.setPivotMatrix(X.c.Translation(-d.x,-d.y,-d.z),!0)}getPivotPoint(){const d=X.l.Zero();return this.getPivotPointToRef(d),d}getPivotPointToRef(d){return d.x=-this._pivotMatrix.m[12],d.y=-this._pivotMatrix.m[13],d.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const d=X.l.Zero();return this.getAbsolutePivotPointToRef(d),d}getAbsolutePivotPointToRef(d){return this.getPivotPointToRef(d),X.l.TransformCoordinatesToRef(d,this.getWorldMatrix(),d),this}Cg(d){if(this._isDirty)return this;if(this._children)for(const t of this._children)t.Cg(d);return super.Cg(d)}setParent(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!d&&!this.parent)return this;const w=X.h.Quaternion[0],N=X.h.gb[0],p=X.h.gb[1],B=X.h.Matrix[1];X.c.IdentityToRef(B);const W=X.h.Matrix[0];this.Nj(!0);let a=this.rotationQuaternion;return a||(a=i._TmpRotation,X.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,a)),X.c.ComposeToRef(this.Gf,a,this.position,W),this.parent&&W.multiplyToRef(this.parent.Nj(!0),W),d&&(d.Nj(!0).invertToRef(B),W.multiplyToRef(B,W)),W.decompose(p,w,N,t?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(w):w.toEulerAnglesToRef(this.rotation),this.Gf.p(p),this.position.p(N),this.parent=d,A&&this.setPivotMatrix(X.c.Identity()),this}addChild(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return d.setParent(this,t),this}removeChild(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return d.setParent(null,t),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(d){return this._nonUniformScaling!==d&&(this._nonUniformScaling=d,!0)}attachToBone(d,t){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=t,this.parent=d,d.getSkeleton().prepare(!0),d.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=d?this._currentParentWhenAttachingToBone:null,this):(d&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(d,t,A){let w;if(d.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Dj(0)),A&&0!==A){if(this.parent){const A=this.parent.getWorldMatrix(),w=X.h.Matrix[0];A.invertToRef(w),d=X.l.TransformNormal(d,w),A.determinant()<0&&(t*=-1)}w=X.f.RotationAxisToRef(d,t,i._RotationAxisCache),w.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else w=X.f.RotationAxisToRef(d,t,i._RotationAxisCache),this.rotationQuaternion.multiplyToRef(w,this.rotationQuaternion);return this}rotateAround(d,t,A){t.normalize(),this.rotationQuaternion||(this.rotationQuaternion=X.f.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Dj(0));const w=X.h.gb[0],N=X.h.gb[1],p=X.h.gb[2],B=X.h.Quaternion[0],W=X.h.Matrix[0],a=X.h.Matrix[1],D=X.h.Matrix[2],i=X.h.Matrix[3];return d.subtractToRef(this.position,w),X.c.TranslationToRef(w.x,w.y,w.z,W),X.c.TranslationToRef(-w.x,-w.y,-w.z,a),X.c.RotationAxisToRef(t,A,D),a.multiplyToRef(D,i),i.multiplyToRef(W,i),i.decompose(N,B,p),this.position.addInPlace(p),B.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(d,t,A){const w=d.scale(t);if(A&&0!==A)this.setAbsolutePosition(this.getAbsolutePosition().add(w));else{const d=this.getPositionExpressedInLocalSpace().add(w);this.setPositionWithLocalVector(d)}return this}addRotation(d,t,A){let w;this.rotationQuaternion?w=this.rotationQuaternion:(w=X.h.Quaternion[1],X.f.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,w));const N=X.h.Quaternion[0];return X.f.RotationYawPitchRollToRef(t,d,A,N),w.multiplyInPlace(N),this.rotationQuaternion||w.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==i.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}Nj(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const A=this.va().getRenderId();if(!this._isDirty&&!d&&(this._currentRenderId===A||this.isSynchronized()))return this._currentRenderId=A,this._worldMatrix;t=t||this.va().activeCamera,this._updateCache();const w=this._cache;w.pivotMatrixUpdated=!1,w.billboardMode=this.billboardMode,w.infiniteDistance=this.infiniteDistance,w.parent=this._parentNode,this._currentRenderId=A,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const N=this._getEffectiveParent(),p=i._TmpScaling;let B,W=this._position;if(this._infiniteDistance&&!this.parent&&t){const d=t.getWorldMatrix(),A=new X.l(d.m[12],d.m[13],d.m[14]);W=i._TmpTranslation,W.wf(this._position.x+A.x,this._position.y+A.y,this._position.z+A.z)}if(p.wf(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,B=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(X.f.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.wf(0,0,0))}}else B=i._TmpRotation,X.f.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,B);if(this._usePivotMatrix){const d=X.h.Matrix[1];X.c.ScalingToRef(p.x,p.y,p.z,d);const t=X.h.Matrix[0];B.toRotationMatrix(t),this._pivotMatrix.multiplyToRef(d,X.h.Matrix[4]),X.h.Matrix[4].multiplyToRef(t,this.Pj),this._postMultiplyPivotMatrix&&this.Pj.multiplyToRef(this._pivotMatrixInverse,this.Pj),this.Pj.addTranslationFromFloats(W.x,W.y,W.z)}else X.c.ComposeToRef(p,B,W,this.Pj);if(N&&N.getWorldMatrix){if(d&&N.Nj(d),w.useBillboardPath){if(this._transformToBoneReferal){const d=this.parent;d.getSkeleton().prepare(),d.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),X.h.Matrix[7])}else X.h.Matrix[7].p(N.getWorldMatrix());const d=X.h.gb[5],t=X.h.gb[6],A=X.h.Quaternion[0];X.h.Matrix[7].decompose(t,A,d),X.c.ScalingToRef(t.x,t.y,t.z,X.h.Matrix[7]),X.h.Matrix[7].setTranslation(d),i.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(A,d),this.Pj.setTranslation(d)),this.Pj.multiplyToRef(X.h.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const d=this.parent;d.getSkeleton().prepare(),this.Pj.multiplyToRef(d.getFinalMatrix(),X.h.Matrix[6]),X.h.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.Pj.multiplyToRef(N.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.Pj);if(w.useBillboardPath&&t&&this.billboardMode&&!w.useBillboardPosition){const d=X.h.gb[0];if(this._worldMatrix.getTranslationToRef(d),X.h.Matrix[1].p(t.getViewMatrix()),this._scene.useRightHandedSystem&&X.h.Matrix[1].multiplyToRef(D,X.h.Matrix[1]),X.h.Matrix[1].setTranslationFromFloats(0,0,0),X.h.Matrix[1].invertToRef(X.h.Matrix[0]),(this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL){X.h.Matrix[0].decompose(void 0,X.h.Quaternion[0],void 0);const d=X.h.gb[1];X.h.Quaternion[0].toEulerAnglesToRef(d),(this.billboardMode&i.BILLBOARDMODE_X)!==i.BILLBOARDMODE_X&&(d.x=0),(this.billboardMode&i.BILLBOARDMODE_Y)!==i.BILLBOARDMODE_Y&&(d.y=0),(this.billboardMode&i.BILLBOARDMODE_Z)!==i.BILLBOARDMODE_Z&&(d.z=0),X.c.RotationYawPitchRollToRef(d.y,d.x,d.z,X.h.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(X.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(X.h.gb[0])}else if(w.useBillboardPath&&t&&w.useBillboardPosition){const d=X.h.gb[0];this._worldMatrix.getTranslationToRef(d);const A=t.globalPosition;this._worldMatrix.invertToRef(X.h.Matrix[1]);const w=X.h.gb[1];X.l.TransformCoordinatesToRef(A,X.h.Matrix[1],w),w.normalize();const N=-Math.atan2(w.z,w.x)+Math.PI/2,p=Math.sqrt(w.x*w.x+w.z*w.z),B=-Math.atan2(w.y,p);if(X.f.RotationYawPitchRollToRef(N,B,0,X.h.Quaternion[0]),(this.billboardMode&i.BILLBOARDMODE_ALL)!==i.BILLBOARDMODE_ALL){const d=X.h.gb[1];X.h.Quaternion[0].toEulerAnglesToRef(d),(this.billboardMode&i.BILLBOARDMODE_X)!==i.BILLBOARDMODE_X&&(d.x=0),(this.billboardMode&i.BILLBOARDMODE_Y)!==i.BILLBOARDMODE_Y&&(d.y=0),(this.billboardMode&i.BILLBOARDMODE_Z)!==i.BILLBOARDMODE_Z&&(d.z=0),X.c.RotationYawPitchRollToRef(d.y,d.x,d.z,X.h.Matrix[0])}else X.c.FromQuaternionToRef(X.h.Quaternion[0],X.h.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(X.h.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(X.h.gb[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):N&&N._nonUniformScaling?this._updateNonUniformScalingState(N._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.wf(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=X.c.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.Nj(),d){const d=this.getChildren();for(let t=0;t<d.length;++t){const A=d[t];if(A){A.Nj();const d=X.h.Matrix[0];A.Pj.multiplyToRef(this.Pj,d);const t=X.h.Quaternion[0];d.decompose(A.Gf,t,A.position),A.rotationQuaternion?A.rotationQuaternion.p(t):t.toEulerAnglesToRef(A.rotation)}}}this.Gf.wf(1,1,1),this.position.wf(0,0,0),this.rotation.wf(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=X.f.Identity()),this._worldMatrix=X.c.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(d){return this.onAfterWorldMatrixUpdateObservable.add(d),this}unregisterAfterWorldMatrixUpdate(d){return this.onAfterWorldMatrixUpdateObservable.removeCallback(d),this}getPositionInCameraSpace(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return d||(d=this.va().activeCamera),X.l.TransformCoordinates(this.getAbsolutePosition(),d.getViewMatrix())}getDistanceToCamera(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return d||(d=this.va().activeCamera),this.getAbsolutePosition().Uc(d.globalPosition).length()}clone(d,t,A){const w=p.d.Clone((()=>new i(d,this.va())),this);if(w.name=d,w.id=d,t&&(w.parent=t),!A){const t=this.getDescendants(!0);for(let A=0;A<t.length;A++){const N=t[A];N.clone&&N.clone(d+"."+N.name,w)}}return w}serialize(d){const t=p.d.Serialize(this,d);return t.type=this.getClassName(),t.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(t),t.localMatrix=this.getPivotMatrix().gj(),t.isEnabled=this.isEnabled(),p.d.AppendSerializedAnimations(this,t),t.ranges=this.serializeAnimationRanges(),t}static Parse(d,t,A){const w=p.d.Parse((()=>new i(d.name,t)),d,t,A);if(d.localMatrix?w.setPreTransformMatrix(X.c.Lg(d.localMatrix)):d.pivotMatrix&&w.setPivotMatrix(X.c.Lg(d.pivotMatrix)),w.Mf(d.isEnabled),w._waitingParsedUniqueId=d.uniqueId,void 0!==d.parentId&&(w._waitingParentId=d.parentId),void 0!==d.parentInstanceIndex&&(w._waitingParentInstanceIndex=d.parentInstanceIndex),d.animations){for(let t=0;t<d.animations.length;t++){const A=d.animations[t],N=(0,a.d)("BABYLON.Animation");N&&w.animations.push(N.Parse(A))}W.d.ParseAnimationRanges(w,d,t)}return d.autoAnimate&&t.beginAnimation(w,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),w}getChildTransformNodes(d,t){const A=[];return this._getDescendants(A,d,(d=>(!t||t(d))&&d instanceof i)),A}dispose(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const d=this._parentContainer.transformNodes.indexOf(this);d>-1&&this._parentContainer.transformNodes.splice(d,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),d){const d=this.getChildTransformNodes(!0);for(const t of d)t.parent=null,t.Nj(!0)}super.dispose(d,t)}normalizeToUnitCube(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0,w=null,N=null;t&&(this.rotationQuaternion?(N=this.rotationQuaternion.clone(),this.rotationQuaternion.wf(0,0,0,1)):this.rotation&&(w=this.rotation.clone(),this.rotation.wf(0,0,0)));const p=this.getHierarchyBoundingVectors(d,A),B=p.max.Uc(p.min),X=Math.max(B.x,B.y,B.z);if(0===X)return this;const W=1/X;return this.Gf.scaleInPlace(W),t&&(this.rotationQuaternion&&N?this.rotationQuaternion.p(N):this.rotation&&w&&this.rotation.p(w)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}i.BILLBOARDMODE_NONE=0,i.BILLBOARDMODE_X=1,i.BILLBOARDMODE_Y=2,i.BILLBOARDMODE_Z=4,i.BILLBOARDMODE_ALL=7,i.BILLBOARDMODE_USE_POSITION=128,i.BillboardUseParentOrientation=!1,i._TmpRotation=X.f.Zero(),i._TmpScaling=X.l.Zero(),i._TmpTranslation=X.l.Zero(),i._LookAtVectorCache=new X.l(0,0,0),i._RotationAxisCache=new X.f,(0,w.b)([(0,N.H)("position")],i.prototype,"_position",void 0),(0,w.b)([(0,N.H)("rotation")],i.prototype,"_rotation",void 0),(0,w.b)([(0,N.A)("rotationQuaternion")],i.prototype,"_rotationQuaternion",void 0),(0,w.b)([(0,N.H)("Gf")],i.prototype,"_scaling",void 0),(0,w.b)([(0,N.J)("billboardMode")],i.prototype,"_billboardMode",void 0),(0,w.b)([(0,N.J)()],i.prototype,"scalingDeterminant",void 0),(0,w.b)([(0,N.J)("infiniteDistance")],i.prototype,"_infiniteDistance",void 0),(0,w.b)([(0,N.J)()],i.prototype,"ignoreNonUniformScaling",void 0),(0,w.b)([(0,N.J)()],i.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11568:(d,t,A)=>{"use strict";A.d(t,{d:()=>a});var w=A(11076),N=A(11087),p=A(11541),B=A(11079),X=A(11094);class W{constructor(d,t,A,w){this.name=d,this.worldAxisForNormal=t,this.worldAxisForFileX=A,this.worldAxisForFileY=w}}class a{static ConvertCubeMapTextureToSphericalPolynomial(d){var t;if(!d.isCube)return null;null===(t=d.va())||void 0===t||t.getEngine().flushFramebuffer();const A=d.getSize().width,w=d.readPixels(0,void 0,void 0,!1),N=d.readPixels(1,void 0,void 0,!1);let p,B;d.isRenderTarget?(p=d.readPixels(3,void 0,void 0,!1),B=d.readPixels(2,void 0,void 0,!1)):(p=d.readPixels(2,void 0,void 0,!1),B=d.readPixels(3,void 0,void 0,!1));const X=d.readPixels(4,void 0,void 0,!1),W=d.readPixels(5,void 0,void 0,!1),a=d.gammaSpace;let D=0;return 1!=d.textureType&&2!=d.textureType||(D=1),new Promise((d=>{Promise.all([N,w,p,B,X,W]).then((t=>{let[w,N,p,B,X,W]=t;const i={size:A,right:N,left:w,up:p,down:B,front:X,back:W,format:5,type:D,gammaSpace:a};d(this.ConvertCubeMapToSphericalPolynomial(i))}))}))}static _AreaElement(d,t){return Math.atan2(d*t,Math.sqrt(d*d+t*t+1))}static ConvertCubeMapToSphericalPolynomial(d){const t=new p.c;let A=0;const w=2/d.size,W=w,a=.5*w,D=a-1;for(let p=0;p<6;p++){const i=this._FileFaces[p],k=d[i.name];let b=D;const Q=5===d.format?4:3;for(let p=0;p<d.size;p++){let P=D;for(let W=0;W<d.size;W++){const D=i.worldAxisForFileX.scale(P).add(i.worldAxisForFileY.scale(b)).add(i.worldAxisForNormal);D.normalize();const J=this._AreaElement(P-a,b-a)-this._AreaElement(P-a,b+a)-this._AreaElement(P+a,b-a)+this._AreaElement(P+a,b+a);let U=k[p*d.size*Q+W*Q+0],T=k[p*d.size*Q+W*Q+1],F=k[p*d.size*Q+W*Q+2];isNaN(U)&&(U=0),isNaN(T)&&(T=0),isNaN(F)&&(F=0),0===d.type&&(U/=255,T/=255,F/=255),d.gammaSpace&&(U=Math.pow((0,N.e)(U),B.k),T=Math.pow((0,N.e)(T),B.k),F=Math.pow((0,N.e)(F),B.k));const q=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const d=Math.max(U,T,F);if(d>q){const t=q/d;U*=t,T*=t,F*=t}}else U=(0,N.e)(U,0,q),T=(0,N.e)(T,0,q),F=(0,N.e)(F,0,q);const H=new X.e(U,T,F);t.addLight(D,H,J),A+=J,P+=w}b+=W}}const i=6*(4*Math.PI)/6/A;return t.scaleInPlace(i),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),p.f.FromHarmonics(t)}}a._FileFaces=[new W("right",new w.l(1,0,0),new w.l(0,0,-1),new w.l(0,-1,0)),new W("left",new w.l(-1,0,0),new w.l(0,0,1),new w.l(0,-1,0)),new W("up",new w.l(0,1,0),new w.l(1,0,0),new w.l(0,0,1)),new W("down",new w.l(0,-1,0),new w.l(1,0,0),new w.l(0,0,-1)),new W("front",new w.l(0,0,1),new w.l(1,0,0),new w.l(0,-1,0)),new W("back",new w.l(0,0,-1),new w.l(-1,0,0),new w.l(0,-1,0))],a.MAX_HDRI_VALUE=4096,a.PRESERVE_CLAMPED_COLORS=!1},11081:(d,t,A)=>{"use strict";function w(d,t){const A=[];for(let w=0;w<d;++w)A.push(t());return A}function N(d,t){return w(d,t)}A.d(t,{b:()=>w,f:()=>N,h:()=>B});const p=["push","splice","pop","shift","unshift"];function B(d,t){const A=p.map((A=>function(d,t,A){const w=d[t];if("function"!==typeof w)return null;const N=function(){const w=d.length,p=N.previous.apply(d,arguments);return A(t,w),p};return w.next=N,N.previous=w,d[t]=N,()=>{const A=N.previous;if(!A)return;const w=N.next;w?(A.next=w,w.previous=A):(A.next=void 0,d[t]=A),N.next=void 0,N.previous=void 0}}(d,A,t)));return()=>{A.forEach((d=>{null===d||void 0===d||d()}))}}},12040:(d,t,A)=>{"use strict";A.d(t,{c:()=>B});var w=A(11264),N=A(12042);let p=0;const B=d=>{if(!d.environmentBRDFTexture){const t=d.useDelayedTextureLoading;d.useDelayedTextureLoading=!1;const A=d._blockEntityCollection;d._blockEntityCollection=!1;const B=w.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+p++,d,!0,!1,w.c.BILINEAR_SAMPLINGMODE);d._blockEntityCollection=A;const X=d.getEngine().getLoadedTexturesCache(),W=X.indexOf(B.getInternalTexture());-1!==W&&X.splice(W,1),B.isRGBD=!0,B.wrapU=w.c.CLAMP_ADDRESSMODE,B.wrapV=w.c.CLAMP_ADDRESSMODE,d.environmentBRDFTexture=B,d.useDelayedTextureLoading=t,N.b.ExpandRGBDTexture(B);const a=d.getEngine().onContextRestoredObservable.add((()=>{B.isRGBD=!0;const t=d.onBeforeRenderObservable.add((()=>{B.isReady()&&(d.onBeforeRenderObservable.remove(t),N.b.ExpandRGBDTexture(B))}))}));d.hj.add((()=>{d.getEngine().onContextRestoredObservable.remove(a)}))}return d.environmentBRDFTexture}},11314:(d,t,A)=>{"use strict";function w(d,t,A){try{const w=d.next();w.done?t(w):w.value?w.value.then((()=>{w.value=void 0,t(w)}),A):t(w)}catch(w){A(w)}}function N(){let d,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(A,N,p)=>{const B=performance.now();void 0===d||B-d>t?(d=B,setTimeout((()=>{w(A,N,p)}),0)):w(A,N,p)}}function p(d,t,A,w,N){const p=()=>{let B;const X=d=>{d.done?A(d.value):void 0===B?B=!0:p()};do{B=void 0,N&&N.aborted?w(new Error("Aborted")):t(d,X,w),void 0===B&&(B=!1)}while(B)};p()}function B(d,t){let A;return p(d,w,(d=>A=d),(d=>{throw d}),t),A}function X(d,t,A){return new Promise(((w,N)=>{p(d,t,w,N,A)}))}function W(d,t){return function(){return B(d(...arguments),t)}}A.d(t,{c:()=>N,d:()=>W,g:()=>X,k:()=>B})},11560:(d,t,A)=>{"use strict";A.d(t,{d:()=>Q});var w=A(11087),N=A(10740),p=A(11568),B=A(11573);A(11607);const X=131072,W=131072;function a(d){return d.charCodeAt(0)+(d.charCodeAt(1)<<8)+(d.charCodeAt(2)<<16)+(d.charCodeAt(3)<<24)}const D=a("DXT1"),i=a("DXT3"),k=a("DXT5"),b=a("DX10");class Q{static GetDDSInfo(d){const t=new Int32Array(d.buffer,d.byteOffset,31),A=new Int32Array(d.buffer,d.byteOffset,35);let w=1;t[2]&X&&(w=Math.max(1,t[7]));const N=t[21],p=N===b?A[32]:0;let B=0;switch(N){case 113:B=2;break;case 116:B=1;break;case b:if(10===p){B=2;break}if(2===p){B=1;break}}return{width:t[4],height:t[3],mipmapCount:w,isFourCC:4===(4&t[20]),isRGB:64===(64&t[20]),isLuminance:(t[20]&W)===W,isCube:512===(512&t[28]),isCompressed:N===D||N===i||N===k,dxgiFormat:p,textureType:B}}static _GetHalfFloatAsFloatRGBAArrayBuffer(d,t,A,w,N,p){const X=new Float32Array(w),W=new Uint16Array(N,A);let a=0;for(let D=0;D<t;D++)for(let t=0;t<d;t++){const A=4*(t+D*d);X[a]=(0,B.h)(W[A]),X[a+1]=(0,B.h)(W[A+1]),X[a+2]=(0,B.h)(W[A+2]),Q.StoreLODInAlphaChannel?X[a+3]=p:X[a+3]=(0,B.h)(W[A+3]),a+=4}return X}static _GetHalfFloatRGBAArrayBuffer(d,t,A,w,N,p){if(Q.StoreLODInAlphaChannel){const X=new Uint16Array(w),W=new Uint16Array(N,A);let a=0;for(let A=0;A<t;A++)for(let t=0;t<d;t++){const w=4*(t+A*d);X[a]=W[w],X[a+1]=W[w+1],X[a+2]=W[w+2],X[a+3]=(0,B.j)(p),a+=4}return X}return new Uint16Array(N,A,w)}static _GetFloatRGBAArrayBuffer(d,t,A,w,N,p){if(Q.StoreLODInAlphaChannel){const B=new Float32Array(w),X=new Float32Array(N,A);let W=0;for(let A=0;A<t;A++)for(let t=0;t<d;t++){const w=4*(t+A*d);B[W]=X[w],B[W+1]=X[w+1],B[W+2]=X[w+2],B[W+3]=p,W+=4}return B}return new Float32Array(N,A,w)}static _GetFloatAsHalfFloatRGBAArrayBuffer(d,t,A,w,N,p){const X=new Uint16Array(w),W=new Float32Array(N,A);let a=0;for(let D=0;D<t;D++)for(let t=0;t<d;t++)X[a]=(0,B.j)(W[a]),X[a+1]=(0,B.j)(W[a+1]),X[a+2]=(0,B.j)(W[a+2]),Q.StoreLODInAlphaChannel?X[a+3]=(0,B.j)(p):X[a+3]=(0,B.j)(W[a+3]),a+=4;return X}static _GetFloatAsUIntRGBAArrayBuffer(d,t,A,N,p,B){const X=new Uint8Array(N),W=new Float32Array(p,A);let a=0;for(let D=0;D<t;D++)for(let t=0;t<d;t++){const A=4*(t+D*d);X[a]=255*(0,w.e)(W[A]),X[a+1]=255*(0,w.e)(W[A+1]),X[a+2]=255*(0,w.e)(W[A+2]),Q.StoreLODInAlphaChannel?X[a+3]=B:X[a+3]=255*(0,w.e)(W[A+3]),a+=4}return X}static _GetHalfFloatAsUIntRGBAArrayBuffer(d,t,A,N,p,X){const W=new Uint8Array(N),a=new Uint16Array(p,A);let D=0;for(let i=0;i<t;i++)for(let t=0;t<d;t++){const A=4*(t+i*d);W[D]=255*(0,w.e)((0,B.h)(a[A])),W[D+1]=255*(0,w.e)((0,B.h)(a[A+1])),W[D+2]=255*(0,w.e)((0,B.h)(a[A+2])),Q.StoreLODInAlphaChannel?W[D+3]=X:W[D+3]=255*(0,w.e)((0,B.h)(a[A+3])),D+=4}return W}static _GetRGBAArrayBuffer(d,t,A,w,N,p,B,X,W){const a=new Uint8Array(w),D=new Uint8Array(N,A);let i=0;for(let k=0;k<t;k++)for(let t=0;t<d;t++){const A=4*(t+k*d);a[i]=D[A+p],a[i+1]=D[A+B],a[i+2]=D[A+X],a[i+3]=D[A+W],i+=4}return a}static _ExtractLongWordOrder(d){return 0===d||255===d||-16777216===d?0:1+Q._ExtractLongWordOrder(d>>8)}static _GetRGBArrayBuffer(d,t,A,w,N,p,B,X){const W=new Uint8Array(w),a=new Uint8Array(N,A);let D=0;for(let i=0;i<t;i++)for(let t=0;t<d;t++){const A=3*(t+i*d);W[D]=a[A+p],W[D+1]=a[A+B],W[D+2]=a[A+X],D+=3}return W}static _GetLuminanceArrayBuffer(d,t,A,w,N){const p=new Uint8Array(w),B=new Uint8Array(N,A);let X=0;for(let W=0;W<t;W++)for(let t=0;t<d;t++){const A=t+W*d;p[X]=B[A],X++}return p}static UploadDDSLevels(d,t,A,w,B,W){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,P=arguments.length>7?arguments[7]:void 0,J=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],U=null;w.sphericalPolynomial&&(U=[]);const T=!!d.getCaps().s3tc;t.generateMipMaps=B;const F=new Int32Array(A.buffer,A.byteOffset,31);let q,H,f,v,m,j,n,R=0,Z=0,L=1;if(542327876!==F[0])return void N.e.Error("Invalid magic number in DDS header");if(!w.isFourCC&&!w.isRGB&&!w.isLuminance)return void N.e.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(w.isCompressed&&!T)return void N.e.Error("Compressed textures are not supported on this platform.");let I=F[22];v=F[1]+4;let u=!1;if(w.isFourCC)switch(q=F[21],q){case D:L=8,Z=33777;break;case i:L=16,Z=33778;break;case k:L=16,Z=33779;break;case 113:u=!0,I=64;break;case 116:u=!0,I=128;break;case b:{v+=20;let d=!1;switch(w.dxgiFormat){case 10:u=!0,I=64,d=!0;break;case 2:u=!0,I=128,d=!0;break;case 88:w.isRGB=!0,w.isFourCC=!1,I=32,d=!0}if(d)break}default:return void N.e.Error(["Unsupported FourCC code:",(V=q,String.fromCharCode(255&V,V>>8&255,V>>16&255,V>>24&255))])}var V;const h=Q._ExtractLongWordOrder(F[23]),l=Q._ExtractLongWordOrder(F[24]),y=Q._ExtractLongWordOrder(F[25]),s=Q._ExtractLongWordOrder(F[26]);u&&(Z=d._getRGBABufferInternalSizedFormat(w.textureType)),j=1,F[2]&X&&!1!==B&&(j=Math.max(1,F[7]));const Y=P||0,r=d.getCaps();for(let N=Y;N<W;N++){for(H=F[4],f=F[3],n=0;n<j;++n){if(-1===a||a===n){const p=-1===a?n:0;if(!w.isCompressed&&w.isFourCC){t.format=5,R=H*f*4;let w=null;if(d._badOS||d._badDesktopOS||!r.textureHalfFloat&&!r.textureFloat)128===I?(w=Q._GetFloatAsUIntRGBAArrayBuffer(H,f,A.byteOffset+v,R,A.buffer,p),U&&0==p&&U.push(Q._GetFloatRGBAArrayBuffer(H,f,A.byteOffset+v,R,A.buffer,p))):64===I&&(w=Q._GetHalfFloatAsUIntRGBAArrayBuffer(H,f,A.byteOffset+v,R,A.buffer,p),U&&0==p&&U.push(Q._GetHalfFloatAsFloatRGBAArrayBuffer(H,f,A.byteOffset+v,R,A.buffer,p))),t.type=0;else{const d=r.textureFloat&&(J&&r.textureFloatLinearFiltering||!J),N=r.textureHalfFloat&&(J&&r.textureHalfFloatLinearFiltering||!J),B=(128===I||64===I&&!N)&&d?1:(64===I||128===I&&!d)&&N?2:0;let X,W=null;if(128===I)switch(B){case 1:X=Q._GetFloatRGBAArrayBuffer,W=null;break;case 2:X=Q._GetFloatAsHalfFloatRGBAArrayBuffer,W=Q._GetFloatRGBAArrayBuffer;break;case 0:X=Q._GetFloatAsUIntRGBAArrayBuffer,W=Q._GetFloatRGBAArrayBuffer}else switch(B){case 1:X=Q._GetHalfFloatAsFloatRGBAArrayBuffer,W=null;break;case 2:X=Q._GetHalfFloatRGBAArrayBuffer,W=Q._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:X=Q._GetHalfFloatAsUIntRGBAArrayBuffer,W=Q._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=B,w=X(H,f,A.byteOffset+v,R,A.buffer,p),U&&0==p&&U.push(W?W(H,f,A.byteOffset+v,R,A.buffer,p):w)}w&&d._uploadDataToTextureDirectly(t,w,N,p)}else if(w.isRGB)t.type=0,24===I?(t.format=4,R=H*f*3,m=Q._GetRGBArrayBuffer(H,f,A.byteOffset+v,R,A.buffer,h,l,y),d._uploadDataToTextureDirectly(t,m,N,p)):(t.format=5,R=H*f*4,m=Q._GetRGBAArrayBuffer(H,f,A.byteOffset+v,R,A.buffer,h,l,y,s),d._uploadDataToTextureDirectly(t,m,N,p));else if(w.isLuminance){const w=d._getUnpackAlignement(),B=H;R=Math.floor((H+w-1)/w)*w*(f-1)+B,m=Q._GetLuminanceArrayBuffer(H,f,A.byteOffset+v,R,A.buffer),t.format=1,t.type=0,d._uploadDataToTextureDirectly(t,m,N,p)}else R=Math.max(4,H)/4*Math.max(4,f)/4*L,m=new Uint8Array(A.buffer,A.byteOffset+v,R),t.type=0,d._uploadCompressedDataToTextureDirectly(t,Z,H,f,m,N,p)}v+=I?H*f*(I/8):R,H*=.5,f*=.5,H=Math.max(1,H),f=Math.max(1,f)}if(void 0!==P)break}U&&U.length>0?w.sphericalPolynomial=p.d.ConvertCubeMapToSphericalPolynomial({size:F[4],right:U[0],left:U[1],up:U[2],down:U[3],front:U[4],back:U[5],format:5,type:1,gammaSpace:!1}):w.sphericalPolynomial=void 0}}Q.StoreLODInAlphaChannel=!1},11052:(d,t,A)=>{"use strict";A.d(t,{e:()=>p,i:()=>B});const w={},N={};function p(d){const t=d.getClassName();return N[t]||(N[t]={}),N[t]}function B(d){const t=d.getClassName();if(w[t])return w[t];w[t]={};const A=w[t];let p=d,B=t;for(;B;){const d=N[B];for(const N in d)A[N]=d[N];let t,w=!1;do{if(t=Object.getPrototypeOf(p),!t.getClassName){w=!0;break}if(t.getClassName()!==B)break;p=t}while(t);if(w)break;B=t.getClassName(),p=t}return A}},11047:(d,t,A)=>{"use strict";A.d(t,{A:()=>J,C:()=>X,F:()=>D,H:()=>i,J:()=>B,c:()=>p,g:()=>T,h:()=>b,i:()=>W,m:()=>Q,o:()=>a,s:()=>P,t:()=>U,x:()=>k});var w=A(11052);function N(d,t){return(A,N)=>{const p=(0,w.e)(A);p[N]||(p[N]={type:d,sourceName:t})}}function p(d){return function(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(A,w)=>{const N=t||"_"+w;Object.defineProperty(A,w,{get:function(){return this[N]},set:function(t){"function"===typeof this.equals&&this.equals(t)||this[N]!==t&&(this[N]=t,A[d].apply(this))},enumerable:!0,configurable:!0})}}(d,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function B(d){return N(0,d)}function X(d){return N(1,d)}function W(d){return N(2,d)}function a(d){return N(3,d)}function D(d){return N(4,d)}function i(d){return N(5,d)}function k(d){return N(6,d)}function b(d){return N(7,d)}function Q(d){return N(8,d)}function P(d){return N(9,d)}function J(d){return N(10,d)}function U(d){return N(12,d)}function T(d,t,A,w){const N=A.value;A.value=function(){let A=N;if("undefined"!==typeof _native&&_native[t]){const d=_native[t];A=w?function(){return w(...arguments)?d(...arguments):N(...arguments)}:d}return d[t]=A,A(...arguments)}}T.filter=function(d){return(t,A,w)=>T(t,A,w,d)}},11097:(d,t,A)=>{"use strict";A.d(t,{d:()=>a});var w=A(10761),N=A(11067),p=A(11094),B=A(11076),X=A(11052);const W=function(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const p=d();N.c&&N.c.HasTags(t)&&N.c.AddTagsTo(p,N.c.GetTags(t,!0));const B=(0,X.i)(p),W={};for(const N in B){const d=B[N],X=t[N],D=d.type;if(void 0!==X&&null!==X&&("uniqueId"!==N||a.AllowLoadingUniqueId))switch(D){case 0:case 6:case 11:p[N]=X;break;case 1:w.cloneTexturesOnlyOnce&&W[X.uniqueId]?p[N]=W[X.uniqueId]:(p[N]=A||X.isRenderTarget?X:X.clone(),W[X.uniqueId]=p[N]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:p[N]=A?X:X.clone()}}return p};class a{static AppendSerializedAnimations(d,t){if(d.animations){t.animations=[];for(let A=0;A<d.animations.length;A++){const w=d.animations[A];t.animations.push(w.serialize())}}}static Serialize(d,t){t||(t={}),N.c&&(t.tags=N.c.GetTags(d));const A=(0,X.i)(d);for(const w in A){const N=A[w],p=N.sourceName||w,B=N.type,X=d[w];if(void 0!==X&&null!==X&&("uniqueId"!==w||a.AllowLoadingUniqueId))switch(B){case 0:t[p]=X;break;case 1:case 3:case 7:case 9:t[p]=X.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:t[p]=X.gj();break;case 6:case 11:t[p]=X.id}}return t}static ParseProperties(d,t,A,w){w||(w="");const N=(0,X.i)(t);for(const X in N){const W=N[X],D=d[W.sourceName||X],i=W.type;if(void 0!==D&&null!==D&&("uniqueId"!==X||a.AllowLoadingUniqueId)){const d=t;switch(i){case 0:d[X]=D;break;case 1:A&&(d[X]=a._TextureParser(D,A,w));break;case 2:d[X]=p.e.Lg(D);break;case 3:d[X]=a._FresnelParametersParser(D);break;case 4:d[X]=B.j.Lg(D);break;case 5:d[X]=B.l.Lg(D);break;case 6:A&&(d[X]=A.getLastMeshById(D));break;case 7:d[X]=a._ColorCurvesParser(D);break;case 8:d[X]=p.i.Lg(D);break;case 9:d[X]=a._ImageProcessingConfigurationParser(D);break;case 10:d[X]=B.f.Lg(D);break;case 11:A&&(d[X]=A.getCameraById(D));break;case 12:d[X]=B.c.Lg(D)}}}}static Parse(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const p=d();return N.c&&N.c.AddTagsTo(p,t.tags),a.ParseProperties(t,p,A,w),p}static Clone(d,t){return W(d,t,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(d,t){return W(d,t,!0)}}a.AllowLoadingUniqueId=!1,a._ImageProcessingConfigurationParser=d=>{throw(0,w.b)("ImageProcessingConfiguration")},a._FresnelParametersParser=d=>{throw(0,w.b)("FresnelParameters")},a._ColorCurvesParser=d=>{throw(0,w.b)("ColorCurves")},a._TextureParser=(d,t,A)=>{throw(0,w.b)("Texture")}},10749:(d,t,A)=>{"use strict";A.d(t,{b:()=>p});var w=A(10740);const N=(d,t,A)=>d?d.getClassName&&"Mesh"===d.getClassName()?null:!d.getClassName||"SubMesh"!==d.getClassName()&&"PhysicsBody"!==d.getClassName()?d.clone?d.clone():Array.isArray(d)?d.slice():A&&"object"===typeof d?{...d}:null:d.clone(t):null;class p{static DeepCopy(d,t,A,p){let B=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const X=function(d){const t=[];do{Object.getOwnPropertyNames(d).forEach((function(d){-1===t.indexOf(d)&&t.push(d)}))}while(d=Object.getPrototypeOf(d));return t}(d);for(const a of X){if("_"===a[0]&&(!p||-1===p.indexOf(a)))continue;if(a.endsWith("Observable"))continue;if(A&&-1!==A.indexOf(a))continue;const X=d[a],D=typeof X;if("function"!==D)try{if("object"===D)if(X instanceof Uint8Array)t[a]=Uint8Array.from(X);else if(X instanceof Array){if(t[a]=[],X.length>0)if("object"==typeof X[0])for(let d=0;d<X.length;d++){const A=N(X[d],t,B);-1===t[a].indexOf(A)&&t[a].push(A)}else t[a]=X.slice(0)}else t[a]=N(X,t,B);else t[a]=X}catch(W){w.e.Warn(W.message)}}}}},10761:(d,t,A)=>{"use strict";A.d(t,{b:()=>N});const w={};function N(d){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!w[d])return w[d]=!0,`${d} needs to be imported before as it contains a side-effect required by your code.`}},10737:(d,t,A)=>{"use strict";function w(){return"undefined"!==typeof window}function N(){return"undefined"!==typeof navigator}function p(){return"undefined"!==typeof document}function B(d){let t="",A=d.firstChild;for(;A;)3===A.nodeType&&(t+=A.textContent),A=A.nextSibling;return t}A.d(t,{c:()=>B,f:()=>p,j:()=>N,l:()=>w})},12080:(d,t,A)=>{"use strict";A.r(t),A.d(t,{Dispose:()=>k,DumpData:()=>i,DumpDataAsync:()=>D,DumpFramebuffer:()=>a,DumpTools:()=>b});var w=A(11593),N=A(10727),p=A(11087),B=A(10775);let X,W=null;async function a(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",p=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0;const X=await A.readPixels(0,0,d,t);i(d,t,new Uint8Array(X.buffer),w,N,p,!0,void 0,B)}function D(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7?arguments[7]:void 0;return new Promise((W=>{i(d,t,A,(d=>W(d)),w,N,p,B,X)}))}function i(d,t,a,D){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",b=arguments.length>5?arguments[5]:void 0,Q=arguments.length>6&&void 0!==arguments[6]&&arguments[6],P=arguments.length>7&&void 0!==arguments[7]&&arguments[7],J=arguments.length>8?arguments[8]:void 0;(async function(){return W||(W=new Promise(((d,t)=>{let N,p=null;const W={hh:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(A.bind(A,11476)).then((a=>{let{ThinEngine:D}=a;try{N=new OffscreenCanvas(100,100),p=new D(N,!1,W)}catch(b){N=document.createElement("canvas"),p=new D(N,!1,W)}B.e.Instances.pop(),B.e.OnEnginesDisposedObservable.add((d=>{p&&d!==p&&!p.u&&0===B.e.Instances.length&&k()})),p.getCaps().parallelShaderCompile=void 0;const i=new w.d(p);A.e(34).then(A.bind(A,13245)).then((A=>{let{passPixelShader:B}=A;if(!p)return void t("Engine is not defined");const W=new w.g({ud:p,name:B.name,fragmentShader:B.shader,samplerNames:["textureSampler"]});X={canvas:N,ud:p,renderer:i,wrapper:W},d(X)}))})).catch(t)}))),await W})().then((A=>{if(A.ud.setSize(d,t,!0),a instanceof Float32Array){const d=new Uint8Array(a.length);let t=a.length;for(;t--;){const A=a[t];d[t]=Math.round(255*(0,p.e)(A))}a=d}const w=A.ud.createRawTexture(a,d,t,5,!1,!Q,1);A.renderer.setViewport(),A.renderer.applyEffectWrapper(A.wrapper),A.wrapper.effect._bindTexture("textureSampler",w),A.renderer.draw(),P?N.g.ToBlob(A.canvas,(d=>{const t=new FileReader;t.onload=d=>{const t=d.target.result;D&&D(t)},t.readAsArrayBuffer(d)}),i,J):N.g.EncodeScreenshotCanvasData(A.canvas,D,i,b,J),w.dispose()}))}function k(){var d;X?(X.wrapper.dispose(),X.renderer.dispose(),X.ud.dispose()):null===(d=W)||void 0===d||d.then((d=>{d.wrapper.dispose(),d.renderer.dispose(),d.ud.dispose()}));W=null,X=null}const b={DumpData:i,DumpDataAsync:D,DumpFramebuffer:a,Dispose:k};N.g.DumpData=i,N.g.DumpDataAsync=D,N.g.DumpFramebuffer=a},12076:(d,t,A)=>{"use strict";A.d(t,{e:()=>Q,g:()=>U,h:()=>q,j:()=>H});var w=A(10727),N=A(11076),p=A(11087),B=A(11541),X=A(10861),W=A(11266),a=(A(11061),A(11584)),D=A(10740);A(12042),A(12052),A(12080);const i="image/png",k=2,b=[134,22,135,150,246,214,150,54];function Q(d){const t=new DataView(d.buffer,d.byteOffset,d.byteLength);let A=0;for(let B=0;B<b.length;B++)if(t.getUint8(A++)!==b[B])return D.e.Error("Not a babylon environment map"),null;let w="",N=0;for(;N=t.getUint8(A++);)w+=String.fromCharCode(N);let p=JSON.parse(w);return p=P(p),p.mh&&(p.mh.specularDataPosition=A,p.mh.lodGenerationScale=p.mh.lodGenerationScale||.8),p}function P(d){if(d.version>k)throw new Error(`Unsupported babylon environment map version "${d.version}". Latest supported version is "${k}".`);return 2===d.version?d:d={...d,version:2,imageType:i}}function J(d,t){const A=(t=P(t)).mh;let w=Math.log2(t.width);if(w=Math.round(w)+1,A.mipmaps.length!==6*w)throw new Error(`Unsupported specular mipmaps number "${A.mipmaps.length}"`);const N=new Array(w);for(let p=0;p<w;p++){N[p]=new Array(6);for(let t=0;t<6;t++){const w=A.mipmaps[6*p+t];N[p][t]=new Uint8Array(d.buffer,d.byteOffset+A.specularDataPosition+w.position,w.length)}}return N}function U(d,t,A){const w=(A=P(A)).mh;if(!w)return Promise.resolve();d._lodGenerationScale=w.lodGenerationScale;return F(d,J(t,A),A.imageType)}function T(d,t,A,w,N,p,B,X,W,a,D){return new Promise(((i,k)=>{if(A){const A=t.createTexture(null,!0,!0,null,1,null,(d=>{k(d)}),d);null===w||void 0===w||w.onEffectCreatedObservable.addOnce((X=>{X.executeWhenCompiled((()=>{w.externalTextureSamplerBinding=!0,w.onApply=w=>{w._bindTexture("textureSampler",A),w.setFloat2("scale",1,t._features.needsInvertingBitmap&&d instanceof ImageBitmap?-1:1)},t.scenes.length&&(t.scenes[0].postProcessManager.directRender([w],a,!0,p,B),t.restoreDefaultFramebuffer(),A.dispose(),URL.revokeObjectURL(N),i())}))}))}else{if(t._uploadImageToTexture(D,d,p,B),X){const A=W[B];A&&t._uploadImageToTexture(A._texture,d,p,0)}i()}}))}async function F(d,t){let N=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i;if(!w.g.IsExponentOfTwo(d.width))throw new Error("Texture size must be a power of two");const B=(0,p.n)(d.width)+1,D=d.getEngine();let k=!1,b=!1,Q=null,P=null,J=null;const U=D.getCaps();d.format=5,d.type=0,d.generateMipMaps=!0,d._cachedAnisotropicFilteringLevel=null,D.updateTextureSamplingMode(3,d),U.textureLOD?D._features.supportRenderAndCopyToLodForFloatTextures?U.textureHalfFloatRender&&U.textureHalfFloatLinearFiltering?(k=!0,d.type=2):U.textureFloatRender&&U.textureFloatLinearFiltering&&(k=!0,d.type=1):k=!1:(k=!1,b=!0,J={});let F=0;if(k)D.isWebGPU?(F=1,await A.e(39).then(A.bind(A,13273))):await A.e(41).then(A.bind(A,13285)),Q=new a.d("rgbdDecode","rgbdDecode",null,null,1,null,3,D,!1,void 0,d.type,void 0,null,!1,void 0,F),d._isRGBD=!1,d.invertY=!1,P=D.createRenderTargetCubeTexture(d.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:d.type,format:5});else if(d._isRGBD=!0,d.invertY=!0,b){const t=3,A=d._lodGenerationScale,w=d._lodGenerationOffset;for(let N=0;N<t;N++){const p=(B-1)*A+w,a=w+(p-w)*(1-N/(t-1)),i=Math.round(Math.min(Math.max(a,0),p)),k=new X.c(D,2);k.isCube=!0,k.invertY=!0,k.generateMipMaps=!1,D.updateTextureSamplingMode(2,k);const b=new W.e(null);switch(b._isCube=!0,b._texture=k,J[i]=b,N){case 0:d._lodTextureLow=b;break;case 1:d._lodTextureMid=b;break;case 2:d._lodTextureHigh=b}}}const q=[];for(let A=0;A<t.length;A++)for(let w=0;w<6;w++){const p=t[A][w],B=new Blob([p],{type:N}),X=URL.createObjectURL(B);let W;if(D._features.forceBitmapOverHTMLImageElement)W=D.createImageBitmap(B,{premultiplyAlpha:"none"}).then((t=>T(t,D,k,Q,X,w,A,b,J,P,d)));else{const t=new Image;t.src=X,W=new Promise(((N,p)=>{t.onload=()=>{T(t,D,k,Q,X,w,A,b,J,P,d).then((()=>N())).catch((d=>{p(d)}))},t.onerror=d=>{p(d)}}))}q.push(W)}if(t.length<B){let A;const w=Math.pow(2,B-1-t.length),N=w*w*4;switch(d.type){case 0:A=new Uint8Array(N);break;case 2:A=new Uint16Array(N);break;case 1:A=new Float32Array(N)}for(let p=t.length;p<B;p++)for(let t=0;t<6;t++)D._uploadArrayBufferViewToTexture(d,A,t,p)}return Promise.all(q).then((()=>{P&&(D._releaseTexture(d),P._swapAndDie(d)),Q&&Q.dispose(),b&&(d._lodTextureHigh&&d._lodTextureHigh._texture&&(d._lodTextureHigh._texture.isReady=!0),d._lodTextureMid&&d._lodTextureMid._texture&&(d._lodTextureMid._texture.isReady=!0),d._lodTextureLow&&d._lodTextureLow._texture&&(d._lodTextureLow._texture.isReady=!0))}))}function q(d,t){const A=(t=P(t)).irradiance;if(!A)return;const w=new B.f;N.l.FromArrayToRef(A.x,0,w.x),N.l.FromArrayToRef(A.y,0,w.y),N.l.FromArrayToRef(A.z,0,w.z),N.l.FromArrayToRef(A.xx,0,w.xx),N.l.FromArrayToRef(A.yy,0,w.yy),N.l.FromArrayToRef(A.zz,0,w.zz),N.l.FromArrayToRef(A.yz,0,w.yz),N.l.FromArrayToRef(A.zx,0,w.zx),N.l.FromArrayToRef(A.xy,0,w.xy),d._sphericalPolynomial=w}function H(d,t,A,w,N){const p=F(d.getEngine().createRawCubeTexture(null,d.width,d.format,d.type,d.generateMipMaps,d.invertY,d.samplingMode,d._compression),t).then((()=>d));return d.onRebuildCallback=d=>({proxy:p,isReady:!0,isAsync:!0}),d._source=13,d._bufferViewArrayArray=t,d._lodGenerationScale=w,d._lodGenerationOffset=N,d._sphericalPolynomial=A,F(d,t).then((()=>(d.isReady=!0,d)))}},10787:(d,t,A)=>{"use strict";A.d(t,{b:()=>w,e:()=>N,h:()=>p});class w extends Error{}w._setPrototypeOf=Object.setPrototypeOf||((d,t)=>(d.__proto__=t,d));const N={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class p extends w{constructor(d,t,A){super(d),this.errorCode=t,this.innerError=A,this.name="RuntimeError",w._setPrototypeOf(this,p.prototype)}}},10779:(d,t,A)=>{"use strict";A.d(t,{b:()=>L,f:()=>F,g:()=>R,l:()=>m,i:()=>J,o:()=>f,q:()=>v,u:()=>j,y:()=>q});var w=A(10767),N=A(10737),p=A(10730);class B{}B.FilesToLoad={};var X=A(10787),W=A(10791),a=A(10798),D=A(10775),i=A(10740),k=A(10815),b=A(10807),Q=A(10824);const P=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class J extends X.h{constructor(d,t){super(d,X.e.LoadFileError),this.name="LoadFileError",X.b._setPrototypeOf(this,J.prototype),t instanceof w.b?this.request=t:this.file=t}}class U extends X.h{constructor(d,t){super(d,X.e.RequestFileError),this.request=t,this.name="RequestFileError",X.b._setPrototypeOf(this,U.prototype)}}class T extends X.h{constructor(d,t){super(d,X.e.ReadFileError),this.file=t,this.name="ReadFileError",X.b._setPrototypeOf(this,T.prototype)}}const F={DefaultRetryStrategy:class{static ExponentialBackoff(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(A,w,N)=>0!==w.status||N>=d||-1!==A.indexOf("file:")?-1:Math.pow(2,N)*t}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:d=>d,ScriptBaseUrl:"",ScriptPreprocessUrl:d=>d,CleanUrl:d=>d=d.replace(/#/gm,"%23")},q=(d,t)=>{if((!d||0!==d.indexOf("data:"))&&F.CorsBehavior)if("string"===typeof F.CorsBehavior||F.CorsBehavior instanceof String)t.crossOrigin=F.CorsBehavior;else{const A=F.CorsBehavior(d);A&&(t.crossOrigin=A)}},H={getRequiredSize:null},f=function(d,t,A,N){let p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",X=arguments.length>5?arguments[5]:void 0;const a=D.e.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===a||void 0===a||!a._features.forceBitmapOverHTMLImageElement))return A("LoadImage is only supported in web or BabylonNative environments."),null;let i,k=!1;d instanceof ArrayBuffer||ArrayBuffer.isView(d)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(i=URL.createObjectURL(new Blob([d],{type:p})),k=!0):i=`data:${p};base64,`+(0,W.k)(d):d instanceof Blob?(i=URL.createObjectURL(d),k=!0):(i=F.CleanUrl(d),i=F.PreprocessUrl(i));const b=t=>{if(A){const w=i||d.toString();A(`Error while trying to load image: ${0===w.indexOf("http")||w.length<=128?w:w.slice(0,128)+"..."}`,t)}};if(null!==a&&void 0!==a&&a._features.forceBitmapOverHTMLImageElement)return m(i,(w=>{a.createImageBitmap(new Blob([w],{type:p}),{premultiplyAlpha:"none",...X}).then((d=>{t(d),k&&URL.revokeObjectURL(i)})).catch((t=>{A&&A("Error while trying to load image: "+d,t)}))}),void 0,N||void 0,!0,((d,t)=>{b(t)})),null;const Q=new Image;if(H.getRequiredSize){const t=H.getRequiredSize(d);t.width&&(Q.width=t.width),t.height&&(Q.height=t.height)}q(i,Q);const P=[],J=()=>{P.forEach((d=>{d.target.removeEventListener(d.name,d.handler)})),P.length=0};P.push({target:Q,name:"load",handler:()=>{J(),t(Q),k&&Q.src&&URL.revokeObjectURL(Q.src)}}),P.push({target:Q,name:"error",handler:d=>{J(),b(d),k&&Q.src&&URL.revokeObjectURL(Q.src)}}),P.push({target:document,name:"securitypolicyviolation",handler:d=>{if(d.blockedURI!==Q.src||"nm"===d.disposition)return;J();const t=new Error(`CSP violation of policy ${d.effectiveDirective} ${d.blockedURI}. Current policy is ${d.originalPolicy}`);D.e.UseFallbackTexture=!1,b(t),k&&Q.src&&URL.revokeObjectURL(Q.src),Q.src=""}}),P.forEach((d=>{d.target.addEventListener(d.name,d.handler)}));const U="blob:"===i.substring(0,5),T="data:"===i.substring(0,5),f=()=>{U||T||!w.b.IsCustomRequestAvailable?Q.src=i:m(i,((d,t,A)=>{const w=new Blob([d],{type:!p&&A?A:p}),N=URL.createObjectURL(w);k=!0,Q.src=N}),void 0,N||void 0,!0,((d,t)=>{b(t)}))},v=()=>{N&&N.loadImage(i,Q)};if(!U&&!T&&N&&N.enableTexturesOffline)N.open(v,f);else{if(-1!==i.indexOf("file:")){const d=decodeURIComponent(i.substring(5).toLowerCase());if(B.FilesToLoad[d]&&"undefined"!==typeof URL){try{let t;try{t=URL.createObjectURL(B.FilesToLoad[d])}catch(j){t=URL.createObjectURL(B.FilesToLoad[d])}Q.src=t,k=!0}catch(n){Q.src=""}return Q}}f()}return Q},v=(d,t,A,w,N)=>{const B=new FileReader,X={onCompleteObservable:new p.b,abort:()=>B.abort()};return B.onloadend=()=>X.onCompleteObservable.notifyObservers(X),N&&(B.onerror=()=>{N(new T(`Unable to read ${d.name}`,d))}),B.onload=d=>{t(d.target.result)},A&&(B.onprogress=A),w?B.readAsArrayBuffer(d):B.readAsText(d),X},m=(d,t,A,w,N,W,a)=>{if(d.name)return v(d,t,A,N,W?d=>{W(void 0,d)}:void 0);const D=d;if(-1!==D.indexOf("file:")){let d=decodeURIComponent(D.substring(5).toLowerCase());0===d.indexOf("./")&&(d=d.substring(2));const w=B.FilesToLoad[d];if(w)return v(w,t,A,N,W?d=>W(void 0,new J(d.message,d.file)):void 0)}const{match:b,type:Q}=Z(D);if(b){const d={onCompleteObservable:new p.b,abort:()=>()=>{}};try{const d=N?L(D):I(D);t(d,void 0,Q)}catch(X){W?W(void 0,X):i.e.Error(X.message||"Failed to parse the Data URL")}return k.c.SetImmediate((()=>{d.onCompleteObservable.notifyObservers(d)})),d}return j(D,((d,A)=>{t(d,null===A||void 0===A?void 0:A.responseURL,null===A||void 0===A?void 0:A.getResponseHeader("content-type"))}),A,w,N,W?d=>{W(d.request,new J(d.message,d.request))}:void 0,a)},j=(d,t,A,B,X,W,a)=>{d=F.CleanUrl(d),d=F.PreprocessUrl(d);const D=F.BaseUrl+d;let k=!1;const b={onCompleteObservable:new p.b,abort:()=>k=!0},Q=()=>{let d,p=new w.b,B=null;const Q=()=>{p&&(A&&p.removeEventListener("progress",A),d&&p.removeEventListener("readystatechange",d),p.removeEventListener("loadend",P))};let P=()=>{Q(),b.onCompleteObservable.notifyObservers(b),b.onCompleteObservable.clear(),A=void 0,d=null,P=null,W=void 0,a=void 0,t=void 0};b.abort=()=>{k=!0,P&&P(),p&&p.readyState!==(XMLHttpRequest.DONE||4)&&p.abort(),null!==B&&(clearTimeout(B),B=null),p=null};const J=d=>{const t=d.message||"Unknown error";W&&p?W(new U(t,p)):i.e.Error(t)},T=i=>{if(p){if(p.open("GET",D),a)try{a(p)}catch(b){return void J(b)}X&&(p.responseType="arraybuffer"),A&&p.addEventListener("progress",A),P&&p.addEventListener("loadend",P),d=()=>{if(!k&&p&&p.readyState===(XMLHttpRequest.DONE||4)){if(d&&p.removeEventListener("readystatechange",d),p.status>=200&&p.status<300||0===p.status&&(!(0,N.l)()||n())){try{t&&t(X?p.response:p.responseText,p)}catch(b){J(b)}return}const A=F.DefaultRetryStrategy;if(A){const d=A(D,p,i);if(-1!==d)return Q(),p=new w.b,void(B=setTimeout((()=>T(i+1)),d))}const a=new U("Error status: "+p.status+" "+p.statusText+" - Unable to load "+D,p);W&&W(a)}},p.addEventListener("readystatechange",d),p.send()}};T(0)};if(B&&B.enableSceneOffline){const w=d=>{d&&d.status>400?W&&W(d):Q()},N=()=>{B&&B.loadFile(F.BaseUrl+d,(d=>{!k&&t&&t(d),b.onCompleteObservable.notifyObservers(b)}),A?d=>{!k&&A&&A(d)}:void 0,w,X)};B.open(N,w)}else Q();return b},n=()=>"undefined"!==typeof location&&"file:"===location.protocol,R=d=>P.test(d),Z=d=>{const t=P.exec(d);if(null===t||0===t.length)return{match:!1,type:""};return{match:!0,type:t[0].replace("data:","").replace("base64,","")}};function L(d){return(0,W.b)(d.split(",")[1])}const I=d=>(0,W.d)(d.split(",")[1]);let u;Q.c._FileToolsLoadImage=f,b.c.loadFile=m,a.l.loadFile=m;((d,t,A,w,N,p,B,X,W,a)=>{u={DecodeBase64UrlToBinary:d,DecodeBase64UrlToString:t,DefaultRetryStrategy:A.DefaultRetryStrategy,BaseUrl:A.BaseUrl,CorsBehavior:A.CorsBehavior,PreprocessUrl:A.PreprocessUrl,IsBase64DataUrl:w,IsFileURL:N,LoadFile:p,LoadImage:B,ReadFile:X,RequestFile:W,SetCorsBehavior:a},Object.defineProperty(u,"DefaultRetryStrategy",{get:function(){return A.DefaultRetryStrategy},set:function(d){A.DefaultRetryStrategy=d}}),Object.defineProperty(u,"BaseUrl",{get:function(){return A.BaseUrl},set:function(d){A.BaseUrl=d}}),Object.defineProperty(u,"PreprocessUrl",{get:function(){return A.PreprocessUrl},set:function(d){A.PreprocessUrl=d}}),Object.defineProperty(u,"CorsBehavior",{get:function(){return A.CorsBehavior},set:function(d){A.CorsBehavior=d}})})(L,I,F,R,n,m,f,v,j,q)},10894:(d,t,A)=>{"use strict";function w(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(d=>{const t=16*Math.random()|0;return("x"===d?t:3&t|8).toString(16)}))}A.d(t,{c:()=>w})},10878:(d,t,A)=>{"use strict";A.d(t,{b:()=>p});var w=A(10740),N=A(10885);class p{static Instantiate(d){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[d])return this.RegisteredExternalClasses[d];const t=(0,N.d)(d);if(t)return t;w.e.Warn(d+" not found, you may have missed an import.");const A=d.split(".");let p=window||this;for(let w=0,N=A.length;w<N;w++)p=p[A[w]];return"function"!==typeof p?null:p}}p.RegisteredExternalClasses={}},10740:(d,t,A)=>{"use strict";A.d(t,{e:()=>w});class w{static _CheckLimit(d,t){let A=w._LogLimitOutputs[d];return A?A.current++:(A={limit:t,current:1},w._LogLimitOutputs[d]=A),A.current<=A.limit}static _GenerateLimitMessage(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const A=w._LogLimitOutputs[d];if(!A||!w.MessageLimitReached)return;const N=this._Levels[t];A.current===A.limit&&w[N.name](w.MessageLimitReached.replace(/%LIMIT%/g,""+A.limit).replace(/%TYPE%/g,N.name??""))}static _AddLogEntry(d){w._LogCache=d+w._LogCache,w.OnNewCacheEntry&&w.OnNewCacheEntry(d)}static _FormatMessage(d){const t=d=>d<10?"0"+d:""+d,A=new Date;return"["+t(A.getHours())+":"+t(A.getMinutes())+":"+t(A.getSeconds())+"]: "+d}static _LogDisabled(d,t){}static _LogEnabled(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0;const N=Array.isArray(t)?t[0]:t;if(void 0!==A&&!w._CheckLimit(N,A))return;const p=w._FormatMessage(N),B=this._Levels[d],X=Array.isArray(t)?t.slice(1):[];B.logFunc&&B.logFunc("BJS - "+p,...X);const W=`<div style='color:${B.color}'>${p}</div><br>`;w._AddLogEntry(W),w._GenerateLimitMessage(N,d)}static get LogCache(){return w._LogCache}static ClearLogCache(){w._LogCache="",w._LogLimitOutputs={},w.errorsCount=0}static set LogLevels(d){w.Log=w._LogDisabled,w.Warn=w._LogDisabled,w.Error=w._LogDisabled,[w.MessageLogLevel,w.WarningLogLevel,w.ErrorLogLevel].forEach((t=>{if((d&t)===t){const d=this._Levels[t];w[d.name]=w._LogEnabled.bind(w,t)}}))}}w.NoneLogLevel=0,w.MessageLogLevel=1,w.WarningLogLevel=2,w.ErrorLogLevel=4,w.AllLogLevel=7,w.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",w._LogCache="",w._LogLimitOutputs={},w._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],w.errorsCount=0,w.Log=w._LogEnabled.bind(w,w.MessageLogLevel),w.Warn=w._LogEnabled.bind(w,w.WarningLogLevel),w.Error=w._LogEnabled.bind(w,w.ErrorLogLevel)},10730:(d,t,A)=>{"use strict";A.d(t,{b:()=>p});class w{constructor(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;this.initialize(d,t,A,w)}initialize(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;return this.mask=d,this.skipNextObservers=t,this.target=A,this.currentTarget=w,this}}class N{constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=d,this.mask=t,this.scope=A,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class p{static FromPromise(d,t){const A=new p;return d.then((d=>{A.notifyObservers(d)})).catch((d=>{if(!t)throw d;t.notifyObservers(d)})),A}get observers(){return this._observers}constructor(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=t,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new w(0),d&&(this._onObserverAdded=d)}add(d){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2],A=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!d)return null;const w=new N(d,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return w.unregisterOnNextCall=A,t?this._observers.unshift(w):this._observers.push(w),this._onObserverAdded&&this._onObserverAdded(w),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(w,this._lastNotifiedValue),w._remove=()=>{this.remove(w)},w}addOnce(d){return this.add(d,void 0,void 0,void 0,!0)}remove(d){if(!d)return!1;d._remove=null;return-1!==this._observers.indexOf(d)&&(this._deferUnregister(d),!0)}removeCallback(d,t){for(let A=0;A<this._observers.length;A++){const w=this._observers[A];if(!w._willBeUnregistered&&(w.callback===d&&(!t||t===w.scope)))return this._deferUnregister(w),!0}return!1}_deferUnregister(d){d._willBeUnregistered||(this._numObserversMarkedAsDeleted++,d.unregisterOnNextCall=!1,d._willBeUnregistered=!0,setTimeout((()=>{this._remove(d)}),0))}_remove(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!d)return!1;const A=this._observers.indexOf(d);return-1!==A&&(t&&this._numObserversMarkedAsDeleted--,this._observers.splice(A,1),!0)}makeObserverTopPriority(d){this._remove(d,!1),this._observers.unshift(d)}makeObserverBottomPriority(d){this._remove(d,!1),this._observers.push(d)}notifyObservers(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=d),!this._observers.length)return!0;const p=this._eventState;p.mask=t,p.target=A,p.currentTarget=w,p.skipNextObservers=!1,p.lastReturnValue=d,p.userInfo=N;for(const B of this._observers)if(!B._willBeUnregistered&&(B.mask&t&&(B.unregisterOnNextCall&&this._deferUnregister(B),B.scope?p.lastReturnValue=B.callback.apply(B.scope,[d,p]):p.lastReturnValue=B.callback(d,p)),p.skipNextObservers))return!1;return!0}notifyObserver(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=t),d._willBeUnregistered)return;const w=this._eventState;w.mask=A,w.skipNextObservers=!1,d.unregisterOnNextCall&&this._deferUnregister(d),d.callback(t,w)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const d=this._observers.pop();d&&(d._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const d=new p;return d._observers=this._observers.slice(0),d}hasSpecificMask(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const t of this._observers)if(t.mask&d||t.mask===d)return!0;return!1}}},10901:(d,t,A)=>{"use strict";A.d(t,{d:()=>N});var w=A(10756);class N{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(d,t){N.Enabled&&(this._current+=d,t&&this._fetchResult())}beginMonitoring(){N.Enabled&&(this._startMonitoringTime=w.d.Now)}endMonitoring(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!N.Enabled)return;d&&this.fetchNewFrame();const t=w.d.Now;this._current=t-this._startMonitoringTime,d&&this._fetchResult()}dj(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const d=w.d.Now;d-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=d,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}N.Enabled=!0},10756:(d,t,A)=>{"use strict";A.d(t,{d:()=>N});var w=A(10737);class N{static get Now(){return(0,w.l)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},12042:(d,t,A)=>{"use strict";A.d(t,{b:()=>p});var w=A(11584),N=A(11573);class p{static ExpandRGBDTexture(d){const t=d._texture;if(!t||!d.isRGBD)return;const N=t.getEngine(),p=N.getCaps(),B=t.isReady;let X=!1;p.textureHalfFloatRender&&p.textureHalfFloatLinearFiltering?(X=!0,t.type=2):p.textureFloatRender&&p.textureFloatLinearFiltering&&(X=!0,t.type=1),X&&(t.isReady=!1,t._isRGBD=!1,t.invertY=!1);const W=async()=>{const p=N.isWebGPU,B=p?1:0;t.isReady=!1,p?await Promise.all([A.e(39).then(A.bind(A,13273)),A.e(40).then(A.bind(A,13280))]):await Promise.all([A.e(41).then(A.bind(A,13285)),A.e(42).then(A.bind(A,13293))]);const X=new w.d("rgbdDecode","rgbdDecode",null,null,1,null,3,N,!1,void 0,t.type,void 0,null,!1,void 0,B);X.externalTextureSamplerBinding=!0;const W=N.createRenderTargetTexture(t.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:t.samplingMode,type:t.type,format:5});X.onEffectCreatedObservable.addOnce((A=>{A.executeWhenCompiled((()=>{X.onApply=d=>{d._bindTexture("textureSampler",t),d.setFloat2("scale",1,1)},d.va().postProcessManager.directRender([X],W,!0),N.restoreDefaultFramebuffer(),N._releaseTexture(t),X&&X.dispose(),W._swapAndDie(t),t.isReady=!0}))}))};X&&(B?W():d.onLoadObservable.addOnce(W))}static EncodeTextureToRGBD(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,N.d)("rgbdEncode",d,t,A,1,5)}}},11054:(d,t,A)=>{"use strict";A.d(t,{b:()=>N,d:()=>w});class w{constructor(d){this.length=0,this.data=new Array(d),this._id=w._GlobalId++}push(d){this.data[this.length++]=d,this.length>this.data.length&&(this.data.length*=2)}forEach(d){for(let t=0;t<this.length;t++)d(this.data[t])}sort(d){this.data.sort(d)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(d){if(0!==d.length){this.length+d.length>this.data.length&&(this.data.length=2*(this.length+d.length));for(let t=0;t<d.length;t++)this.data[this.length++]=(d.data||d)[t]}}indexOf(d){const t=this.data.indexOf(d);return t>=this.length?-1:t}contains(d){return-1!==this.indexOf(d)}}w._GlobalId=0;class N extends w{constructor(){super(...arguments),this._duplicateId=0}push(d){super.push(d),d.__smartArrayFlags||(d.__smartArrayFlags={}),d.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(d){return(!d.__smartArrayFlags||d.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(d),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(d){if(0!==d.length){this.length+d.length>this.data.length&&(this.data.length=2*(this.length+d.length));for(let t=0;t<d.length;t++){const A=(d.data||d)[t];this.pushNoDuplicate(A)}}}}},10791:(d,t,A)=>{"use strict";A.d(t,{b:()=>B,d:()=>p,g:()=>w,k:()=>N});const w=d=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(d);let t="";for(let A=0;A<d.byteLength;A++)t+=String.fromCharCode(d[A]);return t},N=d=>{const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let A,w,N,p,B,X,W,a="",D=0;const i=ArrayBuffer.isView(d)?new Uint8Array(d.buffer,d.byteOffset,d.byteLength):new Uint8Array(d);for(;D<i.length;)A=i[D++],w=D<i.length?i[D++]:Number.NaN,N=D<i.length?i[D++]:Number.NaN,p=A>>2,B=(3&A)<<4|w>>4,X=(15&w)<<2|N>>6,W=63&N,isNaN(w)?X=W=64:isNaN(N)&&(W=64),a+=t.charAt(p)+t.charAt(B)+t.charAt(X)+t.charAt(W);return a},p=d=>atob(d),B=d=>{const t=p(d),A=t.length,w=new Uint8Array(new ArrayBuffer(A));for(let N=0;N<A;N++)w[N]=t.charCodeAt(N);return w.buffer}},11067:(d,t,A)=>{"use strict";A.d(t,{c:()=>N});class w{static Eval(d,t){return"true"===(d=d.match(/\([^()]*\)/g)?d.replace(/\([^()]*\)/g,(d=>(d=d.slice(1,d.length-1),w._HandleParenthesisContent(d,t)))):w._HandleParenthesisContent(d,t))||"false"!==d&&w.Eval(d,t)}static _HandleParenthesisContent(d,t){let A;t=t||(d=>"true"===d);const N=d.split("||");for(const p in N)if(Object.prototype.hasOwnProperty.call(N,p)){let d=w._SimplifyNegation(N[p].trim());const B=d.split("&&");if(B.length>1)for(let N=0;N<B.length;++N){const p=w._SimplifyNegation(B[N].trim());if(A="true"!==p&&"false"!==p?"!"===p[0]?!t(p.substring(1)):t(p):"true"===p,!A){d="false";break}}if(A||"true"===d){A=!0;break}A="true"!==d&&"false"!==d?"!"===d[0]?!t(d.substring(1)):t(d):"true"===d}return A?"true":"false"}static _SimplifyNegation(d){return"!true"===(d=(d=d.replace(/^[\s!]+/,(d=>(d=d.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?d="false":"!false"===d&&(d="true"),d}}class N{static EnableFor(d){d._tags=d._tags||{},d.hasTags=()=>N.HasTags(d),d.addTags=t=>N.AddTagsTo(d,t),d.removeTags=t=>N.RemoveTagsFrom(d,t),d.matchesTagsQuery=t=>N.MatchesQuery(d,t)}static DisableFor(d){delete d._tags,delete d.hasTags,delete d.addTags,delete d.removeTags,delete d.matchesTagsQuery}static HasTags(d){if(!d._tags)return!1;const t=d._tags;for(const A in t)if(Object.prototype.hasOwnProperty.call(t,A))return!0;return!1}static GetTags(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!d._tags)return null;if(t){const t=[];for(const A in d._tags)Object.prototype.hasOwnProperty.call(d._tags,A)&&!0===d._tags[A]&&t.push(A);return t.join(" ")}return d._tags}static AddTagsTo(d,t){if(!t)return;if("string"!==typeof t)return;t.split(" ").forEach((function(t){N._AddTagTo(d,t)}))}static _AddTagTo(d,t){""!==(t=t.trim())&&"true"!==t&&"false"!==t&&(t.match(/[\s]/)||t.match(/^([!]|([|]|[&]){2})/)||(N.EnableFor(d),d._tags[t]=!0))}static RemoveTagsFrom(d,t){if(!N.HasTags(d))return;const A=t.split(" ");for(const w in A)N._RemoveTagFrom(d,A[w])}static _RemoveTagFrom(d,t){delete d._tags[t]}static MatchesQuery(d,t){return void 0===t||(""===t?N.HasTags(d):w.Eval(t,(t=>N.HasTags(d)&&d._tags[t])))}}},11573:(d,t,A)=>{"use strict";A.d(t,{d:()=>W,h:()=>k,j:()=>i});A(11264),A(11576);var w=A(11584),N=A(10824),p=A(10885),B=A(11097);class X extends w.d{getClassName(){return"PassPostProcess"}constructor(d,t){super(d,"pass",null,null,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(d,t){d?(this._webGPUReady=!0,t.push(Promise.all([A.e(33).then(A.bind(A,13242))]))):t.push(Promise.all([A.e(34).then(A.bind(A,13245))])),super._gatherImports(d,t)}static _Parse(d,t,A,w){return B.d.Parse((()=>new X(d.name,d.options,t,d.renderTargetSamplingMode,d._engine,d.reusable)),d,A,w)}}(0,p.g)("BABYLON.PassPostProcess",X);w.d;function W(d,t,A,N,p,B,X,W){const a=t.getEngine();return t.isReady=!1,p=p??t.samplingMode,N=N??t.type,B=B??t.format,X=X??t.width,W=W??t.height,-1===N&&(N=0),new Promise((D=>{const i=new w.d("postprocess",d,null,null,1,null,p,a,!1,void 0,N,void 0,null,!1,B);i.externalTextureSamplerBinding=!0;const k=a.createRenderTargetTexture({width:X,height:W},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:p,type:N,format:B});i.onEffectCreatedObservable.addOnce((d=>{d.executeWhenCompiled((()=>{i.onApply=d=>{d._bindTexture("textureSampler",t),d.setFloat2("scale",1,1)},A.postProcessManager.directRender([i],k,!0),a.restoreDefaultFramebuffer(),a._releaseTexture(t),i&&i.dispose(),k._swapAndDie(t),t.type=N,t.format=5,t.isReady=!0,D(t)}))}))}))}let a,D;function i(d){a||(a=new Float32Array(1),D=new Int32Array(a.buffer)),a[0]=d;const t=D[0];let A=t>>16&32768,w=t>>12&2047;const N=t>>23&255;return N<103?A:N>142?(A|=31744,A|=(255==N?0:1)&&8388607&t,A):N<113?(w|=2048,A|=(w>>114-N)+(w>>113-N&1),A):(A|=N-112<<10|w>>1,A+=1&w,A)}function k(d){const t=(32768&d)>>15,A=(31744&d)>>10,w=1023&d;return 0===A?(t?-1:1)*Math.pow(2,-14)*(w/Math.pow(2,10)):31==A?w?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,A-15)*(1+w/Math.pow(2,10))}N.c._RescalePostProcessFactory=d=>new X("rescale",1,null,2,d,!1,0)},10815:(d,t,A)=>{"use strict";A.d(t,{c:()=>N});var w=A(10737);class N{static SetImmediate(d){(0,w.l)()&&window.setImmediate?window.setImmediate(d):setTimeout(d,1)}}},10896:(d,t,A)=>{"use strict";function w(d){let t=1;do{t*=2}while(t<d);return t===d}function N(d,t,A){return d*(1-A)+t*A}function p(d){const t=B(d),A=X(d);return t-d>d-A?A:t}function B(d){return d--,d|=d>>1,d|=d>>2,d|=d>>4,d|=d>>8,d|=d>>16,++d}function X(d){return d|=d>>1,d|=d>>2,d|=d>>4,d|=d>>8,(d|=d>>16)-(d>>1)}function W(d,t){let A;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:A=X(d);break;case 2:A=p(d);break;default:A=B(d)}return Math.min(A,t)}A.d(t,{c:()=>X,g:()=>W,i:()=>w,l:()=>N,p:()=>p})},10727:(d,t,A)=>{"use strict";A.d(t,{d:()=>U,g:()=>J});var w=A(10730),N=A(10737),p=A(10740),B=A(10749),X=A(10756),W=A(10761),a=A(10767),D=A(10775),i=A(10779),k=A(10815),b=A(10878),Q=A(10894),P=A(10896);class J{static get BaseUrl(){return i.f.BaseUrl}static set BaseUrl(d){i.f.BaseUrl=d}static get CleanUrl(){return i.f.CleanUrl}static set CleanUrl(d){i.f.CleanUrl=d}static IsAbsoluteUrl(d){return 0===d.indexOf("//")||-1!==d.indexOf("://")&&(-1!==d.indexOf(".")&&(-1!==d.indexOf("/")&&(!(d.indexOf(":")>d.indexOf("/"))&&(d.indexOf("://")<d.indexOf(".")||(0===d.indexOf("data:")||0===d.indexOf("blob:"))))))}static set ScriptBaseUrl(d){i.f.ScriptBaseUrl=d}static get ScriptBaseUrl(){return i.f.ScriptBaseUrl}static set ScriptPreprocessUrl(d){i.f.ScriptPreprocessUrl=d}static get ScriptPreprocessUrl(){return i.f.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return i.f.DefaultRetryStrategy}static set DefaultRetryStrategy(d){i.f.DefaultRetryStrategy=d}static get CorsBehavior(){return i.f.CorsBehavior}static set CorsBehavior(d){i.f.CorsBehavior=d}static get UseFallbackTexture(){return D.e.UseFallbackTexture}static set UseFallbackTexture(d){D.e.UseFallbackTexture=d}static get RegisteredExternalClasses(){return b.b.RegisteredExternalClasses}static set RegisteredExternalClasses(d){b.b.RegisteredExternalClasses=d}static get fallbackTexture(){return D.e.FallbackTexture}static set fallbackTexture(d){D.e.FallbackTexture=d}static FetchToRef(d,t,A,w,N,p){const B=4*((Math.abs(d)*A%A|0)+(Math.abs(t)*w%w|0)*A);p.r=N[B]/255,p.g=N[B+1]/255,p.b=N[B+2]/255,p.a=N[B+3]/255}static Mix(d,t,A){return 0}static Instantiate(d){return b.b.Instantiate(d)}static SetImmediate(d){k.c.SetImmediate(d)}static IsExponentOfTwo(d){return!0}static FloatRound(d){return Math.fround(d)}static GetFilename(d){const t=d.lastIndexOf("/");return t<0?d:d.substring(t+1)}static GetFolderPath(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const A=d.lastIndexOf("/");return A<0?t?d:"":d.substring(0,A+1)}static ToDegrees(d){return 180*d/Math.PI}static ToRadians(d){return d*Math.PI/180}static SmoothAngleChange(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const w=this.ToRadians(d),N=this.ToRadians(t);return this.ToDegrees(Math.atan2((1-A)*Math.sin(N)+A*Math.sin(w),(1-A)*Math.cos(N)+A*Math.cos(w)))}static MakeArray(d,t){return!0===t||void 0!==d&&null!=d?Array.isArray(d)?d:[d]:null}static GetPointerPrefix(d){return(0,N.l)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(d,t){(0,i.y)(d,t)}static SetReferrerPolicyBehavior(d,t){t.referrerPolicy=d}static get PreprocessUrl(){return i.f.PreprocessUrl}static set PreprocessUrl(d){i.f.PreprocessUrl=d}static LoadImage(d,t,A,w,N,p){return(0,i.o)(d,t,A,w,N,p)}static LoadFile(d,t,A,w,N,p){return(0,i.l)(d,t,A,w,N,p)}static LoadFileAsync(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((A,w)=>{(0,i.l)(d,(d=>{A(d)}),void 0,void 0,t,((d,t)=>{w(t)}))}))}static GetBabylonScriptURL(d,t){if(!d)return"";if(J.ScriptBaseUrl&&d.startsWith(J._DefaultCdnUrl)){const t="/"===J.ScriptBaseUrl[J.ScriptBaseUrl.length-1]?J.ScriptBaseUrl.substring(0,J.ScriptBaseUrl.length-1):J.ScriptBaseUrl;d=d.replace(J._DefaultCdnUrl,t)}return d=J.ScriptPreprocessUrl(d),t&&(d=J.GetAbsoluteUrl(d)),d}static LoadBabylonScript(d,t,A,w){d=J.GetBabylonScriptURL(d),J.LoadScript(d,t,A)}static LoadBabylonScriptAsync(d){return d=J.GetBabylonScriptURL(d),J.LoadScriptAsync(d)}static LoadScript(d,t,A,w){let p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(d),t&&t()}catch(W){null===A||void 0===A||A(`Unable to load script '${d}' in worker`,W)}return}if(!(0,N.l)())return void(null===A||void 0===A||A(`Cannot load script '${d}' outside of a window or a worker`));const B=document.getElementsByTagName("head")[0],X=document.createElement("script");p?(X.setAttribute("type","module"),X.innerText=d):(X.setAttribute("type","text/javascript"),X.setAttribute("src",d)),w&&(X.id=w),X.onload=()=>{t&&t()},X.onerror=t=>{A&&A(`Unable to load script '${d}'`,t)},B.appendChild(X)}static LoadScriptAsync(d,t){return new Promise(((A,w)=>{this.LoadScript(d,(()=>{A()}),((d,t)=>{w(t||new Error(d))}),t)}))}static ReadFileAsDataURL(d,t,A){const N=new FileReader,p={onCompleteObservable:new w.b,abort:()=>N.abort()};return N.onloadend=()=>{p.onCompleteObservable.notifyObservers(p)},N.onload=d=>{t(d.target.result)},N.onprogress=A,N.readAsDataURL(d),p}static ReadFile(d,t,A,w,N){return(0,i.q)(d,t,A,w,N)}static FileAsURL(d){const t=new Blob([d]);return window.URL.createObjectURL(t)}static Format(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return d.toFixed(t)}static DeepCopy(d,t,A,w){B.b.DeepCopy(d,t,A,w)}static IsEmpty(d){for(const t in d)if(Object.prototype.hasOwnProperty.call(d,t))return!1;return!0}static RegisterTopRootEvents(d,t){for(let w=0;w<t.length;w++){const N=t[w];d.addEventListener(N.name,N.handler,!1);try{window.parent&&window.parent.addEventListener(N.name,N.handler,!1)}catch(A){}}}static UnregisterTopRootEvents(d,t){for(let w=0;w<t.length;w++){const N=t[w];d.removeEventListener(N.name,N.handler);try{d.parent&&d.parent.removeEventListener(N.name,N.handler)}catch(A){}}}static async DumpFramebuffer(d,t,A,w){throw(0,W.b)("DumpTools")}static DumpData(d,t,A,w){throw(0,W.b)("DumpTools")}static DumpDataAsync(d,t,A){throw(0,W.b)("DumpTools")}static _IsOffScreenCanvas(d){return void 0!==d.convertToBlob}static ToBlob(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",w=arguments.length>3?arguments[3]:void 0;J._IsOffScreenCanvas(d)||d.toBlob||(d.toBlob=function(d,t,A){setTimeout((()=>{const w=atob(this.toDataURL(t,A).split(",")[1]),N=w.length,p=new Uint8Array(N);for(let d=0;d<N;d++)p[d]=w.charCodeAt(d);d(new Blob([p]))}))}),J._IsOffScreenCanvas(d)?d.convertToBlob({type:A,quality:w}).then((d=>t(d))):d.toBlob((function(d){t(d)}),A,w)}static DownloadBlob(d,t){if("download"in document.createElement("a")){if(!t){const d=new Date;t="screenshot_"+((d.getFullYear()+"-"+(d.getMonth()+1)).slice(2)+"-"+d.getDate()+"_"+d.getHours()+"-"+("0"+d.getMinutes()).slice(-2))+".png"}J.Download(d,t)}else if(d&&"undefined"!==typeof URL){const t=URL.createObjectURL(d),A=window.open("");if(!A)return;const w=A.document.createElement("img");w.onload=function(){URL.revokeObjectURL(t)},w.src=t,A.document.body.appendChild(w)}}static EncodeScreenshotCanvasData(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0;if("string"!==typeof w&&t){if(t){if(J._IsOffScreenCanvas(d))return void d.convertToBlob({type:A,quality:N}).then((d=>{const A=new FileReader;A.readAsDataURL(d),A.onloadend=()=>{const d=A.result;t(d)}}));const w=d.toDataURL(A,N);t(w)}}else this.ToBlob(d,(function(d){d&&J.DownloadBlob(d,w),t&&t("")}),A,N)}static Download(d,t){if("undefined"===typeof URL)return;const A=window.URL.createObjectURL(d),w=document.createElement("a");document.body.appendChild(w),w.style.display="none",w.href=A,w.download=t,w.addEventListener("click",(()=>{w.parentElement&&w.parentElement.removeChild(w)})),w.click(),window.URL.revokeObjectURL(A)}static BackCompatCameraNoPreventDefault(d){return"boolean"===typeof d[0]?d[0]:"boolean"===typeof d[1]&&d[1]}static CreateScreenshot(d,t,A,w){throw(0,W.b)("ScreenshotTools")}static CreateScreenshotAsync(d,t,A){throw(0,W.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(d,t,A,w){throw(0,W.b)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(d,t,A){throw(0,W.b)("ScreenshotTools")}static RandomId(){return(0,Q.c)()}static IsBase64(d){return(0,i.g)(d)}static DecodeBase64(d){return(0,i.b)(d)}static get errorsCount(){return p.e.errorsCount}static Log(d){p.e.Log(d)}static Warn(d){p.e.Warn(d)}static Error(d){p.e.Error(d)}static get LogCache(){return p.e.LogCache}static ClearLogCache(){p.e.ClearLogCache()}static set LogLevels(d){p.e.LogLevels=d}static set PerformanceLogLevel(d){return(d&J.PerformanceUserMarkLogLevel)===J.PerformanceUserMarkLogLevel?(J.StartPerformanceCounter=J._StartUserMark,void(J.EndPerformanceCounter=J._EndUserMark)):(d&J.PerformanceConsoleLogLevel)===J.PerformanceConsoleLogLevel?(J.StartPerformanceCounter=J._StartPerformanceConsole,void(J.EndPerformanceCounter=J._EndPerformanceConsole)):(J.StartPerformanceCounter=J._StartPerformanceCounterDisabled,void(J.EndPerformanceCounter=J._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(d,t){}static _EndPerformanceCounterDisabled(d,t){}static _StartUserMark(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!J._Performance){if(!(0,N.l)())return;J._Performance=window.performance}t&&J._Performance.mark&&J._Performance.mark(d+"-Begin")}static _EndUserMark(d){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&J._Performance.mark&&(J._Performance.mark(d+"-End"),J._Performance.measure(d,d+"-Begin",d+"-End"))}static _StartPerformanceConsole(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&(J._StartUserMark(d,t),console.time&&console.time(d))}static _EndPerformanceConsole(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];t&&(J._EndUserMark(d,t),console.timeEnd(d))}static get Now(){return X.d.Now}static GetClassName(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=null;if(!t&&d.getClassName)A=d.getClassName();else{if(d instanceof Object){A=(t?d:Object.getPrototypeOf(d)).constructor.__bjsclassName__}A||(A=typeof d)}return A}static First(d,t){for(const A of d)if(t(A))return A;return null}static getFullClassName(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=null,w=null;if(!t&&d.getClassName)A=d.getClassName();else{if(d instanceof Object){const N=t?d:Object.getPrototypeOf(d);A=N.constructor.__bjsclassName__,w=N.constructor.__bjsmoduleName__}A||(A=typeof d)}return A?(null!=w?w+".":"")+A:null}static DelayAsync(d){return new Promise((t=>{setTimeout((()=>{t()}),d)}))}static IsSafari(){return!!(0,N.j)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}J.UseCustomRequestHeaders=!1,J.CustomRequestHeaders=a.b.CustomRequestHeaders,J.GetDOMTextContent=N.c,J._DefaultCdnUrl="https://cdn.babylonjs.com",J.GetAbsoluteUrl="object"===typeof document?d=>{const t=document.createElement("a");return t.href=d,t.href}:"function"===typeof URL&&"object"===typeof location?d=>new URL(d,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},J.NoneLogLevel=p.e.NoneLogLevel,J.MessageLogLevel=p.e.MessageLogLevel,J.WarningLogLevel=p.e.WarningLogLevel,J.ErrorLogLevel=p.e.ErrorLogLevel,J.AllLogLevel=p.e.AllLogLevel,J.IsWindowObjectExist=N.l,J.PerformanceNoneLogLevel=0,J.PerformanceUserMarkLogLevel=1,J.PerformanceConsoleLogLevel=2,J.StartPerformanceCounter=J._StartPerformanceCounterDisabled,J.EndPerformanceCounter=J._EndPerformanceCounterDisabled;class U{constructor(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=d,this.index=w-1,this._done=!1,this._fn=t,this._successCallback=A}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(d,t,A){const w=new U(d,t,A,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return w.executeNext(),w}static SyncAsyncForLoop(d,t,A,w,N){let p=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return U.Run(Math.ceil(d/t),(w=>{N&&N()?w.breakLoop():setTimeout((()=>{for(let p=0;p<t;++p){const B=w.index*t+p;if(B>=d)break;if(A(B),N&&N()){w.breakLoop();break}}w.executeNext()}),p)}),w)}}J.Mix=P.l,J.IsExponentOfTwo=P.i,D.e.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10885:(d,t,A)=>{"use strict";A.d(t,{d:()=>p,g:()=>N});const w={};function N(d,t){w[d]=t}function p(d){return w[d]}},11189:(d,t,A)=>{"use strict";A.d(t,{e:()=>w});class w{static get UniqueId(){const d=this._UniqueIdCounter;return this._UniqueIdCounter++,d}}w._UniqueIdCounter=1},10767:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});class w{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(w.CustomRequestHeaders).length>0||w.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const d in w.CustomRequestHeaders){const t=w.CustomRequestHeaders[d];t&&this._xhr.setRequestHeader(d,t)}}_shouldSkipRequestModifications(d){return w.SkipRequestModificationForBabylonCDN&&(d.includes("preview.babylonjs.com")||d.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(d){this._xhr.onprogress=d}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(d){this._xhr.responseType=d}get timeout(){return this._xhr.timeout}set timeout(d){this._xhr.timeout=d}addEventListener(d,t,A){this._xhr.addEventListener(d,t,A)}removeEventListener(d,t,A){this._xhr.removeEventListener(d,t,A)}abort(){this._xhr.abort()}send(d){w.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(d)}open(d,t){for(const A of w.CustomRequestModifiers){if(this._shouldSkipRequestModifications(t))return;A(this._xhr,t)}t=(t=t.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=t,this._xhr.open(d,t,!0)}setRequestHeader(d,t){this._xhr.setRequestHeader(d,t)}getResponseHeader(d){return this._xhr.getResponseHeader(d)}}w.CustomRequestHeaders={},w.CustomRequestModifiers=new Array,w.SkipRequestModificationForBabylonCDN=!0},12104:(d,t,A)=>{"use strict";A.d(t,{d:()=>N});class w{constructor(d){this._pendingActions=new Array,this._workerInfos=d.map((d=>({workerPromise:Promise.resolve(d),idle:!0})))}dispose(){for(const d of this._workerInfos)d.workerPromise.then((d=>{d.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(d){this._executeOnIdleWorker(d)||this._pendingActions.push(d)}_executeOnIdleWorker(d){for(const t of this._workerInfos)if(t.idle)return this._execute(t,d),!0;return!1}_execute(d,t){d.idle=!1,d.workerPromise.then((A=>{t(A,(()=>{const t=this._pendingActions.shift();t?this._execute(d,t):d.idle=!0}))}))}}class N extends w{constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:N.DefaultOptions;super([]),this._maxWorkers=d,this._createWorkerAsync=t,this._options=A}push(d){if(!this._executeOnIdleWorker(d))if(this._workerInfos.length<this._maxWorkers){const t={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(t),this._execute(t,d)}else this._pendingActions.push(d)}_execute(d,t){d.timeoutId&&(clearTimeout(d.timeoutId),delete d.timeoutId),super._execute(d,((A,w)=>{t(A,(()=>{w(),d.idle&&(d.timeoutId=setTimeout((()=>{d.workerPromise.then((d=>{d.terminate()}));const t=this._workerInfos.indexOf(d);-1!==t&&this._workerInfos.splice(t,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}N.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11464:(d,t,A)=>{"use strict";A.d(t,{b:()=>Ud});var w=A(11076),N=A(11257);class p extends N.b{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var B=A(11094),X=(A(11471),A(10885));class W{get noiseTexture(){return this._noiseTexture}set noiseTexture(d){this._noiseTexture!==d&&(this._noiseTexture=d,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(d){this._isAnimationSheetEnabled!=d&&(this._isAnimationSheetEnabled=d,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(d){this._useLogarithmicDepth=d&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:w.l.Zero()}set direction1(d){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=d)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:w.l.Zero()}set direction2(d){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=d)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:w.l.Zero()}set minEmitBox(d){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=d)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:w.l.Zero()}set maxEmitBox(d){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=d)}get billboardMode(){return this._billboardMode}set billboardMode(d){this._billboardMode!==d&&(this._billboardMode=d,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(d){this._isBillboardBased!==d&&(this._isBillboardBased=d,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(d){this._attachImageProcessingConfiguration(d)}_attachImageProcessingConfiguration(d){d!==this._imageProcessingConfiguration&&(!d&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=d)}_reset(){}_removeGradientAndTexture(d,t,A){if(!t)return this;let w=0;for(const N of t){if(N.gradient===d){t.splice(w,1);break}w++}return A&&A.dispose(),this}constructor(d){this.animations=[],this.renderingGroupId=0,this.k=w.l.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new w.l(10,10,10),this.onAnimationEnd=null,this.blendMode=W.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new w.j(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.uf=new w.l(0,0,0),this._useLogarithmicDepth=!1,this.gravity=w.l.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new B.i(1,1,1,1),this.color2=new B.i(1,1,1,1),this.colorDead=new B.i(0,0,0,1),this.textureMask=new B.i(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new p,this.id=d,this.name=d}createPointEmitter(d,t){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new w.l(0,1,0),arguments.length>2&&void 0!==arguments[2]||new w.l(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new w.l(0,1,0),arguments.length>4&&void 0!==arguments[4]||new w.l(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new w.l(0,1,0),arguments.length>3&&void 0!==arguments[3]||new w.l(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(d,t,A,w){throw new Error("Method not implemented.")}}W.BLENDMODE_ONEONE=0,W.BLENDMODE_STANDARD=1,W.BLENDMODE_ADD=2,W.BLENDMODE_MULTIPLY=3,W.BLENDMODE_MULTIPLYADD=4,(0,X.g)("BABYLON.BaseParticleSystem",W);var a=A(11087),D=A(10749);class i{constructor(){this.direction1=new w.l(0,1,0),this.direction2=new w.l(0,1,0),this.minEmitBox=new w.l(-.5,-.5,-.5),this.maxEmitBox=new w.l(.5,.5,.5)}startDirectionFunction(d,t,A,N){const p=(0,a.t)(this.direction1.x,this.direction2.x),B=(0,a.t)(this.direction1.y,this.direction2.y),X=(0,a.t)(this.direction1.z,this.direction2.z);if(N)return t.x=p,t.y=B,void(t.z=X);w.l.TransformNormalFromFloatsToRef(p,B,X,d,t)}startPositionFunction(d,t,A,N){const p=(0,a.t)(this.minEmitBox.x,this.maxEmitBox.x),B=(0,a.t)(this.minEmitBox.y,this.maxEmitBox.y),X=(0,a.t)(this.minEmitBox.z,this.maxEmitBox.z);if(N)return t.x=p,t.y=B,void(t.z=X);w.l.TransformCoordinatesFromFloatsToRef(p,B,X,d,t)}clone(){const d=new i;return D.b.DeepCopy(this,d),d}applyToShader(d){d.setVector3("direction1",this.direction1),d.setVector3("direction2",this.direction2),d.setVector3("minEmitBox",this.minEmitBox),d.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(d){d.addUniform("direction1",3),d.addUniform("direction2",3),d.addUniform("minEmitBox",3),d.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const d={};return d.type=this.getClassName(),d.direction1=this.direction1.gj(),d.direction2=this.direction2.gj(),d.minEmitBox=this.minEmitBox.gj(),d.maxEmitBox=this.maxEmitBox.gj(),d}parse(d){w.l.FromArrayToRef(d.direction1,0,this.direction1),w.l.FromArrayToRef(d.direction2,0,this.direction2),w.l.FromArrayToRef(d.minEmitBox,0,this.minEmitBox),w.l.FromArrayToRef(d.maxEmitBox,0,this.maxEmitBox)}}class k{get i(){return this._radius}set i(d){this._radius=d,this._buildHeight()}get angle(){return this._angle}set angle(d){this._angle=d,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=A,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=t,this.i=d}startDirectionFunction(d,t,A,N){N?w.h.gb[0].p(A.Cf).normalize():A.position.subtractToRef(d.getTranslation(),w.h.gb[0]).normalize();const p=(0,a.t)(0,this.directionRandomizer),B=(0,a.t)(0,this.directionRandomizer),X=(0,a.t)(0,this.directionRandomizer);t.x=w.h.gb[0].x+p,t.y=w.h.gb[0].y+B,t.z=w.h.gb[0].z+X,t.normalize()}startPositionFunction(d,t,A,N){const p=(0,a.t)(0,2*Math.PI);let B;this.emitFromSpawnPointOnly?B=1e-4:(B=(0,a.t)(0,this.heightRange),B=1-B*B);let X=this._radius-(0,a.t)(0,this._radius*this.radiusRange);X*=B;const W=X*Math.sin(p),D=X*Math.cos(p),i=B*this._height;if(N)return t.x=W,t.y=i,void(t.z=D);w.l.TransformCoordinatesFromFloatsToRef(W,i,D,d,t)}clone(){const d=new k(this._radius,this._angle,this.directionRandomizer);return D.b.DeepCopy(this,d),d}applyToShader(d){d.setFloat2("i",this._radius,this.radiusRange),d.setFloat("coneAngle",this._angle),d.setFloat2("height",this._height,this.heightRange),d.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(d){d.addUniform("i",2),d.addUniform("coneAngle",1),d.addUniform("height",2),d.addUniform("directionRandomizer",1)}getEffectDefines(){let d="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(d+="\n#define CONEEMITTERSPAWNPOINT"),d}getClassName(){return"ConeParticleEmitter"}serialize(){const d={};return d.type=this.getClassName(),d.i=this._radius,d.angle=this._angle,d.directionRandomizer=this.directionRandomizer,d.radiusRange=this.radiusRange,d.heightRange=this.heightRange,d.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,d}parse(d){this.i=d.i,this.angle=d.angle,this.directionRandomizer=d.directionRandomizer,this.radiusRange=void 0!==d.radiusRange?d.radiusRange:1,this.heightRange=void 0!==d.radiusRange?d.heightRange:1,this.emitFromSpawnPointOnly=void 0!==d.emitFromSpawnPointOnly&&d.emitFromSpawnPointOnly}}class b extends k{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.l(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.l(0,1,0);super(d,t),this.direction1=A,this.direction2=N}startDirectionFunction(d,t){const A=(0,a.t)(this.direction1.x,this.direction2.x),N=(0,a.t)(this.direction1.y,this.direction2.y),p=(0,a.t)(this.direction1.z,this.direction2.z);w.l.TransformNormalFromFloatsToRef(A,N,p,d,t)}clone(){const d=new b(this.i,this.angle,this.direction1,this.direction2);return D.b.DeepCopy(this,d),d}applyToShader(d){d.setFloat("i",this.i),d.setFloat("radiusRange",this.radiusRange),d.setVector3("direction1",this.direction1),d.setVector3("direction2",this.direction2)}buildUniformLayout(d){d.addUniform("i",1),d.addUniform("radiusRange",1),d.addUniform("direction1",3),d.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const d=super.serialize();return d.direction1=this.direction1.gj(),d.direction2=this.direction2.gj(),d}parse(d){super.parse(d),this.direction1.p(d.direction1),this.direction2.p(d.direction2)}}class Q{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.i=d,this.height=t,this.radiusRange=A,this.directionRandomizer=N,this._tempVector=w.l.Zero()}startDirectionFunction(d,t,A,N,p){A.position.subtractToRef(d.getTranslation(),this._tempVector),this._tempVector.normalize(),w.l.TransformNormalToRef(this._tempVector,p,this._tempVector);const B=(0,a.t)(-this.directionRandomizer/2,this.directionRandomizer/2);let X=Math.atan2(this._tempVector.x,this._tempVector.z);X+=(0,a.t)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=B,this._tempVector.x=Math.sin(X),this._tempVector.z=Math.cos(X),this._tempVector.normalize(),N?t.p(this._tempVector):w.l.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,d,t)}startPositionFunction(d,t,A,N){const p=(0,a.t)(-this.height/2,this.height/2),B=(0,a.t)(0,2*Math.PI),X=(0,a.t)((1-this.radiusRange)*(1-this.radiusRange),1),W=Math.sqrt(X)*this.i,D=W*Math.cos(B),i=W*Math.sin(B);N?t.wf(D,p,i):w.l.TransformCoordinatesFromFloatsToRef(D,p,i,d,t)}clone(){const d=new Q(this.i,this.directionRandomizer);return D.b.DeepCopy(this,d),d}applyToShader(d){d.setFloat("i",this.i),d.setFloat("height",this.height),d.setFloat("radiusRange",this.radiusRange),d.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(d){d.addUniform("i",1),d.addUniform("height",1),d.addUniform("radiusRange",1),d.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const d={};return d.type=this.getClassName(),d.i=this.i,d.height=this.height,d.radiusRange=this.radiusRange,d.directionRandomizer=this.directionRandomizer,d}parse(d){this.i=d.i,this.height=d.height,this.radiusRange=d.radiusRange,this.directionRandomizer=d.directionRandomizer}}class P extends Q{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.l(0,1,0),p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.l(0,1,0);super(d,t,A),this.direction1=N,this.direction2=p}startDirectionFunction(d,t,A,N){const p=(0,a.t)(this.direction1.x,this.direction2.x),B=(0,a.t)(this.direction1.y,this.direction2.y),X=(0,a.t)(this.direction1.z,this.direction2.z);N?t.wf(p,B,X):w.l.TransformNormalFromFloatsToRef(p,B,X,d,t)}clone(){const d=new P(this.i,this.height,this.radiusRange,this.direction1,this.direction2);return D.b.DeepCopy(this,d),d}applyToShader(d){d.setFloat("i",this.i),d.setFloat("height",this.height),d.setFloat("radiusRange",this.radiusRange),d.setVector3("direction1",this.direction1),d.setVector3("direction2",this.direction2)}buildUniformLayout(d){d.addUniform("i",1),d.addUniform("height",1),d.addUniform("radiusRange",1),d.addUniform("direction1",3),d.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const d=super.serialize();return d.direction1=this.direction1.gj(),d.direction2=this.direction2.gj(),d}parse(d){super.parse(d),w.l.FromArrayToRef(d.direction1,0,this.direction1),w.l.FromArrayToRef(d.direction2,0,this.direction2)}}class J{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=d,this.radiusRange=t,this.directionRandomizer=A}startDirectionFunction(d,t,A,N){const p=A.position.Uc(d.getTranslation()).normalize(),B=(0,a.t)(0,this.directionRandomizer),X=(0,a.t)(0,this.directionRandomizer),W=(0,a.t)(0,this.directionRandomizer);p.x+=B,p.y+=X,p.z+=W,p.normalize(),N?t.p(p):w.l.TransformNormalFromFloatsToRef(p.x,p.y,p.z,d,t)}startPositionFunction(d,t,A,N){const p=this.i-(0,a.t)(0,this.i*this.radiusRange),B=(0,a.t)(0,1),X=(0,a.t)(0,2*Math.PI),W=Math.acos(2*B-1),D=p*Math.cos(X)*Math.sin(W),i=p*Math.cos(W),k=p*Math.sin(X)*Math.sin(W);N?t.wf(D,Math.abs(i),k):w.l.TransformCoordinatesFromFloatsToRef(D,Math.abs(i),k,d,t)}clone(){const d=new J(this.i,this.directionRandomizer);return D.b.DeepCopy(this,d),d}applyToShader(d){d.setFloat("i",this.i),d.setFloat("radiusRange",this.radiusRange),d.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(d){d.addUniform("i",1),d.addUniform("radiusRange",1),d.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const d={};return d.type=this.getClassName(),d.i=this.i,d.radiusRange=this.radiusRange,d.directionRandomizer=this.directionRandomizer,d}parse(d){this.i=d.i,this.radiusRange=d.radiusRange,this.directionRandomizer=d.directionRandomizer}}class U{constructor(){this.direction1=new w.l(0,1,0),this.direction2=new w.l(0,1,0)}startDirectionFunction(d,t,A,N){const p=(0,a.t)(this.direction1.x,this.direction2.x),B=(0,a.t)(this.direction1.y,this.direction2.y),X=(0,a.t)(this.direction1.z,this.direction2.z);N?t.wf(p,B,X):w.l.TransformNormalFromFloatsToRef(p,B,X,d,t)}startPositionFunction(d,t,A,N){N?t.wf(0,0,0):w.l.TransformCoordinatesFromFloatsToRef(0,0,0,d,t)}clone(){const d=new U;return D.b.DeepCopy(this,d),d}applyToShader(d){d.setVector3("direction1",this.direction1),d.setVector3("direction2",this.direction2)}buildUniformLayout(d){d.addUniform("direction1",3),d.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const d={};return d.type=this.getClassName(),d.direction1=this.direction1.gj(),d.direction2=this.direction2.gj(),d}parse(d){w.l.FromArrayToRef(d.direction1,0,this.direction1),w.l.FromArrayToRef(d.direction2,0,this.direction2)}}class T{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.i=d,this.radiusRange=t,this.directionRandomizer=A}startDirectionFunction(d,t,A,N){const p=A.position.Uc(d.getTranslation()).normalize(),B=(0,a.t)(0,this.directionRandomizer),X=(0,a.t)(0,this.directionRandomizer),W=(0,a.t)(0,this.directionRandomizer);p.x+=B,p.y+=X,p.z+=W,p.normalize(),N?t.p(p):w.l.TransformNormalFromFloatsToRef(p.x,p.y,p.z,d,t)}startPositionFunction(d,t,A,N){const p=this.i-(0,a.t)(0,this.i*this.radiusRange),B=(0,a.t)(0,1),X=(0,a.t)(0,2*Math.PI),W=Math.acos(2*B-1),D=p*Math.cos(X)*Math.sin(W),i=p*Math.cos(W),k=p*Math.sin(X)*Math.sin(W);N?t.wf(D,i,k):w.l.TransformCoordinatesFromFloatsToRef(D,i,k,d,t)}clone(){const d=new T(this.i,this.directionRandomizer);return D.b.DeepCopy(this,d),d}applyToShader(d){d.setFloat("i",this.i),d.setFloat("radiusRange",this.radiusRange),d.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(d){d.addUniform("i",1),d.addUniform("radiusRange",1),d.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const d={};return d.type=this.getClassName(),d.i=this.i,d.radiusRange=this.radiusRange,d.directionRandomizer=this.directionRandomizer,d}parse(d){this.i=d.i,this.radiusRange=d.radiusRange,this.directionRandomizer=d.directionRandomizer}}class F extends T{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.l(0,1,0),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.l(0,1,0);super(d),this.direction1=t,this.direction2=A}startDirectionFunction(d,t){const A=(0,a.t)(this.direction1.x,this.direction2.x),N=(0,a.t)(this.direction1.y,this.direction2.y),p=(0,a.t)(this.direction1.z,this.direction2.z);w.l.TransformNormalFromFloatsToRef(A,N,p,d,t)}clone(){const d=new F(this.i,this.direction1,this.direction2);return D.b.DeepCopy(this,d),d}applyToShader(d){d.setFloat("i",this.i),d.setFloat("radiusRange",this.radiusRange),d.setVector3("direction1",this.direction1),d.setVector3("direction2",this.direction2)}buildUniformLayout(d){d.addUniform("i",1),d.addUniform("radiusRange",1),d.addUniform("direction1",3),d.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const d=super.serialize();return d.direction1=this.direction1.gj(),d.direction2=this.direction2.gj(),d}parse(d){super.parse(d),this.direction1.p(d.direction1),this.direction2.p(d.direction2)}}class q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(d,t,A,N){const p=w.h.gb[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,A,p);const d=w.h.gb[1];p.subtractToRef(A.position,d),d.scaleToRef(1/A.lifeTime,p)}else p.set(0,0,0);N?t.p(p):w.l.TransformNormalToRef(p,d,t)}startPositionFunction(d,t,A,N){const p=w.h.gb[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,A,p):p.set(0,0,0),N?t.p(p):w.l.TransformCoordinatesToRef(p,d,t)}clone(){const d=new q;return D.b.DeepCopy(this,d),d}applyToShader(d){}buildUniformLayout(d){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const d={};return d.type=this.getClassName(),d.particlePositionGenerator=this.particlePositionGenerator,d.particleDestinationGenerator=this.particleDestinationGenerator,d}parse(d){d.particlePositionGenerator&&(this.particlePositionGenerator=d.particlePositionGenerator),d.particleDestinationGenerator&&(this.particleDestinationGenerator=d.particleDestinationGenerator)}}var H=A(11120);class f{get mesh(){return this.Vk}set mesh(d){this.Vk!==d&&(this.Vk=d,d?(this._indices=d.xf(),this._positions=d.getVerticesData(H.f.PositionKind),this._normals=d.getVerticesData(H.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=w.l.Zero(),this.Vk=null,this.direction1=new w.l(0,1,0),this.direction2=new w.l(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=d}startDirectionFunction(d,t,A,N){if(this.useMeshNormalsForDirection&&this._normals)return void w.l.TransformNormalToRef(this._storedNormal,d,t);const p=(0,a.t)(this.direction1.x,this.direction2.x),B=(0,a.t)(this.direction1.y,this.direction2.y),X=(0,a.t)(this.direction1.z,this.direction2.z);N?t.wf(p,B,X):w.l.TransformNormalFromFloatsToRef(p,B,X,d,t)}startPositionFunction(d,t,A,N){if(!this._indices||!this._positions)return;const p=3*Math.random()*(this._indices.length/3)|0,B=Math.random(),X=Math.random()*(1-B),W=1-B-X,a=this._indices[p],D=this._indices[p+1],i=this._indices[p+2],k=w.h.gb[0],b=w.h.gb[1],Q=w.h.gb[2],P=w.h.gb[3];w.l.FromArrayToRef(this._positions,3*a,k),w.l.FromArrayToRef(this._positions,3*D,b),w.l.FromArrayToRef(this._positions,3*i,Q),P.x=B*k.x+X*b.x+W*Q.x,P.y=B*k.y+X*b.y+W*Q.y,P.z=B*k.z+X*b.z+W*Q.z,N?t.wf(P.x,P.y,P.z):w.l.TransformCoordinatesFromFloatsToRef(P.x,P.y,P.z,d,t),this.useMeshNormalsForDirection&&this._normals&&(w.l.FromArrayToRef(this._normals,3*a,k),w.l.FromArrayToRef(this._normals,3*D,b),w.l.FromArrayToRef(this._normals,3*i,Q),this._storedNormal.x=B*k.x+X*b.x+W*Q.x,this._storedNormal.y=B*k.y+X*b.y+W*Q.y,this._storedNormal.z=B*k.z+X*b.z+W*Q.z)}clone(){const d=new f(this.mesh);return D.b.DeepCopy(this,d),d}applyToShader(d){d.setVector3("direction1",this.direction1),d.setVector3("direction2",this.direction2)}buildUniformLayout(d){d.addUniform("direction1",3),d.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var d;const t={};return t.type=this.getClassName(),t.direction1=this.direction1.gj(),t.direction2=this.direction2.gj(),t.meshId=null===(d=this.mesh)||void 0===d?void 0:d.id,t.useMeshNormalsForDirection=this.useMeshNormalsForDirection,t}parse(d,t){w.l.FromArrayToRef(d.direction1,0,this.direction1),w.l.FromArrayToRef(d.direction2,0,this.direction2),d.meshId&&t&&(this.mesh=t.getLastMeshById(d.meshId)),this.useMeshNormalsForDirection=d.useMeshNormalsForDirection}}var v=A(10829);class m{_isUbo(d){return void 0!==d.addUniform}constructor(d){this._isUbo(d)?(this.setMatrix3x3=d.updateMatrix3x3.bind(d),this.setMatrix2x2=d.updateMatrix2x2.bind(d),this.setFloat=d.updateFloat.bind(d),this.setFloat2=d.updateFloat2.bind(d),this.setFloat3=d.updateFloat3.bind(d),this.setFloat4=d.updateFloat4.bind(d),this.setFloatArray=d.updateFloatArray.bind(d),this.setArray=d.updateArray.bind(d),this.setIntArray=d.updateIntArray.bind(d),this.setMatrix=d.Fj.bind(d),this.setMatrices=d.updateMatrices.bind(d),this.setVector3=d.updateVector3.bind(d),this.setVector4=d.updateVector4.bind(d),this.setColor3=d.updateColor3.bind(d),this.setColor4=d.updateColor4.bind(d),this.setDirectColor4=d.updateDirectColor4.bind(d),this.setInt=d.updateInt.bind(d),this.setInt2=d.updateInt2.bind(d),this.setInt3=d.updateInt3.bind(d),this.setInt4=d.updateInt4.bind(d)):(this.setMatrix3x3=d.setMatrix3x3.bind(d),this.setMatrix2x2=d.setMatrix2x2.bind(d),this.setFloat=d.setFloat.bind(d),this.setFloat2=d.setFloat2.bind(d),this.setFloat3=d.setFloat3.bind(d),this.setFloat4=d.setFloat4.bind(d),this.setFloatArray=d.setFloatArray.bind(d),this.setArray=d.setArray.bind(d),this.setIntArray=d.setIntArray.bind(d),this.setMatrix=d.setMatrix.bind(d),this.setMatrices=d.setMatrices.bind(d),this.setVector3=d.setVector3.bind(d),this.setVector4=d.setVector4.bind(d),this.setColor3=d.setColor3.bind(d),this.setColor4=d.setColor4.bind(d),this.setDirectColor4=d.setDirectColor4.bind(d),this.setInt=d.setInt.bind(d),this.setInt2=d.setInt2.bind(d),this.setInt3=d.setInt3.bind(d),this.setInt4=d.setInt4.bind(d))}}var j=A(10837);const n="gpuUpdateParticlesPixelShader",R="#version 300 es\nvoid main() {discard;}\n";j.c.ShadersStore[n]=R;const Z="gpuUpdateParticlesVertexShader",L="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";j.c.ShadersStore[Z]=L;(0,X.g)("BABYLON.WebGL2ParticleSystem",class{constructor(d,t){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=d,this._engine=t,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","i","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var d;return(null===(d=this._updateEffect)||void 0===d?void 0:d.isReady())??!1}createUpdateBuffer(d){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=d,this._updateEffect=new v.e("gpuUpdateParticles",this._updateEffectOptions,this._engine),new m(this._updateEffect)}createVertexBuffers(d,t){this._updateVAO.push(this._createUpdateVAO(d)),this._renderVAO.push(this._engine.recordVertexArrayObject(t,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=t}createParticleBuffer(d){return d}bindDrawBuffers(d,t,A){A?this._engine.bindBuffers(this._renderVertexBuffers,A,t):this._engine.bindVertexArrayObject(this._renderVAO[d],null)}preUpdateParticleBuffer(){const d=this._engine;if(this._engine.enableEffect(this._updateEffect),!d.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(d,t,A){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[d],null);const w=this._engine;w.bindTransformFeedbackBuffer(t.getBuffer()),w.setRasterizerState(!1),w.beginTransformFeedback(!0),w.drawArraysType(3,0,A),w.endTransformFeedback(),w.setRasterizerState(!0),w.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let d=0;d<this._updateVAO.length;d++)this._engine.releaseVertexArrayObject(this._updateVAO[d]);this._updateVAO.length=0;for(let d=0;d<this._renderVAO.length;d++)this._engine.releaseVertexArrayObject(this._renderVAO[d]);this._renderVAO.length=0}_createUpdateVAO(d){const t={};t.position=d.createVertexBuffer("position",0,3);let A=3;t.age=d.createVertexBuffer("age",A,1),A+=1,t.size=d.createVertexBuffer("size",A,3),A+=3,t.life=d.createVertexBuffer("life",A,1),A+=1,t.seed=d.createVertexBuffer("seed",A,4),A+=4,t.direction=d.createVertexBuffer("direction",A,3),A+=3,this._parent.particleEmitterType instanceof q&&(t.initialPosition=d.createVertexBuffer("initialPosition",A,3),A+=3),this._parent._colorGradientsTexture||(t.color=d.createVertexBuffer("color",A,4),A+=4),this._parent._isBillboardBased||(t.initialDirection=d.createVertexBuffer("initialDirection",A,3),A+=3),this._parent.noiseTexture&&(t.noiseCoordinates1=d.createVertexBuffer("noiseCoordinates1",A,3),A+=3,t.noiseCoordinates2=d.createVertexBuffer("noiseCoordinates2",A,3),A+=3),this._parent._angularSpeedGradientsTexture?(t.angle=d.createVertexBuffer("angle",A,1),A+=1):(t.angle=d.createVertexBuffer("angle",A,2),A+=2),this._parent._isAnimationSheetEnabled&&(t.cellIndex=d.createVertexBuffer("cellIndex",A,1),A+=1,this._parent.spriteRandomStartCell&&(t.cellStartOffset=d.createVertexBuffer("cellStartOffset",A,1),A+=1));const w=this._engine.recordVertexArrayObject(t,null,this._updateEffect);return this._engine.bindArrayBuffer(null),w}});class I{constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,w=arguments.length>3?arguments[3]:void 0;this._engine=d,this._label=w,this._engine._storageBuffers.push(this),this._create(t,A)}_create(d,t){this._bufferSize=d,this._creationFlags=t,this._buffer=this._engine.createStorageBuffer(d,t,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(d,t,A){this._buffer&&this._engine.updateStorageBuffer(this._buffer,d,t,A)}read(d,t,A,w){return this._engine.readFromStorageBuffer(this._buffer,d,t,A,w)}dispose(){const d=this._engine._storageBuffers,t=d.indexOf(this);-1!==t&&(d[t]=d[d.length-1],d.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var u=A(11041),V=A(11047),h=A(11097),l=A(11264),y=A(11189),s=A(10740),Y=A(10863),r=A(10901);class K{constructor(){this._gpuTimeInFrameId=-1,this.counter=new r.d}_addDuration(d,t){d<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==d?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(t,!1),this._gpuTimeInFrameId=d):this.counter.addCount(t,!1))}}class G{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=d,this._engine=t,this.uniqueId=y.e.UniqueId,t.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new K),this._engine.getCaps().supportComputeShaders?w.bindingsMapping?(this._context=t.createComputeContext(),this._shaderPath=A,this._options={bindingsMapping:{},defines:[],...w}):s.e.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):s.e.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const w=this._bindings[d];this._bindings[d]={type:A?0:4,object:t,indexInGroupEntries:null===w||void 0===w?void 0:w.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!w||w.object!==t||w.type!==this._bindings[d].type)}setStorageTexture(d,t){const A=this._bindings[d];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==t),this._bindings[d]={type:1,object:t,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setExternalTexture(d,t){const A=this._bindings[d];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==t),this._bindings[d]={type:6,object:t,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setVideoTexture(d,t){return!!t.externalTexture&&(this.setExternalTexture(d,t.externalTexture),!0)}setUniformBuffer(d,t){const A=this._bindings[d];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==t),this._bindings[d]={type:G._BufferIsDataBuffer(t)?7:2,object:t,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setStorageBuffer(d,t){const A=this._bindings[d];this._contextIsDirty||(this._contextIsDirty=!A||A.object!==t),this._bindings[d]={type:G._BufferIsDataBuffer(t)?7:3,object:t,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}setTextureSampler(d,t){const A=this._bindings[d];this._contextIsDirty||(this._contextIsDirty=!A||!t.compareSampler(A.object)),this._bindings[d]={type:5,object:t,indexInGroupEntries:null===A||void 0===A?void 0:A.indexInGroupEntries}}isReady(){let d=this._effect;for(const N in this._bindings){const d=this._bindings[N],t=d.type,A=d.object;switch(t){case 0:case 4:case 1:if(!A.isReady())return!1;break;case 6:if(!A.isReady())return!1;break}}const t=[],A=this._shaderPath;if(this._options.defines)for(let N=0;N<this._options.defines.length;N++)t.push(this._options.defines[N]);const w=t.join("\n");return this._cachedDefines!==w&&(this._cachedDefines=w,d=this._engine.createComputeEffect(A,{defines:w,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=d),!!d.isReady()}dispatch(d,t,A){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,d,t,A,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const A=G._BufferIsDataBuffer(d)?d:d.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,A,t,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const t in this._bindings){const A=this._bindings[t];if(!this._options.bindingsMapping[t])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+t+"'");switch(A.type){case 0:{const w=this._samplers[t],N=A.object;var d;if(!w||!N._texture||!w.compareSampler(N._texture))this._samplers[t]=(new Y.d).setParameters(N.wrapU,N.wrapV,N.wrapR,N.anisotropicFilteringLevel,N._texture.samplingMode,null===(d=N._texture)||void 0===d?void 0:d._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const d=A.object;d.getBuffer()!==A.buffer&&(A.buffer=d.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((N=>{const p=()=>{this.dispatch(d,t,A)?N():setTimeout(p,w)};p()}))}serialize(){const d=h.d.Serialize(this);d.options=this._options,d.shaderPath=this._shaderPath,d.uj={},d.textures={};for(const t in this._bindings){const A=this._bindings[t],w=A.object;switch(A.type){case 0:case 4:case 1:{const N=w.serialize();N&&(d.textures[t]=N,d.uj[t]={type:A.type});break}}}return d}static Parse(d,t,A){const w=h.d.Parse((()=>new G(d.name,t.getEngine(),d.shaderPath,d.options)),d,t,A);for(const N in d.textures){const p=d.uj[N],B=l.c.Parse(d.textures[N],t,A);0===p.type?w.setTexture(N,B):4===p.type?w.setTexture(N,B,!1):w.setStorageTexture(N,B)}return w}static _BufferIsDataBuffer(d){return void 0!==d.underlyingResource}}(0,u.b)([(0,V.J)()],G.prototype,"name",void 0),(0,u.b)([(0,V.J)()],G.prototype,"fastMode",void 0),(0,X.g)("BABYLON.ComputeShader",G);var O=A(11108);const z="gpuUpdateParticlesComputeShader",c="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";j.c.ShadersStoreWGSL[z]=c;(0,X.g)("BABYLON.ComputeShaderParticleSystem",class{constructor(d,t){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=d,this._engine=t}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var d;return(null===(d=this._updateComputeShader)||void 0===d?void 0:d.isReady())??!1}createUpdateBuffer(d){var t;const A={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(A.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(A.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(A.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(A.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(A.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(A.noiseTexture={group:1,binding:11}),this._updateComputeShader=new G("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:A,defines:d.split("\n")}),null===(t=this._simParamsComputeShader)||void 0===t||t.dispose(),this._simParamsComputeShader=new O.e(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new m(this._simParamsComputeShader)}createVertexBuffers(d,t){this._renderVertexBuffers.push(t)}createParticleBuffer(d){const t=new I(this._engine,4*d.length,11,"ComputeShaderParticleSystemBuffer");return t.update(d),this._bufferComputeShader.push(t),t.getBuffer()}bindDrawBuffers(d,t,A){this._engine.bindBuffers(this._renderVertexBuffers[d],A,t)}preUpdateParticleBuffer(){}updateParticleBuffer(d,t,A){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[d]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^d]),this._updateComputeShader.dispatch(Math.ceil(A/64))}releaseBuffers(){var d;for(let t=0;t<this._bufferComputeShader.length;++t)this._bufferComputeShader[t].dispose();this._bufferComputeShader.length=0,null===(d=this._simParamsComputeShader)||void 0===d||d.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class e{constructor(d,t,A){this.gradient=d,this.color1=t,this.color2=A}getColorToRef(d){this.color2?B.i.LerpToRef(this.color1,this.color2,Math.random(),d):d.p(this.color1)}}class M{constructor(d,t){this.gradient=d,this.color=t}}class x{constructor(d,t,A){this.gradient=d,this.factor1=t,this.factor2=A}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class o{static GetCurrentGradient(d,t,A){if(t[0].gradient>d)return void A(t[0],t[0],1);for(let N=0;N<t.length-1;N++){const w=t[N],p=t[N+1];if(d>=w.gradient&&d<=p.gradient){return void A(w,p,(d-w.gradient)/(p.gradient-w.gradient))}}const w=t.length-1;A(t[w],t[w],1)}}var C=A(10730),E=A(11499),g=A(10775);class S{constructor(d){this.particleSystem=d,this.position=w.l.Zero(),this.direction=w.l.Zero(),this.color=new B.i(0,0,0,0),this.colorStep=new B.i(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new w.j(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new B.i(0,0,0,0),this._currentColor2=new B.i(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=S._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let d=this.age,t=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===t?(t=1,d=this._randomCellOffset):d+=this._randomCellOffset);const A=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let w;w=this._initialSpriteCellLoop?(0,a.e)(d*t%this.lifeTime/this.lifeTime):(0,a.e)(d*t/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+w*A|0}_inheritParticleInfoToSubEmitter(d){if(d.particleSystem.k.position){const t=d.particleSystem.k;if(t.position.p(this.position),d.inheritDirection){const d=w.h.gb[0];this.direction.normalizeToRef(d),t.setDirection(d,0,Math.PI/2)}}else{d.particleSystem.k.p(this.position)}this.direction.scaleToRef(d.inheritedVelocityAmount/2,w.h.gb[0]),d.particleSystem._inheritedVelocityOffset.p(w.h.gb[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((d=>{this._inheritParticleInfoToSubEmitter(d)}))}_reset(){this.age=0,this.id=S._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(d){d.position.p(this.position),this._initialDirection?d._initialDirection?d._initialDirection.p(this._initialDirection):d._initialDirection=this._initialDirection.clone():d._initialDirection=null,d.direction.p(this.direction),this.Cf&&(d.Cf?d.Cf.p(this.Cf):d.Cf=this.Cf.clone()),d.color.p(this.color),d.colorStep.p(this.colorStep),d.lifeTime=this.lifeTime,d.age=this.age,d._randomCellOffset=this._randomCellOffset,d.size=this.size,d.scale.p(this.scale),d.angle=this.angle,d.angularSpeed=this.angularSpeed,d.particleSystem=this.particleSystem,d.cellIndex=this.cellIndex,d.id=this.id,d._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(d._currentColorGradient=this._currentColorGradient,d._currentColor1.p(this._currentColor1),d._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(d._currentSizeGradient=this._currentSizeGradient,d._currentSize1=this._currentSize1,d._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(d._currentAngularSpeedGradient=this._currentAngularSpeedGradient,d._currentAngularSpeed1=this._currentAngularSpeed1,d._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(d._currentVelocityGradient=this._currentVelocityGradient,d._currentVelocity1=this._currentVelocity1,d._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(d._currentLimitVelocityGradient=this._currentLimitVelocityGradient,d._currentLimitVelocity1=this._currentLimitVelocity1,d._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(d._currentDragGradient=this._currentDragGradient,d._currentDrag1=this._currentDrag1,d._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(d._initialStartSpriteCellID=this._initialStartSpriteCellID,d._initialEndSpriteCellID=this._initialEndSpriteCellID,d._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(d.remapData&&this.remapData?d.remapData.p(this.remapData):d.remapData=new w.m(0,0,0,0)),this._randomNoiseCoordinates1&&(d._randomNoiseCoordinates1?(d._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),d._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(d._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),d._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}S._Count=0;var dd=A(11239),td=(A(11506),A(11254)),Ad=A(11246),wd=A(11106);class Nd extends W{set onDispose(d){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(d)}get useRampGradients(){return this._useRampGradients}set useRampGradients(d){this._useRampGradients!==d&&(this._useRampGradients=d,this._resetEffect())}get particles(){return this.pj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.pj.length}getClassName(){return"wb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var d;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(d=this._customWrappers[t])||void 0===d?void 0:d.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[d]??this._customWrappers[0]}setCustomEffect(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[t]=new dd.b(this._engine),this._customWrappers[t].effect=d,this._customWrappers[t].drawContext&&(this._customWrappers[t].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4],X=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(d),this._emitterInverseWorldMatrix=w.c.Identity(),this._inheritedVelocityOffset=new w.l,this.hj=new C.b,this.onStoppedObservable=new C.b,this.pj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new B.i(0,0,0,0),this._colorDiff=new B.i(0,0,0,0),this._scaledDirection=w.l.Zero(),this._scaledGravity=w.l.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=d=>{},this.recycleParticle=d=>{const t=this.pj.pop();t!==d&&t.copyTo(d),this._stockParticles.push(t)},this._createParticle=()=>{let d;return 0!==this._stockParticles.length?(d=this._stockParticles.pop(),d._reset()):d=new S(this),this._prepareParticle(d),d},this._shadersLoaded=!1,this._capacity=t,this._epsilon=X,this._isAnimationSheetEnabled=p,A&&"Scene"!==A.getClassName()?(this._engine=A,this.defaultProjectionMatrix=w.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=A||g.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.nj.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new dd.b(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new i;let W=null;this.updateFunction=d=>{let t=null;var A;this.noiseTexture&&(t=this.noiseTexture.getSize(),null===(A=this.noiseTexture.getContent())||void 0===A||A.then((d=>{W=d})));const N=d===this.pj;for(let p=0;p<d.length;p++){const A=d[p];let X=this._scaledUpdateSpeed;const D=A.age;if(A.age+=X,A.age>A.lifeTime){const d=A.age-D;X=(A.lifeTime-D)*X/d,A.age=A.lifeTime}const i=A.age/A.lifeTime;this._colorGradients&&this._colorGradients.length>0?o.GetCurrentGradient(i,this._colorGradients,((d,t,w)=>{d!==A._currentColorGradient&&(A._currentColor1.p(A._currentColor2),t.getColorToRef(A._currentColor2),A._currentColorGradient=d),B.i.LerpToRef(A._currentColor1,A._currentColor2,w,A.color)})):(A.colorStep.scaleToRef(X,this._scaledColorStep),A.color.addInPlace(this._scaledColorStep),A.color.a<0&&(A.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&o.GetCurrentGradient(i,this._angularSpeedGradients,((d,t,w)=>{d!==A._currentAngularSpeedGradient&&(A._currentAngularSpeed1=A._currentAngularSpeed2,A._currentAngularSpeed2=t.getFactor(),A._currentAngularSpeedGradient=d),A.angularSpeed=(0,a.o)(A._currentAngularSpeed1,A._currentAngularSpeed2,w)})),A.angle+=A.angularSpeed*X;let k=X;if(this._velocityGradients&&this._velocityGradients.length>0&&o.GetCurrentGradient(i,this._velocityGradients,((d,t,w)=>{d!==A._currentVelocityGradient&&(A._currentVelocity1=A._currentVelocity2,A._currentVelocity2=t.getFactor(),A._currentVelocityGradient=d),k*=(0,a.o)(A._currentVelocity1,A._currentVelocity2,w)})),A.direction.scaleToRef(k,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&o.GetCurrentGradient(i,this._limitVelocityGradients,((d,t,w)=>{d!==A._currentLimitVelocityGradient&&(A._currentLimitVelocity1=A._currentLimitVelocity2,A._currentLimitVelocity2=t.getFactor(),A._currentLimitVelocityGradient=d);const N=(0,a.o)(A._currentLimitVelocity1,A._currentLimitVelocity2,w);A.direction.length()>N&&A.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&o.GetCurrentGradient(i,this._dragGradients,((d,t,w)=>{d!==A._currentDragGradient&&(A._currentDrag1=A._currentDrag2,A._currentDrag2=t.getFactor(),A._currentDragGradient=d);const N=(0,a.o)(A._currentDrag1,A._currentDrag2,w);this._scaledDirection.scaleInPlace(1-N)})),this.isLocal&&A.Cf?(A.Cf.addInPlace(this._scaledDirection),w.l.TransformCoordinatesToRef(A.Cf,this._emitterWorldMatrix,A.position)):A.position.addInPlace(this._scaledDirection),W&&t&&A._randomNoiseCoordinates1){const d=this._fetchR(A._randomNoiseCoordinates1.x,A._randomNoiseCoordinates1.y,t.width,t.height,W),N=this._fetchR(A._randomNoiseCoordinates1.z,A._randomNoiseCoordinates2.x,t.width,t.height,W),p=this._fetchR(A._randomNoiseCoordinates2.y,A._randomNoiseCoordinates2.z,t.width,t.height,W),B=w.h.gb[0],a=w.h.gb[1];B.wf((2*d-1)*this.noiseStrength.x,(2*N-1)*this.noiseStrength.y,(2*p-1)*this.noiseStrength.z),B.scaleToRef(X,a),A.direction.addInPlace(a)}this.gravity.scaleToRef(X,this._scaledGravity),A.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&o.GetCurrentGradient(i,this._sizeGradients,((d,t,w)=>{d!==A._currentSizeGradient&&(A._currentSize1=A._currentSize2,A._currentSize2=t.getFactor(),A._currentSizeGradient=d),A.size=(0,a.o)(A._currentSize1,A._currentSize2,w)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&o.GetCurrentGradient(i,this._colorRemapGradients,((d,t,w)=>{const N=(0,a.o)(d.factor1,t.factor1,w),p=(0,a.o)(d.factor2,t.factor2,w);A.remapData.x=N,A.remapData.y=p-N})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&o.GetCurrentGradient(i,this._alphaRemapGradients,((d,t,w)=>{const N=(0,a.o)(d.factor1,t.factor1,w),p=(0,a.o)(d.factor2,t.factor2,w);A.remapData.z=N,A.remapData.w=p-N}))),this._isAnimationSheetEnabled&&A.updateCellIndex(),A._inheritParticleInfoToSubEmitters(),A.age>=A.lifeTime&&(this._emitFromParticle(A),A._attachedSubEmitters&&(A._attachedSubEmitters.forEach((d=>{d.particleSystem.disposeOnStop=!0,d.particleSystem.stop()})),A._attachedSubEmitters=null),this.recycleParticle(A),N&&p--)}}}serialize(d){throw new Error("Method not implemented.")}clone(d,t){throw new Error("Method not implemented.")}_addFactorGradient(d,t,A,w){const N=new x(t,A,w);d.push(N),d.sort(((d,t)=>d.gradient<t.gradient?-1:d.gradient>t.gradient?1:0))}_removeFactorGradient(d,t){if(!d)return;let A=0;for(const w of d){if(w.gradient===t){d.splice(A,1);break}A++}}addLifeTimeGradient(d,t,A){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,d,t,A),this}removeLifeTimeGradient(d){return this._removeFactorGradient(this._lifeTimeGradients,d),this}addSizeGradient(d,t,A){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,d,t,A),this}removeSizeGradient(d){return this._removeFactorGradient(this._sizeGradients,d),this}addColorRemapGradient(d,t,A){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,d,t,A),this}removeColorRemapGradient(d){return this._removeFactorGradient(this._colorRemapGradients,d),this}addAlphaRemapGradient(d,t,A){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,d,t,A),this}removeAlphaRemapGradient(d){return this._removeFactorGradient(this._alphaRemapGradients,d),this}addAngularSpeedGradient(d,t,A){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,d,t,A),this}removeAngularSpeedGradient(d){return this._removeFactorGradient(this._angularSpeedGradients,d),this}addVelocityGradient(d,t,A){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,d,t,A),this}removeVelocityGradient(d){return this._removeFactorGradient(this._velocityGradients,d),this}addLimitVelocityGradient(d,t,A){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,d,t,A),this}removeLimitVelocityGradient(d){return this._removeFactorGradient(this._limitVelocityGradients,d),this}addDragGradient(d,t,A){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,d,t,A),this}removeDragGradient(d){return this._removeFactorGradient(this._dragGradients,d),this}addEmitRateGradient(d,t,A){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,d,t,A),this}removeEmitRateGradient(d){return this._removeFactorGradient(this._emitRateGradients,d),this}addStartSizeGradient(d,t,A){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,d,t,A),this}removeStartSizeGradient(d){return this._removeFactorGradient(this._startSizeGradients,d),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const d=new Uint8Array(4*this._rawTextureWidth),t=B.j.jb[0];for(let A=0;A<this._rawTextureWidth;A++){const w=A/this._rawTextureWidth;o.GetCurrentGradient(w,this._rampGradients,((w,N,p)=>{B.e.LerpToRef(w.color,N.color,p,t),d[4*A]=255*t.r,d[4*A+1]=255*t.g,d[4*A+2]=255*t.b,d[4*A+3]=255}))}this._rampGradientsTexture=E.b.CreateRGBATexture(d,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((d,t)=>d.gradient<t.gradient?-1:d.gradient>t.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(d,t){this._rampGradients||(this._rampGradients=[]);const A=new M(d,t);return this._rampGradients.push(A),this._syncRampGradientTexture(),this}removeRampGradient(d){return this._removeGradientAndTexture(d,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(d,t,A){this._colorGradients||(this._colorGradients=[]);const w=new e(d,t,A);return this._colorGradients.push(w),this._colorGradients.sort(((d,t)=>d.gradient<t.gradient?-1:d.gradient>t.gradient?1:0)),this}removeColorGradient(d){if(!this._colorGradients)return this;let t=0;for(const A of this._colorGradients){if(A.gradient===d){this._colorGradients.splice(t,1);break}t++}return this}resetDrawCache(){for(const d of this._drawWrappers)if(d)for(const t of d)null===t||void 0===t||t.dispose();this._drawWrappers=[]}_fetchR(d,t,A,w,N){return N[4*(((d=.5*Math.abs(d)+.5)*A%A|0)+((t=.5*Math.abs(t)+.5)*w%w|0)*A)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const d=this._engine,t=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*t),this._vertexBuffer=new H.d(d,this._vertexData,!0,t);let A=0;const w=this._vertexBuffer.createVertexBuffer(H.f.PositionKind,A,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[H.f.PositionKind]=w,A+=3;const N=this._vertexBuffer.createVertexBuffer(H.f.ColorKind,A,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[H.f.ColorKind]=N,A+=4;const p=this._vertexBuffer.createVertexBuffer("angle",A,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=p,A+=1;const B=this._vertexBuffer.createVertexBuffer("size",A,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=B,A+=2,this._isAnimationSheetEnabled){const d=this._vertexBuffer.createVertexBuffer("cellIndex",A,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=d,A+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const d=this._vertexBuffer.createVertexBuffer("direction",A,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=d,A+=3}if(this._useRampGradients){const d=this._vertexBuffer.createVertexBuffer("remapData",A,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=d,A+=4}let X;if(this._useInstancing){const t=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new H.d(d,t,!1,2),X=this._spriteBuffer.createVertexBuffer("offset",0,2)}else X=this._vertexBuffer.createVertexBuffer("offset",A,2,this._vertexBufferSize,this._useInstancing),A+=2;this._vertexBuffers.offset=X,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const d=[],t=[];let A=0;for(let w=0;w<this._capacity;w++)d.push(A),d.push(A+1),d.push(A+2),d.push(A),d.push(A+2),d.push(A+3),t.push(A,A+1,A+1,A+2,A+2,A+3,A+3,A,A,A+3),A+=4;this._indexBuffer=this._engine.createIndexBuffer(d),this._linesIndexBuffer=this._engine.createIndexBuffer(t)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(d)setTimeout((()=>{this.start(0)}),d);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var t;-1!==(null===(t=this.k)||void 0===t?void 0:t.getClassName().indexOf("Mesh"))&&this.k.Nj(!0);const d=this.noiseTexture;if(d&&d.onGeneratedObservable)d.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let t=0;t<this.preWarmCycles;t++)this.animate(!0),d.render()}))}));else for(let t=0;t<this.preWarmCycles;t++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(d))}_postStop(d){}reset(){this._stockParticles.length=0,this.pj.length=0}_appendParticleVertex(d,t,A,N){let p=d*this._vertexBufferSize;if(this._vertexData[p++]=t.position.x+this.uf.x,this._vertexData[p++]=t.position.y+this.uf.y,this._vertexData[p++]=t.position.z+this.uf.z,this._vertexData[p++]=t.color.r,this._vertexData[p++]=t.color.g,this._vertexData[p++]=t.color.b,this._vertexData[p++]=t.color.a,this._vertexData[p++]=t.angle,this._vertexData[p++]=t.scale.x*t.size,this._vertexData[p++]=t.scale.y*t.size,this._isAnimationSheetEnabled&&(this._vertexData[p++]=t.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[p++]=t.direction.x,this._vertexData[p++]=t.direction.y,this._vertexData[p++]=t.direction.z);else if(t._initialDirection){let d=t._initialDirection;this.isLocal&&(w.l.TransformNormalToRef(d,this._emitterWorldMatrix,w.h.gb[0]),d=w.h.gb[0]),0===d.x&&0===d.z&&(d.x=.001),this._vertexData[p++]=d.x,this._vertexData[p++]=d.y,this._vertexData[p++]=d.z}else{let d=t.direction;this.isLocal&&(w.l.TransformNormalToRef(d,this._emitterWorldMatrix,w.h.gb[0]),d=w.h.gb[0]),0===d.x&&0===d.z&&(d.x=.001),this._vertexData[p++]=d.x,this._vertexData[p++]=d.y,this._vertexData[p++]=d.z}this._useRampGradients&&t.remapData&&(this._vertexData[p++]=t.remapData.x,this._vertexData[p++]=t.remapData.y,this._vertexData[p++]=t.remapData.z,this._vertexData[p++]=t.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===A?A=this._epsilon:1===A&&(A=1-this._epsilon),0===N?N=this._epsilon:1===N&&(N=1-this._epsilon)),this._vertexData[p++]=A,this._vertexData[p++]=N)}_prepareParticle(d){}_update(d){if(this._alive=this.pj.length>0,this.k.position){const d=this.k;this._emitterWorldMatrix=d.getWorldMatrix()}else{const d=this.k;this._emitterWorldMatrix=w.c.Translation(d.x,d.y,d.z)}let t;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.pj);for(let A=0;A<d&&this.pj.length!==this._capacity;A++){if(t=this._createParticle(),this.pj.push(t),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const d=(0,a.e)(this._actualFrame/this.targetStopDuration);o.GetCurrentGradient(d,this._lifeTimeGradients,((A,w)=>{const N=A,p=w,B=N.getFactor(),X=p.getFactor(),W=(d-N.gradient)/(p.gradient-N.gradient);t.lifeTime=(0,a.o)(B,X,W)}))}else t.lifeTime=(0,a.t)(this.minLifeTime,this.maxLifeTime);const d=(0,a.t)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,t.position,t,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,t.position,t,this.isLocal),this.isLocal&&(t.Cf?t.Cf.p(t.position):t.Cf=t.position.clone(),w.l.TransformCoordinatesToRef(t.Cf,this._emitterWorldMatrix,t.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,t.direction,t,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,t.direction,t,this.isLocal,this._emitterInverseWorldMatrix),0===d?t._initialDirection?t._initialDirection.p(t.direction):t._initialDirection=t.direction.clone():t._initialDirection=null,t.direction.scaleInPlace(d),this._sizeGradients&&0!==this._sizeGradients.length?(t._currentSizeGradient=this._sizeGradients[0],t._currentSize1=t._currentSizeGradient.getFactor(),t.size=t._currentSize1,this._sizeGradients.length>1?t._currentSize2=this._sizeGradients[1].getFactor():t._currentSize2=t._currentSize1):t.size=(0,a.t)(this.minSize,this.maxSize),t.scale.wf((0,a.t)(this.minScaleX,this.maxScaleX),(0,a.t)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const d=this._actualFrame/this.targetStopDuration;o.GetCurrentGradient(d,this._startSizeGradients,((d,A,w)=>{d!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=A.getFactor(),this._currentStartSizeGradient=d);const N=(0,a.o)(this._currentStartSize1,this._currentStartSize2,w);t.scale.scaleInPlace(N)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(t._currentAngularSpeedGradient=this._angularSpeedGradients[0],t.angularSpeed=t._currentAngularSpeedGradient.getFactor(),t._currentAngularSpeed1=t.angularSpeed,this._angularSpeedGradients.length>1?t._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():t._currentAngularSpeed2=t._currentAngularSpeed1):t.angularSpeed=(0,a.t)(this.minAngularSpeed,this.maxAngularSpeed),t.angle=(0,a.t)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(t._currentVelocityGradient=this._velocityGradients[0],t._currentVelocity1=t._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?t._currentVelocity2=this._velocityGradients[1].getFactor():t._currentVelocity2=t._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(t._currentLimitVelocityGradient=this._limitVelocityGradients[0],t._currentLimitVelocity1=t._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?t._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():t._currentLimitVelocity2=t._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(t._currentDragGradient=this._dragGradients[0],t._currentDrag1=t._currentDragGradient.getFactor(),this._dragGradients.length>1?t._currentDrag2=this._dragGradients[1].getFactor():t._currentDrag2=t._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)t._currentColorGradient=this._colorGradients[0],t._currentColorGradient.getColorToRef(t.color),t._currentColor1.p(t.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(t._currentColor2):t._currentColor2.p(t.color);else{const d=(0,a.t)(0,1);B.i.LerpToRef(this.color1,this.color2,d,t.color),this.colorDead.subtractToRef(t.color,this._colorDiff),this._colorDiff.scaleToRef(1/t.lifeTime,t.colorStep)}this._isAnimationSheetEnabled&&(t._initialStartSpriteCellID=this.startSpriteCellID,t._initialEndSpriteCellID=this.endSpriteCellID,t._initialSpriteCellLoop=this.spriteCellLoop),t.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(t.remapData=new w.m(0,1,0,1)),this.noiseTexture&&(t._randomNoiseCoordinates1?(t._randomNoiseCoordinates1.wf(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2.wf(Math.random(),Math.random(),Math.random())):(t._randomNoiseCoordinates1=new w.l(Math.random(),Math.random(),Math.random()),t._randomNoiseCoordinates2=new w.l(Math.random(),Math.random(),Math.random()))),t._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=[H.f.PositionKind,H.f.ColorKind,"angle","offset","size"];return d&&w.push("cellIndex"),t||w.push("direction"),A&&w.push("remapData"),w}static _GetEffectCreationOptions(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,td.e)(w),d&&w.push("particlesInfos"),t&&w.push("logarithmicDepthConstant"),A&&(w.push("vFogInfos"),w.push("vFogColor")),w}fillDefines(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,td.l)(this,this._scene,d),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&d.push("#define FOG")),this._isAnimationSheetEnabled&&d.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&d.push("#define LOGARITHMICDEPTH"),t===W.BLENDMODE_MULTIPLY&&d.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&d.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(d.push("#define BILLBOARD"),this.billboardMode){case 2:d.push("#define BILLBOARDY");break;case 8:case 9:d.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&d.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:d.push("#define BILLBOARDMODE_ALL")}A&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),d.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(d,t,A){t.push(...Nd._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),d.push(...Nd._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),A.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,wd.f)(d,this._imageProcessingConfigurationDefines),(0,wd.c)(A,this._imageProcessingConfigurationDefines))}_getWrapper(d){const t=this._getCustomDrawWrapper(d);if(null!==t&&void 0!==t&&t.effect)return t;const A=[];this.fillDefines(A,d);const w=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let N=this._drawWrappers[w];N||(N=this._drawWrappers[w]=[]);let p=N[d];p||(p=new dd.b(this._engine),p.drawContext&&(p.drawContext.useInstancing=this._useInstancing),N[d]=p);const B=A.join("\n");if(p.defines!==B){const d=[],t=[],A=[];this.fillUniformsAttributesAndSamplerNames(t,d,A),p.setEffect(this._engine.createEffect("particles",d,t,A,B,void 0,void 0,void 0,void 0,this._shaderLanguage),B)}return p}animate(){var d;let t,A=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!A&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(A?this.preWarmStepOffset:(null===(d=this._scene)||void 0===d?void 0:d.getAnimationRatio())||1),this.manualEmitCount>-1)t=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let d=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const t=this._actualFrame/this.targetStopDuration;o.GetCurrentGradient(t,this._emitRateGradients,((t,A,w)=>{t!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=A.getFactor(),this._currentEmitRateGradient=t),d=(0,a.o)(this._currentEmitRate1,this._currentEmitRate2,w)}))}t=d*this._scaledUpdateSpeed|0,this._newPartsExcess+=d*this._scaledUpdateSpeed-t}if(this._newPartsExcess>1&&(t+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?t=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(t),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!A){let d=0;for(let t=0;t<this.pj.length;t++){const A=this.pj[t];this._appendParticleVertices(d,A),d+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.pj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(d,t){this._appendParticleVertex(d++,t,0,0),this._useInstancing||(this._appendParticleVertex(d++,t,1,0),this._appendParticleVertex(d++,t,1,1),this._appendParticleVertex(d++,t,0,1))}rebuild(){var d;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(d=this._spriteBuffer)||void 0===d||d._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!Nd.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(A.bind(A,11821)),Promise.resolve().then(A.bind(A,11755))])):await Promise.all([Promise.resolve().then(A.bind(A,11743)),Promise.resolve().then(A.bind(A,11729))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==W.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(W.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(W.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(d){const t=this._getWrapper(d),A=t.effect,N=this._engine;N.enableEffect(t);const p=this.defaultViewMatrix??this._scene.getViewMatrix();if(A.setTexture("diffuseSampler",this.particleTexture),A.setMatrix("view",p),A.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const d=this.particleTexture.getBaseSize();A.setFloat3("particlesInfos",this.spriteCellWidth/d.width,this.spriteCellHeight/d.height,this.spriteCellWidth/d.width)}if(A.setVector2("translationPivot",this.translationPivot),A.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const d=this._scene.activeCamera;A.setVector3("eyePosition",d.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),A.setTexture("rampSampler",this._rampGradientsTexture));const B=A.defines;var X,a,D,i,k,b;(this._scene&&((0,td.g)(A,this,this._scene),this.applyFog&&(0,Ad.e)(this._scene,void 0,A)),B.indexOf("#define BILLBOARDMODE_ALL")>=0&&(p.invertToRef(w.h.Matrix[0]),A.setMatrix("invView",w.h.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?N.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,A):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,A)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(a=this._scene)&&void 0!==a&&a.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?N.bindBuffers(this._vertexBuffers,null!==(D=this._scene)&&void 0!==D&&D.forceWireframe?this._linesIndexBuffer:this._indexBuffer,A):N.bindBuffers(this._vertexBuffers,null!==(i=this._scene)&&void 0!==i&&i.forceWireframe?this._linesIndexBufferUseInstancing:null,A);switch(this.useLogarithmicDepth&&this._scene&&(0,Ad.k)(B,A,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(A),d){case W.BLENDMODE_ADD:N.setAlphaMode(1);break;case W.BLENDMODE_ONEONE:N.setAlphaMode(6);break;case W.BLENDMODE_STANDARD:N.setAlphaMode(2);break;case W.BLENDMODE_MULTIPLY:N.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(A),this._useInstancing)?null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?N.drawElementsType(6,0,10,this.pj.length):N.drawArraysType(7,0,4,this.pj.length):null!==(b=this._scene)&&void 0!==b&&b.forceWireframe?N.drawElementsType(1,0,10*this.pj.length):N.drawElementsType(0,0,6*this.pj.length);return this.pj.length}render(){if(!this.isReady()||!this.pj.length)return 0;const d=this._engine;d.setState&&(d.setState(!1),this.forceDepthWrite&&d.setDepthWrite(!0));let t=0;return t=this.blendMode===W.BLENDMODE_MULTIPLYADD?this._render(W.BLENDMODE_MULTIPLY)+this._render(W.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),t}_onDispose(){}dispose(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),d&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),d&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(t,A),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const d=this._scene.nj.indexOf(this);d>-1&&this._scene.nj.splice(d,1),this._scene._activeParticleSystems.dispose()}this.hj.notifyObservers(this),this.hj.clear(),this.onStoppedObservable.clear(),this.reset()}}Nd.ForceGLSL=!1;var pd,Bd=A(10761);!function(d){d[d.ATTACHED=0]="ATTACHED",d[d.END=1]="END"}(pd||(pd={}));class Xd{constructor(d){if(this.particleSystem=d,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!d.k||!d.k.dispose){const t=(0,X.d)("BABYLON.AbstractMesh");d.k=new t("SubemitterSystemEmitter",d.va()),d._disposeEmitterOnDispose=!0}}clone(){let d=this.particleSystem.k;if(d){if(d instanceof w.l)d=d.clone();else if(-1!==d.getClassName().indexOf("Mesh")){d=new((0,X.d)("BABYLON.Mesh"))("",d.va()),d.isVisible=!1}}else d=new w.l;const t=new Xd(this.particleSystem.clone(this.particleSystem.name,d));return t.particleSystem.name+="Clone",t.type=this.type,t.inheritDirection=this.inheritDirection,t.inheritedVelocityAmount=this.inheritedVelocityAmount,t.particleSystem._disposeEmitterOnDispose=!0,t.particleSystem.disposeOnStop=!0,t}serialize(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={};return t.type=this.type,t.inheritDirection=this.inheritDirection,t.inheritedVelocityAmount=this.inheritedVelocityAmount,t.particleSystem=this.particleSystem.serialize(d),t}static _ParseParticleSystem(d,t,A){throw(0,Bd.b)("ParseParticle")}static Parse(d,t,A){const w=d.particleSystem,N=new Xd(Xd._ParseParticleSystem(w,t,A,!0));return N.type=d.type,N.inheritDirection=d.inheritDirection,N.inheritedVelocityAmount=d.inheritedVelocityAmount,N.particleSystem._isSubEmitter=!0,N}dispose(){this.particleSystem.dispose()}}var Wd=A(10824);function ad(d,t){const A=new U;return A.direction1=d,A.direction2=t,A}function Dd(){return new J(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function id(){return new T(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function kd(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.l(0,1,0),A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.l(0,1,0);return new F(d,t,A)}function bd(){return new Q(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function Qd(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.l(0,1,0),p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.l(0,1,0);return new P(d,t,A,N,p)}function Pd(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new k(d,t)}function Jd(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.l(0,1,0),N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.l(0,1,0);return new b(d,t,A,N)}class Ud extends Nd{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=d=>{if(!this._subEmitters||0===this._subEmitters.length)return;const t=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[t].forEach((t=>{if(1===t.type){const A=t.clone();d._inheritParticleInfoToSubEmitter(A),A.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(A.particleSystem),A.particleSystem.start()}}))}}createPointEmitter(d,t){const A=ad(d,t);return this.particleEmitterType=A,A}createHemisphericEmitter(){const d=Dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=d,d}createSphereEmitter(){const d=id(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=d,d}createDirectedSphereEmitter(){const d=kd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.l(0,1,0));return this.particleEmitterType=d,d}createCylinderEmitter(){const d=bd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=d,d}createDirectedCylinderEmitter(){const d=Qd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.l(0,1,0));return this.particleEmitterType=d,d}createConeEmitter(){const d=Pd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=d,d}createDirectedConeEmitter(){const d=Jd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.l(0,1,0));return this.particleEmitterType=d,d}createBoxEmitter(d,t,A,w){const N=new i;return this.particleEmitterType=N,this.direction1=d,this.direction2=t,this.minEmitBox=A,this.maxEmitBox=w,N}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((d=>{d instanceof Ud?this._subEmitters.push([new Xd(d)]):d instanceof Xd?this._subEmitters.push([d]):d instanceof Array&&this._subEmitters.push(d)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((d=>{d.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const d=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==d&&this._rootParticleSystem.activeSubSystems.splice(d,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(d){d&&this._stopSubEmitters()}_prepareParticle(d){if(this._subEmitters&&this._subEmitters.length>0){const t=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];d._attachedSubEmitters=[],t.forEach((t=>{if(0===t.type){const A=t.clone();d._attachedSubEmitters.push(A),A.particleSystem.start()}}))}}_onDispose(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var A;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),d)&&(null===(A=this.particles)||void 0===A||A.forEach((d=>{if(d._attachedSubEmitters)for(let t=d._attachedSubEmitters.length-1;t>=0;t-=1)d._attachedSubEmitters[t].dispose()})));if(t&&this.activeSubSystems)for(let w=this.activeSubSystems.length-1;w>=0;w-=1)this.activeSubSystems[w].dispose();if(this._subEmitters&&this._subEmitters.length){for(let d=0;d<this._subEmitters.length;d++)for(const t of this._subEmitters[d])t.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.k&&this.k.dispose&&this.k.dispose(!0)}static _Parse(d,t,A,N){let p;p=A instanceof Wd.c?null:A;const W=(0,X.d)("BABYLON.Texture");if(W&&p&&(d.texture?t.particleTexture=W.Parse(d.texture,p,N):d.textureName&&(t.particleTexture=new W(N+d.textureName,p,!1,void 0===d.invertY||d.invertY),t.particleTexture.name=d.textureName)),d.emitterId||0===d.emitterId||void 0!==d.k?d.emitterId&&p?t.k=p.getLastMeshById(d.emitterId):t.k=w.l.Lg(d.k):t.k=w.l.Zero(),t.isLocal=!!d.isLocal,void 0!==d.renderingGroupId&&(t.renderingGroupId=d.renderingGroupId),void 0!==d.isBillboardBased&&(t.isBillboardBased=d.isBillboardBased),void 0!==d.billboardMode&&(t.billboardMode=d.billboardMode),void 0!==d.useLogarithmicDepth&&(t.useLogarithmicDepth=d.useLogarithmicDepth),d.animations){for(let A=0;A<d.animations.length;A++){const w=d.animations[A],N=(0,X.d)("BABYLON.Animation");N&&t.animations.push(N.Parse(w))}t.beginAnimationOnStart=d.beginAnimationOnStart,t.beginAnimationFrom=d.beginAnimationFrom,t.beginAnimationTo=d.beginAnimationTo,t.beginAnimationLoop=d.beginAnimationLoop}if(d.autoAnimate&&p&&p.beginAnimation(t,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1),t.startDelay=0|d.startDelay,t.minAngularSpeed=d.minAngularSpeed,t.maxAngularSpeed=d.maxAngularSpeed,t.minSize=d.minSize,t.maxSize=d.maxSize,d.minScaleX&&(t.minScaleX=d.minScaleX,t.maxScaleX=d.maxScaleX,t.minScaleY=d.minScaleY,t.maxScaleY=d.maxScaleY),void 0!==d.preWarmCycles&&(t.preWarmCycles=d.preWarmCycles,t.preWarmStepOffset=d.preWarmStepOffset),void 0!==d.minInitialRotation&&(t.minInitialRotation=d.minInitialRotation,t.maxInitialRotation=d.maxInitialRotation),t.minLifeTime=d.minLifeTime,t.maxLifeTime=d.maxLifeTime,t.minEmitPower=d.minEmitPower,t.maxEmitPower=d.maxEmitPower,t.emitRate=d.emitRate,t.gravity=w.l.Lg(d.gravity),d.noiseStrength&&(t.noiseStrength=w.l.Lg(d.noiseStrength)),t.color1=B.i.Lg(d.color1),t.color2=B.i.Lg(d.color2),t.colorDead=B.i.Lg(d.colorDead),t.updateSpeed=d.updateSpeed,t.targetStopDuration=d.targetStopDuration,t.blendMode=d.blendMode,d.colorGradients)for(const w of d.colorGradients)t.addColorGradient(w.gradient,B.i.Lg(w.color1),w.color2?B.i.Lg(w.color2):void 0);if(d.rampGradients){for(const A of d.rampGradients)t.addRampGradient(A.gradient,B.e.Lg(A.color));t.useRampGradients=d.useRampGradients}if(d.colorRemapGradients)for(const w of d.colorRemapGradients)t.addColorRemapGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.alphaRemapGradients)for(const w of d.alphaRemapGradients)t.addAlphaRemapGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.sizeGradients)for(const w of d.sizeGradients)t.addSizeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.angularSpeedGradients)for(const w of d.angularSpeedGradients)t.addAngularSpeedGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.velocityGradients)for(const w of d.velocityGradients)t.addVelocityGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.dragGradients)for(const w of d.dragGradients)t.addDragGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.emitRateGradients)for(const w of d.emitRateGradients)t.addEmitRateGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.startSizeGradients)for(const w of d.startSizeGradients)t.addStartSizeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.lifeTimeGradients)for(const w of d.lifeTimeGradients)t.addLifeTimeGradient(w.gradient,void 0!==w.factor1?w.factor1:w.factor,w.factor2);if(d.limitVelocityGradients){for(const A of d.limitVelocityGradients)t.addLimitVelocityGradient(A.gradient,void 0!==A.factor1?A.factor1:A.factor,A.factor2);t.limitVelocityDamping=d.limitVelocityDamping}if(d.noiseTexture&&p){const A=(0,X.d)("BABYLON.ProceduralTexture");t.noiseTexture=A.Parse(d.noiseTexture,p,N)}let a;if(d.particleEmitterType){switch(d.particleEmitterType.type){case"SphereParticleEmitter":a=new T;break;case"SphereDirectedParticleEmitter":a=new F;break;case"ConeEmitter":case"ConeParticleEmitter":a=new k;break;case"ConeDirectedParticleEmitter":a=new b;break;case"CylinderParticleEmitter":a=new Q;break;case"CylinderDirectedParticleEmitter":a=new P;break;case"HemisphericParticleEmitter":a=new J;break;case"PointParticleEmitter":a=new U;break;case"MeshParticleEmitter":a=new f;break;case"CustomParticleEmitter":a=new q;break;default:a=new i}a.parse(d.particleEmitterType,p)}else a=new i,a.parse(d,p);t.particleEmitterType=a,t.startSpriteCellID=d.startSpriteCellID,t.endSpriteCellID=d.endSpriteCellID,t.spriteCellLoop=d.spriteCellLoop??!0,t.spriteCellWidth=d.spriteCellWidth,t.spriteCellHeight=d.spriteCellHeight,t.spriteCellChangeSpeed=d.spriteCellChangeSpeed,t.spriteRandomStartCell=d.spriteRandomStartCell,t.disposeOnStop=d.disposeOnStop??!1,t.manualEmitCount=d.manualEmitCount??-1}static Parse(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]&&arguments[3],p=arguments.length>4?arguments[4]:void 0;const X=d.name;let W,a,D=null,i=null;if(t instanceof Wd.c?W=t:(a=t,W=a.getEngine()),d.customShader&&W.createEffectForParticles){i=d.customShader;const t=i.shaderOptions.defines.length>0?i.shaderOptions.defines.join("\n"):"";D=W.createEffectForParticles(i.shaderPath.fragmentElement,i.shaderOptions.uniforms,i.shaderOptions.samplers,t)}const k=new Ud(X,p||d.Yc,t,D,d.isAnimationSheetEnabled);if(k.customShader=i,k._rootUrl=A,d.id&&(k.id=d.id),d.subEmitters){k.subEmitters=[];for(const w of d.subEmitters){const d=[];for(const N of w)d.push(Xd.Parse(N,t,A));k.subEmitters.push(d)}}return Ud._Parse(d,k,t,A),d.textureMask&&(k.textureMask=B.i.Lg(d.textureMask)),d.uf&&(k.uf=w.l.Lg(d.uf)),d.preventAutoStart&&(k.preventAutoStart=d.preventAutoStart),N||k.preventAutoStart||k.start(),k}serialize(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={};if(Ud._Serialize(t,this,d),t.textureMask=this.textureMask.gj(),t.customShader=this.customShader,t.preventAutoStart=this.preventAutoStart,t.uf=this.uf.gj(),this.subEmitters){t.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const A of this._subEmitters){const w=[];for(const t of A)w.push(t.serialize(d));t.subEmitters.push(w)}}return t}static _Serialize(d,t,A){if(d.name=t.name,d.id=t.id,d.Yc=t.getCapacity(),d.disposeOnStop=t.disposeOnStop,d.manualEmitCount=t.manualEmitCount,t.k.position){const A=t.k;d.emitterId=A.id}else{const A=t.k;d.k=A.gj()}t.particleEmitterType&&(d.particleEmitterType=t.particleEmitterType.serialize()),t.particleTexture&&(A?d.texture=t.particleTexture.serialize():(d.textureName=t.particleTexture.name,d.invertY=!!t.particleTexture._invertY)),d.isLocal=t.isLocal,h.d.AppendSerializedAnimations(t,d),d.beginAnimationOnStart=t.beginAnimationOnStart,d.beginAnimationFrom=t.beginAnimationFrom,d.beginAnimationTo=t.beginAnimationTo,d.beginAnimationLoop=t.beginAnimationLoop,d.startDelay=t.startDelay,d.renderingGroupId=t.renderingGroupId,d.isBillboardBased=t.isBillboardBased,d.billboardMode=t.billboardMode,d.minAngularSpeed=t.minAngularSpeed,d.maxAngularSpeed=t.maxAngularSpeed,d.minSize=t.minSize,d.maxSize=t.maxSize,d.minScaleX=t.minScaleX,d.maxScaleX=t.maxScaleX,d.minScaleY=t.minScaleY,d.maxScaleY=t.maxScaleY,d.minEmitPower=t.minEmitPower,d.maxEmitPower=t.maxEmitPower,d.minLifeTime=t.minLifeTime,d.maxLifeTime=t.maxLifeTime,d.emitRate=t.emitRate,d.gravity=t.gravity.gj(),d.noiseStrength=t.noiseStrength.gj(),d.color1=t.color1.gj(),d.color2=t.color2.gj(),d.colorDead=t.colorDead.gj(),d.updateSpeed=t.updateSpeed,d.targetStopDuration=t.targetStopDuration,d.blendMode=t.blendMode,d.preWarmCycles=t.preWarmCycles,d.preWarmStepOffset=t.preWarmStepOffset,d.minInitialRotation=t.minInitialRotation,d.maxInitialRotation=t.maxInitialRotation,d.startSpriteCellID=t.startSpriteCellID,d.spriteCellLoop=t.spriteCellLoop,d.endSpriteCellID=t.endSpriteCellID,d.spriteCellChangeSpeed=t.spriteCellChangeSpeed,d.spriteCellWidth=t.spriteCellWidth,d.spriteCellHeight=t.spriteCellHeight,d.spriteRandomStartCell=t.spriteRandomStartCell,d.isAnimationSheetEnabled=t.isAnimationSheetEnabled,d.useLogarithmicDepth=t.useLogarithmicDepth;const w=t.getColorGradients();if(w){d.colorGradients=[];for(const t of w){const A={gradient:t.gradient,color1:t.color1.gj()};t.color2?A.color2=t.color2.gj():A.color2=t.color1.gj(),d.colorGradients.push(A)}}const N=t.getRampGradients();if(N){d.rampGradients=[];for(const t of N){const A={gradient:t.gradient,color:t.color.gj()};d.rampGradients.push(A)}d.useRampGradients=t.useRampGradients}const p=t.getColorRemapGradients();if(p){d.colorRemapGradients=[];for(const t of p){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.colorRemapGradients.push(A)}}const B=t.getAlphaRemapGradients();if(B){d.alphaRemapGradients=[];for(const t of B){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.alphaRemapGradients.push(A)}}const X=t.getSizeGradients();if(X){d.sizeGradients=[];for(const t of X){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.sizeGradients.push(A)}}const W=t.getAngularSpeedGradients();if(W){d.angularSpeedGradients=[];for(const t of W){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.angularSpeedGradients.push(A)}}const a=t.getVelocityGradients();if(a){d.velocityGradients=[];for(const t of a){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.velocityGradients.push(A)}}const D=t.getDragGradients();if(D){d.dragGradients=[];for(const t of D){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.dragGradients.push(A)}}const i=t.getEmitRateGradients();if(i){d.emitRateGradients=[];for(const t of i){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.emitRateGradients.push(A)}}const k=t.getStartSizeGradients();if(k){d.startSizeGradients=[];for(const t of k){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.startSizeGradients.push(A)}}const b=t.getLifeTimeGradients();if(b){d.lifeTimeGradients=[];for(const t of b){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.lifeTimeGradients.push(A)}}const Q=t.getLimitVelocityGradients();if(Q){d.limitVelocityGradients=[];for(const t of Q){const A={gradient:t.gradient,factor1:t.factor1};void 0!==t.factor2?A.factor2=t.factor2:A.factor2=t.factor1,d.limitVelocityGradients.push(A)}d.limitVelocityDamping=t.limitVelocityDamping}t.noiseTexture&&(d.noiseTexture=t.noiseTexture.serialize())}clone(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w={...this._customWrappers};let N=null;const p=this._engine;if(p.createEffectForParticles&&null!=this.customShader){N=this.customShader;const d=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"",t=p.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,d);w[0]?w[0].effect=t:this.setCustomEffect(t,0)}const B=this.serialize(A),X=Ud.Parse(B,this._scene||this._engine,this._rootUrl);return X.name=d,X.customShader=N,X._customWrappers=w,void 0===t&&(t=this.k),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.k=t,this.preventAutoStart||X.start(),X}}Ud.BILLBOARDMODE_Y=2,Ud.BILLBOARDMODE_ALL=7,Ud.BILLBOARDMODE_STRETCHED=8,Ud.BILLBOARDMODE_STRETCHED_LOCAL=9,Xd._ParseParticleSystem=Ud.Parse;var Td=A(11092),Fd=A(11061),qd=A(11515);qd.c.prototype.createTransformFeedback=function(){const d=this._gl.createTransformFeedback();if(!d)throw new Error("Unable to create Transform Feedback");return d},qd.c.prototype.deleteTransformFeedback=function(d){this._gl.deleteTransformFeedback(d)},qd.c.prototype.bindTransformFeedback=function(d){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,d)},qd.c.prototype.beginTransformFeedback=function(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(d?this._gl.POINTS:this._gl.TRIANGLES)},qd.c.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},qd.c.prototype.setTranformFeedbackVaryings=function(d,t){this._gl.transformFeedbackVaryings(d,t,this._gl.INTERLEAVED_ATTRIBS)},qd.c.prototype.bindTransformFeedbackBuffer=function(d){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,d?d.underlyingResource:null)},qd.c.prototype.readTransformFeedbackBuffer=function(d){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,d)};const Hd="clipPlaneFragmentDeclaration2",fd="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";j.c.IncludesShadersStore[Hd]=fd;A(11624),A(11633),A(11638),A(11645),A(11654),A(11663),A(11669),A(11678);const vd="gpuRenderParticlesPixelShader",md="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";j.c.ShadersStore[vd]=md;const jd="clipPlaneVertexDeclaration2",nd="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";j.c.IncludesShadersStore[jd]=nd;A(11684),A(11692),A(11698),A(11704);const Rd="gpuRenderParticlesVertexShader",Zd="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";j.c.ShadersStore[Rd]=Zd;class Ld extends W{static get IsSupported(){if(!g.e.LastCreatedEngine)return!1;const d=g.e.LastCreatedEngine.getCaps();return d.supportTransformFeedbacks||d.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(d){this._maxActiveParticleCount=Math.min(d,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(d){this.maxActiveParticleCount=d}createPointEmitter(d,t){const A=ad(d,t);return this.particleEmitterType=A,A}createHemisphericEmitter(){const d=Dd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=d,d}createSphereEmitter(){const d=id(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=d,d}createDirectedSphereEmitter(){const d=kd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new w.l(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.l(0,1,0));return this.particleEmitterType=d,d}createCylinderEmitter(){const d=bd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=d,d}createDirectedCylinderEmitter(){const d=Qd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.l(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new w.l(0,1,0));return this.particleEmitterType=d,d}createConeEmitter(){const d=Pd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=d,d}createDirectedConeEmitter(){const d=Jd(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new w.l(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new w.l(0,1,0));return this.particleEmitterType=d,d}createBoxEmitter(d,t,A,w){const N=new i;return this.particleEmitterType=N,this.direction1=d,this.direction2=t,this.minEmitBox=A,this.maxEmitBox=w,N}isReady(){if(!this.k||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==Ud.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(Ud.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(Ud.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";d?setTimeout((()=>{this.start(0)}),d):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var d;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(d=this._customWrappers[t])||void 0===d?void 0:d.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[d]??this._customWrappers[0]}setCustomEffect(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[t]=new dd.b(this._engine),this._customWrappers[t].effect=d}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new C.b),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(d,t,A){return super._removeGradientAndTexture(d,t,A),this._releaseBuffers(),this}addColorGradient(d,t){this._colorGradients||(this._colorGradients=[]);const A=new e(d,t);return this._colorGradients.push(A),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(d&&this._colorGradients.sort(((d,t)=>d.gradient<t.gradient?-1:d.gradient>t.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(d){return this._removeGradientAndTexture(d,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const t in this._drawWrappers){var d;null===(d=this._drawWrappers[t].drawContext)||void 0===d||d.reset()}}_addFactorGradient(d,t,A){const w=new x(t,A);d.push(w),this._releaseBuffers()}addSizeGradient(d,t){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,d,t),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(d){return this._removeGradientAndTexture(d,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(d,t){if(!d)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&d.sort(((d,t)=>d.gradient<t.gradient?-1:d.gradient>t.gradient?1:0));const A=this;A[t]&&(A[t].dispose(),A[t]=null)}addAngularSpeedGradient(d,t){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,d,t),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(d){return this._removeGradientAndTexture(d,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(d,t){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,d,t),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(d){return this._removeGradientAndTexture(d,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(d,t){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,d,t),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(d){return this._removeGradientAndTexture(d,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(d,t){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,d,t),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(d){return this._removeGradientAndTexture(d,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(d){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(d),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.hj=new C.b,this.onStoppedObservable=new C.b,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,A&&"Scene"!==A.getClassName()?(this._engine=A,this.defaultProjectionMatrix=w.c.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=A||g.e.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene.nj.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,X.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,X.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,X.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new dd.b(this._engine)},this._customWrappers[0].effect=N,this._drawWrappers={0:new dd.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(t=t??{}).randomTextureSize||delete t.randomTextureSize;const B={Yc:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...t},W=t;isFinite(W)&&(B.Yc=W),this._capacity=B.Yc,this._maxActiveParticleCount=B.Yc,this._currentActiveCount=0,this._isAnimationSheetEnabled=p,this.particleEmitterType=new i;const a=Math.min(this._engine.getCaps().maxTextureSize,B.randomTextureSize);let D=[];for(let w=0;w<a;++w)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture=new E.b(new Float32Array(D),a,1,5,A,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,D=[];for(let w=0;w<a;++w)D.push(Math.random()),D.push(Math.random()),D.push(Math.random()),D.push(Math.random());this._randomTexture2=new E.b(new Float32Array(D),a,1,5,A,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=a}_reset(){this._releaseBuffers()}_createVertexBuffers(d,t,A){const w={};w.position=t.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let N=3;w.age=t.createVertexBuffer("age",N,1,this._attributesStrideSize,!0),N+=1,w.size=t.createVertexBuffer("size",N,3,this._attributesStrideSize,!0),N+=3,w.life=t.createVertexBuffer("life",N,1,this._attributesStrideSize,!0),N+=1,N+=4,this.billboardMode===Ud.BILLBOARDMODE_STRETCHED&&(w.direction=t.createVertexBuffer("direction",N,3,this._attributesStrideSize,!0)),N+=3,this._platform.alignDataInBuffer&&(N+=1),this.particleEmitterType instanceof q&&(N+=3,this._platform.alignDataInBuffer&&(N+=1)),this._colorGradientsTexture||(w.color=t.createVertexBuffer("color",N,4,this._attributesStrideSize,!0),N+=4),this._isBillboardBased||(w.initialDirection=t.createVertexBuffer("initialDirection",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),this.noiseTexture&&(w.noiseCoordinates1=t.createVertexBuffer("noiseCoordinates1",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1),w.noiseCoordinates2=t.createVertexBuffer("noiseCoordinates2",N,3,this._attributesStrideSize,!0),N+=3,this._platform.alignDataInBuffer&&(N+=1)),w.angle=t.createVertexBuffer("angle",N,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?N++:N+=2,this._isAnimationSheetEnabled&&(w.cellIndex=t.createVertexBuffer("cellIndex",N,1,this._attributesStrideSize,!0),N+=1,this.spriteRandomStartCell&&(w.cellStartOffset=t.createVertexBuffer("cellStartOffset",N,1,this._attributesStrideSize,!0),N+=1)),w.offset=A.createVertexBuffer("offset",0,2),w.uv=A.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(w),this._platform.createVertexBuffers(d,w),this.resetDrawCache()}_initialize(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!d)return;const t=this._engine,A=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const N=this.particleEmitterType instanceof q,p=w.h.gb[0];let B=0;for(let w=0;w<this._capacity;w++)if(A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(0),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),N?(this.particleEmitterType.particleDestinationGenerator(w,null,p),A.push(p.x),A.push(p.y),A.push(p.z)):(A.push(0),A.push(0),A.push(0)),this._platform.alignDataInBuffer&&A.push(0),B+=16,N&&(this.particleEmitterType.particlePositionGenerator(w,null,p),A.push(p.x),A.push(p.y),A.push(p.z),this._platform.alignDataInBuffer&&A.push(0),B+=4),this._colorGradientsTexture||(A.push(0),A.push(0),A.push(0),A.push(0),B+=4),this.isBillboardBased||(A.push(0),A.push(0),A.push(0),this._platform.alignDataInBuffer&&A.push(0),B+=4),this.noiseTexture&&(A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),this._platform.alignDataInBuffer&&A.push(0),A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),this._platform.alignDataInBuffer&&A.push(0),B+=8),A.push(0),B+=1,this._angularSpeedGradientsTexture||(A.push(0),B+=1),this._isAnimationSheetEnabled&&(A.push(0),B+=1,this.spriteRandomStartCell&&(A.push(0),B+=1)),this._platform.alignDataInBuffer){let d=3-(B+3&3);for(B+=d;d-- >0;)A.push(0)}const X=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),W=this._platform.createParticleBuffer(A),a=this._platform.createParticleBuffer(A);this._buffer0=new H.d(t,W,!1,this._attributesStrideSize),this._buffer1=new H.d(t,a,!1,this._attributesStrideSize),this._spriteBuffer=new H.d(t,X,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let d=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(d+="\n#define BILLBOARD"),this._colorGradientsTexture&&(d+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(d+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(d+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(d+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(d+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(d+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(d+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(d+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(d+="\n#define NOISE"),this.isLocal&&(d+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===d||(this._cachedUpdateDefines=d,this._updateBuffer=this._platform.createUpdateBuffer(d)),this._platform.isUpdateBufferReady()}_getWrapper(d){const t=this._getCustomDrawWrapper(d);if(null!==t&&void 0!==t&&t.effect)return t;const A=[];this.fillDefines(A,d);let w=this._drawWrappers[d];w||(w=new dd.b(this._engine),w.drawContext&&(w.drawContext.useInstancing=!0),this._drawWrappers[d]=w);const N=A.join("\n");if(w.defines!==N){const d=[],t=[],A=[];this.fillUniformsAttributesAndSamplerNames(t,d,A),w.setEffect(this._engine.createEffect("gpuRenderParticles",d,t,A,N),N)}return w}static _GetAttributeNamesOrOptions(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const N=[H.f.PositionKind,"age","life","size","angle"];return d||N.push(H.f.ColorKind),t&&N.push("cellIndex"),A||N.push("initialDirection"),w&&N.push("direction"),N.push("offset",H.f.UVKind),N}static _GetEffectCreationOptions(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=["emitterWM","uf","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,td.e)(w),d&&w.push("sheetInfos"),t&&w.push("logarithmicDepthConstant"),A&&(w.push("vFogInfos"),w.push("vFogColor")),w}fillDefines(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,td.l)(this,this._scene,d),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==Fd.e.FOGMODE_NONE&&d.push("#define FOG")),t===Ud.BLENDMODE_MULTIPLY&&d.push("#define BLENDMULTIPLYMODE"),this.isLocal&&d.push("#define LOCAL"),this.useLogarithmicDepth&&d.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(d.push("#define BILLBOARD"),this.billboardMode){case Ud.BILLBOARDMODE_Y:d.push("#define BILLBOARDY");break;case Ud.BILLBOARDMODE_STRETCHED:d.push("#define BILLBOARDSTRETCHED");break;case Ud.BILLBOARDMODE_ALL:d.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&d.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&d.push("#define ANIMATESHEET"),A&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),d.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(d,t,A){t.push(...Ld._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===Ud.BILLBOARDMODE_STRETCHED)),d.push(...Ld._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),A.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(Td.c.PrepareUniforms(d,this._imageProcessingConfigurationDefines),Td.c.PrepareSamplers(A,this._imageProcessingConfigurationDefines))}animate(){var d;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(t?this.preWarmStepOffset:(null===(d=this._scene)||void 0===d?void 0:d.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(d,t){const A=this[t];if(!d||!d.length||A)return;const w=new Float32Array(this._rawTextureWidth);for(let N=0;N<this._rawTextureWidth;N++){const t=N/this._rawTextureWidth;o.GetCurrentGradient(t,d,((d,t,A)=>{w[N]=(0,a.o)(d.factor1,t.factor1,A)}))}this[t]=E.b.CreateRTexture(w,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[t].name=t.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const d=new Uint8Array(4*this._rawTextureWidth),t=B.j.pb[0];for(let A=0;A<this._rawTextureWidth;A++){const w=A/this._rawTextureWidth;o.GetCurrentGradient(w,this._colorGradients,((w,N,p)=>{B.i.LerpToRef(w.color1,N.color1,p,t),d[4*A]=255*t.r,d[4*A+1]=255*t.g,d[4*A+2]=255*t.b,d[4*A+3]=255*t.a}))}this._colorGradientsTexture=E.b.CreateRGBATexture(d,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(d,t){var A,N,p,B;const X=this._getWrapper(d),W=X.effect;this._engine.enableEffect(X);const a=(null===(A=this._scene)||void 0===A?void 0:A.getViewMatrix())||w.c.IdentityReadOnly;if(W.setMatrix("view",a),W.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),W.setTexture("diffuseSampler",this.particleTexture),W.setVector2("translationPivot",this.translationPivot),W.setVector3("uf",this.uf),this.isLocal&&W.setMatrix("emitterWM",t),this._colorGradientsTexture?W.setTexture("colorGradientSampler",this._colorGradientsTexture):W.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const d=this.particleTexture.getBaseSize();W.setFloat3("sheetInfos",this.spriteCellWidth/d.width,this.spriteCellHeight/d.height,d.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const d=this._scene.activeCamera;W.setVector3("eyePosition",d.globalPosition)}const D=W.defines;if(this._scene&&((0,td.g)(W,this,this._scene),this.applyFog&&(0,Ad.e)(this._scene,void 0,W)),D.indexOf("#define BILLBOARDMODE_ALL")>=0){const d=a.clone();d.invert(),W.setMatrix("invView",d)}switch(this.useLogarithmicDepth&&this._scene&&(0,Ad.k)(D,W,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(W),d){case Ud.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case Ud.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case Ud.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case Ud.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,W,null!==(N=this._scene)&&void 0!==N&&N.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(W),null!==(p=this._scene)&&void 0!==p&&p.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(B=this._scene)&&void 0!==B&&B.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(d){if(!this.k||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!d)if(this.k.position){d=this.k.getWorldMatrix()}else{const t=this.k;d=w.h.Matrix[0],w.c.TranslationToRef(t.x,t.y,t.z,d)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",d),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const t=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=t}render(){let d,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!t&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let d=0;d<this.preWarmCycles;d++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const d=0|this._accumulatedCount;this._accumulatedCount-=d,this._currentActiveCount+=d}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.k.position){d=this.k.getWorldMatrix()}else{const t=this.k;d=w.h.Matrix[0],w.c.TranslationToRef(t.x,t.y,t.z,d)}const N=this._engine;this.updateInAnimate||this._update(d);let p=0;return t||A||(N.setState(!1),this.forceDepthWrite&&N.setDepthWrite(!0),p=this.blendMode===Ud.BLENDMODE_MULTIPLYADD?this._render(Ud.BLENDMODE_MULTIPLY,d)+this._render(Ud.BLENDMODE_ADD,d):this._render(this.blendMode,d),this._engine.setAlphaMode(0)),p}rebuild(){const d=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(d,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,d()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const t in this._drawWrappers){this._drawWrappers[t].dispose()}if(this._drawWrappers={},this._scene){const d=this._scene.nj.indexOf(this);d>-1&&this._scene.nj.splice(d,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let t=0;t<this._renderVertexBuffers.length;++t){const d=this._renderVertexBuffers[t];for(const t in d)d[t].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),d&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),d&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.hj.notifyObservers(this),this.hj.clear()}clone(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w={...this._customWrappers};let N=null;const p=this._engine;if(p.createEffectForParticles&&null!=this.customShader){N=this.customShader;const d=N.shaderOptions.defines.length>0?N.shaderOptions.defines.join("\n"):"";w[0]=p.createEffectForParticles(N.shaderPath.fragmentElement,N.shaderOptions.uniforms,N.shaderOptions.samplers,d,void 0,void 0,void 0,this)}const B=this.serialize(A),X=Ld.Parse(B,this._scene||this._engine,this._rootUrl);return X.name=d,X.customShader=N,X._customWrappers=w,void 0===t&&(t=this.k),this.noiseTexture&&(X.noiseTexture=this.noiseTexture.clone()),X.k=t,X}serialize(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={};return Ud._Serialize(t,this,d),t.activeParticleCount=this.activeParticleCount,t.randomTextureSize=this._randomTextureSize,t.customShader=this.customShader,t}static Parse(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4?arguments[4]:void 0;const p=d.name;let B,X;t instanceof Wd.c?B=t:(X=t,B=X.getEngine());const W=new Ld(p,{Yc:N||d.Yc,randomTextureSize:d.randomTextureSize},t,null,d.isAnimationSheetEnabled);if(W._rootUrl=A,d.customShader&&B.createEffectForParticles){const t=d.customShader,A=t.shaderOptions.defines.length>0?t.shaderOptions.defines.join("\n"):"",w=B.createEffectForParticles(t.shaderPath.fragmentElement,t.shaderOptions.uniforms,t.shaderOptions.samplers,A,void 0,void 0,void 0,W);W.setCustomEffect(w,0),W.customShader=t}return d.id&&(W.id=d.id),d.activeParticleCount&&(W.activeParticleCount=d.activeParticleCount),Ud._Parse(d,W,t,A),d.preventAutoStart&&(W.preventAutoStart=d.preventAutoStart),w||W.preventAutoStart||W.start(),W}}var Id=A(10727),ud=A(11710),Vd=A(11033);class hd{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(d){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const t of this.systems)t.k=d;this._emitterNode=d}setEmitterAsSphere(d,t,A){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:d,renderingGroupId:t};const w=(0,ud.b)("emitterSphere",{diameter:d.diameter,segments:d.segments},A);w.renderingGroupId=t;const N=new Vd.d("emitterSphereMaterial",A);N.emissiveColor=d.color,w.material=N;for(const p of this.systems)p.k=w;this._emitterNode=w}start(d){for(const t of this.systems)d&&(t.k=d),t.start()}dispose(){for(const d of this.systems)d.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t={systems:[]};for(const A of this.systems)t.systems.push(A.serialize(d));return this._emitterNode&&(t.k=this._emitterCreationOptions),t}static Parse(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;const N=new hd,p=this.BaseAssetsUrl+"/textures/";t=t||g.e.LastCreatedScene;for(const B of d.systems)N.systems.push(A?Ld.Parse(B,t,p,!0,w):Ud.Parse(B,t,p,!0,w));if(d.k){const A=d.k.options;if("Sphere"===d.k.kind)N.setEmitterAsSphere({diameter:A.diameter,segments:A.segments,color:B.e.Lg(A.color)},d.k.renderingGroupId,t)}return N}}hd.BaseAssetsUrl="https://assets.babylonjs.com/particles";var ld=A(10767);class yd{static CreateDefault(d){let t,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,w=arguments.length>2?arguments[2]:void 0;return t=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new Ld("default system",{Yc:A},w):new Ud("default system",A,w),t.k=d,t.particleTexture=new l.c("https://assets.babylonjs.com/textures/flare.png",t.va()),t.createConeEmitter(.1,Math.PI/4),t.color1=new B.i(1,1,1,1),t.color2=new B.i(1,1,1,1),t.colorDead=new B.i(1,1,1,0),t.minSize=.1,t.maxSize=.1,t.minEmitPower=2,t.maxEmitPower=2,t.updateSpeed=1/60,t.emitRate=30,t}static CreateAsync(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3?arguments[3]:void 0;t||(t=g.e.LastCreatedScene);const N={};return t.addPendingData(N),new Promise(((p,B)=>{if(A&&!Ld.IsSupported)return t.removePendingData(N),B("Particle system with GPU is not supported.");Id.g.LoadFile(`${yd.BaseAssetsUrl}/systems/${d}.json`,(d=>{t.removePendingData(N);const B=JSON.parse(d.toString());return p(hd.Parse(B,t,A,w))}),void 0,void 0,void 0,(()=>(t.removePendingData(N),B(`An error occurred with the creation of your particle system. Check if your type '${d}' exists.`))))}))}static ExportSet(d){const t=new hd;for(const A of d)t.systems.push(A);return t}static ParseFromFileAsync(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",p=arguments.length>5?arguments[5]:void 0;return new Promise(((B,X)=>{const W=new ld.b;W.addEventListener("readystatechange",(()=>{if(4==W.readyState)if(200==W.status){const t=JSON.parse(W.responseText);let X;X=w?Ld.Parse(t,A,N,!1,p):Ud.Parse(t,A,N,!1,p),d&&(X.name=d),B(X)}else X("Unable to load the particle system")})),W.open("GET",t),W.send()}))}static ParseFromSnippetAsync(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",N=arguments.length>4?arguments[4]:void 0;if("_BLANK"===d){const d=this.CreateDefault(null);return d.start(),Promise.resolve(d)}return new Promise(((p,B)=>{const X=new ld.b;X.addEventListener("readystatechange",(()=>{if(4==X.readyState)if(200==X.status){const B=JSON.parse(JSON.parse(X.responseText).jsonPayload),W=JSON.parse(B.particleSystem);let a;a=A?Ld.Parse(W,t,w,!1,N):Ud.Parse(W,t,w,!1,N),a.snippetId=d,p(a)}else B("Unable to load the snippet "+d)})),X.open("GET",this.SnippetUrl+"/"+d.replace(/#/g,"/")),X.send()}))}}yd.BaseAssetsUrl=hd.BaseAssetsUrl,yd.SnippetUrl="https://snippet.babylonjs.com",yd.CreateFromSnippetAsync=yd.ParseFromSnippetAsync;var sd=A(11309),Yd=A(11146),rd=A(11714);(0,rd.e)(Yd.e.NAME_PARTICLESYSTEM,((d,t,A,w)=>{const N=(0,rd.i)(Yd.e.NAME_PARTICLESYSTEM);if(N&&void 0!==d.nj&&null!==d.nj)for(let p=0,B=d.nj.length;p<B;p++){const B=d.nj[p];A.nj.push(N(B,t,w))}})),(0,rd.d)(Yd.e.NAME_PARTICLESYSTEM,((d,t,A)=>{if(d.activeParticleCount){return Ld.Parse(d,t,A)}return Ud.Parse(d,t,A)})),Wd.c.prototype.createEffectForParticles=function(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],w=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",p=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0,X=arguments.length>6?arguments[6]:void 0,W=arguments.length>7?arguments[7]:void 0,a=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,D=[],i=[];const k=[];return W?W.fillUniformsAttributesAndSamplerNames(i,D,k):(D=Ud._GetAttributeNamesOrOptions(),i=Ud._GetEffectCreationOptions()),-1===N.indexOf(" BILLBOARD")&&(N+="\n#define BILLBOARD\n"),null!==W&&void 0!==W&&W.isAnimationSheetEnabled&&-1===N.indexOf(" ANIMATESHEET")&&(N+="\n#define ANIMATESHEET\n"),-1===w.indexOf("diffuseSampler")&&w.push("diffuseSampler"),this.createEffect({vertex:(null===W||void 0===W?void 0:W.vertexShaderName)??"particles",fragmentElement:d},D,i.concat(t),k.concat(w),N,p,B,X,void 0,a,(async()=>{0===a?await Promise.resolve().then(A.bind(A,11743)):await Promise.resolve().then(A.bind(A,11821))}))},sd.d.prototype.getEmittedParticleSystems=function(){const d=[];for(let t=0;t<this.va().nj.length;t++){const A=this.va().nj[t];A.k===this&&d.push(A)}return d},sd.d.prototype.getHierarchyEmittedParticleSystems=function(){const d=[],t=this.getDescendants();t.push(this);for(let A=0;A<this.va().nj.length;A++){const w=this.va().nj[A],N=w.k;N.position&&-1!==t.indexOf(N)&&d.push(w)}return d};A(11221),A(11230),A(11350);A(11339),A(11719),A(11359),A(11205),A(11368);A(11548);var Kd;A(11723),A(11266);!function(d){d[d.Color=2]="Color",d[d.UV=1]="UV",d[d.Random=0]="Random",d[d.Stated=3]="Stated"}(Kd||(Kd={}));A(11729),A(11743),A(11755),A(11821)},11584:(d,t,A)=>{"use strict";A.d(t,{d:()=>Q});var w=A(11041),N=A(11054),p=A(10730),B=A(11076),X=A(10829),W=A(11047),a=A(11097),D=A(10885),i=A(10824),k=A(10896),b=A(11593);i.c.prototype.setTextureFromPostProcess=function(d,t,A){var w;let N=null;t&&(t._forcedOutputTexture?N=t._forcedOutputTexture:t._textures.data[t._currentRenderTextureInd]&&(N=t._textures.data[t._currentRenderTextureInd])),this._bindTexture(d,(null===(w=N)||void 0===w?void 0:w.texture)??null,A)},i.c.prototype.setTextureFromPostProcessOutput=function(d,t,A){var w;this._bindTexture(d,(null===t||void 0===t||null===(w=t._outputTexture)||void 0===w?void 0:w.texture)??null,A)},X.e.prototype.setTextureFromPostProcess=function(d,t){this._engine.setTextureFromPostProcess(this._samplers[d],t,d)},X.e.prototype.setTextureFromPostProcessOutput=function(d,t){this._engine.setTextureFromPostProcessOutput(this._samplers[d],t,d)};class Q{static get ForceGLSL(){return b.g.ForceGLSL}static set ForceGLSL(d){b.g.ForceGLSL=d}static RegisterShaderCodeProcessing(d,t){b.g.RegisterShaderCodeProcessing(d,t)}get name(){return this._effectWrapper.name}set name(d){this._effectWrapper.name=d}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(d){this._effectWrapper.alphaMode=d}get samples(){return this._samples}set samples(d){this._samples=Math.min(d,this._engine.getCaps().maxMSAASamples),this._textures.forEach((d=>{d.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(d){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),d&&(this._onActivateObserver=this.onActivateObservable.add(d))}set onSizeChanged(d){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(d)}set onApply(d){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(d)}set onBeforeRender(d){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(d)}set onAfterRender(d){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(d)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(d){this._forcedOutputTexture=d}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.wf(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(d,t,A,w,X,W){var a;let D=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,i=arguments.length>7?arguments[7]:void 0,k=arguments.length>8?arguments[8]:void 0,P=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,J=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",T=arguments.length>12?arguments[12]:void 0,F=arguments.length>13&&void 0!==arguments[13]&&arguments[13],q=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,H=arguments.length>15?arguments[15]:void 0,f=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Ri=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new N.d(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new B.j(1,1),this._texelSize=B.j.Zero(),this.onActivateObservable=new p.b,this.onSizeChangedObservable=new p.b,this.onApplyObservable=new p.b,this.onBeforeRenderObservable=new p.b,this.onAfterRenderObservable=new p.b;let v,m=1,j=null;if(A&&!Array.isArray(A)){const d=A;A=d.uniforms??null,w=d.samplers??null,m=d.size??1,W=d.camera??null,D=d.samplingMode??1,i=d.ud,k=d.reusable,P=Array.isArray(d.defines)?d.defines.join("\n"):d.defines??null,J=d.textureType??0,U=d.vertexUrl??"postprocess",T=d.indexParameters,F=d.blockCompilation??!1,q=d.textureFormat??5,H=d.shaderLanguage??0,j=d.uniformBuffers??null,f=d.extraInitializations,v=d.effectWrapper}else X&&(m="number"===typeof X?X:{width:X.width,height:X.height});const n=!!v;if(this._effectWrapper=v??new b.g({name:d,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:t,ud:i||(null===(a=W)||void 0===a?void 0:a.va().getEngine()),uniforms:A,samplers:w,uniformBuffers:j,defines:P,vertexUrl:U,indexParameters:T,blockCompilation:F,shaderLanguage:H,extraInitializations:f}),this.name=d,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=W?(this._camera=W,this._scene=W.va(),W.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):i&&(this._engine=i,this._engine.postProcesses.push(this)),this._options=m,this.renderTargetSamplingMode=D||1,this._reusable=k||!1,this._textureType=J,this._textureFormat=q,this._shaderLanguage=H||0,this._samplers=w||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=t,this._vertexUrl=U,this._parameters=A||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=j||[],this._indexParameters=T,!n){this._webGPUReady=1===this._shaderLanguage;const d=[];this._gatherImports(this._engine.isWebGPU&&!Q.ForceGLSL,d),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(F,P,f,d)}}_gatherImports(){let d=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?d.push(Promise.all([A.e(37).then(A.bind(A,13261))])):d.push(Promise.all([Promise.resolve().then(A.bind(A,11599))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(d){return this._disposeTextures(),this._shareOutputWithPostProcess=d,this}useOwnOutput(){0==this._textures.length&&(this._textures=new N.d(2)),this._shareOutputWithPostProcess=null}updateEffect(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3?arguments[3]:void 0,N=arguments.length>4?arguments[4]:void 0,p=arguments.length>5?arguments[5]:void 0,B=arguments.length>6?arguments[6]:void 0,X=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(d,t,A,w,N,p,B,X),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let N=0;N<this._textureCache.length;N++)if(this._textureCache[N].texture.width===d.width&&this._textureCache[N].texture.height===d.height&&this._textureCache[N].postProcessChannel===A&&this._textureCache[N].texture._generateDepthBuffer===t.generateDepthBuffer&&this._textureCache[N].texture.samples===t.samples)return this._textureCache[N].texture;const w=this._engine.createRenderTargetTexture(d,t);return this._textureCache.push({texture:w,postProcessChannel:A,lastUsedRenderId:-1}),w}_flushTextureCache(){const d=this._renderId;for(let t=this._textureCache.length-1;t>=0;t--)if(d-this._textureCache[t].lastUsedRenderId>100){let d=!1;for(let A=0;A<this._textures.length;A++)if(this._textures.data[A]===this._textureCache[t].texture){d=!0;break}d||(this._textureCache[t].texture.dispose(),this._textureCache.splice(t,1))}}resize(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]&&arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=d,this.height=t;let p=null;if(A)for(let W=0;W<A._postProcesses.length;W++)if(null!==A._postProcesses[W]){p=A._postProcesses[W];break}const B={width:this.width,height:this.height},X={generateMipMaps:w,generateDepthBuffer:N||p===this,generateStencilBuffer:(N||p===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(B,X,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(B,X,1)),this._texelSize.wf(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let d;if(this._shareOutputWithPostProcess)d=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)d=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let t;d=this.inputTexture;for(let A=0;A<this._textureCache.length;A++)if(this._textureCache[A].texture===d){t=this._textureCache[A];break}t&&(t.lastUsedRenderId=this._renderId)}return d}activate(d){var t,A;let w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,N=arguments.length>2?arguments[2]:void 0;const p=(d=d||this._camera).va(),B=p.getEngine(),X=B.getCaps().maxTextureSize,W=(w?w.width:this._engine.getRenderWidth(!0))*this._options|0,a=(w?w.height:this._engine.getRenderHeight(!0))*this._options|0;let D=this._options.width||W,i=this._options.height||a;const b=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let Q=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const d=B.currentViewport;d&&(D*=d.width,i*=d.height)}(b||this.alwaysForcePOT)&&(this._options.width||(D=B.needPOTTextures?(0,k.g)(D,X,this.scaleMode):D),this._options.height||(i=B.needPOTTextures?(0,k.g)(i,X,this.scaleMode):i)),this.width===D&&this.height===i&&(Q=this._getTarget())||this.resize(D,i,d,b,N),this._textures.forEach((d=>{d.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(d,this.samples)})),this._flushTextureCache(),this._renderId++}return Q||(Q=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.wf(W/D,a/i),this._engine.bindFramebuffer(Q,0,W,a,this.forceFullscreenViewport)):(this._scaleRatio.wf(1,1),this._engine.bindFramebuffer(Q,0,void 0,void 0,this.forceFullscreenViewport)),null===(t=(A=this._engine)._debugInsertMarker)||void 0===t||t.call(A,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(d),this.Ri&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:p.clearColor,p._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),Q}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let d;var t;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),d=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(t=d)||void 0===t?void 0:t.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let d=this._textureCache.length-1;d>=0;d--)this._textureCache[d].texture.dispose();this._textureCache.length=0}setPrePassRenderer(d){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=d.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(d){let t;if(d=d||this._camera,this._disposeTextures(),this._scene&&(t=this._scene.postProcesses.indexOf(this),-1!==t&&this._scene.postProcesses.splice(t,1)),this._parentContainer){const d=this._parentContainer.postProcesses.indexOf(this);d>-1&&this._parentContainer.postProcesses.splice(d,1),this._parentContainer=null}if(t=this._engine.postProcesses.indexOf(this),-1!==t&&this._engine.postProcesses.splice(t,1),d){if(d.detachPostProcess(this),t=d._postProcesses.indexOf(this),0===t&&d._postProcesses.length>0){const d=this._camera._getFirstPostProcess();d&&d.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const d=a.d.Serialize(this),t=this.getCamera()||this._scene&&this._scene.activeCamera;return d.customType="BABYLON."+this.getClassName(),d.cameraId=t?t.id:null,d.reusable=this._reusable,d.textureType=this._textureType,d.fragmentUrl=this._fragmentUrl,d.parameters=this._parameters,d.samplers=this._samplers,d.uniformBuffers=this._uniformBuffers,d.options=this._options,d.defines=this._postProcessDefines,d.textureFormat=this._textureFormat,d.vertexUrl=this._vertexUrl,d.indexParameters=this._indexParameters,d}clone(){const d=this.serialize();d._engine=this._engine,d.cameraId=null;const t=Q.Parse(d,this._scene,"");return t?(t.onActivateObservable=this.onActivateObservable.clone(),t.onSizeChangedObservable=this.onSizeChangedObservable.clone(),t.onApplyObservable=this.onApplyObservable.clone(),t.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),t.onAfterRenderObservable=this.onAfterRenderObservable.clone(),t._prePassEffectConfiguration=this._prePassEffectConfiguration,t):null}static Parse(d,t,A){const w=(0,D.d)(d.customType);if(!w||!w._Parse)return null;const N=t?t.getCameraById(d.cameraId):null;return w._Parse(d,N,t,A)}static _Parse(d,t,A,w){return a.d.Parse((()=>new Q(d.name,d.fragmentUrl,d.parameters,d.samplers,d.options,t,d.renderTargetSamplingMode,d._engine,d.reusable,d.defines,d.textureType,d.vertexUrl,d.indexParameters,!1,d.textureFormat)),d,A,w)}}(0,w.b)([(0,W.J)()],Q.prototype,"uniqueId",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"name",null),(0,w.b)([(0,W.J)()],Q.prototype,"width",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"height",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"renderTargetSamplingMode",void 0),(0,w.b)([(0,W.m)()],Q.prototype,"clearColor",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"Ri",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"forceAutoClearInAlphaMode",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"alphaMode",null),(0,w.b)([(0,W.J)()],Q.prototype,"alphaConstants",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"enablePixelPerfectMode",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"forceFullscreenViewport",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"scaleMode",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"alwaysForcePOT",void 0),(0,w.b)([(0,W.J)("samples")],Q.prototype,"_samples",void 0),(0,w.b)([(0,W.J)()],Q.prototype,"adaptScaleToCurrentViewport",void 0),(0,D.g)("BABYLON.PostProcess",Q)},11132:(d,t,A)=>{"use strict";A.d(t,{b:()=>p});var w=A(11120),N=A(10730);class p{constructor(d){this._vertexBuffers={},this.onBeforeRenderObservable=new N.b,this._scene=d}_prepareBuffers(){if(this._vertexBuffers[w.f.PositionKind])return;const d=[];d.push(1,1),d.push(-1,1),d.push(-1,-1),d.push(1,-1),this._vertexBuffers[w.f.PositionKind]=new w.f(this._scene.getEngine(),d,w.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const d=[];d.push(0),d.push(1),d.push(2),d.push(0),d.push(2),d.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(d)}_rebuild(){const d=this._vertexBuffers[w.f.PositionKind];d&&(d._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const A=this._scene.activeCamera;return!!A&&(t=t||A._postProcesses.filter((d=>null!=d)),!(!t||0===t.length||!this._scene.postProcessesEnabled)&&(t[0].activate(A,d,null!==t&&void 0!==t),!0))}directRender(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]&&arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const B=this._scene.getEngine();for(let W=0;W<d.length;W++){var X;if(W<d.length-1)d[W+1].activate(this._scene.activeCamera,null===t||void 0===t?void 0:t.texture);else t?B.bindFramebuffer(t,w,void 0,void 0,A,N):p||B.restoreDefaultFramebuffer(),null===(X=B._debugInsertMarker)||void 0===X||X.call(B,`post process ${d[W].name} output`);const a=d[W],D=a.apply();D&&(a.onBeforeRenderObservable.notifyObservers(D),this._prepareBuffers(),B.bindBuffers(this._vertexBuffers,this._indexBuffer,D),B.drawElementsType(0,0,6),a.onAfterRenderObservable.notifyObservers(D))}B.setDepthBuffer(!0),B.setDepthWrite(!0)}_finalizeFrame(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const p=this._scene.activeCamera;if(!p)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(w=w||p._postProcesses.filter((d=>null!=d))).length||!this._scene.postProcessesEnabled)return;const B=this._scene.getEngine();for(let W=0,a=w.length;W<a;W++){const D=w[W];var X;if(W<a-1)D._outputTexture=w[W+1].activate(p,null===t||void 0===t?void 0:t.texture);else t?(B.bindFramebuffer(t,A,void 0,void 0,N),D._outputTexture=t):(B.restoreDefaultFramebuffer(),D._outputTexture=null),null===(X=B._debugInsertMarker)||void 0===X||X.call(B,`post process ${w[W].name} output`);if(d)break;const i=D.apply();i&&(D.onBeforeRenderObservable.notifyObservers(i),this._prepareBuffers(),B.bindBuffers(this._vertexBuffers,this._indexBuffer,i),B.drawElementsType(0,0,6),D.onAfterRenderObservable.notifyObservers(i))}B.setDepthBuffer(!0),B.setDepthWrite(!0),B.setAlphaMode(0)}dispose(){const d=this._vertexBuffers[w.f.PositionKind];d&&(d.dispose(),this._vertexBuffers[w.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11137:(d,t,A)=>{"use strict";A.d(t,{e:()=>X});var w=A(11054),N=A(11076);class p{set opaqueSortCompareFn(d){this._opaqueSortCompareFn=d||p.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(d){this._alphaTestSortCompareFn=d||p.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(d){this._transparentSortCompareFn=d||p.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,p=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=d,this._opaqueSubMeshes=new w.d(256),this._transparentSubMeshes=new w.d(256),this._alphaTestSubMeshes=new w.d(256),this._depthOnlySubMeshes=new w.d(256),this._particleSystems=new w.d(256),this._spriteManagers=new w.d(256),this._empty=!0,this._edgesRenderers=new w.b(16),this._scene=t,this.opaqueSortCompareFn=A,this.alphaTestSortCompareFn=N,this.transparentSortCompareFn=p}render(d,t,A,w){if(d)return void d(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const N=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(N.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),N.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const p=N.getStencilBuffer();if(N.setStencilBuffer(!1),t&&this._renderSprites(),A&&this._renderParticles(w),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(N.setStencilBuffer(p),this._scene.useOrderIndependentTransparency){const d=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);d.length&&this._renderTransparent(d)}else this._renderTransparent(this._transparentSubMeshes);N.setAlphaMode(0)}if(N.setStencilBuffer(!1),this._edgesRenderers.length){for(let d=0;d<this._edgesRenderers.length;d++)this._edgesRenderers.data[d].render();N.setAlphaMode(0)}N.setStencilBuffer(p)}_renderOpaqueSorted(d){p._RenderSorted(d,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(d){p._RenderSorted(d,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(d){p._RenderSorted(d,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(d,t,A,w){let B,X=0;const W=A?A.globalPosition:p._ZeroVector;if(w)for(;X<d.length;X++)B=d.data[X],B._alphaIndex=B.getMesh().alphaIndex,B._distanceToCamera=N.l.Distance(B.getBoundingInfo().boundingSphere.centerWorld,W);const a=d.length===d.data.length?d.data:d.data.slice(0,d.length);t&&a.sort(t);const D=a[0].getMesh().va();for(X=0;X<a.length;X++)if(B=a[X],!D._activeMeshesFrozenButKeepClipping||B.isInFrustum(D._frustumPlanes)){if(w){const d=B.Ha();if(d&&d.needDepthPrePass){const t=d.va().getEngine();t.setColorWrite(!1),t.setAlphaMode(0),B.render(!1),t.setColorWrite(!0)}}B.render(w)}}static defaultTransparentSortCompare(d,t){return d._alphaIndex>t._alphaIndex?1:d._alphaIndex<t._alphaIndex?-1:p.backToFrontSortCompare(d,t)}static backToFrontSortCompare(d,t){return d._distanceToCamera<t._distanceToCamera?1:d._distanceToCamera>t._distanceToCamera?-1:0}static frontToBackSortCompare(d,t){return d._distanceToCamera<t._distanceToCamera?-1:d._distanceToCamera>t._distanceToCamera?1:0}static PainterSortCompare(d,t){const A=d.getMesh(),w=t.getMesh();return A.material&&w.material?A.material.uniqueId-w.material.uniqueId:A.uniqueId-w.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(d,t,A){void 0===t&&(t=d.getMesh()),void 0===A&&(A=d.Ha()),null!==A&&void 0!==A&&(A.needAlphaBlendingForMesh(t)?this._transparentSubMeshes.push(d):A.needAlphaTesting()?(A.needDepthPrePass&&this._depthOnlySubMeshes.push(d),this._alphaTestSubMeshes.push(d)):(A.needDepthPrePass&&this._depthOnlySubMeshes.push(d),this._opaqueSubMeshes.push(d)),t._renderingGroup=this,t._edgesRenderer&&t.isEnabled()&&t.isVisible&&t._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(t._edgesRenderer),this._empty=!1)}dispatchSprites(d){this._spriteManagers.push(d),this._empty=!1}dispatchParticles(d){this._particleSystems.push(d),this._empty=!1}_renderParticles(d){if(0===this._particleSystems.length)return;const t=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let A=0;A<this._particleSystems.length;A++){const w=this._particleSystems.data[A];if(0===(t&&t.layerMask&w.layerMask))continue;const N=w.k;N.position&&d&&-1===d.indexOf(N)||this._scene._activeParticles.addCount(w.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const d=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let t=0;t<this._spriteManagers.length;t++){const A=this._spriteManagers.data[t];0!==(d&&d.layerMask&A.layerMask)&&A.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}p._ZeroVector=N.l.Zero();class B{}class X{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(d){d!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=d,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const d of this._scene.meshes)if(d.If)for(const t of d.If)t._wasDispatched=!1;if(this._scene.spriteManagers)for(const d of this._scene.spriteManagers)d._wasDispatched=!1;for(const d of this._scene.nj)d._wasDispatched=!1}constructor(d){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new B,this._maintainStateBetweenFrames=!1,this._scene=d;for(let t=X.MIN_RENDERINGGROUPS;t<X.MAX_RENDERINGGROUPS;t++)this._autoClearDepthStencil[t]={Ri:!0,depth:!0,stencil:!0}}getRenderingGroup(d){const t=d||0;return this._prepareRenderingGroup(t),this._renderingGroups[t]}_clearDepthStencilBuffer(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,d,t),this._depthStencilBufferAlreadyCleaned=!0)}render(d,t,A,w){const N=this._renderingGroupInfo;if(N.Hf=this._scene,N.camera=this._scene.activeCamera,this._scene.spriteManagers&&w)for(let p=0;p<this._scene.spriteManagers.length;p++){const d=this._scene.spriteManagers[p];this.dispatchSprites(d)}for(let p=X.MIN_RENDERINGGROUPS;p<X.MAX_RENDERINGGROUPS;p++){this._depthStencilBufferAlreadyCleaned=p===X.MIN_RENDERINGGROUPS;const B=this._renderingGroups[p];if(!B||B._empty)continue;const W=1<<p;if(N.renderingGroupId=p,this._scene.onBeforeRenderingGroupObservable.notifyObservers(N,W),X.AUTOCLEAR){const d=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(p):this._autoClearDepthStencil[p];d&&d.Ri&&this._clearDepthStencilBuffer(d.depth,d.stencil)}for(const d of this._scene._beforeRenderingGroupDrawStage)d.action(p);B.render(d,w,A,t);for(const d of this._scene._afterRenderingGroupDrawStage)d.action(p);this._scene.onAfterRenderingGroupObservable.notifyObservers(N,W)}}reset(){if(!this.maintainStateBetweenFrames)for(let d=X.MIN_RENDERINGGROUPS;d<X.MAX_RENDERINGGROUPS;d++){const t=this._renderingGroups[d];t&&t.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let d=X.MIN_RENDERINGGROUPS;d<X.MAX_RENDERINGGROUPS;d++){const t=this._renderingGroups[d];t&&t.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let d=X.MIN_RENDERINGGROUPS;d<X.MAX_RENDERINGGROUPS;d++){const t=this._renderingGroups[d];t&&t.dispose()}}_prepareRenderingGroup(d){void 0===this._renderingGroups[d]&&(this._renderingGroups[d]=new p(d,this._scene,this._customOpaqueSortCompareFn[d],this._customAlphaTestSortCompareFn[d],this._customTransparentSortCompareFn[d]))}dispatchSprites(d){this.maintainStateBetweenFrames&&d._wasDispatched||(d._wasDispatched=!0,this.getRenderingGroup(d.renderingGroupId).dispatchSprites(d))}dispatchParticles(d){this.maintainStateBetweenFrames&&d._wasDispatched||(d._wasDispatched=!0,this.getRenderingGroup(d.renderingGroupId).dispatchParticles(d))}dispatch(d,t,A){void 0===t&&(t=d.getMesh()),this.maintainStateBetweenFrames&&d._wasDispatched||(d._wasDispatched=!0,this.getRenderingGroup(t.renderingGroupId).dispatch(d,t,A))}setRenderingOrder(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[d]=t,this._customAlphaTestSortCompareFn[d]=A,this._customTransparentSortCompareFn[d]=w,this._renderingGroups[d]){const t=this._renderingGroups[d];t.opaqueSortCompareFn=this._customOpaqueSortCompareFn[d],t.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[d],t.transparentSortCompareFn=this._customTransparentSortCompareFn[d]}}setRenderingAutoClearDepthStencil(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[d]={Ri:t,depth:A,stencil:w}}getAutoClearDepthStencilSetup(d){return this._autoClearDepthStencil[d]}}X.MAX_RENDERINGGROUPS=4,X.MIN_RENDERINGGROUPS=0,X.AUTOCLEAR=!0},11801:(d,t,A)=>{"use strict";const w="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11760:(d,t,A)=>{"use strict";const w="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11845:(d,t,A)=>{"use strict";const w="clipPlaneVertex",N="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11828:(d,t,A)=>{"use strict";const w="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11814:(d,t,A)=>{"use strict";const w="fogFragment",N="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11793:(d,t,A)=>{"use strict";const w="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11848:(d,t,A)=>{"use strict";const w="fogVertex",N="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11837:(d,t,A)=>{"use strict";const w="fogVertexDeclaration",N="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11778:(d,t,A)=>{"use strict";const w="helperFunctions",N="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11767:(d,t,A)=>{"use strict";const w="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11786:(d,t,A)=>{"use strict";const w="imageProcessingFunctions",N="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";A(10837).c.IncludesShadersStoreWGSL[w]=N},11770:(d,t,A)=>{"use strict";const w="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11805:(d,t,A)=>{"use strict";const w="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11850:(d,t,A)=>{"use strict";const w="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";A(10837).c.IncludesShadersStoreWGSL[w]=N},11755:(d,t,A)=>{"use strict";A.r(t),A.d(t,{particlesPixelShaderWGSL:()=>B});var w=A(10837);A(11760),A(11767),A(11770),A(11778),A(11786),A(11793),A(11801),A(11805),A(11814);const N="particlesPixelShader",p="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";w.c.ShadersStoreWGSL[N]=p;const B={name:N,shader:p}},11821:(d,t,A)=>{"use strict";A.r(t),A.d(t,{particlesVertexShaderWGSL:()=>B});var w=A(10837);A(11828),A(11837),A(11770),A(11845),A(11848),A(11850);const N="particlesVertexShader",p="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";w.c.ShadersStoreWGSL[N]=p;const B={name:N,shader:p}},11663:(d,t,A)=>{"use strict";const w="clipPlaneFragment",N="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11738:(d,t,A)=>{"use strict";const w="clipPlaneFragmentDeclaration",N="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11692:(d,t,A)=>{"use strict";const w="clipPlaneVertex",N="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11751:(d,t,A)=>{"use strict";const w="clipPlaneVertexDeclaration",N="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11678:(d,t,A)=>{"use strict";const w="fogFragment",N="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11654:(d,t,A)=>{"use strict";const w="fogFragmentDeclaration",N="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11698:(d,t,A)=>{"use strict";const w="fogVertex",N="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11684:(d,t,A)=>{"use strict";const w="fogVertexDeclaration",N="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11638:(d,t,A)=>{"use strict";const w="helperFunctions",N="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";A(10837).c.IncludesShadersStore[w]=N},11624:(d,t,A)=>{"use strict";const w="imageProcessingDeclaration",N="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11645:(d,t,A)=>{"use strict";const w="imageProcessingFunctions",N="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";A(10837).c.IncludesShadersStore[w]=N},11633:(d,t,A)=>{"use strict";const w="logDepthDeclaration",N="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11669:(d,t,A)=>{"use strict";const w="logDepthFragment",N="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11704:(d,t,A)=>{"use strict";const w="logDepthVertex",N="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";A(10837).c.IncludesShadersStore[w]=N},11729:(d,t,A)=>{"use strict";A.r(t),A.d(t,{particlesPixelShader:()=>B});var w=A(10837);A(11738),A(11624),A(11633),A(11638),A(11645),A(11654),A(11663),A(11669),A(11678);const N="particlesPixelShader",p="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";w.c.ShadersStore[N]=p;const B={name:N,shader:p}},11743:(d,t,A)=>{"use strict";A.r(t),A.d(t,{particlesVertexShader:()=>B});var w=A(10837);A(11751),A(11684),A(11633),A(11692),A(11698),A(11704);const N="particlesVertexShader",p="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";w.c.ShadersStore[N]=p;const B={name:N,shader:p}},11599:(d,t,A)=>{"use strict";A.r(t),A.d(t,{postprocessVertexShader:()=>p});const w="postprocessVertexShader",N="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";A(10837).c.ShadersStore[w]=N;const p={name:w,shader:N}},11165:(d,t,A)=>{"use strict";A.d(t,{d:()=>w});class w{}w._IsPickingAvailable=!1},11326:(d,t,A)=>{"use strict";A.d(t,{d:()=>i});var w=A(11041),N=A(11076),p=A(11047),B=A(10730),X=A(10775),W=A(10761),a=A(11097);class D{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new B.b,this._onClonedObservable=new B.b}}class i{static AddNodeConstructor(d,t){this._NodeConstructors[d]=t}static Construct(d,t,A,w){const N=this._NodeConstructors[d];return N?N(t,A,w):null}set accessibilityTag(d){this._accessibilityTag=d,this.onAccessibilityTagChangedObservable.notifyObservers(d)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(d){this._nodeDataStorage._doNotSerialize=d}u(){return this._nodeDataStorage._isDisposed}set parent(d){if(this._parentNode===d)return;const t=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const t=this._parentNode._children.indexOf(this);-1!==t&&this._parentNode._children.splice(t,1),d||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=d,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),t||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(d){d.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const d=this._scene.rootNodes,t=d.length-1;d[this._nodeDataStorage._sceneRootNodesIndex]=d[t],d[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(d){this._animationPropertiesOverride=d}getClassName(){return"Node"}set onDispose(d){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(d)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new D,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new B.b,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=N.c.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.hj=new B.b,this._onDisposeObserver=null,this._behaviors=new Array,this.name=d,this.id=d,this._scene=t||X.e.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),A&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(d)||(d.init(),this._scene.isLoading&&!t?this._scene.onDataLoadedObservable.addOnce((()=>{d.attach(this)})):d.attach(this),this._behaviors.push(d)),this}removeBehavior(d){const t=this._behaviors.indexOf(d);return-1===t||(this._behaviors[t].detach(),this._behaviors.splice(t,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(d){for(const t of this._behaviors)if(t.name===d)return t;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.Nj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(d){!d&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(d){return this.parent?this.parent._getActionManagerForTrigger(d,!1):null}_updateCache(d){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}Cg(d){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((d=>{d._syncParentEnabledState()}))}Mf(d){this._nodeDataStorage._isEnabled!==d&&(this._nodeDataStorage._isEnabled=d,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(d))}isDescendantOf(d){return!!this.parent&&(this.parent===d||this.parent.isDescendantOf(d))}_getDescendants(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;if(this._children)for(let w=0;w<this._children.length;w++){const N=this._children[w];A&&!A(N)||d.push(N),t||N._getDescendants(d,!1,A)}}getDescendants(d,t){const A=[];return this._getDescendants(A,d,t),A}getChildMeshes(d,t){const A=[];return this._getDescendants(A,d,(d=>(!t||t(d))&&void 0!==d.Bi)),A}getChildren(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(t,d)}_setReady(d){d!==this._nodeDataStorage._isReady&&(d?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(d){for(let t=0;t<this.animations.length;t++){const A=this.animations[t];if(A.name===d)return A}return null}createAnimationRange(d,t,A){if(!this._ranges[d]){this._ranges[d]=i._AnimationRangeFactory(d,t,A);for(let w=0,N=this.animations.length;w<N;w++)this.animations[w]&&this.animations[w].createRange(d,t,A)}}deleteAnimationRange(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let A=0,w=this.animations.length;A<w;A++)this.animations[A]&&this.animations[A].deleteRange(d,t);this._ranges[d]=null}getAnimationRange(d){return this._ranges[d]||null}clone(d,t,A){const w=a.d.Clone((()=>new i(d,this.va())),this);if(t&&(w.parent=t),!A){const t=this.getDescendants(!0);for(let A=0;A<t.length;A++){const N=t[A];N.clone(d+"."+N.name,w)}}return w}getAnimationRanges(){const d=[];let t;for(t in this._ranges)d.push(this._ranges[t]);return d}beginAnimation(d,t,A,w){const N=this.getAnimationRange(d);return N?this._scene.beginAnimation(this,N.from,N.to,t,A,w):null}serializeAnimationRanges(){const d=[];for(const t in this._ranges){const A=this._ranges[t];if(!A)continue;const w={};w.name=t,w.from=A.from,w.to=A.to,d.push(w)}return d}Nj(d){return this._worldMatrix||(this._worldMatrix=N.c.Identity()),this._worldMatrix}dispose(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!d){const A=this.getDescendants(!0);for(const w of A)w.dispose(d,t)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.hj.notifyObservers(this),this.hj.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const A of this._behaviors)A.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(d,t,A){if(t.ranges)for(let w=0;w<t.ranges.length;w++){const A=t.ranges[w];d.createAnimationRange(A.name,A.from,A.to)}}getHierarchyBoundingVectors(){let d,t,A=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],w=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.Nj(!0);const p=this;if(p.getBoundingInfo&&p.If){const A=p.getBoundingInfo();d=A.boundingBox.minimumWorld.clone(),t=A.boundingBox.maximumWorld.clone()}else d=new N.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),t=new N.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(A){const A=this.getDescendants(!1);for(const p of A){const A=p;if(A.Nj(!0),w&&!w(A))continue;if(!A.getBoundingInfo||0===A.getTotalVertices())continue;const B=A.getBoundingInfo().boundingBox,X=B.minimumWorld,W=B.maximumWorld;N.l.CheckExtends(X,d,t),N.l.CheckExtends(W,d,t)}}return{min:d,max:t}}}i._AnimationRangeFactory=(d,t,A)=>{throw(0,W.b)("AnimationRange")},i._NodeConstructors={},(0,w.b)([(0,p.J)()],i.prototype,"name",void 0),(0,w.b)([(0,p.J)()],i.prototype,"id",void 0),(0,w.b)([(0,p.J)()],i.prototype,"uniqueId",void 0),(0,w.b)([(0,p.J)()],i.prototype,"state",void 0),(0,w.b)([(0,p.J)()],i.prototype,"metadata",void 0)},11061:(d,t,A)=>{"use strict";A.d(t,{e:()=>dd});var w=A(10727),N=A(10756),p=A(10730),B=A(11054);class X{constructor(){this._count=0,this._data={}}p(d){this.clear(),d.forEach(((d,t)=>this.add(d,t)))}get(d){const t=this._data[d];if(void 0!==t)return t}getOrAddWithFactory(d,t){let A=this.get(d);return void 0!==A||(A=t(d),A&&this.add(d,A)),A}getOrAdd(d,t){const A=this.get(d);return void 0!==A?A:(this.add(d,t),t)}contains(d){return void 0!==this._data[d]}add(d,t){return void 0===this._data[d]&&(this._data[d]=t,++this._count,!0)}set(d,t){return void 0!==this._data[d]&&(this._data[d]=t,!0)}getAndRemove(d){const t=this.get(d);return void 0!==t?(delete this._data[d],--this._count,t):null}remove(d){return!!this.contains(d)&&(delete this._data[d],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(d){for(const t in this._data){d(t,this._data[t])}}first(d){for(const t in this._data){const A=d(t,this._data[t]);if(A)return A}return null}}var W=A(11067),a=A(11076),D=A(11092),i=A(11108),k=A(11115);class b{constructor(d,t,A,w,N,p){this.source=d,this.pointerX=t,this.pointerY=A,this.meshUnderPointer=w,this.sourceEvent=N,this.additionalData=p}static CreateNew(d,t,A){const w=d.va();return new b(d,w.pointerX,w.pointerY,w.meshUnderPointer||d,t,A)}static CreateNewFromSprite(d,t,A,w){return new b(d,t.pointerX,t.pointerY,t.meshUnderPointer,A,w)}static CreateNewFromScene(d,t){return new b(null,d.pointerX,d.pointerY,d.meshUnderPointer,t)}static CreateNewFromPrimitive(d,t,A,w){return new b(d,t.x,t.y,null,A,w)}}var Q=A(11132),P=A(11137),J=A(11146),U=A(10737),T=A(10775),F=A(10761),q=A(11151);class H{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const d in H.Triggers)if(Object.prototype.hasOwnProperty.call(H.Triggers,d))return!0;return!1}static get HasPickTriggers(){for(const d in H.Triggers)if(Object.prototype.hasOwnProperty.call(H.Triggers,d)){const t=parseInt(d);if(t>=1&&t<=7)return!0}return!1}static HasSpecificTrigger(d){for(const t in H.Triggers)if(Object.prototype.hasOwnProperty.call(H.Triggers,t)){if(parseInt(t)===d)return!0}return!1}}H.Triggers={};var f,v,m,j,n,R,Z,L=A(11156);!function(d){d[d.Generic=0]="Generic",d[d.Keyboard=1]="Keyboard",d[d.Mouse=2]="Mouse",d[d.Touch=3]="Touch",d[d.DualShock=4]="DualShock",d[d.Xbox=5]="Xbox",d[d.Switch=6]="Switch",d[d.DualSense=7]="DualSense"}(f||(f={})),function(d){d[d.Horizontal=0]="Horizontal",d[d.Vertical=1]="Vertical",d[d.LeftClick=2]="LeftClick",d[d.MiddleClick=3]="MiddleClick",d[d.RightClick=4]="RightClick",d[d.BrowserBack=5]="BrowserBack",d[d.BrowserForward=6]="BrowserForward",d[d.MouseWheelX=7]="MouseWheelX",d[d.MouseWheelY=8]="MouseWheelY",d[d.MouseWheelZ=9]="MouseWheelZ",d[d.Move=12]="Move"}(v||(v={})),function(d){d[d.Horizontal=0]="Horizontal",d[d.Vertical=1]="Vertical",d[d.LeftClick=2]="LeftClick",d[d.MiddleClick=3]="MiddleClick",d[d.RightClick=4]="RightClick",d[d.BrowserBack=5]="BrowserBack",d[d.BrowserForward=6]="BrowserForward",d[d.MouseWheelX=7]="MouseWheelX",d[d.MouseWheelY=8]="MouseWheelY",d[d.MouseWheelZ=9]="MouseWheelZ",d[d.DeltaHorizontal=10]="DeltaHorizontal",d[d.DeltaVertical=11]="DeltaVertical"}(m||(m={})),function(d){d[d.Cross=0]="Cross",d[d.Circle=1]="Circle",d[d.Square=2]="Square",d[d.Triangle=3]="Triangle",d[d.L1=4]="L1",d[d.R1=5]="R1",d[d.L2=6]="L2",d[d.R2=7]="R2",d[d.Share=8]="Share",d[d.Options=9]="Options",d[d.L3=10]="L3",d[d.R3=11]="R3",d[d.DPadUp=12]="DPadUp",d[d.DPadDown=13]="DPadDown",d[d.DPadLeft=14]="DPadLeft",d[d.DPadRight=15]="DPadRight",d[d.Home=16]="Home",d[d.TouchPad=17]="TouchPad",d[d.LStickXAxis=18]="LStickXAxis",d[d.LStickYAxis=19]="LStickYAxis",d[d.RStickXAxis=20]="RStickXAxis",d[d.RStickYAxis=21]="RStickYAxis"}(j||(j={})),function(d){d[d.Cross=0]="Cross",d[d.Circle=1]="Circle",d[d.Square=2]="Square",d[d.Triangle=3]="Triangle",d[d.L1=4]="L1",d[d.R1=5]="R1",d[d.L2=6]="L2",d[d.R2=7]="R2",d[d.Create=8]="Create",d[d.Options=9]="Options",d[d.L3=10]="L3",d[d.R3=11]="R3",d[d.DPadUp=12]="DPadUp",d[d.DPadDown=13]="DPadDown",d[d.DPadLeft=14]="DPadLeft",d[d.DPadRight=15]="DPadRight",d[d.Home=16]="Home",d[d.TouchPad=17]="TouchPad",d[d.LStickXAxis=18]="LStickXAxis",d[d.LStickYAxis=19]="LStickYAxis",d[d.RStickXAxis=20]="RStickXAxis",d[d.RStickYAxis=21]="RStickYAxis"}(n||(n={})),function(d){d[d.A=0]="A",d[d.B=1]="B",d[d.X=2]="X",d[d.Y=3]="Y",d[d.LB=4]="LB",d[d.RB=5]="RB",d[d.LT=6]="LT",d[d.RT=7]="RT",d[d.Back=8]="Back",d[d.Start=9]="Start",d[d.LS=10]="LS",d[d.RS=11]="RS",d[d.DPadUp=12]="DPadUp",d[d.DPadDown=13]="DPadDown",d[d.DPadLeft=14]="DPadLeft",d[d.DPadRight=15]="DPadRight",d[d.Home=16]="Home",d[d.LStickXAxis=17]="LStickXAxis",d[d.LStickYAxis=18]="LStickYAxis",d[d.RStickXAxis=19]="RStickXAxis",d[d.RStickYAxis=20]="RStickYAxis"}(R||(R={})),function(d){d[d.B=0]="B",d[d.A=1]="A",d[d.Y=2]="Y",d[d.X=3]="X",d[d.L=4]="L",d[d.R=5]="R",d[d.ZL=6]="ZL",d[d.ZR=7]="ZR",d[d.Minus=8]="Minus",d[d.Plus=9]="Plus",d[d.LS=10]="LS",d[d.RS=11]="RS",d[d.DPadUp=12]="DPadUp",d[d.DPadDown=13]="DPadDown",d[d.DPadLeft=14]="DPadLeft",d[d.DPadRight=15]="DPadRight",d[d.Home=16]="Home",d[d.Capture=17]="Capture",d[d.LStickXAxis=18]="LStickXAxis",d[d.LStickYAxis=19]="LStickYAxis",d[d.RStickXAxis=20]="RStickXAxis",d[d.RStickYAxis=21]="RStickYAxis"}(Z||(Z={}));var I=A(11159);class u{static CreateDeviceEvent(d,t,A,w,N,p,B){switch(d){case f.Keyboard:return this._CreateKeyboardEvent(A,w,N,p);case f.Mouse:if(A===v.MouseWheelX||A===v.MouseWheelY||A===v.MouseWheelZ)return this._CreateWheelEvent(d,t,A,w,N,p);case f.Touch:return this._CreatePointerEvent(d,t,A,w,N,p,B);default:throw`Unable to generate event for device ${f[d]}`}}static _CreatePointerEvent(d,t,A,w,N,p,B){const X=this._CreateMouseEvent(d,t,A,w,N,p);d===f.Mouse?(X.deviceType=f.Mouse,X.pointerId=1,X.pointerType="mouse"):(X.deviceType=f.Touch,X.pointerId=B??t,X.pointerType="touch");let W=0;return W+=N.pollInput(d,t,v.LeftClick),W+=2*N.pollInput(d,t,v.RightClick),W+=4*N.pollInput(d,t,v.MiddleClick),X.buttons=W,A===v.Move?X.type="pointermove":A>=v.LeftClick&&A<=v.RightClick&&(X.type=1===w?"pointerdown":"pointerup",X.button=A-2),X}static _CreateWheelEvent(d,t,A,w,N,p){const B=this._CreateMouseEvent(d,t,A,w,N,p);switch(B.pointerId=1,B.type="wheel",B.deltaMode=I.e.DOM_DELTA_PIXEL,B.deltaX=0,B.deltaY=0,B.deltaZ=0,A){case v.MouseWheelX:B.deltaX=w;break;case v.MouseWheelY:B.deltaY=w;break;case v.MouseWheelZ:B.deltaZ=w}return B}static _CreateMouseEvent(d,t,A,w,N,p){const B=this._CreateEvent(p),X=N.pollInput(d,t,v.Horizontal),W=N.pollInput(d,t,v.Vertical);return p?(B.movementX=0,B.movementY=0,B.offsetX=B.movementX-p.getBoundingClientRect().x,B.offsetY=B.movementY-p.getBoundingClientRect().y):(B.movementX=N.pollInput(d,t,10),B.movementY=N.pollInput(d,t,11),B.offsetX=0,B.offsetY=0),this._CheckNonCharacterKeys(B,N),B.clientX=X,B.clientY=W,B.x=X,B.y=W,B.deviceType=d,B.deviceSlot=t,B.inputIndex=A,B}static _CreateKeyboardEvent(d,t,A,w){const N=this._CreateEvent(w);return this._CheckNonCharacterKeys(N,A),N.deviceType=f.Keyboard,N.deviceSlot=0,N.inputIndex=d,N.type=1===t?"keydown":"keyup",N.key=String.fromCharCode(d),N.keyCode=d,N}static _CheckNonCharacterKeys(d,t){const A=t.isDeviceAvailable(f.Keyboard),w=A&&1===t.pollInput(f.Keyboard,0,18),N=A&&1===t.pollInput(f.Keyboard,0,17),p=A&&(1===t.pollInput(f.Keyboard,0,91)||1===t.pollInput(f.Keyboard,0,92)||1===t.pollInput(f.Keyboard,0,93)),B=A&&1===t.pollInput(f.Keyboard,0,16);d.altKey=w,d.ctrlKey=N,d.metaKey=p,d.shiftKey=B}static _CreateEvent(d){const t={preventDefault:()=>{}};return t.target=d,t}}class V{constructor(d,t,A){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(d,t,((d,t,w,N)=>{const p=u.CreateDeviceEvent(d,t,w,N,this);A(d,t,p)})):this._createDummyNativeInput()}pollInput(d,t,A){return this._nativeInput.pollInput(d,t,A)}isDeviceAvailable(d){return d===f.Mouse||d===f.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const h=Object.keys(v).length/2;class l{constructor(d,t,A,N){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=w.g.IsSafari(),this._usingMacOS=(0,U.j)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=d=>{},this._keyboardUpEvent=d=>{},this._keyboardBlurEvent=d=>{},this._pointerMoveEvent=d=>{},this._pointerDownEvent=d=>{},this._pointerUpEvent=d=>{},this._pointerCancelEvent=d=>{},this._pointerWheelEvent=d=>{},this._pointerBlurEvent=d=>{},this._pointerMacOSChromeOutEvent=d=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,U.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,U.j)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=d=>{},this._gamepadDisconnectedEvent=d=>{},this._eventPrefix=w.g.GetPointerPrefix(d),this._engine=d,this._onDeviceConnected=t,this._onDeviceDisconnected=A,this._onInputChanged=N,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(d,t,A){const N=this._inputs[d][t];if(!N)throw`Unable to find device ${f[d]}`;d>=f.DualShock&&d<=f.DualSense&&this._updateDevice(d,t,A);const p=N[A];if(void 0===p)throw`Unable to find input ${A} for device ${f[d]} in slot ${t}`;return A===v.Move&&w.g.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),p}isDeviceAvailable(d){return void 0!==this._inputs[d]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const d=null===this||void 0===this?void 0:this._engine.getInputElement();if(d&&(!this._eventsAttached||this._elementToAttachTo!==d)){if(this._disableEvents(),this._inputs)for(const d of this._inputs)if(d)for(const t in d){const A=d[+t];if(A)for(let d=0;d<A.length;d++)A[d]=0}this._elementToAttachTo=d,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const d=navigator.getGamepads();for(const t of d)t&&this._addGamePad(t)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(f.Mouse,0,0,0)}_addGamePad(d){const t=this._getGamepadDeviceType(d.id),A=d.index;this._gamepads=this._gamepads||new Array(d.index+1),this._registerDevice(t,A,d.buttons.length+d.axes.length),this._gamepads[A]=t}_addPointerDevice(d,t,A,w){this._pointerActive||(this._pointerActive=!0),this._registerDevice(d,t,h);const N=this._inputs[d][t];N[0]=A,N[1]=w}_registerDevice(d,t,A){if(void 0===t)throw`Unable to register device ${f[d]} to undefined slot.`;if(this._inputs[d]||(this._inputs[d]={}),!this._inputs[d][t]){const w=new Array(A);w.fill(0),this._inputs[d][t]=w,this._onDeviceConnected(d,t)}}_unregisterDevice(d,t){this._inputs[d][t]&&(delete this._inputs[d][t],this._onDeviceDisconnected(d,t))}_handleKeyActions(){this._keyboardDownEvent=d=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(f.Keyboard,0,255));const t=this._inputs[f.Keyboard][0];if(t){t[d.keyCode]=1;const A=d;A.inputIndex=d.keyCode,this._usingMacOS&&d.metaKey&&"Meta"!==d.key&&(this._metaKeys.includes(d.keyCode)||this._metaKeys.push(d.keyCode)),this._onInputChanged(f.Keyboard,0,A)}},this._keyboardUpEvent=d=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(f.Keyboard,0,255));const t=this._inputs[f.Keyboard][0];if(t){t[d.keyCode]=0;const A=d;if(A.inputIndex=d.keyCode,this._usingMacOS&&"Meta"===d.key&&this._metaKeys.length>0){for(const d of this._metaKeys){const A=u.CreateDeviceEvent(f.Keyboard,0,d,0,this,this._elementToAttachTo);t[d]=0,this._onInputChanged(f.Keyboard,0,A)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(f.Keyboard,0,A)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const d=this._inputs[f.Keyboard][0];for(let t=0;t<d.length;t++)if(0!==d[t]){d[t]=0;const A=u.CreateDeviceEvent(f.Keyboard,0,t,0,this,this._elementToAttachTo);this._onInputChanged(f.Keyboard,0,A)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,U.j)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let w=0;w<this._maxTouchPoints;w++)this._activeTouchIds[w]=-1;this._pointerMoveEvent=d=>{const t=this._getPointerType(d);let A=t===f.Mouse?0:this._activeTouchIds.indexOf(d.pointerId);if(t===f.Touch&&-1===A){const N=this._activeTouchIds.indexOf(-1);if(!(N>=0))return void w.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);A=N,this._activeTouchIds[N]=d.pointerId,this._onDeviceConnected(t,A)}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][A]||this._addPointerDevice(t,A,d.clientX,d.clientY);const N=this._inputs[t][A];if(N){const w=d;w.inputIndex=v.Move,N[v.Horizontal]=d.clientX,N[v.Vertical]=d.clientY,t===f.Touch&&0===N[v.LeftClick]&&(N[v.LeftClick]=1),void 0===d.pointerId&&(d.pointerId=this._mouseId),this._onInputChanged(t,A,w),this._usingSafari||-1===d.button||(w.inputIndex=d.button+2,N[d.button+2]=N[d.button+2]?0:1,this._onInputChanged(t,A,w))}},this._pointerDownEvent=d=>{const t=this._getPointerType(d);let A=t===f.Mouse?0:d.pointerId;if(t===f.Touch){let t=this._activeTouchIds.indexOf(d.pointerId);if(-1===t&&(t=this._activeTouchIds.indexOf(-1)),!(t>=0))return void w.g.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);A=t,this._activeTouchIds[t]=d.pointerId}this._inputs[t]||(this._inputs[t]={}),this._inputs[t][A]?t===f.Touch&&this._onDeviceConnected(t,A):this._addPointerDevice(t,A,d.clientX,d.clientY);const N=this._inputs[t][A];if(N){const w=N[v.Horizontal],B=N[v.Vertical];if(t===f.Mouse){if(void 0===d.pointerId&&(d.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(p){}}else if(d.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(d.pointerId)}catch(p){}N[v.Horizontal]=d.clientX,N[v.Vertical]=d.clientY,N[d.button+2]=1;const X=d;X.inputIndex=d.button+2,this._onInputChanged(t,A,X),w===d.clientX&&B===d.clientY||(X.inputIndex=v.Move,this._onInputChanged(t,A,X))}},this._pointerUpEvent=d=>{var t;const A=this._getPointerType(d),w=A===f.Mouse?0:this._activeTouchIds.indexOf(d.pointerId);if(A===f.Touch){if(-1===w)return;this._activeTouchIds[w]=-1}const N=null===(t=this._inputs[A])||void 0===t?void 0:t[w];if(N&&0!==N[d.button+2]){var p,B,X,W;const t=N[v.Horizontal],a=N[v.Vertical];N[v.Horizontal]=d.clientX,N[v.Vertical]=d.clientY,N[d.button+2]=0;const D=d;void 0===d.pointerId&&(d.pointerId=this._mouseId),t===d.clientX&&a===d.clientY||(D.inputIndex=v.Move,this._onInputChanged(A,w,D)),D.inputIndex=d.button+2,A===f.Mouse&&this._mouseId>=0&&null!==(p=(B=this._elementToAttachTo).hasPointerCapture)&&void 0!==p&&p.call(B,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):d.pointerId&&null!==(X=(W=this._elementToAttachTo).hasPointerCapture)&&void 0!==X&&X.call(W,d.pointerId)&&this._elementToAttachTo.releasePointerCapture(d.pointerId),this._onInputChanged(A,w,D),A===f.Touch&&this._onDeviceDisconnected(A,w)}},this._pointerCancelEvent=d=>{if("mouse"===d.pointerType){var t,A;const d=this._inputs[f.Mouse][0];this._mouseId>=0&&null!==(t=(A=this._elementToAttachTo).hasPointerCapture)&&void 0!==t&&t.call(A,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let t=v.LeftClick;t<=v.BrowserForward;t++)if(1===d[t]){d[t]=0;const A=u.CreateDeviceEvent(f.Mouse,0,t,0,this,this._elementToAttachTo);this._onInputChanged(f.Mouse,0,A)}}else{var w,N;const t=this._activeTouchIds.indexOf(d.pointerId);if(-1===t)return;null!==(w=(N=this._elementToAttachTo).hasPointerCapture)&&void 0!==w&&w.call(N,d.pointerId)&&this._elementToAttachTo.releasePointerCapture(d.pointerId),this._inputs[f.Touch][t][v.LeftClick]=0;const A=u.CreateDeviceEvent(f.Touch,t,v.LeftClick,0,this,this._elementToAttachTo,d.pointerId);this._onInputChanged(f.Touch,t,A),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(f.Touch,t)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let d=!1;const t=function(){};try{const A=Object.defineProperty({},"passive",{get:function(){d=!0}});this._elementToAttachTo.addEventListener("test",t,A),this._elementToAttachTo.removeEventListener("test",t,A)}catch(A){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(f.Mouse)){var d,t;const A=this._inputs[f.Mouse][0];this._mouseId>=0&&null!==(d=(t=this._elementToAttachTo).hasPointerCapture)&&void 0!==d&&d.call(t,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let d=v.LeftClick;d<=v.BrowserForward;d++)if(1===A[d]){A[d]=0;const t=u.CreateDeviceEvent(f.Mouse,0,d,0,this,this._elementToAttachTo);this._onInputChanged(f.Mouse,0,t)}}if(this.isDeviceAvailable(f.Touch)){const d=this._inputs[f.Touch];for(let t=0;t<this._activeTouchIds.length;t++){var A,w,N;const p=this._activeTouchIds[t];if(null!==(A=(w=this._elementToAttachTo).hasPointerCapture)&&void 0!==A&&A.call(w,p)&&this._elementToAttachTo.releasePointerCapture(p),-1!==p&&1===(null===(N=d[t])||void 0===N?void 0:N[v.LeftClick])){d[t][v.LeftClick]=0;const A=u.CreateDeviceEvent(f.Touch,t,v.LeftClick,0,this,this._elementToAttachTo,p);this._onInputChanged(f.Touch,t,A),this._activeTouchIds[t]=-1,this._onDeviceDisconnected(f.Touch,t)}}}},this._pointerWheelEvent=d=>{const t=f.Mouse;this._inputs[t]||(this._inputs[t]=[]),this._inputs[t][0]||(this._pointerActive=!0,this._registerDevice(t,0,h));const A=this._inputs[t][0];if(A){A[v.MouseWheelX]=d.deltaX||0,A[v.MouseWheelY]=d.deltaY||d.wheelDelta||0,A[v.MouseWheelZ]=d.deltaZ||0;const w=d;void 0===d.pointerId&&(d.pointerId=this._mouseId),0!==A[v.MouseWheelX]&&(w.inputIndex=v.MouseWheelX,this._onInputChanged(t,0,w)),0!==A[v.MouseWheelY]&&(w.inputIndex=v.MouseWheelY,this._onInputChanged(t,0,w)),0!==A[v.MouseWheelZ]&&(w.inputIndex=v.MouseWheelZ,this._onInputChanged(t,0,w))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=d=>{d.buttons>1&&this._pointerCancelEvent(d)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!d&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(f.Mouse)){const d=this._inputs[f.Mouse][0];d[v.MouseWheelX]=0,d[v.MouseWheelY]=0,d[v.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=d=>{this._addGamePad(d.gamepad)},this._gamepadDisconnectedEvent=d=>{if(this._gamepads){const t=this._getGamepadDeviceType(d.gamepad.id),A=d.gamepad.index;this._unregisterDevice(t,A),delete this._gamepads[A]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(d,t,A){const w=navigator.getGamepads()[t];if(w&&d===this._gamepads[t]){const N=this._inputs[d][t];A>=w.buttons.length?N[A]=w.axes[A-w.buttons.length].valueOf():N[A]=w.buttons[A].value}}_getGamepadDeviceType(d){return-1!==d.indexOf("054c")?-1!==d.indexOf("0ce6")?f.DualSense:f.DualShock:-1!==d.indexOf("Xbox One")||-1!==d.search("Xbox 360")||-1!==d.search("xinput")?f.Xbox:-1!==d.indexOf("057e")?f.Switch:f.Generic}_getPointerType(d){let t=f.Mouse;return("touch"===d.pointerType||"pen"===d.pointerType||d.touches)&&(t=f.Touch),t}}class y{constructor(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=t,this.deviceSlot=A,this.onInputChangedObservable=new p.b,this._deviceInputSystem=d}getInput(d){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,d)}}class s{constructor(d){this._registeredManagers=new Array,this._refCount=0,this.registerManager=d=>{for(let t=0;t<this._devices.length;t++){const A=this._devices[t];for(const w in A){const A=+w;d._addDevice(new y(this._deviceInputSystem,t,A))}}this._registeredManagers.push(d)},this.unregisterManager=d=>{const t=this._registeredManagers.indexOf(d);t>-1&&this._registeredManagers.splice(t,1)};const t=Object.keys(f).length/2;this._devices=new Array(t);const A=(d,t)=>{this._devices[d]||(this._devices[d]=new Array),this._devices[d][t]||(this._devices[d][t]=t);for(const A of this._registeredManagers){const w=new y(this._deviceInputSystem,d,t);A._addDevice(w)}},w=(d,t)=>{var A;null!==(A=this._devices[d])&&void 0!==A&&A[t]&&delete this._devices[d][t];for(const w of this._registeredManagers)w._removeDevice(d,t)},N=(d,t,A)=>{if(A)for(const w of this._registeredManagers)w._onInputChanged(d,t,A)};"undefined"!==typeof _native?this._deviceInputSystem=new V(A,w,N):this._deviceInputSystem=new l(d,A,w,N)}dispose(){this._deviceInputSystem.dispose()}}class Y{getDeviceSource(d,t){if(void 0===t){if(void 0===this._firstDevice[d])return null;t=this._firstDevice[d]}return this._devices[d]&&void 0!==this._devices[d][t]?this._devices[d][t]:null}getDeviceSources(d){return this._devices[d]?this._devices[d].filter((d=>!!d)):[]}constructor(d){const t=Object.keys(f).length/2;this._devices=new Array(t),this._firstDevice=new Array(t),this._engine=d,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new s(d)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new p.b((d=>{for(const t of this._devices)if(t)for(const A of t)A&&this.onDeviceConnectedObservable.notifyObserver(d,A)})),this.onDeviceDisconnectedObservable=new p.b,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=d.hj.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.hj.remove(this._onDisposeObserver)}_addDevice(d){this._devices[d.deviceType]||(this._devices[d.deviceType]=new Array),this._devices[d.deviceType][d.deviceSlot]||(this._devices[d.deviceType][d.deviceSlot]=d,this._updateFirstDevices(d.deviceType)),this.onDeviceConnectedObservable.notifyObservers(d)}_removeDevice(d,t){var A,w;const N=null===(A=this._devices[d])||void 0===A?void 0:A[t];this.onDeviceDisconnectedObservable.notifyObservers(N),null!==(w=this._devices[d])&&void 0!==w&&w[t]&&delete this._devices[d][t],this._updateFirstDevices(d)}_onInputChanged(d,t,A){var w,N;null===(w=this._devices[d])||void 0===w||null===(N=w[t])||void 0===N||N.onInputChangedObservable.notifyObservers(A)}_updateFirstDevices(d){switch(d){case f.Keyboard:case f.Mouse:this._firstDevice[d]=0;break;case f.Touch:case f.DualSense:case f.DualShock:case f.Xbox:case f.Switch:case f.Generic:{delete this._firstDevice[d];const t=this._devices[d];if(t)for(let A=0;A<t.length;A++)if(t[A]){this._firstDevice[d]=A;break}break}}}}var r=A(11165);class K{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(d){this._singleClick=d}set doubleClick(d){this._doubleClick=d}set hasSwiped(d){this._hasSwiped=d}set ignore(d){this._ignore=d}}class G{constructor(d){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new a.j(0,0),this._previousStartingPointerPosition=new a.j(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=d||T.e.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(d){return this._meshUnderPointerId[d]||null}get unTranslatedPointer(){return new a.j(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(d){this._pointerX=d}get pointerY(){return this._pointerY}set pointerY(d){this._pointerY=d}_updatePointerPosition(d){const t=this._scene.getEngine().getInputElementClientRect();t&&(this._pointerX=d.clientX-t.left,this._pointerY=d.clientY-t.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(d,t){const A=this._scene,w=A.getEngine(),N=w.getInputElement();N&&(N.tabIndex=w.canvasTabIndex,A.doNotHandleCursors||(N.style.cursor=A.defaultCursor)),this._setCursorAndPointerOverMesh(d,t,A);for(const W of A._pointerMoveStage){var p;const A=!(null===(p=d=d||this._pickMove(t))||void 0===p||!p.pickedMesh);d=W.action(this._unTranslatedPointerX,this._unTranslatedPointerY,d,A,N)}const B=t.inputIndex>=v.MouseWheelX&&t.inputIndex<=v.MouseWheelZ?q.e.POINTERWHEEL:q.e.POINTERMOVE;let X;A.onPointerMove&&(d=d||this._pickMove(t),A.onPointerMove(t,d,B)),d?(X=new q.i(B,t,d),this._setRayOnPointerInfo(d,t)):(X=new q.i(B,t,null,this),this._movePointerInfo=X),A.onPointerObservable.hasObservers()&&A.onPointerObservable.notifyObservers(X,B)}_setRayOnPointerInfo(d,t){const A=this._scene;d&&r.d._IsPickingAvailable&&(d.ray||(d.ray=A.createPickingRay(t.offsetX,t.offsetY,a.c.Identity(),A.activeCamera)))}_addCameraPointerObserver(d,t){return this._cameraObserverCount++,this._scene.onPointerObservable.add(d,t)}_removeCameraPointerObserver(d){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(d)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(d,t,A){const w=this._scene,N=new q.g(A,t,this._unTranslatedPointerX,this._unTranslatedPointerY);return d&&(N.originalPickingInfo=d,N.ray=d.ray,"xr-near"===t.pointerType&&d.originMesh&&(N.nearInteractionPickingInfo=d)),w.onPrePointerObservable.notifyObservers(N,A),!!N.skipOnPointerObservable}_pickMove(d){const t=this._scene,A=t.Rc(this._unTranslatedPointerX,this._unTranslatedPointerY,t.pointerMovePredicate,t.pointerMoveFastCheck,t.cameraToUseForPointers,t.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(A,d,t),A}_setCursorAndPointerOverMesh(d,t,A){const w=A.getEngine().getInputElement();if(null!==d&&void 0!==d&&d.pickedMesh){if(this.setPointerOverMesh(d.pickedMesh,t.pointerId,d,t),!A.doNotHandleCursors&&w&&this._pointerOverMesh){const d=this._pointerOverMesh._getActionManagerForTrigger();d&&d.hasPointerTriggers&&(w.style.cursor=d.hoverCursor||A.hoverCursor)}}else this.setPointerOverMesh(null,t.pointerId,d,t)}simulatePointerMove(d,t){const A=new PointerEvent("pointermove",t);A.inputIndex=v.Move,this._checkPrePointerObservable(d,A,q.e.POINTERMOVE)||this._processPointerMove(d,A)}simulatePointerDown(d,t){const A=new PointerEvent("pointerdown",t);A.inputIndex=A.button+2,this._checkPrePointerObservable(d,A,q.e.POINTERDOWN)||this._processPointerDown(d,A)}_processPointerDown(d,t){var A;const w=this._scene;if(null!==(A=d)&&void 0!==A&&A.pickedMesh){this._pickedDownMesh=d.pickedMesh;const A=d.pickedMesh._getActionManagerForTrigger();if(A){if(A.hasPickTriggers)switch(A.processTrigger(5,b.CreateNew(d.pickedMesh,t,d)),t.button){case 0:A.processTrigger(2,b.CreateNew(d.pickedMesh,t,d));break;case 1:A.processTrigger(4,b.CreateNew(d.pickedMesh,t,d));break;case 2:A.processTrigger(3,b.CreateNew(d.pickedMesh,t,d))}A.hasSpecificTrigger(8)&&window.setTimeout((()=>{const d=w.Rc(this._unTranslatedPointerX,this._unTranslatedPointerY,(d=>d.Be&&d.isVisible&&d.isReady()&&d.actionManager&&d.actionManager.hasSpecificTrigger(8)&&d===this._pickedDownMesh),!1,w.cameraToUseForPointers);null!==d&&void 0!==d&&d.pickedMesh&&A&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>G.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,A.processTrigger(8,b.CreateNew(d.pickedMesh,t)))}),G.LongPressDelay)}}else for(const B of w._pointerDownStage)d=B.action(this._unTranslatedPointerX,this._unTranslatedPointerY,d,t,!1);let N;const p=q.e.POINTERDOWN;d?(w.onPointerDown&&w.onPointerDown(t,d,p),N=new q.i(p,t,d),this._setRayOnPointerInfo(d,t)):N=new q.i(p,t,null,this),w.onPointerObservable.hasObservers()&&w.onPointerObservable.notifyObservers(N,p)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(d,t,A){const w=new PointerEvent("pointerup",t);w.inputIndex=v.Move;const N=new K;A?N.doubleClick=!0:N.singleClick=!0,this._checkPrePointerObservable(d,w,q.e.POINTERUP)||this._processPointerUp(d,w,N)}_processPointerUp(d,t,A){var w;const N=this._scene;if(null!==(w=d)&&void 0!==w&&w.pickedMesh){if(this._pickedUpMesh=d.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(N.onPointerPick&&N.onPointerPick(t,d),A.singleClick&&!A.ignore&&N.onPointerObservable.observers.length>this._cameraObserverCount)){const A=q.e.POINTERPICK,w=new q.i(A,t,d);this._setRayOnPointerInfo(d,t),N.onPointerObservable.notifyObservers(w,A)}const w=d.pickedMesh._getActionManagerForTrigger();if(w&&!A.ignore){w.processTrigger(7,b.CreateNew(d.pickedMesh,t,d)),!A.hasSwiped&&A.singleClick&&w.processTrigger(1,b.CreateNew(d.pickedMesh,t,d));const N=d.pickedMesh._getActionManagerForTrigger(6);A.doubleClick&&N&&N.processTrigger(6,b.CreateNew(d.pickedMesh,t,d))}}else if(!A.ignore)for(const p of N._pointerUpStage)d=p.action(this._unTranslatedPointerX,this._unTranslatedPointerY,d,t,A.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const d=this._pickedDownMesh._getActionManagerForTrigger(16);d&&d.processTrigger(16,b.CreateNew(this._pickedDownMesh,t))}if(!A.ignore){const w=new q.i(q.e.POINTERUP,t,d);if(this._setRayOnPointerInfo(d,t),N.onPointerObservable.notifyObservers(w,q.e.POINTERUP),N.onPointerUp&&N.onPointerUp(t,d,q.e.POINTERUP),!A.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let w=0;if(A.singleClick?w=q.e.POINTERTAP:A.doubleClick&&(w=q.e.POINTERDOUBLETAP),w){const A=new q.i(w,t,d);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(w)&&N.onPointerObservable.notifyObservers(A,w)}}}}isPointerCaptured(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[d]}attachControl(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const N=this._scene,p=N.getEngine();w||(w=p.getInputElement()),this._alreadyAttached&&this.Qi(),w&&(this._alreadyAttachedTo=w),this._deviceSourceManager=new Y(p),this._initActionManager=d=>{if(!this._meshPickProceed){const t=N.skipPointerUpPicking||0===N._registeredActions&&!this._checkForPicking()&&!N.onPointerUp?null:N.Rc(this._unTranslatedPointerX,this._unTranslatedPointerY,N.pointerUpPredicate,N.pointerUpFastCheck,N.cameraToUseForPointers,N.pointerUpTrianglePredicate);this._currentPickResult=t,t&&(d=t.hit&&t.pickedMesh?t.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return d},this._delayedSimpleClick=(d,t,A)=>{if((Date.now()-this._previousStartingPointerTime>G.DoubleClickDelay&&!this._doubleClickOccured||d!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,t.singleClick=!0,t.ignore=!1,this._delayedClicks[d])){const t=this._delayedClicks[d].evt,A=q.e.POINTERTAP,w=new q.i(A,t,this._currentPickResult);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(A)&&N.onPointerObservable.notifyObservers(w,A),this._delayedClicks[d]=null}},this._initClickEvent=(d,t,A,w)=>{const N=new K;this._currentPickResult=null;let p=null,B=d.hasSpecificMask(q.e.POINTERPICK)||t.hasSpecificMask(q.e.POINTERPICK)||d.hasSpecificMask(q.e.POINTERTAP)||t.hasSpecificMask(q.e.POINTERTAP)||d.hasSpecificMask(q.e.POINTERDOUBLETAP)||t.hasSpecificMask(q.e.POINTERDOUBLETAP);!B&&H&&(p=this._initActionManager(p,N),p&&(B=p.hasPickTriggers));let X=!1;if(B){const B=A.button;if(N.hasSwiped=this._isPointerSwiping(),!N.hasSwiped){let D=!G.ExclusiveDoubleClickMode;if(D||(D=!d.hasSpecificMask(q.e.POINTERDOUBLETAP)&&!t.hasSpecificMask(q.e.POINTERDOUBLETAP),D&&!H.HasSpecificTrigger(6)&&(p=this._initActionManager(p,N),p&&(D=!p.hasSpecificTrigger(6)))),D)(Date.now()-this._previousStartingPointerTime>G.DoubleClickDelay||B!==this._previousButtonPressed)&&(N.singleClick=!0,w(N,this._currentPickResult),X=!0);else{const d={evt:A,clickInfo:N,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,B,N,w),G.DoubleClickDelay)};this._delayedClicks[B]=d}let i=d.hasSpecificMask(q.e.POINTERDOUBLETAP)||t.hasSpecificMask(q.e.POINTERDOUBLETAP);if(!i&&H.HasSpecificTrigger(6)&&(p=this._initActionManager(p,N),p&&(i=p.hasSpecificTrigger(6))),i)if(B===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<G.DoubleClickDelay&&!this._doubleClickOccured){if(N.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=B,G.ExclusiveDoubleClickMode){var W;if(this._delayedClicks[B])clearTimeout(null===(W=this._delayedClicks[B])||void 0===W?void 0:W.timeoutId),this._delayedClicks[B]=null;w(N,this._previousPickResult)}else w(N,this._currentPickResult);else{var a;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,N.doubleClick=!0,N.ignore=!1,G.ExclusiveDoubleClickMode&&this._delayedClicks[B])clearTimeout(null===(a=this._delayedClicks[B])||void 0===a?void 0:a.timeoutId),this._delayedClicks[B]=null;w(N,this._currentPickResult)}X=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=B}}X||w(N,this._currentPickResult)},this._onPointerMove=d=>{if(this._updatePointerPosition(d),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>G.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>G.DragMovementThreshold),p.isPointerLock&&p._verifyPointerLock(),this._checkPrePointerObservable(null,d,d.inputIndex>=v.MouseWheelX&&d.inputIndex<=v.MouseWheelZ?q.e.POINTERWHEEL:q.e.POINTERMOVE))return;if(!N.cameraToUseForPointers&&!N.activeCamera)return;if(N.Zi)return void this._processPointerMove(new k.c,d);N.pointerMovePredicate||(N.pointerMovePredicate=d=>d.Be&&d.isVisible&&d.isReady()&&d.isEnabled()&&(d.enablePointerMoveEvents||N.constantlyUpdateMeshUnderPointer||null!==d._getActionManagerForTrigger())&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&d.layerMask)));const t=N._registeredActions>0||N.constantlyUpdateMeshUnderPointer?this._pickMove(d):null;this._processPointerMove(t,d)},this._onPointerDown=d=>{const t=this._activePointerIds.indexOf(-1);if(-1===t?this._activePointerIds.push(d.pointerId):this._activePointerIds[t]=d.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,G.ExclusiveDoubleClickMode)for(let w=0;w<this._delayedClicks.length;w++)if(this._delayedClicks[w])if(d.button===w){var A;clearTimeout(null===(A=this._delayedClicks[w])||void 0===A?void 0:A.timeoutId)}else{const d=this._delayedClicks[w].clickInfo;this._doubleClickOccured=!1,d.singleClick=!0,d.ignore=!1;const t=this._delayedClicks[w].evt,A=q.e.POINTERTAP,p=new q.i(A,t,this._currentPickResult);N.onPointerObservable.hasObservers()&&N.onPointerObservable.hasSpecificMask(A)&&N.onPointerObservable.notifyObservers(p,A),this._delayedClicks[w]=null}if(this._updatePointerPosition(d),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=d.button),N.preventDefaultOnPointerDown&&w&&(d.preventDefault(),w.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,d,q.e.POINTERDOWN))return;if(!N.cameraToUseForPointers&&!N.activeCamera)return;let p;this._pointerCaptures[d.pointerId]=!0,N.pointerDownPredicate||(N.pointerDownPredicate=d=>d.Be&&d.isVisible&&d.isReady()&&d.isEnabled()&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&d.layerMask))),this._pickedDownMesh=null,p=N.skipPointerDownPicking||0===N._registeredActions&&!this._checkForPicking()&&!N.onPointerDown?new k.c:N.Rc(this._unTranslatedPointerX,this._unTranslatedPointerY,N.pointerDownPredicate,N.pointerDownFastCheck,N.cameraToUseForPointers,N.pointerDownTrianglePredicate),this._processPointerDown(p,d)},this._onPointerUp=d=>{const t=this._activePointerIds.indexOf(d.pointerId);-1!==t&&(this._activePointerIds[t]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(d),N.preventDefaultOnPointerUp&&w&&(d.preventDefault(),w.focus()),this._initClickEvent(N.onPrePointerObservable,N.onPointerObservable,d,((t,A)=>{if(N.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!t.ignore)){if(this._checkPrePointerObservable(null,d,q.e.POINTERUP))return this._swipeButtonPressed===d.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===d.buttons&&(this._pointerCaptures[d.pointerId]=!1));t.hasSwiped||(t.singleClick&&N.onPrePointerObservable.hasSpecificMask(q.e.POINTERTAP)&&this._checkPrePointerObservable(null,d,q.e.POINTERTAP)&&(this._skipPointerTap=!0),t.doubleClick&&N.onPrePointerObservable.hasSpecificMask(q.e.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,d,q.e.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[d.pointerId]?(0===d.buttons&&(this._pointerCaptures[d.pointerId]=!1),(N.cameraToUseForPointers||N.activeCamera)&&(N.pointerUpPredicate||(N.pointerUpPredicate=d=>d.Be&&d.isVisible&&d.isReady()&&d.isEnabled()&&(!N.cameraToUseForPointers||0!==(N.cameraToUseForPointers.layerMask&d.layerMask))),!this._meshPickProceed&&(H&&H.HasTriggers||this._checkForPicking()||N.onPointerUp)&&this._initActionManager(null,t),A||(A=this._currentPickResult),this._processPointerUp(A,d,t),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===d.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===d.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=d=>{const t=L.b.KEYDOWN;if(N.onPreKeyboardObservable.hasObservers()){const A=new L.c(t,d);if(N.onPreKeyboardObservable.notifyObservers(A,t),A.skipOnKeyboardObservable)return}if(N.onKeyboardObservable.hasObservers()){const A=new L.f(t,d);N.onKeyboardObservable.notifyObservers(A,t)}N.actionManager&&N.actionManager.processTrigger(14,b.CreateNewFromScene(N,d))},this._onKeyUp=d=>{const t=L.b.KEYUP;if(N.onPreKeyboardObservable.hasObservers()){const A=new L.c(t,d);if(N.onPreKeyboardObservable.notifyObservers(A,t),A.skipOnKeyboardObservable)return}if(N.onKeyboardObservable.hasObservers()){const A=new L.f(t,d);N.onKeyboardObservable.notifyObservers(A,t)}N.actionManager&&N.actionManager.processTrigger(15,b.CreateNewFromScene(N,d))},this._deviceSourceManager.onDeviceConnectedObservable.add((w=>{w.deviceType===f.Mouse?w.onInputChangedObservable.add((N=>{this._originMouseEvent=N,N.inputIndex===v.LeftClick||N.inputIndex===v.MiddleClick||N.inputIndex===v.RightClick||N.inputIndex===v.BrowserBack||N.inputIndex===v.BrowserForward?t&&1===w.getInput(N.inputIndex)?this._onPointerDown(N):d&&0===w.getInput(N.inputIndex)&&this._onPointerUp(N):A&&(N.inputIndex===v.Move?this._onPointerMove(N):N.inputIndex!==v.MouseWheelX&&N.inputIndex!==v.MouseWheelY&&N.inputIndex!==v.MouseWheelZ||this._onPointerMove(N))})):w.deviceType===f.Touch?w.onInputChangedObservable.add((N=>{N.inputIndex===v.LeftClick&&(t&&1===w.getInput(N.inputIndex)?(this._onPointerDown(N),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):d&&0===w.getInput(N.inputIndex)&&(this._onPointerUp(N),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),A&&N.inputIndex===v.Move&&this._onPointerMove(N)})):w.deviceType===f.Keyboard&&w.onInputChangedObservable.add((d=>{"keydown"===d.type?this._onKeyDown(d):"keyup"===d.type&&this._onKeyUp(d)}))})),this._alreadyAttached=!0}Qi(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0,w=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[t]===d&&(!d||!d._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const N=this._meshUnderPointerId[t];let p;N&&(p=N._getActionManagerForTrigger(10),p&&p.processTrigger(10,b.CreateNew(N,w,{pointerId:t}))),d?(this._meshUnderPointerId[t]=d,this._pointerOverMesh=d,p=d._getActionManagerForTrigger(9),p&&p.processTrigger(9,b.CreateNew(d,w,{pointerId:t,pickResult:A}))):(delete this._meshUnderPointerId[t],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(d){this._pointerOverMesh===d&&(this._pointerOverMesh=null),this._pickedDownMesh===d&&(this._pickedDownMesh=null),this._pickedUpMesh===d&&(this._pickedUpMesh=null);for(const t in this._meshUnderPointerId)this._meshUnderPointerId[t]===d&&delete this._meshUnderPointerId[t]}}G.DragMovementThreshold=10,G.LongPressDelay=500,G.DoubleClickDelay=300,G.ExclusiveDoubleClickMode=!1;var O=A(10901),z=A(11094),c=A(11173),e=A(11189),M=A(10779),x=A(11196),o=A(11081);class C{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Zi=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var E,g=A(10740),S=A(10885);!function(d){d[d.BackwardCompatible=0]="BackwardCompatible",d[d.Intermediate=1]="Intermediate",d[d.Aggressive=2]="Aggressive"}(E||(E={}));class dd{static DefaultMaterialFactory(d){throw(0,F.b)("ob")}static CollisionCoordinatorFactory(){throw(0,F.b)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(d){d!==this._clearColor&&(this._clearColor=d,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(d){if(d!==this._performancePriority){switch(this._performancePriority=d,d){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Zi=!1,this.Ri=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Zi=!0,this.Ri=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Zi=!0,this.Ri=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(d)}}set forceWireframe(d){this._forceWireframe!==d&&(this._forceWireframe=d,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(d){this._skipFrustumClipping!==d&&(this._skipFrustumClipping=d)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(d){this._forcePointsCloud!==d&&(this._forcePointsCloud=d,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(d){this._environmentTexture!==d&&(this._environmentTexture=d,this.markAllMaterialsAsDirty(1))}getNodes(){let d=[];return d=d.concat(this.meshes),d=d.concat(this.lights),d=d.concat(this.cameras),d=d.concat(this.transformNodes),this.skeletons.forEach((t=>d=d.concat(t.bones))),d}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(d){this._animationPropertiesOverride=d}set onDispose(d){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(d)}set beforeRender(d){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),d&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(d))}set afterRender(d){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),d&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(d))}set beforeCameraRender(d){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(d)}set afterCameraRender(d){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(d)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(d){this._pointerPickingConfiguration.pointerDownPredicate=d}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(d){this._pointerPickingConfiguration.pointerUpPredicate=d}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(d){this._pointerPickingConfiguration.pointerMovePredicate=d}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(d){this._pointerPickingConfiguration.pointerDownFastCheck=d}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(d){this._pointerPickingConfiguration.pointerUpFastCheck=d}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(d){this._pointerPickingConfiguration.pointerMoveFastCheck=d}get Zi(){return this._pointerPickingConfiguration.Zi}set Zi(d){this._pointerPickingConfiguration.Zi=d}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(d){this._pointerPickingConfiguration.skipPointerDownPicking=d}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(d){this._pointerPickingConfiguration.skipPointerUpPicking=d}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return G.DragMovementThreshold}static set DragMovementThreshold(d){G.DragMovementThreshold=d}static get LongPressDelay(){return G.LongPressDelay}static set LongPressDelay(d){G.LongPressDelay=d}static get DoubleClickDelay(){return G.DoubleClickDelay}static set DoubleClickDelay(d){G.DoubleClickDelay=d}static get ExclusiveDoubleClickMode(){return G.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(d){G.ExclusiveDoubleClickMode=d}bindEyePosition(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const w=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,N=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return a.h.Vector4[0].set(w.x,w.y,w.z,N?-1:1),d&&(A?d.setFloat3(t,a.h.Vector4[0].x,a.h.Vector4[0].y,a.h.Vector4[0].z):d.setVector4(t,a.h.Vector4[0])),a.h.Vector4[0]}finalizeSceneUbo(){const d=this.getSceneUniformBuffer(),t=this.bindEyePosition(null);return d.updateFloat4("vEyePosition",t.x,t.y,t.z,t.w),d.update(),d}set useRightHandedSystem(d){this._useRightHandedSystem!==d&&(this._useRightHandedSystem=d,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(d){this._currentStepId=d}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(d){this._fogEnabled!==d&&(this._fogEnabled=d,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(d){this._fogMode!==d&&(this._fogMode=d,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(d){this._shadowsEnabled!==d&&(this._shadowsEnabled=d,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(d){this._lightsEnabled!==d&&(this._lightsEnabled=d,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(d){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),d&&(this._unObserveActiveCameras=(0,o.h)(d,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=d}get activeCamera(){return this._activeCamera}set activeCamera(d){d!==this._activeCamera&&(this._activeCamera=d,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.si||(this.si=dd.DefaultMaterialFactory(this)),this.si}set defaultMaterial(d){this.si=d}set texturesEnabled(d){this._texturesEnabled!==d&&(this._texturesEnabled=d,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(d){if(this._frameGraph)return this._frameGraph=d,void(d||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=d,d&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(d){this._skeletonsEnabled!==d&&(this._skeletonsEnabled=d,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=dd.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const d of this._transientComponents)d.register();this._transientComponents.length=0}}o(d){this._components.push(d),this._transientComponents.push(d);const t=d;t.addFromContainer&&t.serialize&&this._serializableComponents.push(t)}_getComponent(d){for(const t of this._components)if(t.name===d)return t;return null}constructor(d,t){this._inputManager=new G(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Ri=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new z.i(.2,.2,.3,1),this.onClearColorChangedObservable=new p.b,this.ambientColor=new z.e(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new p.b,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.nj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.ak=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.hj=new p.b,this._onDisposeObserver=null,this.onBeforeRenderObservable=new p.b,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new p.b,this.onAfterRenderCameraObservable=new p.b,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new p.b,this.onAfterAnimationsObservable=new p.b,this.onBeforeDrawPhaseObservable=new p.b,this.onAfterDrawPhaseObservable=new p.b,this.onReadyObservable=new p.b,this.onBeforeCameraRenderObservable=new p.b,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new p.b,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new p.b,this.onAfterActiveMeshesEvaluationObservable=new p.b,this.onBeforeParticlesRenderingObservable=new p.b,this.onAfterParticlesRenderingObservable=new p.b,this.onDataLoadedObservable=new p.b,this.onNewCameraAddedObservable=new p.b,this.onCameraRemovedObservable=new p.b,this.onNewLightAddedObservable=new p.b,this.onLightRemovedObservable=new p.b,this.onNewGeometryAddedObservable=new p.b,this.onGeometryRemovedObservable=new p.b,this.onNewTransformNodeAddedObservable=new p.b,this.onTransformNodeRemovedObservable=new p.b,this.onNewMeshAddedObservable=new p.b,this.onMeshRemovedObservable=new p.b,this.onNewSkeletonAddedObservable=new p.b,this.onSkeletonRemovedObservable=new p.b,this.onNewMaterialAddedObservable=new p.b,this.onNewMultiMaterialAddedObservable=new p.b,this.onMaterialRemovedObservable=new p.b,this.onMultiMaterialRemovedObservable=new p.b,this.onNewTextureAddedObservable=new p.b,this.onTextureRemovedObservable=new p.b,this.onBeforeRenderTargetsRenderObservable=new p.b,this.onAfterRenderTargetsRenderObservable=new p.b,this.onBeforeStepObservable=new p.b,this.onAfterStepObservable=new p.b,this.onActiveCameraChanged=new p.b,this.onActiveCamerasChanged=new p.b,this.onBeforeRenderingGroupObservable=new p.b,this.onAfterRenderingGroupObservable=new p.b,this.onMeshImportedObservable=new p.b,this.onAnimationFileImportedObservable=new p.b,this._registeredForLateAnimationBindings=new B.b(256),this._pointerPickingConfiguration=new C,this.onPrePointerObservable=new p.b,this.onPointerObservable=new p.b,this.onPreKeyboardObservable=new p.b,this.onKeyboardObservable=new p.b,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=dd.FOGMODE_NONE,this.fogColor=new z.e(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new a.l(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new B.b(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new O.d,this._activeIndices=new O.d,this._activeParticles=new O.d,this._activeBones=new O.d,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new B.d(256),this._processedMaterials=new B.d(256),this._renderTargets=new B.b(256),this._materialsRenderTargets=new B.b(256),this._activeParticleSystems=new B.d(256),this._activeSkeletons=new B.b(32),this._softwareSkinnedMeshes=new B.b(32),this._activeAnimatables=new Array,this._transformMatrix=a.c.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=J.g.Create(),this._beforeClearStage=J.g.Create(),this._beforeRenderTargetClearStage=J.g.Create(),this._gatherRenderTargetsStage=J.g.Create(),this._gatherActiveCameraRenderTargetsStage=J.g.Create(),this._isReadyForMeshStage=J.g.Create(),this._beforeEvaluateActiveMeshStage=J.g.Create(),this._evaluateSubMeshStage=J.g.Create(),this._preActiveMeshStage=J.g.Create(),this._cameraDrawRenderTargetStage=J.g.Create(),this._beforeCameraDrawStage=J.g.Create(),this._beforeRenderTargetDrawStage=J.g.Create(),this._beforeRenderingGroupDrawStage=J.g.Create(),this._beforeRenderingMeshStage=J.g.Create(),this._afterRenderingMeshStage=J.g.Create(),this._afterRenderingGroupDrawStage=J.g.Create(),this._afterCameraDrawStage=J.g.Create(),this._afterCameraPostProcessStage=J.g.Create(),this._afterRenderTargetDrawStage=J.g.Create(),this._afterRenderTargetPostProcessStage=J.g.Create(),this._afterRenderStage=J.g.Create(),this._pointerMoveStage=J.g.Create(),this._pointerDownStage=J.g.Create(),this._pointerUpStage=J.g.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const A={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...t};d=this._engine=d||T.e.LastCreatedEngine,A.virtual?d._virtualScenes.push(this):(T.e._LastCreatedScene=this,d.scenes.push(this)),this._uid=null,this._renderingManager=new P.e(this),Q.b&&(this.postProcessManager=new Q.b(this)),(0,U.l)()&&this.attachControl(),this._createUbo(),D.c&&(this._imageProcessingConfiguration=new D.c),this.setDefaultCandidateProviders(),A.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=A.useMaterialMeshMap,this.useClonedMeshMap=A.useClonedMeshMap,t&&t.virtual||d.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(d){return this._defaultSubMeshCandidates.data=d.If,this._defaultSubMeshCandidates.length=d.If.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=d=>this._getDefaultSubMeshCandidates(d),this.getIntersectingSubMeshCandidates=(d,t)=>this._getDefaultSubMeshCandidates(d),this.getCollidingSubMeshCandidates=(d,t)=>this._getDefaultSubMeshCandidates(d)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(d){this._inputManager.pointerX=d}get pointerY(){return this._inputManager.pointerY}set pointerY(d){this._inputManager.pointerY=d}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==t||this._cachedMaterial!==d||this._cachedVisibility!==A}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(d,t){return this._inputManager.simulatePointerMove(d,t),this}simulatePointerDown(d,t){return this._inputManager.simulatePointerDown(d,t),this}simulatePointerUp(d,t,A){return this._inputManager.simulatePointerUp(d,t,A),this}isPointerCaptured(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(d)}attachControl(){let d=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(d,t,A)}Qi(){this._inputManager.Qi()}isReady(){var d,t;let A,w=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const N=this.getEngine(),p=N.currentRenderPassId;N.currentRenderPassId=(null===(d=this.activeCamera)||void 0===d?void 0:d.renderPassId)??p;let B=!0;for(this._pendingData.length>0&&(B=!1),null===(t=this.prePassRenderer)||void 0===t||t.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&B&&(B=this.depthPeelingRenderer.isReady()),w&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),A=0;A<this.meshes.length;A++){const d=this.meshes[A];if(!d.If||0===d.If.length)continue;if(!d.isReady(!0)){B=!1;continue}const t=d.hasThinInstances||"InstancedMesh"===d.getClassName()||"InstancedLinesMesh"===d.getClassName()||N.getCaps().instancedArrays&&d.instances.length>0;for(const A of this._isReadyForMeshStage)A.action(d,t)||(B=!1);if(!w)continue;const p=d.material||this.defaultMaterial;if(p)if(p._storeEffectOnSubMeshes)for(const A of d.If){const d=A.Ha();d&&d.hasRenderTargetTextures&&null!=d.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(d)&&(this._processedMaterials.push(d),this._materialsRenderTargets.concatWithNoDuplicate(d.getRenderTargetTextures()))}else p.hasRenderTargetTextures&&null!=p.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(p)&&(this._processedMaterials.push(p),this._materialsRenderTargets.concatWithNoDuplicate(p.getRenderTargetTextures()))}if(w)for(A=0;A<this._materialsRenderTargets.length;++A){this._materialsRenderTargets.data[A].isReadyForRendering()||(B=!1)}for(A=0;A<this.geometries.length;A++){2===this.geometries[A].delayLoadState&&(B=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const X of this.activeCameras)X.isReady(!0)||(B=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(B=!1));for(const X of this.nj)X.isReady()||(B=!1);if(this.layers)for(const X of this.layers)X.isReady()||(B=!1);return N.areAllEffectsReady()||(B=!1),N.currentRenderPassId=p,B}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(d){this.onBeforeRenderObservable.add(d)}unregisterBeforeRender(d){this.onBeforeRenderObservable.removeCallback(d)}registerAfterRender(d){this.onAfterRenderObservable.add(d)}unregisterAfterRender(d){this.onAfterRenderObservable.removeCallback(d)}_executeOnceBeforeRender(d){const t=()=>{d(),setTimeout((()=>{this.unregisterBeforeRender(t)}))};this.registerBeforeRender(t)}executeOnceBeforeRender(d,t){void 0!==t?setTimeout((()=>{this._executeOnceBeforeRender(d)}),t):this._executeOnceBeforeRender(d)}addPendingData(d){this._pendingData.push(d)}removePendingData(d){const t=this.isLoading,A=this._pendingData.indexOf(d);-1!==A&&this._pendingData.splice(A,1),t&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(d),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(t)}whenReadyAsync(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((t=>{this.executeWhenReady((()=>{t()}),d)}))}_checkIsReady(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(d)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(d)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=N.d.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(d,t,A,w){A||w||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===d.updateFlag&&this._projectionUpdateFlag===t.updateFlag||(this._viewUpdateFlag=d.updateFlag,this._projectionUpdateFlag=t.updateFlag,this._viewMatrix=d,this._projectionMatrix=t,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?c.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=c.e.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(A,w):this._sceneUbo.useUbo&&(this._sceneUbo.Fj("viewProjection",this._transformMatrix),this._sceneUbo.Fj("view",this._viewMatrix),this._sceneUbo.Fj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(d){const t=new i.e(this._engine,void 0,!1,d??"Hf");return t.addUniform("viewProjection",16),t.addUniform("view",16),t.addUniform("projection",16),t.addUniform("vEyePosition",4),t}setSceneUniformBuffer(d){this._sceneUbo=d,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return e.e.UniqueId}ii(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(d),d._resyncLightSources(),d.parent||d._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(d),t&&d.getChildMeshes().forEach((d=>{this.ii(d)})))}Ug(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const A=this.meshes.indexOf(d);return-1!==A&&(this.meshes.splice(A,1),d.parent||d._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(d),this.onMeshRemovedObservable.notifyObservers(d),t&&d.getChildMeshes().forEach((d=>{this.Ug(d)})),A}addTransformNode(d){this._blockEntityCollection||d.va()===this&&-1!==d._indexInSceneTransformNodesArray||(d._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(d),d.parent||d._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(d))}removeTransformNode(d){const t=d._indexInSceneTransformNodesArray;if(-1!==t){if(t!==this.transformNodes.length-1){const d=this.transformNodes[this.transformNodes.length-1];this.transformNodes[t]=d,d._indexInSceneTransformNodesArray=t}d._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),d.parent||d._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(d),t}removeSkeleton(d){const t=this.skeletons.indexOf(d);return-1!==t&&(this.skeletons.splice(t,1),this.onSkeletonRemovedObservable.notifyObservers(d),this._executeActiveContainerCleanup(this._activeSkeletons)),t}removeMorphTargetManager(d){const t=this.morphTargetManagers.indexOf(d);return-1!==t&&this.morphTargetManagers.splice(t,1),t}removeLight(d){const t=this.lights.indexOf(d);if(-1!==t){for(const t of this.meshes)t._removeLightSource(d,!1);this.lights.splice(t,1),this.sortLightsByPriority(),d.parent||d._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(d),t}removeCamera(d){const t=this.cameras.indexOf(d);if(-1!==t&&(this.cameras.splice(t,1),d.parent||d._removeFromSceneRootNodes()),this.activeCameras){const t=this.activeCameras.indexOf(d);-1!==t&&this.activeCameras.splice(t,1)}return this.activeCamera===d&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(d),t}removeParticleSystem(d){const t=this.nj.indexOf(d);return-1!==t&&(this.nj.splice(t,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),t}removeAnimation(d){const t=this.animations.indexOf(d);return-1!==t&&this.animations.splice(t,1),t}stopAnimation(d,t,A){}removeAnimationGroup(d){const t=this.animationGroups.indexOf(d);return-1!==t&&this.animationGroups.splice(t,1),t}removeMultiMaterial(d){const t=this.multiMaterials.indexOf(d);return-1!==t&&this.multiMaterials.splice(t,1),this.onMultiMaterialRemovedObservable.notifyObservers(d),t}removeMaterial(d){const t=d._indexInSceneMaterialArray;if(-1!==t&&t<this.materials.length){if(t!==this.materials.length-1){const d=this.materials[this.materials.length-1];this.materials[t]=d,d._indexInSceneMaterialArray=t}d._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(d),t}removeActionManager(d){const t=this.actionManagers.indexOf(d);return-1!==t&&this.actionManagers.splice(t,1),t}removeTexture(d){const t=this.textures.indexOf(d);return-1!==t&&this.textures.splice(t,1),this.onTextureRemovedObservable.notifyObservers(d),t}addLight(d){if(!this._blockEntityCollection){this.lights.push(d),this.sortLightsByPriority(),d.parent||d._addToSceneRootNodes();for(const t of this.meshes)-1===t.lightSources.indexOf(d)&&(t.lightSources.push(d),t._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(d)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(x.b.CompareLightsPriority)}addCamera(d){this._blockEntityCollection||(this.cameras.push(d),this.onNewCameraAddedObservable.notifyObservers(d),d.parent||d._addToSceneRootNodes())}addSkeleton(d){this._blockEntityCollection||(this.skeletons.push(d),this.onNewSkeletonAddedObservable.notifyObservers(d))}addParticleSystem(d){this._blockEntityCollection||this.nj.push(d)}addAnimation(d){this._blockEntityCollection||this.animations.push(d)}addAnimationGroup(d){this._blockEntityCollection||this.animationGroups.push(d)}addMultiMaterial(d){this._blockEntityCollection||(this.multiMaterials.push(d),this.onNewMultiMaterialAddedObservable.notifyObservers(d))}addMaterial(d){this._blockEntityCollection||d.va()===this&&-1!==d._indexInSceneMaterialArray||(d._indexInSceneMaterialArray=this.materials.length,this.materials.push(d),this.onNewMaterialAddedObservable.notifyObservers(d))}addMorphTargetManager(d){this._blockEntityCollection||this.morphTargetManagers.push(d)}addGeometry(d){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[d.uniqueId]=this.geometries.length),this.geometries.push(d))}addActionManager(d){this.actionManagers.push(d)}addTexture(d){this._blockEntityCollection||(this.textures.push(d),this.onNewTextureAddedObservable.notifyObservers(d))}switchActiveCamera(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Qi(),this.activeCamera=d,t&&d.attachControl())}setActiveCameraById(d){const t=this.getCameraById(d);return t?(this.activeCamera=t,t):null}setActiveCameraByName(d){const t=this.getCameraByName(d);return t?(this.activeCamera=t,t):null}getAnimationGroupByName(d){for(let t=0;t<this.animationGroups.length;t++)if(this.animationGroups[t].name===d)return this.animationGroups[t];return null}_getMaterial(d,t){for(let A=0;A<this.materials.length;A++){const d=this.materials[A];if(t(d))return d}if(d)for(let A=0;A<this.multiMaterials.length;A++){const d=this.multiMaterials[A];if(t(d))return d}return null}getMaterialByUniqueID(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(t=>t.uniqueId===d))}getMaterialById(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(t=>t.id===d))}getMaterialByName(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(t,(t=>t.name===d))}getLastMaterialById(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let A=this.materials.length-1;A>=0;A--)if(this.materials[A].id===d)return this.materials[A];if(t)for(let A=this.multiMaterials.length-1;A>=0;A--)if(this.multiMaterials[A].id===d)return this.multiMaterials[A];return null}getTextureByUniqueId(d){for(let t=0;t<this.textures.length;t++)if(this.textures[t].uniqueId===d)return this.textures[t];return null}getTextureByName(d){for(let t=0;t<this.textures.length;t++)if(this.textures[t].name===d)return this.textures[t];return null}getCameraById(d){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].id===d)return this.cameras[t];return null}getCameraByUniqueId(d){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].uniqueId===d)return this.cameras[t];return null}getCameraByName(d){for(let t=0;t<this.cameras.length;t++)if(this.cameras[t].name===d)return this.cameras[t];return null}getBoneById(d){for(let t=0;t<this.skeletons.length;t++){const A=this.skeletons[t];for(let t=0;t<A.bones.length;t++)if(A.bones[t].id===d)return A.bones[t]}return null}getBoneByName(d){for(let t=0;t<this.skeletons.length;t++){const A=this.skeletons[t];for(let t=0;t<A.bones.length;t++)if(A.bones[t].name===d)return A.bones[t]}return null}getLightByName(d){for(let t=0;t<this.lights.length;t++)if(this.lights[t].name===d)return this.lights[t];return null}getLightById(d){for(let t=0;t<this.lights.length;t++)if(this.lights[t].id===d)return this.lights[t];return null}getLightByUniqueId(d){for(let t=0;t<this.lights.length;t++)if(this.lights[t].uniqueId===d)return this.lights[t];return null}getParticleSystemById(d){for(let t=0;t<this.nj.length;t++)if(this.nj[t].id===d)return this.nj[t];return null}getGeometryById(d){for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].id===d)return this.geometries[t];return null}_getGeometryByUniqueId(d){if(this._geometriesByUniqueId){const t=this._geometriesByUniqueId[d];if(void 0!==t)return this.geometries[t]}else for(let t=0;t<this.geometries.length;t++)if(this.geometries[t].uniqueId===d)return this.geometries[t];return null}pushGeometry(d,t){return!(!t&&this._getGeometryByUniqueId(d.uniqueId))&&(this.addGeometry(d),this.onNewGeometryAddedObservable.notifyObservers(d),!0)}removeGeometry(d){let t;if(this._geometriesByUniqueId){if(t=this._geometriesByUniqueId[d.uniqueId],void 0===t)return!1}else if(t=this.geometries.indexOf(d),t<0)return!1;if(t!==this.geometries.length-1){const d=this.geometries[this.geometries.length-1];d&&(this.geometries[t]=d,this._geometriesByUniqueId&&(this._geometriesByUniqueId[d.uniqueId]=t))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[d.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(d),!0}getGeometries(){return this.geometries}getMeshById(d){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].id===d)return this.meshes[t];return null}getMeshesById(d){return this.meshes.filter((function(t){return t.id===d}))}getTransformNodeById(d){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].id===d)return this.transformNodes[t];return null}getTransformNodeByUniqueId(d){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].uniqueId===d)return this.transformNodes[t];return null}getTransformNodesById(d){return this.transformNodes.filter((function(t){return t.id===d}))}getMeshByUniqueId(d){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].uniqueId===d)return this.meshes[t];return null}getLastMeshById(d){for(let t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===d)return this.meshes[t];return null}getLastTransformNodeById(d){for(let t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===d)return this.transformNodes[t];return null}getLastEntryById(d){let t;for(t=this.meshes.length-1;t>=0;t--)if(this.meshes[t].id===d)return this.meshes[t];for(t=this.transformNodes.length-1;t>=0;t--)if(this.transformNodes[t].id===d)return this.transformNodes[t];for(t=this.cameras.length-1;t>=0;t--)if(this.cameras[t].id===d)return this.cameras[t];for(t=this.lights.length-1;t>=0;t--)if(this.lights[t].id===d)return this.lights[t];return null}getNodeById(d){const t=this.getMeshById(d);if(t)return t;const A=this.getTransformNodeById(d);if(A)return A;const w=this.getLightById(d);if(w)return w;const N=this.getCameraById(d);if(N)return N;const p=this.getBoneById(d);return p||null}getNodeByName(d){const t=this.getMeshByName(d);if(t)return t;const A=this.getTransformNodeByName(d);if(A)return A;const w=this.getLightByName(d);if(w)return w;const N=this.getCameraByName(d);if(N)return N;const p=this.getBoneByName(d);return p||null}getMeshByName(d){for(let t=0;t<this.meshes.length;t++)if(this.meshes[t].name===d)return this.meshes[t];return null}getTransformNodeByName(d){for(let t=0;t<this.transformNodes.length;t++)if(this.transformNodes[t].name===d)return this.transformNodes[t];return null}getLastSkeletonById(d){for(let t=this.skeletons.length-1;t>=0;t--)if(this.skeletons[t].id===d)return this.skeletons[t];return null}getSkeletonByUniqueId(d){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].uniqueId===d)return this.skeletons[t];return null}getSkeletonById(d){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].id===d)return this.skeletons[t];return null}getSkeletonByName(d){for(let t=0;t<this.skeletons.length;t++)if(this.skeletons[t].name===d)return this.skeletons[t];return null}getMorphTargetManagerById(d){for(let t=0;t<this.morphTargetManagers.length;t++)if(this.morphTargetManagers[t].uniqueId===d)return this.morphTargetManagers[t];return null}getMorphTargetById(d){for(let t=0;t<this.morphTargetManagers.length;++t){const A=this.morphTargetManagers[t];for(let t=0;t<A.numTargets;++t){const w=A.getTarget(t);if(w.id===d)return w}}return null}getMorphTargetByName(d){for(let t=0;t<this.morphTargetManagers.length;++t){const A=this.morphTargetManagers[t];for(let t=0;t<A.numTargets;++t){const w=A.getTarget(t);if(w.name===d)return w}}return null}getPostProcessByName(d){for(let t=0;t<this.postProcesses.length;++t){const A=this.postProcesses[t];if(A.name===d)return A}return null}isActiveMesh(d){return-1!==this._activeMeshes.indexOf(d)}get uid(){return this._uid||(this._uid=w.g.RandomId()),this._uid}addExternalData(d,t){return this._externalData||(this._externalData=new X),this._externalData.add(d,t)}getExternalData(d){return this._externalData?this._externalData.get(d):null}getOrAddExternalDataWithFactory(d,t){return this._externalData||(this._externalData=new X),this._externalData.getOrAddWithFactory(d,t)}removeExternalData(d){return this._externalData.remove(d)}_evaluateSubMesh(d,t,A,w){if(w||d.isInFrustum(this._frustumPlanes)){for(const w of this._evaluateSubMeshStage)w.action(t,d);const A=d.Ha();null!==A&&void 0!==A&&(A.hasRenderTargetTextures&&null!=A.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(A)&&(this._processedMaterials.push(A),this._materialsRenderTargets.concatWithNoDuplicate(A.getRenderTargetTextures())),this._renderingManager.dispatch(d,t,A))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(d){this._preventFreeActiveMeshesAndRenderingGroups!==d&&(d&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=d)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let d=0;d<this.activeCameras.length;d++){const t=this.activeCameras[d];t&&t._activeMeshes&&t._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let d=0;d<this.textures.length;d++){const t=this.textures[d];t&&t.renderList&&t.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2?arguments[2]:void 0,w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],N=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=N,this._skipEvaluateActiveMeshesCompletely=d,w)for(let d=0;d<this._activeMeshes.length;d++)this._activeMeshes.data[d]._freeze();t&&t()}else A&&A("No active camera found")})),this}unfreezeActiveMeshes(){for(let d=0;d<this.meshes.length;d++){const t=this.meshes[d];t._internalAbstractMeshDataInfo&&(t._internalAbstractMeshDataInfo._isActive=!1)}for(let d=0;d<this._activeMeshes.length;d++)this._activeMeshes.data[d]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(d){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>d.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var d;if(this._activeMeshes.length>0)null===(d=this.activeCamera)||void 0===d||d._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const d=this._activeMeshes.length;for(let t=0;t<d;t++){this._activeMeshes.data[t].Nj()}}if(this._activeParticleSystems){const d=this._activeParticleSystems.length;for(let t=0;t<d;t++)this._activeParticleSystems.data[t].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const w of this._beforeEvaluateActiveMeshStage)w.action();const t=this.getActiveMeshCandidates(),A=t.length;for(let w=0;w<A;w++){const d=t.data[w];if(d._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,d.isBlocked)continue;if(this._totalVertices.addCount(d.getTotalVertices(),!1),!d.isReady()||!d.isEnabled()||d.Gf.hasAZeroComponent)continue;d.Nj(),d.actionManager&&d.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(d);let A=this.customLODSelector?this.customLODSelector(d,this.activeCamera):d.getLOD(this.activeCamera);if(d._internalAbstractMeshDataInfo._currentLOD=A,d._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==A&&null!==A&&(A!==d&&0!==A.billboardMode&&A.Nj(),d._preActivate(),d.isVisible&&d.visibility>0&&0!==(d.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||d.rg||d.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(d),this.activeCamera._activeMeshes.push(d),A!==d&&A._activate(this._renderId,!1);for(const t of this._preActiveMeshStage)t.action(d);d._activate(this._renderId,!1)&&(d.isAnInstance?d._internalAbstractMeshDataInfo._actAsRegularMesh&&(A=d):A._internalAbstractMeshDataInfo._onlyForInstances=!1,A._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(d,A)),d._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let d=0;d<this.nj.length;d++){const t=this.nj[d];if(!t.isStarted()||!t.k)continue;const A=t.k;A.position&&!A.isEnabled()||(this._activeParticleSystems.push(t),t.animate(),this._renderingManager.dispatchParticles(t))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(d){this._skeletonsEnabled&&d.skeleton&&(this._activeSkeletons.pushNoDuplicate(d.skeleton)&&(d.skeleton.prepare(),this._activeBones.addCount(d.skeleton.bones.length,!1)),d.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(d)&&this.frameGraph&&d.applySkeleton(d.skeleton))}_activeMesh(d,t){this._prepareSkeleton(t);let A=d.hasInstances||d.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||t.rg;if(t&&t.If&&t.If.length>0){const w=this.getActiveSubMeshCandidates(t),N=w.length;A=A||1===N;for(let p=0;p<N;p++){const N=w.data[p];this._evaluateSubMesh(N,t,d,A)}}}updateTransformMatrix(d){const t=this.activeCamera;if(t)if(t._renderingMultiview){const A=t._rigCameras[0],w=t._rigCameras[1];this.setTransformMatrix(A.getViewMatrix(),A.getProjectionMatrix(d),w.getViewMatrix(),w.getProjectionMatrix(d))}else this.setTransformMatrix(t.getViewMatrix(),t.getProjectionMatrix(d))}_bindFrameBuffer(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];d&&d._multiviewTexture?d._multiviewTexture._bindFrameBuffer():d&&d.outputRenderTarget?d.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),t&&this._clearFrameBuffer(d)}_clearFrameBuffer(d){if(d&&d._multiviewTexture);else if(d&&d.outputRenderTarget&&!d._renderingMultiview){const t=d.outputRenderTarget;t.onClearObservable.hasObservers()?t.onClearObservable.notifyObservers(this._engine):t.skipInitialClear||d.isRightCamera||(this.Ri&&this._engine.clear(t.clearColor||this._clearColor,!t._cleared,!0,!0),t._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(d,t){var A;let N=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(d&&d._skipRendering)return;const p=this._engine;if(this._activeCamera=d,!this.activeCamera)throw new Error("Active camera not set");if(p.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&N){let t=!0;d._renderingMultiview&&d.outputRenderTarget&&(t=d.outputRenderTarget.skipInitialClear,this.Ri&&(this._defaultFrameBufferCleared=!1,d.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),d._renderingMultiview&&d.outputRenderTarget&&(d.outputRenderTarget.skipInitialClear=t)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let w=0;w<this._softwareSkinnedMeshes.length;w++){const d=this._softwareSkinnedMeshes.data[w];d.applySkeleton(d.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),d.customRenderTargets&&d.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(d.customRenderTargets),t&&t.customRenderTargets&&t.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(t.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const w of this._gatherActiveCameraRenderTargetsStage)w.action(this._renderTargets);let B=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){w.g.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let d=0;d<this._renderTargets.length;d++){const t=this._renderTargets.data[d];if(t._shouldRender()){this._renderId++;const d=t.activeCamera&&t.activeCamera!==this.activeCamera;t.render(d,this.dumpNextRenderTargets),B=!0}}w.g.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const d of this._cameraDrawRenderTargetStage)B=d.action(this.activeCamera)||B;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(A=d.outputRenderTarget)||void 0===A?void 0:A.renderPassId)??d.renderPassId??0,B&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||d._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const w of this._beforeCameraDrawStage)w.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),p.snapshotRendering&&1===p.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const w of this._afterCameraDrawStage)w.action(this.activeCamera);if(this.postProcessManager&&!d._multiviewTexture){const t=d.outputRenderTarget?d.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(d.isIntermediate,t)}for(const w of this._afterCameraPostProcessStage)w.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===d.cameraRigMode||d._renderingMultiview)return d._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(d,void 0,t),void this.onAfterRenderCameraObservable.notifyObservers(d);if(d._useMultiviewToSingleView)this._renderMultiviewToSingleView(d);else{this.onBeforeCameraRenderObservable.notifyObservers(d);for(let t=0;t<d._rigCameras.length;t++)this._renderForCamera(d._rigCameras[t],d)}this._activeCamera=d,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(d)}_checkIntersections(){for(let d=0;d<this._meshesForIntersections.length;d++){const t=this._meshesForIntersections.data[d];if(t.actionManager)for(let d=0;t.actionManager&&d<t.actionManager.actions.length;d++){const A=t.actionManager.actions[d];if(12===A.trigger||13===A.trigger){const d=A.getTriggerParameter(),w=d.mesh?d.mesh:d,N=w.intersectsMesh(t,d.usePreciseIntersection),p=t._intersectionsInProgress.indexOf(w);N&&-1===p?12===A.trigger?(A._executeCurrent(b.CreateNew(t,void 0,w)),t._intersectionsInProgress.push(w)):13===A.trigger&&t._intersectionsInProgress.push(w):!N&&p>-1&&(13===A.trigger&&A._executeCurrent(b.CreateNew(t,void 0,w)),t.actionManager.hasSpecificTrigger(13,(d=>{const t=d.mesh?d.mesh:d;return w===t}))&&13!==A.trigger||t._intersectionsInProgress.splice(p,1))}}}}_advancePhysicsEngineStep(d){}_animate(d){}animate(){if(this._engine.isDeterministicLockStep()){let d=Math.max(dd.MinDeltaTime,Math.min(this._engine.getDeltaTime(),dd.MaxDeltaTime))+this._timeAccumulator;const t=this._engine.getTimeStep(),A=1e3/t/1e3;let w=0;const N=this._engine.getLockstepMaxSteps();let p=Math.floor(d/t);for(p=Math.min(p,N);d>0&&w<p;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=t*A,this._animate(t),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(t),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,w++,d-=t;this._timeAccumulator=d<0?0:d}else{const d=this.useConstantAnimationDeltaTime?16:Math.max(dd.MinDeltaTime,Math.min(this._engine.getDeltaTime(),dd.MaxDeltaTime));this._animationRatio=.06*d,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(d)}}_clear(){(this.autoClearDepthAndStencil||this.Ri)&&this._engine.clear(this._clearColor,this.Ri||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(d){var t;if(null===d||void 0===d||!d.outputRenderTarget||null!==d&&void 0!==d&&d.isRigCamera||(d.outputRenderTarget._cleared=!1),null!==d&&void 0!==d&&null!==(t=d.rigCameras)&&void 0!==t&&t.length)for(let A=0;A<d.rigCameras.length;++A){const t=d.rigCameras[A].outputRenderTarget;t&&(t._cleared=!1)}}resetDrawCache(d){if(this.meshes)for(const t of this.meshes)t.resetDrawCache(d)}_renderWithFrameGraph(){var d;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),t)for(const N of this.cameras)if(N.update(),0!==N.cameraRigMode)for(let d=0;d<N._rigCameras.length;d++)N._rigCameras[d].update();for(const N of this._beforeClearStage)N.action();const A=this.getActiveMeshCandidates(),w=A.length;for(let N=0;N<w;N++){const d=A.data[N];d.isBlocked||(this._totalVertices.addCount(d.getTotalVertices(),!1),d.isReady()&&d.isEnabled()&&!d.Gf.hasAZeroComponent&&(d.Nj(),d.actionManager&&d.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(d)))}if(this.particlesEnabled)for(let N=0;N<this.nj.length;N++){const d=this.nj[N];if(!d.isStarted()||!d.k)continue;const t=d.k;t.position&&!t.isEnabled()||(this._activeParticleSystems.push(d),d.animate())}null===(d=this.frameGraph)||void 0===d||d.execute()}render(){var d;let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(d=this.activeCameras)&&void 0!==d&&d.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),A||this.animate();for(const d of this._beforeCameraUpdateStage)d.action();if(t)if(this.activeCameras&&this.activeCameras.length>0)for(let d=0;d<this.activeCameras.length;d++){const t=this.activeCameras[d];if(t.update(),0!==t.cameraRigMode)for(let d=0;d<t._rigCameras.length;d++)t._rigCameras[d].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let d=0;d<this.activeCamera._rigCameras.length;d++)this.activeCamera._rigCameras[d].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(t,A);else{var N;const d=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const t=null!==(N=this.activeCameras)&&void 0!==N&&N.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){w.g.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let A=0;A<this.customRenderTargets.length;A++){const w=this.customRenderTargets[A];if(w._shouldRender()){if(this._renderId++,this.activeCamera=w.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");d.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),w.render(t!==this.activeCamera,this.dumpNextRenderTargets)}}w.g.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===t||void 0===t?void 0:t.renderPassId)??0,this.activeCamera=t,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const A of this._beforeClearStage)A.action();this._clearFrameBuffer(this.activeCamera);for(const A of this._gatherRenderTargetsStage)A.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let A=0;A<this.activeCameras.length;A++)this._processSubCameras(this.activeCameras[A],A>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const d of this._afterRenderStage)d.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let d=0;d<this._toBeDisposed.length;d++){const t=this._toBeDisposed[d];t&&t.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let d=0;d<this.materials.length;d++)this.materials[d].freeze()}unfreezeMaterials(){for(let d=0;d<this.materials.length;d++)this.materials[d].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((d=>{d.onAnimationEndObservable.clear(),d.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const d=this._activeRequests.slice();for(const N of d)N.abort();this._activeRequests.length=0;try{this.hj.notifyObservers(this)}catch(w){g.e.Error("An error occurred while calling onDisposeObservable!",w)}this.Qi();if(this._engine.getInputElement())for(let N=0;N<this.cameras.length;N++)this.cameras[N].Qi();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(d=>d.dispose(!0))),this._disposeList(this.transformNodes,(d=>d.dispose(!0)));const t=this.cameras;this._disposeList(t),this.si&&this.si.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this.nj),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let A=this._engine.scenes.indexOf(this);A>-1&&this._engine.scenes.splice(A,1),T.e._LastCreatedScene===this&&(this._engine.scenes.length>0?T.e._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:T.e._LastCreatedScene=null),A=this._engine._virtualScenes.indexOf(this),A>-1&&this._engine._virtualScenes.splice(A,1),this._engine.wipeCaches(!0),this.hj.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(d,t){const A=d.slice(0);t=t??(d=>d.dispose());for(const w of A)t(w);d.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let d=0;d<this.meshes.length;d++){const t=this.meshes[d].Aj;t&&t.clearCachedData()}}cleanCachedTextureBuffer(){for(const d of this.textures){d._buffer&&(d._buffer=null)}}getWorldExtends(d){const t=new a.l(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),A=new a.l(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return d=d||(()=>!0),this.meshes.filter(d).forEach((d=>{if(d.Nj(!0),!d.If||0===d.If.length||d.infiniteDistance)return;const w=d.getBoundingInfo(),N=w.boundingBox.minimumWorld,p=w.boundingBox.maximumWorld;a.l.CheckExtends(N,t,A),a.l.CheckExtends(p,t,A)})),{min:t,max:A}}createPickingRay(d,t,A,w){throw(0,F.b)("Ray")}createPickingRayToRef(d,t,A,w,N){throw(0,F.b)("Ray")}createPickingRayInCameraSpace(d,t,A){throw(0,F.b)("Ray")}createPickingRayInCameraSpaceToRef(d,t,A,w){throw(0,F.b)("Ray")}Rc(d,t,A,w,N,p){const B=(0,F.b)("Ray",!0);return B&&g.e.Warn(B),new k.c}pickWithBoundingInfo(d,t,A,w,N){const p=(0,F.b)("Ray",!0);return p&&g.e.Warn(p),new k.c}pickWithRay(d,t,A,w){throw(0,F.b)("Ray")}multiPick(d,t,A,w,N){throw(0,F.b)("Ray")}multiPickWithRay(d,t,A){throw(0,F.b)("Ray")}setPointerOverMesh(d,t,A){this._inputManager.setPointerOverMesh(d,t,A)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const d of this.geometries)d._rebuild();for(const d of this.meshes)d._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const d of this._components)d.rebuild();for(const d of this.nj)d.rebuild();if(this.spriteManagers)for(const d of this.spriteManagers)d.rebuild()}_rebuildTextures(){for(const d of this.textures)d._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(d,t,A){if(void 0===t)return d;const w=[];for(const N in d){const p=d[N];W.c&&W.c.MatchesQuery(p,t)&&(!A||A(p))&&w.push(p)}return w}getMeshesByTags(d,t){return this._getByTags(this.meshes,d,t)}getCamerasByTags(d,t){return this._getByTags(this.cameras,d,t)}getLightsByTags(d,t){return this._getByTags(this.lights,d,t)}getMaterialByTags(d,t){return this._getByTags(this.materials,d,t).concat(this._getByTags(this.multiMaterials,d,t))}getTransformNodesByTags(d,t){return this._getByTags(this.transformNodes,d,t)}setRenderingOrder(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(d,t,A,w)}setRenderingAutoClearDepthStencil(d,t){let A=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],w=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(d,t,A,w)}getAutoClearDepthStencilSetup(d){return this._renderingManager.getAutoClearDepthStencilSetup(d)}_forceBlockMaterialDirtyMechanism(d){this._blockMaterialDirtyMechanism=d}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(d){this._blockMaterialDirtyMechanism!==d&&(this._blockMaterialDirtyMechanism=d,d||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(d,t){if(!this._blockMaterialDirtyMechanism)for(const A of this.materials)t&&!t(A)||A.Cg(d)}_loadFile(d,t,A,w,N,p,B){const X=(0,M.l)(d,t,A,w?this.offlineProvider:void 0,N,p,B);return this._activeRequests.push(X),X.onCompleteObservable.add((d=>{this._activeRequests.splice(this._activeRequests.indexOf(d),1)})),X}_loadFileAsync(d,t,A,w,N){return new Promise(((p,B)=>{this._loadFile(d,(d=>{p(d)}),t,A,w,((d,t)=>{B(t)}),N)}))}_requestFile(d,t,A,w,N,p,B){const X=(0,M.u)(d,t,A,w?this.offlineProvider:void 0,N,p,B);return this._activeRequests.push(X),X.onCompleteObservable.add((d=>{this._activeRequests.splice(this._activeRequests.indexOf(d),1)})),X}_requestFileAsync(d,t,A,w,N){return new Promise(((p,B)=>{this._requestFile(d,(d=>{p(d)}),t,A,w,(d=>{B(d)}),N)}))}_readFile(d,t,A,w,N){const p=(0,M.q)(d,t,A,w,N);return this._activeRequests.push(p),p.onCompleteObservable.add((d=>{this._activeRequests.splice(this._activeRequests.indexOf(d),1)})),p}_readFileAsync(d,t,A){return new Promise(((w,N)=>{this._readFile(d,(d=>{w(d)}),t,A,(d=>{N(d)}))}))}getPerfCollector(){throw(0,F.b)("performanceViewerSceneExtension")}setActiveCameraByID(d){return this.setActiveCameraById(d)}getMaterialByID(d){return this.getMaterialById(d)}getLastMaterialByID(d){return this.getLastMaterialById(d)}getTextureByUniqueID(d){return this.getTextureByUniqueId(d)}getCameraByID(d){return this.getCameraById(d)}getCameraByUniqueID(d){return this.getCameraByUniqueId(d)}getBoneByID(d){return this.getBoneById(d)}getLightByID(d){return this.getLightById(d)}getLightByUniqueID(d){return this.getLightByUniqueId(d)}getParticleSystemByID(d){return this.getParticleSystemById(d)}getGeometryByID(d){return this.getGeometryById(d)}getMeshByID(d){return this.getMeshById(d)}getMeshByUniqueID(d){return this.getMeshByUniqueId(d)}getLastMeshByID(d){return this.getLastMeshById(d)}getMeshesByID(d){return this.getMeshesById(d)}getTransformNodeByID(d){return this.getTransformNodeById(d)}getTransformNodeByUniqueID(d){return this.getTransformNodeByUniqueId(d)}getTransformNodesByID(d){return this.getTransformNodesById(d)}getNodeByID(d){return this.getNodeById(d)}getLastEntryByID(d){return this.getLastEntryById(d)}getLastSkeletonByID(d){return this.getLastSkeletonById(d)}}dd.FOGMODE_NONE=0,dd.FOGMODE_EXP=1,dd.FOGMODE_EXP2=2,dd.FOGMODE_LINEAR=3,dd.MinDeltaTime=1,dd.MaxDeltaTime=1e3,(0,S.g)("BABYLON.Scene",dd)},11146:(d,t,A)=>{"use strict";A.d(t,{e:()=>w,g:()=>N});class w{}w.NAME_EFFECTLAYER="EffectLayer",w.NAME_LAYER="Layer",w.NAME_LENSFLARESYSTEM="LensFlareSystem",w.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",w.NAME_PARTICLESYSTEM="wb",w.NAME_GAMEPAD="Gamepad",w.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",w.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",w.NAME_PREPASSRENDERER="PrePassRenderer",w.NAME_DEPTHRENDERER="DepthRenderer",w.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",w.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",w.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",w.NAME_SPRITE="Sprite",w.NAME_SUBSURFACE="SubSurface",w.NAME_OUTLINERENDERER="Outline",w.NAME_PROCEDURALTEXTURE="ProceduralTexture",w.NAME_SHADOWGENERATOR="ShadowGenerator",w.NAME_OCTREE="xb",w.NAME_PHYSICSENGINE="PhysicsEngine",w.NAME_AUDIO="Audio",w.NAME_FLUIDRENDERER="FluidRenderer",w.STEP_ISREADYFORMESH_EFFECTLAYER=0,w.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,w.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,w.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,w.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,w.STEP_BEFORECAMERADRAW_PREPASS=0,w.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,w.STEP_BEFORECAMERADRAW_LAYER=2,w.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,w.STEP_BEFORERENDERTARGETDRAW_LAYER=1,w.STEP_BEFORERENDERINGMESH_PREPASS=0,w.STEP_BEFORERENDERINGMESH_OUTLINE=1,w.STEP_AFTERRENDERINGMESH_PREPASS=0,w.STEP_AFTERRENDERINGMESH_OUTLINE=1,w.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,w.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,w.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,w.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,w.STEP_BEFORECLEAR_PREPASS=1,w.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,w.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,w.STEP_AFTERRENDERTARGETDRAW_LAYER=1,w.STEP_AFTERCAMERADRAW_PREPASS=0,w.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,w.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,w.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,w.STEP_AFTERCAMERADRAW_LAYER=4,w.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,w.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,w.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,w.STEP_AFTERRENDER_AUDIO=0,w.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,w.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,w.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,w.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,w.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,w.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,w.STEP_POINTERMOVE_SPRITE=0,w.STEP_POINTERDOWN_SPRITE=0,w.STEP_POINTERUP_SPRITE=0;class N extends Array{constructor(d){super(...d)}static Create(){return Object.create(N.prototype)}registerStep(d,t,A){let w=0,N=Number.MAX_VALUE;for(;w<this.length;w++){if(N=this[w].index,d<N)break}this.splice(w,0,{index:d,component:t,action:A.bind(t)})}clear(){this.length=0}}},11041:(d,t,A)=>{"use strict";A.d(t,{b:()=>w});function w(d,t,A,w){var N,p=arguments.length,B=p<3?t:null===w?w=Object.getOwnPropertyDescriptor(t,A):w;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)B=Reflect.decorate(d,t,A,w);else for(var X=d.length-1;X>=0;X--)(N=d[X])&&(B=(p<3?N(B):p>3?N(t,A,B):N(t,A))||B);return p>3&&B&&Object.defineProperty(t,A,B),B}Object.create;Object.create},12001:(d,t,A)=>{"use strict";class w{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((d,t)=>{this._resolve=d,this._reject=t}))}}var N=A(11076),p=A(11094),B=A(10727),X=A(11320),W=A(12009),a=A(12026),D=A(10730),i=A(11499),k=A(12029),b=A(12037),Q=A(10775),P=A(10740),J=A(10749);class U{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(d){this._useTextureToStoreBoneMatrices=d,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(d){this._animationPropertiesOverride=d}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(d,t,A){this.name=d,this.id=t,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=N.c.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new D.b,this.bones=[],this._scene=A||Q.e.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const w=this._scene.getEngine().getCaps();this._canUseTextureForBones=w.textureFloat&&w.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((d=>!d.getParent()))}getTransformMatrices(d){if(this.needInitialSkinMatrix){if(!d)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return d._bonesTransformMatrices||this.prepare(!0),d._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(d){return this.needInitialSkinMatrix&&d._transformMatrixTexture?d._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(d){let t=`Name: ${this.name}, nBones: ${this.bones.length}`;if(t+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,d){t+=", Ranges: {";let d=!0;for(const A in this._ranges)d&&(t+=", ",d=!1),t+=A;t+="}"}return t}getBoneIndexByName(d){for(let t=0,A=this.bones.length;t<A;t++)if(this.bones[t].name===d)return t;return-1}createAnimationRange(d,t,A){if(!this._ranges[d]){this._ranges[d]=new b.d(d,t,A);for(let w=0,N=this.bones.length;w<N;w++)this.bones[w].animations[0]&&this.bones[w].animations[0].createRange(d,t,A)}}deleteAnimationRange(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let A=0,w=this.bones.length;A<w;A++)this.bones[A].animations[0]&&this.bones[A].animations[0].deleteRange(d,t);this._ranges[d]=null}getAnimationRange(d){return this._ranges[d]||null}getAnimationRanges(){const d=[];let t;for(t in this._ranges)d.push(this._ranges[t]);return d}copyAnimationRange(d,t){let A=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[t]||!d.getAnimationRange(t))return!1;let w=!0;const N=this._getHighestAnimationFrame()+1,p={},B=d.bones;let X,W;for(W=0,X=B.length;W<X;W++)p[B[W].name]=B[W];this.bones.length!==B.length&&(P.e.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${B.length}`),w=!1);const a=A&&this.dimensionsAtRest&&d.dimensionsAtRest?this.dimensionsAtRest.divide(d.dimensionsAtRest):null;for(W=0,X=this.bones.length;W<X;W++){const d=this.bones[W].name,B=p[d];B?w=w&&this.bones[W].copyAnimationRange(B,t,N,A,a):(P.e.Warn("copyAnimationRange: not same rig, missing source bone "+d),w=!1)}const D=d.getAnimationRange(t);return D&&(this._ranges[t]=new b.d(t,D.from+N,D.to+N)),w}returnToRest(){for(const d of this.bones)-1!==d._index&&d.returnToRest()}_getHighestAnimationFrame(){let d=0;for(let t=0,A=this.bones.length;t<A;t++)if(this.bones[t].animations[0]){const A=this.bones[t].animations[0].getHighestFrame();d<A&&(d=A)}return d}beginAnimation(d,t,A,w){const N=this.getAnimationRange(d);return N?this._scene.beginAnimation(this,N.from,N.to,t,A,w):null}static MakeAnimationAdditive(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2?arguments[2]:void 0;const w=d.getAnimationRange(A);if(!w)return null;const N=d._scene.getAllAnimatablesByTarget(d);let p=null;for(let X=0;X<N.length;X++){const d=N[X];if(d.fromFrame===(null===w||void 0===w?void 0:w.from)&&d.toFrame===(null===w||void 0===w?void 0:w.to)){p=d;break}}const B=d.getAnimatables();for(let X=0;X<B.length;X++){const d=B[X].animations;if(d)for(let w=0;w<d.length;w++)k.d.MakeAnimationAdditive(d[w],t,A)}return p&&(p.isAdditive=!0),d}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(d){this._meshesWithPoseMatrix.push(d)}_unregisterMeshWithPoseMatrix(d){const t=this._meshesWithPoseMatrix.indexOf(d);t>-1&&this._meshesWithPoseMatrix.splice(t,1)}_computeTransformMatrices(d,t){this.onBeforeComputeObservable.notifyObservers(this);for(let A=0;A<this.bones.length;A++){const w=this.bones[A];w._childUpdateId++;const N=w.getParent();if(N?w.getLocalMatrix().multiplyToRef(N.getFinalMatrix(),w.getFinalMatrix()):t?w.getLocalMatrix().multiplyToRef(t,w.getFinalMatrix()):w.getFinalMatrix().p(w.getLocalMatrix()),-1!==w._index){const t=null===w._index?A:w._index;w.getAbsoluteInverseBindMatrix().multiplyToArray(w.getFinalMatrix(),d,16*t)}}this._identity.copyToArray(d,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const d=this.va().getRenderId();if(this._currentRenderId===d)return;this._currentRenderId=d}if(this._numBonesWithLinkedTransformNode>0)for(const d of this.bones)if(d._linkedTransformNode){const t=d._linkedTransformNode;d.position=t.position,t.rotationQuaternion?d.rotationQuaternion=t.rotationQuaternion:d.rotation=t.rotation,d.Gf=t.Gf}if(this.needInitialSkinMatrix)for(const d of this._meshesWithPoseMatrix){const t=d.getPoseMatrix();let A=this._isDirty;if(d._bonesTransformMatrices&&d._bonesTransformMatrices.length===16*(this.bones.length+1)||(d._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),A=!0),A){if(this._synchronizedWithMesh!==d){this._synchronizedWithMesh=d;for(const d of this.bones)if(!d.getParent()){d.getBindMatrix().multiplyToRef(t,N.h.Matrix[1]),d._updateAbsoluteBindMatrices(N.h.Matrix[1])}if(this.isUsingTextureForMatrices){const t=4*(this.bones.length+1);d._transformMatrixTexture&&d._transformMatrixTexture.getSize().width===t||(d._transformMatrixTexture&&d._transformMatrixTexture.dispose(),d._transformMatrixTexture=i.b.CreateRGBATexture(d._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(d._bonesTransformMatrices,t),this.isUsingTextureForMatrices&&d._transformMatrixTexture&&d._transformMatrixTexture.update(d._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=i.b.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let d=0;d<this.bones.length;d++)this._animatables.push(this.bones[d])}return this._animatables}clone(d,t){const A=new U(d,t||d,this._scene);A.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let w=0;w<this.bones.length;w++){const d=this.bones[w];let t=null;const N=d.getParent();if(N){const d=this.bones.indexOf(N);t=A.bones[d]}const p=new a.b(d.name,A,t,d.getBindMatrix().clone(),d.getRestMatrix().clone());p._index=d._index,d._linkedTransformNode&&p.linkTransformNode(d._linkedTransformNode),J.b.DeepCopy(d.animations,p.animations)}if(this._ranges){A._ranges={};for(const d in this._ranges){const t=this._ranges[d];t&&(A._ranges[d]=t.clone())}}return this._isDirty=!0,A.prepare(!0),A}enableBlending(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((t=>{t.animations.forEach((t=>{t.enableBlending=!0,t.blendingSpeed=d}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const d=this._parentContainer.skeletons.indexOf(this);d>-1&&this._parentContainer.skeletons.splice(d,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const d={};d.name=this.name,d.id=this.id,this.dimensionsAtRest&&(d.dimensionsAtRest=this.dimensionsAtRest.gj()),d.bones=[],d.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let A=0;A<this.bones.length;A++){var t;const w=this.bones[A],N=w.getParent(),p={parentBoneIndex:N?this.bones.indexOf(N):-1,index:w.getIndex(),name:w.name,id:w.id,matrix:w.getBindMatrix().gj(),rest:w.getRestMatrix().gj(),linkedTransformNodeId:null===(t=w.getTransformNode())||void 0===t?void 0:t.id};d.bones.push(p),w.length&&(p.length=w.length),w.metadata&&(p.metadata=w.metadata),w.animations&&w.animations.length>0&&(p.animation=w.animations[0].serialize()),d.ranges=[];for(const t in this._ranges){const A=this._ranges[t];if(!A)continue;const w={};w.name=t,w.from=A.from,w.to=A.to,d.ranges.push(w)}}return d}static Parse(d,t){const A=new U(d.name,d.id,t);let w;for(d.dimensionsAtRest&&(A.dimensionsAtRest=N.l.Lg(d.dimensionsAtRest)),A.needInitialSkinMatrix=d.needInitialSkinMatrix,w=0;w<d.bones.length;w++){const t=d.bones[w],p=d.bones[w].index;let B=null;t.parentBoneIndex>-1&&(B=A.bones[t.parentBoneIndex]);const X=t.rest?N.c.Lg(t.rest):null,W=new a.b(t.name,A,B,N.c.Lg(t.matrix),X,null,p);void 0!==t.id&&null!==t.id&&(W.id=t.id),t.length&&(W.length=t.length),t.metadata&&(W.metadata=t.metadata),t.animation&&W.animations.push(k.d.Parse(t.animation)),void 0!==t.linkedTransformNodeId&&null!==t.linkedTransformNodeId&&(A._hasWaitingData=!0,W._waitingTransformNodeId=t.linkedTransformNodeId)}if(d.ranges)for(w=0;w<d.ranges.length;w++){const t=d.ranges[w];A.createAnimationRange(t.name,t.from,t.to)}return A}computeAbsoluteMatrices(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||d)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let d=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(d)}getPoseMatrix(){let d=null;return this._meshesWithPoseMatrix.length>0&&(d=this._meshesWithPoseMatrix[0].getPoseMatrix()),d}sortBones(){const d=[],t=new Array(this.bones.length);for(let A=0;A<this.bones.length;A++)this._sortBones(A,d,t);this.bones=d}_sortBones(d,t,A){if(A[d])return;A[d]=!0;const w=this.bones[d];if(!w)return;void 0===w._index&&(w._index=d);const N=w.getParent();N&&this._sortBones(this.bones.indexOf(N),t,A),t.push(w)}setCurrentPoseAsRest(){this.bones.forEach((d=>{d.setCurrentPoseAsRest()}))}}var T=A(11203),F=A(11041),q=A(11047),H=A(12040),f=A(12048),v=A(10885),m=A(11097);class j extends f.c{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(d){this.subSurface.refractionTexture=d,d?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(d){this.subSurface.indexOfRefraction=d}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(d){this.subSurface.invertRefractionY=d}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(d){this.subSurface.linkRefractionWithTransparency=d,d&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===f.c.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(d){d!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=d?f.c.LIGHTFALLOFF_PHYSICAL:f.c.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===f.c.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(d){d!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=d?f.c.LIGHTFALLOFF_GLTF:f.c.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(d){this._attachImageProcessingConfiguration(d),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(d){this.imageProcessingConfiguration.colorCurvesEnabled=d}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(d){this.imageProcessingConfiguration.colorGradingEnabled=d}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(d){this._imageProcessingConfiguration.toneMappingEnabled=d}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(d){this._imageProcessingConfiguration.exposure=d}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(d){this._imageProcessingConfiguration.contrast=d}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(d){this._imageProcessingConfiguration.colorGradingTexture=d}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(d){this._imageProcessingConfiguration.colorCurves=d}constructor(d,t){super(d,t,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=j.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=p.e.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new p.e(0,0,0),this.albedoColor=new p.e(1,1,1),this.reflectivityColor=new p.e(1,1,1),this.reflectionColor=new p.e(1,1,1),this.emissiveColor=new p.e(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,H.c)(this.va())}getClassName(){return"PBRMaterial"}clone(d){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const w=m.d.Clone((()=>new j(d,this.va())),this,{cloneTexturesOnlyOnce:t});return w.id=d,w.name=d,this.stencil.copyTo(w.stencil),this._clonePlugins(w,A),w}serialize(){const d=super.serialize();return d.customType="BABYLON.PBRMaterial",d}static Parse(d,t,A){const w=m.d.Parse((()=>new j(d.name,t)),d,t,A);return d.stencil&&w.stencil.parse(d.stencil,t,A),T.c._ParsePlugins(d,w,t,A),d.clearCoat&&w.clearCoat.parse(d.clearCoat,t,A),d.anisotropy&&w.anisotropy.parse(d.anisotropy,t,A),d.brdf&&w.brdf.parse(d.brdf,t,A),d.sheen&&w.sheen.parse(d.sheen,t,A),d.subSurface&&w.subSurface.parse(d.subSurface,t,A),d.iridescence&&w.iridescence.parse(d.iridescence,t,A),w}}j.PBRMATERIAL_OPAQUE=f.c.PBRMATERIAL_OPAQUE,j.PBRMATERIAL_ALPHATEST=f.c.PBRMATERIAL_ALPHATEST,j.PBRMATERIAL_ALPHABLEND=f.c.PBRMATERIAL_ALPHABLEND,j.PBRMATERIAL_ALPHATESTANDBLEND=f.c.PBRMATERIAL_ALPHATESTANDBLEND,j.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=f.c.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"directIntensity",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"emissiveIntensity",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"environmentIntensity",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"specularIntensity",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"disableBumpMap",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"albedoTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"ambientTexture",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"ambientTextureStrength",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],j.prototype,"opacityTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"reflectionTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"emissiveTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"reflectivityTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"metallicTexture",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"metallic",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"roughness",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"metallicF0Factor",void 0),(0,F.b)([(0,q.i)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"metallicReflectanceColor",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"metallicReflectanceTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"reflectanceTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"microSurfaceTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"bumpTexture",void 0),(0,F.b)([(0,q.C)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty",null)],j.prototype,"lightmapTexture",void 0),(0,F.b)([(0,q.i)("ambient"),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"ambientColor",void 0),(0,F.b)([(0,q.i)("albedo"),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"albedoColor",void 0),(0,F.b)([(0,q.i)("reflectivity"),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"reflectivityColor",void 0),(0,F.b)([(0,q.i)("reflection"),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"reflectionColor",void 0),(0,F.b)([(0,q.i)("emissive"),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"emissiveColor",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"microSurface",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useLightmapAsShadowmap",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],j.prototype,"useAlphaFromAlbedoTexture",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],j.prototype,"forceAlphaTest",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesAndMiscDirty")],j.prototype,"alphaCutOff",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useSpecularOverAlpha",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useAmbientInGrayScale",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,F.b)([(0,q.J)()],j.prototype,"usePhysicalLightFalloff",null),(0,F.b)([(0,q.J)()],j.prototype,"useGLTFLightFalloff",null),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useRadianceOverAlpha",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useObjectSpaceNormalMap",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useParallax",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useParallaxOcclusion",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"parallaxScaleBias",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsLightsDirty")],j.prototype,"disableLighting",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"forceIrradianceInFragment",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsLightsDirty")],j.prototype,"maxSimultaneousLights",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"invertNormalMapX",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"invertNormalMapY",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"twoSidedLighting",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useAlphaFresnel",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useLinearAlphaFresnel",void 0),(0,F.b)([(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"environmentBRDFTexture",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"forceNormalForward",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"enableSpecularAntiAliasing",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useHorizonOcclusion",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsTexturesDirty")],j.prototype,"useRadianceOcclusion",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsMiscDirty")],j.prototype,"unlit",void 0),(0,F.b)([(0,q.J)(),(0,q.c)("_markAllSubMeshesAsMiscDirty")],j.prototype,"applyDecalMapAfterDetailMap",void 0),(0,v.g)("BABYLON.PBRMaterial",j);var n=A(11264),R=A(11353),Z=A(11120),L=A(11342),I=A(11350),u=A(11309);class V{get influence(){return this._influence}set influence(d){if(this._influence===d)return;const t=this._influence;this._influence=d,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===t||0===d)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(d){this._animationPropertiesOverride=d}constructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=d,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new D.b,this._onDataLayoutChanged=new D.b,this._animationPropertiesOverride=null,this.id=d,this._scene=A||Q.e.LastCreatedScene,this.influence=t,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(d){const t=this.hasPositions;this._positions=d,t!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(d){const t=this.hasNormals;this._normals=d,t!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(d){const t=this.hasTangents;this._tangents=d,t!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(d){const t=this.hasUVs;this._uvs=d,t!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const d=m.d.Clone((()=>new V(this.name,this.influence,this._scene)),this);return d._positions=this._positions,d._normals=this._normals,d._tangents=this._tangents,d._uvs=this._uvs,d}serialize(){const d={};return d.name=this.name,d.influence=this.influence,d.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(d.id=this.id),this.hasNormals&&(d.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(d.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(d.Aa=Array.prototype.slice.call(this.getUVs())),m.d.AppendSerializedAnimations(this,d),d}getClassName(){return"MorphTarget"}static Parse(d,t){const A=new V(d.name,d.influence);if(A.setPositions(d.xa),null!=d.id&&(A.id=d.id),d.ya&&A.setNormals(d.ya),d.tangents&&A.setTangents(d.tangents),d.Aa&&A.setUVs(d.Aa),d.animations){for(let t=0;t<d.animations.length;t++){const w=d.animations[t],N=(0,v.d)("BABYLON.Animation");N&&A.animations.push(N.Parse(w))}d.autoAnimate&&t&&t.beginAnimation(A,d.autoAnimateFrom,d.autoAnimateTo,d.autoAnimateLoop,d.autoAnimateSpeed||1)}return A}static FromMesh(d,t,A){t||(t=d.name);const w=new V(t,A,d.va());return w.setPositions(d.getVerticesData(Z.f.PositionKind)),d.isVerticesDataPresent(Z.f.NormalKind)&&w.setNormals(d.getVerticesData(Z.f.NormalKind)),d.isVerticesDataPresent(Z.f.TangentKind)&&w.setTangents(d.getVerticesData(Z.f.TangentKind)),d.isVerticesDataPresent(Z.f.UVKind)&&w.setUVs(d.getVerticesData(Z.f.UVKind)),w}}(0,F.b)([(0,q.J)()],V.prototype,"id",void 0);var h=A(11054),l=A(11923);class y{set areUpdatesFrozen(d){d?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new h.d(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,d||(d=Q.e.LastCreatedScene),this._scene=d,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const d=this._scene.getEngine().getCaps();this._canUseTextureForTargets=d.canUseGLVertexID&&d.textureFloat&&d.maxVertexTextureImageUnits>0&&d.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(d){this._numMaxInfluencers!==d&&(this._numMaxInfluencers=d,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(d){this._useTextureToStoreTargets=d}get isUsingTextureForTargets(){var d;return y.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(d=this._scene)&&void 0!==d&&d.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(d){return this._activeTargets.data[d]}getTarget(d){return this._targets[d]}getTargetByName(d){for(const t of this._targets)if(t.name===d)return t;return null}addTarget(d){this._targets.push(d),this._targetInfluenceChangedObservers.push(d.onInfluenceChanged.add((d=>{this._syncActiveTargets(d)}))),this._targetDataLayoutChangedObservers.push(d._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(d){const t=this._targets.indexOf(d);t>=0&&(this._targets.splice(t,1),d.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(t,1)[0]),d._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(t,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(d)}_bind(d){d.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),d.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),d.setTexture("morphTargets",this._targetStoreTexture),d.setInt("morphTargetCount",this.numInfluencers)}clone(){const d=new y(this._scene);for(const t of this._targets)d.addTarget(t.clone());return d.enableNormalMorphing=this.enableNormalMorphing,d.enableTangentMorphing=this.enableTangentMorphing,d.enableUVMorphing=this.enableUVMorphing,d}serialize(){const d={};d.id=this.uniqueId,d.targets=[];for(const t of this._targets)d.targets.push(t.serialize());return d}_syncActiveTargets(d){if(this.areUpdatesFrozen)return;let t=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let A=-1;for(const w of this._targets){if(A++,0===w.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=y.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(w),this._morphTargetTextureIndices[t]=A,this._tempInfluences[t++]=w.influence,this._supportsNormals=this._supportsNormals&&w.hasNormals,this._supportsTangents=this._supportsTangents&&w.hasTangents,this._supportsUVs=this._supportsUVs&&w.hasUVs;const d=w.getPositions();if(d){const t=d.length/3;if(0===this._vertexCount)this._vertexCount=t;else if(this._vertexCount!==t)return void P.e.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==t&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,t)),this._influences&&this._influences.length===t||(this._influences=new Float32Array(t));for(let w=0;w<t;w++)this._influences[w]=this._tempInfluences[w];d&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const d=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>d&&(this._textureHeight=Math.ceil(this._textureWidth/d),this._textureWidth=d);let t=!0;if(this._targetStoreTexture){const d=this._targetStoreTexture.getSize();d.width===this._textureWidth&&d.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(t=!1)}if(t){this._targetStoreTexture&&this._targetStoreTexture.dispose();const d=this._targets.length,t=new Float32Array(d*this._textureWidth*this._textureHeight*4);let A=0;for(let w=0;w<d;w++){const d=this._targets[w],N=d.getPositions(),p=d.getNormals(),B=d.getUVs(),X=d.getTangents();if(!N)return void(0===w&&P.e.Error("Invalid morph target. Target must have positions."));A=w*this._textureWidth*this._textureHeight*4;for(let w=0;w<this._vertexCount;w++)t[A]=N[3*w],t[A+1]=N[3*w+1],t[A+2]=N[3*w+2],A+=4,this._supportsNormals&&p&&(t[A]=p[3*w],t[A+1]=p[3*w+1],t[A+2]=p[3*w+2],A+=4),this._supportsUVs&&B&&(t[A]=B[2*w],t[A+1]=B[2*w+1],A+=4),this._supportsTangents&&X&&(t[A]=X[3*w],t[A+1]=X[3*w+1],t[A+2]=X[3*w+2],A+=4)}this._targetStoreTexture=l.b.CreateRGBATexture(t,this._textureWidth,this._textureHeight,d,this._scene,!1,!1,1,1)}}for(const d of this._scene.meshes)d.morphTargetManager===this&&d._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const d=this._parentContainer.morphTargetManagers.indexOf(this);d>-1&&this._parentContainer.morphTargetManagers.splice(d,1),this._parentContainer=null}for(const d of this._targets)this._scene.stopAnimation(d)}}static Parse(d,t){const A=new y(t);for(const w of d.targets)A.addTarget(V.Parse(w,t));return A}}y.EnableTextureStorage=!0,y.MaxActiveMorphTargetsInVertexAttributeMode=8;var s=A(12061),Y=A(10779),r=A(11221);function K(d,t,A,w){return N.l.Lg(t,A).scaleInPlace(w)}class G{constructor(d,t,A,w){this.type=d,this.name=t,this.getValue=A,this.getStride=w}_buildAnimation(d,t,A){const w=new k.d(d,this.name,t,this.type);return w.setKeys(A),w}}class O extends G{buildAnimations(d,t,A,w,N){N(d._babylonTransformNode,this._buildAnimation(t,A,w))}}const z={translation:[new O(k.d.ANIMATIONTYPE_VECTOR3,"position",K,(()=>3))],rotation:[new O(k.d.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(d,t,A,w){return N.f.Lg(t,A).scaleInPlace(w)}),(()=>4))],scale:[new O(k.d.ANIMATIONTYPE_VECTOR3,"Gf",K,(()=>3))],weights:[new class extends G{buildAnimations(d,t,A,w,N){if(d._numMorphTargets)for(let p=0;p<d._numMorphTargets;p++){const B=new k.d(`${t}_${p}`,this.name,A,this.type);if(B.setKeys(w.map((d=>({frame:d.frame,inTangent:d.inTangent?d.inTangent[p]:void 0,value:d.value[p],outTangent:d.outTangent?d.outTangent[p]:void 0,interpolation:d.interpolation})))),d._primitiveBabylonMeshes)for(const t of d._primitiveBabylonMeshes)if(t.morphTargetManager){const d=t.morphTargetManager.getTarget(p),A=B.clone();d.animations.push(A),N(d,A)}}}}(k.d.ANIMATIONTYPE_FLOAT,"influence",(function(d,t,A,w){const N=new Array(d._numMorphTargets);for(let p=0;p<N.length;p++)N[p]=t[A++]*w;return N}),(d=>d._numMorphTargets))]},c=new Map,e=c;function M(d,t,A){x(d)&&P.e.Warn(`Extension with the name '${d}' already exists`),c.set(d,{isGLTFExtension:t,factory:A})}function x(d){return c.delete(d)}function o(){const d=d=>d&&"object"===typeof d;for(var t=arguments.length,A=new Array(t),w=0;w<t;w++)A[w]=arguments[w];return A.reduce(((t,A)=>(Object.keys(A).forEach((w=>{const N=t[w],p=A[w];Array.isArray(N)&&Array.isArray(p)?t[w]=N.concat(...p):d(N)&&d(p)?t[w]=o(N,p):t[w]=p})),t)),{})}class C{static Get(d,t,A){if(!t||void 0==A||!t[A])throw new Error(`${d}: Failed to find index (${A})`);return t[A]}static TryGet(d,t){return d&&void 0!=t&&d[t]?d[t]:null}static Assign(d){if(d)for(let t=0;t<d.length;t++)d[t].index=t}}class E{static RegisterExtension(d,t){M(d,!1,t)}static UnregisterExtension(d){return x(d)}get Mi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(d){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=d}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((d=>d.dispose&&d.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(d,t,A,w,N,p){let B=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=t,this._assetContainer=A,this._loadData(w);let p=null;if(d){const t={};if(this._gltf.nodes)for(const d of this._gltf.nodes)d.name&&(t[d.name]=d.index);p=(d instanceof Array?d:[d]).map((d=>{const A=t[d];if(void 0===A)throw new Error(`Failed to find node '${d}'`);return A}))}return this._loadAsync(N,B,p,(()=>({meshes:this._getMeshes(),nj:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=d,this._loadData(t),this._loadAsync(A,N,null,(()=>{})))))}_loadAsync(d,t,A,w){return Promise.resolve().then((async()=>{this._rootUrl=d,this._uniqueRootUrl=!d.startsWith("file:")&&t?d:`${d}${Date.now()}/`,this._fileName=t,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const N=`${s.i[s.i.LOADING]} => ${s.i[s.i.READY]}`,p=`${s.i[s.i.LOADING]} => ${s.i[s.i.COMPLETE]}`;this._parent._startPerformanceCounter(N),this._parent._startPerformanceCounter(p),this._parent._setState(s.i.LOADING),this._extensionsOnLoading();const X=new Array;if(!this.parent.loadOnlyMaterials)if(A)X.push(this.loadSceneAsync("/nodes",{nodes:A,index:-1}));else if(void 0!=this._gltf.Hf||this._gltf.scenes&&this._gltf.scenes[0]){const d=C.Get("/scene",this._gltf.scenes,this._gltf.Hf||0);X.push(this.loadSceneAsync(`/scenes/${d.index}`,d))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let d=0;d<this._gltf.materials.length;++d){const t=this._gltf.materials[d],A="/materials/"+d,w=T.c.TriangleFillMode;X.push(this._loadMaterialAsync(A,t,null,w,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&X.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&X.push(this._compileShadowGeneratorsAsync());return Promise.all(X).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.Mf(!0),this._extensionsOnReady(),this._parent._setState(s.i.READY),this._startAnimations(),w()))).then((d=>(this._parent._endPerformanceCounter(N),B.g.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(p),this._parent._setState(s.i.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(d=>{this._parent.onErrorObservable.notifyObservers(d),this._parent.onErrorObservable.clear(),this.dispose()}))})),d)))})).catch((d=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(d),this._parent.onErrorObservable.clear(),this.dispose()),d}))}_loadData(d){if(this._gltf=d.json,this._setupData(),d.bin){const t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){const A=t[0];(A.byteLength<d.bin.byteLength-3||A.byteLength>d.bin.byteLength)&&P.e.Warn(`Binary buffer length (${A.byteLength}) from JSON does not match chunk length (${d.bin.byteLength})`),this._bin=d.bin}else P.e.Warn("Unexpected BIN chunk")}}_setupData(){if(C.Assign(this._gltf.accessors),C.Assign(this._gltf.animations),C.Assign(this._gltf.buffers),C.Assign(this._gltf.bufferViews),C.Assign(this._gltf.cameras),C.Assign(this._gltf.images),C.Assign(this._gltf.materials),C.Assign(this._gltf.meshes),C.Assign(this._gltf.nodes),C.Assign(this._gltf.samplers),C.Assign(this._gltf.scenes),C.Assign(this._gltf.skins),C.Assign(this._gltf.textures),this._gltf.nodes){const d={};for(const A of this._gltf.nodes)if(A.children)for(const t of A.children)d[t]=A.index;const t=this._createRootNode();for(const A of this._gltf.nodes){const w=d[A.index];A.parent=void 0===w?t:this._gltf.nodes[w]}}}async _loadExtensionsAsync(){const d=[];if(e.forEach(((t,A)=>{var w;!1===(null===(w=this.parent.extensionOptions[A])||void 0===w?void 0:w.enabled)?t.isGLTFExtension&&this.isExtensionUsed(A)&&P.e.Warn(`Extension ${A} is used but has been explicitly disabled.`):t.isGLTFExtension&&!this.isExtensionUsed(A)||d.push((async()=>{const d=await t.factory(this);return d.name!==A&&P.e.Warn(`The name of the glTF loader extension instance does not match the registered name: ${d.name} !== ${A}`),this._parent.onExtensionLoadedObservable.notifyObservers(d),d})())})),this._extensions.push(...await Promise.all(d)),this._extensions.sort(((d,t)=>(d.order||Number.MAX_VALUE)-(t.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const A of this._gltf.extensionsRequired){if(!this._extensions.some((d=>d.name===A&&d.enabled))){var t;if(!1===(null===(t=this.parent.extensionOptions[A])||void 0===t?void 0:t.enabled))throw new Error(`Required extension ${A} is disabled`);throw new Error(`Required extension ${A} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const d=new u.d("__root__",this._babylonScene);this._rootBabylonMesh=d,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.Mf(!1);const t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case s.e.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],E._LoadTransform(t,this._rootBabylonMesh));break;case s.e.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(d),t}loadSceneAsync(d,t){const A=this._extensionsLoadSceneAsync(d,t);if(A)return A;const w=new Array;if(this.logOpen(`${d} ${t.name||""}`),t.nodes)for(const N of t.nodes){const t=C.Get(`${d}/nodes/${N}`,this._gltf.nodes,N);w.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(d=>{d.parent=this._rootBabylonMesh})))}for(const N of this._postSceneLoadActions)N();return w.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(w).then((()=>{}))}_forEachPrimitive(d,t){if(d._primitiveBabylonMeshes)for(const A of d._primitiveBabylonMeshes)t(A)}_getGeometries(){const d=[],t=this._gltf.nodes;if(t)for(const A of t)this._forEachPrimitive(A,(t=>{const A=t.Aj;A&&-1===d.indexOf(A)&&d.push(A)}));return d}_getMeshes(){const d=[];this._rootBabylonMesh instanceof I.d&&d.push(this._rootBabylonMesh);const t=this._gltf.nodes;if(t)for(const A of t)this._forEachPrimitive(A,(t=>{d.push(t)}));return d}_getTransformNodes(){const d=[],t=this._gltf.nodes;if(t)for(const A of t)A._babylonTransformNode&&"tb"===A._babylonTransformNode.getClassName()&&d.push(A._babylonTransformNode),A._babylonTransformNodeForSkin&&d.push(A._babylonTransformNodeForSkin);return d}_getSkeletons(){const d=[],t=this._gltf.skins;if(t)for(const A of t)A._data&&d.push(A._data.babylonSkeleton);return d}_getAnimationGroups(){const d=[],t=this._gltf.animations;if(t)for(const A of t)A._babylonAnimationGroup&&d.push(A._babylonAnimationGroup);return d}_startAnimations(){switch(this._parent.animationStartMode){case s.c.NONE:break;case s.c.FIRST:{const d=this._getAnimationGroups();0!==d.length&&d[0].start(!0);break}case s.c.ALL:{const d=this._getAnimationGroups();for(const t of d)t.start(!0);break}default:return void P.e.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadNodeAsync(d,t,A);if(w)return w;if(t._babylonTransformNode)throw new Error(`${d}: Invalid recursive node hierarchy`);const N=new Array;this.logOpen(`${d} ${t.name||""}`);const p=w=>{if(E.AddPointerMetadata(w,d),E._LoadTransform(t,w),void 0!=t.camera){const A=C.Get(`${d}/camera`,this._gltf.cameras,t.camera);N.push(this.loadCameraAsync(`/cameras/${A.index}`,A,(d=>{d.parent=w})))}if(t.children)for(const A of t.children){const t=C.Get(`${d}/children/${A}`,this._gltf.nodes,A);N.push(this.loadNodeAsync(`/nodes/${t.index}`,t,(d=>{d.parent=w})))}A(w)},B=void 0!=t.mesh,X=this._parent.loadSkins&&void 0!=t.skin;if(!B||X){const d=t.name||`node${t.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new R.e(d,this._babylonScene);A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==t.mesh?t._babylonTransformNode=A:t._babylonTransformNodeForSkin=A,p(A)}if(B)if(X){const A=C.Get(`${d}/mesh`,this._gltf.meshes,t.mesh);N.push(this._loadMeshAsync(`/meshes/${A.index}`,t,A,(A=>{const w=t._babylonTransformNodeForSkin;A.metadata=o(w.metadata,A.metadata||{});const p=C.Get(`${d}/skin`,this._gltf.skins,t.skin);N.push(this._loadSkinAsync(`/skins/${p.index}`,t,p,(d=>{this._forEachPrimitive(t,(t=>{t.skeleton=d})),this._postSceneLoadActions.push((()=>{if(void 0!=p.skeleton){const d=C.Get(`/skins/${p.index}/skeleton`,this._gltf.nodes,p.skeleton).parent;t.index===d.index?A.parent=w.parent:A.parent=d._babylonTransformNode}else A.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:w,skinnedNode:A})}))})))})))}else{const A=C.Get(`${d}/mesh`,this._gltf.meshes,t.mesh);N.push(this._loadMeshAsync(`/meshes/${A.index}`,t,A,p))}return this.logClose(),Promise.all(N).then((()=>(this._forEachPrimitive(t,(d=>{d.Aj&&d.Aj.useBoundingInfoFromGeometry?d.Ea():d.refreshBoundingInfo(!0,!0)})),t._babylonTransformNode)))}_loadMeshAsync(d,t,A,w){const N=A.primitives;if(!N||!N.length)throw new Error(`${d}: Primitives are missing`);void 0==N[0].index&&C.Assign(N);const p=new Array;this.logOpen(`${d} ${A.name||""}`);const B=t.name||`node${t.index}`;if(1===N.length){const w=A.primitives[0];p.push(this._loadMeshPrimitiveAsync(`${d}/primitives/${w.index}`,B,t,A,w,(d=>{t._babylonTransformNode=d,t._primitiveBabylonMeshes=[d]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new R.e(B,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(const w of N)p.push(this._loadMeshPrimitiveAsync(`${d}/primitives/${w.index}`,`${B}_primitive${w.index}`,t,A,w,(d=>{d.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(d)})))}return w(t._babylonTransformNode),this.logClose(),Promise.all(p).then((()=>t._babylonTransformNode))}_loadMeshPrimitiveAsync(d,t,A,w,N,p){const B=this._extensionsLoadMeshPrimitiveAsync(d,t,A,w,N,p);if(B)return B;this.logOpen(`${d}`);const X=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==A.skin&&!w.primitives[0].targets;let W,a;if(X&&N._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,W=N._instanceData.babylonSourceMesh.qd(t),W._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a=N._instanceData.promise;else{const p=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new u.d(t,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.sideOrientation=this._babylonScene.useRightHandedSystem?T.c.CounterClockWiseSideOrientation:T.c.ClockWiseSideOrientation,this._createMorphTargets(d,A,w,N,B),p.push(this._loadVertexDataAsync(d,N,B).then((t=>this._loadMorphTargetsAsync(d,N,B,t).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,t.Ca(B),t._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const D=E._GetDrawMode(d,N.mode);if(void 0==N.material){let d=this._defaultBabylonMaterialData[D];d||(d=this._createDefaultMaterial("__GLTFLoader._default",D),this._parent.onMaterialLoadedObservable.notifyObservers(d),this._defaultBabylonMaterialData[D]=d),B.material=d}else if(!this.parent.skipMaterials){const t=C.Get(`${d}/material`,this._gltf.materials,N.material);p.push(this._loadMaterialAsync(`/materials/${t.index}`,t,B,D,(d=>{B.material=d})))}a=Promise.all(p),X&&(N._instanceData={babylonSourceMesh:B,promise:a}),W=B}return E.AddPointerMetadata(W,d),this._parent.onMeshLoadedObservable.notifyObservers(W),p(W),this.logClose(),a.then((()=>W))}_loadVertexDataAsync(d,t,A){const w=this._extensionsLoadVertexDataAsync(d,t,A);if(w)return w;const p=t.attributes;if(!p)throw new Error(`${d}: Attributes are missing`);const B=new Array,X=new L.c(A.name,this._babylonScene);if(void 0==t.indices)A.isUnIndexed=!0;else{const A=C.Get(`${d}/indices`,this._gltf.accessors,t.indices);B.push(this._loadIndicesAccessorAsync(`/accessors/${A.index}`,A).then((d=>{X.setIndices(d)})))}const W=(t,w,W)=>{if(void 0==p[t])return;A._delayInfo=A._delayInfo||[],-1===A._delayInfo.indexOf(w)&&A._delayInfo.push(w);const a=C.Get(`${d}/attributes/${t}`,this._gltf.accessors,p[t]);B.push(this._loadVertexAccessorAsync(`/accessors/${a.index}`,a,w).then((d=>{if(d.getKind()===Z.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!A.skeleton&&a.min&&a.max){const d=N.h.gb[0].wf(...a.min),t=N.h.gb[1].wf(...a.max);if(a.normalized&&5126!==a.componentType){let A=1;switch(a.componentType){case 5120:A=127;break;case 5121:A=255;break;case 5122:A=32767;break;case 5123:A=65535}const w=1/A;d.scaleInPlace(w),t.scaleInPlace(w)}X._boundingInfo=new r.b(d,t),X.useBoundingInfoFromGeometry=!0}X.setVerticesBuffer(d,a.count)}))),w==Z.f.MatricesIndicesExtraKind&&(A.numBoneInfluencers=8),W&&W(a)};return W("POSITION",Z.f.PositionKind),W("NORMAL",Z.f.NormalKind),W("TANGENT",Z.f.TangentKind),W("TEXCOORD_0",Z.f.UVKind),W("TEXCOORD_1",Z.f.UV2Kind),W("TEXCOORD_2",Z.f.UV3Kind),W("TEXCOORD_3",Z.f.UV4Kind),W("TEXCOORD_4",Z.f.UV5Kind),W("TEXCOORD_5",Z.f.UV6Kind),W("JOINTS_0",Z.f.MatricesIndicesKind),W("WEIGHTS_0",Z.f.MatricesWeightsKind),W("JOINTS_1",Z.f.MatricesIndicesExtraKind),W("WEIGHTS_1",Z.f.MatricesWeightsExtraKind),W("COLOR_0",Z.f.ColorKind,(d=>{"VEC4"===d.type&&(A.hasVertexAlpha=!0)})),Promise.all(B).then((()=>X))}_createMorphTargets(d,t,A,w,N){if(!w.targets||!this._parent.loadMorphTargets)return;if(void 0==t._numMorphTargets)t._numMorphTargets=w.targets.length;else if(w.targets.length!==t._numMorphTargets)throw new Error(`${d}: Primitives do not have the same number of targets`);const p=A.extras?A.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,N.morphTargetManager=new y(this._babylonScene),N.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,N.morphTargetManager.areUpdatesFrozen=!0;for(let B=0;B<w.targets.length;B++){const d=t.weights?t.weights[B]:A.weights?A.weights[B]:0,w=p?p[B]:`morphTarget${B}`;N.morphTargetManager.addTarget(new V(w,d,N.va()))}}_loadMorphTargetsAsync(d,t,A,w){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();const N=new Array,p=A.morphTargetManager;for(let B=0;B<p.numTargets;B++){const A=p.getTarget(B);N.push(this._loadMorphTargetVertexDataAsync(`${d}/targets/${B}`,w,t.targets[B],A))}return Promise.all(N).then((()=>{p.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(d,t,A,w){const N=new Array,p=(w,p,B)=>{if(void 0==A[w])return;const X=t.getVertexBuffer(p);if(!X)return;const W=C.Get(`${d}/${w}`,this._gltf.accessors,A[w]);N.push(this._loadFloatAccessorAsync(`/accessors/${W.index}`,W).then((d=>{B(X,d)})))};return p("POSITION",Z.f.PositionKind,((d,t)=>{const A=new Float32Array(t.length);d.forEach(t.length,((d,w)=>{A[w]=t[w]+d})),w.setPositions(A)})),p("NORMAL",Z.f.NormalKind,((d,t)=>{const A=new Float32Array(t.length);d.forEach(A.length,((d,w)=>{A[w]=t[w]+d})),w.setNormals(A)})),p("TANGENT",Z.f.TangentKind,((d,t)=>{const A=new Float32Array(t.length/3*4);let N=0;d.forEach(t.length/3*4,((d,w)=>{(w+1)%4!==0&&(A[N]=t[N]+d,N++)})),w.setTangents(A)})),Promise.all(N).then((()=>{}))}static _LoadTransform(d,t){if(void 0!=d.skin)return;let A=N.l.Zero(),w=N.f.Identity(),p=N.l.One();if(d.matrix){N.c.Lg(d.matrix).decompose(p,w,A)}else d.translation&&(A=N.l.Lg(d.translation)),d.rotation&&(w=N.f.Lg(d.rotation)),d.scale&&(p=N.l.Lg(d.scale));t.position=A,t.rotationQuaternion=w,t.Gf=p}_loadSkinAsync(d,t,A,w){if(!this._parent.loadSkins)return Promise.resolve();const N=this._extensionsLoadSkinAsync(d,t,A);if(N)return N;if(A._data)return w(A._data.babylonSkeleton),A._data.promise;const p=`skeleton${A.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new U(A.name||p,p,this._babylonScene);B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(d,A,B);const X=this._loadSkinInverseBindMatricesDataAsync(d,A).then((d=>{this._updateBoneMatrices(B,d)}));return A._data={babylonSkeleton:B,promise:X},w(B),X}_loadBones(d,t,A){if(void 0==t.skeleton||this._parent.alwaysComputeSkeletonRootNode){const A=this._findSkeletonRootNode(`${d}/joints`,t.joints);if(A)if(void 0===t.skeleton)t.skeleton=A.index;else{const w=(d,t)=>{for(;t.parent;t=t.parent)if(t.parent===d)return!0;return!1},N=C.Get(`${d}/skeleton`,this._gltf.nodes,t.skeleton);N===A||w(N,A)||(P.e.Warn(`${d}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),t.skeleton=A.index)}else P.e.Warn(`${d}: Failed to find common root`)}const w={};for(const N of t.joints){const p=C.Get(`${d}/joints/${N}`,this._gltf.nodes,N);this._loadBone(p,t,A,w)}}_findSkeletonRootNode(d,t){if(0===t.length)return null;const A={};for(const N of t){const t=[];let w=C.Get(`${d}/${N}`,this._gltf.nodes,N);for(;-1!==w.index;)t.unshift(w),w=w.parent;A[N]=t}let w=null;for(let N=0;;++N){let d=A[t[0]];if(N>=d.length)return w;const p=d[N];for(let B=1;B<t.length;++B)if(d=A[t[B]],N>=d.length||p!==d[N])return w;w=p}}_loadBone(d,t,A,w){d._isJoint=!0;let N=w[d.index];if(N)return N;let p=null;d.index!==t.skeleton&&(d.parent&&-1!==d.parent.index?p=this._loadBone(d.parent,t,A,w):void 0!==t.skeleton&&P.e.Warn(`/skins/${t.index}/skeleton: Skeleton node is not a common root`));const B=t.joints.indexOf(d.index);return N=new a.b(d.name||`joint${d.index}`,A,p,this._getNodeMatrix(d),null,null,B),w[d.index]=N,this._postSceneLoadActions.push((()=>{N.linkTransformNode(d._babylonTransformNode)})),N}_loadSkinInverseBindMatricesDataAsync(d,t){if(void 0==t.inverseBindMatrices)return Promise.resolve(null);const A=C.Get(`${d}/inverseBindMatrices`,this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${A.index}`,A)}_updateBoneMatrices(d,t){for(const A of d.bones){const d=N.c.Identity(),w=A._index;t&&-1!==w&&(N.c.FromArrayToRef(t,16*w,d),d.invertToRef(d));const p=A.getParent();p&&d.multiplyToRef(p.getAbsoluteInverseBindMatrix(),d),A.Fj(d,!1,!1),A._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(d){return d.matrix?N.c.Lg(d.matrix):N.c.Compose(d.scale?N.l.Lg(d.scale):N.l.One(),d.rotation?N.f.Lg(d.rotation):N.f.Identity(),d.translation?N.l.Lg(d.translation):N.l.Zero())}loadCameraAsync(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadCameraAsync(d,t,A);if(w)return w;const p=new Array;this.logOpen(`${d} ${t.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const B=new W.c(t.name||`camera${t.index}`,N.l.Zero(),this._babylonScene,!1);switch(B._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,B.ignoreParentScaling=!0,t._babylonCamera=B,B.rotation.set(0,Math.PI,0),t.type){case"perspective":{const A=t.perspective;if(!A)throw new Error(`${d}: Camera perspective properties are missing`);B.fov=A.yfov,B.Ui=A.znear,B.maxZ=A.zfar||0;break}case"orthographic":if(!t.orthographic)throw new Error(`${d}: Camera orthographic properties are missing`);B.mode=X.d.ORTHOGRAPHIC_CAMERA,B.orthoLeft=-t.orthographic.xmag,B.orthoRight=t.orthographic.xmag,B.orthoBottom=-t.orthographic.ymag,B.orthoTop=t.orthographic.ymag,B.Ui=t.orthographic.znear,B.maxZ=t.orthographic.zfar;break;default:throw new Error(`${d}: Invalid camera type (${t.type})`)}return E.AddPointerMetadata(B,d),this._parent.onCameraLoadedObservable.notifyObservers(B),A(B),this.logClose(),Promise.all(p).then((()=>B))}_loadAnimationsAsync(){const d=this._gltf.animations;if(!d)return Promise.resolve();const t=new Array;for(let A=0;A<d.length;A++){const w=d[A];t.push(this.loadAnimationAsync(`/animations/${w.index}`,w).then((d=>{0===d.targetedAnimations.length&&d.dispose()})))}return Promise.all(t).then((()=>{}))}loadAnimationAsync(d,t){const w=this._extensionsLoadAnimationAsync(d,t);return w||A.e(38).then(A.bind(A,13265)).then((A=>{let{AnimationGroup:w}=A;this._babylonScene._blockEntityCollection=!!this._assetContainer;const N=new w(t.name||`animation${t.index}`,this._babylonScene);N._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=N;const p=new Array;C.Assign(t.channels),C.Assign(t.samplers);for(const B of t.channels)p.push(this._loadAnimationChannelAsync(`${d}/channels/${B.index}`,d,t,B,((d,t)=>{d.animations=d.animations||[],d.animations.push(t),N.addTargetedAnimation(t,d)})));return Promise.all(p).then((()=>(N.normalize(0),N)))}))}_loadAnimationChannelAsync(d,t,A,w,N){const p=this._extensionsLoadAnimationChannelAsync(d,t,A,w,N);if(p)return p;if(void 0==w.target.node)return Promise.resolve();const B=C.Get(`${d}/target/node`,this._gltf.nodes,w.target.node),X=w.target.path,W="weights"===X;if(W&&!B._numMorphTargets||!W&&!B._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!W&&!B._isJoint)return Promise.resolve();let a;switch(X){case"translation":a=z.translation;break;case"rotation":a=z.rotation;break;case"scale":a=z.scale;break;case"weights":a=z.weights;break;default:throw new Error(`${d}/target/path: Invalid value (${w.target.path})`)}const D={object:B,info:a};return this._loadAnimationChannelFromTargetInfoAsync(d,t,A,w,D,N)}_loadAnimationChannelFromTargetInfoAsync(d,t,A,w,N,p){const B=this.parent.targetFps,X=1/B,W=C.Get(`${d}/sampler`,A.samplers,w.sampler);return this._loadAnimationSamplerAsync(`${t}/samplers/${w.sampler}`,W).then((d=>{let t=0;const W=N.object,a=N.info;for(const N of a){const a=N.getStride(W),D=d.input,i=d.output,k=new Array(D.length);let b=0;switch(d.interpolation){case"STEP":for(let d=0;d<D.length;d++){const t=N.getValue(W,i,b,1);b+=a,k[d]={frame:D[d]*B,value:t,interpolation:1}}break;case"CUBICSPLINE":for(let d=0;d<D.length;d++){const t=N.getValue(W,i,b,X);b+=a;const A=N.getValue(W,i,b,1);b+=a;const w=N.getValue(W,i,b,X);b+=a,k[d]={frame:D[d]*B,inTangent:t,value:A,outTangent:w}}break;case"LINEAR":for(let d=0;d<D.length;d++){const t=N.getValue(W,i,b,1);b+=a,k[d]={frame:D[d]*B,value:t}}}if(b>0){const d=`${A.name||`animation${A.index}`}_channel${w.index}_${t}`;N.buildAnimations(W,d,B,k,((d,A)=>{++t,p(d,A)}))}}}))}_loadAnimationSamplerAsync(d,t){if(t._data)return t._data;const A=t.interpolation||"LINEAR";switch(A){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${d}/interpolation: Invalid value (${t.interpolation})`)}const w=C.Get(`${d}/input`,this._gltf.accessors,t.input),N=C.Get(`${d}/output`,this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${w.index}`,w),this._loadFloatAccessorAsync(`/accessors/${N.index}`,N)]).then((d=>{let[t,w]=d;return{input:t,interpolation:A,output:w}})),t._data}loadBufferAsync(d,t,A,w){const N=this._extensionsLoadBufferAsync(d,t,A,w);if(N)return N;if(!t._data)if(t.uri)t._data=this.loadUriAsync(`${d}/uri`,t,t.uri);else{if(!this._bin)throw new Error(`${d}: Uri is missing or the binary glTF is missing its binary chunk`);t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then((t=>{try{return new Uint8Array(t.buffer,t.byteOffset+A,w)}catch(N){throw new Error(`${d}: ${N.message}`)}}))}loadBufferViewAsync(d,t){const A=this._extensionsLoadBufferViewAsync(d,t);if(A)return A;if(t._data)return t._data;const w=C.Get(`${d}/buffer`,this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync(`/buffers/${w.index}`,w,t.byteOffset||0,t.byteLength),t._data}_loadAccessorAsync(d,t,A){if(t._data)return t._data;const w=E._GetNumComponents(d,t.type),N=w*Z.f.GetTypeByteLength(t.componentType),p=w*t.count;if(void 0==t.bufferView)t._data=Promise.resolve(new A(p));else{const B=C.Get(`${d}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${B.index}`,B).then((X=>{if(5126!==t.componentType||t.normalized||B.byteStride&&B.byteStride!==N){const d=new A(p);return Z.f.ForEach(X,t.byteOffset||0,B.byteStride||N,w,t.componentType,d.length,t.normalized||!1,((t,A)=>{d[A]=t})),d}return E._GetTypedArray(d,t.componentType,X,t.byteOffset,p)}))}if(t.sparse){const p=t.sparse;t._data=t._data.then((B=>{const X=B,W=C.Get(`${d}/sparse/indices/bufferView`,this._gltf.bufferViews,p.indices.bufferView),a=C.Get(`${d}/sparse/values/bufferView`,this._gltf.bufferViews,p.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${W.index}`,W),this.loadBufferViewAsync(`/bufferViews/${a.index}`,a)]).then((B=>{let[W,a]=B;const D=E._GetTypedArray(`${d}/sparse/indices`,p.indices.componentType,W,p.indices.byteOffset,p.count),i=w*p.count;let k;if(5126!==t.componentType||t.normalized){const B=E._GetTypedArray(`${d}/sparse/values`,t.componentType,a,p.values.byteOffset,i);k=new A(i),Z.f.ForEach(B,0,N,w,t.componentType,k.length,t.normalized||!1,((d,t)=>{k[t]=d}))}else k=E._GetTypedArray(`${d}/sparse/values`,t.componentType,a,p.values.byteOffset,i);let b=0;for(let d=0;d<D.length;d++){let t=D[d]*w;for(let d=0;d<w;d++)X[t++]=k[b++]}return X}))}))}return t._data}_loadFloatAccessorAsync(d,t){return this._loadAccessorAsync(d,t,Float32Array)}_loadIndicesAccessorAsync(d,t){if("SCALAR"!==t.type)throw new Error(`${d}/type: Invalid value ${t.type}`);if(5121!==t.componentType&&5123!==t.componentType&&5125!==t.componentType)throw new Error(`${d}/componentType: Invalid value ${t.componentType}`);if(t._data)return t._data;if(t.sparse){const A=E._GetTypedArrayConstructor(`${d}/componentType`,t.componentType);t._data=this._loadAccessorAsync(d,t,A)}else{const A=C.Get(`${d}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A).then((A=>E._GetTypedArray(d,t.componentType,A,t.byteOffset,t.count)))}return t._data}_loadVertexBufferViewAsync(d){if(d._babylonBuffer)return d._babylonBuffer;const t=this._babylonScene.getEngine();return d._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${d.index}`,d).then((d=>new Z.d(t,d,!1))),d._babylonBuffer}_loadVertexAccessorAsync(d,t,A){var w;if(null!==(w=t._babylonVertexBuffer)&&void 0!==w&&w[A])return t._babylonVertexBuffer[A];t._babylonVertexBuffer||(t._babylonVertexBuffer={});const N=this._babylonScene.getEngine();if(t.sparse||void 0==t.bufferView)t._babylonVertexBuffer[A]=this._loadFloatAccessorAsync(d,t).then((d=>new Z.f(N,d,A,!1)));else{const w=C.Get(`${d}/bufferView`,this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer[A]=this._loadVertexBufferViewAsync(w).then((p=>{const B=E._GetNumComponents(d,t.type);return new Z.f(N,p,A,!1,void 0,w.byteStride,void 0,t.byteOffset,B,t.componentType,t.normalized,!0,void 0,!0)}))}return t._babylonVertexBuffer[A]}_loadMaterialMetallicRoughnessPropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;return t&&(t.baseColorFactor?(A.albedoColor=p.e.Lg(t.baseColorFactor),A.alpha=t.baseColorFactor[3]):A.albedoColor=p.e.White(),A.metallic=void 0==t.metallicFactor?1:t.metallicFactor,A.roughness=void 0==t.roughnessFactor?1:t.roughnessFactor,t.baseColorTexture&&w.push(this.loadTextureInfoAsync(`${d}/baseColorTexture`,t.baseColorTexture,(d=>{d.name=`${A.name} (Base Color)`,A.albedoTexture=d}))),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${d}/metallicRoughnessTexture`,t.metallicRoughnessTexture,(d=>{d.name=`${A.name} (Metallic Roughness)`,A.metallicTexture=d}))),A.useMetallnessFromMetallicTextureBlue=!0,A.useRoughnessFromMetallicTextureGreen=!0,A.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(w).then((()=>{}))}_loadMaterialAsync(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const p=this._extensionsLoadMaterialAsync(d,t,A,w,N);if(p)return p;t._data=t._data||{};let B=t._data[w];if(!B){this.logOpen(`${d} ${t.name||""}`);const A=this.createMaterial(d,t,w);B={babylonMaterial:A,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(d,t,A)},t._data[w]=B,E.AddPointerMetadata(A,d),this._parent.onMaterialLoadedObservable.notifyObservers(A),this.logClose()}return A&&(B.babylonMeshes.push(A),A.hj.addOnce((()=>{const d=B.babylonMeshes.indexOf(A);-1!==d&&B.babylonMeshes.splice(d,1)}))),N(B.babylonMaterial),B.promise.then((()=>B.babylonMaterial))}_createDefaultMaterial(d,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;const A=new j(d,this._babylonScene);return A._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,A.fillMode=t,A.enableSpecularAntiAliasing=!0,A.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,A.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,A.transparencyMode=j.PBRMATERIAL_OPAQUE,A.metallic=1,A.roughness=1,A}createMaterial(d,t,A){const w=this._extensionsCreateMaterial(d,t,A);if(w)return w;const N=t.name||`material${t.index}`;return this._createDefaultMaterial(N,A)}loadMaterialPropertiesAsync(d,t,A){const w=this._extensionsLoadMaterialPropertiesAsync(d,t,A);if(w)return w;const N=new Array;return N.push(this.loadMaterialBasePropertiesAsync(d,t,A)),t.pbrMetallicRoughness&&N.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${d}/pbrMetallicRoughness`,t.pbrMetallicRoughness,A)),this.loadMaterialAlphaProperties(d,t,A),Promise.all(N).then((()=>{}))}loadMaterialBasePropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;return A.emissiveColor=t.emissiveFactor?p.e.Lg(t.emissiveFactor):new p.e(0,0,0),t.doubleSided&&(A.Tg=!1,A.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${d}/normalTexture`,t.normalTexture,(d=>{d.name=`${A.name} (Normal)`,A.bumpTexture=d}))),A.invertNormalMapX=!this._babylonScene.useRightHandedSystem,A.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=t.normalTexture.scale&&A.bumpTexture&&(A.bumpTexture.level=t.normalTexture.scale),A.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,w.push(this.loadTextureInfoAsync(`${d}/occlusionTexture`,t.occlusionTexture,(d=>{d.name=`${A.name} (Occlusion)`,A.ambientTexture=d}))),A.useAmbientInGrayScale=!0,void 0!=t.occlusionTexture.strength&&(A.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&w.push(this.loadTextureInfoAsync(`${d}/emissiveTexture`,t.emissiveTexture,(d=>{d.name=`${A.name} (Emissive)`,A.emissiveTexture=d}))),Promise.all(w).then((()=>{}))}loadMaterialAlphaProperties(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);switch(t.alphaMode||"OPAQUE"){case"OPAQUE":A.transparencyMode=j.PBRMATERIAL_OPAQUE,A.alpha=1;break;case"MASK":A.transparencyMode=j.PBRMATERIAL_ALPHATEST,A.alphaCutOff=void 0==t.alphaCutoff?.5:t.alphaCutoff,A.albedoTexture&&(A.albedoTexture.uc=!0);break;case"BLEND":A.transparencyMode=j.PBRMATERIAL_ALPHABLEND,A.albedoTexture&&(A.albedoTexture.uc=!0,A.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${d}/alphaMode: Invalid value (${t.alphaMode})`)}}loadTextureInfoAsync(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadTextureInfoAsync(d,t,A);if(w)return w;if(this.logOpen(`${d}`),t.texCoord>=6)throw new Error(`${d}/texCoord: Invalid value (${t.texCoord})`);const N=C.Get(`${d}/index`,this._gltf.textures,t.index);N._textureInfo=t;const p=this._loadTextureAsync(`/textures/${t.index}`,N,(w=>{w.coordinatesIndex=t.texCoord||0,E.AddPointerMetadata(w,d),this._parent.onTextureLoadedObservable.notifyObservers(w),A(w)}));return this.logClose(),p}_loadTextureAsync(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const w=this._extensionsLoadTextureAsync(d,t,A);if(w)return w;this.logOpen(`${d} ${t.name||""}`);const N=void 0==t.sampler?E.DefaultSampler:C.Get(`${d}/sampler`,this._gltf.samplers,t.sampler),p=C.Get(`${d}/source`,this._gltf.images,t.source),B=this._createTextureAsync(d,N,p,A,void 0,!t._textureInfo.nonColorData);return this.logClose(),B}_createTextureAsync(d,t,A){let N=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},p=arguments.length>4?arguments[4]:void 0,B=arguments.length>5?arguments[5]:void 0;const X=this._loadSampler(`/samplers/${t.index}`,t),W=new Array,a=new w;this._babylonScene._blockEntityCollection=!!this._assetContainer;const D={noMipmap:X.noMipMaps,invertY:!1,samplingMode:X.samplingMode,X:()=>{this._disposed||a.resolve()},onError:(t,A)=>{this._disposed||a.reject(new Error(`${d}: ${A&&A.message?A.message:t||"Failed to load texture"}`))},mimeType:A.mimeType,loaderOptions:p,useSRGBBuffer:!!B&&this._parent.useSRGBBuffers},i=new n.c(null,this._babylonScene,D);return i._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,W.push(a.promise),W.push(this.loadImageAsync(`/images/${A.index}`,A).then((d=>{const t=A.uri||`${this._fileName}#image${A.index}`,w=`data:${this._uniqueRootUrl}${t}`;i.updateURL(w,d);const N=i.getInternalTexture();N&&(N.label=A.name)}))),i.wrapU=X.wrapU,i.wrapV=X.wrapV,N(i),this._parent.useGltfTextureNames&&(i.name=A.name||A.uri||`image${A.index}`),Promise.all(W).then((()=>i))}_loadSampler(d,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:E._GetTextureSamplingMode(d,t),wrapU:E._GetTextureWrapMode(`${d}/wrapS`,t.wrapS),wrapV:E._GetTextureWrapMode(`${d}/wrapT`,t.wrapT)}),t._data}loadImageAsync(d,t){if(!t._data){if(this.logOpen(`${d} ${t.name||""}`),t.uri)t._data=this.loadUriAsync(`${d}/uri`,t,t.uri);else{const A=C.Get(`${d}/bufferView`,this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync(`/bufferViews/${A.index}`,A)}this.logClose()}return t._data}loadUriAsync(d,t,A){const w=this._extensionsLoadUriAsync(d,t,A);if(w)return w;if(!E._ValidateUri(A))throw new Error(`${d}: '${A}' is invalid`);if((0,Y.g)(A)){const t=new Uint8Array((0,Y.b)(A));return this.log(`${d}: Decoded ${A.substring(0,64)}... (${t.length} bytes)`),Promise.resolve(t)}return this.log(`${d}: Loading ${A}`),this._parent.preprocessUrlAsync(this._rootUrl+A).then((t=>new Promise(((w,N)=>{this._parent._loadFile(this._babylonScene,t,(t=>{this._disposed||(this.log(`${d}: Loaded ${A} (${t.byteLength} bytes)`),w(new Uint8Array(t)))}),!0,(t=>{N(new Y.i(`${d}: Failed to load '${A}'${t?": "+t.status+" "+t.statusText:""}`,t))}))}))))}static AddPointerMetadata(d,t){d.metadata=d.metadata||{};const A=d._internalMetadata=d._internalMetadata||{},w=A.Mi=A.Mi||{};(w.pointers=w.pointers||[]).push(t)}static _GetTextureWrapMode(d,t){switch(t=void 0==t?10497:t){case 33071:return n.c.CLAMP_ADDRESSMODE;case 33648:return n.c.MIRROR_ADDRESSMODE;case 10497:return n.c.WRAP_ADDRESSMODE;default:return P.e.Warn(`${d}: Invalid value (${t})`),n.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(d,t){const A=void 0==t.magFilter?9729:t.magFilter,w=void 0==t.minFilter?9987:t.minFilter;if(9729===A)switch(w){case 9728:return n.c.LINEAR_NEAREST;case 9729:return n.c.LINEAR_LINEAR;case 9984:return n.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return n.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return n.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return n.c.LINEAR_LINEAR_MIPLINEAR;default:return P.e.Warn(`${d}/minFilter: Invalid value (${w})`),n.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==A&&P.e.Warn(`${d}/magFilter: Invalid value (${A})`),w){case 9728:return n.c.NEAREST_NEAREST;case 9729:return n.c.NEAREST_LINEAR;case 9984:return n.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return n.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return n.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return n.c.NEAREST_LINEAR_MIPLINEAR;default:return P.e.Warn(`${d}/minFilter: Invalid value (${w})`),n.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(d,t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${d}: Invalid component type ${t}`)}}static _GetTypedArray(d,t,A,w,N){const p=A.buffer;w=A.byteOffset+(w||0);const B=E._GetTypedArrayConstructor(`${d}/componentType`,t),X=Z.f.GetTypeByteLength(t);return w%X!==0?(P.e.Warn(`${d}: Copying buffer as byte offset (${w}) is not a multiple of component type byte length (${X})`),new B(p.slice(w,w+N*X),0)):new B(p,w,N)}static _GetNumComponents(d,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${d}: Invalid type (${t})`)}static _ValidateUri(d){return B.g.IsBase64(d)||-1===d.indexOf("..")}static _GetDrawMode(d,t){switch(void 0==t&&(t=4),t){case 0:return T.c.PointListDrawMode;case 1:return T.c.LineListDrawMode;case 2:return T.c.LineLoopDrawMode;case 3:return T.c.LineStripDrawMode;case 4:return T.c.TriangleFillMode;case 5:return T.c.TriangleStripDrawMode;case 6:return T.c.TriangleFanDrawMode}throw new Error(`${d}: Invalid mesh primitive mode (${t})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const d=new Array;if(this._gltf.materials)for(const t of this._gltf.materials)if(t._data)for(const A in t._data){const w=t._data[A];for(const t of w.babylonMeshes){t.Nj(!0);const A=w.babylonMaterial;d.push(A.forceCompilationAsync(t)),d.push(A.forceCompilationAsync(t,{useInstances:!0})),this._parent.useClipPlane&&(d.push(A.forceCompilationAsync(t,{clipPlane:!0})),d.push(A.forceCompilationAsync(t,{clipPlane:!0,useInstances:!0})))}}return Promise.all(d).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const d=new Array,t=this._babylonScene.lights;for(const A of t){const t=A.getShadowGenerator();t&&d.push(t.forceCompilationAsync())}return Promise.all(d).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(d){for(const t of this._extensions)t.enabled&&d(t)}_applyExtensions(d,t,A){for(const w of this._extensions)if(w.enabled){const N=`${w.name}.${t}`,p=d;p._activeLoaderExtensionFunctions=p._activeLoaderExtensionFunctions||{};const B=p._activeLoaderExtensionFunctions;if(!B[N]){B[N]=!0;try{const d=A(w);if(d)return d}finally{delete B[N]}}}return null}_extensionsOnLoading(){this._forEachExtensions((d=>d.onLoading&&d.onLoading()))}_extensionsOnReady(){this._forEachExtensions((d=>d.onReady&&d.onReady()))}_extensionsLoadSceneAsync(d,t){return this._applyExtensions(t,"loadScene",(A=>A.loadSceneAsync&&A.loadSceneAsync(d,t)))}_extensionsLoadNodeAsync(d,t,A){return this._applyExtensions(t,"loadNode",(w=>w.loadNodeAsync&&w.loadNodeAsync(d,t,A)))}_extensionsLoadCameraAsync(d,t,A){return this._applyExtensions(t,"loadCamera",(w=>w.loadCameraAsync&&w.loadCameraAsync(d,t,A)))}_extensionsLoadVertexDataAsync(d,t,A){return this._applyExtensions(t,"loadVertexData",(w=>w._loadVertexDataAsync&&w._loadVertexDataAsync(d,t,A)))}_extensionsLoadMeshPrimitiveAsync(d,t,A,w,N,p){return this._applyExtensions(N,"loadMeshPrimitive",(B=>B._loadMeshPrimitiveAsync&&B._loadMeshPrimitiveAsync(d,t,A,w,N,p)))}_extensionsLoadMaterialAsync(d,t,A,w,N){return this._applyExtensions(t,"loadMaterial",(p=>p._loadMaterialAsync&&p._loadMaterialAsync(d,t,A,w,N)))}_extensionsCreateMaterial(d,t,A){return this._applyExtensions(t,"createMaterial",(w=>w.createMaterial&&w.createMaterial(d,t,A)))}_extensionsLoadMaterialPropertiesAsync(d,t,A){return this._applyExtensions(t,"loadMaterialProperties",(w=>w.loadMaterialPropertiesAsync&&w.loadMaterialPropertiesAsync(d,t,A)))}_extensionsLoadTextureInfoAsync(d,t,A){return this._applyExtensions(t,"loadTextureInfo",(w=>w.loadTextureInfoAsync&&w.loadTextureInfoAsync(d,t,A)))}_extensionsLoadTextureAsync(d,t,A){return this._applyExtensions(t,"loadTexture",(w=>w._loadTextureAsync&&w._loadTextureAsync(d,t,A)))}_extensionsLoadAnimationAsync(d,t){return this._applyExtensions(t,"loadAnimation",(A=>A.loadAnimationAsync&&A.loadAnimationAsync(d,t)))}_extensionsLoadAnimationChannelAsync(d,t,A,w,N){return this._applyExtensions(A,"loadAnimationChannel",(p=>p._loadAnimationChannelAsync&&p._loadAnimationChannelAsync(d,t,A,w,N)))}_extensionsLoadSkinAsync(d,t,A){return this._applyExtensions(A,"loadSkin",(w=>w._loadSkinAsync&&w._loadSkinAsync(d,t,A)))}_extensionsLoadUriAsync(d,t,A){return this._applyExtensions(t,"loadUri",(w=>w._loadUriAsync&&w._loadUriAsync(d,t,A)))}_extensionsLoadBufferViewAsync(d,t){return this._applyExtensions(t,"loadBufferView",(A=>A.loadBufferViewAsync&&A.loadBufferViewAsync(d,t)))}_extensionsLoadBufferAsync(d,t,A,w){return this._applyExtensions(t,"loadBuffer",(N=>N.loadBufferAsync&&N.loadBufferAsync(d,t,A,w)))}static LoadExtensionAsync(d,t,A,w){if(!t.extensions)return null;const N=t.extensions[A];return N?w(`${d}/extensions/${A}`,N):null}static LoadExtraAsync(d,t,A,w){if(!t.extras)return null;const N=t.extras[A];return N?w(`${d}/extras/${A}`,N):null}isExtensionUsed(d){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(d)}logOpen(d){this._parent._logOpen(d)}logClose(){this._parent._logClose()}log(d){this._parent._log(d)}startPerformanceCounter(d){this._parent._startPerformanceCounter(d)}endPerformanceCounter(d){this._parent._endPerformanceCounter(d)}}E.DefaultSampler={index:-1},s.b._CreateGLTF2Loader=d=>new E(d);var g=A(11541),S=A(12076),dd=A(12083);class td extends dd.e{constructor(d,t,A){let w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,p=arguments.length>5&&void 0!==arguments[5]&&arguments[5],B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,W=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",d),this._texture=d.getEngine().createRawCubeTexture(t,A,w,N,p,B,X,W)}update(d,t,A,w){let N=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,d,t,A,w,N)}updateRGBDAsync(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,S.j)(this._texture,d,t,A,w).then((()=>{}))}clone(){return m.d.Clone((()=>{const d=this.va(),t=this._texture,A=new td(d,t._bufferViewArray,t.width,t.format,t.type,t.generateMipMaps,t.invertY,t.samplingMode,t._compression);return 13===t.source&&A.updateRGBDAsync(t._bufferViewArrayArray,t._sphericalPolynomial,t._lodGenerationScale,t._lodGenerationOffset),A}),this)}}const Ad="EXT_lights_image_based";class wd{constructor(d){this.name=Ad,this._loader=d,this.enabled=this._loader.isExtensionUsed(Ad)}dispose(){this._loader=null,delete this._lights}onLoading(){const d=this._loader.Mi.extensions;if(d&&d[this.name]){const t=d[this.name];this._lights=t.lights}}loadSceneAsync(d,t){return E.LoadExtensionAsync(d,t,this.name,((A,w)=>{this._loader._allMaterialsDirtyRequired=!0;const N=new Array;N.push(this._loader.loadSceneAsync(d,t)),this._loader.logOpen(`${A}`);const p=C.Get(`${A}/light`,this._lights,w.fb);return N.push(this._loadLightAsync(`/extensions/${this.name}/lights/${w.fb}`,p).then((d=>{this._loader.babylonScene.environmentTexture=d}))),this._loader.logClose(),Promise.all(N).then((()=>{}))}))}_loadLightAsync(d,t){if(!t._loaded){const A=new Array;this._loader.logOpen(`${d}`);const w=new Array(t.specularImages.length);for(let N=0;N<t.specularImages.length;N++){const p=t.specularImages[N];w[N]=new Array(p.length);for(let t=0;t<p.length;t++){const B=`${d}/specularImages/${N}/${t}`;this._loader.logOpen(`${B}`);const X=p[t],W=C.Get(B,this._loader.Mi.images,X);A.push(this._loader.loadImageAsync(`/images/${X}`,W).then((d=>{w[N][t]=d}))),this._loader.logClose()}}this._loader.logClose(),t._loaded=Promise.all(A).then((()=>{const A=new td(this._loader.babylonScene,null,t.specularImageSize);if(A.name=t.name||"environment",t._babylonTexture=A,void 0!=t.Yi&&(A.level=t.Yi),t.rotation){let d=N.f.Lg(t.rotation);this._loader.babylonScene.useRightHandedSystem||(d=N.f.Inverse(d)),N.c.FromQuaternionToRef(d,A.getReflectionTextureMatrix())}if(!t.irradianceCoefficients)throw new Error(`${d}: Irradiance coefficients are missing`);const p=g.c.Lg(t.irradianceCoefficients);p.scaleInPlace(t.Yi),p.convertIrradianceToLambertianRadiance();const B=g.f.FromHarmonics(p),X=(w.length-1)/Math.log2(t.specularImageSize);return A.updateRGBDAsync(w,B,X)}))}return t._loaded.then((()=>t._babylonTexture))}}x(Ad),M(Ad,!0,(d=>new wd(d)));A(12092);const Nd="EXT_mesh_gpu_instancing";class pd{constructor(d){this.name=Nd,this._loader=d,this.enabled=this._loader.isExtensionUsed(Nd)}dispose(){this._loader=null}loadNodeAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((d,w)=>{this._loader._disableInstancedMesh++;const p=this._loader.loadNodeAsync(`/nodes/${t.index}`,t,A);if(this._loader._disableInstancedMesh--,!t._primitiveBabylonMeshes)return p;const B=new Array;let X=0;const W=t=>{if(void 0==w.attributes[t])return void B.push(Promise.resolve(null));const A=C.Get(`${d}/attributes/${t}`,this._loader.Mi.accessors,w.attributes[t]);if(B.push(this._loader._loadFloatAccessorAsync(`/accessors/${A.bufferView}`,A)),0===X)X=A.count;else if(X!==A.count)throw new Error(`${d}/attributes: Instance buffer accessors do not have the same count.`)};return W("TRANSLATION"),W("ROTATION"),W("SCALE"),p.then((d=>Promise.all(B).then((A=>{let[w,p,B]=A;const W=new Float32Array(16*X);N.h.gb[0].wf(0,0,0),N.h.Quaternion[0].wf(0,0,0,1),N.h.gb[1].wf(1,1,1);for(let d=0;d<X;++d)w&&N.l.FromArrayToRef(w,3*d,N.h.gb[0]),p&&N.f.FromArrayToRef(p,4*d,N.h.Quaternion[0]),B&&N.l.FromArrayToRef(B,3*d,N.h.gb[1]),N.c.ComposeToRef(N.h.gb[1],N.h.Quaternion[0],N.h.gb[0],N.h.Matrix[0]),N.h.Matrix[0].copyToArray(W,16*d);for(const d of t._primitiveBabylonMeshes)d.Rj("matrix",W,16,!0);return d}))))}))}}x(Nd),M(Nd,!0,(d=>new pd(d)));class Bd{static get Default(){return Bd._Default||(Bd._Default=new Bd),Bd._Default}constructor(){const d=Bd.Configuration.decoder;this._decoderModulePromise=B.g.LoadBabylonScriptAsync(d.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(d,t,A,w,N){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const p=await MeshoptDecoder.decodeGltfBufferAsync(t,A,d,w,N);return MeshoptDecoder.useWorkers(0),p}))}}Bd.Configuration={decoder:{url:`${B.g._DefaultCdnUrl}/meshopt_decoder.js`}},Bd._Default=null;const Xd="EXT_meshopt_compression";class Wd{constructor(d){this.name=Xd,this.enabled=d.isExtensionUsed(Xd),this._loader=d}dispose(){this._loader=null}loadBufferViewAsync(d,t){return E.LoadExtensionAsync(d,t,this.name,((A,w)=>{const N=t;if(N._meshOptData)return N._meshOptData;const p=C.Get(`${d}/buffer`,this._loader.Mi.buffers,w.buffer);return N._meshOptData=this._loader.loadBufferAsync(`/buffers/${p.index}`,p,w.byteOffset||0,w.byteLength).then((d=>Bd.Default.decodeGltfBufferAsync(d,w.count,w.byteStride,w.mode,w.filter))),N._meshOptData}))}}x(Xd),M(Xd,!0,(d=>new Wd(d)));const ad="EXT_texture_webp";class Dd{constructor(d){this.name=ad,this._loader=d,this.enabled=d.isExtensionUsed(ad)}dispose(){this._loader=null}_loadTextureAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=void 0==t.sampler?E.DefaultSampler:C.Get(`${d}/sampler`,this._loader.Mi.samplers,t.sampler),B=C.Get(`${w}/source`,this._loader.Mi.images,N.source);return this._loader._createTextureAsync(d,p,B,(d=>{A(d)}),void 0,!t._textureInfo.nonColorData)}))}}x(ad),M(ad,!0,(d=>new Dd(d)));const id="EXT_texture_avif";class kd{constructor(d){this.name=id,this._loader=d,this.enabled=d.isExtensionUsed(id)}dispose(){this._loader=null}_loadTextureAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=void 0==t.sampler?E.DefaultSampler:C.Get(`${d}/sampler`,this._loader.Mi.samplers,t.sampler),B=C.Get(`${w}/source`,this._loader.Mi.images,N.source);return this._loader._createTextureAsync(d,p,B,(d=>{A(d)}),void 0,!t._textureInfo.nonColorData)}))}}x(id),M(id,!0,(d=>new kd(d)));var bd=A(12099);const Qd="KHR_draco_mesh_compression";class Pd{constructor(d){this.name=Qd,this.useNormalizedFlagFromAccessor=!0,this._loader=d,this.enabled=bd.d.DecoderAvailable&&this._loader.isExtensionUsed(Qd)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{if(void 0!=t.mode&&4!==t.mode&&5!==t.mode)throw new Error(`${d}: Unsupported mode ${t.mode}`);const p={},B={},X=(d,w)=>{const X=N.attributes[d];if(void 0!=X&&(A._delayInfo=A._delayInfo||[],-1===A._delayInfo.indexOf(w)&&A._delayInfo.push(w),p[w]=X,this.useNormalizedFlagFromAccessor)){const A=C.TryGet(this._loader.Mi.accessors,t.attributes[d]);A&&(B[w]=A.normalized||!1)}};X("POSITION",Z.f.PositionKind),X("NORMAL",Z.f.NormalKind),X("TANGENT",Z.f.TangentKind),X("TEXCOORD_0",Z.f.UVKind),X("TEXCOORD_1",Z.f.UV2Kind),X("TEXCOORD_2",Z.f.UV3Kind),X("TEXCOORD_3",Z.f.UV4Kind),X("TEXCOORD_4",Z.f.UV5Kind),X("TEXCOORD_5",Z.f.UV6Kind),X("JOINTS_0",Z.f.MatricesIndicesKind),X("WEIGHTS_0",Z.f.MatricesWeightsKind),X("COLOR_0",Z.f.ColorKind);const W=C.Get(w,this._loader.Mi.bufferViews,N.bufferView);return W._dracoBabylonGeometry||(W._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${W.index}`,W).then((t=>(this.dracoCompression||bd.d.Default)._decodeMeshToGeometryForGltfAsync(A.name,this._loader.babylonScene,t,p,B).catch((t=>{throw new Error(`${d}: ${t.message}`)}))))),W._dracoBabylonGeometry}))}}x(Qd),M(Qd,!0,(d=>new Pd(d)));var Jd=A(12107),Ud=A(11326),Td=A(12069),Fd=A(12114);Ud.d.AddNodeConstructor("Light_Type_0",((d,t)=>()=>new qd(d,N.l.Zero(),t)));class qd extends Fd.b{get shadowAngle(){return this._shadowAngle}set shadowAngle(d){this._shadowAngle=d,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(d){const t=this.needCube();if(this._direction=d,this.needCube()!==t&&this._shadowGenerators){const d=this._shadowGenerators.values();for(let t=d.next();!0!==t.done;t=d.next()){t.value.recreateShadowMap()}}}constructor(d,t,A){super(d,A),this._shadowAngle=Math.PI/2,this.position=t}getClassName(){return"PointLight"}getTypeID(){return Td.c.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(d){if(this.direction)return super.getShadowDirection(d);switch(d){case 0:return new N.l(1,0,0);case 1:return new N.l(-1,0,0);case 2:return new N.l(0,-1,0);case 3:return new N.l(0,1,0);case 4:return new N.l(0,0,1);case 5:return new N.l(0,0,-1)}return N.l.Zero()}_setDefaultShadowProjectionMatrix(d,t,A){const w=this.va().activeCamera;if(!w)return;const p=void 0!==this.shadowMinZ?this.shadowMinZ:w.Ui,B=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,X=this.va().getEngine().useReverseDepthBuffer;N.c.PerspectiveFovLHToRef(this.shadowAngle,1,X?B:p,X?p:B,d,!0,this._scene.getEngine().isNDCHalfZRange,void 0,X)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(d,t){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,t):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,t),this}transferToNodeMaterialEffect(d,t){return this.computeTransformedInformation()?d.setFloat3(t,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):d.setFloat3(t,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(d,t){d["POINTLIGHT"+t]=!0}}(0,F.b)([(0,q.J)()],qd.prototype,"shadowAngle",null),(0,v.g)("BABYLON.PointLight",qd),Ud.d.AddNodeConstructor("Light_Type_2",((d,t)=>()=>new Hd(d,N.l.Zero(),N.l.Zero(),0,0,t)));class Hd extends Fd.b{get angle(){return this._angle}set angle(d){this._angle=d,this._cosHalfAngle=Math.cos(.5*d),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(d){this._innerAngle=d,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(d){this._shadowAngleScale=d,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(d){this._projectionTextureLightNear=d,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(d){this._projectionTextureLightFar=d,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(d){this._projectionTextureUpDirection=d,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(d){this._projectionTexture!==d&&(this._projectionTexture=d,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(Hd._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):Hd._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(d){return void 0!==d.onGeneratedObservable}static _IsTexture(d){return void 0!==d.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(d){this._projectionTextureProjectionLightMatrix=d,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(d,t,A,w,p,B){super(d,B),this._innerAngle=0,this._projectionTextureMatrix=N.c.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=N.l.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=N.l.Zero(),this._projectionTextureViewLightMatrix=N.c.Zero(),this._projectionTextureProjectionLightMatrix=N.c.Zero(),this._projectionTextureScalingMatrix=N.c.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=t,this.direction=A,this.angle=w,this.exponent=p}getClassName(){return"SpotLight"}getTypeID(){return Td.c.LIGHTTYPEID_SPOTLIGHT}_setDirection(d){super._setDirection(d),this._projectionTextureViewLightDirty=!0}_setPosition(d){super._setPosition(d),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(d,t,A){const w=this.va().activeCamera;if(!w)return;this._shadowAngleScale=this._shadowAngleScale||1;const p=this._shadowAngleScale*this._angle,B=void 0!==this.shadowMinZ?this.shadowMinZ:w.Ui,X=void 0!==this.shadowMaxZ?this.shadowMaxZ:w.maxZ,W=this.va().getEngine().useReverseDepthBuffer;N.c.PerspectiveFovLHToRef(p,1,W?X:B,W?B:X,d,!0,this._scene.getEngine().isNDCHalfZRange,void 0,W)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),N.c.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const d=this.projectionTextureLightFar,t=this.projectionTextureLightNear,A=d/(d-t),w=-A*t,p=1/Math.tan(this._angle/2);N.c.FromValuesToRef(p/1,0,0,0,0,p,0,0,0,0,A,1,0,0,w,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof n.c){const d=this._projectionTexture.uScale/2,t=this._projectionTexture.vScale/2;N.c.FromValuesToRef(d,0,0,0,0,t,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(d,t){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),d.setMatrix("textureProjectionMatrix"+t,this._projectionTextureMatrix),d.setTexture("projectionLightTexture"+t,this.projectionTexture)),this}transferToEffect(d,t){let A;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,t),A=N.l.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,t),A=N.l.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",A.x,A.y,A.z,this._cosHalfAngle,t),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,t),this}transferToNodeMaterialEffect(d,t){let A;return A=this.computeTransformedInformation()?N.l.Normalize(this.transformedDirection):N.l.Normalize(this.direction),this.va().useRightHandedSystem?d.setFloat3(t,-A.x,-A.y,-A.z):d.setFloat3(t,A.x,A.y,A.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(d){const t=this._scene.getEngine(),A=void 0!==this.shadowMinZ?this.shadowMinZ:d.Ui;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?A:this._scene.getEngine().isNDCHalfZRange?0:A}getDepthMaxZ(d){const t=this._scene.getEngine(),A=void 0!==this.shadowMaxZ?this.shadowMaxZ:d.maxZ;return t.useReverseDepthBuffer&&t.isNDCHalfZRange?0:A}prepareLightSpecificDefines(d,t){d["SPOTLIGHT"+t]=!0,d["PROJECTEDLIGHTTEXTURE"+t]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,F.b)([(0,q.J)()],Hd.prototype,"angle",null),(0,F.b)([(0,q.J)()],Hd.prototype,"innerAngle",null),(0,F.b)([(0,q.J)()],Hd.prototype,"shadowAngleScale",null),(0,F.b)([(0,q.J)()],Hd.prototype,"exponent",void 0),(0,F.b)([(0,q.J)()],Hd.prototype,"projectionTextureLightNear",null),(0,F.b)([(0,q.J)()],Hd.prototype,"projectionTextureLightFar",null),(0,F.b)([(0,q.J)()],Hd.prototype,"projectionTextureUpDirection",null),(0,F.b)([(0,q.C)("projectedLightTexture")],Hd.prototype,"_projectionTexture",void 0),(0,v.g)("BABYLON.SpotLight",Hd);const fd="KHR_lights_punctual";class vd{constructor(d){this.name=fd,this._loader=d,this.enabled=this._loader.isExtensionUsed(fd)}dispose(){this._loader=null,delete this._lights}onLoading(){const d=this._loader.Mi.extensions;if(d&&d[this.name]){const t=d[this.name];this._lights=t.lights,C.Assign(this._lights)}}loadNodeAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,B)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(d,t,(d=>{let t;const X=C.Get(w,this._lights,B.fb),W=X.name||d.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,X.type){case"directional":{const d=new Jd.d(W,N.l.Backward(),this._loader.babylonScene);d.position.Dj(0),t=d;break}case"point":t=new qd(W,N.l.Zero(),this._loader.babylonScene);break;case"spot":{const d=new Hd(W,N.l.Zero(),N.l.Backward(),0,1,this._loader.babylonScene);d.angle=2*(X.spot&&X.spot.outerConeAngle||Math.PI/4),d.innerAngle=2*(X.spot&&X.spot.innerConeAngle||0),t=d;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${w}: Invalid light type (${X.type})`)}t._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,X._babylonLight=t,t.falloffType=Td.c.FALLOFF_GLTF,t.kh=X.color?p.e.Lg(X.color):p.e.White(),t.Yi=void 0==X.Yi?1:X.Yi,t.range=void 0==X.range?Number.MAX_VALUE:X.range,t.parent=d,this._loader._babylonLights.push(t),E.AddPointerMetadata(t,w),A(d)})))))}}x(fd),M(fd,!0,(d=>new vd(d)));const md="KHR_materials_pbrSpecularGlossiness";class jd{constructor(d){this.name=md,this.order=200,this._loader=d,this.enabled=this._loader.isExtensionUsed(md)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialBasePropertiesAsync(d,t,A)),p.push(this._loadSpecularGlossinessPropertiesAsync(w,N,A)),this._loader.loadMaterialAlphaProperties(d,t,A),Promise.all(p).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;return A.metallic=null,A.roughness=null,t.diffuseFactor?(A.albedoColor=p.e.Lg(t.diffuseFactor),A.alpha=t.diffuseFactor[3]):A.albedoColor=p.e.White(),A.reflectivityColor=t.specularFactor?p.e.Lg(t.specularFactor):p.e.White(),A.microSurface=void 0==t.glossinessFactor?1:t.glossinessFactor,t.diffuseTexture&&w.push(this._loader.loadTextureInfoAsync(`${d}/diffuseTexture`,t.diffuseTexture,(d=>{d.name=`${A.name} (Diffuse)`,A.albedoTexture=d}))),t.specularGlossinessTexture&&(w.push(this._loader.loadTextureInfoAsync(`${d}/specularGlossinessTexture`,t.specularGlossinessTexture,(d=>{d.name=`${A.name} (Specular Glossiness)`,A.reflectivityTexture=d,A.reflectivityTexture.uc=!0}))),A.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(w).then((()=>{}))}}x(md),M(md,!0,(d=>new jd(d)));const nd="KHR_materials_unlit";class Rd{constructor(d){this.name=nd,this.order=210,this._loader=d,this.enabled=this._loader.isExtensionUsed(nd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,(()=>this._loadUnlitPropertiesAsync(d,t,A)))}_loadUnlitPropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;A.unlit=!0;const N=t.pbrMetallicRoughness;return N&&(N.baseColorFactor?(A.albedoColor=p.e.Lg(N.baseColorFactor),A.alpha=N.baseColorFactor[3]):A.albedoColor=p.e.White(),N.baseColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${d}/baseColorTexture`,N.baseColorTexture,(d=>{d.name=`${A.name} (Base Color)`,A.albedoTexture=d})))),t.doubleSided&&(A.Tg=!1,A.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(d,t,A),Promise.all(w).then((()=>{}))}}x(nd),M(nd,!0,(d=>new Rd(d)));const Zd="KHR_materials_clearcoat";class Ld{constructor(d){this.name=Zd,this.order=190,this._loader=d,this.enabled=this._loader.isExtensionUsed(Zd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadClearCoatPropertiesAsync(w,N,A)),Promise.all(p).then((()=>{}))}))}_loadClearCoatPropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;return A.clearCoat.isEnabled=!0,A.clearCoat.useRoughnessFromMainTexture=!1,A.clearCoat.remapF0OnInterfaceChange=!1,void 0!=t.clearcoatFactor?A.clearCoat.Yi=t.clearcoatFactor:A.clearCoat.Yi=0,t.clearcoatTexture&&w.push(this._loader.loadTextureInfoAsync(`${d}/clearcoatTexture`,t.clearcoatTexture,(d=>{d.name=`${A.name} (ClearCoat)`,A.clearCoat.texture=d}))),void 0!=t.clearcoatRoughnessFactor?A.clearCoat.roughness=t.clearcoatRoughnessFactor:A.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${d}/clearcoatRoughnessTexture`,t.clearcoatRoughnessTexture,(d=>{d.name=`${A.name} (ClearCoat Roughness)`,A.clearCoat.textureRoughness=d})))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${d}/clearcoatNormalTexture`,t.clearcoatNormalTexture,(d=>{d.name=`${A.name} (ClearCoat Normal)`,A.clearCoat.bumpTexture=d}))),A.invertNormalMapX=!A.va().useRightHandedSystem,A.invertNormalMapY=A.va().useRightHandedSystem,void 0!=t.clearcoatNormalTexture.scale&&(A.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(w).then((()=>{}))}}x(Zd),M(Zd,!0,(d=>new Ld(d)));const Id="KHR_materials_iridescence";class ud{constructor(d){this.name=Id,this.order=195,this._loader=d,this.enabled=this._loader.isExtensionUsed(Id)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadIridescencePropertiesAsync(w,N,A)),Promise.all(p).then((()=>{}))}))}_loadIridescencePropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;return A.iridescence.isEnabled=!0,A.iridescence.Yi=t.iridescenceFactor??0,A.iridescence.indexOfRefraction=t.iridescenceIor??t.iridescenceIOR??1.3,A.iridescence.minimumThickness=t.iridescenceThicknessMinimum??100,A.iridescence.maximumThickness=t.iridescenceThicknessMaximum??400,t.iridescenceTexture&&w.push(this._loader.loadTextureInfoAsync(`${d}/iridescenceTexture`,t.iridescenceTexture,(d=>{d.name=`${A.name} (Iridescence)`,A.iridescence.texture=d}))),t.iridescenceThicknessTexture&&w.push(this._loader.loadTextureInfoAsync(`${d}/iridescenceThicknessTexture`,t.iridescenceThicknessTexture,(d=>{d.name=`${A.name} (Iridescence Thickness)`,A.iridescence.thicknessTexture=d}))),Promise.all(w).then((()=>{}))}}x(Id),M(Id,!0,(d=>new ud(d)));const Vd="KHR_materials_anisotropy";class hd{constructor(d){this.name=Vd,this.order=195,this._loader=d,this.enabled=this._loader.isExtensionUsed(Vd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadIridescencePropertiesAsync(w,N,A)),Promise.all(p).then((()=>{}))}))}_loadIridescencePropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;return A.anisotropy.isEnabled=!0,A.anisotropy.Yi=t.anisotropyStrength??0,A.anisotropy.angle=t.anisotropyRotation??0,t.anisotropyTexture&&(t.anisotropyTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${d}/anisotropyTexture`,t.anisotropyTexture,(d=>{d.name=`${A.name} (Anisotropy Intensity)`,A.anisotropy.texture=d})))),Promise.all(w).then((()=>{}))}}x(Vd),M(Vd,!0,(d=>new hd(d)));const ld="KHR_materials_emissive_strength";class yd{constructor(d){this.name=ld,this.order=170,this._loader=d,this.enabled=this._loader.isExtensionUsed(ld)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>this._loader.loadMaterialPropertiesAsync(d,t,A).then((()=>{this._loadEmissiveProperties(w,N,A)}))))}_loadEmissiveProperties(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);void 0!==t.emissiveStrength&&(A.emissiveIntensity=t.emissiveStrength)}}x(ld),M(ld,!0,(d=>new yd(d)));const sd="KHR_materials_sheen";class Yd{constructor(d){this.name=sd,this.order=190,this._loader=d,this.enabled=this._loader.isExtensionUsed(sd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadSheenPropertiesAsync(w,N,A)),Promise.all(p).then((()=>{}))}))}_loadSheenPropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;return A.sheen.isEnabled=!0,A.sheen.Yi=1,void 0!=t.sheenColorFactor?A.sheen.color=p.e.Lg(t.sheenColorFactor):A.sheen.color=p.e.Black(),t.sheenColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${d}/sheenColorTexture`,t.sheenColorTexture,(d=>{d.name=`${A.name} (Sheen Color)`,A.sheen.texture=d}))),void 0!==t.sheenRoughnessFactor?A.sheen.roughness=t.sheenRoughnessFactor:A.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${d}/sheenRoughnessTexture`,t.sheenRoughnessTexture,(d=>{d.name=`${A.name} (Sheen Roughness)`,A.sheen.textureRoughness=d})))),A.sheen.albedoScaling=!0,A.sheen.useRoughnessFromMainTexture=!1,Promise.all(w).then((()=>{}))}}x(sd),M(sd,!0,(d=>new Yd(d)));const rd="KHR_materials_specular";class Kd{constructor(d){this.name=rd,this.order=190,this._loader=d,this.enabled=this._loader.isExtensionUsed(rd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadSpecularPropertiesAsync(w,N,A)),Promise.all(p).then((()=>{}))}))}_loadSpecularPropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const w=new Array;return void 0!==t.specularFactor&&(A.metallicF0Factor=t.specularFactor),void 0!==t.specularColorFactor&&(A.metallicReflectanceColor=p.e.Lg(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,w.push(this._loader.loadTextureInfoAsync(`${d}/specularTexture`,t.specularTexture,(d=>{d.name=`${A.name} (Specular)`,A.metallicReflectanceTexture=d,A.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),t.specularColorTexture&&w.push(this._loader.loadTextureInfoAsync(`${d}/specularColorTexture`,t.specularColorTexture,(d=>{d.name=`${A.name} (Specular Color)`,A.reflectanceTexture=d}))),Promise.all(w).then((()=>{}))}}x(rd),M(rd,!0,(d=>new Kd(d)));const Gd="KHR_materials_ior";class Od{constructor(d){this.name=Gd,this.order=180,this._loader=d,this.enabled=this._loader.isExtensionUsed(Gd)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadIorPropertiesAsync(w,N,A)),Promise.all(p).then((()=>{}))}))}_loadIorPropertiesAsync(d,t,A){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);return void 0!==t.ior?A.indexOfRefraction=t.ior:A.indexOfRefraction=Od._DEFAULT_IOR,Promise.resolve()}}Od._DEFAULT_IOR=1.5,x(Gd),M(Gd,!0,(d=>new Od(d)));const zd="KHR_materials_variants";class cd{constructor(d){this.name=zd,this._loader=d,this.enabled=this._loader.isExtensionUsed(zd)}dispose(){this._loader=null}static GetAvailableVariants(d){const t=this._GetExtensionMetadata(d);return t?Object.keys(t.variants):[]}getAvailableVariants(d){return cd.GetAvailableVariants(d)}static SelectVariant(d,t){const A=this._GetExtensionMetadata(d);if(!A)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${zd} extension`);const w=d=>{const t=A.variants[d];if(t)for(const A of t)A.mesh.material=A.material};if(t instanceof Array)for(const N of t)w(N);else w(t);A.lastSelected=t}selectVariant(d,t){cd.SelectVariant(d,t)}static Reset(d){const t=this._GetExtensionMetadata(d);if(!t)throw new Error(`Cannot reset on a glTF mesh that does not have the ${zd} extension`);for(const A of t.original)A.mesh.material=A.material;t.lastSelected=null}reset(d){cd.Reset(d)}static GetLastSelectedVariant(d){const t=this._GetExtensionMetadata(d);if(!t)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${zd} extension`);return t.lastSelected}getLastSelectedVariant(d){return cd.GetLastSelectedVariant(d)}static _GetExtensionMetadata(d){var t,A;return(null===d||void 0===d||null===(t=d._internalMetadata)||void 0===t||null===(A=t.Mi)||void 0===A?void 0:A[zd])||null}onLoading(){const d=this._loader.Mi.extensions;if(d&&d[this.name]){const t=d[this.name];this._variants=t.variants}}_loadMeshPrimitiveAsync(d,t,A,w,N,p){return E.LoadExtensionAsync(d,N,this.name,((B,X)=>{const W=new Array;return W.push(this._loader._loadMeshPrimitiveAsync(d,t,A,w,N,(t=>{if(p(t),t instanceof u.d){const A=E._GetDrawMode(d,N.mode),w=this._loader.rootBabylonMesh,p=w?w._internalMetadata=w._internalMetadata||{}:{},a=p.Mi=p.Mi||{},D=a[zd]=a[zd]||{lastSelected:null,original:[],variants:{}};D.original.push({mesh:t,material:t.material});for(let d=0;d<X.mappings.length;++d){const N=X.mappings[d],p=C.Get(`${B}/mappings/${d}/material`,this._loader.Mi.materials,N.material);W.push(this._loader._loadMaterialAsync(`#/materials/${N.material}`,p,t,A,(d=>{for(let A=0;A<N.variants.length;++A){const p=N.variants[A],B=C.Get(`/extensions/${zd}/variants/${p}`,this._variants,p);D.variants[B.name]=D.variants[B.name]||[],D.variants[B.name].push({mesh:t,material:d}),t.onClonedObservable.add((d=>{const A=d;let N=null,p=A;do{if(p=p.parent,!p)return;N=cd._GetExtensionMetadata(p)}while(null===N);if(w&&N===cd._GetExtensionMetadata(w)){p._internalMetadata={};for(const d in w._internalMetadata)p._internalMetadata[d]=w._internalMetadata[d];p._internalMetadata.Mi=[];for(const d in w._internalMetadata.Mi)p._internalMetadata.Mi[d]=w._internalMetadata.Mi[d];p._internalMetadata.Mi[zd]={lastSelected:null,original:[],variants:{}};for(const d of N.original)p._internalMetadata.Mi[zd].original.push({mesh:d.mesh,material:d.material});for(const d in N.variants)if(Object.prototype.hasOwnProperty.call(N.variants,d)){p._internalMetadata.Mi[zd].variants[d]=[];for(const t of N.variants[d])p._internalMetadata.Mi[zd].variants[d].push({mesh:t.mesh,material:t.material})}N=p._internalMetadata.Mi[zd]}for(const w of N.original)w.mesh===t&&(w.mesh=A);for(const w of N.variants[B.name])w.mesh===t&&(w.mesh=A)}))}})))}}}))),Promise.all(W).then((d=>{let[t]=d;return t}))}))}}x(zd),M(zd,!0,(d=>new cd(d)));var ed=A(11576);class Md{}Md.AUTOSAMPLERSUFFIX="Sampler",Md.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",Md.ALPHA_DISABLE=0,Md.ALPHA_ADD=1,Md.ALPHA_COMBINE=2,Md.ALPHA_SUBTRACT=3,Md.ALPHA_MULTIPLY=4,Md.ALPHA_MAXIMIZED=5,Md.ALPHA_ONEONE=6,Md.ALPHA_PREMULTIPLIED=7,Md.ALPHA_PREMULTIPLIED_PORTERDUFF=8,Md.ALPHA_INTERPOLATE=9,Md.ALPHA_SCREENMODE=10,Md.ALPHA_ONEONE_ONEONE=11,Md.ALPHA_ALPHATOCOLOR=12,Md.ALPHA_REVERSEONEMINUS=13,Md.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,Md.ALPHA_ONEONE_ONEZERO=15,Md.ALPHA_EXCLUSION=16,Md.ALPHA_LAYER_ACCUMULATE=17,Md.ALPHA_EQUATION_ADD=0,Md.ALPHA_EQUATION_SUBSTRACT=1,Md.ALPHA_EQUATION_REVERSE_SUBTRACT=2,Md.ALPHA_EQUATION_MAX=3,Md.ALPHA_EQUATION_MIN=4,Md.ALPHA_EQUATION_DARKEN=5,Md.DELAYLOADSTATE_NONE=0,Md.DELAYLOADSTATE_LOADED=1,Md.DELAYLOADSTATE_LOADING=2,Md.DELAYLOADSTATE_NOTLOADED=4,Md.NEVER=512,Md.ALWAYS=519,Md.LESS=513,Md.EQUAL=514,Md.LEQUAL=515,Md.GREATER=516,Md.GEQUAL=518,Md.NOTEQUAL=517,Md.KEEP=7680,Md.ZERO=0,Md.REPLACE=7681,Md.INCR=7682,Md.DECR=7683,Md.INVERT=5386,Md.INCR_WRAP=34055,Md.DECR_WRAP=34056,Md.TEXTURE_CLAMP_ADDRESSMODE=0,Md.TEXTURE_WRAP_ADDRESSMODE=1,Md.TEXTURE_MIRROR_ADDRESSMODE=2,Md.TEXTURE_CREATIONFLAG_STORAGE=1,Md.TEXTUREFORMAT_ALPHA=0,Md.TEXTUREFORMAT_LUMINANCE=1,Md.TEXTUREFORMAT_LUMINANCE_ALPHA=2,Md.TEXTUREFORMAT_RGB=4,Md.TEXTUREFORMAT_RGBA=5,Md.TEXTUREFORMAT_RED=6,Md.TEXTUREFORMAT_R=6,Md.TEXTUREFORMAT_RG=7,Md.TEXTUREFORMAT_RED_INTEGER=8,Md.TEXTUREFORMAT_R_INTEGER=8,Md.TEXTUREFORMAT_RG_INTEGER=9,Md.TEXTUREFORMAT_RGB_INTEGER=10,Md.TEXTUREFORMAT_RGBA_INTEGER=11,Md.TEXTUREFORMAT_BGRA=12,Md.TEXTUREFORMAT_DEPTH24_STENCIL8=13,Md.TEXTUREFORMAT_DEPTH32_FLOAT=14,Md.TEXTUREFORMAT_DEPTH16=15,Md.TEXTUREFORMAT_DEPTH24=16,Md.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,Md.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,Md.TEXTUREFORMAT_STENCIL8=19,Md.TEXTUREFORMAT_UNDEFINED=4294967295,Md.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,Md.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,Md.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,Md.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,Md.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,Md.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,Md.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,Md.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,Md.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,Md.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,Md.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,Md.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,Md.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,Md.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,Md.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,Md.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,Md.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,Md.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,Md.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,Md.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,Md.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,Md.TEXTURETYPE_UNSIGNED_BYTE=0,Md.TEXTURETYPE_UNSIGNED_INT=0,Md.TEXTURETYPE_FLOAT=1,Md.TEXTURETYPE_HALF_FLOAT=2,Md.TEXTURETYPE_BYTE=3,Md.TEXTURETYPE_SHORT=4,Md.TEXTURETYPE_UNSIGNED_SHORT=5,Md.TEXTURETYPE_INT=6,Md.TEXTURETYPE_UNSIGNED_INTEGER=7,Md.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,Md.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,Md.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,Md.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,Md.TEXTURETYPE_UNSIGNED_INT_24_8=12,Md.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,Md.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,Md.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,Md.TEXTURETYPE_UNDEFINED=16,Md.TEXTURE_2D=3553,Md.TEXTURE_2D_ARRAY=35866,Md.TEXTURE_CUBE_MAP=34067,Md.TEXTURE_CUBE_MAP_ARRAY=3735928559,Md.TEXTURE_3D=32879,Md.TEXTURE_NEAREST_SAMPLINGMODE=1,Md.TEXTURE_NEAREST_NEAREST=1,Md.TEXTURE_BILINEAR_SAMPLINGMODE=2,Md.TEXTURE_LINEAR_LINEAR=2,Md.TEXTURE_TRILINEAR_SAMPLINGMODE=3,Md.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,Md.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,Md.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,Md.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,Md.TEXTURE_NEAREST_LINEAR=7,Md.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,Md.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,Md.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,Md.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,Md.TEXTURE_LINEAR_NEAREST=12,Md.TEXTURE_EXPLICIT_MODE=0,Md.TEXTURE_SPHERICAL_MODE=1,Md.TEXTURE_PLANAR_MODE=2,Md.TEXTURE_CUBIC_MODE=3,Md.TEXTURE_PROJECTION_MODE=4,Md.TEXTURE_SKYBOX_MODE=5,Md.TEXTURE_INVCUBIC_MODE=6,Md.TEXTURE_EQUIRECTANGULAR_MODE=7,Md.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,Md.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,Md.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,Md.TEXTURE_FILTERING_QUALITY_HIGH=64,Md.TEXTURE_FILTERING_QUALITY_MEDIUM=16,Md.TEXTURE_FILTERING_QUALITY_LOW=8,Md.SCALEMODE_FLOOR=1,Md.SCALEMODE_NEAREST=2,Md.SCALEMODE_CEILING=3,Md.MATERIAL_TextureDirtyFlag=1,Md.MATERIAL_LightDirtyFlag=2,Md.MATERIAL_FresnelDirtyFlag=4,Md.MATERIAL_AttributesDirtyFlag=8,Md.MATERIAL_MiscDirtyFlag=16,Md.MATERIAL_PrePassDirtyFlag=32,Md.MATERIAL_AllDirtyFlag=63,Md.MATERIAL_TriangleFillMode=0,Md.MATERIAL_WireFrameFillMode=1,Md.MATERIAL_PointFillMode=2,Md.MATERIAL_PointListDrawMode=3,Md.MATERIAL_LineListDrawMode=4,Md.MATERIAL_LineLoopDrawMode=5,Md.MATERIAL_LineStripDrawMode=6,Md.MATERIAL_TriangleStripDrawMode=7,Md.MATERIAL_TriangleFanDrawMode=8,Md.MATERIAL_ClockWiseSideOrientation=0,Md.MATERIAL_CounterClockWiseSideOrientation=1,Md.ACTION_NothingTrigger=0,Md.ACTION_OnPickTrigger=1,Md.ACTION_OnLeftPickTrigger=2,Md.ACTION_OnRightPickTrigger=3,Md.ACTION_OnCenterPickTrigger=4,Md.ACTION_OnPickDownTrigger=5,Md.ACTION_OnDoublePickTrigger=6,Md.ACTION_OnPickUpTrigger=7,Md.ACTION_OnPickOutTrigger=16,Md.ACTION_OnLongPressTrigger=8,Md.ACTION_OnPointerOverTrigger=9,Md.ACTION_OnPointerOutTrigger=10,Md.ACTION_OnEveryFrameTrigger=11,Md.ACTION_OnIntersectionEnterTrigger=12,Md.ACTION_OnIntersectionExitTrigger=13,Md.ACTION_OnKeyDownTrigger=14,Md.ACTION_OnKeyUpTrigger=15,Md.PARTICLES_BILLBOARDMODE_Y=2,Md.PARTICLES_BILLBOARDMODE_ALL=7,Md.PARTICLES_BILLBOARDMODE_STRETCHED=8,Md.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,Md.MESHES_CULLINGSTRATEGY_STANDARD=0,Md.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,Md.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,Md.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,Md.SCENELOADER_NO_LOGGING=0,Md.SCENELOADER_MINIMAL_LOGGING=1,Md.SCENELOADER_SUMMARY_LOGGING=2,Md.SCENELOADER_DETAILED_LOGGING=3,Md.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,Md.PREPASS_POSITION_TEXTURE_TYPE=1,Md.PREPASS_VELOCITY_TEXTURE_TYPE=2,Md.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,Md.PREPASS_COLOR_TEXTURE_TYPE=4,Md.PREPASS_DEPTH_TEXTURE_TYPE=5,Md.PREPASS_NORMAL_TEXTURE_TYPE=6,Md.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,Md.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,Md.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,Md.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,Md.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,Md.PREPASS_ALBEDO_TEXTURE_TYPE=12,Md.BUFFER_CREATIONFLAG_READ=1,Md.BUFFER_CREATIONFLAG_WRITE=2,Md.BUFFER_CREATIONFLAG_READWRITE=3,Md.BUFFER_CREATIONFLAG_UNIFORM=4,Md.BUFFER_CREATIONFLAG_VERTEX=8,Md.BUFFER_CREATIONFLAG_INDEX=16,Md.BUFFER_CREATIONFLAG_STORAGE=32,Md.BUFFER_CREATIONFLAG_INDIRECT=64,Md.RENDERPASS_MAIN=0,Md.INPUT_ALT_KEY=18,Md.INPUT_CTRL_KEY=17,Md.INPUT_META_KEY1=91,Md.INPUT_META_KEY2=92,Md.INPUT_META_KEY3=93,Md.INPUT_SHIFT_KEY=16,Md.SNAPSHOTRENDERING_STANDARD=0,Md.SNAPSHOTRENDERING_FAST=1,Md.PERSPECTIVE_CAMERA=0,Md.ORTHOGRAPHIC_CAMERA=1,Md.FOVMODE_VERTICAL_FIXED=0,Md.FOVMODE_HORIZONTAL_FIXED=1,Md.RIG_MODE_NONE=0,Md.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,Md.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,Md.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,Md.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,Md.RIG_MODE_STEREOSCOPIC_INTERLACED=14,Md.RIG_MODE_VR=20,Md.RIG_MODE_CUSTOM=22,Md.MAX_SUPPORTED_UV_SETS=6,Md.GL_ALPHA_EQUATION_ADD=32774,Md.GL_ALPHA_EQUATION_MIN=32775,Md.GL_ALPHA_EQUATION_MAX=32776,Md.GL_ALPHA_EQUATION_SUBTRACT=32778,Md.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,Md.GL_ALPHA_FUNCTION_SRC=768,Md.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,Md.GL_ALPHA_FUNCTION_SRC_ALPHA=770,Md.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,Md.GL_ALPHA_FUNCTION_DST_ALPHA=772,Md.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,Md.GL_ALPHA_FUNCTION_DST_COLOR=774,Md.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,Md.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,Md.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,Md.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,Md.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,Md.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,Md.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,Md.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,Md.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,Md.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,Md.SnippetUrl="https://snippet.babylonjs.com",Md.FOGMODE_NONE=0,Md.FOGMODE_EXP=1,Md.FOGMODE_EXP2=2,Md.FOGMODE_LINEAR=3,Md.BYTE=5120,Md.UNSIGNED_BYTE=5121,Md.SHORT=5122,Md.UNSIGNED_SHORT=5123,Md.INT=5124,Md.UNSIGNED_INT=5125,Md.FLOAT=5126,Md.PositionKind="position",Md.NormalKind="ab",Md.TangentKind="tangent",Md.UVKind="uv",Md.UV2Kind="uv2",Md.UV3Kind="uv3",Md.UV4Kind="uv4",Md.UV5Kind="uv5",Md.UV6Kind="uv6",Md.ColorKind="color",Md.ColorInstanceKind="instanceColor",Md.MatricesIndicesKind="matricesIndices",Md.MatricesWeightsKind="matricesWeights",Md.MatricesIndicesExtraKind="matricesIndicesExtra",Md.MatricesWeightsExtraKind="matricesWeightsExtra";class xd{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:Md.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(d,t){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...xd._GetDefaultOptions(),...d},this._scene=t,this._scene._transmissionHelper=this,this.onErrorObservable=new D.b,this._scene.hj.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(d){if(!Object.keys(d).filter((t=>this._options[t]!==d[t])).length)return;const t={...this._options,...d},A=this._options;this._options=t,t.renderSize===A.renderSize&&t.renderTargetTextureType===A.renderTargetTextureType&&t.generateMipmaps===A.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=t.samples,this._opaqueRenderTarget.lodGenerationScale=t.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=t.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(d){return!!d&&!!(d instanceof j&&d.subSurface.isRefractionEnabled)}_addMesh(d){this._materialObservers[d.uniqueId]=d.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),B.g.SetImmediate((()=>{this._shouldRenderAsTransmission(d.material)?(d.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(d)&&this._transparentMeshesCache.push(d)):-1===this._opaqueMeshesCache.indexOf(d)&&this._opaqueMeshesCache.push(d)}))}_removeMesh(d){d.onMaterialChangedObservable.remove(this._materialObservers[d.uniqueId]),delete this._materialObservers[d.uniqueId];let t=this._transparentMeshesCache.indexOf(d);-1!==t&&this._transparentMeshesCache.splice(t,1),t=this._opaqueMeshesCache.indexOf(d),-1!==t&&this._opaqueMeshesCache.splice(t,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(d){const t=this._transparentMeshesCache.indexOf(d),A=this._opaqueMeshesCache.indexOf(d);this._shouldRenderAsTransmission(d.material)?(d.material instanceof j&&(d.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==A?(this._opaqueMeshesCache.splice(A,1),this._transparentMeshesCache.push(d)):-1===t&&this._transparentMeshesCache.push(d)):-1!==t?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(d)):-1===A&&this._opaqueMeshesCache.push(d)}_isRenderTargetValid(){var d;return null!==(null===(d=this._opaqueRenderTarget)||void 0===d?void 0:d.getInternalTexture())}_setupRenderTargets(){var d;let t,A;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new ed.d("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(d=this._options.clearColor)||void 0===d?void 0:d.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((d=>{A=this._scene.environmentIntensity,this._scene.environmentIntensity=1,t=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?d.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(d.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=A,this._scene.imageProcessingConfiguration._applyByPostProcess=t})),this._transparentMeshesCache.forEach((d=>{this._shouldRenderAsTransmission(d.material)&&(d.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const od="KHR_materials_transmission";class Cd{constructor(d){this.name=od,this.order=175,this._loader=d,this.enabled=this._loader.isExtensionUsed(od),this.enabled&&(d.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadTransparentPropertiesAsync(w,t,A,N)),Promise.all(p).then((()=>{}))}))}_loadTransparentPropertiesAsync(d,t,A,w){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const N=A;if(N.subSurface.isRefractionEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.useAlbedoToTintRefraction=!0,void 0===w.transmissionFactor)return N.subSurface.refractionIntensity=0,N.subSurface.isRefractionEnabled=!1,Promise.resolve();{var p;N.subSurface.refractionIntensity=w.transmissionFactor;const d=N.va();if(N.subSurface.refractionIntensity&&!d._transmissionHelper)new xd({},N.va());else if(N.subSurface.refractionIntensity&&(null===(p=d._transmissionHelper)||void 0===p||!p._isRenderTargetValid())){var B;null===(B=d._transmissionHelper)||void 0===B||B._setupRenderTargets()}}return N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,w.transmissionTexture?(w.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${d}/transmissionTexture`,w.transmissionTexture,void 0).then((d=>{d.name=`${A.name} (Transmission)`,N.subSurface.refractionIntensityTexture=d,N.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(od),M(od,!0,(d=>new Cd(d)));const Ed="KHR_materials_diffuse_transmission";class gd{constructor(d){this.name=Ed,this.order=174,this._loader=d,this.enabled=this._loader.isExtensionUsed(Ed),this.enabled&&(d.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadTranslucentPropertiesAsync(w,t,A,N)),Promise.all(p).then((()=>{}))}))}_loadTranslucentPropertiesAsync(d,t,A,w){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);const N=A;if(N.subSurface.isTranslucencyEnabled=!0,N.subSurface.volumeIndexOfRefraction=1,N.subSurface.minimumThickness=0,N.subSurface.maximumThickness=0,N.subSurface.useAlbedoToTintTranslucency=!1,void 0===w.diffuseTransmissionFactor)return N.subSurface.translucencyIntensity=0,N.subSurface.isTranslucencyEnabled=!1,Promise.resolve();N.subSurface.translucencyIntensity=w.diffuseTransmissionFactor;const B=new Array;return N.subSurface.useGltfStyleTextures=!0,w.diffuseTransmissionTexture&&(w.diffuseTransmissionTexture.nonColorData=!0,B.push(this._loader.loadTextureInfoAsync(`${d}/diffuseTransmissionTexture`,w.diffuseTransmissionTexture).then((d=>{d.name=`${A.name} (Diffuse Transmission)`,N.subSurface.translucencyIntensityTexture=d})))),void 0!==w.diffuseTransmissionColorFactor?N.subSurface.translucencyColor=p.e.Lg(w.diffuseTransmissionColorFactor):N.subSurface.translucencyColor=p.e.White(),w.diffuseTransmissionColorTexture&&B.push(this._loader.loadTextureInfoAsync(`${d}/diffuseTransmissionColorTexture`,w.diffuseTransmissionColorTexture).then((d=>{d.name=`${A.name} (Diffuse Transmission Color)`,N.subSurface.translucencyColorTexture=d}))),Promise.all(B).then((()=>{}))}}x(Ed),M(Ed,!0,(d=>new gd(d)));const Sd="KHR_materials_volume";class dt{constructor(d){this.name=Sd,this.order=173,this._loader=d,this.enabled=this._loader.isExtensionUsed(Sd),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadVolumePropertiesAsync(w,t,A,N)),Promise.all(p).then((()=>{}))}))}_loadVolumePropertiesAsync(d,t,A,w){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);if(!A.subSurface.isRefractionEnabled&&!A.subSurface.isTranslucencyEnabled||!w.thicknessFactor)return Promise.resolve();A.subSurface.volumeIndexOfRefraction=A.indexOfRefraction;const N=void 0!==w.attenuationDistance?w.attenuationDistance:Number.MAX_VALUE;return A.subSurface.tintColorAtDistance=N,void 0!==w.attenuationColor&&3==w.attenuationColor.length&&A.subSurface.tintColor.wf(w.attenuationColor[0],w.attenuationColor[1],w.attenuationColor[2]),A.subSurface.minimumThickness=0,A.subSurface.maximumThickness=w.thicknessFactor,A.subSurface.useThicknessAsDepth=!0,w.thicknessTexture?(w.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${d}/thicknessTexture`,w.thicknessTexture).then((d=>{d.name=`${A.name} (Thickness)`,A.subSurface.thicknessTexture=d,A.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}x(Sd),M(Sd,!0,(d=>new dt(d)));const tt="KHR_materials_dispersion";class At{constructor(d){this.name=tt,this.order=174,this._loader=d,this.enabled=this._loader.isExtensionUsed(tt)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=new Array;return p.push(this._loader.loadMaterialPropertiesAsync(d,t,A)),p.push(this._loadDispersionPropertiesAsync(w,t,A,N)),Promise.all(p).then((()=>{}))}))}_loadDispersionPropertiesAsync(d,t,A,w){if(!(A instanceof j))throw new Error(`${d}: Material type not supported`);return A.subSurface.isRefractionEnabled&&w.dispersion?(A.subSurface.isDispersionEnabled=!0,A.subSurface.dispersion=w.dispersion,Promise.resolve()):Promise.resolve()}}x(tt),M(tt,!0,(d=>new At(d)));const wt="KHR_mesh_quantization";class Nt{constructor(d){this.name=wt,this.enabled=d.isExtensionUsed(wt)}dispose(){}}x(wt),M(wt,!0,(d=>new Nt(d)));const pt="KHR_texture_basisu";class Bt{constructor(d){this.name=pt,this._loader=d,this.enabled=d.isExtensionUsed(pt)}dispose(){this._loader=null}_loadTextureAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>{const p=void 0==t.sampler?E.DefaultSampler:C.Get(`${d}/sampler`,this._loader.Mi.samplers,t.sampler),B=C.Get(`${w}/source`,this._loader.Mi.images,N.source);return this._loader._createTextureAsync(d,p,B,(d=>{A(d)}),t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)}))}}x(pt),M(pt,!0,(d=>new Bt(d)));const Xt="KHR_texture_transform";class Wt{constructor(d){this.name=Xt,this._loader=d,this.enabled=this._loader.isExtensionUsed(Xt)}dispose(){this._loader=null}loadTextureInfoAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((w,N)=>this._loader.loadTextureInfoAsync(d,t,(d=>{if(!(d instanceof n.c))throw new Error(`${w}: Texture type not supported`);N.offset&&(d.uOffset=N.offset[0],d.vOffset=N.offset[1]),d.uRotationCenter=0,d.vRotationCenter=0,N.rotation&&(d.wAng=-N.rotation),N.scale&&(d.uScale=N.scale[0],d.vScale=N.scale[1]),void 0!=N.texCoord&&(d.coordinatesIndex=N.texCoord),A(d)}))))}}x(Xt),M(Xt,!0,(d=>new Wt(d)));const at="KHR_xmp_json_ld";class Dt{constructor(d){this.name=at,this.order=100,this._loader=d,this.enabled=this._loader.isExtensionUsed(at)}dispose(){this._loader=null}onLoading(){var d,t,A;if(null===this._loader.rootBabylonMesh)return;const w=null===(d=this._loader.Mi.extensions)||void 0===d?void 0:d.KHR_xmp_json_ld,N=null===(t=this._loader.Mi.asset)||void 0===t||null===(A=t.extensions)||void 0===A?void 0:A.KHR_xmp_json_ld;if(w&&N){const d=+N.packet;w.packets&&d<w.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=w.packets[d])}}}function it(d,t,A,w){return p.e.Lg(t,A).scale(w)}function kt(d,t,A,w){return t[A]*w}function bt(d,t,A,w){return-t[A]*w}function Qt(d,t,A,w){return t[A+1]*w}function Pt(d,t,A,w){return t[A]*w*2}function Jt(d){return{scale:[new Tt(k.d.ANIMATIONTYPE_FLOAT,`${d}.uScale`,kt,(()=>2)),new Tt(k.d.ANIMATIONTYPE_FLOAT,`${d}.vScale`,Qt,(()=>2))],offset:[new Tt(k.d.ANIMATIONTYPE_FLOAT,`${d}.uOffset`,kt,(()=>2)),new Tt(k.d.ANIMATIONTYPE_FLOAT,`${d}.vOffset`,Qt,(()=>2))],rotation:[new Tt(k.d.ANIMATIONTYPE_FLOAT,`${d}.wAng`,bt,(()=>1))]}}x(at),M(at,!0,(d=>new Dt(d)));class Ut extends G{buildAnimations(d,t,A,w,N){N(d._babylonCamera,this._buildAnimation(t,A,w))}}class Tt extends G{buildAnimations(d,t,A,w,N){for(const p in d._data)N(d._data[p].babylonMaterial,this._buildAnimation(t,A,w))}}class Ft extends G{buildAnimations(d,t,A,w,N){N(d._babylonLight,this._buildAnimation(t,A,w))}}const qt={__array__:{__target__:!0,...z}},Ht={__array__:{__target__:!0,orthographic:{xmag:[new Ut(k.d.ANIMATIONTYPE_FLOAT,"orthoLeft",bt,(()=>1)),new Ut(k.d.ANIMATIONTYPE_FLOAT,"orthoRight",Qt,(()=>1))],ymag:[new Ut(k.d.ANIMATIONTYPE_FLOAT,"orthoBottom",bt,(()=>1)),new Ut(k.d.ANIMATIONTYPE_FLOAT,"orthoTop",Qt,(()=>1))],zfar:[new Ut(k.d.ANIMATIONTYPE_FLOAT,"maxZ",kt,(()=>1))],znear:[new Ut(k.d.ANIMATIONTYPE_FLOAT,"Ui",kt,(()=>1))]},perspective:{yfov:[new Ut(k.d.ANIMATIONTYPE_FLOAT,"fov",kt,(()=>1))],zfar:[new Ut(k.d.ANIMATIONTYPE_FLOAT,"maxZ",kt,(()=>1))],znear:[new Ut(k.d.ANIMATIONTYPE_FLOAT,"Ui",kt,(()=>1))]}}},ft={nodes:qt,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Tt(k.d.ANIMATIONTYPE_COLOR3,"albedoColor",it,(()=>4)),new Tt(k.d.ANIMATIONTYPE_FLOAT,"alpha",(function(d,t,A,w){return t[A+3]*w}),(()=>4))],metallicFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"metallic",kt,(()=>1))],roughnessFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"roughness",kt,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:Jt("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:Jt("metallicTexture")}}},emissiveFactor:[new Tt(k.d.ANIMATIONTYPE_COLOR3,"emissiveColor",it,(()=>3))],normalTexture:{scale:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"bumpTexture.level",kt,(()=>1))],extensions:{KHR_texture_transform:Jt("bumpTexture")}},occlusionTexture:{strength:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",kt,(()=>1))],extensions:{KHR_texture_transform:Jt("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:Jt("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",kt,(()=>1))],anisotropyRotation:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"anisotropy.angle",kt,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:Jt("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",kt,(()=>1))],clearcoatRoughnessFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",kt,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:Jt("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",kt,(()=>1))],extensions:{KHR_texture_transform:Jt("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:Jt("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",kt,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"emissiveIntensity",kt,(()=>1))]},KHR_materials_ior:{ior:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"indexOfRefraction",kt,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"iridescence.intensity",kt,(()=>1))],iridescenceIor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",kt,(()=>1))],iridescenceThicknessMinimum:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",kt,(()=>1))],iridescenceThicknessMaximum:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",kt,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:Jt("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:Jt("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Tt(k.d.ANIMATIONTYPE_COLOR3,"sheen.color",it,(()=>3))],sheenRoughnessFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"sheen.roughness",kt,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:Jt("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:Jt("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"metallicF0Factor",kt,(()=>1))],specularColorFactor:[new Tt(k.d.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",it,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:Jt("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:Jt("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",kt,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:Jt("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Tt(k.d.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",it,(()=>3))],attenuationDistance:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",kt,(()=>1))],thicknessFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",kt,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:Jt("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Tt(k.d.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",kt,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:Jt("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Tt(k.d.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",it,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:Jt("subSurface.translucencyColorTexture")}}}}}},cameras:Ht,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new Ft(k.d.ANIMATIONTYPE_COLOR3,"diffuse",it,(()=>3))],Yi:[new Ft(k.d.ANIMATIONTYPE_FLOAT,"intensity",kt,(()=>1))],range:[new Ft(k.d.ANIMATIONTYPE_FLOAT,"range",kt,(()=>1))],spot:{innerConeAngle:[new Ft(k.d.ANIMATIONTYPE_FLOAT,"innerAngle",Pt,(()=>1))],outerConeAngle:[new Ft(k.d.ANIMATIONTYPE_FLOAT,"angle",Pt,(()=>1))]}}}}}};class vt{constructor(d,t){this._gltf=d,this._infoTree=t}convert(d){let t,A=this._gltf,w=this._infoTree;if(!d.startsWith("/"))throw new Error("Path must start with a /");const N=d.split("/");N.shift();for(const p of N){if(w.__array__)w=w.__array__;else if(w=w[p],!w)throw new Error(`Path ${d} is invalid`);if(void 0===A)throw new Error(`Path ${d} is invalid`);A=A[p],w.__target__&&(t=A)}return{object:t,info:w}}}const mt="KHR_animation_pointer";class jt extends vt{constructor(d){super(d,ft)}}class nt{constructor(d){this.name=mt,this._loader=d,this._pathToObjectConverter=new jt(this._loader.Mi)}get enabled(){return this._loader.isExtensionUsed(mt)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(d,t,A,w,N){var p;const B=null===(p=w.target.extensions)||void 0===p?void 0:p.KHR_animation_pointer;if(!B||!this._pathToObjectConverter)return null;"pointer"!==w.target.path&&P.e.Warn(`${d}/target/path: Value (${w.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=w.target.node&&P.e.Warn(`${d}/target/node: Value (${w.target.node}) must not be present when using the ${this.name} extension`);const X=`${d}/extensions/${this.name}`,W=B.pointer;if(!W)throw new Error(`${X}: Pointer is missing`);try{const p=this._pathToObjectConverter.convert(W);return this._loader._loadAnimationChannelFromTargetInfoAsync(d,t,A,w,p,N)}catch(a){return P.e.Warn(`${X}/pointer: Invalid pointer (${W}) skipped`),null}}}x(mt),M(mt,!0,(d=>new nt(d)));class Rt{constructor(d,t,A){this.frame=d,this.action=t,this.onlyOnce=A,this.isDone=!1}_clone(){return new Rt(this.frame,this.action,this.onlyOnce)}}var Zt=A(10761),Lt=A(10824);class It{get loop(){return this._loop}set loop(d){d!==this._loop&&(this._loop=d,this.updateOptions({loop:d}))}get currentTime(){var d;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.audioContext&&(this.isPlaying||this.isPaused)){const d=this.isPaused?0:Lt.c.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+d}return 0}get spatialSound(){return this._spatialSound}set spatialSound(d){if(d==this._spatialSound)return;const t=this.isPlaying;this.pause(),d?(this._spatialSound=d,this._updateSpatialParameters()):this._disableSpatialSound(),t&&this.play()}constructor(d,t,A){var w;let p=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,X=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new D.b,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=N.l.Zero(),this._localDirection=new N.l(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=d,A=A||Q.e.LastCreatedScene)if(this._scene=A,It._SceneComponentInitialization(A),this._readyToPlayCallback=p,this._customAttenuationFunction=(d,t,A,w,N)=>t<A?d*(1-t/A):0,X&&(this.autoplay=X.autoplay||!1,this._loop=X.loop||!1,void 0!==X.volume&&(this._volume=X.volume),this._spatialSound=X.spatialSound??!1,this.maxDistance=X.maxDistance??100,this.useCustomAttenuation=X.useCustomAttenuation??!1,this.rolloffFactor=X.rolloffFactor||1,this.refDistance=X.refDistance||1,this.distanceModel=X.distanceModel||"linear",this._playbackRate=X.playbackRate||1,this._streaming=X.streaming??!1,this._length=X.length,this._offset=X.offset),null!==(w=Lt.c.audioEngine)&&void 0!==w&&w.canUseWebAudio&&Lt.c.audioEngine.audioContext){this._soundGain=Lt.c.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let d=!0;if(t)try{"string"===typeof t?(this._urlType="String",this._url=t):t instanceof ArrayBuffer?this._urlType="ArrayBuffer":t instanceof HTMLMediaElement?this._urlType="MediaElement":t instanceof MediaStream?this._urlType="MediaStream":t instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(t)&&(this._urlType="Array");let A=[],w=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Lt.c.audioEngine.audioContext.createMediaElementSource(t),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=Lt.c.audioEngine.audioContext.createMediaStreamSource(t),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":t.byteLength>0&&(w=!0,this._soundLoaded(t));break;case"AudioBuffer":this._audioBufferLoaded(t);break;case"String":A.push(t);case"Array":0===A.length&&(A=t);for(let d=0;d<A.length;d++){const t=A[d];if(w=X&&X.skipCodecCheck||-1!==t.indexOf(".mp3",t.length-4)&&Lt.c.audioEngine.isMP3supported||-1!==t.indexOf(".ogg",t.length-4)&&Lt.c.audioEngine.isOGGsupported||-1!==t.indexOf(".wav",t.length-4)||-1!==t.indexOf(".m4a",t.length-4)||-1!==t.indexOf(".mp4",t.length-4)||-1!==t.indexOf("blob:"),w){this._streaming?(this._htmlAudioElement=new Audio(t),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,B.g.SetCorsBehavior(t,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(t,(d=>{this._soundLoaded(d)}),void 0,!0,!0,(d=>{d&&P.e.Error("XHR "+d.status+" error on: "+t+"."),P.e.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:d=!1}d?w||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):P.e.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(W){P.e.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),Lt.c.audioEngine&&!Lt.c.audioEngine.WarnedWebAudioUnsupported&&(P.e.Error("Web Audio is not supported by your browser."),Lt.c.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var d;null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(d){var t;null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.audioContext&&(this._audioBuffer=d,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(d){var t;null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.audioContext&&Lt.c.audioEngine.audioContext.decodeAudioData(d,(d=>{this._audioBufferLoaded(d)}),(d=>{P.e.Error("Error while decoding audio data for: "+this.name+" / Error: "+d)}))}setAudioBuffer(d){var t;null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&(this._audioBuffer=d,this._isReadyToPlay=!0)}updateOptions(d){d&&(this.loop=d.loop??this.loop,this.maxDistance=d.maxDistance??this.maxDistance,this.useCustomAttenuation=d.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=d.rolloffFactor??this.rolloffFactor,this.refDistance=d.refDistance??this.refDistance,this.distanceModel=d.distanceModel??this.distanceModel,this._playbackRate=d.playbackRate??this._playbackRate,this._length=d.length??void 0,this.spatialSound=d.spatialSound??this._spatialSound,this._setOffset(d.offset??void 0),this.setVolume(d.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var d;null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&Lt.c.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??Lt.c.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var d;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(d=this._soundPanner)||void 0===d||d.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var d;null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(d){var t;null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(d),this._isOutputConnected=!0)}setDirectionalCone(d,t,A){t<d?P.e.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=d,this._coneOuterAngle=t,this._coneOuterGain=A,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(d){if(d!=this._coneInnerAngle){var t;if(this._coneOuterAngle<d)return void P.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=d,null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(d){if(d!=this._coneOuterAngle){var t;if(d<this._coneInnerAngle)return void P.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=d,null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(d){var t;d.equals(this._position)||(this._position.p(d),null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(d){var t;this._localDirection=d,null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const d=this._connectedTransformNode.getWorldMatrix(),t=N.l.TransformNormal(this._localDirection,d);t.normalize(),this._soundPanner.orientationX.value=t.x,this._soundPanner.orientationY.value=t.y,this._soundPanner.orientationZ.value=t.z}updateDistanceFromListener(){var d;if(null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const d=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Uc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,d,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(d){this._customAttenuationFunction=d}play(d,t,A){var w;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(w=Lt.c.audioEngine)&&void 0!==w&&w.audioContext)try{var N,p;this._clearTimeoutsAndObservers();let w=d?(null===(N=Lt.c.audioEngine)||void 0===N?void 0:N.audioContext.currentTime)+d:null===(p=Lt.c.audioEngine)||void 0===p?void 0:p.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=Lt.c.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const d=()=>{var A;if(null!==(A=Lt.c.audioEngine)&&void 0!==A&&A.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=t??0;const A=this._htmlAudioElement.play();void 0!==A&&A.catch((()=>{var t,A;(null===(t=Lt.c.audioEngine)||void 0===t||t.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(A=Lt.c.audioEngine)||void 0===A?void 0:A.onAudioUnlockedObservable.addOnce((()=>{d()})))}))}else{var w;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(w=Lt.c.audioEngine)||void 0===w?void 0:w.onAudioUnlockedObservable.addOnce((()=>{d()}))}};d()}}else{var B;const N=()=>{var N;if(null!==(N=Lt.c.audioEngine)&&void 0!==N&&N.audioContext){var p;if(A=A||this._length,void 0!==t&&this._setOffset(t),this._soundSource){const d=this._soundSource;d.onended=()=>{d.disconnect()}}if(this._soundSource=null===(p=Lt.c.audioEngine)||void 0===p?void 0:p.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var B;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==t&&(this._soundSource.loopStart=t),void 0!==A&&(this._soundSource.loopEnd=(0|t)+A),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},w=d?(null===(B=Lt.c.audioEngine)||void 0===B?void 0:B.audioContext.currentTime)+d:Lt.c.audioEngine.audioContext.currentTime;const N=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(w,N,this.loop?void 0:A)}}};"suspended"===(null===(B=Lt.c.audioEngine)||void 0===B?void 0:B.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var d;"suspended"===(null===(d=Lt.c.audioEngine)||void 0===d?void 0:d.audioContext.state)?(Lt.c.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=Lt.c.audioEngine.onAudioUnlockedObservable.addOnce((()=>{N()})))):N()}),500):N()}this._startTime=w,this.isPlaying=!0,this.isPaused=!1}catch(X){P.e.Error("Error while trying to play audio: "+this.name+", "+X.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(d){var t;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var A;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(A=this._streamingSource)||void 0===A||A.disconnect();this.isPlaying=!1}else if(null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.audioContext&&this._soundSource){const t=d?Lt.c.audioEngine.audioContext.currentTime+d:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(t)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var d;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var t;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(t=this._streamingSource)||void 0===t||t.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=Lt.c.audioEngine.audioContext.currentTime-this._startTime)}setVolume(d,t){var A;null!==(A=Lt.c.audioEngine)&&void 0!==A&&A.canUseWebAudio&&this._soundGain&&(t&&Lt.c.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(Lt.c.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,Lt.c.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(d,Lt.c.audioEngine.audioContext.currentTime+t)):this._soundGain.gain.value=d),this._volume=d}setPlaybackRate(d){this._playbackRate=d,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(d){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=d,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=d=>this._onRegisterAfterWorldMatrixUpdate(d),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(d){var t;if(d.getBoundingInfo){const t=d.getBoundingInfo();this.setPosition(t.boundingSphere.centerWorld)}else this.setPosition(d.absolutePosition);null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const d=()=>{this._isReadyToPlay?(A._audioBuffer=this.getAudioBuffer(),A._isReadyToPlay=!0,A.autoplay&&A.play(0,this._offset,this._length)):setTimeout(d,300)},t={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},A=new It(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,t);return this.useCustomAttenuation&&A.setAttenuationFunction(this._customAttenuationFunction),A.setPosition(this._position),A.setPlaybackRate(this._playbackRate),d(),A}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const d={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(d.connectedMeshId=this._connectedTransformNode.id),d.position=this._position.gj(),d.refDistance=this.refDistance,d.distanceModel=this.distanceModel,d.isDirectional=this._isDirectional,d.localDirectionToMesh=this._localDirection.gj(),d.coneInnerAngle=this._coneInnerAngle,d.coneOuterAngle=this._coneOuterAngle,d.coneOuterGain=this._coneOuterGain),d}static Parse(d,t,A,w){const p=d.name;let B;B=d.url?A+d.url:A+p;const X={autoplay:d.autoplay,loop:d.loop,volume:d.volume,spatialSound:d.spatialSound,maxDistance:d.maxDistance,rolloffFactor:d.rolloffFactor,refDistance:d.refDistance,distanceModel:d.distanceModel,playbackRate:d.playbackRate};let W;if(w){const d=()=>{w._isReadyToPlay?(W._audioBuffer=w.getAudioBuffer(),W._isReadyToPlay=!0,W.autoplay&&W.play(0,W._offset,W._length)):setTimeout(d,300)};W=new It(p,new ArrayBuffer(0),t,null,X),d()}else W=new It(p,B,t,(()=>{t.removePendingData(W)}),X),t.addPendingData(W);if(d.position){const t=N.l.Lg(d.position);W.setPosition(t)}if(d.isDirectional&&(W.setDirectionalCone(d.coneInnerAngle||360,d.coneOuterAngle||360,d.coneOuterGain||0),d.localDirectionToMesh)){const t=N.l.Lg(d.localDirectionToMesh);W.setLocalDirectionToMesh(t)}if(d.connectedMeshId){const A=t.getMeshById(d.connectedMeshId);A&&W.attachToMesh(A)}return d.metadata&&(W.metadata=d.metadata),W}_setOffset(d){this._offset!==d&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=d)}_clearTimeoutsAndObservers(){var d;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(d=Lt.c.audioEngine)||void 0===d||d.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}It._SceneComponentInitialization=d=>{throw(0,Zt.b)("AudioSceneComponent")},(0,v.g)("BABYLON.Sound",It);class ut{constructor(d,t,A){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],t.length!==A.length)throw new Error("Sounds length does not equal weights length");this.loop=d,this._weights=A;let w=0;for(const p of A)w+=p;const N=w>0?1/w:0;for(let p=0;p<this._weights.length;p++)this._weights[p]*=N;this._sounds=t;for(const p of this._sounds)p.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(d){if(d!==this._coneInnerAngle){if(this._coneOuterAngle<d)return void P.e.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=d;for(const t of this._sounds)t.directionalConeInnerAngle=d}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(d){if(d!==this._coneOuterAngle){if(d<this._coneInnerAngle)return void P.e.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=d;for(const t of this._sounds)t.directionalConeOuterAngle=d}}get volume(){return this._volume}set volume(d){if(d!==this._volume)for(const t of this._sounds)t.setVolume(d)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(d){if(!this.isPaused){this.stop();const d=Math.random();let t=0;for(let A=0;A<this._weights.length;A++)if(t+=this._weights[A],d<=t){this._currentIndex=A;break}}const t=this._sounds[this._currentIndex??0];t.isReady()?t.play(0,this.isPaused?void 0:d):t.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class Vt{constructor(d){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(d=d||Q.e.LastCreatedScene)&&(this._scene=d,this.soundCollection=[],this._options=t,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var d;null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.canUseWebAudio&&Lt.c.audioEngine.audioContext&&(this._outputAudioNode=Lt.c.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(Lt.c.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(Lt.c.audioEngine&&Lt.c.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(d){var t;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._outputAudioNode&&d.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==d.soundTrackId&&(-1===d.soundTrackId?this._scene.mainSoundTrack.removeSound(d):this._scene.soundTracks&&this._scene.soundTracks[d.soundTrackId].removeSound(d)),this.soundCollection.push(d),d.soundTrackId=this.id}removeSound(d){const t=this.soundCollection.indexOf(d);-1!==t&&this.soundCollection.splice(t,1)}setVolume(d){var t;null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=d)}switchPanningModelToHRTF(){var d;if(null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.canUseWebAudio)for(let t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var d;if(null!==(d=Lt.c.audioEngine)&&void 0!==d&&d.canUseWebAudio)for(let t=0;t<this.soundCollection.length;t++)this.soundCollection[t].switchPanningModelToEqualPower()}connectToAnalyser(d){var t;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=d,null!==(t=Lt.c.audioEngine)&&void 0!==t&&t.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,Lt.c.audioEngine.masterGain))}}var ht=A(11146),lt=A(11061),yt=(A(11616),A(10756));(0,A(11714).e)(ht.e.NAME_AUDIO,((d,t,A,w)=>{let N,p=[];if(A.ak=A.ak||[],void 0!==d.ak&&null!==d.ak)for(let X=0,W=d.ak.length;X<W;X++){var B;const W=d.ak[X];null!==(B=Lt.c.audioEngine)&&void 0!==B&&B.canUseWebAudio?(W.url||(W.url=W.name),p[W.url]?A.ak.push(It.Parse(W,t,w,p[W.url])):(N=It.Parse(W,t,w),p[W.url]=N,A.ak.push(N))):A.ak.push(new It(W.name,null,t))}p=[]})),Object.defineProperty(lt.e.prototype,"mainSoundTrack",{get:function(){let d=this._getComponent(ht.e.NAME_AUDIO);return d||(d=new st(this),this.o(d)),this._mainSoundTrack||(this._mainSoundTrack=new Vt(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),lt.e.prototype.getSoundByName=function(d){let t;for(t=0;t<this.mainSoundTrack.soundCollection.length;t++)if(this.mainSoundTrack.soundCollection[t].name===d)return this.mainSoundTrack.soundCollection[t];if(this.soundTracks)for(let A=0;A<this.soundTracks.length;A++)for(t=0;t<this.soundTracks[A].soundCollection.length;t++)if(this.soundTracks[A].soundCollection[t].name===d)return this.soundTracks[A].soundCollection[t];return null},Object.defineProperty(lt.e.prototype,"audioEnabled",{get:function(){let d=this._getComponent(ht.e.NAME_AUDIO);return d||(d=new st(this),this.o(d)),d.audioEnabled},set:function(d){let t=this._getComponent(ht.e.NAME_AUDIO);t||(t=new st(this),this.o(t)),d?t.enableAudio():t.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(lt.e.prototype,"headphone",{get:function(){let d=this._getComponent(ht.e.NAME_AUDIO);return d||(d=new st(this),this.o(d)),d.headphone},set:function(d){let t=this._getComponent(ht.e.NAME_AUDIO);t||(t=new st(this),this.o(t)),d?t.switchAudioModeForHeadphones():t.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(lt.e.prototype,"audioListenerPositionProvider",{get:function(){let d=this._getComponent(ht.e.NAME_AUDIO);return d||(d=new st(this),this.o(d)),d.audioListenerPositionProvider},set:function(d){let t=this._getComponent(ht.e.NAME_AUDIO);if(t||(t=new st(this),this.o(t)),d&&"function"!==typeof d)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");t.audioListenerPositionProvider=d},enumerable:!0,configurable:!0}),Object.defineProperty(lt.e.prototype,"audioListenerRotationProvider",{get:function(){let d=this._getComponent(ht.e.NAME_AUDIO);return d||(d=new st(this),this.o(d)),d.audioListenerRotationProvider},set:function(d){let t=this._getComponent(ht.e.NAME_AUDIO);if(t||(t=new st(this),this.o(t)),d&&"function"!==typeof d)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");t.audioListenerRotationProvider=d},enumerable:!0,configurable:!0}),Object.defineProperty(lt.e.prototype,"audioPositioningRefreshRate",{get:function(){let d=this._getComponent(ht.e.NAME_AUDIO);return d||(d=new st(this),this.o(d)),d.audioPositioningRefreshRate},set:function(d){let t=this._getComponent(ht.e.NAME_AUDIO);t||(t=new st(this),this.o(t)),t.audioPositioningRefreshRate=d},enumerable:!0,configurable:!0});class st{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(d){this.name=ht.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new N.l,this._cachedCameraPosition=new N.l,this._lastCheck=0,this._invertMatrixTemp=new N.c,this._cameraDirectionTemp=new N.l,(d=d||Q.e.LastCreatedScene)&&(this.Hf=d,d.soundTracks=[],d.ak=[])}register(){this.Hf._afterRenderStage.registerStep(ht.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(d){if(d.ak=[],this.Hf.soundTracks)for(let t=0;t<this.Hf.soundTracks.length;t++){const A=this.Hf.soundTracks[t];for(let t=0;t<A.soundCollection.length;t++)d.ak.push(A.soundCollection[t].serialize())}}addFromContainer(d){d.ak&&d.ak.forEach((d=>{d.play(),d.autoplay=!0,this.Hf.mainSoundTrack.addSound(d)}))}removeFromContainer(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];d.ak&&d.ak.forEach((d=>{d.stop(),d.autoplay=!1,this.Hf.mainSoundTrack.removeSound(d),t&&d.dispose()}))}dispose(){const d=this.Hf;if(d._mainSoundTrack&&d.mainSoundTrack.dispose(),d.soundTracks)for(let t=0;t<d.soundTracks.length;t++)d.soundTracks[t].dispose()}disableAudio(){const d=this.Hf;let t;for(this._audioEnabled=!1,Lt.c.audioEngine&&Lt.c.audioEngine.audioContext&&Lt.c.audioEngine.audioContext.suspend(),t=0;t<d.mainSoundTrack.soundCollection.length;t++)d.mainSoundTrack.soundCollection[t].pause();if(d.soundTracks)for(t=0;t<d.soundTracks.length;t++)for(let A=0;A<d.soundTracks[t].soundCollection.length;A++)d.soundTracks[t].soundCollection[A].pause()}enableAudio(){const d=this.Hf;let t;for(this._audioEnabled=!0,Lt.c.audioEngine&&Lt.c.audioEngine.audioContext&&Lt.c.audioEngine.audioContext.resume(),t=0;t<d.mainSoundTrack.soundCollection.length;t++)d.mainSoundTrack.soundCollection[t].isPaused&&d.mainSoundTrack.soundCollection[t].play();if(d.soundTracks)for(t=0;t<d.soundTracks.length;t++)for(let A=0;A<d.soundTracks[t].soundCollection.length;A++)d.soundTracks[t].soundCollection[A].isPaused&&d.soundTracks[t].soundCollection[A].play()}switchAudioModeForHeadphones(){const d=this.Hf;if(this._headphone=!0,d.mainSoundTrack.switchPanningModelToHRTF(),d.soundTracks)for(let t=0;t<d.soundTracks.length;t++)d.soundTracks[t].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const d=this.Hf;if(this._headphone=!1,d.mainSoundTrack.switchPanningModelToEqualPower(),d.soundTracks)for(let t=0;t<d.soundTracks.length;t++)d.soundTracks[t].switchPanningModelToEqualPower()}_afterRender(){const d=yt.d.Now;if(this._lastCheck&&d-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=d;const t=this.Hf;if(!this._audioEnabled||!t._mainSoundTrack||!t.soundTracks||0===t._mainSoundTrack.soundCollection.length&&1===t.soundTracks.length)return;const A=Lt.c.audioEngine;if(A&&A.audioContext){let d,w=t.activeCamera;if(t.activeCameras&&t.activeCameras.length>0&&(w=t.activeCameras[0]),this.audioListenerPositionProvider){const d=this.audioListenerPositionProvider();A.audioContext.listener.setPosition(d.x||0,d.y||0,d.z||0)}else w?this._cachedCameraPosition.equals(w.globalPosition)||(this._cachedCameraPosition.p(w.globalPosition),A.audioContext.listener.setPosition(w.globalPosition.x,w.globalPosition.y,w.globalPosition.z)):A.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const d=this.audioListenerRotationProvider();A.audioContext.listener.setOrientation(d.x||0,d.y||0,d.z||0,0,1,0)}else w?(w.rigCameras&&w.rigCameras.length>0&&(w=w.rigCameras[0]),w.getViewMatrix().invertToRef(this._invertMatrixTemp),N.l.TransformNormalToRef(st._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),A.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):A.audioContext.listener.setOrientation(0,0,0,0,1,0);for(d=0;d<t.mainSoundTrack.soundCollection.length;d++){const A=t.mainSoundTrack.soundCollection[d];A.useCustomAttenuation&&A.updateDistanceFromListener()}if(t.soundTracks)for(d=0;d<t.soundTracks.length;d++)for(let A=0;A<t.soundTracks[d].soundCollection.length;A++){const w=t.soundTracks[d].soundCollection[A];w.useCustomAttenuation&&w.updateDistanceFromListener()}}}}st._CameraDirection=new N.l(0,0,-1),It._SceneComponentInitialization=d=>{let t=d._getComponent(ht.e.NAME_AUDIO);t||(t=new st(d),d.o(t))};const Yt="MSFT_audio_emitter";class rt{constructor(d){this.name=Yt,this._loader=d,this.enabled=this._loader.isExtensionUsed(Yt)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const d=this._loader.Mi.extensions;if(d&&d[this.name]){const t=d[this.name];this._clips=t.clips,this._emitters=t.emitters,C.Assign(this._clips),C.Assign(this._emitters)}}loadSceneAsync(d,t){return E.LoadExtensionAsync(d,t,this.name,((A,w)=>{const N=new Array;N.push(this._loader.loadSceneAsync(d,t));for(const d of w.emitters){const t=C.Get(`${A}/emitters`,this._emitters,d);if(void 0!=t.refDistance||void 0!=t.maxDistance||void 0!=t.rolloffFactor||void 0!=t.distanceModel||void 0!=t.innerAngle||void 0!=t.outerAngle)throw new Error(`${A}: Direction or Distance properties are not allowed on emitters attached to a scene`);N.push(this._loadEmitterAsync(`${A}/emitters/${t.index}`,t))}return Promise.all(N).then((()=>{}))}))}loadNodeAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((d,w)=>{const p=new Array;return this._loader.loadNodeAsync(d,t,(t=>{for(const A of w.emitters){const w=C.Get(`${d}/emitters`,this._emitters,A);p.push(this._loadEmitterAsync(`${d}/emitters/${w.index}`,w).then((()=>{for(const d of w._babylonSounds)d.attachToMesh(t),void 0==w.innerAngle&&void 0==w.outerAngle||(d.setLocalDirectionToMesh(N.l.Forward()),d.setDirectionalCone(2*B.g.ToDegrees(void 0==w.innerAngle?Math.PI:w.innerAngle),2*B.g.ToDegrees(void 0==w.outerAngle?Math.PI:w.outerAngle),0))})))}A(t)})).then((d=>Promise.all(p).then((()=>d))))}))}loadAnimationAsync(d,t){return E.LoadExtensionAsync(d,t,this.name,((A,w)=>this._loader.loadAnimationAsync(d,t).then((N=>{const p=new Array;C.Assign(w.events);for(const B of w.events)p.push(this._loadAnimationEventAsync(`${A}/events/${B.index}`,d,t,B,N));return Promise.all(p).then((()=>N))}))))}_loadClipAsync(d,t){if(t._objectURL)return t._objectURL;let A;if(t.uri)A=this._loader.loadUriAsync(d,t,t.uri);else{const w=C.Get(`${d}/bufferView`,this._loader.Mi.bufferViews,t.bufferView);A=this._loader.loadBufferViewAsync(`/bufferViews/${w.index}`,w)}return t._objectURL=A.then((d=>URL.createObjectURL(new Blob([d],{type:t.mimeType})))),t._objectURL}_loadEmitterAsync(d,t){if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){const d=new Array,A=t.name||`emitter${t.index}`,w={loop:!1,autoplay:!1,volume:void 0==t.volume?1:t.volume};for(let p=0;p<t.clips.length;p++){const N=`/extensions/${this.name}/clips`,B=C.Get(N,this._clips,t.clips[p].clip);d.push(this._loadClipAsync(`${N}/${t.clips[p].clip}`,B).then((d=>{const N=t._babylonSounds[p]=new It(A,d,this._loader.babylonScene,null,w);N.refDistance=t.refDistance||1,N.maxDistance=t.maxDistance||256,N.rolloffFactor=t.rolloffFactor||1,N.distanceModel=t.distanceModel||"exponential"})))}const N=Promise.all(d).then((()=>{const d=t.clips.map((d=>d.weight||1)),A=new ut(t.loop||!1,t._babylonSounds,d);t.innerAngle&&(A.directionalConeInnerAngle=2*B.g.ToDegrees(t.innerAngle)),t.outerAngle&&(A.directionalConeOuterAngle=2*B.g.ToDegrees(t.outerAngle)),t.volume&&(A.volume=t.volume),t._babylonData.sound=A}));t._babylonData={loaded:N}}return t._babylonData.loaded}_getEventAction(d,t,A,w,N){switch(A){case"play":return d=>{const A=(N||0)+(d-w);t.play(A)};case"stop":return()=>{t.stop()};case"pause":return()=>{t.pause()};default:throw new Error(`${d}: Unsupported action ${A}`)}}_loadAnimationEventAsync(d,t,A,w,N){if(0==N.targetedAnimations.length)return Promise.resolve();const p=N.targetedAnimations[0],B=w.k,X=C.Get(`/extensions/${this.name}/emitters`,this._emitters,B);return this._loadEmitterAsync(d,X).then((()=>{const t=X._babylonData.sound;if(t){const A=new Rt(w.time,this._getEventAction(d,t,w.action,w.time,w.startOffset));p.animation.addEvent(A),N.onAnimationGroupEndObservable.add((()=>{t.stop()})),N.onAnimationGroupPauseObservable.add((()=>{t.pause()}))}}))}}x(Yt),M(Yt,!0,(d=>new rt(d)));const Kt="MSFT_lod";class Gt{constructor(d){var t;this.name=Kt,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new D.b,this.onMaterialLODsLoadedObservable=new D.b,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=d,this.maxLODsToLoad=(null===(t=this._loader.parent.extensionOptions[Kt])||void 0===t?void 0:t.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Kt)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let d=0;d<this._nodePromiseLODs.length;d++){const t=Promise.all(this._nodePromiseLODs[d]).then((()=>{0!==d&&(this._loader.endPerformanceCounter(`Node LOD ${d}`),this._loader.log(`Loaded node LOD ${d}`)),this.onNodeLODsLoadedObservable.notifyObservers(d),d!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${d+1}`),this._loadBufferLOD(this._nodeBufferLODs,d+1),this._nodeSignalLODs[d]&&this._nodeSignalLODs[d].resolve())}));this._loader._completePromises.push(t)}for(let d=0;d<this._materialPromiseLODs.length;d++){const t=Promise.all(this._materialPromiseLODs[d]).then((()=>{0!==d&&(this._loader.endPerformanceCounter(`Material LOD ${d}`),this._loader.log(`Loaded material LOD ${d}`)),this.onMaterialLODsLoadedObservable.notifyObservers(d),d!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${d+1}`),this._loadBufferLOD(this._materialBufferLODs,d+1),this._materialSignalLODs[d]&&this._materialSignalLODs[d].resolve())}));this._loader._completePromises.push(t)}}loadSceneAsync(d,t){const A=this._loader.loadSceneAsync(d,t);return this._loadBufferLOD(this._bufferLODs,0),A}loadNodeAsync(d,t,A){return E.LoadExtensionAsync(d,t,this.name,((d,N)=>{let p;const B=this._getLODs(d,t,this._loader.Mi.nodes,N.ids);this._loader.logOpen(`${d}`);for(let t=0;t<B.length;t++){const d=B[t];0!==t&&(this._nodeIndexLOD=t,this._nodeSignalLODs[t]=this._nodeSignalLODs[t]||new w);const N=d=>{A(d),d.Mf(!1)},X=this._loader.loadNodeAsync(`/nodes/${d.index}`,d,N).then((d=>{if(0!==t){const d=B[t-1];d._babylonTransformNode&&(this._disposeTransformNode(d._babylonTransformNode),delete d._babylonTransformNode)}return d.Mf(!0),d}));this._nodePromiseLODs[t]=this._nodePromiseLODs[t]||[],0===t?p=X:(this._nodeIndexLOD=null,this._nodePromiseLODs[t].push(X))}return this._loader.logClose(),p}))}_loadMaterialAsync(d,t,A,w,N){return this._nodeIndexLOD?null:E.LoadExtensionAsync(d,t,this.name,((d,p)=>{let B;const X=this._getLODs(d,t,this._loader.Mi.materials,p.ids);this._loader.logOpen(`${d}`);for(let t=0;t<X.length;t++){const d=X[t];0!==t&&(this._materialIndexLOD=t);const p=this._loader._loadMaterialAsync(`/materials/${d.index}`,d,A,w,(d=>{0===t&&N(d)})).then((d=>{if(0!==t){N(d);const A=X[t-1]._data;A[w]&&(this._disposeMaterials([A[w].babylonMaterial]),delete A[w])}return d}));this._materialPromiseLODs[t]=this._materialPromiseLODs[t]||[],0===t?B=p:(this._materialIndexLOD=null,this._materialPromiseLODs[t].push(p))}return this._loader.logClose(),B}))}_loadUriAsync(d,t,A){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const N=this._nodeIndexLOD-1;return this._nodeSignalLODs[N]=this._nodeSignalLODs[N]||new w,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(d,t,A)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const N=this._materialIndexLOD-1;return this._materialSignalLODs[N]=this._materialSignalLODs[N]||new w,this._materialSignalLODs[N].promise.then((()=>this._loader.loadUriAsync(d,t,A)))}return null}loadBufferAsync(d,t,A,N){if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error(`${d}: Uri is missing or the binary glTF is missing its binary chunk`);const t=(d,t)=>{const p=A,B=p+N-1;let X=d[t];return X?(X.start=Math.min(X.start,p),X.end=Math.max(X.end,B)):(X={start:p,end:B,loaded:new w},d[t]=X),X.loaded.promise.then((d=>new Uint8Array(d.buffer,d.byteOffset+A-X.start,N)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?t(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?t(this._materialBufferLODs,this._materialIndexLOD):t(this._bufferLODs,0)}return null}_loadBufferLOD(d,t){const A=d[t];A&&(this._loader.log(`Loading buffer range [${A.start}-${A.end}]`),this._loader.bin.readAsync(A.start,A.end-A.start+1).then((d=>{A.loaded.resolve(d)}),(d=>{A.loaded.reject(d)})))}_getLODs(d,t,A,w){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const N=[];for(let p=w.length-1;p>=0;p--)if(N.push(C.Get(`${d}/ids/${w[p]}`,A,w[p])),N.length===this.maxLODsToLoad)return N;return N.push(t),N}_disposeTransformNode(d){const t=[],A=d.material;A&&t.push(A);for(const N of d.getChildMeshes())N.material&&t.push(N.material);d.dispose();const w=t.filter((d=>this._loader.babylonScene.meshes.every((t=>t.material!=d))));this._disposeMaterials(w)}_disposeMaterials(d){const t={};for(const A of d){for(const d of A.getActiveTextures())t[d.uniqueId]=d;A.dispose()}for(const A in t)for(const d of this._loader.babylonScene.materials)d.hasTexture(t[A])&&delete t[A];for(const A in t)t[A].dispose()}}x(Kt),M(Kt,!0,(d=>new Gt(d)));const Ot="MSFT_minecraftMesh";class zt{constructor(d){this.name=Ot,this._loader=d,this.enabled=this._loader.isExtensionUsed(Ot)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtraAsync(d,t,this.name,((w,N)=>{if(N){if(!(A instanceof j))throw new Error(`${w}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(d,t,A);return A.needAlphaBlending()&&(A.forceDepthWrite=!0,A.separateCullingPass=!0),A.Tg=A.forceDepthWrite,A.twoSidedLighting=!0,N}return null}))}}x(Ot),M(Ot,!0,(d=>new zt(d)));const ct="MSFT_sRGBFactors";class et{constructor(d){this.name=ct,this._loader=d,this.enabled=this._loader.isExtensionUsed(ct)}dispose(){this._loader=null}loadMaterialPropertiesAsync(d,t,A){return E.LoadExtraAsync(d,t,this.name,((w,N)=>{if(N){if(!(A instanceof j))throw new Error(`${w}: Material type not supported`);const N=this._loader.loadMaterialPropertiesAsync(d,t,A),p=A.va().getEngine().useExactSrgbConversions;return A.albedoTexture||A.albedoColor.toLinearSpaceToRef(A.albedoColor,p),A.reflectivityTexture||A.reflectivityColor.toLinearSpaceToRef(A.reflectivityColor,p),N}return null}))}}x(ct),M(ct,!0,(d=>new et(d)));var Mt,xt=A(10894);!function(d){d[d.Input=0]="Input",d[d.Output=1]="Output"}(Mt||(Mt={}));class ot{constructor(d,t,A){this._ownerBlock=A,this._connectedPoint=[],this.uniqueId=(0,xt.c)(),this.connectedPointIds=[],this.name=d,this._connectionType=t}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(d){if(this._connectionType===d._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||d._isSingularConnection()&&d._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(d),d._connectedPoint.push(this)}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d.uniqueId=this.uniqueId,d.name=this.name,d._connectionType=this._connectionType,d.connectedPointIds=[],d.className=this.getClassName();for(const t of this._connectedPoint)d.connectedPointIds.push(t.uniqueId)}getClassName(){return"FGConnection"}deserialize(d){this.uniqueId=d.uniqueId,this.name=d.name,this._connectionType=d._connectionType,this.connectedPointIds=d.connectedPointIds}static Parse(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;const A=new(B.g.Instantiate(d.className))(d.name,d._connectionType,t);return A.deserialize(d),A}}class Ct{constructor(d){this.value=this._toInt(d)}_toInt(d){return 0|d}add(d){return new Ct(this.value+d.value)}Uc(d){return new Ct(this.value-d.value)}multiply(d){return new Ct(Math.imul(this.value,d.value))}divide(d){return new Ct(this.value/d.value)}getClassName(){return Ct.ClassName}equals(d){return this.value===d.value}static Parse(d){return new Ct(d.value)}}Ct.ClassName="FlowGraphInteger",(0,v.g)("FlowGraphInteger",Ct);class Et{constructor(d,t){this.typeName=d,this.defaultValue=t}serialize(d){d.typeName=this.typeName,d.defaultValue=this.defaultValue}static Parse(d){return new Et(d.typeName,d.defaultValue)}}const gt=new Et("any",void 0),St=(new Et("string",""),new Et("number",0)),dA=new Et("boolean",!1),tA=new Et("Vector2",N.j.Zero()),AA=new Et("gb",N.l.Zero()),wA=(new Et("Vector4",N.m.Zero()),new Et("Matrix",N.c.Identity())),NA=(new Et("jb",p.e.Black()),new Et("pb",new p.i(0,0,0,0)),new Et("Quaternion",N.f.Identity()),new Et("FlowGraphInteger",new Ct(0)));class pA extends ot{constructor(d,t,A,w){super(d,t,A),this.richType=w}_isSingularConnection(){return 0===this.connectionType}setValue(d,t){t._setConnectionValue(this,d)}connectTo(d){super.connectTo(d)}_getValueOrDefault(d){return d._hasConnectionValue(this)?d._getConnectionValue(this):this.richType.defaultValue}getValue(d){return 1===this.connectionType?(d._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(d),this._getValueOrDefault(d)):this.isConnected()?this._connectedPoint[0].getValue(d):this._getValueOrDefault(d)}getClassName(){return"FGDataConnection"}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(d),d.richType={},this.richType.serialize(d.richType)}static Parse(d,t){const A=ot.Parse(d,t);return A.richType=Et.Parse(d.richType),A}}function BA(d){return"Mesh"===d||"AbstractMesh"===d||"GroundMesh"===d||"InstanceMesh"===d||"LinesMesh"===d||"GoldbergMesh"===d||"GreasedLineMesh"===d||"TrailMesh"===d}function XA(d){return"Vector2"===d||"gb"===d||"Vector4"===d||"Quaternion"===d||"jb"===d||"pb"===d}function WA(d,t,A){var w;const N=(null===t||void 0===t||null===(w=t.getClassName)||void 0===w?void 0:w.call(t))??"";BA(N)?A[d]={name:t.name,className:N}:XA(N)?A[d]={value:t.gj(),className:N}:A[d]=t}function aA(d,t,A){const w=t[d];let B;const X=null===w||void 0===w?void 0:w.className;return B=BA(X)?A.getMeshByName(w.name):XA(X)?function(d,t){if("Vector2"===d)return N.j.Lg(t);if("gb"===d)return N.l.Lg(t);if("Vector4"===d)return N.m.Lg(t);if("Quaternion"===d)return N.f.Lg(t);if("jb"===d)return new p.e(t[0],t[1],t[2]);if("pb"===d)return new p.i(t[0],t[1],t[2],t[3]);throw new Error(`Unknown vector class name ${d}`)}(X,w.value):"Matrix"===X?N.c.Lg(w.value):X===Ct.ClassName?Ct.Parse(w):w&&void 0!==w.value?w.value:w,B}(0,v.g)("FGDataConnection",pA);class DA{constructor(d){var t;this.config=d,this.uniqueId=(0,xt.c)(),this.name=(null===(t=this.config)||void 0===t?void 0:t.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(d){}registerDataInput(d,t){const A=new pA(d,0,this,t);return this.dataInputs.push(A),A}registerDataOutput(d,t){const A=new pA(d,1,this,t);return this.dataOutputs.push(A),A}getDataInput(d){return this.dataInputs.find((t=>t.name===d))}getDataOutput(d){return this.dataOutputs.find((t=>t.name===d))}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d.uniqueId=this.uniqueId,d.config={},this.config&&(d.config.name=this.config.name),d.dataInputs=[],d.dataOutputs=[],d.className=this.getClassName();for(const t of this.dataInputs){const A={};t.serialize(A),d.dataInputs.push(A)}for(const t of this.dataOutputs){const A={};t.serialize(A),d.dataOutputs.push(A)}}getClassName(){return"FGBlock"}static Parse(d,t){const A=B.g.Instantiate(d.className),w={},N=t.valueParseFunction??aA;if(d.config)for(const B in d.config)w[B]=N(B,d.config,t.Hf);var p;("FGSetPropertyBlock"===(p=d.className)||"FGGetPropertyBlock"===p||"FGPlayAnimationBlock"===p||"FGMeshPickEventBlock"===p)&&(w.pathConverter=t.pathConverter);const X=new A(w);X.uniqueId=d.uniqueId;for(let B=0;B<d.dataInputs.length;B++){const t=X.getDataInput(d.dataInputs[B].name);if(!t)throw new Error("Could not find data input with name "+d.dataInputs[B].name+" in block "+d.className);t.deserialize(d.dataInputs[B])}for(let B=0;B<d.dataOutputs.length;B++){const t=X.getDataOutput(d.dataOutputs[B].name);if(!t)throw new Error("Could not find data output with name "+d.dataOutputs[B].name+" in block "+d.className);t.deserialize(d.dataOutputs[B])}return X.metadata=d.metadata,X.deserialize&&X.deserialize(d),X}}class iA extends ot{_isSingularConnection(){return 1===this.connectionType}_activateSignal(d){var t;0===this.connectionType?(d._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(d,this),d._increaseExecutionId()):null===(t=this._connectedPoint[0])||void 0===t||t._activateSignal(d)}}(0,v.g)("FlowGraphSignalConnection",iA);class kA extends DA{constructor(d){super(d),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(d){const t=new iA(d,0,this);return this.signalInputs.push(t),t}_registerSignalOutput(d){const t=new iA(d,1,this);return this.signalOutputs.push(t),t}getSignalInput(d){return this.signalInputs.find((t=>t.name===d))}getSignalOutput(d){return this.signalOutputs.find((t=>t.name===d))}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(d),d.signalInputs=[],d.signalOutputs=[];for(const t of this.signalInputs){const A={};t.serialize(A),d.signalInputs.push(A)}for(const t of this.signalOutputs){const A={};t.serialize(A),d.signalOutputs.push(A)}}deserialize(d){for(let t=0;t<d.signalInputs.length;t++){const A=this.getSignalInput(d.signalInputs[t].name);if(!A)throw new Error("Could not find signal input with name "+d.signalInputs[t].name+" in block "+d.className);A.deserialize(d.signalInputs[t])}for(let t=0;t<d.signalOutputs.length;t++){const A=this.getSignalOutput(d.signalOutputs[t].name);if(!A)throw new Error("Could not find signal output with name "+d.signalOutputs[t].name+" in block "+d.className);A.deserialize(d.signalOutputs[t])}}getClassName(){return"FGExecutionBlock"}}class bA extends kA{constructor(d){super(d),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(d){this._preparePendingTasks(d),d._addPendingBlock(this)}}class QA extends bA{_execute(d){d._notifyExecuteNode(this),this.out._activateSignal(d)}}class PA{constructor(d){this.uniqueId=(0,xt.c)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new D.b,this._configuration=d}hasVariable(d){return d in this._userVariables}setVariable(d,t){this._userVariables[d]=t}getVariable(d){return this._userVariables[d]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(d,t){return`${d.uniqueId}_${t}`}_setExecutionVariable(d,t,A){this._executionVariables[this._getUniqueIdPrefixedName(d,t)]=A}_getExecutionVariable(d,t,A){return this._hasExecutionVariable(d,t)?this._executionVariables[this._getUniqueIdPrefixedName(d,t)]:A}_deleteExecutionVariable(d,t){delete this._executionVariables[this._getUniqueIdPrefixedName(d,t)]}_hasExecutionVariable(d,t){return this._getUniqueIdPrefixedName(d,t)in this._executionVariables}_hasConnectionValue(d){return d.uniqueId in this._connectionValues}_setConnectionValue(d,t){this._connectionValues[d.uniqueId]=t}_getConnectionValue(d){return this._connectionValues[d.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(d){this._pendingBlocks.push(d)}_removePendingBlock(d){const t=this._pendingBlocks.indexOf(d);-1!==t&&this._pendingBlocks.splice(t,1)}_clearPendingBlocks(){for(const d of this._pendingBlocks)d._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(d){this.onNodeExecutedObservable.notifyObservers(d)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WA;d.uniqueId=this.uniqueId,d._userVariables={};for(const A in this._userVariables)t(A,this._userVariables[A],d._userVariables);d._connectionValues={};for(const A in this._connectionValues)t(A,this._connectionValues[A],d._connectionValues)}getClassName(){return"FGContext"}static Parse(d,t){const A=t.graph.createContext(),w=t.valueParseFunction??aA;A.uniqueId=d.uniqueId;for(const N in d._userVariables){const t=w(N,d._userVariables,A._configuration.Hf);A._userVariables[N]=t}for(const N in d._connectionValues){const t=w(N,d._connectionValues,A._configuration.Hf);A._connectionValues[N]=t}return A}}(0,F.b)([(0,q.J)()],PA.prototype,"uniqueId",void 0);var JA,UA,TA=A(11151);function FA(d,t){return!(!d.parent||d.parent!==t&&!FA(d.parent,t))}class qA extends QA{constructor(d){super(d),this.config=d}_getReferencedMesh(){const d=this.config.pathConverter.convert(this.config.path),t=d.info.getObject(d.object);if(!t||!(t instanceof I.d))throw new Error("Mesh pick event block requires a valid mesh");return t}_preparePendingTasks(d){let t=d._getExecutionVariable(this,"meshPickObserver");if(!t){const A=this._getReferencedMesh();d._setExecutionVariable(this,"mesh",A),t=A.va().onPointerObservable.add((t=>{var w,N,p;t.type===TA.e.POINTERPICK&&null!==(w=t.pickInfo)&&void 0!==w&&w.pickedMesh&&((null===(N=t.pickInfo)||void 0===N?void 0:N.pickedMesh)===A||FA(null===(p=t.pickInfo)||void 0===p?void 0:p.pickedMesh,A))&&this._execute(d)}));const w=A.hj.add((()=>this._onDispose));d._setExecutionVariable(this,"meshPickObserver",t),d._setExecutionVariable(this,"meshDisposeObserver",w)}}_onDispose(d){this._cancelPendingTasks(d),d._removePendingBlock(this)}_cancelPendingTasks(d){const t=d._getExecutionVariable(this,"mesh"),A=d._getExecutionVariable(this,"meshPickObserver"),w=d._getExecutionVariable(this,"meshDisposeObserver");t.va().onPointerObservable.remove(A),t.hj.remove(w),d._deleteExecutionVariable(this,"mesh"),d._deleteExecutionVariable(this,"meshPickObserver"),d._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return qA.ClassName}serialize(d){super.serialize(d),d.config.path=this.config.path}}qA.ClassName="FGMeshPickEventBlock",(0,v.g)(qA.ClassName,qA),function(d){d[d.Stopped=0]="Stopped",d[d.Started=1]="Started"}(JA||(JA={}));class HA{constructor(d){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=d.Hf,this._coordinator=d.coordinator,this._sceneDisposeObserver=this._scene.hj.add((()=>this.dispose()))}createContext(){const d=new PA({Hf:this._scene,coordinator:this._coordinator});return this._executionContexts.push(d),d}getContext(d){return this._executionContexts[d]}addEventBlock(d){this._eventBlocks.push(d)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const d of this._executionContexts){const t=this._getContextualOrder();for(const A of t)A._startPendingTasks(d)}}}_getContextualOrder(){const d=[];for(const t of this._eventBlocks)if(t.getClassName()===qA.ClassName){const A=t._getReferencedMesh();let w=0;for(;w<d.length;w++){const t=d[w]._getReferencedMesh();if(A&&t&&FA(A,t))break}d.splice(w,0,t)}else d.push(t);return d}dispose(){if(0!==this.state){this.state=0;for(const d of this._executionContexts)d._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.hj.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(d){const t=[],A=new Set;for(const w of this._eventBlocks)t.push(w),A.add(w.uniqueId);for(;t.length>0;){const w=t.pop();d(w);for(const d of w.dataInputs)for(const w of d._connectedPoint)A.has(w._ownerBlock.uniqueId)||(t.push(w._ownerBlock),A.add(w._ownerBlock.uniqueId));if(w instanceof kA)for(const d of w.signalOutputs)for(const w of d._connectedPoint)A.has(w._ownerBlock.uniqueId)||(t.push(w._ownerBlock),A.add(w._ownerBlock.uniqueId))}}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;d.allBlocks=[],this.visitAllBlocks((t=>{const A={};t.serialize(A),d.allBlocks.push(A)})),d.executionContexts=[];for(const A of this._executionContexts){const w={};A.serialize(w,t),d.executionContexts.push(w)}}static GetDataOutConnectionByUniqueId(d,t){for(const A of d)for(const d of A.dataOutputs)if(d.uniqueId===t)return d;throw new Error("Could not find data out connection with unique id "+t)}static GetSignalInConnectionByUniqueId(d,t){for(const A of d)if(A instanceof kA)for(const d of A.signalInputs)if(d.uniqueId===t)return d;throw new Error("Could not find signal in connection with unique id "+t)}static Parse(d,t){const A=t.coordinator.createGraph(),w=[],N=t.valueParseFunction??aA;for(const p of d.allBlocks){const d=DA.Parse(p,{Hf:t.coordinator.config.Hf,pathConverter:t.pathConverter,valueParseFunction:N});w.push(d),d instanceof QA&&A.addEventBlock(d)}for(const p of w){for(const d of p.dataInputs)for(const t of d.connectedPointIds){const A=HA.GetDataOutConnectionByUniqueId(w,t);d.connectTo(A)}if(p instanceof kA)for(const d of p.signalOutputs)for(const t of d.connectedPointIds){const A=HA.GetSignalInConnectionByUniqueId(w,t);d.connectTo(A)}}for(const p of d.executionContexts)PA.Parse(p,{graph:A,valueParseFunction:N});return A}}class fA{constructor(d){this.config=d,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Hf.hj.add((()=>{this.dispose()}));(fA.SceneCoordinators.get(this.config.Hf)??[]).push(this)}createGraph(){const d=new HA({Hf:this.config.Hf,coordinator:this});return this._flowGraphs.push(d),d}removeGraph(d){const t=this._flowGraphs.indexOf(d);-1!==t&&(d.dispose(),this._flowGraphs.splice(t,1))}start(){this._flowGraphs.forEach((d=>d.start()))}dispose(){this._flowGraphs.forEach((d=>d.dispose())),this._flowGraphs.length=0;const d=fA.SceneCoordinators.get(this.config.Hf)??[],t=d.indexOf(this);-1!==t&&d.splice(t,1)}serialize(d,t){d._flowGraphs=[],this._flowGraphs.forEach((A=>{const w={};A.serialize(w,t),d._flowGraphs.push(w)}))}static Parse(d,t){var A;const w=t.valueParseFunction??aA,N=new fA({Hf:t.Hf});return null===(A=d._flowGraphs)||void 0===A||A.forEach((d=>{HA.Parse(d,{coordinator:N,valueParseFunction:w,pathConverter:t.pathConverter})})),N}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(d){let t=this._customEventsMap.get(d);return t||(t=new D.b,this._customEventsMap.set(d,t)),t}notifyCustomEvent(d,t){const A=this._customEventsMap.get(d);A&&A.notifyObservers(t)}}fA.SceneCoordinators=new Map;class vA extends QA{_preparePendingTasks(d){if(!d._getExecutionVariable(this,"sceneReadyObserver")){const t=d.configuration.Hf.onReadyObservable.add((()=>{this._execute(d)}));d._setExecutionVariable(this,"sceneReadyObserver",t)}}_cancelPendingTasks(d){const t=d._getExecutionVariable(this,"sceneReadyObserver");d.configuration.Hf.onReadyObservable.remove(t),d._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return vA.ClassName}}vA.ClassName="FGSceneReadyEventBlock",(0,v.g)("FGSceneReadyEventBlock",vA);class mA extends QA{_preparePendingTasks(d){if(!d._getExecutionVariable(this,"sceneBeforeRender")){const t=d.configuration.Hf.onBeforeRenderObservable.add((()=>{this._execute(d)}));d._setExecutionVariable(this,"sceneBeforeRender",t)}}_cancelPendingTasks(d){const t=d._getExecutionVariable(this,"sceneBeforeRender");d.configuration.Hf.onBeforeRenderObservable.remove(t),d._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return mA.ClassName}}mA.ClassName="FGSceneTickEventBlock",(0,v.g)(mA.ClassName,mA);class jA extends kA{constructor(d){super(d),this.out=this._registerSignalOutput("out")}}class nA extends jA{constructor(d){super(d),this.message=this.registerDataInput("message",gt)}_execute(d){const t=this.message.getValue(d);P.e.Log(t),this.out._activateSignal(d)}getClassName(){return nA.ClassName}}nA.ClassName="FGConsoleLogBlock",(0,v.g)(nA.ClassName,nA),function(d){d[d.INIT=0]="INIT",d[d.STARTED=1]="STARTED",d[d.ENDED=2]="ENDED"}(UA||(UA={}));class RA{constructor(d){this.onEachCountObservable=new D.b,this.onTimerAbortedObservable=new D.b,this.onTimerEndedObservable=new D.b,this.onStateChangedObservable=new D.b,this._observer=null,this._breakOnNextTick=!1,this._tick=d=>{const t=Date.now();this._timer=t-this._startTime;const A={startTime:this._startTime,currentTime:t,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:d},w=this._breakOnNextTick||this._breakCondition(A);w||this._timer>=this._timeToEnd?this._stop(A,w):this.onEachCountObservable.notifyObservers(A)},this._setState(0),this._contextObservable=d.contextObservable,this._observableParameters=d.observableParameters??{},this._breakCondition=d.breakCondition??(()=>!1),this._timeToEnd=d.timeout,d.onEnded&&this.onTimerEndedObservable.add(d.onEnded),d._h&&this.onEachCountObservable.add(d._h),d.onAborted&&this.onTimerAbortedObservable.add(d.onAborted)}set breakCondition(d){this._breakCondition=d}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=d,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(d){this._state=d,this.onStateChangedObservable.notifyObservers(this._state)}_stop(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),t?this.onTimerAbortedObservable.notifyObservers(d):this.onTimerEndedObservable.notifyObservers(d)}}class ZA extends bA{constructor(d){super(d),this.timeout=this.registerDataInput("timeout",St)}_preparePendingTasks(d){const t=this.timeout.getValue(d);if(void 0!==t&&t>=0){const A=d._getExecutionVariable(this,"runningTimers")||[],w=d.configuration.Hf,N=new RA({timeout:t,contextObservable:w.onBeforeRenderObservable,onEnded:()=>this._onEnded(N,d)});N.start(),A.push(N),d._setExecutionVariable(this,"runningTimers",A)}}_execute(d){this._startPendingTasks(d),this.out._activateSignal(d)}_onEnded(d,t){const A=t._getExecutionVariable(this,"runningTimers")||[],w=A.indexOf(d);-1!==w?A.splice(w,1):B.g.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),t._removePendingBlock(this),this.done._activateSignal(t)}_cancelPendingTasks(d){const t=d._getExecutionVariable(this,"runningTimers")||[];for(const A of t)A.dispose();d._deleteExecutionVariable(this,"runningTimers")}getClassName(){return ZA.ClassName}}ZA.ClassName="FGTimerBlock",(0,v.g)("FGTimerBlock",ZA);class LA extends jA{constructor(d){super(d),this.config=d;for(let t=0;t<this.config.eventData.length;t++){const d=this.config.eventData[t];this.registerDataInput(d,gt)}}_execute(d){const t=this.config.eventId,A=this.dataInputs.map((t=>t.getValue(d)));d.configuration.coordinator.notifyCustomEvent(t,A),this.out._activateSignal(d)}getClassName(){return LA.ClassName}}LA.ClassName="FGSendCustomEventBlock",(0,v.g)("FGSendCustomEventBlock",LA);class IA extends QA{constructor(d){super(d),this.config=d;for(let t=0;t<this.config.eventData.length;t++){const d=this.config.eventData[t];this.registerDataOutput(d,gt)}}_preparePendingTasks(d){const t=d.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=t.add((t=>{for(let A=0;A<t.length;A++)this.dataOutputs[A].setValue(t[A],d);this._execute(d)}))}_cancelPendingTasks(d){const t=d.configuration.coordinator.getCustomEventObservable(this.config.eventId);t?t.remove(this._eventObserver):B.g.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return IA.ClassName}serialize(d){super.serialize(d),d.eventId=this.config.eventId,d.eventData=this.config.eventData}}IA.ClassName="FGReceiveCustomEventBlock",(0,v.g)(IA.ClassName,IA);class uA extends kA{constructor(d){super(d),this.config=d,this.outFlows=[];for(let t=0;t<this.config.numberOutputFlows;t++)this.outFlows.push(this._registerSignalOutput(`${t}`))}_execute(d){for(let t=0;t<this.config.numberOutputFlows;t++)this.outFlows[t]._activateSignal(d)}getClassName(){return uA.ClassName}}uA.ClassName="FGSequenceBlock",(0,v.g)(uA.ClassName,uA);const VA=new RegExp(/\{(\w+)\}/g);class hA{constructor(d,t){this.path=d,this.ownerBlock=t,this.templatedInputs=[];let A=VA.exec(d);for(;A;){const[,w]=A;this.templatedInputs.push(t.registerDataInput(w,NA)),A=VA.exec(d)}}getAccessor(d,t){let A=this.path;for(const w of this.templatedInputs){const d=w.getValue(t).value;A=A.replace(`{${w.name}}`,d.toString())}return d.convert(A)}}class lA extends DA{constructor(d){super(d),this.config=d,this.value=this.registerDataOutput("value",gt),this.templateComponent=new hA(d.path,this)}_updateOutputs(d){const t=this.templateComponent.getAccessor(this.config.pathConverter,d),A=t.info.get(t.object);this.value.setValue(A,d)}getClassName(){return lA.ClassName}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(d),d.config.path=this.config.path}}lA.ClassName="FGGetPropertyBlock",(0,v.g)(lA.ClassName,lA);class yA extends jA{constructor(d){super(d),this.config=d,this.a=this.registerDataInput("a",gt),this.templateComponent=new hA(d.path,this)}_execute(d){const t=this.a.getValue(d),A=this.templateComponent.getAccessor(this.config.pathConverter,d);A.info.set(t,A.object),this.out._activateSignal(d)}serialize(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(d),d.config.path=this.config.path}getClassName(){return yA.ClassName}}yA.ClassName="FGSetPropertyBlock",(0,v.g)("FGSetPropertyBlock",yA);const sA="cachedOperationValue",YA="cachedExecutionId";class rA extends DA{constructor(d,t){super(t),this.value=this.registerDataOutput("value",d)}_updateOutputs(d){const t=d._getExecutionVariable(this,YA),A=d._getExecutionVariable(this,sA);if(void 0!==A&&t===d.executionId)this.value.setValue(A,d);else{const t=this._doOperation(d);d._setExecutionVariable(this,sA,t),d._setExecutionVariable(this,YA,d.executionId),this.value.setValue(t,d)}}}class KA extends rA{constructor(d,t,A,w,N,p){super(A,p),this._operation=w,this._className=N,this.a=this.registerDataInput("a",d),this.b=this.registerDataInput("b",t)}_doOperation(d){return this._operation(this.a.getValue(d),this.b.getValue(d))}getClassName(){return this._className}}class GA extends rA{constructor(d,t,A,w){super(d,w),this._operation=t,this._className=A}_doOperation(d){return this._operation()}getClassName(){return this._className}}class OA extends rA{constructor(d,t,A,w,N){super(t,N),this._operation=A,this._className=w,this.a=this.registerDataInput("a",d)}_doOperation(d){return this._operation(this.a.getValue(d))}getClassName(){return this._className}}class zA extends rA{constructor(d,t,A,w,N,p,B){super(w,B),this._operation=N,this._className=p,this.a=this.registerDataInput("a",d),this.b=this.registerDataInput("b",t),this.c=this.registerDataInput("c",A)}_doOperation(d){return this._operation(this.a.getValue(d),this.b.getValue(d),this.c.getValue(d))}getClassName(){return this._className}}function cA(d){return d.getClassName?d.getClassName():""}function eA(d,t){return"Vector2"===d&&"Vector2"===t||"gb"===d&&"gb"===t||"Vector4"===d&&"Vector4"===t}function MA(d,t){return"Matrix"===d&&"Matrix"===t}function xA(d,t){return"FlowGraphInteger"===d&&"FlowGraphInteger"===t}class oA extends KA{constructor(d){super(gt,gt,gt,((d,t)=>this._polymorphicAdd(d,t)),oA.ClassName,d)}_polymorphicAdd(d,t){const A=cA(d),w=cA(t);return eA(A,w)||MA(A,w)||xA(A,w)?d.add(t):d+t}}oA.ClassName="FGAddBlock",(0,v.g)(oA.ClassName,oA);class CA extends KA{constructor(d){super(gt,gt,gt,((d,t)=>this._polymorphicAdd(d,t)),CA.ClassName,d)}_polymorphicAdd(d,t){const A=cA(d),w=cA(t);return eA(A,w)||xA(A,w)?d.Uc(t):MA(A,w)?d.add(t.scale(-1)):d-t}}CA.ClassName="FGSubBlock",(0,v.g)(CA.ClassName,CA);class EA extends KA{constructor(d){super(gt,gt,gt,((d,t)=>this._polymorphicMultiply(d,t)),EA.ClassName,d)}_polymorphicMultiply(d,t){const A=cA(d),w=cA(t);return eA(A,w)||xA(A,w)?d.multiply(t):MA(A,w)?N.c.FromValues(d.m[0]*t.m[0],d.m[4]*t.m[4],d.m[8]*t.m[8],d.m[12]*t.m[12],d.m[1]*t.m[1],d.m[5]*t.m[5],d.m[9]*t.m[9],d.m[13]*t.m[13],d.m[2]*t.m[2],d.m[6]*t.m[6],d.m[10]*t.m[10],d.m[14]*t.m[14],d.m[3]*t.m[3],d.m[7]*t.m[7],d.m[11]*t.m[11],d.m[15]*t.m[15]):d*t}}EA.ClassName="FGMultiplyBlock",(0,v.g)(EA.ClassName,EA);class gA extends KA{constructor(d){super(gt,gt,gt,((d,t)=>this._polymorphicDivide(d,t)),gA.ClassName,d)}_polymorphicDivide(d,t){const A=cA(d),w=cA(t);return eA(A,w)||xA(A,w)?d.divide(t):MA(A,w)?N.c.FromValues(d.m[0]/t.m[0],d.m[4]/t.m[4],d.m[8]/t.m[8],d.m[12]/t.m[12],d.m[1]/t.m[1],d.m[5]/t.m[5],d.m[9]/t.m[9],d.m[13]/t.m[13],d.m[2]/t.m[2],d.m[6]/t.m[6],d.m[10]/t.m[10],d.m[14]/t.m[14],d.m[3]/t.m[3],d.m[7]/t.m[7],d.m[11]/t.m[11],d.m[15]/t.m[15]):d/t}}gA.ClassName="FGDivideBlock",(0,v.g)(gA.ClassName,gA);class SA extends GA{constructor(d){super(St,(()=>Math.random()),SA.ClassName,d)}}SA.ClassName="FGRandomBlock",(0,v.g)(SA.ClassName,SA);class dw extends KA{constructor(d){super(gt,gt,St,((d,t)=>this._polymorphicDot(d,t)),dw.ClassName,d)}_polymorphicDot(d,t){switch(cA(d)){case"Vector2":return N.j.Dot(d,t);case"gb":return N.l.Dot(d,t);case"Vector4":return N.m.Dot(d,t);default:throw new Error(`Cannot get dot product of ${d} and ${t}`)}}}dw.ClassName="FGDotBlock",(0,v.g)(dw.ClassName,dw);class tw extends GA{constructor(d){super(St,(()=>Math.E),tw.ClassName,d)}}tw.ClassName="FGEBlock",(0,v.g)(tw.ClassName,tw);class Aw extends GA{constructor(d){super(St,(()=>Math.PI),Aw.ClassName,d)}}Aw.ClassName="FGPIBlock",(0,v.g)(Aw.ClassName,Aw);class ww extends GA{constructor(d){super(St,(()=>Number.POSITIVE_INFINITY),ww.ClassName,d)}}ww.ClassName="FGInfBlock",(0,v.g)(ww.ClassName,ww);class Nw extends GA{constructor(d){super(St,(()=>Number.NaN),Nw.ClassName,d)}}function pw(d,t){switch(cA(d)){case"FlowGraphInteger":return new Ct(t(d.value));case"Vector2":return new N.j(t(d.x),t(d.y));case"gb":return new N.l(t(d.x),t(d.y),t(d.z));case"Vector4":return new N.m(t(d.x),t(d.y),t(d.z),t(d.w));case"Matrix":return N.c.FromValues(t(d.m[0]),t(d.m[4]),t(d.m[8]),t(d.m[12]),t(d.m[1]),t(d.m[5]),t(d.m[9]),t(d.m[13]),t(d.m[2]),t(d.m[6]),t(d.m[10]),t(d.m[14]),t(d.m[3]),t(d.m[7]),t(d.m[11]),t(d.m[15]));default:return t(d)}}Nw.ClassName="FGNaNBlock",(0,v.g)(Nw.ClassName,Nw);class Bw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicAbs(d)),Bw.ClassName,d)}_polymorphicAbs(d){return pw(d,Math.abs)}}Bw.ClassName="FGAbsBlock",(0,v.g)(Bw.ClassName,Bw);class Xw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicSign(d)),Xw.ClassName,d)}_polymorphicSign(d){return pw(d,Math.sign)}}Xw.ClassName="FGSignBlock",(0,v.g)(Xw.ClassName,Xw);class Ww extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicTrunc(d)),Ww.ClassName,d)}_polymorphicTrunc(d){return pw(d,Math.trunc)}}Ww.ClassName="FGTruncBlock",(0,v.g)(Ww.ClassName,Ww);class aw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicFloor(d)),aw.ClassName,d)}_polymorphicFloor(d){return pw(d,Math.floor)}}aw.ClassName="FGFloorBlock",(0,v.g)(aw.ClassName,aw);class Dw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicCeiling(d)),Dw.ClassName,d)}_polymorphicCeiling(d){return pw(d,Math.ceil)}}Dw.ClassName="FGCeilBlock",(0,v.g)(Dw.ClassName,Dw);class iw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicFract(d)),iw.ClassName,d)}_polymorphicFract(d){return pw(d,(d=>d-Math.floor(d)))}}iw.ClassName="FGFractBlock",(0,v.g)(iw.ClassName,iw);class kw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicNeg(d)),kw.ClassName,d)}_polymorphicNeg(d){return pw(d,(d=>-d))}}function bw(d,t,A){switch(cA(d)){case"FlowGraphInteger":return new Ct(A(d.value,t.value));case"Vector2":return new N.j(A(d.x,t.x),A(d.y,t.y));case"gb":return new N.l(A(d.x,t.x),A(d.y,t.y),A(d.z,t.z));case"Vector4":return new N.m(A(d.x,t.x),A(d.y,t.y),A(d.z,t.z),A(d.w,t.w));case"Matrix":return N.c.FromValues(A(d.m[0],t.m[0]),A(d.m[4],t.m[4]),A(d.m[8],t.m[8]),A(d.m[12],t.m[12]),A(d.m[1],t.m[1]),A(d.m[5],t.m[5]),A(d.m[9],t.m[9]),A(d.m[13],t.m[13]),A(d.m[2],t.m[2]),A(d.m[6],t.m[6]),A(d.m[10],t.m[10]),A(d.m[14],t.m[14]),A(d.m[3],t.m[3]),A(d.m[7],t.m[7]),A(d.m[11],t.m[11]),A(d.m[15],t.m[15]));default:return A(d,t)}}kw.ClassName="FGNegBlock",(0,v.g)(kw.ClassName,kw);class Qw extends KA{constructor(d){super(gt,gt,gt,((d,t)=>this._polymorphicRemainder(d,t)),Qw.ClassName,d)}_polymorphicRemainder(d,t){return bw(d,t,((d,t)=>d%t))}}Qw.ClassName="FGRemainderBlock",(0,v.g)(Qw.ClassName,Qw);class Pw extends KA{constructor(d){super(gt,gt,gt,((d,t)=>this._polymorphicMin(d,t)),Pw.ClassName,d)}_polymorphicMin(d,t){return bw(d,t,Math.min)}}Pw.ClassName="FGMinBlock",(0,v.g)(Pw.ClassName,Pw);class Jw extends KA{constructor(d){super(gt,gt,gt,((d,t)=>this._polymorphicMax(d,t)),Jw.ClassName,d)}_polymorphicMax(d,t){return bw(d,t,Math.max)}}function Uw(d,t,A){return Math.min(Math.max(d,Math.min(t,A)),Math.max(t,A))}function Tw(d,t,A,w){switch(cA(d)){case"FlowGraphInteger":return new Ct(w(d.value,t.value,A.value));case"Vector2":return new N.j(w(d.x,t.x,A.x),w(d.y,t.y,A.y));case"gb":return new N.l(w(d.x,t.x,A.x),w(d.y,t.y,A.y),w(d.z,t.z,A.z));case"Vector4":return new N.m(w(d.x,t.x,A.x),w(d.y,t.y,A.y),w(d.z,t.z,A.z),w(d.w,t.w,A.w));case"Matrix":return N.c.FromValues(w(d.m[0],t.m[0],A.m[0]),w(d.m[4],t.m[4],A.m[4]),w(d.m[8],t.m[8],A.m[8]),w(d.m[12],t.m[12],A.m[12]),w(d.m[1],t.m[1],A.m[1]),w(d.m[5],t.m[5],A.m[5]),w(d.m[9],t.m[9],A.m[9]),w(d.m[13],t.m[13],A.m[13]),w(d.m[2],t.m[2],A.m[2]),w(d.m[6],t.m[6],A.m[6]),w(d.m[10],t.m[10],A.m[10]),w(d.m[14],t.m[14],A.m[14]),w(d.m[3],t.m[3],A.m[3]),w(d.m[7],t.m[7],A.m[7]),w(d.m[11],t.m[11],A.m[11]),w(d.m[15],t.m[15],A.m[15]));default:return w(d,t,A)}}Jw.ClassName="FGMaxBlock",(0,v.g)(Jw.ClassName,Jw);class Fw extends zA{constructor(d){super(gt,gt,gt,gt,((d,t,A)=>this._polymorphicClamp(d,t,A)),Fw.ClassName,d)}_polymorphicClamp(d,t,A){return Tw(d,t,A,Uw)}}function qw(d){return Math.min(Math.max(d,0),1)}Fw.ClassName="FGClampBlock",(0,v.g)(Fw.ClassName,Fw);class Hw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicSaturate(d)),Hw.ClassName,d)}_polymorphicSaturate(d){return pw(d,qw)}}Hw.ClassName="FGSaturateBlock",(0,v.g)(Hw.ClassName,Hw);class fw extends zA{constructor(d){super(gt,gt,gt,gt,((d,t,A)=>this._polymorphicInterpolate(d,t,A)),fw.ClassName,d)}_interpolate(d,t,A){return(1-A)*d+A*t}_polymorphicInterpolate(d,t,A){return Tw(d,t,A,this._interpolate)}}fw.ClassName="FGInterpolateBlock",(0,v.g)(fw.ClassName,fw);class vw extends KA{constructor(d){super(gt,gt,dA,((d,t)=>this._polymorphicEq(d,t)),vw.ClassName,d)}_polymorphicEq(d,t){const A=cA(d),w=cA(t);return eA(A,w)||MA(A,w)||xA(A,w)?d.equals(t):d===t}}function mw(d,t,A){const w=cA(d);if(w===cA(t)){if(""===w)return A(d,t);if("FlowGraphInteger"===w)return A(d.value,t.value);throw new Error(`Cannot compare ${d} and ${t}`)}throw new Error(`${d} and ${t} are of different types.`)}vw.ClassName="FGEqBlock",(0,v.g)(vw.ClassName,vw);class jw extends KA{constructor(d){super(gt,gt,dA,((d,t)=>this._polymorphicLessThan(d,t)),jw.ClassName,d)}_polymorphicLessThan(d,t){return mw(d,t,((d,t)=>d<t))}}jw.ClassName="FGLessThanBlock",(0,v.g)(jw.ClassName,jw);class nw extends KA{constructor(d){super(gt,gt,dA,((d,t)=>this._polymorphicLessThanOrEqual(d,t)),nw.ClassName,d)}_polymorphicLessThanOrEqual(d,t){return mw(d,t,((d,t)=>d<=t))}}nw.ClassName="FGLessThanOrEqualBlock";class Rw extends KA{constructor(d){super(gt,gt,dA,((d,t)=>this._polymorphicGreaterThan(d,t)),Rw.ClassName,d)}_polymorphicGreaterThan(d,t){return mw(d,t,((d,t)=>d>t))}}Rw.ClassName="FGGreaterThanBlock",(0,v.g)(Rw.ClassName,Rw);class Zw extends KA{constructor(d){super(gt,gt,dA,((d,t)=>this._polymorphicGreaterThanOrEqual(d,t)),Zw.ClassName,d)}_polymorphicGreaterThanOrEqual(d,t){return mw(d,t,((d,t)=>d>=t))}}Zw.ClassName="FGGreaterThanOrEqualBlock",(0,v.g)(Zw.ClassName,Zw);class Lw extends OA{constructor(d){super(gt,dA,(d=>this._polymorphicIsNan(d)),Lw.ClassName,d)}_polymorphicIsNan(d){const t=cA(d);if(""===t)return isNaN(d);if("FlowGraphInteger"===t)return isNaN(d.value);throw new Error(`Cannot get NaN of ${d}`)}}Lw.ClassName="FGIsNanBlock",(0,v.g)(Lw.ClassName,Lw);class Iw extends OA{constructor(d){super(gt,dA,(d=>this._polymorphicIsInf(d)),Iw.ClassName,d)}_polymorphicIsInf(d){const t=cA(d);if(""===t)return!isFinite(d);if("FlowGraphInteger"===t)return!isFinite(d.value);throw new Error(`Cannot get isInf of ${d}`)}}Iw.ClassName="FGIsInfBlock";class uw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicDegToRad(d)),uw.ClassName,d)}_degToRad(d){return d*Math.PI/180}_polymorphicDegToRad(d){return pw(d,this._degToRad)}}uw.ClassName="FGDegToRadBlock",(0,v.g)(uw.ClassName,uw);class Vw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicRadToDeg(d)),Vw.ClassName,d)}_radToDeg(d){return 180*d/Math.PI}_polymorphicRadToDeg(d){return pw(d,this._radToDeg)}}Vw.ClassName="FGRadToDegBlock",(0,v.g)(Vw.ClassName,Vw);class hw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicSin(d)),hw.ClassName,d)}_polymorphicSin(d){return pw(d,Math.sin)}}hw.ClassName="FGSinBlock",(0,v.g)(hw.ClassName,hw);class lw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicCos(d)),lw.ClassName,d)}_polymorphicCos(d){return pw(d,Math.cos)}}lw.ClassName="FGCosBlock",(0,v.g)(lw.ClassName,lw);class yw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicTan(d)),yw.ClassName,d)}_polymorphicTan(d){return pw(d,Math.tan)}}yw.ClassName="FGTanBlock",(0,v.g)(yw.ClassName,yw);class sw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicAsin(d)),sw.ClassName,d)}_polymorphicAsin(d){return pw(d,Math.asin)}}sw.ClassName="FGAsinBlock",(0,v.g)(sw.ClassName,sw);class Yw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicAcos(d)),Yw.ClassName,d)}_polymorphicAcos(d){return pw(d,Math.acos)}}Yw.ClassName="FGAcosBlock",(0,v.g)(Yw.ClassName,Yw);class rw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicAtan(d)),rw.ClassName,d)}_polymorphicAtan(d){return pw(d,Math.atan)}}rw.ClassName="FGAtanBlock",(0,v.g)(rw.ClassName,rw);class Kw extends KA{constructor(d){super(gt,gt,gt,((d,t)=>this._polymorphicAtan2(d,t)),Kw.ClassName,d)}_polymorphicAtan2(d,t){return bw(d,t,Math.atan2)}}Kw.ClassName="FGAtan2Block",(0,v.g)(Kw.ClassName,Kw);class Gw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicSinh(d)),Gw.ClassName,d)}_polymorphicSinh(d){return pw(d,Math.sinh)}}Gw.ClassName="FGSinhBlock",(0,v.g)(Gw.ClassName,Gw);class Ow extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicCosh(d)),Ow.ClassName,d)}_polymorphicCosh(d){return pw(d,Math.cosh)}}Ow.ClassName="FGCoshBlock",(0,v.g)(Ow.ClassName,Ow);class zw extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicTanh(d)),zw.ClassName,d)}_polymorphicTanh(d){return pw(d,Math.tanh)}}zw.ClassName="FGTanhBlock",(0,v.g)(zw.ClassName,zw);class cw extends OA{constructor(d){super(gt,St,(d=>this._polymorphicAsinh(d)),cw.ClassName,d)}_polymorphicAsinh(d){return pw(d,Math.asinh)}}cw.ClassName="FGAsinhBlock",(0,v.g)(cw.ClassName,cw);class ew extends OA{constructor(d){super(gt,St,(d=>this._polymorphicAcosh(d)),ew.ClassName,d)}_polymorphicAcosh(d){return pw(d,Math.acosh)}}ew.ClassName="FGAcoshBlock",(0,v.g)(ew.ClassName,ew);class Mw extends OA{constructor(d){super(gt,St,(d=>this._polymorphicAtanh(d)),Mw.ClassName,d)}_polymorphicAtanh(d){return pw(d,Math.atanh)}}Mw.ClassName="FGAtanhBlock",(0,v.g)(Mw.ClassName,Mw);class xw extends OA{constructor(d){super(gt,St,(d=>this._polymorphicExp(d)),xw.ClassName,d)}_polymorphicExp(d){return pw(d,Math.exp)}}xw.ClassName="FGExpBlock",(0,v.g)(xw.ClassName,xw);class ow extends OA{constructor(d){super(gt,St,(d=>this._polymorphicLog(d)),ow.ClassName,d)}_polymorphicLog(d){return pw(d,Math.log)}}ow.ClassName="FGLogBlock",(0,v.g)(ow.ClassName,ow);class Cw extends OA{constructor(d){super(gt,St,(d=>this._polymorphicLog2(d)),Cw.ClassName,d)}_polymorphicLog2(d){return pw(d,Math.log2)}}Cw.ClassName="FGLog2Block",(0,v.g)(Cw.ClassName,Cw);class Ew extends OA{constructor(d){super(gt,St,(d=>this._polymorphicLog10(d)),Ew.ClassName,d)}_polymorphicLog10(d){return pw(d,Math.log10)}}Ew.ClassName="FGLog10Block",(0,v.g)(Ew.ClassName,Ew);class gw extends OA{constructor(d){super(gt,St,(d=>this._polymorphicSqrt(d)),gw.ClassName,d)}_polymorphicSqrt(d){return pw(d,Math.sqrt)}}gw.ClassName="FGSqrtBlock",(0,v.g)(gw.ClassName,gw);class Sw extends OA{constructor(d){super(gt,St,(d=>this._polymorphicCubeRoot(d)),Sw.ClassName,d)}_polymorphicCubeRoot(d){return pw(d,Math.cbrt)}}Sw.ClassName="FGCubeRootBlock",(0,v.g)(Sw.ClassName,Sw);class dN extends KA{constructor(d){super(gt,St,St,((d,t)=>this._polymorphicPow(d,t)),dN.ClassName,d)}_polymorphicPow(d,t){return bw(d,t,Math.pow)}}dN.ClassName="FGPowBlock",(0,v.g)(dN.ClassName,dN);class tN extends OA{constructor(d){super(gt,St,(d=>this._polymorphicLength(d)),tN.ClassName,d)}_polymorphicLength(d){switch(cA(d)){case"Vector2":case"gb":case"Vector4":return d.length();default:throw new Error(`Cannot compute length of value ${d}`)}}}tN.ClassName="FGLengthBlock",(0,v.g)(tN.ClassName,tN);class AN extends OA{constructor(d){super(gt,gt,(d=>this._polymorphicNormalize(d)),AN.ClassName,d)}_polymorphicNormalize(d){switch(cA(d)){case"Vector2":case"gb":case"Vector4":return d.normalize();default:throw new Error(`Cannot normalize value ${d}`)}}}AN.ClassName="FGNormalizeBlock",(0,v.g)(AN.ClassName,AN);class wN extends KA{constructor(d){super(AA,AA,AA,((d,t)=>N.l.Cross(d,t)),wN.ClassName,d)}}wN.ClassName="FGCrossBlock",(0,v.g)(wN.ClassName,wN);class NN extends KA{constructor(d){super(tA,St,tA,((d,t)=>N.j.Transform(d,N.c.RotationZ(t))),NN.ClassName,d)}}NN.ClassName="FGRotate2DBlock",(0,v.g)(NN.ClassName,NN);class pN extends zA{constructor(d){super(AA,AA,St,AA,((d,t,A)=>N.l.TransformCoordinates(d,N.c.RotationAxis(t,A))),pN.ClassName,d)}}pN.ClassName="FGRotate3DBlock",(0,v.g)(pN.ClassName,pN);class BN extends OA{constructor(d){super(wA,wA,(d=>N.c.Transpose(d)),BN.ClassName,d)}}BN.ClassName="FGTransposeBlock",(0,v.g)(BN.ClassName,BN);class XN extends OA{constructor(d){super(wA,St,(d=>d.determinant()),XN.ClassName,d)}}XN.ClassName="FGDeterminantBlock",(0,v.g)(XN.ClassName,XN);class WN extends OA{constructor(d){super(wA,wA,(d=>N.c.Invert(d)),WN.ClassName,d)}}WN.ClassName="FGInvertMatrixBlock",(0,v.g)(WN.ClassName,WN);class aN extends KA{constructor(d){super(wA,wA,wA,((d,t)=>t.multiply(d)),aN.ClassName,d)}}aN.ClassName="FGMatMulBlock",(0,v.g)(aN.ClassName,aN);class DN extends OA{constructor(d){super(NA,NA,(d=>new Ct(~d.value)),DN.ClassName,d)}}DN.ClassName="FGBitwiseNotBlock",(0,v.g)(DN.ClassName,DN);class iN extends KA{constructor(d){super(NA,NA,NA,((d,t)=>new Ct(d.value&t.value)),iN.ClassName,d)}}iN.ClassName="FGBitwiseAndBlock",(0,v.g)(iN.ClassName,iN);class kN extends KA{constructor(d){super(NA,NA,NA,((d,t)=>new Ct(d.value|t.value)),kN.ClassName,d)}}kN.ClassName="FGBitwiseOrBlock",(0,v.g)(kN.ClassName,kN);class bN extends KA{constructor(d){super(NA,NA,NA,((d,t)=>new Ct(d.value^t.value)),bN.ClassName,d)}}bN.ClassName="FGBitwiseXorBlock",(0,v.g)(bN.ClassName,bN);class QN extends KA{constructor(d){super(NA,NA,NA,((d,t)=>new Ct(d.value<<t.value)),QN.ClassName,d)}}QN.ClassName="FGBitwiseLeftShiftBlock",(0,v.g)(QN.ClassName,QN);class PN extends KA{constructor(d){super(NA,NA,NA,((d,t)=>new Ct(d.value>>t.value)),PN.ClassName,d)}}PN.ClassName="FGBitwiseRightShiftBlock",(0,v.g)(PN.ClassName,PN);class JN extends OA{constructor(d){super(NA,NA,(d=>new Ct(Math.clz32(d.value))),JN.ClassName,d)}}JN.ClassName="FGCountLeadingZerosBlock",(0,v.g)(JN.ClassName,JN);class UN extends OA{constructor(d){super(NA,NA,(d=>new Ct(d.value?31-Math.clz32(d.value&-d.value):32)),UN.ClassName,d)}}UN.ClassName="FGCountTrailingZerosBlock",(0,v.g)(UN.ClassName,UN);class TN extends OA{constructor(d){super(NA,NA,(d=>new Ct(function(d){let t=0;for(;d;)t+=1&d,d>>=1;return t}(d.value))),TN.ClassName,d)}}TN.ClassName="FGCountOneBitsBlock",(0,v.g)(TN.ClassName,TN);class FN extends jA{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new Ct(0)};super(d),this.config=d,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",NA),this.value=this.registerDataOutput("value",NA)}_execute(d,t){if(t===this.reset)this.value.setValue(this.config.startIndex,d);else{const t=this.value.getValue(d);t.value<this.n.getValue(d).value&&(this.value.setValue(new Ct(t.value+1),d),this.out._activateSignal(d))}}getClassName(){return FN.ClassName}}FN.ClassName="FGDoNBlock",(0,v.g)(FN.ClassName,FN);class qN extends DA{constructor(d){super(d),this.config=d,this.output=this.registerDataOutput(d.variableName,gt)}_updateOutputs(d){const t=this.config.variableName;d.hasVariable(t)&&this.output.setValue(d.getVariable(t),d)}getClassName(){return qN.ClassName}serialize(d){super.serialize(d),d.config.variableName=this.config.variableName}}qN.ClassName="FGGetVariableBlock",(0,v.g)(qN.ClassName,qN);class HN extends jA{constructor(d){super(d),this.config=d,this.input=this.registerDataInput(d.variableName,gt)}_execute(d){const t=this.config.variableName,A=this.input.getValue(d);d.setVariable(t,A),this.out._activateSignal(d)}getClassName(){return HN.ClassName}}HN.ClassName="FGSetVariableBlock",(0,v.g)(HN.ClassName,HN);class fN extends jA{constructor(d){super(d),this.config=d,this.condition=this.registerDataInput("condition",dA),this.loopBody=this._registerSignalOutput("loopBody")}_execute(d,t){var A;let w=this.condition.getValue(d);for(null!==(A=this.config)&&void 0!==A&&A.isDo&&!w&&this.loopBody._activateSignal(d);w;)this.loopBody._activateSignal(d),w=this.condition.getValue(d);this.out._activateSignal(d)}getClassName(){return fN.ClassName}serialize(d){var t;super.serialize(d),d.isDo=null===(t=this.config)||void 0===t?void 0:t.isDo}}fN.ClassName="FGWhileLoopBlock",(0,v.g)(fN.ClassName,fN);const vN={"lifecycle/onStart":vA.ClassName,"lifecycle/onTick":mA.ClassName,log:nA.ClassName,"flow/delay":ZA.ClassName,"customEvent/send":LA.ClassName,"customEvent/receive":IA.ClassName,"flow/sequence":uA.ClassName,"world/get":lA.ClassName,"world/set":yA.ClassName,"flow/doN":FN.ClassName,"variable/get":qN.ClassName,"variable/set":HN.ClassName,"flow/whileLoop":fN.ClassName,"math/random":SA.ClassName,"math/e":tw.ClassName,"math/pi":Aw.ClassName,"math/inf":ww.ClassName,"math/nan":Nw.ClassName,"math/abs":Bw.ClassName,"math/sign":Xw.ClassName,"math/trunc":Ww.ClassName,"math/floor":aw.ClassName,"math/ceil":Dw.ClassName,"math/fract":iw.ClassName,"math/neg":kw.ClassName,"math/add":oA.ClassName,"math/sub":CA.ClassName,"math/mul":EA.ClassName,"math/div":gA.ClassName,"math/rem":Qw.ClassName,"math/min":Pw.ClassName,"math/max":Jw.ClassName,"math/clamp":Fw.ClassName,"math/saturate":Hw.ClassName,"math/mix":fw.ClassName,"math/eq":vw.ClassName,"math/lt":jw.ClassName,"math/le":nw.ClassName,"math/gt":Rw.ClassName,"math/ge":Zw.ClassName,"math/isnan":Lw.ClassName,"math/isinf":Iw.ClassName,"math/rad":uw.ClassName,"math/deg":Vw.ClassName,"math/sin":hw.ClassName,"math/cos":lw.ClassName,"math/tan":yw.ClassName,"math/asin":sw.ClassName,"math/acos":Yw.ClassName,"math/atan":rw.ClassName,"math/atan2":Kw.ClassName,"math/sinh":Gw.ClassName,"math/cosh":Ow.ClassName,"math/tanh":zw.ClassName,"math/asinh":cw.ClassName,"math/acosh":ew.ClassName,"math/atanh":Mw.ClassName,"math/exp":xw.ClassName,"math/log":ow.ClassName,"math/log2":Cw.ClassName,"math/log10":Ew.ClassName,"math/sqrt":gw.ClassName,"math/cbrt":Sw.ClassName,"math/pow":dN.ClassName,"math/length":tN.ClassName,"math/normalize":AN.ClassName,"math/dot":dw.ClassName,"math/cross":wN.ClassName,"math/rotate2d":NN.ClassName,"math/rotate3d":pN.ClassName,"math/transpose":BN.ClassName,"math/determinant":XN.ClassName,"math/inverse":WN.ClassName,"math/matmul":aN.ClassName,"math/not":DN.ClassName,"math/and":iN.ClassName,"math/or":kN.ClassName,"math/xor":bN.ClassName,"math/asr":PN.ClassName,"math/lsl":QN.ClassName,"math/clz":JN.ClassName,"math/ctz":UN.ClassName,"math/popcnt":TN.ClassName},mN={float2:"Vector2",float3:"gb",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function jN(d,t,A){if(void 0!==d.type){const w=t.types&&t.types[d.type];if(!w)throw new Error(`${A}: Unknown type: ${d.type}`);const N=w.signature;if(!N)throw new Error(`${A}: Type ${d.type} has no signature`);const p=mN[N];return{value:d.value,className:p}}return d.value}function nN(d,t,A){const w=vN[t.type];if(!w)throw new Error(`/extensions/KHR_interactivity/nodes/${d}: Unknown block type: ${t.type}`);const N=d.toString(),p=function(d,t,A){const w={},N=d.configuration??[];for(const p of N)if("customEvent"===p.id){const d=t.customEvents&&t.customEvents[p.value];if(!d)throw new Error(`/extensions/KHR_interactivity/nodes/${A}: Unknown custom event: ${p.value}`);w.eventId=d.id,w.eventData=d.values.map((d=>d.id))}else if("variable"===p.id){const d=t.variables&&t.variables[p.value];if(!d)throw new Error(`/extensions/KHR_interactivity/nodes/${A}: Unknown variable: ${p.value}`);w.variableName=d.id}else if("path"===p.id){const d=p.value;w.path=d}else w[p.id]=jN(p,t,`/extensions/KHR_interactivity/nodes/${A}`);return w}(t,A,N);return{className:w,config:p,uniqueId:N,metadata:t.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class RN extends vt{constructor(d){super(d,LN)}}const ZN={__array__:{__target__:!0,translation:{type:"gb",get:d=>d._babylonTransformNode.position,set:(d,t)=>{t._babylonTransformNode.position=d},getObject:d=>d._babylonTransformNode}}},LN={nodes:ZN},IN="KHR_interactivity";class uN{constructor(d){this._loader=d,this.name=IN,this.enabled=this._loader.isExtensionUsed(IN),this._pathConverter=new RN(this._loader.Mi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var d;if(!this._loader.babylonScene||!this._pathConverter)return;const t=this._loader.babylonScene,A=function(d){const t={uniqueId:(0,xt.c)(),_userVariables:{},_connectionValues:{}},A=[t],w=[];for(let p=0;p<d.nodes.length;p++){const t=nN(p,d.nodes[p],d);w.push(t)}for(let p=0;p<d.nodes.length;p++){const A=d.nodes[p],N=w[p],B=A.flows??[];for(const d of B){const t=d.id,A={uniqueId:(0,xt.c)(),name:t,_connectionType:1,connectedPointIds:[]};N.signalOutputs.push(A);const B=d.node,X=d.socket,W=w[B];if(!W)throw new Error(`/extensions/KHR_interactivity/nodes/${p}: Could not find node with id ${B} that connects its input with with node ${p}'s output ${t}`);let a=W.signalInputs.find((d=>d.name===X));a||(a={uniqueId:(0,xt.c)(),name:X,_connectionType:0,connectedPointIds:[]},W.signalInputs.push(a)),a.connectedPointIds.push(A.uniqueId),A.connectedPointIds.push(a.uniqueId)}const X=A.values??[];for(const W of X){const A=W.id,B={uniqueId:(0,xt.c)(),name:A,_connectionType:0,connectedPointIds:[]};if(N.dataInputs.push(B),void 0!==W.value){const A=jN(W,d,`/extensions/KHR_interactivity/nodes/${p}`);t._connectionValues[B.uniqueId]=A}else{if(void 0===W.node||void 0===W.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${p}: Invalid socket ${A} in node ${p}`);{const d=W.node,t=W.socket,N=w[d];if(!N)throw new Error(`/extensions/KHR_interactivity/nodes/${p}: Could not find node with id ${d} that connects its output with node${p}'s input ${A}`);let X=N.dataOutputs.find((d=>d.name===t));X||(X={uniqueId:(0,xt.c)(),name:t,_connectionType:1,connectedPointIds:[]},N.dataOutputs.push(X)),B.connectedPointIds.push(X.uniqueId),X.connectedPointIds.push(B.uniqueId)}}}}const N=d.variables??[];for(let p=0;p<N.length;p++){const A=N[p],w=A.id;t._userVariables[w]=jN(A,d,`/extensions/KHR_interactivity/variables/${p}`)}return{allBlocks:w,executionContexts:A}}(null===(d=this._loader.Mi.extensions)||void 0===d?void 0:d.KHR_interactivity),w=new fA({Hf:t});HA.Parse(A,{coordinator:w,pathConverter:this._pathConverter}),w.start()}}x(IN),M(IN,!0,(d=>new uN(d)));const VN="KHR_node_visibility";class hN{constructor(d){this.name=VN,this._loader=d,this.enabled=d.isExtensionUsed(VN)}async onReady(){var d;null===(d=this._loader.Mi.nodes)||void 0===d||d.forEach((d=>{var t,A,w,N;(null===(t=d._primitiveBabylonMeshes)||void 0===t||t.forEach((d=>{d.inheritVisibility=!0})),null!==(A=d.extensions)&&void 0!==A&&A.KHR_node_visibility)&&(!1===(null===(w=d.extensions)||void 0===w?void 0:w.KHR_node_visibility.visible)&&(d._babylonTransformNode&&(d._babylonTransformNode.isVisible=!1),null===(N=d._primitiveBabylonMeshes)||void 0===N||N.forEach((d=>{d.isVisible=!1}))))}))}dispose(){this._loader=null}}x(VN),M(VN,!0,(d=>new hN(d)));const lN="ExtrasAsMetadata";class yN{_assignExtras(d,t){if(t.extras&&Object.keys(t.extras).length>0){const A=d.metadata=d.metadata||{};(A.Mi=A.Mi||{}).extras=t.extras}}constructor(d){this.name=lN,this.enabled=!0,this._loader=d}dispose(){this._loader=null}loadNodeAsync(d,t,A){return this._loader.loadNodeAsync(d,t,(d=>{this._assignExtras(d,t),A(d)}))}loadCameraAsync(d,t,A){return this._loader.loadCameraAsync(d,t,(d=>{this._assignExtras(d,t),A(d)}))}createMaterial(d,t,A){const w=this._loader.createMaterial(d,t,A);return this._assignExtras(w,t),w}}x(lN),M(lN,!1,(d=>new yN(d)))},12061:(d,t,A)=>{"use strict";A.d(t,{b:()=>I,c:()=>m,e:()=>v,i:()=>j});var w=A(10730),N=A(10727),p=A(11420),B=A(11309),X=A(11353),W=A(11350),a=A(10740),D=A(10775),i=A(12065),k=A(12069),b=A(11320);class Q{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this.nj=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.ak=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(d){this._environmentTexture=d}getNodes(){let d=[];return d=d.concat(this.meshes),d=d.concat(this.lights),d=d.concat(this.cameras),d=d.concat(this.transformNodes),this.skeletons.forEach((t=>d=d.concat(t.bones))),d}}class P extends Q{}class J{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((d=>{d.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((d=>{d.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((d=>{d.dispose()})),this.animationGroups.length=0}}class U extends Q{constructor(d){super(),this._wasAddedToScene=!1,(d=d||D.e.LastCreatedScene)&&(this.Hf=d,this.proceduralTextures=[],d.hj.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=d.getEngine().onContextRestoredObservable.add((()=>{for(const d of this.geometries)d._rebuild();for(const d of this.meshes)d._rebuild();for(const d of this.nj)d.rebuild();for(const d of this.textures)d._rebuild()})))}_topologicalSort(d){const t=new Map;for(const B of d)t.set(B.uniqueId,B);const A={dependsOn:new Map,dependedBy:new Map};for(const B of d){const d=B.uniqueId;A.dependsOn.set(d,new Set),A.dependedBy.set(d,new Set)}for(const B of d){const d=B.uniqueId,w=A.dependsOn.get(d);if(B instanceof i.b){const N=B.sourceMesh;t.has(N.uniqueId)&&(w.add(N.uniqueId),A.dependedBy.get(N.uniqueId).add(d))}const N=A.dependedBy.get(d);for(const p of B.getDescendants()){const w=p.uniqueId;if(t.has(w)){N.add(w);A.dependsOn.get(w).add(d)}}}const w=[],N=[];for(const B of d){const d=B.uniqueId;0===A.dependsOn.get(d).size&&(N.push(B),t.delete(d))}const p=N;for(;p.length>0;){const d=p.shift();w.push(d);const N=A.dependedBy.get(d.uniqueId);for(const w of Array.from(N.values())){const N=A.dependsOn.get(w);N.delete(d.uniqueId),0===N.size&&t.get(w)&&(p.push(t.get(w)),t.delete(w))}}return t.size>0&&(a.e.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),t.forEach((d=>a.e.Error(d.name)))),w}_addNodeAndDescendantsToList(d,t,A,w){if(A&&(!w||w(A))&&!t.has(A.uniqueId)){d.push(A),t.add(A.uniqueId);for(const N of A.getDescendants(!0))this._addNodeAndDescendantsToList(d,t,N,w)}}_isNodeInContainer(d){return d instanceof W.d&&-1!==this.meshes.indexOf(d)||(d instanceof X.e&&-1!==this.transformNodes.indexOf(d)||(d instanceof k.c&&-1!==this.lights.indexOf(d)||d instanceof b.d&&-1!==this.cameras.indexOf(d)))}_isValidHierarchy(){for(const d of this.meshes)if(d.parent&&!this._isNodeInContainer(d.parent))return a.e.Warn(`Node ${d.name} has a parent that is not in the container.`),!1;for(const d of this.transformNodes)if(d.parent&&!this._isNodeInContainer(d.parent))return a.e.Warn(`Node ${d.name} has a parent that is not in the container.`),!1;for(const d of this.lights)if(d.parent&&!this._isNodeInContainer(d.parent))return a.e.Warn(`Node ${d.name} has a parent that is not in the container.`),!1;for(const d of this.cameras)if(d.parent&&!this._isNodeInContainer(d.parent))return a.e.Warn(`Node ${d.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(d){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],A=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||N.g.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const w={},p={},X=new J,W=[],a=[],D={doNotInstantiate:!0,...A},i=[],k=new Set;for(const N of this.transformNodes)null===N.parent&&this._addNodeAndDescendantsToList(i,k,N,D.predicate);for(const N of this.meshes)null===N.parent&&this._addNodeAndDescendantsToList(i,k,N,D.predicate);const b=this._topologicalSort(i),Q=(A,N)=>{if(((t,A)=>{if(w[t.uniqueId]=A.uniqueId,p[A.uniqueId]=A,d&&(A.name=d(t.name)),A instanceof B.d){const d=A;if(d.morphTargetManager){const A=t.morphTargetManager;d.morphTargetManager=A.clone();for(let t=0;t<A.numTargets;t++){const N=A.getTarget(t),B=d.morphTargetManager.getTarget(t);w[N.uniqueId]=B.uniqueId,p[B.uniqueId]=B}}}})(A,N),A.parent){const d=w[A.parent.uniqueId],t=p[d];N.parent=t||A.parent}if(N.position&&A.position&&N.position.p(A.position),N.rotationQuaternion&&A.rotationQuaternion&&N.rotationQuaternion.p(A.rotationQuaternion),N.rotation&&A.rotation&&N.rotation.p(A.rotation),N.Gf&&A.Gf&&N.Gf.p(A.Gf),N.material){const B=N;if(B.material)if(t){const t=A.material;if(-1===a.indexOf(t)){let A=t.clone(d?d(t.name):"Clone of "+t.name);if(a.push(t),w[t.uniqueId]=A.uniqueId,p[A.uniqueId]=A,"MultiMaterial"===t.getClassName()){const N=t;for(const t of N.Kf)t&&(A=t.clone(d?d(t.name):"Clone of "+t.name),a.push(t),w[t.uniqueId]=A.uniqueId,p[A.uniqueId]=A);N.Kf=N.Kf.map((d=>d&&p[w[d.uniqueId]]))}}"InstancedMesh"!==B.getClassName()&&(B.material=p[w[t.uniqueId]])}else"MultiMaterial"===B.material.getClassName()?-1===this.Hf.multiMaterials.indexOf(B.material)&&this.Hf.addMultiMaterial(B.material):-1===this.Hf.materials.indexOf(B.material)&&this.Hf.addMaterial(B.material)}null===N.parent&&X.rootNodes.push(N)};return b.forEach((d=>{if("InstancedMesh"===d.getClassName()){const t=d,A=t.sourceMesh,N=w[A.uniqueId],B=("number"===typeof N?p[N]:A).qd(t.name);Q(t,B)}else{let t=!0;"tb"===d.getClassName()||"Node"===d.getClassName()||d.skeleton||!d.getTotalVertices||0===d.getTotalVertices()?t=!1:D.doNotInstantiate&&(t="function"===typeof D.doNotInstantiate?!D.doNotInstantiate(d):!D.doNotInstantiate);const A=t?d.qd(`instance of ${d.name}`):d.clone(`Clone of ${d.name}`,null,!0);if(!A)throw new Error(`Could not clone or instantiate node on Asset Container ${d.name}`);Q(d,A)}})),this.skeletons.forEach((t=>{if(D.predicate&&!D.predicate(t))return;const A=t.clone(d?d(t.name):"Clone of "+t.name);for(const d of this.meshes)if(d.skeleton===t&&!d.isAnInstance){const t=p[w[d.uniqueId]];if(!t||t.isAnInstance)continue;if(t.skeleton=A,-1!==W.indexOf(A))continue;W.push(A);for(const d of A.bones)d._linkedTransformNode&&(d._linkedTransformNode=p[w[d._linkedTransformNode.uniqueId]])}X.skeletons.push(A)})),this.animationGroups.forEach((t=>{if(D.predicate&&!D.predicate(t))return;const A=t.clone(d?d(t.name):"Clone of "+t.name,(d=>p[w[d.uniqueId]]||d));X.animationGroups.push(A)})),X}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||N.g.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Hf.environmentTexture=this.environmentTexture);for(const d of this.Hf._serializableComponents)d.addFromContainer(this);this.Hf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const t=[];this.cameras.forEach((A=>{d&&!d(A)||(this.Hf.addCamera(A),t.push(A))})),this.lights.forEach((A=>{d&&!d(A)||(this.Hf.addLight(A),t.push(A))})),this.meshes.forEach((A=>{d&&!d(A)||(this.Hf.ii(A),t.push(A))})),this.skeletons.forEach((t=>{d&&!d(t)||this.Hf.addSkeleton(t)})),this.animations.forEach((t=>{d&&!d(t)||this.Hf.addAnimation(t)})),this.animationGroups.forEach((t=>{d&&!d(t)||this.Hf.addAnimationGroup(t)})),this.multiMaterials.forEach((t=>{d&&!d(t)||this.Hf.addMultiMaterial(t)})),this.materials.forEach((t=>{d&&!d(t)||this.Hf.addMaterial(t)})),this.morphTargetManagers.forEach((t=>{d&&!d(t)||this.Hf.addMorphTargetManager(t)})),this.geometries.forEach((t=>{d&&!d(t)||this.Hf.addGeometry(t)})),this.transformNodes.forEach((A=>{d&&!d(A)||(this.Hf.addTransformNode(A),t.push(A))})),this.actionManagers.forEach((t=>{d&&!d(t)||this.Hf.addActionManager(t)})),this.textures.forEach((t=>{d&&!d(t)||this.Hf.addTexture(t)})),this.reflectionProbes.forEach((t=>{d&&!d(t)||this.Hf.addReflectionProbe(t)}));for(const A of t)A.parent&&-1===this.Hf.getNodes().indexOf(A.parent)&&(A.setParent?A.setParent(null):A.parent=null)}removeAllFromScene(){this._isValidHierarchy()||N.g.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Hf.environmentTexture&&(this.Hf.environmentTexture=null);for(const d of this.Hf._serializableComponents)d.removeFromContainer(this)}removeFromScene(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((t=>{d&&!d(t)||this.Hf.removeCamera(t)})),this.lights.forEach((t=>{d&&!d(t)||this.Hf.removeLight(t)})),this.meshes.forEach((t=>{d&&!d(t)||this.Hf.Ug(t,!0)})),this.skeletons.forEach((t=>{d&&!d(t)||this.Hf.removeSkeleton(t)})),this.animations.forEach((t=>{d&&!d(t)||this.Hf.removeAnimation(t)})),this.animationGroups.forEach((t=>{d&&!d(t)||this.Hf.removeAnimationGroup(t)})),this.multiMaterials.forEach((t=>{d&&!d(t)||this.Hf.removeMultiMaterial(t)})),this.materials.forEach((t=>{d&&!d(t)||this.Hf.removeMaterial(t)})),this.morphTargetManagers.forEach((t=>{d&&!d(t)||this.Hf.removeMorphTargetManager(t)})),this.geometries.forEach((t=>{d&&!d(t)||this.Hf.removeGeometry(t)})),this.transformNodes.forEach((t=>{d&&!d(t)||this.Hf.removeTransformNode(t)})),this.actionManagers.forEach((t=>{d&&!d(t)||this.Hf.removeActionManager(t)})),this.textures.forEach((t=>{d&&!d(t)||this.Hf.removeTexture(t)})),this.reflectionProbes.forEach((t=>{d&&!d(t)||this.Hf.removeReflectionProbe(t)}))}dispose(){this.cameras.slice(0).forEach((d=>{d.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((d=>{d.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((d=>{d.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((d=>{d.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((d=>{d.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((d=>{d.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((d=>{d.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((d=>{d.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((d=>{d.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((d=>{d.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((d=>{d.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((d=>{d.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((d=>{d.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const d of this.Hf._serializableComponents)d.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Hf.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(d,t,A){if(d&&t)for(const w of d){let d=!0;if(A)for(const t of A)if(w===t){d=!1;break}d&&(t.push(w),w._parentContainer=this)}}moveAllFromScene(d){this._wasAddedToScene=!1,void 0===d&&(d=new P);for(const t in this)Object.prototype.hasOwnProperty.call(this,t)&&(this[t]=this[t]||("_environmentTexture"===t?null:[]),this._moveAssets(this.Hf[t],this[t],d[t]));this.environmentTexture=this.Hf.environmentTexture,this.removeAllFromScene()}createRootMesh(){const d=new B.d("assetContainerRootMesh",this.Hf);return this.meshes.forEach((t=>{t.parent||d.addChild(t)})),this.meshes.unshift(d),d}mergeAnimationsTo(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D.e.LastCreatedScene,t=arguments.length>1?arguments[1]:void 0,A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!d)return a.e.Error("No scene available to merge animations to"),[];const w=A||(t=>{let A=null;const w=t.animations.length?t.animations[0].targetProperty:"",N=t.name.split(".").join("").split("_primitive")[0];switch(w){case"position":case"rotationQuaternion":A=d.getTransformNodeByName(t.name)||d.getTransformNodeByName(N);break;case"influence":A=d.getMorphTargetByName(t.name)||d.getMorphTargetByName(N);break;default:A=d.getNodeByName(t.name)||d.getNodeByName(N)}return A});this.getNodes().forEach((d=>{const t=w(d);if(null!==t){for(const A of d.animations){const d=t.animations.filter((d=>d.targetProperty===A.targetProperty));for(const A of d){const d=t.animations.indexOf(A,0);d>-1&&t.animations.splice(d,1)}}t.animations=t.animations.concat(d.animations)}}));const N=[];return this.animationGroups.slice().forEach((d=>{N.push(d.clone(d.name,w)),d.animatables.forEach((d=>{d.stop()}))})),t.forEach((t=>{const A=w(t.target);A&&(d.beginAnimation(A,t.fromFrame,t.toFrame,t.loopAnimation,t.speedRatio,t.onAnimationEnd?t.onAnimationEnd:void 0,void 0,!0,void 0,t.onAnimationLoop?t.onAnimationLoop:void 0),d.stopAnimation(t.target))})),N}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((d=>{d.parent||-1!==this.rootNodes.indexOf(d)||this.rootNodes.push(d)})),this.transformNodes.forEach((d=>{d.parent||-1!==this.rootNodes.indexOf(d)||this.rootNodes.push(d)})),this.lights.forEach((d=>{d.parent||-1!==this.rootNodes.indexOf(d)||this.rootNodes.push(d)})),this.cameras.forEach((d=>{d.parent||-1!==this.rootNodes.indexOf(d)||this.rootNodes.push(d)}))}addAllAssetsToContainer(d){if(!d)return;const t=[],A=new Set;for(t.push(d);t.length>0;){const d=t.pop();if(d instanceof B.d?(d.Aj&&-1===this.geometries.indexOf(d.Aj)&&this.geometries.push(d.Aj),this.meshes.push(d)):d instanceof X.e?this.transformNodes.push(d):d instanceof k.c?this.lights.push(d):d instanceof b.d&&this.cameras.push(d),d instanceof W.d){if(d.material&&-1===this.materials.indexOf(d.material)){this.materials.push(d.material);for(const t of d.material.getActiveTextures())-1===this.textures.indexOf(t)&&this.textures.push(t)}d.skeleton&&-1===this.skeletons.indexOf(d.skeleton)&&this.skeletons.push(d.skeleton),d.morphTargetManager&&-1===this.morphTargetManagers.indexOf(d.morphTargetManager)&&this.morphTargetManagers.push(d.morphTargetManager)}for(const w of d.getChildren())A.has(w)||t.push(w);A.add(d)}this.populateRootNodes()}}var T=A(10791);class F{constructor(d){this.byteOffset=0,this.buffer=d}loadAsync(d){return this.buffer.readAsync(this.byteOffset,d).then((d=>{this._dataView=new DataView(d.buffer,d.byteOffset,d.byteLength),this._dataByteOffset=0}))}readUint32(){const d=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,d}readUint8Array(d){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,d);return this._dataByteOffset+=d,this.byteOffset+=d,t}readString(d){return(0,T.g)(this.readUint8Array(d))}skipBytes(d){this._dataByteOffset+=d,this.byteOffset+=d}}var q=A(12071);const H="Z2xURg",f={name:"Mi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:d=>-1!==d.indexOf("asset")&&-1!==d.indexOf("version")||d.startsWith("data:base64,"+H)||d.startsWith("data:;base64,"+H)||d.startsWith("data:application/octet-stream;base64,"+H)||d.startsWith("data:model/gltf-binary;base64,"+H)};var v,m,j,n=A(10779),R=A(10787);function Z(d,t,A){try{return Promise.resolve(new Uint8Array(d,t,A))}catch(w){return Promise.reject(w)}}!function(d){d[d.AUTO=0]="AUTO",d[d.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(v||(v={})),function(d){d[d.NONE=0]="NONE",d[d.FIRST=1]="FIRST",d[d.ALL=2]="ALL"}(m||(m={})),function(d){d[d.LOADING=0]="LOADING",d[d.READY=1]="READY",d[d.COMPLETE=2]="COMPLETE"}(j||(j={}));class L{constructor(){this.coordinateSystemMode=v.AUTO,this.animationStartMode=m.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=d=>Promise.resolve(d),this.extensionOptions={}}p(d){d&&(this.onParsed=d.onParsed,this.coordinateSystemMode=d.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=d.animationStartMode??this.animationStartMode,this.loadNodeAnimations=d.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=d.loadSkins??this.loadSkins,this.loadMorphTargets=d.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=d.compileMaterials??this.compileMaterials,this.useClipPlane=d.useClipPlane??this.useClipPlane,this.compileShadowGenerators=d.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=d.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=d.useRangeRequests??this.useRangeRequests,this.createInstances=d.createInstances??this.createInstances,this.alwaysComputeBoundingBox=d.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=d.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=d.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=d.skipMaterials??this.skipMaterials,this.useSRGBBuffers=d.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=d.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=d.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=d.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=d.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=d.customRootNode,this.onMeshLoaded=d.onMeshLoaded,this.onSkinLoaded=d.onSkinLoaded,this.onTextureLoaded=d.onTextureLoaded,this.onMaterialLoaded=d.onMaterialLoaded,this.onCameraLoaded=d.onCameraLoaded,this.extensionOptions=d.extensionOptions??this.extensionOptions)}}class I extends L{constructor(d){super(),this.onParsedObservable=new w.b,this.onMeshLoadedObservable=new w.b,this.onSkinLoadedObservable=new w.b,this.onTextureLoadedObservable=new w.b,this.onMaterialLoadedObservable=new w.b,this.onCameraLoadedObservable=new w.b,this.onCompleteObservable=new w.b,this.onErrorObservable=new w.b,this.hj=new w.b,this.onExtensionLoadedObservable=new w.b,this.validate=!1,this.onValidatedObservable=new w.b,this._loader=null,this._state=null,this._requests=new Array,this.name=f.name,this.extensions=f.extensions,this.onLoaderStateChangedObservable=new w.b,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(d)}set onParsed(d){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),d&&(this._onParsedObserver=this.onParsedObservable.add(d))}set onMeshLoaded(d){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),d&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(d))}set onSkinLoaded(d){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),d&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((t=>d(t.node,t.skinnedNode))))}set onTextureLoaded(d){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),d&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(d))}set onMaterialLoaded(d){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),d&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(d))}set onCameraLoaded(d){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),d&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(d))}set onComplete(d){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(d)}set onError(d){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(d)}set onDispose(d){this._onDisposeObserver&&this.hj.remove(this._onDisposeObserver),this._onDisposeObserver=this.hj.add(d)}set onExtensionLoaded(d){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(d)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(d){this._loggingEnabled!==d&&(this._loggingEnabled=d,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(d){this._capturePerformanceCounters!==d&&(this._capturePerformanceCounters=d,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(d){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(d)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const d of this._requests)d.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=d=>Promise.resolve(d),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.hj.notifyObservers(void 0),this.hj.clear()}loadFile(d,t,A,p,B,X,W,D){if(ArrayBuffer.isView(t))return this._loadBinary(d,t,A,p,W,D),null;this._progressCallback=B;const i=t.name||N.g.GetFilename(t);if(X){if(this.useRangeRequests){this.validate&&a.e.Warn("glTF validation is not supported when range requests are enabled");const A={abort:()=>{},onCompleteObservable:new w.b},N={readAsync:(A,w)=>new Promise(((N,p)=>{this._loadFile(d,t,(d=>{N(new Uint8Array(d))}),!0,(d=>{p(d)}),(d=>{d.setRequestHeader("Range",`bytes=${A}-${A+w-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new F(N)).then((d=>{A.onCompleteObservable.notifyObservers(A),p(d)}),W?d=>W(void 0,d):void 0),A}return this._loadFile(d,t,(t=>{this._validate(d,new Uint8Array(t,0,t.byteLength),A,i),this._unpackBinaryAsync(new F({readAsync:(d,A)=>Z(t,d,A),byteLength:t.byteLength})).then((d=>{p(d)}),W?d=>W(void 0,d):void 0)}),!0,W)}return this._loadFile(d,t,(t=>{try{this._validate(d,t,A,i),p({json:this._parseJson(t)})}catch{W&&W()}}),!1,W)}_loadBinary(d,t,A,w,N,p){this._validate(d,new Uint8Array(t.buffer,t.byteOffset,t.byteLength),A,p),this._unpackBinaryAsync(new F({readAsync:(d,A)=>function(d,t,A){try{if(t<0||t>=d.byteLength)throw new RangeError("Offset is out of range.");if(t+A>d.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(d.buffer,d.byteOffset+t,A))}catch(w){return Promise.reject(w)}}(t,d,A),byteLength:t.byteLength})).then((d=>{w(d)}),N?d=>N(void 0,d):void 0)}importMeshAsync(d,t,A,w,N,p){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(A),this.onParsedObservable.clear(),this._log(`Loading ${p||""}`),this._loader=this._getLoader(A),this._loader.importMeshAsync(d,t,null,A,w,N,p))))}loadAsync(d,t,A,w,N){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(t),this._loader.loadAsync(d,t,A,w,N))))}loadAssetContainerAsync(d,t,A,w,N){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._log(`Loading ${N||""}`),this._loader=this._getLoader(t);const p=new U(d),B=[];this.onMaterialLoadedObservable.add((d=>{B.push(d)}));const X=[];this.onTextureLoadedObservable.add((d=>{X.push(d)}));const W=[];this.onCameraLoadedObservable.add((d=>{W.push(d)}));const a=[];return this.onMeshLoadedObservable.add((d=>{d.morphTargetManager&&a.push(d.morphTargetManager)})),this._loader.importMeshAsync(null,d,p,t,A,w,N).then((d=>(Array.prototype.push.apply(p.geometries,d.geometries),Array.prototype.push.apply(p.meshes,d.meshes),Array.prototype.push.apply(p.nj,d.nj),Array.prototype.push.apply(p.skeletons,d.skeletons),Array.prototype.push.apply(p.animationGroups,d.animationGroups),Array.prototype.push.apply(p.materials,B),Array.prototype.push.apply(p.textures,X),Array.prototype.push.apply(p.lights,d.lights),Array.prototype.push.apply(p.transformNodes,d.transformNodes),Array.prototype.push.apply(p.cameras,W),Array.prototype.push.apply(p.morphTargetManagers,a),p)))}))}canDirectLoad(d){return f.canDirectLoad(d)}directLoad(d,t){if(t.startsWith("base64,"+H)||t.startsWith(";base64,"+H)||t.startsWith("application/octet-stream;base64,"+H)||t.startsWith("model/gltf-binary;base64,"+H)){const A=(0,n.b)(t);return this._validate(d,new Uint8Array(A,0,A.byteLength)),this._unpackBinaryAsync(new F({readAsync:(d,t)=>Z(A,d,t),byteLength:A.byteLength}))}return this._validate(d,t),Promise.resolve({json:this._parseJson(t)})}createPlugin(d){return new I(d[f.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((d,t)=>{this.onCompleteObservable.addOnce((()=>{d()})),this.onErrorObservable.addOnce((d=>{t(d)}))}))}_setState(d){this._state!==d&&(this._state=d,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(j[this._state]))}_loadFile(d,t,A,w,N,p){const B=d._loadFile(t,A,(d=>{this._onProgress(d,B)}),!0,w,N,p);return B.onCompleteObservable.add((()=>{B._lengthComputable=!0,B._total=B._loaded})),this._requests.push(B),B}_onProgress(d,t){if(!this._progressCallback)return;t._lengthComputable=d.lengthComputable,t._loaded=d.loaded,t._total=d.total;let A=!0,w=0,N=0;for(const p of this._requests){if(void 0===p._lengthComputable||void 0===p._loaded||void 0===p._total)return;A=A&&p._lengthComputable,w+=p._loaded,N+=p._total}this._progressCallback({lengthComputable:A,loaded:w,total:A?N:0})}_validate(d,t){let A=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",w=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),q.b.ValidateAsync(t,A,w,(t=>this.preprocessUrlAsync(A+t).then((t=>d._loadFileAsync(t,void 0,!0,!0).then((d=>new Uint8Array(d,0,d.byteLength))))))).then((d=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(d),this.onValidatedObservable.clear()}),(d=>{this._endPerformanceCounter("Validate JSON"),N.g.Warn(`Failed to validate: ${d.message}`),this.onValidatedObservable.clear()})))}_getLoader(d){const t=d.json.asset||{};this._log(`Asset version: ${t.version}`),t.minVersion&&this._log(`Asset minimum version: ${t.minVersion}`),t.generator&&this._log(`Asset generator: ${t.generator}`);const A=I._parseVersion(t.version);if(!A)throw new Error("Invalid version: "+t.version);if(void 0!==t.minVersion){const d=I._parseVersion(t.minVersion);if(!d)throw new Error("Invalid minimum version: "+t.minVersion);if(I._compareVersion(d,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+t.minVersion)}const w={1:I._CreateGLTF1Loader,2:I._CreateGLTF2Loader}[A.major];if(!w)throw new Error("Unsupported version: "+t.version);return w(this)}_parseJson(d){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${d.length}`);const t=JSON.parse(d);return this._endPerformanceCounter("Parse JSON"),t}_unpackBinaryAsync(d){return this._startPerformanceCounter("Unpack Binary"),d.loadAsync(20).then((()=>{const t=d.readUint32();if(1179937895!==t)throw new R.h("Unexpected magic: "+t,R.e.GLTFLoaderUnexpectedMagicError);const A=d.readUint32();this.loggingEnabled&&this._log(`Binary version: ${A}`);const w=d.readUint32();let N;switch(this.useRangeRequests||w===d.buffer.byteLength||a.e.Warn(`Length in header does not match actual data length: ${w} != ${d.buffer.byteLength}`),A){case 1:N=this._unpackBinaryV1Async(d,w);break;case 2:N=this._unpackBinaryV2Async(d,w);break;default:throw new Error("Unsupported version: "+A)}return this._endPerformanceCounter("Unpack Binary"),N}))}_unpackBinaryV1Async(d,t){const A=d.readUint32(),w=d.readUint32();if(0!==w)throw new Error(`Unexpected content format: ${w}`);const N=t-d.byteOffset,p={json:this._parseJson(d.readString(A)),bin:null};if(0!==N){const t=d.byteOffset;p.bin={readAsync:(A,w)=>d.buffer.readAsync(t+A,w),byteLength:N}}return Promise.resolve(p)}_unpackBinaryV2Async(d,t){const A=1313821514,w=5130562,N=d.readUint32();if(d.readUint32()!==A)throw new Error("First chunk format is not JSON");return d.byteOffset+N===t?d.loadAsync(N).then((()=>({json:this._parseJson(d.readString(N)),bin:null}))):d.loadAsync(N+8).then((()=>{const p={json:this._parseJson(d.readString(N)),bin:null},B=()=>{const N=d.readUint32();switch(d.readUint32()){case A:throw new Error("Unexpected JSON chunk");case w:{const t=d.byteOffset;p.bin={readAsync:(A,w)=>d.buffer.readAsync(t+A,w),byteLength:N},d.skipBytes(N);break}default:d.skipBytes(N)}return d.byteOffset!==t?d.loadAsync(8).then(B):Promise.resolve(p)};return B()}))}static _parseVersion(d){if("1.0"===d||"1.0.1"===d)return{major:1,minor:0};const t=(d+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null}static _compareVersion(d,t){return d.major>t.major?1:d.major<t.major?-1:d.minor>t.minor?1:d.minor<t.minor?-1:0}_logOpen(d){this._log(d),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(d){const t=I._logSpaces.substring(0,2*this._logIndentLevel);a.e.Log(`${t}${d}`)}_logDisabled(d){}_startPerformanceCounterEnabled(d){N.g.StartPerformanceCounter(d)}_startPerformanceCounterDisabled(d){}_endPerformanceCounterEnabled(d){N.g.EndPerformanceCounter(d)}_endPerformanceCounterDisabled(d){}}I.IncrementalLoading=!0,I.HomogeneousCoordinates=!1,I._logSpaces="                                ",(0,p.e)(new I)},12071:(d,t,A)=>{"use strict";A.d(t,{b:()=>B});var w=A(10727);function N(d,t,A,w){const N={externalResourceFunction:w};return A&&(N.uri="file:"===t?A:t+A),ArrayBuffer.isView(d)?GLTFValidator.validateBytes(d,N):GLTFValidator.validateString(d,N)}function p(){const d=[];onmessage=t=>{const A=t.data;switch(A.id){case"init":importScripts(A.url);break;case"validate":N(A.data,A.rootUrl,A.fileName,(t=>new Promise(((A,w)=>{const N=d.length;d.push({resolve:A,reject:w}),postMessage({id:"getExternalResource",index:N,uri:t})})))).then((d=>{postMessage({id:"validate.resolve",value:d})}),(d=>{postMessage({id:"validate.reject",reason:d})}));break;case"getExternalResource.resolve":d[A.index].resolve(A.value);break;case"getExternalResource.reject":d[A.index].reject(A.reason)}}}class B{static ValidateAsync(d,t,A,B){return"function"===typeof Worker?new Promise(((X,W)=>{const a=`${N}(${p})()`,D=URL.createObjectURL(new Blob([a],{type:"application/javascript"})),i=new Worker(D),k=d=>{i.removeEventListener("error",k),i.removeEventListener("message",b),W(d)},b=d=>{const t=d.data;switch(t.id){case"getExternalResource":B(t.uri).then((d=>{i.postMessage({id:"getExternalResource.resolve",index:t.index,value:d},[d.buffer])}),(d=>{i.postMessage({id:"getExternalResource.reject",index:t.index,reason:d})}));break;case"validate.resolve":i.removeEventListener("error",k),i.removeEventListener("message",b),X(t.value),i.terminate();break;case"validate.reject":i.removeEventListener("error",k),i.removeEventListener("message",b),W(t.reason),i.terminate()}};if(i.addEventListener("error",k),i.addEventListener("message",b),i.postMessage({id:"init",url:w.g.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(d)){const w=d.slice();i.postMessage({id:"validate",data:w,rootUrl:t,fileName:A},[w.buffer])}else i.postMessage({id:"validate",data:d,rootUrl:t,fileName:A})})):(this._LoadScriptPromise||(this._LoadScriptPromise=w.g.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>N(d,t,A,B))))}}B.Configuration={url:`${w.g._DefaultCdnUrl}/gltf_validator.js`}},12498:(d,t,A)=>{"use strict";A.d(t,{e:()=>v});var w=A(11041),N=A(11047),p=A(11097),B=A(11076),X=A(11257),W=A(11260),a=A(11120),D=A(11061),i=A(10885),k=A(10837);A(11738),A(11633),A(11654),A(11638),A(11663),A(11669),A(11678);const b="imageProcessingCompatibility",Q="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";k.c.IncludesShadersStore[b]=Q;const P="skyPixelShader",J="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";k.c.ShadersStore[P]=J;A(11751),A(11684),A(11692),A(11704),A(11698);const U="skyVertexShader",T="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";k.c.ShadersStore[U]=T;var F=A(11285),q=A(11254),H=A(11246);class f extends X.b{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class v extends W.b{constructor(d,t){super(d,t),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new B.l(0,100,0),this.useSunPosition=!1,this.cameraOffset=B.l.Zero(),this.up=B.l.Up(),this.dithering=!1,this._cameraPosition=B.l.Zero(),this._skyOrientation=new B.f}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(d,t){const A=t._drawWrapper;if(this.isFrozen&&A.effect&&A._wasPreviouslyReady)return!0;t.materialDefines||(t.materialDefines=new f);const w=t.materialDefines,N=this.va();if(this._isReadyForSubMesh(t))return!0;if((0,H.R)(d,N,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,w),(0,H.E)(d,w,!0,!1),w.IMAGEPROCESSINGPOSTPROCESS!==N.imageProcessingConfiguration.applyByPostProcess&&w.markAsMiscDirty(),w.DITHER!==this.dithering&&w.markAsMiscDirty(),w.isDirty){w.markAsProcessed(),N.resetCachedMaterial();const d=new F.b;w.FOG&&d.addFallback(1,"FOG"),w.IMAGEPROCESSINGPOSTPROCESS=N.imageProcessingConfiguration.applyByPostProcess,w.DITHER=this.dithering;const A=[a.f.PositionKind];w.VERTEXCOLOR&&A.push(a.f.ColorKind);const p="sky",B=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,q.e)(B);const X=w.toString();t.setEffect(N.getEngine().createEffect(p,A,B,[],X,d,this.onCompiled,this.onError),w,this._materialContext)}return!(!t.effect||!t.effect.isReady())&&(w._renderId=N.getRenderId(),A._wasPreviouslyReady=!0,!0)}bindForSubMesh(d,t,A){const w=this.va(),N=A.materialDefines;if(!N)return;const p=A.effect;if(!p)return;this._activeEffect=p,this.bindOnlyWorldMatrix(d),this._activeEffect.setMatrix("viewProjection",w.getTransformMatrix()),this._mustRebind(w,p,A)&&((0,q.g)(p,this,w),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,H.k)(N,p,w)),w.fogEnabled&&t.applyFog&&w.fogMode!==D.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",w.getViewMatrix()),(0,H.e)(w,t,this._activeEffect);const X=w.activeCamera;if(X){const d=X.getWorldMatrix();this._cameraPosition.x=d.m[12],this._cameraPosition.y=d.m[13],this._cameraPosition.z=d.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const d=Math.PI*(this.inclination-.5),t=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(t)*Math.cos(d),this.sunPosition.y=this.distance*Math.sin(-d),this.sunPosition.z=this.distance*Math.sin(t)*Math.cos(d),B.f.FromUnitVectorsToRef(B.l.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(t,this._activeEffect,A)}getAnimatables(){return[]}dispose(d){super.dispose(d)}clone(d){return p.d.Clone((()=>new v(d,this.va())),this)}serialize(){const d=super.serialize();return d.customType="BABYLON.SkyMaterial",d}getClassName(){return"SkyMaterial"}static Parse(d,t,A){return p.d.Parse((()=>new v(d.name,t)),d,t,A)}}(0,w.b)([(0,N.J)()],v.prototype,"luminance",void 0),(0,w.b)([(0,N.J)()],v.prototype,"turbidity",void 0),(0,w.b)([(0,N.J)()],v.prototype,"rayleigh",void 0),(0,w.b)([(0,N.J)()],v.prototype,"mieCoefficient",void 0),(0,w.b)([(0,N.J)()],v.prototype,"mieDirectionalG",void 0),(0,w.b)([(0,N.J)()],v.prototype,"distance",void 0),(0,w.b)([(0,N.J)()],v.prototype,"inclination",void 0),(0,w.b)([(0,N.J)()],v.prototype,"azimuth",void 0),(0,w.b)([(0,N.H)()],v.prototype,"sunPosition",void 0),(0,w.b)([(0,N.J)()],v.prototype,"useSunPosition",void 0),(0,w.b)([(0,N.H)()],v.prototype,"cameraOffset",void 0),(0,w.b)([(0,N.H)()],v.prototype,"up",void 0),(0,w.b)([(0,N.J)()],v.prototype,"dithering",void 0),(0,i.g)("BABYLON.SkyMaterial",v)},10589:(d,t,A)=>{"use strict";function w(d,t){t.headers=d.headers||{},t.statusMessage=d.statusText,t.statusCode=d.status,t.data=d.response}function N(d,t,A){return new Promise((function(N,p){A=A||{};var B,X,W,a=new XMLHttpRequest,D=A.body,i=A.headers||{};for(B in A.timeout&&(a.timeout=A.timeout),a.ontimeout=a.onerror=function(d){d.timeout="timeout"==d.type,p(d)},a.open(d,t.href||t),a.onload=function(){for(W=a.getAllResponseHeaders().trim().split(/[\r\n]+/),w(a,a);X=W.shift();)X=X.split(": "),a.headers[X.shift().toLowerCase()]=X.join(": ");if((X=a.headers["content-type"])&&~X.indexOf("application/json"))try{a.data=JSON.parse(a.data,A.reviver)}catch(d){return w(a,d),p(d)}(a.status>=400?p:N)(a)},typeof FormData<"u"&&D instanceof FormData||D&&"object"==typeof D&&(i["content-type"]="application/json",D=JSON.stringify(D)),a.withCredentials=!!A.withCredentials,i)a.setRequestHeader(B,i[B]);a.send(D)}))}A.r(t),A.d(t,{del:()=>W,get:()=>p,patch:()=>X,post:()=>B,put:()=>a,send:()=>N});var p=N.bind(N,"GET"),B=N.bind(N,"POST"),X=N.bind(N,"PATCH"),W=N.bind(N,"DELETE"),a=N.bind(N,"PUT")},12616:(d,t,A)=>{"use strict";A.d(t,{c:()=>i});const w=.5*(Math.sqrt(3)-1),N=(3-Math.sqrt(3))/6,p=1/3,B=1/6,X=(Math.sqrt(5)-1)/4,W=(5-Math.sqrt(5))/20,a=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),D=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const i=class{constructor(){let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const t="function"==typeof d?d:function(d){let t=0,A=0,w=0,N=1;const p=function(){let d=4022871197;return function(t){t=t.toString();for(let A=0;A<t.length;A++){d+=t.charCodeAt(A);let w=.02519603282416938*d;d=w>>>0,w-=d,w*=d,d=w>>>0,w-=d,d+=4294967296*w}return 2.3283064365386963e-10*(d>>>0)}}();t=p(" "),A=p(" "),w=p(" "),t-=p(d),t<0&&(t+=1);A-=p(d),A<0&&(A+=1);w-=p(d),w<0&&(w+=1);return function(){const d=2091639*t+2.3283064365386963e-10*N;return t=A,A=w,w=d-(N=0|d)}}(d);this.p=function(d){const t=new Uint8Array(256);for(let A=0;A<256;A++)t[A]=A;for(let A=0;A<255;A++){const w=A+~~(d()*(256-A)),N=t[A];t[A]=t[w],t[w]=N}return t}(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let A=0;A<512;A++)this.perm[A]=this.p[255&A],this.permMod12[A]=this.perm[A]%12}noise2D(d,t){const A=this.permMod12,p=this.perm;let B=0,X=0,W=0;const D=(d+t)*w,i=Math.floor(d+D),k=Math.floor(t+D),b=(i+k)*N,Q=d-(i-b),P=t-(k-b);let J,U;Q>P?(J=1,U=0):(J=0,U=1);const T=Q-J+N,F=P-U+N,q=Q-1+2*N,H=P-1+2*N,f=255&i,v=255&k;let m=.5-Q*Q-P*P;if(m>=0){const d=3*A[f+p[v]];m*=m,B=m*m*(a[d]*Q+a[d+1]*P)}let j=.5-T*T-F*F;if(j>=0){const d=3*A[f+J+p[v+U]];j*=j,X=j*j*(a[d]*T+a[d+1]*F)}let n=.5-q*q-H*H;if(n>=0){const d=3*A[f+1+p[v+1]];n*=n,W=n*n*(a[d]*q+a[d+1]*H)}return 70*(B+X+W)}noise3D(d,t,A){const w=this.permMod12,N=this.perm;let X,W,D,i;const k=(d+t+A)*p,b=Math.floor(d+k),Q=Math.floor(t+k),P=Math.floor(A+k),J=(b+Q+P)*B,U=d-(b-J),T=t-(Q-J),F=A-(P-J);let q,H,f,v,m,j;U>=T?T>=F?(q=1,H=0,f=0,v=1,m=1,j=0):U>=F?(q=1,H=0,f=0,v=1,m=0,j=1):(q=0,H=0,f=1,v=1,m=0,j=1):T<F?(q=0,H=0,f=1,v=0,m=1,j=1):U<F?(q=0,H=1,f=0,v=0,m=1,j=1):(q=0,H=1,f=0,v=1,m=1,j=0);const n=U-q+B,R=T-H+B,Z=F-f+B,L=U-v+2*B,I=T-m+2*B,u=F-j+2*B,V=U-1+.5,h=T-1+.5,l=F-1+.5,y=255&b,s=255&Q,Y=255&P;let r=.6-U*U-T*T-F*F;if(r<0)X=0;else{const d=3*w[y+N[s+N[Y]]];r*=r,X=r*r*(a[d]*U+a[d+1]*T+a[d+2]*F)}let K=.6-n*n-R*R-Z*Z;if(K<0)W=0;else{const d=3*w[y+q+N[s+H+N[Y+f]]];K*=K,W=K*K*(a[d]*n+a[d+1]*R+a[d+2]*Z)}let G=.6-L*L-I*I-u*u;if(G<0)D=0;else{const d=3*w[y+v+N[s+m+N[Y+j]]];G*=G,D=G*G*(a[d]*L+a[d+1]*I+a[d+2]*u)}let O=.6-V*V-h*h-l*l;if(O<0)i=0;else{const d=3*w[y+1+N[s+1+N[Y+1]]];O*=O,i=O*O*(a[d]*V+a[d+1]*h+a[d+2]*l)}return 32*(X+W+D+i)}noise4D(d,t,A,w){const N=this.perm;let p,B,a,i,k;const b=(d+t+A+w)*X,Q=Math.floor(d+b),P=Math.floor(t+b),J=Math.floor(A+b),U=Math.floor(w+b),T=(Q+P+J+U)*W,F=d-(Q-T),q=t-(P-T),H=A-(J-T),f=w-(U-T);let v=0,m=0,j=0,n=0;F>q?v++:m++,F>H?v++:j++,F>f?v++:n++,q>H?m++:j++,q>f?m++:n++,H>f?j++:n++;const R=v>=3?1:0,Z=m>=3?1:0,L=j>=3?1:0,I=n>=3?1:0,u=v>=2?1:0,V=m>=2?1:0,h=j>=2?1:0,l=n>=2?1:0,y=v>=1?1:0,s=m>=1?1:0,Y=j>=1?1:0,r=n>=1?1:0,K=F-R+W,G=q-Z+W,O=H-L+W,z=f-I+W,c=F-u+2*W,e=q-V+2*W,M=H-h+2*W,x=f-l+2*W,o=F-y+3*W,C=q-s+3*W,E=H-Y+3*W,g=f-r+3*W,S=F-1+4*W,dd=q-1+4*W,td=H-1+4*W,Ad=f-1+4*W,wd=255&Q,Nd=255&P,pd=255&J,Bd=255&U;let Xd=.6-F*F-q*q-H*H-f*f;if(Xd<0)p=0;else{const d=N[wd+N[Nd+N[pd+N[Bd]]]]%32*4;Xd*=Xd,p=Xd*Xd*(D[d]*F+D[d+1]*q+D[d+2]*H+D[d+3]*f)}let Wd=.6-K*K-G*G-O*O-z*z;if(Wd<0)B=0;else{const d=N[wd+R+N[Nd+Z+N[pd+L+N[Bd+I]]]]%32*4;Wd*=Wd,B=Wd*Wd*(D[d]*K+D[d+1]*G+D[d+2]*O+D[d+3]*z)}let ad=.6-c*c-e*e-M*M-x*x;if(ad<0)a=0;else{const d=N[wd+u+N[Nd+V+N[pd+h+N[Bd+l]]]]%32*4;ad*=ad,a=ad*ad*(D[d]*c+D[d+1]*e+D[d+2]*M+D[d+3]*x)}let Dd=.6-o*o-C*C-E*E-g*g;if(Dd<0)i=0;else{const d=N[wd+y+N[Nd+s+N[pd+Y+N[Bd+r]]]]%32*4;Dd*=Dd,i=Dd*Dd*(D[d]*o+D[d+1]*C+D[d+2]*E+D[d+3]*g)}let id=.6-S*S-dd*dd-td*td-Ad*Ad;if(id<0)k=0;else{const d=N[wd+1+N[Nd+1+N[pd+1+N[Bd+1]]]]%32*4;id*=id,k=id*id*(D[d]*S+D[d+1]*dd+D[d+2]*td+D[d+3]*Ad)}return 27*(p+B+a+i+k)}}}}]);