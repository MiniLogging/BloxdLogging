/*! For license information please see ghe9r.9.e92d3c5c.chunk.js.LICENSE.txt */
(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{10610:function(K,b){!function(K){"use strict";var b=function(K,e){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(K,b){K.__proto__=b}||function(K,b){for(var e in b)Object.prototype.hasOwnProperty.call(b,e)&&(K[e]=b[e])},b(K,e)};function e(K,e){if("function"!==typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function z(){this.constructor=K}b(K,e),K.prototype=null===e?Object.create(e):(z.prototype=e.prototype,new z)}function z(K,b,e,z){var k,j=arguments.length,T=j<3?b:null===z?z=Object.getOwnPropertyDescriptor(b,e):z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)T=Reflect.decorate(K,b,e,z);else for(var F=K.length-1;F>=0;F--)(k=K[F])&&(T=(j<3?k(T):j>3?k(b,e,T):k(b,e))||T);return j>3&&T&&Object.defineProperty(b,e,T),T}function k(K,b,e){if(e||2===arguments.length)for(var z,k=0,j=b.length;k<j;k++)!z&&k in b||(z||(z=Array.prototype.slice.call(b,0,k)),z[k]=b[k]);return K.concat(z||Array.prototype.slice.call(b))}var j,T=255,F=213;K.OPERATION=void 0,(j=K.OPERATION||(K.OPERATION={}))[j.ADD=128]="ADD",j[j.REPLACE=0]="REPLACE",j[j.DELETE=64]="DELETE",j[j.DELETE_AND_ADD=192]="DELETE_AND_ADD",j[j.TOUCH=1]="TOUCH",j[j.CLEAR=10]="CLEAR";var l=function(){function b(K,b,e){this.changed=!1,this.changes=new Map,this.allChanges=new Set,this.caches={},this.currentCustomOperation=0,this.ref=K,this.setParent(b,e)}return b.prototype.setParent=function(K,b,e){var z=this;if(this.indexes||(this.indexes=this.ref instanceof RK?this.ref._definition.indexes:{}),this.parent=K,this.parentIndex=e,b)if(this.root=b,this.ref instanceof RK){var k=this.ref._definition;for(var j in k.schema){var T=this.ref[j];if(T&&T.$changes){var F=k.indexes[j];T.$changes.setParent(this.ref,b,F)}}}else"object"===typeof this.ref&&this.ref.forEach((function(K,b){if(K instanceof RK){var e=K.$changes,k=z.ref.$changes.indexes[b];e.setParent(z.ref,z.root,k)}}))},b.prototype.operation=function(K){this.changes.set(--this.currentCustomOperation,K)},b.prototype.change=function(b,e){void 0===e&&(e=K.OPERATION.ADD);var z="number"===typeof b?b:this.indexes[b];this.assertValidIndex(z,b);var k=this.changes.get(z);k&&k.op!==K.OPERATION.DELETE&&k.op!==K.OPERATION.TOUCH||this.changes.set(z,{op:k&&k.op===K.OPERATION.DELETE?K.OPERATION.DELETE_AND_ADD:e,index:z}),this.allChanges.add(z),this.changed=!0,this.touchParents()},b.prototype.touch=function(b){var e="number"===typeof b?b:this.indexes[b];this.assertValidIndex(e,b),this.changes.has(e)||this.changes.set(e,{op:K.OPERATION.TOUCH,index:e}),this.allChanges.add(e),this.touchParents()},b.prototype.touchParents=function(){this.parent&&this.parent.$changes.touch(this.parentIndex)},b.prototype.getType=function(K){if(this.ref._definition)return(b=this.ref._definition).schema[b.fieldsByIndex[K]];var b,e=(b=this.parent._definition).schema[b.fieldsByIndex[this.parentIndex]];return Object.values(e)[0]},b.prototype.getChildrenFilter=function(){var K=this.parent._definition.childFilters;return K&&K[this.parentIndex]},b.prototype.getValue=function(K){return this.ref.getByIndex(K)},b.prototype.delete=function(b){var e="number"===typeof b?b:this.indexes[b];if(void 0!==e){var z=this.getValue(e);this.changes.set(e,{op:K.OPERATION.DELETE,index:e}),this.allChanges.delete(e),delete this.caches[e],z&&z.$changes&&(z.$changes.parent=void 0),this.changed=!0,this.touchParents()}else console.warn("@colyseus/schema ".concat(this.ref.constructor.name,": trying to delete non-existing index: ").concat(b," (").concat(e,")"))},b.prototype.discard=function(b,e){var z=this;void 0===b&&(b=!1),void 0===e&&(e=!1),this.ref instanceof RK||this.changes.forEach((function(b){if(b.op===K.OPERATION.DELETE){var e=z.ref.getIndex(b.index);delete z.indexes[e]}})),this.changes.clear(),this.changed=b,e&&this.allChanges.clear(),this.currentCustomOperation=0},b.prototype.discardAll=function(){var K=this;this.changes.forEach((function(b){var e=K.getValue(b.index);e&&e.$changes&&e.$changes.discardAll()})),this.discard()},b.prototype.cache=function(K,b){this.caches[K]=b},b.prototype.clone=function(){return new b(this.ref,this.parent,this.root)},b.prototype.ensureRefId=function(){void 0===this.refId&&(this.refId=this.root.getNextUniqueId())},b.prototype.assertValidIndex=function(K,b){if(void 0===K)throw new Error('ChangeTree: missing index for field "'.concat(b,'"'))},b}();function Y(K,b,e,z){return K[b]||(K[b]=[]),K[b].push(e),null===z||void 0===z||z.forEach((function(K,b){return e(K,b)})),function(){return X(K[b],K[b].indexOf(e))}}function A(b){var e=this,z="string"!==typeof this.$changes.getType();this.$items.forEach((function(k,j){b.push({refId:e.$changes.refId,op:K.OPERATION.DELETE,field:j,value:void 0,previousValue:k}),z&&e.$changes.root.removeRef(k.$changes.refId)}))}function X(K,b){if(-1===b||b>=K.length)return!1;for(var e=K.length-1,z=b;z<e;z++)K[z]=K[z+1];return K.length=e,!0}var t=function(K,b){var e=K.toString(),z=b.toString();return e<z?-1:e>z?1:0};function U(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,b){return"symbol"===typeof b||isNaN(b)?K[b]:K.at(b)},set:function(K,b,e){if("symbol"===typeof b||isNaN(b))K[b]=e;else{var z=Array.from(K.$items.keys()),k=parseInt(z[b]||b);void 0===e||null===e?K.deleteAt(k):K.setAt(k,e)}return!0},deleteProperty:function(K,b){return"number"===typeof b?K.deleteAt(b):delete K[b],!0}})}var B=function(){function b(){for(var K=[],b=0;b<arguments.length;b++)K[b]=arguments[b];this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,this.push.apply(this,K)}return b.prototype.Bd=function(b,e){return void 0===e&&(e=!0),Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,b,e?this.$items:void 0)},b.prototype.ab=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,b)},b.is=function(K){return Array.isArray(K)||void 0!==K.array},Object.defineProperty(b.prototype,"length",{get:function(){return this.$items.size},set:function(K){0===K?this.clear():this.splice(K,this.length-K)},enumerable:!1,configurable:!0}),b.prototype.push=function(){for(var K,b=this,e=[],z=0;z<arguments.length;z++)e[z]=arguments[z];return e.forEach((function(e){K=b.$refId++,b.setAt(K,e)})),K},b.prototype.pop=function(){var K=Array.from(this.$indexes.values()).pop();if(void 0!==K){this.$changes.delete(K),this.$indexes.delete(K);var b=this.$items.get(K);return this.$items.delete(K),b}},b.prototype.at=function(K){var b=Array.from(this.$items.keys())[K];return this.$items.get(b)},b.prototype.setAt=function(b,e){var z,k;if(void 0!==e&&null!==e){if(this.$items.get(b)!==e){void 0!==e.$changes&&e.$changes.setParent(this,this.$changes.root,b);var j=null!==(k=null===(z=this.$changes.indexes[b])||void 0===z?void 0:z.op)&&void 0!==k?k:K.OPERATION.ADD;this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,e),this.$changes.change(b,j)}}else console.error("ArraySchema items cannot be null nor undefined; Use `deleteAt(index)` instead.")},b.prototype.deleteAt=function(K){var b=Array.from(this.$items.keys())[K];return void 0!==b&&this.$deleteAt(b)},b.prototype.$deleteAt=function(K){return this.$changes.delete(K),this.$indexes.delete(K),this.$items.delete(K)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&A.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.concat=function(){for(var K,e=[],z=0;z<arguments.length;z++)e[z]=arguments[z];return new(b.bind.apply(b,k([void 0],(K=Array.from(this.$items.values())).concat.apply(K,e),!1)))},b.prototype.join=function(K){return Array.from(this.$items.values()).join(K)},b.prototype.reverse=function(){var K=this,b=Array.from(this.$items.keys());return Array.from(this.$items.values()).reverse().forEach((function(e,z){K.setAt(b[z],e)})),this},b.prototype.shift=function(){var K=Array.from(this.$items.keys()).shift();if(void 0!==K){var b=this.$items.get(K);return this.$deleteAt(K),b}},b.prototype.slice=function(K,e){var z=new b;return z.push.apply(z,Array.from(this.$items.values()).slice(K,e)),z},b.prototype.sort=function(K){var b=this;void 0===K&&(K=t);var e=Array.from(this.$items.keys());return Array.from(this.$items.values()).sort(K).forEach((function(K,z){b.setAt(e[z],K)})),this},b.prototype.splice=function(K,b){void 0===b&&(b=this.length-K);for(var e=Array.from(this.$items.keys()),z=[],k=K;k<K+b;k++)z.push(this.$items.get(e[k])),this.$deleteAt(e[k]);return z},b.prototype.unshift=function(){for(var K=this,b=[],e=0;e<arguments.length;e++)b[e]=arguments[e];var z=this.length,k=b.length,j=Array.from(this.$items.values());return b.forEach((function(b,e){K.setAt(e,b)})),j.forEach((function(b,e){K.setAt(k+e,b)})),z+k},b.prototype.indexOf=function(K,b){return Array.from(this.$items.values()).indexOf(K,b)},b.prototype.lastIndexOf=function(K,b){return void 0===b&&(b=this.length-1),Array.from(this.$items.values()).lastIndexOf(K,b)},b.prototype.every=function(K,b){return Array.from(this.$items.values()).every(K,b)},b.prototype.some=function(K,b){return Array.from(this.$items.values()).some(K,b)},b.prototype.forEach=function(K,b){Array.from(this.$items.values()).forEach(K,b)},b.prototype.map=function(K,b){return Array.from(this.$items.values()).map(K,b)},b.prototype.filter=function(K,b){return Array.from(this.$items.values()).filter(K,b)},b.prototype.reduce=function(K,b){return Array.prototype.reduce.apply(Array.from(this.$items.values()),arguments)},b.prototype.reduceRight=function(K,b){return Array.prototype.reduceRight.apply(Array.from(this.$items.values()),arguments)},b.prototype.find=function(K,b){return Array.from(this.$items.values()).find(K,b)},b.prototype.findIndex=function(K,b){return Array.from(this.$items.values()).findIndex(K,b)},b.prototype.fill=function(K,b,e){throw new Error("ArraySchema#fill() not implemented")},b.prototype.copyWithin=function(K,b,e){throw new Error("ArraySchema#copyWithin() not implemented")},b.prototype.toString=function(){return this.$items.toString()},b.prototype.toLocaleString=function(){return this.$items.toLocaleString()},b.prototype[Symbol.iterator]=function(){return Array.from(this.$items.values())[Symbol.iterator]()},Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},b.prototype.includes=function(K,b){return Array.from(this.$items.values()).includes(K,b)},b.prototype.flatMap=function(K,b){throw new Error("ArraySchema#flatMap() is not supported.")},b.prototype.flat=function(K){throw new Error("ArraySchema#flat() is not supported.")},b.prototype.findLast=function(){var K=Array.from(this.$items.values());return K.findLast.apply(K,arguments)},b.prototype.findLastIndex=function(){var K=Array.from(this.$items.values());return K.findLastIndex.apply(K,arguments)},b.prototype.setIndex=function(K,b){this.$indexes.set(K,b)},b.prototype.getIndex=function(K){return this.$indexes.get(K)},b.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},b.prototype.deleteByIndex=function(K){var b=this.$indexes.get(K);this.$items.delete(b),this.$indexes.delete(K)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){return this.toArray().map((function(K){return"function"===typeof K.toJSON?K.toJSON():K}))},b.prototype.clone=function(K){return K?new(b.bind.apply(b,k([void 0],Array.from(this.$items.values()),!1))):new(b.bind.apply(b,k([void 0],this.map((function(K){return K.$changes?K.clone():K})),!1)))},b}();function u(K){return K.$proxy=!0,K=new Proxy(K,{get:function(K,b){return"symbol"!==typeof b&&"undefined"===typeof K[b]?K.get(b):K[b]},set:function(K,b,e){return"symbol"!==typeof b&&-1===b.indexOf("$")&&"Bd"!==b&&"ab"!==b&&"onChange"!==b?K.set(b,e):K[b]=e,!0},deleteProperty:function(K,b){return K.delete(b),!0}})}var m=function(){function b(K){var e=this;if(this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K)if(K instanceof Map||K instanceof b)K.forEach((function(K,b){return e.set(b,K)}));else for(var z in K)this.set(z,K[z])}return b.prototype.Bd=function(b,e){return void 0===e&&(e=!0),Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,b,e?this.$items:void 0)},b.prototype.ab=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,b)},b.is=function(K){return void 0!==K.map},b.prototype[Symbol.iterator]=function(){return this.$items[Symbol.iterator]()},Object.defineProperty(b.prototype,Symbol.toStringTag,{get:function(){return this.$items[Symbol.toStringTag]},enumerable:!1,configurable:!0}),Object.defineProperty(b,Symbol.species,{get:function(){return b},enumerable:!1,configurable:!0}),b.prototype.set=function(b,e){if(void 0===e||null===e)throw new Error("MapSchema#set('".concat(b,"', ").concat(e,"): trying to set ").concat(e," value on '").concat(b,"'."));b=b.toString();var z="undefined"!==typeof this.$changes.indexes[b],k=z?this.$changes.indexes[b]:this.$refId++,j=z?K.OPERATION.REPLACE:K.OPERATION.ADD,T=void 0!==e.$changes;if(T&&e.$changes.setParent(this,this.$changes.root,k),z){if(!T&&this.$items.get(b)===e)return;T&&this.$items.get(b)!==e&&(j=K.OPERATION.ADD)}else this.$changes.indexes[b]=k,this.$indexes.set(k,b);return this.$items.set(b,e),this.$changes.change(b,j),this},b.prototype.get=function(K){return this.$items.get(K)},b.prototype.delete=function(K){return this.$changes.delete(K),this.$items.delete(K)},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&A.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(K){return this.$items.has(K)},b.prototype.forEach=function(K){this.$items.forEach(K)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.keys=function(){return this.$items.keys()},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(K,b){this.$indexes.set(K,b)},b.prototype.getIndex=function(K){return this.$indexes.get(K)},b.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},b.prototype.deleteByIndex=function(K){var b=this.$indexes.get(K);this.$items.delete(b),this.$indexes.delete(K)},b.prototype.toJSON=function(){var K={};return this.forEach((function(b,e){K[e]="function"===typeof b.toJSON?b.toJSON():b})),K},b.prototype.clone=function(K){var e;return K?e=Object.assign(new b,this):(e=new b,this.forEach((function(K,b){K.$changes?e.set(b,K.clone()):e.set(b,K)}))),e},b}(),D={};function I(K,b){D[K]=b}function x(K){return D[K]}var Q=function(){function K(){this.indexes={},this.fieldsByIndex={},this.deprecated={},this.descriptors={}}return K.create=function(b){var e=new K;return e.schema=Object.assign({},b&&b.schema||{}),e.indexes=Object.assign({},b&&b.indexes||{}),e.fieldsByIndex=Object.assign({},b&&b.fieldsByIndex||{}),e.descriptors=Object.assign({},b&&b.descriptors||{}),e.deprecated=Object.assign({},b&&b.deprecated||{}),e},K.prototype.addField=function(K,b){var e=this.getNextFieldIndex();this.fieldsByIndex[e]=K,this.indexes[K]=e,this.schema[K]=Array.isArray(b)?{array:b[0]}:b},K.prototype.hasField=function(K){return void 0!==this.indexes[K]},K.prototype.addFilter=function(K,b){return this.filters||(this.filters={},this.indexesWithFilters=[]),this.filters[this.indexes[K]]=b,this.indexesWithFilters.push(this.indexes[K]),!0},K.prototype.addChildrenFilter=function(K,b){var e=this.indexes[K],z=this.schema[K];if(x(Object.keys(z)[0]))return this.childFilters||(this.childFilters={}),this.childFilters[e]=b,!0;console.warn("@filterChildren: field '".concat(K,"' can't have children. Ignoring filter."))},K.prototype.getChildrenFilter=function(K){return this.childFilters&&this.childFilters[this.indexes[K]]},K.prototype.getNextFieldIndex=function(){return Object.keys(this.schema||{}).length},K}();function G(K){return K._context&&K._context.useFilters}var i=function(){function K(){this.types={},this.schemas=new Map,this.useFilters=!1}return K.prototype.has=function(K){return this.schemas.has(K)},K.prototype.get=function(K){return this.types[K]},K.prototype.add=function(K,b){void 0===b&&(b=this.schemas.size),K._definition=Q.create(K._definition),K._typeid=b,this.types[b]=K,this.schemas.set(K,b)},K.create=function(b){return void 0===b&&(b={}),function(e){return b.context||(b.context=new K),M(e,b)}},K}(),S=new i;function M(K,b){return void 0===b&&(b={}),function(e,z){var j=b.context||S,T=e.constructor;if(T._context=j,!K)throw new Error("".concat(T.name,': @type() reference provided for "').concat(z,"\" is undefined. Make sure you don't have any circular dependencies."));j.has(T)||j.add(T);var F=T._definition;if(F.addField(z,K),F.descriptors[z]){if(F.deprecated[z])return;try{throw new Error("@colyseus/schema: Duplicate '".concat(z,"' definition on '").concat(T.name,"'.\nCheck @type() annotation"))}catch(D){var l=D.stack.split("\n")[4].trim();throw new Error("".concat(D.message," ").concat(l))}}var Y=B.is(K),A=!Y&&m.is(K);if("string"!==typeof K&&!RK.is(K)){var X=Object.values(K)[0];"string"===typeof X||j.has(X)||j.add(X)}if(b.manual)F.descriptors[z]={enumerable:!0,configurable:!0,writable:!0};else{var t="_".concat(z);F.descriptors[t]={enumerable:!1,configurable:!1,writable:!0},F.descriptors[z]={get:function(){return this[t]},set:function(K){K!==this[t]&&(void 0!==K&&null!==K?(!Y||K instanceof B||(K=new(B.bind.apply(B,k([void 0],K,!1)))),!A||K instanceof m||(K=new m(K)),void 0===K.$proxy&&(A?K=u(K):Y&&(K=U(K))),this.$changes.change(z),K.$changes&&K.$changes.setParent(this,this.$changes.root,this._definition.indexes[z])):this[t]&&this.$changes.delete(z),this[t]=K)},enumerable:!0,configurable:!0}}}}function r(K){return function(b,e){var z=b.constructor;z._definition.addFilter(e,K)&&(z._context.useFilters=!0)}}function L(K){return function(b,e){var z=b.constructor;z._definition.addChildrenFilter(e,K)&&(z._context.useFilters=!0)}}function c(K){return void 0===K&&(K=!0),function(b,e){var z=b.constructor._definition;z.deprecated[e]=!0,K&&(z.descriptors[e]={get:function(){throw new Error("".concat(e," is deprecated."))},set:function(K){},enumerable:!1,configurable:!0})}}function v(K,b,e){for(var z in void 0===e&&(e={}),e.context||(e.context=K._context||e.context||S),b)M(b[z],e)(K.prototype,z);return K}function w(K){for(var b=0,e=0,z=0,k=K.length;z<k;z++)(b=K.charCodeAt(z))<128?e+=1:b<2048?e+=2:b<55296||b>=57344?e+=3:(z++,e+=4);return e}function h(K,b,e){for(var z=0,k=0,j=e.length;k<j;k++)(z=e.charCodeAt(k))<128?K[b++]=z:z<2048?(K[b++]=192|z>>6,K[b++]=128|63&z):z<55296||z>=57344?(K[b++]=224|z>>12,K[b++]=128|z>>6&63,K[b++]=128|63&z):(k++,z=65536+((1023&z)<<10|1023&e.charCodeAt(k)),K[b++]=240|z>>18,K[b++]=128|z>>12&63,K[b++]=128|z>>6&63,K[b++]=128|63&z)}function R(K,b){K.push(255&b)}function n(K,b){K.push(255&b)}function P(K,b){K.push(255&b),K.push(b>>8&255)}function d(K,b){K.push(255&b),K.push(b>>8&255)}function p(K,b){K.push(255&b),K.push(b>>8&255),K.push(b>>16&255),K.push(b>>24&255)}function a(K,b){var e=b>>24,z=b>>16,k=b>>8,j=b;K.push(255&j),K.push(255&k),K.push(255&z),K.push(255&e)}function O(K,b){var e=Math.floor(b/Math.pow(2,32));a(K,b>>>0),a(K,e)}function g(K,b){var e=b/Math.pow(2,32)|0;a(K,b>>>0),a(K,e)}function N(K,b){o(K,b)}function Z(K,b){C(K,b)}var y=new Int32Array(2),s=new Float32Array(y.buffer),E=new Float64Array(y.buffer);function o(K,b){s[0]=b,p(K,y[0])}function C(K,b){E[0]=b,p(K,y[0]),p(K,y[1])}function H(K,b){return n(K,b?1:0)}function W(K,b){b||(b="");var e=w(b),z=0;if(e<32)K.push(160|e),z=1;else if(e<256)K.push(217),n(K,e),z=2;else if(e<65536)K.push(218),d(K,e),z=3;else{if(!(e<4294967296))throw new Error("String too long");K.push(219),a(K,e),z=5}return h(K,K.length,b),z+e}function f(K,b){return isNaN(b)?f(K,0):isFinite(b)?b!==(0|b)?(K.push(203),C(K,b),9):b>=0?b<128?(n(K,b),1):b<256?(K.push(204),n(K,b),2):b<65536?(K.push(205),d(K,b),3):b<4294967296?(K.push(206),a(K,b),5):(K.push(207),g(K,b),9):b>=-32?(K.push(224|b+32),1):b>=-128?(K.push(208),R(K,b),2):b>=-32768?(K.push(209),P(K,b),3):b>=-2147483648?(K.push(210),p(K,b),5):(K.push(211),O(K,b),9):f(K,b>0?Number.MAX_SAFE_INTEGER:-Number.MAX_SAFE_INTEGER)}var V=Object.freeze({__proto__:null,utf8Write:h,int8:R,uint8:n,int16:P,uint16:d,int32:p,uint32:a,int64:O,uint64:g,float32:N,float64:Z,writeFloat32:o,writeFloat64:C,boolean:H,string:W,number:f});function q(K,b,e){for(var z="",k=0,j=b,T=b+e;j<T;j++){var F=K[j];0!==(128&F)?192!==(224&F)?224!==(240&F)?240!==(248&F)?console.error("Invalid byte "+F.toString(16)):(k=(7&F)<<18|(63&K[++j])<<12|(63&K[++j])<<6|63&K[++j])>=65536?(k-=65536,z+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):z+=String.fromCharCode(k):z+=String.fromCharCode((15&F)<<12|(63&K[++j])<<6|63&K[++j]):z+=String.fromCharCode((31&F)<<6|63&K[++j]):z+=String.fromCharCode(F)}return z}function J(K,b){return KK(K,b)<<24>>24}function KK(K,b){return K[b.offset++]}function bK(K,b){return eK(K,b)<<16>>16}function eK(K,b){return K[b.offset++]|K[b.offset++]<<8}function zK(K,b){return K[b.offset++]|K[b.offset++]<<8|K[b.offset++]<<16|K[b.offset++]<<24}function kK(K,b){return zK(K,b)>>>0}function jK(K,b){return tK(K,b)}function TK(K,b){return UK(K,b)}function FK(K,b){var e=kK(K,b);return zK(K,b)*Math.pow(2,32)+e}function lK(K,b){var e=kK(K,b);return kK(K,b)*Math.pow(2,32)+e}var YK=new Int32Array(2),AK=new Float32Array(YK.buffer),XK=new Float64Array(YK.buffer);function tK(K,b){return YK[0]=zK(K,b),AK[0]}function UK(K,b){return YK[0]=zK(K,b),YK[1]=zK(K,b),XK[0]}function BK(K,b){return KK(K,b)>0}function uK(K,b){var e,z=K[b.offset++];z<192?e=31&z:217===z?e=KK(K,b):218===z?e=eK(K,b):219===z&&(e=kK(K,b));var k=q(K,b.offset,e);return b.offset+=e,k}function mK(K,b){var e=K[b.offset];return e<192&&e>160||217===e||218===e||219===e}function DK(K,b){var e=K[b.offset++];return e<128?e:202===e?tK(K,b):203===e?UK(K,b):204===e?KK(K,b):205===e?eK(K,b):206===e?kK(K,b):207===e?lK(K,b):208===e?J(K,b):209===e?bK(K,b):210===e?zK(K,b):211===e?FK(K,b):e>223?-1*(255-e+1):void 0}function IK(K,b){var e=K[b.offset];return e<128||e>=202&&e<=211}function xK(K,b){return K[b.offset]<160}function QK(K,b){return K[b.offset-1]===T&&(K[b.offset]<128||K[b.offset]>=202&&K[b.offset]<=211)}var GK=Object.freeze({__proto__:null,int8:J,uint8:KK,int16:bK,uint16:eK,int32:zK,uint32:kK,float32:jK,float64:TK,int64:FK,uint64:lK,readFloat32:tK,readFloat64:UK,boolean:BK,string:uK,stringCheck:mK,number:DK,numberCheck:IK,arrayCheck:xK,switchStructureCheck:QK}),iK=function(){function b(K){var b=this;this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return b.add(K)}))}return b.prototype.Bd=function(b,e){return void 0===e&&(e=!0),Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,b,e?this.$items:void 0)},b.prototype.ab=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,b)},b.is=function(K){return void 0!==K.collection},b.prototype.add=function(K){var b=this.$refId++;return void 0!==K.$changes&&K.$changes.setParent(this,this.$changes.root,b),this.$changes.indexes[b]=b,this.$indexes.set(b,b),this.$items.set(b,K),this.$changes.change(b),b},b.prototype.at=function(K){var b=Array.from(this.$items.keys())[K];return this.$items.get(b)},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(K){for(var b,e,z=this.$items.entries();(e=z.next())&&!e.done;)if(K===e.value[1]){b=e.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&A.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(K){return Array.from(this.$items.values()).some((function(b){return b===K}))},b.prototype.forEach=function(K){var b=this;this.$items.forEach((function(e,z,k){return K(e,z,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(K,b){this.$indexes.set(K,b)},b.prototype.getIndex=function(K){return this.$indexes.get(K)},b.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},b.prototype.deleteByIndex=function(K){var b=this.$indexes.get(K);this.$items.delete(b),this.$indexes.delete(K)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var K=[];return this.forEach((function(b,e){K.push("function"===typeof b.toJSON?b.toJSON():b)})),K},b.prototype.clone=function(K){var e;return K?e=Object.assign(new b,this):(e=new b,this.forEach((function(K){K.$changes?e.add(K.clone()):e.add(K)}))),e},b}(),SK=function(){function b(K){var b=this;this.$changes=new l(this),this.$items=new Map,this.$indexes=new Map,this.$refId=0,K&&K.forEach((function(K){return b.add(K)}))}return b.prototype.Bd=function(b,e){return void 0===e&&(e=!0),Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.ADD,b,e?this.$items:void 0)},b.prototype.ab=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,b)},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,b)},b.is=function(K){return void 0!==K.set},b.prototype.add=function(b){var e,z;if(this.has(b))return!1;var k=this.$refId++;void 0!==b.$changes&&b.$changes.setParent(this,this.$changes.root,k);var j=null!==(z=null===(e=this.$changes.indexes[k])||void 0===e?void 0:e.op)&&void 0!==z?z:K.OPERATION.ADD;return this.$changes.indexes[k]=k,this.$indexes.set(k,k),this.$items.set(k,b),this.$changes.change(k,j),k},b.prototype.entries=function(){return this.$items.entries()},b.prototype.delete=function(K){for(var b,e,z=this.$items.entries();(e=z.next())&&!e.done;)if(K===e.value[1]){b=e.value[0];break}return void 0!==b&&(this.$changes.delete(b),this.$indexes.delete(b),this.$items.delete(b))},b.prototype.clear=function(b){this.$changes.discard(!0,!0),this.$changes.indexes={},this.$indexes.clear(),b&&A.call(this,b),this.$items.clear(),this.$changes.operation({index:0,op:K.OPERATION.CLEAR}),this.$changes.touchParents()},b.prototype.has=function(K){for(var b,e=this.$items.values(),z=!1;(b=e.next())&&!b.done;)if(K===b.value){z=!0;break}return z},b.prototype.forEach=function(K){var b=this;this.$items.forEach((function(e,z,k){return K(e,z,b)}))},b.prototype.values=function(){return this.$items.values()},Object.defineProperty(b.prototype,"size",{get:function(){return this.$items.size},enumerable:!1,configurable:!0}),b.prototype.setIndex=function(K,b){this.$indexes.set(K,b)},b.prototype.getIndex=function(K){return this.$indexes.get(K)},b.prototype.getByIndex=function(K){return this.$items.get(this.$indexes.get(K))},b.prototype.deleteByIndex=function(K){var b=this.$indexes.get(K);this.$items.delete(b),this.$indexes.delete(K)},b.prototype.toArray=function(){return Array.from(this.$items.values())},b.prototype.toJSON=function(){var K=[];return this.forEach((function(b,e){K.push("function"===typeof b.toJSON?b.toJSON():b)})),K},b.prototype.clone=function(K){var e;return K?e=Object.assign(new b,this):(e=new b,this.forEach((function(K){K.$changes?e.add(K.clone()):e.add(K)}))),e},b}(),MK=function(){function K(){this.refIds=new WeakSet,this.containerIndexes=new WeakMap}return K.prototype.addRefId=function(K){this.refIds.has(K)||(this.refIds.add(K),this.containerIndexes.set(K,new Set))},K.get=function(b){return void 0===b.$filterState&&(b.$filterState=new K),b.$filterState},K}(),rK=function(){function K(){this.refs=new Map,this.refCounts={},this.deletedRefs=new Set,this.nextUniqueId=0}return K.prototype.getNextUniqueId=function(){return this.nextUniqueId++},K.prototype.addRef=function(K,b,e){void 0===e&&(e=!0),this.refs.set(K,b),e&&(this.refCounts[K]=(this.refCounts[K]||0)+1)},K.prototype.removeRef=function(K){this.refCounts[K]=this.refCounts[K]-1,this.deletedRefs.add(K)},K.prototype.clearRefs=function(){this.refs.clear(),this.deletedRefs.clear(),this.refCounts={}},K.prototype.garbageCollectDeletedRefs=function(){var K=this;this.deletedRefs.forEach((function(b){if(!(K.refCounts[b]>0)){var e=K.refs.get(b);if(e instanceof RK)for(var z in e._definition.schema)"string"!==typeof e._definition.schema[z]&&e[z]&&e[z].$changes&&K.removeRef(e[z].$changes.refId);else{var k=e.$changes.parent._definition,j=k.schema[k.fieldsByIndex[e.$changes.parentIndex]];"function"===typeof Object.values(j)[0]&&Array.from(e.values()).forEach((function(b){return K.removeRef(b.$changes.refId)}))}K.refs.delete(b),delete K.refCounts[b]}})),this.deletedRefs.clear()},K}(),LK=function(K){function b(){return null!==K&&K.apply(this,arguments)||this}return e(b,K),b}(Error);function cK(K,b,e,z){var k,j=!1;switch(b){case"number":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":case"int64":case"uint64":case"float32":case"float64":k="number",isNaN(K)&&console.log('trying to encode "NaN" in '.concat(e.constructor.name,"#").concat(z));break;case"string":k="string",j=!0;break;case"boolean":return}if(typeof K!==k&&(!j||j&&null!==K)){var T="'".concat(JSON.stringify(K),"'").concat(K&&K.constructor&&" (".concat(K.constructor.name,")")||"");throw new LK("a '".concat(k,"' was expected, but ").concat(T," was provided in ").concat(e.constructor.name,"#").concat(z))}}function vK(K,b,e,z){if(!(K instanceof b))throw new LK("a '".concat(b.name,"' was expected, but '").concat(K.constructor.name,"' was provided in ").concat(e.constructor.name,"#").concat(z))}function wK(K,b,e,z,k){cK(e,K,z,k);var j=V[K];if(!j)throw new LK("a '".concat(K,"' was expected, but ").concat(e," was provided in ").concat(z.constructor.name,"#").concat(k));j(b,e)}function hK(K,b,e){return GK[K](b,e)}var RK=function(){function b(){for(var K=[],b=0;b<arguments.length;b++)K[b]=arguments[b];Object.defineProperties(this,{$changes:{value:new l(this,void 0,new rK),enumerable:!1,writable:!0},$callbacks:{value:void 0,enumerable:!1,writable:!0}});var e=this._definition.descriptors;e&&Object.defineProperties(this,e),K[0]&&this.assign(K[0])}return b.onError=function(K){console.error(K)},b.is=function(K){return K._definition&&void 0!==K._definition.schema},b.prototype.onChange=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.REPLACE,b)},b.prototype.ab=function(b){return Y(this.$callbacks||(this.$callbacks=[]),K.OPERATION.DELETE,b)},b.prototype.assign=function(K){return Object.assign(this,K),this},Object.defineProperty(b.prototype,"_definition",{get:function(){return this.constructor._definition},enumerable:!1,configurable:!0}),b.prototype.setDirty=function(K,b){this.$changes.change(K,b)},b.prototype.listen=function(K,b,e){var z=this;return void 0===e&&(e=!0),this.$callbacks||(this.$callbacks={}),this.$callbacks[K]||(this.$callbacks[K]=[]),this.$callbacks[K].push(b),e&&void 0!==this[K]&&b(this[K],void 0),function(){return X(z.$callbacks[K],z.$callbacks[K].indexOf(b))}},b.prototype.decode=function(e,z,k){var j;void 0===z&&(z={offset:0}),void 0===k&&(k=this);var F=[],l=this.$changes.root,Y=e.length,A=0;for(l.refs.set(A,this);z.offset<Y;){var X=e[z.offset++];if(X!=T){var t=k.$changes,U=void 0!==k._definition,u=U?X>>6<<6:X;if(u!==K.OPERATION.CLEAR){var D=U?X%(u||255):DK(e,z),I=U?k._definition.fieldsByIndex[D]:"",Q=t.getType(D),G=void 0,i=void 0,S=void 0;if(U?i=k["_".concat(I)]:(i=k.getByIndex(D),(u&K.OPERATION.ADD)===K.OPERATION.ADD?(S=k instanceof m?uK(e,z):D,k.setIndex(D,S)):S=k.getIndex(D)),(u&K.OPERATION.DELETE)===K.OPERATION.DELETE&&(u!==K.OPERATION.DELETE_AND_ADD&&k.deleteByIndex(D),i&&i.$changes&&l.removeRef(i.$changes.refId),G=null),void 0!==I){if(u===K.OPERATION.DELETE);else if(b.is(Q)){var M=DK(e,z);if(G=l.refs.get(M),u!==K.OPERATION.REPLACE){var r=this.getSchemaType(e,z,Q);G||((G=this.createTypeInstance(r)).$changes.refId=M,i&&(G.$callbacks=i.$callbacks,i.$changes.refId&&M!==i.$changes.refId&&l.removeRef(i.$changes.refId))),l.addRef(M,G,G!==i)}}else if("string"===typeof Q)G=hK(Q,e,z);else{var L=x(Object.keys(Q)[0]),c=DK(e,z),v=l.refs.has(c)?i||l.refs.get(c):new L.constructor;if((G=v.clone(!0)).$changes.refId=c,i&&(G.$callbacks=i.$callbacks,i.$changes.refId&&c!==i.$changes.refId)){l.removeRef(i.$changes.refId);for(var w=i.entries(),h=void 0;(h=w.next())&&!h.done;){var R=(j=h.value)[0],n=j[1];F.push({refId:c,op:K.OPERATION.DELETE,field:R,value:void 0,previousValue:n})}}l.addRef(c,G,v!==i)}if(null!==G&&void 0!==G)if(G.$changes&&G.$changes.setParent(t.ref,t.root,D),k instanceof b)k[I]=G;else if(k instanceof m)R=S,k.$items.set(R,G),k.$changes.allChanges.add(D);else if(k instanceof B)k.setAt(D,G);else if(k instanceof iK){var P=k.add(G);k.setIndex(D,P)}else k instanceof SK&&!1!==(P=k.add(G))&&k.setIndex(D,P);i!==G&&F.push({refId:A,op:u,field:I,dynamicIndex:S,value:G,previousValue:i})}else{console.warn("@colyseus/schema: definition mismatch");for(var d={offset:z.offset};z.offset<Y&&(!QK(e,z)||(d.offset=z.offset+1,!l.refs.has(DK(e,d))));)z.offset++}}else k.clear(F)}else{A=DK(e,z);var p=l.refs.get(A);if(!p)throw new Error('"refId" not found: '.concat(A));k=p}}return this._triggerChanges(F),l.garbageCollectDeletedRefs(),F},b.prototype.encode=function(e,z,k){void 0===e&&(e=!1),void 0===z&&(z=[]),void 0===k&&(k=!1);for(var j=this.$changes,F=new WeakSet,l=[j],Y=1,A=0;A<Y;A++){var X=l[A],t=X.ref,U=t instanceof b;X.ensureRefId(),F.add(X),X!==j&&(X.changed||e)&&(n(z,T),f(z,X.refId));for(var B=e?Array.from(X.allChanges):Array.from(X.changes.values()),u=0,D=B.length;u<D;u++){var I=e?{op:K.OPERATION.ADD,index:B[u]}:B[u],Q=I.index,G=U?t._definition.fieldsByIndex&&t._definition.fieldsByIndex[Q]:Q,i=z.length;if(I.op!==K.OPERATION.TOUCH)if(U)n(z,Q|I.op);else{if(n(z,I.op),I.op===K.OPERATION.CLEAR)continue;f(z,Q)}if(U||(I.op&K.OPERATION.ADD)!=K.OPERATION.ADD||t instanceof m&&W(z,X.ref.$indexes.get(Q)),I.op!==K.OPERATION.DELETE){var S=X.getType(Q),M=X.getValue(Q);if(M&&M.$changes&&!F.has(M.$changes)&&(l.push(M.$changes),M.$changes.ensureRefId(),Y++),I.op!==K.OPERATION.TOUCH){if(b.is(S))vK(M,S,t,G),f(z,M.$changes.refId),(I.op&K.OPERATION.ADD)===K.OPERATION.ADD&&this.tryEncodeTypeId(z,S,M.constructor);else if("string"===typeof S)wK(S,z,M,t,G);else{var r=x(Object.keys(S)[0]);vK(t["_".concat(G)],r.constructor,t,G),f(z,M.$changes.refId)}k&&X.cache(Q,z.slice(i))}}}e||k||X.discard()}return z},b.prototype.encodeAll=function(K){return this.encode(!0,[],K)},b.prototype.applyFilters=function(e,z){var k,j;void 0===z&&(z=!1);for(var F=this,l=new Set,Y=MK.get(e),A=[this.$changes],X=1,t=[],U=function(U){var B=A[U];if(l.has(B.refId))return"continue";var u=B.ref,D=u instanceof b;n(t,T),f(t,B.refId);var I=Y.refIds.has(B),x=z||!I;Y.addRefId(B);var Q=Y.containerIndexes.get(B),G=x?Array.from(B.allChanges):Array.from(B.changes.values());!z&&D&&u._definition.indexesWithFilters&&u._definition.indexesWithFilters.forEach((function(b){!Q.has(b)&&B.allChanges.has(b)&&(x?G.push(b):G.push({op:K.OPERATION.ADD,index:b}))}));for(var i=0,S=G.length;i<S;i++){var M=x?{op:K.OPERATION.ADD,index:G[i]}:G[i];if(M.op!==K.OPERATION.CLEAR){var r=M.index;if(M.op!==K.OPERATION.DELETE){var L=B.getValue(r),c=B.getType(r);if(D){if((v=u._definition.filters&&u._definition.filters[r])&&!v.call(u,e,L,F)){L&&L.$changes&&l.add(L.$changes.refId);continue}}else{var v,w=B.parent;if((v=B.getChildrenFilter())&&!v.call(w,e,u.$indexes.get(r),L,F)){L&&L.$changes&&l.add(L.$changes.refId);continue}}if(L.$changes&&(A.push(L.$changes),X++),M.op!==K.OPERATION.TOUCH)if(M.op===K.OPERATION.ADD||D)t.push.apply(t,null!==(k=B.caches[r])&&void 0!==k?k:[]),Q.add(r);else if(Q.has(r))t.push.apply(t,null!==(j=B.caches[r])&&void 0!==j?j:[]);else{if(Q.add(r),n(t,K.OPERATION.ADD),f(t,r),u instanceof m){var h=B.ref.$indexes.get(r);W(t,h)}L.$changes?f(t,L.$changes.refId):V[c](t,L)}else L.$changes&&!D&&(n(t,K.OPERATION.ADD),f(t,r),u instanceof m&&(h=B.ref.$indexes.get(r),W(t,h)),f(t,L.$changes.refId))}else D?n(t,M.op|r):(n(t,M.op),f(t,r))}else n(t,M.op)}},B=0;B<X;B++)U(B);return t},b.prototype.clone=function(){var K,b=new this.constructor,e=this._definition.schema;for(var z in e)"object"===typeof this[z]&&"function"===typeof(null===(K=this[z])||void 0===K?void 0:K.clone)?b[z]=this[z].clone():b[z]=this[z];return b},b.prototype.toJSON=function(){var K=this._definition.schema,b=this._definition.deprecated,e={};for(var z in K)b[z]||null===this[z]||"undefined"===typeof this[z]||(e[z]="function"===typeof this[z].toJSON?this[z].toJSON():this["_".concat(z)]);return e},b.prototype.discardAllChanges=function(){this.$changes.discardAll()},b.prototype.getByIndex=function(K){return this[this._definition.fieldsByIndex[K]]},b.prototype.deleteByIndex=function(K){this[this._definition.fieldsByIndex[K]]=void 0},b.prototype.tryEncodeTypeId=function(K,b,e){b._typeid!==e._typeid&&(n(K,F),f(K,e._typeid))},b.prototype.getSchemaType=function(K,b,e){var z;return K[b.offset]===F&&(b.offset++,z=this.constructor._context.get(DK(K,b))),z||e},b.prototype.createTypeInstance=function(K){var b=new K;return b.$changes.root=this.$changes.root,b},b.prototype._triggerChanges=function(e){for(var z,k,j,T,F,l,Y,A,X,t=new Set,U=this.$changes.root.refs,B=function(B){var u=e[B],m=u.refId,D=U.get(m),I=D.$callbacks;if((u.op&K.OPERATION.DELETE)===K.OPERATION.DELETE&&u.previousValue instanceof b&&(null===(k=null===(z=u.previousValue.$callbacks)||void 0===z?void 0:z[K.OPERATION.DELETE])||void 0===k||k.forEach((function(K){return K()}))),!I)return"continue";if(D instanceof b){if(!t.has(m))try{null===(j=null===I||void 0===I?void 0:I[K.OPERATION.REPLACE])||void 0===j||j.forEach((function(K){return K()}))}catch(x){b.onError(x)}try{I.hasOwnProperty(u.field)&&(null===(T=I[u.field])||void 0===T||T.forEach((function(K){return K(u.value,u.previousValue)})))}catch(x){b.onError(x)}}else u.op===K.OPERATION.ADD&&void 0===u.previousValue?null===(F=I[K.OPERATION.ADD])||void 0===F||F.forEach((function(K){var b;return K(u.value,null!==(b=u.dynamicIndex)&&void 0!==b?b:u.field)})):u.op===K.OPERATION.DELETE?void 0!==u.previousValue&&(null===(l=I[K.OPERATION.DELETE])||void 0===l||l.forEach((function(K){var b;return K(u.previousValue,null!==(b=u.dynamicIndex)&&void 0!==b?b:u.field)}))):u.op===K.OPERATION.DELETE_AND_ADD&&(void 0!==u.previousValue&&(null===(Y=I[K.OPERATION.DELETE])||void 0===Y||Y.forEach((function(K){var b;return K(u.previousValue,null!==(b=u.dynamicIndex)&&void 0!==b?b:u.field)}))),null===(A=I[K.OPERATION.ADD])||void 0===A||A.forEach((function(K){var b;return K(u.value,null!==(b=u.dynamicIndex)&&void 0!==b?b:u.field)}))),u.value!==u.previousValue&&(null===(X=I[K.OPERATION.REPLACE])||void 0===X||X.forEach((function(K){var b;return K(u.value,null!==(b=u.dynamicIndex)&&void 0!==b?b:u.field)})));t.add(m)},u=0;u<e.length;u++)B(u)},b._definition=Q.create(),b}();function nK(K){for(var b=[K.$changes],e=1,z={},k=z,j=function(K){var e=b[K];e.changes.forEach((function(K){var b=e.ref,z=K.index,j=b._definition?b._definition.fieldsByIndex[z]:b.$indexes.get(z);k[j]=e.getValue(z)}))},T=0;T<e;T++)j(T);return z}var PK={context:new i},dK=function(K){function b(){return null!==K&&K.apply(this,arguments)||this}return e(b,K),z([M("string",PK)],b.prototype,"name",void 0),z([M("string",PK)],b.prototype,"type",void 0),z([M("number",PK)],b.prototype,"referencedType",void 0),b}(RK),pK=function(K){function b(){var b=null!==K&&K.apply(this,arguments)||this;return b.fields=new B,b}return e(b,K),z([M("number",PK)],b.prototype,"id",void 0),z([M([dK],PK)],b.prototype,"fields",void 0),b}(RK),aK=function(K){function b(){var b=null!==K&&K.apply(this,arguments)||this;return b.types=new B,b}return e(b,K),b.encode=function(K){var e=K.constructor,z=new b;z.rootType=e._typeid;var k=function(K,b){for(var e in b){var k=new dK;k.name=e;var j=void 0;if("string"===typeof b[e])j=b[e];else{var T=b[e],F=void 0;RK.is(T)?(j="ref",F=b[e]):"string"===typeof T[j=Object.keys(T)[0]]?j+=":"+T[j]:F=T[j],k.referencedType=F?F._typeid:-1}k.type=j,K.fields.push(k)}z.types.push(K)},j=e._context.types;for(var T in j){var F=new pK;F.id=Number(T),k(F,j[T]._definition.schema)}return z.encodeAll()},b.decode=function(K,z){var k=new i,j=new b;j.decode(K,z);var T=j.types.reduce((function(K,b){var z=function(K){function b(){return null!==K&&K.apply(this,arguments)||this}return e(b,K),b}(RK),j=b.id;return K[j]=z,k.add(z,j),K}),{});j.types.forEach((function(K){var b=T[K.id];K.fields.forEach((function(K){var e;if(void 0!==K.referencedType){var z=K.type,j=T[K.referencedType];if(!j){var F=K.type.split(":");z=F[0],j=F[1]}"ref"===z?M(j,{context:k})(b.prototype,K.name):M(((e={})[z]=j,e),{context:k})(b.prototype,K.name)}else M(K.type,{context:k})(b.prototype,K.name)}))}));var F=T[j.rootType],l=new F;for(var Y in F._definition.schema){var A=F._definition.schema[Y];"string"!==typeof A&&(l[Y]="function"===typeof A?new A:new(x(Object.keys(A)[0]).constructor))}return l},z([M([pK],PK)],b.prototype,"types",void 0),z([M("number",PK)],b.prototype,"rootType",void 0),b}(RK);I("map",{constructor:m}),I("array",{constructor:B}),I("set",{constructor:SK}),I("collection",{constructor:iK}),K.ArraySchema=B,K.CollectionSchema=iK,K.Context=i,K.MapSchema=m,K.Reflection=aK,K.ReflectionField=dK,K.ReflectionType=pK,K.Schema=RK,K.SchemaDefinition=Q,K.SetSchema=SK,K.decode=GK,K.defineTypes=v,K.deprecated=c,K.dumpChanges=nK,K.encode=V,K.filter=r,K.filterChildren=L,K.hasFilter=G,K.registerType=I,K.type=M,Object.defineProperty(K,"__esModule",{value:!0})}(b)},12165:K=>{K.exports=function(K){return null!=K&&null!=K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}},12140:(K,b,e)=>{"use strict";var z=e(12149),k=e(12158),j=e(12165);e.g.__TYPEDARRAY_POOL||(e.g.__TYPEDARRAY_POOL={UINT8:k([32,0]),UINT16:k([32,0]),UINT32:k([32,0]),INT8:k([32,0]),INT16:k([32,0]),INT32:k([32,0]),FLOAT:k([32,0]),DOUBLE:k([32,0]),DATA:k([32,0]),UINT8C:k([32,0]),BUFFER:k([32,0])});var T="undefined"!==typeof Uint8ClampedArray,F=e.g.__TYPEDARRAY_POOL;F.UINT8C||(F.UINT8C=k([32,0])),F.BUFFER||(F.BUFFER=k([32,0]));var l=F.DATA,Y=F.BUFFER;function A(K){if(K){var b=K.length||K.byteLength,e=z.log2(b);l[e].push(K)}}function X(K){K=z.nextPow2(K);var b=z.log2(K),e=l[b];return e.length>0?e.pop():new ArrayBuffer(K)}function t(K){return new Uint8Array(X(K),0,K)}function U(K){return new Uint16Array(X(2*K),0,K)}function B(K){return new Uint32Array(X(4*K),0,K)}function u(K){return new Int8Array(X(K),0,K)}function m(K){return new Int16Array(X(2*K),0,K)}function D(K){return new Int32Array(X(4*K),0,K)}function I(K){return new Float32Array(X(4*K),0,K)}function x(K){return new Float64Array(X(8*K),0,K)}function Q(K){return T?new Uint8ClampedArray(X(K),0,K):t(K)}function G(K){return new DataView(X(K),0,K)}b.free=function(K){if(j(K))Y[z.log2(K.length)].push(K);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(K)&&(K=K.buffer),!K)return;var b=K.length||K.byteLength,e=0|z.log2(b);l[e].push(K)}},b.freeUint8=b.freeUint16=b.freeUint32=b.freeInt8=b.freeInt16=b.freeInt32=b.freeFloat32=b.freeFloat=b.freeFloat64=b.freeDouble=b.freeUint8Clamped=b.freeDataView=function(K){A(K.buffer)},b.freeArrayBuffer=A,b.freeBuffer=function(K){Y[z.log2(K.length)].push(K)},b.malloc=function(K,b){if(void 0===b||"arraybuffer"===b)return X(K);switch(b){case"uint8":return t(K);case"uint16":return U(K);case"uint32":return B(K);case"int8":return u(K);case"int16":return m(K);case"int32":return D(K);case"float":case"float32":return I(K);case"double":case"float64":return x(K);case"uint8_clamped":return Q(K);case"buffer":throw"Buffer not supported";case"data":case"dataview":return G(K);default:return null}return null},b.mallocArrayBuffer=X,b.mallocUint8=t,b.mallocUint16=U,b.mallocUint32=B,b.mallocInt8=u,b.mallocInt16=m,b.mallocInt32=D,b.mallocFloat32=b.mallocFloat=I,b.mallocFloat64=b.mallocDouble=x,b.mallocUint8Clamped=Q,b.mallocDataView=G,b.clearCache=function(){for(var K=0;K<32;++K)F.UINT8[K].length=0,F.UINT16[K].length=0,F.UINT32[K].length=0,F.INT8[K].length=0,F.INT16[K].length=0,F.INT32[K].length=0,F.FLOAT[K].length=0,F.DOUBLE[K].length=0,F.UINT8C[K].length=0,l[K].length=0,Y[K].length=0}},12249:(K,b,e)=>{K.exports=k;var z=e(126);function k(K,b){if(!(this instanceof k))return new k(K,b);var e=z.create();z.add(e,K,b),this.base=z.min(z.create(),K,e),this.Fg=z.clone(b),this.max=z.max(z.create(),K,e),this.mag=z.length(this.Fg)}var j=k.prototype;j.width=function(){return this.Fg[0]},j.height=function(){return this.Fg[1]},j.depth=function(){return this.Fg[2]},j.x0=function(){return this.base[0]},j.y0=function(){return this.base[1]},j.z0=function(){return this.base[2]},j.x1=function(){return this.max[0]},j.y1=function(){return this.max[1]},j.z1=function(){return this.max[2]},j.translate=function(K){return z.add(this.max,this.max,K),z.add(this.base,this.base,K),this},j.setPosition=function(K){return z.add(this.max,K,this.Fg),z.i(this.base,K),this},j.expand=function(K){var b=z.create(),e=z.create();return z.max(b,K.max,this.max),z.min(e,K.base,this.base),z.Qc(b,b,e),new k(e,b)},j.intersects=function(K){return!(K.base[0]>this.max[0])&&(!(K.base[1]>this.max[1])&&(!(K.base[2]>this.max[2])&&(!(K.max[0]<this.base[0])&&(!(K.max[1]<this.base[1])&&!(K.max[2]<this.base[2])))))},j.touches=function(K){var b=this.union(K);return null!==b&&(0==b.width()||0==b.height()||0==b.depth())},j.union=function(K){if(!this.intersects(K))return null;var b=Math.max(K.base[0],this.base[0]),e=Math.max(K.base[1],this.base[1]),z=Math.max(K.base[2],this.base[2]);return new k([b,e,z],[Math.min(K.max[0],this.max[0])-b,Math.min(K.max[1],this.max[1])-e,Math.min(K.max[2],this.max[2])-z])}},12149:(K,b)=>{"use strict";function e(K){var b=32;return(K&=-K)&&b--,65535&K&&(b-=16),16711935&K&&(b-=8),252645135&K&&(b-=4),858993459&K&&(b-=2),1431655765&K&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(K){return(K>0)-(K<0)},b.abs=function(K){var b=K>>31;return(K^b)-b},b.min=function(K,b){return b^(K^b)&-(K<b)},b.max=function(K,b){return K^(K^b)&-(K<b)},b.isPow2=function(K){return!(K&K-1)&&!!K},b.log2=function(K){var b,e;return b=(K>65535)<<4,b|=e=((K>>>=b)>255)<<3,b|=e=((K>>>=e)>15)<<2,(b|=e=((K>>>=e)>3)<<1)|(K>>>=e)>>1},b.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},b.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},b.countTrailingZeros=e,b.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},b.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},b.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var z=new Array(256);!function(K){for(var b=0;b<256;++b){var e=b,z=b,k=7;for(e>>>=1;e;e>>>=1)z<<=1,z|=1&e,--k;K[b]=z<<k&255}}(z),b.reverse=function(K){return z[255&K]<<24|z[K>>>8&255]<<16|z[K>>>16&255]<<8|z[K>>>24&255]},b.interleave2=function(K,b){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(K,b){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>b&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},b.interleave3=function(K,b,e){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<2},b.deinterleave3=function(K,b){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>b&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},b.nextCombination=function(K){var b=K|K-1;return b+1|(~b&-~b)-1>>>e(K)+1}},12134:(K,b,e)=>{"use strict";K.exports=function(K,b,e){switch(arguments.length){case 1:return z=[],Y(k=K,k,A,!0),z;case 2:return"function"===typeof b?Y(K,K,b,!0):function(K,b){return z=[],Y(K,b,A,!1),z}(K,b);case 3:return Y(K,b,e,!1);default:throw new Error("box-intersect: Invalid arguments")}var k};var z,k=e(12140),j=e(12174),T=e(12185);function F(K,b){for(var e=0;e<K;++e)if(!(b[e]<=b[e+K]))return!0;return!1}function l(K,b,e,z){for(var k=0,j=0,T=0,l=K.length;T<l;++T){var Y=K[T];if(!F(b,Y)){for(var A=0;A<2*b;++A)e[k++]=Y[A];z[j++]=T}}return j}function Y(K,b,e,z){var F=K.length,Y=b.length;if(!(F<=0||Y<=0)){var A=K[0].length>>>1;if(!(A<=0)){var X,t=k.mallocDouble(2*A*F),U=k.mallocInt32(F);if((F=l(K,A,t,U))>0){if(1===A&&z)j.init(F),X=j.sweepComplete(A,e,0,F,t,U,0,F,t,U);else{var B=k.mallocDouble(2*A*Y),u=k.mallocInt32(Y);(Y=l(b,A,B,u))>0&&(j.init(F+Y),X=1===A?j.sweepBipartite(A,e,0,F,t,U,0,Y,B,u):T(A,e,z,F,t,U,Y,B,u),k.free(B),k.free(u))}k.free(t),k.free(U)}return X}}}function A(K,b){z.push([K,b])}},12192:(K,b)=>{"use strict";var e="d",z="ax",k="fp",j="es",T="rs",F="re",l="rb",Y="bs",A="be",X="bb",t=[e,z,"vv",T,F,l,"ri",Y,A,X,"bi"];function U(K){var b="bruteForce"+(K?"Full":"Partial"),z=[],T=t.slice();K||T.splice(3,0,k);var F=["function "+b+"("+T.join()+"){"];function l(b,k){var T=function(K,b,z){var k="bruteForce"+(K?"Red":"Blue")+(b?"Flip":"")+(z?"Full":""),T=["function ",k,"(",t.join(),"){","var ",j,"=2*",e,";"],F="for(var i=rs,rp=es*rs;i<re;++i,rp+=es){var x0=rb[ax+rp],x1=rb[ax+rp+d],xi=ri[i];",l="for(var j=bs,bp=es*bs;j<be;++j,bp+=es){var y0=bb[ax+bp],"+(z?"y1=bb[ax+bp+d],":"")+"yi=bi[j];";return K?T.push(F,"Q",":",l):T.push(l,"Q",":",F),z?T.push("if(y1<x0||x1<y0)continue;"):b?T.push("if(y0<=x0||x1<y0)continue;"):T.push("if(y0<x0||x1<y0)continue;"),T.push("for(var k=ax+1;k<d;++k){var r0=rb[k+rp],r1=rb[k+d+rp],b0=bb[k+bp],b1=bb[k+d+bp];if(r1<b0||b1<r0)continue Q;}var rv=vv("),b?T.push("yi,xi"):T.push("xi,yi"),T.push(");if(rv!==void 0)return rv;}}}"),{name:k,code:T.join("")}}(b,k,K);z.push(T.code),F.push("return "+T.name+"("+t.join()+");")}F.push("if(re-rs>be-bs){"),K?(l(!0,!1),F.push("}else{"),l(!1,!1)):(F.push("if(fp){"),l(!0,!0),F.push("}else{"),l(!0,!1),F.push("}}else{if(fp){"),l(!1,!0),F.push("}else{"),l(!1,!1),F.push("}")),F.push("}}return "+b);var Y=z.join("")+F.join("");return new Function(Y)()}b.partial=U(!1),b.full=U(!0)},12185:(K,b,e)=>{"use strict";K.exports=function(K,b,e,j,A,c,v,w,h){!function(K,b){var e=8*k.log2(b+1)*(K+1)|0,j=k.nextPow2(Q*e);i.length<j&&(z.free(i),i=z.mallocInt32(j));var T=k.nextPow2(G*e);S.length<T&&(z.free(S),S=z.mallocDouble(T))}(K,j+v);var R,n=0,P=2*K;M(n++,0,0,j,0,v,e?16:0,-1/0,1/0),e||M(n++,0,0,v,0,j,1,-1/0,1/0);for(;n>0;){var d=(n-=1)*Q,p=i[d],a=i[d+1],O=i[d+2],g=i[d+3],N=i[d+4],Z=i[d+5],y=n*G,s=S[y],E=S[y+1],o=1&Z,C=!!(16&Z),H=A,W=c,f=w,V=h;if(o&&(H=w,W=h,f=A,V=c),!(2&Z&&a>=(O=m(K,p,a,O,H,W,E)))&&!(4&Z&&(a=D(K,p,a,O,H,W,s))>=O)){var q=O-a,J=N-g;if(C){if(K*q*(q+J)<U){if(void 0!==(R=l.scanComplete(K,p,b,a,O,H,W,g,N,f,V)))return R;continue}}else{if(K*Math.min(q,J)<X){if(void 0!==(R=T(K,p,b,o,a,O,H,W,g,N,f,V)))return R;continue}if(K*q*J<t){if(void 0!==(R=l.scanBipartite(K,p,b,o,a,O,H,W,g,N,f,V)))return R;continue}}var KK=B(K,p,a,O,H,W,s,E);if(a<KK)if(K*(KK-a)<X){if(void 0!==(R=F(K,p+1,b,a,KK,H,W,g,N,f,V)))return R}else if(p===K-2){if(void 0!==(R=o?l.sweepBipartite(K,b,g,N,f,V,a,KK,H,W):l.sweepBipartite(K,b,a,KK,H,W,g,N,f,V)))return R}else M(n++,p+1,a,KK,g,N,o,-1/0,1/0),M(n++,p+1,g,N,a,KK,1^o,-1/0,1/0);if(KK<O){var bK=Y(K,p,g,N,f,V),eK=f[P*bK+p],zK=u(K,p,bK,N,f,V,eK);if(zK<N&&M(n++,p,KK,O,zK,N,(4|o)+(C?16:0),eK,E),g<bK&&M(n++,p,KK,O,g,bK,(2|o)+(C?16:0),s,eK),bK+1===zK){if(void 0!==(R=C?L(K,p,b,KK,O,H,W,bK,f,V[bK]):r(K,p,b,o,KK,O,H,W,bK,f,V[bK])))return R}else if(bK<zK){var kK;if(C){if(KK<(kK=I(K,p,KK,O,H,W,eK))){var jK=u(K,p,KK,kK,H,W,eK);if(p===K-2){if(KK<jK&&void 0!==(R=l.sweepComplete(K,b,KK,jK,H,W,bK,zK,f,V)))return R;if(jK<kK&&void 0!==(R=l.sweepBipartite(K,b,jK,kK,H,W,bK,zK,f,V)))return R}else KK<jK&&M(n++,p+1,KK,jK,bK,zK,16,-1/0,1/0),jK<kK&&(M(n++,p+1,jK,kK,bK,zK,0,-1/0,1/0),M(n++,p+1,bK,zK,jK,kK,1,-1/0,1/0))}}else KK<(kK=o?x(K,p,KK,O,H,W,eK):I(K,p,KK,O,H,W,eK))&&(p===K-2?R=o?l.sweepBipartite(K,b,bK,zK,f,V,KK,kK,H,W):l.sweepBipartite(K,b,KK,kK,H,W,bK,zK,f,V):(M(n++,p+1,KK,kK,bK,zK,o,-1/0,1/0),M(n++,p+1,bK,zK,KK,kK,1^o,-1/0,1/0)))}}}}};var z=e(12140),k=e(12149),j=e(12192),T=j.partial,F=j.full,l=e(12174),Y=e(12200),A=e(12203),X=128,t=1<<22,U=1<<22,B=A("!(lo>=p0)&&!(p1>=hi)",["p0","p1"]),u=A("lo===p0",["p0"]),m=A("lo<p0",["p0"]),D=A("hi<=p0",["p0"]),I=A("lo<=p0&&p0<=hi",["p0"]),x=A("lo<p0&&p0<=hi",["p0"]),Q=6,G=2,i=z.mallocInt32(1024),S=z.mallocDouble(1024);function M(K,b,e,z,k,j,T,F,l){var Y=Q*K;i[Y]=b,i[Y+1]=e,i[Y+2]=z,i[Y+3]=k,i[Y+4]=j,i[Y+5]=T;var A=G*K;S[A]=F,S[A+1]=l}function r(K,b,e,z,k,j,T,F,l,Y,A){var X=2*K,t=l*X,U=Y[t+b];K:for(var B=k,u=k*X;B<j;++B,u+=X){var m=T[u+b],D=T[u+b+K];if(!(U<m||D<U)&&(!z||U!==m)){for(var I,x=F[B],Q=b+1;Q<K;++Q){m=T[u+Q],D=T[u+Q+K];var G=Y[t+Q],i=Y[t+Q+K];if(D<G||i<m)continue K}if(void 0!==(I=z?e(A,x):e(x,A)))return I}}}function L(K,b,e,z,k,j,T,F,l,Y){var A=2*K,X=F*A,t=l[X+b];K:for(var U=z,B=z*A;U<k;++U,B+=A){var u=T[U];if(u!==Y){var m=j[B+b],D=j[B+b+K];if(!(t<m||D<t)){for(var I=b+1;I<K;++I){m=j[B+I],D=j[B+I+K];var x=l[X+I],Q=l[X+I+K];if(D<x||Q<m)continue K}var G=e(u,Y);if(void 0!==G)return G}}}}},12200:(K,b,e)=>{"use strict";K.exports=function(K,b,e,T,F,l){if(T<=e+1)return e;var Y=e,A=T,X=T+e>>>1,t=2*K,U=X,B=F[t*X+b];for(;Y<A;){if(A-Y<k){j(K,b,Y,A,F,l),B=F[t*X+b];break}var u=A-Y,m=Math.random()*u+Y|0,D=F[t*m+b],I=Math.random()*u+Y|0,x=F[t*I+b],Q=Math.random()*u+Y|0,G=F[t*Q+b];D<=x?G>=x?(U=I,B=x):D>=G?(U=m,B=D):(U=Q,B=G):x>=G?(U=I,B=x):G>=D?(U=m,B=D):(U=Q,B=G);for(var i=t*(A-1),S=t*U,M=0;M<t;++M,++i,++S){var r=F[i];F[i]=F[S],F[S]=r}var L=l[A-1];l[A-1]=l[U],l[U]=L;for(i=t*(A-1),S=t*(U=z(K,b,Y,A-1,F,l,B)),M=0;M<t;++M,++i,++S){r=F[i];F[i]=F[S],F[S]=r}L=l[A-1];if(l[A-1]=l[U],l[U]=L,X<U){for(A=U-1;Y<A&&F[t*(A-1)+b]===B;)A-=1;A+=1}else{if(!(U<X))break;for(Y=U+1;Y<A&&F[t*Y+b]===B;)Y+=1}}return z(K,b,e,X,F,l,F[t*X+b])};var z=e(12203)("lo<p0",["p0"]),k=8;function j(K,b,e,z,k,j){for(var T=2*K,F=T*(e+1)+b,l=e+1;l<z;++l,F+=T)for(var Y=k[F],A=l,X=T*(l-1);A>e&&k[X+b]>Y;--A,X-=T){for(var t=X,U=X+T,B=0;B<T;++B,++t,++U){var u=k[t];k[t]=k[U],k[U]=u}var m=j[A];j[A]=j[A-1],j[A-1]=m}}},12203:K=>{"use strict";K.exports=function(K,e){var z="abcdef".split("").concat(e),k=[];K.indexOf("lo")>=0&&k.push("lo=e[k+n]");K.indexOf("hi")>=0&&k.push("hi=e[k+o]");return z.push(b.replace("_",k.join()).replace("$",K)),Function.apply(void 0,z)};var b="for(var j=2*a,k=j*c,l=k,m=c,n=b,o=a+b,p=c;d>p;++p,k+=j){var _;if($)if(m===p)m+=1,l+=j;else{for(var s=0;j>s;++s){var t=e[k+s];e[k+s]=e[l],e[l++]=t}var u=f[p];f[p]=f[m],f[m++]=u}}return m"},12178:K=>{"use strict";K.exports=function(K,z){z<=4*b?e(0,z-1,K):Y(0,z-1,K)};var b=32;function e(K,b,e){for(var z=2*(K+1),k=K+1;k<=b;++k){for(var j=e[z++],T=e[z++],F=k,l=z-2;F-- >K;){var Y=e[l-2],A=e[l-1];if(Y<j)break;if(Y===j&&A<T)break;e[l]=Y,e[l+1]=A,l-=2}e[l]=j,e[l+1]=T}}function z(K,b,e){b*=2;var z=e[K*=2],k=e[K+1];e[K]=e[b],e[K+1]=e[b+1],e[b]=z,e[b+1]=k}function k(K,b,e){b*=2,e[K*=2]=e[b],e[K+1]=e[b+1]}function j(K,b,e,z){b*=2,e*=2;var k=z[K*=2],j=z[K+1];z[K]=z[b],z[K+1]=z[b+1],z[b]=z[e],z[b+1]=z[e+1],z[e]=k,z[e+1]=j}function T(K,b,e,z,k){b*=2,k[K*=2]=k[b],k[b]=e,k[K+1]=k[b+1],k[b+1]=z}function F(K,b,e){b*=2;var z=e[K*=2],k=e[b];return!(z<k)&&(z!==k||e[K+1]>e[b+1])}function l(K,b,e,z){var k=z[K*=2];return k<b||k===b&&z[K+1]<e}function Y(K,A,X){var t=(A-K+1)/6|0,U=K+t,B=A-t,u=K+A>>1,m=u-t,D=u+t,I=U,x=m,Q=u,G=D,i=B,S=K+1,M=A-1,r=0;F(I,x,X)&&(r=I,I=x,x=r),F(G,i,X)&&(r=G,G=i,i=r),F(I,Q,X)&&(r=I,I=Q,Q=r),F(x,Q,X)&&(r=x,x=Q,Q=r),F(I,G,X)&&(r=I,I=G,G=r),F(Q,G,X)&&(r=Q,Q=G,G=r),F(x,i,X)&&(r=x,x=i,i=r),F(x,Q,X)&&(r=x,x=Q,Q=r),F(G,i,X)&&(r=G,G=i,i=r);for(var L=X[2*x],c=X[2*x+1],v=X[2*G],w=X[2*G+1],h=2*I,R=2*Q,n=2*i,P=2*U,d=2*u,p=2*B,a=0;a<2;++a){var O=X[h+a],g=X[R+a],N=X[n+a];X[P+a]=O,X[d+a]=g,X[p+a]=N}k(m,K,X),k(D,A,X);for(var Z=S;Z<=M;++Z)if(l(Z,L,c,X))Z!==S&&z(Z,S,X),++S;else if(!l(Z,v,w,X))for(;;){if(l(M,v,w,X)){l(M,L,c,X)?(j(Z,S,M,X),++S,--M):(z(Z,M,X),--M);break}if(--M<Z)break}T(K,S-1,L,c,X),T(A,M+1,v,w,X),S-2-K<=b?e(K,S-2,X):Y(K,S-2,X),A-(M+2)<=b?e(M+2,A,X):Y(M+2,A,X),M-S<=b?e(S,M,X):Y(S,M,X)}},12174:(K,b,e)=>{"use strict";K.exports={init:function(K){var b=k.nextPow2(K);l.length<b&&(z.free(l),l=z.mallocInt32(b));Y.length<b&&(z.free(Y),Y=z.mallocInt32(b));A.length<b&&(z.free(A),A=z.mallocInt32(b));X.length<b&&(z.free(X),X=z.mallocInt32(b));t.length<b&&(z.free(t),t=z.mallocInt32(b));U.length<b&&(z.free(U),U=z.mallocInt32(b));var e=8*b;B.length<e&&(z.free(B),B=z.mallocDouble(e))},sweepBipartite:function(K,b,e,z,k,F,t,U,D,I){for(var x=0,Q=2*K,G=K-1,i=Q-1,S=e;S<z;++S){var M=F[S],r=Q*S;B[x++]=k[r+G],B[x++]=-(M+1),B[x++]=k[r+i],B[x++]=M}for(S=t;S<U;++S){M=I[S]+T;var L=Q*S;B[x++]=D[L+G],B[x++]=-M,B[x++]=D[L+i],B[x++]=M}var c=x>>>1;j(B,c);var v=0,w=0;for(S=0;S<c;++S){var h=0|B[2*S+1];if(h>=T)u(A,X,w--,h=h-T|0);else if(h>=0)u(l,Y,v--,h);else if(h<=-T){h=-h-T|0;for(var R=0;R<v;++R){if(void 0!==(n=b(l[R],h)))return n}m(A,X,w++,h)}else{h=-h-1|0;for(R=0;R<w;++R){var n;if(void 0!==(n=b(h,A[R])))return n}m(l,Y,v++,h)}}},sweepComplete:function(K,b,e,z,k,T,F,D,I,x){for(var Q=0,G=2*K,i=K-1,S=G-1,M=e;M<z;++M){var r=T[M]+1<<1,L=G*M;B[Q++]=k[L+i],B[Q++]=-r,B[Q++]=k[L+S],B[Q++]=r}for(M=F;M<D;++M){r=x[M]+1<<1;var c=G*M;B[Q++]=I[c+i],B[Q++]=1|-r,B[Q++]=I[c+S],B[Q++]=1|r}var v=Q>>>1;j(B,v);var w=0,h=0,R=0;for(M=0;M<v;++M){var n=0|B[2*M+1],P=1&n;if(M<v-1&&n>>1===B[2*M+3]>>1&&(P=2,M+=1),n<0){for(var d=-(n>>1)-1,p=0;p<R;++p){if(void 0!==(a=b(t[p],d)))return a}if(0!==P)for(p=0;p<w;++p){if(void 0!==(a=b(l[p],d)))return a}if(1!==P)for(p=0;p<h;++p){var a;if(void 0!==(a=b(A[p],d)))return a}0===P?m(l,Y,w++,d):1===P?m(A,X,h++,d):2===P&&m(t,U,R++,d)}else{d=(n>>1)-1;0===P?u(l,Y,w--,d):1===P?u(A,X,h--,d):2===P&&u(t,U,R--,d)}}},scanBipartite:function(K,b,e,z,k,F,A,X,t,U,D,I){var x=0,Q=2*K,G=b,i=b+K,S=1,M=1;z?M=T:S=T;for(var r=k;r<F;++r){var L=r+S,c=Q*r;B[x++]=A[c+G],B[x++]=-L,B[x++]=A[c+i],B[x++]=L}for(r=t;r<U;++r){L=r+M;var v=Q*r;B[x++]=D[v+G],B[x++]=-L}var w=x>>>1;j(B,w);var h=0;for(r=0;r<w;++r){var R=0|B[2*r+1];if(R<0){var n=!1;if((L=-R)>=T?(n=!z,L-=T):(n=!!z,L-=1),n)m(l,Y,h++,L);else{var P=I[L],d=Q*L,p=D[d+b+1],a=D[d+b+1+K];K:for(var O=0;O<h;++O){var g=l[O],N=Q*g;if(!(a<A[N+b+1]||A[N+b+1+K]<p)){for(var Z=b+2;Z<K;++Z)if(D[d+Z+K]<A[N+Z]||A[N+Z+K]<D[d+Z])continue K;var y,s=X[g];if(void 0!==(y=z?e(P,s):e(s,P)))return y}}}}else u(l,Y,h--,R-S)}},scanComplete:function(K,b,e,z,k,F,Y,A,X,t,U){for(var u=0,m=2*K,D=b,I=b+K,x=z;x<k;++x){var Q=x+T,G=m*x;B[u++]=F[G+D],B[u++]=-Q,B[u++]=F[G+I],B[u++]=Q}for(x=A;x<X;++x){Q=x+1;var i=m*x;B[u++]=t[i+D],B[u++]=-Q}var S=u>>>1;j(B,S);var M=0;for(x=0;x<S;++x){var r=0|B[2*x+1];if(r<0){if((Q=-r)>=T)l[M++]=Q-T;else{var L=U[Q-=1],c=m*Q,v=t[c+b+1],w=t[c+b+1+K];K:for(var h=0;h<M;++h){var R=l[h],n=Y[R];if(n===L)break;var P=m*R;if(!(w<F[P+b+1]||F[P+b+1+K]<v)){for(var d=b+2;d<K;++d)if(t[c+d+K]<F[P+d]||F[P+d+K]<t[c+d])continue K;var p=e(n,L);if(void 0!==p)return p}}}}else{for(Q=r-T,h=M-1;h>=0;--h)if(l[h]===Q){for(d=h+1;d<M;++d)l[d-1]=l[d];break}--M}}}};var z=e(12140),k=e(12149),j=e(12178),T=1<<28,F=1024,l=z.mallocInt32(F),Y=z.mallocInt32(F),A=z.mallocInt32(F),X=z.mallocInt32(F),t=z.mallocInt32(F),U=z.mallocInt32(F),B=z.mallocDouble(8192);function u(K,b,e,z){var k=b[z],j=K[e-1];K[k]=j,b[j]=k}function m(K,b,e,z){K[e]=z,b[z]=e}},12306:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},12301:(K,b,e)=>{var z=e(12306),k=e(12314),j=Object.hasOwnProperty,T=Object.create(null);for(var F in z)j.call(z,F)&&(T[z[F]]=F);var l=K.exports={to:{},get:{}};function Y(K,b,e){return Math.min(Math.max(b,K),e)}function A(K){var b=Math.round(K).toString(16).toUpperCase();return b.length<2?"0"+b:b}l.get=function(K){var b,e;switch(K.substring(0,3).toLowerCase()){case"hsl":b=l.get.hsl(K),e="hsl";break;case"hwb":b=l.get.hwb(K),e="hwb";break;default:b=l.get.rgb(K),e="rgb"}return b?{model:e,value:b}:null},l.get.rgb=function(K){if(!K)return null;var b,e,k,T=[0,0,0,1];if(b=K.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(k=b[2],b=b[1],e=0;e<3;e++){var F=2*e;T[e]=parseInt(b.slice(F,F+2),16)}k&&(T[3]=parseInt(k,16)/255)}else if(b=K.match(/^#([a-f0-9]{3,4})$/i)){for(k=(b=b[1])[3],e=0;e<3;e++)T[e]=parseInt(b[e]+b[e],16);k&&(T[3]=parseInt(k+k,16)/255)}else if(b=K.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(e=0;e<3;e++)T[e]=parseInt(b[e+1],0);b[4]&&(b[5]?T[3]=.01*parseFloat(b[4]):T[3]=parseFloat(b[4]))}else{if(!(b=K.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(b=K.match(/^(\w+)$/))?"transparent"===b[1]?[0,0,0,0]:j.call(z,b[1])?((T=z[b[1]])[3]=1,T):null:null;for(e=0;e<3;e++)T[e]=Math.round(2.55*parseFloat(b[e+1]));b[4]&&(b[5]?T[3]=.01*parseFloat(b[4]):T[3]=parseFloat(b[4]))}for(e=0;e<3;e++)T[e]=Y(T[e],0,255);return T[3]=Y(T[3],0,1),T},l.get.hsl=function(K){if(!K)return null;var b=K.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var e=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,Y(parseFloat(b[2]),0,100),Y(parseFloat(b[3]),0,100),Y(isNaN(e)?1:e,0,1)]}return null},l.get.hwb=function(K){if(!K)return null;var b=K.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(b){var e=parseFloat(b[4]);return[(parseFloat(b[1])%360+360)%360,Y(parseFloat(b[2]),0,100),Y(parseFloat(b[3]),0,100),Y(isNaN(e)?1:e,0,1)]}return null},l.to.hex=function(){var K=k(arguments);return"#"+A(K[0])+A(K[1])+A(K[2])+(K[3]<1?A(Math.round(255*K[3])):"")},l.to.rgb=function(){var K=k(arguments);return K.length<4||1===K[3]?"rgb("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+")":"rgba("+Math.round(K[0])+", "+Math.round(K[1])+", "+Math.round(K[2])+", "+K[3]+")"},l.to.rgb.percent=function(){var K=k(arguments),b=Math.round(K[0]/255*100),e=Math.round(K[1]/255*100),z=Math.round(K[2]/255*100);return K.length<4||1===K[3]?"rgb("+b+"%, "+e+"%, "+z+"%)":"rgba("+b+"%, "+e+"%, "+z+"%, "+K[3]+")"},l.to.hsl=function(){var K=k(arguments);return K.length<4||1===K[3]?"hsl("+K[0]+", "+K[1]+"%, "+K[2]+"%)":"hsla("+K[0]+", "+K[1]+"%, "+K[2]+"%, "+K[3]+")"},l.to.hwb=function(){var K=k(arguments),b="";return K.length>=4&&1!==K[3]&&(b=", "+K[3]),"hwb("+K[0]+", "+K[1]+"%, "+K[2]+"%"+b+")"},l.to.keyword=function(K){return T[K.slice(0,3)]}},12297:(K,b,e)=>{const z=e(12301),k=e(12323),j=["keyword","gray","hex"],T={};for(const U of Object.keys(k))T[[...k[U].labels].sort().join("")]=U;const F={};function l(K,b){if(!(this instanceof l))return new l(K,b);if(b&&b in j&&(b=null),b&&!(b in k))throw new Error("Unknown model: "+b);let e,Y;if(null==K)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(K instanceof l)this.model=K.model,this.color=[...K.color],this.valpha=K.valpha;else if("string"===typeof K){const b=z.get(K);if(null===b)throw new Error("Unable to parse color from string: "+K);this.model=b.model,Y=k[this.model].channels,this.color=b.value.slice(0,Y),this.valpha="number"===typeof b.value[Y]?b.value[Y]:1}else if(K.length>0){this.model=b||"rgb",Y=k[this.model].channels;const e=Array.prototype.slice.call(K,0,Y);this.color=t(e,Y),this.valpha="number"===typeof K[Y]?K[Y]:1}else if("number"===typeof K)this.model="rgb",this.color=[K>>16&255,K>>8&255,255&K],this.valpha=1;else{this.valpha=1;const b=Object.keys(K);"alpha"in K&&(b.splice(b.indexOf("alpha"),1),this.valpha="number"===typeof K.alpha?K.alpha:0);const z=b.sort().join("");if(!(z in T))throw new Error("Unable to parse color from object: "+JSON.stringify(K));this.model=T[z];const{labels:j}=k[this.model],F=[];for(e=0;e<j.length;e++)F.push(K[j[e]]);this.color=t(F)}if(F[this.model])for(Y=k[this.model].channels,e=0;e<Y;e++){const K=F[this.model][e];K&&(this.color[e]=K(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}l.prototype={toString(){return this.string()},toJSON(){return this[this.model]()},string(K){let b=this.model in z.to?this:this.rgb();b=b.round("number"===typeof K?K:1);const e=1===b.valpha?b.color:[...b.color,this.valpha];return z.to[b.model](e)},percentString(K){const b=this.rgb().round("number"===typeof K?K:1),e=1===b.valpha?b.color:[...b.color,this.valpha];return z.to.rgb.percent(e)},array(){return 1===this.valpha?[...this.color]:[...this.color,this.valpha]},object(){const K={},{channels:b}=k[this.model],{labels:e}=k[this.model];for(let z=0;z<b;z++)K[e[z]]=this.color[z];return 1!==this.valpha&&(K.alpha=this.valpha),K},unitArray(){const K=this.rgb().color;return K[0]/=255,K[1]/=255,K[2]/=255,1!==this.valpha&&K.push(this.valpha),K},unitObject(){const K=this.rgb().object();return K.r/=255,K.g/=255,K.b/=255,1!==this.valpha&&(K.alpha=this.valpha),K},round(K){return K=Math.max(K||0,0),new l([...this.color.map(Y(K)),this.valpha],this.model)},alpha(K){return void 0!==K?new l([...this.color,Math.max(0,Math.min(1,K))],this.model):this.valpha},red:A("rgb",0,X(255)),green:A("rgb",1,X(255)),blue:A("rgb",2,X(255)),hue:A(["hsl","hsv","hsl","hwb","hcg"],0,(K=>(K%360+360)%360)),saturationl:A("hsl",1,X(100)),lightness:A("hsl",2,X(100)),saturationv:A("hsv",1,X(100)),value:A("hsv",2,X(100)),chroma:A("hcg",1,X(100)),gray:A("hcg",2,X(100)),white:A("hwb",1,X(100)),wblack:A("hwb",2,X(100)),cyan:A("cmyk",0,X(100)),magenta:A("cmyk",1,X(100)),yellow:A("cmyk",2,X(100)),black:A("cmyk",3,X(100)),x:A("xyz",0,X(95.047)),y:A("xyz",1,X(100)),z:A("xyz",2,X(108.833)),l:A("lab",0,X(100)),a:A("lab",1),b:A("lab",2),keyword(K){return void 0!==K?new l(K):k[this.model].keyword(this.color)},hex(K){return void 0!==K?new l(K):z.to.hex(this.rgb().round().color)},hexa(K){if(void 0!==K)return new l(K);const b=this.rgb().round().color;let e=Math.round(255*this.valpha).toString(16).toUpperCase();return 1===e.length&&(e="0"+e),z.to.hex(b)+e},rgbNumber(){const K=this.rgb().color;return(255&K[0])<<16|(255&K[1])<<8|255&K[2]},luminosity(){const K=this.rgb().color,b=[];for(const[e,z]of K.entries()){const K=z/255;b[e]=K<=.04045?K/12.92:((K+.055)/1.055)**2.4}return.2126*b[0]+.7152*b[1]+.0722*b[2]},contrast(K){const b=this.luminosity(),e=K.luminosity();return b>e?(b+.05)/(e+.05):(e+.05)/(b+.05)},level(K){const b=this.contrast(K);return b>=7?"AAA":b>=4.5?"AA":""},isDark(){const K=this.rgb().color;return(2126*K[0]+7152*K[1]+722*K[2])/1e4<128},isLight(){return!this.isDark()},negate(){const K=this.rgb();for(let b=0;b<3;b++)K.color[b]=255-K.color[b];return K},lighten(K){const b=this.hsl();return b.color[2]+=b.color[2]*K,b},darken(K){const b=this.hsl();return b.color[2]-=b.color[2]*K,b},saturate(K){const b=this.hsl();return b.color[1]+=b.color[1]*K,b},desaturate(K){const b=this.hsl();return b.color[1]-=b.color[1]*K,b},whiten(K){const b=this.hwb();return b.color[1]+=b.color[1]*K,b},blacken(K){const b=this.hwb();return b.color[2]+=b.color[2]*K,b},grayscale(){const K=this.rgb().color,b=.3*K[0]+.59*K[1]+.11*K[2];return l.rgb(b,b,b)},fade(K){return this.alpha(this.valpha-this.valpha*K)},opaquer(K){return this.alpha(this.valpha+this.valpha*K)},rotate(K){const b=this.hsl();let e=b.color[0];return e=(e+K)%360,e=e<0?360+e:e,b.color[0]=e,b},mix(K,b){if(!K||!K.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof K);const e=K.rgb(),z=this.rgb(),k=void 0===b?.5:b,j=2*k-1,T=e.alpha()-z.alpha(),F=((j*T===-1?j:(j+T)/(1+j*T))+1)/2,Y=1-F;return l.rgb(F*e.red()+Y*z.red(),F*e.green()+Y*z.green(),F*e.blue()+Y*z.blue(),e.alpha()*k+z.alpha()*(1-k))}};for(const U of Object.keys(k)){if(j.includes(U))continue;const{channels:K}=k[U];l.prototype[U]=function(){if(this.model===U)return new l(this);for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];return b.length>0?new l(b,U):new l([...(z=k[this.model][U].raw(this.color),Array.isArray(z)?z:[z]),this.valpha],U);var z},l[U]=function(){for(var b=arguments.length,e=new Array(b),z=0;z<b;z++)e[z]=arguments[z];let k=e[0];return"number"===typeof k&&(k=t(e,K)),new l(k,U)}}function Y(K){return function(b){return function(K,b){return Number(K.toFixed(b))}(b,K)}}function A(K,b,e){K=Array.isArray(K)?K:[K];for(const z of K)(F[z]||(F[z]=[]))[b]=e;return K=K[0],function(z){let k;return void 0!==z?(e&&(z=e(z)),k=this[K](),k.color[b]=z,k):(k=this[K]().color[b],e&&(k=e(k)),k)}}function X(K){return function(b){return Math.max(0,Math.min(K,b))}}function t(K,b){for(let e=0;e<b;e++)"number"!==typeof K[e]&&(K[e]=0);return K}K.exports=l},12325:(K,b,e)=>{const z=e(12331),k={};for(const T of Object.keys(z))k[z[T]]=T;const j={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};K.exports=j;for(const T of Object.keys(j)){if(!("channels"in j[T]))throw new Error("missing channels property: "+T);if(!("labels"in j[T]))throw new Error("missing channel labels property: "+T);if(j[T].labels.length!==j[T].channels)throw new Error("channel and label counts mismatch: "+T);const{channels:K,labels:b}=j[T];delete j[T].channels,delete j[T].labels,Object.defineProperty(j[T],"channels",{value:K}),Object.defineProperty(j[T],"labels",{value:b})}j.rgb.hsl=function(K){const b=K[0]/255,e=K[1]/255,z=K[2]/255,k=Math.min(b,e,z),j=Math.max(b,e,z),T=j-k;let F,l;j===k?F=0:b===j?F=(e-z)/T:e===j?F=2+(z-b)/T:z===j&&(F=4+(b-e)/T),F=Math.min(60*F,360),F<0&&(F+=360);const Y=(k+j)/2;return l=j===k?0:Y<=.5?T/(j+k):T/(2-j-k),[F,100*l,100*Y]},j.rgb.hsv=function(K){let b,e,z,k,j;const T=K[0]/255,F=K[1]/255,l=K[2]/255,Y=Math.max(T,F,l),A=Y-Math.min(T,F,l),X=function(K){return(Y-K)/6/A+.5};return 0===A?(k=0,j=0):(j=A/Y,b=X(T),e=X(F),z=X(l),T===Y?k=z-e:F===Y?k=1/3+b-z:l===Y&&(k=2/3+e-b),k<0?k+=1:k>1&&(k-=1)),[360*k,100*j,100*Y]},j.rgb.hwb=function(K){const b=K[0],e=K[1];let z=K[2];const k=j.rgb.hsl(K)[0],T=1/255*Math.min(b,Math.min(e,z));return z=1-1/255*Math.max(b,Math.max(e,z)),[k,100*T,100*z]},j.rgb.cmyk=function(K){const b=K[0]/255,e=K[1]/255,z=K[2]/255,k=Math.min(1-b,1-e,1-z);return[100*((1-b-k)/(1-k)||0),100*((1-e-k)/(1-k)||0),100*((1-z-k)/(1-k)||0),100*k]},j.rgb.keyword=function(K){const b=k[K];if(b)return b;let e,j=1/0;for(const k of Object.keys(z)){const b=z[k],l=(F=b,((T=K)[0]-F[0])**2+(T[1]-F[1])**2+(T[2]-F[2])**2);l<j&&(j=l,e=k)}var T,F;return e},j.keyword.rgb=function(K){return z[K]},j.rgb.xyz=function(K){let b=K[0]/255,e=K[1]/255,z=K[2]/255;b=b>.04045?((b+.055)/1.055)**2.4:b/12.92,e=e>.04045?((e+.055)/1.055)**2.4:e/12.92,z=z>.04045?((z+.055)/1.055)**2.4:z/12.92;return[100*(.4124*b+.3576*e+.1805*z),100*(.2126*b+.7152*e+.0722*z),100*(.0193*b+.1192*e+.9505*z)]},j.rgb.lab=function(K){const b=j.rgb.xyz(K);let e=b[0],z=b[1],k=b[2];e/=95.047,z/=100,k/=108.883,e=e>.008856?e**(1/3):7.787*e+16/116,z=z>.008856?z**(1/3):7.787*z+16/116,k=k>.008856?k**(1/3):7.787*k+16/116;return[116*z-16,500*(e-z),200*(z-k)]},j.hsl.rgb=function(K){const b=K[0]/360,e=K[1]/100,z=K[2]/100;let k,j,T;if(0===e)return T=255*z,[T,T,T];k=z<.5?z*(1+e):z+e-z*e;const F=2*z-k,l=[0,0,0];for(let Y=0;Y<3;Y++)j=b+1/3*-(Y-1),j<0&&j++,j>1&&j--,T=6*j<1?F+6*(k-F)*j:2*j<1?k:3*j<2?F+(k-F)*(2/3-j)*6:F,l[Y]=255*T;return l},j.hsl.hsv=function(K){const b=K[0];let e=K[1]/100,z=K[2]/100,k=e;const j=Math.max(z,.01);z*=2,e*=z<=1?z:2-z,k*=j<=1?j:2-j;return[b,100*(0===z?2*k/(j+k):2*e/(z+e)),100*((z+e)/2)]},j.hsv.rgb=function(K){const b=K[0]/60,e=K[1]/100;let z=K[2]/100;const k=Math.floor(b)%6,j=b-Math.floor(b),T=255*z*(1-e),F=255*z*(1-e*j),l=255*z*(1-e*(1-j));switch(z*=255,k){case 0:return[z,l,T];case 1:return[F,z,T];case 2:return[T,z,l];case 3:return[T,F,z];case 4:return[l,T,z];case 5:return[z,T,F]}},j.hsv.hsl=function(K){const b=K[0],e=K[1]/100,z=K[2]/100,k=Math.max(z,.01);let j,T;T=(2-e)*z;const F=(2-e)*k;return j=e*k,j/=F<=1?F:2-F,j=j||0,T/=2,[b,100*j,100*T]},j.hwb.rgb=function(K){const b=K[0]/360;let e=K[1]/100,z=K[2]/100;const k=e+z;let j;k>1&&(e/=k,z/=k);const T=Math.floor(6*b),F=1-z;j=6*b-T,0!==(1&T)&&(j=1-j);const l=e+j*(F-e);let Y,A,X;switch(T){default:case 6:case 0:Y=F,A=l,X=e;break;case 1:Y=l,A=F,X=e;break;case 2:Y=e,A=F,X=l;break;case 3:Y=e,A=l,X=F;break;case 4:Y=l,A=e,X=F;break;case 5:Y=F,A=e,X=l}return[255*Y,255*A,255*X]},j.cmyk.rgb=function(K){const b=K[0]/100,e=K[1]/100,z=K[2]/100,k=K[3]/100;return[255*(1-Math.min(1,b*(1-k)+k)),255*(1-Math.min(1,e*(1-k)+k)),255*(1-Math.min(1,z*(1-k)+k))]},j.xyz.rgb=function(K){const b=K[0]/100,e=K[1]/100,z=K[2]/100;let k,j,T;return k=3.2406*b+-1.5372*e+-.4986*z,j=-.9689*b+1.8758*e+.0415*z,T=.0557*b+-.204*e+1.057*z,k=k>.0031308?1.055*k**(1/2.4)-.055:12.92*k,j=j>.0031308?1.055*j**(1/2.4)-.055:12.92*j,T=T>.0031308?1.055*T**(1/2.4)-.055:12.92*T,k=Math.min(Math.max(0,k),1),j=Math.min(Math.max(0,j),1),T=Math.min(Math.max(0,T),1),[255*k,255*j,255*T]},j.xyz.lab=function(K){let b=K[0],e=K[1],z=K[2];b/=95.047,e/=100,z/=108.883,b=b>.008856?b**(1/3):7.787*b+16/116,e=e>.008856?e**(1/3):7.787*e+16/116,z=z>.008856?z**(1/3):7.787*z+16/116;return[116*e-16,500*(b-e),200*(e-z)]},j.lab.xyz=function(K){let b,e,z;e=(K[0]+16)/116,b=K[1]/500+e,z=e-K[2]/200;const k=e**3,j=b**3,T=z**3;return e=k>.008856?k:(e-16/116)/7.787,b=j>.008856?j:(b-16/116)/7.787,z=T>.008856?T:(z-16/116)/7.787,b*=95.047,e*=100,z*=108.883,[b,e,z]},j.lab.lch=function(K){const b=K[0],e=K[1],z=K[2];let k;k=360*Math.atan2(z,e)/2/Math.PI,k<0&&(k+=360);return[b,Math.sqrt(e*e+z*z),k]},j.lch.lab=function(K){const b=K[0],e=K[1],z=K[2]/360*2*Math.PI;return[b,e*Math.cos(z),e*Math.sin(z)]},j.rgb.ansi16=function(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[e,z,k]=K;let T=null===b?j.rgb.hsv(K)[2]:b;if(T=Math.round(T/50),0===T)return 30;let F=30+(Math.round(k/255)<<2|Math.round(z/255)<<1|Math.round(e/255));return 2===T&&(F+=60),F},j.hsv.ansi16=function(K){return j.rgb.ansi16(j.hsv.rgb(K),K[2])},j.rgb.ansi256=function(K){const b=K[0],e=K[1],z=K[2];if(b===e&&e===z)return b<8?16:b>248?231:Math.round((b-8)/247*24)+232;return 16+36*Math.round(b/255*5)+6*Math.round(e/255*5)+Math.round(z/255*5)},j.ansi16.rgb=function(K){let b=K%10;if(0===b||7===b)return K>50&&(b+=3.5),b=b/10.5*255,[b,b,b];const e=.5*(1+~~(K>50));return[(1&b)*e*255,(b>>1&1)*e*255,(b>>2&1)*e*255]},j.ansi256.rgb=function(K){if(K>=232){const b=10*(K-232)+8;return[b,b,b]}let b;K-=16;return[Math.floor(K/36)/5*255,Math.floor((b=K%36)/6)/5*255,b%6/5*255]},j.rgb.hex=function(K){const b=(((255&Math.round(K[0]))<<16)+((255&Math.round(K[1]))<<8)+(255&Math.round(K[2]))).toString(16).toUpperCase();return"000000".substring(b.length)+b},j.hex.rgb=function(K){const b=K.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!b)return[0,0,0];let e=b[0];3===b[0].length&&(e=e.split("").map((K=>K+K)).join(""));const z=parseInt(e,16);return[z>>16&255,z>>8&255,255&z]},j.rgb.hcg=function(K){const b=K[0]/255,e=K[1]/255,z=K[2]/255,k=Math.max(Math.max(b,e),z),j=Math.min(Math.min(b,e),z),T=k-j;let F,l;return F=T<1?j/(1-T):0,l=T<=0?0:k===b?(e-z)/T%6:k===e?2+(z-b)/T:4+(b-e)/T,l/=6,l%=1,[360*l,100*T,100*F]},j.hsl.hcg=function(K){const b=K[1]/100,e=K[2]/100,z=e<.5?2*b*e:2*b*(1-e);let k=0;return z<1&&(k=(e-.5*z)/(1-z)),[K[0],100*z,100*k]},j.hsv.hcg=function(K){const b=K[1]/100,e=K[2]/100,z=b*e;let k=0;return z<1&&(k=(e-z)/(1-z)),[K[0],100*z,100*k]},j.hcg.rgb=function(K){const b=K[0]/360,e=K[1]/100,z=K[2]/100;if(0===e)return[255*z,255*z,255*z];const k=[0,0,0],j=b%1*6,T=j%1,F=1-T;let l=0;switch(Math.floor(j)){case 0:k[0]=1,k[1]=T,k[2]=0;break;case 1:k[0]=F,k[1]=1,k[2]=0;break;case 2:k[0]=0,k[1]=1,k[2]=T;break;case 3:k[0]=0,k[1]=F,k[2]=1;break;case 4:k[0]=T,k[1]=0,k[2]=1;break;default:k[0]=1,k[1]=0,k[2]=F}return l=(1-e)*z,[255*(e*k[0]+l),255*(e*k[1]+l),255*(e*k[2]+l)]},j.hcg.hsv=function(K){const b=K[1]/100,e=b+K[2]/100*(1-b);let z=0;return e>0&&(z=b/e),[K[0],100*z,100*e]},j.hcg.hsl=function(K){const b=K[1]/100,e=K[2]/100*(1-b)+.5*b;let z=0;return e>0&&e<.5?z=b/(2*e):e>=.5&&e<1&&(z=b/(2*(1-e))),[K[0],100*z,100*e]},j.hcg.hwb=function(K){const b=K[1]/100,e=b+K[2]/100*(1-b);return[K[0],100*(e-b),100*(1-e)]},j.hwb.hcg=function(K){const b=K[1]/100,e=1-K[2]/100,z=e-b;let k=0;return z<1&&(k=(e-z)/(1-z)),[K[0],100*z,100*k]},j.apple.rgb=function(K){return[K[0]/65535*255,K[1]/65535*255,K[2]/65535*255]},j.rgb.apple=function(K){return[K[0]/255*65535,K[1]/255*65535,K[2]/255*65535]},j.gray.rgb=function(K){return[K[0]/100*255,K[0]/100*255,K[0]/100*255]},j.gray.hsl=function(K){return[0,0,K[0]]},j.gray.hsv=j.gray.hsl,j.gray.hwb=function(K){return[0,100,K[0]]},j.gray.cmyk=function(K){return[0,0,0,K[0]]},j.gray.lab=function(K){return[K[0],0,0]},j.gray.hex=function(K){const b=255&Math.round(K[0]/100*255),e=((b<<16)+(b<<8)+b).toString(16).toUpperCase();return"000000".substring(e.length)+e},j.rgb.gray=function(K){return[(K[0]+K[1]+K[2])/3/255*100]}},12323:(K,b,e)=>{const z=e(12325),k=e(12337),j={};Object.keys(z).forEach((K=>{j[K]={},Object.defineProperty(j[K],"channels",{value:z[K].channels}),Object.defineProperty(j[K],"labels",{value:z[K].labels});const b=k(K);Object.keys(b).forEach((e=>{const z=b[e];j[K][e]=function(K){const b=function(){for(var b=arguments.length,e=new Array(b),z=0;z<b;z++)e[z]=arguments[z];const k=e[0];if(void 0===k||null===k)return k;k.length>1&&(e=k);const j=K(e);if("object"===typeof j)for(let K=j.length,T=0;T<K;T++)j[T]=Math.round(j[T]);return j};return"conversion"in K&&(b.conversion=K.conversion),b}(z),j[K][e].raw=function(K){const b=function(){for(var b=arguments.length,e=new Array(b),z=0;z<b;z++)e[z]=arguments[z];const k=e[0];return void 0===k||null===k?k:(k.length>1&&(e=k),K(e))};return"conversion"in K&&(b.conversion=K.conversion),b}(z)}))})),K.exports=j},12337:(K,b,e)=>{const z=e(12325);function k(K){const b=function(){const K={},b=Object.keys(z);for(let e=b.length,z=0;z<e;z++)K[b[z]]={distance:-1,parent:null};return K}(),e=[K];for(b[K].distance=0;e.length;){const K=e.pop(),k=Object.keys(z[K]);for(let z=k.length,j=0;j<z;j++){const z=k[j],T=b[z];-1===T.distance&&(T.distance=b[K].distance+1,T.parent=K,e.unshift(z))}}return b}function j(K,b){return function(e){return b(K(e))}}function T(K,b){const e=[b[K].parent,K];let k=z[b[K].parent][K],T=b[K].parent;for(;b[T].parent;)e.unshift(b[T].parent),k=j(z[b[T].parent][T],k),T=b[T].parent;return k.conversion=e,k}K.exports=function(K){const b=k(K),e={},z=Object.keys(b);for(let k=z.length,j=0;j<k;j++){const K=z[j];null!==b[K].parent&&(e[K]=T(K,b))}return e}},12331:K=>{"use strict";K.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},10618:function(K,b,e){"use strict";var z=this&&this.__createBinding||(Object.create?function(K,b,e,z){void 0===z&&(z=e);var k=Object.getOwnPropertyDescriptor(b,e);k&&!("get"in k?!b.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return b[e]}}),Object.defineProperty(K,z,k)}:function(K,b,e,z){void 0===z&&(z=e),K[z]=b[e]}),k=this&&this.__setModuleDefault||(Object.create?function(K,b){Object.defineProperty(K,"default",{enumerable:!0,value:b})}:function(K,b){K.default=b}),j=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var b={};if(null!=K)for(var e in K)"default"!==e&&Object.prototype.hasOwnProperty.call(K,e)&&z(b,K,e);return k(b,K),b},T=this&&this.__awaiter||function(K,b,e,z){return new(e||(e=Promise))((function(k,j){function T(K){try{l(z.next(K))}catch(b){j(b)}}function F(K){try{l(z.throw(K))}catch(b){j(b)}}function l(K){var b;K.done?k(K.value):(b=K.value,b instanceof e?b:new e((function(K){K(b)}))).then(T,F)}l((z=z.apply(K,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Auth=b.Platform=void 0;const F=j(e(10549)),l=e(10627),Y="colyseus-auth-token";!function(K){K.ios="ios",K.android="android"}(b.Platform||(b.Platform={}));b.Auth=class{constructor(K){this._id=void 0,this.username=void 0,this.displayName=void 0,this.avatarUrl=void 0,this.isAnonymous=void 0,this.email=void 0,this.lang=void 0,this.location=void 0,this.timezone=void 0,this.metadata=void 0,this.devices=void 0,this.facebookId=void 0,this.twitterId=void 0,this.googleId=void 0,this.gameCenterId=void 0,this.steamId=void 0,this.friendIds=void 0,this.blockedUserIds=void 0,this.createdAt=void 0,this.updatedAt=void 0,this.token=void 0,this.endpoint=K.replace("ws","http"),(0,l.getItem)(Y,(K=>this.token=K))}get hasToken(){return!!this.token}login(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return T(this,void 0,void 0,(function*(){const b=Object.assign({},K);this.hasToken&&(b.token=this.token);const e=yield this.request("post","/auth",b);this.token=e.token,(0,l.setItem)(Y,this.token);for(let K in e)this.hasOwnProperty(K)&&(this[K]=e[K]);return this.registerPingService(),this}))}save(){return T(this,void 0,void 0,(function*(){return yield this.request("put","/auth",{},{username:this.username,displayName:this.displayName,avatarUrl:this.avatarUrl,lang:this.lang,location:this.location,timezone:this.timezone}),this}))}getFriends(){return T(this,void 0,void 0,(function*(){return yield this.request("get","/friends/all")}))}getOnlineFriends(){return T(this,void 0,void 0,(function*(){return yield this.request("get","/friends/online")}))}getFriendRequests(){return T(this,void 0,void 0,(function*(){return yield this.request("get","/friends/requests")}))}sendFriendRequest(K){return T(this,void 0,void 0,(function*(){return yield this.request("post","/friends/requests",{userId:K})}))}acceptFriendRequest(K){return T(this,void 0,void 0,(function*(){return yield this.request("put","/friends/requests",{userId:K})}))}declineFriendRequest(K){return T(this,void 0,void 0,(function*(){return yield this.request("del","/friends/requests",{userId:K})}))}blockUser(K){return T(this,void 0,void 0,(function*(){return yield this.request("post","/friends/block",{userId:K})}))}unblockUser(K){return T(this,void 0,void 0,(function*(){return yield this.request("put","/friends/block",{userId:K})}))}request(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return T(this,void 0,void 0,(function*(){k.Accept="application/json",this.hasToken&&(k.Authorization="Bearer "+this.token);const j=[];for(const K in e)j.push(`${K}=${e[K]}`);const T=j.length>0?`?${j.join("&")}`:"",l={headers:k};return z&&(l.body=z),(yield F[K](`${this.endpoint}${b}${T}`,l)).data}))}logout(){this.token=void 0,(0,l.removeItem)(Y),this.unregisterPingService()}registerPingService(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;this.unregisterPingService(),this.keepOnlineInterval=setInterval((()=>this.request("get","/auth")),K)}unregisterPingService(){clearInterval(this.keepOnlineInterval)}}},10541:function(K,b,e){"use strict";var z,k=this&&this.__awaiter||function(K,b,e,z){return new(e||(e=Promise))((function(k,j){function T(K){try{l(z.next(K))}catch(b){j(b)}}function F(K){try{l(z.throw(K))}catch(b){j(b)}}function l(K){var b;K.done?k(K.value):(b=K.value,b instanceof e?b:new e((function(K){K(b)}))).then(T,F)}l((z=z.apply(K,b||[])).next())}))};Object.defineProperty(b,"__esModule",{value:!0}),b.Client=b.MatchMakeError=void 0;const j=e(10549),T=e(10556),F=e(10562);class l extends Error{constructor(K,b){super(K),this.code=b,Object.setPrototypeOf(this,l.prototype)}}b.MatchMakeError=l;const Y="undefined"!==typeof window&&"undefined"!==typeof(null===(z=null===window||void 0===window?void 0:window.location)||void 0===z?void 0:z.hostname)?`${window.location.protocol.replace("http","ws")}//${window.location.hostname}${window.location.port&&`:${window.location.port}`}`:"ws://127.0.0.1:2567";b.Client=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Y;if("string"===typeof K){const b=new URL(K),e="https:"===b.protocol||"wss:"===b.protocol,z=Number(b.port||(e?443:80));this.settings={hostname:b.hostname,pathname:"/"!==b.pathname?b.pathname:"",port:z,secure:e}}else void 0===K.port&&(K.port=K.secure?443:80),void 0===K.pathname&&(K.pathname=""),this.settings=K}joinOrCreate(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinOrCreate",K,b,e)}))}create(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("create",K,b,e)}))}join(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("join",K,b,e)}))}joinById(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;return k(this,void 0,void 0,(function*(){return yield this.createMatchMakeRequest("joinById",K,b,e)}))}reconnect(K,b){return k(this,void 0,void 0,(function*(){if("string"===typeof K&&"string"===typeof b)throw new Error("DEPRECATED: .reconnect() now only accepts 'reconnectionToken' as argument.\nYou can get this token from previously connected `room.reconnectionToken`");const[e,z]=K.split(":");return yield this.createMatchMakeRequest("reconnect",e,{reconnectionToken:z},b)}))}getAvailableRooms(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return k(this,void 0,void 0,(function*(){return(yield(0,j.get)(this.getHttpEndpoint(`${K}`),{headers:{Accept:"application/json"}})).data}))}consumeSeatReservation(K,b,e){return k(this,void 0,void 0,(function*(){const z=this.createRoom(K.room.name,b);z.roomId=K.room.roomId,z.sessionId=K.sessionId;const j={sessionId:z.sessionId};K.reconnectionToken&&(j.reconnectionToken=K.reconnectionToken);const F=e||z;return z.connect(this.buildEndpoint(K.room,j),K.devMode&&(()=>k(this,void 0,void 0,(function*(){console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} Re-establishing connection with room id '${z.roomId}'...`);let e=0;const j=()=>k(this,void 0,void 0,(function*(){e++;try{yield this.consumeSeatReservation(K,b,F),console.info(`[Colyseus devMode]: ${String.fromCodePoint(9989)} Successfully re-established connection with room '${z.roomId}'`)}catch(k){e<8?(console.info(`[Colyseus devMode]: ${String.fromCodePoint(128260)} retrying... (${e} out of 8)`),setTimeout(j,2e3)):console.info(`[Colyseus devMode]: ${String.fromCodePoint(10060)} Failed to reconnect. Is your server running? Please check server logs.`)}}));setTimeout(j,2e3)}))),F),new Promise(((K,b)=>{const e=(K,e)=>b(new T.ServerError(K,e));F.onError.once(e),F.onJoin.once((()=>{F.onError.remove(e),K(F)}))}))}))}createMatchMakeRequest(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3?arguments[3]:void 0,T=arguments.length>4?arguments[4]:void 0;return k(this,void 0,void 0,(function*(){const k=(yield(0,j.post)(this.getHttpEndpoint(`${K}/${b}`),{headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})).data;if(k.error)throw new l(k.error,k.code);return"reconnect"===K&&(k.reconnectionToken=e.reconnectionToken),yield this.consumeSeatReservation(k,z,T)}))}createRoom(K,b){return new F.Room(K,b)}buildEndpoint(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=[];for(const k in b)b.hasOwnProperty(k)&&e.push(`${k}=${b[k]}`);let z=this.settings.secure?"wss://":"ws://";return K.publicAddress?z+=`${K.publicAddress}`:z+=`${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}`,`${z}/${K.processId}/${K.roomId}?${e.join("&")}`}getHttpEndpoint(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return`${this.settings.secure?"https":"http"}://${this.settings.hostname}${this.getEndpointPort()}${this.settings.pathname}/matchmake/${K}`}getEndpointPort(){return 80!==this.settings.port&&443!==this.settings.port?`:${this.settings.port}`:""}}},10572:(K,b,e)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Connection=void 0;const z=e(10580);b.Connection=class{constructor(){this.events={},this.transport=new z.WebSocketTransport(this.events)}send(K){this.transport.send(K)}connect(K){this.transport.connect(K)}close(K,b){this.transport.close(K,b)}get isOpen(){return this.transport.isOpen}}},10595:(K,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.utf8Length=b.utf8Read=b.ErrorCode=b.Protocol=void 0,function(K){K[K.HANDSHAKE=9]="HANDSHAKE",K[K.JOIN_ROOM=10]="JOIN_ROOM",K[K.ERROR=11]="ERROR",K[K.LEAVE_ROOM=12]="LEAVE_ROOM",K[K.ROOM_DATA=13]="ROOM_DATA",K[K.ROOM_STATE=14]="ROOM_STATE",K[K.ROOM_STATE_PATCH=15]="ROOM_STATE_PATCH",K[K.ROOM_DATA_SCHEMA=16]="ROOM_DATA_SCHEMA",K[K.ROOM_DATA_BYTES=17]="ROOM_DATA_BYTES"}(b.Protocol||(b.Protocol={})),function(K){K[K.MATCHMAKE_NO_HANDLER=4210]="MATCHMAKE_NO_HANDLER",K[K.MATCHMAKE_INVALID_CRITERIA=4211]="MATCHMAKE_INVALID_CRITERIA",K[K.MATCHMAKE_INVALID_ROOM_ID=4212]="MATCHMAKE_INVALID_ROOM_ID",K[K.MATCHMAKE_UNHANDLED=4213]="MATCHMAKE_UNHANDLED",K[K.MATCHMAKE_EXPIRED=4214]="MATCHMAKE_EXPIRED",K[K.AUTH_FAILED=4215]="AUTH_FAILED",K[K.APPLICATION_ERROR=4216]="APPLICATION_ERROR"}(b.ErrorCode||(b.ErrorCode={})),b.utf8Read=function(K,b){const e=K[b++];for(var z="",k=0,j=b,T=b+e;j<T;j++){var F=K[j];if(0!==(128&F))if(192!==(224&F))if(224!==(240&F)){if(240!==(248&F))throw new Error("Invalid byte "+F.toString(16));(k=(7&F)<<18|(63&K[++j])<<12|(63&K[++j])<<6|63&K[++j])>=65536?(k-=65536,z+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):z+=String.fromCharCode(k)}else z+=String.fromCharCode((15&F)<<12|(63&K[++j])<<6|63&K[++j]);else z+=String.fromCharCode((31&F)<<6|63&K[++j]);else z+=String.fromCharCode(F)}return z},b.utf8Length=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",b=0,e=0;for(let z=0,k=K.length;z<k;z++)b=K.charCodeAt(z),b<128?e+=1:b<2048?e+=2:b<55296||b>=57344?e+=3:(z++,e+=4);return e+1}},10562:function(K,b,e){"use strict";var z=this&&this.__createBinding||(Object.create?function(K,b,e,z){void 0===z&&(z=e);var k=Object.getOwnPropertyDescriptor(b,e);k&&!("get"in k?!b.__esModule:k.writable||k.configurable)||(k={enumerable:!0,get:function(){return b[e]}}),Object.defineProperty(K,z,k)}:function(K,b,e,z){void 0===z&&(z=e),K[z]=b[e]}),k=this&&this.__setModuleDefault||(Object.create?function(K,b){Object.defineProperty(K,"default",{enumerable:!0,value:b})}:function(K,b){K.default=b}),j=this&&this.__importStar||function(K){if(K&&K.__esModule)return K;var b={};if(null!=K)for(var e in K)"default"!==e&&Object.prototype.hasOwnProperty.call(K,e)&&z(b,K,e);return k(b,K),b};Object.defineProperty(b,"__esModule",{value:!0}),b.Room=void 0;const T=j(e(10564)),F=e(10572),l=e(10595),Y=e(10597),A=e(10602),X=e(10604),t=e(10610),U=e(10556);class B{constructor(K,b){this.onStateChange=(0,X.createSignal)(),this.onError=(0,X.createSignal)(),this.onLeave=(0,X.createSignal)(),this.onJoin=(0,X.createSignal)(),this.hasJoined=!1,this.onMessageHandlers=(0,A.createNanoEvents)(),this.roomId=null,this.name=K,b&&(this.serializer=new((0,Y.getSerializer)("schema")),this.rootSchema=b,this.serializer.state=new b),this.onError(((K,b)=>{var e;return null===(e=console.warn)||void 0===e?void 0:e.call(console,`colyseus.js - onError => (${K}) ${b}`)})),this.onLeave((()=>this.removeAllListeners()))}get id(){return this.roomId}connect(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this;const z=new F.Connection;e.connection=z,z.events.onmessage=B.prototype.onMessageCallback.bind(e),z.events.onclose=function(K){var z;if(!e.hasJoined)return null===(z=console.warn)||void 0===z||z.call(console,`Room connection was closed unexpectedly (${K.code}): ${K.reason}`),void e.onError.invoke(K.code,K.reason);K.code===U.CloseCode.DEVMODE_RESTART&&b?b():(e.onLeave.invoke(K.code),e.destroy())},z.events.onerror=function(K){var b;null===(b=console.warn)||void 0===b||b.call(console,`Room, onError (${K.code}): ${K.reason}`),e.onError.invoke(K.code,K.reason)},z.connect(K)}leave(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return new Promise((b=>{this.onLeave((K=>b(K))),this.connection?K?this.connection.send([l.Protocol.LEAVE_ROOM]):this.connection.close():this.onLeave.invoke(U.CloseCode.CONSENTED)}))}onMessage(K,b){return this.onMessageHandlers.on(this.getMessageHandlerKey(K),b)}send(K,b){const e=[l.Protocol.ROOM_DATA];let z;if("string"===typeof K?t.encode.string(e,K):t.encode.number(e,K),void 0!==b){const K=T.encode(b);z=new Uint8Array(e.length+K.byteLength),z.set(new Uint8Array(e),0),z.set(new Uint8Array(K),e.length)}else z=new Uint8Array(e);this.connection.send(z.buffer)}sendBytes(K,b){const e=[l.Protocol.ROOM_DATA_BYTES];let z;"string"===typeof K?t.encode.string(e,K):t.encode.number(e,K),z=new Uint8Array(e.length+(b.byteLength||b.length)),z.set(new Uint8Array(e),0),z.set(new Uint8Array(b),e.length),this.connection.send(z.buffer)}get state(){return this.serializer.getState()}removeAllListeners(){this.onJoin.clear(),this.onStateChange.clear(),this.onError.clear(),this.onLeave.clear(),this.onMessageHandlers.events={}}onMessageCallback(K){const b=Array.from(new Uint8Array(K.data)),e=b[0];if(e===l.Protocol.JOIN_ROOM){let K=1;const e=(0,l.utf8Read)(b,K);if(K+=(0,l.utf8Length)(e),this.serializerId=(0,l.utf8Read)(b,K),K+=(0,l.utf8Length)(this.serializerId),!this.serializer){const K=(0,Y.getSerializer)(this.serializerId);this.serializer=new K}b.length>K&&this.serializer.handshake&&this.serializer.handshake(b,{offset:K}),this.reconnectionToken=`${this.roomId}:${e}`,this.hasJoined=!0,this.onJoin.invoke(),this.connection.send([l.Protocol.JOIN_ROOM])}else if(e===l.Protocol.ERROR){const K={offset:1},e=t.decode.number(b,K),z=t.decode.string(b,K);this.onError.invoke(e,z)}else if(e===l.Protocol.LEAVE_ROOM)this.leave();else if(e===l.Protocol.ROOM_DATA_SCHEMA){const K={offset:1},e=this.serializer.getState().constructor._context.get(t.decode.number(b,K)),z=new e;z.decode(b,K),this.dispatchMessage(e,z)}else if(e===l.Protocol.ROOM_STATE)b.shift(),this.setState(b);else if(e===l.Protocol.ROOM_STATE_PATCH)b.shift(),this.patch(b);else if(e===l.Protocol.ROOM_DATA){const e={offset:1},z=t.decode.stringCheck(b,e)?t.decode.string(b,e):t.decode.number(b,e),k=b.length>e.offset?T.decode(K.data,e.offset):void 0;this.dispatchMessage(z,k)}else if(e===l.Protocol.ROOM_DATA_BYTES){const K={offset:1},e=t.decode.stringCheck(b,K)?t.decode.string(b,K):t.decode.number(b,K);this.dispatchMessage(e,new Uint8Array(b.slice(K.offset)))}}setState(K){this.serializer.setState(K),this.onStateChange.invoke(this.serializer.getState())}patch(K){this.serializer.patch(K),this.onStateChange.invoke(this.serializer.getState())}dispatchMessage(K,b){var e;const z=this.getMessageHandlerKey(K);this.onMessageHandlers.events[z]?this.onMessageHandlers.emit(z,b):this.onMessageHandlers.events["*"]?this.onMessageHandlers.emit("*",K,b):null===(e=console.warn)||void 0===e||e.call(console,`colyseus.js: onMessage() not registered for type '${K}'.`)}destroy(){this.serializer&&this.serializer.teardown()}getMessageHandlerKey(K){switch(typeof K){case"function":return`$${K._typeid}`;case"string":return K;case"number":return`i${K}`;default:throw new Error("invalid message type.")}}}b.Room=B},10627:(K,b)=>{"use strict";let e;function z(){return e||(e="undefined"!==typeof cc&&cc.sys&&cc.sys.localStorage?cc.sys.localStorage:"undefined"!==typeof window&&window.localStorage?window.localStorage:{cache:{},setItem:function(K,b){this.cache[K]=b},getItem:function(K){this.cache[K]},removeItem:function(K){delete this.cache[K]}}),e}Object.defineProperty(b,"__esModule",{value:!0}),b.getItem=b.removeItem=b.setItem=void 0,b.setItem=function(K,b){z().setItem(K,b)},b.removeItem=function(K){z().removeItem(K)},b.getItem=function(K,b){const e=z().getItem(K);"undefined"!==typeof Promise&&e instanceof Promise?e.then((K=>b(K))):b(e)}},10602:(K,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createNanoEvents=void 0;b.createNanoEvents=()=>({emit(K){let b=this.events[K]||[];for(var e=arguments.length,z=new Array(e>1?e-1:0),k=1;k<e;k++)z[k-1]=arguments[k];for(let j=0,T=b.length;j<T;j++)b[j](...z)},events:{},on(K,b){var e;return(null===(e=this.events[K])||void 0===e?void 0:e.push(b))||(this.events[K]=[b]),()=>{var e;this.events[K]=null===(e=this.events[K])||void 0===e?void 0:e.filter((K=>b!==K))}}})},10604:(K,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.createSignal=b.EventEmitter=void 0;class e{constructor(){this.handlers=[]}register(K){return this.handlers.push(K),this}invoke(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];this.handlers.forEach((K=>K.apply(this,b)))}invokeAsync(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];return Promise.all(this.handlers.map((K=>K.apply(this,b))))}remove(K){const b=this.handlers.indexOf(K);this.handlers[b]=this.handlers[this.handlers.length-1],this.handlers.pop()}clear(){this.handlers=[]}}b.EventEmitter=e,b.createSignal=function(){const K=new e;function b(b){return K.register(b,null===this)}return b.once=b=>{const e=function(){for(var z=arguments.length,k=new Array(z),j=0;j<z;j++)k[j]=arguments[j];b.apply(this,k),K.remove(e)};K.register(e)},b.remove=b=>K.remove(b),b.invoke=function(){return K.invoke(...arguments)},b.invokeAsync=function(){return K.invokeAsync(...arguments)},b.clear=()=>K.clear(),b}},10556:(K,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.ServerError=b.CloseCode=void 0,function(K){K[K.CONSENTED=4e3]="CONSENTED",K[K.DEVMODE_RESTART=4010]="DEVMODE_RESTART"}(b.CloseCode||(b.CloseCode={}));class e extends Error{constructor(K,b){super(b),this.name="ServerError",this.code=K}}b.ServerError=e},10524:(K,b,e)=>{"use strict";b.d=void 0,e(10532);var z=e(10541);Object.defineProperty(b,"d",{enumerable:!0,get:function(){return z.Client}});var k=e(10595);var j=e(10562);var T=e(10618);const F=e(10630);const l=e(10637),Y=e(10597);(0,Y.registerSerializer)("schema",F.SchemaSerializer),(0,Y.registerSerializer)("none",l.NoneSerializer)},10532:()=>{ArrayBuffer.isView||(ArrayBuffer.isView=K=>null!==K&&"object"===typeof K&&K.buffer instanceof ArrayBuffer),"undefined"===typeof globalThis&&"undefined"!==typeof window&&(window.globalThis=window)},10564:(K,b)=>{"use strict";function e(K,b){if(this._offset=b,K instanceof ArrayBuffer)this._buffer=K,this._view=new DataView(this._buffer);else{if(!ArrayBuffer.isView(K))throw new Error("Invalid argument");this._buffer=K.buffer,this._view=new DataView(this._buffer,K.byteOffset,K.byteLength)}}Object.defineProperty(b,"__esModule",{value:!0}),b.decode=b.encode=void 0,e.prototype._array=function(K){for(var b=new Array(K),e=0;e<K;e++)b[e]=this._parse();return b},e.prototype._map=function(K){for(var b={},e=0;e<K;e++)b[this._parse()]=this._parse();return b},e.prototype._str=function(K){var b=function(K,b,e){for(var z="",k=0,j=b,T=b+e;j<T;j++){var F=K.getUint8(j);if(0!==(128&F))if(192!==(224&F))if(224!==(240&F)){if(240!==(248&F))throw new Error("Invalid byte "+F.toString(16));(k=(7&F)<<18|(63&K.getUint8(++j))<<12|(63&K.getUint8(++j))<<6|63&K.getUint8(++j))>=65536?(k-=65536,z+=String.fromCharCode(55296+(k>>>10),56320+(1023&k))):z+=String.fromCharCode(k)}else z+=String.fromCharCode((15&F)<<12|(63&K.getUint8(++j))<<6|63&K.getUint8(++j));else z+=String.fromCharCode((31&F)<<6|63&K.getUint8(++j));else z+=String.fromCharCode(F)}return z}(this._view,this._offset,K);return this._offset+=K,b},e.prototype._bin=function(K){var b=this._buffer.slice(this._offset,this._offset+K);return this._offset+=K,b},e.prototype._parse=function(){var K,b=this._view.getUint8(this._offset++),e=0,z=0,k=0,j=0;if(b<192)return b<128?b:b<144?this._map(15&b):b<160?this._array(15&b):this._str(31&b);if(b>223)return-1*(255-b+1);switch(b){case 192:return null;case 194:return!1;case 195:return!0;case 196:return e=this._view.getUint8(this._offset),this._offset+=1,this._bin(e);case 197:return e=this._view.getUint16(this._offset),this._offset+=2,this._bin(e);case 198:return e=this._view.getUint32(this._offset),this._offset+=4,this._bin(e);case 199:if(e=this._view.getUint8(this._offset),z=this._view.getInt8(this._offset+1),this._offset+=2,-1===z){var T=this._view.getUint32(this._offset);return k=this._view.getInt32(this._offset+4),j=this._view.getUint32(this._offset+8),this._offset+=12,new Date(1e3*(4294967296*k+j)+T/1e6)}return[z,this._bin(e)];case 200:return e=this._view.getUint16(this._offset),z=this._view.getInt8(this._offset+2),this._offset+=3,[z,this._bin(e)];case 201:return e=this._view.getUint32(this._offset),z=this._view.getInt8(this._offset+4),this._offset+=5,[z,this._bin(e)];case 202:return K=this._view.getFloat32(this._offset),this._offset+=4,K;case 203:return K=this._view.getFloat64(this._offset),this._offset+=8,K;case 204:return K=this._view.getUint8(this._offset),this._offset+=1,K;case 205:return K=this._view.getUint16(this._offset),this._offset+=2,K;case 206:return K=this._view.getUint32(this._offset),this._offset+=4,K;case 207:return k=this._view.getUint32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,k+j;case 208:return K=this._view.getInt8(this._offset),this._offset+=1,K;case 209:return K=this._view.getInt16(this._offset),this._offset+=2,K;case 210:return K=this._view.getInt32(this._offset),this._offset+=4,K;case 211:return k=this._view.getInt32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,k+j;case 212:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?void(this._offset+=1):[z,this._bin(1)];case 213:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(2)];case 214:return z=this._view.getInt8(this._offset),this._offset+=1,-1===z?(K=this._view.getUint32(this._offset),this._offset+=4,new Date(1e3*K)):[z,this._bin(4)];case 215:return z=this._view.getInt8(this._offset),this._offset+=1,0===z?(k=this._view.getInt32(this._offset)*Math.pow(2,32),j=this._view.getUint32(this._offset+4),this._offset+=8,new Date(k+j)):-1===z?(k=this._view.getUint32(this._offset),j=this._view.getUint32(this._offset+4),this._offset+=8,new Date(1e3*(4294967296*(3&k)+j)+(k>>>2)/1e6)):[z,this._bin(8)];case 216:return z=this._view.getInt8(this._offset),this._offset+=1,[z,this._bin(16)];case 217:return e=this._view.getUint8(this._offset),this._offset+=1,this._str(e);case 218:return e=this._view.getUint16(this._offset),this._offset+=2,this._str(e);case 219:return e=this._view.getUint32(this._offset),this._offset+=4,this._str(e);case 220:return e=this._view.getUint16(this._offset),this._offset+=2,this._array(e);case 221:return e=this._view.getUint32(this._offset),this._offset+=4,this._array(e);case 222:return e=this._view.getUint16(this._offset),this._offset+=2,this._map(e);case 223:return e=this._view.getUint32(this._offset),this._offset+=4,this._map(e)}throw new Error("Could not parse")},b.decode=function(K){var b=new e(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),z=b._parse();if(b._offset!==K.byteLength)throw new Error(K.byteLength-b._offset+" trailing bytes");return z};function z(K,b,e){for(var z=0,k=0,j=e.length;k<j;k++)(z=e.charCodeAt(k))<128?K.setUint8(b++,z):z<2048?(K.setUint8(b++,192|z>>6),K.setUint8(b++,128|63&z)):z<55296||z>=57344?(K.setUint8(b++,224|z>>12),K.setUint8(b++,128|z>>6&63),K.setUint8(b++,128|63&z)):(k++,z=65536+((1023&z)<<10|1023&e.charCodeAt(k)),K.setUint8(b++,240|z>>18),K.setUint8(b++,128|z>>12&63),K.setUint8(b++,128|z>>6&63),K.setUint8(b++,128|63&z))}function k(K,b,e){var z=typeof e,j=0,T=0,F=0,l=0,Y=0,A=0;if("string"===z){if(Y=function(K){for(var b=0,e=0,z=0,k=K.length;z<k;z++)(b=K.charCodeAt(z))<128?e+=1:b<2048?e+=2:b<55296||b>=57344?e+=3:(z++,e+=4);return e}(e),Y<32)K.push(160|Y),A=1;else if(Y<256)K.push(217,Y),A=2;else if(Y<65536)K.push(218,Y>>8,Y),A=3;else{if(!(Y<4294967296))throw new Error("String too long");K.push(219,Y>>24,Y>>16,Y>>8,Y),A=5}return b.push({_str:e,_length:Y,_offset:K.length}),A+Y}if("number"===z)return Math.floor(e)===e&&isFinite(e)?e>=0?e<128?(K.push(e),1):e<256?(K.push(204,e),2):e<65536?(K.push(205,e>>8,e),3):e<4294967296?(K.push(206,e>>24,e>>16,e>>8,e),5):(F=e/Math.pow(2,32)|0,l=e>>>0,K.push(207,F>>24,F>>16,F>>8,F,l>>24,l>>16,l>>8,l),9):e>=-32?(K.push(e),1):e>=-128?(K.push(208,e),2):e>=-32768?(K.push(209,e>>8,e),3):e>=-2147483648?(K.push(210,e>>24,e>>16,e>>8,e),5):(F=Math.floor(e/Math.pow(2,32)),l=e>>>0,K.push(211,F>>24,F>>16,F>>8,F,l>>24,l>>16,l>>8,l),9):(K.push(203),b.push({_float:e,_length:8,_offset:K.length}),9);if("object"===z){if(null===e)return K.push(192),1;if(Array.isArray(e)){if((Y=e.length)<16)K.push(144|Y),A=1;else if(Y<65536)K.push(220,Y>>8,Y),A=3;else{if(!(Y<4294967296))throw new Error("Array too large");K.push(221,Y>>24,Y>>16,Y>>8,Y),A=5}for(j=0;j<Y;j++)A+=k(K,b,e[j]);return A}if(e instanceof Date){var X=e.getTime(),t=Math.floor(X/1e3),U=1e6*(X-1e3*t);return t>=0&&U>=0&&t<=17179869183?0===U&&t<=4294967295?(K.push(214,255,t>>24,t>>16,t>>8,t),6):(F=t/4294967296,l=4294967295&t,K.push(215,255,U>>22,U>>14,U>>6,F,l>>24,l>>16,l>>8,l),10):(F=Math.floor(t/4294967296),l=t>>>0,K.push(199,12,255,U>>24,U>>16,U>>8,U,F>>24,F>>16,F>>8,F,l>>24,l>>16,l>>8,l),15)}if(e instanceof ArrayBuffer){if((Y=e.byteLength)<256)K.push(196,Y),A=2;else if(Y<65536)K.push(197,Y>>8,Y),A=3;else{if(!(Y<4294967296))throw new Error("Buffer too large");K.push(198,Y>>24,Y>>16,Y>>8,Y),A=5}return b.push({_bin:e,_length:Y,_offset:K.length}),A+Y}if("function"===typeof e.toJSON)return k(K,b,e.toJSON());var B=[],u="",m=Object.keys(e);for(j=0,T=m.length;j<T;j++)void 0!==e[u=m[j]]&&"function"!==typeof e[u]&&B.push(u);if((Y=B.length)<16)K.push(128|Y),A=1;else if(Y<65536)K.push(222,Y>>8,Y),A=3;else{if(!(Y<4294967296))throw new Error("Object too large");K.push(223,Y>>24,Y>>16,Y>>8,Y),A=5}for(j=0;j<Y;j++)A+=k(K,b,u=B[j]),A+=k(K,b,e[u]);return A}if("boolean"===z)return K.push(e?195:194),1;if("undefined"===z)return K.push(192),1;if("function"===typeof e.toJSON)return k(K,b,e.toJSON());throw new Error("Could not encode")}b.encode=function(K){var b=[],e=[],j=k(b,e,K),T=new ArrayBuffer(j),F=new DataView(T),l=0,Y=0,A=-1;e.length>0&&(A=e[0]._offset);for(var X,t=0,U=0,B=0,u=b.length;B<u;B++)if(F.setUint8(Y+B,b[B]),B+1===A){if(t=(X=e[l])._length,U=Y+A,X._bin)for(var m=new Uint8Array(X._bin),D=0;D<t;D++)F.setUint8(U+D,m[D]);else X._str?z(F,U,X._str):void 0!==X._float&&F.setFloat64(U,X._float);Y+=t,e[++l]&&(A=e[l]._offset)}return T}},10637:(K,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.NoneSerializer=void 0;b.NoneSerializer=class{setState(K){}getState(){return null}patch(K){}teardown(){}handshake(K){}}},10630:(K,b,e)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.SchemaSerializer=void 0;const z=e(10610);b.SchemaSerializer=class{setState(K){return this.state.decode(K)}getState(){return this.state}patch(K){return this.state.decode(K)}teardown(){var K,b;null===(b=null===(K=this.state)||void 0===K?void 0:K.$changes)||void 0===b||b.root.clearRefs()}handshake(K,b){if(this.state){(new z.Reflection).decode(K,b)}else this.state=z.Reflection.decode(K,b)}}},10597:(K,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.getSerializer=b.registerSerializer=void 0;const e={};b.registerSerializer=function(K,b){e[K]=b},b.getSerializer=function(K){const b=e[K];if(!b)throw new Error("missing serializer: "+K);return b}},10580:function(K,b,e){"use strict";var z=this&&this.__importDefault||function(K){return K&&K.__esModule?K:{default:K}};Object.defineProperty(b,"__esModule",{value:!0}),b.WebSocketTransport=void 0;const k=z(e(10587)),j=globalThis.WebSocket||k.default;b.WebSocketTransport=class{constructor(K){this.events=K}send(K){K instanceof ArrayBuffer?this.ws.send(K):Array.isArray(K)&&this.ws.send(new Uint8Array(K).buffer)}connect(K){this.ws=new j(K,this.protocols),this.ws.binaryType="arraybuffer",this.ws.onopen=this.events.onopen,this.ws.onmessage=this.events.onmessage,this.ws.onclose=this.events.onclose,this.ws.onerror=this.events.onerror}close(K,b){this.ws.close(K,b)}get isOpen(){return this.ws.readyState===j.OPEN}}},10587:K=>{"use strict";K.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},12158:K=>{"use strict";function b(K,e,z){var k=0|K[z];if(k<=0)return[];var j,T=new Array(k);if(z===K.length-1)for(j=0;j<k;++j)T[j]=e;else for(j=0;j<k;++j)T[j]=b(K,e,z+1);return T}K.exports=function(K,e){switch("undefined"===typeof e&&(e=0),typeof K){case"number":if(K>0)return function(K,b){var e,z;for(e=new Array(K),z=0;z<K;++z)e[z]=b;return e}(0|K,e);break;case"object":if("number"===typeof K.length)return b(K,e,0)}return[]}},12107:(K,b,e)=>{K.exports=function(){var K=this;this.components={},this.comps=this.components;var b=this.components,e=1,k={},j=[],T=[],F={timeout:!1,removals:[],multiComps:[]};function l(K,e){var z=b[e],j=k[e],T=j.hash[K];T&&(j.remove(K),z.ab&&(z.multi?(T.forEach((b=>{b&&z.ab(K,b)})),T.length=0):z.ab(K,T)),F.removals.push(j),Y())}function Y(){F.timeout||(F.timeout=!0,setTimeout(A,1))}function A(){F.timeout=!1,X()}function X(){F.multiComps.length&&function(K){for(var b=0;b<K.length;b++){var{entID:e,data:z}=K[b],k=z.hash[e];if(k){for(var j=0;j<k.length;j++)k[j]||(k.splice(j,1),j--);0===k.length&&(z.remove(e),F.removals.push(z))}}K.length=0}(F.multiComps),F.removals.length&&function(K){for(var b=0;b<K.length;b++){K[b].flush()}K.length=0}(F.removals)}this.ki=k,this._systems=j,this._renderSystems=T,this.Jg=function(b){var z=e++;return Array.isArray(b)&&b.forEach((b=>K.We(z,b))),z},this.deleteEntity=function(b){return Object.keys(k).forEach((K=>{k[K].hash[b]&&l(b,K)})),K},this.hh=function(K){if(!K)throw new Error("Missing component definition");var e=K.name;if(!e)throw new Error("Component definition must have a name property.");if("string"!==typeof e)throw new Error("Component name must be a string.");if(""===e)throw new Error("Component name must be a non-empty string.");if(k[e])throw new Error(`Component ${e} already exists.`);var F={};return F.name=e,F.multi=!!K.multi,F.order=isNaN(K.order)?99:K.order,F.stateConstructor=K.stateConstructor||null,F.state=K.state||{},F.Bd=K.Bd||null,F.ab=K.ab||null,F.system=K.system||null,F.Nd=K.Nd||null,b[e]=F,k[e]=new z,k[e]._pendingMultiCleanup=!1,k[e]._multiCleanupIDs=F.multi?[]:null,F.system&&(j.push(e),j.sort(((K,e)=>b[K].order-b[e].order))),F.Nd&&(T.push(e),T.sort(((K,e)=>b[K].order-b[e].order))),e},this.overwriteComponent=function(K,e){var z=b[K];if(!z)throw new Error(`Unknown component: ${K}`);if(!e)throw new Error("Missing component definition");if(z.name!==e.name)throw new Error("Overwriting component must use the same name property.");var F={};F.name=K,F.multi=!!e.multi,F.order=isNaN(e.order)?99:e.order,F.state=e.state||{},F.Bd=e.Bd||null,F.ab=e.ab||null,F.system=e.system||null,F.Nd=e.Nd||null,b[K]=F,k[K]._pendingMultiCleanup=!1,k[K]._multiCleanupIDs=F.multi?[]:null;var l=j.indexOf(K);F.system&&l<0&&j.push(K),!F.system&&l>=0&&j.splice(l,1),j.sort(((K,e)=>b[K].order-b[e].order));var Y=T.indexOf(K);F.Nd&&Y<0&&T.push(K),!F.Nd&&Y>=0&&T.splice(Y,1),T.sort(((K,e)=>b[K].order-b[e].order));var A=F.state;return this.jg(K).forEach((K=>{for(var b in A)b in K||(K[b]=A[b]);F.Bd&&F.Bd(K.Kd,K)})),K},this.deleteComponent=function(e){var z=k[e];if(!z)throw new Error(`Unknown component: ${e}`);z.flush(),z.list.forEach((K=>{K&&l(K.Kd||K[0].Kd,e)}));var F=j.indexOf(e),Y=T.indexOf(e);return F>-1&&j.splice(F,1),Y>-1&&T.splice(Y,1),k[e].dispose(),delete k[e],delete b[e],K},this.We=function(K,e,z){var j,T=b[e],F=k[e];if(!F)throw new Error(`Unknown component: ${e}.`);if(F.hash[K]&&!T.multi)throw new Error(`Entity ${K} already has component: ${e}.`);if(T.stateConstructor){if(!(j=new T.stateConstructor).hasOwnProperty("Kd"))throw new Error(`Component ${T.name} stateConstructor type does not have property __id`)}else j=Object.assign({},{Kd:K},T.state,z);if(j.Kd=K,T.multi){var l=F.hash[K];l||(l=[],F.add(K,l)),l.push(j)}else F.add(K,j);return T.Bd&&T.Bd(K,j),this},this.gf=function(K,b){var e=k[b];if(!e)throw new Error(`Unknown component: ${b}.`);return!!e.hash[K]},this.$e=function(b,e){if(!k[e])throw new Error(`Unknown component: ${e}.`);return l(b,e),K},this.getState=function(K,b){var e=k[b];if(!e)throw new Error(`Unknown component: ${b}.`);return e.hash[K]},this.jg=function(K){var b=k[K];if(!b)throw new Error(`Unknown component: ${K}.`);return X(),b.list},this.fk=function(K){if(!k[K])throw new Error(`Unknown component: ${K}.`);var b=k[K].hash;return K=>b[K]},this.ik=function(K){if(!k[K])throw new Error(`Unknown component: ${K}.`);var b=k[K].hash;return K=>!!b[K]},this.yd=function(e){X();for(var z=0;z<j.length;z++){var T=j[z],F=b[T],l=k[T];F.system(e,l.list),X()}return K},this.render=function(e){X();for(var z=0;z<T.length;z++){var j=T[z],F=b[j],l=k[j];F.Nd(e,l.list),X()}return K},this.removeMultiComponent=function(e,z,j){var T=b[z],l=k[z];if(!l)throw new Error(`Unknown component: ${z}.`);if(!T.multi)throw new Error("removeMultiComponent called on non-multi component");return function(K,b,e,z){var k=e.hash[K];if(k){var j=k[z];j&&(k[z]=null,b.ab&&b.ab(K,j),F.multiComps.push({entID:K,data:e}),Y())}}(e,T,l,j),K}};var z=e(12116)},12116:K=>{function b(K,b){var e=K._map[b];if(delete K.hash[b],delete K._map[b],e===K.list.length-1)K.list.pop();else{var z=K.list.pop();if(K.list[e]=z,null===z||null===z[0]){var k=K.list.length;for(var j in K._map)if(K._map[j]===k)return void(K._map[j]=e)}else{var T=z.Kd||z[0].Kd;K._map[T]=e}}}K.exports=class{constructor(){this.list=[],this.hash={},this._map={},this._pendingRemovals=[]}add(K,b){if("number"===typeof this._map[K]){var e=this._map[K];this.hash[K]=b,this.list[e]=b}else this._map[K]=this.list.length,this.hash[K]=b,this.list.push(b)}remove(K){var b=this._map[K];this.hash[K]=null,this.list[b]=null,this._pendingRemovals.push(K)}dispose(){this.list=null,this.hash=null,this._map=null,this._pendingRemovals.length=0}flush(){for(var K=0;K<this._pendingRemovals.length;K++){var e=this._pendingRemovals[K];null===this.hash[e]&&b(this,e)}this._pendingRemovals.length=0}}},12382:K=>{"use strict";K.exports=function(K,b,e,z,k,j){var T=+b[0],F=+b[1],l=+b[2],Y=+e[0],A=+e[1],X=+e[2],t=Math.sqrt(Y*Y+A*A+X*X);if(0===t)throw new Error("Can't raycast along a zero vector");return function(K,b,e,z,k,j,T,F,l,Y){for(var A=0,X=Math.floor,t=0|X(b),U=0|X(e),B=0|X(z),u=k>0?1:-1,m=j>0?1:-1,D=T>0?1:-1,I=Math.abs(1/k),x=Math.abs(1/j),Q=Math.abs(1/T),G=I<1/0?I*(u>0?t+1-b:b-t):1/0,i=x<1/0?x*(m>0?U+1-e:e-U):1/0,S=Q<1/0?Q*(D>0?B+1-z:z-B):1/0,M=-1;A<=F;){var r=K(t,U,B);if(r)return l&&(l[0]=b+A*k,l[1]=e+A*j,l[2]=z+A*T),Y&&(Y[0]=Y[1]=Y[2]=0,0===M&&(Y[0]=-u),1===M&&(Y[1]=-m),2===M&&(Y[2]=-D)),r;G<i?G<S?(t+=u,A=G,G+=I,M=0):(B+=D,A=S,S+=Q,M=2):i<S?(U+=m,A=i,i+=x,M=1):(B+=D,A=S,S+=Q,M=2)}return l&&(l[0]=b+A*k,l[1]=e+A*j,l[2]=z+A*T),Y&&(Y[0]=Y[1]=Y[2]=0),0}(K,T,F,l,Y/=t,A/=t,X/=t,z="undefined"===typeof z?64:+z,k,j)}},12421:(K,b,e)=>{"use strict";e.d(b,{d:()=>j});var z=e(696);function k(){this.ej=!1,this.stopPropagation=!1,this.fj=!1,this.disabled=!1}class j{constructor(K,b){this.version="0.7.0";var e=Object.assign({},new k,b||{});this.element=K||document,this.ej=!!e.ej,this.stopPropagation=!!e.stopPropagation,this.fj=!!e.fj,this.disabled=!!e.disabled,this.filterEvents=(K,b)=>!0,this.down=new z.EventEmitter,this.up=new z.EventEmitter,this.state={},this.dg={dx:0,dy:0,Yj:0,cg:0,Zj:0},this.pressCount={},this.releaseCount={},this._keyBindmap={},this._keyStates={},this._bindPressCount={},this._touches={lastX:0,lastY:0,currID:null},"loading"!==document.readyState?F(this):document.addEventListener("DOMContentLoaded",(K=>{F(this)}),{once:!0})}bind(K){for(var b=arguments.length,e=new Array(b>1?b-1:0),z=1;z<b;z++)e[z-1]=arguments[z];e.forEach((b=>{var e=this._keyBindmap[b]||[];e.includes(K)||(e.push(K),this._keyBindmap[b]=e)})),this.state[K]=!!this.state[K],this.pressCount[K]=this.pressCount[K]||0,this.releaseCount[K]=this.releaseCount[K]||0}unbind(K){for(var b in this._keyBindmap){var e=this._keyBindmap[b],z=e.indexOf(K);z>-1&&e.splice(z,1)}}getBindings(){var K={};for(var b in this._keyBindmap){this._keyBindmap[b].forEach((e=>{K[e]=K[e]||[],K[e].push(b)}))}return K}yd(){T(this.dg),T(this.pressCount),T(this.releaseCount)}}function T(K){for(var b in K)K[b]=0}function F(K){window.addEventListener("keydown",B.bind(null,K,!0),!1),window.addEventListener("keyup",B.bind(null,K,!1),!1);var b={passive:!0};K.element.addEventListener("touchstart",X.bind(void 0,K),{passive:!1}),K.element.addEventListener("touchend",U.bind(void 0,K),b),K.element.addEventListener("mousedown",u.bind(null,K,!0),b),window.document.addEventListener("mouseup",u.bind(null,K,!1),b),K.element.addEventListener("touchmove",m.bind(null,K),b),K.element.addEventListener("mousemove",m.bind(null,K),b),window.PointerEvent,K.element.addEventListener("wheel",D.bind(null,K),b),K.element.addEventListener("contextmenu",I.bind(null,K),!1),window.addEventListener("blur",x.bind(null,K),!1)}var l=0,Y=0,A=null;function X(K,b){b.preventDefault(),t(b)}function t(K){let b=!1;for(let e=0;e<K.touches.length;++e)if(K.touches[e].identifier===A){b=!0;break}if(!b){const b=K.changedTouches[0];l=b.clientX,Y=b.clientY,A=b.identifier}}function U(K,b){for(var e=b.changedTouches,z=0;z<e.length;++z)e[z].identifier===A&&(A=null)}function B(K,b,e){Q(e.code,b,K,e)}function u(K,b,e){if("pointerId"in e)if(b){if(null!==K._touches.currID)return;K._touches.currID=e.pointerId}else{if(K._touches.currID!==e.pointerId)return;K._touches.currID=null}return Q("Mouse"+("button"in e?e.button+1:1),b,K,e),!1}function m(K,b){var e=b.movementX||b.mozMovementX||0,z=b.movementY||b.mozMovementY||0;if(b.touches&&0===(e|z)){var k=function(K){t(K);for(let b=0;b<K.changedTouches.length;++b)if(K.changedTouches[b].identifier==A){const e=K.changedTouches[b],z=[e.clientX-l,e.clientY-Y];return l=e.clientX,Y=e.clientY,z}return console.error(`Did not find touch id ${A}`),[0,0]}(b);e=k[0],z=k[1]}K.dg.dx+=e,K.dg.dy+=z}function D(K,b){var e=1;switch(b.deltaMode){case 0:e=1;break;case 1:e=12;break;case 2:e=K.element.clientHeight||window.innerHeight}K.dg.Yj+=(b.deltaX||0)*e,K.dg.cg+=(b.deltaY||0)*e,K.dg.Zj+=(b.deltaZ||0)*e}function I(K,b){if(!K.fj)return b.preventDefault(),!1}function x(K){for(var b in K._keyStates)K._keyStates[b]&&(/^Mouse\d/.test(b)||Q(b,!1,K,{code:b,note:"This is a mocked KeyboardEvent made by the 'game-inputs' module",preventDefault:()=>{},stopPropagation:()=>{}}))}function Q(K,b,e,z){var k=e._keyBindmap[K];k&&(G(e._keyStates[K],b)&&(e._keyStates[K]=b,k.forEach((K=>{(!e.filterEvents||e.filterEvents(z,K))&&function(K,b,e,z){var k=b?e.pressCount:e.releaseCount;k[K]=(k[K]||0)+1;var j=e._bindPressCount[K]||0;(j+=b?1:-1)<0&&(j=0);e._bindPressCount[K]=j;var T=e.state[K];if(G(T,j)){e.state[K]=j>0;var F=b?e.down:e.up;e.disabled||F.emit(K,z)}}(K,b,e,z)}))),"button"in z||(e.ej&&!z.defaultPrevented&&z.preventDefault(),e.stopPropagation&&z.stopPropagation()))}function G(K,b){return K?!b:b}},10671:K=>{"use strict";K.exports=function(K){for(var b=new Array(K),e=0;e<K;++e)b[e]=e;return b}},10675:K=>{function b(K){return!!K.constructor&&"function"===typeof K.constructor.isBuffer&&K.constructor.isBuffer(K)}K.exports=function(K){return null!=K&&(b(K)||function(K){return"function"===typeof K.readFloatLE&&"function"===typeof K.slice&&b(K.slice(0,0))}(K)||!!K._isBuffer)}},12391:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{constructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;this.Kh=!1,this.Lh=!1,this.Ih=30,this.Jh=0,this.Th=!1,this.fullscreen=!1,this.Nh=function(K){},this.Oh=function(){},this.Rh=function(){},this.bb=function(){},this.Ph=function(K){},this.onFullscreenChanged=function(K){},Y((()=>{!function(K,b){K._nowObject=performance||Date,K._lastTick=0,K._renderAccum=0,K._rt=0,K._frameCB=F.bind(null,K),requestAnimationFrame(K._frameCB),b>0&&(K._intervalCB=T.bind(null,K),K._interval=setInterval(K._intervalCB,Math.max(b,1e3/K.Ih/2)))}(this,b),function(K,b){if(!b)return;var e=!1,z=!1;document.addEventListener("pointerlockchange",(z=>{e=document.pointerLockElement===b,K.Ph(e)})),document.addEventListener("fullscreenchange",(e=>{z=document.fullscreenElement===b,K.onFullscreenChanged(z)})),Object.defineProperty(K,"Th",{get:()=>e,set:K=>{K&&!e?l(b):e&&!K&&function(K){K.exitPointerLock&&K.exitPointerLock()}(document)}}),Object.defineProperty(K,"fullscreen",{get:()=>z,set:K=>{K&&!z?b.requestFullscreen():z&&!K&&document.exitFullscreen()}}),b.addEventListener("click",(k=>{K.Kh&&!e&&l(b),K.Lh&&!z&&b.requestFullscreen()}));var k=()=>K.bb();if(window.ResizeObserver){new ResizeObserver(k).observe(b)}else window.addEventListener("resize",k)}(this,K),this.Rh()}))}}var k=3,j=20;function T(K){for(var b=1e3/K.Ih,e=K._nowObject.now()+j,z=0;K._nowObject.now()>=K._lastTick+b&&K._nowObject.now()<e&&++z<=k;)K.Nh(b),K._lastTick+=b;var T=5*(b+5),F=K._nowObject.now();if(F-K._lastTick>T)for(;F>=K._lastTick+b;)K._lastTick+=b}function F(K){requestAnimationFrame(K._frameCB),T(K);var b=K._nowObject.now(),e=b-K._rt;if(K._rt=b,K.Jh>0){K._renderAccum+=e;var z=1e3/K.Jh;if(K._renderAccum<z)return;K._renderAccum=Math.min(K._renderAccum-z,z)}var k=1e3/K.Ih,j=(b-K._lastTick)/k;K.Oh(e,j,k)}function l(K){K.requestPointerLock&&K.requestPointerLock()}var Y=K=>{if("loading"===document.readyState){var b=()=>{document.removeEventListener("readystatechange",b),K()};document.addEventListener("readystatechange",b)}else setTimeout(K,1)}},10665:(K,b,e)=>{var z=e(10671),k=e(10675),j="undefined"!==typeof Float64Array;function T(K,b){return K[0]-b[0]}function F(){var K,b=this.stride,e=new Array(b.length);for(K=0;K<e.length;++K)e[K]=[Math.abs(b[K]),K];e.sort(T);var z=new Array(e.length);for(K=0;K<z.length;++K)z[K]=e[K][1];return z}function l(K,b){var e=["View",b,"d",K].join("");b<0&&(e="View_Nil"+K);var k="generic"===K;if(-1===b){var j="function "+e+"(a){this.data=a;};var proto="+e+".prototype;proto.dtype='"+K+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+e+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+e+"(a){return new "+e+"(a);}";return new Function(j)()}if(0===b){j="function "+e+"(a,d) {this.data = a;this.offset = d};var proto="+e+".prototype;proto.dtype='"+K+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+e+"_copy() {return new "+e+"(this.data,this.offset)};proto.pick=function "+e+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+e+"_get(){return "+(k?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+e+"_set(v){return "+(k?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+e+"(a,b,c,d){return new "+e+"(a,d)}";return new Function("TrivialArray",j)(Y[K][0])}j=["'use strict'"];var T=z(b),l=T.map((function(K){return"i"+K})),A="this.offset+"+T.map((function(K){return"this.stride["+K+"]*i"+K})).join("+"),X=T.map((function(K){return"b"+K})).join(","),t=T.map((function(K){return"c"+K})).join(",");j.push("function "+e+"(a,"+X+","+t+",d){this.data=a","this.shape=["+X+"]","this.stride=["+t+"]","this.offset=d|0}","var proto="+e+".prototype","proto.dtype='"+K+"'","proto.dimension="+b),j.push("Object.defineProperty(proto,'size',{get:function "+e+"_size(){return "+T.map((function(K){return"this.shape["+K+"]"})).join("*"),"}})"),1===b?j.push("proto.order=[0]"):(j.push("Object.defineProperty(proto,'order',{get:"),b<4?(j.push("function "+e+"_order(){"),2===b?j.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===b&&j.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):j.push("ORDER})")),j.push("proto.set=function "+e+"_set("+l.join(",")+",v){"),k?j.push("return this.data.set("+A+",v)}"):j.push("return this.data["+A+"]=v}"),j.push("proto.get=function "+e+"_get("+l.join(",")+"){"),k?j.push("return this.data.get("+A+")}"):j.push("return this.data["+A+"]}"),j.push("proto.index=function "+e+"_index(",l.join(),"){return "+A+"}"),j.push("proto.hi=function "+e+"_hi("+l.join(",")+"){return new "+e+"(this.data,"+T.map((function(K){return["(typeof i",K,"!=='number'||i",K,"<0)?this.shape[",K,"]:i",K,"|0"].join("")})).join(",")+","+T.map((function(K){return"this.stride["+K+"]"})).join(",")+",this.offset)}");var U=T.map((function(K){return"a"+K+"=this.shape["+K+"]"})),B=T.map((function(K){return"c"+K+"=this.stride["+K+"]"}));j.push("proto.lo=function "+e+"_lo("+l.join(",")+"){var b=this.offset,d=0,"+U.join(",")+","+B.join(","));for(var u=0;u<b;++u)j.push("if(typeof i"+u+"==='number'&&i"+u+">=0){d=i"+u+"|0;b+=c"+u+"*d;a"+u+"-=d}");j.push("return new "+e+"(this.data,"+T.map((function(K){return"a"+K})).join(",")+","+T.map((function(K){return"c"+K})).join(",")+",b)}"),j.push("proto.step=function "+e+"_step("+l.join(",")+"){var "+T.map((function(K){return"a"+K+"=this.shape["+K+"]"})).join(",")+","+T.map((function(K){return"b"+K+"=this.stride["+K+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(u=0;u<b;++u)j.push("if(typeof i"+u+"==='number'){d=i"+u+"|0;if(d<0){c+=b"+u+"*(a"+u+"-1);a"+u+"=ceil(-a"+u+"/d)}else{a"+u+"=ceil(a"+u+"/d)}b"+u+"*=d}");j.push("return new "+e+"(this.data,"+T.map((function(K){return"a"+K})).join(",")+","+T.map((function(K){return"b"+K})).join(",")+",c)}");var m=new Array(b),D=new Array(b);for(u=0;u<b;++u)m[u]="a[i"+u+"]",D[u]="b[i"+u+"]";j.push("proto.transpose=function "+e+"_transpose("+l+"){"+l.map((function(K,b){return K+"=("+K+"===undefined?"+b+":"+K+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+e+"(this.data,"+m.join(",")+","+D.join(",")+",this.offset)}"),j.push("proto.pick=function "+e+"_pick("+l+"){var a=[],b=[],c=this.offset");for(u=0;u<b;++u)j.push("if(typeof i"+u+"==='number'&&i"+u+">=0){c=(c+this.stride["+u+"]*i"+u+")|0}else{a.push(this.shape["+u+"]);b.push(this.stride["+u+"])}");return j.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),j.push("return function construct_"+e+"(data,shape,stride,offset){return new "+e+"(data,"+T.map((function(K){return"shape["+K+"]"})).join(",")+","+T.map((function(K){return"stride["+K+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",j.join("\n"))(Y[K],F)}var Y={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};K.exports=function(K,b,e,z){if(void 0===K)return(0,Y.array[0])([]);"number"===typeof K&&(K=[K]),void 0===b&&(b=[K.length]);var T=b.length;if(void 0===e){e=new Array(T);for(var F=T-1,A=1;F>=0;--F)e[F]=A,A*=b[F]}if(void 0===z){z=0;for(F=0;F<T;++F)e[F]<0&&(z-=(b[F]-1)*e[F])}for(var X=function(K){if(k(K))return"buffer";if(j)switch(Object.prototype.toString.call(K)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(K)?"array":"generic"}(K),t=Y[X];t.length<=T+1;)t.push(l(X,t.length-1));return(0,t[T+1])(K,b,e,z)}},10645:K=>{var b;self,b=()=>(()=>{"use strict";var K={d:(b,e)=>{for(var z in e)K.o(e,z)&&!K.o(b,z)&&Object.defineProperty(b,z,{enumerable:!0,get:e[z]})},o:(K,b)=>Object.prototype.hasOwnProperty.call(K,b)},b={};K.d(b,{default:()=>n});var e,z=function(K,b){var e=b.x-K.x,z=b.y-K.y;return Math.sqrt(e*e+z*z)},k=function(K){return K*(Math.PI/180)},j=new Map,T=function(K){j.has(K)&&clearTimeout(j.get(K)),j.set(K,setTimeout(K,100))},F=function(K,b,e){for(var z,k=b.split(/[ ,]+/g),j=0;j<k.length;j+=1)z=k[j],K.addEventListener?K.addEventListener(z,e,!1):K.attachEvent&&K.attachEvent(z,e)},l=function(K,b,e){for(var z,k=b.split(/[ ,]+/g),j=0;j<k.length;j+=1)z=k[j],K.removeEventListener?K.removeEventListener(z,e):K.detachEvent&&K.detachEvent(z,e)},Y=function(K){return K.preventDefault(),K.type.match(/^touch/)?K.changedTouches:K},A=function(){return{x:void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,y:void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}},X=function(K,b){b.top||b.right||b.bottom||b.left?(K.style.top=b.top,K.style.right=b.right,K.style.bottom=b.bottom,K.style.left=b.left):(K.style.left=b.x+"px",K.style.top=b.y+"px")},t=function(K,b,e){var z=U(K);for(var k in z)if(z.hasOwnProperty(k))if("string"==typeof b)z[k]=b+" "+e;else{for(var j="",T=0,F=b.length;T<F;T+=1)j+=b[T]+" "+e+", ";z[k]=j.slice(0,-2)}return z},U=function(K){var b={};return b[K]="",["webkit","Moz","o"].forEach((function(e){b[e+K.charAt(0).toUpperCase()+K.slice(1)]=""})),b},B=function(K,b){for(var e in b)b.hasOwnProperty(e)&&(K[e]=b[e]);return K},u=function(K,b){if(K.length)for(var e=0,z=K.length;e<z;e+=1)b(K[e]);else b(K)},m="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document,D=window.matchMedia("(any-hover: none)").matches,I=!!("ontouchstart"in window),x=!!window.PointerEvent,Q=!!window.MSPointerEvent,G={start:"touchstart",move:"touchmove",end:"touchend, touchcancel"},i={start:"mousedown",move:"mousemove",end:"mouseup"},S={};function M(){}m&&!D?e=G:x?e={start:"pointerdown",move:"pointermove",end:"pointerup, pointercancel"}:Q?e={start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:I?(e=G,S=i):e=i,M.prototype.on=function(K,b){var e,z=this,k=K.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var j=0;j<k.length;j+=1)e=k[j],z._handlers_[e]=z._handlers_[e]||[],z._handlers_[e].push(b);return z},M.prototype.off=function(K,b){var e=this;return e._handlers_=e._handlers_||{},void 0===K?e._handlers_={}:void 0===b?e._handlers_[K]=null:e._handlers_[K]&&e._handlers_[K].indexOf(b)>=0&&e._handlers_[K].splice(e._handlers_[K].indexOf(b),1),e},M.prototype.trigger=function(K,b){var e,z=this,k=K.split(/[ ,]+/g);z._handlers_=z._handlers_||{};for(var j=0;j<k.length;j+=1)e=k[j],z._handlers_[e]&&z._handlers_[e].length&&z._handlers_[e].forEach((function(K){K.call(z,{type:e,target:z},b)}))},M.prototype.config=function(K){var b=this;b.options=b.defaults||{},K&&(b.options=function(K,b){var e={};for(var z in K)K.hasOwnProperty(z)&&b.hasOwnProperty(z)?e[z]=b[z]:K.hasOwnProperty(z)&&(e[z]=K[z]);return e}(b.options,K))},M.prototype.bindEvt=function(K,b){var z=this;return z._domHandlers_=z._domHandlers_||{},z._domHandlers_[b]=function(){"function"==typeof z["on"+b]?z["on"+b].apply(z,arguments):console.warn('[WARNING] : Missing "on'+b+'" handler.')},F(K,e[b],z._domHandlers_[b]),S[b]&&F(K,S[b],z._domHandlers_[b]),z},M.prototype.unbindEvt=function(K,b){var z=this;return z._domHandlers_=z._domHandlers_||{},l(K,e[b],z._domHandlers_[b]),S[b]&&l(K,S[b],z._domHandlers_[b]),delete z._domHandlers_[b],this};const r=M;function L(K,b){return this.identifier=b.identifier,this.position=b.position,this.frontPosition=b.frontPosition,this.collection=K,this.defaults={size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,mode:"dynamic",zone:document.body,lockX:!1,lockY:!1,shape:"circle"},this.config(b),"dynamic"===this.options.mode&&(this.options.restOpacity=0),this.id=L.id,L.id+=1,this.buildEl().stylize(),this.instance={el:this.ui.el,on:this.on.bind(this),off:this.off.bind(this),show:this.show.bind(this),hide:this.hide.bind(this),add:this.addToDom.bind(this),remove:this.removeFromDom.bind(this),destroy:this.destroy.bind(this),setPosition:this.setPosition.bind(this),resetDirection:this.resetDirection.bind(this),computeDirection:this.computeDirection.bind(this),trigger:this.trigger.bind(this),position:this.position,frontPosition:this.frontPosition,ui:this.ui,identifier:this.identifier,id:this.id,options:this.options},this.instance}L.prototype=new r,L.constructor=L,L.id=0,L.prototype.buildEl=function(K){return this.ui={},this.options.dataOnly||(this.ui.el=document.createElement("div"),this.ui.back=document.createElement("div"),this.ui.front=document.createElement("div"),this.ui.el.className="nipple collection_"+this.collection.id,this.ui.back.className="back",this.ui.front.className="front",this.ui.el.setAttribute("id","nipple_"+this.collection.id+"_"+this.id),this.ui.el.appendChild(this.ui.back),this.ui.el.appendChild(this.ui.front)),this},L.prototype.stylize=function(){if(this.options.dataOnly)return this;var K=this.options.fadeTime+"ms",b=function(){var K=U("borderRadius");for(var b in K)K.hasOwnProperty(b)&&(K[b]="50%");return K}(),e=t("transition","opacity",K),z={};return z.el={position:"absolute",opacity:this.options.restOpacity,display:"block",zIndex:999},z.back={position:"absolute",display:"block",width:this.options.size+"px",height:this.options.size+"px",marginLeft:-this.options.size/2+"px",marginTop:-this.options.size/2+"px",background:this.options.color,opacity:".5"},z.front={width:this.options.size/2+"px",height:this.options.size/2+"px",position:"absolute",display:"block",marginLeft:-this.options.size/4+"px",marginTop:-this.options.size/4+"px",background:this.options.color,opacity:".5",transform:"translate(0px, 0px)"},B(z.el,e),"circle"===this.options.shape&&B(z.back,b),B(z.front,b),this.applyStyles(z),this},L.prototype.applyStyles=function(K){for(var b in this.ui)if(this.ui.hasOwnProperty(b))for(var e in K[b])this.ui[b].style[e]=K[b][e];return this},L.prototype.addToDom=function(){return this.options.dataOnly||document.body.contains(this.ui.el)||this.options.zone.appendChild(this.ui.el),this},L.prototype.removeFromDom=function(){return this.options.dataOnly||!document.body.contains(this.ui.el)||this.options.zone.removeChild(this.ui.el),this},L.prototype.destroy=function(){clearTimeout(this.removeTimeout),clearTimeout(this.showTimeout),clearTimeout(this.restTimeout),this.trigger("destroyed",this.instance),this.removeFromDom(),this.off()},L.prototype.show=function(K){var b=this;return b.options.dataOnly||(clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.addToDom(),b.restCallback(),setTimeout((function(){b.ui.el.style.opacity=1}),0),b.showTimeout=setTimeout((function(){b.trigger("shown",b.instance),"function"==typeof K&&K.call(this)}),b.options.fadeTime)),b},L.prototype.hide=function(K){var b=this;if(b.options.dataOnly)return b;if(b.ui.el.style.opacity=b.options.restOpacity,clearTimeout(b.removeTimeout),clearTimeout(b.showTimeout),clearTimeout(b.restTimeout),b.removeTimeout=setTimeout((function(){var e="dynamic"===b.options.mode?"none":"block";b.ui.el.style.display=e,"function"==typeof K&&K.call(b),b.trigger("hidden",b.instance)}),b.options.fadeTime),b.options.restJoystick){var e=b.options.restJoystick,z={};z.x=!0===e||!1!==e.x?0:b.instance.frontPosition.x,z.y=!0===e||!1!==e.y?0:b.instance.frontPosition.y,b.setPosition(K,z)}return b},L.prototype.setPosition=function(K,b){var e=this;e.frontPosition={x:b.x,y:b.y};var z=e.options.fadeTime+"ms",k={};k.front=t("transition",["transform"],z);var j={front:{}};j.front={transform:"translate("+e.frontPosition.x+"px,"+e.frontPosition.y+"px)"},e.applyStyles(k),e.applyStyles(j),e.restTimeout=setTimeout((function(){"function"==typeof K&&K.call(e),e.restCallback()}),e.options.fadeTime)},L.prototype.restCallback=function(){var K=this,b={};b.front=t("transition","none",""),K.applyStyles(b),K.trigger("rested",K.instance)},L.prototype.resetDirection=function(){this.direction={x:!1,y:!1,angle:!1}},L.prototype.computeDirection=function(K){var b,e,z,k=K.angle.radian,j=Math.PI/4,T=Math.PI/2;if(k>j&&k<3*j&&!K.lockX?b="up":k>-j&&k<=j&&!K.lockY?b="left":k>3*-j&&k<=-j&&!K.lockX?b="down":K.lockY||(b="right"),K.lockY||(e=k>-T&&k<T?"left":"right"),K.lockX||(z=k>0?"up":"down"),K.force>this.options.threshold){var F,l={};for(F in this.direction)this.direction.hasOwnProperty(F)&&(l[F]=this.direction[F]);var Y={};for(F in this.direction={x:e,y:z,angle:b},K.direction=this.direction,l)l[F]===this.direction[F]&&(Y[F]=!0);if(Y.x&&Y.y&&Y.angle)return K;Y.x&&Y.y||this.trigger("plain",K),Y.x||this.trigger("plain:"+e,K),Y.y||this.trigger("plain:"+z,K),Y.angle||this.trigger("dir dir:"+b,K)}else this.resetDirection();return K};const c=L;function v(K,b){var e=this;e.nipples=[],e.idles=[],e.actives=[],e.ids=[],e.pressureIntervals={},e.manager=K,e.id=v.id,v.id+=1,e.defaults={zone:document.body,multitouch:!1,maxNumberOfNipples:10,mode:"dynamic",position:{top:0,left:0},catchDistance:200,size:100,threshold:.1,color:"white",fadeTime:250,dataOnly:!1,restJoystick:!0,restOpacity:.5,lockX:!1,lockY:!1,shape:"circle",dynamicPage:!1,follow:!1},e.config(b),"static"!==e.options.mode&&"semi"!==e.options.mode||(e.options.multitouch=!1),e.options.multitouch||(e.options.maxNumberOfNipples=1);var z=getComputedStyle(e.options.zone.parentElement);return z&&"flex"===z.display&&(e.parentIsFlex=!0),e.updateBox(),e.prepareNipples(),e.gj(),e.begin(),e.nipples}v.prototype=new r,v.constructor=v,v.id=0,v.prototype.prepareNipples=function(){var K=this,b=K.nipples;b.on=K.on.bind(K),b.off=K.off.bind(K),b.options=K.options,b.destroy=K.destroy.bind(K),b.ids=K.ids,b.id=K.id,b.processOnMove=K.processOnMove.bind(K),b.processOnEnd=K.processOnEnd.bind(K),b.get=function(K){if(void 0===K)return b[0];for(var e=0,z=b.length;e<z;e+=1)if(b[e].identifier===K)return b[e];return!1}},v.prototype.gj=function(){var K=this;K.bindEvt(K.options.zone,"start"),K.options.zone.style.touchAction="none",K.options.zone.style.msTouchAction="none"},v.prototype.begin=function(){var K=this,b=K.options;if("static"===b.mode){var e=K.createNipple(b.position,K.manager.getIdentifier());e.add(),K.idles.push(e)}},v.prototype.createNipple=function(K,b){var e=this,z=e.manager.scroll,k={},j=e.options,T=e.parentIsFlex?z.x:z.x+e.box.left,F=e.parentIsFlex?z.y:z.y+e.box.top;if(K.x&&K.y)k={x:K.x-T,y:K.y-F};else if(K.top||K.right||K.bottom||K.left){var l=document.createElement("DIV");l.style.display="hidden",l.style.top=K.top,l.style.right=K.right,l.style.bottom=K.bottom,l.style.left=K.left,l.style.position="absolute",j.zone.appendChild(l);var Y=l.getBoundingClientRect();j.zone.removeChild(l),k=K,K={x:Y.left+z.x,y:Y.top+z.y}}var A=new c(e,{color:j.color,size:j.size,threshold:j.threshold,fadeTime:j.fadeTime,dataOnly:j.dataOnly,restJoystick:j.restJoystick,restOpacity:j.restOpacity,mode:j.mode,identifier:b,position:K,zone:j.zone,frontPosition:{x:0,y:0},shape:j.shape});return j.dataOnly||(X(A.ui.el,k),X(A.ui.front,A.frontPosition)),e.nipples.push(A),e.trigger("added "+A.identifier+":added",A),e.manager.trigger("added "+A.identifier+":added",A),e.bindNipple(A),A},v.prototype.updateBox=function(){this.box=this.options.zone.getBoundingClientRect()},v.prototype.bindNipple=function(K){var b,e=this,z=function(K,z){b=K.type+" "+z.id+":"+K.type,e.trigger(b,z)};K.on("destroyed",e.onDestroyed.bind(e)),K.on("shown hidden rested dir plain",z),K.on("dir:up dir:right dir:down dir:left",z),K.on("plain:up plain:right plain:down plain:left",z)},v.prototype.pressureFn=function(K,b,e){var z=this,k=0;clearInterval(z.pressureIntervals[e]),z.pressureIntervals[e]=setInterval(function(){var e=K.force||K.pressure||K.webkitForce||0;e!==k&&(b.trigger("pressure",e),z.trigger("pressure "+b.identifier+":pressure",e),k=e)}.bind(z),100)},v.prototype.onstart=function(K){var b=this,e=b.options,z=K;return K=Y(K),b.updateBox(),u(K,(function(k){b.actives.length<e.maxNumberOfNipples?b.processOnStart(k):z.type.match(/^touch/)&&(Object.keys(b.manager.ids).forEach((function(e){if(Object.values(z.touches).findIndex((function(K){return K.identifier===e}))<0){var k=[K[0]];k.identifier=e,b.processOnEnd(k)}})),b.actives.length<e.maxNumberOfNipples&&b.processOnStart(k))})),b.manager.bindDocument(),!1},v.prototype.processOnStart=function(K){var b,e=this,k=e.options,j=e.manager.getIdentifier(K),T=K.force||K.pressure||K.webkitForce||0,F={x:K.pageX,y:K.pageY},l=e.getOrCreate(j,F);l.identifier!==j&&e.manager.removeIdentifier(l.identifier),l.identifier=j;var Y=function(b){b.trigger("start",b),e.trigger("start "+b.id+":start",b),b.show(),T>0&&e.pressureFn(K,b,b.identifier),e.processOnMove(K)};if((b=e.idles.indexOf(l))>=0&&e.idles.splice(b,1),e.actives.push(l),e.ids.push(l.identifier),"semi"!==k.mode)Y(l);else{if(!(z(F,l.position)<=k.catchDistance))return l.destroy(),void e.processOnStart(K);Y(l)}return l},v.prototype.getOrCreate=function(K,b){var e,z=this,k=z.options;return/(semi|static)/.test(k.mode)?(e=z.idles[0])?(z.idles.splice(0,1),e):"semi"===k.mode?z.createNipple(b,K):(console.warn("Coudln't find the needed nipple."),!1):e=z.createNipple(b,K)},v.prototype.processOnMove=function(K){var b=this,e=b.options,j=b.manager.getIdentifier(K),T=b.nipples.get(j),F=b.manager.scroll;if(function(K){return isNaN(K.buttons)?0!==K.pressure:0!==K.buttons}(K)){if(!T)return console.error("Found zombie joystick with ID "+j),void b.manager.removeIdentifier(j);if(e.dynamicPage){var l=T.el.getBoundingClientRect();T.position={x:F.x+l.left,y:F.y+l.top}}T.identifier=j;var Y=T.options.size/2,A={x:K.pageX,y:K.pageY};e.lockX&&(A.y=T.position.y),e.lockY&&(A.x=T.position.x);var X,t,U,B,u,m,D,I,x,Q,G=z(A,T.position),i=(X=A,U=(t=T.position).x-X.x,B=t.y-X.y,function(K){return K*(180/Math.PI)}(Math.atan2(B,U))),S=k(i),M=G/Y,r={distance:G,position:A};if("circle"===T.options.shape?(u=Math.min(G,Y),D=T.position,I=u,Q={x:0,y:0},x=k(x=i),Q.x=D.x-I*Math.cos(x),Q.y=D.y-I*Math.sin(x),m=Q):(m=function(K,b,e){return{x:Math.min(Math.max(K.x,b.x-e),b.x+e),y:Math.min(Math.max(K.y,b.y-e),b.y+e)}}(A,T.position,Y),u=z(m,T.position)),e.follow){if(G>Y){var L=A.x-m.x,c=A.y-m.y;T.position.x+=L,T.position.y+=c,T.el.style.top=T.position.y-(b.box.top+F.y)+"px",T.el.style.left=T.position.x-(b.box.left+F.x)+"px",G=z(A,T.position)}}else A=m,G=u;var v=A.x-T.position.x,w=A.y-T.position.y;T.frontPosition={x:v,y:w},e.dataOnly||(T.ui.front.style.transform="translate("+v+"px,"+w+"px)");var h={identifier:T.identifier,position:A,force:M,pressure:K.force||K.pressure||K.webkitForce||0,distance:G,angle:{radian:S,degree:i},vector:{x:v/Y,y:-w/Y},raw:r,instance:T,lockX:e.lockX,lockY:e.lockY};(h=T.computeDirection(h)).angle={radian:k(180-i),degree:180-i},T.trigger("move",h),b.trigger("move "+T.id+":move",h)}else this.processOnEnd(K)},v.prototype.processOnEnd=function(K){var b=this,e=b.options,z=b.manager.getIdentifier(K),k=b.nipples.get(z),j=b.manager.removeIdentifier(k.identifier);k&&(e.dataOnly||k.hide((function(){"dynamic"===e.mode&&(k.trigger("removed",k),b.trigger("removed "+k.id+":removed",k),b.manager.trigger("removed "+k.id+":removed",k),k.destroy())})),clearInterval(b.pressureIntervals[k.identifier]),k.resetDirection(),k.trigger("end",k),b.trigger("end "+k.id+":end",k),b.ids.indexOf(k.identifier)>=0&&b.ids.splice(b.ids.indexOf(k.identifier),1),b.actives.indexOf(k)>=0&&b.actives.splice(b.actives.indexOf(k),1),/(semi|static)/.test(e.mode)?b.idles.push(k):b.nipples.indexOf(k)>=0&&b.nipples.splice(b.nipples.indexOf(k),1),b.manager.unbindDocument(),/(semi|static)/.test(e.mode)&&(b.manager.ids[j.id]=j.identifier))},v.prototype.onDestroyed=function(K,b){var e=this;e.nipples.indexOf(b)>=0&&e.nipples.splice(e.nipples.indexOf(b),1),e.actives.indexOf(b)>=0&&e.actives.splice(e.actives.indexOf(b),1),e.idles.indexOf(b)>=0&&e.idles.splice(e.idles.indexOf(b),1),e.ids.indexOf(b.identifier)>=0&&e.ids.splice(e.ids.indexOf(b.identifier),1),e.manager.removeIdentifier(b.identifier),e.manager.unbindDocument()},v.prototype.destroy=function(){var K=this;for(var b in K.unbindEvt(K.options.zone,"start"),K.nipples.forEach((function(K){K.destroy()})),K.pressureIntervals)K.pressureIntervals.hasOwnProperty(b)&&clearInterval(K.pressureIntervals[b]);K.trigger("destroyed",K.nipples),K.manager.unbindDocument(),K.off()};const w=v;function h(K){var b=this;b.ids={},b.index=0,b.collections=[],b.scroll=A(),b.config(K),b.prepareCollections();var e=function(){var K;b.collections.forEach((function(e){e.forEach((function(e){K=e.el.getBoundingClientRect(),e.position={x:b.scroll.x+K.left,y:b.scroll.y+K.top}}))}))};F(window,"resize",(function(){T(e)}));var z=function(){b.scroll=A()};return F(window,"scroll",(function(){T(z)})),b.collections}h.prototype=new r,h.constructor=h,h.prototype.prepareCollections=function(){var K=this;K.collections.create=K.create.bind(K),K.collections.on=K.on.bind(K),K.collections.off=K.off.bind(K),K.collections.destroy=K.destroy.bind(K),K.collections.get=function(b){var e;return K.collections.every((function(K){return!(e=K.get(b))})),e}},h.prototype.create=function(K){return this.createCollection(K)},h.prototype.createCollection=function(K){var b=this,e=new w(b,K);return b.bindCollection(e),b.collections.push(e),e},h.prototype.bindCollection=function(K){var b,e=this,z=function(K,z){b=K.type+" "+z.id+":"+K.type,e.trigger(b,z)};K.on("destroyed",e.onDestroyed.bind(e)),K.on("shown hidden rested dir plain",z),K.on("dir:up dir:right dir:down dir:left",z),K.on("plain:up plain:right plain:down plain:left",z)},h.prototype.bindDocument=function(){var K=this;K.binded||(K.bindEvt(document,"move").bindEvt(document,"end"),K.binded=!0)},h.prototype.unbindDocument=function(K){var b=this;Object.keys(b.ids).length&&!0!==K||(b.unbindEvt(document,"move").unbindEvt(document,"end"),b.binded=!1)},h.prototype.getIdentifier=function(K){var b;return K?void 0===(b=void 0===K.identifier?K.pointerId:K.identifier)&&(b=this.latest||0):b=this.index,void 0===this.ids[b]&&(this.ids[b]=this.index,this.index+=1),this.latest=b,this.ids[b]},h.prototype.removeIdentifier=function(K){var b={};for(var e in this.ids)if(this.ids[e]===K){b.id=e,b.identifier=this.ids[e],delete this.ids[e];break}return b},h.prototype.onmove=function(K){return this.onAny("move",K),!1},h.prototype.onend=function(K){return this.onAny("end",K),!1},h.prototype.oncancel=function(K){return this.onAny("end",K),!1},h.prototype.onAny=function(K,b){var e,z=this,k="processOn"+K.charAt(0).toUpperCase()+K.slice(1);b=Y(b);var j=function(K,b,e){e.ids.indexOf(b)>=0&&(e[k](K),K._found_=!0)};return u(b,(function(K){e=z.getIdentifier(K),u(z.collections,j.bind(null,K,e)),K._found_||z.removeIdentifier(e)})),!1},h.prototype.destroy=function(){var K=this;K.unbindDocument(!0),K.ids={},K.index=0,K.collections.forEach((function(K){K.destroy()})),K.off()},h.prototype.onDestroyed=function(K,b){var e=this;if(e.collections.indexOf(b)<0)return!1;e.collections.splice(e.collections.indexOf(b),1)};var R=new h;const n={create:function(K){return R.create(K)},factory:R};return b.default})(),K.exports=b()},10824:(K,b,e)=>{"use strict";const{Deflate:z,deflate:k,deflateRaw:j,gzip:T}=e(10827),{Inflate:F,inflate:l,inflateRaw:Y,ungzip:A}=e(10870),X=e(10851);K.exports.Deflate=z,K.exports.deflate=k,K.exports.deflateRaw=j,K.exports.gzip=T,K.exports.Inflate=F,K.exports.inflate=l,K.exports.inflateRaw=Y,K.exports.ungzip=A,K.exports.constants=X},10827:(K,b,e)=>{"use strict";const z=e(10833),k=e(10853),j=e(10860),T=e(10848),F=e(10865),l=Object.prototype.toString,{Z_NO_FLUSH:Y,Z_SYNC_FLUSH:A,Z_FULL_FLUSH:X,Z_FINISH:t,Z_OK:U,Z_STREAM_END:B,Z_DEFAULT_COMPRESSION:u,Z_DEFAULT_STRATEGY:m,Z_DEFLATED:D}=e(10851);function I(K){this.options=k.assign({level:u,method:D,Ja:16384,windowBits:15,memLevel:8,strategy:m},K||{});let b=this.options;b.raw&&b.windowBits>0?b.windowBits=-b.windowBits:b.gzip&&b.windowBits>0&&b.windowBits<16&&(b.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;let e=z.deflateInit2(this.strm,b.level,b.method,b.windowBits,b.memLevel,b.strategy);if(e!==U)throw new Error(T[e]);if(b.header&&z.deflateSetHeader(this.strm,b.header),b.dictionary){let K;if(K="string"===typeof b.dictionary?j.string2buf(b.dictionary):"[object ArrayBuffer]"===l.call(b.dictionary)?new Uint8Array(b.dictionary):b.dictionary,e=z.deflateSetDictionary(this.strm,K),e!==U)throw new Error(T[e]);this._dict_set=!0}}function x(K,b){const e=new I(b);if(e.push(K,!0),e.err)throw e.msg||T[e.err];return e.result}I.prototype.push=function(K,b){const e=this.strm,k=this.options.Ja;let T,F;if(this.ended)return!1;for(F=b===~~b?b:!0===b?t:Y,"string"===typeof K?e.input=j.string2buf(K):"[object ArrayBuffer]"===l.call(K)?e.input=new Uint8Array(K):e.input=K,e.next_in=0,e.avail_in=e.input.length;;)if(0===e.avail_out&&(e.output=new Uint8Array(k),e.next_out=0,e.avail_out=k),(F===A||F===X)&&e.avail_out<=6)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else{if(T=z.deflate(e,F),T===B)return e.next_out>0&&this.onData(e.output.subarray(0,e.next_out)),T=z.deflateEnd(this.strm),this.onEnd(T),this.ended=!0,T===U;if(0!==e.avail_out){if(F>0&&e.next_out>0)this.onData(e.output.subarray(0,e.next_out)),e.avail_out=0;else if(0===e.avail_in)break}else this.onData(e.output)}return!0},I.prototype.onData=function(K){this.chunks.push(K)},I.prototype.onEnd=function(K){K===U&&(this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.msg=this.strm.msg},K.exports.Deflate=I,K.exports.deflate=x,K.exports.deflateRaw=function(K,b){return(b=b||{}).raw=!0,x(K,b)},K.exports.gzip=function(K,b){return(b=b||{}).gzip=!0,x(K,b)},K.exports.constants=e(10851)},10870:(K,b,e)=>{"use strict";const z=e(10878),k=e(10853),j=e(10860),T=e(10848),F=e(10865),l=e(10897),Y=Object.prototype.toString,{Z_NO_FLUSH:A,Z_FINISH:X,Z_OK:t,Z_STREAM_END:U,Z_NEED_DICT:B,Z_STREAM_ERROR:u,Z_DATA_ERROR:m,Z_MEM_ERROR:D}=e(10851);function I(K){this.options=k.assign({Ja:65536,windowBits:15,to:""},K||{});const b=this.options;b.raw&&b.windowBits>=0&&b.windowBits<16&&(b.windowBits=-b.windowBits,0===b.windowBits&&(b.windowBits=-15)),!(b.windowBits>=0&&b.windowBits<16)||K&&K.windowBits||(b.windowBits+=32),b.windowBits>15&&b.windowBits<48&&0===(15&b.windowBits)&&(b.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new F,this.strm.avail_out=0;let e=z.inflateInit2(this.strm,b.windowBits);if(e!==t)throw new Error(T[e]);if(this.header=new l,z.inflateGetHeader(this.strm,this.header),b.dictionary&&("string"===typeof b.dictionary?b.dictionary=j.string2buf(b.dictionary):"[object ArrayBuffer]"===Y.call(b.dictionary)&&(b.dictionary=new Uint8Array(b.dictionary)),b.raw&&(e=z.inflateSetDictionary(this.strm,b.dictionary),e!==t)))throw new Error(T[e])}function x(K,b){const e=new I(b);if(e.push(K),e.err)throw e.msg||T[e.err];return e.result}I.prototype.push=function(K,b){const e=this.strm,k=this.options.Ja,T=this.options.dictionary;let F,l,I;if(this.ended)return!1;for(l=b===~~b?b:!0===b?X:A,"[object ArrayBuffer]"===Y.call(K)?e.input=new Uint8Array(K):e.input=K,e.next_in=0,e.avail_in=e.input.length;;){for(0===e.avail_out&&(e.output=new Uint8Array(k),e.next_out=0,e.avail_out=k),F=z.inflate(e,l),F===B&&T&&(F=z.inflateSetDictionary(e,T),F===t?F=z.inflate(e,l):F===m&&(F=B));e.avail_in>0&&F===U&&e.state.wrap>0&&0!==K[e.next_in];)z.inflateReset(e),F=z.inflate(e,l);switch(F){case u:case m:case B:case D:return this.onEnd(F),this.ended=!0,!1}if(I=e.avail_out,e.next_out&&(0===e.avail_out||F===U))if("string"===this.options.to){let K=j.utf8border(e.output,e.next_out),b=e.next_out-K,z=j.buf2string(e.output,K);e.next_out=b,e.avail_out=k-b,b&&e.output.set(e.output.subarray(K,K+b),0),this.onData(z)}else this.onData(e.output.length===e.next_out?e.output:e.output.subarray(0,e.next_out));if(F!==t||0!==I){if(F===U)return F=z.inflateEnd(this.strm),this.onEnd(F),this.ended=!0,!0;if(0===e.avail_in)break}}return!0},I.prototype.onData=function(K){this.chunks.push(K)},I.prototype.onEnd=function(K){K===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=k.flattenChunks(this.chunks)),this.chunks=[],this.err=K,this.msg=this.strm.msg},K.exports.Inflate=I,K.exports.inflate=x,K.exports.inflateRaw=function(K,b){return(b=b||{}).raw=!0,x(K,b)},K.exports.ungzip=x,K.exports.constants=e(10851)},10853:K=>{"use strict";const b=(K,b)=>Object.prototype.hasOwnProperty.call(K,b);K.exports.assign=function(K){const e=Array.prototype.slice.call(arguments,1);for(;e.length;){const z=e.shift();if(z){if("object"!==typeof z)throw new TypeError(z+"must be non-object");for(const e in z)b(z,e)&&(K[e]=z[e])}}return K},K.exports.flattenChunks=K=>{let b=0;for(let z=0,k=K.length;z<k;z++)b+=K[z].length;const e=new Uint8Array(b);for(let z=0,k=0,j=K.length;z<j;z++){let b=K[z];e.set(b,k),k+=b.length}return e}},10860:K=>{"use strict";let b=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(z){b=!1}const e=new Uint8Array(256);for(let k=0;k<256;k++)e[k]=k>=252?6:k>=248?5:k>=240?4:k>=224?3:k>=192?2:1;e[254]=e[254]=1,K.exports.string2buf=K=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(K);let b,e,z,k,j,T=K.length,F=0;for(k=0;k<T;k++)e=K.charCodeAt(k),55296===(64512&e)&&k+1<T&&(z=K.charCodeAt(k+1),56320===(64512&z)&&(e=65536+(e-55296<<10)+(z-56320),k++)),F+=e<128?1:e<2048?2:e<65536?3:4;for(b=new Uint8Array(F),j=0,k=0;j<F;k++)e=K.charCodeAt(k),55296===(64512&e)&&k+1<T&&(z=K.charCodeAt(k+1),56320===(64512&z)&&(e=65536+(e-55296<<10)+(z-56320),k++)),e<128?b[j++]=e:e<2048?(b[j++]=192|e>>>6,b[j++]=128|63&e):e<65536?(b[j++]=224|e>>>12,b[j++]=128|e>>>6&63,b[j++]=128|63&e):(b[j++]=240|e>>>18,b[j++]=128|e>>>12&63,b[j++]=128|e>>>6&63,b[j++]=128|63&e);return b};K.exports.buf2string=(K,z)=>{const k=z||K.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(K.subarray(0,z));let j,T;const F=new Array(2*k);for(T=0,j=0;j<k;){let b=K[j++];if(b<128){F[T++]=b;continue}let z=e[b];if(z>4)F[T++]=65533,j+=z-1;else{for(b&=2===z?31:3===z?15:7;z>1&&j<k;)b=b<<6|63&K[j++],z--;z>1?F[T++]=65533:b<65536?F[T++]=b:(b-=65536,F[T++]=55296|b>>10&1023,F[T++]=56320|1023&b)}}return((K,e)=>{if(e<65534&&K.subarray&&b)return String.fromCharCode.apply(null,K.length===e?K:K.subarray(0,e));let z="";for(let b=0;b<e;b++)z+=String.fromCharCode(K[b]);return z})(F,T)},K.exports.utf8border=(K,b)=>{(b=b||K.length)>K.length&&(b=K.length);let z=b-1;for(;z>=0&&128===(192&K[z]);)z--;return z<0||0===z?b:z+e[K[z]]>b?z:b}},10840:K=>{"use strict";K.exports=(K,b,e,z)=>{let k=65535&K,j=K>>>16&65535,T=0;for(;0!==e;){T=e>2e3?2e3:e,e-=T;do{k=k+b[z++]|0,j=j+k|0}while(--T);k%=65521,j%=65521}return k|j<<16}},10851:K=>{"use strict";K.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},10846:K=>{"use strict";const b=new Uint32Array((()=>{let K,b=[];for(var e=0;e<256;e++){K=e;for(var z=0;z<8;z++)K=1&K?3988292384^K>>>1:K>>>1;b[e]=K}return b})());K.exports=(K,e,z,k)=>{const j=b,T=k+z;K^=-1;for(let b=k;b<T;b++)K=K>>>8^j[255&(K^e[b])];return~K}},10833:(K,b,e)=>{"use strict";const{_tr_init:z,_tr_stored_block:k,_tr_flush_block:j,_tr_tally:T,_tr_align:F}=e(10837),l=e(10840),Y=e(10846),A=e(10848),{Z_NO_FLUSH:X,Z_PARTIAL_FLUSH:t,Z_FULL_FLUSH:U,Z_FINISH:B,Z_BLOCK:u,Z_OK:m,Z_STREAM_END:D,Z_STREAM_ERROR:I,Z_DATA_ERROR:x,Z_BUF_ERROR:Q,Z_DEFAULT_COMPRESSION:G,Z_FILTERED:i,Z_HUFFMAN_ONLY:S,Z_RLE:M,Z_FIXED:r,Z_DEFAULT_STRATEGY:L,Z_UNKNOWN:c,Z_DEFLATED:v}=e(10851),w=258,h=262,R=103,n=113,P=666,d=(K,b)=>(K.msg=A[b],b),p=K=>(K<<1)-(K>4?9:0),a=K=>{let b=K.length;for(;--b>=0;)K[b]=0};let O=(K,b,e)=>(b<<K.hash_shift^e)&K.hash_mask;const g=K=>{const b=K.state;let e=b.pending;e>K.avail_out&&(e=K.avail_out),0!==e&&(K.output.set(b.pending_buf.subarray(b.pending_out,b.pending_out+e),K.next_out),K.next_out+=e,b.pending_out+=e,K.total_out+=e,K.avail_out-=e,b.pending-=e,0===b.pending&&(b.pending_out=0))},N=(K,b)=>{j(K,K.block_start>=0?K.block_start:-1,K.strstart-K.block_start,b),K.block_start=K.strstart,g(K.strm)},Z=(K,b)=>{K.pending_buf[K.pending++]=b},y=(K,b)=>{K.pending_buf[K.pending++]=b>>>8&255,K.pending_buf[K.pending++]=255&b},s=(K,b,e,z)=>{let k=K.avail_in;return k>z&&(k=z),0===k?0:(K.avail_in-=k,b.set(K.input.subarray(K.next_in,K.next_in+k),e),1===K.state.wrap?K.adler=l(K.adler,b,k,e):2===K.state.wrap&&(K.adler=Y(K.adler,b,k,e)),K.next_in+=k,K.total_in+=k,k)},E=(K,b)=>{let e,z,k=K.max_chain_length,j=K.strstart,T=K.prev_length,F=K.nice_match;const l=K.strstart>K.w_size-h?K.strstart-(K.w_size-h):0,Y=K.window,A=K.w_mask,X=K.prev,t=K.strstart+w;let U=Y[j+T-1],B=Y[j+T];K.prev_length>=K.good_match&&(k>>=2),F>K.lookahead&&(F=K.lookahead);do{if(e=b,Y[e+T]===B&&Y[e+T-1]===U&&Y[e]===Y[j]&&Y[++e]===Y[j+1]){j+=2,e++;do{}while(Y[++j]===Y[++e]&&Y[++j]===Y[++e]&&Y[++j]===Y[++e]&&Y[++j]===Y[++e]&&Y[++j]===Y[++e]&&Y[++j]===Y[++e]&&Y[++j]===Y[++e]&&Y[++j]===Y[++e]&&j<t);if(z=w-(t-j),j=t-w,z>T){if(K.match_start=b,T=z,z>=F)break;U=Y[j+T-1],B=Y[j+T]}}}while((b=X[b&A])>l&&0!==--k);return T<=K.lookahead?T:K.lookahead},o=K=>{const b=K.w_size;let e,z,k,j,T;do{if(j=K.window_size-K.lookahead-K.strstart,K.strstart>=b+(b-h)){K.window.set(K.window.subarray(b,b+b),0),K.match_start-=b,K.strstart-=b,K.block_start-=b,z=K.hash_size,e=z;do{k=K.head[--e],K.head[e]=k>=b?k-b:0}while(--z);z=b,e=z;do{k=K.prev[--e],K.prev[e]=k>=b?k-b:0}while(--z);j+=b}if(0===K.strm.avail_in)break;if(z=s(K.strm,K.window,K.strstart+K.lookahead,j),K.lookahead+=z,K.lookahead+K.insert>=3)for(T=K.strstart-K.insert,K.ins_h=K.window[T],K.ins_h=O(K,K.ins_h,K.window[T+1]);K.insert&&(K.ins_h=O(K,K.ins_h,K.window[T+3-1]),K.prev[T&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=T,T++,K.insert--,!(K.lookahead+K.insert<3)););}while(K.lookahead<h&&0!==K.strm.avail_in)},C=(K,b)=>{let e,z;for(;;){if(K.lookahead<h){if(o(K),K.lookahead<h&&b===X)return 1;if(0===K.lookahead)break}if(e=0,K.lookahead>=3&&(K.ins_h=O(K,K.ins_h,K.window[K.strstart+3-1]),e=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),0!==e&&K.strstart-e<=K.w_size-h&&(K.match_length=E(K,e)),K.match_length>=3)if(z=T(K,K.strstart-K.match_start,K.match_length-3),K.lookahead-=K.match_length,K.match_length<=K.max_lazy_match&&K.lookahead>=3){K.match_length--;do{K.strstart++,K.ins_h=O(K,K.ins_h,K.window[K.strstart+3-1]),e=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart}while(0!==--K.match_length);K.strstart++}else K.strstart+=K.match_length,K.match_length=0,K.ins_h=K.window[K.strstart],K.ins_h=O(K,K.ins_h,K.window[K.strstart+1]);else z=T(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++;if(z&&(N(K,!1),0===K.strm.avail_out))return 1}return K.insert=K.strstart<2?K.strstart:2,b===B?(N(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(N(K,!1),0===K.strm.avail_out)?1:2},H=(K,b)=>{let e,z,k;for(;;){if(K.lookahead<h){if(o(K),K.lookahead<h&&b===X)return 1;if(0===K.lookahead)break}if(e=0,K.lookahead>=3&&(K.ins_h=O(K,K.ins_h,K.window[K.strstart+3-1]),e=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart),K.prev_length=K.match_length,K.prev_match=K.match_start,K.match_length=2,0!==e&&K.prev_length<K.max_lazy_match&&K.strstart-e<=K.w_size-h&&(K.match_length=E(K,e),K.match_length<=5&&(K.strategy===i||3===K.match_length&&K.strstart-K.match_start>4096)&&(K.match_length=2)),K.prev_length>=3&&K.match_length<=K.prev_length){k=K.strstart+K.lookahead-3,z=T(K,K.strstart-1-K.prev_match,K.prev_length-3),K.lookahead-=K.prev_length-1,K.prev_length-=2;do{++K.strstart<=k&&(K.ins_h=O(K,K.ins_h,K.window[K.strstart+3-1]),e=K.prev[K.strstart&K.w_mask]=K.head[K.ins_h],K.head[K.ins_h]=K.strstart)}while(0!==--K.prev_length);if(K.match_available=0,K.match_length=2,K.strstart++,z&&(N(K,!1),0===K.strm.avail_out))return 1}else if(K.match_available){if(z=T(K,0,K.window[K.strstart-1]),z&&N(K,!1),K.strstart++,K.lookahead--,0===K.strm.avail_out)return 1}else K.match_available=1,K.strstart++,K.lookahead--}return K.match_available&&(z=T(K,0,K.window[K.strstart-1]),K.match_available=0),K.insert=K.strstart<2?K.strstart:2,b===B?(N(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(N(K,!1),0===K.strm.avail_out)?1:2};function W(K,b,e,z,k){this.good_length=K,this.max_lazy=b,this.nice_length=e,this.max_chain=z,this.func=k}const f=[new W(0,0,0,0,((K,b)=>{let e=65535;for(e>K.pending_buf_size-5&&(e=K.pending_buf_size-5);;){if(K.lookahead<=1){if(o(K),0===K.lookahead&&b===X)return 1;if(0===K.lookahead)break}K.strstart+=K.lookahead,K.lookahead=0;const z=K.block_start+e;if((0===K.strstart||K.strstart>=z)&&(K.lookahead=K.strstart-z,K.strstart=z,N(K,!1),0===K.strm.avail_out))return 1;if(K.strstart-K.block_start>=K.w_size-h&&(N(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,b===B?(N(K,!0),0===K.strm.avail_out?3:4):(K.strstart>K.block_start&&(N(K,!1),K.strm.avail_out),1)})),new W(4,4,8,4,C),new W(4,5,16,8,C),new W(4,6,32,32,C),new W(4,4,16,16,H),new W(8,16,32,32,H),new W(8,16,128,128,H),new W(8,32,128,256,H),new W(32,128,258,1024,H),new W(32,258,258,4096,H)];function V(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=v,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),a(this.dyn_ltree),a(this.dyn_dtree),a(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),a(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),a(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const q=K=>{if(!K||!K.state)return d(K,I);K.total_in=K.total_out=0,K.data_type=c;const b=K.state;return b.pending=0,b.pending_out=0,b.wrap<0&&(b.wrap=-b.wrap),b.status=b.wrap?42:n,K.adler=2===b.wrap?0:1,b.last_flush=X,z(b),m},J=K=>{const b=q(K);var e;return b===m&&((e=K.state).window_size=2*e.w_size,a(e.head),e.max_lazy_match=f[e.level].max_lazy,e.good_match=f[e.level].good_length,e.nice_match=f[e.level].nice_length,e.max_chain_length=f[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),b},KK=(K,b,e,z,k,j)=>{if(!K)return I;let T=1;if(b===G&&(b=6),z<0?(T=0,z=-z):z>15&&(T=2,z-=16),k<1||k>9||e!==v||z<8||z>15||b<0||b>9||j<0||j>r)return d(K,I);8===z&&(z=9);const F=new V;return K.state=F,F.strm=K,F.wrap=T,F.gzhead=null,F.w_bits=z,F.w_size=1<<F.w_bits,F.w_mask=F.w_size-1,F.hash_bits=k+7,F.hash_size=1<<F.hash_bits,F.hash_mask=F.hash_size-1,F.hash_shift=~~((F.hash_bits+3-1)/3),F.window=new Uint8Array(2*F.w_size),F.head=new Uint16Array(F.hash_size),F.prev=new Uint16Array(F.w_size),F.lit_bufsize=1<<k+6,F.pending_buf_size=4*F.lit_bufsize,F.pending_buf=new Uint8Array(F.pending_buf_size),F.d_buf=1*F.lit_bufsize,F.l_buf=3*F.lit_bufsize,F.level=b,F.strategy=j,F.method=e,J(K)};K.exports.deflateInit=(K,b)=>KK(K,b,v,15,8,L),K.exports.deflateInit2=KK,K.exports.deflateReset=J,K.exports.deflateResetKeep=q,K.exports.deflateSetHeader=(K,b)=>K&&K.state?2!==K.state.wrap?I:(K.state.gzhead=b,m):I,K.exports.deflate=(K,b)=>{let e,z;if(!K||!K.state||b>u||b<0)return K?d(K,I):I;const j=K.state;if(!K.output||!K.input&&0!==K.avail_in||j.status===P&&b!==B)return d(K,0===K.avail_out?Q:I);j.strm=K;const l=j.last_flush;if(j.last_flush=b,42===j.status)if(2===j.wrap)K.adler=0,Z(j,31),Z(j,139),Z(j,8),j.gzhead?(Z(j,(j.gzhead.text?1:0)+(j.gzhead.hcrc?2:0)+(j.gzhead.extra?4:0)+(j.gzhead.name?8:0)+(j.gzhead.comment?16:0)),Z(j,255&j.gzhead.time),Z(j,j.gzhead.time>>8&255),Z(j,j.gzhead.time>>16&255),Z(j,j.gzhead.time>>24&255),Z(j,9===j.level?2:j.strategy>=S||j.level<2?4:0),Z(j,255&j.gzhead.os),j.gzhead.extra&&j.gzhead.extra.length&&(Z(j,255&j.gzhead.extra.length),Z(j,j.gzhead.extra.length>>8&255)),j.gzhead.hcrc&&(K.adler=Y(K.adler,j.pending_buf,j.pending,0)),j.gzindex=0,j.status=69):(Z(j,0),Z(j,0),Z(j,0),Z(j,0),Z(j,0),Z(j,9===j.level?2:j.strategy>=S||j.level<2?4:0),Z(j,3),j.status=n);else{let b=v+(j.w_bits-8<<4)<<8,e=-1;e=j.strategy>=S||j.level<2?0:j.level<6?1:6===j.level?2:3,b|=e<<6,0!==j.strstart&&(b|=32),b+=31-b%31,j.status=n,y(j,b),0!==j.strstart&&(y(j,K.adler>>>16),y(j,65535&K.adler)),K.adler=1}if(69===j.status)if(j.gzhead.extra){for(e=j.pending;j.gzindex<(65535&j.gzhead.extra.length)&&(j.pending!==j.pending_buf_size||(j.gzhead.hcrc&&j.pending>e&&(K.adler=Y(K.adler,j.pending_buf,j.pending-e,e)),g(K),e=j.pending,j.pending!==j.pending_buf_size));)Z(j,255&j.gzhead.extra[j.gzindex]),j.gzindex++;j.gzhead.hcrc&&j.pending>e&&(K.adler=Y(K.adler,j.pending_buf,j.pending-e,e)),j.gzindex===j.gzhead.extra.length&&(j.gzindex=0,j.status=73)}else j.status=73;if(73===j.status)if(j.gzhead.name){e=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>e&&(K.adler=Y(K.adler,j.pending_buf,j.pending-e,e)),g(K),e=j.pending,j.pending===j.pending_buf_size)){z=1;break}z=j.gzindex<j.gzhead.name.length?255&j.gzhead.name.charCodeAt(j.gzindex++):0,Z(j,z)}while(0!==z);j.gzhead.hcrc&&j.pending>e&&(K.adler=Y(K.adler,j.pending_buf,j.pending-e,e)),0===z&&(j.gzindex=0,j.status=91)}else j.status=91;if(91===j.status)if(j.gzhead.comment){e=j.pending;do{if(j.pending===j.pending_buf_size&&(j.gzhead.hcrc&&j.pending>e&&(K.adler=Y(K.adler,j.pending_buf,j.pending-e,e)),g(K),e=j.pending,j.pending===j.pending_buf_size)){z=1;break}z=j.gzindex<j.gzhead.comment.length?255&j.gzhead.comment.charCodeAt(j.gzindex++):0,Z(j,z)}while(0!==z);j.gzhead.hcrc&&j.pending>e&&(K.adler=Y(K.adler,j.pending_buf,j.pending-e,e)),0===z&&(j.status=R)}else j.status=R;if(j.status===R&&(j.gzhead.hcrc?(j.pending+2>j.pending_buf_size&&g(K),j.pending+2<=j.pending_buf_size&&(Z(j,255&K.adler),Z(j,K.adler>>8&255),K.adler=0,j.status=n)):j.status=n),0!==j.pending){if(g(K),0===K.avail_out)return j.last_flush=-1,m}else if(0===K.avail_in&&p(b)<=p(l)&&b!==B)return d(K,Q);if(j.status===P&&0!==K.avail_in)return d(K,Q);if(0!==K.avail_in||0!==j.lookahead||b!==X&&j.status!==P){let e=j.strategy===S?((K,b)=>{let e;for(;;){if(0===K.lookahead&&(o(K),0===K.lookahead)){if(b===X)return 1;break}if(K.match_length=0,e=T(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++,e&&(N(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,b===B?(N(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(N(K,!1),0===K.strm.avail_out)?1:2})(j,b):j.strategy===M?((K,b)=>{let e,z,k,j;const F=K.window;for(;;){if(K.lookahead<=w){if(o(K),K.lookahead<=w&&b===X)return 1;if(0===K.lookahead)break}if(K.match_length=0,K.lookahead>=3&&K.strstart>0&&(k=K.strstart-1,z=F[k],z===F[++k]&&z===F[++k]&&z===F[++k])){j=K.strstart+w;do{}while(z===F[++k]&&z===F[++k]&&z===F[++k]&&z===F[++k]&&z===F[++k]&&z===F[++k]&&z===F[++k]&&z===F[++k]&&k<j);K.match_length=w-(j-k),K.match_length>K.lookahead&&(K.match_length=K.lookahead)}if(K.match_length>=3?(e=T(K,1,K.match_length-3),K.lookahead-=K.match_length,K.strstart+=K.match_length,K.match_length=0):(e=T(K,0,K.window[K.strstart]),K.lookahead--,K.strstart++),e&&(N(K,!1),0===K.strm.avail_out))return 1}return K.insert=0,b===B?(N(K,!0),0===K.strm.avail_out?3:4):K.last_lit&&(N(K,!1),0===K.strm.avail_out)?1:2})(j,b):f[j.level].func(j,b);if(3!==e&&4!==e||(j.status=P),1===e||3===e)return 0===K.avail_out&&(j.last_flush=-1),m;if(2===e&&(b===t?F(j):b!==u&&(k(j,0,0,!1),b===U&&(a(j.head),0===j.lookahead&&(j.strstart=0,j.block_start=0,j.insert=0))),g(K),0===K.avail_out))return j.last_flush=-1,m}return b!==B?m:j.wrap<=0?D:(2===j.wrap?(Z(j,255&K.adler),Z(j,K.adler>>8&255),Z(j,K.adler>>16&255),Z(j,K.adler>>24&255),Z(j,255&K.total_in),Z(j,K.total_in>>8&255),Z(j,K.total_in>>16&255),Z(j,K.total_in>>24&255)):(y(j,K.adler>>>16),y(j,65535&K.adler)),g(K),j.wrap>0&&(j.wrap=-j.wrap),0!==j.pending?m:D)},K.exports.deflateEnd=K=>{if(!K||!K.state)return I;const b=K.state.status;return 42!==b&&69!==b&&73!==b&&91!==b&&b!==R&&b!==n&&b!==P?d(K,I):(K.state=null,b===n?d(K,x):m)},K.exports.deflateSetDictionary=(K,b)=>{let e=b.length;if(!K||!K.state)return I;const z=K.state,k=z.wrap;if(2===k||1===k&&42!==z.status||z.lookahead)return I;if(1===k&&(K.adler=l(K.adler,b,e,0)),z.wrap=0,e>=z.w_size){0===k&&(a(z.head),z.strstart=0,z.block_start=0,z.insert=0);let K=new Uint8Array(z.w_size);K.set(b.subarray(e-z.w_size,e),0),b=K,e=z.w_size}const j=K.avail_in,T=K.next_in,F=K.input;for(K.avail_in=e,K.next_in=0,K.input=b,o(z);z.lookahead>=3;){let K=z.strstart,b=z.lookahead-2;do{z.ins_h=O(z,z.ins_h,z.window[K+3-1]),z.prev[K&z.w_mask]=z.head[z.ins_h],z.head[z.ins_h]=K,K++}while(--b);z.strstart=K,z.lookahead=2,o(z)}return z.strstart+=z.lookahead,z.block_start=z.strstart,z.insert=z.lookahead,z.lookahead=0,z.match_length=z.prev_length=2,z.match_available=0,K.next_in=T,K.input=F,K.avail_in=j,z.wrap=k,m},K.exports.deflateInfo="pako deflate (from Nodeca project)"},10897:K=>{"use strict";K.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},10883:K=>{"use strict";K.exports=function(K,b){let e,z,k,j,T,F,l,Y,A,X,t,U,B,u,m,D,I,x,Q,G,i,S,M,r;const L=K.state;e=K.next_in,M=K.input,z=e+(K.avail_in-5),k=K.next_out,r=K.output,j=k-(b-K.avail_out),T=k+(K.avail_out-257),F=L.dmax,l=L.wsize,Y=L.whave,A=L.wnext,X=L.window,t=L.hold,U=L.bits,B=L.lencode,u=L.distcode,m=(1<<L.lenbits)-1,D=(1<<L.distbits)-1;K:do{U<15&&(t+=M[e++]<<U,U+=8,t+=M[e++]<<U,U+=8),I=B[t&m];b:for(;;){if(x=I>>>24,t>>>=x,U-=x,x=I>>>16&255,0===x)r[k++]=65535&I;else{if(!(16&x)){if(0===(64&x)){I=B[(65535&I)+(t&(1<<x)-1)];continue b}if(32&x){L.mode=12;break K}K.msg="invalid literal/length code",L.mode=30;break K}Q=65535&I,x&=15,x&&(U<x&&(t+=M[e++]<<U,U+=8),Q+=t&(1<<x)-1,t>>>=x,U-=x),U<15&&(t+=M[e++]<<U,U+=8,t+=M[e++]<<U,U+=8),I=u[t&D];e:for(;;){if(x=I>>>24,t>>>=x,U-=x,x=I>>>16&255,!(16&x)){if(0===(64&x)){I=u[(65535&I)+(t&(1<<x)-1)];continue e}K.msg="invalid distance code",L.mode=30;break K}if(G=65535&I,x&=15,U<x&&(t+=M[e++]<<U,U+=8,U<x&&(t+=M[e++]<<U,U+=8)),G+=t&(1<<x)-1,G>F){K.msg="invalid distance too far back",L.mode=30;break K}if(t>>>=x,U-=x,x=k-j,G>x){if(x=G-x,x>Y&&L.sane){K.msg="invalid distance too far back",L.mode=30;break K}if(i=0,S=X,0===A){if(i+=l-x,x<Q){Q-=x;do{r[k++]=X[i++]}while(--x);i=k-G,S=r}}else if(A<x){if(i+=l+A-x,x-=A,x<Q){Q-=x;do{r[k++]=X[i++]}while(--x);if(i=0,A<Q){x=A,Q-=x;do{r[k++]=X[i++]}while(--x);i=k-G,S=r}}}else if(i+=A-x,x<Q){Q-=x;do{r[k++]=X[i++]}while(--x);i=k-G,S=r}for(;Q>2;)r[k++]=S[i++],r[k++]=S[i++],r[k++]=S[i++],Q-=3;Q&&(r[k++]=S[i++],Q>1&&(r[k++]=S[i++]))}else{i=k-G;do{r[k++]=r[i++],r[k++]=r[i++],r[k++]=r[i++],Q-=3}while(Q>2);Q&&(r[k++]=r[i++],Q>1&&(r[k++]=r[i++]))}break}}break}}while(e<z&&k<T);Q=U>>3,e-=Q,U-=Q<<3,t&=(1<<U)-1,K.next_in=e,K.next_out=k,K.avail_in=e<z?z-e+5:5-(e-z),K.avail_out=k<T?T-k+257:257-(k-T),L.hold=t,L.bits=U}},10878:(K,b,e)=>{"use strict";const z=e(10840),k=e(10846),j=e(10883),T=e(10891),{Z_FINISH:F,Z_BLOCK:l,Z_TREES:Y,Z_OK:A,Z_STREAM_END:X,Z_NEED_DICT:t,Z_STREAM_ERROR:U,Z_DATA_ERROR:B,Z_MEM_ERROR:u,Z_BUF_ERROR:m,Z_DEFLATED:D}=e(10851),I=12,x=30,Q=K=>(K>>>24&255)+(K>>>8&65280)+((65280&K)<<8)+((255&K)<<24);function G(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const i=K=>{if(!K||!K.state)return U;const b=K.state;return K.total_in=K.total_out=b.total=0,K.msg="",b.wrap&&(K.adler=1&b.wrap),b.mode=1,b.last=0,b.havedict=0,b.dmax=32768,b.head=null,b.hold=0,b.bits=0,b.lencode=b.lendyn=new Int32Array(852),b.distcode=b.distdyn=new Int32Array(592),b.sane=1,b.back=-1,A},S=K=>{if(!K||!K.state)return U;const b=K.state;return b.wsize=0,b.whave=0,b.wnext=0,i(K)},M=(K,b)=>{let e;if(!K||!K.state)return U;const z=K.state;return b<0?(e=0,b=-b):(e=1+(b>>4),b<48&&(b&=15)),b&&(b<8||b>15)?U:(null!==z.window&&z.wbits!==b&&(z.window=null),z.wrap=e,z.wbits=b,S(K))},r=(K,b)=>{if(!K)return U;const e=new G;K.state=e,e.window=null;const z=M(K,b);return z!==A&&(K.state=null),z};let L,c,v=!0;const w=K=>{if(v){L=new Int32Array(512),c=new Int32Array(32);let b=0;for(;b<144;)K.lens[b++]=8;for(;b<256;)K.lens[b++]=9;for(;b<280;)K.lens[b++]=7;for(;b<288;)K.lens[b++]=8;for(T(1,K.lens,0,288,L,0,K.work,{bits:9}),b=0;b<32;)K.lens[b++]=5;T(2,K.lens,0,32,c,0,K.work,{bits:5}),v=!1}K.lencode=L,K.lenbits=9,K.distcode=c,K.distbits=5},h=(K,b,e,z)=>{let k;const j=K.state;return null===j.window&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new Uint8Array(j.wsize)),z>=j.wsize?(j.window.set(b.subarray(e-j.wsize,e),0),j.wnext=0,j.whave=j.wsize):(k=j.wsize-j.wnext,k>z&&(k=z),j.window.set(b.subarray(e-z,e-z+k),j.wnext),(z-=k)?(j.window.set(b.subarray(e-z,e),0),j.wnext=z,j.whave=j.wsize):(j.wnext+=k,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=k))),0};K.exports.inflateReset=S,K.exports.inflateReset2=M,K.exports.inflateResetKeep=i,K.exports.inflateInit=K=>r(K,15),K.exports.inflateInit2=r,K.exports.inflate=(K,b)=>{let e,G,i,S,M,r,L,c,v,R,n,P,d,p,a,O,g,N,Z,y,s,E,o=0;const C=new Uint8Array(4);let H,W;const f=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!K||!K.state||!K.output||!K.input&&0!==K.avail_in)return U;e=K.state,e.mode===I&&(e.mode=13),M=K.next_out,i=K.output,L=K.avail_out,S=K.next_in,G=K.input,r=K.avail_in,c=e.hold,v=e.bits,R=r,n=L,E=A;K:for(;;)switch(e.mode){case 1:if(0===e.wrap){e.mode=13;break}for(;v<16;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(2&e.wrap&&35615===c){e.check=0,C[0]=255&c,C[1]=c>>>8&255,e.check=k(e.check,C,2,0),c=0,v=0,e.mode=2;break}if(e.flags=0,e.head&&(e.head.done=!1),!(1&e.wrap)||(((255&c)<<8)+(c>>8))%31){K.msg="incorrect header check",e.mode=x;break}if((15&c)!==D){K.msg="unknown compression method",e.mode=x;break}if(c>>>=4,v-=4,s=8+(15&c),0===e.wbits)e.wbits=s;else if(s>e.wbits){K.msg="invalid window size",e.mode=x;break}e.dmax=1<<e.wbits,K.adler=e.check=1,e.mode=512&c?10:I,c=0,v=0;break;case 2:for(;v<16;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(e.flags=c,(255&e.flags)!==D){K.msg="unknown compression method",e.mode=x;break}if(57344&e.flags){K.msg="unknown header flags set",e.mode=x;break}e.head&&(e.head.text=c>>8&1),512&e.flags&&(C[0]=255&c,C[1]=c>>>8&255,e.check=k(e.check,C,2,0)),c=0,v=0,e.mode=3;case 3:for(;v<32;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}e.head&&(e.head.time=c),512&e.flags&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,e.check=k(e.check,C,4,0)),c=0,v=0,e.mode=4;case 4:for(;v<16;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}e.head&&(e.head.xflags=255&c,e.head.os=c>>8),512&e.flags&&(C[0]=255&c,C[1]=c>>>8&255,e.check=k(e.check,C,2,0)),c=0,v=0,e.mode=5;case 5:if(1024&e.flags){for(;v<16;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}e.length=c,e.head&&(e.head.extra_len=c),512&e.flags&&(C[0]=255&c,C[1]=c>>>8&255,e.check=k(e.check,C,2,0)),c=0,v=0}else e.head&&(e.head.extra=null);e.mode=6;case 6:if(1024&e.flags&&(P=e.length,P>r&&(P=r),P&&(e.head&&(s=e.head.extra_len-e.length,e.head.extra||(e.head.extra=new Uint8Array(e.head.extra_len)),e.head.extra.set(G.subarray(S,S+P),s)),512&e.flags&&(e.check=k(e.check,G,P,S)),r-=P,S+=P,e.length-=P),e.length))break K;e.length=0,e.mode=7;case 7:if(2048&e.flags){if(0===r)break K;P=0;do{s=G[S+P++],e.head&&s&&e.length<65536&&(e.head.name+=String.fromCharCode(s))}while(s&&P<r);if(512&e.flags&&(e.check=k(e.check,G,P,S)),r-=P,S+=P,s)break K}else e.head&&(e.head.name=null);e.length=0,e.mode=8;case 8:if(4096&e.flags){if(0===r)break K;P=0;do{s=G[S+P++],e.head&&s&&e.length<65536&&(e.head.comment+=String.fromCharCode(s))}while(s&&P<r);if(512&e.flags&&(e.check=k(e.check,G,P,S)),r-=P,S+=P,s)break K}else e.head&&(e.head.comment=null);e.mode=9;case 9:if(512&e.flags){for(;v<16;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(c!==(65535&e.check)){K.msg="header crc mismatch",e.mode=x;break}c=0,v=0}e.head&&(e.head.hcrc=e.flags>>9&1,e.head.done=!0),K.adler=e.check=0,e.mode=I;break;case 10:for(;v<32;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}K.adler=e.check=Q(c),c=0,v=0,e.mode=11;case 11:if(0===e.havedict)return K.next_out=M,K.avail_out=L,K.next_in=S,K.avail_in=r,e.hold=c,e.bits=v,t;K.adler=e.check=1,e.mode=I;case I:if(b===l||b===Y)break K;case 13:if(e.last){c>>>=7&v,v-=7&v,e.mode=27;break}for(;v<3;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}switch(e.last=1&c,c>>>=1,v-=1,3&c){case 0:e.mode=14;break;case 1:if(w(e),e.mode=20,b===Y){c>>>=2,v-=2;break K}break;case 2:e.mode=17;break;case 3:K.msg="invalid block type",e.mode=x}c>>>=2,v-=2;break;case 14:for(c>>>=7&v,v-=7&v;v<32;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if((65535&c)!==(c>>>16^65535)){K.msg="invalid stored block lengths",e.mode=x;break}if(e.length=65535&c,c=0,v=0,e.mode=15,b===Y)break K;case 15:e.mode=16;case 16:if(P=e.length,P){if(P>r&&(P=r),P>L&&(P=L),0===P)break K;i.set(G.subarray(S,S+P),M),r-=P,S+=P,L-=P,M+=P,e.length-=P;break}e.mode=I;break;case 17:for(;v<14;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(e.nlen=257+(31&c),c>>>=5,v-=5,e.ndist=1+(31&c),c>>>=5,v-=5,e.ncode=4+(15&c),c>>>=4,v-=4,e.nlen>286||e.ndist>30){K.msg="too many length or distance symbols",e.mode=x;break}e.have=0,e.mode=18;case 18:for(;e.have<e.ncode;){for(;v<3;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}e.lens[f[e.have++]]=7&c,c>>>=3,v-=3}for(;e.have<19;)e.lens[f[e.have++]]=0;if(e.lencode=e.lendyn,e.lenbits=7,H={bits:e.lenbits},E=T(0,e.lens,0,19,e.lencode,0,e.work,H),e.lenbits=H.bits,E){K.msg="invalid code lengths set",e.mode=x;break}e.have=0,e.mode=19;case 19:for(;e.have<e.nlen+e.ndist;){for(;o=e.lencode[c&(1<<e.lenbits)-1],a=o>>>24,O=o>>>16&255,g=65535&o,!(a<=v);){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(g<16)c>>>=a,v-=a,e.lens[e.have++]=g;else{if(16===g){for(W=a+2;v<W;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(c>>>=a,v-=a,0===e.have){K.msg="invalid bit length repeat",e.mode=x;break}s=e.lens[e.have-1],P=3+(3&c),c>>>=2,v-=2}else if(17===g){for(W=a+3;v<W;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}c>>>=a,v-=a,s=0,P=3+(7&c),c>>>=3,v-=3}else{for(W=a+7;v<W;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}c>>>=a,v-=a,s=0,P=11+(127&c),c>>>=7,v-=7}if(e.have+P>e.nlen+e.ndist){K.msg="invalid bit length repeat",e.mode=x;break}for(;P--;)e.lens[e.have++]=s}}if(e.mode===x)break;if(0===e.lens[256]){K.msg="invalid code -- missing end-of-block",e.mode=x;break}if(e.lenbits=9,H={bits:e.lenbits},E=T(1,e.lens,0,e.nlen,e.lencode,0,e.work,H),e.lenbits=H.bits,E){K.msg="invalid literal/lengths set",e.mode=x;break}if(e.distbits=6,e.distcode=e.distdyn,H={bits:e.distbits},E=T(2,e.lens,e.nlen,e.ndist,e.distcode,0,e.work,H),e.distbits=H.bits,E){K.msg="invalid distances set",e.mode=x;break}if(e.mode=20,b===Y)break K;case 20:e.mode=21;case 21:if(r>=6&&L>=258){K.next_out=M,K.avail_out=L,K.next_in=S,K.avail_in=r,e.hold=c,e.bits=v,j(K,n),M=K.next_out,i=K.output,L=K.avail_out,S=K.next_in,G=K.input,r=K.avail_in,c=e.hold,v=e.bits,e.mode===I&&(e.back=-1);break}for(e.back=0;o=e.lencode[c&(1<<e.lenbits)-1],a=o>>>24,O=o>>>16&255,g=65535&o,!(a<=v);){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(O&&0===(240&O)){for(N=a,Z=O,y=g;o=e.lencode[y+((c&(1<<N+Z)-1)>>N)],a=o>>>24,O=o>>>16&255,g=65535&o,!(N+a<=v);){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}c>>>=N,v-=N,e.back+=N}if(c>>>=a,v-=a,e.back+=a,e.length=g,0===O){e.mode=26;break}if(32&O){e.back=-1,e.mode=I;break}if(64&O){K.msg="invalid literal/length code",e.mode=x;break}e.extra=15&O,e.mode=22;case 22:if(e.extra){for(W=e.extra;v<W;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}e.length+=c&(1<<e.extra)-1,c>>>=e.extra,v-=e.extra,e.back+=e.extra}e.was=e.length,e.mode=23;case 23:for(;o=e.distcode[c&(1<<e.distbits)-1],a=o>>>24,O=o>>>16&255,g=65535&o,!(a<=v);){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(0===(240&O)){for(N=a,Z=O,y=g;o=e.distcode[y+((c&(1<<N+Z)-1)>>N)],a=o>>>24,O=o>>>16&255,g=65535&o,!(N+a<=v);){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}c>>>=N,v-=N,e.back+=N}if(c>>>=a,v-=a,e.back+=a,64&O){K.msg="invalid distance code",e.mode=x;break}e.offset=g,e.extra=15&O,e.mode=24;case 24:if(e.extra){for(W=e.extra;v<W;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}e.offset+=c&(1<<e.extra)-1,c>>>=e.extra,v-=e.extra,e.back+=e.extra}if(e.offset>e.dmax){K.msg="invalid distance too far back",e.mode=x;break}e.mode=25;case 25:if(0===L)break K;if(P=n-L,e.offset>P){if(P=e.offset-P,P>e.whave&&e.sane){K.msg="invalid distance too far back",e.mode=x;break}P>e.wnext?(P-=e.wnext,d=e.wsize-P):d=e.wnext-P,P>e.length&&(P=e.length),p=e.window}else p=i,d=M-e.offset,P=e.length;P>L&&(P=L),L-=P,e.length-=P;do{i[M++]=p[d++]}while(--P);0===e.length&&(e.mode=21);break;case 26:if(0===L)break K;i[M++]=e.length,L--,e.mode=21;break;case 27:if(e.wrap){for(;v<32;){if(0===r)break K;r--,c|=G[S++]<<v,v+=8}if(n-=L,K.total_out+=n,e.total+=n,n&&(K.adler=e.check=e.flags?k(e.check,i,n,M-n):z(e.check,i,n,M-n)),n=L,(e.flags?c:Q(c))!==e.check){K.msg="incorrect data check",e.mode=x;break}c=0,v=0}e.mode=28;case 28:if(e.wrap&&e.flags){for(;v<32;){if(0===r)break K;r--,c+=G[S++]<<v,v+=8}if(c!==(4294967295&e.total)){K.msg="incorrect length check",e.mode=x;break}c=0,v=0}e.mode=29;case 29:E=X;break K;case x:E=B;break K;case 31:return u;default:return U}return K.next_out=M,K.avail_out=L,K.next_in=S,K.avail_in=r,e.hold=c,e.bits=v,(e.wsize||n!==K.avail_out&&e.mode<x&&(e.mode<27||b!==F))&&h(K,K.output,K.next_out,n-K.avail_out)?(e.mode=31,u):(R-=K.avail_in,n-=K.avail_out,K.total_in+=R,K.total_out+=n,e.total+=n,e.wrap&&n&&(K.adler=e.check=e.flags?k(e.check,i,n,K.next_out-n):z(e.check,i,n,K.next_out-n)),K.data_type=e.bits+(e.last?64:0)+(e.mode===I?128:0)+(20===e.mode||15===e.mode?256:0),(0===R&&0===n||b===F)&&E===A&&(E=m),E)},K.exports.inflateEnd=K=>{if(!K||!K.state)return U;let b=K.state;return b.window&&(b.window=null),K.state=null,A},K.exports.inflateGetHeader=(K,b)=>{if(!K||!K.state)return U;const e=K.state;return 0===(2&e.wrap)?U:(e.head=b,b.done=!1,A)},K.exports.inflateSetDictionary=(K,b)=>{const e=b.length;let k,j,T;return K&&K.state?(k=K.state,0!==k.wrap&&11!==k.mode?U:11===k.mode&&(j=1,j=z(j,b,e,0),j!==k.check)?B:(T=h(K,b,e,e),T?(k.mode=31,u):(k.havedict=1,A))):U},K.exports.inflateInfo="pako inflate (from Nodeca project)"},10891:K=>{"use strict";const b=15,e=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),z=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),k=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),j=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);K.exports=(K,T,F,l,Y,A,X,t)=>{const U=t.bits;let B,u,m,D,I,x,Q=0,G=0,i=0,S=0,M=0,r=0,L=0,c=0,v=0,w=0,h=null,R=0;const n=new Uint16Array(16),P=new Uint16Array(16);let d,p,a,O=null,g=0;for(Q=0;Q<=b;Q++)n[Q]=0;for(G=0;G<l;G++)n[T[F+G]]++;for(M=U,S=b;S>=1&&0===n[S];S--);if(M>S&&(M=S),0===S)return Y[A++]=20971520,Y[A++]=20971520,t.bits=1,0;for(i=1;i<S&&0===n[i];i++);for(M<i&&(M=i),c=1,Q=1;Q<=b;Q++)if(c<<=1,c-=n[Q],c<0)return-1;if(c>0&&(0===K||1!==S))return-1;for(P[1]=0,Q=1;Q<b;Q++)P[Q+1]=P[Q]+n[Q];for(G=0;G<l;G++)0!==T[F+G]&&(X[P[T[F+G]]++]=G);if(0===K?(h=O=X,x=19):1===K?(h=e,R-=257,O=z,g-=257,x=256):(h=k,O=j,x=-1),w=0,G=0,Q=i,I=A,r=M,L=0,m=-1,v=1<<M,D=v-1,1===K&&v>852||2===K&&v>592)return 1;for(;;){d=Q-L,X[G]<x?(p=0,a=X[G]):X[G]>x?(p=O[g+X[G]],a=h[R+X[G]]):(p=96,a=0),B=1<<Q-L,u=1<<r,i=u;do{u-=B,Y[I+(w>>L)+u]=d<<24|p<<16|a}while(0!==u);for(B=1<<Q-1;w&B;)B>>=1;if(0!==B?(w&=B-1,w+=B):w=0,G++,0===--n[Q]){if(Q===S)break;Q=T[F+X[G]]}if(Q>M&&(w&D)!==m){for(0===L&&(L=M),I+=i,r=Q-L,c=1<<r;r+L<S&&(c-=n[r+L],!(c<=0));)r++,c<<=1;if(v+=1<<r,1===K&&v>852||2===K&&v>592)return 1;m=w&D,Y[m]=M<<24|r<<16|I-A}}return 0!==w&&(Y[I+w]=Q-L<<24|64<<16),t.bits=M,0}},10848:K=>{"use strict";K.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},10837:K=>{"use strict";function b(K){let b=K.length;for(;--b>=0;)K[b]=0}const e=256,z=286,k=30,j=15,T=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),F=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),l=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Y=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),A=new Array(576);b(A);const X=new Array(60);b(X);const t=new Array(512);b(t);const U=new Array(256);b(U);const B=new Array(29);b(B);const u=new Array(k);function m(K,b,e,z,k){this.static_tree=K,this.extra_bits=b,this.extra_base=e,this.elems=z,this.max_length=k,this.has_stree=K&&K.length}let D,I,x;function Q(K,b){this.dyn_tree=K,this.max_code=0,this.stat_desc=b}b(u);const G=K=>K<256?t[K]:t[256+(K>>>7)],i=(K,b)=>{K.pending_buf[K.pending++]=255&b,K.pending_buf[K.pending++]=b>>>8&255},S=(K,b,e)=>{K.bi_valid>16-e?(K.bi_buf|=b<<K.bi_valid&65535,i(K,K.bi_buf),K.bi_buf=b>>16-K.bi_valid,K.bi_valid+=e-16):(K.bi_buf|=b<<K.bi_valid&65535,K.bi_valid+=e)},M=(K,b,e)=>{S(K,e[2*b],e[2*b+1])},r=(K,b)=>{let e=0;do{e|=1&K,K>>>=1,e<<=1}while(--b>0);return e>>>1},L=(K,b,e)=>{const z=new Array(16);let k,T,F=0;for(k=1;k<=j;k++)z[k]=F=F+e[k-1]<<1;for(T=0;T<=b;T++){let b=K[2*T+1];0!==b&&(K[2*T]=r(z[b]++,b))}},c=K=>{let b;for(b=0;b<z;b++)K.dyn_ltree[2*b]=0;for(b=0;b<k;b++)K.dyn_dtree[2*b]=0;for(b=0;b<19;b++)K.bl_tree[2*b]=0;K.dyn_ltree[512]=1,K.opt_len=K.static_len=0,K.last_lit=K.matches=0},v=K=>{K.bi_valid>8?i(K,K.bi_buf):K.bi_valid>0&&(K.pending_buf[K.pending++]=K.bi_buf),K.bi_buf=0,K.bi_valid=0},w=(K,b,e,z)=>{const k=2*b,j=2*e;return K[k]<K[j]||K[k]===K[j]&&z[b]<=z[e]},h=(K,b,e)=>{const z=K.heap[e];let k=e<<1;for(;k<=K.heap_len&&(k<K.heap_len&&w(b,K.heap[k+1],K.heap[k],K.depth)&&k++,!w(b,z,K.heap[k],K.depth));)K.heap[e]=K.heap[k],e=k,k<<=1;K.heap[e]=z},R=(K,b,z)=>{let k,j,l,Y,A=0;if(0!==K.last_lit)do{k=K.pending_buf[K.d_buf+2*A]<<8|K.pending_buf[K.d_buf+2*A+1],j=K.pending_buf[K.l_buf+A],A++,0===k?M(K,j,b):(l=U[j],M(K,l+e+1,b),Y=T[l],0!==Y&&(j-=B[l],S(K,j,Y)),k--,l=G(k),M(K,l,z),Y=F[l],0!==Y&&(k-=u[l],S(K,k,Y)))}while(A<K.last_lit);M(K,256,b)},n=(K,b)=>{const e=b.dyn_tree,z=b.stat_desc.static_tree,k=b.stat_desc.has_stree,T=b.stat_desc.elems;let F,l,Y,A=-1;for(K.heap_len=0,K.heap_max=573,F=0;F<T;F++)0!==e[2*F]?(K.heap[++K.heap_len]=A=F,K.depth[F]=0):e[2*F+1]=0;for(;K.heap_len<2;)Y=K.heap[++K.heap_len]=A<2?++A:0,e[2*Y]=1,K.depth[Y]=0,K.opt_len--,k&&(K.static_len-=z[2*Y+1]);for(b.max_code=A,F=K.heap_len>>1;F>=1;F--)h(K,e,F);Y=T;do{F=K.heap[1],K.heap[1]=K.heap[K.heap_len--],h(K,e,1),l=K.heap[1],K.heap[--K.heap_max]=F,K.heap[--K.heap_max]=l,e[2*Y]=e[2*F]+e[2*l],K.depth[Y]=(K.depth[F]>=K.depth[l]?K.depth[F]:K.depth[l])+1,e[2*F+1]=e[2*l+1]=Y,K.heap[1]=Y++,h(K,e,1)}while(K.heap_len>=2);K.heap[--K.heap_max]=K.heap[1],((K,b)=>{const e=b.dyn_tree,z=b.max_code,k=b.stat_desc.static_tree,T=b.stat_desc.has_stree,F=b.stat_desc.extra_bits,l=b.stat_desc.extra_base,Y=b.stat_desc.max_length;let A,X,t,U,B,u,m=0;for(U=0;U<=j;U++)K.bl_count[U]=0;for(e[2*K.heap[K.heap_max]+1]=0,A=K.heap_max+1;A<573;A++)X=K.heap[A],U=e[2*e[2*X+1]+1]+1,U>Y&&(U=Y,m++),e[2*X+1]=U,X>z||(K.bl_count[U]++,B=0,X>=l&&(B=F[X-l]),u=e[2*X],K.opt_len+=u*(U+B),T&&(K.static_len+=u*(k[2*X+1]+B)));if(0!==m){do{for(U=Y-1;0===K.bl_count[U];)U--;K.bl_count[U]--,K.bl_count[U+1]+=2,K.bl_count[Y]--,m-=2}while(m>0);for(U=Y;0!==U;U--)for(X=K.bl_count[U];0!==X;)t=K.heap[--A],t>z||(e[2*t+1]!==U&&(K.opt_len+=(U-e[2*t+1])*e[2*t],e[2*t+1]=U),X--)}})(K,b),L(e,A,K.bl_count)},P=(K,b,e)=>{let z,k,j=-1,T=b[1],F=0,l=7,Y=4;for(0===T&&(l=138,Y=3),b[2*(e+1)+1]=65535,z=0;z<=e;z++)k=T,T=b[2*(z+1)+1],++F<l&&k===T||(F<Y?K.bl_tree[2*k]+=F:0!==k?(k!==j&&K.bl_tree[2*k]++,K.bl_tree[32]++):F<=10?K.bl_tree[34]++:K.bl_tree[36]++,F=0,j=k,0===T?(l=138,Y=3):k===T?(l=6,Y=3):(l=7,Y=4))},d=(K,b,e)=>{let z,k,j=-1,T=b[1],F=0,l=7,Y=4;for(0===T&&(l=138,Y=3),z=0;z<=e;z++)if(k=T,T=b[2*(z+1)+1],!(++F<l&&k===T)){if(F<Y)do{M(K,k,K.bl_tree)}while(0!==--F);else 0!==k?(k!==j&&(M(K,k,K.bl_tree),F--),M(K,16,K.bl_tree),S(K,F-3,2)):F<=10?(M(K,17,K.bl_tree),S(K,F-3,3)):(M(K,18,K.bl_tree),S(K,F-11,7));F=0,j=k,0===T?(l=138,Y=3):k===T?(l=6,Y=3):(l=7,Y=4)}};let p=!1;const a=(K,b,e,z)=>{S(K,0+(z?1:0),3),((K,b,e,z)=>{v(K),z&&(i(K,e),i(K,~e)),K.pending_buf.set(K.window.subarray(b,b+e),K.pending),K.pending+=e})(K,b,e,!0)};K.exports._tr_init=K=>{p||((()=>{let K,b,e,Y,Q;const G=new Array(16);for(e=0,Y=0;Y<28;Y++)for(B[Y]=e,K=0;K<1<<T[Y];K++)U[e++]=Y;for(U[e-1]=Y,Q=0,Y=0;Y<16;Y++)for(u[Y]=Q,K=0;K<1<<F[Y];K++)t[Q++]=Y;for(Q>>=7;Y<k;Y++)for(u[Y]=Q<<7,K=0;K<1<<F[Y]-7;K++)t[256+Q++]=Y;for(b=0;b<=j;b++)G[b]=0;for(K=0;K<=143;)A[2*K+1]=8,K++,G[8]++;for(;K<=255;)A[2*K+1]=9,K++,G[9]++;for(;K<=279;)A[2*K+1]=7,K++,G[7]++;for(;K<=287;)A[2*K+1]=8,K++,G[8]++;for(L(A,287,G),K=0;K<k;K++)X[2*K+1]=5,X[2*K]=r(K,5);D=new m(A,T,257,z,j),I=new m(X,F,0,k,j),x=new m(new Array(0),l,0,19,7)})(),p=!0),K.l_desc=new Q(K.dyn_ltree,D),K.d_desc=new Q(K.dyn_dtree,I),K.bl_desc=new Q(K.bl_tree,x),K.bi_buf=0,K.bi_valid=0,c(K)},K.exports._tr_stored_block=a,K.exports._tr_flush_block=(K,b,z,k)=>{let j,T,F=0;K.level>0?(2===K.strm.data_type&&(K.strm.data_type=(K=>{let b,z=4093624447;for(b=0;b<=31;b++,z>>>=1)if(1&z&&0!==K.dyn_ltree[2*b])return 0;if(0!==K.dyn_ltree[18]||0!==K.dyn_ltree[20]||0!==K.dyn_ltree[26])return 1;for(b=32;b<e;b++)if(0!==K.dyn_ltree[2*b])return 1;return 0})(K)),n(K,K.l_desc),n(K,K.d_desc),F=(K=>{let b;for(P(K,K.dyn_ltree,K.l_desc.max_code),P(K,K.dyn_dtree,K.d_desc.max_code),n(K,K.bl_desc),b=18;b>=3&&0===K.bl_tree[2*Y[b]+1];b--);return K.opt_len+=3*(b+1)+5+5+4,b})(K),j=K.opt_len+3+7>>>3,T=K.static_len+3+7>>>3,T<=j&&(j=T)):j=T=z+5,z+4<=j&&-1!==b?a(K,b,z,k):4===K.strategy||T===j?(S(K,2+(k?1:0),3),R(K,A,X)):(S(K,4+(k?1:0),3),((K,b,e,z)=>{let k;for(S(K,b-257,5),S(K,e-1,5),S(K,z-4,4),k=0;k<z;k++)S(K,K.bl_tree[2*Y[k]+1],3);d(K,K.dyn_ltree,b-1),d(K,K.dyn_dtree,e-1)})(K,K.l_desc.max_code+1,K.d_desc.max_code+1,F+1),R(K,K.dyn_ltree,K.dyn_dtree)),c(K),k&&v(K)},K.exports._tr_tally=(K,b,z)=>(K.pending_buf[K.d_buf+2*K.last_lit]=b>>>8&255,K.pending_buf[K.d_buf+2*K.last_lit+1]=255&b,K.pending_buf[K.l_buf+K.last_lit]=255&z,K.last_lit++,0===b?K.dyn_ltree[2*z]++:(K.matches++,b--,K.dyn_ltree[2*(U[z]+e+1)]++,K.dyn_dtree[2*G(b)]++),K.last_lit===K.lit_bufsize-1),K.exports._tr_align=K=>{S(K,2,3),M(K,256,A),(K=>{16===K.bi_valid?(i(K,K.bi_buf),K.bi_buf=0,K.bi_valid=0):K.bi_valid>=8&&(K.pending_buf[K.pending++]=255&K.bi_buf,K.bi_buf>>=8,K.bi_valid-=8)})(K)}},10865:K=>{"use strict";K.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},11847:K=>{function b(K,b,e){for(var z=K.length,k=-1/0,j=1/0,T=0;T<z;T++){var F=(e[0][T]-K[T])/b[T],l=(e[1][T]-K[T])/b[T];if(F>l){var Y=F;F=l,l=Y}if(l<k||F>j)return 1/0;F>k&&(k=F),l<j&&(j=l)}return k>j?1/0:k}K.exports=function(K,e,z,k){var j=b(e,z,k);if(j===1/0)K=null;else{K=K||[];for(var T=0;T<e.length;T++)K[T]=e[T]+z[T]*j}return K},K.exports.distance=b},12351:(K,b,e)=>{"use strict";e.d(b,{e:()=>T});var z=e(33);const k=z.useLayoutEffect;const j=function(K){var b=(0,z.useRef)(K);return k((function(){b.current=K})),b};var T=function(K){var b=j(K);(0,z.useEffect)((function(){var K=function(K){var e;if(null!=b.current&&(e=b.current(K)),K.defaultPrevented&&(K.returnValue=""),"string"===typeof e)return K.returnValue=e,e};return window.addEventListener("beforeunload",K),function(){window.removeEventListener("beforeunload",K)}}),[])}},12314:(K,b,e)=>{"use strict";var z=e(12320),k=Array.prototype.concat,j=Array.prototype.slice,T=K.exports=function(K){for(var b=[],e=0,T=K.length;e<T;e++){var F=K[e];z(F)?b=k.call(b,j.call(F)):b.push(F)}return b};T.wrap=function(K){return function(){return K(T(arguments))}}},12320:K=>{K.exports=function(K){return!(!K||"string"===typeof K)&&(K instanceof Array||Array.isArray(K)||K.length>=0&&(K.splice instanceof Function||Object.getOwnPropertyDescriptor(K,K.length-1)&&"String"!==K.constructor.name))}},12253:K=>{"use strict";var b=[],e=[],z=[],k=[],j=[],T=[],F=[],l=[],Y=[],A=[],X=[],t=[];K.exports=function(K,U,B,u,m,D){for(var I=F,x=Y,Q=A,G=t,i=0;i<3;i++)I[i]=+B[i],Q[i]=+U.max[i],x[i]=+U.base[i];D||(D=1e-10);var S=function(K,F,Y,A,t,U){var B=b,u=e,m=z,D=k,I=j,x=T,Q=l,G=Math.floor,i=0,S=0,M=0,r=0,L=0;if(c(),0===M)return 0;for(r=h();S<=M;){if(v(r)&&w())return i;r=h()}for(i+=M,L=0;L<3;L++)A[L]+=Y[L],t[L]+=Y[L];return i;function c(){if(S=0,0!==(M=Math.sqrt(Y[0]*Y[0]+Y[1]*Y[1]+Y[2]*Y[2])))for(var K=0;K<3;K++){var b=Y[K]>=0;D[K]=b?1:-1;var e=b?t[K]:A[K];B[K]=b?A[K]:t[K],u[K]=R(e,D[K]),m[K]=n(B[K],D[K]),Q[K]=Y[K]/M,I[K]=Math.abs(1/Q[K]);var z=b?u[K]+1-e:e-u[K];x[K]=I[K]<1/0?I[K]*z:1/0}}function v(b){for(var e=D[0],z=0===b?u[0]:m[0],k=u[0]+e,j=D[1],T=1===b?u[1]:m[1],F=u[1]+j,l=D[2],Y=2===b?u[2]:m[2],A=u[2]+l,X=z;X!=k;X+=e)for(var t=T;t!=F;t+=j)for(var U=Y;U!=A;U+=l)if(K(X,t,U))return!0;return!1}function w(){i+=S;var K=D[r],b=S/M,e=X;for(L=0;L<3;L++){var z=Y[L]*b;A[L]+=z,t[L]+=z,e[L]=Y[L]-z}if(K>0?t[r]=Math.round(t[r]):A[r]=Math.round(A[r]),F(i,r,K,e))return!0;for(L=0;L<3;L++)Y[L]=e[L];return c(),0===M}function h(){var K=x[0]<x[1]?x[0]<x[2]?0:2:x[1]<x[2]?1:2,b=x[K]-S;for(S=x[K],u[K]+=D[K],x[K]+=I[K],L=0;L<3;L++)B[L]+=b*Q[L],m[L]=n(B[L],D[L]);return K}function R(K,b){return G(K-b*U)}function n(K,b){return G(K+b*U)}}(K,u,I,x,Q,D);if(!m){for(i=0;i<3;i++)G[i]=B[i]>0?Q[i]-U.max[i]:x[i]-U.base[i];U.translate(G)}return S}},10656:(K,b,e)=>{var z=e(10663);function k(K){for(var b,e,k=0,j=K.length,T=0;T<K.length;){for(b=K[T],e=0;T<j&&K[T]===b;)++T,++e;k+=z.log2(e)/7|0,k+=z.log2(b>>>0)/7|0,k+=2}return k}b.size=k,b.encode=function(K,b){b||(b=new Uint8Array(k(K)));for(var e,z,j=0,T=b.length,F=0;F<K.length;){for(e=K[F],z=0;F<K.length&&K[F]===e;)++F,++z;for(;j<T&&z>=128;)b[j++]=128+(127&z),z>>>=7;if(j>=T)throw new Error("RLE buffer overflow");for(b[j++]=z,e>>>=0;j<T&&e>=128;)b[j++]=128+(127&e),e>>>=7;if(j>=T)throw new Error("RLE buffer overflow");b[j++]=e}return b},b.decode=function(K,b){for(var e,z,k,j,T=b.length,F=K.length,l=0,Y=0;Y<F;){for(e=0,z=0;Y<F&&K[Y]>=128;)e+=(127&K[Y++])<<z,z+=7;if(e+=K[Y++]<<z,Y>=F)throw new Error("RLE buffer underrun");if(l+e>T)throw new Error("Chunk buffer overflow");for(k=0,z=0;Y<F&&K[Y]>=128;)k+=(127&K[Y++])<<z,z+=7;if(Y>=F)throw new Error("RLE buffer underrun");for(k+=K[Y++]<<z,j=0;j<e;++j)b[l++]=k}return b}},10663:(K,b)=>{"use strict";function e(K){var b=32;return(K&=-K)&&b--,65535&K&&(b-=16),16711935&K&&(b-=8),252645135&K&&(b-=4),858993459&K&&(b-=2),1431655765&K&&(b-=1),b}b.INT_BITS=32,b.INT_MAX=2147483647,b.INT_MIN=-1<<31,b.sign=function(K){return(K>0)-(K<0)},b.abs=function(K){var b=K>>31;return(K^b)-b},b.min=function(K,b){return b^(K^b)&-(K<b)},b.max=function(K,b){return K^(K^b)&-(K<b)},b.isPow2=function(K){return!(K&K-1)&&!!K},b.log2=function(K){var b,e;return b=(K>65535)<<4,b|=e=((K>>>=b)>255)<<3,b|=e=((K>>>=e)>15)<<2,(b|=e=((K>>>=e)>3)<<1)|(K>>>=e)>>1},b.log10=function(K){return K>=1e9?9:K>=1e8?8:K>=1e7?7:K>=1e6?6:K>=1e5?5:K>=1e4?4:K>=1e3?3:K>=100?2:K>=10?1:0},b.popCount=function(K){return 16843009*((K=(858993459&(K-=K>>>1&1431655765))+(K>>>2&858993459))+(K>>>4)&252645135)>>>24},b.countTrailingZeros=e,b.nextPow2=function(K){return K+=0===K,--K,K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)+1},b.prevPow2=function(K){return K|=K>>>1,K|=K>>>2,K|=K>>>4,K|=K>>>8,(K|=K>>>16)-(K>>>1)},b.parity=function(K){return K^=K>>>16,K^=K>>>8,K^=K>>>4,27030>>>(K&=15)&1};var z=new Array(256);!function(K){for(var b=0;b<256;++b){var e=b,z=b,k=7;for(e>>>=1;e;e>>>=1)z<<=1,z|=1&e,--k;K[b]=z<<k&255}}(z),b.reverse=function(K){return z[255&K]<<24|z[K>>>8&255]<<16|z[K>>>16&255]<<8|z[K>>>24&255]},b.interleave2=function(K,b){return(K=1431655765&((K=858993459&((K=252645135&((K=16711935&((K&=65535)|K<<8))|K<<4))|K<<2))|K<<1))|(b=1431655765&((b=858993459&((b=252645135&((b=16711935&((b&=65535)|b<<8))|b<<4))|b<<2))|b<<1))<<1},b.deinterleave2=function(K,b){return(K=65535&((K=16711935&((K=252645135&((K=858993459&((K=K>>>b&1431655765)|K>>>1))|K>>>2))|K>>>4))|K>>>16))<<16>>16},b.interleave3=function(K,b,e){return K=1227133513&((K=3272356035&((K=251719695&((K=4278190335&((K&=1023)|K<<16))|K<<8))|K<<4))|K<<2),(K|=(b=1227133513&((b=3272356035&((b=251719695&((b=4278190335&((b&=1023)|b<<16))|b<<8))|b<<4))|b<<2))<<1)|(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<2},b.deinterleave3=function(K,b){return(K=1023&((K=4278190335&((K=251719695&((K=3272356035&((K=K>>>b&1227133513)|K>>>2))|K>>>4))|K>>>8))|K>>>16))<<22>>22},b.nextCombination=function(K){var b=K|K-1;return b+1|(~b&-~b)-1>>>e(K)+1}},12424:(K,b,e)=>{"use strict";e.d(b,{b:()=>X});var z=e(12249),k=e(126);class j{constructor(K,b,e,j,T,F,l){this.ig=new z(K.base,K.Fg),this.mass=b,this.friction=e,this.restitution=j,this.Uc=T,this.sk=F,this.Vc=!!l,this.Cg=-1,this.fluidDrag=-1,this.fluidDragVert=-1,this.fluidDragHoriz=-1,this.dl=null,this.preventFallOffEdge=!1,this.alwaysApplyHorizFriction=!1,this.slideOnCollision=!0,this.rolledBackLastTick=!1,this.Ef=k.create(),this.resting=[0,0,0],this.inFluid=!1,this._ratioInFluid=0,this._forces=k.create(),this._impulses=k.create(),this._sleepFrameCount=10}loadFromCopy(K){k.i(this.ig.base,K.ig.base),k.i(this.ig.Fg,K.ig.Fg),k.i(this.ig.max,K.ig.max),this.ig.mag=K.ig.mag,this.mass=K.mass,this.friction=K.friction,this.restitution=K.restitution,this.Uc=K.Uc,this.sk=K.sk,this.Vc=K.Vc,this.Cg=K.Cg,this.fluidDrag=K.fluidDrag,this.dl=K.dl,this.preventFallOffEdge=K.preventFallOffEdge,this.rolledBackLastTick=K.rolledBackLastTick,k.i(this.Ef,K.Ef),k.i(this.resting,K.resting),this.inFluid=K.inFluid,this._ratioInFluid=K._ratioInFluid,k.i(this._forces,K._forces),k.i(this._impulses,K._impulses),this._sleepFrameCount=K._sleepFrameCount}setPosition(K){T(K),k.Qc(K,K,this.ig.base),this.ig.translate(K),this.If()}cb(){return k.clone(this.ig.base)}applyForce(K){T(K),k.add(this._forces,this._forces,K),this.If()}applyImpulse(K){T(K),k.add(this._impulses,this._impulses,K),this.If()}If(){this._sleepFrameCount=10}atRestX(){return this.resting[0]}atRestY(){return this.resting[1]}atRestZ(){return this.resting[2]}}var T=K=>{};var F=e(12249),l=e(126),Y=e(12253);function A(){this.Cg=.1,this.fluidDrag=.4,this.bd=2,this.gravity=[0,-10,0],this.minBounceImpulse=.5}function X(K,b,e){K=Object.assign(new A,K),this.gravity=K.gravity||[0,-10,0],this.Cg=K.Cg||.1,this.bd=K.bd||2,this.fluidDrag=K.fluidDrag||.4,this.minBounceImpulse=K.minBounceImpulse,this.bodies=[],this.Oj=K.Oj,this.testSolid=b,this.testFluid=e}X.prototype.zk=function(K,b,e,z,k,T){K=K||new F([0,0,0],[1,1,1]),"undefined"==typeof b&&(b=1),"undefined"==typeof e&&(e=1),"undefined"==typeof z&&(z=0),"undefined"==typeof k&&(k=1);var l=new j(K,b,e,z,k,T);return this.bodies.push(l),l},X.prototype.Ak=function(K){var b=this.bodies.indexOf(K);b<0||(this.bodies.splice(b,1),K.ig=K.sk=null)};var t=l.create(),U=l.create(),B=l.create(),u=l.create(),m=l.create(),D=l.create(),I=l.create(),x=new F([0,0,0],[1,1,1]),Q=new j(x,1,1,0,1,(()=>{}),!1);function G(K,b,e){return b=e,b*=1-(1-K.ratioInFluid)**2}X.prototype.yd=function(K){K/=1e3;var b=O(0,l.squaredLength(this.gravity));this.bodies.forEach((e=>function(K,b,e,z){l.i(m,b.resting),K.Oj&&Q.loadFromCopy(b);if(b.mass<=0)return l.set(b.Ef,0,0,0),l.set(b._forces,0,0,0),void l.set(b._impulses,0,0,0);var k=z||0===b.Uc;if(function(K,b,e,z){if(b._sleepFrameCount>0)return!1;if(z)return!0;var k=!1,j=.5*e*e*b.Uc;return l.scale(a,K.gravity,j),Y(K.testSolid,b.ig,a,(function(){return k=!0,!0}),!0),k}(K,b,e,k))return;b._sleepFrameCount--,function(K,b){var e=b.ig,z=Math.floor(e.base[0]),k=Math.floor(e.base[2]),j=Math.floor(e.base[1]),T=Math.floor(e.max[1]);if(!K.testFluid(z,j,k))return b.inFluid=!1,void(b.ratioInFluid=0);var F=1,Y=j+1;for(;Y<=T&&K.testFluid(z,Y,k);)F++,Y++;var A=(j+F-e.base[1])/e.Fg[1];A>1&&(A=1);var X=e.Fg[0]*e.Fg[1]*e.Fg[2]*A,t=S;l.scale(t,K.gravity,-K.bd*X*b.Uc),b.applyForce(t),b.inFluid=!0,b.ratioInFluid=A}(K,b),N(b._forces),N(b._impulses),N(b.Ef),N(b.resting),l.scale(t,b._forces,1/b.mass),l.od(t,t,K.gravity,b.Uc),l.scale(U,b._impulses,1/b.mass),l.od(U,U,t,e),l.add(b.Ef,b.Ef,U),b.friction&&(M(K,0,b,U,e),M(K,1,b,U,e),M(K,2,b,U,e));var j=b.fluidDrag>=0?b.fluidDrag:K.fluidDrag,T=b.Cg>=0?b.Cg:K.Cg,F=T,A=T;b.inFluid&&(F=G(b,F,b.fluidDragHoriz>=0?b.fluidDragHoriz:j),A=G(b,A,b.fluidDragVert>=0?b.fluidDragVert:j));F=Math.max(1-F*e/b.mass,0),A=Math.max(1-A*e/b.mass,0),l.set(i,F,A,F),l.multiply(b.Ef,b.Ef,i),l.scale(B,b.Ef,e),l.set(b._forces,0,0,0),l.set(b._impulses,0,0,0),b.Vc&&g(c,b.ig);l.i(D,B),l.set(I,0,0,0),b.preventFallOffEdge&&function(K,b,e,z){if(!b.resting[1]||e[1]>0)return;var k=P;g(k,b.ig);for(var j=0;j<3;j+=2){l.set(n,0,0,0),n[j]=e[j];var T=!0;(T=(T=(T=(T=T&&!p(K,k.base[0]+n[0]+1e-5,k.base[1],k.base[2]+n[2]+1e-5))&&!p(K,k.max[0]+n[0]-1e-5,k.base[1],k.base[2]+n[2]+1e-5))&&!p(K,k.base[0]+n[0]+1e-5,k.base[1],k.max[2]+n[2]-1e-5))&&!p(K,k.max[0]+n[0]-1e-5,k.base[1],k.max[2]+n[2]-1e-5))?(z[j]=e[j]>0?1:-1,e[j]=0):0===j&&(l.set(d,e[0],0,0),L(K,k,d,z,b.slideOnCollision))}}(K,b,B,I);L(K,b.ig,B,b.resting,b.slideOnCollision),b.Vc&&function(K,b,e,z){if(b.resting[1]>=0&&!b.inFluid)return;var k=0!==b.resting[0],j=0!==b.resting[2];if(!k&&!j)return;var T=Math.abs(z[0]/z[2]),F=4;if(!k&&T>F)return;if(!j&&T<1/F)return;l.add(w,e.base,z);var A=K.testSolid;Y(A,e,z,(function(K,b,e,z){if(1!==b)return!0;z[b]=0}));var X=e.base[1],t=b.inFluid?1.951:1.001,U=Math.floor(X+t)-X;l.set(h,0,U,0);var B=!1;if(Y(A,e,h,(function(K,b,e,z){return B=!0,!0})),B)return;l.Qc(R,w,e.base),R[1]=0,L(K,e,R,v,!0);var u=O(e.base[0],w[0]),m=O(e.base[2],w[2]);if(k&&!u&&(!m||!j))return;if(j&&(!u||!k)&&!m)return;var D=!0;if(D=D&&!p(K,e.base[0]+1e-5,e.base[1],e.base[2]+1e-5),D=D&&!p(K,e.max[0]-1e-5,e.base[1],e.base[2]+1e-5),D=D&&!p(K,e.base[0]+1e-5,e.base[1],e.max[2]-1e-5),D=D&&!p(K,e.max[0]-1e-5,e.base[1],e.max[2]-1e-5),D)return;g(b.ig,e),b.resting[0]=v[0],b.resting[2]=v[2],b.dl&&b.dl()}(K,b,c,D);for(var X=0;X<3;++X)b.resting[X]=b.resting[X]||I[X],u[X]=0,b.resting[X]&&(m[X]||(u[X]=-b.Ef[X]),b.Ef[X]=0);var x=l.length(u);x>.001&&(l.scale(u,u,b.mass),b.sk&&b.sk(u),b.restitution>0&&x>K.minBounceImpulse&&(l.scale(u,u,b.restitution),b.applyImpulse(u)));var r=l.squaredLength(b.Ef);r>1e-5&&b.If();K.Oj&&K.Oj(b)?(b.loadFromCopy(Q),b.rolledBackLastTick=!0):b.rolledBackLastTick=!1}(this,e,K,b)))};var i=l.create([0,0,0]);var S=l.create();function M(K,b,e,z,k){var j=e.resting[b],T=z[b];if(!e.alwaysApplyHorizFriction||1!==b){if(0===j)return;if(j*T<=0)return}l.i(r,e.Ef),r[b]=0;var F=l.length(r);if(!O(F,0)){var Y=Math.abs(e.friction*K.gravity[b]*k),A=F>Y?(F-Y)/F:0;e.Ef[(b+1)%3]*=A,e.Ef[(b+2)%3]*=A}}var r=l.create();function L(K,b,e,z,k){return l.set(z,0,0,0),Y(K.testSolid,b,e,(function(K,b,e,j){z[b]=e,j[b]=0,k||(j[0]=0,j[1]=0,j[2]=0)}))}var c=new F([],[]),v=l.create(),w=l.create(),h=l.create(),R=l.create();var n=l.create(),P=new F([],[]),d=l.create();function p(K,b,e,z){return K.testSolid(Math.floor(b),Math.floor(e-1),Math.floor(z))}var a=l.create();function O(K,b){return Math.abs(K-b)<1e-5}function g(K,b){for(var e=0;e<3;e++)K.base[e]=b.base[e],K.max[e]=b.max[e],K.Fg[e]=b.Fg[e]}var N=function(K){}},10818:K=>{"use strict";K.exports=function(K,b,e,z){var k=self||window;try{try{var j;try{j=new k.Blob([K])}catch(Y){(j=new(k.BlobBuilder||k.WebKitBlobBuilder||k.MozBlobBuilder||k.MSBlobBuilder)).append(K),j=j.getBlob()}var T=k.URL||k.webkitURL,F=T.createObjectURL(j),l=new k[b](F,e);return T.revokeObjectURL(F),l}catch(Y){return new k[b]("data:application/javascript,".concat(encodeURIComponent(K)),e)}}catch(Y){if(!z)throw Error("Inline worker is not supported");return new k[b](z,e)}}},11831:(K,b,e)=>{"use strict";function z(K,b,e,z,k){var j={};return Object.keys(z).forEach((function(K){j[K]=z[K]})),j.enumerable=!!j.enumerable,j.configurable=!!j.configurable,("value"in j||j.initializer)&&(j.writable=!0),j=e.slice().reverse().reduce((function(e,z){return z(K,b,e)||e}),j),k&&void 0!==j.initializer&&(j.value=j.initializer?j.initializer.call(k):void 0,j.initializer=void 0),void 0===j.initializer&&(Object.defineProperty(K,b,j),j=null),j}e.d(b,{e:()=>z})},11829:(K,b,e)=>{"use strict";function z(K,b,e,z){e&&Object.defineProperty(K,b,{enumerable:e.enumerable,configurable:e.configurable,writable:e.writable,value:e.initializer?e.initializer.call(z):void 0})}e.d(b,{b:()=>z})},11896:(K,b,e)=>{"use strict";e.d(b,{c:()=>x,f:()=>m,j:()=>D,m:()=>t,n:()=>u,p:()=>B,r:()=>U});var z=e(10967),k=e(10994),j=e(10984),T=e(10799),F=e(11903),l=e(11243),Y=e(11179),A=e(10718),X=e(11001);const t=Object.freeze(new z.d(0,0,0,0)),U=Object.freeze(z.k.Zero()),B=Object.freeze(z.h.Zero()),u=Object.freeze(Y.c.Zero()),m=Object.freeze(k.c.Black()),D=Object.freeze(new k.g(0,0,0,0)),I={key:0,repeatCount:0,loopMode:2};class x{static _PrepareAnimation(K,b,e,j,T,F,l,A){let X;if(!isNaN(parseFloat(T))&&isFinite(T)?X=x.ANIMATIONTYPE_FLOAT:T instanceof z.d?X=x.ANIMATIONTYPE_QUATERNION:T instanceof z.k?X=x.ANIMATIONTYPE_VECTOR3:T instanceof z.h?X=x.ANIMATIONTYPE_VECTOR2:T instanceof k.c?X=x.ANIMATIONTYPE_COLOR3:T instanceof k.g?X=x.ANIMATIONTYPE_COLOR4:T instanceof Y.c&&(X=x.ANIMATIONTYPE_SIZE),void 0==X)return null;const t=new x(K,b,e,X,l),U=[{frame:0,value:T},{frame:j,value:F}];return t.setKeys(U),void 0!==A&&t.setEasingFunction(A),t}static CreateAnimation(K,b,e,z){const k=new x(K+"Animation",K,e,b,x.ANIMATIONLOOPMODE_CONSTANT);return k.setEasingFunction(z),k}static CreateAndStartAnimation(K,b,e,z,k,j,T,F,l,Y,A){const X=x._PrepareAnimation(K,e,z,k,j,T,F,l);return X?(b.va&&(A=b.va()),A?A.beginDirectAnimation(b,[X],0,k,1===X.loopMode,1,Y):null):null}static CreateAndStartHierarchyAnimation(K,b,e,z,k,j,T,F,l,Y,A){const X=x._PrepareAnimation(K,z,k,j,T,F,l,Y);if(!X)return null;return b.va().beginDirectHierarchyAnimation(b,e,[X],0,j,1===X.loopMode,1,A)}static CreateMergeAndStartAnimation(K,b,e,z,k,j,T,F,l,Y){const A=x._PrepareAnimation(K,e,z,k,j,T,F,l);return A?(b.animations.push(A),b.va().beginAnimation(b,0,k,1===A.loopMode,1,Y)):null}static MakeAnimationAdditive(K,b,e){let k;k="object"===typeof b?b:{referenceFrame:b??0,range:e,cloneOriginalAnimation:arguments.length>3&&void 0!==arguments[3]&&arguments[3],clonedAnimationName:arguments.length>4?arguments[4]:void 0};let j=K;if(k.cloneOriginalAnimation&&(j=K.clone(),j.name=k.clonedAnimationName||j.name),!j._keys.length)return j;const T=k.referenceFrame&&k.referenceFrame>=0?k.referenceFrame:0;let F=0;const l=j._keys[0];let Y=j._keys.length-1;const A=j._keys[Y],X={referenceValue:l.value,referencePosition:z.e.gb[0],referenceQuaternion:z.e.Quaternion[0],referenceScaling:z.e.gb[1],keyPosition:z.e.gb[2],keyQuaternion:z.e.Quaternion[1],keyScaling:z.e.gb[3]};let t=l.frame,U=A.frame;if(k.range){const K=j.getRange(k.range);K&&(t=K.from,U=K.to)}else t=k.fromFrame??t,U=k.toFrame??U;if(t!==l.frame&&(F=j.createKeyForFrame(t)),U!==A.frame&&(Y=j.createKeyForFrame(U)),1===j._keys.length){const K=j._getKeyValue(j._keys[0]);X.referenceValue=K.clone?K.clone():K}else if(T<=l.frame){const K=j._getKeyValue(l.value);X.referenceValue=K.clone?K.clone():K}else if(T>=A.frame){const K=j._getKeyValue(A.value);X.referenceValue=K.clone?K.clone():K}else{I.key=0;const K=j._interpolate(T,I);X.referenceValue=K.clone?K.clone():K}j.dataType===x.ANIMATIONTYPE_QUATERNION?X.referenceValue.normalize().conjugateInPlace():j.dataType===x.ANIMATIONTYPE_MATRIX&&(X.referenceValue.decompose(X.referenceScaling,X.referenceQuaternion,X.referencePosition),X.referenceQuaternion.normalize().conjugateInPlace());let B=Number.MAX_VALUE;const u=k.clipKeys?[]:null;for(let m=F;m<=Y;m++){let K=j._keys[m];if((u||k.cloneOriginalAnimation)&&(K={frame:K.frame,value:K.value.clone?K.value.clone():K.value,inTangent:K.inTangent,outTangent:K.outTangent,interpolation:K.interpolation,lockedTangent:K.lockedTangent},u&&(B===Number.MAX_VALUE&&(B=K.frame),K.frame-=B,u.push(K))),!m||j.dataType===x.ANIMATIONTYPE_FLOAT||K.value!==l.value)switch(j.dataType){case x.ANIMATIONTYPE_MATRIX:K.value.decompose(X.keyScaling,X.keyQuaternion,X.keyPosition),X.keyPosition.$h(X.referencePosition),X.keyScaling.divideInPlace(X.referenceScaling),X.referenceQuaternion.multiplyToRef(X.keyQuaternion,X.keyQuaternion),z.b.ComposeToRef(X.keyScaling,X.keyQuaternion,X.keyPosition,K.value);break;case x.ANIMATIONTYPE_QUATERNION:X.referenceValue.multiplyToRef(K.value,K.value);break;case x.ANIMATIONTYPE_VECTOR2:case x.ANIMATIONTYPE_VECTOR3:case x.ANIMATIONTYPE_COLOR3:case x.ANIMATIONTYPE_COLOR4:K.value.subtractToRef(X.referenceValue,K.value);break;case x.ANIMATIONTYPE_SIZE:K.value.width-=X.referenceValue.width,K.value.height-=X.referenceValue.height;break;default:K.value-=X.referenceValue}}return u&&j.setKeys(u,!0),j}static TransitionTo(K,b,e,z,k,j,T){let F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;if(T<=0)return e[K]=b,F&&F(),null;const l=k*(T/1e3);j.setKeys([{frame:0,value:e[K].clone?e[K].clone():e[K]},{frame:l,value:b}]),e.animations||(e.animations=[]),e.animations.push(j);const Y=z.beginAnimation(e,0,l,!1);return Y.onAnimationEnd=F,Y}get runtimeAnimations(){return this._runtimeAnimations}get hasRunningRuntimeAnimations(){for(const K of this._runtimeAnimations)if(!K.isStopped())return!0;return!1}constructor(K,b,e,z,k,j){this.name=K,this.targetProperty=b,this.framePerSecond=e,this.dataType=z,this.loopMode=k,this.enableBlending=j,this._easingFunction=null,this._runtimeAnimations=new Array,this._events=new Array,this.blendingSpeed=.01,this._ranges={},this.targetPropertyPath=b.split("."),this.dataType=z,this.loopMode=void 0===k?x.ANIMATIONLOOPMODE_CYCLE:k,this.uniqueId=x._UniqueIdGenerator++}toString(K){let b="Name: "+this.name+", property: "+this.targetProperty;if(b+=", datatype: "+["Float","gb","Quaternion","Matrix","hb","Vector2"][this.dataType],b+=", nKeys: "+(this._keys?this._keys.length:"none"),b+=", nRanges: "+(this._ranges?Object.keys(this._ranges).length:"none"),K){b+=", Ranges: {";let K=!0;for(const e in this._ranges)K&&(b+=", ",K=!1),b+=e;b+="}"}return b}addEvent(K){this._events.push(K),this._events.sort(((K,b)=>K.frame-b.frame))}removeEvents(K){for(let b=0;b<this._events.length;b++)this._events[b].frame===K&&(this._events.splice(b,1),b--)}getEvents(){return this._events}createRange(K,b,e){this._ranges[K]||(this._ranges[K]=new F.e(K,b,e))}deleteRange(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=this._ranges[K];if(e){if(b){const K=e.from,b=e.to;for(let e=this._keys.length-1;e>=0;e--)this._keys[e].frame>=K&&this._keys[e].frame<=b&&this._keys.splice(e,1)}this._ranges[K]=null}}getRange(K){return this._ranges[K]}getKeys(){return this._keys}getHighestFrame(){let K=0;for(let b=0,e=this._keys.length;b<e;b++)K<this._keys[b].frame&&(K=this._keys[b].frame);return K}getEasingFunction(){return this._easingFunction}setEasingFunction(K){this._easingFunction=K}floatInterpolateFunction(K,b,e){return(0,j.m)(K,b,e)}floatInterpolateFunctionWithTangents(K,b,e,z,k){return(0,j.g)(K,b,e,z,k)}quaternionInterpolateFunction(K,b,e){return z.d.Slerp(K,b,e)}quaternionInterpolateFunctionWithTangents(K,b,e,k,j){return z.d.Hermite(K,b,e,k,j).normalize()}vector3InterpolateFunction(K,b,e){return z.k.Lerp(K,b,e)}vector3InterpolateFunctionWithTangents(K,b,e,k,j){return z.k.Hermite(K,b,e,k,j)}vector2InterpolateFunction(K,b,e){return z.h.Lerp(K,b,e)}vector2InterpolateFunctionWithTangents(K,b,e,k,j){return z.h.Hermite(K,b,e,k,j)}sizeInterpolateFunction(K,b,e){return Y.c.Lerp(K,b,e)}color3InterpolateFunction(K,b,e){return k.c.Lerp(K,b,e)}color3InterpolateFunctionWithTangents(K,b,e,z,j){return k.c.Hermite(K,b,e,z,j)}color4InterpolateFunction(K,b,e){return k.g.Lerp(K,b,e)}color4InterpolateFunctionWithTangents(K,b,e,z,j){return k.g.Hermite(K,b,e,z,j)}_getKeyValue(K){return"function"===typeof K?K():K}evaluate(K){return I.key=0,this._interpolate(K,I)}_interpolate(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(b.loopMode===x.ANIMATIONLOOPMODE_CONSTANT&&b.repeatCount>0)return b.highLimitValue.clone?b.highLimitValue.clone():b.highLimitValue;const z=this._keys,k=z.length;let j=b.key;for(;j>=0&&K<z[j].frame;)--j;for(;j+1<=k-1&&K>=z[j+1].frame;)++j;if(b.key=j,j<0)return e?void 0:this._getKeyValue(z[0].value);if(j+1>k-1)return e?void 0:this._getKeyValue(z[k-1].value);const T=z[j],F=z[j+1];if(e&&(K===T.frame||K===F.frame))return;const l=this._getKeyValue(T.value),Y=this._getKeyValue(F.value);if(1===T.interpolation)return F.frame>K?l:Y;const A=void 0!==T.outTangent&&void 0!==F.inTangent,X=F.frame-T.frame;let I=(K-T.frame)/X;const Q=T.easingFunction||this.getEasingFunction();switch(null!==Q&&(I=Q.ease(I)),this.dataType){case x.ANIMATIONTYPE_FLOAT:{const K=A?this.floatInterpolateFunctionWithTangents(l,T.outTangent*X,Y,F.inTangent*X,I):this.floatInterpolateFunction(l,Y,I);switch(b.loopMode){case x.ANIMATIONLOOPMODE_CYCLE:case x.ANIMATIONLOOPMODE_CONSTANT:case x.ANIMATIONLOOPMODE_YOYO:return K;case x.ANIMATIONLOOPMODE_RELATIVE:case x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return(b.offsetValue??0)*b.repeatCount+K}break}case x.ANIMATIONTYPE_QUATERNION:{const K=A?this.quaternionInterpolateFunctionWithTangents(l,T.outTangent.scale(X),Y,F.inTangent.scale(X),I):this.quaternionInterpolateFunction(l,Y,I);switch(b.loopMode){case x.ANIMATIONLOOPMODE_CYCLE:case x.ANIMATIONLOOPMODE_CONSTANT:case x.ANIMATIONLOOPMODE_YOYO:return K;case x.ANIMATIONLOOPMODE_RELATIVE:case x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.addInPlace((b.offsetValue||t).scale(b.repeatCount))}return K}case x.ANIMATIONTYPE_VECTOR3:{const K=A?this.vector3InterpolateFunctionWithTangents(l,T.outTangent.scale(X),Y,F.inTangent.scale(X),I):this.vector3InterpolateFunction(l,Y,I);switch(b.loopMode){case x.ANIMATIONLOOPMODE_CYCLE:case x.ANIMATIONLOOPMODE_CONSTANT:case x.ANIMATIONLOOPMODE_YOYO:return K;case x.ANIMATIONLOOPMODE_RELATIVE:case x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.add((b.offsetValue||U).scale(b.repeatCount))}break}case x.ANIMATIONTYPE_VECTOR2:{const K=A?this.vector2InterpolateFunctionWithTangents(l,T.outTangent.scale(X),Y,F.inTangent.scale(X),I):this.vector2InterpolateFunction(l,Y,I);switch(b.loopMode){case x.ANIMATIONLOOPMODE_CYCLE:case x.ANIMATIONLOOPMODE_CONSTANT:case x.ANIMATIONLOOPMODE_YOYO:return K;case x.ANIMATIONLOOPMODE_RELATIVE:case x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.add((b.offsetValue||B).scale(b.repeatCount))}break}case x.ANIMATIONTYPE_SIZE:switch(b.loopMode){case x.ANIMATIONLOOPMODE_CYCLE:case x.ANIMATIONLOOPMODE_CONSTANT:case x.ANIMATIONLOOPMODE_YOYO:return this.sizeInterpolateFunction(l,Y,I);case x.ANIMATIONLOOPMODE_RELATIVE:case x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return this.sizeInterpolateFunction(l,Y,I).add((b.offsetValue||u).scale(b.repeatCount))}break;case x.ANIMATIONTYPE_COLOR3:{const K=A?this.color3InterpolateFunctionWithTangents(l,T.outTangent.scale(X),Y,F.inTangent.scale(X),I):this.color3InterpolateFunction(l,Y,I);switch(b.loopMode){case x.ANIMATIONLOOPMODE_CYCLE:case x.ANIMATIONLOOPMODE_CONSTANT:case x.ANIMATIONLOOPMODE_YOYO:return K;case x.ANIMATIONLOOPMODE_RELATIVE:case x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.add((b.offsetValue||m).scale(b.repeatCount))}break}case x.ANIMATIONTYPE_COLOR4:{const K=A?this.color4InterpolateFunctionWithTangents(l,T.outTangent.scale(X),Y,F.inTangent.scale(X),I):this.color4InterpolateFunction(l,Y,I);switch(b.loopMode){case x.ANIMATIONLOOPMODE_CYCLE:case x.ANIMATIONLOOPMODE_CONSTANT:case x.ANIMATIONLOOPMODE_YOYO:return K;case x.ANIMATIONLOOPMODE_RELATIVE:case x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return K.add((b.offsetValue||D).scale(b.repeatCount))}break}case x.ANIMATIONTYPE_MATRIX:switch(b.loopMode){case x.ANIMATIONLOOPMODE_CYCLE:case x.ANIMATIONLOOPMODE_CONSTANT:case x.ANIMATIONLOOPMODE_YOYO:return x.AllowMatricesInterpolation?this.matrixInterpolateFunction(l,Y,I,b.workValue):l;case x.ANIMATIONLOOPMODE_RELATIVE:case x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT:return l}}return 0}matrixInterpolateFunction(K,b,e,k){return x.AllowMatrixDecomposeForInterpolation?k?(z.b.DecomposeLerpToRef(K,b,e,k),k):z.b.DecomposeLerp(K,b,e):k?(z.b.LerpToRef(K,b,e,k),k):z.b.Lerp(K,b,e)}clone(){const K=new x(this.name,this.targetPropertyPath.join("."),this.framePerSecond,this.dataType,this.loopMode);if(K.enableBlending=this.enableBlending,K.blendingSpeed=this.blendingSpeed,this._keys&&K.setKeys(this._keys),this._ranges){K._ranges={};for(const b in this._ranges){const e=this._ranges[b];e&&(K._ranges[b]=e.clone())}}return K}setKeys(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._keys=b?K:K.slice(0)}createKeyForFrame(K){I.key=0;const b=this._interpolate(K,I,!0);if(!b)return this._keys[I.key].frame===K?I.key:I.key+1;const e={frame:K,value:b.clone?b.clone():b};return this._keys.splice(I.key+1,0,e),I.key+1}serialize(){const K={};K.name=this.name,K.property=this.targetProperty,K.framePerSecond=this.framePerSecond,K.dataType=this.dataType,K.loopBehavior=this.loopMode,K.enableBlending=this.enableBlending,K.blendingSpeed=this.blendingSpeed;const b=this.dataType;K.keys=[];const e=this.getKeys();for(let z=0;z<e.length;z++){const k=e[z],j={};switch(j.frame=k.frame,b){case x.ANIMATIONTYPE_FLOAT:j.values=[k.value],void 0!==k.inTangent&&j.values.push(k.inTangent),void 0!==k.outTangent&&(void 0===k.inTangent&&j.values.push(void 0),j.values.push(k.outTangent)),void 0!==k.interpolation&&(void 0===k.inTangent&&j.values.push(void 0),void 0===k.outTangent&&j.values.push(void 0),j.values.push(k.interpolation));break;case x.ANIMATIONTYPE_QUATERNION:case x.ANIMATIONTYPE_MATRIX:case x.ANIMATIONTYPE_VECTOR3:case x.ANIMATIONTYPE_COLOR3:case x.ANIMATIONTYPE_COLOR4:j.values=k.value.Ti(),void 0!=k.inTangent&&j.values.push(k.inTangent.Ti()),void 0!=k.outTangent&&(void 0===k.inTangent&&j.values.push(void 0),j.values.push(k.outTangent.Ti())),void 0!==k.interpolation&&(void 0===k.inTangent&&j.values.push(void 0),void 0===k.outTangent&&j.values.push(void 0),j.values.push(k.interpolation))}K.keys.push(j)}K.ranges=[];for(const z in this._ranges){const b=this._ranges[z];if(!b)continue;const e={};e.name=z,e.from=b.from,e.to=b.to,K.ranges.push(e)}return K}static _UniversalLerp(K,b,e){const z=K.constructor;return z.Lerp?z.Lerp(K,b,e):z.Slerp?z.Slerp(K,b,e):K.toFixed?K*(1-e)+e*b:b}static Parse(K){const b=new x(K.name,K.property,K.framePerSecond,K.dataType,K.loopBehavior),e=K.dataType,j=[];let T,F;for(K.enableBlending&&(b.enableBlending=K.enableBlending),K.blendingSpeed&&(b.blendingSpeed=K.blendingSpeed),F=0;F<K.keys.length;F++){const b=K.keys[F];let l,Y,A;switch(e){case x.ANIMATIONTYPE_FLOAT:T=b.values[0],b.values.length>=2&&(l=b.values[1]),b.values.length>=3&&(Y=b.values[2]),b.values.length>=4&&(A=b.values[3]);break;case x.ANIMATIONTYPE_QUATERNION:if(T=z.d.Bg(b.values),b.values.length>=8){const K=z.d.Bg(b.values.slice(4,8));K.equals(z.d.Zero())||(l=K)}if(b.values.length>=12){const K=z.d.Bg(b.values.slice(8,12));K.equals(z.d.Zero())||(Y=K)}b.values.length>=13&&(A=b.values[12]);break;case x.ANIMATIONTYPE_MATRIX:T=z.b.Bg(b.values),b.values.length>=17&&(A=b.values[16]);break;case x.ANIMATIONTYPE_COLOR3:T=k.c.Bg(b.values),b.values[3]&&(l=k.c.Bg(b.values[3])),b.values[4]&&(Y=k.c.Bg(b.values[4])),b.values[5]&&(A=b.values[5]);break;case x.ANIMATIONTYPE_COLOR4:T=k.g.Bg(b.values),b.values[4]&&(l=k.g.Bg(b.values[4])),b.values[5]&&(Y=k.g.Bg(b.values[5])),b.values[6]&&(A=k.g.Bg(b.values[6]));break;case x.ANIMATIONTYPE_VECTOR3:default:T=z.k.Bg(b.values),b.values[3]&&(l=z.k.Bg(b.values[3])),b.values[4]&&(Y=z.k.Bg(b.values[4])),b.values[5]&&(A=b.values[5])}const X={};X.frame=b.frame,X.value=T,void 0!=l&&(X.inTangent=l),void 0!=Y&&(X.outTangent=Y),void 0!=A&&(X.interpolation=A),j.push(X)}if(b.setKeys(j),K.ranges)for(F=0;F<K.ranges.length;F++)T=K.ranges[F],b.createRange(T.name,T.from,T.to);return b}static AppendSerializedAnimations(K,b){X.e.AppendSerializedAnimations(K,b)}static ParseFromFileAsync(K,b){return new Promise(((e,z)=>{const k=new A.e;k.addEventListener("readystatechange",(()=>{if(4==k.readyState)if(200==k.status){let b=JSON.parse(k.responseText);if(b.animations&&(b=b.animations),b.length){const K=[];for(const e of b)K.push(this.Parse(e));e(K)}else{const z=this.Parse(b);K&&(z.name=K),e(z)}}else z("Unable to load the animation")})),k.open("GET",b),k.send()}))}static ParseFromSnippetAsync(K){return new Promise(((b,e)=>{const z=new A.e;z.addEventListener("readystatechange",(()=>{if(4==z.readyState)if(200==z.status){const e=JSON.parse(JSON.parse(z.responseText).jsonPayload);if(e.animations){const z=JSON.parse(e.animations),k=[];for(const b of z.animations){const e=this.Parse(b);e.snippetId=K,k.push(e)}b(k)}else{const z=JSON.parse(e.animation),k=this.Parse(z);k.snippetId=K,b(k)}}else e("Unable to load the snippet "+K)})),z.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),z.send()}))}}x._UniqueIdGenerator=0,x.AllowMatricesInterpolation=!1,x.AllowMatrixDecomposeForInterpolation=!0,x.SnippetUrl="https://snippet.babylonjs.com",x.ANIMATIONTYPE_FLOAT=0,x.ANIMATIONTYPE_VECTOR3=1,x.ANIMATIONTYPE_QUATERNION=2,x.ANIMATIONTYPE_MATRIX=3,x.ANIMATIONTYPE_COLOR3=4,x.ANIMATIONTYPE_COLOR4=7,x.ANIMATIONTYPE_VECTOR2=5,x.ANIMATIONTYPE_SIZE=6,x.ANIMATIONLOOPMODE_RELATIVE=0,x.ANIMATIONLOOPMODE_CYCLE=1,x.ANIMATIONLOOPMODE_CONSTANT=2,x.ANIMATIONLOOPMODE_YOYO=4,x.ANIMATIONLOOPMODE_RELATIVE_FROM_CURRENT=5,x.CreateFromSnippetAsync=x.ParseFromSnippetAsync,(0,T.e)("BABYLON.Animation",x),l.e._AnimationRangeFactory=(K,b,e)=>new F.e(K,b,e)},11903:(K,b,e)=>{"use strict";e.d(b,{e:()=>z});class z{constructor(K,b,e){this.name=K,this.from=b,this.to=e}clone(){return new z(this.name,this.from,this.to)}}},11533:(K,b,e)=>{"use strict";var z=e(10690),k=e(10696),j=e(10750),T=e(10693);j.e.AudioEngineFactory=(K,b,e)=>new F(K,b,e);class F{get audioContext(){return this._audioContextInitialized||this._initializeAudioContext(),this._audioContext}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(this._audioContext=null,this._audioContextInitialized=!1,this._muteButton=null,this._audioDestination=null,this.canUseWebAudio=!1,this.WarnedWebAudioUnsupported=!1,this.isMP3supported=!1,this.isOGGsupported=!1,this.unlocked=!1,this.useCustomUnlockedButton=!1,this.onAudioUnlockedObservable=new z.d,this.onAudioLockedObservable=new z.d,this._tryToRun=!1,this._onResize=()=>{this._moveButtonToTopLeft()},!(0,T.k)())return;"undefined"!==typeof window.AudioContext&&(this.canUseWebAudio=!0);const k=document.createElement("audio");this._hostElement=K,this._audioContext=b,this._audioDestination=e;try{k&&k.canPlayType&&(k.canPlayType('audio/mpeg; codecs="mp3"').replace(/^no$/,"")||k.canPlayType("audio/mp3").replace(/^no$/,""))&&(this.isMP3supported=!0)}catch(j){}try{k&&k.canPlayType&&k.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.isOGGsupported=!0)}catch(j){}}lock(){this._triggerSuspendedState()}unlock(){var K,b;if("running"===(null===(K=this._audioContext)||void 0===K?void 0:K.state))return this._hideMuteButton(),void(this.unlocked||(this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)));this._tryToRun?null===(b=this._audioContext)||void 0===b||b.suspend().then((()=>{this._tryToRun=!1,this._triggerRunningState()})):this._triggerRunningState()}_resumeAudioContextOnStateChange(){var K;null===(K=this._audioContext)||void 0===K||K.addEventListener("statechange",(()=>{var K;this.unlocked&&"running"!==(null===(K=this._audioContext)||void 0===K?void 0:K.state)&&this._resumeAudioContext()}),{once:!0,passive:!0,signal:AbortSignal.timeout(3e3)})}_resumeAudioContext(){var K;return null!==(K=this._audioContext)&&void 0!==K&&K.resume?this._audioContext.resume():Promise.resolve()}_initializeAudioContext(){try{this.canUseWebAudio&&(this._audioContext||(this._audioContext=new AudioContext),this.masterGain=this._audioContext.createGain(),this.masterGain.gain.value=1,this._audioDestination||(this._audioDestination=this._audioContext.destination),this.masterGain.connect(this._audioDestination),this._audioContextInitialized=!0,"running"===this._audioContext.state&&this._triggerRunningState())}catch(K){this.canUseWebAudio=!1,k.b.Error("Web Audio: "+K.message)}}_triggerRunningState(){this._tryToRun||(this._tryToRun=!0,this._resumeAudioContext().then((()=>{this._tryToRun=!1,this._muteButton&&this._hideMuteButton(),this.unlocked=!0,this.onAudioUnlockedObservable.notifyObservers(this)})).catch((()=>{this._tryToRun=!1,this.unlocked=!1})))}_triggerSuspendedState(){this.unlocked=!1,this.onAudioLockedObservable.notifyObservers(this),this._displayMuteButton()}_displayMuteButton(){if(this.useCustomUnlockedButton||this._muteButton)return;this._muteButton=document.createElement("BUTTON"),this._muteButton.className="babylonUnmuteIcon",this._muteButton.id="babylonUnmuteIconBtn",this._muteButton.title="Unmute";const K=".babylonUnmuteIcon { position: absolute; left: 20px; top: 20px; height: 40px; width: 60px; background-color: rgba(51,51,51,0.7); background-image: url("+(window.SVGSVGElement?"data:image/svg+xml;charset=UTF-8,%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2239%22%20height%3D%2232%22%20viewBox%3D%220%200%2039%2032%22%3E%3Cpath%20fill%3D%22white%22%20d%3D%22M9.625%2018.938l-0.031%200.016h-4.953q-0.016%200-0.031-0.016v-12.453q0-0.016%200.031-0.016h4.953q0.031%200%200.031%200.016v12.453zM12.125%207.688l8.719-8.703v27.453l-8.719-8.719-0.016-0.047v-9.938zM23.359%207.875l1.406-1.406%204.219%204.203%204.203-4.203%201.422%201.406-4.219%204.219%204.219%204.203-1.484%201.359-4.141-4.156-4.219%204.219-1.406-1.422%204.219-4.203z%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E":"https://cdn.babylonjs.com/Assets/audio.png")+");  background-size: 80%; background-repeat:no-repeat; background-position: center; background-position-y: 4px; border: none; outline: none; transition: transform 0.125s ease-out; cursor: pointer; z-index: 9999; } .babylonUnmuteIcon:hover { transform: scale(1.05) } .babylonUnmuteIcon:active { background-color: rgba(51,51,51,1) }",b=document.createElement("style");b.appendChild(document.createTextNode(K)),document.getElementsByTagName("head")[0].appendChild(b),document.body.appendChild(this._muteButton),this._moveButtonToTopLeft(),this._muteButton.addEventListener("touchend",(()=>{this._triggerRunningState()}),!0),this._muteButton.addEventListener("click",(()=>{this.unlock()}),!0),window.addEventListener("resize",this._onResize)}_moveButtonToTopLeft(){this._hostElement&&this._muteButton&&(this._muteButton.style.top=this._hostElement.offsetTop+20+"px",this._muteButton.style.left=this._hostElement.offsetLeft+20+"px")}_hideMuteButton(){this._muteButton&&(document.body.removeChild(this._muteButton),this._muteButton=null)}dispose(){this.canUseWebAudio&&this._audioContextInitialized&&(this._connectedAnalyser&&this._audioContext&&(this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser.dispose(),this.masterGain.disconnect(),this.masterGain.connect(this._audioContext.destination),this._connectedAnalyser=null),this.masterGain.gain.value=1),this.WarnedWebAudioUnsupported=!1,this._hideMuteButton(),window.removeEventListener("resize",this._onResize),this.onAudioUnlockedObservable.clear(),this.onAudioLockedObservable.clear()}getGlobalVolume(){return this.canUseWebAudio&&this._audioContextInitialized?this.masterGain.gain.value:-1}setGlobalVolume(K){this.canUseWebAudio&&this._audioContextInitialized&&(this.masterGain.gain.value=K)}connectToAnalyser(K){this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this.canUseWebAudio&&this._audioContextInitialized&&this._audioContext&&(this._connectedAnalyser=K,this.masterGain.disconnect(),this._connectedAnalyser.connectAudioNodes(this.masterGain,this._audioContext.destination))}}},11893:(K,b,e)=>{"use strict";e.d(b,{b:()=>T});var z=e(10967),k=e(10975),j=e(11243);class T extends j.e{get _matrix(){return this._compose(),this.zj}set _matrix(K){(K.updateFlag!==this.zj.updateFlag||this._needToCompose)&&(this._needToCompose=!1,this.zj.p(K),this._markAsDirtyAndDecompose())}constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;super(K,b.va(),!1),this.name=K,this.children=[],this.animations=[],this._index=null,this._scalingDeterminant=1,this._needToDecompose=!0,this._needToCompose=!1,this._linkedTransformNode=null,this._waitingTransformNodeId=null,this._skeleton=b,this.zj=(null===k||void 0===k?void 0:k.clone())??z.b.Identity(),this._restMatrix=j??this.zj.clone(),this._bindMatrix=T??this.zj.clone(),this._index=F,this._absoluteMatrix=new z.b,this._absoluteBindMatrix=new z.b,this._absoluteInverseBindMatrix=new z.b,this._finalMatrix=new z.b,b.bones.push(this),this.setParent(e,!1),this._updateAbsoluteBindMatrices()}getClassName(){return"Bone"}getSkeleton(){return this._skeleton}get parent(){return this._parentNode}getParent(){return this.parent}getChildren(){return this.children}getIndex(){return null===this._index?this.getSkeleton().bones.indexOf(this):this._index}set parent(K){this.setParent(K)}setParent(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.parent!==K){if(this.parent){const K=this.parent.children.indexOf(this);-1!==K&&this.parent.children.splice(K,1)}this._parentNode=K,this.parent&&this.parent.children.push(this),b&&this._updateAbsoluteBindMatrices(),this.rg()}}getLocalMatrix(){return this._compose(),this.zj}getBindMatrix(){return this._bindMatrix}getBaseMatrix(){return this.getBindMatrix()}getRestMatrix(){return this._restMatrix}getRestPose(){return this.getRestMatrix()}setRestMatrix(K){this._restMatrix.p(K)}setRestPose(K){this.setRestMatrix(K)}getBindPose(){return this.getBindMatrix()}setBindMatrix(K){this.qj(K)}setBindPose(K){this.setBindMatrix(K)}getFinalMatrix(){return this._finalMatrix}getWorldMatrix(){return this.getFinalMatrix()}returnToRest(){if(this._linkedTransformNode){const K=z.e.gb[0],b=z.e.Quaternion[0],e=z.e.gb[1];this.getRestMatrix().decompose(K,b,e),this._linkedTransformNode.position.p(e),this._linkedTransformNode.rotationQuaternion=this._linkedTransformNode.rotationQuaternion??z.d.Identity(),this._linkedTransformNode.rotationQuaternion.p(b),this._linkedTransformNode.Zd.p(K)}else this._matrix=this._restMatrix}getAbsoluteInverseBindMatrix(){return this._absoluteInverseBindMatrix}getInvertedAbsoluteTransform(){return this.getAbsoluteInverseBindMatrix()}getAbsoluteMatrix(){return this._absoluteMatrix}getAbsoluteTransform(){return this._absoluteMatrix}linkTransformNode(K){this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode--,this._linkedTransformNode=K,this._linkedTransformNode&&this._skeleton._numBonesWithLinkedTransformNode++}getTransformNode(){return this._linkedTransformNode}get position(){return this._decompose(),this.Ud}set position(K){this._decompose(),this.Ud.p(K),this._markAsDirtyAndCompose()}get rotation(){return this.getRotation()}set rotation(K){this.setRotation(K)}get rotationQuaternion(){return this._decompose(),this._localRotation}set rotationQuaternion(K){this.setRotationQuaternion(K)}get Zd(){return this.getScale()}set Zd(K){this.setScale(K)}get animationPropertiesOverride(){return this._skeleton.animationPropertiesOverride}_decompose(){this._needToDecompose&&(this._needToDecompose=!1,this._localScaling||(this._localScaling=z.k.Zero(),this._localRotation=z.d.Zero(),this.Ud=z.k.Zero()),this.zj.decompose(this._localScaling,this._localRotation,this.Ud))}_compose(){this._needToCompose&&(this._localScaling?(this._needToCompose=!1,z.b.ComposeToRef(this._localScaling,this._localRotation,this.Ud,this.zj)):this._needToCompose=!1)}qj(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._bindMatrix.p(K),b&&this._updateAbsoluteBindMatrices(),e?this._matrix=K:this.rg()}_updateAbsoluteBindMatrices(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K||(K=this._bindMatrix),this.parent?K.multiplyToRef(this.parent._absoluteBindMatrix,this._absoluteBindMatrix):this._absoluteBindMatrix.p(K),this._absoluteBindMatrix.invertToRef(this._absoluteInverseBindMatrix),b)for(let e=0;e<this.children.length;e++)this.children[e]._updateAbsoluteBindMatrices();this._scalingDeterminant=this._absoluteBindMatrix.determinant()<0?-1:1}rg(){return this._currentRenderId++,this._childUpdateId++,this._skeleton._markAsDirty(),this}_markAsDirtyAndCompose(){this.rg(),this._needToCompose=!0}_markAsDirtyAndDecompose(){this.rg(),this._needToDecompose=!0}_updatePosition(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,k=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const j=this.getLocalMatrix();if(0==b)k?(j.addAtIndex(12,K.x),j.addAtIndex(13,K.y),j.addAtIndex(14,K.z)):j.setTranslationFromFloats(K.x,K.y,K.z);else{let b=null;e&&(b=e.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const F=T._TmpMats[0],l=T._TmpVecs[0];this.parent?e&&b?(F.p(this.parent.getAbsoluteMatrix()),F.multiplyToRef(b,F)):F.p(this.parent.getAbsoluteMatrix()):z.b.IdentityToRef(F),k&&F.setTranslationFromFloats(0,0,0),F.invert(),z.k.TransformCoordinatesToRef(K,F,l),k?(j.addAtIndex(12,l.x),j.addAtIndex(13,l.y),j.addAtIndex(14,l.z)):j.setTranslationFromFloats(l.x,l.y,l.z)}this._markAsDirtyAndDecompose()}translate(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,b,e,!0)}setPosition(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this._updatePosition(K,b,e,!1)}setAbsolutePosition(K,b){this.setPosition(K,1,b)}scale(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const j=this.getLocalMatrix(),F=T._TmpMats[0];z.b.ScalingToRef(K,b,e,F),F.multiplyToRef(j,j),F.invert();for(const z of this.children){const k=z.getLocalMatrix();k.multiplyToRef(F,k),k.multiplyAtIndex(12,K),k.multiplyAtIndex(13,b),k.multiplyAtIndex(14,e),z._markAsDirtyAndDecompose()}if(this._markAsDirtyAndDecompose(),k)for(const z of this.children)z.scale(K,b,e,k)}setScale(K){this._decompose(),this._localScaling.p(K),this._markAsDirtyAndCompose()}getScale(){return this._decompose(),this._localScaling}getScaleToRef(K){this._decompose(),K.p(this._localScaling)}setYawPitchRoll(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4?arguments[4]:void 0;if(0===k){const F=T._TmpQuat;return z.d.RotationYawPitchRollToRef(K,b,e,F),void this.setRotationQuaternion(F,k,j)}const F=T._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(F,j))return;const l=T._TmpMats[1];z.b.RotationYawPitchRollToRef(K,b,e,l),F.multiplyToRef(l,l),this._rotateWithMatrix(l,k,j)}rotate(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;const j=T._TmpMats[0];j.setTranslationFromFloats(0,0,0),z.b.RotationAxisToRef(K,b,j),this._rotateWithMatrix(j,e,k)}setAxisAngle(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,k=arguments.length>3?arguments[3]:void 0;if(0===e){const j=T._TmpQuat;return z.d.RotationAxisToRef(K,b,j),void this.setRotationQuaternion(j,e,k)}const j=T._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(j,k))return;const F=T._TmpMats[1];z.b.RotationAxisToRef(K,b,F),j.multiplyToRef(F,F),this._rotateWithMatrix(F,e,k)}setRotation(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;this.setYawPitchRoll(K.y,K.x,K.z,b,e)}setRotationQuaternion(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(0===b)return this._decompose(),this._localRotation.p(K),void this._markAsDirtyAndCompose();const k=T._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,e))return;const j=T._TmpMats[1];z.b.FromQuaternionToRef(K,j),k.multiplyToRef(j,j),this._rotateWithMatrix(j,b,e)}setRotationMatrix(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;if(0===b){const k=T._TmpQuat;return z.d.FromRotationMatrixToRef(K,k),void this.setRotationQuaternion(k,b,e)}const k=T._TmpMats[0];if(!this._getAbsoluteInverseMatrixUnscaledToRef(k,e))return;const j=T._TmpMats[1];j.p(K),k.multiplyToRef(K,j),this._rotateWithMatrix(j,b,e)}_rotateWithMatrix(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;const z=this.getLocalMatrix(),k=z.m[12],j=z.m[13],F=z.m[14],l=this.getParent(),Y=T._TmpMats[3],A=T._TmpMats[4];l&&1==b?(e?(Y.p(e.getWorldMatrix()),l.getAbsoluteMatrix().multiplyToRef(Y,Y)):Y.p(l.getAbsoluteMatrix()),A.p(Y),A.invert(),z.multiplyToRef(Y,z),z.multiplyToRef(K,z),z.multiplyToRef(A,z)):1==b&&e?(Y.p(e.getWorldMatrix()),A.p(Y),A.invert(),z.multiplyToRef(Y,z),z.multiplyToRef(K,z),z.multiplyToRef(A,z)):z.multiplyToRef(K,z),z.setTranslationFromFloats(k,j,F),this.computeAbsoluteMatrices(),this._markAsDirtyAndDecompose()}_getAbsoluteInverseMatrixUnscaledToRef(K,b){const e=T._TmpMats[2];return K.p(this.getAbsoluteMatrix()),b?(K.multiplyToRef(b.getWorldMatrix(),K),z.b.ScalingToRef(b.Zd.x,b.Zd.y,b.Zd.z,e)):z.b.IdentityToRef(e),K.invert(),!isNaN(K.m[0])&&(e.multiplyAtIndex(0,this._scalingDeterminant),K.multiplyToRef(e,K),!0)}cb(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=z.k.Zero();return this.getPositionToRef(K,b,e),e}getPositionToRef(){let K=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)){const K=this.getLocalMatrix();b.x=K.m[12],b.y=K.m[13],b.z=K.m[14]}else{let e=null;K&&(e=K.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();let z=T._TmpMats[0];K&&e?(z.p(this.getAbsoluteMatrix()),z.multiplyToRef(e,z)):z=this.getAbsoluteMatrix(),b.x=z.m[12],b.y=z.m[13],b.z=z.m[14]}}getAbsolutePosition(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=z.k.Zero();return this.getPositionToRef(1,K,b),b}getAbsolutePositionToRef(K,b){this.getPositionToRef(1,K,b)}computeAbsoluteMatrices(){if(this._compose(),this.parent)this.zj.multiplyToRef(this.parent._absoluteMatrix,this._absoluteMatrix);else{this._absoluteMatrix.p(this.zj);const K=this._skeleton.getPoseMatrix();K&&this._absoluteMatrix.multiplyToRef(K,this._absoluteMatrix)}const K=this.children,b=K.length;for(let e=0;e<b;e++)K[e].computeAbsoluteMatrices()}computeAbsoluteTransforms(){this.computeAbsoluteMatrices()}Me(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=z.k.Zero();return this.getDirectionToRef(K,b,e),e}getDirectionToRef(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,k=null;b&&(k=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=T._TmpMats[0];j.p(this.getAbsoluteMatrix()),b&&k&&j.multiplyToRef(k,j),z.k.TransformNormalToRef(K,j,e),e.normalize()}getRotation(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=z.k.Zero();return this.getRotationToRef(K,b,e),e}getRotationToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;const z=T._TmpQuat;this.getRotationQuaternionToRef(K,b,z),z.toEulerAnglesToRef(e)}getRotationQuaternion(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=z.d.Identity();return this.getRotationQuaternionToRef(K,b,e),e}getRotationQuaternionToRef(){let K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this._decompose(),b.p(this._localRotation);else{const e=T._TmpMats[0],z=this.getAbsoluteMatrix();K?z.multiplyToRef(K.getWorldMatrix(),e):e.p(z),e.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyAtIndex(1,this._scalingDeterminant),e.multiplyAtIndex(2,this._scalingDeterminant),e.decompose(void 0,b,void 0)}}getRotationMatrix(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0;const e=z.b.Identity();return this.getRotationMatrixToRef(K,b,e),e}getRotationMatrixToRef(){let K=arguments.length>1?arguments[1]:void 0,b=arguments.length>2?arguments[2]:void 0;if(0==(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0))this.getLocalMatrix().getRotationMatrixToRef(b);else{const e=T._TmpMats[0],z=this.getAbsoluteMatrix();K?z.multiplyToRef(K.getWorldMatrix(),e):e.p(z),e.multiplyAtIndex(0,this._scalingDeterminant),e.multiplyAtIndex(1,this._scalingDeterminant),e.multiplyAtIndex(2,this._scalingDeterminant),e.getRotationMatrixToRef(b)}}getAbsolutePositionFromLocal(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=z.k.Zero();return this.getAbsolutePositionFromLocalToRef(K,b,e),e}getAbsolutePositionFromLocalToRef(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,k=null;b&&(k=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=T._TmpMats[0];j.p(this.getAbsoluteMatrix()),b&&k&&j.multiplyToRef(k,j),z.k.TransformCoordinatesToRef(K,j,e)}getLocalPositionFromAbsolute(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=z.k.Zero();return this.getLocalPositionFromAbsoluteToRef(K,b,e),e}getLocalPositionFromAbsoluteToRef(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,k=null;b&&(k=b.getWorldMatrix()),this._skeleton.computeAbsoluteMatrices();const j=T._TmpMats[0];j.p(this.getAbsoluteMatrix()),b&&k&&j.multiplyToRef(k,j),j.invert(),z.k.TransformCoordinatesToRef(K,j,e)}setCurrentPoseAsRest(){this.setRestMatrix(this.getLocalMatrix())}}T._TmpVecs=(0,k.e)(2,z.k.Zero),T._TmpQuat=z.d.Identity(),T._TmpMats=(0,k.e)(5,z.b.Identity)},11030:(K,b,e)=>{"use strict";e.d(b,{b:()=>j,f:()=>T});var z=e(11033),k=e(10696);class j{get u(){return this._isDisposed}constructor(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],T=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8?arguments[8]:void 0;this._isAlreadyOwned=!1,this._isDisposed=!1,K&&K.va?this._engine=K.va().getEngine():this._engine=K,this._updatable=e,this._instanced=T,this._divisor=l||1,this._label=Y,b instanceof z.b?(this._data=null,this._buffer=b):(this._data=b,this._buffer=null),this.byteStride=F?k:k*Float32Array.BYTES_PER_ELEMENT,j||this.create()}createVertexBuffer(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],F=arguments.length>6?arguments[6]:void 0;const l=j?b:b*Float32Array.BYTES_PER_ELEMENT,Y=z?j?z:z*Float32Array.BYTES_PER_ELEMENT:this.byteStride;return new T(this._engine,this,K,this._updatable,!0,Y,void 0===k?this._instanced:k,l,e,void 0,void 0,!0,this._divisor||F)}isUpdatable(){return this._updatable}getData(){return this._data}getBuffer(){return this._buffer}getStrideSize(){return this.byteStride/Float32Array.BYTES_PER_ELEMENT}create(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;!K&&this._buffer||(K=K||this._data,K&&(this._buffer?this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,K),this._data=K):this._updatable?(this._buffer=this._engine.createDynamicVertexBuffer(K,this._label),this._data=K):this._buffer=this._engine.createVertexBuffer(K,void 0,this._label)))}_rebuild(){if(this._data)this._buffer=null,this.create(this._data);else{if(!this._buffer)return;if(this._buffer.kb>0)return void(this._updatable?this._buffer=this._engine.createDynamicVertexBuffer(this._buffer.kb,this._label):this._buffer=this._engine.createVertexBuffer(this._buffer.kb,void 0,this._label));k.b.Warn(`Missing data for buffer "${this._label}" ${this._buffer?"(uniqueId: "+this._buffer.uniqueId+")":""}. Buffer reconstruction failed.`),this._buffer=null}}update(K){this.create(K)}updateDirectly(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._buffer&&this._updatable&&(this._engine.updateDynamicVertexBuffer(this._buffer,K,z?b:b*Float32Array.BYTES_PER_ELEMENT,e?e*this.byteStride:void 0),this._data=0===b&&void 0===e?K:null)}_increaseReferences(){this._buffer&&(this._isAlreadyOwned?this._buffer.references++:this._isAlreadyOwned=!0)}dispose(){this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._isDisposed=!0,this._data=null,this._buffer=null)}}class T{get u(){return this._isDisposed}get instanceDivisor(){return this._instanceDivisor}set instanceDivisor(K){const b=0!=K;this._instanceDivisor=K,b!==this._instanced&&(this._instanced=b,this._computeHashCode())}get _maxVerticesCount(){const K=this.getData();return K?Array.isArray(K)?K.length/(this.byteStride/4)-this.byteOffset/4:(K.byteLength-this.byteOffset)/this.byteStride:0}constructor(K,b,e,z,k,F,l,Y,A,X){let t=arguments.length>10&&void 0!==arguments[10]&&arguments[10],U=arguments.length>11&&void 0!==arguments[11]&&arguments[11],B=arguments.length>12&&void 0!==arguments[12]?arguments[12]:1,u=arguments.length>13&&void 0!==arguments[13]&&arguments[13];this._isDisposed=!1;let m=!1;if(this.kd=K,"object"===typeof z&&null!==z?(m=z.updatable??!1,k=z.postponeInternalCreation,F=z.stride,l=z.instanced,Y=z.offset,A=z.size,X=z.type,t=z.normalized??!1,U=z.useBytes??!1,B=z.divisor??1,u=z.takeBufferOwnership??!1,this._label=z.label):m=!!z,b instanceof j?(this._buffer=b,this._ownsBuffer=u):(this._buffer=new j(K,b,m,F,k,l,U,B,this._label),this._ownsBuffer=!0),this.uniqueId=T._Counter++,this._kind=e,void 0===X){const K=this.getData();this.type=K?T.GetDataType(K):T.FLOAT}else this.type=X;const D=T.GetTypeByteLength(this.type);U?(this._size=A||(F?F/D:T.DeduceStride(e)),this.byteStride=F||this._buffer.byteStride||this._size*D,this.byteOffset=Y||0):(this._size=A||F||T.DeduceStride(e),this.byteStride=F?F*D:this._buffer.byteStride||this._size*D,this.byteOffset=(Y||0)*D),this.normalized=t,this._instanced=void 0!==l&&l,this._instanceDivisor=l?B:0,this._alignBuffer(),this._computeHashCode()}_computeHashCode(){this.hashCode=(this.type-5120|0)+((this.normalized?1:0)<<3)+(this._size<<4)+((this._instanced?1:0)<<6)+(this.byteStride<<12)}_rebuild(){var K;null===(K=this._buffer)||void 0===K||K._rebuild()}getKind(){return this._kind}isUpdatable(){return this._buffer.isUpdatable()}getData(){return this._buffer.getData()}getFloatData(K,b){const e=this.getData();return e?T.GetFloatData(e,this._size,this.type,this.byteOffset,this.byteStride,this.normalized,K,b):null}getBuffer(){return this._buffer.getBuffer()}getWrapperBuffer(){return this._buffer}getStrideSize(){return this.byteStride/T.GetTypeByteLength(this.type)}getOffset(){return this.byteOffset/T.GetTypeByteLength(this.type)}getSize(){return arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._size*T.GetTypeByteLength(this.type):this._size}getIsInstanced(){return this._instanced}getInstanceDivisor(){return this._instanceDivisor}create(K){this._buffer.create(K),this._alignBuffer()}update(K){this._buffer.update(K),this._alignBuffer()}updateDirectly(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._buffer.updateDirectly(K,b,void 0,e),this._alignBuffer()}dispose(){this._ownsBuffer&&this._buffer.dispose(),this._isDisposed=!0}forEach(K,b){T.ForEach(this._buffer.getData(),this.byteOffset,this.byteStride,this._size,this.type,K,this.normalized,b)}_alignBuffer(){}static DeduceStride(K){switch(K){case T.UVKind:case T.UV2Kind:case T.UV3Kind:case T.UV4Kind:case T.UV5Kind:case T.UV6Kind:return 2;case T.NormalKind:case T.PositionKind:return 3;case T.ColorKind:case T.ColorInstanceKind:case T.MatricesIndicesKind:case T.MatricesIndicesExtraKind:case T.MatricesWeightsKind:case T.MatricesWeightsExtraKind:case T.TangentKind:return 4;default:throw new Error("Invalid kind '"+K+"'")}}static GetDataType(K){return K instanceof Int8Array?T.BYTE:K instanceof Uint8Array?T.UNSIGNED_BYTE:K instanceof Int16Array?T.SHORT:K instanceof Uint16Array?T.UNSIGNED_SHORT:K instanceof Int32Array?T.INT:K instanceof Uint32Array?T.UNSIGNED_INT:T.FLOAT}static GetTypeByteLength(K){switch(K){case T.BYTE:case T.UNSIGNED_BYTE:return 1;case T.SHORT:case T.UNSIGNED_SHORT:return 2;case T.INT:case T.UNSIGNED_INT:case T.FLOAT:return 4;default:throw new Error(`Invalid type '${K}'`)}}static ForEach(K,b,e,z,k,j,F,l){if(K instanceof Array){let k=b/4;const T=e/4;for(let b=0;b<j;b+=z){for(let e=0;e<z;e++)l(K[k+e],b+e);k+=T}}else{const Y=K instanceof ArrayBuffer?new DataView(K):new DataView(K.buffer,K.byteOffset,K.byteLength),A=T.GetTypeByteLength(k);for(let K=0;K<j;K+=z){let j=b;for(let b=0;b<z;b++){l(T._GetFloatValue(Y,k,j,F),K+b),j+=A}b+=e}}}static _GetFloatValue(K,b,e,z){switch(b){case T.BYTE:{let b=K.getInt8(e);return z&&(b=Math.max(b/127,-1)),b}case T.UNSIGNED_BYTE:{let b=K.getUint8(e);return z&&(b/=255),b}case T.SHORT:{let b=K.getInt16(e,!0);return z&&(b=Math.max(b/32767,-1)),b}case T.UNSIGNED_SHORT:{let b=K.getUint16(e,!0);return z&&(b/=65535),b}case T.INT:return K.getInt32(e,!0);case T.UNSIGNED_INT:return K.getUint32(e,!0);case T.FLOAT:return K.getFloat32(e,!0);default:throw new Error(`Invalid component type ${b}`)}}static GetFloatData(K,b,e,z,j,F,l,Y){const A=b*T.GetTypeByteLength(e),X=l*b;if(e!==T.FLOAT||j!==A){const k=new Float32Array(X);return T.ForEach(K,z,j,b,e,X,F,((K,b)=>k[b]=K)),k}if(!(K instanceof Array||K instanceof Float32Array)||0!==z||K.length!==X){if(K instanceof Array){const b=z/4;return K.slice(b,b+X)}if(K instanceof ArrayBuffer)return new Float32Array(K,z,X);{const b=K.byteOffset+z;if(0!==(3&b)&&(k.b.Warn("Float array must be aligned to 4-bytes border"),Y=!0),Y){const e=new Uint8Array(X*Float32Array.BYTES_PER_ELEMENT),z=new Uint8Array(K.buffer,b,e.length);return e.set(z),new Float32Array(e.buffer)}return new Float32Array(K.buffer,b,X)}}return Y?K.slice():K}}T._Counter=0,T.BYTE=5120,T.UNSIGNED_BYTE=5121,T.SHORT=5122,T.UNSIGNED_SHORT=5123,T.INT=5124,T.UNSIGNED_INT=5125,T.FLOAT=5126,T.PositionKind="position",T.NormalKind="normal",T.TangentKind="tangent",T.UVKind="uv",T.UV2Kind="uv2",T.UV3Kind="uv3",T.UV4Kind="uv4",T.UV5Kind="uv5",T.UV6Kind="uv6",T.ColorKind="color",T.ColorInstanceKind="instanceColor",T.MatricesIndicesKind="matricesIndices",T.MatricesWeightsKind="matricesWeights",T.MatricesIndicesExtraKind="matricesIndicesExtra",T.MatricesWeightsExtraKind="matricesWeightsExtra"},11033:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{get underlyingResource(){return null}constructor(){this.references=0,this.kb=0,this.is32Bits=!1,this.uniqueId=z._Counter++}}z._Counter=0},12339:(K,b,e)=>{"use strict";e.d(b,{d:()=>R});var z=e(10936),k=e(10938),j=e(10690),T=e(10967),F=e(11243),l=e(11226),Y=e(11054),A=e(10707),X=e(10969);class t{constructor(){this._zoomStopsAnimation=!1,this._idleRotationSpeed=.05,this._idleRotationWaitTime=2e3,this._idleRotationSpinupTime=2e3,this.targetAlpha=null,this._isPointerDown=!1,this._lastFrameTime=null,this._lastInteractionTime=-1/0,this._cameraRotationSpeed=0,this._lastFrameRadius=0}get name(){return"AutoRotation"}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set idleRotationSpeed(K){this._idleRotationSpeed=K}get idleRotationSpeed(){return this._idleRotationSpeed}set idleRotationWaitTime(K){this._idleRotationWaitTime=K}get idleRotationWaitTime(){return this._idleRotationWaitTime}set idleRotationSpinupTime(K){this._idleRotationSpinupTime=K}get idleRotationSpinupTime(){return this._idleRotationSpinupTime}get rotationInProgress(){return Math.abs(this._cameraRotationSpeed)>0}init(){}attach(K){this._attachedCamera=K;const b=this._attachedCamera.va();this._onPrePointerObservableObserver=b.onPrePointerObservable.add((K=>{K.type!==Y.b.POINTERDOWN?K.type===Y.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{if(this._reachTargetAlpha())return;const K=A.e.Now;let b=0;null!=this._lastFrameTime&&(b=K-this._lastFrameTime),this._lastFrameTime=K,this._applyUserInteraction();const e=K-this._lastInteractionTime-this._idleRotationWaitTime,z=Math.max(Math.min(e/this._idleRotationSpinupTime,1),0);this._cameraRotationSpeed=this._idleRotationSpeed*z,this._attachedCamera&&(this._attachedCamera.alpha-=this._cameraRotationSpeed*(b/1e3))}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.va();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._attachedCamera=null,this._lastFrameTime=null}resetLastInteractionTime(K){this._lastInteractionTime=K??A.e.Now}_reachTargetAlpha(){return!(!this._attachedCamera||!this.targetAlpha)&&Math.abs(this._attachedCamera.alpha-this.targetAlpha)<X.c}_userIsZooming(){return!!this._attachedCamera&&0!==this._attachedCamera.inertialRadiusOffset}_shouldAnimationStopForInteraction(){if(!this._attachedCamera)return!1;let K=!1;return this._lastFrameRadius===this._attachedCamera.radius&&0!==this._attachedCamera.inertialRadiusOffset&&(K=!0),this._lastFrameRadius=this._attachedCamera.radius,this._zoomStopsAnimation?K:this._userIsZooming()}_applyUserInteraction(){this._userIsMoving()&&!this._shouldAnimationStopForInteraction()&&(this._lastInteractionTime=A.e.Now)}_userIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}e(11491);class U{constructor(){this._easingMode=U.EASINGMODE_EASEIN}setEasingMode(K){const b=Math.min(Math.max(K,0),2);this._easingMode=b}getEasingMode(){return this._easingMode}easeInCore(K){throw new Error("You must implement this method")}ease(K){switch(this._easingMode){case U.EASINGMODE_EASEIN:return this.easeInCore(K);case U.EASINGMODE_EASEOUT:return 1-this.easeInCore(1-K)}return K>=.5?.5*(1-this.easeInCore(2*(1-K)))+.5:.5*this.easeInCore(2*K)}}U.EASINGMODE_EASEIN=0,U.EASINGMODE_EASEOUT=1,U.EASINGMODE_EASEINOUT=2;var B=e(11896);class u{constructor(){this.transitionDuration=450,this.lowerRadiusTransitionRange=2,this.upperRadiusTransitionRange=-2,this._autoTransitionRange=!1,this._radiusIsAnimating=!1,this._radiusBounceTransition=null,this._animatables=new Array}get name(){return"Bouncing"}get autoTransitionRange(){return this._autoTransitionRange}set autoTransitionRange(K){if(this._autoTransitionRange===K)return;this._autoTransitionRange=K;const b=this._attachedCamera;b&&(K?this._onMeshTargetChangedObserver=b.onMeshTargetChangedObservable.add((K=>{if(K&&(K.xj(!0),K.getBoundingInfo)){const b=K.getBoundingInfo().diagonalLength;this.lowerRadiusTransitionRange=.05*b,this.upperRadiusTransitionRange=.05*b}})):this._onMeshTargetChangedObserver&&b.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver))}init(){}attach(K){this._attachedCamera=K,this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._attachedCamera&&(this._isRadiusAtLimit(this._attachedCamera.lowerRadiusLimit)&&this._applyBoundRadiusAnimation(this.lowerRadiusTransitionRange),this._isRadiusAtLimit(this._attachedCamera.upperRadiusLimit)&&this._applyBoundRadiusAnimation(this.upperRadiusTransitionRange))}))}detach(){this._attachedCamera&&(this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null)}_isRadiusAtLimit(K){return!!this._attachedCamera&&(this._attachedCamera.radius===K&&!this._radiusIsAnimating)}_applyBoundRadiusAnimation(K){if(!this._attachedCamera)return;this._radiusBounceTransition||(u.EasingFunction.setEasingMode(u.EasingMode),this._radiusBounceTransition=B.c.CreateAnimation("radius",B.c.ANIMATIONTYPE_FLOAT,60,u.EasingFunction)),this._cachedWheelPrecision=this._attachedCamera.wheelPrecision,this._attachedCamera.wheelPrecision=1/0,this._attachedCamera.inertialRadiusOffset=0,this.stopAllAnimations(),this._radiusIsAnimating=!0;const b=B.c.TransitionTo("radius",this._attachedCamera.radius+K,this._attachedCamera,this._attachedCamera.va(),60,this._radiusBounceTransition,this.transitionDuration,(()=>this._clearAnimationLocks()));b&&this._animatables.push(b)}_clearAnimationLocks(){this._radiusIsAnimating=!1,this._attachedCamera&&(this._attachedCamera.wheelPrecision=this._cachedWheelPrecision)}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0].onAnimationEnd=null,this._animatables[0].stop(),this._animatables.shift()}}u.EasingFunction=new class extends U{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;super(),this.amplitude=K}easeInCore(K){const b=Math.max(0,this.amplitude);return Math.pow(K,3)-K*b*Math.sin(3.141592653589793*K)}}(.3),u.EasingMode=U.EASINGMODE_EASEOUT;class m{constructor(){this.onTargetFramingAnimationEndObservable=new j.d,this._mode=m.FitFrustumSidesMode,this._radiusScale=1,this._positionScale=.5,this._defaultElevation=.3,this._elevationReturnTime=1500,this._elevationReturnWaitTime=1e3,this._zoomStopsAnimation=!1,this._framingTime=1500,this.autoCorrectCameraLimitsAndSensibility=!0,this._isPointerDown=!1,this._lastInteractionTime=-1/0,this._animatables=new Array,this._betaIsAnimating=!1}get name(){return"Framing"}set mode(K){this._mode=K}get mode(){return this._mode}set radiusScale(K){this._radiusScale=K}get radiusScale(){return this._radiusScale}set positionScale(K){this._positionScale=K}get positionScale(){return this._positionScale}set defaultElevation(K){this._defaultElevation=K}get defaultElevation(){return this._defaultElevation}set elevationReturnTime(K){this._elevationReturnTime=K}get elevationReturnTime(){return this._elevationReturnTime}set elevationReturnWaitTime(K){this._elevationReturnWaitTime=K}get elevationReturnWaitTime(){return this._elevationReturnWaitTime}set zoomStopsAnimation(K){this._zoomStopsAnimation=K}get zoomStopsAnimation(){return this._zoomStopsAnimation}set framingTime(K){this._framingTime=K}get framingTime(){return this._framingTime}init(){}attach(K){this._attachedCamera=K;const b=this._attachedCamera.va();m.EasingFunction.setEasingMode(m.EasingMode),this._onPrePointerObservableObserver=b.onPrePointerObservable.add((K=>{K.type!==Y.b.POINTERDOWN?K.type===Y.b.POINTERUP&&(this._isPointerDown=!1):this._isPointerDown=!0})),this._onMeshTargetChangedObserver=K.onMeshTargetChangedObservable.add((K=>{K&&K.getBoundingInfo&&this.zoomOnMesh(K,void 0,(()=>{this.onTargetFramingAnimationEndObservable.notifyObservers()}))})),this._onAfterCheckInputsObserver=K.onAfterCheckInputsObservable.add((()=>{this._applyUserInteraction(),this._maintainCameraAboveGround()}))}detach(){if(!this._attachedCamera)return;const K=this._attachedCamera.va();this._onPrePointerObservableObserver&&K.onPrePointerObservable.remove(this._onPrePointerObservableObserver),this._onAfterCheckInputsObserver&&this._attachedCamera.onAfterCheckInputsObservable.remove(this._onAfterCheckInputsObserver),this._onMeshTargetChangedObserver&&this._attachedCamera.onMeshTargetChangedObservable.remove(this._onMeshTargetChangedObserver),this._attachedCamera=null}zoomOnMesh(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.xj(!0);const z=K.getBoundingInfo().boundingBox;this.zoomOnBoundingInfo(z.minimumWorld,z.maximumWorld,b,e)}zoomOnMeshHierarchy(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;K.xj(!0);const z=K.getHierarchyBoundingVectors(!0);this.zoomOnBoundingInfo(z.min,z.max,b,e)}zoomOnMeshesHierarchy(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new T.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),k=new T.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(let j=0;j<K.length;j++){const b=K[j].getHierarchyBoundingVectors(!0);T.k.CheckExtends(b.min,z,k),T.k.CheckExtends(b.max,z,k)}this.zoomOnBoundingInfo(z,k,b,e)}zoomOnBoundingInfo(K,b){let e,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!this._attachedCamera)return!1;const j=K.y,F=j+(b.y-j)*this._positionScale,l=b.Qc(K).scale(.5);if(z)e=new T.k(0,F,0);else{const b=K.add(l);e=new T.k(b.x,F,b.z)}this._vectorTransition||(this._vectorTransition=B.c.CreateAnimation("target",B.c.ANIMATIONTYPE_VECTOR3,60,m.EasingFunction)),this._betaIsAnimating=!0;let Y=B.c.TransitionTo("target",e,this._attachedCamera,this._attachedCamera.va(),60,this._vectorTransition,this._framingTime);Y&&this._animatables.push(Y);let A=0;if(this._mode===m.FitFrustumSidesMode){const e=this._calculateLowerRadiusFromModelBoundingSphere(K,b);this.autoCorrectCameraLimitsAndSensibility&&(this._attachedCamera.lowerRadiusLimit=l.length()+this._attachedCamera.Fi),A=e}else this._mode===m.IgnoreBoundsSizeMode&&(A=this._calculateLowerRadiusFromModelBoundingSphere(K,b),this.autoCorrectCameraLimitsAndSensibility&&null===this._attachedCamera.lowerRadiusLimit&&(this._attachedCamera.lowerRadiusLimit=this._attachedCamera.Fi));if(this.autoCorrectCameraLimitsAndSensibility){const e=b.Qc(K).length();this._attachedCamera.panningSensibility=5e3/e,this._attachedCamera.wheelPrecision=100/A}return this._radiusTransition||(this._radiusTransition=B.c.CreateAnimation("radius",B.c.ANIMATIONTYPE_FLOAT,60,m.EasingFunction)),Y=B.c.TransitionTo("radius",A,this._attachedCamera,this._attachedCamera.va(),60,this._radiusTransition,this._framingTime,(()=>{this.stopAllAnimations(),k&&k(),this._attachedCamera&&this._attachedCamera.useInputToRestoreState&&this._attachedCamera.storeState()})),Y&&this._animatables.push(Y),!0}_calculateLowerRadiusFromModelBoundingSphere(K,b){const e=this._attachedCamera;if(!e)return 0;let z=e._calculateLowerRadiusFromModelBoundingSphere(K,b,this._radiusScale);return e.lowerRadiusLimit&&this._mode===m.IgnoreBoundsSizeMode&&(z=z<e.lowerRadiusLimit?e.lowerRadiusLimit:z),e.upperRadiusLimit&&(z=z>e.upperRadiusLimit?e.upperRadiusLimit:z),z}_maintainCameraAboveGround(){if(this._elevationReturnTime<0)return;const K=A.e.Now-this._lastInteractionTime,b=.5*Math.PI-this._defaultElevation,e=.5*Math.PI;if(this._attachedCamera&&!this._betaIsAnimating&&this._attachedCamera.beta>e&&K>=this._elevationReturnWaitTime){this._betaIsAnimating=!0,this.stopAllAnimations(),this._betaTransition||(this._betaTransition=B.c.CreateAnimation("beta",B.c.ANIMATIONTYPE_FLOAT,60,m.EasingFunction));const K=B.c.TransitionTo("beta",b,this._attachedCamera,this._attachedCamera.va(),60,this._betaTransition,this._elevationReturnTime,(()=>{this._clearAnimationLocks(),this.stopAllAnimations()}));K&&this._animatables.push(K)}}_clearAnimationLocks(){this._betaIsAnimating=!1}_applyUserInteraction(){this.isUserIsMoving&&(this._lastInteractionTime=A.e.Now,this.stopAllAnimations(),this._clearAnimationLocks())}stopAllAnimations(){for(this._attachedCamera&&(this._attachedCamera.animations=[]);this._animatables.length;)this._animatables[0]&&(this._animatables[0].onAnimationEnd=null,this._animatables[0].stop()),this._animatables.shift()}get isUserIsMoving(){return!!this._attachedCamera&&(0!==this._attachedCamera.inertialAlphaOffset||0!==this._attachedCamera.inertialBetaOffset||0!==this._attachedCamera.inertialRadiusOffset||0!==this._attachedCamera.inertialPanningX||0!==this._attachedCamera.inertialPanningY||this._isPointerDown)}}m.EasingFunction=new class extends U{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2;super(),this.exponent=K}easeInCore(K){return this.exponent<=0?K:(Math.exp(this.exponent*K)-1)/(Math.exp(this.exponent)-1)}},m.EasingMode=U.EASINGMODE_EASEINOUT,m.IgnoreBoundsSizeMode=0,m.FitFrustumSidesMode=1;var D=e(11237),I=e(11885),x=e(11887),Q=e(10686);class G{constructor(){this._currentActiveButton=-1,this.buttons=[0,1,2]}attachControl(K){K=Q.f.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),e=b.getInputElement();let z=0,k=null;this._pointA=null,this._pointB=null,this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._pointerInput=j=>{var T,F;const l=j.event,A="touch"===l.pointerType;if(j.type!==Y.b.POINTERMOVE&&-1===this.buttons.indexOf(l.button))return;const X=l.target;if(this._altKey=l.altKey,this._ctrlKey=l.ctrlKey,this._metaKey=l.metaKey,this._shiftKey=l.shiftKey,this._buttonsPressed=l.buttons,b.isPointerLock){const K=l.movementX,b=l.movementY;this.onTouch(null,K,b),this._pointA=null,this._pointB=null}else{if(j.type!==Y.b.POINTERDOWN&&j.type!==Y.b.POINTERDOUBLETAP&&A&&(null===(T=this._pointA)||void 0===T?void 0:T.pointerId)!==l.pointerId&&(null===(F=this._pointB)||void 0===F?void 0:F.pointerId)!==l.pointerId)return;if(j.type!==Y.b.POINTERDOWN||-1!==this._currentActiveButton&&!A)if(j.type===Y.b.POINTERDOUBLETAP)this.onDoubleTap(l.pointerType);else if(j.type!==Y.b.POINTERUP||this._currentActiveButton!==l.button&&!A){if(j.type===Y.b.POINTERMOVE)if(K||l.preventDefault(),this._pointA&&null===this._pointB){const K=l.clientX-this._pointA.x,b=l.clientY-this._pointA.y;this._pointA.x=l.clientX,this._pointA.y=l.clientY,this.onTouch(this._pointA,K,b)}else if(this._pointA&&this._pointB){const K=this._pointA.pointerId===l.pointerId?this._pointA:this._pointB;K.x=l.clientX,K.y=l.clientY;const b=this._pointA.x-this._pointB.x,e=this._pointA.y-this._pointB.y,T=b*b+e*e,F={x:(this._pointA.x+this._pointB.x)/2,y:(this._pointA.y+this._pointB.y)/2,pointerId:l.pointerId,type:j.type};this.onMultiTouch(this._pointA,this._pointB,z,T,k,F),k=F,z=T}}else{try{null===X||void 0===X||X.releasePointerCapture(l.pointerId)}catch(t){}A||(this._pointB=null),b._badOS?this._pointA=this._pointB=null:this._pointB&&this._pointA&&this._pointA.pointerId==l.pointerId?(this._pointA=this._pointB,this._pointB=null):this._pointA&&this._pointB&&this._pointB.pointerId==l.pointerId?this._pointB=null:this._pointA=this._pointB=null,(0!==z||k)&&(this.onMultiTouch(this._pointA,this._pointB,z,0,k,null),z=0,k=null),this._currentActiveButton=-1,this.onButtonUp(l),K||l.preventDefault()}else{try{null===X||void 0===X||X.setPointerCapture(l.pointerId)}catch(t){}if(null===this._pointA)this._pointA={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType};else{if(null!==this._pointB)return;this._pointB={x:l.clientX,y:l.clientY,pointerId:l.pointerId,type:l.pointerType}}-1!==this._currentActiveButton||A||(this._currentActiveButton=l.button),this.onButtonDown(l),K||(l.preventDefault(),e&&e.focus())}}},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,Y.b.POINTERDOWN|Y.b.POINTERUP|Y.b.POINTERMOVE|Y.b.POINTERDOUBLETAP),this._onLostFocus=()=>{this._pointA=this._pointB=null,z=0,k=null,this.onLostFocus()},this._contextMenuBind=K=>this.onContextMenu(K),e&&e.addEventListener("contextmenu",this._contextMenuBind,!1);const j=this.camera.va().getEngine().getHostWindow();j&&Q.f.RegisterTopRootEvents(j,[{name:"blur",handler:this._onLostFocus}])}Bi(){if(this._onLostFocus){const K=this.camera.va().getEngine().getHostWindow();K&&Q.f.UnregisterTopRootEvents(K,[{name:"blur",handler:this._onLostFocus}])}if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._contextMenuBind){const K=this.camera.va().getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this._onLostFocus=null}this._altKey=!1,this._ctrlKey=!1,this._metaKey=!1,this._shiftKey=!1,this._buttonsPressed=0,this._currentActiveButton=-1}getClassName(){return"BaseCameraPointersInput"}getSimpleName(){return"pointers"}onDoubleTap(K){}onTouch(K,b,e){}onMultiTouch(K,b,e,z,k,j){}onContextMenu(K){K.preventDefault()}onButtonDown(K){}onButtonUp(K){}onLostFocus(){}}(0,z.b)([(0,k.M)()],G.prototype,"buttons",void 0);class i extends G{constructor(){super(...arguments),this.buttons=[0,1,2],this.angularSensibilityX=1e3,this.angularSensibilityY=1e3,this.pinchPrecision=12,this.pinchDeltaPercentage=0,this.useNaturalPinchZoom=!1,this.pinchZoom=!0,this.panningSensibility=1e3,this.multiTouchPanning=!0,this.multiTouchPanAndZoom=!0,this.pinchInwards=!0,this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}getClassName(){return"ArcRotateCameraPointersInput"}_computeMultiTouchPanning(K,b){if(0!==this.panningSensibility&&K&&b){const e=b.x-K.x,z=b.y-K.y;this.camera.inertialPanningX+=-e/this.panningSensibility,this.camera.inertialPanningY+=z/this.panningSensibility}}_computePinchZoom(K,b){const e=this.camera.radius||i.MinimumRadiusForPinch;this.useNaturalPinchZoom?this.camera.radius=e*Math.sqrt(K)/Math.sqrt(b):this.pinchDeltaPercentage?this.camera.inertialRadiusOffset+=.001*(b-K)*e*this.pinchDeltaPercentage:this.camera.inertialRadiusOffset+=(b-K)/(this.pinchPrecision*(this.pinchInwards?1:-1)*(this.angularSensibilityX+this.angularSensibilityY)/2)}onTouch(K,b,e){0!==this.panningSensibility&&(this._ctrlKey&&this.camera._useCtrlForPanning||this._isPanClick)?(this.camera.inertialPanningX+=-b/this.panningSensibility,this.camera.inertialPanningY+=e/this.panningSensibility):(this.camera.inertialAlphaOffset-=b/this.angularSensibilityX,this.camera.inertialBetaOffset-=e/this.angularSensibilityY)}onDoubleTap(){this.camera.useInputToRestoreState&&this.camera.restoreState()}onMultiTouch(K,b,e,z,k,j){0===e&&null===k||0===z&&null===j||(this.multiTouchPanAndZoom?(this._computePinchZoom(e,z),this._computeMultiTouchPanning(k,j)):this.multiTouchPanning&&this.pinchZoom?(this._twoFingerActivityCount++,this._isPinching||this._twoFingerActivityCount<20&&Math.abs(Math.sqrt(z)-Math.sqrt(e))>this.camera.pinchToPanMaxDistance?(this._computePinchZoom(e,z),this._isPinching=!0):this._computeMultiTouchPanning(k,j)):this.multiTouchPanning?this._computeMultiTouchPanning(k,j):this.pinchZoom&&this._computePinchZoom(e,z))}onButtonDown(K){this._isPanClick=K.button===this.camera._panningMouseButton}onButtonUp(K){this._twoFingerActivityCount=0,this._isPinching=!1}onLostFocus(){this._isPanClick=!1,this._twoFingerActivityCount=0,this._isPinching=!1}}i.MinimumRadiusForPinch=.001,(0,z.b)([(0,k.M)()],i.prototype,"buttons",void 0),(0,z.b)([(0,k.M)()],i.prototype,"angularSensibilityX",void 0),(0,z.b)([(0,k.M)()],i.prototype,"angularSensibilityY",void 0),(0,z.b)([(0,k.M)()],i.prototype,"pinchPrecision",void 0),(0,z.b)([(0,k.M)()],i.prototype,"pinchDeltaPercentage",void 0),(0,z.b)([(0,k.M)()],i.prototype,"useNaturalPinchZoom",void 0),(0,z.b)([(0,k.M)()],i.prototype,"pinchZoom",void 0),(0,z.b)([(0,k.M)()],i.prototype,"panningSensibility",void 0),(0,z.b)([(0,k.M)()],i.prototype,"multiTouchPanning",void 0),(0,z.b)([(0,k.M)()],i.prototype,"multiTouchPanAndZoom",void 0),x.c.ArcRotateCameraPointersInput=i;var S=e(11057);class M{constructor(){this.keysUp=[38],this.keysDown=[40],this.keysLeft=[37],this.keysRight=[39],this.keysReset=[220],this.panningSensibility=50,this.zoomingSensibility=25,this.useAltToZoom=!0,this.angularSpeed=.01,this._keys=new Array}attachControl(K){K=Q.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const e=b.event;if(!e.metaKey)if(b.type===S.e.KEYDOWN){if(this._ctrlPressed=e.ctrlKey,this._altPressed=e.altKey,-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysReset.indexOf(e.keyCode)){-1===this._keys.indexOf(e.keyCode)&&this._keys.push(e.keyCode),e.preventDefault&&(K||e.preventDefault())}}else if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysReset.indexOf(e.keyCode)){const b=this._keys.indexOf(e.keyCode);b>=0&&this._keys.splice(b,1),e.preventDefault&&(K||e.preventDefault())}})))}Bi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let b=0;b<this._keys.length;b++){const e=this._keys[b];-1!==this.keysLeft.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX-=1/this.panningSensibility:K.inertialAlphaOffset-=this.angularSpeed:-1!==this.keysUp.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY+=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset+=1/this.zoomingSensibility:K.inertialBetaOffset-=this.angularSpeed:-1!==this.keysRight.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningX+=1/this.panningSensibility:K.inertialAlphaOffset+=this.angularSpeed:-1!==this.keysDown.indexOf(e)?this._ctrlPressed&&this.camera._useCtrlForPanning?K.inertialPanningY-=1/this.panningSensibility:this._altPressed&&this.useAltToZoom?K.inertialRadiusOffset-=1/this.zoomingSensibility:K.inertialBetaOffset+=this.angularSpeed:-1!==this.keysReset.indexOf(e)&&K.useInputToRestoreState&&K.restoreState()}}}getClassName(){return"ArcRotateCameraKeyboardMoveInput"}getSimpleName(){return"keyboard"}}(0,z.b)([(0,k.M)()],M.prototype,"keysUp",void 0),(0,z.b)([(0,k.M)()],M.prototype,"keysDown",void 0),(0,z.b)([(0,k.M)()],M.prototype,"keysLeft",void 0),(0,z.b)([(0,k.M)()],M.prototype,"keysRight",void 0),(0,z.b)([(0,k.M)()],M.prototype,"keysReset",void 0),(0,z.b)([(0,k.M)()],M.prototype,"panningSensibility",void 0),(0,z.b)([(0,k.M)()],M.prototype,"zoomingSensibility",void 0),(0,z.b)([(0,k.M)()],M.prototype,"useAltToZoom",void 0),(0,z.b)([(0,k.M)()],M.prototype,"angularSpeed",void 0),x.c.ArcRotateCameraKeyboardMoveInput=M;var r=e(11068),L=e(11059),c=e(10984);class v{constructor(){this.wheelPrecision=3,this.zoomToMouseLocation=!1,this.wheelDeltaPercentage=0,this.customComputeDeltaFromMouseWheel=null,this._viewOffset=new T.k(0,0,0),this._globalOffset=new T.k(0,0,0),this._inertialPanning=T.k.Zero()}_computeDeltaFromMouseWheelLegacyEvent(K,b){let e=0;const z=.01*K*this.wheelDeltaPercentage*b;return e=K>0?z/(1+this.wheelDeltaPercentage):z*(1+this.wheelDeltaPercentage),e}attachControl(K){K=Q.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==Y.b.POINTERWHEEL)return;const e=b.event;let z=0;const k=e.deltaMode===L.e.DOM_DELTA_LINE?40:1,j=-e.deltaY*k;if(this.customComputeDeltaFromMouseWheel)z=this.customComputeDeltaFromMouseWheel(j,this,e);else if(this.wheelDeltaPercentage){if(z=this._computeDeltaFromMouseWheelLegacyEvent(j,this.camera.radius),z>0){let K=this.camera.radius,b=this.camera.inertialRadiusOffset+z;for(let e=0;e<20&&Math.abs(b)>.001;e++)K-=b,b*=this.camera.inertia;K=(0,c.e)(K,0,Number.MAX_VALUE),z=this._computeDeltaFromMouseWheelLegacyEvent(j,K)}}else z=j/(40*this.wheelPrecision);z&&(this.zoomToMouseLocation?(this._hitPlane||this._updateHitPlane(),this._zoomToMouse(z)):this.camera.inertialRadiusOffset+=z),e.preventDefault&&(K||e.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,Y.b.POINTERWHEEL),this.zoomToMouseLocation&&this._inertialPanning.Wd(0)}Bi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null)}checkInputs(){if(!this.zoomToMouseLocation)return;const K=this.camera;0+K.inertialAlphaOffset+K.inertialBetaOffset+K.inertialRadiusOffset&&(this._updateHitPlane(),K.target.addInPlace(this._inertialPanning),this._inertialPanning.scaleInPlace(K.inertia),this._zeroIfClose(this._inertialPanning))}getClassName(){return"ArcRotateCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}_updateHitPlane(){const K=this.camera,b=K.target.Qc(K.position);this._hitPlane=r.b.FromPositionAndNormal(K.target,b)}_getPosition(){const K=this.camera,b=K.va(),e=b.createPickingRay(b.pointerX,b.pointerY,T.b.Identity(),K,!1);0===K.targetScreenOffset.x&&0===K.targetScreenOffset.y||(this._viewOffset.set(K.targetScreenOffset.x,K.targetScreenOffset.y,0),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),this._globalOffset=T.k.TransformNormal(this._viewOffset,K._cameraTransformMatrix),e.origin.addInPlace(this._globalOffset));let z=0;return this._hitPlane&&(z=e.intersectsPlane(this._hitPlane)??0),e.origin.addInPlace(e.direction.scaleInPlace(z))}_zoomToMouse(K){const b=this.camera,e=1-b.inertia;if(b.lowerRadiusLimit){const z=b.lowerRadiusLimit??0;b.radius-(b.inertialRadiusOffset+K)/e<z&&(K=(b.radius-z)*e-b.inertialRadiusOffset)}if(b.upperRadiusLimit){const z=b.upperRadiusLimit??0;b.radius-(b.inertialRadiusOffset+K)/e>z&&(K=(b.radius-z)*e-b.inertialRadiusOffset)}const z=K/e/b.radius,k=this._getPosition(),j=T.e.gb[6];k.subtractToRef(b.target,j),j.scaleInPlace(z),j.scaleInPlace(e),this._inertialPanning.addInPlace(j),b.inertialRadiusOffset+=K}_zeroIfClose(K){Math.abs(K.x)<X.c&&(K.x=0),Math.abs(K.y)<X.c&&(K.y=0),Math.abs(K.z)<X.c&&(K.z=0)}}(0,z.b)([(0,k.M)()],v.prototype,"wheelPrecision",void 0),(0,z.b)([(0,k.M)()],v.prototype,"zoomToMouseLocation",void 0),(0,z.b)([(0,k.M)()],v.prototype,"wheelDeltaPercentage",void 0),x.c.ArcRotateCameraMouseWheelInput=v;class w extends x.e{constructor(K){super(K)}addMouseWheel(){return this.add(new v),this}addPointers(){return this.add(new i),this}addKeyboard(){return this.add(new M),this}}var h=e(10799);F.e.AddNodeConstructor("ArcRotateCamera",((K,b)=>()=>new R(K,0,0,1,T.k.Zero(),b)));class R extends I.b{get target(){return this._target}set target(K){this.setTarget(K)}get targetHost(){return this._targetHost}set targetHost(K){K&&this.setTarget(K)}getTarget(){return this.target}get position(){return this._position}set position(K){this.setPosition(K)}set upVector(K){this._upToYMatrix||(this._yToUpMatrix=new T.b,this._upToYMatrix=new T.b,this._upVector=T.k.Zero()),K.normalize(),this._upVector.p(K),this.setMatUp()}get upVector(){return this._upVector}setMatUp(){T.b.RotationAlignToRef(T.k.UpReadOnly,this._upVector,this._yToUpMatrix),T.b.RotationAlignToRef(this._upVector,T.k.UpReadOnly,this._upToYMatrix)}get angularSensibilityX(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityX:0}set angularSensibilityX(K){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityX=K)}get angularSensibilityY(){const K=this.inputs.attached.pointers;return K?K.angularSensibilityY:0}set angularSensibilityY(K){const b=this.inputs.attached.pointers;b&&(b.angularSensibilityY=K)}get pinchPrecision(){const K=this.inputs.attached.pointers;return K?K.pinchPrecision:0}set pinchPrecision(K){const b=this.inputs.attached.pointers;b&&(b.pinchPrecision=K)}get pinchDeltaPercentage(){const K=this.inputs.attached.pointers;return K?K.pinchDeltaPercentage:0}set pinchDeltaPercentage(K){const b=this.inputs.attached.pointers;b&&(b.pinchDeltaPercentage=K)}get useNaturalPinchZoom(){const K=this.inputs.attached.pointers;return!!K&&K.useNaturalPinchZoom}set useNaturalPinchZoom(K){const b=this.inputs.attached.pointers;b&&(b.useNaturalPinchZoom=K)}get panningSensibility(){const K=this.inputs.attached.pointers;return K?K.panningSensibility:0}set panningSensibility(K){const b=this.inputs.attached.pointers;b&&(b.panningSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const b=this.inputs.attached.keyboard;b&&(b.keysUp=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const b=this.inputs.attached.keyboard;b&&(b.keysDown=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const b=this.inputs.attached.keyboard;b&&(b.keysRight=K)}get wheelPrecision(){const K=this.inputs.attached.mousewheel;return K?K.wheelPrecision:0}set wheelPrecision(K){const b=this.inputs.attached.mousewheel;b&&(b.wheelPrecision=K)}get zoomToMouseLocation(){const K=this.inputs.attached.mousewheel;return!!K&&K.zoomToMouseLocation}set zoomToMouseLocation(K){const b=this.inputs.attached.mousewheel;b&&(b.zoomToMouseLocation=K)}get wheelDeltaPercentage(){const K=this.inputs.attached.mousewheel;return K?K.wheelDeltaPercentage:0}set wheelDeltaPercentage(K){const b=this.inputs.attached.mousewheel;b&&(b.wheelDeltaPercentage=K)}get bouncingBehavior(){return this._bouncingBehavior}get useBouncingBehavior(){return null!=this._bouncingBehavior}set useBouncingBehavior(K){K!==this.useBouncingBehavior&&(K?(this._bouncingBehavior=new u,this.addBehavior(this._bouncingBehavior)):this._bouncingBehavior&&(this.removeBehavior(this._bouncingBehavior),this._bouncingBehavior=null))}get framingBehavior(){return this._framingBehavior}get useFramingBehavior(){return null!=this._framingBehavior}set useFramingBehavior(K){K!==this.useFramingBehavior&&(K?(this._framingBehavior=new m,this.addBehavior(this._framingBehavior)):this._framingBehavior&&(this.removeBehavior(this._framingBehavior),this._framingBehavior=null))}get autoRotationBehavior(){return this._autoRotationBehavior}get useAutoRotationBehavior(){return null!=this._autoRotationBehavior}set useAutoRotationBehavior(K){K!==this.useAutoRotationBehavior&&(K?(this._autoRotationBehavior=new t,this.addBehavior(this._autoRotationBehavior)):this._autoRotationBehavior&&(this.removeBehavior(this._autoRotationBehavior),this._autoRotationBehavior=null))}constructor(K,b,e,z,k,F){var l;let Y=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];super(K,T.k.Zero(),F,Y),l=this,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.lowerAlphaLimit=null,this.upperAlphaLimit=null,this.lowerBetaLimit=.01,this.upperBetaLimit=Math.PI-.01,this.lowerRadiusLimit=null,this.upperRadiusLimit=null,this.inertialPanningX=0,this.inertialPanningY=0,this.pinchToPanMaxDistance=20,this.panningDistanceLimit=null,this.panningOriginTarget=T.k.Zero(),this.panningInertia=.9,this.zoomOnFactor=1,this.targetScreenOffset=T.h.Zero(),this.allowUpsideDown=!0,this.useInputToRestoreState=!0,this.restoreStateInterpolationFactor=0,this._viewMatrix=new T.b,this.panningAxis=new T.k(1,1,0),this._transformedDirection=new T.k,this.mapPanning=!1,this._progressiveRestore=!1,this.onMeshTargetChangedObservable=new j.d,this.checkCollisions=!1,this.collisionRadius=new T.k(.5,.5,.5),this._previousPosition=T.k.Zero(),this._collisionVelocity=T.k.Zero(),this._newPosition=T.k.Zero(),this._computationVector=T.k.Zero(),this._onCollisionPositionChange=function(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e?(l.setPosition(b),l.sk&&l.sk(e)):l._previousPosition.p(l._position);const z=Math.cos(l.alpha),k=Math.sin(l.alpha),j=Math.cos(l.beta);let T=Math.sin(l.beta);0===T&&(T=1e-4);const F=l._getTargetPosition();l._computationVector.Yd(l.radius*z*T,l.radius*j,l.radius*k*T),F.addToRef(l._computationVector,l._newPosition),l._position.p(l._newPosition);let Y=l.upVector;l.allowUpsideDown&&l.beta<0&&(Y=Y.clone(),Y=Y.negate()),l._computeViewMatrix(l._position,F,Y),l._viewMatrix.addAtIndex(12,l.targetScreenOffset.x),l._viewMatrix.addAtIndex(13,l.targetScreenOffset.y),l._collisionTriggered=!1},this._target=T.k.Zero(),k&&this.setTarget(k),this.alpha=b,this.beta=e,this.radius=z,this.getViewMatrix(),this.inputs=new w(this),this.inputs.addKeyboard().addMouseWheel().addPointers()}_initCache(){super._initCache(),this._cache._target=new T.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.alpha=void 0,this._cache.beta=void 0,this._cache.radius=void 0,this._cache.targetScreenOffset=T.h.Zero()}_updateCache(K){K||super._updateCache(),this._cache._target.p(this._getTargetPosition()),this._cache.alpha=this.alpha,this._cache.beta=this.beta,this._cache.radius=this.radius,this._cache.targetScreenOffset.p(this.targetScreenOffset)}_getTargetPosition(){if(this._targetHost&&this._targetHost.getAbsolutePosition){const K=this._targetHost.getAbsolutePosition();this._targetBoundingCenter?K.addToRef(this._targetBoundingCenter,this._target):this._target.p(K)}const K=this._getLockedTargetPosition();return K||this._target}storeState(){return this._storedAlpha=this.alpha,this._storedBeta=this.beta,this._storedRadius=this.radius,this._storedTarget=this._getTargetPosition().clone(),this._storedTargetScreenOffset=this.targetScreenOffset.clone(),super.storeState()}_restoreStateValues(){return this.hasStateStored()&&this.restoreStateInterpolationFactor>X.c&&this.restoreStateInterpolationFactor<1?(this._progressiveRestore=!0,this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0):!!super._restoreStateValues()&&(this.setTarget(this._storedTarget.clone()),this.alpha=this._storedAlpha,this.beta=this._storedBeta,this.radius=this._storedRadius,this.targetScreenOffset=this._storedTargetScreenOffset.clone(),this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0,!0)}_isSynchronizedViewMatrix(){return!!super._isSynchronizedViewMatrix()&&(this._cache._target.equals(this._getTargetPosition())&&this._cache.alpha===this.alpha&&this._cache.beta===this.beta&&this._cache.radius===this.radius&&this._cache.targetScreenOffset.equals(this.targetScreenOffset))}attachControl(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2;const k=arguments;b=Q.f.BackCompatCameraNoPreventDefault(k),this._useCtrlForPanning=e,this._panningMouseButton=z,"boolean"===typeof k[0]&&(k.length>1&&(this._useCtrlForPanning=k[1]),k.length>2&&(this._panningMouseButton=k[2])),this.inputs.attachElement(b),this._reset=()=>{this.inertialAlphaOffset=0,this.inertialBetaOffset=0,this.inertialRadiusOffset=0,this.inertialPanningX=0,this.inertialPanningY=0}}Bi(){this.inputs.detachElement(),this._reset&&this._reset()}_checkInputs(){if(!this._collisionTriggered){if(this.inputs.checkInputs(),this._progressiveRestore){const K=this._scene.getEngine().getDeltaTime()/1e3,b=1-Math.pow(2,-K/this.restoreStateInterpolationFactor);this.setTarget(T.k.Lerp(this.getTarget(),this._storedTarget,b)),T.d.RotationAlphaBetaGammaToRef(this._storedAlpha,this._storedBeta,0,T.e.Quaternion[0]),T.d.RotationAlphaBetaGammaToRef(this.alpha,this.beta,0,T.e.Quaternion[1]),T.d.SlerpToRef(T.e.Quaternion[1],T.e.Quaternion[0],b,T.e.Quaternion[2]),T.e.Quaternion[2].normalize(),T.e.Quaternion[2].toAlphaBetaGammaToRef(T.e.gb[0]),this.alpha=T.e.gb[0].x,this.beta=T.e.gb[0].y,this.radius+=(this._storedRadius-this.radius)*b,T.h.LerpToRef(this.targetScreenOffset,this._storedTargetScreenOffset,b,this.targetScreenOffset),(T.k.DistanceSquared(this.getTarget(),this._storedTarget)<X.c&&T.e.Quaternion[2].equalsWithEpsilon(T.e.Quaternion[0])&&Math.pow(this._storedRadius-this.radius,2)<X.c&&T.h.Distance(this.targetScreenOffset,this._storedTargetScreenOffset)<X.c||0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset||0!==this.inertialPanningX||0!==this.inertialPanningY)&&(this._progressiveRestore=!1)}if(0!==this.inertialAlphaOffset||0!==this.inertialBetaOffset||0!==this.inertialRadiusOffset){const K=this.invertRotation?-1:1,b=this._calculateHandednessMultiplier();let e=this.inertialAlphaOffset*b;this.beta<0&&(e*=-1),this.alpha+=e*K,this.beta+=this.inertialBetaOffset*K,this.radius-=this.inertialRadiusOffset,this.inertialAlphaOffset*=this.inertia,this.inertialBetaOffset*=this.inertia,this.inertialRadiusOffset*=this.inertia,Math.abs(this.inertialAlphaOffset)<X.c&&(this.inertialAlphaOffset=0),Math.abs(this.inertialBetaOffset)<X.c&&(this.inertialBetaOffset=0),Math.abs(this.inertialRadiusOffset)<this.speed*X.c&&(this.inertialRadiusOffset=0)}if(0!==this.inertialPanningX||0!==this.inertialPanningY){const K=new T.k(this.inertialPanningX,this.inertialPanningY,this.inertialPanningY);if(this._viewMatrix.invertToRef(this._cameraTransformMatrix),K.multiplyInPlace(this.panningAxis),T.k.TransformNormalToRef(K,this._cameraTransformMatrix,this._transformedDirection),this.mapPanning){const K=this.upVector,b=T.k.CrossToRef(this._transformedDirection,K,this._transformedDirection);T.k.CrossToRef(K,b,this._transformedDirection)}else this.panningAxis.y||(this._transformedDirection.y=0);if(!this._targetHost)if(this.panningDistanceLimit){this._transformedDirection.addInPlace(this._target);T.k.DistanceSquared(this._transformedDirection,this.panningOriginTarget)<=this.panningDistanceLimit*this.panningDistanceLimit&&this._target.p(this._transformedDirection)}else{if(this.parent){const K=T.e.Matrix[0];this.parent.getWorldMatrix().getRotationMatrixToRef(K),K.transposeToRef(K),T.k.TransformCoordinatesToRef(this._transformedDirection,K,this._transformedDirection)}this._target.addInPlace(this._transformedDirection)}this.inertialPanningX*=this.panningInertia,this.inertialPanningY*=this.panningInertia,Math.abs(this.inertialPanningX)<this.speed*X.c&&(this.inertialPanningX=0),Math.abs(this.inertialPanningY)<this.speed*X.c&&(this.inertialPanningY=0)}this._checkLimits(),super._checkInputs()}}_checkLimits(){null===this.lowerBetaLimit||void 0===this.lowerBetaLimit?this.allowUpsideDown&&this.beta>Math.PI&&(this.beta=this.beta-2*Math.PI):this.beta<this.lowerBetaLimit&&(this.beta=this.lowerBetaLimit),null===this.upperBetaLimit||void 0===this.upperBetaLimit?this.allowUpsideDown&&this.beta<-Math.PI&&(this.beta=this.beta+2*Math.PI):this.beta>this.upperBetaLimit&&(this.beta=this.upperBetaLimit),null!==this.lowerAlphaLimit&&this.alpha<this.lowerAlphaLimit&&(this.alpha=this.lowerAlphaLimit),null!==this.upperAlphaLimit&&this.alpha>this.upperAlphaLimit&&(this.alpha=this.upperAlphaLimit),null!==this.lowerRadiusLimit&&this.radius<this.lowerRadiusLimit&&(this.radius=this.lowerRadiusLimit,this.inertialRadiusOffset=0),null!==this.upperRadiusLimit&&this.radius>this.upperRadiusLimit&&(this.radius=this.upperRadiusLimit,this.inertialRadiusOffset=0)}rebuildAnglesAndRadius(){this._position.subtractToRef(this._getTargetPosition(),this._computationVector),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||T.k.TransformCoordinatesToRef(this._computationVector,this._upToYMatrix,this._computationVector),this.radius=this._computationVector.length(),0===this.radius&&(this.radius=1e-4);const K=this.alpha;0===this._computationVector.x&&0===this._computationVector.z?this.alpha=Math.PI/2:this.alpha=Math.acos(this._computationVector.x/Math.sqrt(Math.pow(this._computationVector.x,2)+Math.pow(this._computationVector.z,2))),this._computationVector.z<0&&(this.alpha=2*Math.PI-this.alpha);const b=Math.round((K-this.alpha)/(2*Math.PI));this.alpha+=2*b*Math.PI,this.beta=Math.acos(this._computationVector.y/this.radius),this._checkLimits()}setPosition(K){this._position.equals(K)||(this._position.p(K),this.rebuildAnglesAndRadius())}setTarget(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(z=this.overrideCloneAlphaBetaRadius??z,K.xj)b&&K.getBoundingInfo?this._targetBoundingCenter=K.getBoundingInfo().boundingBox.centerWorld.clone():this._targetBoundingCenter=null,K.xj(),this._targetHost=K,this._target=this._getTargetPosition(),this.onMeshTargetChangedObservable.notifyObservers(this._targetHost);else{const b=K,z=this._getTargetPosition();if(z&&!e&&z.equals(b))return;this._targetHost=null,this._target=b,this._targetBoundingCenter=null,this.onMeshTargetChangedObservable.notifyObservers(null)}z||this.rebuildAnglesAndRadius()}_getViewMatrix(){const K=Math.cos(this.alpha),b=Math.sin(this.alpha),e=Math.cos(this.beta);let z=Math.sin(this.beta);0===z&&(z=1e-4),0===this.radius&&(this.radius=1e-4);const k=this._getTargetPosition();if(this._computationVector.Yd(this.radius*K*z,this.radius*e,this.radius*b*z),0===this._upVector.x&&1===this._upVector.y&&0===this._upVector.z||T.k.TransformCoordinatesToRef(this._computationVector,this._yToUpMatrix,this._computationVector),k.addToRef(this._computationVector,this._newPosition),this.va().collisionsEnabled&&this.checkCollisions){const K=this.va().collisionCoordinator;this._collider||(this._collider=K.createCollider()),this._collider._radius=this.collisionRadius,this._newPosition.subtractToRef(this._position,this._collisionVelocity),this._collisionTriggered=!0,K.getNewPosition(this._position,this._collisionVelocity,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}else{this._position.p(this._newPosition);let K=this.upVector;this.allowUpsideDown&&z<0&&(K=K.negate()),this._computeViewMatrix(this._position,k,K),this._viewMatrix.addAtIndex(12,this.targetScreenOffset.x),this._viewMatrix.addAtIndex(13,this.targetScreenOffset.y)}return this._currentTarget=k,this._viewMatrix}zoomOn(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K=K||this.va().meshes;const e=l.b.MinMax(K);let z=this._calculateLowerRadiusFromModelBoundingSphere(e.min,e.max);z=Math.max(Math.min(z,this.upperRadiusLimit||Number.MAX_VALUE),this.lowerRadiusLimit||0),this.radius=z*this.zoomOnFactor,this.focusOn({min:e.min,max:e.max,distance:z},b)}focusOn(K){let b,e,z=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(void 0===K.min){const z=K||this.va().meshes;b=l.b.MinMax(z),e=T.k.Distance(b.min,b.max)}else{b=K,e=K.distance}this._target=l.b.Center(b),z||(this.maxZ=2*e)}createRigCamera(K,b){let e=0;switch(this.cameraRigMode){case D.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case D.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case D.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case D.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case D.e.RIG_MODE_VR:e=this._cameraRigParams.stereoHalfAngle*(0===b?1:-1);break;case D.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:e=this._cameraRigParams.stereoHalfAngle*(0===b?-1:1)}const z=new R(K,this.alpha+e,this.beta,this.radius,this._target,this.va());return z._cameraRigParams={},z.isRigCamera=!0,z.rigParent=this,z.upVector=this.upVector,z.mode=this.mode,z.orthoLeft=this.orthoLeft,z.orthoRight=this.orthoRight,z.orthoBottom=this.orthoBottom,z.orthoTop=this.orthoTop,z}_updateRigCameras(){const K=this._rigCameras[0],b=this._rigCameras[1];switch(K.beta=b.beta=this.beta,this.cameraRigMode){case D.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case D.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case D.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case D.e.RIG_MODE_STEREOSCOPIC_INTERLACED:case D.e.RIG_MODE_VR:K.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle;break;case D.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:K.alpha=this.alpha+this._cameraRigParams.stereoHalfAngle,b.alpha=this.alpha-this._cameraRigParams.stereoHalfAngle}super._updateRigCameras()}_calculateLowerRadiusFromModelBoundingSphere(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;const z=T.k.Distance(K,b),k=this.va().getEngine().getAspectRatio(this),j=Math.tan(this.fov/2),F=j*k,l=.5*z*e,Y=l*Math.sqrt(1+1/(F*F)),A=l*Math.sqrt(1+1/(j*j));return Math.max(Y,A)}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ArcRotateCamera"}}(0,z.b)([(0,k.M)()],R.prototype,"alpha",void 0),(0,z.b)([(0,k.M)()],R.prototype,"beta",void 0),(0,z.b)([(0,k.M)()],R.prototype,"radius",void 0),(0,z.b)([(0,k.M)()],R.prototype,"overrideCloneAlphaBetaRadius",void 0),(0,z.b)([(0,k.L)("target")],R.prototype,"_target",void 0),(0,z.b)([(0,k.w)("targetHost")],R.prototype,"_targetHost",void 0),(0,z.b)([(0,k.M)()],R.prototype,"inertialAlphaOffset",void 0),(0,z.b)([(0,k.M)()],R.prototype,"inertialBetaOffset",void 0),(0,z.b)([(0,k.M)()],R.prototype,"inertialRadiusOffset",void 0),(0,z.b)([(0,k.M)()],R.prototype,"lowerAlphaLimit",void 0),(0,z.b)([(0,k.M)()],R.prototype,"upperAlphaLimit",void 0),(0,z.b)([(0,k.M)()],R.prototype,"lowerBetaLimit",void 0),(0,z.b)([(0,k.M)()],R.prototype,"upperBetaLimit",void 0),(0,z.b)([(0,k.M)()],R.prototype,"lowerRadiusLimit",void 0),(0,z.b)([(0,k.M)()],R.prototype,"upperRadiusLimit",void 0),(0,z.b)([(0,k.M)()],R.prototype,"inertialPanningX",void 0),(0,z.b)([(0,k.M)()],R.prototype,"inertialPanningY",void 0),(0,z.b)([(0,k.M)()],R.prototype,"pinchToPanMaxDistance",void 0),(0,z.b)([(0,k.M)()],R.prototype,"panningDistanceLimit",void 0),(0,z.b)([(0,k.L)()],R.prototype,"panningOriginTarget",void 0),(0,z.b)([(0,k.M)()],R.prototype,"panningInertia",void 0),(0,z.b)([(0,k.M)()],R.prototype,"zoomToMouseLocation",null),(0,z.b)([(0,k.M)()],R.prototype,"zoomOnFactor",void 0),(0,z.b)([(0,k.H)()],R.prototype,"targetScreenOffset",void 0),(0,z.b)([(0,k.M)()],R.prototype,"allowUpsideDown",void 0),(0,z.b)([(0,k.M)()],R.prototype,"useInputToRestoreState",void 0),(0,z.b)([(0,k.M)()],R.prototype,"restoreStateInterpolationFactor",void 0),(0,h.e)("BABYLON.ArcRotateCamera",R)},11237:(K,b,e)=>{"use strict";e.d(b,{e:()=>m});var z=e(10936),k=e(10938),j=e(10951),T=e(10686),F=e(10690),l=e(10967),Y=e(11243),A=e(10696),X=e(10799),t=e(10710),U=e(11252),B=e(11066),u=e(11001);class m extends Y.e{get position(){return this._position}set position(K){this._position=K}set upVector(K){this._upVector=K}get upVector(){return this._upVector}get screenArea(){let K=0,b=0;if(this.mode===m.PERSPECTIVE_CAMERA)this.fovMode===m.FOVMODE_VERTICAL_FIXED?(b=2*this.Fi*Math.tan(this.fov/2),K=this.getEngine().getAspectRatio(this)*b):(K=2*this.Fi*Math.tan(this.fov/2),b=K/this.getEngine().getAspectRatio(this));else{const e=this.getEngine().getRenderWidth()/2,z=this.getEngine().getRenderHeight()/2;K=(this.orthoRight??e)-(this.orthoLeft??-e),b=(this.orthoTop??z)-(this.orthoBottom??-z)}return K*b}set orthoLeft(K){this._orthoLeft=K;for(const b of this._rigCameras)b.orthoLeft=K}get orthoLeft(){return this._orthoLeft}set orthoRight(K){this._orthoRight=K;for(const b of this._rigCameras)b.orthoRight=K}get orthoRight(){return this._orthoRight}set orthoBottom(K){this._orthoBottom=K;for(const b of this._rigCameras)b.orthoBottom=K}get orthoBottom(){return this._orthoBottom}set orthoTop(K){this._orthoTop=K;for(const b of this._rigCameras)b.orthoTop=K}get orthoTop(){return this._orthoTop}set mode(K){this._mode=K;for(const b of this._rigCameras)b.mode=K}get mode(){return this._mode}get hasMoved(){return this._hasMoved}constructor(K,b,e){let z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];super(K,e,!1),this._position=l.k.Zero(),this._upVector=l.k.Up(),this.oblique=null,this._orthoLeft=null,this._orthoRight=null,this._orthoBottom=null,this._orthoTop=null,this.fov=.8,this.projectionPlaneTilt=0,this.Fi=1,this.maxZ=1e4,this.inertia=.9,this._mode=m.PERSPECTIVE_CAMERA,this.isIntermediate=!1,this.viewport=new U.b(0,0,1,1),this.layerMask=268435455,this.fovMode=m.FOVMODE_VERTICAL_FIXED,this.cameraRigMode=m.RIG_MODE_NONE,this.customRenderTargets=[],this.outputRenderTarget=null,this.onViewMatrixChangedObservable=new F.d,this.onProjectionMatrixChangedObservable=new F.d,this.onAfterCheckInputsObservable=new F.d,this.onRestoreStateObservable=new F.d,this.isRigCamera=!1,this._hasMoved=!1,this._rigCameras=new Array,this._skipRendering=!1,this._projectionMatrix=new l.b,this._postProcesses=new Array,this._activeMeshes=new j.h(256),this._globalPosition=l.k.Zero(),this._computedViewMatrix=l.b.Identity(),this._doNotComputeProjectionMatrix=!1,this._transformMatrix=l.b.Zero(),this._refreshFrustumPlanes=!0,this._absoluteRotation=l.d.Identity(),this._isCamera=!0,this._isLeftCamera=!1,this._isRightCamera=!1,this.va().addCamera(this),z&&!this.va().activeCamera&&(this.va().activeCamera=this),this.position=b,this.renderPassId=this.va().getEngine().createRenderPassId(`Camera ${K}`)}storeState(){return this._stateStored=!0,this._storedFov=this.fov,this}hasStateStored(){return!!this._stateStored}_restoreStateValues(){return!!this._stateStored&&(this.fov=this._storedFov,!0)}restoreState(){return!!this._restoreStateValues()&&(this.onRestoreStateObservable.notifyObservers(this),!0)}getClassName(){return"Zg"}toString(K){let b="Name: "+this.name;if(b+=", type: "+this.getClassName(),this.animations)for(let e=0;e<this.animations.length;e++)b+=", animation[0]: "+this.animations[e].toString(K);return b}applyVerticalCorrection(){const K=this.absoluteRotation.toEulerAngles();this.projectionPlaneTilt=this._scene.useRightHandedSystem?-K.x:K.x}get globalPosition(){return this._globalPosition}getActiveMeshes(){return this._activeMeshes}isActiveMesh(K){return-1!==this._activeMeshes.indexOf(K)}isReady(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(K)for(const b of this._postProcesses)if(b&&!b.isReady())return!1;return super.isReady(K)}_initCache(){super._initCache(),this._cache.position=new l.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.upVector=new l.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.mode=void 0,this._cache.Fi=void 0,this._cache.maxZ=void 0,this._cache.fov=void 0,this._cache.fovMode=void 0,this._cache.aspectRatio=void 0,this._cache.orthoLeft=void 0,this._cache.orthoRight=void 0,this._cache.orthoBottom=void 0,this._cache.orthoTop=void 0,this._cache.obliqueAngle=void 0,this._cache.obliqueLength=void 0,this._cache.obliqueOffset=void 0,this._cache.renderWidth=void 0,this._cache.renderHeight=void 0}_updateCache(K){K||super._updateCache(),this._cache.position.p(this.position),this._cache.upVector.p(this.upVector)}_isSynchronized(){return this._isSynchronizedViewMatrix()&&this._isSynchronizedProjectionMatrix()}_isSynchronizedViewMatrix(){return!!super._isSynchronized()&&(this._cache.position.equals(this.position)&&this._cache.upVector.equals(this.upVector)&&this.isSynchronizedWithParent())}_isSynchronizedProjectionMatrix(){let K=this._cache.mode===this.mode&&this._cache.Fi===this.Fi&&this._cache.maxZ===this.maxZ;if(!K)return!1;const b=this.getEngine();return this.mode===m.PERSPECTIVE_CAMERA?K=this._cache.fov===this.fov&&this._cache.fovMode===this.fovMode&&this._cache.aspectRatio===b.getAspectRatio(this)&&this._cache.projectionPlaneTilt===this.projectionPlaneTilt:(K=this._cache.orthoLeft===this.orthoLeft&&this._cache.orthoRight===this.orthoRight&&this._cache.orthoBottom===this.orthoBottom&&this._cache.orthoTop===this.orthoTop&&this._cache.renderWidth===b.getRenderWidth()&&this._cache.renderHeight===b.getRenderHeight(),this.oblique&&(K=K&&this._cache.obliqueAngle===this.oblique.angle&&this._cache.obliqueLength===this.oblique.length&&this._cache.obliqueOffset===this.oblique.offset)),K}attachControl(K,b){}Bi(K){}update(){this._hasMoved=!1,this._checkInputs(),this.cameraRigMode!==m.RIG_MODE_NONE&&this._updateRigCameras(),this.getViewMatrix(),this.getProjectionMatrix()}_checkInputs(){this.onAfterCheckInputsObservable.notifyObservers(this)}get rigCameras(){return this._rigCameras}get rigPostProcess(){return this._rigPostProcess}_getFirstPostProcess(){for(let K=0;K<this._postProcesses.length;K++)if(null!==this._postProcesses[K])return this._postProcesses[K];return null}_cascadePostProcessesToRigCams(){const K=this._getFirstPostProcess();K&&K.markTextureDirty();for(let b=0,e=this._rigCameras.length;b<e;b++){const K=this._rigCameras[b],e=K._rigPostProcess;if(e){"pass"===e.getEffectName()&&(K.isIntermediate=0===this._postProcesses.length),K._postProcesses=this._postProcesses.slice(0).concat(e),e.markTextureDirty()}else K._postProcesses=this._postProcesses.slice(0)}}attachPostProcess(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return!K.isReusable()&&this._postProcesses.indexOf(K)>-1?(A.b.Error("You're trying to reuse a post process not defined as reusable."),0):(null==b||b<0?this._postProcesses.push(K):null===this._postProcesses[b]?this._postProcesses[b]=K:this._postProcesses.splice(b,0,K),this._cascadePostProcessesToRigCams(),this._scene.prePassRenderer&&this._scene.prePassRenderer.rg(),this._postProcesses.indexOf(K))}detachPostProcess(K){const b=this._postProcesses.indexOf(K);-1!==b&&(this._postProcesses[b]=null),this._scene.prePassRenderer&&this._scene.prePassRenderer.rg(),this._cascadePostProcessesToRigCams()}getWorldMatrix(){return this._isSynchronizedViewMatrix()||this.getViewMatrix(),this._worldMatrix}_getViewMatrix(){return l.b.Identity()}getViewMatrix(K){return!K&&this._isSynchronizedViewMatrix()||(this._hasMoved=!0,this.updateCache(),this._computedViewMatrix=this._getViewMatrix(),this._currentRenderId=this.va().getRenderId(),this._childUpdateId++,this._refreshFrustumPlanes=!0,this._cameraRigParams&&this._cameraRigParams.vrPreViewMatrix&&this._computedViewMatrix.multiplyToRef(this._cameraRigParams.vrPreViewMatrix,this._computedViewMatrix),this.parent&&this.parent.onViewMatrixChangedObservable&&this.parent.onViewMatrixChangedObservable.notifyObservers(this.parent),this.onViewMatrixChangedObservable.notifyObservers(this),this._computedViewMatrix.invertToRef(this._worldMatrix)),this._computedViewMatrix}freezeProjectionMatrix(K){this._doNotComputeProjectionMatrix=!0,void 0!==K&&(this._projectionMatrix=K)}unfreezeProjectionMatrix(){this._doNotComputeProjectionMatrix=!1}getProjectionMatrix(K){if(this._doNotComputeProjectionMatrix||!K&&this._isSynchronizedProjectionMatrix())return this._projectionMatrix;this._cache.mode=this.mode,this._cache.Fi=this.Fi,this._cache.maxZ=this.maxZ,this._refreshFrustumPlanes=!0;const b=this.getEngine(),e=this.va(),z=b.useReverseDepthBuffer;if(this.mode===m.PERSPECTIVE_CAMERA){let K;this._cache.fov=this.fov,this._cache.fovMode=this.fovMode,this._cache.aspectRatio=b.getAspectRatio(this),this._cache.projectionPlaneTilt=this.projectionPlaneTilt,this.Fi<=0&&(this.Fi=.1),K=e.useRightHandedSystem?l.b.PerspectiveFovRHToRef:l.b.PerspectiveFovLHToRef,K(this.fov,b.getAspectRatio(this),z?this.maxZ:this.Fi,z?this.Fi:this.maxZ,this._projectionMatrix,this.fovMode===m.FOVMODE_VERTICAL_FIXED,b.isNDCHalfZRange,this.projectionPlaneTilt,z)}else{var k,j,T;const K=b.getRenderWidth()/2,F=b.getRenderHeight()/2;e.useRightHandedSystem?this.oblique?l.b.ObliqueOffCenterRHToRef(this.orthoLeft??-K,this.orthoRight??K,this.orthoBottom??-F,this.orthoTop??F,z?this.maxZ:this.Fi,z?this.Fi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,b.isNDCHalfZRange):l.b.OrthoOffCenterRHToRef(this.orthoLeft??-K,this.orthoRight??K,this.orthoBottom??-F,this.orthoTop??F,z?this.maxZ:this.Fi,z?this.Fi:this.maxZ,this._projectionMatrix,b.isNDCHalfZRange):this.oblique?l.b.ObliqueOffCenterLHToRef(this.orthoLeft??-K,this.orthoRight??K,this.orthoBottom??-F,this.orthoTop??F,z?this.maxZ:this.Fi,z?this.Fi:this.maxZ,this.oblique.length,this.oblique.angle,this._computeObliqueDistance(this.oblique.offset),this._projectionMatrix,b.isNDCHalfZRange):l.b.OrthoOffCenterLHToRef(this.orthoLeft??-K,this.orthoRight??K,this.orthoBottom??-F,this.orthoTop??F,z?this.maxZ:this.Fi,z?this.Fi:this.maxZ,this._projectionMatrix,b.isNDCHalfZRange),this._cache.orthoLeft=this.orthoLeft,this._cache.orthoRight=this.orthoRight,this._cache.orthoBottom=this.orthoBottom,this._cache.orthoTop=this.orthoTop,this._cache.obliqueAngle=null===(k=this.oblique)||void 0===k?void 0:k.angle,this._cache.obliqueLength=null===(j=this.oblique)||void 0===j?void 0:j.length,this._cache.obliqueOffset=null===(T=this.oblique)||void 0===T?void 0:T.offset,this._cache.renderWidth=b.getRenderWidth(),this._cache.renderHeight=b.getRenderHeight()}return this.onProjectionMatrixChangedObservable.notifyObservers(this),this._projectionMatrix}getTransformationMatrix(){return this._computedViewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._transformMatrix}_computeObliqueDistance(K){return(this.radius||(this.target?l.k.Distance(this.position,this.target):this.position.length()))+K}_updateFrustumPlanes(){this._refreshFrustumPlanes&&(this.getTransformationMatrix(),this._frustumPlanes?B.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=B.e.GetPlanes(this._transformMatrix),this._refreshFrustumPlanes=!1)}isInFrustum(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._updateFrustumPlanes(),b&&this.rigCameras.length>0){let b=!1;return this.rigCameras.forEach((e=>{e._updateFrustumPlanes(),b=b||K.isInFrustum(e._frustumPlanes)})),b}return K.isInFrustum(this._frustumPlanes)}isCompletelyInFrustum(K){return this._updateFrustumPlanes(),K.isCompletelyInFrustum(this._frustumPlanes)}getForwardRay(){throw(0,t.c)("Ray")}getForwardRayToRef(K){throw(0,t.c)("Ray")}dispose(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(this.onViewMatrixChangedObservable.clear(),this.onProjectionMatrixChangedObservable.clear(),this.onAfterCheckInputsObservable.clear(),this.onRestoreStateObservable.clear(),this.inputs&&this.inputs.clear(),this.va().stopAnimation(this),this.va().removeCamera(this);this._rigCameras.length>0;){const K=this._rigCameras.pop();K&&K.dispose()}if(this._parentContainer){const K=this._parentContainer.cameras.indexOf(this);K>-1&&this._parentContainer.cameras.splice(K,1),this._parentContainer=null}if(this._rigPostProcess)this._rigPostProcess.dispose(this),this._rigPostProcess=null,this._postProcesses.length=0;else if(this.cameraRigMode!==m.RIG_MODE_NONE)this._rigPostProcess=null,this._postProcesses.length=0;else{let K=this._postProcesses.length;for(;--K>=0;){const b=this._postProcesses[K];b&&b.dispose(this)}}let e=this.customRenderTargets.length;for(;--e>=0;)this.customRenderTargets[e].dispose();this.customRenderTargets.length=0,this._activeMeshes.dispose(),this.va().getEngine().releaseRenderPassId(this.renderPassId),super.dispose(K,b)}get isLeftCamera(){return this._isLeftCamera}get isRightCamera(){return this._isRightCamera}get leftCamera(){return this._rigCameras.length<1?null:this._rigCameras[0]}get rightCamera(){return this._rigCameras.length<2?null:this._rigCameras[1]}getLeftTarget(){return this._rigCameras.length<1?null:this._rigCameras[0].getTarget()}getRightTarget(){return this._rigCameras.length<2?null:this._rigCameras[1].getTarget()}setCameraRigMode(K,b){if(this.cameraRigMode!==K){for(;this._rigCameras.length>0;){const K=this._rigCameras.pop();K&&K.dispose()}if(this.cameraRigMode=K,this._cameraRigParams={},this._cameraRigParams.interaxialDistance=b.interaxialDistance||.0637,this._cameraRigParams.stereoHalfAngle=T.f.ToRadians(this._cameraRigParams.interaxialDistance/.0637),this.cameraRigMode!==m.RIG_MODE_NONE){const K=this.createRigCamera(this.name+"_L",0);K&&(K._isLeftCamera=!0);const b=this.createRigCamera(this.name+"_R",1);b&&(b._isRightCamera=!0),K&&b&&(this._rigCameras.push(K),this._rigCameras.push(b))}this._setRigMode(b),this._cascadePostProcessesToRigCams(),this.update()}}_setRigMode(K){}_getVRProjectionMatrix(){return l.b.PerspectiveFovLHToRef(this._cameraRigParams.vrMetrics.aspectRatioFov,this._cameraRigParams.vrMetrics.aspectRatio,this.Fi,this.maxZ,this._cameraRigParams.vrWorkMatrix,!0,this.getEngine().isNDCHalfZRange),this._cameraRigParams.vrWorkMatrix.multiplyToRef(this._cameraRigParams.vrHMatrix,this._projectionMatrix),this._projectionMatrix}setCameraRigParameter(K,b){this._cameraRigParams||(this._cameraRigParams={}),this._cameraRigParams[K]=b,"interaxialDistance"===K&&(this._cameraRigParams.stereoHalfAngle=T.f.ToRadians(b/.0637))}createRigCamera(K,b){return null}_updateRigCameras(){for(let K=0;K<this._rigCameras.length;K++)this._rigCameras[K].Fi=this.Fi,this._rigCameras[K].maxZ=this.maxZ,this._rigCameras[K].fov=this.fov,this._rigCameras[K].upVector.p(this.upVector);this.cameraRigMode===m.RIG_MODE_STEREOSCOPIC_ANAGLYPH&&(this._rigCameras[0].viewport=this._rigCameras[1].viewport=this.viewport)}_setupInputs(){}serialize(){const K=u.e.Serialize(this);return K.uniqueId=this.uniqueId,K.type=this.getClassName(),this.parent&&this.parent._serializeAsParent(K),this.inputs&&this.inputs.serialize(K),u.e.AppendSerializedAnimations(this,K),K.ranges=this.serializeAnimationRanges(),K.isEnabled=this.isEnabled(),K}clone(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=u.e.Clone(m.GetConstructorFromName(this.getClassName(),K,this.va(),this.interaxialDistance,this.isStereoscopicSideBySide),this);return e.name=K,e.parent=b,this.onClonedObservable.notifyObservers(e),e}Me(K){const b=l.k.Zero();return this.getDirectionToRef(K,b),b}get absoluteRotation(){return this.getWorldMatrix().decompose(void 0,this._absoluteRotation),this._absoluteRotation}getDirectionToRef(K,b){l.k.TransformNormalToRef(K,this.getWorldMatrix(),b)}static GetConstructorFromName(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const j=Y.e.Construct(K,b,e,{interaxial_distance:z,isStereoscopicSideBySide:k});return j||(()=>m._CreateDefaultParsedCamera(b,e))}xj(){return this.getWorldMatrix()}static Parse(K,b){const e=K.type,z=m.GetConstructorFromName(e,K.name,b,K.interaxial_distance,K.isStereoscopicSideBySide),k=u.e.Parse(z,K,b);if(void 0!==K.parentId&&(k._waitingParentId=K.parentId),void 0!==K.parentInstanceIndex&&(k._waitingParentInstanceIndex=K.parentInstanceIndex),k.inputs&&(k.inputs.parse(K),k._setupInputs()),K.upVector&&(k.upVector=l.k.Bg(K.upVector)),k.setPosition&&(k.position.Yd(0,0,0),k.setPosition(l.k.Bg(K.position))),K.target&&k.setTarget&&k.setTarget(l.k.Bg(K.target)),K.cameraRigMode){const b=K.interaxial_distance?{interaxialDistance:K.interaxial_distance}:{};k.setCameraRigMode(K.cameraRigMode,b)}if(K.animations){for(let b=0;b<K.animations.length;b++){const e=K.animations[b],z=(0,X.d)("BABYLON.Animation");z&&k.animations.push(z.Parse(e))}Y.e.ParseAnimationRanges(k,K,b)}return K.autoAnimate&&b.beginAnimation(k,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),void 0!==K.isEnabled&&k.yb(K.isEnabled),k}_calculateHandednessMultiplier(){let K=this.va().useRightHandedSystem?-1:1;return this.parent&&this.parent._getWorldMatrixDeterminant()<0&&(K*=-1),K}}m._CreateDefaultParsedCamera=(K,b)=>{throw(0,t.c)("UniversalCamera")},m.PERSPECTIVE_CAMERA=0,m.ORTHOGRAPHIC_CAMERA=1,m.FOVMODE_VERTICAL_FIXED=0,m.FOVMODE_HORIZONTAL_FIXED=1,m.RIG_MODE_NONE=0,m.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,m.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,m.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,m.RIG_MODE_STEREOSCOPIC_INTERLACED=14,m.RIG_MODE_VR=20,m.RIG_MODE_CUSTOM=22,m.ForceAttachControlToAlwaysPreventDefault=!1,(0,z.b)([(0,k.L)("position")],m.prototype,"_position",void 0),(0,z.b)([(0,k.L)("upVector")],m.prototype,"_upVector",void 0),(0,z.b)([(0,k.M)()],m.prototype,"orthoLeft",null),(0,z.b)([(0,k.M)()],m.prototype,"orthoRight",null),(0,z.b)([(0,k.M)()],m.prototype,"orthoBottom",null),(0,z.b)([(0,k.M)()],m.prototype,"orthoTop",null),(0,z.b)([(0,k.M)()],m.prototype,"fov",void 0),(0,z.b)([(0,k.M)()],m.prototype,"projectionPlaneTilt",void 0),(0,z.b)([(0,k.M)()],m.prototype,"Fi",void 0),(0,z.b)([(0,k.M)()],m.prototype,"maxZ",void 0),(0,z.b)([(0,k.M)()],m.prototype,"inertia",void 0),(0,z.b)([(0,k.M)()],m.prototype,"mode",null),(0,z.b)([(0,k.M)()],m.prototype,"layerMask",void 0),(0,z.b)([(0,k.M)()],m.prototype,"fovMode",void 0),(0,z.b)([(0,k.M)()],m.prototype,"cameraRigMode",void 0),(0,z.b)([(0,k.M)()],m.prototype,"interaxialDistance",void 0),(0,z.b)([(0,k.M)()],m.prototype,"isStereoscopicSideBySide",void 0)},11887:(K,b,e)=>{"use strict";e.d(b,{c:()=>T,e:()=>F});var z=e(10696),k=e(11001),j=e(11237),T={};class F{constructor(K){this.attachedToElement=!1,this.attached={},this.camera=K,this.checkInputs=()=>{}}add(K){const b=K.getSimpleName();this.attached[b]?z.b.Warn("camera input of type "+b+" already exists on camera"):(this.attached[b]=K,K.camera=this.camera,K.checkInputs&&(this.checkInputs=this._addCheckInputs(K.checkInputs.bind(K))),this.attachedToElement&&K.attachControl(this.noPreventDefault))}remove(K){for(const b in this.attached){const e=this.attached[b];if(e===K)return e.Bi(),e.camera=null,delete this.attached[b],void this.rebuildInputCheck()}}removeByType(K){for(const b in this.attached){const e=this.attached[b];e.getClassName()===K&&(e.Bi(),e.camera=null,delete this.attached[b],this.rebuildInputCheck())}}_addCheckInputs(K){const b=this.checkInputs;return()=>{b(),K()}}attachInput(K){this.attachedToElement&&K.attachControl(this.noPreventDefault)}attachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.attachedToElement){K=!j.e.ForceAttachControlToAlwaysPreventDefault&&K,this.attachedToElement=!0,this.noPreventDefault=K;for(const b in this.attached)this.attached[b].attachControl(K)}}detachElement(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];for(const b in this.attached)this.attached[b].Bi(),K&&(this.attached[b].camera=null);this.attachedToElement=!1}rebuildInputCheck(){this.checkInputs=()=>{};for(const K in this.attached){const b=this.attached[K];b.checkInputs&&(this.checkInputs=this._addCheckInputs(b.checkInputs.bind(b)))}}clear(){this.attachedToElement&&this.detachElement(!0),this.attached={},this.attachedToElement=!1,this.checkInputs=()=>{}}serialize(K){const b={};for(const e in this.attached){const K=this.attached[e],z=k.e.Serialize(K);b[K.getClassName()]=z}K.inputsmgr=b}parse(K){const b=K.inputsmgr;if(b){this.clear();for(const K in b){const e=T[K];if(e){const z=b[K],j=k.e.Parse((()=>new e),z,null);this.add(j)}}}else for(const e in this.attached){const b=T[this.attached[e].getClassName()];if(b){const z=k.e.Parse((()=>new b),K,null);this.remove(this.attached[e]),this.add(z)}}}}},11876:(K,b,e)=>{"use strict";e.d(b,{d:()=>i});var z=e(10936),k=e(10938),j=e(10967),T=e(11885),F=e(11887),l=e(11057),Y=e(10686);class A{constructor(){this.keysUp=[38],this.keysUpward=[33],this.keysDown=[40],this.keysDownward=[34],this.keysLeft=[37],this.keysRight=[39],this.rotationSpeed=.5,this.keysRotateLeft=[],this.keysRotateRight=[],this.keysRotateUp=[],this.keysRotateDown=[],this._keys=new Array}attachControl(K){K=Y.f.BackCompatCameraNoPreventDefault(arguments),this._onCanvasBlurObserver||(this._scene=this.camera.va(),this._engine=this._scene.getEngine(),this._onCanvasBlurObserver=this._engine.onCanvasBlurObservable.add((()=>{this._keys.length=0})),this._onKeyboardObserver=this._scene.onKeyboardObservable.add((b=>{const e=b.event;if(!e.metaKey)if(b.type===l.e.KEYDOWN){if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysUpward.indexOf(e.keyCode)||-1!==this.keysDownward.indexOf(e.keyCode)||-1!==this.keysRotateLeft.indexOf(e.keyCode)||-1!==this.keysRotateRight.indexOf(e.keyCode)||-1!==this.keysRotateUp.indexOf(e.keyCode)||-1!==this.keysRotateDown.indexOf(e.keyCode)){-1===this._keys.indexOf(e.keyCode)&&this._keys.push(e.keyCode),K||e.preventDefault()}}else if(-1!==this.keysUp.indexOf(e.keyCode)||-1!==this.keysDown.indexOf(e.keyCode)||-1!==this.keysLeft.indexOf(e.keyCode)||-1!==this.keysRight.indexOf(e.keyCode)||-1!==this.keysUpward.indexOf(e.keyCode)||-1!==this.keysDownward.indexOf(e.keyCode)||-1!==this.keysRotateLeft.indexOf(e.keyCode)||-1!==this.keysRotateRight.indexOf(e.keyCode)||-1!==this.keysRotateUp.indexOf(e.keyCode)||-1!==this.keysRotateDown.indexOf(e.keyCode)){const b=this._keys.indexOf(e.keyCode);b>=0&&this._keys.splice(b,1),K||e.preventDefault()}})))}Bi(){this._scene&&(this._onKeyboardObserver&&this._scene.onKeyboardObservable.remove(this._onKeyboardObserver),this._onCanvasBlurObserver&&this._engine.onCanvasBlurObservable.remove(this._onCanvasBlurObserver),this._onKeyboardObserver=null,this._onCanvasBlurObserver=null),this._keys.length=0}checkInputs(){if(this._onKeyboardObserver){const K=this.camera;for(let b=0;b<this._keys.length;b++){const e=this._keys[b],z=K._computeLocalCameraSpeed();-1!==this.keysLeft.indexOf(e)?K._localDirection.Yd(-z,0,0):-1!==this.keysUp.indexOf(e)?K._localDirection.Yd(0,0,z):-1!==this.keysRight.indexOf(e)?K._localDirection.Yd(z,0,0):-1!==this.keysDown.indexOf(e)?K._localDirection.Yd(0,0,-z):-1!==this.keysUpward.indexOf(e)?K._localDirection.Yd(0,z,0):-1!==this.keysDownward.indexOf(e)?K._localDirection.Yd(0,-z,0):-1!==this.keysRotateLeft.indexOf(e)?(K._localDirection.Yd(0,0,0),K.cameraRotation.y-=this._getLocalRotation()):-1!==this.keysRotateRight.indexOf(e)?(K._localDirection.Yd(0,0,0),K.cameraRotation.y+=this._getLocalRotation()):-1!==this.keysRotateUp.indexOf(e)?(K._localDirection.Yd(0,0,0),K.cameraRotation.x-=this._getLocalRotation()):-1!==this.keysRotateDown.indexOf(e)&&(K._localDirection.Yd(0,0,0),K.cameraRotation.x+=this._getLocalRotation()),K.va().useRightHandedSystem&&(K._localDirection.z*=-1),K.getViewMatrix().invertToRef(K._cameraTransformMatrix),j.k.TransformNormalToRef(K._localDirection,K._cameraTransformMatrix,K._transformedDirection),K.cameraDirection.addInPlace(K._transformedDirection)}}}getClassName(){return"FreeCameraKeyboardMoveInput"}_onLostFocus(){this._keys.length=0}getSimpleName(){return"keyboard"}_getLocalRotation(){const K=this.camera._calculateHandednessMultiplier();return this.rotationSpeed*this._engine.getDeltaTime()/1e3*K}}(0,z.b)([(0,k.M)()],A.prototype,"keysUp",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysUpward",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysDown",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysDownward",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysLeft",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysRight",void 0),(0,z.b)([(0,k.M)()],A.prototype,"rotationSpeed",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysRotateLeft",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysRotateRight",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysRotateUp",void 0),(0,z.b)([(0,k.M)()],A.prototype,"keysRotateDown",void 0),F.c.FreeCameraKeyboardMoveInput=A;var X=e(10690),t=e(11054);class U{constructor(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.touchEnabled=K,this.buttons=[0,1,2],this.angularSensibility=2e3,this._previousPosition=null,this.onPointerMovedObservable=new X.d,this._allowCameraRotation=!0,this._currentActiveButton=-1,this._activePointerId=-1}attachControl(K){K=Y.f.BackCompatCameraNoPreventDefault(arguments);const b=this.camera.getEngine(),e=b.getInputElement();this._pointerInput||(this._pointerInput=z=>{const k=z.event,j="touch"===k.pointerType;if(!this.touchEnabled&&j)return;if(z.type!==t.b.POINTERMOVE&&-1===this.buttons.indexOf(k.button))return;const T=k.target;if(z.type===t.b.POINTERDOWN){if(j&&-1!==this._activePointerId||!j&&-1!==this._currentActiveButton)return;this._activePointerId=k.pointerId;try{null===T||void 0===T||T.setPointerCapture(k.pointerId)}catch(F){}-1===this._currentActiveButton&&(this._currentActiveButton=k.button),this._previousPosition={x:k.clientX,y:k.clientY},K||(k.preventDefault(),e&&e.focus()),b.isPointerLock&&this._onMouseMove&&this._onMouseMove(z.event)}else if(z.type===t.b.POINTERUP){if(j&&this._activePointerId!==k.pointerId||!j&&this._currentActiveButton!==k.button)return;try{null===T||void 0===T||T.releasePointerCapture(k.pointerId)}catch(F){}this._currentActiveButton=-1,this._previousPosition=null,K||k.preventDefault(),this._activePointerId=-1}else if(z.type===t.b.POINTERMOVE&&(this._activePointerId===k.pointerId||!j))if(b.isPointerLock&&this._onMouseMove)this._onMouseMove(z.event);else if(this._previousPosition){const b=this.camera._calculateHandednessMultiplier(),e=(k.clientX-this._previousPosition.x)*b,z=k.clientY-this._previousPosition.y;this._allowCameraRotation&&(this.camera.cameraRotation.y+=e/this.angularSensibility,this.camera.cameraRotation.x+=z/this.angularSensibility),this.onPointerMovedObservable.notifyObservers({offsetX:e,offsetY:z}),this._previousPosition={x:k.clientX,y:k.clientY},K||k.preventDefault()}}),this._onMouseMove=e=>{if(!b.isPointerLock)return;const z=this.camera._calculateHandednessMultiplier(),k=e.movementX*z;this.camera.cameraRotation.y+=k/this.angularSensibility;const j=e.movementY;this.camera.cameraRotation.x+=j/this.angularSensibility,this._previousPosition=null,K||e.preventDefault()},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,t.b.POINTERDOWN|t.b.POINTERUP|t.b.POINTERMOVE),e&&(this._contextMenuBind=K=>this.onContextMenu(K),e.addEventListener("contextmenu",this._contextMenuBind,!1))}onContextMenu(K){K.preventDefault()}Bi(){if(this._observer){if(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._contextMenuBind){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("contextmenu",this._contextMenuBind)}this.onPointerMovedObservable&&this.onPointerMovedObservable.clear(),this._observer=null,this._onMouseMove=null,this._previousPosition=null}this._activePointerId=-1,this._currentActiveButton=-1}getClassName(){return"FreeCameraMouseInput"}getSimpleName(){return"mouse"}}(0,z.b)([(0,k.M)()],U.prototype,"buttons",void 0),(0,z.b)([(0,k.M)()],U.prototype,"angularSensibility",void 0),F.c.FreeCameraMouseInput=U;var B,u=e(11059);class m{constructor(){this.wheelPrecisionX=3,this.wheelPrecisionY=3,this.wheelPrecisionZ=3,this.onChangedObservable=new X.d,this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0,this._ffMultiplier=12,this._normalize=120}attachControl(K){K=Y.f.BackCompatCameraNoPreventDefault(arguments),this._wheel=b=>{if(b.type!==t.b.POINTERWHEEL)return;const e=b.event,z=e.deltaMode===u.e.DOM_DELTA_LINE?this._ffMultiplier:1;this._wheelDeltaX+=this.wheelPrecisionX*z*e.deltaX/this._normalize,this._wheelDeltaY-=this.wheelPrecisionY*z*e.deltaY/this._normalize,this._wheelDeltaZ+=this.wheelPrecisionZ*z*e.deltaZ/this._normalize,e.preventDefault&&(K||e.preventDefault())},this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._wheel,t.b.POINTERWHEEL)}Bi(){this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null,this._wheel=null),this.onChangedObservable&&this.onChangedObservable.clear()}checkInputs(){this.onChangedObservable.notifyObservers({wheelDeltaX:this._wheelDeltaX,wheelDeltaY:this._wheelDeltaY,wheelDeltaZ:this._wheelDeltaZ}),this._wheelDeltaX=0,this._wheelDeltaY=0,this._wheelDeltaZ=0}getClassName(){return"BaseCameraMouseWheelInput"}getSimpleName(){return"mousewheel"}}(0,z.b)([(0,k.M)()],m.prototype,"wheelPrecisionX",void 0),(0,z.b)([(0,k.M)()],m.prototype,"wheelPrecisionY",void 0),(0,z.b)([(0,k.M)()],m.prototype,"wheelPrecisionZ",void 0),function(K){K[K.MoveRelative=0]="MoveRelative",K[K.RotateRelative=1]="RotateRelative",K[K.MoveScene=2]="MoveScene"}(B||(B={}));class D extends m{constructor(){super(...arguments),this._moveRelative=j.k.Zero(),this._rotateRelative=j.k.Zero(),this._moveScene=j.k.Zero(),this._wheelXAction=B.MoveRelative,this._wheelXActionCoordinate=0,this._wheelYAction=B.MoveRelative,this._wheelYActionCoordinate=2,this._wheelZAction=null,this._wheelZActionCoordinate=null}getClassName(){return"FreeCameraMouseWheelInput"}set wheelXMoveRelative(K){null===K&&this._wheelXAction!==B.MoveRelative||(this._wheelXAction=B.MoveRelative,this._wheelXActionCoordinate=K)}get wheelXMoveRelative(){return this._wheelXAction!==B.MoveRelative?null:this._wheelXActionCoordinate}set wheelYMoveRelative(K){null===K&&this._wheelYAction!==B.MoveRelative||(this._wheelYAction=B.MoveRelative,this._wheelYActionCoordinate=K)}get wheelYMoveRelative(){return this._wheelYAction!==B.MoveRelative?null:this._wheelYActionCoordinate}set wheelZMoveRelative(K){null===K&&this._wheelZAction!==B.MoveRelative||(this._wheelZAction=B.MoveRelative,this._wheelZActionCoordinate=K)}get wheelZMoveRelative(){return this._wheelZAction!==B.MoveRelative?null:this._wheelZActionCoordinate}set wheelXRotateRelative(K){null===K&&this._wheelXAction!==B.RotateRelative||(this._wheelXAction=B.RotateRelative,this._wheelXActionCoordinate=K)}get wheelXRotateRelative(){return this._wheelXAction!==B.RotateRelative?null:this._wheelXActionCoordinate}set wheelYRotateRelative(K){null===K&&this._wheelYAction!==B.RotateRelative||(this._wheelYAction=B.RotateRelative,this._wheelYActionCoordinate=K)}get wheelYRotateRelative(){return this._wheelYAction!==B.RotateRelative?null:this._wheelYActionCoordinate}set wheelZRotateRelative(K){null===K&&this._wheelZAction!==B.RotateRelative||(this._wheelZAction=B.RotateRelative,this._wheelZActionCoordinate=K)}get wheelZRotateRelative(){return this._wheelZAction!==B.RotateRelative?null:this._wheelZActionCoordinate}set wheelXMoveScene(K){null===K&&this._wheelXAction!==B.MoveScene||(this._wheelXAction=B.MoveScene,this._wheelXActionCoordinate=K)}get wheelXMoveScene(){return this._wheelXAction!==B.MoveScene?null:this._wheelXActionCoordinate}set wheelYMoveScene(K){null===K&&this._wheelYAction!==B.MoveScene||(this._wheelYAction=B.MoveScene,this._wheelYActionCoordinate=K)}get wheelYMoveScene(){return this._wheelYAction!==B.MoveScene?null:this._wheelYActionCoordinate}set wheelZMoveScene(K){null===K&&this._wheelZAction!==B.MoveScene||(this._wheelZAction=B.MoveScene,this._wheelZActionCoordinate=K)}get wheelZMoveScene(){return this._wheelZAction!==B.MoveScene?null:this._wheelZActionCoordinate}checkInputs(){if(0===this._wheelDeltaX&&0===this._wheelDeltaY&&0==this._wheelDeltaZ)return;this._moveRelative.Wd(0),this._rotateRelative.Wd(0),this._moveScene.Wd(0),this._updateCamera(),this.camera.va().useRightHandedSystem&&(this._moveRelative.z*=-1);const K=j.b.Zero();this.camera.getViewMatrix().invertToRef(K);const b=j.k.Zero();j.k.TransformNormalToRef(this._moveRelative,K,b),this.camera.cameraRotation.x+=this._rotateRelative.x/200,this.camera.cameraRotation.y+=this._rotateRelative.y/200,this.camera.cameraDirection.addInPlace(b),this.camera.cameraDirection.addInPlace(this._moveScene),super.checkInputs()}_updateCamera(){this._updateCameraProperty(this._wheelDeltaX,this._wheelXAction,this._wheelXActionCoordinate),this._updateCameraProperty(this._wheelDeltaY,this._wheelYAction,this._wheelYActionCoordinate),this._updateCameraProperty(this._wheelDeltaZ,this._wheelZAction,this._wheelZActionCoordinate)}_updateCameraProperty(K,b,e){if(0===K)return;if(null===b||null===e)return;let z=null;switch(b){case B.MoveRelative:z=this._moveRelative;break;case B.RotateRelative:z=this._rotateRelative;break;case B.MoveScene:z=this._moveScene}switch(e){case 0:z.set(K,0,0);break;case 1:z.set(0,K,0);break;case 2:z.set(0,0,K)}}}(0,z.b)([(0,k.M)()],D.prototype,"wheelXMoveRelative",null),(0,z.b)([(0,k.M)()],D.prototype,"wheelYMoveRelative",null),(0,z.b)([(0,k.M)()],D.prototype,"wheelZMoveRelative",null),(0,z.b)([(0,k.M)()],D.prototype,"wheelXRotateRelative",null),(0,z.b)([(0,k.M)()],D.prototype,"wheelYRotateRelative",null),(0,z.b)([(0,k.M)()],D.prototype,"wheelZRotateRelative",null),(0,z.b)([(0,k.M)()],D.prototype,"wheelXMoveScene",null),(0,z.b)([(0,k.M)()],D.prototype,"wheelYMoveScene",null),(0,z.b)([(0,k.M)()],D.prototype,"wheelZMoveScene",null),F.c.FreeCameraMouseWheelInput=D;class I{constructor(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.allowMouse=K,this.touchAngularSensibility=2e5,this.touchMoveSensibility=250,this.singleFingerRotate=!1,this._offsetX=null,this._offsetY=null,this._pointerPressed=new Array,this._isSafari=Y.f.IsSafari()}attachControl(K){K=Y.f.BackCompatCameraNoPreventDefault(arguments);let b=null;if(void 0===this._pointerInput&&(this._onLostFocus=()=>{this._offsetX=null,this._offsetY=null},this._pointerInput=e=>{const z=e.event,k="mouse"===z.pointerType||this._isSafari&&"undefined"===typeof z.pointerType;if(this.allowMouse||!k)if(e.type===t.b.POINTERDOWN){if(K||z.preventDefault(),this._pointerPressed.push(z.pointerId),1!==this._pointerPressed.length)return;b={x:z.clientX,y:z.clientY}}else if(e.type===t.b.POINTERUP){K||z.preventDefault();const e=this._pointerPressed.indexOf(z.pointerId);if(-1===e)return;if(this._pointerPressed.splice(e,1),0!=e)return;b=null,this._offsetX=null,this._offsetY=null}else if(e.type===t.b.POINTERMOVE){if(K||z.preventDefault(),!b)return;if(0!=this._pointerPressed.indexOf(z.pointerId))return;this._offsetX=z.clientX-b.x,this._offsetY=-(z.clientY-b.y)}}),this._observer=this.camera.va()._inputManager._addCameraPointerObserver(this._pointerInput,t.b.POINTERDOWN|t.b.POINTERUP|t.b.POINTERMOVE),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.addEventListener("blur",this._onLostFocus)}}Bi(){if(this._pointerInput){if(this._observer&&(this.camera.va()._inputManager._removeCameraPointerObserver(this._observer),this._observer=null),this._onLostFocus){const K=this.camera.getEngine().getInputElement();K&&K.removeEventListener("blur",this._onLostFocus),this._onLostFocus=null}this._pointerPressed.length=0,this._offsetX=null,this._offsetY=null}}checkInputs(){if(null===this._offsetX||null===this._offsetY)return;if(0===this._offsetX&&0===this._offsetY)return;const K=this.camera,b=K._calculateHandednessMultiplier();K.cameraRotation.y=b*this._offsetX/this.touchAngularSensibility;if(this.singleFingerRotate&&1===this._pointerPressed.length||!this.singleFingerRotate&&this._pointerPressed.length>1)K.cameraRotation.x=-this._offsetY/this.touchAngularSensibility;else{const b=K._computeLocalCameraSpeed(),e=new j.k(0,0,0!==this.touchMoveSensibility?b*this._offsetY/this.touchMoveSensibility:0);j.b.RotationYawPitchRollToRef(K.rotation.y,K.rotation.x,0,K._cameraRotationMatrix),K.cameraDirection.addInPlace(j.k.TransformCoordinates(e,K._cameraRotationMatrix))}}getClassName(){return"FreeCameraTouchInput"}getSimpleName(){return"touch"}}(0,z.b)([(0,k.M)()],I.prototype,"touchAngularSensibility",void 0),(0,z.b)([(0,k.M)()],I.prototype,"touchMoveSensibility",void 0),F.c.FreeCameraTouchInput=I;class x extends F.e{constructor(K){super(K),this._mouseInput=null,this._mouseWheelInput=null}addKeyboard(){return this.add(new A),this}addMouse(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._mouseInput||(this._mouseInput=new U(K),this.add(this._mouseInput)),this}removeMouse(){return this._mouseInput&&this.remove(this._mouseInput),this}addMouseWheel(){return this._mouseWheelInput||(this._mouseWheelInput=new D,this.add(this._mouseWheelInput)),this}removeMouseWheel(){return this._mouseWheelInput&&this.remove(this._mouseWheelInput),this}addTouch(){return this.add(new I),this}clear(){super.clear(),this._mouseInput=null}}var Q=e(10799),G=e(10750);class i extends T.b{get angularSensibility(){const K=this.inputs.attached.mouse;return K?K.angularSensibility:0}set angularSensibility(K){const b=this.inputs.attached.mouse;b&&(b.angularSensibility=K)}get keysUp(){const K=this.inputs.attached.keyboard;return K?K.keysUp:[]}set keysUp(K){const b=this.inputs.attached.keyboard;b&&(b.keysUp=K)}get keysUpward(){const K=this.inputs.attached.keyboard;return K?K.keysUpward:[]}set keysUpward(K){const b=this.inputs.attached.keyboard;b&&(b.keysUpward=K)}get keysDown(){const K=this.inputs.attached.keyboard;return K?K.keysDown:[]}set keysDown(K){const b=this.inputs.attached.keyboard;b&&(b.keysDown=K)}get keysDownward(){const K=this.inputs.attached.keyboard;return K?K.keysDownward:[]}set keysDownward(K){const b=this.inputs.attached.keyboard;b&&(b.keysDownward=K)}get keysLeft(){const K=this.inputs.attached.keyboard;return K?K.keysLeft:[]}set keysLeft(K){const b=this.inputs.attached.keyboard;b&&(b.keysLeft=K)}get keysRight(){const K=this.inputs.attached.keyboard;return K?K.keysRight:[]}set keysRight(K){const b=this.inputs.attached.keyboard;b&&(b.keysRight=K)}get keysRotateLeft(){const K=this.inputs.attached.keyboard;return K?K.keysRotateLeft:[]}set keysRotateLeft(K){const b=this.inputs.attached.keyboard;b&&(b.keysRotateLeft=K)}get keysRotateRight(){const K=this.inputs.attached.keyboard;return K?K.keysRotateRight:[]}set keysRotateRight(K){const b=this.inputs.attached.keyboard;b&&(b.keysRotateRight=K)}get keysRotateUp(){const K=this.inputs.attached.keyboard;return K?K.keysRotateUp:[]}set keysRotateUp(K){const b=this.inputs.attached.keyboard;b&&(b.keysRotateUp=K)}get keysRotateDown(){const K=this.inputs.attached.keyboard;return K?K.keysRotateDown:[]}set keysRotateDown(K){const b=this.inputs.attached.keyboard;b&&(b.keysRotateDown=K)}constructor(K,b,e){var z;super(K,b,e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),z=this,this.ellipsoid=new j.k(.5,1,.5),this.ellipsoidOffset=new j.k(0,0,0),this.checkCollisions=!1,this.applyGravity=!1,this._needMoveForGravity=!1,this._oldPosition=j.k.Zero(),this._diffPosition=j.k.Zero(),this._newPosition=j.k.Zero(),this._collisionMask=-1,this._onCollisionPositionChange=function(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;z._newPosition.p(b),z._newPosition.subtractToRef(z._oldPosition,z._diffPosition),z._diffPosition.length()>G.e.CollisionsEpsilon&&(z.position.addToRef(z._diffPosition,z._deferredPositionUpdate),z._deferOnly?z._deferredUpdated=!0:z.position.p(z._deferredPositionUpdate),z.sk&&e&&z.sk(e))},this.inputs=new x(this),this.inputs.addKeyboard().addMouse()}attachControl(K,b){b=Y.f.BackCompatCameraNoPreventDefault(arguments),this.inputs.attachElement(b)}Bi(){this.inputs.detachElement(),this.cameraDirection=new j.k(0,0,0),this.cameraRotation=new j.h(0,0)}get collisionMask(){return this._collisionMask}set collisionMask(K){this._collisionMask=isNaN(K)?-1:K}_collideWithWorld(K){let b;b=this.parent?j.k.TransformCoordinates(this.position,this.parent.getWorldMatrix()):this.position,b.subtractFromFloatsToRef(0,this.ellipsoid.y,0,this._oldPosition),this._oldPosition.addInPlace(this.ellipsoidOffset);const e=this.va().collisionCoordinator;this._collider||(this._collider=e.createCollider()),this._collider._radius=this.ellipsoid,this._collider.collisionMask=this._collisionMask;let z=K;this.applyGravity&&(z=K.add(this.va().gravity)),e.getNewPosition(this._oldPosition,z,this._collider,3,null,this._onCollisionPositionChange,this.uniqueId)}_checkInputs(){this._localDirection||(this._localDirection=j.k.Zero(),this._transformedDirection=j.k.Zero()),this.inputs.checkInputs(),super._checkInputs()}set needMoveForGravity(K){this._needMoveForGravity=K}get needMoveForGravity(){return this._needMoveForGravity}_decideIfNeedsToMove(){return this._needMoveForGravity||Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){this.checkCollisions&&this.va().collisionsEnabled?this._collideWithWorld(this.cameraDirection):super._updatePosition()}dispose(){this.inputs.clear(),super.dispose()}getClassName(){return"ib"}}(0,z.b)([(0,k.L)()],i.prototype,"ellipsoid",void 0),(0,z.b)([(0,k.L)()],i.prototype,"ellipsoidOffset",void 0),(0,z.b)([(0,k.M)()],i.prototype,"checkCollisions",void 0),(0,z.b)([(0,k.M)()],i.prototype,"applyGravity",void 0),(0,Q.e)("BABYLON.FreeCamera",i)},11885:(K,b,e)=>{"use strict";e.d(b,{b:()=>Y});var z=e(10936),k=e(10938),j=e(11237),T=e(10967),F=e(10969),l=e(11291);e(11243).e.AddNodeConstructor("TargetCamera",((K,b)=>()=>new Y(K,T.k.Zero(),b)));class Y extends j.e{constructor(K,b,e){super(K,b,e,!(arguments.length>3&&void 0!==arguments[3])||arguments[3]),this._tmpUpVector=T.k.Zero(),this._tmpTargetVector=T.k.Zero(),this.cameraDirection=new T.k(0,0,0),this.cameraRotation=new T.h(0,0),this.ignoreParentScaling=!1,this.updateUpVectorFromRotation=!1,this._tmpQuaternion=new T.d,this.rotation=new T.k(0,0,0),this.speed=2,this.noRotationConstraint=!1,this.invertRotation=!1,this.inverseRotationSpeed=.2,this.lockedTarget=null,this._currentTarget=T.k.Zero(),this._initialFocalDistance=1,this._viewMatrix=T.b.Zero(),this._camMatrix=T.b.Zero(),this._cameraTransformMatrix=T.b.Zero(),this._cameraRotationMatrix=T.b.Zero(),this._referencePoint=new T.k(0,0,1),this._transformedReferencePoint=T.k.Zero(),this._deferredPositionUpdate=new T.k,this._deferredRotationQuaternionUpdate=new T.d,this._deferredRotationUpdate=new T.k,this._deferredUpdated=!1,this._deferOnly=!1,this._defaultUp=T.k.Up(),this._cachedRotationZ=0,this._cachedQuaternionRotationZ=0}getFrontPosition(K){this.getWorldMatrix();const b=this.getTarget().Qc(this.position);return b.normalize(),b.scaleInPlace(K),this.globalPosition.add(b)}_getLockedTargetPosition(){if(!this.lockedTarget)return null;if(this.lockedTarget.absolutePosition){const K=this.lockedTarget;K.xj().getTranslationToRef(K.absolutePosition)}return this.lockedTarget.absolutePosition||this.lockedTarget}storeState(){return this._storedPosition=this.position.clone(),this._storedRotation=this.rotation.clone(),this.rotationQuaternion&&(this._storedRotationQuaternion=this.rotationQuaternion.clone()),super.storeState()}_restoreStateValues(){return!!super._restoreStateValues()&&(this.position=this._storedPosition.clone(),this.rotation=this._storedRotation.clone(),this.rotationQuaternion&&(this.rotationQuaternion=this._storedRotationQuaternion.clone()),this.cameraDirection.Yd(0,0,0),this.cameraRotation.Yd(0,0),!0)}_initCache(){super._initCache(),this._cache.lockedTarget=new T.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotation=new T.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),this._cache.rotationQuaternion=new T.d(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)}_updateCache(K){K||super._updateCache();const b=this._getLockedTargetPosition();b?this._cache.lockedTarget?this._cache.lockedTarget.p(b):this._cache.lockedTarget=b.clone():this._cache.lockedTarget=null,this._cache.rotation.p(this.rotation),this.rotationQuaternion&&this._cache.rotationQuaternion.p(this.rotationQuaternion)}_isSynchronizedViewMatrix(){if(!super._isSynchronizedViewMatrix())return!1;const K=this._getLockedTargetPosition();return(this._cache.lockedTarget?this._cache.lockedTarget.equals(K):!K)&&(this.rotationQuaternion?this.rotationQuaternion.equals(this._cache.rotationQuaternion):this._cache.rotation.equals(this.rotation))}_computeLocalCameraSpeed(){const K=this.getEngine();return this.speed*Math.sqrt(K.getDeltaTime()/(100*K.getFps()))}setTarget(K){this.upVector.normalize(),this._initialFocalDistance=K.Qc(this.position).length(),this.position.z===K.z&&(this.position.z+=F.c),this._referencePoint.normalize().scaleInPlace(this._initialFocalDistance),T.b.LookAtLHToRef(this.position,K,this._defaultUp,this._camMatrix),this._camMatrix.invert(),this.rotation.x=Math.atan(this._camMatrix.m[6]/this._camMatrix.m[10]);const b=K.Qc(this.position);b.x>=0?this.rotation.y=-Math.atan(b.z/b.x)+Math.PI/2:this.rotation.y=-Math.atan(b.z/b.x)-Math.PI/2,this.rotation.z=0,isNaN(this.rotation.x)&&(this.rotation.x=0),isNaN(this.rotation.y)&&(this.rotation.y=0),isNaN(this.rotation.z)&&(this.rotation.z=0),this.rotationQuaternion&&T.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this.rotationQuaternion)}get target(){return this.getTarget()}set target(K){this.setTarget(K)}getTarget(){return this._currentTarget}_decideIfNeedsToMove(){return Math.abs(this.cameraDirection.x)>0||Math.abs(this.cameraDirection.y)>0||Math.abs(this.cameraDirection.z)>0}_updatePosition(){if(this.parent)return this.parent.getWorldMatrix().invertToRef(T.e.Matrix[0]),T.k.TransformNormalToRef(this.cameraDirection,T.e.Matrix[0],T.e.gb[0]),this._deferredPositionUpdate.addInPlace(T.e.gb[0]),void(this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate));this._deferredPositionUpdate.addInPlace(this.cameraDirection),this._deferOnly?this._deferredUpdated=!0:this.position.p(this._deferredPositionUpdate)}_checkInputs(){const K=this.invertRotation?-this.inverseRotationSpeed:1,b=this._decideIfNeedsToMove(),e=this.cameraRotation.x||this.cameraRotation.y;if(this._deferredUpdated=!1,this._deferredRotationUpdate.p(this.rotation),this._deferredPositionUpdate.p(this.position),this.rotationQuaternion&&this._deferredRotationQuaternionUpdate.p(this.rotationQuaternion),b&&this._updatePosition(),e){if(this.rotationQuaternion&&this.rotationQuaternion.toEulerAnglesToRef(this._deferredRotationUpdate),this._deferredRotationUpdate.x+=this.cameraRotation.x*K,this._deferredRotationUpdate.y+=this.cameraRotation.y*K,!this.noRotationConstraint){const K=1.570796;this._deferredRotationUpdate.x>K&&(this._deferredRotationUpdate.x=K),this._deferredRotationUpdate.x<-K&&(this._deferredRotationUpdate.x=-K)}if(this._deferOnly?this._deferredUpdated=!0:this.rotation.p(this._deferredRotationUpdate),this.rotationQuaternion){this._deferredRotationUpdate.lengthSquared()&&(T.d.RotationYawPitchRollToRef(this._deferredRotationUpdate.y,this._deferredRotationUpdate.x,this._deferredRotationUpdate.z,this._deferredRotationQuaternionUpdate),this._deferOnly?this._deferredUpdated=!0:this.rotationQuaternion.p(this._deferredRotationQuaternionUpdate))}}b&&(Math.abs(this.cameraDirection.x)<this.speed*F.c&&(this.cameraDirection.x=0),Math.abs(this.cameraDirection.y)<this.speed*F.c&&(this.cameraDirection.y=0),Math.abs(this.cameraDirection.z)<this.speed*F.c&&(this.cameraDirection.z=0),this.cameraDirection.scaleInPlace(this.inertia)),e&&(Math.abs(this.cameraRotation.x)<this.speed*F.c&&(this.cameraRotation.x=0),Math.abs(this.cameraRotation.y)<this.speed*F.c&&(this.cameraRotation.y=0),this.cameraRotation.scaleInPlace(this.inertia)),super._checkInputs()}_updateCameraRotationMatrix(){this.rotationQuaternion?this.rotationQuaternion.toRotationMatrix(this._cameraRotationMatrix):T.b.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,this._cameraRotationMatrix)}_rotateUpVectorWithCameraRotationMatrix(){return T.k.TransformNormalToRef(this._defaultUp,this._cameraRotationMatrix,this.upVector),this}_getViewMatrix(){return this.lockedTarget&&this.setTarget(this._getLockedTargetPosition()),this._updateCameraRotationMatrix(),this.rotationQuaternion&&this._cachedQuaternionRotationZ!=this.rotationQuaternion.z?(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedQuaternionRotationZ=this.rotationQuaternion.z):this._cachedRotationZ!==this.rotation.z&&(this._rotateUpVectorWithCameraRotationMatrix(),this._cachedRotationZ=this.rotation.z),T.k.TransformCoordinatesToRef(this._referencePoint,this._cameraRotationMatrix,this._transformedReferencePoint),this.position.addToRef(this._transformedReferencePoint,this._currentTarget),this.updateUpVectorFromRotation&&(this.rotationQuaternion?l.e.Y.rotateByQuaternionToRef(this.rotationQuaternion,this.upVector):(T.d.FromEulerVectorToRef(this.rotation,this._tmpQuaternion),l.e.Y.rotateByQuaternionToRef(this._tmpQuaternion,this.upVector))),this._computeViewMatrix(this.position,this._currentTarget,this.upVector),this._viewMatrix}_computeViewMatrix(K,b,e){if(this.ignoreParentScaling){if(this.parent){const z=this.parent.getWorldMatrix();T.k.TransformCoordinatesToRef(K,z,this._globalPosition),T.k.TransformCoordinatesToRef(b,z,this._tmpTargetVector),T.k.TransformNormalToRef(e,z,this._tmpUpVector),this._markSyncedWithParent()}else this._globalPosition.p(K),this._tmpTargetVector.p(b),this._tmpUpVector.p(e);this.va().useRightHandedSystem?T.b.LookAtRHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix):T.b.LookAtLHToRef(this._globalPosition,this._tmpTargetVector,this._tmpUpVector,this._viewMatrix)}else if(this.va().useRightHandedSystem?T.b.LookAtRHToRef(K,b,e,this._viewMatrix):T.b.LookAtLHToRef(K,b,e,this._viewMatrix),this.parent){const K=this.parent.getWorldMatrix();this._viewMatrix.invert(),this._viewMatrix.multiplyToRef(K,this._viewMatrix),this._viewMatrix.getTranslationToRef(this._globalPosition),this._viewMatrix.invert(),this._markSyncedWithParent()}else this._globalPosition.p(K)}createRigCamera(K,b){if(this.cameraRigMode!==j.e.RIG_MODE_NONE){const b=new Y(K,this.position.clone(),this.va());return b.isRigCamera=!0,b.rigParent=this,this.cameraRigMode===j.e.RIG_MODE_VR&&(this.rotationQuaternion||(this.rotationQuaternion=new T.d),b._cameraRigParams={},b.rotationQuaternion=new T.d),b.mode=this.mode,b.orthoLeft=this.orthoLeft,b.orthoRight=this.orthoRight,b.orthoTop=this.orthoTop,b.orthoBottom=this.orthoBottom,b}return null}_updateRigCameras(){const K=this._rigCameras[0],b=this._rigCameras[1];switch(this.xj(),this.cameraRigMode){case j.e.RIG_MODE_STEREOSCOPIC_ANAGLYPH:case j.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL:case j.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED:case j.e.RIG_MODE_STEREOSCOPIC_OVERUNDER:case j.e.RIG_MODE_STEREOSCOPIC_INTERLACED:{const e=this.cameraRigMode===j.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?1:-1,z=this.cameraRigMode===j.e.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED?-1:1;this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*e,K),this._getRigCamPositionAndTarget(this._cameraRigParams.stereoHalfAngle*z,b);break}case j.e.RIG_MODE_VR:K.rotationQuaternion?(K.rotationQuaternion.p(this.rotationQuaternion),b.rotationQuaternion.p(this.rotationQuaternion)):(K.rotation.p(this.rotation),b.rotation.p(this.rotation)),K.position.p(this.position),b.position.p(this.position)}super._updateRigCameras()}_getRigCamPositionAndTarget(K,b){this.getTarget().subtractToRef(this.position,Y._TargetFocalPoint),Y._TargetFocalPoint.normalize().scaleInPlace(this._initialFocalDistance);const e=Y._TargetFocalPoint.addInPlace(this.position);T.b.TranslationToRef(-e.x,-e.y,-e.z,Y._TargetTransformMatrix),Y._TargetTransformMatrix.multiplyToRef(T.b.RotationAxis(b.upVector,K),Y._RigCamTransformMatrix),T.b.TranslationToRef(e.x,e.y,e.z,Y._TargetTransformMatrix),Y._RigCamTransformMatrix.multiplyToRef(Y._TargetTransformMatrix,Y._RigCamTransformMatrix),T.k.TransformCoordinatesToRef(this.position,Y._RigCamTransformMatrix,b.position),b.setTarget(e)}getClassName(){return"TargetCamera"}}Y._RigCamTransformMatrix=new T.b,Y._TargetTransformMatrix=new T.b,Y._TargetFocalPoint=new T.k,(0,z.b)([(0,k.L)()],Y.prototype,"rotation",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"speed",void 0),(0,z.b)([(0,k.w)("lockedTargetId")],Y.prototype,"lockedTarget",void 0)},11096:(K,b,e)=>{"use strict";e.d(b,{d:()=>z});class z{constructor(K,b,e){this.bu=K,this.bv=b,this.distance=e,this.faceId=0,this.subMeshId=0}}},11021:(K,b,e)=>{"use strict";e.d(b,{c:()=>j});var z=e(10967),k=e(11030);class j{constructor(){this.hit=!1,this.distance=0,this.pickedPoint=null,this.pickedMesh=null,this.bu=0,this.bv=0,this.faceId=-1,this.subMeshFaceId=-1,this.subMeshId=0,this.pickedSprite=null,this.thinInstanceIndex=-1,this.ray=null,this.originMesh=null,this.aimTransform=null,this.gripTransform=null}getNormal(){var K;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.pickedMesh||e&&!this.pickedMesh.isVerticesDataPresent(k.f.NormalKind))return null;let j,T=this.pickedMesh.Lf();0===(null===(K=T)||void 0===K?void 0:K.length)&&(T=null);const F=z.e.gb[0],l=z.e.gb[1],Y=z.e.gb[2];if(e){const K=this.pickedMesh.getVerticesData(k.f.NormalKind);let b=T?z.k.FromArrayToRef(K,3*T[3*this.faceId],F):F.Yd(K[3*this.faceId*3],K[3*this.faceId*3+1],K[3*this.faceId*3+2]),e=T?z.k.FromArrayToRef(K,3*T[3*this.faceId+1],l):l.Yd(K[3*(3*this.faceId+1)],K[3*(3*this.faceId+1)+1],K[3*(3*this.faceId+1)+2]),A=T?z.k.FromArrayToRef(K,3*T[3*this.faceId+2],Y):Y.Yd(K[3*(3*this.faceId+2)],K[3*(3*this.faceId+2)+1],K[3*(3*this.faceId+2)+2]);b=b.scale(this.bu),e=e.scale(this.bv),A=A.scale(1-this.bu-this.bv),j=new z.k(b.x+e.x+A.x,b.y+e.y+A.y,b.z+e.z+A.z)}else{const K=this.pickedMesh.getVerticesData(k.f.PositionKind),b=T?z.k.FromArrayToRef(K,3*T[3*this.faceId],F):F.Yd(K[3*this.faceId*3],K[3*this.faceId*3+1],K[3*this.faceId*3+2]),e=T?z.k.FromArrayToRef(K,3*T[3*this.faceId+1],l):l.Yd(K[3*(3*this.faceId+1)],K[3*(3*this.faceId+1)+1],K[3*(3*this.faceId+1)+2]),A=T?z.k.FromArrayToRef(K,3*T[3*this.faceId+2],Y):Y.Yd(K[3*(3*this.faceId+2)],K[3*(3*this.faceId+2)+1],K[3*(3*this.faceId+2)+2]),X=b.Qc(e),t=A.Qc(e);j=z.k.Cross(X,t)}const A=(K,b)=>{let e=K.getWorldMatrix();K.nonUniformScaling&&(z.e.Matrix[0].p(e),e=z.e.Matrix[0],e.setTranslationFromFloats(0,0,0),e.invert(),e.transposeToRef(z.e.Matrix[1]),e=z.e.Matrix[1]),z.k.TransformNormalToRef(b,e,b)};if(b&&A(this.pickedMesh,j),this.ray){const K=z.e.gb[0].p(j);b||A(this.pickedMesh,K),z.k.Dot(K,this.ray.direction)>0&&j.negateInPlace()}return j.normalize(),j}getTextureCoordinates(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k.f.UVKind;if(!this.pickedMesh||!this.pickedMesh.isVerticesDataPresent(K))return null;const b=this.pickedMesh.Lf();if(!b)return null;const e=this.pickedMesh.getVerticesData(K);if(!e)return null;let j=z.h.Bg(e,2*b[3*this.faceId]),T=z.h.Bg(e,2*b[3*this.faceId+1]),F=z.h.Bg(e,2*b[3*this.faceId+2]);return j=j.scale(this.bu),T=T.scale(this.bv),F=F.scale(1-this.bu-this.bv),new z.h(j.x+T.x+F.x,j.y+T.y+F.y)}}},11186:(K,b,e)=>{"use strict";e.d(b,{c:()=>z});let z=!1},12399:(K,b,e)=>{"use strict";e.d(b,{d:()=>j});var z=e(10951),k=e(12407);class j{constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;this.maxDepth=e,this.Xh=[],this._maxBlockCapacity=b||64,this._selectionContent=new z.e(1024),this._creationFunc=K}update(K,b,e){k.e._CreateBlocks(K,b,e,this._maxBlockCapacity,0,this.maxDepth,this,this._creationFunc)}Wh(K){for(let b=0;b<this.eh.length;b++){this.eh[b].addEntry(K)}}sd(K){for(let b=0;b<this.eh.length;b++){this.eh[b].removeEntry(K)}}select(K,b){this._selectionContent.reset();for(let e=0;e<this.eh.length;e++){this.eh[e].select(K,this._selectionContent,b)}return b?this._selectionContent.concat(this.Xh):this._selectionContent.concatWithNoDuplicate(this.Xh),this._selectionContent}intersects(K,b,e){this._selectionContent.reset();for(let z=0;z<this.eh.length;z++){this.eh[z].intersects(K,b,this._selectionContent,e)}return e?this._selectionContent.concat(this.Xh):this._selectionContent.concatWithNoDuplicate(this.Xh),this._selectionContent}intersectsRay(K){this._selectionContent.reset();for(let b=0;b<this.eh.length;b++){this.eh[b].intersectsRay(K,this._selectionContent)}return this._selectionContent.concatWithNoDuplicate(this.Xh),this._selectionContent}}j.CreationFuncForMeshes=(K,b)=>{const e=K.getBoundingInfo();!K.isBlocked&&e.boundingBox.intersectsMinMax(b._h,b.ai)&&b.entries.push(K)},j.CreationFuncForSubMeshes=(K,b)=>{K.getBoundingInfo().boundingBox.intersectsMinMax(b._h,b.ai)&&b.entries.push(K)}},12407:(K,b,e)=>{"use strict";e.d(b,{e:()=>j});var z=e(10967),k=e(11102);class j{constructor(K,b,e,z,k,j){this.entries=[],this.bi=new Array,this._capacity=e,this._depth=z,this._maxDepth=k,this._creationFunc=j,this._minPoint=K,this._maxPoint=b,this.bi.push(K.clone()),this.bi.push(b.clone()),this.bi.push(K.clone()),this.bi[2].x=b.x,this.bi.push(K.clone()),this.bi[3].y=b.y,this.bi.push(K.clone()),this.bi[4].z=b.z,this.bi.push(b.clone()),this.bi[5].z=K.z,this.bi.push(b.clone()),this.bi[6].x=K.x,this.bi.push(b.clone()),this.bi[7].y=K.y}get kb(){return this._capacity}get _h(){return this._minPoint}get ai(){return this._maxPoint}addEntry(K){if(this.eh)for(let b=0;b<this.eh.length;b++){this.eh[b].addEntry(K)}else this._creationFunc(K,this),this.entries.length>this.kb&&this._depth<this._maxDepth&&this.createInnerBlocks()}removeEntry(K){if(this.eh){for(let b=0;b<this.eh.length;b++){this.eh[b].removeEntry(K)}return}const b=this.entries.indexOf(K);b>-1&&this.entries.splice(b,1)}addEntries(K){for(let b=0;b<K.length;b++){const e=K[b];this.addEntry(e)}}select(K,b,e){if(k.c.IsInFrustum(this.bi,K)){if(this.eh){for(let z=0;z<this.eh.length;z++){this.eh[z].select(K,b,e)}return}e?b.concat(this.entries):b.concatWithNoDuplicate(this.entries)}}intersects(K,b,e,z){if(k.c.IntersectsSphere(this._minPoint,this._maxPoint,K,b)){if(this.eh){for(let k=0;k<this.eh.length;k++){this.eh[k].intersects(K,b,e,z)}return}z?e.concat(this.entries):e.concatWithNoDuplicate(this.entries)}}intersectsRay(K,b){if(K.intersectsBoxMinMax(this._minPoint,this._maxPoint)){if(this.eh){for(let e=0;e<this.eh.length;e++){this.eh[e].intersectsRay(K,b)}return}b.concatWithNoDuplicate(this.entries)}}createInnerBlocks(){j._CreateBlocks(this._minPoint,this._maxPoint,this.entries,this._capacity,this._depth,this._maxDepth,this,this._creationFunc),this.entries.splice(0)}static _CreateBlocks(K,b,e,k,T,F,l,Y){l.eh=new Array;const A=new z.k((b.x-K.x)/2,(b.y-K.y)/2,(b.z-K.z)/2);for(let z=0;z<2;z++)for(let b=0;b<2;b++)for(let X=0;X<2;X++){const t=K.add(A.multiplyByFloats(z,b,X)),U=K.add(A.multiplyByFloats(z+1,b+1,X+1)),B=new j(t,U,k,T+1,F,Y);B.addEntries(e),l.eh.push(B)}}}},12412:(K,b,e)=>{"use strict";e.d(b,{d:()=>A});var z=e(10960),k=e(10967),j=e(11283),T=e(11620),F=e(11049),l=e(12399),Y=e(10720);z.e.prototype.createOrUpdateSelectionOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e=this._getComponent(F.e.NAME_OCTREE);e||(e=new A(this),this.o(e)),this.Uh||(this.Uh=new l.d(l.d.CreationFuncForMeshes,K,b));const z=this.getWorldExtends();return this.Uh.update(z.min,z.max,this.meshes),this.Uh},Object.defineProperty(z.e.prototype,"selectionOctree",{get:function(){return this.Uh},enumerable:!0,configurable:!0}),j.e.prototype.createOrUpdateSubmeshesOctree=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:64,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const e=this.va();let z=e._getComponent(F.e.NAME_OCTREE);z||(z=new A(e),e.o(z)),this._submeshesOctree||(this._submeshesOctree=new l.d(l.d.CreationFuncForSubMeshes,K,b)),this.xj(!0);const k=this.getBoundingInfo().boundingBox;return this._submeshesOctree.update(k.minimumWorld,k.maximumWorld,this.Rf),this._submeshesOctree};class A{constructor(K){this.name=F.e.NAME_OCTREE,this.checksIsEnabled=!0,this._tempRay=new T.b(k.k.Zero(),new k.k(1,1,1)),(K=K||Y.b.LastCreatedScene)&&(this.Ad=K,this.Ad.getActiveMeshCandidates=()=>this.getActiveMeshCandidates(),this.Ad.getActiveSubMeshCandidates=K=>this.getActiveSubMeshCandidates(K),this.Ad.getCollidingSubMeshCandidates=(K,b)=>this.getCollidingSubMeshCandidates(K,b),this.Ad.getIntersectingSubMeshCandidates=(K,b)=>this.getIntersectingSubMeshCandidates(K,b))}register(){this.Ad.onMeshRemovedObservable.add((K=>{const b=this.Ad.selectionOctree;if(void 0!==b&&null!==b){const e=b.Xh.indexOf(K);-1!==e&&b.Xh.splice(e,1)}})),this.Ad.onMeshImportedObservable.add((K=>{const b=this.Ad.selectionOctree;void 0!==b&&null!==b&&b.Wh(K)}))}getActiveMeshCandidates(){var K;return(null===(K=this.Ad.Uh)||void 0===K?void 0:K.select(this.Ad.frustumPlanes))||this.Ad._getDefaultMeshCandidates()}getActiveSubMeshCandidates(K){if(K._submeshesOctree&&K.useOctreeForRenderingSelection){return K._submeshesOctree.select(this.Ad.frustumPlanes)}return this.Ad._getDefaultSubMeshCandidates(K)}getIntersectingSubMeshCandidates(K,b){if(K._submeshesOctree&&K.useOctreeForPicking){T.b.TransformToRef(b,K.getWorldMatrix(),this._tempRay);return K._submeshesOctree.intersectsRay(this._tempRay)}return this.Ad._getDefaultSubMeshCandidates(K)}getCollidingSubMeshCandidates(K,b){if(K._submeshesOctree&&K.useOctreeForCollisions){const e=b._velocityWorldLength+Math.max(b._radius.x,b._radius.y,b._radius.z);return K._submeshesOctree.intersects(b._basePointWorld,e)}return this.Ad._getDefaultSubMeshCandidates(K)}rebuild(){}dispose(){}}},11102:(K,b,e)=>{"use strict";e.d(b,{c:()=>T});var z=e(10975),k=e(10967),j=e(10969);class T{constructor(K,b,e){this.vectors=(0,z.e)(8,k.k.Zero),this.center=k.k.Zero(),this.centerWorld=k.k.Zero(),this.extendSize=k.k.Zero(),this.extendSizeWorld=k.k.Zero(),this.directions=(0,z.e)(3,k.k.Zero),this.vectorsWorld=(0,z.e)(8,k.k.Zero),this.minimumWorld=k.k.Zero(),this.maximumWorld=k.k.Zero(),this.minimum=k.k.Zero(),this.maximum=k.k.Zero(),this._drawWrapperFront=null,this._drawWrapperBack=null,this.reConstruct(K,b,e)}reConstruct(K,b,e){const z=K.x,j=K.y,T=K.z,F=b.x,l=b.y,Y=b.z,A=this.vectors;this.minimum.Yd(z,j,T),this.maximum.Yd(F,l,Y),A[0].Yd(z,j,T),A[1].Yd(F,l,Y),A[2].Yd(F,j,T),A[3].Yd(z,l,T),A[4].Yd(z,j,Y),A[5].Yd(F,l,T),A[6].Yd(z,l,Y),A[7].Yd(F,j,Y),b.addToRef(K,this.center).scaleInPlace(.5),b.subtractToRef(K,this.extendSize).scaleInPlace(.5),this._worldMatrix=e||k.b.IdentityReadOnly,this._update(this._worldMatrix)}scale(K){const b=T._TmpVector3,e=this.maximum.subtractToRef(this.minimum,b[0]),z=e.length();e.normalizeFromLength(z);const k=z*K,j=e.scaleInPlace(.5*k),F=this.center.subtractToRef(j,b[1]),l=this.center.addToRef(j,b[2]);return this.reConstruct(F,l,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(K){const b=this.minimumWorld,e=this.maximumWorld,z=this.directions,j=this.vectorsWorld,T=this.vectors;if(K.isIdentity()){b.p(this.minimum),e.p(this.maximum);for(let K=0;K<8;++K)j[K].p(T[K]);this.extendSizeWorld.p(this.extendSize),this.centerWorld.p(this.center)}else{b.Wd(Number.MAX_VALUE),e.Wd(-Number.MAX_VALUE);for(let z=0;z<8;++z){const F=j[z];k.k.TransformCoordinatesToRef(T[z],K,F),b.minimizeInPlace(F),e.maximizeInPlace(F)}e.subtractToRef(b,this.extendSizeWorld).scaleInPlace(.5),e.addToRef(b,this.centerWorld).scaleInPlace(.5)}k.k.FromArrayToRef(K.m,0,z[0]),k.k.FromArrayToRef(K.m,4,z[1]),k.k.FromArrayToRef(K.m,8,z[2]),this._worldMatrix=K}isInFrustum(K){return T.IsInFrustum(this.vectorsWorld,K)}isCompletelyInFrustum(K){return T.IsCompletelyInFrustum(this.vectorsWorld,K)}intersectsPoint(K){const b=this.minimumWorld,e=this.maximumWorld,z=b.x,k=b.y,T=b.z,F=e.x,l=e.y,Y=e.z,A=K.x,X=K.y,t=K.z,U=-j.c;return!(F-A<U||U>A-z)&&(!(l-X<U||U>X-k)&&!(Y-t<U||U>t-T))}intersectsSphere(K){return T.IntersectsSphere(this.minimumWorld,this.maximumWorld,K.centerWorld,K.radiusWorld)}intersectsMinMax(K,b){const e=this.minimumWorld,z=this.maximumWorld,k=e.x,j=e.y,T=e.z,F=z.x,l=z.y,Y=z.z,A=K.x,X=K.y,t=K.z,U=b.x,B=b.y,u=b.z;return!(F<A||k>U)&&(!(l<X||j>B)&&!(Y<t||T>u))}dispose(){var K,b;null===(K=this._drawWrapperFront)||void 0===K||K.dispose(),null===(b=this._drawWrapperBack)||void 0===b||b.dispose()}static Intersects(K,b){return K.intersectsMinMax(b.minimumWorld,b.maximumWorld)}static IntersectsSphere(K,b,e,z){const j=T._TmpVector3[0];k.k.ClampToRef(e,K,b,j);return k.k.DistanceSquared(e,j)<=z*z}static IsCompletelyInFrustum(K,b){for(let e=0;e<6;++e){const z=b[e];for(let b=0;b<8;++b)if(z.dotCoordinate(K[b])<0)return!1}return!0}static IsInFrustum(K,b){for(let e=0;e<6;++e){let z=!0;const k=b[e];for(let b=0;b<8;++b)if(k.dotCoordinate(K[b])>=0){z=!1;break}if(z)return!1}return!0}}T._TmpVector3=(0,z.e)(3,k.k.Zero)},11100:(K,b,e)=>{"use strict";e.d(b,{b:()=>X});var z=e(10975),k=e(10967),j=e(11102),T=e(11111);const F={min:0,max:0},l={min:0,max:0},Y=(K,b,e)=>{const z=k.k.Dot(b.centerWorld,K),j=Math.abs(k.k.Dot(b.directions[0],K))*b.extendSize.x+Math.abs(k.k.Dot(b.directions[1],K))*b.extendSize.y+Math.abs(k.k.Dot(b.directions[2],K))*b.extendSize.z;e.min=z-j,e.max=z+j},A=(K,b,e)=>(Y(K,b,F),Y(K,e,l),!(F.min>l.max||l.min>F.max));class X{constructor(K,b,e){this._isLocked=!1,this.boundingBox=new j.c(K,b,e),this.boundingSphere=new T.c(K,b,e)}reConstruct(K,b,e){this.boundingBox.reConstruct(K,b,e),this.boundingSphere.reConstruct(K,b,e)}get minimum(){return this.boundingBox.minimum}get maximum(){return this.boundingBox.maximum}get isLocked(){return this._isLocked}set isLocked(K){this._isLocked=K}update(K){this._isLocked||(this.boundingBox._update(K),this.boundingSphere._update(K))}centerOn(K,b){const e=X._TmpVector3[0].p(K).$h(b),z=X._TmpVector3[1].p(K).addInPlace(b);return this.boundingBox.reConstruct(e,z,this.boundingBox.getWorldMatrix()),this.boundingSphere.reConstruct(e,z,this.boundingBox.getWorldMatrix()),this}encapsulate(K){const b=k.k.Minimize(this.minimum,K),e=k.k.Maximize(this.maximum,K);return this.reConstruct(b,e,this.boundingBox.getWorldMatrix()),this}encapsulateBoundingInfo(K){const b=k.e.Matrix[0];this.boundingBox.getWorldMatrix().invertToRef(b);const e=k.e.gb[0];return k.k.TransformCoordinatesToRef(K.boundingBox.minimumWorld,b,e),this.encapsulate(e),k.k.TransformCoordinatesToRef(K.boundingBox.maximumWorld,b,e),this.encapsulate(e),this}scale(K){return this.boundingBox.scale(K),this.boundingSphere.scale(K),this}isInFrustum(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((2===b||3===b)&&this.boundingSphere.isCenterInFrustum(K))return!0;if(!this.boundingSphere.isInFrustum(K))return!1;return!(1!==b&&3!==b)||this.boundingBox.isInFrustum(K)}get diagonalLength(){const K=this.boundingBox;return K.maximumWorld.subtractToRef(K.minimumWorld,X._TmpVector3[0]).length()}isCompletelyInFrustum(K){return this.boundingBox.isCompletelyInFrustum(K)}_checkCollision(K){return K._canDoCollision(this.boundingSphere.centerWorld,this.boundingSphere.radiusWorld,this.boundingBox.minimumWorld,this.boundingBox.maximumWorld)}intersectsPoint(K){return!!this.boundingSphere.centerWorld&&(!!this.boundingSphere.intersectsPoint(K)&&!!this.boundingBox.intersectsPoint(K))}intersects(K,b){if(!T.c.Intersects(this.boundingSphere,K.boundingSphere))return!1;if(!j.c.Intersects(this.boundingBox,K.boundingBox))return!1;if(!b)return!0;const e=this.boundingBox,z=K.boundingBox;return!!A(e.directions[0],e,z)&&(!!A(e.directions[1],e,z)&&(!!A(e.directions[2],e,z)&&(!!A(z.directions[0],e,z)&&(!!A(z.directions[1],e,z)&&(!!A(z.directions[2],e,z)&&(!!A(k.k.Cross(e.directions[0],z.directions[0]),e,z)&&(!!A(k.k.Cross(e.directions[0],z.directions[1]),e,z)&&(!!A(k.k.Cross(e.directions[0],z.directions[2]),e,z)&&(!!A(k.k.Cross(e.directions[1],z.directions[0]),e,z)&&(!!A(k.k.Cross(e.directions[1],z.directions[1]),e,z)&&(!!A(k.k.Cross(e.directions[1],z.directions[2]),e,z)&&(!!A(k.k.Cross(e.directions[2],z.directions[0]),e,z)&&(!!A(k.k.Cross(e.directions[2],z.directions[1]),e,z)&&!!A(k.k.Cross(e.directions[2],z.directions[2]),e,z))))))))))))))}}X._TmpVector3=(0,z.e)(2,k.k.Zero)},11111:(K,b,e)=>{"use strict";e.d(b,{c:()=>j});var z=e(10975),k=e(10967);class j{constructor(K,b,e){this.center=k.k.Zero(),this.centerWorld=k.k.Zero(),this.minimum=k.k.Zero(),this.maximum=k.k.Zero(),this.reConstruct(K,b,e)}reConstruct(K,b,e){this.minimum.p(K),this.maximum.p(b);const z=k.k.Distance(K,b);b.addToRef(K,this.center).scaleInPlace(.5),this.radius=.5*z,this._update(e||k.b.IdentityReadOnly)}scale(K){const b=this.radius*K,e=j._TmpVector3,z=e[0].Wd(b),k=this.center.subtractToRef(z,e[1]),T=this.center.addToRef(z,e[2]);return this.reConstruct(k,T,this._worldMatrix),this}getWorldMatrix(){return this._worldMatrix}_update(K){if(K.isIdentity())this.centerWorld.p(this.center),this.radiusWorld=this.radius;else{k.k.TransformCoordinatesToRef(this.center,K,this.centerWorld);const b=j._TmpVector3[0];k.k.TransformNormalFromFloatsToRef(1,1,1,K,b),this.radiusWorld=Math.max(Math.abs(b.x),Math.abs(b.y),Math.abs(b.z))*this.radius}}isInFrustum(K){const b=this.centerWorld,e=this.radiusWorld;for(let z=0;z<6;z++)if(K[z].dotCoordinate(b)<=-e)return!1;return!0}isCenterInFrustum(K){const b=this.centerWorld;for(let e=0;e<6;e++)if(K[e].dotCoordinate(b)<0)return!1;return!0}intersectsPoint(K){const b=k.k.DistanceSquared(this.centerWorld,K);return!(this.radiusWorld*this.radiusWorld<b)}static Intersects(K,b){const e=k.k.DistanceSquared(K.centerWorld,b.centerWorld),z=K.radiusWorld+b.radiusWorld;return!(z*z<e)}static CreateFromCenterAndRadius(K,b,e){this._TmpVector3[0].p(K),this._TmpVector3[1].Yd(0,0,b),this._TmpVector3[2].p(K),this._TmpVector3[0].addInPlace(this._TmpVector3[1]),this._TmpVector3[2].$h(this._TmpVector3[1]);const z=new j(this._TmpVector3[0],this._TmpVector3[2]);return z._worldMatrix=e||k.b.Identity(),z}}j._TmpVector3=(0,z.e)(3,k.k.Zero)},11620:(K,b,e)=>{"use strict";e.d(b,{b:()=>U});var z=e(10960),k=e(11237),j=e(10969),T=e(10967),F=e(10975),l=e(11096),Y=e(11021),A=e(10720),X=e(11062);const t={internalPickerForMesh:void 0};class U{constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.MAX_VALUE,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:j.c;this.origin=K,this.direction=b,this.length=e,this.epsilon=z}clone(){return new U(this.origin.clone(),this.direction.clone(),this.length)}intersectsBoxMinMax(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=U._TmpVector3[0].Yd(K.x-e,K.y-e,K.z-e),k=U._TmpVector3[1].Yd(b.x+e,b.y+e,b.z+e);let j,T,F,l,Y=0,A=Number.MAX_VALUE;if(Math.abs(this.direction.x)<1e-7){if(this.origin.x<z.x||this.origin.x>k.x)return!1}else if(j=1/this.direction.x,T=(z.x-this.origin.x)*j,F=(k.x-this.origin.x)*j,F===-1/0&&(F=1/0),T>F&&(l=T,T=F,F=l),Y=Math.max(T,Y),A=Math.min(F,A),Y>A)return!1;if(Math.abs(this.direction.y)<1e-7){if(this.origin.y<z.y||this.origin.y>k.y)return!1}else if(j=1/this.direction.y,T=(z.y-this.origin.y)*j,F=(k.y-this.origin.y)*j,F===-1/0&&(F=1/0),T>F&&(l=T,T=F,F=l),Y=Math.max(T,Y),A=Math.min(F,A),Y>A)return!1;if(Math.abs(this.direction.z)<1e-7){if(this.origin.z<z.z||this.origin.z>k.z)return!1}else if(j=1/this.direction.z,T=(z.z-this.origin.z)*j,F=(k.z-this.origin.z)*j,F===-1/0&&(F=1/0),T>F&&(l=T,T=F,F=l),Y=Math.max(T,Y),A=Math.min(F,A),Y>A)return!1;return!0}intersectsBox(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.intersectsBoxMinMax(K.minimum,K.maximum,b)}intersectsSphere(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=K.center.x-this.origin.x,z=K.center.y-this.origin.y,k=K.center.z-this.origin.z,j=e*e+z*z+k*k,T=K.radius+b,F=T*T;if(j<=F)return!0;const l=e*this.direction.x+z*this.direction.y+k*this.direction.z;if(l<0)return!1;return j-l*l<=F}intersectsTriangle(K,b,e){const z=U._TmpVector3[0],k=U._TmpVector3[1],j=U._TmpVector3[2],F=U._TmpVector3[3],Y=U._TmpVector3[4];b.subtractToRef(K,z),e.subtractToRef(K,k),T.k.CrossToRef(this.direction,k,j);const A=T.k.Dot(z,j);if(0===A)return null;const X=1/A;this.origin.subtractToRef(K,F);const t=T.k.Dot(F,j)*X;if(t<-this.epsilon||t>1+this.epsilon)return null;T.k.CrossToRef(F,z,Y);const B=T.k.Dot(this.direction,Y)*X;if(B<-this.epsilon||t+B>1+this.epsilon)return null;const u=T.k.Dot(k,Y)*X;return u>this.length?null:new l.d(1-t-B,t,u)}intersectsPlane(K){let b;const e=T.k.Dot(K.k,this.direction);if(Math.abs(e)<9.99999997475243e-7)return null;{const z=T.k.Dot(K.k,this.origin);return b=(-K.d-z)/e,b<0?b<-9.99999997475243e-7?null:0:b}}intersectsAxis(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(K){case"y":{const K=(this.origin.y-b)/this.direction.y;return K>0?null:new T.k(this.origin.x+this.direction.x*-K,b,this.origin.z+this.direction.z*-K)}case"x":{const K=(this.origin.x-b)/this.direction.x;return K>0?null:new T.k(b,this.origin.y+this.direction.y*-K,this.origin.z+this.direction.z*-K)}case"z":{const K=(this.origin.z-b)/this.direction.z;return K>0?null:new T.k(this.origin.x+this.direction.x*-K,this.origin.y+this.direction.y*-K,b)}default:return null}}intersectsMesh(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=T.e.Matrix[0];return K.getWorldMatrix().invertToRef(F),this._tmpRay?U.TransformToRef(this,F,this._tmpRay):this._tmpRay=U.Transform(this,F),K.intersects(this._tmpRay,b,e,z,k,j)}intersectsMeshes(K,b,e){e?e.length=0:e=[];for(let z=0;z<K.length;z++){const k=this.intersectsMesh(K[z],b);k.hit&&e.push(k)}return e.sort(this._comparePickingInfo),e}_comparePickingInfo(K,b){return K.distance<b.distance?-1:K.distance>b.distance?1:0}intersectionSegment(K,b,e){const z=this.origin,k=T.e.gb[0],j=T.e.gb[1],F=T.e.gb[2],l=T.e.gb[3];b.subtractToRef(K,k),this.direction.scaleToRef(U._Rayl,F),z.addToRef(F,j),K.subtractToRef(z,l);const Y=T.k.Dot(k,k),A=T.k.Dot(k,F),X=T.k.Dot(F,F),t=T.k.Dot(k,l),B=T.k.Dot(F,l),u=Y*X-A*A;let m,D,I=u,x=u;u<U._Smallnum?(m=0,I=1,D=B,x=X):(m=A*B-X*t,D=Y*B-A*t,m<0?(m=0,D=B,x=X):m>I&&(m=I,D=B+A,x=X)),D<0?(D=0,-t<0?m=0:-t>Y?m=I:(m=-t,I=Y)):D>x&&(D=x,-t+A<0?m=0:-t+A>Y?m=I:(m=-t+A,I=Y));const Q=Math.abs(m)<U._Smallnum?0:m/I,G=Math.abs(D)<U._Smallnum?0:D/x,i=T.e.gb[4];F.scaleToRef(G,i);const S=T.e.gb[5];k.scaleToRef(Q,S),S.addInPlace(l);const M=T.e.gb[6];S.subtractToRef(i,M);return G>0&&G<=this.length&&M.lengthSquared()<e*e?S.length():-1}update(K,b,e,z,k,j,F){if(arguments.length>7&&void 0!==arguments[7]&&arguments[7]){U._RayDistant||(U._RayDistant=U.Zero()),U._RayDistant.unprojectRayToRef(K,b,e,z,T.b.IdentityReadOnly,j,F);const l=T.e.Matrix[0];k.invertToRef(l),U.TransformToRef(U._RayDistant,l,this)}else this.unprojectRayToRef(K,b,e,z,k,j,F);return this}static Zero(){return new U(T.k.Zero(),T.k.Zero())}static CreateNew(K,b,e,z,k,j,T){return U.Zero().update(K,b,e,z,k,j,T)}static CreateNewFromTo(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.b.IdentityReadOnly;const z=new U(new T.k(0,0,0),new T.k(0,0,0));return U.CreateFromToToRef(K,b,z,e)}static CreateFromToToRef(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:T.b.IdentityReadOnly;e.origin.p(K);const k=b.subtractToRef(K,e.direction),j=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);return e.length=j,e.direction.normalize(),U.TransformToRef(e,z,e)}static Transform(K,b){const e=new U(new T.k(0,0,0),new T.k(0,0,0));return U.TransformToRef(K,b,e),e}static TransformToRef(K,b,e){T.k.TransformCoordinatesToRef(K.origin,b,e.origin),T.k.TransformNormalToRef(K.direction,b,e.direction),e.length=K.length,e.epsilon=K.epsilon;const z=e.direction,k=z.length();if(0!==k&&1!==k){const K=1/k;z.x*=K,z.y*=K,z.z*=K,e.length*=k}return e}unprojectRayToRef(K,b,e,z,k,j,F){const l=T.e.Matrix[0];k.multiplyToRef(j,l),l.multiplyToRef(F,l),l.invert();const Y=A.b.LastCreatedEngine,X=T.e.gb[0];X.x=K/e*2-1,X.y=-(b/z*2-1),X.z=null!==Y&&void 0!==Y&&Y.useReverseDepthBuffer?1:null!==Y&&void 0!==Y&&Y.isNDCHalfZRange?0:-1;const t=T.e.gb[1].Yd(X.x,X.y,1-1e-8),U=T.e.gb[2],B=T.e.gb[3];T.k._UnprojectFromInvertedMatrixToRef(X,l,U),T.k._UnprojectFromInvertedMatrixToRef(t,l,B),this.origin.p(U),B.subtractToRef(U,this.direction),this.direction.normalize()}}function B(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const T=U.Zero();return u(K,b,e,z,T,k,j),T}function u(K,b,e,z,k,j){let F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const Y=K.getEngine();if(!j&&!(j=K.activeCamera))return K;const A=j.viewport,X=Y.getRenderHeight(),{x:t,y:U,width:B,height:u}=A.toGlobal(Y.getRenderWidth(),X),m=1/Y.getHardwareScalingLevel();return b=b*m-t,e=e*m-(X-U-u),k.update(b,e,B,u,z||T.b.IdentityReadOnly,F?T.b.IdentityReadOnly:j.getViewMatrix(),j.getProjectionMatrix(),l),K}function m(K,b,e,z,k){if(!Y.c)return K;const j=K.getEngine();if(!k&&!(k=K.activeCamera))throw new Error("Active camera not set");const F=k.viewport,l=j.getRenderHeight(),{x:A,y:X,width:t,height:U}=F.toGlobal(j.getRenderWidth(),l),B=T.b.Identity(),u=1/j.getHardwareScalingLevel();return b=b*u-A,e=e*u-(l-X-U),z.update(b,e,t,U,B,B,k.getProjectionMatrix()),K}function D(K,b,e,z,k,j,T,F){const l=b(z,e.enableDistantPicking),Y=e.intersects(l,k,T,j,z,F);return Y&&Y.hit?!k&&null!=K&&Y.distance>=K.distance?null:Y:null}function I(K,b,e,z,k,j){let F=null;const l=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),A=K.cameraToUseForPointers||K.activeCamera,X=t.internalPickerForMesh||D;for(let Y=0;Y<K.meshes.length;Y++){const t=K.meshes[Y];if(e){if(!e(t,-1))continue}else if(!t.isEnabled()||!t.isVisible||!t.ub)continue;const U=l&&t.isWorldMatrixCameraDependent(),B=t.xj(U,A);if(t.hasThinInstances&&t.thinInstanceEnablePicking){const K=X(F,b,t,B,!0,!0,j);if(K){if(k)return K;const l=T.e.Matrix[1],Y=t.thinInstanceGetWorldMatrices();for(let K=0;K<Y.length;K++){if(e&&!e(t,K))continue;Y[K].multiplyToRef(B,l);const T=X(F,b,t,l,z,k,j,!0);if(T&&(F=T,F.thinInstanceIndex=K,z))return F}}}else{const K=X(F,b,t,B,z,k,j);if(K&&(F=K,z))return F}}return F||new Y.c}function x(K,b,e,z){if(!Y.c)return null;const k=[],j=!!(K.activeCameras&&K.activeCameras.length>1&&K.cameraToUseForPointers!==K.activeCamera),F=K.cameraToUseForPointers||K.activeCamera,l=t.internalPickerForMesh||D;for(let Y=0;Y<K.meshes.length;Y++){const A=K.meshes[Y];if(e){if(!e(A,-1))continue}else if(!A.isEnabled()||!A.isVisible||!A.ub)continue;const X=j&&A.isWorldMatrixCameraDependent(),t=A.xj(X,F);if(A.hasThinInstances&&A.thinInstanceEnablePicking){if(l(null,b,A,t,!0,!0,z)){const K=T.e.Matrix[1],j=A.thinInstanceGetWorldMatrices();for(let T=0;T<j.length;T++){if(e&&!e(A,T))continue;j[T].multiplyToRef(t,K);const F=l(null,b,A,K,!1,!1,z,!0);F&&(F.thinInstanceIndex=T,k.push(F))}}}else{const K=l(null,b,A,t,!1,!1,z);K&&k.push(K)}}return k}function Q(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;z||(z=K.getWorldMatrix()),b.length=e,k?b.origin.p(k):b.origin.p(K.position);const j=T.e.gb[2];j.set(0,0,K._scene.useRightHandedSystem?-1:1);const F=T.e.gb[3];return T.k.TransformNormalToRef(j,z,F),T.k.NormalizeToRef(F,b.direction),b}var G,i;U._TmpVector3=(0,F.e)(6,T.k.Zero),U._RayDistant=U.Zero(),U._Smallnum=1e-8,U._Rayl=1e9,G=z.e,(i=k.e)&&(i.prototype.getForwardRay=function(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;return Q(this,new U(T.k.Zero(),T.k.Zero(),K),K,b,e)},i.prototype.getForwardRayToRef=function(K){return Q(this,K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,arguments.length>2?arguments[2]:void 0,arguments.length>3?arguments[3]:void 0)}),G&&(X.c._IsPickingAvailable=!0,G.prototype.createPickingRay=function(K,b,e,z){return B(this,K,b,e,z,arguments.length>4&&void 0!==arguments[4]&&arguments[4])}),z.e.prototype.createPickingRayToRef=function(K,b,e,z,k){return u(this,K,b,e,z,k,arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6])},z.e.prototype.createPickingRayInCameraSpace=function(K,b,e){return function(K,b,e,z){const k=U.Zero();return m(K,b,e,k,z),k}(this,K,b,e)},z.e.prototype.createPickingRayInCameraSpaceToRef=function(K,b,e,z){return m(this,K,b,e,z)},z.e.prototype.pickWithBoundingInfo=function(K,b,e,z,k){return function(K,b,e,z,k,j){if(!Y.c)return null;const F=I(K,(z=>(K._tempPickingRay||(K._tempPickingRay=U.Zero()),u(K,b,e,z,K._tempPickingRay,j||null),K._tempPickingRay)),z,k,!0);return F&&(F.ray=B(K,b,e,T.b.Identity(),j||null)),F}(this,K,b,e,z,k)},z.e.prototype.Oc=function(K,b,e,z,k,j){return function(K,b,e,z,k,j,F){const l=I(K,((z,k)=>(K._tempPickingRay||(K._tempPickingRay=U.Zero()),u(K,b,e,z,K._tempPickingRay,j||null,!1,k),K._tempPickingRay)),z,k,!1,F);return l&&(l.ray=B(K,b,e,T.b.Identity(),j||null)),l}(this,K,b,e,z,k,j)},z.e.prototype.pickWithRay=function(K,b,e,z){return function(K,b,e,z,k){const j=I(K,(e=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=T.b.Identity()),e.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=U.Zero()),U.TransformToRef(b,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),e,z,!1,k);return j&&(j.ray=b),j}(this,K,b,e,z)},z.e.prototype.multiPick=function(K,b,e,z,k){return function(K,b,e,z,k,j){return x(K,(z=>B(K,b,e,z,k||null)),z,j)}(this,K,b,e,z,k)},z.e.prototype.multiPickWithRay=function(K,b,e){return function(K,b,e,z){return x(K,(e=>(K._pickWithRayInverseMatrix||(K._pickWithRayInverseMatrix=T.b.Identity()),e.invertToRef(K._pickWithRayInverseMatrix),K._cachedRayForTransform||(K._cachedRayForTransform=U.Zero()),U.TransformToRef(b,K._pickWithRayInverseMatrix,K._cachedRayForTransform),K._cachedRayForTransform)),e,z)}(this,K,b,e)}},11531:(K,b,e)=>{"use strict";var z=e(10780),k=e(10696),j=e(10723),T=e(10801),F=e(10750),l=e(10790);F.e.prototype._partialLoadFile=function(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._loadFile(K,(K=>{e[b]=K,e._internalCount++,6===e._internalCount&&z(e)}),void 0,void 0,!0,((K,b)=>{k&&K&&k(K.status+" "+K.statusText,b)}))},F.e.prototype._cascadeLoadFiles=function(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=[];k._internalCount=0;for(let j=0;j<6;j++)this._partialLoadFile(e[j],j,k,b,z)},F.e.prototype._cascadeLoadImgs=function(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5?arguments[5]:void 0;const T=[];T._internalCount=0;for(let F=0;F<6;F++)this._partialLoadImg(z[F],F,T,K,b,e,k,j)},F.e.prototype._partialLoadImg=function(K,b,e,z,k,F){let l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7?arguments[7]:void 0;const A=(0,T.b)();(0,j.s)(K,(K=>{e[b]=K,e._internalCount++,z&&z.removePendingData(A),6===e._internalCount&&F&&F(k,e)}),((K,b)=>{z&&z.removePendingData(A),l&&l(K,b)}),z?z.offlineProvider:null,Y),z&&z.addPendingData(A)},F.e.prototype.createCubeTextureBase=function(K,b,e,j){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6?arguments[6]:void 0,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,m=arguments.length>13&&void 0!==arguments[13]?arguments[13]:null,D=arguments.length>14&&void 0!==arguments[14]&&arguments[14],I=arguments.length>15&&void 0!==arguments[15]?arguments[15]:null;const x=B||new z.e(this,7);x.isCube=!0,x.url=K,x.generateMipMaps=!j,x._lodGenerationScale=t,x._lodGenerationOffset=U,x._useSRGBBuffer=!!D&&this._caps.supportSRGBBuffers&&(this.version>1||this.isWebGPU||!!j),x!==B&&(x.label=K.substring(0,60)),this._doNotHandleContextLost||(x._extension=A,x._files=e,x._buffer=I);const Q=K;this._transformTextureUrl&&!B&&(K=this._transformTextureUrl(K));const G=K.split("?")[0],i=G.lastIndexOf("."),S=A||(i>-1?G.substring(i).toLowerCase():""),M=(0,l.b)(S),r=(z,l)=>{K===Q?F&&z&&F(z.status+" "+z.statusText,l):(k.b.Warn(`Failed to load ${K}, falling back to the ${Q}`),this.createCubeTextureBase(Q,b,e,!!j,T,F,Y,A,X,t,U,x,u,m,D,I))};if(M)M.then((z=>{const j=K=>{u&&u(x,K),z.loadCubeData(K,x,X,T,F)};I?j(I):e&&6===e.length?z.supportCascades?this._cascadeLoadFiles(b,(K=>j(K.map((K=>new Uint8Array(K))))),e,F):F?F("Textures type does not support cascades."):k.b.Warn("Texture loader does not support cascades."):this._loadFile(K,(K=>j(new Uint8Array(K))),void 0,void 0,!0,r)}));else{if(!e||0===e.length)throw new Error("Cannot load cubemap because files were not defined, or the correct loader was not found.");this._cascadeLoadImgs(b,x,((K,b)=>{m&&m(K,b)}),e,F)}return this._internalTexturesCache.push(x),x}},11473:(K,b,e)=>{"use strict";e(10750).e.prototype.createDepthStencilTexture=function(K,b,e){if(b.isCube){const e=K.width||K;return this._createDepthStencilCubeTexture(e,b)}return this._createDepthStencilTexture(K,b,e)}},11447:(K,b,e)=>{"use strict";e(11415).ThinEngine.prototype.setAlphaMode=function(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._alphaMode!==K){switch(K){case 0:this._alphaState.alphaBlend=!1;break;case 7:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 8:case 14:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 2:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 6:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 1:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 3:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ZERO,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 4:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_COLOR,this._gl.ZERO,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 5:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 9:this._alphaState.setAlphaBlendFunctionParameters(this._gl.CONSTANT_COLOR,this._gl.ONE_MINUS_CONSTANT_COLOR,this._gl.CONSTANT_ALPHA,this._gl.ONE_MINUS_CONSTANT_ALPHA),this._alphaState.alphaBlend=!0;break;case 10:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 11:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 12:this._alphaState.setAlphaBlendFunctionParameters(this._gl.DST_ALPHA,this._gl.ONE,this._gl.ZERO,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 13:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ONE_MINUS_DST_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0;break;case 15:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE,this._gl.ONE,this._gl.ONE,this._gl.ZERO),this._alphaState.alphaBlend=!0;break;case 16:this._alphaState.setAlphaBlendFunctionParameters(this._gl.ONE_MINUS_DST_COLOR,this._gl.ONE_MINUS_SRC_COLOR,this._gl.ZERO,this._gl.ONE),this._alphaState.alphaBlend=!0;break;case 17:this._alphaState.setAlphaBlendFunctionParameters(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA,this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA),this._alphaState.alphaBlend=!0}b||(this.depthCullingState.depthMask=0===K),this._alphaMode=K}else if(!b){const b=0===K;this.depthCullingState.depthMask!==b&&(this.depthCullingState.depthMask=b)}}},11413:(K,b,e)=>{"use strict";var z=e(11415);z.ThinEngine.prototype.updateDynamicIndexBuffer=function(K,b){let e;this._currentBoundBuffer[this._gl.ELEMENT_ARRAY_BUFFER]=null,this.bindIndexBuffer(K),e=K.is32Bits?b instanceof Uint32Array?b:new Uint32Array(b):b instanceof Uint16Array?b:new Uint16Array(b),this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,e,this._gl.DYNAMIC_DRAW),this._resetIndexBufferBinding()},z.ThinEngine.prototype.updateDynamicVertexBuffer=function(K,b,e,z){this.bindArrayBuffer(K),void 0===e&&(e=0);const k=b.byteLength||b.length;void 0===z||z>=k&&0===e?b instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e,new Float32Array(b)):this._gl.bufferSubData(this._gl.ARRAY_BUFFER,e,b):b instanceof Array?this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,new Float32Array(b).subarray(e,e+z)):(b=b instanceof ArrayBuffer?new Uint8Array(b,e,z):new Uint8Array(b.buffer,b.byteOffset+e,z),this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b)),this._resetVertexBufferBinding()}},11459:(K,b,e)=>{"use strict";var z=e(10780),k=e(10696),j=e(11415),T=e(11465);class F extends T.b{constructor(K,b,e,z,k){super(K,b,e,z),this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._disposeOnlyFramebuffers=!1,this._currentLOD=0,this._context=k}_cloneRenderTargetWrapper(){let K=null;return this._colorTextureArray&&this._depthStencilTextureArray?(K=this._engine.createMultiviewRenderTargetTexture(this.width,this.height),K.texture.isReady=!0):K=super._cloneRenderTargetWrapper(),K}_swapRenderTargetWrapper(K){super._swapRenderTargetWrapper(K),K._framebuffer=this._framebuffer,K._depthStencilBuffer=this._depthStencilBuffer,K._MSAAFramebuffer=this._MSAAFramebuffer,K._colorTextureArray=this._colorTextureArray,K._depthStencilTextureArray=this._depthStencilTextureArray,this._framebuffer=this._depthStencilBuffer=this._MSAAFramebuffer=this._colorTextureArray=this._depthStencilTextureArray=null}createDepthStencilTexture(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,j=arguments.length>5?arguments[5]:void 0;if(this._depthStencilBuffer){const K=this._engine,b=K._currentFramebuffer,e=this._context;K._bindUnboundFramebuffer(this._framebuffer),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,null),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,null),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.STENCIL_ATTACHMENT,e.RENDERBUFFER,null),K._bindUnboundFramebuffer(b),e.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null}return super.createDepthStencilTexture(K,b,e,z,k,j)}shareDepth(K){super.shareDepth(K);const b=this._context,e=this._depthStencilBuffer,z=K._MSAAFramebuffer||K._framebuffer,k=this._engine;K._depthStencilBuffer&&K._depthStencilBuffer!==e&&b.deleteRenderbuffer(K._depthStencilBuffer),K._depthStencilBuffer=e;const j=K._generateStencilBuffer?b.DEPTH_STENCIL_ATTACHMENT:b.DEPTH_ATTACHMENT;k._bindUnboundFramebuffer(z),b.framebufferRenderbuffer(b.FRAMEBUFFER,j,b.RENDERBUFFER,e),k._bindUnboundFramebuffer(null)}_bindTextureRenderTarget(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(!K._hardwareTexture)return;const k=this._framebuffer,j=this._engine,T=j._currentFramebuffer;if(j._bindUnboundFramebuffer(k),j.webGLVersion>1){const k=this._context,j=k["COLOR_ATTACHMENT"+b];var F;if(K.is2DArray||K.is3D)e=e??(null===(F=this.layerIndices)||void 0===F?void 0:F[b])??0,k.framebufferTextureLayer(k.FRAMEBUFFER,j,K._hardwareTexture.underlyingResource,z,e);else if(K.isCube){var l;e=e??(null===(l=this.faceIndices)||void 0===l?void 0:l[b])??0,k.framebufferTexture2D(k.FRAMEBUFFER,j,k.TEXTURE_CUBE_MAP_POSITIVE_X+e,K._hardwareTexture.underlyingResource,z)}else k.framebufferTexture2D(k.FRAMEBUFFER,j,k.TEXTURE_2D,K._hardwareTexture.underlyingResource,z)}else{const k=this._context,j=k["COLOR_ATTACHMENT"+b+"_WEBGL"],T=void 0!==e?k.TEXTURE_CUBE_MAP_POSITIVE_X+e:k.TEXTURE_2D;k.framebufferTexture2D(k.FRAMEBUFFER,j,T,K._hardwareTexture.underlyingResource,z)}j._bindUnboundFramebuffer(T)}setTexture(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super.setTexture(K,b,e),this._bindTextureRenderTarget(K,b)}setLayerAndFaceIndices(K,b){var e;if(super.setLayerAndFaceIndices(K,b),!this.textures||!this.layerIndices||!this.faceIndices)return;const z=(null===(e=this._attachments)||void 0===e?void 0:e.length)??this.textures.length;for(let k=0;k<z;k++){const K=this.textures[k];K&&(K.is2DArray||K.is3D?this._bindTextureRenderTarget(K,k,this.layerIndices[k]):K.isCube?this._bindTextureRenderTarget(K,k,this.faceIndices[k]):this._bindTextureRenderTarget(K,k))}}setLayerAndFaceIndex(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;if(super.setLayerAndFaceIndex(K,b,e),!this.textures||!this.layerIndices||!this.faceIndices)return;const z=this.textures[K];z.is2DArray||z.is3D?this._bindTextureRenderTarget(this.textures[K],K,this.layerIndices[K]):z.isCube&&this._bindTextureRenderTarget(this.textures[K],K,this.faceIndices[K])}dispose(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._disposeOnlyFramebuffers;const b=this._context;K||(this._colorTextureArray&&(this._context.deleteTexture(this._colorTextureArray),this._colorTextureArray=null),this._depthStencilTextureArray&&(this._context.deleteTexture(this._depthStencilTextureArray),this._depthStencilTextureArray=null)),this._framebuffer&&(b.deleteFramebuffer(this._framebuffer),this._framebuffer=null),this._depthStencilBuffer&&(b.deleteRenderbuffer(this._depthStencilBuffer),this._depthStencilBuffer=null),this._MSAAFramebuffer&&(b.deleteFramebuffer(this._MSAAFramebuffer),this._MSAAFramebuffer=null),super.dispose(K)}}e(11473);j.ThinEngine.prototype._createHardwareRenderTargetWrapper=function(K,b,e){const z=new F(K,b,e,this,this._gl);return this._renderTargetWrapperCache.push(z),z},j.ThinEngine.prototype.createRenderTargetTexture=function(K,b){const e=this._createHardwareRenderTargetWrapper(!1,!1,K);let z,k,j=!0,T=!1,F=!1,l=1;void 0!==b&&"object"===typeof b&&(j=b.generateDepthBuffer??!0,T=!!b.generateStencilBuffer,F=!!b.noColorAttachment,z=b.colorAttachment,l=b.samples??1,k=b.label);const Y=z||(F?null:this._createInternalTexture(K,b,!0,5)),A=K.width||K,X=K.height||K,t=this._currentFramebuffer,U=this._gl,B=U.createFramebuffer();if(this._bindUnboundFramebuffer(B),e._depthStencilBuffer=this._setupFramebufferDepthAttachments(T,j,A,X),!Y||Y.is2DArray||Y.is3D||U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.TEXTURE_2D,Y._hardwareTexture.underlyingResource,0),this._bindUnboundFramebuffer(t),e.label=k??"RenderTargetWrapper",e._framebuffer=B,e._generateDepthBuffer=j,e._generateStencilBuffer=T,e.setTextures(Y),z){if(e._samples=z.samples,z.samples>1){const K=z._hardwareTexture.getMSAARenderBuffer(0);e._MSAAFramebuffer=U.createFramebuffer(),this._bindUnboundFramebuffer(e._MSAAFramebuffer),U.framebufferRenderbuffer(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,U.RENDERBUFFER,K),this._bindUnboundFramebuffer(null)}}else this.updateRenderTargetTextureSampleCount(e,l);return e},j.ThinEngine.prototype._createDepthStencilTexture=function(K,b,e){const j=this._gl,T=K.layers||0,F=K.depth||0;let l=j.TEXTURE_2D;0!==T?l=j.TEXTURE_2D_ARRAY:0!==F&&(l=j.TEXTURE_3D);const Y=new z.e(this,12);if(Y.label=b.label,!this._caps.depthTextureExtension)return k.b.Error("Depth texture is not supported by your browser or hardware."),Y;const A={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...b};if(this._bindTextureDirectly(l,Y,!0),this._setupDepthStencilTexture(Y,K,0!==A.comparisonFunction&&A.bilinearFiltering,A.comparisonFunction,A.samples),void 0!==A.depthTextureFormat){if(15!==A.depthTextureFormat&&16!==A.depthTextureFormat&&17!==A.depthTextureFormat&&13!==A.depthTextureFormat&&14!==A.depthTextureFormat&&18!==A.depthTextureFormat)return k.b.Error(`Depth texture ${A.depthTextureFormat} format is not supported.`),Y;Y.format=A.depthTextureFormat}else Y.format=A.generateStencil?13:16;const X=17===Y.format||13===Y.format||18===Y.format;let t=j.UNSIGNED_INT;15===Y.format?t=j.UNSIGNED_SHORT:17===Y.format||13===Y.format?t=j.UNSIGNED_INT_24_8:14===Y.format?t=j.FLOAT:18===Y.format&&(t=j.FLOAT_32_UNSIGNED_INT_24_8_REV);const U=X?j.DEPTH_STENCIL:j.DEPTH_COMPONENT,B=this._getInternalFormatFromDepthTextureFormat(Y.format,!0,X);return Y.is2DArray?j.texImage3D(l,0,B,Y.width,Y.height,T,0,U,t,null):Y.is3D?j.texImage3D(l,0,B,Y.width,Y.height,F,0,U,t,null):j.texImage2D(l,0,B,Y.width,Y.height,0,U,t,null),this._bindTextureDirectly(l,null),this._internalTexturesCache.push(Y),e._depthStencilBuffer&&(j.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),this._bindUnboundFramebuffer(e._MSAAFramebuffer??e._framebuffer),e._generateStencilBuffer=X,e._depthStencilTextureWithStencil=X,e._depthStencilBuffer=this._setupFramebufferDepthAttachments(e._generateStencilBuffer,e._generateDepthBuffer,e.width,e.height,e.samples,Y.format),this._bindUnboundFramebuffer(null),Y},j.ThinEngine.prototype.updateRenderTargetTextureSampleCount=function(K,b){var e;if(this.webGLVersion<2||!K)return 1;if(K.samples===b)return b;const z=this._gl;b=Math.min(b,this.getCaps().maxMSAASamples),K._depthStencilBuffer&&(z.deleteRenderbuffer(K._depthStencilBuffer),K._depthStencilBuffer=null),K._MSAAFramebuffer&&(z.deleteFramebuffer(K._MSAAFramebuffer),K._MSAAFramebuffer=null);const k=null===(e=K.texture)||void 0===e?void 0:e._hardwareTexture;if(null===k||void 0===k||k.releaseMSAARenderBuffers(),K.texture&&b>1&&"function"===typeof z.renderbufferStorageMultisample){const e=z.createFramebuffer();if(!e)throw new Error("Unable to create multi sampled framebuffer");K._MSAAFramebuffer=e,this._bindUnboundFramebuffer(K._MSAAFramebuffer);const j=this._createRenderBuffer(K.texture.width,K.texture.height,b,-1,this._getRGBABufferInternalSizedFormat(K.texture.type,K.texture.format,K.texture._useSRGBBuffer),z.COLOR_ATTACHMENT0,!1);if(!j)throw new Error("Unable to create multi sampled framebuffer");null===k||void 0===k||k.addMSAARenderBuffer(j)}this._bindUnboundFramebuffer(K._MSAAFramebuffer??K._framebuffer),K.texture&&(K.texture.samples=b),K._samples=b;const j=K._depthStencilTexture?K._depthStencilTexture.format:void 0;return K._depthStencilBuffer=this._setupFramebufferDepthAttachments(K._generateStencilBuffer,K._generateDepthBuffer,K.width,K.height,b,j),this._bindUnboundFramebuffer(null),b},j.ThinEngine.prototype._setupDepthStencilTexture=function(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const j=b.width??b,T=b.height??b,F=b.layers||0,l=b.depth||0;K.baseWidth=j,K.baseHeight=T,K.width=j,K.height=T,K.is2DArray=F>0,K.depth=F||l,K.isReady=!0,K.samples=k,K.generateMipMaps=!1,K.samplingMode=e?2:1,K.type=0,K._comparisonFunction=z;const Y=this._gl,A=this._getTextureTarget(K),X=this._getSamplingParameters(K.samplingMode,!1);Y.texParameteri(A,Y.TEXTURE_MAG_FILTER,X.mag),Y.texParameteri(A,Y.TEXTURE_MIN_FILTER,X.min),Y.texParameteri(A,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(A,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),this.webGLVersion>1&&(0===z?(Y.texParameteri(A,Y.TEXTURE_COMPARE_FUNC,515),Y.texParameteri(A,Y.TEXTURE_COMPARE_MODE,Y.NONE)):(Y.texParameteri(A,Y.TEXTURE_COMPARE_FUNC,z),Y.texParameteri(A,Y.TEXTURE_COMPARE_MODE,Y.COMPARE_REF_TO_TEXTURE)))}},10736:(K,b,e)=>{"use strict";e.d(b,{e:()=>M,h:()=>i,i:()=>S,l:()=>R,p:()=>n});class z{constructor(){this.children=[]}isValid(K){return!0}process(K,b){let e="";if(this.line){let Y=this.line;const A=b.processor;if(A){var z,k,j,T,F,l;A.lineProcessor&&(Y=A.lineProcessor(Y,b.isFragment,b.processingContext));const e=(null===(z=b.processor)||void 0===z?void 0:z.attributeKeywordName)??"attribute",X=b.isFragment&&null!==(k=b.processor)&&void 0!==k&&k.varyingFragmentKeywordName?null===(j=b.processor)||void 0===j?void 0:j.varyingFragmentKeywordName:!b.isFragment&&null!==(T=b.processor)&&void 0!==T&&T.varyingVertexKeywordName?null===(F=b.processor)||void 0===F?void 0:F.varyingVertexKeywordName:"varying";if(!b.isFragment&&A.attributeProcessor&&this.line.startsWith(e))Y=A.attributeProcessor(this.line,K,b.processingContext);else if(A.varyingProcessor&&(null!==(l=A.varyingCheck)&&void 0!==l&&l.call(A,this.line,b.isFragment)||!A.varyingCheck&&this.line.startsWith(X)))Y=A.varyingProcessor(this.line,b.isFragment,K,b.processingContext);else if(A.uniformProcessor&&A.uniformRegexp&&A.uniformRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(Y=A.uniformProcessor(this.line,b.isFragment,K,b.processingContext));else if(A.uniformBufferProcessor&&A.uniformBufferRegexp&&A.uniformBufferRegexp.test(this.line))b.lookForClosingBracketForUniformBuffer||(Y=A.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0);else if(A.textureProcessor&&A.textureRegexp&&A.textureRegexp.test(this.line))Y=A.textureProcessor(this.line,b.isFragment,K,b.processingContext);else if((A.uniformProcessor||A.uniformBufferProcessor)&&this.line.startsWith("uniform")&&!b.lookForClosingBracketForUniformBuffer){/uniform\s+(?:(?:highp)?|(?:lowp)?)\s*(\S+)\s+(\S+)\s*;/.test(this.line)?A.uniformProcessor&&(Y=A.uniformProcessor(this.line,b.isFragment,K,b.processingContext)):A.uniformBufferProcessor&&(Y=A.uniformBufferProcessor(this.line,b.isFragment,b.processingContext),b.lookForClosingBracketForUniformBuffer=!0)}b.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(b.lookForClosingBracketForUniformBuffer=!1,A.endOfUniformBufferProcessor&&(Y=A.endOfUniformBufferProcessor(this.line,b.isFragment,b.processingContext)))}e+=Y+"\n"}return this.children.forEach((z=>{e+=z.process(K,b)})),this.additionalDefineKey&&(K[this.additionalDefineKey]=this.additionalDefineValue||"true"),e}}class k{constructor(){this._lines=[]}get currentLine(){return this._lines[this.lineIndex]}get canRead(){return this.lineIndex<this._lines.length-1}set lines(K){this._lines.length=0;for(const b of K){if(!b||"\r"===b)continue;if("#"===b[0]){this._lines.push(b);continue}const K=b.trim();if(!K)continue;if(K.startsWith("//")){this._lines.push(b);continue}const e=K.indexOf(";");if(-1===e)this._lines.push(K);else if(e===K.length-1)K.length>1&&this._lines.push(K);else{const K=b.split(";");for(let b=0;b<K.length;b++){let e=K[b];e&&(e=e.trim(),e&&this._lines.push(e+(b!==K.length-1?";":"")))}}}}}class j extends z{process(K,b){for(let e=0;e<this.children.length;e++){const z=this.children[e];if(z.isValid(K))return z.process(K,b)}return""}}class T extends z{isValid(K){return this.testExpression.isTrue(K)}}class F{isTrue(K){return!0}static postfixToInfix(K){const b=[];for(const e of K)if(void 0===F._OperatorPriority[e])b.push(e);else{const K=b[b.length-1],z=b[b.length-2];b.length-=2,b.push(`(${z}${e}${K})`)}return b[b.length-1]}static infixToPostfix(K){const b=F._InfixToPostfixCache.get(K);if(b)return b.accessTime=Date.now(),b.result;if(!K.includes("&&")&&!K.includes("||")&&!K.includes(")")&&!K.includes("("))return[K];const e=[];let z=-1;const k=()=>{A=A.trim(),""!==A&&(e.push(A),A="")},j=K=>{z<F._Stack.length-1&&(F._Stack[++z]=K)},T=()=>F._Stack[z],l=()=>-1===z?"!!INVALID EXPRESSION!!":F._Stack[z--];let Y=0,A="";for(;Y<K.length;){const b=K.charAt(Y),X=Y<K.length-1?K.substring(Y,2+Y):"";if("("===b)A="",j(b);else if(")"===b){for(k();-1!==z&&"("!==T();)e.push(l());l()}else if(F._OperatorPriority[X]>1){for(k();-1!==z&&F._OperatorPriority[T()]>=F._OperatorPriority[X];)e.push(l());j(X),Y++}else A+=b;Y++}for(k();-1!==z;)"("===T()?l():e.push(l());return F._InfixToPostfixCache.size>=F.InfixToPostfixCacheLimitSize&&F.ClearCache(),F._InfixToPostfixCache.set(K,{result:e,accessTime:Date.now()}),e}static ClearCache(){const K=Array.from(F._InfixToPostfixCache.entries()).sort(((K,b)=>K[1].accessTime-b[1].accessTime));for(let b=0;b<F.InfixToPostfixCacheCleanupSize;b++)F._InfixToPostfixCache.delete(K[b][0])}}F.InfixToPostfixCacheLimitSize=5e4,F.InfixToPostfixCacheCleanupSize=25e3,F._InfixToPostfixCache=new Map,F._OperatorPriority={")":0,"(":1,"||":2,"&&":3},F._Stack=["","","","","","","","","","","","","","","","","","","",""];class l extends F{constructor(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(),this.define=K,this.not=b}isTrue(K){let b=void 0!==K[this.define];return this.not&&(b=!b),b}}class Y extends F{isTrue(K){return this.leftOperand.isTrue(K)||this.rightOperand.isTrue(K)}}class A extends F{isTrue(K){return this.leftOperand.isTrue(K)&&this.rightOperand.isTrue(K)}}class X extends F{constructor(K,b,e){super(),this.define=K,this.operand=b,this.testValue=e}isTrue(K){let b=K[this.define];void 0===b&&(b=this.define);let e=!1;const z=parseInt(b),k=parseInt(this.testValue);switch(this.operand){case">":e=z>k;break;case"<":e=z<k;break;case"<=":e=z<=k;break;case">=":e=z>=k;break;case"==":e=z===k;break;case"!=":e=z!==k}return e}}var t=e(10710),U=e(10739);const B=/defined\s*?\((.+?)\)/g,u=/defined\s*?\[(.+?)\]/g,m=/#include\s?<(.+)>(\((.*)\))*(\[(.*)\])*/g,D=/__decl__/,I=/light\{X\}.(\w*)/g,x=/\{X\}/g,Q=[],G=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/;function i(K){K.processor&&K.processor.initializeShaders&&K.processor.initializeShaders(K.processingContext)}function S(K,b,e,z){var k;null!==(k=b.processor)&&void 0!==k&&k.preProcessShaderCode&&(K=b.processor.preProcessShaderCode(K,b.isFragment)),R(K,b,(K=>{b.processCodeAfterIncludes&&(K=b.processCodeAfterIncludes(b.isFragment?"fragment":"vertex",K,b.defines));const k=function(K,b,e){let z=function(K,b){var e;if(null!==(e=b.processor)&&void 0!==e&&e.noPrecision)return K;const z=b.shouldUseHighPrecisionShader;-1===K.indexOf("precision highp float")?K=z?"precision highp float;\n"+K:"precision mediump float;\n"+K:z||(K=K.replace("precision highp float","precision mediump float"));return K}(K,b);if(!b.processor)return z;if(0===b.processor.shaderLanguage&&-1!==z.indexOf("#version 3")&&(z=z.replace("#version 300 es",""),!b.processor.parseGLES3))return z;const k=b.defines,j=h(b,e);b.processor.preProcessor&&(z=b.processor.preProcessor(z,k,j,b.isFragment,b.processingContext));z=w(z,j,b),b.processor.postProcessor&&(z=b.processor.postProcessor(z,k,b.isFragment,b.processingContext,e?{drawBuffersExtensionDisabled:!e.getCaps().drawBuffersExtension}:{}));null!==e&&void 0!==e&&e._features.needShaderCodeInlining&&(z=e.inlineShaderCode(z));return z}(K,b,z);e(k,K)}))}function M(K,b,e){return e.processor&&e.processor.finalizeShaders?e.processor.finalizeShaders(K,b,e.processingContext):{vertexCode:K,fragmentCode:b}}function r(K){const b=/defined\((.+)\)/.exec(K);if(b&&b.length)return new l(b[1].trim(),"!"===K[0]);const e=["==","!=",">=","<=","<",">"];let z="",k=0;for(z of e)if(k=K.indexOf(z),k>-1)break;if(-1===k)return new l(K);const j=K.substring(0,k).trim(),T=K.substring(k+z.length).trim();return new X(j,z,T)}function L(K,b){const e=new T,z=K.substring(0,b);let k=K.substring(b);return k=k.substring(0,(k.indexOf("//")+1||k.length+1)-1).trim(),e.testExpression="#ifdef"===z?new l(k):"#ifndef"===z?new l(k,!0):function(K){K=K.replace(B,"defined[$1]");const b=F.infixToPostfix(K),e=[];for(const k of b)if("||"!==k&&"&&"!==k)e.push(k);else if(e.length>=2){let K=e[e.length-1],b=e[e.length-2];e.length-=2;const z="&&"==k?new A:new Y;"string"===typeof K&&(K=K.replace(u,"defined($1)")),"string"===typeof b&&(b=b.replace(u,"defined($1)")),z.leftOperand="string"===typeof b?r(b):b,z.rightOperand="string"===typeof K?r(K):K,e.push(z)}let z=e[e.length-1];return"string"===typeof z&&(z=z.replace(u,"defined($1)")),"string"===typeof z?r(z):z}(k),e}function c(K,b,e){let k=K.currentLine;for(;v(K,e);){k=K.currentLine;const j=k.substring(0,5).toLowerCase();if("#else"===j){const e=new z;return b.children.push(e),void v(K,e)}if("#elif"===j){const K=L(k,5);b.children.push(K),e=K}}}function v(K,b){for(;K.canRead;){K.lineIndex++;const e=K.currentLine;if(e.indexOf("#")>=0){const z=G.exec(e);if(z&&z.length){switch(z[0]){case"#ifdef":{const z=new j;b.children.push(z);const k=L(e,6);z.children.push(k),c(K,z,k);break}case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":{const z=new j;b.children.push(z);const k=L(e,7);z.children.push(k),c(K,z,k);break}case"#if":{const z=new j,k=L(e,3);b.children.push(z),z.children.push(k),c(K,z,k);break}}continue}}const k=new z;if(k.line=e,b.children.push(k),"#"===e[0]&&"d"===e[1]){const K=e.replace(";","").split(" ");k.additionalDefineKey=K[1],3===K.length&&(k.additionalDefineValue=K[2])}}return!1}function w(K,b,e){const j=new z,T=new k;return T.lineIndex=-1,T.lines=K.split("\n"),v(T,j),j.process(b,e)}function h(K,b){var e;const z=K.defines,k={};for(const j of z){const K=j.replace("#define","").replace(";","").trim().split(" ");k[K[0]]=K.length>1?K[1]:""}return 0===(null===(e=K.processor)||void 0===e?void 0:e.shaderLanguage)&&(k.GL_ES="true"),k.__VERSION__=K.version,k[K.platformName]="true",(0,U.h)(k,null===b||void 0===b?void 0:b.isNDCHalfZRange,null===b||void 0===b?void 0:b.useReverseDepthBuffer,null===b||void 0===b?void 0:b.useExactSrgbConversions),k}function R(K,b,e){let z;for(Q.length=0;null!==(z=m.exec(K));)Q.push(z);let k=String(K),j=[K],T=!1;for(const F of Q){let K=F[1];if(-1!==K.indexOf("__decl__")&&(K=K.replace(D,""),b.supportsUniformBuffers&&(K=K.replace("Vertex","Ubo").replace("Fragment","Ubo")),K+="Declaration"),!b.includesShadersStore[K]){const z=b.shadersRepository+"ShadersInclude/"+K+".fx";return void n.loadFile(z,(z=>{b.includesShadersStore[K]=z,R(j.join(""),b,e)}))}{let e=b.includesShadersStore[K];if(F[2]){const K=F[3].split(",");for(let b=0;b<K.length;b+=2){const z=new RegExp(K[b],"g"),k=K[b+1];e=e.replace(z,k)}}if(F[4]){const K=F[5];if(-1!==K.indexOf("..")){const z=K.split(".."),k=parseInt(z[0]);let j=parseInt(z[1]),T=e.slice(0);e="",isNaN(j)&&(j=b.indexParameters[z[1]]);for(let K=k;K<j;K++)b.supportsUniformBuffers||(T=T.replace(I,((K,b)=>b+"{X}"))),e+=T.replace(x,K.toString())+"\n"}else b.supportsUniformBuffers||(e=e.replace(I,((K,b)=>b+"{X}"))),e=e.replace(x,K)}const z=[];for(const K of j){const b=K.split(F[0]);for(let K=0;K<b.length-1;K++)z.push(b[K]),z.push(e);z.push(b[b.length-1])}j=z,T=T||e.indexOf("#include<")>=0||e.indexOf("#include <")>=0}}Q.length=0,k=j.join(""),T?R(k.toString(),b,e):e(k)}const n={loadFile:(K,b,e,z,k,j)=>{throw(0,t.c)("FileTools")}}},11436:(K,b,e)=>{"use strict";e.d(b,{c:()=>z});class z{get underlyingResource(){return this._webGLTexture}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0;if(this._MSAARenderBuffers=null,this._context=b,!K&&(K=b.createTexture(),!K))throw new Error("Unable to create webGL texture");this.set(K)}setUsage(){}set(K){this._webGLTexture=K}reset(){this._webGLTexture=null,this._MSAARenderBuffers=null}addMSAARenderBuffer(K){this._MSAARenderBuffers||(this._MSAARenderBuffers=[]),this._MSAARenderBuffers.push(K)}releaseMSAARenderBuffers(){if(this._MSAARenderBuffers){for(const K of this._MSAARenderBuffers)this._context.deleteRenderbuffer(K);this._MSAARenderBuffers=null}}getMSAARenderBuffer(){var K;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._MSAARenderBuffers)||void 0===K?void 0:K[b])??null}release(){this.releaseMSAARenderBuffers(),this._webGLTexture&&this._context.deleteTexture(this._webGLTexture),this.reset()}}},10739:(K,b,e)=>{"use strict";e.d(b,{d:()=>k,e:()=>j,h:()=>F,k:()=>T,l:()=>l});var z=e(10710);e(10693);const k={};function j(K,b){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"")+(b?b+"\n":"")+K}function T(K,b,e,j,T,F,l){const Y=l||k.loadFile;if(Y){return Y(K,b,e,j,T,F)}throw(0,z.c)("FileTools")}function F(K,b,e,z){if(K)return b?K.IS_NDC_HALF_ZRANGE="":delete K.IS_NDC_HALF_ZRANGE,e?K.USE_REVERSE_DEPTHBUFFER="":delete K.USE_REVERSE_DEPTHBUFFER,void(z?K.USE_EXACT_SRGB_CONVERSIONS="":delete K.USE_EXACT_SRGB_CONVERSIONS);{let K="";return b&&(K+="#define IS_NDC_HALF_ZRANGE"),e&&(K&&(K+="\n"),K+="#define USE_REVERSE_DEPTHBUFFER"),z&&(K&&(K+="\n"),K+="#define USE_EXACT_SRGB_CONVERSIONS"),K}}function l(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;switch(K){case 3:{const K=(ArrayBuffer,new Int8Array(b));return z&&K.set(new Int8Array(z)),K}case 0:{const K=(ArrayBuffer,new Uint8Array(b));return z&&K.set(new Uint8Array(z)),K}case 4:{const K=b instanceof ArrayBuffer?new Int16Array(b):new Int16Array(e?b/2:b);return z&&K.set(new Int16Array(z)),K}case 5:case 8:case 9:case 10:case 2:{const K=b instanceof ArrayBuffer?new Uint16Array(b):new Uint16Array(e?b/2:b);return z&&K.set(new Uint16Array(z)),K}case 6:{const K=b instanceof ArrayBuffer?new Int32Array(b):new Int32Array(e?b/4:b);return z&&K.set(new Int32Array(z)),K}case 7:case 11:case 12:case 13:case 14:case 15:{const K=b instanceof ArrayBuffer?new Uint32Array(b):new Uint32Array(e?b/4:b);return z&&K.set(new Uint32Array(z)),K}case 1:{const K=b instanceof ArrayBuffer?new Float32Array(b):new Float32Array(e?b/4:b);return z&&K.set(new Float32Array(z)),K}}const k=(ArrayBuffer,new Uint8Array(b));return z&&k.set(new Uint8Array(z)),k}},10750:(K,b,e)=>{"use strict";e.d(b,{e:()=>x});var z=e(10720),k=e(10696),j=e(10756),T=e(10778),F=e(10707);class l{constructor(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,K&&this.reset()}get isDirty(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty}get zOffset(){return this._zOffset}set zOffset(K){this._zOffset!==K&&(this._zOffset=K,this._isZOffsetDirty=!0)}get zOffsetUnits(){return this._zOffsetUnits}set zOffsetUnits(K){this._zOffsetUnits!==K&&(this._zOffsetUnits=K,this._isZOffsetDirty=!0)}get cullFace(){return this._cullFace}set cullFace(K){this._cullFace!==K&&(this._cullFace=K,this._isCullFaceDirty=!0)}get cull(){return this._cull}set cull(K){this._cull!==K&&(this._cull=K,this._isCullDirty=!0)}get depthFunc(){return this._depthFunc}set depthFunc(K){this._depthFunc!==K&&(this._depthFunc=K,this._isDepthFuncDirty=!0)}get depthMask(){return this._depthMask}set depthMask(K){this._depthMask!==K&&(this._depthMask=K,this._isDepthMaskDirty=!0)}get depthTest(){return this._depthTest}set depthTest(K){this._depthTest!==K&&(this._depthTest=K,this._isDepthTestDirty=!0)}get frontFace(){return this._frontFace}set frontFace(K){this._frontFace!==K&&(this._frontFace=K,this._isFrontFaceDirty=!0)}reset(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._zOffsetUnits=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!0,this._isFrontFaceDirty=!1}apply(K){this.isDirty&&(this._isCullDirty&&(this.cull?K.enable(K.CULL_FACE):K.disable(K.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(K.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(K.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?K.enable(K.DEPTH_TEST):K.disable(K.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(K.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset||this.zOffsetUnits?(K.enable(K.POLYGON_OFFSET_FILL),K.polygonOffset(this.zOffset,this.zOffsetUnits)):K.disable(K.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(K.frontFace(this.frontFace),this._isFrontFaceDirty=!1))}}class Y{get isDirty(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty}get func(){return this._func}set func(K){this._func!==K&&(this._func=K,this._isStencilFuncDirty=!0)}get funcRef(){return this._funcRef}set funcRef(K){this._funcRef!==K&&(this._funcRef=K,this._isStencilFuncDirty=!0)}get funcMask(){return this._funcMask}set funcMask(K){this._funcMask!==K&&(this._funcMask=K,this._isStencilFuncDirty=!0)}get opStencilFail(){return this._opStencilFail}set opStencilFail(K){this._opStencilFail!==K&&(this._opStencilFail=K,this._isStencilOpDirty=!0)}get opDepthFail(){return this._opDepthFail}set opDepthFail(K){this._opDepthFail!==K&&(this._opDepthFail=K,this._isStencilOpDirty=!0)}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(K){this._opStencilDepthPass!==K&&(this._opStencilDepthPass=K,this._isStencilOpDirty=!0)}get mask(){return this._mask}set mask(K){this._mask!==K&&(this._mask=K,this._isStencilMaskDirty=!0)}get enabled(){return this._enabled}set enabled(K){this._enabled!==K&&(this._enabled=K,this._isStencilTestDirty=!0)}constructor(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.useStencilGlobalOnly=!1,K&&this.reset()}reset(){var K;this.stencilMaterial=void 0,null===(K=this.stencilGlobal)||void 0===K||K.reset(),this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0}apply(K){var b;if(!K)return;const e=!this.useStencilGlobalOnly&&!(null===(b=this.stencilMaterial)||void 0===b||!b.enabled);this.enabled=e?this.stencilMaterial.enabled:this.stencilGlobal.enabled,this.func=e?this.stencilMaterial.func:this.stencilGlobal.func,this.funcRef=e?this.stencilMaterial.funcRef:this.stencilGlobal.funcRef,this.funcMask=e?this.stencilMaterial.funcMask:this.stencilGlobal.funcMask,this.opStencilFail=e?this.stencilMaterial.opStencilFail:this.stencilGlobal.opStencilFail,this.opDepthFail=e?this.stencilMaterial.opDepthFail:this.stencilGlobal.opDepthFail,this.opStencilDepthPass=e?this.stencilMaterial.opStencilDepthPass:this.stencilGlobal.opStencilDepthPass,this.mask=e?this.stencilMaterial.mask:this.stencilGlobal.mask,this.isDirty&&(this._isStencilTestDirty&&(this.enabled?K.enable(K.STENCIL_TEST):K.disable(K.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(K.stencilMask(this.mask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(K.stencilFunc(this.func,this.funcRef,this.funcMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(K.stencilOp(this.opStencilFail,this.opDepthFail,this.opStencilDepthPass),this._isStencilOpDirty=!1))}}class A{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=A.ALWAYS,this.funcRef=1,this.funcMask=255,this.opStencilFail=A.KEEP,this.opDepthFail=A.KEEP,this.opStencilDepthPass=A.REPLACE}get stencilFunc(){return this.func}set stencilFunc(K){this.func=K}get stencilFuncRef(){return this.funcRef}set stencilFuncRef(K){this.funcRef=K}get stencilFuncMask(){return this.funcMask}set stencilFuncMask(K){this.funcMask=K}get stencilOpStencilFail(){return this.opStencilFail}set stencilOpStencilFail(K){this.opStencilFail=K}get stencilOpDepthFail(){return this.opDepthFail}set stencilOpDepthFail(K){this.opDepthFail=K}get stencilOpStencilDepthPass(){return this.opStencilDepthPass}set stencilOpStencilDepthPass(K){this.opStencilDepthPass=K}get stencilMask(){return this.mask}set stencilMask(K){this.mask=K}get stencilTest(){return this.enabled}set stencilTest(K){this.enabled=K}}A.ALWAYS=519,A.KEEP=7680,A.REPLACE=7681;class X{constructor(){this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this.reset()}get isDirty(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty||this._isBlendEquationParametersDirty}get alphaBlend(){return this._alphaBlend}set alphaBlend(K){this._alphaBlend!==K&&(this._alphaBlend=K,this._isAlphaBlendDirty=!0)}setAlphaBlendConstants(K,b,e,z){this._blendConstants[0]===K&&this._blendConstants[1]===b&&this._blendConstants[2]===e&&this._blendConstants[3]===z||(this._blendConstants[0]=K,this._blendConstants[1]=b,this._blendConstants[2]=e,this._blendConstants[3]=z,this._isBlendConstantsDirty=!0)}setAlphaBlendFunctionParameters(K,b,e,z){this._blendFunctionParameters[0]===K&&this._blendFunctionParameters[1]===b&&this._blendFunctionParameters[2]===e&&this._blendFunctionParameters[3]===z||(this._blendFunctionParameters[0]=K,this._blendFunctionParameters[1]=b,this._blendFunctionParameters[2]=e,this._blendFunctionParameters[3]=z,this._isBlendFunctionParametersDirty=!0)}setAlphaEquationParameters(K,b){this._blendEquationParameters[0]===K&&this._blendEquationParameters[1]===b||(this._blendEquationParameters[0]=K,this._blendEquationParameters[1]=b,this._isBlendEquationParametersDirty=!0)}reset(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1}apply(K){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?K.enable(K.BLEND):K.disable(K.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(K.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(K.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(K.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))}}var t=e(10710),U=e(10780),B=e(10693),u=e(10690),m=e(10739),D=e(10790);function I(K,b){if((0,B.k)()){const{requestAnimationFrame:e}=b||window;if("function"===typeof e)return e(K)}else if("function"===typeof requestAnimationFrame)return requestAnimationFrame(K);return setTimeout(K,16)}class x{get frameId(){return this._frameId}get isWebGPU(){return this._isWebGPU}_getShaderProcessor(K){return this._shaderProcessor}get shaderPlatformName(){return this._shaderPlatformName}_clearEmptyResources(){this._emptyTexture=null,this._emptyCubeTexture=null,this._emptyTexture3D=null,this._emptyTexture2DArray=null}get useReverseDepthBuffer(){return this._useReverseDepthBuffer}set useReverseDepthBuffer(K){K!==this._useReverseDepthBuffer&&(this._useReverseDepthBuffer=K,this._depthCullingState.depthFunc=K?518:515)}setColorWrite(K){K!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=K)}getColorWrite(){return this._colorWrite}get depthCullingState(){return this._depthCullingState}get alphaState(){return this._alphaState}get stencilState(){return this._stencilState}get stencilStateComposer(){return this._stencilStateComposer}_getGlobalDefines(K){if(K)return this.isNDCHalfZRange?K.IS_NDC_HALF_ZRANGE="":delete K.IS_NDC_HALF_ZRANGE,this.useReverseDepthBuffer?K.USE_REVERSE_DEPTHBUFFER="":delete K.USE_REVERSE_DEPTHBUFFER,void(this.useExactSrgbConversions?K.USE_EXACT_SRGB_CONVERSIONS="":delete K.USE_EXACT_SRGB_CONVERSIONS);{let K="";return this.isNDCHalfZRange&&(K+="#define IS_NDC_HALF_ZRANGE"),this.useReverseDepthBuffer&&(K&&(K+="\n"),K+="#define USE_REVERSE_DEPTHBUFFER"),this.useExactSrgbConversions&&(K&&(K+="\n"),K+="#define USE_EXACT_SRGB_CONVERSIONS"),K}}_rebuildInternalTextures(){const K=this._internalTexturesCache.slice();for(const b of K)b._rebuild()}_rebuildRenderTargetWrappers(){const K=this._renderTargetWrapperCache.slice();for(const b of K)b._rebuild()}_rebuildEffects(){for(const K in this._compiledEffects){const b=this._compiledEffects[K];b._pipelineContext=null,b._prepareEffect()}j.d.ResetCache()}_rebuildGraphicsResources(){var K;this.wipeCaches(!0),this._rebuildEffects(),null===(K=this._rebuildComputeEffects)||void 0===K||K.call(this),this._rebuildBuffers(),this._rebuildInternalTextures(),this._rebuildTextures(),this._rebuildRenderTargetWrappers(),this.wipeCaches(!0)}_flagContextRestored(){k.b.Warn(this.name+" context successfully restored."),this.onContextRestoredObservable.notifyObservers(this),this._contextWasLost=!1}_restoreEngineAfterContextLost(K){setTimeout((async()=>{this._clearEmptyResources();const b=this._depthCullingState.depthTest,e=this._depthCullingState.depthFunc,z=this._depthCullingState.depthMask,k=this._stencilState.stencilTest;await K(),this._rebuildGraphicsResources(),this._depthCullingState.depthTest=b,this._depthCullingState.depthFunc=e,this._depthCullingState.depthMask=z,this._stencilState.stencilTest=k,this._flagContextRestored()}),0)}get u(){return this._isDisposed}get snapshotRendering(){return!1}set snapshotRendering(K){}get snapshotRenderingMode(){return 0}set snapshotRenderingMode(K){}getClassName(){return"AbstractEngine"}get emptyTexture(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture}get emptyTexture3D(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D}get emptyTexture2DArray(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray}get emptyCubeTexture(){if(!this._emptyCubeTexture){const K=new Uint8Array(4),b=[K,K,K,K,K,K];this._emptyCubeTexture=this.createRawCubeTexture(b,1,5,0,!1,!1,1)}return this._emptyCubeTexture}get activeRenderLoops(){return this._activeRenderLoops}stopRenderLoop(K){if(!K)return this._activeRenderLoops.length=0,void this._cancelFrame();const b=this._activeRenderLoops.indexOf(K);b>=0&&(this._activeRenderLoops.splice(b,1),0==this._activeRenderLoops.length&&this._cancelFrame())}_cancelFrame(){if(0!==this._frameHandler){const K=this._frameHandler;if(this._frameHandler=0,(0,B.k)()){const{cancelAnimationFrame:b}=this.getHostWindow()||window;if("function"===typeof b)return b(K)}else if("function"===typeof cancelAnimationFrame)return cancelAnimationFrame(K);return clearTimeout(K)}}Pi(){this.onBeginFrameObservable.notifyObservers(this)}Qi(){this._frameId++,this.onEndFrameObservable.notifyObservers(this)}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let K=!0;(this._isDisposed||!this.renderEvenInBackground&&this._windowIsBackground)&&(K=!1),K&&(this.Pi(),this._renderViews()||this._renderFrame(),this.Qi())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}_renderFrame(){for(let K=0;K<this._activeRenderLoops.length;K++){(0,this._activeRenderLoops[K])()}}_renderViews(){return!1}_queueNewFrame(K,b){return I(K,b)}runRenderLoop(K){-1===this._activeRenderLoops.indexOf(K)&&(this._activeRenderLoops.push(K),1===this._activeRenderLoops.length&&0===this._frameHandler&&(this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))}getDepthBuffer(){return this._depthCullingState.depthTest}setDepthBuffer(K){this._depthCullingState.depthTest=K}setZOffset(K){this._depthCullingState.zOffset=this.useReverseDepthBuffer?-K:K}getZOffset(){const K=this._depthCullingState.zOffset;return this.useReverseDepthBuffer?-K:K}setZOffsetUnits(K){this._depthCullingState.zOffsetUnits=this.useReverseDepthBuffer?-K:K}getZOffsetUnits(){const K=this._depthCullingState.zOffsetUnits;return this.useReverseDepthBuffer?-K:K}getHostWindow(){return(0,B.k)()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null}get compatibilityMode(){return this._compatibilityMode}set compatibilityMode(K){this._compatibilityMode=!0}_rebuildTextures(){for(const K of this.scenes)K._rebuildTextures();for(const K of this._virtualScenes)K._rebuildTextures()}_releaseRenderTargetWrapper(K){const b=this._renderTargetWrapperCache.indexOf(K);-1!==b&&this._renderTargetWrapperCache.splice(b,1)}get currentViewport(){return this._cachedViewport}setViewport(K,b,e){const z=b||this.getRenderWidth(),k=e||this.getRenderHeight(),j=K.x||0,T=K.y||0;this._cachedViewport=K,this._viewport(j*z,T*k,z*K.width,k*K.height)}createCanvasImage(){return document.createElement("img")}get description(){let K=this.name+this.version;return this._caps.parallelShaderCompile&&(K+=" - Parallel shader compilation"),K}_createTextureBase(K,b,e,j){let T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7?arguments[7]:void 0,A=arguments.length>8?arguments[8]:void 0,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,u=arguments.length>12&&void 0!==arguments[12]?arguments[12]:null,m=arguments.length>13?arguments[13]:void 0,I=arguments.length>14?arguments[14]:void 0,Q=arguments.length>15?arguments[15]:void 0;const G="data:"===(K=K||"").substr(0,5),i="blob:"===K.substr(0,5),S=G&&-1!==K.indexOf(";base64,"),M=t||new U.e(this,1);M!==t&&(M.label=K.substring(0,60));const r=K;!this._transformTextureUrl||S||t||X||(K=this._transformTextureUrl(K)),r!==K&&(M._originalUrl=r);const L=K.lastIndexOf(".");let c=u||(L>-1?K.substring(L).toLowerCase():"");c.indexOf("?")>-1&&(c=c.split("?")[0]);const v=(0,D.b)(c,m);j&&j.addPendingData(M),M.url=K,M.generateMipMaps=!b,M.samplingMode=T,M.invertY=e,M._useSRGBBuffer=this._getUseSRGBBuffer(!!Q,b),this._doNotHandleContextLost||(M._buffer=X);let w=null;F&&!t&&(w=M.onLoadedObservable.add(F)),t||this._internalTexturesCache.push(M);const h=(e,t)=>{j&&j.removePendingData(M),K===r?(w&&M.onLoadedObservable.remove(w),z.b.UseFallbackTexture&&K!==z.b.FallbackTexture&&this._createTextureBase(z.b.FallbackTexture,b,M.invertY,j,T,null,l,Y,A,X,M),e=(e||"Unknown error")+(z.b.UseFallbackTexture?" - Fallback texture was used":""),M.onErrorObservable.notifyObservers({message:e,exception:t}),l&&l(e,t)):(k.b.Warn(`Failed to load ${K}, falling back to ${r}`),this._createTextureBase(r,b,M.invertY,j,T,F,l,Y,A,X,M,B,u,m,I,Q))};if(v){const b=async K=>{(await v).loadData(K,M,((K,b,e,z,k,F)=>{F?h("TextureLoader failed to load data"):Y(M,c,j,{width:K,height:b},M.invertY,!e,z,(()=>(k(),!1)),T)}),I)};X?X instanceof ArrayBuffer?b(new Uint8Array(X)):ArrayBuffer.isView(X)?b(X):l&&l("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(K,(K=>b(new Uint8Array(K))),void 0,j?j.offlineProvider:void 0,!0,((K,b)=>{h("Unable to load "+(K&&K.responseURL,b))}))}else{const e=K=>{i&&!this._doNotHandleContextLost&&(M._buffer=K),Y(M,c,j,K,M.invertY,b,!1,A,T)};!G||S?X&&("string"===typeof X.decoding||X.close)?e(X):x._FileToolsLoadImage(K||"",e,h,j?j.offlineProvider:null,m,M.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):"string"===typeof X||X instanceof ArrayBuffer||ArrayBuffer.isView(X)||X instanceof Blob?x._FileToolsLoadImage(X,e,h,j?j.offlineProvider:null,m,M.invertY&&this._features.needsInvertingBitmap?{imageOrientation:"flipY"}:void 0):X&&e(X)}return M}_rebuildBuffers(){for(const K of this._uniformBuffers)K._rebuildAfterContextLost()}get _shouldUseHighPrecisionShader(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)}getHostDocument(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:(0,B.d)()?document:null}getLoadedTexturesCache(){return this._internalTexturesCache}clearInternalTexturesCache(){this._internalTexturesCache.length=0}getCaps(){return this._caps}resetTextureCache(){for(const K in this._boundTexturesCache)Object.prototype.hasOwnProperty.call(this._boundTexturesCache,K)&&(this._boundTexturesCache[K]=null);this._currentTextureChannel=-1}get name(){return this._name}set name(K){this._name=K}static get NpmPackage(){return"babylonjs@7.33.0"}static get Version(){return"7.33.0"}getRenderingCanvas(){return this._renderingCanvas}getAudioContext(){return this._audioContext}getAudioDestination(){return this._audioDestination}setHardwareScalingLevel(K){this._hardwareScalingLevel=K,this.resize()}getHardwareScalingLevel(){return this._hardwareScalingLevel}get doNotHandleContextLost(){return this._doNotHandleContextLost}set doNotHandleContextLost(K){this._doNotHandleContextLost=K}get isStencilEnable(){return this._isStencilEnable}getCreationOptions(){return this._creationOptions}constructor(K,b,e){var k,j;this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new l,this._stencilStateComposer=new Y,this._stencilState=new A,this._alphaState=new X,this._alphaMode=1,this._alphaEquation=0,this._activeRequests=[],this._badOS=!1,this._badDesktopOS=!1,this._compatibilityMode=!0,this._internalTexturesCache=new Array,this._currentRenderTarget=null,this._boundTexturesCache={},this._activeChannel=0,this._currentTextureChannel=-1,this._viewportCached={x:0,y:0,z:0,w:0},this._isWebGPU=!1,this.onCanvasBlurObservable=new u.d,this.onCanvasFocusObservable=new u.d,this.onNewSceneAddedObservable=new u.d,this.onResizeObservable=new u.d,this.onCanvasPointerOutObservable=new u.d,this.disablePerformanceMonitorInBackground=!1,this.disableVertexArrayObjects=!1,this._frameId=0,this.hostInformation={isMobile:!1},this.isFullscreen=!1,this.enableOfflineSupport=!1,this.disableManifestCheck=!1,this.disableContextMenu=!0,this.currentRenderPassId=0,this.isPointerLock=!1,this.postProcesses=[],this.canvasTabIndex=1,this._contextWasLost=!1,this._useReverseDepthBuffer=!1,this.isNDCHalfZRange=!1,this.hasOriginBottomLeft=!0,this._renderTargetWrapperCache=new Array,this._compiledEffects={},this._isDisposed=!1,this.scenes=[],this._virtualScenes=new Array,this.onBeforeTextureInitObservable=new u.d,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this._frameHandler=0,this._activeRenderLoops=new Array,this._windowIsBackground=!1,this._boundRenderFunction=()=>this._renderLoop(),this.onBeforeShaderCompilationObservable=new u.d,this.onAfterShaderCompilationObservable=new u.d,this.onBeginFrameObservable=new u.d,this.onEndFrameObservable=new u.d,this._transformTextureUrl=null,this._uniformBuffers=new Array,this._storageBuffers=new Array,this._highPrecisionShadersAllowed=!0,this.onContextLostObservable=new u.d,this.onContextRestoredObservable=new u.d,this._name="",this.premultipliedAlpha=!0,this.adaptToDeviceRatio=!1,this._lastDevicePixelRatio=1,this._doNotHandleContextLost=!1,this.cullBackFaces=null,this._renderPassNames=["main"],this._fps=60,this._deltaTime=0,this._deterministicLockstep=!1,this._lockstepMaxSteps=4,this._timeStep=1/60,this.Ui=new u.d,z.b.Instances.push(this),this.startTime=F.e.Now,this._stencilStateComposer.stencilGlobal=this._stencilState,T.e.SetMatrixPrecision(!!b.useHighPrecisionMatrix),(0,B.g)()&&navigator.userAgent&&(this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)),this.adaptToDeviceRatio=e??!1,b.antialias=K??b.antialias,b.deterministicLockstep=b.deterministicLockstep??!1,b.lockstepMaxSteps=b.lockstepMaxSteps??4,b.timeStep=b.timeStep??1/60,b.audioEngine=b.audioEngine??!0,b.stencil=b.stencil??!0,this._audioContext=(null===(k=b.audioEngineOptions)||void 0===k?void 0:k.audioContext)??null,this._audioDestination=(null===(j=b.audioEngineOptions)||void 0===j?void 0:j.audioDestination)??null,this.premultipliedAlpha=b.premultipliedAlpha??!0,this._doNotHandleContextLost=!!b.doNotHandleContextLost,this._isStencilEnable=!!b.stencil,this.useExactSrgbConversions=b.useExactSrgbConversions??!1;const t=(0,B.k)()&&window.devicePixelRatio||1,U=b.limitDeviceRatio||t;e=e||b.adaptToDeviceRatio||!1,this._hardwareScalingLevel=e?1/Math.min(U,t):1,this._lastDevicePixelRatio=t,this._creationOptions=b}resize(){let K,b,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.adaptToDeviceRatio){const K=(0,B.k)()&&window.devicePixelRatio||1,b=this._lastDevicePixelRatio/K;this._lastDevicePixelRatio=K,this._hardwareScalingLevel*=b}if((0,B.k)()&&(0,B.d)())if(this._renderingCanvas){const e=this._renderingCanvas.getBoundingClientRect?this._renderingCanvas.getBoundingClientRect():{width:this._renderingCanvas.width*this._hardwareScalingLevel,height:this._renderingCanvas.height*this._hardwareScalingLevel};K=this._renderingCanvas.clientWidth||e.width||this._renderingCanvas.width||100,b=this._renderingCanvas.clientHeight||e.height||this._renderingCanvas.height||100}else K=window.innerWidth,b=window.innerHeight;else K=this._renderingCanvas?this._renderingCanvas.width:100,b=this._renderingCanvas?this._renderingCanvas.height:100;this.setSize(K/this._hardwareScalingLevel,b/this._hardwareScalingLevel,e)}setSize(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._renderingCanvas)return!1;if(K|=0,b|=0,!e&&this._renderingCanvas.width===K&&this._renderingCanvas.height===b)return!1;if(this._renderingCanvas.width=K,this._renderingCanvas.height=b,this.scenes){for(let K=0;K<this.scenes.length;K++){const b=this.scenes[K];for(let K=0;K<b.cameras.length;K++){b.cameras[K]._currentRenderId=0}}this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this)}return!0}createRawTexture(K,b,e,z,k,j,T,F,l,Y,A){throw(0,t.c)("engine.rawTexture")}createRawCubeTexture(K,b,e,z,k,j,T,F){throw(0,t.c)("engine.rawTexture")}createRawTexture3D(K,b,e,z,k,j,T,F,l,Y,A){throw(0,t.c)("engine.rawTexture")}createRawTexture2DArray(K,b,e,z,k,j,T,F,l,Y,A){throw(0,t.c)("engine.rawTexture")}_sharedInit(K){this._renderingCanvas=K}_setupMobileChecks(){navigator&&navigator.userAgent&&(this._checkForMobile=()=>{const K=navigator.userAgent;this.hostInformation.isMobile=-1!==K.indexOf("Mobile")||-1!==K.indexOf("Mac")&&(0,B.d)()&&"ontouchend"in document},this._checkForMobile(),(0,B.k)()&&window.addEventListener("resize",this._checkForMobile))}createVideoElement(K){return document.createElement("video")}_reportDrawCall(){var K;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;null===(K=this._drawCalls)||void 0===K||K.addCount(b,!1)}getFps(){return this._fps}getDeltaTime(){return this._deltaTime}isDeterministicLockStep(){return this._deterministicLockstep}getLockstepMaxSteps(){return this._lockstepMaxSteps}getTimeStep(){return 1e3*this._timeStep}_createImageBitmapFromSource(K,b){throw new Error("createImageBitmapFromSource is not implemented")}createImageBitmap(K,b){return createImageBitmap(K,b)}resizeImageBitmap(K,b,e){throw new Error("resizeImageBitmap is not implemented")}getFontOffset(K){throw new Error("getFontOffset is not implemented")}static _CreateCanvas(K,b){if("undefined"===typeof document)return new OffscreenCanvas(K,b);const e=document.createElement("canvas");return e.width=K,e.height=b,e}createCanvas(K,b){return x._CreateCanvas(K,b)}static _FileToolsLoadImage(K,b,e,z,k,j){throw(0,t.c)("FileTools")}_loadFile(K,b,e,z,k,j){const T=(0,m.k)(K,b,e,z,k,j);return this._activeRequests.push(T),T.onCompleteObservable.add((()=>{const K=this._activeRequests.indexOf(T);-1!==K&&this._activeRequests.splice(K,1)})),T}static _FileToolsLoadFile(K,b,e,z,k,j){if(m.d.loadFile)return m.d.loadFile(K,b,e,z,k,j);throw(0,t.c)("FileTools")}dispose(){var K;for(this.releaseEffects(),this._isDisposed=!0,this.stopRenderLoop(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this._renderingCanvas=null,this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear();this.postProcesses.length;)this.postProcesses[0].dispose();for(;this.scenes.length;)this.scenes[0].dispose();for(;this._virtualScenes.length;)this._virtualScenes[0].dispose();null===(K=this.releaseComputeEffects)||void 0===K||K.call(this),j.d.ResetCache();for(const e of this._activeRequests)e.abort();this._boundRenderFunction=null,this.Ui.notifyObservers(this),this.Ui.clear(),this.onResizeObservable.clear(),this.onCanvasBlurObservable.clear(),this.onCanvasFocusObservable.clear(),this.onCanvasPointerOutObservable.clear(),this.onNewSceneAddedObservable.clear(),(0,B.k)()&&window.removeEventListener("resize",this._checkForMobile);const b=z.b.Instances.indexOf(this);b>=0&&z.b.Instances.splice(b,1),z.b.Instances.length||(z.b.OnEnginesDisposedObservable.notifyObservers(this),z.b.OnEnginesDisposedObservable.clear()),this.onBeginFrameObservable.clear(),this.onEndFrameObservable.clear()}static DefaultLoadingScreenFactory(K){throw(0,t.c)("LoadingScreen")}static MarkAllMaterialsAsDirty(K,b){for(let e=0;e<z.b.Instances.length;e++){const k=z.b.Instances[e];for(let e=0;e<k.scenes.length;e++)k.scenes[e].markAllMaterialsAsDirty(K,b)}}}x._RenderPassIdCounter=0,x._RescalePostProcessFactory=null,x.CollisionsEpsilon=.001,x.QueueNewFrame=I},11455:(K,b,e)=>{"use strict";e.d(b,{e:()=>M});var z=e(10780),k=e(10720),j=e(11415),T=e(10707);class F{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;this._enabled=!0,this._rollingFrameTime=new l(K)}sampleFrame(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.e.Now;if(this._enabled){if(null!=this._lastFrameTimeMs){const b=K-this._lastFrameTimeMs;this._rollingFrameTime.add(b)}this._lastFrameTimeMs=K}}get averageFrameTime(){return this._rollingFrameTime.average}get averageFrameTimeVariance(){return this._rollingFrameTime.variance}get instantaneousFrameTime(){return this._rollingFrameTime.history(0)}get averageFPS(){return 1e3/this._rollingFrameTime.average}get instantaneousFPS(){const K=this._rollingFrameTime.history(0);return 0===K?0:1e3/K}get isSaturated(){return this._rollingFrameTime.isSaturated()}enable(){this._enabled=!0}disable(){this._enabled=!1,this._lastFrameTimeMs=null}get isEnabled(){return this._enabled}reset(){this._lastFrameTimeMs=null,this._rollingFrameTime.reset()}}class l{constructor(K){this._samples=new Array(K),this.reset()}add(K){let b;if(this.isSaturated()){const K=this._samples[this._pos];b=K-this.average,this.average-=b/(this._sampleCount-1),this._m2-=b*(K-this.average)}else this._sampleCount++;b=K-this.average,this.average+=b/this._sampleCount,this._m2+=b*(K-this.average),this.variance=this._m2/(this._sampleCount-1),this._samples[this._pos]=K,this._pos++,this._pos%=this._samples.length}history(K){if(K>=this._sampleCount||K>=this._samples.length)return 0;const b=this._wrapPosition(this._pos-1);return this._samples[this._wrapPosition(b-K)]}isSaturated(){return this._sampleCount>=this._samples.length}reset(){this.average=0,this.variance=0,this._sampleCount=0,this._pos=0,this._m2=0}_wrapPosition(K){const b=this._samples.length;return(K%b+b)%b}}var Y=e(11430),A=e(10696),X=e(11436),t=(e(11447),e(10803));function U(K,b,e,z){let k,j=1;1===z?k=new Float32Array(b*e*4):2===z?(k=new Uint16Array(b*e*4),j=15360):k=7===z?new Uint32Array(b*e*4):new Uint8Array(b*e*4);for(let T=0;T<b;T++)for(let z=0;z<e;z++){const e=3*(z*b+T),F=4*(z*b+T);k[F+0]=K[e+0],k[F+1]=K[e+1],k[F+2]=K[e+2],k[F+3]=j}return k}function B(K){return function(b,e,k,j,T,F,l,Y){let A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const t=K?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,U=K?10:11,B=new z.e(this,U);B.baseWidth=e,B.baseHeight=k,B.baseDepth=j,B.width=e,B.height=k,B.depth=j,B.format=T,B.type=X,B.generateMipMaps=F,B.samplingMode=Y,K?B.is3D=!0:B.is2DArray=!0,this._doNotHandleContextLost||(B._bufferView=b),K?this.updateRawTexture3D(B,b,T,l,A,X):this.updateRawTexture2DArray(B,b,T,l,A,X),this._bindTextureDirectly(t,B,!0);const u=this._getSamplingParameters(Y,F);return this._gl.texParameteri(t,this._gl.TEXTURE_MAG_FILTER,u.mag),this._gl.texParameteri(t,this._gl.TEXTURE_MIN_FILTER,u.min),F&&this._gl.generateMipmap(t),this._bindTextureDirectly(t,null),this._internalTexturesCache.push(B),B}}function u(K){return function(b,e,z,k){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const F=K?this._gl.TEXTURE_3D:this._gl.TEXTURE_2D_ARRAY,l=this._getWebGLTextureType(T),Y=this._getInternalFormat(z),A=this._getRGBABufferInternalSizedFormat(T,z);this._bindTextureDirectly(F,b,!0),this._unpackFlipY(void 0===k||!!k),this._doNotHandleContextLost||(b._bufferView=e,b.format=z,b.invertY=k,b._compression=j),b.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),j&&e?this._gl.compressedTexImage3D(F,0,this.getCaps().s3tc[j],b.width,b.height,b.depth,0,e):this._gl.texImage3D(F,0,A,b.width,b.height,b.depth,0,Y,l,e),b.generateMipMaps&&this._gl.generateMipmap(F),this._bindTextureDirectly(F,null),b.isReady=!0}}j.ThinEngine.prototype.updateRawTexture=function(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(!K)return;const F=this._getRGBABufferInternalSizedFormat(j,e,T),l=this._getInternalFormat(e),Y=this._getWebGLTextureType(j);this._bindTextureDirectly(this._gl.TEXTURE_2D,K,!0),this._unpackFlipY(void 0===z||!!z),this._doNotHandleContextLost||(K._bufferView=b,K.format=e,K.type=j,K.invertY=z,K._compression=k),K.width%4!==0&&this._gl.pixelStorei(this._gl.UNPACK_ALIGNMENT,1),k&&b?this._gl.compressedTexImage2D(this._gl.TEXTURE_2D,0,this.getCaps().s3tc[k],K.width,K.height,0,b):this._gl.texImage2D(this._gl.TEXTURE_2D,0,F,K.width,K.height,0,l,Y,b),K.generateMipMaps&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),K.isReady=!0},j.ThinEngine.prototype.createRawTexture=function(K,b,e,k,j,T,F){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>10&&void 0!==arguments[10]&&arguments[10];const X=new z.e(this,3);X.baseWidth=b,X.baseHeight=e,X.width=b,X.height=e,X.format=k,X.generateMipMaps=j,X.samplingMode=F,X.invertY=T,X._compression=l,X.type=Y,X._useSRGBBuffer=this._getUseSRGBBuffer(A,!j),this._doNotHandleContextLost||(X._bufferView=K),this.updateRawTexture(X,K,k,T,l,Y,X._useSRGBBuffer),this._bindTextureDirectly(this._gl.TEXTURE_2D,X,!0);const t=this._getSamplingParameters(F,j);return this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,t.mag),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,t.min),j&&this._gl.generateMipmap(this._gl.TEXTURE_2D),this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._internalTexturesCache.push(X),X},j.ThinEngine.prototype.createRawCubeTexture=function(K,b,e,k,j,T,F){let l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;const Y=this._gl,X=new z.e(this,8);X.isCube=!0,X.format=e,X.type=k,this._doNotHandleContextLost||(X._bufferViewArray=K);const U=this._getWebGLTextureType(k);let B=this._getInternalFormat(e);B===Y.RGB&&(B=Y.RGBA),U!==Y.FLOAT||this._caps.textureFloatLinearFiltering?U!==this._gl.HALF_FLOAT_OES||this._caps.textureHalfFloatLinearFiltering?U!==Y.FLOAT||this._caps.textureFloatRender?U!==Y.HALF_FLOAT||this._caps.colorBufferFloat||(j=!1,A.b.Warn("Render to half float textures is not supported. Mipmap generation forced to false.")):(j=!1,A.b.Warn("Render to float textures is not supported. Mipmap generation forced to false.")):(j=!1,F=1,A.b.Warn("Half float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively.")):(j=!1,F=1,A.b.Warn("Float texture filtering is not supported. Mipmap generation and sampling mode are forced to false and TEXTURE_NEAREST_SAMPLINGMODE, respectively."));const u=b,m=u;X.width=u,X.height=m,X.invertY=T,X._compression=l;if(!this.needPOTTextures||(0,t.k)(X.width)&&(0,t.k)(X.height)||(j=!1),K)this.updateRawCubeTexture(X,K,e,k,T,l);else{const K=this._getRGBABufferInternalSizedFormat(k),b=0;this._bindTextureDirectly(Y.TEXTURE_CUBE_MAP,X,!0);for(let e=0;e<6;e++)l?Y.compressedTexImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+e,b,this.getCaps().s3tc[l],X.width,X.height,0,void 0):Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+e,b,K,X.width,X.height,0,B,U,null);this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)}this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,X,!0),K&&j&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP);const D=this._getSamplingParameters(F,j);return Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,D.mag),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,D.min),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),this._bindTextureDirectly(Y.TEXTURE_CUBE_MAP,null),X.generateMipMaps=j,X.samplingMode=F,X.isReady=!0,X},j.ThinEngine.prototype.updateRawCubeTexture=function(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;K._bufferViewArray=b,K.format=e,K.type=z,K.invertY=k,K._compression=j;const F=this._gl,l=this._getWebGLTextureType(z);let Y=this._getInternalFormat(e);const A=this._getRGBABufferInternalSizedFormat(z);let X=!1;Y===F.RGB&&(Y=F.RGBA,X=!0),this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,K,!0),this._unpackFlipY(void 0===k||!!k),K.width%4!==0&&F.pixelStorei(F.UNPACK_ALIGNMENT,1);for(let t=0;t<6;t++){let e=b[t];j?F.compressedTexImage2D(F.TEXTURE_CUBE_MAP_POSITIVE_X+t,T,this.getCaps().s3tc[j],K.width,K.height,0,e):(X&&(e=U(e,K.width,K.height,z)),F.texImage2D(F.TEXTURE_CUBE_MAP_POSITIVE_X+t,T,A,K.width,K.height,0,Y,l,e))}(!this.needPOTTextures||(0,t.k)(K.width)&&(0,t.k)(K.height))&&K.generateMipMaps&&0===T&&this._gl.generateMipmap(this._gl.TEXTURE_CUBE_MAP),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),K.isReady=!0},j.ThinEngine.prototype.createRawCubeTextureFromUrl=function(K,b,e,z,k,j,T,F){let l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,A=arguments.length>10&&void 0!==arguments[10]?arguments[10]:3,X=arguments.length>11&&void 0!==arguments[11]&&arguments[11];const t=this._gl,B=this.createRawCubeTexture(null,e,z,k,!j,X,A,null);null===b||void 0===b||b.addPendingData(B),B.url=K,B.isReady=!1,this._internalTexturesCache.push(B);const u=K=>{const e=B.width,j=T(K);if(j){if(F){const K=this._getWebGLTextureType(k);let b=this._getInternalFormat(z);const T=this._getRGBABufferInternalSizedFormat(k);let l=!1;b===t.RGB&&(b=t.RGBA,l=!0),this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,B,!0),this._unpackFlipY(!1);const Y=F(j);for(let z=0;z<Y.length;z++){const j=e>>z;for(let e=0;e<6;e++){let F=Y[z][e];l&&(F=U(F,j,j,k)),t.texImage2D(e,z,T,j,j,0,b,K,F)}}this._bindTextureDirectly(t.TEXTURE_CUBE_MAP,null)}else this.updateRawCubeTexture(B,j,z,k,X);B.isReady=!0,null===b||void 0===b||b.removePendingData(B),B.onLoadedObservable.notifyObservers(B),B.onLoadedObservable.clear(),l&&l()}};return this._loadFile(K,(K=>{u(K)}),void 0,null===b||void 0===b?void 0:b.offlineProvider,!0,((K,e)=>{null===b||void 0===b||b.removePendingData(B),Y&&K&&Y(K.status+" "+K.statusText,e)})),B},j.ThinEngine.prototype.createRawTexture2DArray=B(!1),j.ThinEngine.prototype.createRawTexture3D=B(!0),j.ThinEngine.prototype.updateRawTexture2DArray=u(!1),j.ThinEngine.prototype.updateRawTexture3D=u(!0);var m=e(10739);j.ThinEngine.prototype._readTexturePixelsSync=function(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;const A=this._gl;if(!A)throw new Error("Engine does not have gl rendering context.");if(!this._dummyFramebuffer){const K=A.createFramebuffer();if(!K)throw new Error("Unable to create dummy framebuffer");this._dummyFramebuffer=K}var X,t;(A.bindFramebuffer(A.FRAMEBUFFER,this._dummyFramebuffer),z>-1)?A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+z,null===(X=K._hardwareTexture)||void 0===X?void 0:X.underlyingResource,k):A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_2D,null===(t=K._hardwareTexture)||void 0===t?void 0:t.underlyingResource,k);let U=void 0!==K.type?this._getWebGLTextureType(K.type):A.UNSIGNED_BYTE;if(F)j||(j=(0,m.l)(K.type,4*b*e));else if(U===A.UNSIGNED_BYTE)j||(j=new Uint8Array(4*b*e)),U=A.UNSIGNED_BYTE;else j||(j=new Float32Array(4*b*e)),U=A.FLOAT;return T&&this.flushFramebuffer(),A.readPixels(l,Y,b,e,A.RGBA,U,j),A.bindFramebuffer(A.FRAMEBUFFER,this._currentFramebuffer),j},j.ThinEngine.prototype._readTexturePixels=function(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],F=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;return Promise.resolve(this._readTexturePixelsSync(K,b,e,z,k,j,T,F,l,Y))};e(11413);j.ThinEngine.prototype._createDepthStencilCubeTexture=function(K,b){const e=new z.e(this,12);if(e.isCube=!0,1===this.webGLVersion)return A.b.Error("Depth cube texture is not supported by WebGL 1."),e;const k={bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1,...b},j=this._gl;this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,e,!0),this._setupDepthStencilTexture(e,K,k.bilinearFiltering,k.comparisonFunction);for(let z=0;z<6;z++)k.generateStencil?j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,j.DEPTH24_STENCIL8,K,K,0,j.DEPTH_STENCIL,j.UNSIGNED_INT_24_8,null):j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,j.DEPTH_COMPONENT24,K,K,0,j.DEPTH_COMPONENT,j.UNSIGNED_INT,null);return this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null),this._internalTexturesCache.push(e),e},j.ThinEngine.prototype._setCubeMapTextureParams=function(K,b,e){const z=this._gl;z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAG_FILTER,z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MIN_FILTER,b?z.LINEAR_MIPMAP_LINEAR:z.LINEAR),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_S,z.CLAMP_TO_EDGE),z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_WRAP_T,z.CLAMP_TO_EDGE),K.samplingMode=b?3:2,b&&this.getCaps().textureMaxLevel&&void 0!==e&&e>0&&(z.texParameteri(z.TEXTURE_CUBE_MAP,z.TEXTURE_MAX_LEVEL,e),K._maxLodLevel=e),this._bindTextureDirectly(z.TEXTURE_CUBE_MAP,null)},j.ThinEngine.prototype.createCubeTexture=function(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8],Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:null,B=arguments.length>13&&void 0!==arguments[13]&&arguments[13],u=arguments.length>14&&void 0!==arguments[14]?arguments[14]:null;const m=this._gl;return this.createCubeTextureBase(K,b,e,!!z,k,j,T,F,l,Y,X,U,(K=>this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,K,!0)),((K,b)=>{const e=this.needPOTTextures?(0,t.g)(b[0].width,this._caps.maxCubemapTextureSize):b[0].width,j=e,F=[m.TEXTURE_CUBE_MAP_POSITIVE_X,m.TEXTURE_CUBE_MAP_POSITIVE_Y,m.TEXTURE_CUBE_MAP_POSITIVE_Z,m.TEXTURE_CUBE_MAP_NEGATIVE_X,m.TEXTURE_CUBE_MAP_NEGATIVE_Y,m.TEXTURE_CUBE_MAP_NEGATIVE_Z];this._bindTextureDirectly(m.TEXTURE_CUBE_MAP,K,!0),this._unpackFlipY(!1);const l=T?this._getInternalFormat(T,K._useSRGBBuffer):K._useSRGBBuffer?this._glSRGBExtensionValues.SRGB8_ALPHA8:m.RGBA;let Y=T?this._getInternalFormat(T):m.RGBA;K._useSRGBBuffer&&1===this.webGLVersion&&(Y=l);for(let z=0;z<F.length;z++)if(b[z].width!==e||b[z].height!==j){if(this._prepareWorkingCanvas(),!this._workingCanvas||!this._workingContext)return void A.b.Warn("Cannot create canvas to resize texture.");this._workingCanvas.width=e,this._workingCanvas.height=j,this._workingContext.drawImage(b[z],0,0,b[z].width,b[z].height,0,0,e,j),m.texImage2D(F[z],0,l,Y,m.UNSIGNED_BYTE,this._workingCanvas)}else m.texImage2D(F[z],0,l,Y,m.UNSIGNED_BYTE,b[z]);z||m.generateMipmap(m.TEXTURE_CUBE_MAP),this._setCubeMapTextureParams(K,!z),K.width=e,K.height=j,K.isReady=!0,T&&(K.format=T),K.onLoadedObservable.notifyObservers(K),K.onLoadedObservable.clear(),k&&k()}),!!B,u)},j.ThinEngine.prototype.generateMipMapsForCubemap=function(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K.generateMipMaps){const e=this._gl;this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,K,!0),e.generateMipmap(e.TEXTURE_CUBE_MAP),b&&this._bindTextureDirectly(e.TEXTURE_CUBE_MAP,null)}};e(11459);j.ThinEngine.prototype.setDepthStencilTexture=function(K,b,e,z){void 0!==K&&(b&&(this._boundUniforms[K]=b),e&&e.depthStencilTexture?this._setTexture(K,e,!1,!0,z):this._setTexture(K,null,void 0,void 0,z))},j.ThinEngine.prototype.createRenderTargetCubeTexture=function(K,b){const e=this._createHardwareRenderTargetWrapper(!1,!0,K),k={generateMipMaps:!0,generateDepthBuffer:!0,generateStencilBuffer:!1,type:0,samplingMode:3,format:5,...b};k.generateStencilBuffer=k.generateDepthBuffer&&k.generateStencilBuffer,(1!==k.type||this._caps.textureFloatLinearFiltering)&&(2!==k.type||this._caps.textureHalfFloatLinearFiltering)||(k.samplingMode=1);const j=this._gl,T=new z.e(this,5);this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,T,!0);const F=this._getSamplingParameters(k.samplingMode,k.generateMipMaps);1!==k.type||this._caps.textureFloat||(k.type=0,A.b.Warn("Float textures are not supported. Cube render target forced to TEXTURETYPE_UNESIGNED_BYTE type")),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MAG_FILTER,F.mag),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_MIN_FILTER,F.min),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_CUBE_MAP,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE);for(let z=0;z<6;z++)j.texImage2D(j.TEXTURE_CUBE_MAP_POSITIVE_X+z,0,this._getRGBABufferInternalSizedFormat(k.type,k.format),K,K,0,this._getInternalFormat(k.format),this._getWebGLTextureType(k.type),null);const l=j.createFramebuffer();return this._bindUnboundFramebuffer(l),e._depthStencilBuffer=this._setupFramebufferDepthAttachments(k.generateStencilBuffer,k.generateDepthBuffer,K,K),k.generateMipMaps&&j.generateMipmap(j.TEXTURE_CUBE_MAP),this._bindTextureDirectly(j.TEXTURE_CUBE_MAP,null),this._bindUnboundFramebuffer(null),e._framebuffer=l,e._generateDepthBuffer=k.generateDepthBuffer,e._generateStencilBuffer=k.generateStencilBuffer,T.width=K,T.height=K,T.isReady=!0,T.isCube=!0,T.samples=1,T.generateMipMaps=k.generateMipMaps,T.samplingMode=k.samplingMode,T.type=k.type,T.format=k.format,this._internalTexturesCache.push(T),e.setTextures(T),e};var D=e(11479),I=e(11170),x=e(11497);j.ThinEngine.prototype.createPrefilteredCubeTexture=function(K,b,e,k){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];return this.createCubeTexture(K,b,null,!1,(K=>{if(!K)return void(j&&j(null));const T=K.texture;if(Y?K.info.sphericalPolynomial&&(T._sphericalPolynomial=K.info.sphericalPolynomial):T._sphericalPolynomial=new D.c,T._source=9,this.getCaps().textureLOD)return void(j&&j(T));const F=this._gl,l=K.width;if(!l)return;const X=[];for(let j=0;j<3;j++){const Y=1-j/2,t=k,U=Math.log2(l)*e+k,B=t+(U-t)*Y,u=Math.round(Math.min(Math.max(B,0),U)),m=new z.e(this,2);if(m.type=T.type,m.format=T.format,m.width=Math.pow(2,Math.max(Math.log2(l)-u,0)),m.height=m.width,m.isCube=!0,m._cachedWrapU=0,m._cachedWrapV=0,this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,m,!0),m.samplingMode=2,F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MAG_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_MIN_FILTER,F.LINEAR),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_S,F.CLAMP_TO_EDGE),F.texParameteri(F.TEXTURE_CUBE_MAP,F.TEXTURE_WRAP_T,F.CLAMP_TO_EDGE),K.isDDS){const b=K.info,e=K.data;this._unpackFlipY(b.isCompressed),x.c.UploadDDSLevels(this,m,e,b,!0,6,u)}else A.b.Warn("DDS is the only prefiltered cube map supported so far.");this._bindTextureDirectly(F.TEXTURE_CUBE_MAP,null);const D=new I.d(b);D._isCube=!0,D._texture=m,m.isReady=!0,X.push(D)}T._lodTextureHigh=X[2],T._lodTextureMid=X[1],T._lodTextureLow=X[0],j&&j(T)}),T,F,l,Y,e,k)},j.ThinEngine.prototype.createUniformBuffer=function(K,b){const e=this._gl.createBuffer();if(!e)throw new Error("Unable to create uniform buffer");const z=new Y.b(e);return this.bindUniformBuffer(z),K instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,K,this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(K),this._gl.STATIC_DRAW),this.bindUniformBuffer(null),z.references=1,z},j.ThinEngine.prototype.createDynamicUniformBuffer=function(K,b){const e=this._gl.createBuffer();if(!e)throw new Error("Unable to create dynamic uniform buffer");const z=new Y.b(e);return this.bindUniformBuffer(z),K instanceof Float32Array?this._gl.bufferData(this._gl.UNIFORM_BUFFER,K,this._gl.DYNAMIC_DRAW):this._gl.bufferData(this._gl.UNIFORM_BUFFER,new Float32Array(K),this._gl.DYNAMIC_DRAW),this.bindUniformBuffer(null),z.references=1,z},j.ThinEngine.prototype.updateUniformBuffer=function(K,b,e,z){this.bindUniformBuffer(K),void 0===e&&(e=0),void 0===z?b instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,b):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,e,new Float32Array(b)):b instanceof Float32Array?this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,b.subarray(e,e+z)):this._gl.bufferSubData(this._gl.UNIFORM_BUFFER,0,new Float32Array(b).subarray(e,e+z)),this.bindUniformBuffer(null)},j.ThinEngine.prototype.bindUniformBuffer=function(K){this._gl.bindBuffer(this._gl.UNIFORM_BUFFER,K?K.underlyingResource:null)},j.ThinEngine.prototype.bindUniformBufferBase=function(K,b,e){this._gl.bindBufferBase(this._gl.UNIFORM_BUFFER,b,K?K.underlyingResource:null)},j.ThinEngine.prototype.bindUniformBlock=function(K,b,e){const z=K.program,k=this._gl.getUniformBlockIndex(z,b);4294967295!==k&&this._gl.uniformBlockBinding(z,k,e)};var Q=e(10693),G=e(10750);G.e.prototype.displayLoadingUI=function(){if(!(0,Q.k)())return;const K=this.loadingScreen;K&&K.displayLoadingUI()},G.e.prototype.hideLoadingUI=function(){if(!(0,Q.k)())return;const K=this._loadingScreen;K&&K.hideLoadingUI()},Object.defineProperty(G.e.prototype,"loadingScreen",{get:function(){return!this._loadingScreen&&this._renderingCanvas&&(this._loadingScreen=G.e.DefaultLoadingScreenFactory(this._renderingCanvas)),this._loadingScreen},set:function(K){this._loadingScreen=K},enumerable:!0,configurable:!0}),Object.defineProperty(G.e.prototype,"loadingUIText",{set:function(K){this.loadingScreen.loadingUIText=K},enumerable:!0,configurable:!0}),Object.defineProperty(G.e.prototype,"loadingUIBackgroundColor",{set:function(K){this.loadingScreen.loadingUIBackgroundColor=K},enumerable:!0,configurable:!0}),G.e.prototype.getInputElement=function(){return this._renderingCanvas},G.e.prototype.getRenderingCanvasClientRect=function(){return this._renderingCanvas?this._renderingCanvas.getBoundingClientRect():null},G.e.prototype.getInputElementClientRect=function(){return this._renderingCanvas?this.getInputElement().getBoundingClientRect():null},G.e.prototype.getAspectRatio=function(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=K.viewport;return this.getRenderWidth(b)*e.width/(this.getRenderHeight(b)*e.height)},G.e.prototype.getScreenAspectRatio=function(){return this.getRenderWidth(!0)/this.getRenderHeight(!0)},G.e.prototype._verifyPointerLock=function(){var K;null===(K=this._onPointerLockChange)||void 0===K||K.call(this)},G.e.prototype.setAlphaEquation=function(K){if(this._alphaEquation!==K){switch(K){case 0:this._alphaState.setAlphaEquationParameters(32774,32774);break;case 1:this._alphaState.setAlphaEquationParameters(32778,32778);break;case 2:this._alphaState.setAlphaEquationParameters(32779,32779);break;case 3:this._alphaState.setAlphaEquationParameters(32776,32776);break;case 4:this._alphaState.setAlphaEquationParameters(32775,32775);break;case 5:this._alphaState.setAlphaEquationParameters(32775,32774)}this._alphaEquation=K}},G.e.prototype.getInputElement=function(){return this._renderingCanvas},G.e.prototype.getDepthFunction=function(){return this._depthCullingState.depthFunc},G.e.prototype.setDepthFunction=function(K){this._depthCullingState.depthFunc=K},G.e.prototype.setDepthFunctionToGreater=function(){this.setDepthFunction(516)},G.e.prototype.setDepthFunctionToGreaterOrEqual=function(){this.setDepthFunction(518)},G.e.prototype.setDepthFunctionToLess=function(){this.setDepthFunction(513)},G.e.prototype.setDepthFunctionToLessOrEqual=function(){this.setDepthFunction(515)},G.e.prototype.getDepthWrite=function(){return this._depthCullingState.depthMask},G.e.prototype.setDepthWrite=function(K){this._depthCullingState.depthMask=K},G.e.prototype.getStencilBuffer=function(){return this._stencilState.stencilTest},G.e.prototype.setStencilBuffer=function(K){this._stencilState.stencilTest=K},G.e.prototype.getStencilMask=function(){return this._stencilState.stencilMask},G.e.prototype.setStencilMask=function(K){this._stencilState.stencilMask=K},G.e.prototype.getStencilFunction=function(){return this._stencilState.stencilFunc},G.e.prototype.getStencilFunctionReference=function(){return this._stencilState.stencilFuncRef},G.e.prototype.getStencilFunctionMask=function(){return this._stencilState.stencilFuncMask},G.e.prototype.setStencilFunction=function(K){this._stencilState.stencilFunc=K},G.e.prototype.setStencilFunctionReference=function(K){this._stencilState.stencilFuncRef=K},G.e.prototype.setStencilFunctionMask=function(K){this._stencilState.stencilFuncMask=K},G.e.prototype.getStencilOperationFail=function(){return this._stencilState.stencilOpStencilFail},G.e.prototype.getStencilOperationDepthFail=function(){return this._stencilState.stencilOpDepthFail},G.e.prototype.getStencilOperationPass=function(){return this._stencilState.stencilOpStencilDepthPass},G.e.prototype.setStencilOperationFail=function(K){this._stencilState.stencilOpStencilFail=K},G.e.prototype.setStencilOperationDepthFail=function(K){this._stencilState.stencilOpDepthFail=K},G.e.prototype.setStencilOperationPass=function(K){this._stencilState.stencilOpStencilDepthPass=K},G.e.prototype.cacheStencilState=function(){this._cachedStencilBuffer=this.getStencilBuffer(),this._cachedStencilFunction=this.getStencilFunction(),this._cachedStencilMask=this.getStencilMask(),this._cachedStencilOperationPass=this.getStencilOperationPass(),this._cachedStencilOperationFail=this.getStencilOperationFail(),this._cachedStencilOperationDepthFail=this.getStencilOperationDepthFail(),this._cachedStencilReference=this.getStencilFunctionReference()},G.e.prototype.restoreStencilState=function(){this.setStencilFunction(this._cachedStencilFunction),this.setStencilMask(this._cachedStencilMask),this.setStencilBuffer(this._cachedStencilBuffer),this.setStencilOperationPass(this._cachedStencilOperationPass),this.setStencilOperationFail(this._cachedStencilOperationFail),this.setStencilOperationDepthFail(this._cachedStencilOperationDepthFail),this.setStencilFunctionReference(this._cachedStencilReference)},G.e.prototype.setAlphaConstants=function(K,b,e,z){this._alphaState.setAlphaBlendConstants(K,b,e,z)},G.e.prototype.getAlphaMode=function(){return this._alphaMode},G.e.prototype.getAlphaEquation=function(){return this._alphaEquation},G.e.prototype.getRenderPassNames=function(){return this._renderPassNames},G.e.prototype.getCurrentRenderPassName=function(){return this._renderPassNames[this.currentRenderPassId]},G.e.prototype.createRenderPassId=function(K){const b=++G.e._RenderPassIdCounter;return this._renderPassNames[b]=K??"NONAME",b},G.e.prototype.releaseRenderPassId=function(K){this._renderPassNames[K]=void 0;for(let b=0;b<this.scenes.length;++b){const e=this.scenes[b];for(let b=0;b<e.meshes.length;++b){const z=e.meshes[b];if(z.Rf)for(let b=0;b<z.Rf.length;++b){z.Rf[b]._removeDrawWrapper(K)}}}};e(11473);function i(K){if(K.requestPointerLock){const b=K.requestPointerLock();b instanceof Promise?b.then((()=>{K.focus()})).catch((()=>{})):K.focus()}}var S=e(10810);e(11533);class M extends j.ThinEngine{static get NpmPackage(){return G.e.NpmPackage}static get Version(){return G.e.Version}static get Instances(){return k.b.Instances}static get LastCreatedEngine(){return k.b.LastCreatedEngine}static get LastCreatedScene(){return k.b.LastCreatedScene}static DefaultLoadingScreenFactory(K){return G.e.DefaultLoadingScreenFactory(K)}get _supportsHardwareTextureRescaling(){return!!M._RescalePostProcessFactory}_measureFps(){this._performanceMonitor.sampleFrame(),this._fps=this._performanceMonitor.averageFPS,this._deltaTime=this._performanceMonitor.instantaneousFrameTime||0}get performanceMonitor(){return this._performanceMonitor}constructor(K,b,e){if(super(K,b,e,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this.customAnimationFrameRequester=null,this._performanceMonitor=new F,this._drawCalls=new S.e,K&&(this._features.supportRenderPasses=!0,e=this._creationOptions,K.getContext)){const b=K;this._sharedInit(b)}}_initGLContext(){super._initGLContext(),this._rescalePostProcess=null}_sharedInit(K){super._sharedInit(K),function(K,b,e){K._onCanvasFocus=()=>{K.onCanvasFocusObservable.notifyObservers(K)},K._onCanvasBlur=()=>{K.onCanvasBlurObservable.notifyObservers(K)},K._onCanvasContextMenu=b=>{K.disableContextMenu&&b.preventDefault()},b.addEventListener("focus",K._onCanvasFocus),b.addEventListener("blur",K._onCanvasBlur),b.addEventListener("contextmenu",K._onCanvasContextMenu),K._onBlur=()=>{K.disablePerformanceMonitorInBackground&&K.performanceMonitor.disable(),K._windowIsBackground=!0},K._onFocus=()=>{K.disablePerformanceMonitorInBackground&&K.performanceMonitor.enable(),K._windowIsBackground=!1},K._onCanvasPointerOut=e=>{document.elementFromPoint(e.clientX,e.clientY)!==b&&K.onCanvasPointerOutObservable.notifyObservers(e)};const z=K.getHostWindow();z&&"function"===typeof z.addEventListener&&(z.addEventListener("blur",K._onBlur),z.addEventListener("focus",K._onFocus)),b.addEventListener("pointerout",K._onCanvasPointerOut),e.doNotHandleTouchAction||function(K){K&&K.setAttribute&&(K.setAttribute("touch-action","none"),K.style.touchAction="none",K.style.webkitTapHighlightColor="transparent")}(b),!G.e.audioEngine&&e.audioEngine&&G.e.AudioEngineFactory&&(G.e.audioEngine=G.e.AudioEngineFactory(K.getRenderingCanvas(),K.getAudioContext(),K.getAudioDestination())),(0,Q.d)()&&(K._onFullscreenChange=()=>{K.isFullscreen=!!document.fullscreenElement,K.isFullscreen&&K._pointerLockRequested&&b&&i(b)},document.addEventListener("fullscreenchange",K._onFullscreenChange,!1),document.addEventListener("webkitfullscreenchange",K._onFullscreenChange,!1),K._onPointerLockChange=()=>{K.isPointerLock=document.pointerLockElement===b},document.addEventListener("pointerlockchange",K._onPointerLockChange,!1),document.addEventListener("webkitpointerlockchange",K._onPointerLockChange,!1)),K.enableOfflineSupport=void 0!==G.e.OfflineProviderFactory,K._deterministicLockstep=!!e.deterministicLockstep,K._lockstepMaxSteps=e.lockstepMaxSteps||0,K._timeStep=e.timeStep||1/60}(this,K,this._creationOptions)}resizeImageBitmap(K,b,e){return function(K,b,e,z){const k=K.createCanvas(e,z).getContext("2d");if(!k)throw new Error("Unable to get 2d context for resizeImageBitmap");return k.drawImage(b,0,0),k.getImageData(0,0,e,z).data}(this,K,b,e)}_createImageBitmapFromSource(K,b){return function(K,b,e){return new Promise(((z,k)=>{const j=new Image;j.onload=()=>{j.decode().then((()=>{K.createImageBitmap(j,e).then((K=>{z(K)}))}))},j.onerror=()=>{k(`Error loading image ${j.src}`)},j.src=b}))}(this,K,b)}switchFullscreen(K){this.isFullscreen?this.exitFullscreen():this.enterFullscreen(K)}enterFullscreen(K){this.isFullscreen||(this._pointerLockRequested=K,this._renderingCanvas&&function(K){const b=K.requestFullscreen||K.webkitRequestFullscreen;b&&b.call(K)}(this._renderingCanvas))}exitFullscreen(){this.isFullscreen&&function(){const K=document;document.exitFullscreen?document.exitFullscreen():K.webkitCancelFullScreen&&K.webkitCancelFullScreen()}()}setDitheringState(K){K?this._gl.enable(this._gl.DITHER):this._gl.disable(this._gl.DITHER)}setRasterizerState(K){K?this._gl.disable(this._gl.RASTERIZER_DISCARD):this._gl.enable(this._gl.RASTERIZER_DISCARD)}setDirectViewport(K,b,e,z){const k=this._cachedViewport;return this._cachedViewport=null,this._viewport(K,b,e,z),k}scissorClear(K,b,e,z,k){this.enableScissor(K,b,e,z),this.clear(k,!0,!0,!0),this.disableScissor()}enableScissor(K,b,e,z){const k=this._gl;k.enable(k.SCISSOR_TEST),k.scissor(K,b,e,z)}disableScissor(){const K=this._gl;K.disable(K.SCISSOR_TEST)}_loadFileAsync(K,b,e){return new Promise(((z,k)=>{this._loadFile(K,(K=>{z(K)}),void 0,b,e,((K,b)=>{k(b)}))}))}getVertexShaderSource(K){const b=this._gl.getAttachedShaders(K);return b?this._gl.getShaderSource(b[0]):null}getFragmentShaderSource(K){const b=this._gl.getAttachedShaders(K);return b?this._gl.getShaderSource(b[1]):null}set framebufferDimensionsObject(K){this._framebufferDimensionsObject=K,this._framebufferDimensionsObject&&this.onResizeObservable.notifyObservers(this)}_rebuildBuffers(){for(const K of this.scenes)K.resetCachedMaterial(),K._rebuildGeometries();for(const K of this._virtualScenes)K.resetCachedMaterial(),K._rebuildGeometries();super._rebuildBuffers()}getFontOffset(K){return function(K){const b=document.createElement("span");b.textContent="Hg",b.style.font=K;const e=document.createElement("div");e.style.display="inline-block",e.style.width="1px",e.style.height="0px",e.style.verticalAlign="bottom";const z=document.createElement("div");z.style.whiteSpace="nowrap",z.appendChild(b),z.appendChild(e),document.body.appendChild(z);let k=0,j=0;try{j=e.getBoundingClientRect().top-b.getBoundingClientRect().top,e.style.verticalAlign="baseline",k=e.getBoundingClientRect().top-b.getBoundingClientRect().top}finally{document.body.removeChild(z)}return{ascent:k,height:j,descent:j-k}}(K)}_cancelFrame(){if(this.customAnimationFrameRequester){if(0!==this._frameHandler){this._frameHandler=0;const{cancelAnimationFrame:K}=this.customAnimationFrameRequester;K&&K(this.customAnimationFrameRequester.v)}}else super._cancelFrame()}_renderLoop(){if(this._frameHandler=0,!this._contextWasLost){let K=!0;(this.u||!this.renderEvenInBackground&&this._windowIsBackground)&&(K=!1),K&&(this.Pi(),this._renderViews()||this._renderFrame(),this.Qi())}this._activeRenderLoops.length>0&&0===this._frameHandler&&(this.customAnimationFrameRequester?(this.customAnimationFrameRequester.v=this._queueNewFrame(this.customAnimationFrameRequester.renderFunction||this._boundRenderFunction,this.customAnimationFrameRequester),this._frameHandler=this.customAnimationFrameRequester.v):this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()))}enterPointerlock(){this._renderingCanvas&&i(this._renderingCanvas)}exitPointerlock(){document.exitPointerLock&&document.exitPointerLock()}Pi(){this._measureFps(),super.Pi()}_deletePipelineContext(K){const b=K;b&&b.program&&b.transformFeedback&&(this.deleteTransformFeedback(b.transformFeedback),b.transformFeedback=null),super._deletePipelineContext(K)}createShaderProgram(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;k=k||this._gl,this.onBeforeShaderCompilationObservable.notifyObservers(this);const T=super.createShaderProgram(K,b,e,z,k,j);return this.onAfterShaderCompilationObservable.notifyObservers(this),T}_createShaderProgram(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const j=z.createProgram();if(K.program=j,!j)throw new Error("Unable to create program");if(z.attachShader(j,b),z.attachShader(j,e),this.webGLVersion>1&&k){const b=this.createTransformFeedback();this.bindTransformFeedback(b),this.setTranformFeedbackVaryings(j,k),K.transformFeedback=b}return z.linkProgram(j),this.webGLVersion>1&&k&&this.bindTransformFeedback(null),K.context=z,K.vertexShader=b,K.fragmentShader=e,K.isParallelCompiled||this._finalizePipelineContext(K),j}_releaseTexture(K){super._releaseTexture(K)}_releaseRenderTargetWrapper(K){super._releaseRenderTargetWrapper(K),this.scenes.forEach((b=>{b.postProcesses.forEach((b=>{b._outputTexture===K&&(b._outputTexture=null)})),b.cameras.forEach((b=>{b._postProcesses.forEach((b=>{b&&b._outputTexture===K&&(b._outputTexture=null)}))}))}))}_rescaleTexture(K,b,e,z,k){this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MAG_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_MIN_FILTER,this._gl.LINEAR),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_S,this._gl.CLAMP_TO_EDGE),this._gl.texParameteri(this._gl.TEXTURE_2D,this._gl.TEXTURE_WRAP_T,this._gl.CLAMP_TO_EDGE);const j=this.createRenderTargetTexture({width:b.width,height:b.height},{generateMipMaps:!1,type:0,samplingMode:2,generateDepthBuffer:!1,generateStencilBuffer:!1});if(!this._rescalePostProcess&&M._RescalePostProcessFactory&&(this._rescalePostProcess=M._RescalePostProcessFactory(this)),this._rescalePostProcess){this._rescalePostProcess.externalTextureSamplerBinding=!0;const T=()=>{this._rescalePostProcess.onApply=function(b){b._bindTexture("textureSampler",K)};let T=e;T||(T=this.scenes[this.scenes.length-1]),T.postProcessManager.directRender([this._rescalePostProcess],j,!0),this._bindTextureDirectly(this._gl.TEXTURE_2D,b,!0),this._gl.copyTexImage2D(this._gl.TEXTURE_2D,0,z,0,0,b.width,b.height,0),this.unBindFramebuffer(j),j.dispose(),k&&k()},F=this._rescalePostProcess.getEffect();F?F.executeWhenCompiled(T):this._rescalePostProcess.onEffectCreatedObservable.addOnce((K=>{K.executeWhenCompiled(T)}))}}wrapWebGLTexture(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const T=new X.c(K,this._gl),F=new z.e(this,0,!0);return F._hardwareTexture=T,F.baseWidth=k,F.baseHeight=j,F.width=k,F.height=j,F.isReady=!0,F.useMipMaps=b,this.updateTextureSamplingMode(e,F),F}_uploadImageToTexture(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const k=this._gl,j=this._getWebGLTextureType(K.type),T=this._getInternalFormat(K.format),F=this._getRGBABufferInternalSizedFormat(K.type,T),l=K.isCube?k.TEXTURE_CUBE_MAP:k.TEXTURE_2D;this._bindTextureDirectly(l,K,!0),this._unpackFlipY(K.invertY);let Y=k.TEXTURE_2D;K.isCube&&(Y=k.TEXTURE_CUBE_MAP_POSITIVE_X+e),k.texImage2D(Y,z,F,T,j,b),this._bindTextureDirectly(l,null,!0)}updateTextureComparisonFunction(K,b){if(1===this.webGLVersion)return void A.b.Error("WebGL 1 does not support texture comparison.");const e=this._gl;K.isCube?(this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,K,!0),0===b?(e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,515),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,e.NONE)):(e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_FUNC,b),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null)):(this._bindTextureDirectly(this._gl.TEXTURE_2D,K,!0),0===b?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_COMPARE_FUNC,515),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_COMPARE_MODE,e.NONE)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_COMPARE_FUNC,b),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_COMPARE_MODE,e.COMPARE_REF_TO_TEXTURE)),this._bindTextureDirectly(this._gl.TEXTURE_2D,null)),K._comparisonFunction=b}createInstancesBuffer(K){const b=this._gl.createBuffer();if(!b)throw new Error("Unable to create instance buffer");const e=new Y.b(b);return e.kb=K,this.bindArrayBuffer(e),this._gl.bufferData(this._gl.ARRAY_BUFFER,K,this._gl.DYNAMIC_DRAW),e.references=1,e}deleteInstancesBuffer(K){this._gl.deleteBuffer(K)}_clientWaitAsync(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;const z=this._gl;return new Promise(((k,j)=>{const T=()=>{const F=z.clientWaitSync(K,b,0);F!=z.WAIT_FAILED?F!=z.TIMEOUT_EXPIRED?k():setTimeout(T,e):j()};T()}))}_readPixelsAsync(K,b,e,z,k,j,T){if(this._webGLVersion<2)throw new Error("_readPixelsAsync only work on WebGL2+");const F=this._gl,l=F.createBuffer();F.bindBuffer(F.PIXEL_PACK_BUFFER,l),F.bufferData(F.PIXEL_PACK_BUFFER,T.byteLength,F.STREAM_READ),F.readPixels(K,b,e,z,k,j,0),F.bindBuffer(F.PIXEL_PACK_BUFFER,null);const Y=F.fenceSync(F.SYNC_GPU_COMMANDS_COMPLETE,0);return Y?(F.flush(),this._clientWaitAsync(Y,0,10).then((()=>(F.deleteSync(Y),F.bindBuffer(F.PIXEL_PACK_BUFFER,l),F.getBufferSubData(F.PIXEL_PACK_BUFFER,0,T),F.bindBuffer(F.PIXEL_PACK_BUFFER,null),F.deleteBuffer(l),T)))):null}dispose(){this.hideLoadingUI(),this._rescalePostProcess&&this._rescalePostProcess.dispose(),function(K,b){1===k.b.Instances.length&&G.e.audioEngine&&(G.e.audioEngine.dispose(),G.e.audioEngine=null);const e=K.getHostWindow();e&&"function"===typeof e.removeEventListener&&(e.removeEventListener("blur",K._onBlur),e.removeEventListener("focus",K._onFocus)),b&&(b.removeEventListener("focus",K._onCanvasFocus),b.removeEventListener("blur",K._onCanvasBlur),b.removeEventListener("pointerout",K._onCanvasPointerOut),b.removeEventListener("contextmenu",K._onCanvasContextMenu)),(0,Q.d)()&&(document.removeEventListener("fullscreenchange",K._onFullscreenChange),document.removeEventListener("mozfullscreenchange",K._onFullscreenChange),document.removeEventListener("webkitfullscreenchange",K._onFullscreenChange),document.removeEventListener("msfullscreenchange",K._onFullscreenChange),document.removeEventListener("pointerlockchange",K._onPointerLockChange),document.removeEventListener("mspointerlockchange",K._onPointerLockChange),document.removeEventListener("mozpointerlockchange",K._onPointerLockChange),document.removeEventListener("webkitpointerlockchange",K._onPointerLockChange))}(this,this._renderingCanvas),super.dispose()}}M.ALPHA_DISABLE=0,M.ALPHA_ADD=1,M.ALPHA_COMBINE=2,M.ALPHA_SUBTRACT=3,M.ALPHA_MULTIPLY=4,M.ALPHA_MAXIMIZED=5,M.ALPHA_ONEONE=6,M.ALPHA_PREMULTIPLIED=7,M.ALPHA_PREMULTIPLIED_PORTERDUFF=8,M.ALPHA_INTERPOLATE=9,M.ALPHA_SCREENMODE=10,M.DELAYLOADSTATE_NONE=0,M.DELAYLOADSTATE_LOADED=1,M.DELAYLOADSTATE_LOADING=2,M.DELAYLOADSTATE_NOTLOADED=4,M.NEVER=512,M.ALWAYS=519,M.LESS=513,M.EQUAL=514,M.LEQUAL=515,M.GREATER=516,M.GEQUAL=518,M.NOTEQUAL=517,M.KEEP=7680,M.REPLACE=7681,M.INCR=7682,M.DECR=7683,M.INVERT=5386,M.INCR_WRAP=34055,M.DECR_WRAP=34056,M.TEXTURE_CLAMP_ADDRESSMODE=0,M.TEXTURE_WRAP_ADDRESSMODE=1,M.TEXTURE_MIRROR_ADDRESSMODE=2,M.TEXTUREFORMAT_ALPHA=0,M.TEXTUREFORMAT_LUMINANCE=1,M.TEXTUREFORMAT_LUMINANCE_ALPHA=2,M.TEXTUREFORMAT_RGB=4,M.TEXTUREFORMAT_RGBA=5,M.TEXTUREFORMAT_RED=6,M.TEXTUREFORMAT_R=6,M.TEXTUREFORMAT_RG=7,M.TEXTUREFORMAT_RED_INTEGER=8,M.TEXTUREFORMAT_R_INTEGER=8,M.TEXTUREFORMAT_RG_INTEGER=9,M.TEXTUREFORMAT_RGB_INTEGER=10,M.TEXTUREFORMAT_RGBA_INTEGER=11,M.TEXTURETYPE_UNSIGNED_BYTE=0,M.TEXTURETYPE_UNSIGNED_INT=0,M.TEXTURETYPE_FLOAT=1,M.TEXTURETYPE_HALF_FLOAT=2,M.TEXTURETYPE_BYTE=3,M.TEXTURETYPE_SHORT=4,M.TEXTURETYPE_UNSIGNED_SHORT=5,M.TEXTURETYPE_INT=6,M.TEXTURETYPE_UNSIGNED_INTEGER=7,M.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,M.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,M.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,M.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,M.TEXTURETYPE_UNSIGNED_INT_24_8=12,M.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,M.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,M.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,M.TEXTURE_NEAREST_SAMPLINGMODE=1,M.TEXTURE_BILINEAR_SAMPLINGMODE=2,M.TEXTURE_TRILINEAR_SAMPLINGMODE=3,M.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,M.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,M.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,M.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,M.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,M.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,M.TEXTURE_NEAREST_LINEAR=7,M.TEXTURE_NEAREST_NEAREST=1,M.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,M.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,M.TEXTURE_LINEAR_LINEAR=2,M.TEXTURE_LINEAR_NEAREST=12,M.TEXTURE_EXPLICIT_MODE=0,M.TEXTURE_SPHERICAL_MODE=1,M.TEXTURE_PLANAR_MODE=2,M.TEXTURE_CUBIC_MODE=3,M.TEXTURE_PROJECTION_MODE=4,M.TEXTURE_SKYBOX_MODE=5,M.TEXTURE_INVCUBIC_MODE=6,M.TEXTURE_EQUIRECTANGULAR_MODE=7,M.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,M.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,M.SCALEMODE_FLOOR=1,M.SCALEMODE_NEAREST=2,M.SCALEMODE_CEILING=3},10720:(K,b,e)=>{"use strict";e.d(b,{b:()=>k});var z=e(10690);class k{static get LastCreatedEngine(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]}static get LastCreatedScene(){return this._LastCreatedScene}}k.Instances=[],k.OnEnginesDisposedObservable=new z.d,k._LastCreatedScene=null,k.UseFallbackTexture=!0,k.FallbackTexture=""},12419:(K,b,e)=>{"use strict";e(10696);var z=e(11455);e(10780),e(11033),e(10778),e(11465),e(11422);z.e},10778:(K,b,e)=>{"use strict";e.d(b,{e:()=>z});class z{static SetMatrixPrecision(K){if(z.MatrixTrackPrecisionChange=!1,K&&!z.MatrixUse64Bits&&z.MatrixTrackedMatrices)for(let b=0;b<z.MatrixTrackedMatrices.length;++b){const K=z.MatrixTrackedMatrices[b],e=K.yj;K.yj=new Array(16);for(let b=0;b<16;++b)K.yj[b]=e[b]}z.MatrixUse64Bits=K,z.MatrixCurrentType=z.MatrixUse64Bits?Array:Float32Array,z.MatrixTrackedMatrices=null}}z.MatrixUse64Bits=!1,z.MatrixTrackPrecisionChange=!0,z.MatrixCurrentType=Float32Array,z.MatrixTrackedMatrices=[]},11465:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{get depthStencilTexture(){return this._depthStencilTexture}get depthStencilTextureWithStencil(){return this._depthStencilTextureWithStencil}get isCube(){return this._isCube}get isMulti(){return this._isMulti}get is2DArray(){return this.layers>0}get is3D(){return this.depth>0}get size(){return this.width}get width(){return this._size.width||this._size}get height(){return this._size.height||this._size}get layers(){return this._size.layers||0}get depth(){return this._size.depth||0}get texture(){var K;return(null===(K=this._textures)||void 0===K?void 0:K[0])??null}get textures(){return this._textures}get faceIndices(){return this._faceIndices}get layerIndices(){return this._layerIndices}getBaseArrayLayer(K){var b,e;if(!this._textures)return-1;const z=this._textures[K],k=(null===(b=this._layerIndices)||void 0===b?void 0:b[K])??0,j=(null===(e=this._faceIndices)||void 0===e?void 0:e[K])??0;return z.isCube?6*k+j:z.is3D?0:k}get samples(){return this._samples}setSamples(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.samples===K&&!e)return K;const z=this._isMulti?this._engine.updateMultipleRenderTargetTextureSampleCount(this,K,b):this._engine.updateRenderTargetTextureSampleCount(this,K);return this._samples=K,z}constructor(K,b,e,z,k){this._textures=null,this._faceIndices=null,this._layerIndices=null,this._samples=1,this._attachments=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._depthStencilTextureWithStencil=!1,this._isMulti=K,this._isCube=b,this._size=e,this._engine=z,this._depthStencilTexture=null,this.label=k}setTextures(K){Array.isArray(K)?this._textures=K:this._textures=K?[K]:null}setTexture(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._textures||(this._textures=[]),this._textures[b]!==K&&(this._textures[b]&&e&&this._textures[b].dispose(),this._textures[b]=K)}setLayerAndFaceIndices(K,b){this._layerIndices=K,this._faceIndices=b}setLayerAndFaceIndex(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;this._layerIndices||(this._layerIndices=[]),this._faceIndices||(this._faceIndices=[]),void 0!==b&&b>=0&&(this._layerIndices[K]=b),void 0!==e&&e>=0&&(this._faceIndices[K]=e)}createDepthStencilTexture(){var K;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,T=arguments.length>5?arguments[5]:void 0;return null===(K=this._depthStencilTexture)||void 0===K||K.dispose(),this._depthStencilTextureWithStencil=z,this._depthStencilTextureLabel=T,this._depthStencilTexture=this._engine.createDepthStencilTexture(this._size,{bilinearFiltering:e,comparisonFunction:b,generateStencil:z,isCube:this._isCube,samples:k,depthTextureFormat:j,label:T},this),this._depthStencilTexture}_shareDepth(K){this.shareDepth(K)}shareDepth(K){this._depthStencilTexture&&(K._depthStencilTexture&&K._depthStencilTexture.dispose(),K._depthStencilTexture=this._depthStencilTexture,K._depthStencilTextureWithStencil=this._depthStencilTextureWithStencil,this._depthStencilTexture.incrementReferences())}_swapAndDie(K){this.texture&&this.texture._swapAndDie(K),this._textures=null,this.dispose(!0)}_cloneRenderTargetWrapper(){let K=null;if(this._isMulti){const b=this.textures;if(b&&b.length>0){let e=!1,z=b.length,k=-1;const j=b[b.length-1]._source;14!==j&&12!==j||(e=!0,k=b[b.length-1].format,z--);const T=[],F=[],l=[],Y=[],A=[],X=[],t=[],U={};for(let K=0;K<z;++K){const e=b[K];T.push(e.samplingMode),F.push(e.type),l.push(e.format);void 0!==U[e.uniqueId]?(Y.push(-1),t.push(0)):(U[e.uniqueId]=K,e.is2DArray?(Y.push(35866),t.push(e.depth)):e.isCube?(Y.push(34067),t.push(0)):e.is3D?(Y.push(32879),t.push(e.depth)):(Y.push(3553),t.push(0))),this._faceIndices&&A.push(this._faceIndices[K]??0),this._layerIndices&&X.push(this._layerIndices[K]??0)}const B={samplingModes:T,generateMipMaps:b[0].generateMipMaps,generateDepthBuffer:this._generateDepthBuffer,generateStencilBuffer:this._generateStencilBuffer,generateDepthTexture:e,depthTextureFormat:k,types:F,formats:l,textureCount:z,targetTypes:Y,faceIndex:A,layerIndex:X,layerCounts:t,label:this.label},u={width:this.width,height:this.height,depth:this.depth};K=this._engine.createMultipleRenderTarget(u,B);for(let m=0;m<z;++m){if(-1!==Y[m])continue;const e=U[b[m].uniqueId];K.setTexture(K.textures[e],m)}}}else{var b,e,z,k;const T={};if(T.generateDepthBuffer=this._generateDepthBuffer,T.generateMipMaps=(null===(b=this.texture)||void 0===b?void 0:b.generateMipMaps)??!1,T.generateStencilBuffer=this._generateStencilBuffer,T.samplingMode=null===(e=this.texture)||void 0===e?void 0:e.samplingMode,T.type=null===(z=this.texture)||void 0===z?void 0:z.type,T.format=null===(k=this.texture)||void 0===k?void 0:k.format,T.noColorAttachment=!this._textures,T.label=this.label,this.isCube)K=this._engine.createRenderTargetCubeTexture(this.width,T);else{var j;const b={width:this.width,height:this.height,layers:this.is2DArray||this.is3D?null===(j=this.texture)||void 0===j?void 0:j.depth:void 0};K=this._engine.createRenderTargetTexture(b,T)}K.texture&&(K.texture.isReady=!0)}return K}_swapRenderTargetWrapper(K){if(this._textures&&K._textures)for(let b=0;b<this._textures.length;++b)this._textures[b]._swapAndDie(K._textures[b],!1),K._textures[b].isReady=!0;this._depthStencilTexture&&K._depthStencilTexture&&(this._depthStencilTexture._swapAndDie(K._depthStencilTexture),K._depthStencilTexture.isReady=!0),this._textures=null,this._depthStencilTexture=null}_rebuild(){const K=this._cloneRenderTargetWrapper();if(K){if(this._depthStencilTexture){const b=this._depthStencilTexture.samplingMode,e=this._depthStencilTexture.format,z=2===b||3===b||11===b;K.createDepthStencilTexture(this._depthStencilTexture._comparisonFunction,z,this._depthStencilTextureWithStencil,this._depthStencilTexture.samples,e,this._depthStencilTextureLabel)}this.samples>1&&K.setSamples(this.samples),K._swapRenderTargetWrapper(this),K.dispose()}}releaseTextures(){if(this._textures)for(let b=0;b<(null===(K=this._textures)||void 0===K?void 0:K.length);++b){var K;this._textures[b].dispose()}this._textures=null}dispose(){var K;arguments.length>0&&void 0!==arguments[0]&&arguments[0]||(null===(K=this._depthStencilTexture)||void 0===K||K.dispose(),this._depthStencilTexture=null,this.releaseTextures());this._engine._releaseRenderTargetWrapper(this)}}},10764:(K,b,e)=>{"use strict";e.d(b,{d:()=>z});class z{static GetShadersRepository(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.ShadersRepository:z.ShadersRepositoryWGSL}static GetShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.ShadersStore:z.ShadersStoreWGSL}static GetIncludesShadersStore(){return 0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)?z.IncludesShadersStore:z.IncludesShadersStoreWGSL}}z.ShadersRepository="src/Shaders/",z.ShadersStore={},z.IncludesShadersStore={},z.ShadersRepositoryWGSL="src/ShadersWGSL/",z.ShadersStoreWGSL={},z.IncludesShadersStoreWGSL={}},10776:(K,b,e)=>{"use strict";e.d(b,{e:()=>t,f:()=>I,j:()=>U,k:()=>B,n:()=>D,r:()=>X,t:()=>Y,v:()=>A,x:()=>l,z:()=>F});class z{constructor(){this._valueCache={},this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null,this._isDisposed=!1}get isAsync(){return this.isParallelCompiled}get isReady(){return!!this.program&&(!this.isParallelCompiled||this.kd._isRenderingStateCompiled(this))}_handlesSpectorRebuildCallback(K){K&&this.program&&K(this.program)}setEngine(K){this.kd=K}_fillEffectInformation(K,b,e,z,k,j,T,F){const l=this.kd;if(l.supportsUniformBuffers)for(const A in b)K.bindUniformBlock(A,b[A]);let Y;for(this.kd.getUniforms(this,e).forEach(((K,b)=>{z[e[b]]=K})),this._uniforms=z,Y=0;Y<k.length;Y++){null==K.getUniform(k[Y])&&(k.splice(Y,1),Y--)}k.forEach(((K,b)=>{j[K]=b}));for(const A of l.getAttributes(this,T))F.push(A)}dispose(){this._uniforms={},this._isDisposed=!0}_cacheMatrix(K,b){const e=this._valueCache[K],z=b.updateFlag;return(void 0===e||e!==z)&&(this._valueCache[K]=z,!0)}_cacheFloat2(K,b,e){let z=this._valueCache[K];if(!z||2!==z.length)return z=[b,e],this._valueCache[K]=z,!0;let k=!1;return z[0]!==b&&(z[0]=b,k=!0),z[1]!==e&&(z[1]=e,k=!0),k}_cacheFloat3(K,b,e,z){let k=this._valueCache[K];if(!k||3!==k.length)return k=[b,e,z],this._valueCache[K]=k,!0;let j=!1;return k[0]!==b&&(k[0]=b,j=!0),k[1]!==e&&(k[1]=e,j=!0),k[2]!==z&&(k[2]=z,j=!0),j}_cacheFloat4(K,b,e,z,k){let j=this._valueCache[K];if(!j||4!==j.length)return j=[b,e,z,k],this._valueCache[K]=j,!0;let T=!1;return j[0]!==b&&(j[0]=b,T=!0),j[1]!==e&&(j[1]=e,T=!0),j[2]!==z&&(j[2]=z,T=!0),j[3]!==k&&(j[3]=k,T=!0),T}setInt(K,b){const e=this._valueCache[K];void 0!==e&&e===b||this.kd.setInt(this._uniforms[K],b)&&(this._valueCache[K]=b)}setInt2(K,b,e){this._cacheFloat2(K,b,e)&&(this.kd.setInt2(this._uniforms[K],b,e)||(this._valueCache[K]=null))}setInt3(K,b,e,z){this._cacheFloat3(K,b,e,z)&&(this.kd.setInt3(this._uniforms[K],b,e,z)||(this._valueCache[K]=null))}setInt4(K,b,e,z,k){this._cacheFloat4(K,b,e,z,k)&&(this.kd.setInt4(this._uniforms[K],b,e,z,k)||(this._valueCache[K]=null))}setIntArray(K,b){this._valueCache[K]=null,this.kd.setIntArray(this._uniforms[K],b)}setIntArray2(K,b){this._valueCache[K]=null,this.kd.setIntArray2(this._uniforms[K],b)}setIntArray3(K,b){this._valueCache[K]=null,this.kd.setIntArray3(this._uniforms[K],b)}setIntArray4(K,b){this._valueCache[K]=null,this.kd.setIntArray4(this._uniforms[K],b)}setUInt(K,b){const e=this._valueCache[K];void 0!==e&&e===b||this.kd.setUInt(this._uniforms[K],b)&&(this._valueCache[K]=b)}setUInt2(K,b,e){this._cacheFloat2(K,b,e)&&(this.kd.setUInt2(this._uniforms[K],b,e)||(this._valueCache[K]=null))}setUInt3(K,b,e,z){this._cacheFloat3(K,b,e,z)&&(this.kd.setUInt3(this._uniforms[K],b,e,z)||(this._valueCache[K]=null))}setUInt4(K,b,e,z,k){this._cacheFloat4(K,b,e,z,k)&&(this.kd.setUInt4(this._uniforms[K],b,e,z,k)||(this._valueCache[K]=null))}setUIntArray(K,b){this._valueCache[K]=null,this.kd.setUIntArray(this._uniforms[K],b)}setUIntArray2(K,b){this._valueCache[K]=null,this.kd.setUIntArray2(this._uniforms[K],b)}setUIntArray3(K,b){this._valueCache[K]=null,this.kd.setUIntArray3(this._uniforms[K],b)}setUIntArray4(K,b){this._valueCache[K]=null,this.kd.setUIntArray4(this._uniforms[K],b)}setArray(K,b){this._valueCache[K]=null,this.kd.setArray(this._uniforms[K],b)}setArray2(K,b){this._valueCache[K]=null,this.kd.setArray2(this._uniforms[K],b)}setArray3(K,b){this._valueCache[K]=null,this.kd.setArray3(this._uniforms[K],b)}setArray4(K,b){this._valueCache[K]=null,this.kd.setArray4(this._uniforms[K],b)}setMatrices(K,b){b&&(this._valueCache[K]=null,this.kd.setMatrices(this._uniforms[K],b))}setMatrix(K,b){this._cacheMatrix(K,b)&&(this.kd.setMatrices(this._uniforms[K],b.Ti())||(this._valueCache[K]=null))}setMatrix3x3(K,b){this._valueCache[K]=null,this.kd.setMatrix3x3(this._uniforms[K],b)}setMatrix2x2(K,b){this._valueCache[K]=null,this.kd.setMatrix2x2(this._uniforms[K],b)}setFloat(K,b){const e=this._valueCache[K];void 0!==e&&e===b||this.kd.setFloat(this._uniforms[K],b)&&(this._valueCache[K]=b)}setVector2(K,b){this._cacheFloat2(K,b.x,b.y)&&(this.kd.setFloat2(this._uniforms[K],b.x,b.y)||(this._valueCache[K]=null))}setFloat2(K,b,e){this._cacheFloat2(K,b,e)&&(this.kd.setFloat2(this._uniforms[K],b,e)||(this._valueCache[K]=null))}setVector3(K,b){this._cacheFloat3(K,b.x,b.y,b.z)&&(this.kd.setFloat3(this._uniforms[K],b.x,b.y,b.z)||(this._valueCache[K]=null))}setFloat3(K,b,e,z){this._cacheFloat3(K,b,e,z)&&(this.kd.setFloat3(this._uniforms[K],b,e,z)||(this._valueCache[K]=null))}setVector4(K,b){this._cacheFloat4(K,b.x,b.y,b.z,b.w)&&(this.kd.setFloat4(this._uniforms[K],b.x,b.y,b.z,b.w)||(this._valueCache[K]=null))}setQuaternion(K,b){this._cacheFloat4(K,b.x,b.y,b.z,b.w)&&(this.kd.setFloat4(this._uniforms[K],b.x,b.y,b.z,b.w)||(this._valueCache[K]=null))}setFloat4(K,b,e,z,k){this._cacheFloat4(K,b,e,z,k)&&(this.kd.setFloat4(this._uniforms[K],b,e,z,k)||(this._valueCache[K]=null))}setColor3(K,b){this._cacheFloat3(K,b.r,b.g,b.b)&&(this.kd.setFloat3(this._uniforms[K],b.r,b.g,b.b)||(this._valueCache[K]=null))}setColor4(K,b,e){this._cacheFloat4(K,b.r,b.g,b.b,e)&&(this.kd.setFloat4(this._uniforms[K],b.r,b.g,b.b,e)||(this._valueCache[K]=null))}setDirectColor4(K,b){this._cacheFloat4(K,b.r,b.g,b.b,b.a)&&(this.kd.setFloat4(this._uniforms[K],b.r,b.g,b.b,b.a)||(this._valueCache[K]=null))}_getVertexShaderCode(){return this.vertexShader?this.kd._getShaderSource(this.vertexShader):null}_getFragmentShaderCode(){return this.fragmentShader?this.kd._getShaderSource(this.fragmentShader):null}}var k=e(10739);const j=new WeakMap,T={_webGLVersion:2,cachedPipelines:{}};function F(K){let b=j.get(K);if(!b){if(!K)return T;b={_webGLVersion:K.TEXTURE_BINDING_3D?2:1,_context:K,cachedPipelines:{}},j.set(K,b)}return b}function l(K){j.delete(K)}function Y(K,b,e,z,k,j){const T=F(z);j||(j=T._createShaderProgramInjection??t);return j(K,m(b,"vertex",z,T._contextWasLost),m(e,"fragment",z,T._contextWasLost),z,k,T.validateShaderPrograms)}function A(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6?arguments[6]:void 0;const l=F(k);T||(T=l._createShaderProgramInjection??t);const Y=l._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"";return T(K,u(b,"vertex",z,Y,k,l._contextWasLost),u(e,"fragment",z,Y,k,l._contextWasLost),k,j,l.validateShaderPrograms)}function X(K,b){const e=new z,k=F(K);return k.parallelShaderCompile&&(e.isParallelCompiled=!0),e.context=k._context,e}function t(K,b,e,z){let k=arguments.length>5?arguments[5]:void 0;const j=z.createProgram();if(K.program=j,!j)throw new Error("Unable to create program");return z.attachShader(j,b),z.attachShader(j,e),z.linkProgram(j),K.context=z,K.vertexShader=b,K.fragmentShader=e,K.isParallelCompiled||U(K,z,k),j}function U(K,b,e){const z=K.context,k=K.vertexShader,j=K.fragmentShader,T=K.program;if(!z.getProgramParameter(T,z.LINK_STATUS)){if(!b.getShaderParameter(k,b.COMPILE_STATUS)){const e=b.getShaderInfoLog(k);if(e)throw K.vertexCompilationError=e,new Error("VERTEX SHADER "+e)}if(!b.getShaderParameter(j,b.COMPILE_STATUS)){const e=b.getShaderInfoLog(j);if(e)throw K.fragmentCompilationError=e,new Error("FRAGMENT SHADER "+e)}const e=z.getProgramInfoLog(T);if(e)throw K.programLinkError=e,new Error(e)}if(e){z.validateProgram(T);if(!z.getProgramParameter(T,z.VALIDATE_STATUS)){const b=z.getProgramInfoLog(T);if(b)throw K.programValidationError=b,new Error(b)}}z.deleteShader(k),z.deleteShader(j),K.vertexShader=void 0,K.fragmentShader=void 0,K.onCompiled&&(K.onCompiled(),K.onCompiled=void 0)}function B(K,b,e,z,k,j,T,l,X){let t=arguments.length>10?arguments[10]:void 0,U=arguments.length>11?arguments[11]:void 0,B=arguments.length>12?arguments[12]:void 0;const u=F(K.context);U||(U=u.createRawShaderProgramInjection??Y),B||(B=u.createShaderProgramInjection??A);const m=K;m.program=z?U(m,b,e,m.context,X):B(m,b,e,l,m.context,X),m.program.__SPECTOR_rebuildProgram=T,t()}function u(K,b,e,z,j,T){return m((0,k.e)(K,e,z),b,j,T)}function m(K,b,e,z){const k=e.createShader("vertex"===b?e.VERTEX_SHADER:e.FRAGMENT_SHADER);if(!k){let K=e.NO_ERROR,k=e.NO_ERROR;for(;(k=e.getError())!==e.NO_ERROR;)K=k;throw new Error(`Something went wrong while creating a gl ${b} shader object. gl error=${K}, gl isContextLost=${e.isContextLost()}, _contextWasLost=${z}`)}return e.shaderSource(k,K),e.compileShader(k),k}function D(K,b){b.useProgram(K)}function I(K,b){const e=K;if(!e.isParallelCompiled)return void b(K);const z=e.onCompiled;e.onCompiled=()=>{null===z||void 0===z||z(),b(K)}}},11415:(K,b,e)=>{"use strict";e.r(b),e.d(b,{ThinEngine:()=>x});var z=e(10776),k=e(11422),j=e(10696),T=e(10693);class F{constructor(){this.shaderLanguage=0}postProcessor(K,b,e,z,k){if(k.drawBuffersExtensionDisabled){const b=/#extension.+GL_EXT_draw_buffers.+(enable|require)/g;K=K.replace(b,"")}return K}}const l=/(flat\s)?\s*varying\s*.*/;class Y{constructor(){this.shaderLanguage=0}attributeProcessor(K){return K.replace("attribute","in")}varyingCheck(K,b){return l.test(K)}varyingProcessor(K,b){return K.replace("varying",b?"in":"out")}postProcessor(K,b,e){const z=-1!==K.search(/#extension.+GL_EXT_draw_buffers.+require/);if(K=(K=K.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),e){const b=-1!==K.search(/layout *\(location *= *0\) *out/g);K=(K=(K=(K=(K=(K=(K=K.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(z||b?"":"layout(location = 0) out vec4 glFragColor;\n")+"void main(")}else{if(-1!==b.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+K}return K}}var A=e(11430),X=e(10803),t=e(10750),U=e(11436),B=e(10780),u=e(10756),m=e(10739),D=e(10771);class I{}class x extends t.e{get name(){return this._name}set name(K){this._name=K}get version(){return this._webGLVersion}static get ShadersRepository(){return u.d.ShadersRepository}static set ShadersRepository(K){u.d.ShadersRepository=K}get supportsUniformBuffers(){return this.webGLVersion>1&&!this.disableUniformBuffers}get needPOTTextures(){return this._webGLVersion<2||this.forcePOTTextures}get _supportsHardwareTextureRescaling(){return!1}set framebufferDimensionsObject(K){this._framebufferDimensionsObject=K}snapshotRenderingReset(){this.snapshotRendering=!1}constructor(K,b,e,k){if(e=e||{},super(b??e.antialias,e,k),this._name="WebGL",this.forcePOTTextures=!1,this.validateShaderPrograms=!1,this.disableUniformBuffers=!1,this._webGLVersion=1,this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._dummyFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._maxMSAASamplesOverride=null,this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._boundUniforms={},!K)return;let T=null;if(K.getContext){if(T=K,this._renderingCanvas=T,void 0===e.Yg&&(e.Yg=!1),void 0===e.xrCompatible&&(e.xrCompatible=!1),navigator&&navigator.userAgent){this._setupMobileChecks();const K=navigator.userAgent;for(const b of x.ExceptionList){const z=b.key,k=b.targets;if(new RegExp(z).test(K)){if(b.capture&&b.captureConstraint){const e=b.capture,z=b.captureConstraint,k=new RegExp(e).exec(K);if(k&&k.length>0){if(parseInt(k[k.length-1])>=z)continue}}for(const K of k)switch(K){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0;break;case"antialias":e.antialias=!1;break;case"maxMSAASamples":this._maxMSAASamplesOverride=1}}}}if(this._doNotHandleContextLost||(this._onContextLost=K=>{K.preventDefault(),this._contextWasLost=!0,j.b.Warn("WebGL context lost."),this.onContextLostObservable.notifyObservers(this)},this._onContextRestored=()=>{this._restoreEngineAfterContextLost((()=>this._initGLContext()))},T.addEventListener("webglcontextlost",this._onContextLost,!1),T.addEventListener("webglcontextrestored",this._onContextRestored,!1),e.powerPreference=e.powerPreference||"high-performance"),this._badDesktopOS&&(e.xrCompatible=!1),!e.disableWebGL2Support)try{this._gl=T.getContext("webgl2",e)||T.getContext("experimental-webgl2",e),this._gl&&(this._webGLVersion=2,this._shaderPlatformName="WEBGL2",this._gl.deleteQuery||(this._webGLVersion=1,this._shaderPlatformName="WEBGL1"))}catch(X){}if(!this._gl){if(!T)throw new Error("The provided canvas is null or undefined.");try{this._gl=T.getContext("webgl",e)||T.getContext("experimental-webgl",e)}catch(X){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=K,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample?(this._webGLVersion=2,this._shaderPlatformName="WEBGL2"):this._shaderPlatformName="WEBGL1";const b=this._gl.getContextAttributes();b&&(e.stencil=b.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==e.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=e.useHighPrecisionFloats),this.resize(),this._initGLContext(),this._initFeatures();for(let z=0;z<this._caps.maxVertexAttribs;z++)this._currentBufferPointers[z]=new I;this._shaderProcessor=this.webGLVersion>1?new Y:new F;const l=`Babylon.js v${x.Version}`;j.b.Log(l+` - ${this.description}`),this._renderingCanvas&&this._renderingCanvas.setAttribute&&this._renderingCanvas.setAttribute("data-engine",l);const A=(0,z.z)(this._gl);A.validateShaderPrograms=this.validateShaderPrograms,A.parallelShaderCompile=this._caps.parallelShaderCompile}_clearEmptyResources(){this._dummyFramebuffer=null,super._clearEmptyResources()}_getShaderProcessingContext(K){return null}areAllEffectsReady(){for(const K in this._compiledEffects){if(!this._compiledEffects[K].isReady())return!1}return!0}_initGLContext(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile")||void 0,standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),bptc:this._gl.getExtension("EXT_texture_compression_bptc")||this._gl.getExtension("WEBKIT_EXT_texture_compression_bptc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),s3tc_srgb:this._gl.getExtension("WEBGL_compressed_texture_s3tc_srgb")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc_srgb"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),supportOcclusionQuery:this._webGLVersion>1,canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float")),supportFloatTexturesResolve:!1,rg11b10ufColorRenderable:!1,colorBufferHalfFloat:!!(this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_half_float")),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),texelFetch:1!==this._webGLVersion,blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1,canUseGLInstanceID:this._webGLVersion>1,canUseGLVertexID:this._webGLVersion>1,supportComputeShaders:!1,supportSRGBBuffers:!1,supportTransformFeedbacks:this._webGLVersion>1,textureMaxLevel:this._webGLVersion>1,texture2DArrayMaxLayerCount:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_ARRAY_TEXTURE_LAYERS):128,disableMorphTargetTexture:!1},this._caps.supportFloatTexturesResolve=this._caps.colorBufferFloat,this._caps.rg11b10ufColorRenderable=this._caps.colorBufferFloat,this._glVersion=this._gl.getParameter(this._gl.VERSION);const K=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=K&&(this._glRenderer=this._gl.getParameter(K.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(K.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor=this._gl.getParameter(this._gl.VENDOR)||"Unknown vendor"),this._glRenderer||(this._glRenderer=this._gl.getParameter(this._gl.RENDERER)||"Unknown renderer"),36193!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=36193),34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=(this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)??0)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._caps.astc&&(this._gl.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=this._caps.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR),this._caps.bptc&&(this._gl.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=this._caps.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT),this._caps.s3tc_srgb&&(this._gl.COMPRESSED_SRGB_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,this._gl.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=this._caps.s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT),this._caps.etc2&&(this._gl.COMPRESSED_SRGB8_ETC2=this._caps.etc2.COMPRESSED_SRGB8_ETC2,this._gl.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=this._caps.etc2.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC),this._webGLVersion>1&&5131!==this._gl.HALF_FLOAT_OES&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=null!==this._maxMSAASamplesOverride?this._maxMSAASamplesOverride:this._gl.getParameter(this._gl.MAX_SAMPLES),this._caps.maxDrawBuffers=this._gl.getParameter(this._gl.MAX_DRAW_BUFFERS);else{const K=this._gl.getExtension("WEBGL_draw_buffers");if(null!==K){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=K.drawBuffersWEBGL.bind(K),this._caps.maxDrawBuffers=this._gl.getParameter(K.MAX_DRAW_BUFFERS_WEBGL),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(let b=0;b<16;b++)this._gl["COLOR_ATTACHMENT"+b+"_WEBGL"]=K["COLOR_ATTACHMENT"+b+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{const K=this._gl.getExtension("WEBGL_depth_texture");null!=K&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=K.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{const K=this._gl.getExtension("OES_vertex_array_object");null!=K&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=K.createVertexArrayOES.bind(K),this._gl.bindVertexArray=K.bindVertexArrayOES.bind(K),this._gl.deleteVertexArray=K.deleteVertexArrayOES.bind(K))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{const K=this._gl.getExtension("ANGLE_instanced_arrays");null!=K?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=K.drawArraysInstancedANGLE.bind(K),this._gl.drawElementsInstanced=K.drawElementsInstancedANGLE.bind(K),this._gl.vertexAttribDivisor=K.vertexAttribDivisorANGLE.bind(K)):this._caps.instancedArrays=!1}if(this._gl.getShaderPrecisionFormat){const K=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),b=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);K&&b&&(this._caps.highPrecisionShaderSupported=0!==K.precision&&0!==b.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{const K=this._gl.getExtension("EXT_blend_minmax");null!=K&&(this._caps.blendMinMax=!0,this._gl.MAX=K.MAX_EXT,this._gl.MIN=K.MIN_EXT)}if(!this._caps.supportSRGBBuffers){if(this._webGLVersion>1)this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:WebGL2RenderingContext.SRGB,SRGB8:WebGL2RenderingContext.SRGB8,SRGB8_ALPHA8:WebGL2RenderingContext.SRGB8_ALPHA8};else{const K=this._gl.getExtension("EXT_sRGB");null!=K&&(this._caps.supportSRGBBuffers=!0,this._glSRGBExtensionValues={SRGB:K.SRGB_EXT,SRGB8:K.SRGB_ALPHA_EXT,SRGB8_ALPHA8:K.SRGB_ALPHA_EXT})}if(this._creationOptions){const K=this._creationOptions.forceSRGBBufferSupportState;void 0!==K&&(this._caps.supportSRGBBuffers=this._caps.supportSRGBBuffers&&K)}}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(let b=0;b<this._maxSimultaneousTextures;b++)this._nextFreeTextureSlots.push(b);"Mali-G72"===this._glRenderer&&(this._caps.disableMorphTargetTexture=!0)}_initFeatures(){this._features={forceBitmapOverHTMLImageElement:"undefined"===typeof HTMLImageElement,supportRenderAndCopyToLodForFloatTextures:1!==this._webGLVersion,supportDepthStencilTexture:1!==this._webGLVersion,supportShadowSamplers:1!==this._webGLVersion,uniformBufferHardCheckMatrix:!1,allowTexturePrefiltering:1!==this._webGLVersion,trackUbosInFrame:!1,checkUbosContentBeforeUpload:!1,supportCSM:1!==this._webGLVersion,basisNeedsPOT:1===this._webGLVersion,support3DTextures:1!==this._webGLVersion,needTypeSuffixInShaderConstants:1!==this._webGLVersion,supportMSAA:1!==this._webGLVersion,supportSSAO2:1!==this._webGLVersion,supportIBLShadows:1!==this._webGLVersion,supportExtendedTextureFormats:1!==this._webGLVersion,supportSwitchCaseInShader:1!==this._webGLVersion,supportSyncTextureRead:!0,needsInvertingBitmap:!0,useUBOBindingCache:!0,needShaderCodeInlining:!1,needToAlwaysBindUniformBuffers:!1,supportRenderPasses:!1,supportSpriteInstancing:!0,forceVertexBufferStrideAndOffsetMultiple4Bytes:!1,_checkNonFloatVertexBuffersDontRecreatePipelineContext:!1,_collectUbosUpdatedInFrame:!1}}get webGLVersion(){return this._webGLVersion}getClassName(){return"ThinEngine"}_prepareWorkingCanvas(){if(this._workingCanvas)return;this._workingCanvas=this.createCanvas(1,1);const K=this._workingCanvas.getContext("2d");K&&(this._workingContext=K)}getInfo(){return this.getGlInfo()}getGlInfo(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}}extractDriverInfo(){const K=this.getGlInfo();return K&&K.renderer?K.renderer:""}getRenderWidth(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.width:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferWidth:this._gl.drawingBufferWidth}getRenderHeight(){return!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this._currentRenderTarget?this._currentRenderTarget.height:this._framebufferDimensionsObject?this._framebufferDimensionsObject.framebufferHeight:this._gl.drawingBufferHeight}clear(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=this.stencilStateComposer.useStencilGlobalOnly;this.stencilStateComposer.useStencilGlobalOnly=!0,this.applyStates(),this.stencilStateComposer.useStencilGlobalOnly=k;let j=0;if(b&&K){let b=!0;if(this._currentRenderTarget){var T;const e=null===(T=this._currentRenderTarget.texture)||void 0===T?void 0:T.format;if(8===e||9===e||10===e||11===e){var F;const e=null===(F=this._currentRenderTarget.texture)||void 0===F?void 0:F.type;7===e||5===e?(x._TempClearColorUint32[0]=255*K.r,x._TempClearColorUint32[1]=255*K.g,x._TempClearColorUint32[2]=255*K.b,x._TempClearColorUint32[3]=255*K.a,this._gl.clearBufferuiv(this._gl.COLOR,0,x._TempClearColorUint32),b=!1):(x._TempClearColorInt32[0]=255*K.r,x._TempClearColorInt32[1]=255*K.g,x._TempClearColorInt32[2]=255*K.b,x._TempClearColorInt32[3]=255*K.a,this._gl.clearBufferiv(this._gl.COLOR,0,x._TempClearColorInt32),b=!1)}}b&&(this._gl.clearColor(K.r,K.g,K.b,void 0!==K.a?K.a:1),j|=this._gl.COLOR_BUFFER_BIT)}e&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GEQUAL,this._gl.clearDepth(0)):this._gl.clearDepth(1),j|=this._gl.DEPTH_BUFFER_BIT),z&&(this._gl.clearStencil(0),j|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(j)}_viewport(K,b,e,z){K===this._viewportCached.x&&b===this._viewportCached.y&&e===this._viewportCached.z&&z===this._viewportCached.w||(this._viewportCached.x=K,this._viewportCached.y=b,this._viewportCached.z=e,this._viewportCached.w=z,this._gl.viewport(K,b,e,z))}Qi(){super.Qi(),this._badOS&&this.flushFramebuffer()}get performanceMonitor(){throw new Error("Not Supported by ThinEngine")}bindFramebuffer(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const l=K;this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=K,this._bindUnboundFramebuffer(l._framebuffer);const Y=this._gl;var A;if(!K.isMulti)if(K.is2DArray||K.is3D)Y.framebufferTextureLayer(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,null===(A=K.texture._hardwareTexture)||void 0===A?void 0:A.underlyingResource,T,F),l._currentLOD=T;else if(K.isCube){var X;Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_CUBE_MAP_POSITIVE_X+b,null===(X=K.texture._hardwareTexture)||void 0===X?void 0:X.underlyingResource,T)}else if(l._currentLOD!==T){var t;Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,null===(t=K.texture._hardwareTexture)||void 0===t?void 0:t.underlyingResource,T),l._currentLOD=T}const U=K._depthStencilTexture;if(U){K.is3D&&(K.texture.width===U.width&&K.texture.height===U.height&&K.texture.depth===U.depth||j.b.Warn("Depth/Stencil attachment for 3D target must have same dimensions as color attachment"));const e=K._depthStencilTextureWithStencil?Y.DEPTH_STENCIL_ATTACHMENT:Y.DEPTH_ATTACHMENT;var B;if(K.is2DArray||K.is3D)Y.framebufferTextureLayer(Y.FRAMEBUFFER,e,null===(B=U._hardwareTexture)||void 0===B?void 0:B.underlyingResource,T,F);else if(K.isCube){var u;Y.framebufferTexture2D(Y.FRAMEBUFFER,e,Y.TEXTURE_CUBE_MAP_POSITIVE_X+b,null===(u=U._hardwareTexture)||void 0===u?void 0:u.underlyingResource,T)}else{var m;Y.framebufferTexture2D(Y.FRAMEBUFFER,e,Y.TEXTURE_2D,null===(m=U._hardwareTexture)||void 0===m?void 0:m.underlyingResource,T)}}l._MSAAFramebuffer&&this._bindUnboundFramebuffer(l._MSAAFramebuffer),this._cachedViewport&&!k?this.setViewport(this._cachedViewport,e,z):(e||(e=K.width,T&&(e/=Math.pow(2,T))),z||(z=K.height,T&&(z/=Math.pow(2,T))),this._viewport(0,0,e,z)),this.wipeCaches()}setState(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(this._depthCullingState.cull!==K||e)&&(this._depthCullingState.cull=K);const F=this.cullBackFaces??k??1?this._gl.BACK:this._gl.FRONT;(this._depthCullingState.cullFace!==F||e)&&(this._depthCullingState.cullFace=F),this.setZOffset(b),this.setZOffsetUnits(T);const l=z?this._gl.CW:this._gl.CCW;(this._depthCullingState.frontFace!==l||e)&&(this._depthCullingState.frontFace=l),this._stencilStateComposer.stencilMaterial=j}_bindUnboundFramebuffer(K){this._currentFramebuffer!==K&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,K),this._currentFramebuffer=K)}_currentFrameBufferIsDefaultFrameBuffer(){return null===this._currentFramebuffer}generateMipmaps(K){const b=this._getTextureTarget(K);this._bindTextureDirectly(b,K,!0),this._gl.generateMipmap(b),this._bindTextureDirectly(b,null)}unBindFramebuffer(K){var b;let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],z=arguments.length>2?arguments[2]:void 0;const k=K;this._currentRenderTarget=null;const j=this._gl;if(k._MSAAFramebuffer){if(K.isMulti)return void this.unBindMultiColorAttachmentFramebuffer(K,e,z);j.bindFramebuffer(j.READ_FRAMEBUFFER,k._MSAAFramebuffer),j.bindFramebuffer(j.DRAW_FRAMEBUFFER,k._framebuffer),j.blitFramebuffer(0,0,K.width,K.height,0,0,K.width,K.height,j.COLOR_BUFFER_BIT,j.NEAREST)}null===(b=K.texture)||void 0===b||!b.generateMipMaps||e||K.isCube||this.generateMipmaps(K.texture),z&&(k._MSAAFramebuffer&&this._bindUnboundFramebuffer(k._framebuffer),z()),this._bindUnboundFramebuffer(null)}flushFramebuffer(){this._gl.flush()}restoreDefaultFramebuffer(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()}_resetVertexBufferBinding(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null}createVertexBuffer(K,b,e){return this._createVertexBuffer(K,this._gl.STATIC_DRAW)}_createVertexBuffer(K,b){const e=this._gl.createBuffer();if(!e)throw new Error("Unable to create vertex buffer");const z=new A.b(e);return this.bindArrayBuffer(z),"number"!==typeof K?K instanceof Array?(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(K),b),z.kb=4*K.length):(this._gl.bufferData(this._gl.ARRAY_BUFFER,K,b),z.kb=K.byteLength):(this._gl.bufferData(this._gl.ARRAY_BUFFER,new Uint8Array(K),b),z.kb=K),this._resetVertexBufferBinding(),z.references=1,z}createDynamicVertexBuffer(K,b){return this._createVertexBuffer(K,this._gl.DYNAMIC_DRAW)}_resetIndexBufferBinding(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null}createIndexBuffer(K,b,e){const z=this._gl.createBuffer(),k=new A.b(z);if(!z)throw new Error("Unable to create index buffer");this.bindIndexBuffer(k);const j=this._normalizeIndexData(K);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,j,b?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),k.references=1,k.is32Bits=4===j.BYTES_PER_ELEMENT,k}_normalizeIndexData(K){if(2===K.BYTES_PER_ELEMENT)return K;if(this._caps.uintIndices){if(K instanceof Uint32Array)return K;for(let b=0;b<K.length;b++)if(K[b]>=65535)return new Uint32Array(K);return new Uint16Array(K)}return new Uint16Array(K)}bindArrayBuffer(K){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(K,this._gl.ARRAY_BUFFER)}bindUniformBlock(K,b,e){const z=K.program,k=this._gl.getUniformBlockIndex(z,b);this._gl.uniformBlockBinding(z,k,e)}bindIndexBuffer(K){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this._bindBuffer(K,this._gl.ELEMENT_ARRAY_BUFFER)}_bindBuffer(K,b){(this._vaoRecordInProgress||this._currentBoundBuffer[b]!==K)&&(this._gl.bindBuffer(b,K?K.underlyingResource:null),this._currentBoundBuffer[b]=K)}updateArrayBuffer(K){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,K)}_vertexAttribPointer(K,b,e,z,k,j,T){const F=this._currentBufferPointers[b];if(!F)return;let l=!1;F.active?(F.buffer!==K&&(F.buffer=K,l=!0),F.size!==e&&(F.size=e,l=!0),F.type!==z&&(F.type=z,l=!0),F.normalized!==k&&(F.normalized=k,l=!0),F.stride!==j&&(F.stride=j,l=!0),F.offset!==T&&(F.offset=T,l=!0)):(l=!0,F.active=!0,F.index=b,F.size=e,F.type=z,F.normalized=k,F.stride=j,F.offset=T,F.buffer=K),(l||this._vaoRecordInProgress)&&(this.bindArrayBuffer(K),z===this._gl.UNSIGNED_INT||z===this._gl.INT?this._gl.vertexAttribIPointer(b,e,z,j,T):this._gl.vertexAttribPointer(b,e,z,k,j,T))}_bindIndexBufferWithCache(K){null!=K&&this._cachedIndexBuffer!==K&&(this._cachedIndexBuffer=K,this.bindIndexBuffer(K),this._uintIndicesCurrentlySet=K.is32Bits)}_bindVertexBuffersAttributes(K,b,e){const z=b.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(let k=0;k<z.length;k++){const j=b.getAttributeLocation(k);if(j>=0){const b=z[k];let T=null;if(e&&(T=e[b]),T||(T=K[b]),!T)continue;this._gl.enableVertexAttribArray(j),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[j]=!0);const F=T.getBuffer();F&&(this._vertexAttribPointer(F,j,T.getSize(),T.type,T.normalized,T.byteStride,T.byteOffset),T.getIsInstanced()&&(this._gl.vertexAttribDivisor(j,T.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(j),this._currentInstanceBuffers.push(F))))}}}recordVertexArrayObject(K,b,e,z){const k=this._gl.createVertexArray();if(!k)throw new Error("Unable to create VAO");return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(k),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(K,e,z),this.bindIndexBuffer(b),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),k}bindVertexArrayObject(K,b){this._cachedVertexArrayObject!==K&&(this._cachedVertexArrayObject=K,this._gl.bindVertexArray(K),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=b&&b.is32Bits,this._mustWipeVertexAttributes=!0)}bindBuffersDirectly(K,b,e,z,k){if(this._cachedVertexBuffers!==K||this._cachedEffectForVertexBuffers!==k){this._cachedVertexBuffers=K,this._cachedEffectForVertexBuffers=k;const b=k.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();let j=0;for(let T=0;T<b;T++)if(T<e.length){const b=k.getAttributeLocation(T);b>=0&&(this._gl.enableVertexAttribArray(b),this._vertexAttribArraysEnabled[b]=!0,this._vertexAttribPointer(K,b,e[T],this._gl.FLOAT,!1,z,j)),j+=4*e[T]}}this._bindIndexBufferWithCache(b)}_unbindVertexArrayObject(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))}bindBuffers(K,b,e,z){this._cachedVertexBuffers===K&&this._cachedEffectForVertexBuffers===e||(this._cachedVertexBuffers=K,this._cachedEffectForVertexBuffers=e,this._bindVertexBuffersAttributes(K,e,z)),this._bindIndexBufferWithCache(b)}unbindInstanceAttributes(){let K;for(let b=0,e=this._currentInstanceLocations.length;b<e;b++){const e=this._currentInstanceBuffers[b];K!=e&&e.references&&(K=e,this.bindArrayBuffer(e));const z=this._currentInstanceLocations[b];this._gl.vertexAttribDivisor(z,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0}releaseVertexArrayObject(K){this._gl.deleteVertexArray(K)}_releaseBuffer(K){return K.references--,0===K.references&&(this._deleteBuffer(K),!0)}_deleteBuffer(K){this._gl.deleteBuffer(K.underlyingResource)}updateAndBindInstancesBuffer(K,b,e){if(this.bindArrayBuffer(K),b&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,b),void 0!==e[0].index)this.bindInstancesBuffer(K,e,!0);else for(let z=0;z<4;z++){const b=e[z];this._vertexAttribArraysEnabled[b]||(this._gl.enableVertexAttribArray(b),this._vertexAttribArraysEnabled[b]=!0),this._vertexAttribPointer(K,b,4,this._gl.FLOAT,!1,64,16*z),this._gl.vertexAttribDivisor(b,1),this._currentInstanceLocations.push(b),this._currentInstanceBuffers.push(K)}}bindInstancesBuffer(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.bindArrayBuffer(K);let z=0;if(e)for(let k=0;k<b.length;k++){z+=4*b[k].attributeSize}for(let k=0;k<b.length;k++){const e=b[k];void 0===e.index&&(e.index=this._currentEffect.getAttributeLocationByName(e.attributeName)),e.index<0||(this._vertexAttribArraysEnabled[e.index]||(this._gl.enableVertexAttribArray(e.index),this._vertexAttribArraysEnabled[e.index]=!0),this._vertexAttribPointer(K,e.index,e.attributeSize,e.attributeType||this._gl.FLOAT,e.normalized||!1,z,e.offset),this._gl.vertexAttribDivisor(e.index,void 0===e.divisor?1:e.divisor),this._currentInstanceLocations.push(e.index),this._currentInstanceBuffers.push(K))}}disableInstanceAttributeByName(K){if(!this._currentEffect)return;const b=this._currentEffect.getAttributeLocationByName(K);this.disableInstanceAttribute(b)}disableInstanceAttribute(K){let b,e=!1;for(;-1!==(b=this._currentInstanceLocations.indexOf(K));)this._currentInstanceLocations.splice(b,1),this._currentInstanceBuffers.splice(b,1),e=!0,b=this._currentInstanceLocations.indexOf(K);e&&(this._gl.vertexAttribDivisor(K,0),this.disableAttributeByIndex(K))}disableAttributeByIndex(K){this._gl.disableVertexAttribArray(K),this._vertexAttribArraysEnabled[K]=!1,this._currentBufferPointers[K].active=!1}draw(K,b,e,z){this.drawElementsType(K?0:1,b,e,z)}drawPointClouds(K,b,e){this.drawArraysType(2,K,b,e)}drawUnIndexed(K,b,e,z){this.drawArraysType(K?0:1,b,e,z)}drawElementsType(K,b,e,z){this.applyStates(),this._reportDrawCall();const k=this._drawMode(K),j=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,T=this._uintIndicesCurrentlySet?4:2;z?this._gl.drawElementsInstanced(k,e,j,b*T,z):this._gl.drawElements(k,e,j,b*T)}drawArraysType(K,b,e,z){this.applyStates(),this._reportDrawCall();const k=this._drawMode(K);z?this._gl.drawArraysInstanced(k,b,e,z):this._gl.drawArrays(k,b,e)}_drawMode(K){switch(K){case 0:default:return this._gl.TRIANGLES;case 2:case 3:return this._gl.POINTS;case 1:case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN}}_releaseEffect(K){this._compiledEffects[K._key]&&delete this._compiledEffects[K._key];const b=K.getPipelineContext();b&&this._deletePipelineContext(b)}_deletePipelineContext(K){const b=K;b&&b.program&&(b.program.__SPECTOR_rebuildProgram=null,(0,D.g)(b),this._gl.deleteProgram(b.program))}_getGlobalDefines(K){return(0,m.h)(K,this.isNDCHalfZRange,this.useReverseDepthBuffer,this.useExactSrgbConversions)}createEffect(K,b,e,k,j,T,F,l,Y){let A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10?arguments[10]:void 0;const t="string"===typeof K?K:K.vertexToken||K.vertexSource||K.vertexElement||K.vertex,U="string"===typeof K?K:K.fragmentToken||K.fragmentSource||K.fragmentElement||K.fragment,B=this._getGlobalDefines();let m=j??b.defines??"";B&&(m+=B);const D=t+"+"+U+"@"+m;if(this._compiledEffects[D]){const K=this._compiledEffects[D];return F&&K.isReady()&&F(K),K._refCount++,K}this._gl&&(0,z.z)(this._gl);const I=new u.d(K,b,e,k,this,j,T,F,l,Y,D,b.shaderLanguage??A,b.extraInitializationsAsync??X);return this._compiledEffects[D]=I,I}_getShaderSource(K){return this._gl.getShaderSource(K)}createRawShaderProgram(K,b,e,k){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const T=(0,z.z)(this._gl);return T._contextWasLost=this._contextWasLost,T.validateShaderPrograms=this.validateShaderPrograms,(0,z.t)(K,b,e,k||this._gl,j)}createShaderProgram(K,b,e,k,j){let T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null;const F=(0,z.z)(this._gl);return F._contextWasLost=this._contextWasLost,F.validateShaderPrograms=this.validateShaderPrograms,(0,z.v)(K,b,e,k,j||this._gl,T)}inlineShaderCode(K){return K}createPipelineContext(K){if(this._gl){(0,z.z)(this._gl).parallelShaderCompile=this._caps.parallelShaderCompile}const b=(0,z.r)(this._gl,K);return b.kd=this,b}createMaterialContext(){}createDrawContext(){}_finalizePipelineContext(K){return(0,z.j)(K,this._gl,this.validateShaderPrograms)}_preparePipelineContext(K,b,e,k,j,T,F,l,Y,A,X){const t=(0,z.z)(this._gl);return t._contextWasLost=this._contextWasLost,t.validateShaderPrograms=this.validateShaderPrograms,t._createShaderProgramInjection=this._createShaderProgram.bind(this),t.createRawShaderProgramInjection=this.createRawShaderProgram.bind(this),t.createShaderProgramInjection=this.createShaderProgram.bind(this),t.loadFileInjection=this._loadFile.bind(this),(0,z.k)(K,b,e,k,j,T,F,l,Y,A,X)}_createShaderProgram(K,b,e,k){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return(0,z.e)(K,b,e,k,j)}_isRenderingStateCompiled(K){const b=K;return!this._isDisposed&&!b._isDisposed&&(!!this._gl.getProgramParameter(b.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(b),!0))}_executeWhenRenderingStateIsCompiled(K,b){(0,z.f)(K,b)}getUniforms(K,b){const e=new Array,z=K;for(let k=0;k<b.length;k++)e.push(this._gl.getUniformLocation(z.program,b[k]));return e}getAttributes(K,b){const e=[],z=K;for(let j=0;j<b.length;j++)try{e.push(this._gl.getAttribLocation(z.program,b[j]))}catch(k){e.push(-1)}return e}enableEffect(K){(K=null!==K&&(0,k.d)(K)?K.effect:K)&&K!==this._currentEffect&&(this._stencilStateComposer.stencilMaterial=void 0,this.bindSamplers(K),this._currentEffect=K,K.onBind&&K.onBind(K),K._onBindObservable&&K._onBindObservable.notifyObservers(K))}setInt(K,b){return!!K&&(this._gl.uniform1i(K,b),!0)}setInt2(K,b,e){return!!K&&(this._gl.uniform2i(K,b,e),!0)}setInt3(K,b,e,z){return!!K&&(this._gl.uniform3i(K,b,e,z),!0)}setInt4(K,b,e,z,k){return!!K&&(this._gl.uniform4i(K,b,e,z,k),!0)}setIntArray(K,b){return!!K&&(this._gl.uniform1iv(K,b),!0)}setIntArray2(K,b){return!(!K||b.length%2!==0)&&(this._gl.uniform2iv(K,b),!0)}setIntArray3(K,b){return!(!K||b.length%3!==0)&&(this._gl.uniform3iv(K,b),!0)}setIntArray4(K,b){return!(!K||b.length%4!==0)&&(this._gl.uniform4iv(K,b),!0)}setUInt(K,b){return!!K&&(this._gl.uniform1ui(K,b),!0)}setUInt2(K,b,e){return!!K&&(this._gl.uniform2ui(K,b,e),!0)}setUInt3(K,b,e,z){return!!K&&(this._gl.uniform3ui(K,b,e,z),!0)}setUInt4(K,b,e,z,k){return!!K&&(this._gl.uniform4ui(K,b,e,z,k),!0)}setUIntArray(K,b){return!!K&&(this._gl.uniform1uiv(K,b),!0)}setUIntArray2(K,b){return!(!K||b.length%2!==0)&&(this._gl.uniform2uiv(K,b),!0)}setUIntArray3(K,b){return!(!K||b.length%3!==0)&&(this._gl.uniform3uiv(K,b),!0)}setUIntArray4(K,b){return!(!K||b.length%4!==0)&&(this._gl.uniform4uiv(K,b),!0)}setArray(K,b){return!!K&&(!(b.length<1)&&(this._gl.uniform1fv(K,b),!0))}setArray2(K,b){return!(!K||b.length%2!==0)&&(this._gl.uniform2fv(K,b),!0)}setArray3(K,b){return!(!K||b.length%3!==0)&&(this._gl.uniform3fv(K,b),!0)}setArray4(K,b){return!(!K||b.length%4!==0)&&(this._gl.uniform4fv(K,b),!0)}setMatrices(K,b){return!!K&&(this._gl.uniformMatrix4fv(K,!1,b),!0)}setMatrix3x3(K,b){return!!K&&(this._gl.uniformMatrix3fv(K,!1,b),!0)}setMatrix2x2(K,b){return!!K&&(this._gl.uniformMatrix2fv(K,!1,b),!0)}setFloat(K,b){return!!K&&(this._gl.uniform1f(K,b),!0)}setFloat2(K,b,e){return!!K&&(this._gl.uniform2f(K,b,e),!0)}setFloat3(K,b,e,z){return!!K&&(this._gl.uniform3f(K,b,e,z),!0)}setFloat4(K,b,e,z,k){return!!K&&(this._gl.uniform4f(K,b,e,z,k),!0)}applyStates(){if(this._depthCullingState.apply(this._gl),this._stencilStateComposer.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;const K=this._colorWrite;this._gl.colorMask(K,K,K,K)}}wipeCaches(K){this.preventCacheWipeBetweenFrames&&!K||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),K&&(this._currentProgram=null,this.resetTextureCache(),this._stencilStateComposer.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))}_getSamplingParameters(K,b){const e=this._gl;let z=e.NEAREST,k=e.NEAREST;switch(K){case 11:z=e.LINEAR,k=b?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;break;case 3:z=e.LINEAR,k=b?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;break;case 8:z=e.NEAREST,k=b?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;break;case 4:z=e.NEAREST,k=b?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;break;case 5:z=e.NEAREST,k=b?e.LINEAR_MIPMAP_NEAREST:e.LINEAR;break;case 6:z=e.NEAREST,k=b?e.LINEAR_MIPMAP_LINEAR:e.LINEAR;break;case 7:z=e.NEAREST,k=e.LINEAR;break;case 1:z=e.NEAREST,k=e.NEAREST;break;case 9:z=e.LINEAR,k=b?e.NEAREST_MIPMAP_NEAREST:e.NEAREST;break;case 10:z=e.LINEAR,k=b?e.NEAREST_MIPMAP_LINEAR:e.NEAREST;break;case 2:z=e.LINEAR,k=e.LINEAR;break;case 12:z=e.LINEAR,k=e.NEAREST}return{min:k,mag:z}}_createTexture(){const K=this._gl.createTexture();if(!K)throw new Error("Unable to create texture");return K}_createHardwareTexture(){return new U.c(this._createTexture(),this._gl)}_createInternalTexture(K,b){let e,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=!1,T=0,F=3,l=5,Y=!1,A=1;void 0!==b&&"object"===typeof b?(k=!!b.generateMipMaps,T=void 0===b.type?0:b.type,F=void 0===b.samplingMode?3:b.samplingMode,l=void 0===b.format?5:b.format,Y=void 0!==b.useSRGBBuffer&&b.useSRGBBuffer,A=b.samples??1,e=b.label):k=!!b,Y&&(Y=this._caps.supportSRGBBuffers&&(this.webGLVersion>1||this.isWebGPU)),(1!==T||this._caps.textureFloatLinearFiltering)&&(2!==T||this._caps.textureHalfFloatLinearFiltering)||(F=1),1!==T||this._caps.textureFloat||(T=0,j.b.Warn("Float textures are not supported. Type forced to TEXTURETYPE_UNSIGNED_BYTE"));const X=this._gl,t=new B.e(this,z),U=K.width||K,u=K.height||K,m=K.depth||0,D=K.layers||0,I=this._getSamplingParameters(F,k),x=0!==D?X.TEXTURE_2D_ARRAY:0!==m?X.TEXTURE_3D:X.TEXTURE_2D,Q=this._getRGBABufferInternalSizedFormat(T,l,Y),G=this._getInternalFormat(l),i=this._getWebGLTextureType(T);return this._bindTextureDirectly(x,t),0!==D?(t.is2DArray=!0,X.texImage3D(x,0,Q,U,u,D,0,G,i,null)):0!==m?(t.is3D=!0,X.texImage3D(x,0,Q,U,u,m,0,G,i,null)):X.texImage2D(x,0,Q,U,u,0,G,i,null),X.texParameteri(x,X.TEXTURE_MAG_FILTER,I.mag),X.texParameteri(x,X.TEXTURE_MIN_FILTER,I.min),X.texParameteri(x,X.TEXTURE_WRAP_S,X.CLAMP_TO_EDGE),X.texParameteri(x,X.TEXTURE_WRAP_T,X.CLAMP_TO_EDGE),k&&this._gl.generateMipmap(x),this._bindTextureDirectly(x,null),t._useSRGBBuffer=Y,t.baseWidth=U,t.baseHeight=u,t.width=U,t.height=u,t.depth=D,t.isReady=!0,t.samples=A,t.generateMipMaps=k,t.samplingMode=F,t.type=T,t.format=l,t.label=e,this._internalTexturesCache.push(t),t}_getUseSRGBBuffer(K,b){return K&&this._caps.supportSRGBBuffers&&(this.webGLVersion>1||b)}createTexture(K,b,e,z){var k=this;let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,X=arguments.length>10&&void 0!==arguments[10]?arguments[10]:null,t=arguments.length>11?arguments[11]:void 0,U=arguments.length>12?arguments[12]:void 0,u=arguments.length>13?arguments[13]:void 0,m=arguments.length>14?arguments[14]:void 0;return this._createTextureBase(K,b,e,z,j,T,F,(function(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];return k._prepareWebGLTexture(...b,A)}),((K,b,e,k,j,T)=>{const F=this._gl,l=e.width===K&&e.height===b;j._creationFlags=u??0;const Y=this._getTexImageParametersForCreateTexture(j.format,j._useSRGBBuffer);if(l)return F.texImage2D(F.TEXTURE_2D,0,Y.internalFormat,Y.format,Y.type,e),!1;const A=this._caps.maxTextureSize;if(e.width>A||e.height>A||!this._supportsHardwareTextureRescaling)return this._prepareWorkingCanvas(),!(!this._workingCanvas||!this._workingContext)&&(this._workingCanvas.width=K,this._workingCanvas.height=b,this._workingContext.drawImage(e,0,0,e.width,e.height,0,0,K,b),F.texImage2D(F.TEXTURE_2D,0,Y.internalFormat,Y.format,Y.type,this._workingCanvas),j.width=K,j.height=b,!1);{const K=new B.e(this,2);this._bindTextureDirectly(F.TEXTURE_2D,K,!0),F.texImage2D(F.TEXTURE_2D,0,Y.internalFormat,Y.format,Y.type,e),this._rescaleTexture(K,j,z,Y.format,(()=>{this._releaseTexture(K),this._bindTextureDirectly(F.TEXTURE_2D,j,!0),T()}))}return!0}),l,Y,A,X,t,U,m)}_getTexImageParametersForCreateTexture(K,b){let e,z;return 1===this.webGLVersion?(e=this._getInternalFormat(K,b),z=e):(e=this._getInternalFormat(K,!1),z=this._getRGBABufferInternalSizedFormat(0,K,b)),{internalFormat:z,format:e,type:this._gl.UNSIGNED_BYTE}}_rescaleTexture(K,b,e,z,k){}_unpackFlipY(K){this._unpackFlipYCached!==K&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,K?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=K))}_getUnpackAlignement(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)}_getTextureTarget(K){return K.isCube?this._gl.TEXTURE_CUBE_MAP:K.is3D?this._gl.TEXTURE_3D:K.is2DArray||K.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D}updateTextureSamplingMode(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=this._getTextureTarget(b),k=this._getSamplingParameters(K,b.useMipMaps||e);this._setTextureParameterInteger(z,this._gl.TEXTURE_MAG_FILTER,k.mag,b),this._setTextureParameterInteger(z,this._gl.TEXTURE_MIN_FILTER,k.min),e&&(b.generateMipMaps=!0,this._gl.generateMipmap(z)),this._bindTextureDirectly(z,null),b.samplingMode=K}updateTextureDimensions(K,b,e){}updateTextureWrappingMode(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=this._getTextureTarget(K);null!==b&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(b),K),K._cachedWrapU=b),null!==e&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(e),K),K._cachedWrapV=e),(K.is2DArray||K.is3D)&&null!==z&&(this._setTextureParameterInteger(k,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(z),K),K._cachedWrapR=z),this._bindTextureDirectly(k,null)}_uploadCompressedDataToTextureDirectly(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const F=this._gl;let l=F.TEXTURE_2D;if(K.isCube&&(l=F.TEXTURE_CUBE_MAP_POSITIVE_X+j),K._useSRGBBuffer)switch(b){case 37492:case 36196:this._caps.etc2?b=F.COMPRESSED_SRGB8_ETC2:K._useSRGBBuffer=!1;break;case 37496:this._caps.etc2?b=F.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:K._useSRGBBuffer=!1;break;case 36492:b=F.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT;break;case 37808:b=F.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;break;case 33776:this._caps.s3tc_srgb?b=F.COMPRESSED_SRGB_S3TC_DXT1_EXT:K._useSRGBBuffer=!1;break;case 33777:this._caps.s3tc_srgb?b=F.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT:K._useSRGBBuffer=!1;break;case 33779:this._caps.s3tc_srgb?b=F.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT:K._useSRGBBuffer=!1;break;default:K._useSRGBBuffer=!1}this._gl.compressedTexImage2D(l,T,b,e,z,0,k)}_uploadDataToTextureDirectly(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const T=this._gl,F=this._getWebGLTextureType(K.type),l=this._getInternalFormat(K.format),Y=void 0===k?this._getRGBABufferInternalSizedFormat(K.type,K.format,K._useSRGBBuffer):this._getInternalFormat(k,K._useSRGBBuffer);this._unpackFlipY(K.invertY);let A=T.TEXTURE_2D;K.isCube&&(A=T.TEXTURE_CUBE_MAP_POSITIVE_X+e);const X=Math.round(Math.log(K.width)*Math.LOG2E),t=Math.round(Math.log(K.height)*Math.LOG2E),U=j?K.width:Math.pow(2,Math.max(X-z,0)),B=j?K.height:Math.pow(2,Math.max(t-z,0));T.texImage2D(A,z,Y,U,B,0,l,F,b)}updateTextureData(K,b,e,z,k,j){let T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const Y=this._gl,A=this._getWebGLTextureType(K.type),X=this._getInternalFormat(K.format);this._unpackFlipY(K.invertY);let t=Y.TEXTURE_2D,U=Y.TEXTURE_2D;K.isCube&&(U=Y.TEXTURE_CUBE_MAP_POSITIVE_X+T,t=Y.TEXTURE_CUBE_MAP),this._bindTextureDirectly(t,K,!0),Y.texSubImage2D(U,F,e,z,k,j,X,A,b),l&&this._gl.generateMipmap(U),this._bindTextureDirectly(t,null)}_uploadArrayBufferViewToTexture(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const k=this._gl,j=K.isCube?k.TEXTURE_CUBE_MAP:k.TEXTURE_2D;this._bindTextureDirectly(j,K,!0),this._uploadDataToTextureDirectly(K,b,e,z),this._bindTextureDirectly(j,null,!0)}_prepareWebGLTextureContinuation(K,b,e,z,k){const j=this._gl;if(!j)return;const T=this._getSamplingParameters(k,!e);j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,T.mag),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,T.min),e||z||j.generateMipmap(j.TEXTURE_2D),this._bindTextureDirectly(j.TEXTURE_2D,null),b&&b.removePendingData(K),K.onLoadedObservable.notifyObservers(K),K.onLoadedObservable.clear()}_prepareWebGLTexture(K,b,e,z,k,j,T,F,l,Y){const A=this.getCaps().maxTextureSize,t=Math.min(A,this.needPOTTextures?(0,X.g)(z.width,A):z.width),U=Math.min(A,this.needPOTTextures?(0,X.g)(z.height,A):z.height),B=this._gl;B&&(K._hardwareTexture?(this._bindTextureDirectly(B.TEXTURE_2D,K,!0),this._unpackFlipY(void 0===k||!!k),K.baseWidth=z.width,K.baseHeight=z.height,K.width=t,K.height=U,K.isReady=!0,K.type=-1!==K.type?K.type:0,K.format=-1!==K.format?K.format:Y??(".jpg"!==b||K._useSRGBBuffer?5:4),F(t,U,z,b,K,(()=>{this._prepareWebGLTextureContinuation(K,e,j,T,l)}))||this._prepareWebGLTextureContinuation(K,e,j,T,l)):e&&e.removePendingData(K))}_getInternalFormatFromDepthTextureFormat(K,b,e){const z=this._gl;if(!b)return z.STENCIL_INDEX8;let k=e?z.DEPTH_STENCIL:z.DEPTH_COMPONENT;return this.webGLVersion>1?15===K?k=z.DEPTH_COMPONENT16:16===K?k=z.DEPTH_COMPONENT24:17===K||13===K?k=e?z.DEPTH24_STENCIL8:z.DEPTH_COMPONENT24:14===K?k=z.DEPTH_COMPONENT32F:18===K&&(k=e?z.DEPTH32F_STENCIL8:z.DEPTH_COMPONENT32F):k=z.DEPTH_COMPONENT16,k}_setupFramebufferDepthAttachments(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,j=arguments.length>5?arguments[5]:void 0;const T=this._gl;j=j??(K?13:14);const F=this._getInternalFormatFromDepthTextureFormat(j,b,K);return K&&b?this._createRenderBuffer(e,z,k,T.DEPTH_STENCIL,F,T.DEPTH_STENCIL_ATTACHMENT):b?this._createRenderBuffer(e,z,k,F,F,T.DEPTH_ATTACHMENT):K?this._createRenderBuffer(e,z,k,F,F,T.STENCIL_ATTACHMENT):null}_createRenderBuffer(K,b,e,z,k,j){let T=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];const F=this._gl.createRenderbuffer();return this._updateRenderBuffer(F,K,b,e,z,k,j,T)}_updateRenderBuffer(K,b,e,z,k,j,T){let F=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=this._gl;return l.bindRenderbuffer(l.RENDERBUFFER,K),z>1&&l.renderbufferStorageMultisample?l.renderbufferStorageMultisample(l.RENDERBUFFER,z,j,b,e):l.renderbufferStorage(l.RENDERBUFFER,k,b,e),l.framebufferRenderbuffer(l.FRAMEBUFFER,T,l.RENDERBUFFER,K),F&&l.bindRenderbuffer(l.RENDERBUFFER,null),K}_releaseTexture(K){this._deleteTexture(K._hardwareTexture),this.unbindAllTextures();const b=this._internalTexturesCache.indexOf(K);-1!==b&&this._internalTexturesCache.splice(b,1),K._lodTextureHigh&&K._lodTextureHigh.dispose(),K._lodTextureMid&&K._lodTextureMid.dispose(),K._lodTextureLow&&K._lodTextureLow.dispose(),K._irradianceTexture&&K._irradianceTexture.dispose()}_deleteTexture(K){null===K||void 0===K||K.release()}_setProgram(K){this._currentProgram!==K&&((0,z.n)(K,this._gl),this._currentProgram=K)}bindSamplers(K){const b=K.getPipelineContext();this._setProgram(b.program);const e=K.getSamplers();for(let z=0;z<e.length;z++){const b=K.getUniform(e[z]);b&&(this._boundUniforms[z]=b)}this._currentEffect=null}_activateCurrentTexture(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)}_bindTextureDirectly(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=!1;const T=b&&b._associatedChannel>-1;e&&T&&(this._activeChannel=b._associatedChannel);if(this._boundTexturesCache[this._activeChannel]!==b||z){if(this._activateCurrentTexture(),b&&b.isMultiview)throw j.b.Error(["_bindTextureDirectly called with a multiview texture!",K,b]),"_bindTextureDirectly called with a multiview texture!";var F;this._gl.bindTexture(K,(null===b||void 0===b||null===(F=b._hardwareTexture)||void 0===F?void 0:F.underlyingResource)??null),this._boundTexturesCache[this._activeChannel]=b,b&&(b._associatedChannel=this._activeChannel)}else e&&(k=!0,this._activateCurrentTexture());return T&&!e&&this._bindSamplerUniformToChannel(b._associatedChannel,this._activeChannel),k}_bindTexture(K,b,e){if(void 0===K)return;b&&(b._associatedChannel=K),this._activeChannel=K;const z=b?this._getTextureTarget(b):this._gl.TEXTURE_2D;this._bindTextureDirectly(z,b)}unbindAllTextures(){for(let K=0;K<this._maxSimultaneousTextures;K++)this._activeChannel=K,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))}setTexture(K,b,e,z){void 0!==K&&(b&&(this._boundUniforms[K]=b),this._setTexture(K,e))}_bindSamplerUniformToChannel(K,b){const e=this._boundUniforms[K];e&&e._currentState!==b&&(this._gl.uniform1i(e,b),e._currentState=b)}_getTextureWrapMode(K){switch(K){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT}_setTexture(K,b){let e,z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!b)return null!=this._boundTexturesCache[K]&&(this._activeChannel=K,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(b.video){this._activeChannel=K;const e=b.getInternalTexture();e&&(e._associatedChannel=K),b.update()}else if(4===b.delayLoadState)return b.delayLoad(),!1;e=k?b.depthStencilTexture:b.isReady()?b.getInternalTexture():b.isCube?this.emptyCubeTexture:b.is3D?this.emptyTexture3D:b.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!z&&e&&(e._associatedChannel=K);let j=!0;this._boundTexturesCache[K]===e&&(z||this._bindSamplerUniformToChannel(e._associatedChannel,K),j=!1),this._activeChannel=K;const T=this._getTextureTarget(e);if(j&&this._bindTextureDirectly(T,e,z),e&&!e.isMultiview){if(e.isCube&&e._cachedCoordinatesMode!==b.coordinatesMode){e._cachedCoordinatesMode=b.coordinatesMode;const K=3!==b.coordinatesMode&&5!==b.coordinatesMode?1:0;b.wrapU=K,b.wrapV=K}e._cachedWrapU!==b.wrapU&&(e._cachedWrapU=b.wrapU,this._setTextureParameterInteger(T,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(b.wrapU),e)),e._cachedWrapV!==b.wrapV&&(e._cachedWrapV=b.wrapV,this._setTextureParameterInteger(T,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(b.wrapV),e)),e.is3D&&e._cachedWrapR!==b.wrapR&&(e._cachedWrapR=b.wrapR,this._setTextureParameterInteger(T,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(b.wrapR),e)),this._setAnisotropicLevel(T,e,b.anisotropicFilteringLevel)}return!0}setTextureArray(K,b,e,z){if(void 0!==K&&b){this._textureUnits&&this._textureUnits.length===e.length||(this._textureUnits=new Int32Array(e.length));for(let b=0;b<e.length;b++){const z=e[b].getInternalTexture();z?(this._textureUnits[b]=K+b,z._associatedChannel=K+b):this._textureUnits[b]=-1}this._gl.uniform1iv(b,this._textureUnits);for(let K=0;K<e.length;K++)this._setTexture(this._textureUnits[K],e[K],!0)}}_setAnisotropicLevel(K,b,e){const z=this._caps.textureAnisotropicFilterExtension;11!==b.samplingMode&&3!==b.samplingMode&&2!==b.samplingMode&&(e=1),z&&b._cachedAnisotropicFilteringLevel!==e&&(this._setTextureParameterFloat(K,z.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e,this._caps.maxAnisotropy),b),b._cachedAnisotropicFilteringLevel=e)}_setTextureParameterFloat(K,b,e,z){this._bindTextureDirectly(K,z,!0,!0),this._gl.texParameterf(K,b,e)}_setTextureParameterInteger(K,b,e,z){z&&this._bindTextureDirectly(K,z,!0,!0),this._gl.texParameteri(K,b,e)}unbindAllAttributes(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(let K=0;K<this._caps.maxVertexAttribs;K++)this.disableAttributeByIndex(K)}else for(let K=0,b=this._vertexAttribArraysEnabled.length;K<b;K++)K>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[K]||this.disableAttributeByIndex(K)}releaseEffects(){const K=Object.keys(this._compiledEffects);for(const b of K){this._compiledEffects[b].dispose()}this._compiledEffects={}}dispose(){var K;((0,T.k)()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),super.dispose(),this._dummyFramebuffer&&this._gl.deleteFramebuffer(this._dummyFramebuffer),this.unbindAllAttributes(),this._boundUniforms={},this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers.length=0,this._currentProgram=null,this._creationOptions.loseContextOnDispose)&&(null===(K=this._gl.getExtension("WEBGL_lose_context"))||void 0===K||K.loseContext());(0,z.x)(this._gl)}attachContextLostEvent(K){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",K,!1)}attachContextRestoredEvent(K){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",K,!1)}getError(){return this._gl.getError()}_canRenderToFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)}_canRenderToHalfFloatFramebuffer(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)}_canRenderToFramebuffer(K){const b=this._gl;for(;b.getError()!==b.NO_ERROR;);let e=!0;const z=b.createTexture();b.bindTexture(b.TEXTURE_2D,z),b.texImage2D(b.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(K),1,1,0,b.RGBA,this._getWebGLTextureType(K),null),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.NEAREST),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.NEAREST);const k=b.createFramebuffer();b.bindFramebuffer(b.FRAMEBUFFER,k),b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,z,0);const j=b.checkFramebufferStatus(b.FRAMEBUFFER);if(e=e&&j===b.FRAMEBUFFER_COMPLETE,e=e&&b.getError()===b.NO_ERROR,e&&(b.clear(b.COLOR_BUFFER_BIT),e=e&&b.getError()===b.NO_ERROR),e){b.bindFramebuffer(b.FRAMEBUFFER,null);const K=b.RGBA,z=b.UNSIGNED_BYTE,k=new Uint8Array(4);b.readPixels(0,0,1,1,K,z,k),e=e&&b.getError()===b.NO_ERROR}for(b.deleteTexture(z),b.deleteFramebuffer(k),b.bindFramebuffer(b.FRAMEBUFFER,null);!e&&b.getError()!==b.NO_ERROR;);return e}_getWebGLTextureType(K){if(1===this._webGLVersion){switch(K){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(K){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE}_getInternalFormat(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=b?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA;switch(K){case 0:e=this._gl.ALPHA;break;case 1:e=this._gl.LUMINANCE;break;case 2:e=this._gl.LUMINANCE_ALPHA;break;case 6:e=this._gl.RED;break;case 7:e=this._gl.RG;break;case 4:e=b?this._glSRGBExtensionValues.SRGB:this._gl.RGB;break;case 5:e=b?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA}if(this._webGLVersion>1)switch(K){case 8:e=this._gl.RED_INTEGER;break;case 9:e=this._gl.RG_INTEGER;break;case 10:e=this._gl.RGB_INTEGER;break;case 11:e=this._gl.RGBA_INTEGER}return e}_getRGBABufferInternalSizedFormat(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(1===this._webGLVersion){if(void 0!==b)switch(b){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return e?this._glSRGBExtensionValues.SRGB:this._gl.RGB}return this._gl.RGBA}switch(K){case 3:switch(b){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(b){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return e?this._glSRGBExtensionValues.SRGB8:this._gl.RGB8;case 5:return e?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(b){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;default:return this._gl.RGBA16I}case 5:switch(b){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;default:return this._gl.RGBA16UI}case 6:switch(b){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;default:return this._gl.RGBA32I}case 7:switch(b){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;default:return this._gl.RGBA32UI}case 1:switch(b){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;default:return this._gl.RGBA32F}case 2:switch(b){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(b){case 5:default:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI}}return e?this._glSRGBExtensionValues.SRGB8_ALPHA8:this._gl.RGBA8}readPixels(K,b,e,z){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const T=k?4:3,F=k?this._gl.RGBA:this._gl.RGB,l=new Uint8Array(z*e*T);return j&&this.flushFramebuffer(),this._gl.readPixels(K,b,e,z,F,this._gl.UNSIGNED_BYTE,l),Promise.resolve(l)}static get IsSupportedAsync(){return Promise.resolve(this.isSupported())}static get IsSupported(){return this.isSupported()}static isSupported(){if(null!==this._HasMajorPerformanceCaveat)return!this._HasMajorPerformanceCaveat;if(null===this._IsSupported)try{const K=t.e._CreateCanvas(1,1),b=K.getContext("webgl")||K.getContext("experimental-webgl");this._IsSupported=null!=b&&!!window.WebGLRenderingContext}catch(K){this._IsSupported=!1}return this._IsSupported}static get HasMajorPerformanceCaveat(){if(null===this._HasMajorPerformanceCaveat)try{const K=t.e._CreateCanvas(1,1),b=K.getContext("webgl",{failIfMajorPerformanceCaveat:!0})||K.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0});this._HasMajorPerformanceCaveat=!b}catch(K){this._HasMajorPerformanceCaveat=!1}return this._HasMajorPerformanceCaveat}}x._TempClearColorUint32=new Uint32Array(4),x._TempClearColorInt32=new Int32Array(4),x.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/12\\d\\..+?Mobile",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:".*AppleWebKit.*(15.4).*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]},{key:".*(15.4).*AppleWebKit.*Safari",capture:null,captureConstraint:null,targets:["antialias","maxMSAASamples"]}],x._ConcatenateShader=m.e,x._IsSupported=null,x._HasMajorPerformanceCaveat=null},11059:(K,b,e)=>{"use strict";var z;e.d(b,{e:()=>k}),function(K){K[K.PointerMove=0]="PointerMove",K[K.PointerDown=1]="PointerDown",K[K.PointerUp=2]="PointerUp"}(z||(z={}));class k{}k.DOM_DELTA_PIXEL=0,k.DOM_DELTA_LINE=1,k.DOM_DELTA_PAGE=2},11057:(K,b,e)=>{"use strict";e.d(b,{e:()=>z,g:()=>j,h:()=>k});class z{}z.KEYDOWN=1,z.KEYUP=2;class k{constructor(K,b){this.type=K,this.event=b}}class j extends k{get skipOnPointerObservable(){return this.skipOnKeyboardObservable}set skipOnPointerObservable(K){this.skipOnKeyboardObservable=K}constructor(K,b){super(K,b),this.type=K,this.event=b,this.skipOnKeyboardObservable=!1}}},11054:(K,b,e)=>{"use strict";e.d(b,{b:()=>k,e:()=>T,h:()=>F});var z=e(10967);class k{}k.POINTERDOWN=1,k.POINTERUP=2,k.POINTERMOVE=4,k.POINTERWHEEL=8,k.POINTERPICK=16,k.POINTERTAP=32,k.POINTERDOUBLETAP=64;class j{constructor(K,b){this.type=K,this.event=b}}class T extends j{constructor(K,b,e,k){super(K,b),this.ray=null,this.originalPickingInfo=null,this.skipOnPointerObservable=!1,this.localPosition=new z.h(e,k)}}class F extends j{get pickInfo(){return this._pickInfo||this._generatePickInfo(),this._pickInfo}constructor(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;super(K,b),this._pickInfo=e,this._inputManager=z}_generatePickInfo(){this._inputManager&&(this._pickInfo=this._inputManager._pickMove(this.event),this._inputManager._setRayOnPointerInfo(this._pickInfo,this.event),this._inputManager=null)}}},10682:(K,b,e)=>{"use strict";e.r(b),e.d(b,{SceneInstrumentation:()=>j});var z=e(10686),k=e(10810);class j{get activeMeshesEvaluationTimeCounter(){return this._activeMeshesEvaluationTime}get captureActiveMeshesEvaluationTime(){return this._captureActiveMeshesEvaluationTime}set captureActiveMeshesEvaluationTime(K){K!==this._captureActiveMeshesEvaluationTime&&(this._captureActiveMeshesEvaluationTime=K,K?(this._onBeforeActiveMeshesEvaluationObserver=this.Ad.onBeforeActiveMeshesEvaluationObservable.add((()=>{z.f.StartPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.beginMonitoring()})),this._onAfterActiveMeshesEvaluationObserver=this.Ad.onAfterActiveMeshesEvaluationObservable.add((()=>{z.f.EndPerformanceCounter("Active meshes evaluation"),this._activeMeshesEvaluationTime.endMonitoring(!1)}))):(this.Ad.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Ad.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null))}get renderTargetsRenderTimeCounter(){return this._renderTargetsRenderTime}get captureRenderTargetsRenderTime(){return this._captureRenderTargetsRenderTime}set captureRenderTargetsRenderTime(K){K!==this._captureRenderTargetsRenderTime&&(this._captureRenderTargetsRenderTime=K,K?(this._onBeforeRenderTargetsRenderObserver=this.Ad.onBeforeRenderTargetsRenderObservable.add((()=>{z.f.StartPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.beginMonitoring()})),this._onAfterRenderTargetsRenderObserver=this.Ad.onAfterRenderTargetsRenderObservable.add((()=>{z.f.EndPerformanceCounter("Render targets rendering"),this._renderTargetsRenderTime.endMonitoring(!1)}))):(this.Ad.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Ad.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null))}get particlesRenderTimeCounter(){return this._particlesRenderTime}get captureParticlesRenderTime(){return this._captureParticlesRenderTime}set captureParticlesRenderTime(K){K!==this._captureParticlesRenderTime&&(this._captureParticlesRenderTime=K,K?(this._onBeforeParticlesRenderingObserver=this.Ad.onBeforeParticlesRenderingObservable.add((()=>{z.f.StartPerformanceCounter("Particles"),this._particlesRenderTime.beginMonitoring()})),this._onAfterParticlesRenderingObserver=this.Ad.onAfterParticlesRenderingObservable.add((()=>{z.f.EndPerformanceCounter("Particles"),this._particlesRenderTime.endMonitoring(!1)}))):(this.Ad.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Ad.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null))}get spritesRenderTimeCounter(){return this._spritesRenderTime}get captureSpritesRenderTime(){return this._captureSpritesRenderTime}set captureSpritesRenderTime(K){K!==this._captureSpritesRenderTime&&(this._captureSpritesRenderTime=K,this.Ad.spriteManagers&&(K?(this._onBeforeSpritesRenderingObserver=this.Ad.onBeforeSpritesRenderingObservable.add((()=>{z.f.StartPerformanceCounter("Sprites"),this._spritesRenderTime.beginMonitoring()})),this._onAfterSpritesRenderingObserver=this.Ad.onAfterSpritesRenderingObservable.add((()=>{z.f.EndPerformanceCounter("Sprites"),this._spritesRenderTime.endMonitoring(!1)}))):(this.Ad.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null,this.Ad.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null)))}get physicsTimeCounter(){return this._physicsTime}get capturePhysicsTime(){return this._capturePhysicsTime}set capturePhysicsTime(K){K!==this._capturePhysicsTime&&this.Ad.onBeforePhysicsObservable&&(this._capturePhysicsTime=K,K?(this._onBeforePhysicsObserver=this.Ad.onBeforePhysicsObservable.add((()=>{z.f.StartPerformanceCounter("jb"),this._physicsTime.beginMonitoring()})),this._onAfterPhysicsObserver=this.Ad.onAfterPhysicsObservable.add((()=>{z.f.EndPerformanceCounter("jb"),this._physicsTime.endMonitoring()}))):(this.Ad.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null,this.Ad.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null))}get animationsTimeCounter(){return this._animationsTime}get captureAnimationsTime(){return this._captureAnimationsTime}set captureAnimationsTime(K){K!==this._captureAnimationsTime&&(this._captureAnimationsTime=K,K?this._onAfterAnimationsObserver=this.Ad.onAfterAnimationsObservable.add((()=>{this._animationsTime.endMonitoring()})):(this.Ad.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null))}get frameTimeCounter(){return this._frameTime}get captureFrameTime(){return this._captureFrameTime}set captureFrameTime(K){this._captureFrameTime=K}get interFrameTimeCounter(){return this._interFrameTime}get captureInterFrameTime(){return this._captureInterFrameTime}set captureInterFrameTime(K){this._captureInterFrameTime=K}get renderTimeCounter(){return this._renderTime}get captureRenderTime(){return this._captureRenderTime}set captureRenderTime(K){K!==this._captureRenderTime&&(this._captureRenderTime=K,K?(this._onBeforeDrawPhaseObserver=this.Ad.onBeforeDrawPhaseObservable.add((()=>{this._renderTime.beginMonitoring(),z.f.StartPerformanceCounter("Main render")})),this._onAfterDrawPhaseObserver=this.Ad.onAfterDrawPhaseObservable.add((()=>{this._renderTime.endMonitoring(!1),z.f.EndPerformanceCounter("Main render")}))):(this.Ad.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Ad.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null))}get cameraRenderTimeCounter(){return this._cameraRenderTime}get captureCameraRenderTime(){return this._captureCameraRenderTime}set captureCameraRenderTime(K){K!==this._captureCameraRenderTime&&(this._captureCameraRenderTime=K,K?(this._onBeforeCameraRenderObserver=this.Ad.onBeforeCameraRenderObservable.add((K=>{this._cameraRenderTime.beginMonitoring(),z.f.StartPerformanceCounter(`Rendering camera ${K.name}`)})),this._onAfterCameraRenderObserver=this.Ad.onAfterCameraRenderObservable.add((K=>{this._cameraRenderTime.endMonitoring(!1),z.f.EndPerformanceCounter(`Rendering camera ${K.name}`)}))):(this.Ad.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Ad.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null))}get drawCallsCounter(){return this.Ad.getEngine()._drawCalls}constructor(K){this.Ad=K,this._captureActiveMeshesEvaluationTime=!1,this._activeMeshesEvaluationTime=new k.e,this._captureRenderTargetsRenderTime=!1,this._renderTargetsRenderTime=new k.e,this._captureFrameTime=!1,this._frameTime=new k.e,this._captureRenderTime=!1,this._renderTime=new k.e,this._captureInterFrameTime=!1,this._interFrameTime=new k.e,this._captureParticlesRenderTime=!1,this._particlesRenderTime=new k.e,this._captureSpritesRenderTime=!1,this._spritesRenderTime=new k.e,this._capturePhysicsTime=!1,this._physicsTime=new k.e,this._captureAnimationsTime=!1,this._animationsTime=new k.e,this._captureCameraRenderTime=!1,this._cameraRenderTime=new k.e,this._onBeforeActiveMeshesEvaluationObserver=null,this._onAfterActiveMeshesEvaluationObserver=null,this._onBeforeRenderTargetsRenderObserver=null,this._onAfterRenderTargetsRenderObserver=null,this._onAfterRenderObserver=null,this._onBeforeDrawPhaseObserver=null,this._onAfterDrawPhaseObserver=null,this._onBeforeAnimationsObserver=null,this._onBeforeParticlesRenderingObserver=null,this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver=null,this._onAfterSpritesRenderingObserver=null,this._onBeforePhysicsObserver=null,this._onAfterPhysicsObserver=null,this._onAfterAnimationsObserver=null,this._onBeforeCameraRenderObserver=null,this._onAfterCameraRenderObserver=null,this._onBeforeAnimationsObserver=K.onBeforeAnimationsObservable.add((()=>{this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.fetchNewFrame(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.fetchNewFrame(),this._captureFrameTime&&(z.f.StartPerformanceCounter("Scene rendering"),this._frameTime.beginMonitoring()),this._captureInterFrameTime&&this._interFrameTime.endMonitoring(),this._captureParticlesRenderTime&&this._particlesRenderTime.fetchNewFrame(),this._captureSpritesRenderTime&&this._spritesRenderTime.fetchNewFrame(),this._captureAnimationsTime&&this._animationsTime.beginMonitoring(),this._captureRenderTime&&this._renderTime.fetchNewFrame(),this._captureCameraRenderTime&&this._cameraRenderTime.fetchNewFrame(),this.Ad.getEngine()._drawCalls.fetchNewFrame()})),this._onAfterRenderObserver=K.onAfterRenderObservable.add((()=>{this._captureFrameTime&&(z.f.EndPerformanceCounter("Scene rendering"),this._frameTime.endMonitoring()),this._captureRenderTime&&this._renderTime.endMonitoring(!1),this._captureInterFrameTime&&this._interFrameTime.beginMonitoring(),this._captureActiveMeshesEvaluationTime&&this._activeMeshesEvaluationTime.Qi(),this._captureRenderTargetsRenderTime&&this._renderTargetsRenderTime.Qi(),this._captureParticlesRenderTime&&this._particlesRenderTime.Qi(),this._captureSpritesRenderTime&&this._spritesRenderTime.Qi(),this._captureRenderTime&&this._renderTime.Qi(),this._captureCameraRenderTime&&this._cameraRenderTime.Qi()}))}dispose(){this.Ad.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=null,this.Ad.onBeforeActiveMeshesEvaluationObservable.remove(this._onBeforeActiveMeshesEvaluationObserver),this._onBeforeActiveMeshesEvaluationObserver=null,this.Ad.onAfterActiveMeshesEvaluationObservable.remove(this._onAfterActiveMeshesEvaluationObserver),this._onAfterActiveMeshesEvaluationObserver=null,this.Ad.onBeforeRenderTargetsRenderObservable.remove(this._onBeforeRenderTargetsRenderObserver),this._onBeforeRenderTargetsRenderObserver=null,this.Ad.onAfterRenderTargetsRenderObservable.remove(this._onAfterRenderTargetsRenderObserver),this._onAfterRenderTargetsRenderObserver=null,this.Ad.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.Ad.onBeforeParticlesRenderingObservable.remove(this._onBeforeParticlesRenderingObserver),this._onBeforeParticlesRenderingObserver=null,this.Ad.onAfterParticlesRenderingObservable.remove(this._onAfterParticlesRenderingObserver),this._onAfterParticlesRenderingObserver=null,this._onBeforeSpritesRenderingObserver&&(this.Ad.onBeforeSpritesRenderingObservable.remove(this._onBeforeSpritesRenderingObserver),this._onBeforeSpritesRenderingObserver=null),this._onAfterSpritesRenderingObserver&&(this.Ad.onAfterSpritesRenderingObservable.remove(this._onAfterSpritesRenderingObserver),this._onAfterSpritesRenderingObserver=null),this.Ad.onBeforeDrawPhaseObservable.remove(this._onBeforeDrawPhaseObserver),this._onBeforeDrawPhaseObserver=null,this.Ad.onAfterDrawPhaseObservable.remove(this._onAfterDrawPhaseObserver),this._onAfterDrawPhaseObserver=null,this._onBeforePhysicsObserver&&(this.Ad.onBeforePhysicsObservable.remove(this._onBeforePhysicsObserver),this._onBeforePhysicsObserver=null),this._onAfterPhysicsObserver&&(this.Ad.onAfterPhysicsObservable.remove(this._onAfterPhysicsObserver),this._onAfterPhysicsObserver=null),this.Ad.onAfterAnimationsObservable.remove(this._onAfterAnimationsObserver),this._onAfterAnimationsObserver=null,this.Ad.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=null,this.Ad.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=null,this.Ad=null}}},11994:(K,b,e)=>{"use strict";e.d(b,{d:()=>A});var z=e(10936),k=e(10938),j=e(10967),T=e(11243),F=e(11942),l=e(11997),Y=e(10799);T.e.AddNodeConstructor("Light_Type_1",((K,b)=>()=>new A(K,j.k.Zero(),b)));class A extends l.e{get shadowFrustumSize(){return this._shadowFrustumSize}set shadowFrustumSize(K){this._shadowFrustumSize=K,this.forceProjectionMatrixCompute()}get shadowOrthoScale(){return this._shadowOrthoScale}set shadowOrthoScale(K){this._shadowOrthoScale=K,this.forceProjectionMatrixCompute()}get orthoLeft(){return this._orthoLeft}set orthoLeft(K){this._orthoLeft=K}get orthoRight(){return this._orthoRight}set orthoRight(K){this._orthoRight=K}get orthoTop(){return this._orthoTop}set orthoTop(K){this._orthoTop=K}get orthoBottom(){return this._orthoBottom}set orthoBottom(K){this._orthoBottom=K}constructor(K,b,e){super(K,e),this._shadowFrustumSize=0,this._shadowOrthoScale=.1,this.autoUpdateExtends=!0,this.autoCalcShadowZBounds=!1,this._orthoLeft=Number.MAX_VALUE,this._orthoRight=Number.MIN_VALUE,this._orthoTop=Number.MIN_VALUE,this._orthoBottom=Number.MAX_VALUE,this.position=b.scale(-1),this.direction=b}getClassName(){return"lb"}getTypeID(){return F.b.LIGHTTYPEID_DIRECTIONALLIGHT}_setDefaultShadowProjectionMatrix(K,b,e){this.shadowFrustumSize>0?this._setDefaultFixedFrustumShadowProjectionMatrix(K):this._setDefaultAutoExtendShadowProjectionMatrix(K,b,e)}_setDefaultFixedFrustumShadowProjectionMatrix(K){const b=this.va().activeCamera;b&&j.b.OrthoLHToRef(this.shadowFrustumSize,this.shadowFrustumSize,void 0!==this.shadowMinZ?this.shadowMinZ:b.Fi,void 0!==this.shadowMaxZ?this.shadowMaxZ:b.maxZ,K,this.va().getEngine().isNDCHalfZRange)}_setDefaultAutoExtendShadowProjectionMatrix(K,b,e){const z=this.va().activeCamera;if(!z)return;if(this.autoUpdateExtends||this._orthoLeft===Number.MAX_VALUE){const K=j.k.Zero();this._orthoLeft=Number.MAX_VALUE,this._orthoRight=-Number.MAX_VALUE,this._orthoTop=-Number.MAX_VALUE,this._orthoBottom=Number.MAX_VALUE;let z=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(let T=0;T<e.length;T++){const F=e[T];if(!F)continue;const l=F.getBoundingInfo().boundingBox;for(let e=0;e<l.vectorsWorld.length;e++)j.k.TransformCoordinatesToRef(l.vectorsWorld[e],b,K),K.x<this._orthoLeft&&(this._orthoLeft=K.x),K.y<this._orthoBottom&&(this._orthoBottom=K.y),K.x>this._orthoRight&&(this._orthoRight=K.x),K.y>this._orthoTop&&(this._orthoTop=K.y),this.autoCalcShadowZBounds&&(K.z<z&&(z=K.z),K.z>k&&(k=K.z))}this.autoCalcShadowZBounds&&(this._shadowMinZ=z,this._shadowMaxZ=k)}const k=this._orthoRight-this._orthoLeft,T=this._orthoTop-this._orthoBottom,F=void 0!==this.shadowMinZ?this.shadowMinZ:z.Fi,l=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,Y=this.va().getEngine().useReverseDepthBuffer;j.b.OrthoOffCenterLHToRef(this._orthoLeft-k*this.shadowOrthoScale,this._orthoRight+k*this.shadowOrthoScale,this._orthoBottom-T*this.shadowOrthoScale,this._orthoTop+T*this.shadowOrthoScale,Y?l:F,Y?F:l,K,this.va().getEngine().isNDCHalfZRange)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,b){return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z,1,b),this):(this._uniformBuffer.updateFloat4("vLightData",this.direction.x,this.direction.y,this.direction.z,1,b),this)}transferToNodeMaterialEffect(K,b){return this.computeTransformedInformation()?(K.setFloat3(b,this.transformedDirection.x,this.transformedDirection.y,this.transformedDirection.z),this):(K.setFloat3(b,this.direction.x,this.direction.y,this.direction.z),this)}getDepthMinZ(K){const b=this._scene.getEngine();return!b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}getDepthMaxZ(K){const b=this._scene.getEngine();return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:1}prepareLightSpecificDefines(K,b){K["DIRLIGHT"+b]=!0}}(0,z.b)([(0,k.M)()],A.prototype,"shadowFrustumSize",null),(0,z.b)([(0,k.M)()],A.prototype,"shadowOrthoScale",null),(0,z.b)([(0,k.M)()],A.prototype,"autoUpdateExtends",void 0),(0,z.b)([(0,k.M)()],A.prototype,"autoCalcShadowZBounds",void 0),(0,z.b)([(0,k.M)("orthoLeft")],A.prototype,"_orthoLeft",void 0),(0,z.b)([(0,k.M)("orthoRight")],A.prototype,"_orthoRight",void 0),(0,z.b)([(0,k.M)("orthoTop")],A.prototype,"_orthoTop",void 0),(0,z.b)([(0,k.M)("orthoBottom")],A.prototype,"_orthoBottom",void 0),(0,Y.e)("BABYLON.DirectionalLight",A)},12348:(K,b,e)=>{"use strict";e.d(b,{e:()=>A});var z=e(10936),k=e(10938),j=e(10967),T=e(10994),F=e(11243),l=e(11942),Y=e(10799);F.e.AddNodeConstructor("Light_Type_3",((K,b)=>()=>new A(K,j.k.Zero(),b)));class A extends l.b{constructor(K,b,e){super(K,e),this.groundColor=new T.c(0,0,0),this.direction=b||j.k.Up()}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightGround",3),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}getClassName(){return"mb"}setDirectionToTarget(K){return this.direction=j.k.Normalize(K.Qc(j.k.Zero())),this.direction}getShadowGenerator(){return null}transferToEffect(K,b){const e=j.k.Normalize(this.direction);return this._uniformBuffer.updateFloat4("vLightData",e.x,e.y,e.z,0,b),this._uniformBuffer.updateColor3("vLightGround",this.groundColor.scale(this.Ji),b),this}transferToNodeMaterialEffect(K,b){const e=j.k.Normalize(this.direction);return K.setFloat3(b,e.x,e.y,e.z),this}xj(){return this._worldMatrix||(this._worldMatrix=j.b.Identity()),this._worldMatrix}getTypeID(){return l.b.LIGHTTYPEID_HEMISPHERICLIGHT}prepareLightSpecificDefines(K,b){K["HEMILIGHT"+b]=!0}}(0,z.b)([(0,k.m)()],A.prototype,"groundColor",void 0),(0,z.b)([(0,k.L)()],A.prototype,"direction",void 0),(0,Y.e)("BABYLON.HemisphericLight",A)},11942:(K,b,e)=>{"use strict";e.d(b,{b:()=>t});var z=e(10936),k=e(10938),j=e(10967),T=e(10994),F=e(11243),l=e(11017),Y=e(10799),A=e(11079),X=e(11001);class t extends F.e{get range(){return this._range}set range(K){this._range=K,this._inverseSquaredRange=1/(this.range*this.range)}get intensityMode(){return this._intensityMode}set intensityMode(K){this._intensityMode=K,this._computePhotometricScale()}get radius(){return this._radius}set radius(K){this._radius=K,this._computePhotometricScale()}get shadowEnabled(){return this._shadowEnabled}set shadowEnabled(K){this._shadowEnabled!==K&&(this._shadowEnabled=K,this._markMeshesAsLightDirty())}get includedOnlyMeshes(){return this._includedOnlyMeshes}set includedOnlyMeshes(K){this._includedOnlyMeshes=K,this._hookArrayForIncludedOnly(K)}get excludedMeshes(){return this._excludedMeshes}set excludedMeshes(K){this._excludedMeshes=K,this._hookArrayForExcluded(K)}get excludeWithLayerMask(){return this._excludeWithLayerMask}set excludeWithLayerMask(K){this._excludeWithLayerMask=K,this._resyncMeshes()}get includeOnlyWithLayerMask(){return this._includeOnlyWithLayerMask}set includeOnlyWithLayerMask(K){this._includeOnlyWithLayerMask=K,this._resyncMeshes()}get lightmapMode(){return this._lightmapMode}set lightmapMode(K){this._lightmapMode!==K&&(this._lightmapMode=K,this._markMeshesAsLightDirty())}getViewMatrix(K){return null}getProjectionMatrix(K,b){return null}constructor(K,b){super(K,b,!1),this._g=new T.c(1,1,1),this.ah=new T.c(1,1,1),this.falloffType=t.FALLOFF_DEFAULT,this.Ji=1,this._range=Number.MAX_VALUE,this._inverseSquaredRange=0,this._photometricScale=1,this._intensityMode=t.INTENSITYMODE_AUTOMATIC,this._radius=1e-5,this.renderPriority=0,this._shadowEnabled=!0,this._excludeWithLayerMask=0,this._includeOnlyWithLayerMask=0,this._lightmapMode=0,this._shadowGenerators=null,this._excludedMeshesIds=new Array,this._includedOnlyMeshesIds=new Array,this._isLight=!0,this.va().addLight(this),this._uniformBuffer=new l.d(this.va().getEngine(),void 0,void 0,K),this._buildUniformLayout(),this.includedOnlyMeshes=[],this.excludedMeshes=[],this._resyncMeshes()}transferTexturesToEffect(K,b){return this}_bindLight(K,b,e,z){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const j=K.toString();let F=!1;if(this._uniformBuffer.bindToEffect(e,"Light"+j),this._renderId!==b.getRenderId()||this._lastUseSpecular!==z||!this._uniformBuffer.useUbo){this._renderId=b.getRenderId(),this._lastUseSpecular=z;const K=this.getScaledIntensity();this.transferToEffect(e,j),this._g.scaleToRef(K,T.i.hb[0]),this._uniformBuffer.updateColor4("vLightDiffuse",T.i.hb[0],this.range,j),z&&(this.ah.scaleToRef(K,T.i.hb[1]),this._uniformBuffer.updateColor4("vLightSpecular",T.i.hb[1],this.radius,j)),F=!0}if(this.transferTexturesToEffect(e,j),b.shadowsEnabled&&this.shadowEnabled&&k){const K=this.getShadowGenerator(b.activeCamera)??this.getShadowGenerator();K&&(K.bindShadowLight(j,e),F=!0)}F?this._uniformBuffer.update():this._uniformBuffer.bindUniformBuffer()}getClassName(){return"Light"}toString(K){let b="Name: "+this.name;if(b+=", type: "+["Point","Directional","Spot","Hemispheric"][this.getTypeID()],this.animations)for(let e=0;e<this.animations.length;e++)b+=", animation[0]: "+this.animations[e].toString(K);return b}_syncParentEnabledState(){super._syncParentEnabledState(),this.u()||this._resyncMeshes()}yb(K){super.yb(K),this._resyncMeshes()}getShadowGenerator(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return null===this._shadowGenerators?null:this._shadowGenerators.get(K)??null}getShadowGenerators(){return this._shadowGenerators}getAbsolutePosition(){return j.k.Zero()}canAffectMesh(K){return!K||!(this.includedOnlyMeshes&&this.includedOnlyMeshes.length>0&&-1===this.includedOnlyMeshes.indexOf(K))&&(!(this.excludedMeshes&&this.excludedMeshes.length>0&&-1!==this.excludedMeshes.indexOf(K))&&((0===this.includeOnlyWithLayerMask||0!==(this.includeOnlyWithLayerMask&K.layerMask))&&!(0!==this.excludeWithLayerMask&&this.excludeWithLayerMask&K.layerMask)))}dispose(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._shadowGenerators){const K=this._shadowGenerators.values();for(let b=K.next();!0!==b.done;b=K.next()){b.value.dispose()}this._shadowGenerators=null}if(this.va().stopAnimation(this),this._parentContainer){const K=this._parentContainer.lights.indexOf(this);K>-1&&this._parentContainer.lights.splice(K,1),this._parentContainer=null}for(const e of this.va().meshes)e._removeLightSource(this,!0);this._uniformBuffer.dispose(),this.va().removeLight(this),super.dispose(K,b)}getTypeID(){return 0}getScaledIntensity(){return this._photometricScale*this.Ji}clone(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=t.GetConstructorFromName(this.getTypeID(),K,this.va());if(!e)return null;const z=X.e.Clone(e,this);return K&&(z.name=K),b&&(z.parent=b),z.yb(this.isEnabled()),this.onClonedObservable.notifyObservers(z),z}serialize(){const K=X.e.Serialize(this);return K.uniqueId=this.uniqueId,K.type=this.getTypeID(),this.parent&&this.parent._serializeAsParent(K),this.excludedMeshes.length>0&&(K.excludedMeshesIds=[],this.excludedMeshes.forEach((b=>{K.excludedMeshesIds.push(b.id)}))),this.includedOnlyMeshes.length>0&&(K.includedOnlyMeshesIds=[],this.includedOnlyMeshes.forEach((b=>{K.includedOnlyMeshesIds.push(b.id)}))),X.e.AppendSerializedAnimations(this,K),K.ranges=this.serializeAnimationRanges(),K.isEnabled=this.isEnabled(),K}static GetConstructorFromName(K,b,e){const z=F.e.Construct("Light_Type_"+K,b,e);return z||null}static Parse(K,b){const e=t.GetConstructorFromName(K.type,K.name,b);if(!e)return null;const z=X.e.Parse(e,K,b);if(K.excludedMeshesIds&&(z._excludedMeshesIds=K.excludedMeshesIds),K.includedOnlyMeshesIds&&(z._includedOnlyMeshesIds=K.includedOnlyMeshesIds),void 0!==K.parentId&&(z._waitingParentId=K.parentId),void 0!==K.parentInstanceIndex&&(z._waitingParentInstanceIndex=K.parentInstanceIndex),void 0!==K.falloffType&&(z.falloffType=K.falloffType),void 0!==K.lightmapMode&&(z.lightmapMode=K.lightmapMode),K.animations){for(let b=0;b<K.animations.length;b++){const e=K.animations[b],k=(0,Y.d)("BABYLON.Animation");k&&z.animations.push(k.Parse(e))}F.e.ParseAnimationRanges(z,K,b)}return K.autoAnimate&&b.beginAnimation(z,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),void 0!==K.isEnabled&&z.yb(K.isEnabled),z}_hookArrayForExcluded(K){var b=this;const e=K.push;K.push=function(){for(var z=arguments.length,k=new Array(z),j=0;j<z;j++)k[j]=arguments[j];const T=e.apply(K,k);for(const K of k)K._resyncLightSource(b);return T};const z=K.splice;K.splice=(b,e)=>{const k=z.apply(K,[b,e]);for(const K of k)K._resyncLightSource(this);return k};for(const k of K)k._resyncLightSource(this)}_hookArrayForIncludedOnly(K){var b=this;const e=K.push;K.push=function(){for(var z=arguments.length,k=new Array(z),j=0;j<z;j++)k[j]=arguments[j];const T=e.apply(K,k);return b._resyncMeshes(),T};const z=K.splice;K.splice=(b,e)=>{const k=z.apply(K,[b,e]);return this._resyncMeshes(),k},this._resyncMeshes()}_resyncMeshes(){for(const K of this.va().meshes)K._resyncLightSource(this)}_markMeshesAsLightDirty(){for(const K of this.va().meshes)-1!==K.lightSources.indexOf(this)&&K._markSubMeshesAsLightDirty()}_computePhotometricScale(){this._photometricScale=this._getPhotometricScale(),this.va().resetCachedMaterial()}_getPhotometricScale(){let K=0;const b=this.getTypeID();let e=this.intensityMode;switch(e===t.INTENSITYMODE_AUTOMATIC&&(e=b===t.LIGHTTYPEID_DIRECTIONALLIGHT?t.INTENSITYMODE_ILLUMINANCE:t.INTENSITYMODE_LUMINOUSINTENSITY),b){case t.LIGHTTYPEID_POINTLIGHT:case t.LIGHTTYPEID_SPOTLIGHT:switch(e){case t.INTENSITYMODE_LUMINOUSPOWER:K=1/(4*Math.PI);break;case t.INTENSITYMODE_LUMINOUSINTENSITY:K=1;break;case t.INTENSITYMODE_LUMINANCE:K=this.radius*this.radius}break;case t.LIGHTTYPEID_DIRECTIONALLIGHT:switch(e){case t.INTENSITYMODE_ILLUMINANCE:K=1;break;case t.INTENSITYMODE_LUMINANCE:{let b=this.radius;b=Math.max(b,.001);K=2*Math.PI*(1-Math.cos(b));break}}break;case t.LIGHTTYPEID_HEMISPHERICLIGHT:K=1}return K}_reorderLightsInScene(){const K=this.va();0!=this._renderPriority&&(K.requireLightSorting=!0),this.va().sortLightsByPriority()}}t.FALLOFF_DEFAULT=A.c.FALLOFF_DEFAULT,t.FALLOFF_PHYSICAL=A.c.FALLOFF_PHYSICAL,t.FALLOFF_GLTF=A.c.FALLOFF_GLTF,t.FALLOFF_STANDARD=A.c.FALLOFF_STANDARD,t.LIGHTMAP_DEFAULT=A.c.LIGHTMAP_DEFAULT,t.LIGHTMAP_SPECULAR=A.c.LIGHTMAP_SPECULAR,t.LIGHTMAP_SHADOWSONLY=A.c.LIGHTMAP_SHADOWSONLY,t.INTENSITYMODE_AUTOMATIC=A.c.INTENSITYMODE_AUTOMATIC,t.INTENSITYMODE_LUMINOUSPOWER=A.c.INTENSITYMODE_LUMINOUSPOWER,t.INTENSITYMODE_LUMINOUSINTENSITY=A.c.INTENSITYMODE_LUMINOUSINTENSITY,t.INTENSITYMODE_ILLUMINANCE=A.c.INTENSITYMODE_ILLUMINANCE,t.INTENSITYMODE_LUMINANCE=A.c.INTENSITYMODE_LUMINANCE,t.LIGHTTYPEID_POINTLIGHT=A.c.LIGHTTYPEID_POINTLIGHT,t.LIGHTTYPEID_DIRECTIONALLIGHT=A.c.LIGHTTYPEID_DIRECTIONALLIGHT,t.LIGHTTYPEID_SPOTLIGHT=A.c.LIGHTTYPEID_SPOTLIGHT,t.LIGHTTYPEID_HEMISPHERICLIGHT=A.c.LIGHTTYPEID_HEMISPHERICLIGHT,(0,z.b)([(0,k.m)()],t.prototype,"diffuse",void 0),(0,z.b)([(0,k.m)()],t.prototype,"specular",void 0),(0,z.b)([(0,k.M)()],t.prototype,"falloffType",void 0),(0,z.b)([(0,k.M)()],t.prototype,"intensity",void 0),(0,z.b)([(0,k.M)()],t.prototype,"range",null),(0,z.b)([(0,k.M)()],t.prototype,"intensityMode",null),(0,z.b)([(0,k.M)()],t.prototype,"radius",null),(0,z.b)([(0,k.M)()],t.prototype,"_renderPriority",void 0),(0,z.b)([(0,k.b)("_reorderLightsInScene")],t.prototype,"renderPriority",void 0),(0,z.b)([(0,k.M)("shadowEnabled")],t.prototype,"_shadowEnabled",void 0),(0,z.b)([(0,k.M)("excludeWithLayerMask")],t.prototype,"_excludeWithLayerMask",void 0),(0,z.b)([(0,k.M)("includeOnlyWithLayerMask")],t.prototype,"_includeOnlyWithLayerMask",void 0),(0,z.b)([(0,k.M)("lightmapMode")],t.prototype,"_lightmapMode",void 0)},11079:(K,b,e)=>{"use strict";e.d(b,{c:()=>z});class z{static CompareLightsPriority(K,b){return K.shadowEnabled!==b.shadowEnabled?(b.shadowEnabled?1:0)-(K.shadowEnabled?1:0):b.renderPriority-K.renderPriority}}z.FALLOFF_DEFAULT=0,z.FALLOFF_PHYSICAL=1,z.FALLOFF_GLTF=2,z.FALLOFF_STANDARD=3,z.LIGHTMAP_DEFAULT=0,z.LIGHTMAP_SPECULAR=1,z.LIGHTMAP_SHADOWSONLY=2,z.INTENSITYMODE_AUTOMATIC=0,z.INTENSITYMODE_LUMINOUSPOWER=1,z.INTENSITYMODE_LUMINOUSINTENSITY=2,z.INTENSITYMODE_ILLUMINANCE=3,z.INTENSITYMODE_LUMINANCE=4,z.LIGHTTYPEID_POINTLIGHT=0,z.LIGHTTYPEID_DIRECTIONALLIGHT=1,z.LIGHTTYPEID_SPOTLIGHT=2,z.LIGHTTYPEID_HEMISPHERICLIGHT=3},11997:(K,b,e)=>{"use strict";e.d(b,{e:()=>l});var z=e(10936),k=e(10938),j=e(10967),T=e(11942),F=e(11291);class l extends T.b{constructor(){super(...arguments),this._needProjectionMatrixCompute=!0,this._viewMatrix=j.b.Identity(),this._projectionMatrix=j.b.Identity()}_setPosition(K){this._position=K}get position(){return this._position}set position(K){this._setPosition(K)}_setDirection(K){this._direction=K}get direction(){return this._direction}set direction(K){this._setDirection(K)}get shadowMinZ(){return this._shadowMinZ}set shadowMinZ(K){this._shadowMinZ=K,this.forceProjectionMatrixCompute()}get shadowMaxZ(){return this._shadowMaxZ}set shadowMaxZ(K){this._shadowMaxZ=K,this.forceProjectionMatrixCompute()}computeTransformedInformation(){return!(!this.parent||!this.parent.getWorldMatrix)&&(this.transformedPosition||(this.transformedPosition=j.k.Zero()),j.k.TransformCoordinatesToRef(this.position,this.parent.getWorldMatrix(),this.transformedPosition),this.direction&&(this.transformedDirection||(this.transformedDirection=j.k.Zero()),j.k.TransformNormalToRef(this.direction,this.parent.getWorldMatrix(),this.transformedDirection)),!0)}getDepthScale(){return 50}getShadowDirection(K){return this.transformedDirection?this.transformedDirection:this.direction}getAbsolutePosition(){return this.transformedPosition?this.transformedPosition:this.position}setDirectionToTarget(K){return this.direction=j.k.Normalize(K.Qc(this.position)),this.direction}getRotation(){this.direction.normalize();const K=j.k.Cross(this.direction,F.e.Y),b=j.k.Cross(K,this.direction);return j.k.RotationFromAxis(K,b,this.direction)}needCube(){return!1}needProjectionMatrixCompute(){return this._needProjectionMatrixCompute}forceProjectionMatrixCompute(){this._needProjectionMatrixCompute=!0}_initCache(){super._initCache(),this._cache.position=j.k.Zero()}_isSynchronized(){return!!this._cache.position.equals(this.position)}xj(K){return!K&&this.isSynchronized()?(this._currentRenderId=this.va().getRenderId(),this._worldMatrix):(this._updateCache(),this._cache.position.p(this.position),this._worldMatrix||(this._worldMatrix=j.b.Identity()),j.b.TranslationToRef(this.position.x,this.position.y,this.position.z,this._worldMatrix),this.parent&&this.parent.getWorldMatrix&&(this._worldMatrix.multiplyToRef(this.parent.getWorldMatrix(),this._worldMatrix),this._markSyncedWithParent()),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix)}getDepthMinZ(K){return void 0!==this.shadowMinZ?this.shadowMinZ:K.Fi}getDepthMaxZ(K){return void 0!==this.shadowMaxZ?this.shadowMaxZ:K.maxZ}setShadowProjectionMatrix(K,b,e){return this.customProjectionMatrixBuilder?this.customProjectionMatrixBuilder(b,e,K):this._setDefaultShadowProjectionMatrix(K,b,e),this}_syncParentEnabledState(){super._syncParentEnabledState(),this.parent&&this.parent.getWorldMatrix||(this.transformedPosition=null,this.transformedDirection=null)}getViewMatrix(K){const b=j.e.gb[0];let e=this.position;this.computeTransformedInformation()&&(e=this.transformedPosition),j.k.NormalizeToRef(this.getShadowDirection(K),b),1===Math.abs(j.k.Dot(b,j.k.Up()))&&(b.z=1e-13);const z=j.e.gb[1];return e.addToRef(b,z),j.b.LookAtLHToRef(e,z,j.k.Up(),this._viewMatrix),this._viewMatrix}getProjectionMatrix(K,b){return this.setShadowProjectionMatrix(this._projectionMatrix,K??this._viewMatrix,b??[]),this._projectionMatrix}}(0,z.b)([(0,k.L)()],l.prototype,"position",null),(0,z.b)([(0,k.L)()],l.prototype,"direction",null),(0,z.b)([(0,k.M)()],l.prototype,"shadowMinZ",null),(0,z.b)([(0,k.M)()],l.prototype,"shadowMaxZ",null)},11609:(K,b,e)=>{"use strict";e.d(b,{d:()=>T,g:()=>j,i:()=>F});const z={},k={};function j(K,b){z[K]=b}function T(K,b){k[K]=b}function F(K){return k[K]?k[K]:null}},11354:(K,b,e)=>{"use strict";e.d(b,{b:()=>n,d:()=>i});var z,k=e(10686),j=e(10690),T=e(10960),F=e(10720),l=e(10696),Y=e(11274),A=e(10723),X=e(10728),t=e(10801),U=e(10750);!function(K){K[K.Clean=0]="Clean",K[K.Stop=1]="Stop",K[K.Sync=2]="Sync",K[K.NoSync=3]="NoSync"}(z||(z={}));const B=new j.d,u={};let m=!1;function D(){return u[".babylon"]}function I(K){const b=u[K];return b||(l.b.Warn("Unable to find a plugin to load "+K+" files. Trying to use .babylon default plugin. To load from a specific filetype (eg. gltf) see: https://doc.babylonjs.com/features/featuresDeepDive/importers/loadingFileTypes"),D())}function x(K,b,e){let z="Unable to load from "+(K.rawData?"binary data":K.url);return b?z+=`: ${b}`:e&&(z+=`: ${e}`),z}function Q(K,b,e,z,k,j,T,F,l){var Y;const X="data:"===(t=K.url).substring(0,5)?t.substring(5):null;var t;if(K.rawData&&!T)throw"When using ArrayBufferView to load data the file extension must be provided.";const m=T?I(T):X?function(K){for(const b in u){const e=u[b].plugin;if(e.canDirectLoad&&e.canDirectLoad(K))return u[b]}return D()}(K.url):function(K){const b=K.indexOf("?");-1!==b&&(K=K.substring(0,b));const e=K.lastIndexOf(".");return I(K.substring(e,K.length).toLowerCase())}(K.url);if(!m)throw new Error(`No plugin or fallback for ${T??K.url}`);if(!1===(null===l||void 0===l||null===(Y=l[m.plugin.name])||void 0===Y?void 0:Y.enabled))throw new Error(`The '${m.plugin.name}' plugin is disabled via the loader options passed to the loading operation.`);if(K.rawData&&!m.isBinary)throw"Loading from ArrayBufferView can not be used with plugins that don't support binary loading.";return(K=>{if(m.plugin.createPlugin){const b=m.plugin.createPlugin(l??{});return b instanceof Promise?(b.then(K).catch((K=>{k("Error instantiating plugin.",K)})),null):(K(b),b)}return K(m.plugin),m.plugin})((l=>{var Y;if(!l)throw`The loader plugin corresponding to the '${T}' file type has not been found. If using es6, please import the plugin you wish to use before.`;if(B.notifyObservers(l),X&&(l.canDirectLoad&&l.canDirectLoad(K.url)||!(0,A.k)(K.url))){if(l.directLoad){const K=l.directLoad(b,X);K instanceof Promise?K.then((K=>{e(l,K)})).catch((K=>{k("Error in directLoad of _loadData: "+K,K)})):e(l,K)}else e(l,X);return}const t=m.isBinary,u=(K,z)=>{b.u?k("Scene has been disposed"):e(l,K,z)};let D=null,I=!1;null===(Y=l.Ui)||void 0===Y||Y.add((()=>{I=!0,D&&(D.abort(),D=null),j()}));const x=()=>{if(I)return;const e=(K,b)=>{k(null===K||void 0===K?void 0:K.statusText,b)};if(!l.loadFile&&K.rawData)throw"Plugin does not support loading ArrayBufferView.";D=l.loadFile?l.loadFile(b,K.rawData||K.file||K.url,K.rootUrl,u,z,t,e,F):b._loadFile(K.file||K.url,u,z,!0,t,e)},Q=b.getEngine();let G=Q.enableOfflineSupport;if(G){let e=!1;for(const z of b.disableOfflineSupportExceptionRules)if(z.test(K.url)){e=!0;break}G=!e}G&&U.e.OfflineProviderFactory?b.offlineProvider=U.e.OfflineProviderFactory(K.url,x,Q.disableManifestCheck):x()}))}function G(K,b){let e,z,j=null,T=null;if(b)if(b.name)e=`file:${b.name}`,z=b.name,j=b;else if(ArrayBuffer.isView(b))e="",z=(0,t.b)(),T=b;else if(b.startsWith("data:"))e=b,z="";else if(K){const j=b;if("/"===j.substring(0,1))return k.f.Error("Wrong sceneFilename parameter"),null;e=K+j,z=j}else e=b,z=k.f.GetFilename(b),K=k.f.GetFolderPath(b);else e=K,z=k.f.GetFilename(K),K=k.f.GetFolderPath(K);return{url:e,rootUrl:K,name:z,file:j,rawData:T}}function i(K){if("string"===typeof K.extensions){const b=K.extensions;u[b.toLowerCase()]={plugin:K,isBinary:!1}}else{const b=K.extensions;Object.keys(b).forEach((e=>{u[e.toLowerCase()]={plugin:K,isBinary:b[e].isBinary}}))}}function S(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:F.b.LastCreatedScene,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:"",t=arguments.length>9&&void 0!==arguments[9]?arguments[9]:{};if(!z)return l.b.Error("No scene available to import mesh to"),null;const U=G(b,e);if(!U)return null;const B={};z.addPendingData(B);const u=()=>{z.removePendingData(B)},m=(K,b)=>{const e=x(U,K,b);T?T(z,e,new X.h(e,X.d.SceneLoaderError,b)):l.b.Error(e),u()},D=j?K=>{try{j(K)}catch(b){m("Error in onProgress callback: "+b,b)}}:void 0,I=(K,b,e,j,T,F,l,Y)=>{if(z.importedMeshesFiles.push(U.url),k)try{k(K,b,e,j,T,F,l,Y)}catch(A){m("Error in onSuccess callback: "+A,A)}z.removePendingData(B)};return Q(U,z,((b,e,k)=>{if(b.rewriteRootURL&&(U.rootUrl=b.rewriteRootURL(U.rootUrl,k)),b.importMesh){const k=[],j=[],T=[];if(!b.importMesh(K,z,e,U.rootUrl,k,j,T,m))return;z.loadingPluginName=b.name,I(k,j,T,[],[],[],[],[])}else{b.importMeshAsync(K,z,e,U.rootUrl,D,U.name).then((K=>{z.loadingPluginName=b.name,I(K.meshes,K._i,K.skeletons,K.animationGroups,K.transformNodes,K.geometries,K.lights,K.spriteManagers)})).catch((K=>{m(K.message,K)}))}}),D,m,u,Y,A,t)}function M(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.LastCreatedEngine,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};return e?L(K,b,new T.e(e),z,j,l,Y,A,X):(k.f.Error("No engine available"),null)}function r(K,b,e,z,k,j,T){return new Promise(((F,l)=>{M(K,b,e,(K=>{F(K)}),z,((K,b,e)=>{l(e||new Error(b))}),k,j,T)}))}function L(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",t=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!e)return l.b.Error("No scene available to append to"),null;const U=G(K,b);if(!U)return null;const B={};e.addPendingData(B);const u=()=>{e.removePendingData(B)};Y.b.ShowLoadingScreen&&!m&&(m=!0,e.getEngine().displayLoadingUI(),e.executeWhenReady((()=>{e.getEngine().hideLoadingUI(),m=!1})));const D=(K,b)=>{const z=x(U,K,b);j?j(e,z,new X.h(z,X.d.SceneLoaderError,b)):l.b.Error(z),u()},I=k?K=>{try{k(K)}catch(b){D("Error in onProgress callback",b)}}:void 0,i=()=>{if(z)try{z(e)}catch(K){D("Error in onSuccess callback",K)}e.removePendingData(B)};return Q(U,e,((K,b)=>{if(K.load){if(!K.load(e,b,U.rootUrl,D))return;e.loadingPluginName=K.name,i()}else{K.loadAsync(e,b,U.rootUrl,I,U.name).then((()=>{e.loadingPluginName=K.name,i()})).catch((K=>{D(K.message,K)}))}}),I,D,u,T,A,t)}function c(K,b,e,z,k,j,T){return new Promise(((F,l)=>{L(K,b,e,(K=>{F(K)}),z,((K,b,e)=>{l(e||new Error(b))}),k,j,T)}))}function v(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.LastCreatedScene,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:{};if(!e)return l.b.Error("No scene available to load asset container to"),null;const t=G(K,b);if(!t)return null;const U={};e.addPendingData(U);const B=()=>{e.removePendingData(U)},u=(K,b)=>{const z=x(t,K,b);j?j(e,z,new X.h(z,X.d.SceneLoaderError,b)):l.b.Error(z),B()},m=k?K=>{try{k(K)}catch(b){u("Error in onProgress callback",b)}}:void 0,D=K=>{if(z)try{z(K)}catch(b){u("Error in onSuccess callback",b)}e.removePendingData(U)};return Q(t,e,((K,b)=>{if(K.loadAssetContainer){const z=K.loadAssetContainer(e,b,t.rootUrl,u);if(!z)return;z.populateRootNodes(),e.loadingPluginName=K.name,D(z)}else if(K.loadAssetContainerAsync){K.loadAssetContainerAsync(e,b,t.rootUrl,m,t.name).then((b=>{b.populateRootNodes(),e.loadingPluginName=K.name,D(b)})).catch((K=>{u(K.message,K)}))}else u("LoadAssetContainer is not supported by this plugin. Plugin did not provide a loadAssetContainer or loadAssetContainerAsync method.")}),m,u,B,T,Y,A)}function w(K,b,e,z,k,j,T){return new Promise(((F,l)=>{v(K,b,e,(K=>{F(K)}),z,((K,b,e)=>{l(e||new Error(b))}),k,j,T)}))}function h(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:F.b.LastCreatedScene,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,A=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,X=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,t=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",U=arguments.length>11&&void 0!==arguments[11]?arguments[11]:{};if(!e)return void l.b.Error("No scene available to load animations to");if(z){for(const K of e.animatables)K.reset();e.stopAllAnimations(),e.animationGroups.slice().forEach((K=>{K.dispose()}));e.getNodes().forEach((K=>{K.animations&&(K.animations=[])}))}else switch(k){case 0:e.animationGroups.slice().forEach((K=>{K.dispose()}));break;case 1:e.animationGroups.forEach((K=>{K.stop()}));break;case 2:e.animationGroups.forEach((K=>{K.reset(),K.restart()}));break;case 3:break;default:return void l.b.Error("Unknown animation group loading mode value '"+k+"'")}const B=e.animatables.length;v(K,b,e,(K=>{K.mergeAnimationsTo(e,e.animatables.slice(B),j),K.dispose(),e.onAnimationFileImportedObservable.notifyObservers(e),T&&T(e)}),Y,A,X,t,U)}function R(K,b,e,z,k,j,T,F,l,Y){return new Promise(((A,X)=>{h(K,b,e,z,k,j,(K=>{A(K)}),T,((K,b,e)=>{X(e||new Error(b))}),F,l,Y)}))}class n{static get ForceFullSceneLoadingForIncremental(){return Y.b.ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(K){Y.b.ForceFullSceneLoadingForIncremental=K}static get ShowLoadingScreen(){return Y.b.ShowLoadingScreen}static set ShowLoadingScreen(K){Y.b.ShowLoadingScreen=K}static get loggingLevel(){return Y.b.loggingLevel}static set loggingLevel(K){Y.b.loggingLevel=K}static get CleanBoneMatrixWeights(){return Y.b.CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(K){Y.b.CleanBoneMatrixWeights=K}static GetDefaultPlugin(){return D()}static GetPluginForExtension(K){var b;return null===(b=I(K))||void 0===b?void 0:b.plugin}static IsPluginForExtensionAvailable(K){return function(K){return!!u[K]}(K)}static RegisterPlugin(K){i(K)}static ImportMesh(K,b,e,z,k,j,T,F,l){return S(K,b,e,z,k,j,T,F,l)}static ImportMeshAsync(K,b,e,z,k,j,T){return function(K,b,e,z,k,j,T,F){return new Promise(((l,Y)=>{S(K,b,e,z,((K,b,e,z,k,j,T,F)=>{l({meshes:K,_i:b,skeletons:e,animationGroups:z,transformNodes:k,geometries:j,lights:T,spriteManagers:F})}),k,((K,b,e)=>{Y(e||new Error(b))}),j,T,F)}))}(K,b,e,z,k,j,T)}static Load(K,b,e,z,k,j,T,F){return M(K,b,e,z,k,j,T,F)}static LoadAsync(K,b,e,z,k,j){return r(K,b,e,z,k,j)}static Append(K,b,e,z,k,j,T,F){return L(K,b,e,z,k,j,T,F)}static AppendAsync(K,b,e,z,k,j){return c(K,b,e,z,k,j)}static LoadAssetContainer(K,b,e,z,k,j,T,F){return v(K,b,e,z,k,j,T,F)}static LoadAssetContainerAsync(K,b,e,z,k,j){return w(K,b,e,z,k,j)}static ImportAnimations(K,b,e,z,k,j,T,F,l,Y,A){h(K,b,e,z,k,j,T,F,l,Y,A)}static ImportAnimationsAsync(K,b,e,z,k,j,T,F,l,Y,A){return R(K,b,e,z,k,j,F,Y,A)}}n.NO_LOGGING=0,n.MINIMAL_LOGGING=1,n.SUMMARY_LOGGING=2,n.DETAILED_LOGGING=3,n.OnPluginActivatedObservable=B},11274:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{static get ForceFullSceneLoadingForIncremental(){return z._ForceFullSceneLoadingForIncremental}static set ForceFullSceneLoadingForIncremental(K){z._ForceFullSceneLoadingForIncremental=K}static get ShowLoadingScreen(){return z._ShowLoadingScreen}static set ShowLoadingScreen(K){z._ShowLoadingScreen=K}static get loggingLevel(){return z._LoggingLevel}static set loggingLevel(K){z._LoggingLevel=K}static get CleanBoneMatrixWeights(){return z._CleanBoneMatrixWeights}static set CleanBoneMatrixWeights(K){z._CleanBoneMatrixWeights=K}}z._ForceFullSceneLoadingForIncremental=!1,z._ShowLoadingScreen=!0,z._CleanBoneMatrixWeights=!1,z._LoggingLevel=0},11917:(K,b,e)=>{"use strict";e.d(b,{d:()=>N});var z=e(10936),k=e(10938),j=e(10696),T=e(10951),F=e(11906),l=e(10960),Y=e(10967),A=e(11030),X=e(11146),t=e(11215);class U extends X.d{constructor(){super(...arguments),this.BRDF_V_HEIGHT_CORRELATED=!1,this.MS_BRDF_ENERGY_CONSERVATION=!1,this.SPHERICAL_HARMONICS=!1,this.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=!1}}class B extends t.b{_markAllSubMeshesAsMiscDirty(){this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRBRDF",90,new U,b),this._useEnergyConservation=B.DEFAULT_USE_ENERGY_CONSERVATION,this.useEnergyConservation=B.DEFAULT_USE_ENERGY_CONSERVATION,this._useSmithVisibilityHeightCorrelated=B.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this.useSmithVisibilityHeightCorrelated=B.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED,this._useSphericalHarmonics=B.DEFAULT_USE_SPHERICAL_HARMONICS,this.useSphericalHarmonics=B.DEFAULT_USE_SPHERICAL_HARMONICS,this._useSpecularGlossinessInputEnergyConservation=B.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this.useSpecularGlossinessInputEnergyConservation=B.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION,this._internalMarkAllSubMeshesAsMiscDirty=K._dirtyCallbacks[16],this._enable(!0)}prepareDefines(K){K.BRDF_V_HEIGHT_CORRELATED=this._useSmithVisibilityHeightCorrelated,K.MS_BRDF_ENERGY_CONSERVATION=this._useEnergyConservation&&this._useSmithVisibilityHeightCorrelated,K.SPHERICAL_HARMONICS=this._useSphericalHarmonics,K.SPECULAR_GLOSSINESS_ENERGY_CONSERVATION=this._useSpecularGlossinessInputEnergyConservation}getClassName(){return"PBRBRDFConfiguration"}}B.DEFAULT_USE_ENERGY_CONSERVATION=!0,B.DEFAULT_USE_SMITH_VISIBILITY_HEIGHT_CORRELATED=!0,B.DEFAULT_USE_SPHERICAL_HARMONICS=!0,B.DEFAULT_USE_SPECULAR_GLOSSINESS_INPUT_ENERGY_CONSERVATION=!0,(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],B.prototype,"useEnergyConservation",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],B.prototype,"useSmithVisibilityHeightCorrelated",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],B.prototype,"useSphericalHarmonics",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],B.prototype,"useSpecularGlossinessInputEnergyConservation",void 0);var u=e(11082),m=e(10994),D=e(10990),I=e(11085),x=e(11155),Q=e(11161),G=e(11194),i=(e(11922),e(11201)),S=e(11129);class M extends X.d{constructor(){super(...arguments),this.CLEARCOAT=!1,this.CLEARCOAT_DEFAULTIOR=!1,this.CLEARCOAT_TEXTURE=!1,this.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this.CLEARCOAT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,this.CLEARCOAT_BUMP=!1,this.CLEARCOAT_BUMPDIRECTUV=0,this.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,this.CLEARCOAT_REMAP_F0=!1,this.CLEARCOAT_TINT=!1,this.CLEARCOAT_TINT_TEXTURE=!1,this.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,this.CLEARCOAT_TINT_GAMMATEXTURE=!1}}class r extends t.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRClearCoat",100,new M,b),this._isEnabled=!1,this.isEnabled=!1,this.Ji=1,this.roughness=0,this._indexOfRefraction=r._DefaultIndexOfRefraction,this.indexOfRefraction=r._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._textureRoughness=null,this.textureRoughness=null,this._remapF0OnInterfaceChange=!0,this.remapF0OnInterfaceChange=!0,this._bumpTexture=null,this.bumpTexture=null,this._isTintEnabled=!1,this.isTintEnabled=!1,this.tintColor=m.c.White(),this.tintColorAtDistance=1,this.tintThickness=1,this._tintTexture=null,this.tintTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1]}isReadyForSubMesh(K,b,e){if(!this._isEnabled)return!0;const z=this._material._disableBumpMap;if(K._areTexturesDirty&&b.texturesEnabled){if(this._texture&&G.c.ClearCoatTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&G.c.ClearCoatTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1;if(e.getCaps().standardDerivatives&&this._bumpTexture&&G.c.ClearCoatBumpTextureEnabled&&!z&&!this._bumpTexture.isReady())return!1;if(this._isTintEnabled&&this._tintTexture&&G.c.ClearCoatTintTextureEnabled&&!this._tintTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(K,b){this._isEnabled?(K.CLEARCOAT=!0,K.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,K.CLEARCOAT_REMAP_F0=this._remapF0OnInterfaceChange,K._areTexturesDirty&&b.texturesEnabled&&(this._texture&&G.c.ClearCoatTextureEnabled?(0,S.V)(this._texture,K,"CLEARCOAT_TEXTURE"):K.CLEARCOAT_TEXTURE=!1,this._textureRoughness&&G.c.ClearCoatTextureEnabled?(0,S.V)(this._textureRoughness,K,"CLEARCOAT_TEXTURE_ROUGHNESS"):K.CLEARCOAT_TEXTURE_ROUGHNESS=!1,this._bumpTexture&&G.c.ClearCoatBumpTextureEnabled?(0,S.V)(this._bumpTexture,K,"CLEARCOAT_BUMP"):K.CLEARCOAT_BUMP=!1,K.CLEARCOAT_DEFAULTIOR=this._indexOfRefraction===r._DefaultIndexOfRefraction,this._isTintEnabled?(K.CLEARCOAT_TINT=!0,this._tintTexture&&G.c.ClearCoatTintTextureEnabled?((0,S.V)(this._tintTexture,K,"CLEARCOAT_TINT_TEXTURE"),K.CLEARCOAT_TINT_GAMMATEXTURE=this._tintTexture.gammaSpace):K.CLEARCOAT_TINT_TEXTURE=!1):(K.CLEARCOAT_TINT=!1,K.CLEARCOAT_TINT_TEXTURE=!1))):(K.CLEARCOAT=!1,K.CLEARCOAT_TEXTURE=!1,K.CLEARCOAT_TEXTURE_ROUGHNESS=!1,K.CLEARCOAT_BUMP=!1,K.CLEARCOAT_TINT=!1,K.CLEARCOAT_TINT_TEXTURE=!1,K.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,K.CLEARCOAT_DEFAULTIOR=!1,K.CLEARCOAT_TEXTUREDIRECTUV=0,K.CLEARCOAT_TEXTURE_ROUGHNESSDIRECTUV=0,K.CLEARCOAT_BUMPDIRECTUV=0,K.CLEARCOAT_REMAP_F0=!1,K.CLEARCOAT_TINT_TEXTUREDIRECTUV=0,K.CLEARCOAT_TINT_GAMMATEXTURE=!1)}bindForSubMesh(K,b,e,z){if(!this._isEnabled)return;const k=z.materialDefines,j=this._material.isFrozen,T=this._material._disableBumpMap,F=this._material._invertNormalMapX,l=this._material._invertNormalMapY;if(!K.useUbo||!j||!K.isSync){var Y,A,X,t;if((this._texture||this._textureRoughness)&&G.c.ClearCoatTextureEnabled)K.updateFloat4("vClearCoatInfos",(null===(Y=this._texture)||void 0===Y?void 0:Y.coordinatesIndex)??0,(null===(A=this._texture)||void 0===A?void 0:A.level)??0,(null===(X=this._textureRoughness)||void 0===X?void 0:X.coordinatesIndex)??0,(null===(t=this._textureRoughness)||void 0===t?void 0:t.level)??0),this._texture&&(0,S.y)(this._texture,K,"clearCoat"),this._textureRoughness&&!k.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,S.y)(this._textureRoughness,K,"clearCoatRoughness");this._bumpTexture&&e.getCaps().standardDerivatives&&G.c.ClearCoatTextureEnabled&&!T&&(K.updateFloat2("vClearCoatBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level),(0,S.y)(this._bumpTexture,K,"clearCoatBump"),b._mirroredCameraPosition?K.updateFloat2("vClearCoatTangentSpaceParams",F?1:-1,l?1:-1):K.updateFloat2("vClearCoatTangentSpaceParams",F?-1:1,l?-1:1)),this._tintTexture&&G.c.ClearCoatTintTextureEnabled&&(K.updateFloat2("vClearCoatTintInfos",this._tintTexture.coordinatesIndex,this._tintTexture.level),(0,S.y)(this._tintTexture,K,"clearCoatTint")),K.updateFloat2("vClearCoatParams",this.Ji,this.roughness);const z=1-this._indexOfRefraction,j=1+this._indexOfRefraction,U=Math.pow(-z/j,2),B=1/this._indexOfRefraction;K.updateFloat4("vClearCoatRefractionParams",U,B,z,j),this._isTintEnabled&&(K.updateFloat4("vClearCoatTintParams",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintThickness)),K.updateFloat("clearCoatColorAtDistance",Math.max(1e-5,this.tintColorAtDistance)))}b.texturesEnabled&&(this._texture&&G.c.ClearCoatTextureEnabled&&K.setTexture("clearCoatSampler",this._texture),this._textureRoughness&&!k.CLEARCOAT_USE_ROUGHNESS_FROM_MAINTEXTURE&&G.c.ClearCoatTextureEnabled&&K.setTexture("clearCoatRoughnessSampler",this._textureRoughness),this._bumpTexture&&e.getCaps().standardDerivatives&&G.c.ClearCoatBumpTextureEnabled&&!T&&K.setTexture("clearCoatBumpSampler",this._bumpTexture),this._isTintEnabled&&this._tintTexture&&G.c.ClearCoatTintTextureEnabled&&K.setTexture("clearCoatTintSampler",this._tintTexture))}hasTexture(K){return this._texture===K||(this._textureRoughness===K||(this._bumpTexture===K||this._tintTexture===K))}getActiveTextures(K){this._texture&&K.push(this._texture),this._textureRoughness&&K.push(this._textureRoughness),this._bumpTexture&&K.push(this._bumpTexture),this._tintTexture&&K.push(this._tintTexture)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&K.push(this._textureRoughness),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&K.push(this._bumpTexture),this._tintTexture&&this._tintTexture.animations&&this._tintTexture.animations.length>0&&K.push(this._tintTexture)}dispose(K){var b,e,z,k;K&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(e=this._textureRoughness)||void 0===e||e.dispose(),null===(z=this._bumpTexture)||void 0===z||z.dispose(),null===(k=this._tintTexture)||void 0===k||k.dispose())}getClassName(){return"PBRClearCoatConfiguration"}addFallbacks(K,b,e){return K.CLEARCOAT_BUMP&&b.addFallback(e++,"CLEARCOAT_BUMP"),K.CLEARCOAT_TINT&&b.addFallback(e++,"CLEARCOAT_TINT"),K.CLEARCOAT&&b.addFallback(e++,"CLEARCOAT"),e}getSamplers(K){K.push("clearCoatSampler","clearCoatRoughnessSampler","clearCoatBumpSampler","clearCoatTintSampler")}getUniforms(){return{ubo:[{name:"vClearCoatParams",size:2,type:"vec2"},{name:"vClearCoatRefractionParams",size:4,type:"vec4"},{name:"vClearCoatInfos",size:4,type:"vec4"},{name:"clearCoatMatrix",size:16,type:"mat4"},{name:"clearCoatRoughnessMatrix",size:16,type:"mat4"},{name:"vClearCoatBumpInfos",size:2,type:"vec2"},{name:"vClearCoatTangentSpaceParams",size:2,type:"vec2"},{name:"clearCoatBumpMatrix",size:16,type:"mat4"},{name:"vClearCoatTintParams",size:4,type:"vec4"},{name:"clearCoatColorAtDistance",size:1,type:"float"},{name:"vClearCoatTintInfos",size:2,type:"vec2"},{name:"clearCoatTintMatrix",size:16,type:"mat4"}]}}}r._DefaultIndexOfRefraction=1.5,(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"isEnabled",void 0),(0,z.b)([(0,k.M)()],r.prototype,"intensity",void 0),(0,z.b)([(0,k.M)()],r.prototype,"roughness",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"indexOfRefraction",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"texture",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMainTexture",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"textureRoughness",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"remapF0OnInterfaceChange",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"isTintEnabled",void 0),(0,z.b)([(0,k.m)()],r.prototype,"tintColor",void 0),(0,z.b)([(0,k.M)()],r.prototype,"tintColorAtDistance",void 0),(0,z.b)([(0,k.M)()],r.prototype,"tintThickness",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"tintTexture",void 0);class L extends X.d{constructor(){super(...arguments),this.IRIDESCENCE=!1,this.IRIDESCENCE_TEXTURE=!1,this.IRIDESCENCE_TEXTUREDIRECTUV=0,this.IRIDESCENCE_THICKNESS_TEXTURE=!1,this.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0}}class c extends t.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRIridescence",110,new L,b),this._isEnabled=!1,this.isEnabled=!1,this.Ji=1,this.minimumThickness=c._DefaultMinimumThickness,this.maximumThickness=c._DefaultMaximumThickness,this.indexOfRefraction=c._DefaultIndexOfRefraction,this._texture=null,this.texture=null,this._thicknessTexture=null,this.thicknessTexture=null,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1]}isReadyForSubMesh(K,b){if(!this._isEnabled)return!0;if(K._areTexturesDirty&&b.texturesEnabled){if(this._texture&&G.c.IridescenceTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._thicknessTexture&&G.c.IridescenceTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(K,b){this._isEnabled?(K.IRIDESCENCE=!0,K._areTexturesDirty&&b.texturesEnabled&&(this._texture&&G.c.IridescenceTextureEnabled?(0,S.V)(this._texture,K,"IRIDESCENCE_TEXTURE"):K.IRIDESCENCE_TEXTURE=!1,this._thicknessTexture&&G.c.IridescenceTextureEnabled?(0,S.V)(this._thicknessTexture,K,"IRIDESCENCE_THICKNESS_TEXTURE"):K.IRIDESCENCE_THICKNESS_TEXTURE=!1)):(K.IRIDESCENCE=!1,K.IRIDESCENCE_TEXTURE=!1,K.IRIDESCENCE_THICKNESS_TEXTURE=!1,K.IRIDESCENCE_TEXTUREDIRECTUV=0,K.IRIDESCENCE_THICKNESS_TEXTUREDIRECTUV=0)}bindForSubMesh(K,b){if(!this._isEnabled)return;const e=this._material.isFrozen;if(!K.useUbo||!e||!K.isSync){var z,k,j,T;if((this._texture||this._thicknessTexture)&&G.c.IridescenceTextureEnabled)K.updateFloat4("vIridescenceInfos",(null===(z=this._texture)||void 0===z?void 0:z.coordinatesIndex)??0,(null===(k=this._texture)||void 0===k?void 0:k.level)??0,(null===(j=this._thicknessTexture)||void 0===j?void 0:j.coordinatesIndex)??0,(null===(T=this._thicknessTexture)||void 0===T?void 0:T.level)??0),this._texture&&(0,S.y)(this._texture,K,"iridescence"),this._thicknessTexture&&(0,S.y)(this._thicknessTexture,K,"iridescenceThickness");K.updateFloat4("vIridescenceParams",this.Ji,this.indexOfRefraction,this.minimumThickness,this.maximumThickness)}b.texturesEnabled&&(this._texture&&G.c.IridescenceTextureEnabled&&K.setTexture("iridescenceSampler",this._texture),this._thicknessTexture&&G.c.IridescenceTextureEnabled&&K.setTexture("iridescenceThicknessSampler",this._thicknessTexture))}hasTexture(K){return this._texture===K||this._thicknessTexture===K}getActiveTextures(K){this._texture&&K.push(this._texture),this._thicknessTexture&&K.push(this._thicknessTexture)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture),this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&K.push(this._thicknessTexture)}dispose(K){var b,e;K&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(e=this._thicknessTexture)||void 0===e||e.dispose())}getClassName(){return"PBRIridescenceConfiguration"}addFallbacks(K,b,e){return K.IRIDESCENCE&&b.addFallback(e++,"IRIDESCENCE"),e}getSamplers(K){K.push("iridescenceSampler","iridescenceThicknessSampler")}getUniforms(){return{ubo:[{name:"vIridescenceParams",size:4,type:"vec4"},{name:"vIridescenceInfos",size:4,type:"vec4"},{name:"iridescenceMatrix",size:16,type:"mat4"},{name:"iridescenceThicknessMatrix",size:16,type:"mat4"}]}}}c._DefaultMinimumThickness=100,c._DefaultMaximumThickness=400,c._DefaultIndexOfRefraction=1.3,(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"isEnabled",void 0),(0,z.b)([(0,k.M)()],c.prototype,"intensity",void 0),(0,z.b)([(0,k.M)()],c.prototype,"minimumThickness",void 0),(0,z.b)([(0,k.M)()],c.prototype,"maximumThickness",void 0),(0,z.b)([(0,k.M)()],c.prototype,"indexOfRefraction",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"texture",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],c.prototype,"thicknessTexture",void 0);class v extends X.d{constructor(){super(...arguments),this.ANISOTROPIC=!1,this.ANISOTROPIC_TEXTURE=!1,this.ANISOTROPIC_TEXTUREDIRECTUV=0,this.ANISOTROPIC_LEGACY=!1,this.MAINUV1=!1}}class w extends t.b{set angle(K){this.direction.x=Math.cos(K),this.direction.y=Math.sin(K)}get angle(){return Math.atan2(this.direction.y,this.direction.x)}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markAllSubMeshesAsMiscDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsMiscDirty()}isCompatible(){return!0}constructor(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRAnisotropic",110,new v,b),this._isEnabled=!1,this.isEnabled=!1,this.Ji=1,this.direction=new Y.h(1,0),this._texture=null,this.texture=null,this._legacy=!1,this.legacy=!1,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1],this._internalMarkAllSubMeshesAsMiscDirty=K._dirtyCallbacks[16]}isReadyForSubMesh(K,b){return!this._isEnabled||!(K._areTexturesDirty&&b.texturesEnabled&&this._texture&&G.c.AnisotropicTextureEnabled&&!this._texture.isReadyOrNotBlocking())}prepareDefinesBeforeAttributes(K,b,e){this._isEnabled?(K.ANISOTROPIC=this._isEnabled,this._isEnabled&&!e.isVerticesDataPresent(A.f.TangentKind)&&(K._needUVs=!0,K.MAINUV1=!0),K._areTexturesDirty&&b.texturesEnabled&&(this._texture&&G.c.AnisotropicTextureEnabled?(0,S.V)(this._texture,K,"ANISOTROPIC_TEXTURE"):K.ANISOTROPIC_TEXTURE=!1),K._areMiscDirty&&(K.ANISOTROPIC_LEGACY=this._legacy)):(K.ANISOTROPIC=!1,K.ANISOTROPIC_TEXTURE=!1,K.ANISOTROPIC_TEXTUREDIRECTUV=0,K.ANISOTROPIC_LEGACY=!1)}bindForSubMesh(K,b){if(!this._isEnabled)return;const e=this._material.isFrozen;K.useUbo&&e&&K.isSync||(this._texture&&G.c.AnisotropicTextureEnabled&&(K.updateFloat2("vAnisotropyInfos",this._texture.coordinatesIndex,this._texture.level),(0,S.y)(this._texture,K,"anisotropy")),K.updateFloat3("vAnisotropy",this.direction.x,this.direction.y,this.Ji)),b.texturesEnabled&&this._texture&&G.c.AnisotropicTextureEnabled&&K.setTexture("anisotropySampler",this._texture)}hasTexture(K){return this._texture===K}getActiveTextures(K){this._texture&&K.push(this._texture)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture)}dispose(K){K&&this._texture&&this._texture.dispose()}getClassName(){return"PBRAnisotropicConfiguration"}addFallbacks(K,b,e){return K.ANISOTROPIC&&b.addFallback(e++,"ANISOTROPIC"),e}getSamplers(K){K.push("anisotropySampler")}getUniforms(){return{ubo:[{name:"vAnisotropy",size:3,type:"vec3"},{name:"vAnisotropyInfos",size:2,type:"vec2"},{name:"anisotropyMatrix",size:16,type:"mat4"}]}}parse(K,b,e){super.parse(K,b,e),void 0===K.legacy&&(this.legacy=!0)}}(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"isEnabled",void 0),(0,z.b)([(0,k.M)()],w.prototype,"intensity",void 0),(0,z.b)([(0,k.H)()],w.prototype,"direction",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],w.prototype,"texture",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsMiscDirty")],w.prototype,"legacy",void 0);class h extends X.d{constructor(){super(...arguments),this.SHEEN=!1,this.SHEEN_TEXTURE=!1,this.SHEEN_GAMMATEXTURE=!1,this.SHEEN_TEXTURE_ROUGHNESS=!1,this.SHEEN_TEXTUREDIRECTUV=0,this.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0,this.SHEEN_LINKWITHALBEDO=!1,this.SHEEN_ROUGHNESS=!1,this.SHEEN_ALBEDOSCALING=!1,this.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1}}class R extends t.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"Sheen",120,new h,b),this._isEnabled=!1,this.isEnabled=!1,this._linkSheenWithAlbedo=!1,this.linkSheenWithAlbedo=!1,this.Ji=1,this.color=m.c.White(),this._texture=null,this.texture=null,this._useRoughnessFromMainTexture=!0,this.useRoughnessFromMainTexture=!0,this._roughness=null,this.roughness=null,this._textureRoughness=null,this.textureRoughness=null,this._albedoScaling=!1,this.albedoScaling=!1,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1]}isReadyForSubMesh(K,b){if(!this._isEnabled)return!0;if(K._areTexturesDirty&&b.texturesEnabled){if(this._texture&&G.c.SheenTextureEnabled&&!this._texture.isReadyOrNotBlocking())return!1;if(this._textureRoughness&&G.c.SheenTextureEnabled&&!this._textureRoughness.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(K,b){this._isEnabled?(K.SHEEN=!0,K.SHEEN_LINKWITHALBEDO=this._linkSheenWithAlbedo,K.SHEEN_ROUGHNESS=null!==this._roughness,K.SHEEN_ALBEDOSCALING=this._albedoScaling,K.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=this._useRoughnessFromMainTexture,K._areTexturesDirty&&b.texturesEnabled&&(this._texture&&G.c.SheenTextureEnabled?((0,S.V)(this._texture,K,"SHEEN_TEXTURE"),K.SHEEN_GAMMATEXTURE=this._texture.gammaSpace):K.SHEEN_TEXTURE=!1,this._textureRoughness&&G.c.SheenTextureEnabled?(0,S.V)(this._textureRoughness,K,"SHEEN_TEXTURE_ROUGHNESS"):K.SHEEN_TEXTURE_ROUGHNESS=!1)):(K.SHEEN=!1,K.SHEEN_TEXTURE=!1,K.SHEEN_TEXTURE_ROUGHNESS=!1,K.SHEEN_LINKWITHALBEDO=!1,K.SHEEN_ROUGHNESS=!1,K.SHEEN_ALBEDOSCALING=!1,K.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE=!1,K.SHEEN_GAMMATEXTURE=!1,K.SHEEN_TEXTUREDIRECTUV=0,K.SHEEN_TEXTURE_ROUGHNESSDIRECTUV=0)}bindForSubMesh(K,b,e,z){if(!this._isEnabled)return;const k=z.materialDefines,j=this._material.isFrozen;if(!K.useUbo||!j||!K.isSync){var T,F,l,Y;if((this._texture||this._textureRoughness)&&G.c.SheenTextureEnabled)K.updateFloat4("vSheenInfos",(null===(T=this._texture)||void 0===T?void 0:T.coordinatesIndex)??0,(null===(F=this._texture)||void 0===F?void 0:F.level)??0,(null===(l=this._textureRoughness)||void 0===l?void 0:l.coordinatesIndex)??0,(null===(Y=this._textureRoughness)||void 0===Y?void 0:Y.level)??0),this._texture&&(0,S.y)(this._texture,K,"sheen"),this._textureRoughness&&!k.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&(0,S.y)(this._textureRoughness,K,"sheenRoughness");K.updateFloat4("vSheenColor",this.color.r,this.color.g,this.color.b,this.Ji),null!==this._roughness&&K.updateFloat("vSheenRoughness",this._roughness)}b.texturesEnabled&&(this._texture&&G.c.SheenTextureEnabled&&K.setTexture("sheenSampler",this._texture),this._textureRoughness&&!k.SHEEN_USE_ROUGHNESS_FROM_MAINTEXTURE&&G.c.SheenTextureEnabled&&K.setTexture("sheenRoughnessSampler",this._textureRoughness))}hasTexture(K){return this._texture===K||this._textureRoughness===K}getActiveTextures(K){this._texture&&K.push(this._texture),this._textureRoughness&&K.push(this._textureRoughness)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture),this._textureRoughness&&this._textureRoughness.animations&&this._textureRoughness.animations.length>0&&K.push(this._textureRoughness)}dispose(K){var b,e;K&&(null===(b=this._texture)||void 0===b||b.dispose(),null===(e=this._textureRoughness)||void 0===e||e.dispose())}getClassName(){return"PBRSheenConfiguration"}addFallbacks(K,b,e){return K.SHEEN&&b.addFallback(e++,"SHEEN"),e}getSamplers(K){K.push("sheenSampler","sheenRoughnessSampler")}getUniforms(){return{ubo:[{name:"vSheenColor",size:4,type:"vec4"},{name:"vSheenRoughness",size:1,type:"float"},{name:"vSheenInfos",size:4,type:"vec4"},{name:"sheenMatrix",size:16,type:"mat4"},{name:"sheenRoughnessMatrix",size:16,type:"mat4"}]}}}(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"isEnabled",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"linkSheenWithAlbedo",void 0),(0,z.b)([(0,k.M)()],R.prototype,"intensity",void 0),(0,z.b)([(0,k.m)()],R.prototype,"color",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"texture",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"useRoughnessFromMainTexture",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"roughness",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"textureRoughness",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],R.prototype,"albedoScaling",void 0);class n extends X.d{constructor(){super(...arguments),this.SUBSURFACE=!1,this.SS_REFRACTION=!1,this.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_TRANSLUCENCY=!1,this.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,this.SS_SCATTERING=!1,this.SS_DISPERSION=!1,this.SS_THICKNESSANDMASK_TEXTURE=!1,this.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,this.SS_HAS_THICKNESS=!1,this.SS_REFRACTIONINTENSITY_TEXTURE=!1,this.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,this.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,this.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,this.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0,this.SS_REFRACTIONMAP_3D=!1,this.SS_REFRACTIONMAP_OPPOSITEZ=!1,this.SS_LODINREFRACTIONALPHA=!1,this.SS_GAMMAREFRACTION=!1,this.SS_RGBDREFRACTION=!1,this.SS_LINEARSPECULARREFRACTION=!1,this.SS_LINKREFRACTIONTOTRANSPARENCY=!1,this.SS_ALBEDOFORREFRACTIONTINT=!1,this.SS_ALBEDOFORTRANSLUCENCYTINT=!1,this.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.SS_USE_THICKNESS_AS_DEPTH=!1,this.SS_USE_GLTF_TEXTURES=!1}}class P extends t.b{get scatteringDiffusionProfile(){return this._scene.subSurfaceConfiguration?this._scene.subSurfaceConfiguration.ssDiffusionProfileColors[this._scatteringDiffusionProfileIndex]:null}set scatteringDiffusionProfile(K){this._scene.enableSubSurfaceForPrePass()&&K&&(this._scatteringDiffusionProfileIndex=this._scene.subSurfaceConfiguration.addDiffusionProfile(K))}get volumeIndexOfRefraction(){return this._volumeIndexOfRefraction>=1?this._volumeIndexOfRefraction:this._indexOfRefraction}set volumeIndexOfRefraction(K){this._volumeIndexOfRefraction=K>=1?K:-1}_markAllSubMeshesAsTexturesDirty(){this._enable(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}_markScenePrePassDirty(){this._internalMarkAllSubMeshesAsTexturesDirty(),this._internalMarkScenePrePassDirty()}isCompatible(){return!0}constructor(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"PBRSubSurface",130,new n,b),this._isRefractionEnabled=!1,this.isRefractionEnabled=!1,this._isTranslucencyEnabled=!1,this.isTranslucencyEnabled=!1,this._isDispersionEnabled=!1,this.isDispersionEnabled=!1,this._isScatteringEnabled=!1,this.isScatteringEnabled=!1,this._scatteringDiffusionProfileIndex=0,this.refractionIntensity=1,this.translucencyIntensity=1,this.useAlbedoToTintRefraction=!1,this.useAlbedoToTintTranslucency=!1,this._thicknessTexture=null,this.thicknessTexture=null,this._refractionTexture=null,this.refractionTexture=null,this._indexOfRefraction=1.5,this.indexOfRefraction=1.5,this._volumeIndexOfRefraction=-1,this._invertRefractionY=!1,this.invertRefractionY=!1,this._linkRefractionWithTransparency=!1,this.linkRefractionWithTransparency=!1,this.minimumThickness=0,this.maximumThickness=1,this.useThicknessAsDepth=!1,this.tintColor=m.c.White(),this.tintColorAtDistance=1,this.dispersion=0,this.diffusionDistance=m.c.White(),this._useMaskFromThicknessTexture=!1,this.useMaskFromThicknessTexture=!1,this._refractionIntensityTexture=null,this.refractionIntensityTexture=null,this._translucencyIntensityTexture=null,this.translucencyIntensityTexture=null,this.translucencyColor=null,this._translucencyColorTexture=null,this.translucencyColorTexture=null,this._useGltfStyleTextures=!0,this.useGltfStyleTextures=!0,this._scene=K.va(),this.registerForExtraEvents=!0,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1],this._internalMarkScenePrePassDirty=K._dirtyCallbacks[32]}isReadyForSubMesh(K,b){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return!0;if(K._areTexturesDirty&&b.texturesEnabled){if(this._thicknessTexture&&G.c.ThicknessTextureEnabled&&!this._thicknessTexture.isReadyOrNotBlocking())return!1;if(this._translucencyColorTexture&&G.c.TranslucencyColorTextureEnabled&&!this._translucencyColorTexture.isReadyOrNotBlocking())return!1;if(this._translucencyIntensityTexture&&G.c.TranslucencyIntensityTextureEnabled&&!this._translucencyIntensityTexture.isReadyOrNotBlocking())return!1;const K=this._getRefractionTexture(b);if(K&&G.c.RefractionTextureEnabled&&!K.isReadyOrNotBlocking())return!1}return!0}prepareDefinesBeforeAttributes(K,b){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return K.SUBSURFACE=!1,K.SS_DISPERSION=!1,K.SS_TRANSLUCENCY=!1,K.SS_SCATTERING=!1,K.SS_REFRACTION=!1,K.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,K.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,K.SS_THICKNESSANDMASK_TEXTURE=!1,K.SS_THICKNESSANDMASK_TEXTUREDIRECTUV=0,K.SS_HAS_THICKNESS=!1,K.SS_REFRACTIONINTENSITY_TEXTURE=!1,K.SS_REFRACTIONINTENSITY_TEXTUREDIRECTUV=0,K.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,K.SS_TRANSLUCENCYINTENSITY_TEXTUREDIRECTUV=0,K.SS_REFRACTIONMAP_3D=!1,K.SS_REFRACTIONMAP_OPPOSITEZ=!1,K.SS_LODINREFRACTIONALPHA=!1,K.SS_GAMMAREFRACTION=!1,K.SS_RGBDREFRACTION=!1,K.SS_LINEARSPECULARREFRACTION=!1,K.SS_LINKREFRACTIONTOTRANSPARENCY=!1,K.SS_ALBEDOFORREFRACTIONTINT=!1,K.SS_ALBEDOFORTRANSLUCENCYTINT=!1,K.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,K.SS_USE_THICKNESS_AS_DEPTH=!1,K.SS_USE_GLTF_TEXTURES=!1,K.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,void(K.SS_TRANSLUCENCYCOLOR_TEXTUREDIRECTUV=0);if(K._areTexturesDirty){if(K.SUBSURFACE=!0,K.SS_DISPERSION=this._isDispersionEnabled,K.SS_TRANSLUCENCY=this._isTranslucencyEnabled,K.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=!1,K.SS_SCATTERING=this._isScatteringEnabled,K.SS_THICKNESSANDMASK_TEXTURE=!1,K.SS_REFRACTIONINTENSITY_TEXTURE=!1,K.SS_TRANSLUCENCYINTENSITY_TEXTURE=!1,K.SS_HAS_THICKNESS=!1,K.SS_USE_GLTF_TEXTURES=!1,K.SS_REFRACTION=!1,K.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=!1,K.SS_REFRACTIONMAP_3D=!1,K.SS_GAMMAREFRACTION=!1,K.SS_RGBDREFRACTION=!1,K.SS_LINEARSPECULARREFRACTION=!1,K.SS_REFRACTIONMAP_OPPOSITEZ=!1,K.SS_LODINREFRACTIONALPHA=!1,K.SS_LINKREFRACTIONTOTRANSPARENCY=!1,K.SS_ALBEDOFORREFRACTIONTINT=!1,K.SS_ALBEDOFORTRANSLUCENCYTINT=!1,K.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=!1,K.SS_USE_THICKNESS_AS_DEPTH=!1,K.SS_TRANSLUCENCYCOLOR_TEXTURE=!1,K._areTexturesDirty&&b.texturesEnabled&&(this._thicknessTexture&&G.c.ThicknessTextureEnabled&&(0,S.V)(this._thicknessTexture,K,"SS_THICKNESSANDMASK_TEXTURE"),this._refractionIntensityTexture&&G.c.RefractionIntensityTextureEnabled&&(0,S.V)(this._refractionIntensityTexture,K,"SS_REFRACTIONINTENSITY_TEXTURE"),this._translucencyIntensityTexture&&G.c.TranslucencyIntensityTextureEnabled&&(0,S.V)(this._translucencyIntensityTexture,K,"SS_TRANSLUCENCYINTENSITY_TEXTURE"),this._translucencyColorTexture&&G.c.TranslucencyColorTextureEnabled&&(0,S.V)(this._translucencyColorTexture,K,"SS_TRANSLUCENCYCOLOR_TEXTURE")),K.SS_HAS_THICKNESS=this.maximumThickness-this.minimumThickness!==0,K.SS_USE_GLTF_TEXTURES=this._useGltfStyleTextures,K.SS_REFRACTION_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._refractionIntensityTexture,K.SS_TRANSLUCENCY_USE_INTENSITY_FROM_THICKNESS=this._useMaskFromThicknessTexture&&!this._translucencyIntensityTexture,this._isRefractionEnabled&&b.texturesEnabled){const e=this._getRefractionTexture(b);e&&G.c.RefractionTextureEnabled&&(K.SS_REFRACTION=!0,K.SS_REFRACTIONMAP_3D=e.isCube,K.SS_GAMMAREFRACTION=e.gammaSpace,K.SS_RGBDREFRACTION=e.isRGBD,K.SS_LINEARSPECULARREFRACTION=e.linearSpecularLOD,K.SS_REFRACTIONMAP_OPPOSITEZ=this._scene.useRightHandedSystem&&e.isCube?!e.invertZ:e.invertZ,K.SS_LODINREFRACTIONALPHA=e.lodLevelInAlpha,K.SS_LINKREFRACTIONTOTRANSPARENCY=this._linkRefractionWithTransparency,K.SS_ALBEDOFORREFRACTIONTINT=this.useAlbedoToTintRefraction,K.SS_USE_LOCAL_REFRACTIONMAP_CUBIC=e.isCube&&e.boundingBoxSize,K.SS_USE_THICKNESS_AS_DEPTH=this.useThicknessAsDepth)}this._isTranslucencyEnabled&&(K.SS_ALBEDOFORTRANSLUCENCYTINT=this.useAlbedoToTintTranslucency)}}hardBindForSubMesh(K,b,e,z){if(this._isRefractionEnabled||this._isTranslucencyEnabled||this._isScatteringEnabled)if(0===this.maximumThickness&&0===this.minimumThickness)K.updateFloat2("vThicknessParam",0,0);else{z.getRenderingMesh().getWorldMatrix().decompose(Y.e.gb[0]);const b=Math.max(Math.abs(Y.e.gb[0].x),Math.abs(Y.e.gb[0].y),Math.abs(Y.e.gb[0].z));K.updateFloat2("vThicknessParam",this.minimumThickness*b,(this.maximumThickness-this.minimumThickness)*b)}}bindForSubMesh(K,b,e,z){if(!this._isRefractionEnabled&&!this._isTranslucencyEnabled&&!this._isScatteringEnabled)return;const k=z.materialDefines,j=this._material.isFrozen,T=this._material.realTimeFiltering,F=k.LODBASEDMICROSFURACE,l=this._getRefractionTexture(b);if(!K.useUbo||!j||!K.isSync){if(this._thicknessTexture&&G.c.ThicknessTextureEnabled&&(K.updateFloat2("vThicknessInfos",this._thicknessTexture.coordinatesIndex,this._thicknessTexture.level),(0,S.y)(this._thicknessTexture,K,"thickness")),this._refractionIntensityTexture&&G.c.RefractionIntensityTextureEnabled&&k.SS_REFRACTIONINTENSITY_TEXTURE&&(K.updateFloat2("vRefractionIntensityInfos",this._refractionIntensityTexture.coordinatesIndex,this._refractionIntensityTexture.level),(0,S.y)(this._refractionIntensityTexture,K,"refractionIntensity")),this._translucencyColorTexture&&G.c.TranslucencyColorTextureEnabled&&k.SS_TRANSLUCENCYCOLOR_TEXTURE&&(K.updateFloat2("vTranslucencyColorInfos",this._translucencyColorTexture.coordinatesIndex,this._translucencyColorTexture.level),(0,S.y)(this._translucencyColorTexture,K,"translucencyColor")),this._translucencyIntensityTexture&&G.c.TranslucencyIntensityTextureEnabled&&k.SS_TRANSLUCENCYINTENSITY_TEXTURE&&(K.updateFloat2("vTranslucencyIntensityInfos",this._translucencyIntensityTexture.coordinatesIndex,this._translucencyIntensityTexture.level),(0,S.y)(this._translucencyIntensityTexture,K,"translucencyIntensity")),l&&G.c.RefractionTextureEnabled){K.qj("refractionMatrix",l.getRefractionTextureMatrix());let b=1;l.isCube||l.depth&&(b=l.depth);const e=l.getSize().width,z=this.volumeIndexOfRefraction;if(K.updateFloat4("vRefractionInfos",l.level,1/z,b,this._invertRefractionY?-1:1),K.updateFloat4("vRefractionMicrosurfaceInfos",e,l.lodGenerationScale,l.lodGenerationOffset,1/this.indexOfRefraction),T&&K.updateFloat2("vRefractionFilteringInfo",e,Math.log2(e)),l.boundingBoxSize){const b=l;K.updateVector3("vRefractionPosition",b.boundingBoxPosition),K.updateVector3("vRefractionSize",b.boundingBoxSize)}}this._isScatteringEnabled&&K.updateFloat("scatteringDiffusionProfile",this._scatteringDiffusionProfileIndex),K.updateColor3("vDiffusionDistance",this.diffusionDistance),K.updateFloat4("vTintColor",this.tintColor.r,this.tintColor.g,this.tintColor.b,Math.max(1e-5,this.tintColorAtDistance)),K.updateColor4("vTranslucencyColor",this.translucencyColor??this.tintColor,0),K.updateFloat3("vSubSurfaceIntensity",this.refractionIntensity,this.translucencyIntensity,0),K.updateFloat("dispersion",this.dispersion)}b.texturesEnabled&&(this._thicknessTexture&&G.c.ThicknessTextureEnabled&&K.setTexture("thicknessSampler",this._thicknessTexture),this._refractionIntensityTexture&&G.c.RefractionIntensityTextureEnabled&&k.SS_REFRACTIONINTENSITY_TEXTURE&&K.setTexture("refractionIntensitySampler",this._refractionIntensityTexture),this._translucencyIntensityTexture&&G.c.TranslucencyIntensityTextureEnabled&&k.SS_TRANSLUCENCYINTENSITY_TEXTURE&&K.setTexture("translucencyIntensitySampler",this._translucencyIntensityTexture),this._translucencyColorTexture&&G.c.TranslucencyColorTextureEnabled&&k.SS_TRANSLUCENCYCOLOR_TEXTURE&&K.setTexture("translucencyColorSampler",this._translucencyColorTexture),l&&G.c.RefractionTextureEnabled&&(F?K.setTexture("refractionSampler",l):(K.setTexture("refractionSampler",l._lodTextureMid||l),K.setTexture("refractionSamplerLow",l._lodTextureLow||l),K.setTexture("refractionSamplerHigh",l._lodTextureHigh||l))))}_getRefractionTexture(K){return this._refractionTexture?this._refractionTexture:this._isRefractionEnabled?K.environmentTexture:null}get disableAlphaBlending(){return this._isRefractionEnabled&&this._linkRefractionWithTransparency}fillRenderTargetTextures(K){G.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&K.push(this._refractionTexture)}hasTexture(K){return this._thicknessTexture===K||(this._refractionTexture===K||(this._refractionIntensityTexture===K||(this._translucencyIntensityTexture===K||this._translucencyColorTexture===K)))}hasRenderTargetTextures(){return!!(G.c.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)}getActiveTextures(K){this._thicknessTexture&&K.push(this._thicknessTexture),this._refractionTexture&&K.push(this._refractionTexture),this._translucencyColorTexture&&K.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&K.push(this._translucencyIntensityTexture)}getAnimatables(K){this._thicknessTexture&&this._thicknessTexture.animations&&this._thicknessTexture.animations.length>0&&K.push(this._thicknessTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&K.push(this._refractionTexture),this._translucencyColorTexture&&this._translucencyColorTexture.animations&&this._translucencyColorTexture.animations.length>0&&K.push(this._translucencyColorTexture),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.animations&&this._translucencyIntensityTexture.animations.length>0&&K.push(this._translucencyIntensityTexture)}dispose(K){K&&(this._thicknessTexture&&this._thicknessTexture.dispose(),this._refractionTexture&&this._refractionTexture.dispose(),this._translucencyColorTexture&&this._translucencyColorTexture.dispose(),this._translucencyIntensityTexture&&this._translucencyIntensityTexture.dispose())}getClassName(){return"PBRSubSurfaceConfiguration"}addFallbacks(K,b,e){return K.SS_SCATTERING&&b.addFallback(e++,"SS_SCATTERING"),K.SS_TRANSLUCENCY&&b.addFallback(e++,"SS_TRANSLUCENCY"),e}getSamplers(K){K.push("thicknessSampler","refractionIntensitySampler","translucencyIntensitySampler","refractionSampler","refractionSamplerLow","refractionSamplerHigh","translucencyColorSampler")}getUniforms(){return{ubo:[{name:"vRefractionMicrosurfaceInfos",size:4,type:"vec4"},{name:"vRefractionFilteringInfo",size:2,type:"vec2"},{name:"vTranslucencyIntensityInfos",size:2,type:"vec2"},{name:"vRefractionInfos",size:4,type:"vec4"},{name:"refractionMatrix",size:16,type:"mat4"},{name:"vThicknessInfos",size:2,type:"vec2"},{name:"vRefractionIntensityInfos",size:2,type:"vec2"},{name:"thicknessMatrix",size:16,type:"mat4"},{name:"refractionIntensityMatrix",size:16,type:"mat4"},{name:"translucencyIntensityMatrix",size:16,type:"mat4"},{name:"vThicknessParam",size:2,type:"vec2"},{name:"vDiffusionDistance",size:3,type:"vec3"},{name:"vTintColor",size:4,type:"vec4"},{name:"vSubSurfaceIntensity",size:3,type:"vec3"},{name:"vRefractionPosition",size:3,type:"vec3"},{name:"vRefractionSize",size:3,type:"vec3"},{name:"scatteringDiffusionProfile",size:1,type:"float"},{name:"dispersion",size:1,type:"float"},{name:"vTranslucencyColor",size:4,type:"vec4"},{name:"vTranslucencyColorInfos",size:2,type:"vec2"},{name:"translucencyColorMatrix",size:16,type:"mat4"}]}}}(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isRefractionEnabled",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isTranslucencyEnabled",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"isDispersionEnabled",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markScenePrePassDirty")],P.prototype,"isScatteringEnabled",void 0),(0,z.b)([(0,k.M)()],P.prototype,"_scatteringDiffusionProfileIndex",void 0),(0,z.b)([(0,k.M)()],P.prototype,"refractionIntensity",void 0),(0,z.b)([(0,k.M)()],P.prototype,"translucencyIntensity",void 0),(0,z.b)([(0,k.M)()],P.prototype,"useAlbedoToTintRefraction",void 0),(0,z.b)([(0,k.M)()],P.prototype,"useAlbedoToTintTranslucency",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"thicknessTexture",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"refractionTexture",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"indexOfRefraction",void 0),(0,z.b)([(0,k.M)()],P.prototype,"_volumeIndexOfRefraction",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"volumeIndexOfRefraction",null),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"invertRefractionY",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"linkRefractionWithTransparency",void 0),(0,z.b)([(0,k.M)()],P.prototype,"minimumThickness",void 0),(0,z.b)([(0,k.M)()],P.prototype,"maximumThickness",void 0),(0,z.b)([(0,k.M)()],P.prototype,"useThicknessAsDepth",void 0),(0,z.b)([(0,k.m)()],P.prototype,"tintColor",void 0),(0,z.b)([(0,k.M)()],P.prototype,"tintColorAtDistance",void 0),(0,z.b)([(0,k.M)()],P.prototype,"dispersion",void 0),(0,z.b)([(0,k.m)()],P.prototype,"diffusionDistance",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useMaskFromThicknessTexture",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"refractionIntensityTexture",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"translucencyIntensityTexture",void 0),(0,z.b)([(0,k.m)()],P.prototype,"translucencyColor",void 0),(0,z.b)([(0,k.E)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"translucencyColorTexture",void 0),(0,z.b)([(0,k.M)(),(0,k.b)("_markAllSubMeshesAsTexturesDirty")],P.prototype,"useGltfStyleTextures",void 0);var d=e(11210),p=e(11138),a=e(11224);const O={effect:null,subMesh:null};class g extends X.d{constructor(K){super(K),this.PBR=!0,this.NUM_SAMPLES="0",this.REALTIME_FILTERING=!1,this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.ALBEDO=!1,this.GAMMAALBEDO=!1,this.ALBEDODIRECTUV=0,this.VERTEXCOLOR=!1,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.AMBIENTINGRAYSCALE=!1,this.OPACITY=!1,this.VERTEXALPHA=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHABLEND=!1,this.ALPHAFROMALBEDO=!1,this.ALPHATESTVALUE="0.5",this.SPECULAROVERALPHA=!1,this.RADIANCEOVERALPHA=!1,this.ALPHAFRESNEL=!1,this.LINEARALPHAFRESNEL=!1,this.PREMULTIPLYALPHA=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.GAMMAEMISSIVE=!1,this.REFLECTIVITY=!1,this.REFLECTIVITY_GAMMA=!1,this.REFLECTIVITYDIRECTUV=0,this.SPECULARTERM=!1,this.MICROSURFACEFROMREFLECTIVITYMAP=!1,this.MICROSURFACEAUTOMATIC=!1,this.LODBASEDMICROSFURACE=!1,this.MICROSURFACEMAP=!1,this.MICROSURFACEMAPDIRECTUV=0,this.METALLICWORKFLOW=!1,this.ROUGHNESSSTOREINMETALMAPALPHA=!1,this.ROUGHNESSSTOREINMETALMAPGREEN=!1,this.METALLNESSSTOREINMETALMAPBLUE=!1,this.AOSTOREINMETALMAPRED=!1,this.METALLIC_REFLECTANCE=!1,this.METALLIC_REFLECTANCE_GAMMA=!1,this.METALLIC_REFLECTANCEDIRECTUV=0,this.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=!1,this.REFLECTANCE=!1,this.REFLECTANCE_GAMMA=!1,this.REFLECTANCEDIRECTUV=0,this.ENVIRONMENTBRDF=!1,this.ENVIRONMENTBRDF_RGBD=!1,this.NORMAL=!1,this.TANGENT=!1,this.BUMP=!1,this.BUMPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.NORMALXYSCALE=!0,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.USELIGHTMAPASSHADOWMAP=!1,this.GAMMALIGHTMAP=!1,this.RGBDLIGHTMAP=!1,this.REFLECTION=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.INVERTCUBICMAP=!1,this.USESPHERICALFROMREFLECTIONMAP=!1,this.USEIRRADIANCEMAP=!1,this.USESPHERICALINVERTEX=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.LODINREFLECTIONALPHA=!1,this.GAMMAREFLECTION=!1,this.RGBDREFLECTION=!1,this.LINEARSPECULARREFLECTION=!1,this.RADIANCEOCCLUSION=!1,this.HORIZONOCCLUSION=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.NONUNIFORMSCALING=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.EXPOSURE=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.USEPHYSICALLIGHTFALLOFF=!1,this.USEGLTFLIGHTFALLOFF=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.LOGARITHMICDEPTH=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.FORCENORMALFORWARD=!1,this.SPECULARAA=!1,this.UNLIT=!1,this.DECAL_AFTER_DETAIL=!1,this.DEBUGMODE=0,this.rebuild()}reset(){super.reset(),this.ALPHATESTVALUE="0.5",this.PBR=!0,this.NORMALXYSCALE=!0}}class N extends x.c{get realTimeFiltering(){return this._realTimeFiltering}set realTimeFiltering(K){this._realTimeFiltering=K,this.rg(1)}get realTimeFilteringQuality(){return this._realTimeFilteringQuality}set realTimeFilteringQuality(K){this._realTimeFilteringQuality=K,this.rg(1)}get canRenderToMRT(){return!0}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=K||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}constructor(K,b){super(K,b,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||N.ForceGLSL),this._directIntensity=1,this._emissiveIntensity=1,this._environmentIntensity=1,this._specularIntensity=1,this._lightingInfos=new Y.o(this._directIntensity,this._emissiveIntensity,this._environmentIntensity,this._specularIntensity),this._disableBumpMap=!1,this._albedoTexture=null,this._ambientTexture=null,this._ambientTextureStrength=1,this._ambientTextureImpactOnAnalyticalLights=N.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._reflectivityTexture=null,this._metallicTexture=null,this._metallic=null,this._roughness=null,this._metallicF0Factor=1,this._metallicReflectanceColor=m.c.White(),this._useOnlyMetallicFromMetallicReflectanceTexture=!1,this._metallicReflectanceTexture=null,this._reflectanceTexture=null,this._microSurfaceTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._ambientColor=new m.c(0,0,0),this._albedoColor=new m.c(1,1,1),this._reflectivityColor=new m.c(1,1,1),this._reflectionColor=new m.c(1,1,1),this._emissiveColor=new m.c(0,0,0),this._microSurface=.9,this._useLightmapAsShadowmap=!1,this._useHorizonOcclusion=!0,this._useRadianceOcclusion=!0,this._useAlphaFromAlbedoTexture=!1,this._useSpecularOverAlpha=!0,this._useMicroSurfaceFromReflectivityMapAlpha=!1,this._useRoughnessFromMetallicTextureAlpha=!0,this._useRoughnessFromMetallicTextureGreen=!1,this._useMetallnessFromMetallicTextureBlue=!1,this._useAmbientOcclusionFromMetallicTextureRed=!1,this._useAmbientInGrayScale=!1,this._useAutoMicroSurfaceFromReflectivityMap=!1,this._lightFalloff=N.LIGHTFALLOFF_PHYSICAL,this._useRadianceOverAlpha=!0,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this._parallaxScaleBias=.05,this._disableLighting=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._alphaCutOff=.4,this._forceAlphaTest=!1,this._useAlphaFresnel=!1,this._useLinearAlphaFresnel=!1,this._environmentBRDFTexture=null,this._forceIrradianceInFragment=!1,this._realTimeFiltering=!1,this._realTimeFilteringQuality=8,this._forceNormalForward=!1,this._enableSpecularAntiAliasing=!1,this._imageProcessingObserver=null,this._renderTargets=new T.h(16),this._globalAmbientColor=new m.c(0,0,0),this._unlit=!1,this._applyDecalMapAfterDetailMap=!1,this._debugMode=0,this._shadersLoaded=!1,this._breakShaderLoadedCheck=!1,this.debugMode=0,this.debugLimit=-1,this.debugFactor=1,this._cacheHasRenderTargetTextures=!1,this.brdf=new B(this),this.clearCoat=new r(this),this.iridescence=new c(this),this.anisotropy=new w(this),this.sheen=new R(this),this.subSurface=new P(this),this.detailMap=new d.d(this),this._attachImageProcessingConfiguration(null),this.getRenderTargetTextures=()=>(this._renderTargets.reset(),G.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets),this._environmentBRDFTexture=(0,F.d)(this.va()),this.prePassConfiguration=new u.b}get hasRenderTargetTextures(){return!!(G.c.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures}get isPrePassCapable(){return!this.disableDepthWrite}getClassName(){return"PBRBaseMaterial"}get _disableAlphaBlending(){var K;return this._transparencyMode===N.PBRMATERIAL_OPAQUE||this._transparencyMode===N.PBRMATERIAL_ALPHATEST||(null===(K=this.subSurface)||void 0===K?void 0:K.disableAlphaBlending)}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromAlbedoTexture())}needAlphaTesting(){var K;return!!this._forceAlphaTest||(null===(K=this.subSurface)||void 0===K||!K.disableAlphaBlending)&&(this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===N.PBRMATERIAL_ALPHATEST))}_shouldUseAlphaFromAlbedoTexture(){return null!=this._albedoTexture&&this._albedoTexture.ke&&this._useAlphaFromAlbedoTexture&&this._transparencyMode!==N.PBRMATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._albedoTexture&&this._albedoTexture.ke||null!=this._opacityTexture}getAlphaTestTexture(){return this._albedoTexture}isReadyForSubMesh(K,b,e){this._uniformBufferLayoutBuilt||this.buildUniformLayout();const z=b._drawWrapper;if(z.effect&&this.isFrozen&&z._wasPreviouslyReady&&z._wasPreviouslyUsingInstances===e)return!0;b.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),b.materialDefines=new g(this._eventInfo.defineNames));const k=b.materialDefines;if(this._isReadyForSubMesh(b))return!0;const T=this.va(),F=T.getEngine();if(k._areTexturesDirty&&(this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,T.texturesEnabled)){if(this._albedoTexture&&G.c.DiffuseTextureEnabled&&!this._albedoTexture.isReadyOrNotBlocking())return!1;if(this._ambientTexture&&G.c.AmbientTextureEnabled&&!this._ambientTexture.isReadyOrNotBlocking())return!1;if(this._opacityTexture&&G.c.OpacityTextureEnabled&&!this._opacityTexture.isReadyOrNotBlocking())return!1;const K=this._getReflectionTexture();if(K&&G.c.ReflectionTextureEnabled){if(!K.isReadyOrNotBlocking())return!1;var l;if(K.irradianceTexture){if(!K.irradianceTexture.isReadyOrNotBlocking())return!1}else if(!K.sphericalPolynomial&&null!==(l=K.getInternalTexture())&&void 0!==l&&l._sphericalPolynomialPromise)return!1}if(this._lightmapTexture&&G.c.LightmapTextureEnabled&&!this._lightmapTexture.isReadyOrNotBlocking())return!1;if(this._emissiveTexture&&G.c.EmissiveTextureEnabled&&!this._emissiveTexture.isReadyOrNotBlocking())return!1;if(G.c.SpecularTextureEnabled){if(this._metallicTexture){if(!this._metallicTexture.isReadyOrNotBlocking())return!1}else if(this._reflectivityTexture&&!this._reflectivityTexture.isReadyOrNotBlocking())return!1;if(this._metallicReflectanceTexture&&!this._metallicReflectanceTexture.isReadyOrNotBlocking())return!1;if(this._reflectanceTexture&&!this._reflectanceTexture.isReadyOrNotBlocking())return!1;if(this._microSurfaceTexture&&!this._microSurfaceTexture.isReadyOrNotBlocking())return!1}if(F.getCaps().standardDerivatives&&this._bumpTexture&&G.c.BumpTextureEnabled&&!this._disableBumpMap&&!this._bumpTexture.isReady())return!1;if(this._environmentBRDFTexture&&G.c.ReflectionTextureEnabled&&!this._environmentBRDFTexture.isReady())return!1}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=k,this._eventInfo.subMesh=b,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(k._areImageProcessingDirty&&this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady())return!1;F.getCaps().standardDerivatives||K.isVerticesDataPresent(A.f.NormalKind)||(K.createNormals(!0),j.b.Warn("PBRMaterial: Normals have been created for the mesh: "+K.name));const Y=b.effect,X=k._areLightsDisposed;let t=this._prepareEffect(K,k,this.onCompiled,this.onError,e,null,b.getRenderingMesh().hasThinInstances),U=!1;if(t)if(this._onEffectCreatedObservable&&(O.effect=t,O.subMesh=b,this._onEffectCreatedObservable.notifyObservers(O)),this.allowShaderHotSwapping&&Y&&!t.isReady()){if(t=Y,k.markAsUnprocessed(),U=this.isFrozen,X)return k._areLightsDisposed=!0,!1}else T.resetCachedMaterial(),b.setEffect(t,k,this._materialContext);return!(!b.effect||!b.effect.isReady())&&(k._renderId=T.getRenderId(),z._wasPreviouslyReady=!U,z._wasPreviouslyUsingInstances=!!e,this._checkScenePerformancePriority(),!0)}isMetallicWorkflow(){return!(null==this._metallic&&null==this._roughness&&!this._metallicTexture)}_prepareEffect(K,b){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6?arguments[6]:void 0;if(this._prepareDefines(K,b,j,T,F),!b.isDirty)return null;b.markAsProcessed();const l=this.va().getEngine(),Y=new i.c;let X=0;b.USESPHERICALINVERTEX&&Y.addFallback(X++,"USESPHERICALINVERTEX"),b.FOG&&Y.addFallback(X,"FOG"),b.SPECULARAA&&Y.addFallback(X,"SPECULARAA"),b.POINTSIZE&&Y.addFallback(X,"POINTSIZE"),b.LOGARITHMICDEPTH&&Y.addFallback(X,"LOGARITHMICDEPTH"),b.PARALLAX&&Y.addFallback(X,"PARALLAX"),b.PARALLAX_RHS&&Y.addFallback(X,"PARALLAX_RHS"),b.PARALLAXOCCLUSION&&Y.addFallback(X++,"PARALLAXOCCLUSION"),b.ENVIRONMENTBRDF&&Y.addFallback(X++,"ENVIRONMENTBRDF"),b.TANGENT&&Y.addFallback(X++,"TANGENT"),b.BUMP&&Y.addFallback(X++,"BUMP"),X=(0,S.z)(b,Y,this._maxSimultaneousLights,X++),b.SPECULARTERM&&Y.addFallback(X++,"SPECULARTERM"),b.USESPHERICALFROMREFLECTIONMAP&&Y.addFallback(X++,"USESPHERICALFROMREFLECTIONMAP"),b.USEIRRADIANCEMAP&&Y.addFallback(X++,"USEIRRADIANCEMAP"),b.LIGHTMAP&&Y.addFallback(X++,"LIGHTMAP"),b.NORMAL&&Y.addFallback(X++,"NORMAL"),b.AMBIENT&&Y.addFallback(X++,"AMBIENT"),b.EMISSIVE&&Y.addFallback(X++,"EMISSIVE"),b.VERTEXCOLOR&&Y.addFallback(X++,"VERTEXCOLOR"),b.MORPHTARGETS&&Y.addFallback(X++,"MORPHTARGETS"),b.MULTIVIEW&&Y.addFallback(0,"MULTIVIEW");const t=[A.f.PositionKind];b.NORMAL&&t.push(A.f.NormalKind),b.TANGENT&&t.push(A.f.TangentKind);for(let e=1;e<=6;++e)b["UV"+e]&&t.push(`uv${1===e?"":e}`);b.VERTEXCOLOR&&t.push(A.f.ColorKind),(0,S.F)(t,K,b,Y),(0,S.G)(t,b),(0,S.K)(t,K,b),(0,S.B)(t,K,b);let U="pbr";const B=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vAlbedoColor","vReflectivityColor","vMetallicReflectanceFactors","vEmissiveColor","visibility","vReflectionColor","vFogInfos","vFogColor","pointSize","vAlbedoInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vReflectionPosition","vReflectionSize","vEmissiveInfos","vReflectivityInfos","vReflectionFilteringInfo","vMetallicReflectanceInfos","vReflectanceInfos","vMicroSurfaceSamplerInfos","vBumpInfos","vLightmapInfos","mBones","albedoMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","reflectivityMatrix","normalMatrix","microSurfaceSamplerMatrix","bumpMatrix","lightmapMatrix","metallicReflectanceMatrix","reflectanceMatrix","vLightingIntensity","logarithmicDepthConstant","vSphericalX","vSphericalY","vSphericalZ","vSphericalXX_ZZ","vSphericalYY_ZZ","vSphericalZZ","vSphericalXY","vSphericalYZ","vSphericalZX","vSphericalL00","vSphericalL1_1","vSphericalL10","vSphericalL11","vSphericalL2_2","vSphericalL2_1","vSphericalL20","vSphericalL21","vSphericalL22","vReflectionMicrosurfaceInfos","vTangentSpaceParams","boneTextureWidth","vDebugMode","morphTargetTextureInfo","morphTargetTextureIndices"],m=["albedoSampler","reflectivitySampler","ambientSampler","emissiveSampler","bumpSampler","lightmapSampler","opacitySampler","reflectionSampler","reflectionSamplerLow","reflectionSamplerHigh","irradianceSampler","microSurfaceSampler","environmentBrdfSampler","boneSampler","metallicReflectanceSampler","reflectanceSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],I=["Material","Scene","Mesh"],x={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:b.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=Y,this._eventInfo.fallbackRank=X,this._eventInfo.defines=b,this._eventInfo.uniforms=B,this._eventInfo.attributes=t,this._eventInfo.samplers=m,this._eventInfo.uniformBuffersNames=I,this._eventInfo.customCode=void 0,this._eventInfo.mesh=K,this._eventInfo.indexParameters=x,this._callbackPluginEventGeneric(128,this._eventInfo),a.e.AddUniformsAndSamplers(B,m),u.b.AddUniforms(B),u.b.AddSamplers(m),(0,p.c)(B),D.d&&(D.d.PrepareUniforms(B,b),D.d.PrepareSamplers(m,b)),(0,S.fb)({uniformsNames:B,uniformBuffersNames:I,samplers:m,defines:b,maxSimultaneousLights:this._maxSimultaneousLights});const Q={};this.customShaderNameResolve&&(U=this.customShaderNameResolve(U,B,I,m,b,t,Q));const G=b.toString(),M=l.createEffect(U,{attributes:t,uniformsNames:B,uniformBuffersNames:I,samplers:m,defines:G,fallbacks:Y,onCompiled:z,onError:k,indexParameters:x,processFinalCode:Q.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:b.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this.shaderLanguage?await Promise.all([Promise.all([e.e(21),e.e(43)]).then(e.bind(e,13218)),Promise.all([e.e(22),e.e(44)]).then(e.bind(e,13242))]):await Promise.all([Promise.all([e.e(25),e.e(45)]).then(e.bind(e,13244)),Promise.all([e.e(27),e.e(46)]).then(e.bind(e,13264))]),this._shadersLoaded=!0}},l);return this._eventInfo.customCode=void 0,M}_prepareDefines(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const j=this.va(),T=j.getEngine();(0,S.S)(j,K,b,!0,this._maxSimultaneousLights,this._disableLighting),b._needNormals=!0,(0,S.Z)(j,b);const F=this.needAlphaBlendingForMesh(K)&&this.va().useOrderIndependentTransparency;if((0,S.bb)(j,b,this.canRenderToMRT&&!F),(0,S.ab)(j,b,F),a.e.PrepareDefines(T.currentRenderPassId,K,b),b.METALLICWORKFLOW=this.isMetallicWorkflow(),b._areTexturesDirty){b._needUVs=!1;for(let K=1;K<=6;++K)b["MAINUV"+K]=!1;if(j.texturesEnabled){b.ALBEDODIRECTUV=0,b.AMBIENTDIRECTUV=0,b.OPACITYDIRECTUV=0,b.EMISSIVEDIRECTUV=0,b.REFLECTIVITYDIRECTUV=0,b.MICROSURFACEMAPDIRECTUV=0,b.METALLIC_REFLECTANCEDIRECTUV=0,b.REFLECTANCEDIRECTUV=0,b.BUMPDIRECTUV=0,b.LIGHTMAPDIRECTUV=0,T.getCaps().textureLOD&&(b.LODBASEDMICROSFURACE=!0),this._albedoTexture&&G.c.DiffuseTextureEnabled?((0,S.V)(this._albedoTexture,b,"ALBEDO"),b.GAMMAALBEDO=this._albedoTexture.gammaSpace):b.ALBEDO=!1,this._ambientTexture&&G.c.AmbientTextureEnabled?((0,S.V)(this._ambientTexture,b,"AMBIENT"),b.AMBIENTINGRAYSCALE=this._useAmbientInGrayScale):b.AMBIENT=!1,this._opacityTexture&&G.c.OpacityTextureEnabled?((0,S.V)(this._opacityTexture,b,"OPACITY"),b.OPACITYRGB=this._opacityTexture.getAlphaFromRGB):b.OPACITY=!1;const K=this._getReflectionTexture();if(K&&G.c.ReflectionTextureEnabled){switch(b.REFLECTION=!0,b.GAMMAREFLECTION=K.gammaSpace,b.RGBDREFLECTION=K.isRGBD,b.LODINREFLECTIONALPHA=K.lodLevelInAlpha,b.LINEARSPECULARREFLECTION=K.linearSpecularLOD,this.realTimeFiltering&&this.realTimeFilteringQuality>0?(b.NUM_SAMPLES=""+this.realTimeFilteringQuality,T._features.needTypeSuffixInShaderConstants&&(b.NUM_SAMPLES=b.NUM_SAMPLES+"u"),b.REALTIME_FILTERING=!0):b.REALTIME_FILTERING=!1,b.INVERTCUBICMAP=K.coordinatesMode===Q.c.INVCUBIC_MODE,b.REFLECTIONMAP_3D=K.isCube,b.REFLECTIONMAP_OPPOSITEZ=b.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!K.invertZ:K.invertZ,b.REFLECTIONMAP_CUBIC=!1,b.REFLECTIONMAP_EXPLICIT=!1,b.REFLECTIONMAP_PLANAR=!1,b.REFLECTIONMAP_PROJECTION=!1,b.REFLECTIONMAP_SKYBOX=!1,b.REFLECTIONMAP_SPHERICAL=!1,b.REFLECTIONMAP_EQUIRECTANGULAR=!1,b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,K.coordinatesMode){case Q.c.EXPLICIT_MODE:b.REFLECTIONMAP_EXPLICIT=!0;break;case Q.c.PLANAR_MODE:b.REFLECTIONMAP_PLANAR=!0;break;case Q.c.PROJECTION_MODE:b.REFLECTIONMAP_PROJECTION=!0;break;case Q.c.SKYBOX_MODE:b.REFLECTIONMAP_SKYBOX=!0;break;case Q.c.SPHERICAL_MODE:b.REFLECTIONMAP_SPHERICAL=!0;break;case Q.c.EQUIRECTANGULAR_MODE:b.REFLECTIONMAP_EQUIRECTANGULAR=!0;break;case Q.c.FIXED_EQUIRECTANGULAR_MODE:b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!0;break;case Q.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!0;break;case Q.c.CUBIC_MODE:case Q.c.INVCUBIC_MODE:default:b.REFLECTIONMAP_CUBIC=!0,b.USE_LOCAL_REFLECTIONMAP_CUBIC=!!K.boundingBoxSize}K.coordinatesMode!==Q.c.SKYBOX_MODE&&(K.irradianceTexture?(b.USEIRRADIANCEMAP=!0,b.USESPHERICALFROMREFLECTIONMAP=!1):K.isCube&&(b.USESPHERICALFROMREFLECTIONMAP=!0,b.USEIRRADIANCEMAP=!1,this._forceIrradianceInFragment||this.realTimeFiltering||this._twoSidedLighting||T.getCaps().maxVaryingVectors<=8?b.USESPHERICALINVERTEX=!1:b.USESPHERICALINVERTEX=!0))}else b.REFLECTION=!1,b.REFLECTIONMAP_3D=!1,b.REFLECTIONMAP_SPHERICAL=!1,b.REFLECTIONMAP_PLANAR=!1,b.REFLECTIONMAP_CUBIC=!1,b.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,b.REFLECTIONMAP_PROJECTION=!1,b.REFLECTIONMAP_SKYBOX=!1,b.REFLECTIONMAP_EXPLICIT=!1,b.REFLECTIONMAP_EQUIRECTANGULAR=!1,b.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,b.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,b.INVERTCUBICMAP=!1,b.USESPHERICALFROMREFLECTIONMAP=!1,b.USEIRRADIANCEMAP=!1,b.USESPHERICALINVERTEX=!1,b.REFLECTIONMAP_OPPOSITEZ=!1,b.LODINREFLECTIONALPHA=!1,b.GAMMAREFLECTION=!1,b.RGBDREFLECTION=!1,b.LINEARSPECULARREFLECTION=!1;this._lightmapTexture&&G.c.LightmapTextureEnabled?((0,S.V)(this._lightmapTexture,b,"LIGHTMAP"),b.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,b.GAMMALIGHTMAP=this._lightmapTexture.gammaSpace,b.RGBDLIGHTMAP=this._lightmapTexture.isRGBD):b.LIGHTMAP=!1,this._emissiveTexture&&G.c.EmissiveTextureEnabled?((0,S.V)(this._emissiveTexture,b,"EMISSIVE"),b.GAMMAEMISSIVE=this._emissiveTexture.gammaSpace):b.EMISSIVE=!1,G.c.SpecularTextureEnabled?(this._metallicTexture?((0,S.V)(this._metallicTexture,b,"REFLECTIVITY"),b.ROUGHNESSSTOREINMETALMAPALPHA=this._useRoughnessFromMetallicTextureAlpha,b.ROUGHNESSSTOREINMETALMAPGREEN=!this._useRoughnessFromMetallicTextureAlpha&&this._useRoughnessFromMetallicTextureGreen,b.METALLNESSSTOREINMETALMAPBLUE=this._useMetallnessFromMetallicTextureBlue,b.AOSTOREINMETALMAPRED=this._useAmbientOcclusionFromMetallicTextureRed,b.REFLECTIVITY_GAMMA=!1):this._reflectivityTexture?((0,S.V)(this._reflectivityTexture,b,"REFLECTIVITY"),b.MICROSURFACEFROMREFLECTIVITYMAP=this._useMicroSurfaceFromReflectivityMapAlpha,b.MICROSURFACEAUTOMATIC=this._useAutoMicroSurfaceFromReflectivityMap,b.REFLECTIVITY_GAMMA=this._reflectivityTexture.gammaSpace):b.REFLECTIVITY=!1,this._metallicReflectanceTexture||this._reflectanceTexture?(b.METALLIC_REFLECTANCE_USE_ALPHA_ONLY=this._useOnlyMetallicFromMetallicReflectanceTexture,this._metallicReflectanceTexture?((0,S.V)(this._metallicReflectanceTexture,b,"METALLIC_REFLECTANCE"),b.METALLIC_REFLECTANCE_GAMMA=this._metallicReflectanceTexture.gammaSpace):b.METALLIC_REFLECTANCE=!1,this._reflectanceTexture&&(!this._metallicReflectanceTexture||this._metallicReflectanceTexture&&this._useOnlyMetallicFromMetallicReflectanceTexture)?((0,S.V)(this._reflectanceTexture,b,"REFLECTANCE"),b.REFLECTANCE_GAMMA=this._reflectanceTexture.gammaSpace):b.REFLECTANCE=!1):(b.METALLIC_REFLECTANCE=!1,b.REFLECTANCE=!1),this._microSurfaceTexture?(0,S.V)(this._microSurfaceTexture,b,"MICROSURFACEMAP"):b.MICROSURFACEMAP=!1):(b.REFLECTIVITY=!1,b.MICROSURFACEMAP=!1),T.getCaps().standardDerivatives&&this._bumpTexture&&G.c.BumpTextureEnabled&&!this._disableBumpMap?((0,S.V)(this._bumpTexture,b,"BUMP"),this._useParallax&&this._albedoTexture&&G.c.DiffuseTextureEnabled?(b.PARALLAX=!0,b.PARALLAX_RHS=j.useRightHandedSystem,b.PARALLAXOCCLUSION=!!this._useParallaxOcclusion):b.PARALLAX=!1,b.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap):(b.BUMP=!1,b.PARALLAX=!1,b.PARALLAX_RHS=!1,b.PARALLAXOCCLUSION=!1,b.OBJECTSPACE_NORMALMAP=!1),this._environmentBRDFTexture&&G.c.ReflectionTextureEnabled?(b.ENVIRONMENTBRDF=!0,b.ENVIRONMENTBRDF_RGBD=this._environmentBRDFTexture.isRGBD):(b.ENVIRONMENTBRDF=!1,b.ENVIRONMENTBRDF_RGBD=!1),this._shouldUseAlphaFromAlbedoTexture()?b.ALPHAFROMALBEDO=!0:b.ALPHAFROMALBEDO=!1}b.SPECULAROVERALPHA=this._useSpecularOverAlpha,this._lightFalloff===N.LIGHTFALLOFF_STANDARD?(b.USEPHYSICALLIGHTFALLOFF=!1,b.USEGLTFLIGHTFALLOFF=!1):this._lightFalloff===N.LIGHTFALLOFF_GLTF?(b.USEPHYSICALLIGHTFALLOFF=!1,b.USEGLTFLIGHTFALLOFF=!0):(b.USEPHYSICALLIGHTFALLOFF=!0,b.USEGLTFLIGHTFALLOFF=!1),b.RADIANCEOVERALPHA=this._useRadianceOverAlpha,!this.Lg&&this._twoSidedLighting?b.TWOSIDEDLIGHTING=!0:b.TWOSIDEDLIGHTING=!1,b.SPECULARAA=T.getCaps().standardDerivatives&&this._enableSpecularAntiAliasing}(b._areTexturesDirty||b._areMiscDirty)&&(b.ALPHATESTVALUE=`${this._alphaCutOff}${this._alphaCutOff%1===0?".":""}`,b.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,b.ALPHABLEND=this.needAlphaBlendingForMesh(K),b.ALPHAFRESNEL=this._useAlphaFresnel||this._useLinearAlphaFresnel,b.LINEARALPHAFRESNEL=this._useLinearAlphaFresnel),b._areImageProcessingDirty&&this._imageProcessingConfiguration&&this._imageProcessingConfiguration.prepareDefines(b),b.FORCENORMALFORWARD=this._forceNormalForward,b.RADIANCEOCCLUSION=this._useRadianceOcclusion,b.HORIZONOCCLUSION=this._useHorizonOcclusion,b._areMiscDirty&&((0,S.W)(K,j,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(K)||this._forceAlphaTest,b,this._applyDecalMapAfterDetailMap),b.UNLIT=this._unlit||(this.pointsCloud||this.wireframe)&&!K.isVerticesDataPresent(A.f.NormalKind),b.DEBUGMODE=this._debugMode),(0,S.R)(j,T,this,b,!!e,z,k),this._eventInfo.defines=b,this._eventInfo.mesh=K,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,S.N)(K,b,!0,!0,!0,this._transparencyMode!==N.PBRMATERIAL_OPAQUE),this._callbackPluginEventPrepareDefines(this._eventInfo)}forceCompilation(K,b,e){const z={clipPlane:!1,useInstances:!1,...e};this._uniformBufferLayoutBuilt||this.buildUniformLayout(),this._callbackPluginEventGeneric(4,this._eventInfo);(()=>{if(this._breakShaderLoadedCheck)return;const e=new g(this._eventInfo.defineNames),k=this._prepareEffect(K,e,void 0,void 0,z.useInstances,z.clipPlane,K.hasThinInstances);this._onEffectCreatedObservable&&(O.effect=k,O.subMesh=null,this._onEffectCreatedObservable.notifyObservers(O)),k.isReady()?b&&b(this):k.onCompileObservable.add((()=>{b&&b(this)}))})()}buildUniformLayout(){const K=this._uniformBuffer;K.addUniform("vAlbedoInfos",2),K.addUniform("vAmbientInfos",4),K.addUniform("vOpacityInfos",2),K.addUniform("vEmissiveInfos",2),K.addUniform("vLightmapInfos",2),K.addUniform("vReflectivityInfos",3),K.addUniform("vMicroSurfaceSamplerInfos",2),K.addUniform("vReflectionInfos",2),K.addUniform("vReflectionFilteringInfo",2),K.addUniform("vReflectionPosition",3),K.addUniform("vReflectionSize",3),K.addUniform("vBumpInfos",3),K.addUniform("albedoMatrix",16),K.addUniform("ambientMatrix",16),K.addUniform("opacityMatrix",16),K.addUniform("emissiveMatrix",16),K.addUniform("lightmapMatrix",16),K.addUniform("reflectivityMatrix",16),K.addUniform("microSurfaceSamplerMatrix",16),K.addUniform("bumpMatrix",16),K.addUniform("vTangentSpaceParams",2),K.addUniform("reflectionMatrix",16),K.addUniform("vReflectionColor",3),K.addUniform("vAlbedoColor",4),K.addUniform("vLightingIntensity",4),K.addUniform("vReflectionMicrosurfaceInfos",3),K.addUniform("pointSize",1),K.addUniform("vReflectivityColor",4),K.addUniform("vEmissiveColor",3),K.addUniform("vAmbientColor",3),K.addUniform("vDebugMode",2),K.addUniform("vMetallicReflectanceFactors",4),K.addUniform("vMetallicReflectanceInfos",2),K.addUniform("metallicReflectanceMatrix",16),K.addUniform("vReflectanceInfos",2),K.addUniform("reflectanceMatrix",16),K.addUniform("vSphericalL00",3),K.addUniform("vSphericalL1_1",3),K.addUniform("vSphericalL10",3),K.addUniform("vSphericalL11",3),K.addUniform("vSphericalL2_2",3),K.addUniform("vSphericalL2_1",3),K.addUniform("vSphericalL20",3),K.addUniform("vSphericalL21",3),K.addUniform("vSphericalL22",3),K.addUniform("vSphericalX",3),K.addUniform("vSphericalY",3),K.addUniform("vSphericalZ",3),K.addUniform("vSphericalXX_ZZ",3),K.addUniform("vSphericalYY_ZZ",3),K.addUniform("vSphericalZZ",3),K.addUniform("vSphericalXY",3),K.addUniform("vSphericalYZ",3),K.addUniform("vSphericalZX",3),super.buildUniformLayout()}bindForSubMesh(K,b,e){const z=this.va(),k=e.materialDefines;if(!k)return;const j=e.effect;if(!j)return;this._activeEffect=j,b.getMeshUniformBuffer().bindToEffect(j,"Mesh"),b.transferToEffect(K);const T=z.getEngine();this._uniformBuffer.bindToEffect(j,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,z,b,K,this.isFrozen),a.e.Bind(T.currentRenderPassId,this._activeEffect,b,K),this._eventInfo.subMesh=e,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),k.OBJECTSPACE_NORMALMAP&&(K.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const F=this._mustRebind(z,j,e,b.visibility);(0,S.e)(b,this._activeEffect,this.prePassConfiguration);let Y=null;const A=this._uniformBuffer;if(F){if(this.bindViewProjection(j),Y=this._getReflectionTexture(),!A.useUbo||!this.isFrozen||!A.isSync||e._drawWrapper._forceRebindOnNextCall){var X;if(z.texturesEnabled){if(this._albedoTexture&&G.c.DiffuseTextureEnabled&&(A.updateFloat2("vAlbedoInfos",this._albedoTexture.coordinatesIndex,this._albedoTexture.level),(0,S.y)(this._albedoTexture,A,"albedo")),this._ambientTexture&&G.c.AmbientTextureEnabled&&(A.updateFloat4("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level,this._ambientTextureStrength,this._ambientTextureImpactOnAnalyticalLights),(0,S.y)(this._ambientTexture,A,"ambient")),this._opacityTexture&&G.c.OpacityTextureEnabled&&(A.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,S.y)(this._opacityTexture,A,"opacity")),Y&&G.c.ReflectionTextureEnabled){if(A.qj("reflectionMatrix",Y.getReflectionTextureMatrix()),A.updateFloat2("vReflectionInfos",Y.level,0),Y.boundingBoxSize){const K=Y;A.updateVector3("vReflectionPosition",K.boundingBoxPosition),A.updateVector3("vReflectionSize",K.boundingBoxSize)}if(this.realTimeFiltering){const K=Y.getSize().width;A.updateFloat2("vReflectionFilteringInfo",K,Math.log2(K))}if(!k.USEIRRADIANCEMAP){const K=Y.sphericalPolynomial;if(k.USESPHERICALFROMREFLECTIONMAP&&K)if(k.SPHERICAL_HARMONICS){const b=K.preScaledHarmonics;A.updateVector3("vSphericalL00",b.l00),A.updateVector3("vSphericalL1_1",b.l1_1),A.updateVector3("vSphericalL10",b.l10),A.updateVector3("vSphericalL11",b.l11),A.updateVector3("vSphericalL2_2",b.l2_2),A.updateVector3("vSphericalL2_1",b.l2_1),A.updateVector3("vSphericalL20",b.l20),A.updateVector3("vSphericalL21",b.l21),A.updateVector3("vSphericalL22",b.l22)}else A.updateFloat3("vSphericalX",K.x.x,K.x.y,K.x.z),A.updateFloat3("vSphericalY",K.y.x,K.y.y,K.y.z),A.updateFloat3("vSphericalZ",K.z.x,K.z.y,K.z.z),A.updateFloat3("vSphericalXX_ZZ",K.xx.x-K.zz.x,K.xx.y-K.zz.y,K.xx.z-K.zz.z),A.updateFloat3("vSphericalYY_ZZ",K.yy.x-K.zz.x,K.yy.y-K.zz.y,K.yy.z-K.zz.z),A.updateFloat3("vSphericalZZ",K.zz.x,K.zz.y,K.zz.z),A.updateFloat3("vSphericalXY",K.xy.x,K.xy.y,K.xy.z),A.updateFloat3("vSphericalYZ",K.yz.x,K.yz.y,K.yz.z),A.updateFloat3("vSphericalZX",K.zx.x,K.zx.y,K.zx.z)}A.updateFloat3("vReflectionMicrosurfaceInfos",Y.getSize().width,Y.lodGenerationScale,Y.lodGenerationOffset)}this._emissiveTexture&&G.c.EmissiveTextureEnabled&&(A.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,S.y)(this._emissiveTexture,A,"emissive")),this._lightmapTexture&&G.c.LightmapTextureEnabled&&(A.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,S.y)(this._lightmapTexture,A,"lightmap")),G.c.SpecularTextureEnabled&&(this._metallicTexture?(A.updateFloat3("vReflectivityInfos",this._metallicTexture.coordinatesIndex,this._metallicTexture.level,this._ambientTextureStrength),(0,S.y)(this._metallicTexture,A,"reflectivity")):this._reflectivityTexture&&(A.updateFloat3("vReflectivityInfos",this._reflectivityTexture.coordinatesIndex,this._reflectivityTexture.level,1),(0,S.y)(this._reflectivityTexture,A,"reflectivity")),this._metallicReflectanceTexture&&(A.updateFloat2("vMetallicReflectanceInfos",this._metallicReflectanceTexture.coordinatesIndex,this._metallicReflectanceTexture.level),(0,S.y)(this._metallicReflectanceTexture,A,"metallicReflectance")),this._reflectanceTexture&&k.REFLECTANCE&&(A.updateFloat2("vReflectanceInfos",this._reflectanceTexture.coordinatesIndex,this._reflectanceTexture.level),(0,S.y)(this._reflectanceTexture,A,"reflectance")),this._microSurfaceTexture&&(A.updateFloat2("vMicroSurfaceSamplerInfos",this._microSurfaceTexture.coordinatesIndex,this._microSurfaceTexture.level),(0,S.y)(this._microSurfaceTexture,A,"microSurfaceSampler"))),this._bumpTexture&&T.getCaps().standardDerivatives&&G.c.BumpTextureEnabled&&!this._disableBumpMap&&(A.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,this._bumpTexture.level,this._parallaxScaleBias),(0,S.y)(this._bumpTexture,A,"bump"),z._mirroredCameraPosition?A.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):A.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1))}if(this.pointsCloud&&A.updateFloat("pointSize",this.pointSize),k.METALLICWORKFLOW){var t;m.i.hb[0].r=void 0===this._metallic||null===this._metallic?1:this._metallic,m.i.hb[0].g=void 0===this._roughness||null===this._roughness?1:this._roughness,A.updateColor4("vReflectivityColor",m.i.hb[0],1);const K=(null===(t=this.subSurface)||void 0===t?void 0:t._indexOfRefraction)??1.5,b=1,e=Math.pow((K-b)/(K+b),2);this._metallicReflectanceColor.scaleToRef(e*this._metallicF0Factor,m.i.hb[0]);const z=this._metallicF0Factor;A.updateColor4("vMetallicReflectanceFactors",m.i.hb[0],z)}else A.updateColor4("vReflectivityColor",this._reflectivityColor,this._microSurface);A.updateColor3("vEmissiveColor",G.c.EmissiveTextureEnabled?this._emissiveColor:m.c.BlackReadOnly),A.updateColor3("vReflectionColor",this._reflectionColor),!k.SS_REFRACTION&&null!==(X=this.subSurface)&&void 0!==X&&X._linkRefractionWithTransparency?A.updateColor4("vAlbedoColor",this._albedoColor,1):A.updateColor4("vAlbedoColor",this._albedoColor,this.alpha),this._lightingInfos.x=this._directIntensity,this._lightingInfos.y=this._emissiveIntensity,this._lightingInfos.z=this._environmentIntensity*z.environmentIntensity,this._lightingInfos.w=this._specularIntensity,A.updateVector4("vLightingIntensity",this._lightingInfos),z.ambientColor.multiplyToRef(this._ambientColor,this._globalAmbientColor),A.updateColor3("vAmbientColor",this._globalAmbientColor),A.updateFloat2("vDebugMode",this.debugLimit,this.debugFactor)}z.texturesEnabled&&(this._albedoTexture&&G.c.DiffuseTextureEnabled&&A.setTexture("albedoSampler",this._albedoTexture),this._ambientTexture&&G.c.AmbientTextureEnabled&&A.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&G.c.OpacityTextureEnabled&&A.setTexture("opacitySampler",this._opacityTexture),Y&&G.c.ReflectionTextureEnabled&&(k.LODBASEDMICROSFURACE?A.setTexture("reflectionSampler",Y):(A.setTexture("reflectionSampler",Y._lodTextureMid||Y),A.setTexture("reflectionSamplerLow",Y._lodTextureLow||Y),A.setTexture("reflectionSamplerHigh",Y._lodTextureHigh||Y)),k.USEIRRADIANCEMAP&&A.setTexture("irradianceSampler",Y.irradianceTexture)),k.ENVIRONMENTBRDF&&A.setTexture("environmentBrdfSampler",this._environmentBRDFTexture),this._emissiveTexture&&G.c.EmissiveTextureEnabled&&A.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&G.c.LightmapTextureEnabled&&A.setTexture("lightmapSampler",this._lightmapTexture),G.c.SpecularTextureEnabled&&(this._metallicTexture?A.setTexture("reflectivitySampler",this._metallicTexture):this._reflectivityTexture&&A.setTexture("reflectivitySampler",this._reflectivityTexture),this._metallicReflectanceTexture&&A.setTexture("metallicReflectanceSampler",this._metallicReflectanceTexture),this._reflectanceTexture&&k.REFLECTANCE&&A.setTexture("reflectanceSampler",this._reflectanceTexture),this._microSurfaceTexture&&A.setTexture("microSurfaceSampler",this._microSurfaceTexture)),this._bumpTexture&&T.getCaps().standardDerivatives&&G.c.BumpTextureEnabled&&!this._disableBumpMap&&A.setTexture("bumpSampler",this._bumpTexture)),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(b)&&this.va().depthPeelingRenderer.bind(j),this._eventInfo.subMesh=e,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,p.d)(this._activeEffect,this,z),this.bindEyePosition(j)}else z.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(F||!this.isFrozen){var U;if(z.lightsEnabled&&!this._disableLighting&&(0,S.l)(z,b,this._activeEffect,k,this._maxSimultaneousLights),(z.fogEnabled&&b.applyFog&&z.fogMode!==l.e.FOGMODE_NONE||Y||this.subSurface.refractionTexture||b.receiveShadows||k.PREPASS)&&this.bindView(j),(0,S.h)(z,b,this._activeEffect,!0),k.NUM_MORPH_INFLUENCERS&&(0,S.q)(b,this._activeEffect),k.BAKED_VERTEX_ANIMATION_TEXTURE)null===(U=b.bakedVertexAnimationManager)||void 0===U||U.bind(j,k.INSTANCES);this._imageProcessingConfiguration.bind(this._activeEffect),(0,S.o)(k,this._activeEffect,z)}this._afterBind(b,this._activeEffect,e),A.update()}getAnimatables(){const K=super.getAnimatables();return this._albedoTexture&&this._albedoTexture.animations&&this._albedoTexture.animations.length>0&&K.push(this._albedoTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&K.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&K.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&K.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&K.push(this._emissiveTexture),this._metallicTexture&&this._metallicTexture.animations&&this._metallicTexture.animations.length>0?K.push(this._metallicTexture):this._reflectivityTexture&&this._reflectivityTexture.animations&&this._reflectivityTexture.animations.length>0&&K.push(this._reflectivityTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&K.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&K.push(this._lightmapTexture),this._metallicReflectanceTexture&&this._metallicReflectanceTexture.animations&&this._metallicReflectanceTexture.animations.length>0&&K.push(this._metallicReflectanceTexture),this._reflectanceTexture&&this._reflectanceTexture.animations&&this._reflectanceTexture.animations.length>0&&K.push(this._reflectanceTexture),this._microSurfaceTexture&&this._microSurfaceTexture.animations&&this._microSurfaceTexture.animations.length>0&&K.push(this._microSurfaceTexture),K}_getReflectionTexture(){return this._reflectionTexture?this._reflectionTexture:this.va().environmentTexture}getActiveTextures(){const K=super.getActiveTextures();return this._albedoTexture&&K.push(this._albedoTexture),this._ambientTexture&&K.push(this._ambientTexture),this._opacityTexture&&K.push(this._opacityTexture),this._reflectionTexture&&K.push(this._reflectionTexture),this._emissiveTexture&&K.push(this._emissiveTexture),this._reflectivityTexture&&K.push(this._reflectivityTexture),this._metallicTexture&&K.push(this._metallicTexture),this._metallicReflectanceTexture&&K.push(this._metallicReflectanceTexture),this._reflectanceTexture&&K.push(this._reflectanceTexture),this._microSurfaceTexture&&K.push(this._microSurfaceTexture),this._bumpTexture&&K.push(this._bumpTexture),this._lightmapTexture&&K.push(this._lightmapTexture),K}hasTexture(K){return!!super.hasTexture(K)||(this._albedoTexture===K||(this._ambientTexture===K||(this._opacityTexture===K||(this._reflectionTexture===K||(this._emissiveTexture===K||(this._reflectivityTexture===K||(this._metallicTexture===K||(this._metallicReflectanceTexture===K||(this._reflectanceTexture===K||(this._microSurfaceTexture===K||(this._bumpTexture===K||this._lightmapTexture===K)))))))))))}setPrePassRenderer(){var K;if(null===(K=this.subSurface)||void 0===K||!K.isScatteringEnabled)return!1;const b=this.va().enableSubSurfaceForPrePass();return b&&(b.enabled=!0),!0}dispose(K,b){var e,z,k,j,T,F,l,Y,A,X,t,U;(this._breakShaderLoadedCheck=!0,b)&&(this._environmentBRDFTexture&&this.va().environmentBRDFTexture!==this._environmentBRDFTexture&&this._environmentBRDFTexture.dispose(),null===(e=this._albedoTexture)||void 0===e||e.dispose(),null===(z=this._ambientTexture)||void 0===z||z.dispose(),null===(k=this._opacityTexture)||void 0===k||k.dispose(),null===(j=this._reflectionTexture)||void 0===j||j.dispose(),null===(T=this._emissiveTexture)||void 0===T||T.dispose(),null===(F=this._metallicTexture)||void 0===F||F.dispose(),null===(l=this._reflectivityTexture)||void 0===l||l.dispose(),null===(Y=this._bumpTexture)||void 0===Y||Y.dispose(),null===(A=this._lightmapTexture)||void 0===A||A.dispose(),null===(X=this._metallicReflectanceTexture)||void 0===X||X.dispose(),null===(t=this._reflectanceTexture)||void 0===t||t.dispose(),null===(U=this._microSurfaceTexture)||void 0===U||U.dispose());this._renderTargets.dispose(),this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(K,b)}}N.PBRMATERIAL_OPAQUE=I.b.MATERIAL_OPAQUE,N.PBRMATERIAL_ALPHATEST=I.b.MATERIAL_ALPHATEST,N.PBRMATERIAL_ALPHABLEND=I.b.MATERIAL_ALPHABLEND,N.PBRMATERIAL_ALPHATESTANDBLEND=I.b.MATERIAL_ALPHATESTANDBLEND,N.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=0,N.LIGHTFALLOFF_PHYSICAL=0,N.LIGHTFALLOFF_GLTF=1,N.LIGHTFALLOFF_STANDARD=2,N.ForceGLSL=!1,(0,z.b)([(0,k.u)()],N.prototype,"_imageProcessingConfiguration",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsMiscDirty")],N.prototype,"debugMode",void 0)},10790:(K,b,e)=>{"use strict";e.d(b,{b:()=>T});var z=e(10696);const k=new Map;function j(K,b){(function(K){return k.delete(K)})(K)&&z.b.Warn(`Extension with the name '${name}' already exists`),k.set(K,b)}function T(K,b){"image/ktx"!==b&&"image/ktx2"!==b||(K=".ktx"),k.has(K)||(K.endsWith(".dds")&&j(".dds",(()=>e.e(12).then(e.bind(e,12615)).then((K=>new K._DDSTextureLoader)))),K.endsWith(".basis")&&j(".basis",(()=>e.e(13).then(e.bind(e,12618)).then((K=>new K._BasisTextureLoader)))),K.endsWith(".env")&&j(".env",(()=>e.e(14).then(e.bind(e,12626)).then((K=>new K._ENVTextureLoader)))),K.endsWith(".hdr")&&j(".hdr",(()=>e.e(15).then(e.bind(e,12634)).then((K=>new K._HDRTextureLoader)))),(K.endsWith(".ktx")||K.endsWith(".ktx2"))&&(j(".ktx",(()=>e.e(16).then(e.bind(e,12640)).then((K=>new K._KTXTextureLoader)))),j(".ktx2",(()=>e.e(16).then(e.bind(e,12640)).then((K=>new K._KTXTextureLoader))))),K.endsWith(".tga")&&j(".tga",(()=>e.e(17).then(e.bind(e,12643)).then((K=>new K._TGATextureLoader)))),K.endsWith(".exr")&&j(".exr",(()=>e.e(18).then(e.bind(e,12650)).then((K=>new K._ExrTextureLoader)))));const z=k.get(K);return z?Promise.resolve(z(b)):null}},11170:(K,b,e)=>{"use strict";e.d(b,{d:()=>t});var z=e(10936),k=e(10938),j=e(10690),T=e(10967),F=e(10720),l=e(10801),Y=(e(10723),e(11179));class A{get wrapU(){return this._wrapU}set wrapU(K){this._wrapU=K}get wrapV(){return this._wrapV}set wrapV(K){this._wrapV=K}get coordinatesMode(){return 0}get isCube(){return!!this._texture&&this._texture.isCube}set isCube(K){this._texture&&(this._texture.isCube=K)}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(K){this._texture&&(this._texture.is3D=K)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(K){this._texture&&(this._texture.is2DArray=K)}getClassName(){return"ThinTexture"}static _IsRenderTargetWrapper(K){return void 0!==(null===K||void 0===K?void 0:K.shareDepth)}constructor(K){this._wrapU=1,this._wrapV=1,this.wrapR=1,this.anisotropicFilteringLevel=4,this.delayLoadState=0,this._texture=null,this._engine=null,this._cachedSize=Y.c.Zero(),this._cachedBaseSize=Y.c.Zero(),this._initialSamplingMode=2,this._texture=A._IsRenderTargetWrapper(K)?K.texture:K,this._texture&&(this._engine=this._texture.getEngine())}isReady(){return 4===this.delayLoadState?(this.delayLoad(),!1):!!this._texture&&this._texture.isReady}delayLoad(){}getInternalTexture(){return this._texture}getSize(){if(this._texture){if(this._texture.width)return this._cachedSize.width=this._texture.width,this._cachedSize.height=this._texture.height,this._cachedSize;if(this._texture._size)return this._cachedSize.width=this._texture._size,this._cachedSize.height=this._texture._size,this._cachedSize}return this._cachedSize}getBaseSize(){return this.isReady()&&this._texture?this._texture._size?(this._cachedBaseSize.width=this._texture._size,this._cachedBaseSize.height=this._texture._size,this._cachedBaseSize):(this._cachedBaseSize.width=this._texture.baseWidth,this._cachedBaseSize.height=this._texture.baseHeight,this._cachedBaseSize):(this._cachedBaseSize.width=0,this._cachedBaseSize.height=0,this._cachedBaseSize)}get samplingMode(){return this._texture?this._texture.samplingMode:this._initialSamplingMode}updateSamplingMode(K){this._texture&&this._engine&&this._engine.updateTextureSamplingMode(K,this._texture)}releaseInternalTexture(){this._texture&&(this._texture.dispose(),this._texture=null)}dispose(){this._texture&&(this.releaseInternalTexture(),this._engine=null)}}var X=e(11001);class t extends A{set ke(K){this._hasAlpha!==K&&(this._hasAlpha=K,this._scene&&this._scene.markAllMaterialsAsDirty(1,(K=>K.hasTexture(this))))}get ke(){return this._hasAlpha}set getAlphaFromRGB(K){this._getAlphaFromRGB!==K&&(this._getAlphaFromRGB=K,this._scene&&this._scene.markAllMaterialsAsDirty(1,(K=>K.hasTexture(this))))}get getAlphaFromRGB(){return this._getAlphaFromRGB}set coordinatesIndex(K){this._coordinatesIndex!==K&&(this._coordinatesIndex=K,this._scene&&this._scene.markAllMaterialsAsDirty(1,(K=>K.hasTexture(this))))}get coordinatesIndex(){return this._coordinatesIndex}set coordinatesMode(K){this._coordinatesMode!==K&&(this._coordinatesMode=K,this._scene&&this._scene.markAllMaterialsAsDirty(1,(K=>K.hasTexture(this))))}get coordinatesMode(){return this._coordinatesMode}get wrapU(){return this._wrapU}set wrapU(K){this._wrapU=K}get wrapV(){return this._wrapV}set wrapV(K){this._wrapV=K}get isCube(){return this._texture?this._texture.isCube:this._isCube}set isCube(K){this._texture?this._texture.isCube=K:this._isCube=K}get is3D(){return!!this._texture&&this._texture.is3D}set is3D(K){this._texture&&(this._texture.is3D=K)}get is2DArray(){return!!this._texture&&this._texture.is2DArray}set is2DArray(K){this._texture&&(this._texture.is2DArray=K)}get gammaSpace(){return this._texture?(null===this._texture._gammaSpace&&(this._texture._gammaSpace=this._gammaSpace),this._texture._gammaSpace&&!this._texture._useSRGBBuffer):this._gammaSpace}set gammaSpace(K){var b;if(this._texture){if(this._texture._gammaSpace===K)return;this._texture._gammaSpace=K}else{if(this._gammaSpace===K)return;this._gammaSpace=K}null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1,(K=>K.hasTexture(this)))}get isRGBD(){return null!=this._texture&&this._texture._isRGBD}set isRGBD(K){var b;K!==this.isRGBD&&(this._texture&&(this._texture._isRGBD=K),null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1,(K=>K.hasTexture(this))))}get noMipmap(){return!1}get lodGenerationOffset(){return this._texture?this._texture._lodGenerationOffset:0}set lodGenerationOffset(K){this._texture&&(this._texture._lodGenerationOffset=K)}get lodGenerationScale(){return this._texture?this._texture._lodGenerationScale:0}set lodGenerationScale(K){this._texture&&(this._texture._lodGenerationScale=K)}get linearSpecularLOD(){return!!this._texture&&this._texture._linearSpecularLOD}set linearSpecularLOD(K){this._texture&&(this._texture._linearSpecularLOD=K)}get irradianceTexture(){return this._texture?this._texture._irradianceTexture:null}set irradianceTexture(K){this._texture&&(this._texture._irradianceTexture=K)}get uid(){return this._uid||(this._uid=(0,l.b)()),this._uid}toString(){return this.name}getClassName(){return"BaseTexture"}set onDispose(K){this._onDisposeObserver&&this.Ui.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ui.add(K)}get isBlocking(){return!0}get loadingError(){return this._loadingError}get errorObject(){return this._errorObject}constructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;super(null),this.metadata=null,this.reservedDataStore=null,this._hasAlpha=!1,this._getAlphaFromRGB=!1,this.level=1,this._coordinatesIndex=0,this.optimizeUVAllocation=!0,this._coordinatesMode=0,this.wrapR=1,this.anisotropicFilteringLevel=t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL,this._isCube=!1,this._gammaSpace=!0,this.invertZ=!1,this.lodLevelInAlpha=!1,this.isRenderTarget=!1,this._prefiltered=!1,this._forceSerialize=!1,this.animations=[],this.Ui=new j.d,this._onDisposeObserver=null,this._scene=null,this._uid=null,this._parentContainer=null,this._loadingError=!1,K?t._IsScene(K)?this._scene=K:this._engine=K:this._scene=F.b.LastCreatedScene,this._scene&&(this.uniqueId=this._scene.getUniqueId(),this._scene.addTexture(this),this._engine=this._scene.getEngine()),this._texture=b,this._uid=null}va(){return this._scene}_getEngine(){return this._engine}getTextureMatrix(){return T.b.IdentityReadOnly}getReflectionTextureMatrix(){return T.b.IdentityReadOnly}getRefractionTextureMatrix(){return this.getReflectionTextureMatrix()}isReadyOrNotBlocking(){return!this.isBlocking||this.isReady()||this.loadingError}scale(K){}get canRescale(){return!1}_getFromCache(K,b,e,z,k,j){const T=this._getEngine();if(!T)return null;const F=T._getUseSRGBBuffer(!!k,b),l=T.getLoadedTexturesCache();for(let Y=0;Y<l.length;Y++){const T=l[Y];if((void 0===k||F===T._useSRGBBuffer)&&(void 0===z||z===T.invertY)&&T.url===K&&T.generateMipMaps===!b&&(!e||e===T.samplingMode)&&(void 0===j||j===T.isCube))return T.incrementReferences(),T}return null}_rebuild(){}clone(){return null}get textureType(){return this._texture&&void 0!==this._texture.type?this._texture.type:0}get textureFormat(){return this._texture&&void 0!==this._texture.format?this._texture.format:5}_markAllSubMeshesAsTexturesDirty(){const K=this.va();K&&K.markAllMaterialsAsDirty(1)}readPixels(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:Number.MAX_VALUE,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:Number.MAX_VALUE;if(!this._texture)return null;const Y=this._getEngine();if(!Y)return null;const A=this.getSize();let X=A.width,t=A.height;0!==b&&(X/=Math.pow(2,b),t/=Math.pow(2,b),X=Math.round(X),t=Math.round(t)),F=Math.min(X,F),l=Math.min(t,l);try{return this._texture.isCube?Y._readTexturePixels(this._texture,F,l,K,b,e,z,k,j,T):Y._readTexturePixels(this._texture,F,l,-1,b,e,z,k,j,T)}catch(U){return null}}_readPixelsSync(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!this._texture)return null;const j=this.getSize();let T=j.width,F=j.height;const l=this._getEngine();if(!l)return null;0!=b&&(T/=Math.pow(2,b),F/=Math.pow(2,b),T=Math.round(T),F=Math.round(F));try{return this._texture.isCube?l._readTexturePixelsSync(this._texture,T,F,K,b,e,z,k):l._readTexturePixelsSync(this._texture,T,F,-1,b,e,z,k)}catch(Y){return null}}get _lodTextureHigh(){return this._texture?this._texture._lodTextureHigh:null}get _lodTextureMid(){return this._texture?this._texture._lodTextureMid:null}get _lodTextureLow(){return this._texture?this._texture._lodTextureLow:null}dispose(){if(this._scene){this._scene.stopAnimation&&this._scene.stopAnimation(this),this._scene.removePendingData(this);const K=this._scene.textures.indexOf(this);if(K>=0&&this._scene.textures.splice(K,1),this._scene.onTextureRemovedObservable.notifyObservers(this),this._scene=null,this._parentContainer){const K=this._parentContainer.textures.indexOf(this);K>-1&&this._parentContainer.textures.splice(K,1),this._parentContainer=null}}this.Ui.notifyObservers(this),this.Ui.clear(),this.metadata=null,super.dispose()}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.name&&!K)return null;const b=X.e.Serialize(this);return X.e.AppendSerializedAnimations(this,b),b}static WhenAllReady(K,b){let e=K.length;if(0!==e)for(let z=0;z<K.length;z++){const k=K[z];if(k.isReady())0===--e&&b();else{const K=k.onLoadObservable;K?K.addOnce((()=>{0===--e&&b()})):0===--e&&b()}}else b()}static _IsScene(K){return"Scene"===K.getClassName()}}t.DEFAULT_ANISOTROPIC_FILTERING_LEVEL=4,(0,z.b)([(0,k.M)()],t.prototype,"uniqueId",void 0),(0,z.b)([(0,k.M)()],t.prototype,"name",void 0),(0,z.b)([(0,k.M)()],t.prototype,"metadata",void 0),(0,z.b)([(0,k.M)("ke")],t.prototype,"_hasAlpha",void 0),(0,z.b)([(0,k.M)("getAlphaFromRGB")],t.prototype,"_getAlphaFromRGB",void 0),(0,z.b)([(0,k.M)()],t.prototype,"level",void 0),(0,z.b)([(0,k.M)("coordinatesIndex")],t.prototype,"_coordinatesIndex",void 0),(0,z.b)([(0,k.M)()],t.prototype,"optimizeUVAllocation",void 0),(0,z.b)([(0,k.M)("coordinatesMode")],t.prototype,"_coordinatesMode",void 0),(0,z.b)([(0,k.M)()],t.prototype,"wrapU",null),(0,z.b)([(0,k.M)()],t.prototype,"wrapV",null),(0,z.b)([(0,k.M)()],t.prototype,"wrapR",void 0),(0,z.b)([(0,k.M)()],t.prototype,"anisotropicFilteringLevel",void 0),(0,z.b)([(0,k.M)()],t.prototype,"isCube",null),(0,z.b)([(0,k.M)()],t.prototype,"is3D",null),(0,z.b)([(0,k.M)()],t.prototype,"is2DArray",null),(0,z.b)([(0,k.M)()],t.prototype,"gammaSpace",null),(0,z.b)([(0,k.M)()],t.prototype,"invertZ",void 0),(0,z.b)([(0,k.M)()],t.prototype,"lodLevelInAlpha",void 0),(0,z.b)([(0,k.M)()],t.prototype,"lodGenerationOffset",null),(0,z.b)([(0,k.M)()],t.prototype,"lodGenerationScale",null),(0,z.b)([(0,k.M)()],t.prototype,"linearSpecularLOD",null),(0,z.b)([(0,k.E)()],t.prototype,"irradianceTexture",null),(0,z.b)([(0,k.M)()],t.prototype,"isRenderTarget",void 0)},11922:(K,b,e)=>{"use strict";var z=e(11505),k=e(11170);k.d.prototype.forceSphericalPolynomialsRecompute=function(){this._texture&&(this._texture._sphericalPolynomial=null,this._texture._sphericalPolynomialPromise=null,this._texture._sphericalPolynomialComputed=!1)},Object.defineProperty(k.d.prototype,"sphericalPolynomial",{get:function(){if(this._texture){if(this._texture._sphericalPolynomial||this._texture._sphericalPolynomialComputed)return this._texture._sphericalPolynomial;if(this._texture.isReady)return this._texture._sphericalPolynomialPromise||(this._texture._sphericalPolynomialPromise=z.d.ConvertCubeMapTextureToSphericalPolynomial(this),null===this._texture._sphericalPolynomialPromise?this._texture._sphericalPolynomialComputed=!0:this._texture._sphericalPolynomialPromise.then((K=>{this._texture._sphericalPolynomial=K,this._texture._sphericalPolynomialComputed=!0}))),null}return null},set:function(K){this._texture&&(this._texture._sphericalPolynomial=K)},enumerable:!0,configurable:!0})},11974:(K,b,e)=>{"use strict";e.d(b,{d:()=>t});var z=e(10936),k=e(10938),j=e(10686),T=e(10967),F=e(11170),l=e(11161),Y=e(10799),A=e(10690),X=e(11001);e(11531);class t extends F.d{set boundingBoxSize(K){if(this._boundingBoxSize&&this._boundingBoxSize.equals(K))return;this._boundingBoxSize=K;const b=this.va();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}set rotationY(K){this._rotationY=K,this.setReflectionTextureMatrix(T.b.RotationY(this._rotationY))}get rotationY(){return this._rotationY}get noMipmap(){return this._noMipmap}get forcedExtension(){return this._forcedExtension}static CreateFromImages(K,b,e){let z="";return K.forEach((K=>z+=K)),new t(z,b,null,e,K)}static CreateFromPrefilteredData(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=b.useDelayedTextureLoading;b.useDelayedTextureLoading=!1;const j=new t(K,b,null,!1,null,null,null,void 0,!0,e,z);return b.useDelayedTextureLoading=k,j}constructor(K,b){var e;let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,X=arguments.length>7&&void 0!==arguments[7]?arguments[7]:5,t=arguments.length>8&&void 0!==arguments[8]&&arguments[8],U=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,B=arguments.length>10&&void 0!==arguments[10]&&arguments[10],u=arguments.length>11&&void 0!==arguments[11]?arguments[11]:.8,m=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,D=arguments.length>13?arguments[13]:void 0,I=arguments.length>14?arguments[14]:void 0;super(b),this.onLoadObservable=new A.d,this.boundingBoxPosition=T.k.Zero(),this._rotationY=0,this._files=null,this._forcedExtension=null,this._extensions=null,this._textureMatrixRefraction=new T.b,this._buffer=null,this.name=K,this.url=K,this._noMipmap=k,this.ke=!1,this.isCube=!0,this._textureMatrix=T.b.Identity(),this.coordinatesMode=l.c.CUBIC_MODE;let x=null,Q=null;null===z||Array.isArray(z)?(this._noMipmap=k,this._format=X,this._createPolynomials=B,x=z,this._loaderOptions=D,this._useSRGBBuffer=I,this._lodScale=u,this._lodOffset=m):(x=z.extensions??null,this._noMipmap=z.noMipmap??!1,j=z.files??null,Q=z.buffer??null,this._format=z.format??5,t=z.prefiltered??!1,U=z.forcedExtension??null,this._createPolynomials=z.createPolynomials??!1,this._lodScale=z.lodScale??.8,this._lodOffset=z.lodOffset??0,this._loaderOptions=z.loaderOptions,this._useSRGBBuffer=z.useSRGBBuffer,F=z.X??null,Y=z.onError??null),(K||j)&&this.updateURL(K,U,F,t,Y,x,null===(e=this.va())||void 0===e?void 0:e.useDelayedTextureLoading,j,Q)}getClassName(){return"CubeTexture"}updateURL(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.name&&!this.name.startsWith("data:")||(this.name=K),this.url=K,b&&(this._forcedExtension=b);const Y=K.lastIndexOf("."),A=b||(Y>-1?K.substring(Y).toLowerCase():""),X=0===A.indexOf(".dds"),t=0===A.indexOf(".env"),U=0===A.indexOf(".basis");if(t?(this.gammaSpace=!1,this._prefiltered=!1,this.anisotropicFilteringLevel=1):(this._prefiltered=z,z&&(this.gammaSpace=!1,this.anisotropicFilteringLevel=1)),F)this._files=F;else if(U||t||X||j||(j=["_px.jpg","_py.jpg","_pz.jpg","_nx.jpg","_ny.jpg","_nz.jpg"]),this._files=this._files||[],this._files.length=0,j){for(let b=0;b<j.length;b++)this._files.push(K+j[b]);this._extensions=j}this._buffer=l,T?(this.delayLoadState=4,this._delayedOnLoad=e,this._delayedOnError=k):this._loadTexture(e,k)}delayLoad(K){4===this.delayLoadState&&(K&&(this._forcedExtension=K),this.delayLoadState=1,this._loadTexture(this._delayedOnLoad,this._delayedOnError))}getReflectionTextureMatrix(){return this._textureMatrix}setReflectionTextureMatrix(K){var b,e;if(K.updateFlag===this._textureMatrix.updateFlag)return;K.isIdentity()!==this._textureMatrix.isIdentity()&&(null===(e=this.va())||void 0===e||e.markAllMaterialsAsDirty(1,(K=>-1!==K.getActiveTextures().indexOf(this))));if(this._textureMatrix=K,null===(b=this.va())||void 0===b||!b.useRightHandedSystem)return;const z=T.e.gb[0],k=T.e.Quaternion[0],j=T.e.gb[1];this._textureMatrix.decompose(z,k,j),k.z*=-1,k.w*=-1,T.b.ComposeToRef(z,k,j,this._textureMatrixRefraction)}getRefractionTextureMatrix(){var K;return null!==(K=this.va())&&void 0!==K&&K.useRightHandedSystem?this._textureMatrixRefraction:this._textureMatrix}_loadTexture(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this.va(),z=this._texture;this._texture=this._getFromCache(this.url,this._noMipmap,void 0,void 0,this._useSRGBBuffer,this.isCube);const k=()=>{var b;(this.onLoadObservable.notifyObservers(this),z)&&(z.dispose(),null===(b=this.va())||void 0===b||b.markAllMaterialsAsDirty(1));K&&K()},T=(K,e)=>{this._loadingError=!0,this._errorObject={message:K,exception:e},b&&b(K,e),l.c.OnTextureLoadErrorObservable.notifyObservers(this)};var F;this._texture?this._texture.isReady?j.f.SetImmediate((()=>k())):this._texture.onLoadedObservable.add((()=>k())):(this._prefiltered?this._texture=this._getEngine().createPrefilteredCubeTexture(this.url,e,this._lodScale,this._lodOffset,K,T,this._format,this._forcedExtension,this._createPolynomials):this._texture=this._getEngine().createCubeTexture(this.url,e,this._files,this._noMipmap,K,T,this._format,this._forcedExtension,!1,this._lodScale,this._lodOffset,null,this._loaderOptions,!!this._useSRGBBuffer,this._buffer),null===(F=this._texture)||void 0===F||F.onLoadedObservable.add((()=>this.onLoadObservable.notifyObservers(this))))}static Parse(K,b,e){const z=X.e.Parse((()=>{let z=!1;return K.prefiltered&&(z=K.prefiltered),new t(e+(K.url??K.name),b,K.extensions,!1,K.files||null,null,null,void 0,z,K.forcedExtension)}),K,b);if(K.boundingBoxPosition&&(z.boundingBoxPosition=T.k.Bg(K.boundingBoxPosition)),K.boundingBoxSize&&(z.boundingBoxSize=T.k.Bg(K.boundingBoxSize)),K.animations)for(let k=0;k<K.animations.length;k++){const b=K.animations[k],e=(0,Y.d)("BABYLON.Animation");e&&z.animations.push(e.Parse(b))}return z}clone(){let K=0;const b=X.e.Clone((()=>{const b=new t(this.url,this.va()||this._getEngine(),this._extensions,this._noMipmap,this._files);return K=b.uniqueId,b}),this);return b.uniqueId=K,b}}(0,z.b)([(0,k.M)()],t.prototype,"url",void 0),(0,z.b)([(0,k.L)()],t.prototype,"boundingBoxPosition",void 0),(0,z.b)([(0,k.L)()],t.prototype,"boundingBoxSize",null),(0,z.b)([(0,k.M)("rotationY")],t.prototype,"rotationY",null),(0,z.b)([(0,k.M)("files")],t.prototype,"_files",void 0),(0,z.b)([(0,k.M)("forcedExtension")],t.prototype,"_forcedExtension",void 0),(0,z.b)([(0,k.M)("extensions")],t.prototype,"_extensions",void 0),(0,z.b)([(0,k.v)("textureMatrix")],t.prototype,"_textureMatrix",void 0),(0,z.b)([(0,k.v)("textureMatrixRefraction")],t.prototype,"_textureMatrixRefraction",void 0),l.c._CubeTextureParser=t.Parse,(0,Y.e)("BABYLON.CubeTexture",t)},12362:(K,b,e)=>{"use strict";e.d(b,{d:()=>l});var z=e(10696),k=e(11161),j=e(10803),T=e(11415),F=e(10780);T.ThinEngine.prototype.createDynamicTexture=function(K,b,e,z){const k=new F.e(this,4);return k.baseWidth=K,k.baseHeight=b,e&&(K=this.needPOTTextures?(0,j.g)(K,this._caps.maxTextureSize):K,b=this.needPOTTextures?(0,j.g)(b,this._caps.maxTextureSize):b),k.width=K,k.height=b,k.isReady=!1,k.generateMipMaps=e,k.samplingMode=z,this.updateTextureSamplingMode(z,k),this._internalTexturesCache.push(k),k},T.ThinEngine.prototype.updateDynamicTexture=function(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!K)return;const T=this._gl,F=T.TEXTURE_2D,l=this._bindTextureDirectly(F,K,!0,j);this._unpackFlipY(void 0===e?K.invertY:e),z&&T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);const Y=this._getWebGLTextureType(K.type),A=this._getInternalFormat(k||K.format),X=this._getRGBABufferInternalSizedFormat(K.type,A);T.texImage2D(F,0,X,A,Y,b),K.generateMipMaps&&T.generateMipmap(F),l||this._bindTextureDirectly(F,null),z&&T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),k&&(K.format=k),K._dynamicTextureSource=b,K._premulAlpha=z,K.invertY=e||!1,K.isReady=!0};class l extends k.c{constructor(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,F=arguments.length>6?arguments[6]:void 0;const l=!e||e._isScene;super(null,l?e:null===e||void 0===e?void 0:e.Ad,l?!z:e,F,j,void 0,void 0,void 0,void 0,T),this.name=K,this.wrapU=k.c.CLAMP_ADDRESSMODE,this.wrapV=k.c.CLAMP_ADDRESSMODE,this._generateMipMaps=z;const Y=this._getEngine();if(!Y)return;if(b.getContext)this._canvas=b,this._ownCanvas=!1,this._texture=Y.createDynamicTexture(this._canvas.width,this._canvas.height,z,j);else{this._canvas=Y.createCanvas(1,1),this._ownCanvas=!0;const K=b;K.width||0===K.width?this._texture=Y.createDynamicTexture(K.width,K.height,z,j):this._texture=Y.createDynamicTexture(b,b,z,j)}const A=this.getSize();this._canvas.width!==A.width&&(this._canvas.width=A.width),this._canvas.height!==A.height&&(this._canvas.height=A.height),this._context=this._canvas.getContext("2d")}getClassName(){return"DynamicTexture"}get canRescale(){return!0}_recreate(K){this._canvas.width=K.width,this._canvas.height=K.height,this.releaseInternalTexture(),this._texture=this._getEngine().createDynamicTexture(K.width,K.height,this._generateMipMaps,this.samplingMode)}scale(K){const b=this.getSize();b.width*=K,b.height*=K,this._recreate(b)}scaleTo(K,b){const e=this.getSize();e.width=K,e.height=b,this._recreate(e)}getContext(){return this._context}clear(K){const b=this.getSize();K&&(this._context.fillStyle=K),this._context.clearRect(0,0,b.width,b.height)}update(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._getEngine().updateDynamicTexture(this._texture,this._canvas,void 0===K||K,b,this._format||void 0,void 0,e)}drawText(K,b,e,z,k,j,T){let F=!(arguments.length>7&&void 0!==arguments[7])||arguments[7];const l=this.getSize();if(j&&(this._context.fillStyle=j,this._context.fillRect(0,0,l.width,l.height)),this._context.font=z,null===b||void 0===b){const e=this._context.measureText(K);b=(l.width-e.width)/2}if(null===e||void 0===e){const K=parseInt(z.replace(/\D/g,""));e=l.height/2+K/3.65}this._context.fillStyle=k||"",this._context.fillText(K,b,e),F&&this.update(T)}dispose(){var K,b;(super.dispose(),this._ownCanvas)&&(null===(K=this._canvas)||void 0===K||null===(b=K.remove)||void 0===b||b.call(K));this._canvas=null,this._context=null}clone(){const K=this.va();if(!K)return this;const b=this.getSize(),e=new l(this.name,b,K,this._generateMipMaps);return e.ke=this.ke,e.level=this.level,e.wrapU=this.wrapU,e.wrapV=this.wrapV,e}serialize(){const K=this.va();K&&!K.isReady()&&z.b.Warn("The scene must be ready before serializing the dynamic texture");const b=super.serialize();return l._IsCanvasElement(this._canvas)&&(b.base64String=this._canvas.toDataURL()),b.invertY=this._invertY,b.samplingMode=this.samplingMode,b}static _IsCanvasElement(K){return void 0!==K.toDataURL}_rebuild(){this.update()}}},10780:(K,b,e)=>{"use strict";e.d(b,{e:()=>T});var z,k=e(10690),j=e(10785);!function(K){K[K.Unknown=0]="Unknown",K[K.Url=1]="Url",K[K.Temp=2]="Temp",K[K.Raw=3]="Raw",K[K.Dynamic=4]="Dynamic",K[K.RenderTarget=5]="RenderTarget",K[K.MultiRenderTarget=6]="MultiRenderTarget",K[K.Cube=7]="Cube",K[K.CubeRaw=8]="CubeRaw",K[K.CubePrefiltered=9]="CubePrefiltered",K[K.Raw3D=10]="Raw3D",K[K.Raw2DArray=11]="Raw2DArray",K[K.DepthStencil=12]="DepthStencil",K[K.CubeRawRGBD=13]="CubeRawRGBD",K[K.Depth=14]="Depth"}(z||(z={}));class T extends j.b{get useMipMaps(){return this.generateMipMaps}set useMipMaps(K){this.generateMipMaps=K}get uniqueId(){return this._uniqueId}_setUniqueId(K){this._uniqueId=K}getEngine(){return this._engine}get source(){return this._source}constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];super(),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new k.d,this.onErrorObservable=new k.d,this.onRebuildCallback=null,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=0,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._cachedCoordinatesMode=null,this._isDisabled=!1,this._compression=null,this._sphericalPolynomial=null,this._sphericalPolynomialPromise=null,this._sphericalPolynomialComputed=!1,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._useSRGBBuffer=!1,this._creationFlags=0,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._hardwareTexture=null,this._maxLodLevel=null,this._references=1,this._gammaSpace=null,this._premulAlpha=!1,this._dynamicTextureSource=null,this._engine=K,this._source=b,this._uniqueId=T._Counter++,e||(this._hardwareTexture=K._createHardwareTexture())}incrementReferences(){this._references++}updateSize(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this._engine.updateTextureDimensions(this,K,b,e),this.width=K,this.height=b,this.depth=e,this.baseWidth=K,this.baseHeight=b,this.baseDepth=e,this._size=K*b*e}_rebuild(){if(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this.onRebuildCallback){const K=this.onRebuildCallback(this),b=b=>{b._swapAndDie(this,!1),this.isReady=K.isReady};return void(K.isAsync?K.proxy.then(b):b(K.proxy))}let K;switch(this.source){case 2:case 12:case 14:break;case 1:return void(K=this._engine.createTexture(this._originalUrl??this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(K=>{K._swapAndDie(this,!1),this.isReady=!0}),null,this._buffer,void 0,this.format,this._extension,void 0,void 0,void 0,this._useSRGBBuffer));case 3:K=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type,this._creationFlags,this._useSRGBBuffer),K._swapAndDie(this,!1),this.isReady=!0;break;case 10:K=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),K._swapAndDie(this,!1),this.isReady=!0;break;case 11:K=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression,this.type),K._swapAndDie(this,!1),this.isReady=!0;break;case 4:K=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode),K._swapAndDie(this,!1),this._dynamicTextureSource&&this._engine.updateDynamicTexture(this,this._dynamicTextureSource,this.invertY,this._premulAlpha,this.format,!0);break;case 7:return void(K=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(()=>{K._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension,!1,0,0,null,void 0,this._useSRGBBuffer,ArrayBuffer.isView(this._buffer)?this._buffer:null));case 8:K=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this._originalFormat??this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),K._swapAndDie(this,!1),this.isReady=!0;break;case 13:return;case 9:return K=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(K=>{K&&K._swapAndDie(this,!1),this.isReady=!0}),null,this.format,this._extension),void(K._sphericalPolynomial=this._sphericalPolynomial)}}_swapAndDie(K){var b;let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];null===(b=this._hardwareTexture)||void 0===b||b.setUsage(K._source,this.generateMipMaps,this.is2DArray,this.isCube,this.is3D,this.width,this.height,this.depth),K._hardwareTexture=this._hardwareTexture,e&&(K._isRGBD=this._isRGBD),this._lodTextureHigh&&(K._lodTextureHigh&&K._lodTextureHigh.dispose(),K._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(K._lodTextureMid&&K._lodTextureMid.dispose(),K._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(K._lodTextureLow&&K._lodTextureLow.dispose(),K._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(K._irradianceTexture&&K._irradianceTexture.dispose(),K._irradianceTexture=this._irradianceTexture);const z=this._engine.getLoadedTexturesCache();let k=z.indexOf(this);-1!==k&&z.splice(k,1),k=z.indexOf(K),-1===k&&z.push(K)}dispose(){this._references--,this.onLoadedObservable.clear(),this.onErrorObservable.clear(),0===this._references&&(this._engine._releaseTexture(this),this._hardwareTexture=null,this._dynamicTextureSource=null)}}T._Counter=0},11440:(K,b,e)=>{"use strict";e.d(b,{e:()=>k});var z=e(11161);class k extends z.c{constructor(K,b,e,k,j){let T=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=arguments.length>9?arguments[9]:void 0,X=arguments.length>10?arguments[10]:void 0;super(null,j,!T,F,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,A),this.format=k,this._engine&&(this._engine._caps.textureFloatLinearFiltering||1!==Y||(l=1),this._engine._caps.textureHalfFloatLinearFiltering||2!==Y||(l=1),this._texture=this._engine.createRawTexture(K,b,e,k,T,F,l,null,Y,A??0,X??!1),this.wrapU=z.c.CLAMP_ADDRESSMODE,this.wrapV=z.c.CLAMP_ADDRESSMODE)}update(K){this._getEngine().updateRawTexture(this._texture,K,this._texture.format,this._texture.invertY,null,this._texture.type,this._texture._useSRGBBuffer)}clone(){if(!this._texture)return super.clone();const K=new k(null,this.getSize().width,this.getSize().height,this.format,this.va(),this._texture.generateMipMaps,this._invertY,this.samplingMode,this._texture.type,this._texture._creationFlags,this._useSRGBBuffer);return K._texture=this._texture,this._texture.incrementReferences(),K}static CreateLuminanceTexture(K,b,e,z){return new k(K,b,e,1,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateLuminanceAlphaTexture(K,b,e,z){return new k(K,b,e,2,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateAlphaTexture(K,b,e,z){return new k(K,b,e,0,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3)}static CreateRGBTexture(K,b,e,z){return new k(K,b,e,4,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBATexture(K,b,e,z){return new k(K,b,e,5,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,arguments.length>9&&void 0!==arguments[9]&&arguments[9])}static CreateRGBAStorageTexture(K,b,e,z){return new k(K,b,e,5,z,!(arguments.length>4&&void 0!==arguments[4])||arguments[4],arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&void 0!==arguments[6]?arguments[6]:3,arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,1,arguments.length>8&&void 0!==arguments[8]&&arguments[8])}static CreateRTexture(K,b,e,j){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],F=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z.c.TRILINEAR_SAMPLINGMODE;return new k(K,b,e,6,j,T,F,l,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1)}static CreateRStorageTexture(K,b,e,j){let T=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],F=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:z.c.TRILINEAR_SAMPLINGMODE;return new k(K,b,e,6,j,T,F,l,arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,1)}}},11780:(K,b,e)=>{"use strict";e.d(b,{c:()=>k});var z=e(11161);class k extends z.c{get depth(){return this._depth}constructor(K,b,e,k,j,T){let F=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7],Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:z.c.TRILINEAR_SAMPLINGMODE,A=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,X=arguments.length>10?arguments[10]:void 0;super(null,T,!F,l),this.format=j,this._texture=T.getEngine().createRawTexture2DArray(K,b,e,k,j,F,l,Y,null,A,X),this._depth=k,this.is2DArray=!0}update(K){this._texture&&this._getEngine().updateRawTexture2DArray(this._texture,K,this._texture.format,this._texture.invertY,null,this._texture.type)}static CreateRGBATexture(K,b,e,z,j){return new k(K,b,e,z,5,j,!(arguments.length>5&&void 0!==arguments[5])||arguments[5],arguments.length>6&&void 0!==arguments[6]&&arguments[6],arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,arguments.length>8&&void 0!==arguments[8]?arguments[8]:0)}}},11514:(K,b,e)=>{"use strict";e.d(b,{b:()=>t});var z=e(10690),k=e(10967),j=e(11161),T=e(11037),F=e(11046),l=e(10975),Y=e(10803),A=e(10756),X=e(10696);A.d.prototype.setDepthStencilTexture=function(K,b){this._engine.setDepthStencilTexture(this._samplers[K],this._uniforms[K],b,K)};class t extends j.c{get renderList(){return this._renderList}set renderList(K){this._renderList!==K&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),K&&(this._unObserveRenderList=(0,l.j)(K,this._renderListHasChanged)),this._renderList=K)}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(K){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(K)}set onBeforeRender(K){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(K)}set onAfterRender(K){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(K)}set onClear(K){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(K)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(K,b){let e;e=Array.isArray(K)?K:[K];for(let z=0;z<e.length;++z)for(let K=0;K<this._renderPassIds.length;++K)e[z].setMaterialForRenderPass(this._renderPassIds[K],void 0!==b?Array.isArray(b)?b[K]:b:void 0)}get isMulti(){var K;return(null===(K=this._renderTarget)||void 0===K?void 0:K.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(K){if(this._boundingBoxSize&&this._boundingBoxSize.equals(K))return;this._boundingBoxSize=K;const b=this.va();b&&b.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var K;return(null===(K=this._renderTarget)||void 0===K?void 0:K._depthStencilTexture)??null}constructor(K,b,e){let T,l=arguments.length>3&&void 0!==arguments[3]&&arguments[3],Y=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],A=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,X=arguments.length>6&&void 0!==arguments[6]&&arguments[6],t=arguments.length>7&&void 0!==arguments[7]?arguments[7]:j.c.TRILINEAR_SAMPLINGMODE,U=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],B=arguments.length>9&&void 0!==arguments[9]&&arguments[9],u=arguments.length>10&&void 0!==arguments[10]&&arguments[10],m=arguments.length>11&&void 0!==arguments[11]?arguments[11]:5,D=arguments.length>12&&void 0!==arguments[12]&&arguments[12],I=arguments.length>13?arguments[13]:void 0,x=arguments.length>14?arguments[14]:void 0,Q=arguments.length>15&&void 0!==arguments[15]&&arguments[15],G=arguments.length>16&&void 0!==arguments[16]&&arguments[16],i=!0;if("object"===typeof l){const K=l;l=!!K.generateMipMaps,Y=K.doNotChangeAspectRatio??!0,A=K.type??0,X=!!K.isCube,t=K.samplingMode??j.c.TRILINEAR_SAMPLINGMODE,U=K.generateDepthBuffer??!0,B=!!K.generateStencilBuffer,u=!!K.isMulti,m=K.format??5,D=!!K.delayAllocation,I=K.samples,x=K.creationFlags,Q=!!K.noColorAttachment,G=!!K.useSRGBBuffer,T=K.colorAttachment,i=K.gammaSpace??i}if(super(null,e,!l,void 0,t,void 0,void 0,void 0,void 0,m),this._unObserveRenderList=null,this._renderListHasChanged=(K,b)=>{const e=this._renderList?this._renderList.length:0;var z;(0===b&&e>0||0===e)&&(null===(z=this.va())||void 0===z||z.meshes.forEach((K=>{K._markSubMeshesAsLightDirty()})))},this.particleSystemList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new z.d,this.onAfterUnbindObservable=new z.d,this.onBeforeRenderObservable=new z.d,this.onAfterRenderObservable=new z.d,this.onClearObservable=new z.d,this.onResizeObservable=new z.d,this._cleared=!1,this.skipInitialClear=!1,this._currentRefreshId=-1,this._refreshRate=1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=k.k.Zero(),this._dumpToolsLoading=!1,!(e=this.va()))return;const S=this.va().getEngine();this._gammaSpace=i,this._coordinatesMode=j.c.PROJECTION_MODE,this.renderList=[],this.name=K,this.isRenderTarget=!0,this._initialSizeParameter=b,this._renderPassIds=[],this._isCubeData=X,this._processSizeParameter(b),this.renderPassId=this._renderPassIds[0],this._resizeObserver=S.onResizeObservable.add((()=>{})),this._generateMipMaps=!!l,this._doNotChangeAspectRatio=Y,this._renderingManager=new F.c(e),this._renderingManager._useSceneAutoClearSetup=!0,u||(this._renderTargetOptions={generateMipMaps:l,type:A,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:U,generateStencilBuffer:B,samples:I,creationFlags:x,noColorAttachment:Q,useSRGBBuffer:G,colorAttachment:T,label:this.name},this.samplingMode===j.c.NEAREST_SAMPLINGMODE&&(this.wrapU=j.c.CLAMP_ADDRESSMODE,this.wrapV=j.c.CLAMP_ADDRESSMODE),D||(X?(this._renderTarget=e.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=j.c.INVCUBIC_MODE,this._textureMatrix=k.b.Identity()):this._renderTarget=e.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==I&&(this.samples=I)))}createDepthStencilTexture(){var K;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],z=arguments.length>2&&void 0!==arguments[2]&&arguments[2],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:14,T=arguments.length>5?arguments[5]:void 0;null===(K=this._renderTarget)||void 0===K||K.createDepthStencilTexture(b,e,z,k,j,T)}_releaseRenderPassId(){if(this._scene){const K=this._scene.getEngine();for(let b=0;b<this._renderPassIds.length;++b)K.releaseRenderPassId(this._renderPassIds[b])}this._renderPassIds=[]}_createRenderPassId(){this._releaseRenderPassId();const K=this._scene.getEngine(),b=this._isCubeData?6:this.getRenderLayers()||1;for(let e=0;e<b;++e)this._renderPassIds[e]=K.createRenderPassId(`RenderTargetTexture - ${this.name}#${e}`)}_processSizeParameter(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(K.ratio){this._sizeRatio=K.ratio;const b=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(b.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(b.getRenderHeight(),this._sizeRatio)}}else this._size=K;b&&this._createRenderPassId()}get samples(){var K;return(null===(K=this._renderTarget)||void 0===K?void 0:K.samples)??this._samples}set samples(K){this._renderTarget&&(this._samples=this._renderTarget.setSamples(K))}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(K){this._refreshRate=K,this.resetRefreshCounter()}addPostProcess(K){if(!this._postProcessManager){const K=this.va();if(!K)return;this._postProcessManager=new T.b(K),this._postProcesses=new Array}this._postProcesses.push(K),this._postProcesses[0].Ci=!1}clearPostProcesses(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._postProcesses){if(K)for(const K of this._postProcesses)K.dispose();this._postProcesses=[]}}removePostProcess(K){if(!this._postProcesses)return;const b=this._postProcesses.indexOf(K);-1!==b&&(this._postProcesses.splice(b,1),this._postProcesses.length>0&&(this._postProcesses[0].Ci=!1))}_shouldRender(){return-1===this._currentRefreshId||this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const K=this._size.layers;if(K)return K;const b=this._size.depth;return b||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(K){const b=Math.max(1,this.getRenderSize()*K);this.resize(b)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(K){var b;const e=this.isCube;null===(b=this._renderTarget)||void 0===b||b.dispose(),this._renderTarget=null;const z=this.va();z&&(this._processSizeParameter(K,!1),this._renderTarget=e?z.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):z.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,void 0!==this._renderTargetOptions.samples&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._render(K,b)}isReadyForRendering(){return this._dumpToolsLoading||(this._dumpToolsLoading=!0,Promise.resolve().then(e.bind(e,11966)).then((K=>this._dumpTools=K))),this._render(!1,!1,!0)}_render(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=this.va();if(!z)return e;const k=z.getEngine();if(void 0!==this.useCameraPostProcesses&&(K=this.useCameraPostProcesses),this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let K=0;K<this._waitingRenderList.length;K++){const b=this._waitingRenderList[K],e=z.getMeshById(b);e&&this.renderList.push(e)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const K=this.va();if(!K)return e;const b=K.meshes;for(let e=0;e<b.length;e++){const K=b[e];this.renderListPredicate(K)&&this.renderList.push(K)}}const j=k.currentRenderPassId;this.onBeforeBindObservable.notifyObservers(this);const T=this.activeCamera??z.activeCamera,F=z.activeCamera;T&&(T!==z.activeCamera&&(z.setTransformMatrix(T.getViewMatrix(),T.getProjectionMatrix(!0)),z.activeCamera=T),k.setViewport(T.rigParent?T.rigParent.viewport:T.viewport,this.getRenderWidth(),this.getRenderHeight())),this._defaultRenderListPrepared=!1;let l=e;if(e){z.getViewMatrix()||z.updateTransformMatrix();const K=this.is2DArray||this.is3D?this.getRenderLayers():this.isCube?6:1;for(let j=0;j<K&&l;j++){let K=null;const b=this.renderList?this.renderList:z.getActiveMeshes().data,T=this.renderList?this.renderList.length:z.getActiveMeshes().length;k.currentRenderPassId=this._renderPassIds[j],this.onBeforeRenderObservable.notifyObservers(j),this.getCustomRenderList&&(K=this.getCustomRenderList(j,b,T)),K||(K=b),this._doNotChangeAspectRatio||z.updateTransformMatrix(!0);for(let z=0;z<K.length&&l;++z){const b=K[z];if(b.isEnabled()&&!b.isBlocked&&b.isVisible&&b.Rf)if(this.customIsReadyFunction){if(!this.customIsReadyFunction(b,this.refreshRate,e)){l=!1;continue}}else if(!b.isReady(!0)){l=!1;continue}}this.onAfterRenderObservable.notifyObservers(j),(this.is2DArray||this.is3D||this.isCube)&&(z.incrementRenderId(),z.resetCachedMaterial())}const b=this.particleSystemList||z._i;for(const e of b)e.isReady()||(l=!1)}else if(!this.is2DArray&&!this.is3D||this.isMulti)if(this.isCube&&!this.isMulti)for(let Y=0;Y<6;Y++)this._renderToTarget(Y,K,b,void 0,T),z.incrementRenderId(),z.resetCachedMaterial();else this._renderToTarget(0,K,b,void 0,T);else for(let Y=0;Y<this.getRenderLayers();Y++)this._renderToTarget(0,K,b,Y,T),z.incrementRenderId(),z.resetCachedMaterial();return this.onAfterUnbindObservable.notifyObservers(this),k.currentRenderPassId=j,z.activeCamera=F,F&&(this.activeCamera&&this.activeCamera!==z.activeCamera&&z.setTransformMatrix(F.getViewMatrix(),F.getProjectionMatrix(!0)),k.setViewport(F.viewport)),z.resetCachedMaterial(),l}_bestReflectionRenderTargetDimension(K,b){const e=K*b,z=(0,Y.m)(e+16384/(128+e));return Math.min((0,Y.c)(K),z)}_prepareRenderingManager(K,b,e,z){const k=this.va();if(!k)return;this._renderingManager.reset();const j=k.getRenderId();for(let F=0;F<b;F++){const b=K[F];if(b&&!b.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(b,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!b.isReady(0===this.refreshRate)){this.resetRefreshCounter();continue}if(!b._internalAbstractMeshDataInfo._currentLODIsUpToDate&&e&&(b._internalAbstractMeshDataInfo._currentLOD=k.customLODSelector?k.customLODSelector(b,e):b.getLOD(e),b._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!b._internalAbstractMeshDataInfo._currentLOD)continue;let K,T=b._internalAbstractMeshDataInfo._currentLOD;if(T!==b&&0!==T.billboardMode&&T.xj(),T._preActivateForIntermediateRendering(j),K=!(!z||!e)&&0===(b.layerMask&e.layerMask),b.isEnabled()&&b.isVisible&&b.Rf&&!K){if(T!==b&&T._activate(j,!0),b._activate(j,!0)&&b.Rf.length){b.isAnInstance?b._internalAbstractMeshDataInfo._actAsRegularMesh&&(T=b):T._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,T._internalAbstractMeshDataInfo._isActiveIntermediate=!0,k._prepareSkeleton(T);for(let K=0;K<T.Rf.length;K++){const b=T.Rf[K];this._renderingManager.dispatch(b,T)}}b._postActivate()}}}const T=this.particleSystemList||k._i;for(let F=0;F<T.length;F++){const K=T[F],b=K.j;K.isStarted()&&b&&(!b.position||b.isEnabled())&&this._renderingManager.dispatchParticles(K)}}_bindFrameBuffer(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.va();if(!e)return;const z=e.getEngine();this._renderTarget&&z.bindFramebuffer(this._renderTarget,this.isCube?K:void 0,void 0,void 0,this.ignoreCameraViewport,0,b)}_unbindFrameBuffer(K,b){this._renderTarget&&K.unBindFramebuffer(this._renderTarget,this.isCube,(()=>{this.onAfterRenderObservable.notifyObservers(b)}))}_prepareFrame(K,b,e,z){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):z&&K.postProcessManager._prepareFrame(this._texture)||this._bindFrameBuffer(b,e)}_renderToTarget(K,b,e){var z,k;let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const F=this.va();if(!F)return;const l=F.getEngine();this._prepareFrame(F,K,j,b),null===(z=l._debugPushGroup)||void 0===z||z.call(l,`render to face #${K} layer #${j}`,2),this.is2DArray||this.is3D?(l.currentRenderPassId=this._renderPassIds[j],this.onBeforeRenderObservable.notifyObservers(j)):(l.currentRenderPassId=this._renderPassIds[K],this.onBeforeRenderObservable.notifyObservers(K));if(l.snapshotRendering&&1===l.snapshotRenderingMode)this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(l):this.skipInitialClear||l.clear(this.clearColor||F.clearColor,!0,!0,!0);else{var Y;let z=null;const k=this.renderList?this.renderList:F.getActiveMeshes().data,A=this.renderList?this.renderList.length:F.getActiveMeshes().length;this.getCustomRenderList&&(z=this.getCustomRenderList(this.is2DArray||this.is3D?j:K,k,A)),z?this._prepareRenderingManager(z,z.length,T,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(k,A,T,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),z=k);for(const b of F._beforeRenderTargetClearStage)b.action(this,K,j);this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(l):this.skipInitialClear||l.clear(this.clearColor||F.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||F.updateTransformMatrix(!0);for(const b of F._beforeRenderTargetDrawStage)b.action(this,K,j);this._renderingManager.render(this.customRenderFunction,z,this.renderParticles,this.renderSprites);for(const b of F._afterRenderTargetDrawStage)b.action(this,K,j);const t=(null===(Y=this._texture)||void 0===Y?void 0:Y.generateMipMaps)??!1;this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,K,this._postProcesses,this.ignoreCameraViewport):b&&F.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,K);for(const b of F._afterRenderTargetPostProcessStage)b.action(this,K,j);this._texture&&(this._texture.generateMipMaps=t),this._doNotChangeAspectRatio||F.updateTransformMatrix(!0),e&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),l):X.b.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}null===(k=l._debugPopGroup)||void 0===k||k.call(l,2),this._unbindFrameBuffer(l,K),this._texture&&this.isCube&&5===K&&l.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(K,b,e,z)}setRenderingAutoClearDepthStencil(K,b){this._renderingManager.setRenderingAutoClearDepthStencil(K,b),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const K=this.getSize(),b=new t(this.name,K,this.va(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return b.ke=this.ke,b.level=this.level,b.coordinatesMode=this.coordinatesMode,this.renderList&&(b.renderList=this.renderList.slice(0)),b}serialize(){if(!this.name)return null;const K=super.serialize();if(K.renderTargetSize=this.getRenderSize(),K.renderList=[],this.renderList)for(let b=0;b<this.renderList.length;b++)K.renderList.push(this.renderList[b].id);return K}disposeFramebufferObjects(){var K;null===(K=this._renderTarget)||void 0===K||K.dispose(!0)}releaseInternalTexture(){var K;null===(K=this._renderTarget)||void 0===K||K.releaseTextures(),this._texture=null}dispose(){var K;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterRenderObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this.onBeforeRenderObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._releaseRenderPassId(),this.clearPostProcesses(!0),this._resizeObserver&&(this.va().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null),this.renderList=null;const b=this.va();if(!b)return;let e=b.customRenderTargets.indexOf(this);e>=0&&b.customRenderTargets.splice(e,1);for(const z of b.cameras)e=z.customRenderTargets.indexOf(this),e>=0&&z.customRenderTargets.splice(e,1);null===(K=this._renderTarget)||void 0===K||K.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this.refreshRate===t.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=t.REFRESHRATE_RENDER_ONCE),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}getViewCount(){return 1}}t.REFRESHRATE_RENDER_ONCE=0,t.REFRESHRATE_RENDER_ONEVERYFRAME=1,t.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2,j.c._CreateRenderTargetTexture=(K,b,e,z,k)=>new t(K,b,e,z)},11161:(K,b,e)=>{"use strict";e.d(b,{c:()=>x});var z=e(10936),k=e(10938),j=e(10690),T=e(10967),F=e(11170),l=e(10799),Y=e(10710),A=e(10745),X=e(10792),t=e(11068),U=e(10733);function B(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=b.width,k=b.height;if(K instanceof Float32Array){let b=K.byteLength/K.BYTES_PER_ELEMENT;const e=new Uint8Array(b);for(;--b>=0;){let z=K[b];z<0?z=0:z>1&&(z=1),e[b]=255*z}K=e}const j=document.createElement("canvas");j.width=z,j.height=k;const T=j.getContext("2d");if(!T)return null;const F=T.createImageData(z,k);if(F.data.set(K),T.putImageData(F,0,0),e){const K=document.createElement("canvas");K.width=z,K.height=k;const b=K.getContext("2d");return b?(b.translate(0,k),b.scale(1,-1),b.drawImage(j,0,0),K.toDataURL("image/png")):null}return j.toDataURL("image/png")}function u(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=K.getInternalTexture();if(!z)return null;const k=K._readPixelsSync(b,e);return k?B(k,K.getSize(),z.invertY):null}async function m(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const z=K.getInternalTexture();if(!z)return null;const k=await K.readPixels(b,e);return k?B(k,K.getSize(),z.invertY):null}var D=e(11186),I=e(11001);class x extends F.d{static _CreateVideoTexture(K,b,e){arguments.length>5&&void 0!==arguments[5]||x.TRILINEAR_SAMPLINGMODE;throw(0,Y.c)("VideoTexture")}get noMipmap(){return this._noMipmap}get mimeType(){return this._mimeType}set isBlocking(K){this._isBlocking=K}get isBlocking(){return this._isBlocking}get invertY(){return this._invertY}constructor(K,b,e,z){let k,T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:x.TRILINEAR_SAMPLINGMODE,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,Y=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]&&arguments[8],t=arguments.length>9?arguments[9]:void 0,U=arguments.length>10?arguments[10]:void 0,B=arguments.length>11?arguments[11]:void 0,u=arguments.length>12?arguments[12]:void 0,m=arguments.length>13?arguments[13]:void 0;super(b),this.url=null,this.uOffset=0,this.vOffset=0,this.uScale=1,this.vScale=1,this.uAng=0,this.vAng=0,this.wAng=0,this.uRotationCenter=.5,this.vRotationCenter=.5,this.wRotationCenter=.5,this.homogeneousRotationInUVTransform=!1,this.inspectableCustomProperties=null,this._noMipmap=!1,this._invertY=!1,this._rowGenerationMatrix=null,this._cachedTextureMatrix=null,this._projectionModeMatrix=null,this._t0=null,this._t1=null,this._t2=null,this._cachedUOffset=-1,this._cachedVOffset=-1,this._cachedUScale=0,this._cachedVScale=0,this._cachedUAng=-1,this._cachedVAng=-1,this._cachedWAng=-1,this._cachedReflectionProjectionMatrixId=-1,this._cachedURotationCenter=-1,this._cachedVRotationCenter=-1,this._cachedWRotationCenter=-1,this._cachedHomogeneousRotationInUVTransform=!1,this._cachedIdentity3x2=!0,this._cachedReflectionTextureMatrix=null,this._cachedReflectionUOffset=-1,this._cachedReflectionVOffset=-1,this._cachedReflectionUScale=0,this._cachedReflectionVScale=0,this._cachedReflectionCoordinatesMode=-1,this._buffer=null,this._deleteBuffer=!1,this._format=null,this._delayedOnLoad=null,this._delayedOnError=null,this.onLoadObservable=new j.d,this._isBlocking=!0,this.name=K||"",this.url=K;let I=!1,Q=null,G=!0;"object"===typeof e&&null!==e?(k=e.noMipmap??!1,z=e.invertY??!D.c,T=e.samplingMode??x.TRILINEAR_SAMPLINGMODE,F=e.X??null,l=e.onError??null,Y=e.buffer??null,X=e.deleteBuffer??!1,t=e.format,U=e.mimeType,B=e.loaderOptions,u=e.creationFlags,I=e.useSRGBBuffer??!1,Q=e.internalTexture??null,G=e.gammaSpace??G):k=!!e,this._gammaSpace=G,this._noMipmap=k,this._invertY=void 0===z?!D.c:z,this._initialSamplingMode=T,this._buffer=Y,this._deleteBuffer=X,this._mimeType=U,this._loaderOptions=B,this._creationFlags=u,this._useSRGBBuffer=I,this._forcedExtension=m,t&&(this._format=t);const i=this.va(),S=this._getEngine();if(!S)return;S.onBeforeTextureInitObservable.notifyObservers(this);const M=()=>{this._texture&&(this._texture._invertVScale&&(this.vScale*=-1,this.vOffset+=1),null!==this._texture._cachedWrapU&&(this.wrapU=this._texture._cachedWrapU,this._texture._cachedWrapU=null),null!==this._texture._cachedWrapV&&(this.wrapV=this._texture._cachedWrapV,this._texture._cachedWrapV=null),null!==this._texture._cachedWrapR&&(this.wrapR=this._texture._cachedWrapR,this._texture._cachedWrapR=null)),this.onLoadObservable.hasObservers()&&this.onLoadObservable.notifyObservers(this),F&&F(),!this.isBlocking&&i&&i.resetCachedMaterial()},r=(K,b)=>{this._loadingError=!0,this._errorObject={message:K,exception:b},l&&l(K,b),x.OnTextureLoadErrorObservable.notifyObservers(this)};if(!this.url&&!Q)return this._delayedOnLoad=M,void(this._delayedOnError=r);if(this._texture=Q??this._getFromCache(this.url,k,T,this._invertY,I,this.isCube),this._texture)if(this._texture.isReady)A.e.SetImmediate((()=>M()));else{const K=this._texture.onLoadedObservable.add(M);this._texture.onErrorObservable.add((b=>{var e;r(b.message,b.exception),null===(e=this._texture)||void 0===e||e.onLoadedObservable.remove(K)}))}else if(i&&i.useDelayedTextureLoading)this.delayLoadState=4,this._delayedOnLoad=M,this._delayedOnError=r;else{try{this._texture=S.createTexture(this.url,k,this._invertY,i,T,M,r,this._buffer,void 0,this._format,this._forcedExtension,U,B,u,I)}catch(L){throw r("error loading",L),L}X&&(this._buffer=null)}}updateURL(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;this.url&&(this.releaseInternalTexture(),this.va().markAllMaterialsAsDirty(1,(K=>K.hasTexture(this)))),this.name&&!this.name.startsWith("data:")||(this.name=K),this.url=K,this._buffer=b,this._forcedExtension=z,this.delayLoadState=4,e&&(this._delayedOnLoad=e),this.delayLoad()}delayLoad(){if(4!==this.delayLoadState)return;const K=this.va();K&&(this.delayLoadState=1,this._texture=this._getFromCache(this.url,this._noMipmap,this.samplingMode,this._invertY,this._useSRGBBuffer,this.isCube),this._texture?this._delayedOnLoad&&(this._texture.isReady?A.e.SetImmediate(this._delayedOnLoad):this._texture.onLoadedObservable.add(this._delayedOnLoad)):(this._texture=K.getEngine().createTexture(this.url,this._noMipmap,this._invertY,K,this.samplingMode,this._delayedOnLoad,this._delayedOnError,this._buffer,null,this._format,this._forcedExtension,this._mimeType,this._loaderOptions,this._creationFlags,this._useSRGBBuffer),this._deleteBuffer&&(this._buffer=null)),this._delayedOnLoad=null,this._delayedOnError=null)}_prepareRowForTextureGeneration(K,b,e,z){K*=this._cachedUScale,b*=this._cachedVScale,K-=this.uRotationCenter*this._cachedUScale,b-=this.vRotationCenter*this._cachedVScale,e-=this.wRotationCenter,T.k.TransformCoordinatesFromFloatsToRef(K,b,e,this._rowGenerationMatrix,z),z.x+=this.uRotationCenter*this._cachedUScale+this._cachedUOffset,z.y+=this.vRotationCenter*this._cachedVScale+this._cachedVOffset,z.z+=this.wRotationCenter}getTextureMatrix(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;if(this.uOffset===this._cachedUOffset&&this.vOffset===this._cachedVOffset&&this.uScale*K===this._cachedUScale&&this.vScale===this._cachedVScale&&this.uAng===this._cachedUAng&&this.vAng===this._cachedVAng&&this.wAng===this._cachedWAng&&this.uRotationCenter===this._cachedURotationCenter&&this.vRotationCenter===this._cachedVRotationCenter&&this.wRotationCenter===this._cachedWRotationCenter&&this.homogeneousRotationInUVTransform===this._cachedHomogeneousRotationInUVTransform)return this._cachedTextureMatrix;this._cachedUOffset=this.uOffset,this._cachedVOffset=this.vOffset,this._cachedUScale=this.uScale*K,this._cachedVScale=this.vScale,this._cachedUAng=this.uAng,this._cachedVAng=this.vAng,this._cachedWAng=this.wAng,this._cachedURotationCenter=this.uRotationCenter,this._cachedVRotationCenter=this.vRotationCenter,this._cachedWRotationCenter=this.wRotationCenter,this._cachedHomogeneousRotationInUVTransform=this.homogeneousRotationInUVTransform,this._cachedTextureMatrix&&this._rowGenerationMatrix||(this._cachedTextureMatrix=T.b.Zero(),this._rowGenerationMatrix=new T.b,this._t0=T.k.Zero(),this._t1=T.k.Zero(),this._t2=T.k.Zero()),T.b.RotationYawPitchRollToRef(this.vAng,this.uAng,this.wAng,this._rowGenerationMatrix),this.homogeneousRotationInUVTransform?(T.b.TranslationToRef(-this._cachedURotationCenter,-this._cachedVRotationCenter,-this._cachedWRotationCenter,T.e.Matrix[0]),T.b.TranslationToRef(this._cachedURotationCenter,this._cachedVRotationCenter,this._cachedWRotationCenter,T.e.Matrix[1]),T.b.ScalingToRef(this._cachedUScale,this._cachedVScale,0,T.e.Matrix[2]),T.b.TranslationToRef(this._cachedUOffset,this._cachedVOffset,0,T.e.Matrix[3]),T.e.Matrix[0].multiplyToRef(this._rowGenerationMatrix,this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(T.e.Matrix[1],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(T.e.Matrix[2],this._cachedTextureMatrix),this._cachedTextureMatrix.multiplyToRef(T.e.Matrix[3],this._cachedTextureMatrix),this._cachedTextureMatrix.setRowFromFloats(2,this._cachedTextureMatrix.m[12],this._cachedTextureMatrix.m[13],this._cachedTextureMatrix.m[14],1)):(this._prepareRowForTextureGeneration(0,0,0,this._t0),this._prepareRowForTextureGeneration(1,0,0,this._t1),this._prepareRowForTextureGeneration(0,1,0,this._t2),this._t1.$h(this._t0),this._t2.$h(this._t0),T.b.FromValuesToRef(this._t1.x,this._t1.y,this._t1.z,0,this._t2.x,this._t2.y,this._t2.z,0,this._t0.x,this._t0.y,this._t0.z,0,0,0,0,1,this._cachedTextureMatrix));const b=this.va();if(!b)return this._cachedTextureMatrix;const e=this._cachedIdentity3x2;return this._cachedIdentity3x2=this._cachedTextureMatrix.isIdentityAs3x2(),this.optimizeUVAllocation&&e!==this._cachedIdentity3x2&&b.markAllMaterialsAsDirty(1,(K=>K.hasTexture(this))),this._cachedTextureMatrix}getReflectionTextureMatrix(){const K=this.va();if(!K)return this._cachedReflectionTextureMatrix;if(this.uOffset===this._cachedReflectionUOffset&&this.vOffset===this._cachedReflectionVOffset&&this.uScale===this._cachedReflectionUScale&&this.vScale===this._cachedReflectionVScale&&this.coordinatesMode===this._cachedReflectionCoordinatesMode){if(this.coordinatesMode!==x.PROJECTION_MODE)return this._cachedReflectionTextureMatrix;if(this._cachedReflectionProjectionMatrixId===K.getProjectionMatrix().updateFlag)return this._cachedReflectionTextureMatrix}this._cachedReflectionTextureMatrix||(this._cachedReflectionTextureMatrix=T.b.Zero()),this._projectionModeMatrix||(this._projectionModeMatrix=T.b.Zero());const b=this._cachedReflectionCoordinatesMode!==this.coordinatesMode;switch(this._cachedReflectionUOffset=this.uOffset,this._cachedReflectionVOffset=this.vOffset,this._cachedReflectionUScale=this.uScale,this._cachedReflectionVScale=this.vScale,this._cachedReflectionCoordinatesMode=this.coordinatesMode,this.coordinatesMode){case x.PLANAR_MODE:T.b.IdentityToRef(this._cachedReflectionTextureMatrix),this._cachedReflectionTextureMatrix[0]=this.uScale,this._cachedReflectionTextureMatrix[5]=this.vScale,this._cachedReflectionTextureMatrix[12]=this.uOffset,this._cachedReflectionTextureMatrix[13]=this.vOffset;break;case x.PROJECTION_MODE:{T.b.FromValuesToRef(.5,0,0,0,0,-.5,0,0,0,0,0,0,.5,.5,1,1,this._projectionModeMatrix);const b=K.getProjectionMatrix();this._cachedReflectionProjectionMatrixId=b.updateFlag,b.multiplyToRef(this._projectionModeMatrix,this._cachedReflectionTextureMatrix);break}default:T.b.IdentityToRef(this._cachedReflectionTextureMatrix)}return b&&K.markAllMaterialsAsDirty(1,(K=>K.hasTexture(this))),this._cachedReflectionTextureMatrix}clone(){const K={noMipmap:this._noMipmap,invertY:this._invertY,samplingMode:this.samplingMode,X:void 0,onError:void 0,buffer:this._texture?this._texture._buffer:void 0,deleteBuffer:this._deleteBuffer,format:this.textureFormat,mimeType:this.mimeType,loaderOptions:this._loaderOptions,creationFlags:this._creationFlags,useSRGBBuffer:this._useSRGBBuffer};return I.e.Clone((()=>new x(this._texture?this._texture.url:null,this.va(),K)),this)}serialize(){var K;const b=this.name;x.SerializeBuffers||this.name.startsWith("data:")&&(this.name=""),this.name.startsWith("data:")&&this.url===this.name&&(this.url="");const e=super.serialize(x._SerializeInternalTextureUniqueId);if(!e)return null;var z;((x.SerializeBuffers||x.ForceSerializeBuffers)&&("string"===typeof this._buffer&&"data:"===this._buffer.substring(0,5)?(e.base64String=this._buffer,e.name=e.name.replace("data:","")):this.url&&this.url.startsWith("data:")&&this._buffer instanceof Uint8Array?e.base64String="data:image/png;base64,"+(0,U.i)(this._buffer):(x.ForceSerializeBuffers||this.url&&this.url.startsWith("blob:")||this._forceSerialize)&&(e.base64String=!this._engine||this._engine._features.supportSyncTextureRead?u(this):m(this))),e.invertY=this._invertY,e.samplingMode=this.samplingMode,e._creationFlags=this._creationFlags,e._useSRGBBuffer=this._useSRGBBuffer,x._SerializeInternalTextureUniqueId)&&(e.internalTextureUniqueId=null===(z=this._texture)||void 0===z?void 0:z.uniqueId);return e.internalTextureLabel=null===(K=this._texture)||void 0===K?void 0:K.label,e.noMipmap=this._noMipmap,this.name=b,e}getClassName(){return"Texture"}dispose(){super.dispose(),this.onLoadObservable.clear(),this._delayedOnLoad=null,this._delayedOnError=null,this._buffer=null}static Parse(K,b,e){if(K.customType){const z=X.b.Instantiate(K.customType).Parse(K,b,e);return K.samplingMode&&z.updateSamplingMode&&z._samplingMode&&z._samplingMode!==K.samplingMode&&z.updateSamplingMode(K.samplingMode),z}if(K.isCube&&!K.isRenderTarget)return x._CubeTextureParser(K,b,e);const z=void 0!==K.internalTextureUniqueId;if(!K.name&&!K.isRenderTarget&&!z)return null;let k;if(z){const e=b.getEngine().getLoadedTexturesCache();for(const b of e)if(b.uniqueId===K.internalTextureUniqueId){k=b;break}}const j=b=>{if(b&&b._texture&&(b._texture._cachedWrapU=null,b._texture._cachedWrapV=null,b._texture._cachedWrapR=null),K.samplingMode){const e=K.samplingMode;b&&b.samplingMode!==e&&b.updateSamplingMode(e)}if(b&&K.animations)for(let e=0;e<K.animations.length;e++){const z=K.animations[e],k=(0,l.d)("BABYLON.Animation");k&&b.animations.push(k.Parse(z))}b&&b._texture&&(z&&!k&&b._texture._setUniqueId(K.internalTextureUniqueId),b._texture.label=K.internalTextureLabel)};return I.e.Parse((()=>{let z=!0;if(K.noMipmap&&(z=!1),K.mirrorPlane){const e=x._CreateMirror(K.name,K.renderTargetSize,b,z);return e._waitingRenderList=K.renderList,e.mirrorPlane=t.b.Bg(K.mirrorPlane),j(e),e}if(K.isRenderTarget){let e=null;if(K.isCube){if(b.reflectionProbes)for(let z=0;z<b.reflectionProbes.length;z++){const e=b.reflectionProbes[z];if(e.name===K.name)return e.cubeTexture}}else e=x._CreateRenderTargetTexture(K.name,K.renderTargetSize,b,z,K._creationFlags??0),e._waitingRenderList=K.renderList;return j(e),e}if(K.isVideo){const k=x._CreateVideoTexture(e+(K.url||K.name),e+(K.src||K.url),b,z,K.invertY,K.samplingMode,K.settings||{});return j(k),k}{let T;if(K.base64String&&!k)T=x.CreateFromBase64String(K.base64String,K.base64String,b,!z,K.invertY,K.samplingMode,(()=>{j(T)}),K._creationFlags??0,K._useSRGBBuffer??!1),T.name=K.name;else{let F;F=K.name&&(K.name.indexOf("://")>0||K.name.startsWith("data:"))?K.name:e+K.name,K.url&&(K.url.startsWith("data:")||x.UseSerializedUrlIfAny)&&(F=K.url);const l={noMipmap:!z,invertY:K.invertY,samplingMode:K.samplingMode,X:()=>{j(T)},internalTexture:k};T=new x(F,b,l)}return T}}),K,b)}static CreateFromBase64String(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:x.TRILINEAR_SAMPLINGMODE;return new x("data:"+b,e,z,k,j,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,K,!1,arguments.length>8&&void 0!==arguments[8]?arguments[8]:5,void 0,void 0,arguments.length>9?arguments[9]:void 0,arguments.length>10?arguments[10]:void 0)}static LoadFromDataString(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:x.TRILINEAR_SAMPLINGMODE,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,Y=arguments.length>9&&void 0!==arguments[9]?arguments[9]:5,A=arguments.length>10?arguments[10]:void 0,X=arguments.length>11?arguments[11]:void 0;return"data:"!==K.substring(0,5)&&(K="data:"+K),new x(K,e,k,j,T,F,l,b,z,Y,void 0,void 0,A,X)}}x.SerializeBuffers=!0,x.ForceSerializeBuffers=!1,x.OnTextureLoadErrorObservable=new j.d,x._SerializeInternalTextureUniqueId=!1,x._CubeTextureParser=(K,b,e)=>{throw(0,Y.c)("CubeTexture")},x._CreateMirror=(K,b,e,z)=>{throw(0,Y.c)("MirrorTexture")},x._CreateRenderTargetTexture=(K,b,e,z,k)=>{throw(0,Y.c)("RenderTargetTexture")},x.NEAREST_SAMPLINGMODE=1,x.NEAREST_NEAREST_MIPLINEAR=8,x.BILINEAR_SAMPLINGMODE=2,x.LINEAR_LINEAR_MIPNEAREST=11,x.TRILINEAR_SAMPLINGMODE=3,x.LINEAR_LINEAR_MIPLINEAR=3,x.NEAREST_NEAREST_MIPNEAREST=4,x.NEAREST_LINEAR_MIPNEAREST=5,x.NEAREST_LINEAR_MIPLINEAR=6,x.NEAREST_LINEAR=7,x.NEAREST_NEAREST=1,x.LINEAR_NEAREST_MIPNEAREST=9,x.LINEAR_NEAREST_MIPLINEAR=10,x.LINEAR_LINEAR=2,x.LINEAR_NEAREST=12,x.EXPLICIT_MODE=0,x.SPHERICAL_MODE=1,x.PLANAR_MODE=2,x.CUBIC_MODE=3,x.PROJECTION_MODE=4,x.SKYBOX_MODE=5,x.INVCUBIC_MODE=6,x.EQUIRECTANGULAR_MODE=7,x.FIXED_EQUIRECTANGULAR_MODE=8,x.FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,x.CLAMP_ADDRESSMODE=0,x.WRAP_ADDRESSMODE=1,x.MIRROR_ADDRESSMODE=2,x.UseSerializedUrlIfAny=!1,(0,z.b)([(0,k.M)()],x.prototype,"url",void 0),(0,z.b)([(0,k.M)()],x.prototype,"uOffset",void 0),(0,z.b)([(0,k.M)()],x.prototype,"vOffset",void 0),(0,z.b)([(0,k.M)()],x.prototype,"uScale",void 0),(0,z.b)([(0,k.M)()],x.prototype,"vScale",void 0),(0,z.b)([(0,k.M)()],x.prototype,"uAng",void 0),(0,z.b)([(0,k.M)()],x.prototype,"vAng",void 0),(0,z.b)([(0,k.M)()],x.prototype,"wAng",void 0),(0,z.b)([(0,k.M)()],x.prototype,"uRotationCenter",void 0),(0,z.b)([(0,k.M)()],x.prototype,"vRotationCenter",void 0),(0,z.b)([(0,k.M)()],x.prototype,"wRotationCenter",void 0),(0,z.b)([(0,k.M)()],x.prototype,"homogeneousRotationInUVTransform",void 0),(0,z.b)([(0,k.M)()],x.prototype,"isBlocking",null),(0,l.e)("BABYLON.Texture",x),I.e._TextureParser=x.Parse},10785:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{get wrapU(){return this._cachedWrapU}set wrapU(K){this._cachedWrapU=K}get wrapV(){return this._cachedWrapV}set wrapV(K){this._cachedWrapV=K}get wrapR(){return this._cachedWrapR}set wrapR(K){this._cachedWrapR=K}get anisotropicFilteringLevel(){return this._cachedAnisotropicFilteringLevel}set anisotropicFilteringLevel(K){this._cachedAnisotropicFilteringLevel=K}get comparisonFunction(){return this._comparisonFunction}set comparisonFunction(K){this._comparisonFunction=K}get useMipMaps(){return this._useMipMaps}set useMipMaps(K){this._useMipMaps=K}constructor(){this.samplingMode=-1,this._useMipMaps=!0,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._comparisonFunction=0}setParameters(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return this._cachedWrapU=K,this._cachedWrapV=b,this._cachedWrapR=e,this._cachedAnisotropicFilteringLevel=z,this.samplingMode=k,this._comparisonFunction=j,this}compareSampler(K){return this._cachedWrapU===K._cachedWrapU&&this._cachedWrapV===K._cachedWrapV&&this._cachedWrapR===K._cachedWrapR&&this._cachedAnisotropicFilteringLevel===K._cachedAnisotropicFilteringLevel&&this.samplingMode===K.samplingMode&&this._comparisonFunction===K._comparisonFunction&&this._useMipMaps===K._useMipMaps}}},11138:(K,b,e)=>{"use strict";function z(K){-1===K.indexOf("vClipPlane")&&K.push("vClipPlane"),-1===K.indexOf("vClipPlane2")&&K.push("vClipPlane2"),-1===K.indexOf("vClipPlane3")&&K.push("vClipPlane3"),-1===K.indexOf("vClipPlane4")&&K.push("vClipPlane4"),-1===K.indexOf("vClipPlane5")&&K.push("vClipPlane5"),-1===K.indexOf("vClipPlane6")&&K.push("vClipPlane6")}function k(K,b,e){const z=!!(K.clipPlane??b.clipPlane),k=!!(K.clipPlane2??b.clipPlane2),j=!!(K.clipPlane3??b.clipPlane3),T=!!(K.clipPlane4??b.clipPlane4),F=!!(K.clipPlane5??b.clipPlane5),l=!!(K.clipPlane6??b.clipPlane6);z&&e.push("#define CLIPPLANE"),k&&e.push("#define CLIPPLANE2"),j&&e.push("#define CLIPPLANE3"),T&&e.push("#define CLIPPLANE4"),F&&e.push("#define CLIPPLANE5"),l&&e.push("#define CLIPPLANE6")}function j(K,b,e){let z=!1;const k=!!(K.clipPlane??b.clipPlane),j=!!(K.clipPlane2??b.clipPlane2),T=!!(K.clipPlane3??b.clipPlane3),F=!!(K.clipPlane4??b.clipPlane4),l=!!(K.clipPlane5??b.clipPlane5),Y=!!(K.clipPlane6??b.clipPlane6);return e.CLIPPLANE!==k&&(e.CLIPPLANE=k,z=!0),e.CLIPPLANE2!==j&&(e.CLIPPLANE2=j,z=!0),e.CLIPPLANE3!==T&&(e.CLIPPLANE3=T,z=!0),e.CLIPPLANE4!==F&&(e.CLIPPLANE4=F,z=!0),e.CLIPPLANE5!==l&&(e.CLIPPLANE5=l,z=!0),e.CLIPPLANE6!==Y&&(e.CLIPPLANE6=Y,z=!0),z}function T(K,b,e){let z=b.clipPlane??e.clipPlane;F(K,"vClipPlane",z),z=b.clipPlane2??e.clipPlane2,F(K,"vClipPlane2",z),z=b.clipPlane3??e.clipPlane3,F(K,"vClipPlane3",z),z=b.clipPlane4??e.clipPlane4,F(K,"vClipPlane4",z),z=b.clipPlane5??e.clipPlane5,F(K,"vClipPlane5",z),z=b.clipPlane6??e.clipPlane6,F(K,"vClipPlane6",z)}function F(K,b,e){e&&K.setFloat4(b,e.k.x,e.k.y,e.k.z,e.d)}e.d(b,{c:()=>z,d:()=>T,f:()=>j,j:()=>k})},11007:(K,b,e)=>{"use strict";function z(K){K.push("vCameraColorCurveNeutral","vCameraColorCurvePositive","vCameraColorCurveNegative")}e.d(b,{b:()=>z})},11422:(K,b,e)=>{"use strict";function z(K){return void 0===K.getPipelineContext}e.d(b,{d:()=>z})},11125:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{static GetEffect(K){return void 0===K.getPipelineContext?K.effect:K}constructor(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._wasPreviouslyReady=!1,this._forceRebindOnNextCall=!0,this._wasPreviouslyUsingInstances=null,this.effect=null,this.defines=null,this.drawContext=K.createDrawContext(),b&&(this.materialContext=K.createMaterialContext())}setEffect(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];var z;(this.effect=K,void 0!==b&&(this.defines=b),e)&&(null===(z=this.drawContext)||void 0===z||z.reset())}dispose(){var K;null===(K=this.drawContext)||void 0===K||K.dispose()}}},10771:(K,b,e)=>{"use strict";e.d(b,{b:()=>X,e:()=>U,f:()=>Y,g:()=>A});var z=e(10693),k=e(10776),j=e(10764),T=e(10696),F=e(10736),l=e(10739);function Y(K,b){return(0,k.z)(b).cachedPipelines[K]}function A(K){const b=K._name,e=K.context;if(b&&e){const K=(0,k.z)(e),z=K.cachedPipelines[b];null===z||void 0===z||z.dispose(),delete K.cachedPipelines[b]}}function X(K,b,e,k,j,T,l){let Y,A;const X=(0,z.k)()?null===T||void 0===T?void 0:T.getHostDocument():null;Y="string"===typeof b?b:b.vertexSource?"source:"+b.vertexSource:b.vertexElement?(null===X||void 0===X?void 0:X.getElementById(b.vertexElement))||b.vertexElement:b.vertex||b,A="string"===typeof b?b:b.fragmentSource?"source:"+b.fragmentSource:b.fragmentElement?(null===X||void 0===X?void 0:X.getElementById(b.fragmentElement))||b.fragmentElement:b.fragment||b;const U=[void 0,void 0],B=()=>{if(U[0]&&U[1]){K.isFragment=!0;const[z,Y]=U;(0,F.i)(Y,K,((T,Y)=>{l&&(l._fragmentSourceCodeBeforeMigration=Y),e&&(T=e("fragment",T));const A=(0,F.e)(z,T,K);K=null;const X=function(K,b,e,z){if(e){return{vertexSourceCode:(1===z?"//":"")+"#define SHADER_NAME vertex:"+(e.vertexElement||e.vertex||e.spectorName||e)+"\n"+K,fragmentSourceCode:(1===z?"//":"")+"#define SHADER_NAME fragment:"+(e.fragmentElement||e.fragment||e.spectorName||e)+"\n"+b}}return{vertexSourceCode:K,fragmentSourceCode:b}}(A.vertexCode,A.fragmentCode,b,j);null===k||void 0===k||k(X.vertexSourceCode,X.fragmentSourceCode)}),T)}};t(Y,"Vertex","",(b=>{(0,F.h)(K),(0,F.i)(b,K,((K,z)=>{l&&(l._rawVertexSourceCode=b,l._vertexSourceCodeBeforeMigration=z),e&&(K=e("vertex",K)),U[0]=K,B()}),T)}),j),t(A,"Fragment","Pixel",(K=>{l&&(l._rawFragmentSourceCode=K),U[1]=K,B()}),j)}function t(K,b,e,k,T,F){if("undefined"!==typeof HTMLElement&&K instanceof HTMLElement){return void k((0,z.c)(K))}if("source:"===K.substring(0,7))return void k(K.substring(7));if("base64:"===K.substring(0,7)){return void k(window.atob(K.substring(7)))}const Y=j.d.GetShadersStore(T);if(Y[K+b+"Shader"])return void k(Y[K+b+"Shader"]);if(e&&Y[K+e+"Shader"])return void k(Y[K+e+"Shader"]);let A;if(A="."===K[0]||"/"===K[0]||K.indexOf("http")>-1?K:j.d.GetShadersRepository(T)+K,!(F=F||l.k))throw new Error("loadFileInjection is not defined");F(A+"."+b.toLowerCase()+".fx",k)}const U=(K,b,e,z)=>{try{const j=K.existingPipelineContext||b(K.shaderProcessingContext);if(j._name=K.name,K.name&&K.context){(0,k.z)(K.context).cachedPipelines[K.name]=j}return e(j,K.vertex,K.fragment,!!K.createAsRaw,"","",K.rebuildRebind,K.defines,K.transformFeedbackVaryings,"",(()=>{z(j,(()=>{var b;null===(b=K.onRenderingStateCompiled)||void 0===b||b.call(K,j)}))})),j}catch(j){throw T.b.Error("Error compiling effect"),j}}},10756:(K,b,e)=>{"use strict";e.d(b,{d:()=>F});var z=e(10690),k=e(10696),j=e(10764),T=e(10771);class F{static get ShadersRepository(){return j.d.ShadersRepository}static set ShadersRepository(K){j.d.ShadersRepository=K}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new z.d),this._onBindObservable}get shaderLanguage(){return this._shaderLanguage}constructor(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,X=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null,t=arguments.length>9?arguments[9]:void 0,U=arguments.length>10&&void 0!==arguments[10]?arguments[10]:"",B=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,u=arguments.length>12?arguments[12]:void 0;this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new z.d,this.onErrorObservable=new z.d,this._onBindObservable=null,this._isDisposed=!1,this._refCount=1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._multiTarget=!1,this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeBeforeMigration="",this._fragmentSourceCodeBeforeMigration="",this._rawVertexSourceCode="",this._rawFragmentSourceCode="",this._processCodeAfterIncludes=void 0,this._processFinalCode=null,this.name=K,this._key=U;const m=this._key.replace(/\r/g,"").replace(/\n/g,"|");let D;if(b.attributes){const K=b;if(this._engine=e,this._attributesNames=K.attributes,this._uniformsNames=K.uniformsNames.concat(K.samplers),this._samplerList=K.samplers.slice(),this.defines=K.defines,this.onError=K.onError,this.onCompiled=K.onCompiled,this._fallbacks=K.fallbacks,this._indexParameters=K.indexParameters,this._transformFeedbackVaryings=K.transformFeedbackVaryings||null,this._multiTarget=!!K.multiTarget,this._shaderLanguage=K.shaderLanguage??0,K.uniformBuffersNames){this._uniformBuffersNamesList=K.uniformBuffersNames.slice();for(let b=0;b<K.uniformBuffersNames.length;b++)this._uniformBuffersNames[K.uniformBuffersNames[b]]=b}this._processFinalCode=K.processFinalCode??null,this._processCodeAfterIncludes=K.processCodeAfterIncludes??void 0,D=K.existingPipelineContext}else this._engine=j,this.defines=null==l?"":l,this._uniformsNames=e.concat(k),this._samplerList=k?k.slice():[],this._attributesNames=b,this._uniformBuffersNamesList=[],this._shaderLanguage=B,this.onError=X,this.onCompiled=A,this._indexParameters=t,this._fallbacks=Y;"WEBGL2"===this._engine.shaderPlatformName&&(D=(0,T.f)(m,this._engine._gl)??D),this._attributeLocationByName={},this.uniqueId=F._UniqueIdSeed++,D?(this._pipelineContext=D,this._pipelineContext.setEngine(this._engine),this._onRenderingStateCompiled(this._pipelineContext),this._pipelineContext.program&&(this._pipelineContext.program.__SPECTOR_rebuildProgram=this._rebuildProgram.bind(this))):this._processShaderCodeAsync(null,!1,null,u)}async _processShaderCodeAsync(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3?arguments[3]:void 0;z&&await z(),this._processingContext=e||this._engine._getShaderProcessingContext(this._shaderLanguage,!1);const k={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:K??this._engine._getShaderProcessor(this._shaderLanguage),supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:j.d.GetShadersRepository(this._shaderLanguage),includesShadersStore:j.d.GetIncludesShadersStore(this._shaderLanguage),version:(100*this._engine.version).toString(),platformName:this._engine.shaderPlatformName,processingContext:this._processingContext,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:this._processCodeAfterIncludes};(0,T.b)(k,this.name,this._processFinalCode,((K,e)=>{this._vertexSourceCode=K,this._fragmentSourceCode=e,this._prepareEffect(b)}),this._shaderLanguage,this._engine,this)}get key(){return this._key}isReady(){try{return this._isReadyInternal()}catch{return!1}}_isReadyInternal(){return!!this._engine.u||(!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady)}getEngine(){return this._engine}getPipelineContext(){return this._pipelineContext}getAttributesNames(){return this._attributesNames}getAttributeLocation(K){return this._attributes[K]}getAttributeLocationByName(K){return this._attributeLocationByName[K]}getAttributesCount(){return this._attributes.length}getUniformIndex(K){return this._uniformsNames.indexOf(K)}getUniform(K){return this._uniforms[K]}getSamplers(){return this._samplerList}getUniformNames(){return this._uniformsNames}getUniformBuffersNames(){return this._uniformBuffersNamesList}getIndexParameters(){return this._indexParameters}getCompilationError(){return this._compilationError}allFallbacksProcessed(){return this._allFallbacksProcessed}executeWhenCompiled(K){this.isReady()?K(this):(this.onCompileObservable.add((b=>{K(b)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((()=>{this._checkIsReady(null)}),16))}_checkIsReady(K){try{if(this._isReadyInternal())return}catch(b){return void this._processCompilationErrors(b,K)}this._isDisposed||setTimeout((()=>{this._checkIsReady(K)}),16)}get vertexSourceCode(){var K;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._vertexSourceCodeOverride:(null===(K=this._pipelineContext)||void 0===K?void 0:K._getVertexShaderCode())??this._vertexSourceCode}get fragmentSourceCode(){var K;return this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?this._fragmentSourceCodeOverride:(null===(K=this._pipelineContext)||void 0===K?void 0:K._getFragmentShaderCode())??this._fragmentSourceCode}get vertexSourceCodeBeforeMigration(){return this._vertexSourceCodeBeforeMigration}get fragmentSourceCodeBeforeMigration(){return this._fragmentSourceCodeBeforeMigration}get rawVertexSourceCode(){return this._rawVertexSourceCode}get rawFragmentSourceCode(){return this._rawFragmentSourceCode}getPipelineGenerationOptions(){return{platformName:this._engine.shaderPlatformName,shaderLanguage:this._shaderLanguage,shaderNameOrContent:this.name,key:this._key,defines:this.defines.split("\n"),addGlobalDefines:!1,extendedProcessingOptions:{indexParameters:this._indexParameters,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,supportsUniformBuffers:this._engine.supportsUniformBuffers},extendedCreatePipelineOptions:{transformFeedbackVaryings:this._transformFeedbackVaryings,createAsRaw:!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride)}}}_rebuildProgram(K,b,e,z){this._isReady=!1,this._vertexSourceCodeOverride=K,this._fragmentSourceCodeOverride=b,this.onError=(K,b)=>{z&&z(b)},this.onCompiled=()=>{var K,b;const z=this.getEngine().scenes;if(z)for(let e=0;e<z.length;e++)z[e].markAllMaterialsAsDirty(63);null===(K=(b=this._pipelineContext)._handlesSpectorRebuildCallback)||void 0===K||K.call(b,e)},this._fallbacks=null,this._prepareEffect()}_onRenderingStateCompiled(K){if(this._pipelineContext=K,this._pipelineContext.setEngine(this._engine),this._attributes=[],this._pipelineContext._fillEffectInformation(this,this._uniformBuffersNames,this._uniformsNames,this._uniforms,this._samplerList,this._samplers,this._attributesNames,this._attributes),this._attributesNames)for(let b=0;b<this._attributesNames.length;b++){const K=this._attributesNames[b];this._attributeLocationByName[K]=this._attributes[b]}this._engine.bindSamplers(this),this._compilationError="",this._isReady=!0,this.onCompiled&&this.onCompiled(this),this.onCompileObservable.notifyObservers(this),this.onCompileObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh(),F.AutomaticallyClearCodeCache&&this.clearCodeCache()}_prepareEffect(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this._pipelineContext;this._isReady=!1;try{const e=!(!this._vertexSourceCodeOverride||!this._fragmentSourceCodeOverride),z=e?null:this.defines,k=e?this._vertexSourceCodeOverride:this._vertexSourceCode,j=e?this._fragmentSourceCodeOverride:this._fragmentSourceCode,F=this._engine;this._pipelineContext=(0,T.e)({existingPipelineContext:K?b:null,vertex:k,fragment:j,context:"WEBGL2"===F.shaderPlatformName?F._gl:void 0,rebuildRebind:(K,b,e,z)=>this._rebuildProgram(K,b,e,z),defines:z,transformFeedbackVaryings:this._transformFeedbackVaryings,name:this._key.replace(/\r/g,"").replace(/\n/g,"|"),createAsRaw:e,parallelShaderCompile:F._caps.parallelShaderCompile,shaderProcessingContext:this._processingContext,onRenderingStateCompiled:e=>{b&&!K&&this._engine._deletePipelineContext(b),e&&this._onRenderingStateCompiled(e)}},this._engine.createPipelineContext.bind(this._engine),this._engine._preparePipelineContext.bind(this._engine),this._engine._executeWhenRenderingStateIsCompiled.bind(this._engine)),this._pipelineContext.isAsync&&this._checkIsReady(b)}catch(e){this._processCompilationErrors(e,b)}}_getShaderCodeAndErrorLine(K,b,e){const z=e?/FRAGMENT SHADER ERROR: 0:(\d+?):/:/VERTEX SHADER ERROR: 0:(\d+?):/;let k=null;if(b&&K){const j=b.match(z);if(j&&2===j.length){const b=parseInt(j[1]),z=K.split("\n",-1);z.length>=b&&(k=`Offending line [${b}] in ${e?"fragment":"vertex"} code: ${z[b-1]}`)}}return[K,k]}_processCompilationErrors(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this._compilationError=K.message;const e=this._attributesNames,z=this._fallbacks;if(k.b.Error("Unable to compile effect:"),k.b.Error("Uniforms: "+this._uniformsNames.map((function(K){return" "+K}))),k.b.Error("Attributes: "+e.map((function(K){return" "+K}))),k.b.Error("Defines:\n"+this.defines),F.LogShaderCodeOnCompilationError){var j,T;let K=null,b=null,e=null;var l;if(null!==(j=this._pipelineContext)&&void 0!==j&&j._getVertexShaderCode()&&([e,K]=this._getShaderCodeAndErrorLine(this._pipelineContext._getVertexShaderCode(),this._compilationError,!1),e&&(k.b.Error("Vertex code:"),k.b.Error(e))),null!==(T=this._pipelineContext)&&void 0!==T&&T._getFragmentShaderCode())[e,b]=this._getShaderCodeAndErrorLine(null===(l=this._pipelineContext)||void 0===l?void 0:l._getFragmentShaderCode(),this._compilationError,!0),e&&(k.b.Error("Fragment code:"),k.b.Error(e));K&&k.b.Error(K),b&&k.b.Error(b)}k.b.Error("Error: "+this._compilationError);const Y=()=>{this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)};b&&(this._pipelineContext=b,this._isReady=!0,Y()),z?(this._pipelineContext=null,z.hasMoreFallbacks?(this._allFallbacksProcessed=!1,k.b.Error("Trying next fallback."),this.defines=z.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,Y(),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):(this._allFallbacksProcessed=!0,b||Y())}get isSupported(){return""===this._compilationError}_bindTexture(K,b){this._engine._bindTexture(this._samplers[K],b,K)}setTexture(K,b){this._engine.setTexture(this._samplers[K],this._uniforms[K],b,K)}setTextureArray(K,b){const e=K+"Ex";if(-1===this._samplerList.indexOf(e+"0")){const z=this._samplerList.indexOf(K);for(let K=1;K<b.length;K++){const b=e+(K-1).toString();this._samplerList.splice(z+K,0,b)}let k=0;for(const K of this._samplerList)this._samplers[K]=k,k+=1}this._engine.setTextureArray(this._samplers[K],this._uniforms[K],b,K)}bindUniformBuffer(K,b){const e=this._uniformBuffersNames[b];void 0===e||F._BaseCache[e]===K&&this._engine._features.useUBOBindingCache||(F._BaseCache[e]=K,this._engine.bindUniformBufferBase(K,e,b))}bindUniformBlock(K,b){this._engine.bindUniformBlock(this._pipelineContext,K,b)}setInt(K,b){return this._pipelineContext.setInt(K,b),this}setInt2(K,b,e){return this._pipelineContext.setInt2(K,b,e),this}setInt3(K,b,e,z){return this._pipelineContext.setInt3(K,b,e,z),this}setInt4(K,b,e,z,k){return this._pipelineContext.setInt4(K,b,e,z,k),this}setIntArray(K,b){return this._pipelineContext.setIntArray(K,b),this}setIntArray2(K,b){return this._pipelineContext.setIntArray2(K,b),this}setIntArray3(K,b){return this._pipelineContext.setIntArray3(K,b),this}setIntArray4(K,b){return this._pipelineContext.setIntArray4(K,b),this}setUInt(K,b){return this._pipelineContext.setUInt(K,b),this}setUInt2(K,b,e){return this._pipelineContext.setUInt2(K,b,e),this}setUInt3(K,b,e,z){return this._pipelineContext.setUInt3(K,b,e,z),this}setUInt4(K,b,e,z,k){return this._pipelineContext.setUInt4(K,b,e,z,k),this}setUIntArray(K,b){return this._pipelineContext.setUIntArray(K,b),this}setUIntArray2(K,b){return this._pipelineContext.setUIntArray2(K,b),this}setUIntArray3(K,b){return this._pipelineContext.setUIntArray3(K,b),this}setUIntArray4(K,b){return this._pipelineContext.setUIntArray4(K,b),this}setFloatArray(K,b){return this._pipelineContext.setArray(K,b),this}setFloatArray2(K,b){return this._pipelineContext.setArray2(K,b),this}setFloatArray3(K,b){return this._pipelineContext.setArray3(K,b),this}setFloatArray4(K,b){return this._pipelineContext.setArray4(K,b),this}setArray(K,b){return this._pipelineContext.setArray(K,b),this}setArray2(K,b){return this._pipelineContext.setArray2(K,b),this}setArray3(K,b){return this._pipelineContext.setArray3(K,b),this}setArray4(K,b){return this._pipelineContext.setArray4(K,b),this}setMatrices(K,b){return this._pipelineContext.setMatrices(K,b),this}setMatrix(K,b){return this._pipelineContext.setMatrix(K,b),this}setMatrix3x3(K,b){return this._pipelineContext.setMatrix3x3(K,b),this}setMatrix2x2(K,b){return this._pipelineContext.setMatrix2x2(K,b),this}setFloat(K,b){return this._pipelineContext.setFloat(K,b),this}setBool(K,b){return this._pipelineContext.setInt(K,b?1:0),this}setVector2(K,b){return this._pipelineContext.setVector2(K,b),this}setFloat2(K,b,e){return this._pipelineContext.setFloat2(K,b,e),this}setVector3(K,b){return this._pipelineContext.setVector3(K,b),this}setFloat3(K,b,e,z){return this._pipelineContext.setFloat3(K,b,e,z),this}setVector4(K,b){return this._pipelineContext.setVector4(K,b),this}setQuaternion(K,b){return this._pipelineContext.setQuaternion(K,b),this}setFloat4(K,b,e,z,k){return this._pipelineContext.setFloat4(K,b,e,z,k),this}setColor3(K,b){return this._pipelineContext.setColor3(K,b),this}setColor4(K,b,e){return this._pipelineContext.setColor4(K,b,e),this}setDirectColor4(K,b){return this._pipelineContext.setDirectColor4(K,b),this}clearCodeCache(){this._vertexSourceCode="",this._fragmentSourceCode="",this._fragmentSourceCodeBeforeMigration="",this._vertexSourceCodeBeforeMigration=""}dispose(){this._refCount--,this._refCount>0||(this._pipelineContext&&(0,T.g)(this._pipelineContext),this._engine._releaseEffect(this),this.clearCodeCache(),this._isDisposed=!0)}static RegisterShader(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;b&&(j.d.GetShadersStore(z)[`${K}PixelShader`]=b),e&&(j.d.GetShadersStore(z)[`${K}VertexShader`]=e)}static ResetCache(){F._BaseCache={}}}F.LogShaderCodeOnCompilationError=!0,F.AutomaticallyClearCodeCache=!1,F._UniqueIdSeed=0,F._BaseCache={},F.ShadersStore=j.d.ShadersStore,F.IncludesShadersStore=j.d.IncludesShadersStore},11201:(K,b,e)=>{"use strict";e.d(b,{c:()=>z});class z{constructor(){this._defines={},this._currentRank=32,this._maxRank=-1,this._mesh=null}unBindMesh(){this._mesh=null}addFallback(K,b){this._defines[K]||(K<this._currentRank&&(this._currentRank=K),K>this._maxRank&&(this._maxRank=K),this._defines[K]=new Array),this._defines[K].push(b)}addCPUSkinningFallback(K,b){this._mesh=b,K<this._currentRank&&(this._currentRank=K),K>this._maxRank&&(this._maxRank=K)}get hasMoreFallbacks(){return this._currentRank<=this._maxRank}reduce(K,b){if(this._mesh&&this._mesh.computeBonesUsingShaders&&this._mesh.numBoneInfluencers>0){this._mesh.computeBonesUsingShaders=!1,K=K.replace("#define NUM_BONE_INFLUENCERS "+this._mesh.numBoneInfluencers,"#define NUM_BONE_INFLUENCERS 0"),b._bonesComputationForcedToCPU=!0;const e=this._mesh.va();for(let K=0;K<e.meshes.length;K++){const z=e.meshes[K];if(z.material){if(z.computeBonesUsingShaders&&0!==z.numBoneInfluencers)if(z.material.getEffect()===b)z.computeBonesUsingShaders=!1;else if(z.Rf)for(const K of z.Rf){if(K.effect===b){z.computeBonesUsingShaders=!1;break}}}else!this._mesh.material&&z.computeBonesUsingShaders&&z.numBoneInfluencers>0&&(z.computeBonesUsingShaders=!1)}}else{const b=this._defines[this._currentRank];if(b)for(let e=0;e<b.length;e++)K=K.replace("#define "+b[e],"");this._currentRank++}return K}}},11524:(K,b,e)=>{"use strict";e.d(b,{c:()=>Y,g:()=>A});var z=e(11030),k=e(11252),j=e(10690),T=e(10756),F=e(11125);e(11527);const l={xa:[1,1,-1,1,-1,-1,1,-1],indices:[0,1,2,0,2,3]};class Y{constructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;this._fullscreenViewport=new k.b(0,0,1,1);const e=b.xa??l.xa,j=b.indices??l.indices;this.kd=K,this._vertexBuffers={[z.f.PositionKind]:new z.f(K,e,z.f.PositionKind,!1,!1,2)},this._indexBuffer=K.createIndexBuffer(j),this._onContextRestoredObserver=K.onContextRestoredObservable.add((()=>{this._indexBuffer=K.createIndexBuffer(j);for(const K in this._vertexBuffers){this._vertexBuffers[K]._rebuild()}}))}setViewport(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._fullscreenViewport;this.kd.setViewport(K)}bindBuffers(K){this.kd.bindBuffers(this._vertexBuffers,this._indexBuffer,K)}applyEffectWrapper(K){this.kd.setState(!0),this.kd.depthCullingState.depthTest=!1,this.kd.stencilState.stencilTest=!1,this.kd.enableEffect(K.drawWrapper),this.bindBuffers(K.effect),K.onApplyObservable.notifyObservers({})}saveStates(){this._savedStateDepthTest=this.kd.depthCullingState.depthTest,this._savedStateStencilTest=this.kd.stencilState.stencilTest}restoreStates(){this.kd.depthCullingState.depthTest=this._savedStateDepthTest,this.kd.stencilState.stencilTest=this._savedStateStencilTest}draw(){this.kd.drawElementsType(0,0,6)}_isRenderTargetTexture(K){return void 0!==K.renderTarget}render(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!K.effect.isReady())return;this.saveStates(),this.setViewport();const e=null===b?null:this._isRenderTargetTexture(b)?b.renderTarget:b;e&&this.kd.bindFramebuffer(e),this.applyEffectWrapper(K),this.draw(),e&&this.kd.unBindFramebuffer(e),this.restoreStates()}dispose(){const K=this._vertexBuffers[z.f.PositionKind];K&&(K.dispose(),delete this._vertexBuffers[z.f.PositionKind]),this._indexBuffer&&this.kd._releaseBuffer(this._indexBuffer),this._onContextRestoredObserver&&(this.kd.onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}}class A{static RegisterShaderCodeProcessing(K,b){b?A._CustomShaderCodeProcessing[K??""]=b:delete A._CustomShaderCodeProcessing[K??""]}static _GetShaderCodeProcessing(K){return A._CustomShaderCodeProcessing[K]??A._CustomShaderCodeProcessing[""]}get name(){return this.options.name}set name(K){this.options.name=K}isReady(){var K;return(null===(K=this._drawWrapper.effect)||void 0===K?void 0:K.isReady())??!1}get drawWrapper(){return this._drawWrapper}get effect(){return this._drawWrapper.effect}set effect(K){this._drawWrapper.effect=K}constructor(K){this.alphaMode=0,this.onEffectCreatedObservable=new j.d(void 0,!0),this.onApplyObservable=new j.d,this._shadersLoaded=!1,this._webGPUReady=!1,this._importPromises=[],this.options={...K,name:K.name||"effectWrapper",kd:K.kd,uniforms:K.uniforms||K.uniformNames||[],uniformNames:void 0,samplers:K.samplers||K.samplerNames||[],samplerNames:void 0,attributeNames:K.attributeNames||["position"],uniformBuffers:K.uniformBuffers||[],defines:K.defines||"",useShaderStore:K.useShaderStore||!1,vertexUrl:K.vertexUrl||K.vertexShader||"postprocess",vertexShader:void 0,fragmentShader:K.fragmentShader||"pass",indexParameters:K.indexParameters,blockCompilation:K.blockCompilation||!1,shaderLanguage:K.shaderLanguage||0,onCompiled:K.onCompiled||void 0,extraInitializations:K.extraInitializations||void 0,extraInitializationsAsync:K.extraInitializationsAsync||void 0,useAsPostProcess:K.useAsPostProcess??!1},this.options.uniformNames=this.options.uniforms,this.options.samplerNames=this.options.samplers,this.options.vertexShader=this.options.vertexUrl,this.options.useAsPostProcess&&(-1===this.options.samplers.indexOf("textureSampler")&&this.options.samplers.push("textureSampler"),-1===this.options.uniforms.indexOf("scale")&&this.options.uniforms.push("scale")),K.vertexUrl||K.vertexShader?this._shaderPath={vertexSource:this.options.vertexShader}:(this.options.useAsPostProcess||(this.options.uniforms.push("scale"),this.onApplyObservable.add((()=>{this.effect.setFloat2("scale",1,1)}))),this._shaderPath={vertex:this.options.vertexShader}),this._shaderPath.fragmentSource=this.options.fragmentShader,this._shaderPath.spectorName=this.options.name,this.options.useShaderStore&&(this._shaderPath.fragment=this._shaderPath.fragmentSource,this._shaderPath.vertex||(this._shaderPath.vertex=this._shaderPath.vertexSource),delete this._shaderPath.fragmentSource,delete this._shaderPath.vertexSource),this.onApplyObservable.add((()=>{this.bind()})),this.options.useShaderStore||(this._onContextRestoredObserver=this.options.kd.onContextRestoredObservable.add((()=>{this.effect._pipelineContext=null,this.effect._prepareEffect()}))),this._drawWrapper=new F.b(this.options.kd),this._webGPUReady=1===this.options.shaderLanguage;const b=Array.isArray(this.options.defines)?this.options.defines.join("\n"):this.options.defines;this._postConstructor(this.options.blockCompilation,b,this.options.extraInitializations)}_gatherImports(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1?arguments[1]:void 0;this.options.useAsPostProcess&&(K&&this._webGPUReady?b.push(Promise.all([e.e(37).then(e.bind(e,13186))])):b.push(Promise.all([Promise.resolve().then(e.bind(e,11527))])))}_postConstructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;this._importPromises.length=0,z&&this._importPromises.push(...z);const k=this.options.kd.isWebGPU&&!A.ForceGLSL;this._gatherImports(k,this._importPromises),void 0!==e&&e(k,this._importPromises),k&&this._webGPUReady&&(this.options.shaderLanguage=1),K||this.updateEffect(b)}updateEffect(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0;const Y=A._GetShaderCodeProcessing(this.name);if(null!==Y&&void 0!==Y&&Y.defineCustomBindings){var X,t;const z=(null===(X=b)||void 0===X?void 0:X.slice())??[];z.push(...this.options.uniforms);const k=(null===(t=e)||void 0===t?void 0:t.slice())??[];k.push(...this.options.samplers),K=Y.defineCustomBindings(this.name,K,z,k),b=z,e=k}this.options.defines=K||"";const U=this._shadersLoaded||0===this._importPromises.length?void 0:async()=>{await Promise.all(this._importPromises),this._shadersLoaded=!0};let B;B=this.options.extraInitializationsAsync?async()=>{null===U||void 0===U||U(),await this.options.extraInitializationsAsync}:U,this.options.useShaderStore?this._drawWrapper.effect=this.options.kd.createEffect({vertex:F??this._shaderPath.vertex,fragment:l??this._shaderPath.fragment},{attributes:this.options.attributeNames,uniformsNames:b||this.options.uniforms,uniformBuffersNames:this.options.uniformBuffers,samplers:e||this.options.samplers,defines:null!==K?K:"",fallbacks:null,onCompiled:k??this.options.onCompiled,onError:j??null,indexParameters:z||this.options.indexParameters,processCodeAfterIncludes:null!==Y&&void 0!==Y&&Y.processCodeAfterIncludes?(K,b)=>Y.processCodeAfterIncludes(this.name,K,b):null,processFinalCode:null!==Y&&void 0!==Y&&Y.processFinalCode?(K,b)=>Y.processFinalCode(this.name,K,b):null,shaderLanguage:this.options.shaderLanguage,extraInitializationsAsync:B},this.options.kd):this._drawWrapper.effect=new T.d(this._shaderPath,this.options.attributeNames,b||this.options.uniforms,e||this.options.samplerNames,this.options.kd,K,void 0,k||this.options.onCompiled,void 0,void 0,void 0,this.options.shaderLanguage,B),this.onEffectCreatedObservable.notifyObservers(this._drawWrapper.effect)}bind(){var K,b;this.options.useAsPostProcess&&(this.options.kd.setAlphaMode(this.alphaMode),this.drawWrapper.effect.setFloat2("scale",1,1)),null===(K=A._GetShaderCodeProcessing(this.name))||void 0===K||null===(b=K.bindCustomBindings)||void 0===b||b.call(K,this.name,this._drawWrapper.effect)}dispose(){this._onContextRestoredObserver&&(this.effect.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null),this.onEffectCreatedObservable.clear(),this.effect.dispose()}}A.ForceGLSL=!1,A._CustomShaderCodeProcessing={}},11010:(K,b,e)=>{"use strict";e.d(b,{c:()=>j,g:()=>k});var z=e(11007);function k(K,b){b.EXPOSURE&&K.push("exposureLinear"),b.CONTRAST&&K.push("contrast"),b.COLORGRADING&&K.push("colorTransformSettings"),(b.VIGNETTE||b.DITHER)&&K.push("vInverseScreenSize"),b.VIGNETTE&&(K.push("vignetteSettings1"),K.push("vignetteSettings2")),b.COLORCURVES&&(0,z.b)(K),b.DITHER&&K.push("ditherIntensity")}function j(K,b){b.COLORGRADING&&K.push("txColorTransform")}},10990:(K,b,e)=>{"use strict";e.d(b,{d:()=>U});var z=e(10936),k=e(10938),j=e(10690),T=e(10994),F=e(11001),l=e(11007);class Y{constructor(){this._dirty=!0,this._tempColor=new T.g(0,0,0,0),this._globalCurve=new T.g(0,0,0,0),this._highlightsCurve=new T.g(0,0,0,0),this._midtonesCurve=new T.g(0,0,0,0),this._shadowsCurve=new T.g(0,0,0,0),this._positiveCurve=new T.g(0,0,0,0),this._negativeCurve=new T.g(0,0,0,0),this._globalHue=30,this._globalDensity=0,this._globalSaturation=0,this._globalExposure=0,this._highlightsHue=30,this._highlightsDensity=0,this._highlightsSaturation=0,this._highlightsExposure=0,this._midtonesHue=30,this._midtonesDensity=0,this._midtonesSaturation=0,this._midtonesExposure=0,this._shadowsHue=30,this._shadowsDensity=0,this._shadowsSaturation=0,this._shadowsExposure=0}get globalHue(){return this._globalHue}set globalHue(K){this._globalHue=K,this._dirty=!0}get globalDensity(){return this._globalDensity}set globalDensity(K){this._globalDensity=K,this._dirty=!0}get globalSaturation(){return this._globalSaturation}set globalSaturation(K){this._globalSaturation=K,this._dirty=!0}get globalExposure(){return this._globalExposure}set globalExposure(K){this._globalExposure=K,this._dirty=!0}get highlightsHue(){return this._highlightsHue}set highlightsHue(K){this._highlightsHue=K,this._dirty=!0}get highlightsDensity(){return this._highlightsDensity}set highlightsDensity(K){this._highlightsDensity=K,this._dirty=!0}get highlightsSaturation(){return this._highlightsSaturation}set highlightsSaturation(K){this._highlightsSaturation=K,this._dirty=!0}get highlightsExposure(){return this._highlightsExposure}set highlightsExposure(K){this._highlightsExposure=K,this._dirty=!0}get midtonesHue(){return this._midtonesHue}set midtonesHue(K){this._midtonesHue=K,this._dirty=!0}get midtonesDensity(){return this._midtonesDensity}set midtonesDensity(K){this._midtonesDensity=K,this._dirty=!0}get midtonesSaturation(){return this._midtonesSaturation}set midtonesSaturation(K){this._midtonesSaturation=K,this._dirty=!0}get midtonesExposure(){return this._midtonesExposure}set midtonesExposure(K){this._midtonesExposure=K,this._dirty=!0}get shadowsHue(){return this._shadowsHue}set shadowsHue(K){this._shadowsHue=K,this._dirty=!0}get shadowsDensity(){return this._shadowsDensity}set shadowsDensity(K){this._shadowsDensity=K,this._dirty=!0}get shadowsSaturation(){return this._shadowsSaturation}set shadowsSaturation(K){this._shadowsSaturation=K,this._dirty=!0}get shadowsExposure(){return this._shadowsExposure}set shadowsExposure(K){this._shadowsExposure=K,this._dirty=!0}getClassName(){return"ColorCurves"}static Bind(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"vCameraColorCurvePositive",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vCameraColorCurveNeutral",k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"vCameraColorCurveNegative";K._dirty&&(K._dirty=!1,K._getColorGradingDataToRef(K._globalHue,K._globalDensity,K._globalSaturation,K._globalExposure,K._globalCurve),K._getColorGradingDataToRef(K._highlightsHue,K._highlightsDensity,K._highlightsSaturation,K._highlightsExposure,K._tempColor),K._tempColor.multiplyToRef(K._globalCurve,K._highlightsCurve),K._getColorGradingDataToRef(K._midtonesHue,K._midtonesDensity,K._midtonesSaturation,K._midtonesExposure,K._tempColor),K._tempColor.multiplyToRef(K._globalCurve,K._midtonesCurve),K._getColorGradingDataToRef(K._shadowsHue,K._shadowsDensity,K._shadowsSaturation,K._shadowsExposure,K._tempColor),K._tempColor.multiplyToRef(K._globalCurve,K._shadowsCurve),K._highlightsCurve.subtractToRef(K._midtonesCurve,K._positiveCurve),K._midtonesCurve.subtractToRef(K._shadowsCurve,K._negativeCurve)),b&&(b.setFloat4(e,K._positiveCurve.r,K._positiveCurve.g,K._positiveCurve.b,K._positiveCurve.a),b.setFloat4(z,K._midtonesCurve.r,K._midtonesCurve.g,K._midtonesCurve.b,K._midtonesCurve.a),b.setFloat4(k,K._negativeCurve.r,K._negativeCurve.g,K._negativeCurve.b,K._negativeCurve.a))}_getColorGradingDataToRef(K,b,e,z,k){null!=K&&(K=Y._Clamp(K,0,360),b=Y._Clamp(b,-100,100),e=Y._Clamp(e,-100,100),z=Y._Clamp(z,-100,100),b=Y._ApplyColorGradingSliderNonlinear(b),b*=.5,z=Y._ApplyColorGradingSliderNonlinear(z),b<0&&(b*=-1,K=(K+180)%360),Y._FromHSBToRef(K,b,50+.25*z,k),k.scaleToRef(2,k),k.a=1+.01*e)}static _ApplyColorGradingSliderNonlinear(K){K/=100;let b=Math.abs(K);return b=Math.pow(b,2),K<0&&(b*=-1),b*=100,b}static _FromHSBToRef(K,b,e,z){let k=Y._Clamp(K,0,360);const j=Y._Clamp(b/100,0,1),T=Y._Clamp(e/100,0,1);if(0===j)z.r=T,z.g=T,z.b=T;else{k/=60;const K=Math.floor(k),b=k-K,e=T*(1-j),F=T*(1-j*b),l=T*(1-j*(1-b));switch(K){case 0:z.r=T,z.g=l,z.b=e;break;case 1:z.r=F,z.g=T,z.b=e;break;case 2:z.r=e,z.g=T,z.b=l;break;case 3:z.r=e,z.g=F,z.b=T;break;case 4:z.r=l,z.g=e,z.b=T;break;default:z.r=T,z.g=e,z.b=F}}z.a=1}static _Clamp(K,b,e){return Math.min(Math.max(K,b),e)}clone(){return F.e.Clone((()=>new Y),this)}serialize(){return F.e.Serialize(this)}static Parse(K){return F.e.Parse((()=>new Y),K,null,null)}}Y.PrepareUniforms=l.b,(0,z.b)([(0,k.M)()],Y.prototype,"_globalHue",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_globalDensity",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_globalSaturation",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_globalExposure",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_highlightsHue",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_highlightsDensity",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_highlightsSaturation",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_highlightsExposure",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_midtonesHue",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_midtonesDensity",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_midtonesSaturation",void 0),(0,z.b)([(0,k.M)()],Y.prototype,"_midtonesExposure",void 0),F.e._ColorCurvesParser=Y.Parse;var A=e(10803),X=e(11010),t=e(10799);class U{constructor(){this.colorCurves=new Y,this._colorCurvesEnabled=!1,this._colorGradingEnabled=!1,this._colorGradingWithGreenDepth=!0,this._colorGradingBGR=!0,this._exposure=1,this._toneMappingEnabled=!1,this._toneMappingType=U.TONEMAPPING_STANDARD,this._contrast=1,this.vignetteStretch=0,this.vignetteCenterX=0,this.vignetteCenterY=0,this.vignetteWeight=1.5,this.vignetteColor=new T.g(0,0,0,0),this.vignetteCameraFov=.5,this._vignetteBlendMode=U.VIGNETTEMODE_MULTIPLY,this._vignetteEnabled=!1,this._ditheringEnabled=!1,this._ditheringIntensity=1/255,this._skipFinalColorClamp=!1,this._applyByPostProcess=!1,this._isEnabled=!0,this.onUpdateParameters=new j.d}get colorCurvesEnabled(){return this._colorCurvesEnabled}set colorCurvesEnabled(K){this._colorCurvesEnabled!==K&&(this._colorCurvesEnabled=K,this._updateParameters())}get colorGradingTexture(){return this._colorGradingTexture}set colorGradingTexture(K){this._colorGradingTexture!==K&&(this._colorGradingTexture=K,this._updateParameters())}get colorGradingEnabled(){return this._colorGradingEnabled}set colorGradingEnabled(K){this._colorGradingEnabled!==K&&(this._colorGradingEnabled=K,this._updateParameters())}get colorGradingWithGreenDepth(){return this._colorGradingWithGreenDepth}set colorGradingWithGreenDepth(K){this._colorGradingWithGreenDepth!==K&&(this._colorGradingWithGreenDepth=K,this._updateParameters())}get colorGradingBGR(){return this._colorGradingBGR}set colorGradingBGR(K){this._colorGradingBGR!==K&&(this._colorGradingBGR=K,this._updateParameters())}get exposure(){return this._exposure}set exposure(K){this._exposure!==K&&(this._exposure=K,this._updateParameters())}get toneMappingEnabled(){return this._toneMappingEnabled}set toneMappingEnabled(K){this._toneMappingEnabled!==K&&(this._toneMappingEnabled=K,this._updateParameters())}get toneMappingType(){return this._toneMappingType}set toneMappingType(K){this._toneMappingType!==K&&(this._toneMappingType=K,this._updateParameters())}get contrast(){return this._contrast}set contrast(K){this._contrast!==K&&(this._contrast=K,this._updateParameters())}get vignetteCentreY(){return this.vignetteCenterY}set vignetteCentreY(K){this.vignetteCenterY=K}get vignetteCentreX(){return this.vignetteCenterX}set vignetteCentreX(K){this.vignetteCenterX=K}get vignetteBlendMode(){return this._vignetteBlendMode}set vignetteBlendMode(K){this._vignetteBlendMode!==K&&(this._vignetteBlendMode=K,this._updateParameters())}get vignetteEnabled(){return this._vignetteEnabled}set vignetteEnabled(K){this._vignetteEnabled!==K&&(this._vignetteEnabled=K,this._updateParameters())}get ditheringEnabled(){return this._ditheringEnabled}set ditheringEnabled(K){this._ditheringEnabled!==K&&(this._ditheringEnabled=K,this._updateParameters())}get ditheringIntensity(){return this._ditheringIntensity}set ditheringIntensity(K){this._ditheringIntensity!==K&&(this._ditheringIntensity=K,this._updateParameters())}get skipFinalColorClamp(){return this._skipFinalColorClamp}set skipFinalColorClamp(K){this._skipFinalColorClamp!==K&&(this._skipFinalColorClamp=K,this._updateParameters())}get applyByPostProcess(){return this._applyByPostProcess}set applyByPostProcess(K){this._applyByPostProcess!==K&&(this._applyByPostProcess=K,this._updateParameters())}get isEnabled(){return this._isEnabled}set isEnabled(K){this._isEnabled!==K&&(this._isEnabled=K,this._updateParameters())}_updateParameters(){this.onUpdateParameters.notifyObservers(this)}getClassName(){return"ImageProcessingConfiguration"}prepareDefines(K){if((arguments.length>1&&void 0!==arguments[1]&&arguments[1])!==this.applyByPostProcess||!this._isEnabled)return K.VIGNETTE=!1,K.TONEMAPPING=0,K.CONTRAST=!1,K.EXPOSURE=!1,K.COLORCURVES=!1,K.COLORGRADING=!1,K.COLORGRADING3D=!1,K.DITHER=!1,K.IMAGEPROCESSING=!1,K.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,void(K.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess&&this._isEnabled);if(K.VIGNETTE=this.vignetteEnabled,K.VIGNETTEBLENDMODEMULTIPLY=this.vignetteBlendMode===U._VIGNETTEMODE_MULTIPLY,K.VIGNETTEBLENDMODEOPAQUE=!K.VIGNETTEBLENDMODEMULTIPLY,this._toneMappingEnabled)switch(this._toneMappingType){case U.TONEMAPPING_KHR_PBR_NEUTRAL:K.TONEMAPPING=3;break;case U.TONEMAPPING_ACES:K.TONEMAPPING=2;break;default:K.TONEMAPPING=1}else K.TONEMAPPING=0;K.CONTRAST=1!==this.contrast,K.EXPOSURE=1!==this.exposure,K.COLORCURVES=this.colorCurvesEnabled&&!!this.colorCurves,K.COLORGRADING=this.colorGradingEnabled&&!!this.colorGradingTexture,K.COLORGRADING?K.COLORGRADING3D=this.colorGradingTexture.is3D:K.COLORGRADING3D=!1,K.SAMPLER3DGREENDEPTH=this.colorGradingWithGreenDepth,K.SAMPLER3DBGRMAP=this.colorGradingBGR,K.DITHER=this._ditheringEnabled,K.IMAGEPROCESSINGPOSTPROCESS=this.applyByPostProcess,K.SKIPFINALCOLORCLAMP=this.skipFinalColorClamp,K.IMAGEPROCESSING=K.VIGNETTE||!!K.TONEMAPPING||K.CONTRAST||K.EXPOSURE||K.COLORCURVES||K.COLORGRADING||K.DITHER}isReady(){return!this.colorGradingEnabled||!this.colorGradingTexture||this.colorGradingTexture.isReady()}bind(K,b){if(this._colorCurvesEnabled&&this.colorCurves&&Y.Bind(this.colorCurves,K),this._vignetteEnabled||this._ditheringEnabled){const e=1/K.getEngine().getRenderWidth(),z=1/K.getEngine().getRenderHeight();if(K.setFloat2("vInverseScreenSize",e,z),this._ditheringEnabled&&K.setFloat("ditherIntensity",.5*this._ditheringIntensity),this._vignetteEnabled){const k=null!=b?b:z/e;let j=Math.tan(.5*this.vignetteCameraFov),T=j*k;const F=Math.sqrt(T*j);T=(0,A.l)(T,F,this.vignetteStretch),j=(0,A.l)(j,F,this.vignetteStretch),K.setFloat4("vignetteSettings1",T,j,-T*this.vignetteCenterX,-j*this.vignetteCenterY);const l=-2*this.vignetteWeight;K.setFloat4("vignetteSettings2",this.vignetteColor.r,this.vignetteColor.g,this.vignetteColor.b,l)}}if(K.setFloat("exposureLinear",this.exposure),K.setFloat("contrast",this.contrast),this.colorGradingTexture){K.setTexture("txColorTransform",this.colorGradingTexture);const b=this.colorGradingTexture.getSize().height;K.setFloat4("colorTransformSettings",(b-1)/b,.5/b,b,this.colorGradingTexture.level)}}clone(){return F.e.Clone((()=>new U),this)}serialize(){return F.e.Serialize(this)}static Parse(K){const b=F.e.Parse((()=>new U),K,null,null);return void 0!==K.vignetteCentreX&&(b.vignetteCenterX=K.vignetteCentreX),void 0!==K.vignetteCentreY&&(b.vignetteCenterY=K.vignetteCentreY),b}static get VIGNETTEMODE_MULTIPLY(){return this._VIGNETTEMODE_MULTIPLY}static get VIGNETTEMODE_OPAQUE(){return this._VIGNETTEMODE_OPAQUE}}U.TONEMAPPING_STANDARD=0,U.TONEMAPPING_ACES=1,U.TONEMAPPING_KHR_PBR_NEUTRAL=2,U.PrepareUniforms=X.g,U.PrepareSamplers=X.c,U._VIGNETTEMODE_MULTIPLY=0,U._VIGNETTEMODE_OPAQUE=1,(0,z.b)([(0,k.i)()],U.prototype,"colorCurves",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_colorCurvesEnabled",void 0),(0,z.b)([(0,k.E)("colorGradingTexture")],U.prototype,"_colorGradingTexture",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_colorGradingEnabled",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_colorGradingWithGreenDepth",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_colorGradingBGR",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_exposure",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_toneMappingEnabled",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_toneMappingType",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_contrast",void 0),(0,z.b)([(0,k.M)()],U.prototype,"vignetteStretch",void 0),(0,z.b)([(0,k.M)()],U.prototype,"vignetteCenterX",void 0),(0,z.b)([(0,k.M)()],U.prototype,"vignetteCenterY",void 0),(0,z.b)([(0,k.M)()],U.prototype,"vignetteWeight",void 0),(0,z.b)([(0,k.n)()],U.prototype,"vignetteColor",void 0),(0,z.b)([(0,k.M)()],U.prototype,"vignetteCameraFov",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_vignetteBlendMode",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_vignetteEnabled",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_ditheringEnabled",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_ditheringIntensity",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_skipFinalColorClamp",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_applyByPostProcess",void 0),(0,z.b)([(0,k.M)()],U.prototype,"_isEnabled",void 0),F.e._ImageProcessingConfigurationParser=U.Parse,(0,t.e)("BABYLON.ImageProcessingConfiguration",U)},11210:(K,b,e)=>{"use strict";e.d(b,{d:()=>X});var z=e(10936),k=e(11085),j=e(10938),T=e(11194),F=e(11146),l=e(11215),Y=e(11129);class A extends F.d{constructor(){super(...arguments),this.DETAIL=!1,this.DETAILDIRECTUV=0,this.DETAIL_NORMALBLENDMETHOD=0}}class X extends l.b{_markAllSubMeshesAsTexturesDirty(){this._enable(this._isEnabled),this._internalMarkAllSubMeshesAsTexturesDirty()}isCompatible(){return!0}constructor(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];super(K,"DetailMap",140,new A,b),this._texture=null,this.diffuseBlendLevel=1,this.roughnessBlendLevel=1,this.bumpLevel=1,this._normalBlendMethod=k.b.MATERIAL_NORMALBLENDMETHOD_WHITEOUT,this._isEnabled=!1,this.isEnabled=!1,this._internalMarkAllSubMeshesAsTexturesDirty=K._dirtyCallbacks[1]}isReadyForSubMesh(K,b,e){return!this._isEnabled||!(K._areTexturesDirty&&b.texturesEnabled&&e.getCaps().standardDerivatives&&this._texture&&T.c.DetailTextureEnabled&&!this._texture.isReady())}prepareDefines(K,b){if(this._isEnabled){K.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod;const e=b.getEngine();K._areTexturesDirty&&(e.getCaps().standardDerivatives&&this._texture&&T.c.DetailTextureEnabled&&this._isEnabled?((0,Y.V)(this._texture,K,"DETAIL"),K.DETAIL_NORMALBLENDMETHOD=this._normalBlendMethod):K.DETAIL=!1)}else K.DETAIL=!1}bindForSubMesh(K,b){if(!this._isEnabled)return;const e=this._material.isFrozen;K.useUbo&&e&&K.isSync||this._texture&&T.c.DetailTextureEnabled&&(K.updateFloat4("vDetailInfos",this._texture.coordinatesIndex,this.diffuseBlendLevel,this.bumpLevel,this.roughnessBlendLevel),(0,Y.y)(this._texture,K,"detail")),b.texturesEnabled&&this._texture&&T.c.DetailTextureEnabled&&K.setTexture("detailSampler",this._texture)}hasTexture(K){return this._texture===K}getActiveTextures(K){this._texture&&K.push(this._texture)}getAnimatables(K){this._texture&&this._texture.animations&&this._texture.animations.length>0&&K.push(this._texture)}dispose(K){var b;K&&(null===(b=this._texture)||void 0===b||b.dispose())}getClassName(){return"DetailMapConfiguration"}getSamplers(K){K.push("detailSampler")}getUniforms(){return{ubo:[{name:"vDetailInfos",size:4,type:"vec4"},{name:"detailMatrix",size:16,type:"mat4"}]}}}(0,z.b)([(0,j.E)("detailTexture"),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"texture",void 0),(0,z.b)([(0,j.M)()],X.prototype,"diffuseBlendLevel",void 0),(0,z.b)([(0,j.M)()],X.prototype,"roughnessBlendLevel",void 0),(0,z.b)([(0,j.M)()],X.prototype,"bumpLevel",void 0),(0,z.b)([(0,j.M)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"normalBlendMethod",void 0),(0,z.b)([(0,j.M)(),(0,j.b)("_markAllSubMeshesAsTexturesDirty")],X.prototype,"isEnabled",void 0)},11085:(K,b,e)=>{"use strict";e.d(b,{b:()=>m});var z=e(10936),k=e(10938),j=e(10686),T=e(10690),F=e(10720),l=e(11089),Y=e(11017),A=e(10696),X=e(11068),t=e(11125),U=e(11001);class B{constructor(){this.reset()}reset(){this.enabled=!1,this.mask=255,this.func=519,this.funcRef=1,this.funcMask=255,this.opStencilFail=7680,this.opDepthFail=7680,this.opStencilDepthPass=7681}get func(){return this._func}set func(K){this._func=K}get funcRef(){return this._funcRef}set funcRef(K){this._funcRef=K}get funcMask(){return this._funcMask}set funcMask(K){this._funcMask=K}get opStencilFail(){return this._opStencilFail}set opStencilFail(K){this._opStencilFail=K}get opDepthFail(){return this._opDepthFail}set opDepthFail(K){this._opDepthFail=K}get opStencilDepthPass(){return this._opStencilDepthPass}set opStencilDepthPass(K){this._opStencilDepthPass=K}get mask(){return this._mask}set mask(K){this._mask=K}get enabled(){return this._enabled}set enabled(K){this._enabled=K}getClassName(){return"MaterialStencilState"}copyTo(K){U.e.Clone((()=>K),this)}serialize(){return U.e.Serialize(this)}parse(K,b,e){U.e.Parse((()=>this),K,b,e)}}(0,z.b)([(0,k.M)()],B.prototype,"func",null),(0,z.b)([(0,k.M)()],B.prototype,"funcRef",null),(0,z.b)([(0,k.M)()],B.prototype,"funcMask",null),(0,z.b)([(0,k.M)()],B.prototype,"opStencilFail",null),(0,z.b)([(0,k.M)()],B.prototype,"opDepthFail",null),(0,z.b)([(0,k.M)()],B.prototype,"opStencilDepthPass",null),(0,z.b)([(0,k.M)()],B.prototype,"mask",null),(0,z.b)([(0,k.M)()],B.prototype,"enabled",null);var u=e(11129);class m{get shaderLanguage(){return this._shaderLanguage}get canRenderToMRT(){return!1}set alpha(K){if(this._alpha===K)return;const b=this._alpha;this._alpha=K,1!==b&&1!==K||this.rg(m.MiscDirtyFlag+m.PrePassDirtyFlag)}get alpha(){return this._alpha}set Lg(K){this._backFaceCulling!==K&&(this._backFaceCulling=K,this.rg(m.TextureDirtyFlag))}get Lg(){return this._backFaceCulling}set cullBackFaces(K){this._cullBackFaces!==K&&(this._cullBackFaces=K,this.rg(m.TextureDirtyFlag))}get cullBackFaces(){return this._cullBackFaces}get blockDirtyMechanism(){return this._blockDirtyMechanism}set blockDirtyMechanism(K){this._blockDirtyMechanism!==K&&(this._blockDirtyMechanism=K,K||this.Oi())}atomicMaterialsUpdate(K){this.blockDirtyMechanism=!0;try{K(this)}finally{this.blockDirtyMechanism=!1}}get hasRenderTargetTextures(){return this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._eventInfo.hasRenderTargetTextures}set onDispose(K){this._onDisposeObserver&&this.Ui.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ui.add(K)}get onBindObservable(){return this._onBindObservable||(this._onBindObservable=new T.d),this._onBindObservable}set onBind(K){this._onBindObserver&&this.onBindObservable.remove(this._onBindObserver),this._onBindObserver=this.onBindObservable.add(K)}get onUnBindObservable(){return this._onUnBindObservable||(this._onUnBindObservable=new T.d),this._onUnBindObservable}get onEffectCreatedObservable(){return this._onEffectCreatedObservable||(this._onEffectCreatedObservable=new T.d),this._onEffectCreatedObservable}set alphaMode(K){this._alphaMode!==K&&(this._alphaMode=K,this.rg(m.TextureDirtyFlag))}get alphaMode(){return this._alphaMode}set needDepthPrePass(K){this._needDepthPrePass!==K&&(this._needDepthPrePass=K,this._needDepthPrePass&&(this.checkReadyOnEveryCall=!0))}get needDepthPrePass(){return this._needDepthPrePass}get isPrePassCapable(){return!1}set fogEnabled(K){this._fogEnabled!==K&&(this._fogEnabled=K,this.rg(m.MiscDirtyFlag))}get fogEnabled(){return this._fogEnabled}get wireframe(){switch(this._fillMode){case m.WireFrameFillMode:case m.LineListDrawMode:case m.LineLoopDrawMode:case m.LineStripDrawMode:return!0}return this._scene.forceWireframe}set wireframe(K){this.fillMode=K?m.WireFrameFillMode:m.TriangleFillMode}get pointsCloud(){switch(this._fillMode){case m.PointFillMode:case m.PointListDrawMode:return!0}return this._scene.forcePointsCloud}set pointsCloud(K){this.fillMode=K?m.PointFillMode:m.TriangleFillMode}get fillMode(){return this._fillMode}set fillMode(K){this._fillMode!==K&&(this._fillMode=K,this.rg(m.MiscDirtyFlag))}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(K){const b=this.va().getEngine().getCaps().fragmentDepthSupported;K&&!b&&A.b.Warn("Logarithmic depth has been requested for a material on a device that doesn't support it."),this._useLogarithmicDepth=K&&b,this._markAllSubMeshesAsMiscDirty()}_getDrawWrapper(){return this._drawWrapper}_setDrawWrapper(K){this._drawWrapper=K}constructor(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.shadowDepthWrapper=null,this.allowShaderHotSwapping=!0,this._shaderLanguage=0,this._forceGLSL=!1,this.metadata=null,this.reservedDataStore=null,this.checkReadyOnEveryCall=!1,this.checkReadyOnlyOnce=!1,this.state="",this._alpha=1,this._backFaceCulling=!0,this._cullBackFaces=!0,this._blockDirtyMechanism=!1,this.sideOrientation=null,this.onCompiled=null,this.onError=null,this.getRenderTargetTextures=null,this.doNotSerialize=!1,this._storeEffectOnSubMeshes=!1,this.animations=null,this.Ui=new T.d,this._onDisposeObserver=null,this._onUnBindObservable=null,this._onBindObserver=null,this._alphaMode=2,this._needDepthPrePass=!1,this.disableDepthWrite=!1,this.disableColorWrite=!1,this.forceDepthWrite=!1,this.depthFunction=0,this.separateCullingPass=!1,this._fogEnabled=!0,this.pointSize=1,this.zOffset=0,this.zOffsetUnits=0,this.stencil=new B,this._useUBO=!1,this._fillMode=m.TriangleFillMode,this._cachedDepthWriteState=!1,this._cachedColorWriteState=!1,this._cachedDepthFunctionState=0,this._indexInSceneMaterialArray=-1,this.meshMap=null,this._parentContainer=null,this._uniformBufferLayoutBuilt=!1,this._eventInfo={},this._callbackPluginEventGeneric=()=>{},this._callbackPluginEventIsReadyForSubMesh=()=>{},this._callbackPluginEventPrepareDefines=()=>{},this._callbackPluginEventPrepareDefinesBeforeAttributes=()=>{},this._callbackPluginEventHardBindForSubMesh=()=>{},this._callbackPluginEventBindForSubMesh=()=>{},this._callbackPluginEventHasRenderTargetTextures=()=>{},this._callbackPluginEventFillRenderTargetTextures=()=>{},this._forceAlphaTest=!1,this._transparencyMode=null,this.name=K;const k=b||F.b.LastCreatedScene;k&&(this._scene=k,this._dirtyCallbacks={},this._forceGLSL=z,this._dirtyCallbacks[1]=this._markAllSubMeshesAsTexturesDirty.bind(this),this._dirtyCallbacks[2]=this._markAllSubMeshesAsLightsDirty.bind(this),this._dirtyCallbacks[4]=this._markAllSubMeshesAsFresnelDirty.bind(this),this._dirtyCallbacks[8]=this._markAllSubMeshesAsAttributesDirty.bind(this),this._dirtyCallbacks[16]=this._markAllSubMeshesAsMiscDirty.bind(this),this._dirtyCallbacks[32]=this._markAllSubMeshesAsPrePassDirty.bind(this),this._dirtyCallbacks[63]=this._markAllSubMeshesAsAllDirty.bind(this),this.id=K||j.f.RandomId(),this.uniqueId=this._scene.getUniqueId(),this._materialContext=this._scene.getEngine().createMaterialContext(),this._drawWrapper=new t.b(this._scene.getEngine(),!1),this._drawWrapper.materialContext=this._materialContext,this._uniformBuffer=new Y.d(this._scene.getEngine(),void 0,void 0,K),this._useUBO=this.va().getEngine().supportsUniformBuffers,this._createUniformBuffer(),e||this._scene.addMaterial(this),this._scene.useMaterialMeshMap&&(this.meshMap={}),m.OnEventObservable.notifyObservers(this,1))}_createUniformBuffer(){var K;const b=this.va().getEngine();null===(K=this._uniformBuffer)||void 0===K||K.dispose(),b.isWebGPU&&!this._forceGLSL?(this._uniformBuffer=new Y.d(b,void 0,void 0,this.name,!0),this._shaderLanguage=1):this._uniformBuffer=new Y.d(this._scene.getEngine(),void 0,void 0,this.name),this._uniformBufferLayoutBuilt=!1}toString(K){return"Name: "+this.name}getClassName(){return"Material"}get _isMaterial(){return!0}get isFrozen(){return this.checkReadyOnlyOnce}freeze(){this.Oi(),this.checkReadyOnlyOnce=!0}unfreeze(){this.Oi(),this.checkReadyOnlyOnce=!1}isReady(K,b){return!0}isReadyForSubMesh(K,b,e){const z=b.materialDefines;return!!z&&(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=z,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),this._eventInfo.isReadyForSubMesh)}getEffect(){return this._drawWrapper.effect}va(){return this._scene}_getEffectiveOrientation(K){return null!==this.sideOrientation?this.sideOrientation:K.sideOrientation}get transparencyMode(){return this._transparencyMode}set transparencyMode(K){this._transparencyMode!==K&&(this._transparencyMode=K,this._forceAlphaTest=K===m.MATERIAL_ALPHATESTANDBLEND,this._markAllSubMeshesAsTexturesAndMiscDirty())}get _disableAlphaBlending(){return this._transparencyMode===m.MATERIAL_OPAQUE||this._transparencyMode===m.MATERIAL_ALPHATEST}needAlphaBlending(){return!this._disableAlphaBlending&&this.alpha<1}needAlphaBlendingForMesh(K){return K.visibility<1||!this._disableAlphaBlending&&(K.hasVertexAlpha||this.needAlphaBlending())}needAlphaTesting(){return!!this._forceAlphaTest}_shouldTurnAlphaTestOn(K){return!this.needAlphaBlendingForMesh(K)&&this.needAlphaTesting()}getAlphaTestTexture(){return null}Oi(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this.va().meshes;for(const e of b)if(e.Rf)for(const b of e.Rf)if(b.Ha()===this)for(const e of b._drawWrappers)e&&this._materialContext===e.materialContext&&(e._wasPreviouslyReady=!1,e._wasPreviouslyUsingInstances=null,e._forceRebindOnNextCall=K);K&&this.rg(m.AllDirtyFlag)}_preBind(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this._scene.getEngine(),z=(null==b?this.sideOrientation:b)===m.ClockWiseSideOrientation;return e.enableEffect(K||this._getDrawWrapper()),e.setState(this.Lg,this.zOffset,!1,z,this._scene._mirroredCameraPosition?!this.cullBackFaces:this.cullBackFaces,this.stencil,this.zOffsetUnits),z}bind(K,b){}buildUniformLayout(){const K=this._uniformBuffer;this._eventInfo.ubo=K,this._callbackPluginEventGeneric(8,this._eventInfo),K.create(),this._uniformBufferLayoutBuilt=!0}bindForSubMesh(K,b,e){const z=e._drawWrapper;this._eventInfo.subMesh=e,this._callbackPluginEventBindForSubMesh(this._eventInfo),z._forceRebindOnNextCall=!1}bindOnlyWorldMatrix(K){}bindView(K){this._useUBO?this._needToBindSceneUbo=!0:K.setMatrix("view",this.va().getViewMatrix())}bindViewProjection(K){this._useUBO?this._needToBindSceneUbo=!0:(K.setMatrix("viewProjection",this.va().getTransformMatrix()),K.setMatrix("projection",this.va().getProjectionMatrix()))}bindEyePosition(K,b){this._useUBO?this._needToBindSceneUbo=!0:this._scene.bindEyePosition(K,b)}_afterBind(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._scene._cachedMaterial=this,this._needToBindSceneUbo&&b&&(this._needToBindSceneUbo=!1,(0,u.u)(b,this.va().getSceneUniformBuffer()),this._scene.finalizeSceneUbo()),this._scene._cachedVisibility=K?K.visibility:1,this._onBindObservable&&K&&this._onBindObservable.notifyObservers(K),this.disableDepthWrite){const K=this._scene.getEngine();this._cachedDepthWriteState=K.getDepthWrite(),K.setDepthWrite(!1)}if(this.disableColorWrite){const K=this._scene.getEngine();this._cachedColorWriteState=K.getColorWrite(),K.setColorWrite(!1)}if(0!==this.depthFunction){const K=this._scene.getEngine();this._cachedDepthFunctionState=K.getDepthFunction()||0,K.setDepthFunction(this.depthFunction)}}unbind(){if(this._onUnBindObservable&&this._onUnBindObservable.notifyObservers(this),0!==this.depthFunction){this._scene.getEngine().setDepthFunction(this._cachedDepthFunctionState)}if(this.disableDepthWrite){this._scene.getEngine().setDepthWrite(this._cachedDepthWriteState)}if(this.disableColorWrite){this._scene.getEngine().setColorWrite(this._cachedColorWriteState)}}getAnimatables(){return this._eventInfo.animatables=[],this._callbackPluginEventGeneric(256,this._eventInfo),this._eventInfo.animatables}getActiveTextures(){return this._eventInfo.activeTextures=[],this._callbackPluginEventGeneric(512,this._eventInfo),this._eventInfo.activeTextures}hasTexture(K){return this._eventInfo.hasTexture=!1,this._eventInfo.texture=K,this._callbackPluginEventGeneric(1024,this._eventInfo),this._eventInfo.hasTexture}clone(K){return null}_clonePlugins(K,b){const e={};if(this._serializePlugins(e),m._ParsePlugins(e,K,this._scene,b),this.pluginManager)for(const z of this.pluginManager._plugins){const b=K.pluginManager.getPlugin(z.name);b&&z.copyTo(b)}}getBindedMeshes(){if(this.meshMap){const K=[];for(const b in this.meshMap){const e=this.meshMap[b];e&&K.push(e)}return K}return this._scene.meshes.filter((K=>K.material===this))}forceCompilation(K,b,e,z){const k={clipPlane:!1,useInstances:!1,...e},j=this.va(),T=this.allowShaderHotSwapping;this.allowShaderHotSwapping=!1;const F=()=>{if(!this._scene||!this._scene.getEngine())return;const e=j.clipPlane;if(k.clipPlane&&(j.clipPlane=new X.b(0,0,0,1)),this._storeEffectOnSubMeshes){let e=!0,j=null;if(K.Rf){const b=new l.e(0,0,0,0,0,K,void 0,!1,!1);b.materialDefines&&(b.materialDefines._renderId=-1),this.isReadyForSubMesh(K,b,k.useInstances)||(b.effect&&b.effect.getCompilationError()&&b.effect.allFallbacksProcessed()?j=b.effect.getCompilationError():(e=!1,setTimeout(F,16)))}e&&(this.allowShaderHotSwapping=T,j&&z&&z(j),b&&b(this))}else this.isReady()?(this.allowShaderHotSwapping=T,b&&b(this)):setTimeout(F,16);k.clipPlane&&(j.clipPlane=e)};F()}forceCompilationAsync(K,b){return new Promise(((e,z)=>{this.forceCompilation(K,(()=>{e()}),b,(K=>{z(K)}))}))}rg(K){this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism||(m._DirtyCallbackArray.length=0,K&m.TextureDirtyFlag&&m._DirtyCallbackArray.push(m._TextureDirtyCallBack),K&m.LightDirtyFlag&&m._DirtyCallbackArray.push(m._LightsDirtyCallBack),K&m.FresnelDirtyFlag&&m._DirtyCallbackArray.push(m._FresnelDirtyCallBack),K&m.AttributesDirtyFlag&&m._DirtyCallbackArray.push(m._AttributeDirtyCallBack),K&m.MiscDirtyFlag&&m._DirtyCallbackArray.push(m._MiscDirtyCallBack),K&m.PrePassDirtyFlag&&m._DirtyCallbackArray.push(m._PrePassDirtyCallBack),m._DirtyCallbackArray.length&&this._markAllSubMeshesAsDirty(m._RunDirtyCallBacks),this.va().resetCachedMaterial())}resetDrawCache(){const K=this.va().meshes;for(const b of K)if(b.Rf)for(const K of b.Rf)K.Ha()===this&&K.resetDrawCache()}_markAllSubMeshesAsDirty(K){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const b=this.va().meshes;for(const e of b)if(e.Rf)for(const b of e.Rf)if(b.Ha(!1)===this)for(const e of b._drawWrappers)e&&e.defines&&e.defines.markAllAsDirty&&this._materialContext===e.materialContext&&K(e.defines)}_markScenePrePassDirty(){if(this.va().blockMaterialDirtyMechanism||this._blockDirtyMechanism)return;const K=this.va().enablePrePassRenderer();K&&K.rg()}_markAllSubMeshesAsAllDirty(){this._markAllSubMeshesAsDirty(m._AllDirtyCallBack)}_markAllSubMeshesAsImageProcessingDirty(){this._markAllSubMeshesAsDirty(m._ImageProcessingDirtyCallBack)}_markAllSubMeshesAsTexturesDirty(){this._markAllSubMeshesAsDirty(m._TextureDirtyCallBack)}_markAllSubMeshesAsFresnelDirty(){this._markAllSubMeshesAsDirty(m._FresnelDirtyCallBack)}_markAllSubMeshesAsFresnelAndMiscDirty(){this._markAllSubMeshesAsDirty(m._FresnelAndMiscDirtyCallBack)}_markAllSubMeshesAsLightsDirty(){this._markAllSubMeshesAsDirty(m._LightsDirtyCallBack)}_markAllSubMeshesAsAttributesDirty(){this._markAllSubMeshesAsDirty(m._AttributeDirtyCallBack)}_markAllSubMeshesAsMiscDirty(){this._markAllSubMeshesAsDirty(m._MiscDirtyCallBack)}_markAllSubMeshesAsPrePassDirty(){this._markAllSubMeshesAsDirty(m._MiscDirtyCallBack)}_markAllSubMeshesAsTexturesAndMiscDirty(){this._markAllSubMeshesAsDirty(m._TextureAndMiscDirtyCallBack)}_checkScenePerformancePriority(){if(0!==this._scene.performancePriority){this.checkReadyOnlyOnce=!0;const K=this._scene.onScenePerformancePriorityChangedObservable.addOnce((()=>{this.checkReadyOnlyOnce=!1}));this.Ui.add((()=>{this._scene.onScenePerformancePriorityChangedObservable.remove(K)}))}}setPrePassRenderer(K){return!1}dispose(K,b,e){const z=this.va();if(z.stopAnimation(this),z.freeProcessedMaterials(),z.removeMaterial(this),this._eventInfo.forceDisposeTextures=b,this._callbackPluginEventGeneric(2,this._eventInfo),this._parentContainer){const K=this._parentContainer.materials.indexOf(this);K>-1&&this._parentContainer.materials.splice(K,1),this._parentContainer=null}if(!0!==e)if(this.meshMap)for(const k in this.meshMap){const b=this.meshMap[k];b&&(b.material=null,this.releaseVertexArrayObject(b,K))}else{const b=z.meshes;for(const e of b)e.material!==this||e.sourceMesh||(e.material=null,this.releaseVertexArrayObject(e,K))}this._uniformBuffer.dispose(),K&&this._drawWrapper.effect&&(this._storeEffectOnSubMeshes||this._drawWrapper.effect.dispose(),this._drawWrapper.effect=null),this.metadata=null,this.Ui.notifyObservers(this),this.Ui.clear(),this._onBindObservable&&this._onBindObservable.clear(),this._onUnBindObservable&&this._onUnBindObservable.clear(),this._onEffectCreatedObservable&&this._onEffectCreatedObservable.clear(),this._eventInfo&&(this._eventInfo={})}releaseVertexArrayObject(K,b){const e=K.mj;if(e)if(this._storeEffectOnSubMeshes){if(K.Rf)for(const z of K.Rf)e._releaseVertexArrayObject(z.effect),b&&z.effect&&z.effect.dispose()}else e._releaseVertexArrayObject(this._drawWrapper.effect)}serialize(){const K=U.e.Serialize(this);return K.stencil=this.stencil.serialize(),K.uniqueId=this.uniqueId,this._serializePlugins(K),K}_serializePlugins(K){if(K.plugins={},this.pluginManager)for(const b of this.pluginManager._plugins)K.plugins[b.getClassName()]=b.serialize()}static Parse(K,b,e){if(K.customType){if("BABYLON.PBRMaterial"===K.customType&&K.overloadedAlbedo&&(K.customType="BABYLON.LegacyPBRMaterial",!BABYLON.LegacyPBRMaterial))return A.b.Error("Your scene is trying to load a legacy version of the PBRMaterial, please, include it from the materials library."),null}else K.customType="BABYLON.StandardMaterial";const z=j.f.Instantiate(K.customType).Parse(K,b,e);return z._loadedUniqueId=K.uniqueId,z}static _ParsePlugins(K,b,e,z){if(K.plugins)for(const F in K.plugins){var k,T;const l=K.plugins[F];let Y=null===(k=b.pluginManager)||void 0===k?void 0:k.getPlugin(l.name);if(!Y){const K=j.f.Instantiate("BABYLON."+F);K&&(Y=new K(b))}null===(T=Y)||void 0===T||T.parse(l,e,z)}}}m.TriangleFillMode=0,m.WireFrameFillMode=1,m.PointFillMode=2,m.PointListDrawMode=3,m.LineListDrawMode=4,m.LineLoopDrawMode=5,m.LineStripDrawMode=6,m.TriangleStripDrawMode=7,m.TriangleFanDrawMode=8,m.ClockWiseSideOrientation=0,m.CounterClockWiseSideOrientation=1,m.TextureDirtyFlag=1,m.LightDirtyFlag=2,m.FresnelDirtyFlag=4,m.AttributesDirtyFlag=8,m.MiscDirtyFlag=16,m.PrePassDirtyFlag=32,m.AllDirtyFlag=63,m.MATERIAL_OPAQUE=0,m.MATERIAL_ALPHATEST=1,m.MATERIAL_ALPHABLEND=2,m.MATERIAL_ALPHATESTANDBLEND=3,m.MATERIAL_NORMALBLENDMETHOD_WHITEOUT=0,m.MATERIAL_NORMALBLENDMETHOD_RNM=1,m.OnEventObservable=new T.d,m._AllDirtyCallBack=K=>K.markAllAsDirty(),m._ImageProcessingDirtyCallBack=K=>K.markAsImageProcessingDirty(),m._TextureDirtyCallBack=K=>K.markAsTexturesDirty(),m._FresnelDirtyCallBack=K=>K.markAsFresnelDirty(),m._MiscDirtyCallBack=K=>K.markAsMiscDirty(),m._PrePassDirtyCallBack=K=>K.markAsPrePassDirty(),m._LightsDirtyCallBack=K=>K.markAsLightDirty(),m._AttributeDirtyCallBack=K=>K.markAsAttributesDirty(),m._FresnelAndMiscDirtyCallBack=K=>{m._FresnelDirtyCallBack(K),m._MiscDirtyCallBack(K)},m._TextureAndMiscDirtyCallBack=K=>{m._TextureDirtyCallBack(K),m._MiscDirtyCallBack(K)},m._DirtyCallbackArray=[],m._RunDirtyCallBacks=K=>{for(const b of m._DirtyCallbackArray)b(K)},(0,z.b)([(0,k.M)()],m.prototype,"id",void 0),(0,z.b)([(0,k.M)()],m.prototype,"uniqueId",void 0),(0,z.b)([(0,k.M)()],m.prototype,"name",void 0),(0,z.b)([(0,k.M)()],m.prototype,"metadata",void 0),(0,z.b)([(0,k.M)()],m.prototype,"checkReadyOnEveryCall",void 0),(0,z.b)([(0,k.M)()],m.prototype,"checkReadyOnlyOnce",void 0),(0,z.b)([(0,k.M)()],m.prototype,"state",void 0),(0,z.b)([(0,k.M)("alpha")],m.prototype,"_alpha",void 0),(0,z.b)([(0,k.M)("Lg")],m.prototype,"_backFaceCulling",void 0),(0,z.b)([(0,k.M)("cullBackFaces")],m.prototype,"_cullBackFaces",void 0),(0,z.b)([(0,k.M)()],m.prototype,"sideOrientation",void 0),(0,z.b)([(0,k.M)("alphaMode")],m.prototype,"_alphaMode",void 0),(0,z.b)([(0,k.M)()],m.prototype,"_needDepthPrePass",void 0),(0,z.b)([(0,k.M)()],m.prototype,"disableDepthWrite",void 0),(0,z.b)([(0,k.M)()],m.prototype,"disableColorWrite",void 0),(0,z.b)([(0,k.M)()],m.prototype,"forceDepthWrite",void 0),(0,z.b)([(0,k.M)()],m.prototype,"depthFunction",void 0),(0,z.b)([(0,k.M)()],m.prototype,"separateCullingPass",void 0),(0,z.b)([(0,k.M)("fogEnabled")],m.prototype,"_fogEnabled",void 0),(0,z.b)([(0,k.M)()],m.prototype,"pointSize",void 0),(0,z.b)([(0,k.M)()],m.prototype,"zOffset",void 0),(0,z.b)([(0,k.M)()],m.prototype,"zOffsetUnits",void 0),(0,z.b)([(0,k.M)()],m.prototype,"pointsCloud",null),(0,z.b)([(0,k.M)()],m.prototype,"fillMode",null),(0,z.b)([(0,k.M)()],m.prototype,"useLogarithmicDepth",null),(0,z.b)([(0,k.M)()],m.prototype,"transparencyMode",null)},11146:(K,b,e)=>{"use strict";e.d(b,{d:()=>z});class z{constructor(K){if(this._keys=[],this._isDirty=!0,this._areLightsDirty=!0,this._areLightsDisposed=!1,this._areAttributesDirty=!0,this._areTexturesDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!0,this._areImageProcessingDirty=!0,this._normals=!1,this._uvs=!1,this._needNormals=!1,this._needUVs=!1,this._externalProperties=K,K)for(const b in K)Object.prototype.hasOwnProperty.call(K,b)&&this._setDefaultValue(b)}get isDirty(){return this._isDirty}markAsProcessed(){this._isDirty=!1,this._areAttributesDirty=!1,this._areTexturesDirty=!1,this._areFresnelDirty=!1,this._areLightsDirty=!1,this._areLightsDisposed=!1,this._areMiscDirty=!1,this._arePrePassDirty=!1,this._areImageProcessingDirty=!1}markAsUnprocessed(){this._isDirty=!0}markAllAsDirty(){this._areTexturesDirty=!0,this._areAttributesDirty=!0,this._areLightsDirty=!0,this._areFresnelDirty=!0,this._areMiscDirty=!0,this._arePrePassDirty=!1,this._areImageProcessingDirty=!0,this._isDirty=!0}markAsImageProcessingDirty(){this._areImageProcessingDirty=!0,this._isDirty=!0}markAsLightDirty(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._areLightsDirty=!0,this._areLightsDisposed=this._areLightsDisposed||K,this._isDirty=!0}markAsAttributesDirty(){this._areAttributesDirty=!0,this._isDirty=!0}markAsTexturesDirty(){this._areTexturesDirty=!0,this._isDirty=!0}markAsFresnelDirty(){this._areFresnelDirty=!0,this._isDirty=!0}markAsMiscDirty(){this._areMiscDirty=!0,this._isDirty=!0}markAsPrePassDirty(){this._arePrePassDirty=!0,this._isDirty=!0}rebuild(){this._keys.length=0;for(const K of Object.keys(this))"_"!==K[0]&&this._keys.push(K);if(this._externalProperties)for(const K in this._externalProperties)-1===this._keys.indexOf(K)&&this._keys.push(K)}isEqual(K){if(this._keys.length!==K._keys.length)return!1;for(let b=0;b<this._keys.length;b++){const e=this._keys[b];if(this[e]!==K[e])return!1}return!0}cloneTo(K){this._keys.length!==K._keys.length&&(K._keys=this._keys.slice(0));for(let b=0;b<this._keys.length;b++){const e=this._keys[b];K[e]=this[e]}}reset(){this._keys.forEach((K=>this._setDefaultValue(K)))}_setDefaultValue(K){var b,e,z,k;const j=(null===(b=this._externalProperties)||void 0===b||null===(e=b[K])||void 0===e?void 0:e.type)??typeof this[K],T=null===(z=this._externalProperties)||void 0===z||null===(k=z[K])||void 0===k?void 0:k.default;switch(j){case"number":this[K]=T??0;break;case"string":this[K]=T??"";break;default:this[K]=T??!1}}toString(){let K="";for(let b=0;b<this._keys.length;b++){const e=this._keys[b],z=this[e];switch(typeof z){case"number":case"string":K+="#define "+e+" "+z+"\n";break;default:z&&(K+="#define "+e+"\n")}}return K}}},11194:(K,b,e)=>{"use strict";e.d(b,{c:()=>k});var z=e(10750);class k{static get DiffuseTextureEnabled(){return this._DiffuseTextureEnabled}static set DiffuseTextureEnabled(K){this._DiffuseTextureEnabled!==K&&(this._DiffuseTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get DetailTextureEnabled(){return this._DetailTextureEnabled}static set DetailTextureEnabled(K){this._DetailTextureEnabled!==K&&(this._DetailTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get DecalMapEnabled(){return this._DecalMapEnabled}static set DecalMapEnabled(K){this._DecalMapEnabled!==K&&(this._DecalMapEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get AmbientTextureEnabled(){return this._AmbientTextureEnabled}static set AmbientTextureEnabled(K){this._AmbientTextureEnabled!==K&&(this._AmbientTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get OpacityTextureEnabled(){return this._OpacityTextureEnabled}static set OpacityTextureEnabled(K){this._OpacityTextureEnabled!==K&&(this._OpacityTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get ReflectionTextureEnabled(){return this._ReflectionTextureEnabled}static set ReflectionTextureEnabled(K){this._ReflectionTextureEnabled!==K&&(this._ReflectionTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get EmissiveTextureEnabled(){return this._EmissiveTextureEnabled}static set EmissiveTextureEnabled(K){this._EmissiveTextureEnabled!==K&&(this._EmissiveTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get SpecularTextureEnabled(){return this._SpecularTextureEnabled}static set SpecularTextureEnabled(K){this._SpecularTextureEnabled!==K&&(this._SpecularTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get BumpTextureEnabled(){return this._BumpTextureEnabled}static set BumpTextureEnabled(K){this._BumpTextureEnabled!==K&&(this._BumpTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get LightmapTextureEnabled(){return this._LightmapTextureEnabled}static set LightmapTextureEnabled(K){this._LightmapTextureEnabled!==K&&(this._LightmapTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get RefractionTextureEnabled(){return this._RefractionTextureEnabled}static set RefractionTextureEnabled(K){this._RefractionTextureEnabled!==K&&(this._RefractionTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get ColorGradingTextureEnabled(){return this._ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(K){this._ColorGradingTextureEnabled!==K&&(this._ColorGradingTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get FresnelEnabled(){return this._FresnelEnabled}static set FresnelEnabled(K){this._FresnelEnabled!==K&&(this._FresnelEnabled=K,z.e.MarkAllMaterialsAsDirty(4))}static get ClearCoatTextureEnabled(){return this._ClearCoatTextureEnabled}static set ClearCoatTextureEnabled(K){this._ClearCoatTextureEnabled!==K&&(this._ClearCoatTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatBumpTextureEnabled(){return this._ClearCoatBumpTextureEnabled}static set ClearCoatBumpTextureEnabled(K){this._ClearCoatBumpTextureEnabled!==K&&(this._ClearCoatBumpTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get ClearCoatTintTextureEnabled(){return this._ClearCoatTintTextureEnabled}static set ClearCoatTintTextureEnabled(K){this._ClearCoatTintTextureEnabled!==K&&(this._ClearCoatTintTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get SheenTextureEnabled(){return this._SheenTextureEnabled}static set SheenTextureEnabled(K){this._SheenTextureEnabled!==K&&(this._SheenTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get AnisotropicTextureEnabled(){return this._AnisotropicTextureEnabled}static set AnisotropicTextureEnabled(K){this._AnisotropicTextureEnabled!==K&&(this._AnisotropicTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get ThicknessTextureEnabled(){return this._ThicknessTextureEnabled}static set ThicknessTextureEnabled(K){this._ThicknessTextureEnabled!==K&&(this._ThicknessTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get RefractionIntensityTextureEnabled(){return this._ThicknessTextureEnabled}static set RefractionIntensityTextureEnabled(K){this._RefractionIntensityTextureEnabled!==K&&(this._RefractionIntensityTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyIntensityTextureEnabled(){return this._TranslucencyIntensityTextureEnabled}static set TranslucencyIntensityTextureEnabled(K){this._TranslucencyIntensityTextureEnabled!==K&&(this._TranslucencyIntensityTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get TranslucencyColorTextureEnabled(){return this._TranslucencyColorTextureEnabled}static set TranslucencyColorTextureEnabled(K){this._TranslucencyColorTextureEnabled!==K&&(this._TranslucencyColorTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}static get IridescenceTextureEnabled(){return this._IridescenceTextureEnabled}static set IridescenceTextureEnabled(K){this._IridescenceTextureEnabled!==K&&(this._IridescenceTextureEnabled=K,z.e.MarkAllMaterialsAsDirty(1))}}k._DiffuseTextureEnabled=!0,k._DetailTextureEnabled=!0,k._DecalMapEnabled=!0,k._AmbientTextureEnabled=!0,k._OpacityTextureEnabled=!0,k._ReflectionTextureEnabled=!0,k._EmissiveTextureEnabled=!0,k._SpecularTextureEnabled=!0,k._BumpTextureEnabled=!0,k._LightmapTextureEnabled=!0,k._RefractionTextureEnabled=!0,k._ColorGradingTextureEnabled=!0,k._FresnelEnabled=!0,k._ClearCoatTextureEnabled=!0,k._ClearCoatBumpTextureEnabled=!0,k._ClearCoatTintTextureEnabled=!0,k._SheenTextureEnabled=!0,k._AnisotropicTextureEnabled=!0,k._ThicknessTextureEnabled=!0,k._RefractionIntensityTextureEnabled=!0,k._TranslucencyIntensityTextureEnabled=!0,k._TranslucencyColorTextureEnabled=!0,k._IridescenceTextureEnabled=!0},11129:(K,b,e)=>{"use strict";e.d(b,{B:()=>D,F:()=>G,G:()=>i,K:()=>X,N:()=>v,R:()=>c,S:()=>r,V:()=>u,W:()=>M,Z:()=>w,ab:()=>h,bb:()=>R,e:()=>I,fb:()=>P,gb:()=>t,h:()=>A,l:()=>Q,o:()=>Y,q:()=>U,u:()=>B,y:()=>m,z:()=>S});var z=e(10696),k=e(10994),j=e(10720),T=e(11079),F=e(11138);const l=k.c.Black();function Y(K,b,e){if(!K||K.LOGARITHMICDEPTH||K.indexOf&&K.indexOf("LOGARITHMICDEPTH")>=0){const K=e.activeCamera;1===K.mode&&z.b.Error("Logarithmic depth is not compatible with orthographic cameras!",20),b.setFloat("logarithmicDepthConstant",2/(Math.log(K.maxZ+1)/Math.LN2))}}function A(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e&&K.fogEnabled&&(!b||b.applyFog)&&0!==K.fogMode&&(e.setFloat4("vFogInfos",K.fogMode,K.fogStart,K.fogEnd,K.fogDensity),z?(K.fogColor.toLinearSpaceToRef(l,K.getEngine().useExactSrgbConversions),e.setColor3("vFogColor",l)):e.setColor3("vFogColor",K.fogColor))}function X(K,b,e){const k=e.NUM_MORPH_INFLUENCERS;if(k>0&&j.b.LastCreatedEngine){const T=j.b.LastCreatedEngine.getCaps().maxVertexAttribs,F=b.morphTargetManager;if(null!==F&&void 0!==F&&F.isUsingTextureForTargets)return;const l=F&&F.supportsNormals&&e.NORMAL,Y=F&&F.supportsTangents&&e.TANGENT,A=F&&F.supportsUVs&&e.UV1;for(let e=0;e<k;e++)K.push("position"+e),l&&K.push("normal"+e),Y&&K.push("tangent"+e),A&&K.push("uv_"+e),K.length>T&&z.b.Error("Cannot add more vertex attributes for mesh "+b.name)}}function t(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K.push("world0"),K.push("world1"),K.push("world2"),K.push("world3"),b&&(K.push("previousWorld0"),K.push("previousWorld1"),K.push("previousWorld2"),K.push("previousWorld3"))}function U(K,b){const e=K.morphTargetManager;K&&e&&b.setFloatArray("morphTargetInfluences",e.influences)}function B(K,b){b.bindToEffect(K,"Scene")}function u(K,b,e){b._needUVs=!0,b[e]=!0,K.optimizeUVAllocation&&K.getTextureMatrix().isIdentityAs3x2()?(b[e+"DIRECTUV"]=K.coordinatesIndex+1,b["MAINUV"+(K.coordinatesIndex+1)]=!0):b[e+"DIRECTUV"]=0}function m(K,b,e){const z=K.getTextureMatrix();b.qj(e+"Matrix",z)}function D(K,b,e){e.BAKED_VERTEX_ANIMATION_TEXTURE&&e.INSTANCES&&K.push("bakedVertexAnimationSettingsInstanced")}function I(K,b,e){var z;if(b&&K&&(K.computeBonesUsingShaders&&b._bonesComputationForcedToCPU&&(K.computeBonesUsingShaders=!1),K.useBones&&K.computeBonesUsingShaders&&K.skeleton)){const k=K.skeleton;if(k.isUsingTextureForMatrices&&b.getUniformIndex("boneTextureWidth")>-1){const e=k.getTransformMatrixTexture(K);b.setTexture("boneSampler",e),b.setFloat("boneTextureWidth",4*(k.bones.length+1))}else{const j=k.getTransformMatrices(K);j&&(b.setMatrices("mBones",j),e&&K.va().prePassRenderer&&K.va().prePassRenderer.getIndex(2)&&(e.previousBones[K.uniqueId]||(e.previousBones[K.uniqueId]=j.slice()),b.setMatrices("mPreviousBones",e.previousBones[K.uniqueId]),z=j,e.previousBones[K.uniqueId].set(z)))}}}function x(K,b,e,z,k){let j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];K._bindLight(b,e,z,k,j)}function Q(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;const j=Math.min(b.lightSources.length,k);for(let T=0;T<j;T++){x(b.lightSources[T],T,K,e,"boolean"===typeof z?z:z.SPECULARTERM,b.receiveShadows)}}function G(K,b,e,z){e.NUM_BONE_INFLUENCERS>0&&(z.addCPUSkinningFallback(0,b),K.push("matricesIndices"),K.push("matricesWeights"),e.NUM_BONE_INFLUENCERS>4&&(K.push("matricesIndicesExtra"),K.push("matricesWeightsExtra")))}function i(K,b){(b.INSTANCES||b.THIN_INSTANCES)&&t(K,!!b.PREPASS_VELOCITY),b.INSTANCESCOLOR&&K.push("instanceColor")}function S(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=0;for(let j=0;j<e&&K["LIGHT"+j];j++)j>0&&(k=z+j,b.addFallback(k,"LIGHT"+j)),K.SHADOWS||(K["SHADOW"+j]&&b.addFallback(z,"SHADOW"+j),K["SHADOWPCF"+j]&&b.addFallback(z,"SHADOWPCF"+j),K["SHADOWPCSS"+j]&&b.addFallback(z,"SHADOWPCSS"+j),K["SHADOWPOISSON"+j]&&b.addFallback(z,"SHADOWPOISSON"+j),K["SHADOWESM"+j]&&b.addFallback(z,"SHADOWESM"+j),K["SHADOWCLOSEESM"+j]&&b.addFallback(z,"SHADOWCLOSEESM"+j));return k++}function M(K,b,e,z,k,j,T){let F=arguments.length>7&&void 0!==arguments[7]&&arguments[7];T._areMiscDirty&&(T.LOGARITHMICDEPTH=e,T.POINTSIZE=z,T.FOG=k&&function(K,b){return b.fogEnabled&&K.applyFog&&0!==b.fogMode}(K,b),T.NONUNIFORMSCALING=K.nonUniformScaling,T.ALPHATEST=j,T.DECAL_AFTER_DETAIL=F)}function r(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(!e._areLightsDirty)return e._needNormals;let T=0;const F={needNormals:e._needNormals,needRebuild:!1,lightmapMode:!1,shadowEnabled:!1,specularEnabled:!1};if(K.lightsEnabled&&!j)for(const Y of b.lightSources)if(L(K,b,Y,T,e,z,F),T++,T===k)break;e.SPECULARTERM=F.specularEnabled,e.SHADOWS=F.shadowEnabled;for(let Y=T;Y<k;Y++)void 0!==e["LIGHT"+Y]&&(e["LIGHT"+Y]=!1,e["HEMILIGHT"+Y]=!1,e["POINTLIGHT"+Y]=!1,e["DIRLIGHT"+Y]=!1,e["SPOTLIGHT"+Y]=!1,e["SHADOW"+Y]=!1,e["SHADOWCSM"+Y]=!1,e["SHADOWCSMDEBUG"+Y]=!1,e["SHADOWCSMNUM_CASCADES"+Y]=!1,e["SHADOWCSMUSESHADOWMAXZ"+Y]=!1,e["SHADOWCSMNOBLEND"+Y]=!1,e["SHADOWCSM_RIGHTHANDED"+Y]=!1,e["SHADOWPCF"+Y]=!1,e["SHADOWPCSS"+Y]=!1,e["SHADOWPOISSON"+Y]=!1,e["SHADOWESM"+Y]=!1,e["SHADOWCLOSEESM"+Y]=!1,e["SHADOWCUBE"+Y]=!1,e["SHADOWLOWQUALITY"+Y]=!1,e["SHADOWMEDIUMQUALITY"+Y]=!1);const l=K.getEngine().getCaps();return void 0===e.SHADOWFLOAT&&(F.needRebuild=!0),e.SHADOWFLOAT=F.shadowEnabled&&(l.textureFloatRender&&l.textureFloatLinearFiltering||l.textureHalfFloatRender&&l.textureHalfFloatLinearFiltering),e.LIGHTMAPEXCLUDED=F.lightmapMode,F.needRebuild&&e.rebuild(),F.needNormals}function L(K,b,e,z,k,j,F){switch(F.needNormals=!0,void 0===k["LIGHT"+z]&&(F.needRebuild=!0),k["LIGHT"+z]=!0,k["SPOTLIGHT"+z]=!1,k["HEMILIGHT"+z]=!1,k["POINTLIGHT"+z]=!1,k["DIRLIGHT"+z]=!1,e.prepareLightSpecificDefines(k,z),k["LIGHT_FALLOFF_PHYSICAL"+z]=!1,k["LIGHT_FALLOFF_GLTF"+z]=!1,k["LIGHT_FALLOFF_STANDARD"+z]=!1,e.falloffType){case T.c.FALLOFF_GLTF:k["LIGHT_FALLOFF_GLTF"+z]=!0;break;case T.c.FALLOFF_PHYSICAL:k["LIGHT_FALLOFF_PHYSICAL"+z]=!0;break;case T.c.FALLOFF_STANDARD:k["LIGHT_FALLOFF_STANDARD"+z]=!0}if(j&&!e.ah.equalsFloats(0,0,0)&&(F.specularEnabled=!0),k["SHADOW"+z]=!1,k["SHADOWCSM"+z]=!1,k["SHADOWCSMDEBUG"+z]=!1,k["SHADOWCSMNUM_CASCADES"+z]=!1,k["SHADOWCSMUSESHADOWMAXZ"+z]=!1,k["SHADOWCSMNOBLEND"+z]=!1,k["SHADOWCSM_RIGHTHANDED"+z]=!1,k["SHADOWPCF"+z]=!1,k["SHADOWPCSS"+z]=!1,k["SHADOWPOISSON"+z]=!1,k["SHADOWESM"+z]=!1,k["SHADOWCLOSEESM"+z]=!1,k["SHADOWCUBE"+z]=!1,k["SHADOWLOWQUALITY"+z]=!1,k["SHADOWMEDIUMQUALITY"+z]=!1,b&&b.receiveShadows&&K.shadowsEnabled&&e.shadowEnabled){const b=e.getShadowGenerator(K.activeCamera)??e.getShadowGenerator();if(b){const K=b.getShadowMap();K&&K.renderList&&K.renderList.length>0&&(F.shadowEnabled=!0,b.prepareDefines(k,z))}}e.lightmapMode!=T.c.LIGHTMAP_DEFAULT?(F.lightmapMode=!0,k["LIGHTMAPEXCLUDED"+z]=!0,k["LIGHTMAPNOSPECULAR"+z]=e.lightmapMode==T.c.LIGHTMAP_SHADOWSONLY):(k["LIGHTMAPEXCLUDED"+z]=!1,k["LIGHTMAPNOSPECULAR"+z]=!1)}function c(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=function(K,b){let e=!1;if(K.activeCamera){const z=b.CAMERA_ORTHOGRAPHIC?1:0,k=b.CAMERA_PERSPECTIVE?1:0,j=1===K.activeCamera.mode?1:0,T=0===K.activeCamera.mode?1:0;(z^j||k^T)&&(b.CAMERA_ORTHOGRAPHIC=1===j,b.CAMERA_PERSPECTIVE=1===T,e=!0)}return e}(K,z);!1!==j&&(l=(0,F.f)(e,K,z)),z.DEPTHPREPASS!==!b.getColorWrite()&&(z.DEPTHPREPASS=!z.DEPTHPREPASS,l=!0),z.INSTANCES!==k&&(z.INSTANCES=k,l=!0),z.THIN_INSTANCES!==T&&(z.THIN_INSTANCES=T,l=!0),l&&z.markAsUnprocessed()}function v(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];if(!b._areAttributesDirty&&b._needNormals===b._normals&&b._needUVs===b._uvs)return!1;b._normals=b._needNormals,b._uvs=b._needUVs,b.NORMAL=b._needNormals&&K.isVerticesDataPresent("normal"),b._needNormals&&K.isVerticesDataPresent("tangent")&&(b.TANGENT=!0);for(let F=1;F<=6;++F)b["UV"+F]=!!b._needUVs&&K.isVerticesDataPresent(`uv${1===F?"":F}`);if(e){const e=K.useVertexColors&&K.isVerticesDataPresent("color");b.VERTEXCOLOR=e,b.VERTEXALPHA=K.hasVertexAlpha&&e&&j}return K.isVerticesDataPresent("instanceColor")&&(K.hasInstances||K.hasThinInstances)&&(b.INSTANCESCOLOR=!0),z&&function(K,b){if(K.useBones&&K.computeBonesUsingShaders&&K.skeleton){b.NUM_BONE_INFLUENCERS=K.numBoneInfluencers;const e=void 0!==b.BONETEXTURE;if(K.skeleton.isUsingTextureForMatrices&&e)b.BONETEXTURE=!0;else{b.BonesPerMesh=K.skeleton.bones.length+1,b.BONETEXTURE=!e&&void 0;const z=K.va().prePassRenderer;if(z&&z.enabled){const e=-1===z.excludedSkinnedMesh.indexOf(K);b.BONES_VELOCITY_ENABLED=e}}}else b.NUM_BONE_INFLUENCERS=0,b.BonesPerMesh=0,void 0!==b.BONETEXTURE&&(b.BONETEXTURE=!1)}(K,b),k&&function(K,b){const e=K.morphTargetManager;e?(b.MORPHTARGETS_UV=e.supportsUVs&&b.UV1,b.MORPHTARGETS_TANGENT=e.supportsTangents&&b.TANGENT,b.MORPHTARGETS_NORMAL=e.supportsNormals&&b.NORMAL,b.NUM_MORPH_INFLUENCERS=e.numMaxInfluencers||e.numInfluencers,b.MORPHTARGETS=b.NUM_MORPH_INFLUENCERS>0,b.MORPHTARGETS_TEXTURE=e.isUsingTextureForTargets):(b.MORPHTARGETS_UV=!1,b.MORPHTARGETS_TANGENT=!1,b.MORPHTARGETS_NORMAL=!1,b.MORPHTARGETS=!1,b.NUM_MORPH_INFLUENCERS=0)}(K,b),T&&function(K,b){const e=K.bakedVertexAnimationManager;b.BAKED_VERTEX_ANIMATION_TEXTURE=!(!e||!e.isEnabled)}(K,b),!0}function w(K,b){if(K.activeCamera){const e=b.MULTIVIEW;b.MULTIVIEW=null!==K.activeCamera.outputRenderTarget&&K.activeCamera.outputRenderTarget.getViewCount()>1,b.MULTIVIEW!=e&&b.markAsUnprocessed()}}function h(K,b,e){const z=b.ORDER_INDEPENDENT_TRANSPARENCY,k=b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS;b.ORDER_INDEPENDENT_TRANSPARENCY=K.useOrderIndependentTransparency&&e,b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!K.getEngine().getCaps().textureFloatLinearFiltering,z===b.ORDER_INDEPENDENT_TRANSPARENCY&&k===b.ORDER_INDEPENDENT_TRANSPARENCY_16BITS||b.markAsUnprocessed()}function R(K,b,e){const z=b.PREPASS;if(!b._arePrePassDirty)return;const k=[{type:1,define:"PREPASS_POSITION",index:"PREPASS_POSITION_INDEX"},{type:9,define:"PREPASS_LOCAL_POSITION",index:"PREPASS_LOCAL_POSITION_INDEX"},{type:2,define:"PREPASS_VELOCITY",index:"PREPASS_VELOCITY_INDEX"},{type:11,define:"PREPASS_VELOCITY_LINEAR",index:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:3,define:"PREPASS_REFLECTIVITY",index:"PREPASS_REFLECTIVITY_INDEX"},{type:0,define:"PREPASS_IRRADIANCE",index:"PREPASS_IRRADIANCE_INDEX"},{type:7,define:"PREPASS_ALBEDO_SQRT",index:"PREPASS_ALBEDO_SQRT_INDEX"},{type:5,define:"PREPASS_DEPTH",index:"PREPASS_DEPTH_INDEX"},{type:10,define:"PREPASS_SCREENSPACE_DEPTH",index:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:6,define:"PREPASS_NORMAL",index:"PREPASS_NORMAL_INDEX"},{type:8,define:"PREPASS_WORLD_NORMAL",index:"PREPASS_WORLD_NORMAL_INDEX"}];if(K.prePassRenderer&&K.prePassRenderer.enabled&&e){b.PREPASS=!0,b.SCENE_MRT_COUNT=K.prePassRenderer.mrtCount,b.PREPASS_NORMAL_WORLDSPACE=K.prePassRenderer.generateNormalsInWorldSpace,b.PREPASS_COLOR=!0,b.PREPASS_COLOR_INDEX=0;for(let e=0;e<k.length;e++){const z=K.prePassRenderer.getIndex(k[e].type);-1!==z?(b[k[e].define]=!0,b[k[e].index]=z):b[k[e].define]=!1}}else{b.PREPASS=!1;for(let K=0;K<k.length;K++)b[k[K].define]=!1}b.PREPASS!=z&&(b.markAsUnprocessed(),b.markAsImageProcessingDirty())}function n(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];k&&k.push("Light"+K),j||(b.push("vLightData"+K,"vLightDiffuse"+K,"vLightSpecular"+K,"vLightDirection"+K,"vLightFalloff"+K,"vLightGround"+K,"lightMatrix"+K,"shadowsInfo"+K,"depthValues"+K),e.push("shadowTexture"+K),e.push("depthTexture"+K),b.push("viewFrustumZ"+K,"cascadeBlendFactor"+K,"lightSizeUVCorrection"+K,"depthCorrection"+K,"penumbraDarkness"+K,"frustumLengths"+K),z&&(e.push("projectionLightTexture"+K),b.push("textureProjectionMatrix"+K)))}function P(K,b,e){let z,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,j=null;if(K.uniformsNames){const T=K;z=T.uniformsNames,j=T.uniformBuffersNames,b=T.samplers,e=T.defines,k=T.maxSimultaneousLights||0}else z=K,b||(b=[]);for(let T=0;T<k&&e["LIGHT"+T];T++)n(T,z,b,e["PROJECTEDLIGHTTEXTURE"+T],j);e.NUM_MORPH_INFLUENCERS&&(z.push("morphTargetInfluences"),z.push("morphTargetCount")),e.BAKED_VERTEX_ANIMATION_TEXTURE&&(z.push("bakedVertexAnimationSettings"),z.push("bakedVertexAnimationTextureSizeInverted"),z.push("bakedVertexAnimationTime"),b.push("bakedVertexAnimationTexture"))}},11224:(K,b,e)=>{"use strict";e.d(b,{e:()=>j});var z,k=e(10967);!function(K){K[K.Zero=0]="Zero",K[K.One=1]="One",K[K.MaxViewZ=2]="MaxViewZ"}(z||(z={}));class j{static CreateConfiguration(K){return j._Configurations[K]={defines:{},previousWorldMatrices:{},previousViewProjection:k.b.Zero(),currentViewProjection:k.b.Zero(),previousBones:{},lastUpdateFrameId:-1,excludedSkinnedMesh:[]},j._Configurations[K]}static DeleteConfiguration(K){delete j._Configurations[K]}static GetConfiguration(K){return j._Configurations[K]}static AddUniformsAndSamplers(K,b){K.push("previousWorld","previousViewProjection","mPreviousBones")}static MarkAsDirty(K,b){for(const e of b)if(e.Rf)for(const b of e.Rf)b._removeDrawWrapper(K)}static PrepareDefines(K,b,e){if(!e._arePrePassDirty)return;const z=j._Configurations[K];if(!z)return;e.PREPASS=!0,e.PREPASS_COLOR=!1,e.PREPASS_COLOR_INDEX=-1;let k=0;for(let T=0;T<j.GeometryTextureDescriptions.length;T++){const K=j.GeometryTextureDescriptions[T],b=K.define,F=K.defineIndex,l=z.defines[F];void 0!==l?(e[b]=!0,e[F]=l,k++):(e[b]=!1,delete e[F])}e.SCENE_MRT_COUNT=k,e.BONES_VELOCITY_ENABLED=b.useBones&&b.computeBonesUsingShaders&&b.skeleton&&!b.skeleton.isUsingTextureForMatrices&&-1===z.excludedSkinnedMesh.indexOf(b)}static Bind(K,b,e,z){const k=j._Configurations[K];if(k&&(void 0!==k.defines.PREPASS_VELOCITY_INDEX||void 0!==k.defines.PREPASS_VELOCITY_LINEAR_INDEX)){k.previousWorldMatrices[e.uniqueId]||(k.previousWorldMatrices[e.uniqueId]=z.clone());const K=e.va();k.previousViewProjection||(k.previousViewProjection=K.getTransformMatrix().clone(),k.currentViewProjection=K.getTransformMatrix().clone());const j=K.getEngine();if(k.currentViewProjection.updateFlag!==K.getTransformMatrix().updateFlag?(k.lastUpdateFrameId=j.frameId,k.previousViewProjection.p(k.currentViewProjection),k.currentViewProjection.p(K.getTransformMatrix())):k.lastUpdateFrameId!==j.frameId&&(k.lastUpdateFrameId=j.frameId,k.previousViewProjection.p(k.currentViewProjection)),b.setMatrix("previousWorld",k.previousWorldMatrices[e.uniqueId]),b.setMatrix("previousViewProjection",k.previousViewProjection),k.previousWorldMatrices[e.uniqueId]=z.clone(),e.useBones&&e.computeBonesUsingShaders&&e.skeleton){const K=e.skeleton;if(!K.isUsingTextureForMatrices||-1===b.getUniformIndex("boneTextureWidth")){const z=K.getTransformMatrices(e);z&&(k.previousBones[e.uniqueId]||(k.previousBones[e.uniqueId]=z.slice()),b.setMatrices("mPreviousBones",k.previousBones[e.uniqueId]),k.previousBones[e.uniqueId].set(z))}}}}}j.GeometryTextureDescriptions=[{type:0,name:"Irradiance",clearType:0,define:"PREPASS_IRRADIANCE",defineIndex:"PREPASS_IRRADIANCE_INDEX"},{type:1,name:"WorldPosition",clearType:0,define:"PREPASS_POSITION",defineIndex:"PREPASS_POSITION_INDEX"},{type:2,name:"Velocity",clearType:0,define:"PREPASS_VELOCITY",defineIndex:"PREPASS_VELOCITY_INDEX"},{type:3,name:"Reflectivity",clearType:0,define:"PREPASS_REFLECTIVITY",defineIndex:"PREPASS_REFLECTIVITY_INDEX"},{type:5,name:"ViewDepth",clearType:2,define:"PREPASS_DEPTH",defineIndex:"PREPASS_DEPTH_INDEX"},{type:6,name:"ViewNormal",clearType:0,define:"PREPASS_NORMAL",defineIndex:"PREPASS_NORMAL_INDEX"},{type:7,name:"AlbedoSqrt",clearType:0,define:"PREPASS_ALBEDO_SQRT",defineIndex:"PREPASS_ALBEDO_SQRT_INDEX"},{type:8,name:"WorldNormal",clearType:0,define:"PREPASS_WORLD_NORMAL",defineIndex:"PREPASS_WORLD_NORMAL_INDEX"},{type:9,name:"LocalPosition",clearType:0,define:"PREPASS_LOCAL_POSITION",defineIndex:"PREPASS_LOCAL_POSITION_INDEX"},{type:10,name:"ScreenDepth",clearType:1,define:"PREPASS_SCREENSPACE_DEPTH",defineIndex:"PREPASS_SCREENSPACE_DEPTH_INDEX"},{type:11,name:"LinearVelocity",clearType:0,define:"PREPASS_VELOCITY_LINEAR",defineIndex:"PREPASS_VELOCITY_LINEAR_INDEX"},{type:12,name:"Albedo",clearType:0,define:"PREPASS_ALBEDO",defineIndex:"PREPASS_ALBEDO_INDEX"}],j._Configurations={}},11215:(K,b,e)=>{"use strict";e.d(b,{b:()=>D});var z=e(10936),k=e(10938),j=e(11085),T=e(10720),F=e(10736),l=e(10764);const Y=new RegExp("^([gimus]+)!");class A{constructor(K){this._plugins=[],this._activePlugins=[],this._activePluginsForExtraEvents=[],this._material=K,this._scene=K.va(),this._engine=this._scene.getEngine()}_addPlugin(K){for(let z=0;z<this._plugins.length;++z)if(this._plugins[z].name===K.name)return!1;if(this._material._uniformBufferLayoutBuilt&&(this._material.resetDrawCache(),this._material._createUniformBuffer()),!K.isCompatible(this._material.shaderLanguage))throw`The plugin "${K.name}" can't be added to the material "${this._material.name}" because the plugin is not compatible with the shader language of the material.`;const b=K.getClassName();A._MaterialPluginClassToMainDefine[b]||(A._MaterialPluginClassToMainDefine[b]="MATERIALPLUGIN_"+ ++A._MaterialPluginCounter),this._material._callbackPluginEventGeneric=(K,b)=>this._handlePluginEvent(K,b),this._plugins.push(K),this._plugins.sort(((K,b)=>K.priority-b.priority)),this._codeInjectionPoints={};const e={};e[A._MaterialPluginClassToMainDefine[b]]={type:"boolean",default:!0};for(const z of this._plugins)z.collectDefines(e),this._collectPointNames("vertex",z.getCustomCode("vertex",this._material.shaderLanguage)),this._collectPointNames("fragment",z.getCustomCode("fragment",this._material.shaderLanguage));return this._defineNamesFromPlugins=e,!0}_activatePlugin(K){-1===this._activePlugins.indexOf(K)&&(this._activePlugins.push(K),this._activePlugins.sort(((K,b)=>K.priority-b.priority)),this._material._callbackPluginEventIsReadyForSubMesh=this._handlePluginEventIsReadyForSubMesh.bind(this),this._material._callbackPluginEventPrepareDefinesBeforeAttributes=this._handlePluginEventPrepareDefinesBeforeAttributes.bind(this),this._material._callbackPluginEventPrepareDefines=this._handlePluginEventPrepareDefines.bind(this),this._material._callbackPluginEventBindForSubMesh=this._handlePluginEventBindForSubMesh.bind(this),K.registerForExtraEvents&&(this._activePluginsForExtraEvents.push(K),this._activePluginsForExtraEvents.sort(((K,b)=>K.priority-b.priority)),this._material._callbackPluginEventHasRenderTargetTextures=this._handlePluginEventHasRenderTargetTextures.bind(this),this._material._callbackPluginEventFillRenderTargetTextures=this._handlePluginEventFillRenderTargetTextures.bind(this),this._material._callbackPluginEventHardBindForSubMesh=this._handlePluginEventHardBindForSubMesh.bind(this)))}getPlugin(K){for(let b=0;b<this._plugins.length;++b)if(this._plugins[b].name===K)return this._plugins[b];return null}_handlePluginEventIsReadyForSubMesh(K){let b=!0;for(const e of this._activePlugins)b=b&&e.isReadyForSubMesh(K.defines,this._scene,this._engine,K.subMesh);K.isReadyForSubMesh=b}_handlePluginEventPrepareDefinesBeforeAttributes(K){for(const b of this._activePlugins)b.prepareDefinesBeforeAttributes(K.defines,this._scene,K.mesh)}_handlePluginEventPrepareDefines(K){for(const b of this._activePlugins)b.prepareDefines(K.defines,this._scene,K.mesh)}_handlePluginEventHardBindForSubMesh(K){for(const b of this._activePluginsForExtraEvents)b.hardBindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,K.subMesh)}_handlePluginEventBindForSubMesh(K){for(const b of this._activePlugins)b.bindForSubMesh(this._material._uniformBuffer,this._scene,this._engine,K.subMesh)}_handlePluginEventHasRenderTargetTextures(K){let b=!1;for(const e of this._activePluginsForExtraEvents)if(b=e.hasRenderTargetTextures(),b)break;K.hasRenderTargetTextures=b}_handlePluginEventFillRenderTargetTextures(K){for(const b of this._activePluginsForExtraEvents)b.fillRenderTargetTextures(K.renderTargets)}_handlePluginEvent(K,b){switch(K){case 512:{const K=b;for(const b of this._activePlugins)b.getActiveTextures(K.activeTextures);break}case 256:{const K=b;for(const b of this._activePlugins)b.getAnimatables(K.animatables);break}case 1024:{const K=b;let e=!1;for(const b of this._activePlugins)if(e=b.hasTexture(K.texture),e)break;K.hasTexture=e;break}case 2:{const K=b;for(const b of this._plugins)b.dispose(K.forceDisposeTextures);break}case 4:b.defineNames=this._defineNamesFromPlugins;break;case 128:{const K=b;for(const b of this._activePlugins)K.fallbackRank=b.addFallbacks(K.defines,K.fallbacks,K.fallbackRank),b.getAttributes(K.attributes,this._scene,K.mesh);this._uniformList.length>0&&K.uniforms.push(...this._uniformList),this._samplerList.length>0&&K.samplers.push(...this._samplerList),this._uboList.length>0&&K.uniformBuffersNames.push(...this._uboList),K.customCode=this._injectCustomCode(K,K.customCode);break}case 8:{const K=b;this._uboDeclaration="",this._vertexDeclaration="",this._fragmentDeclaration="",this._uniformList=[],this._samplerList=[],this._uboList=[];const e=1===this._material.shaderLanguage;for(const b of this._plugins){const z=b.getUniforms(this._material.shaderLanguage);if(z){if(z.ubo)for(const b of z.ubo){if(b.size&&b.type){const z=b.arraySize??0;if(K.ubo.addUniform(b.name,b.size,z),e){let K;switch(b.type){case"mat4":K="mat4x4f";break;case"float":K="f32";break;default:K=`${b.type}f`}this._uboDeclaration+=`uniform ${b.name}: ${K}${z>0?`[${z}]`:""};\n`}else this._uboDeclaration+=`${b.type} ${b.name}${z>0?`[${z}]`:""};\n`}this._uniformList.push(b.name)}z.vertex&&(this._vertexDeclaration+=z.vertex+"\n"),z.fragment&&(this._fragmentDeclaration+=z.fragment+"\n")}b.getSamplers(this._samplerList),b.getUniformBuffersNames(this._uboList)}break}}}_collectPointNames(K,b){if(b)for(const e in b)this._codeInjectionPoints[K]||(this._codeInjectionPoints[K]={}),this._codeInjectionPoints[K][e]=!0}_injectCustomCode(K,b){return(e,z)=>{var k;b&&(z=b(e,z)),this._uboDeclaration&&(z=z.replace("#define ADDITIONAL_UBO_DECLARATION",this._uboDeclaration)),this._vertexDeclaration&&(z=z.replace("#define ADDITIONAL_VERTEX_DECLARATION",this._vertexDeclaration)),this._fragmentDeclaration&&(z=z.replace("#define ADDITIONAL_FRAGMENT_DECLARATION",this._fragmentDeclaration));const j=null===(k=this._codeInjectionPoints)||void 0===k?void 0:k[e];if(!j)return z;let T=null;for(let b in j){let k="";for(const z of this._activePlugins){var A;let j=null===(A=z.getCustomCode(e,this._material.shaderLanguage))||void 0===A?void 0:A[b];if(j){if(z.resolveIncludes){if(null===T){const b=0;T={defines:[],indexParameters:K.indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:void 0,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:l.d.GetShadersRepository(b),includesShadersStore:l.d.GetIncludesShadersStore(b),version:void 0,platformName:this._engine.shaderPlatformName,processingContext:void 0,isNDCHalfZRange:this._engine.isNDCHalfZRange,useReverseDepthBuffer:this._engine.useReverseDepthBuffer,processCodeAfterIncludes:void 0}}T.isFragment="fragment"===e,(0,F.l)(j,T,(K=>j=K))}k+=j+"\n"}}if(k.length>0)if("!"===b.charAt(0)){b=b.substring(1);let K="g";if("!"===b.charAt(0))K="",b=b.substring(1);else{const e=Y.exec(b);e&&e.length>=2&&(K=e[1],b=b.substring(K.length+1))}K.indexOf("g")<0&&(K+="g");const e=z,j=new RegExp(b,K);let T=j.exec(e);for(;null!==T;){let K=k;for(let b=0;b<T.length;++b)K=K.replace("$"+b,T[b]);z=z.replace(T[0],K),T=j.exec(e)}}else{const K="#define "+b;z=z.replace(K,"\n"+k+"\n"+K)}}return z}}}A._MaterialPluginClassToMainDefine={},A._MaterialPluginCounter=0,T.b.OnEnginesDisposedObservable.add((()=>{B()}));const X=[];let t=!1,U=null;function B(){X.length=0,t=!1,j.b.OnEventObservable.remove(U),U=null}var u=e(11001),m=e(10799);class D{isCompatible(K){return 0===K}_enable(K){K&&this._pluginManager._activatePlugin(this)}constructor(K,b,e,z){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this.priority=500,this.resolveIncludes=!1,this.registerForExtraEvents=!1,this._material=K,this.name=b,this.priority=e,this.resolveIncludes=T,K.pluginManager||(K.pluginManager=new A(K),K.Ui.add((()=>{K.pluginManager=void 0}))),this._pluginDefineNames=z,this._pluginManager=K.pluginManager,k&&this._pluginManager._addPlugin(this),j&&this._enable(!0),this.markAllDefinesAsDirty=K._dirtyCallbacks[63]}getClassName(){return"MaterialPluginBase"}isReadyForSubMesh(K,b,e,z){return!0}hardBindForSubMesh(K,b,e,z){}bindForSubMesh(K,b,e,z){}dispose(K){}getCustomCode(K){return null}collectDefines(K){if(this._pluginDefineNames)for(const b of Object.keys(this._pluginDefineNames)){if("_"===b[0])continue;const e=typeof this._pluginDefineNames[b];K[b]={type:"number"===e?"number":"string"===e?"string":"boolean"===e?"boolean":"object",default:this._pluginDefineNames[b]}}}prepareDefinesBeforeAttributes(K,b,e){}prepareDefines(K,b,e){}hasTexture(K){return!1}hasRenderTargetTextures(){return!1}fillRenderTargetTextures(K){}getActiveTextures(K){}getAnimatables(K){}addFallbacks(K,b,e){return e}getSamplers(K){}getAttributes(K,b,e){}getUniformBuffersNames(K){}getUniforms(){return{}}copyTo(K){u.e.Clone((()=>K),this)}serialize(){return u.e.Serialize(this)}parse(K,b,e){u.e.Parse((()=>this),K,b,e)}}(0,z.b)([(0,k.M)()],D.prototype,"name",void 0),(0,z.b)([(0,k.M)()],D.prototype,"priority",void 0),(0,z.b)([(0,k.M)()],D.prototype,"resolveIncludes",void 0),(0,z.b)([(0,k.M)()],D.prototype,"registerForExtraEvents",void 0),(0,m.e)("BABYLON.MaterialPluginBase",D)},11294:(K,b,e)=>{"use strict";e.d(b,{b:()=>T});var z=e(11085),k=e(10963),j=e(10799);class T extends z.b{get Tf(){return this._subMaterials}set Tf(K){this._subMaterials=K,this._hookArray(K)}getChildren(){return this.Tf}constructor(K,b){super(K,b,!0),this._waitingSubMaterialsUniqueIds=[],this.va().addMultiMaterial(this),this.Tf=[],this._storeEffectOnSubMeshes=!0}_hookArray(K){var b=this;const e=K.push;K.push=function(){for(var z=arguments.length,k=new Array(z),j=0;j<z;j++)k[j]=arguments[j];const T=e.apply(K,k);return b._markAllSubMeshesAsTexturesDirty(),T};const z=K.splice;K.splice=(b,e)=>{const k=z.apply(K,[b,e]);return this._markAllSubMeshesAsTexturesDirty(),k}}getSubMaterial(K){return K<0||K>=this.Tf.length?this.va().defaultMaterial:this.Tf[K]}getActiveTextures(){return super.getActiveTextures().concat(...this.Tf.map((K=>K?K.getActiveTextures():[])))}hasTexture(K){if(super.hasTexture(K))return!0;for(let e=0;e<this.Tf.length;e++){var b;if(null!==(b=this.Tf[e])&&void 0!==b&&b.hasTexture(K))return!0}return!1}getClassName(){return"MultiMaterial"}isReadyForSubMesh(K,b,e){for(let z=0;z<this.Tf.length;z++){const k=this.Tf[z];if(k){if(k._storeEffectOnSubMeshes){if(!k.isReadyForSubMesh(K,b,e))return!1;continue}if(!k.isReady(K))return!1}}return!0}clone(K,b){const e=new T(K,this.va());for(let z=0;z<this.Tf.length;z++){let k=null;const j=this.Tf[z];k=b&&j?j.clone(K+"-"+j.name):this.Tf[z],e.Tf.push(k)}return e}serialize(){const K={};K.name=this.name,K.id=this.id,K.uniqueId=this.uniqueId,k.d&&(K.tags=k.d.GetTags(this)),K.materialsUniqueIds=[],K.materials=[];for(let b=0;b<this.Tf.length;b++){const e=this.Tf[b];e?(K.materialsUniqueIds.push(e.uniqueId),K.materials.push(e.id)):(K.materialsUniqueIds.push(null),K.materials.push(null))}return K}dispose(K,b,e){const z=this.va();if(!z)return;if(e)for(let j=0;j<this.Tf.length;j++){const e=this.Tf[j];e&&e.dispose(K,b)}const k=z.multiMaterials.indexOf(this);k>=0&&z.multiMaterials.splice(k,1),super.dispose(K,b)}static ParseMultiMaterial(K,b){const e=new T(K.name,b);return e.id=K.id,e._loadedUniqueId=K.uniqueId,k.d&&k.d.AddTagsTo(e,K.tags),K.materialsUniqueIds?e._waitingSubMaterialsUniqueIds=K.materialsUniqueIds:K.materials.forEach((K=>e.Tf.push(b.getLastMaterialById(K)))),e}}(0,j.e)("BABYLON.MultiMaterial",T)},11082:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{constructor(){this.previousWorldMatrices={},this.previousBones={}}static AddUniforms(K){K.push("previousWorld","previousViewProjection","mPreviousBones")}static AddSamplers(K){}bindForSubMesh(K,b,e,z,k){if(b.prePassRenderer&&b.prePassRenderer.enabled&&b.prePassRenderer.currentRTisSceneRT&&(-1!==b.prePassRenderer.getIndex(2)||-1!==b.prePassRenderer.getIndex(11))){this.previousWorldMatrices[e.uniqueId]||(this.previousWorldMatrices[e.uniqueId]=z.clone()),this.previousViewProjection||(this.previousViewProjection=b.getTransformMatrix().clone(),this.currentViewProjection=b.getTransformMatrix().clone());const k=b.getEngine();this.currentViewProjection.updateFlag!==b.getTransformMatrix().updateFlag?(this._lastUpdateFrameId=k.frameId,this.previousViewProjection.p(this.currentViewProjection),this.currentViewProjection.p(b.getTransformMatrix())):this._lastUpdateFrameId!==k.frameId&&(this._lastUpdateFrameId=k.frameId,this.previousViewProjection.p(this.currentViewProjection)),K.setMatrix("previousWorld",this.previousWorldMatrices[e.uniqueId]),K.setMatrix("previousViewProjection",this.previousViewProjection),this.previousWorldMatrices[e.uniqueId]=z.clone()}}}},11155:(K,b,e)=>{"use strict";e.d(b,{c:()=>j});var z=e(10967),k=e(11085);class j extends k.b{constructor(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(K,b,void 0,arguments.length>3&&void 0!==arguments[3]&&arguments[3]),this._normalMatrix=new z.b,this._storeEffectOnSubMeshes=e}getEffect(){return this._storeEffectOnSubMeshes?this._activeEffect:super.getEffect()}isReady(K,b){return!!K&&(!this._storeEffectOnSubMeshes||(!K.Rf||0===K.Rf.length||this.isReadyForSubMesh(K,K.Rf[0],b)))}_isReadyForSubMesh(K){const b=K.materialDefines;return!(this.checkReadyOnEveryCall||!K.effect||!b||b._renderId!==this.va().getRenderId())}bindOnlyWorldMatrix(K){this._activeEffect.setMatrix("world",K)}bindOnlyNormalMatrix(K){this._activeEffect.setMatrix("normalMatrix",K)}bind(K,b){b&&this.bindForSubMesh(K,b,b.Rf[0])}_afterBind(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;super._afterBind(K,b,e),this.va()._cachedEffect=b,e?e._drawWrapper._forceRebindOnNextCall=!1:this._drawWrapper._forceRebindOnNextCall=!1}_mustRebind(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return e._drawWrapper._forceRebindOnNextCall||K.isCachedMaterialInvalid(this,b,z)}dispose(K,b,e){this._activeEffect=void 0,super.dispose(K,b,e)}}},10932:(K,b,e)=>{"use strict";e.d(b,{c:()=>L});var z=e(10936),k=e(10938),j=e(10951),T=e(10960),F=e(10967),l=e(10994),Y=e(11030),A=e(11082),X=e(10990),t=e(11085),U=e(11146),B=e(11155),u=e(11161),m=e(10799),D=e(11194),I=e(11201),x=e(11210),Q=e(11138),G=e(11129),i=e(11001),S=e(11224);const M={effect:null,subMesh:null};class r extends U.d{constructor(K){super(K),this.MAINUV1=!1,this.MAINUV2=!1,this.MAINUV3=!1,this.MAINUV4=!1,this.MAINUV5=!1,this.MAINUV6=!1,this.DIFFUSE=!1,this.DIFFUSEDIRECTUV=0,this.BAKED_VERTEX_ANIMATION_TEXTURE=!1,this.AMBIENT=!1,this.AMBIENTDIRECTUV=0,this.OPACITY=!1,this.OPACITYDIRECTUV=0,this.OPACITYRGB=!1,this.REFLECTION=!1,this.EMISSIVE=!1,this.EMISSIVEDIRECTUV=0,this.SPECULAR=!1,this.SPECULARDIRECTUV=0,this.BUMP=!1,this.BUMPDIRECTUV=0,this.PARALLAX=!1,this.PARALLAX_RHS=!1,this.PARALLAXOCCLUSION=!1,this.SPECULAROVERALPHA=!1,this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.ALPHATEST=!1,this.DEPTHPREPASS=!1,this.ALPHAFROMDIFFUSE=!1,this.POINTSIZE=!1,this.FOG=!1,this.SPECULARTERM=!1,this.DIFFUSEFRESNEL=!1,this.OPACITYFRESNEL=!1,this.REFLECTIONFRESNEL=!1,this.REFRACTIONFRESNEL=!1,this.EMISSIVEFRESNEL=!1,this.FRESNEL=!1,this.NORMAL=!1,this.TANGENT=!1,this.UV1=!1,this.UV2=!1,this.UV3=!1,this.UV4=!1,this.UV5=!1,this.UV6=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.NUM_BONE_INFLUENCERS=0,this.BonesPerMesh=0,this.BONETEXTURE=!1,this.BONES_VELOCITY_ENABLED=!1,this.INSTANCES=!1,this.THIN_INSTANCES=!1,this.INSTANCESCOLOR=!1,this.GLOSSINESS=!1,this.ROUGHNESS=!1,this.EMISSIVEASILLUMINATION=!1,this.LINKEMISSIVEWITHDIFFUSE=!1,this.REFLECTIONFRESNELFROMSPECULAR=!1,this.LIGHTMAP=!1,this.LIGHTMAPDIRECTUV=0,this.OBJECTSPACE_NORMALMAP=!1,this.USELIGHTMAPASSHADOWMAP=!1,this.REFLECTIONMAP_3D=!1,this.REFLECTIONMAP_SPHERICAL=!1,this.REFLECTIONMAP_PLANAR=!1,this.REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFLECTIONMAP_CUBIC=!1,this.USE_LOCAL_REFRACTIONMAP_CUBIC=!1,this.REFLECTIONMAP_PROJECTION=!1,this.REFLECTIONMAP_SKYBOX=!1,this.REFLECTIONMAP_EXPLICIT=!1,this.REFLECTIONMAP_EQUIRECTANGULAR=!1,this.REFLECTIONMAP_EQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED=!1,this.REFLECTIONMAP_OPPOSITEZ=!1,this.INVERTCUBICMAP=!1,this.LOGARITHMICDEPTH=!1,this.REFRACTION=!1,this.REFRACTIONMAP_3D=!1,this.REFLECTIONOVERALPHA=!1,this.TWOSIDEDLIGHTING=!1,this.SHADOWFLOAT=!1,this.MORPHTARGETS=!1,this.MORPHTARGETS_NORMAL=!1,this.MORPHTARGETS_TANGENT=!1,this.MORPHTARGETS_UV=!1,this.NUM_MORPH_INFLUENCERS=0,this.MORPHTARGETS_TEXTURE=!1,this.NONUNIFORMSCALING=!1,this.PREMULTIPLYALPHA=!1,this.ALPHATEST_AFTERALLALPHACOMPUTATIONS=!1,this.ALPHABLEND=!0,this.PREPASS=!1,this.PREPASS_COLOR=!1,this.PREPASS_COLOR_INDEX=-1,this.PREPASS_IRRADIANCE=!1,this.PREPASS_IRRADIANCE_INDEX=-1,this.PREPASS_ALBEDO=!1,this.PREPASS_ALBEDO_INDEX=-1,this.PREPASS_ALBEDO_SQRT=!1,this.PREPASS_ALBEDO_SQRT_INDEX=-1,this.PREPASS_DEPTH=!1,this.PREPASS_DEPTH_INDEX=-1,this.PREPASS_SCREENSPACE_DEPTH=!1,this.PREPASS_SCREENSPACE_DEPTH_INDEX=-1,this.PREPASS_NORMAL=!1,this.PREPASS_NORMAL_INDEX=-1,this.PREPASS_NORMAL_WORLDSPACE=!1,this.PREPASS_WORLD_NORMAL=!1,this.PREPASS_WORLD_NORMAL_INDEX=-1,this.PREPASS_POSITION=!1,this.PREPASS_POSITION_INDEX=-1,this.PREPASS_LOCAL_POSITION=!1,this.PREPASS_LOCAL_POSITION_INDEX=-1,this.PREPASS_VELOCITY=!1,this.PREPASS_VELOCITY_INDEX=-1,this.PREPASS_VELOCITY_LINEAR=!1,this.PREPASS_VELOCITY_LINEAR_INDEX=-1,this.PREPASS_REFLECTIVITY=!1,this.PREPASS_REFLECTIVITY_INDEX=-1,this.SCENE_MRT_COUNT=0,this.RGBDLIGHTMAP=!1,this.RGBDREFLECTION=!1,this.RGBDREFRACTION=!1,this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.MULTIVIEW=!1,this.ORDER_INDEPENDENT_TRANSPARENCY=!1,this.ORDER_INDEPENDENT_TRANSPARENCY_16BITS=!1,this.CAMERA_ORTHOGRAPHIC=!1,this.CAMERA_PERSPECTIVE=!1,this.IS_REFLECTION_LINEAR=!1,this.IS_REFRACTION_LINEAR=!1,this.EXPOSURE=!1,this.DECAL_AFTER_DETAIL=!1,this.rebuild()}setReflectionMode(K){const b=["REFLECTIONMAP_CUBIC","REFLECTIONMAP_EXPLICIT","REFLECTIONMAP_PLANAR","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_PROJECTION","REFLECTIONMAP_SKYBOX","REFLECTIONMAP_SPHERICAL","REFLECTIONMAP_EQUIRECTANGULAR","REFLECTIONMAP_EQUIRECTANGULAR_FIXED","REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED"];for(const e of b)this[e]=e===K}}class L extends B.c{get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K),this._markAllSubMeshesAsTexturesDirty()}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),this._imageProcessingConfiguration=K||this.va().imageProcessingConfiguration,this._imageProcessingConfiguration&&(this._imageProcessingObserver=this._imageProcessingConfiguration.onUpdateParameters.add((()=>{this._markAllSubMeshesAsImageProcessingDirty()}))))}get isPrePassCapable(){return!this.disableDepthWrite}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(K){this.imageProcessingConfiguration.colorCurvesEnabled=K}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(K){this.imageProcessingConfiguration.colorGradingEnabled=K}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(K){this._imageProcessingConfiguration.toneMappingEnabled=K}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(K){this._imageProcessingConfiguration.exposure=K}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(K){this._imageProcessingConfiguration.contrast=K}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(K){this._imageProcessingConfiguration.colorGradingTexture=K}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(K){this._imageProcessingConfiguration.colorCurves=K}get canRenderToMRT(){return!0}constructor(K,b){super(K,b,void 0,arguments.length>2&&void 0!==arguments[2]&&arguments[2]||L.ForceGLSL),this._diffuseTexture=null,this._ambientTexture=null,this._opacityTexture=null,this._reflectionTexture=null,this._emissiveTexture=null,this._specularTexture=null,this._bumpTexture=null,this._lightmapTexture=null,this._refractionTexture=null,this.ambientColor=new l.c(0,0,0),this.diffuseColor=new l.c(1,1,1),this.specularColor=new l.c(1,1,1),this.emissiveColor=new l.c(0,0,0),this.specularPower=64,this._useAlphaFromDiffuseTexture=!1,this._useEmissiveAsIllumination=!1,this._linkEmissiveWithDiffuse=!1,this._useSpecularOverAlpha=!1,this._useReflectionOverAlpha=!1,this._disableLighting=!1,this._useObjectSpaceNormalMap=!1,this._useParallax=!1,this._useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this._roughness=0,this.indexOfRefraction=.98,this.invertRefractionY=!0,this.alphaCutOff=.4,this._useLightmapAsShadowmap=!1,this._useReflectionFresnelFromSpecular=!1,this._useGlossinessFromSpecularMapAlpha=!1,this._maxSimultaneousLights=4,this._invertNormalMapX=!1,this._invertNormalMapY=!1,this._twoSidedLighting=!1,this._applyDecalMapAfterDetailMap=!1,this._shadersLoaded=!1,this._renderTargets=new j.h(16),this._worldViewProjectionMatrix=F.b.Zero(),this._globalAmbientColor=new l.c(0,0,0),this._cacheHasRenderTargetTextures=!1,this.detailMap=new x.d(this),this._attachImageProcessingConfiguration(null),this.prePassConfiguration=new A.b,this.getRenderTargetTextures=()=>(this._renderTargets.reset(),L.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget&&this._renderTargets.push(this._reflectionTexture),L.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget&&this._renderTargets.push(this._refractionTexture),this._eventInfo.renderTargets=this._renderTargets,this._callbackPluginEventFillRenderTargetTextures(this._eventInfo),this._renderTargets)}get hasRenderTargetTextures(){return!!(L.ReflectionTextureEnabled&&this._reflectionTexture&&this._reflectionTexture.isRenderTarget)||(!!(L.RefractionTextureEnabled&&this._refractionTexture&&this._refractionTexture.isRenderTarget)||this._cacheHasRenderTargetTextures)}getClassName(){return"nb"}needAlphaBlending(){return!this._disableAlphaBlending&&(this.alpha<1||null!=this._opacityTexture||this._shouldUseAlphaFromDiffuseTexture()||this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled)}needAlphaTesting(){return!!this._forceAlphaTest||this._hasAlphaChannel()&&(null==this._transparencyMode||this._transparencyMode===t.b.MATERIAL_ALPHATEST)}_shouldUseAlphaFromDiffuseTexture(){return null!=this._diffuseTexture&&this._diffuseTexture.ke&&this._useAlphaFromDiffuseTexture&&this._transparencyMode!==t.b.MATERIAL_OPAQUE}_hasAlphaChannel(){return null!=this._diffuseTexture&&this._diffuseTexture.ke||null!=this._opacityTexture}getAlphaTestTexture(){return this._diffuseTexture}isReadyForSubMesh(K,b){let z=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._uniformBufferLayoutBuilt||this.buildUniformLayout();const k=b._drawWrapper;if(k.effect&&this.isFrozen&&k._wasPreviouslyReady&&k._wasPreviouslyUsingInstances===z)return!0;b.materialDefines||(this._callbackPluginEventGeneric(4,this._eventInfo),b.materialDefines=new r(this._eventInfo.defineNames));const j=this.va(),T=b.materialDefines;if(this._isReadyForSubMesh(b))return!0;const F=j.getEngine();T._needNormals=(0,G.S)(j,K,T,!0,this._maxSimultaneousLights,this._disableLighting),(0,G.Z)(j,T);const l=this.needAlphaBlendingForMesh(K)&&this.va().useOrderIndependentTransparency;if((0,G.bb)(j,T,this.canRenderToMRT&&!l),(0,G.ab)(j,T,l),S.e.PrepareDefines(F.currentRenderPassId,K,T),T._areTexturesDirty){this._eventInfo.hasRenderTargetTextures=!1,this._callbackPluginEventHasRenderTargetTextures(this._eventInfo),this._cacheHasRenderTargetTextures=this._eventInfo.hasRenderTargetTextures,T._needUVs=!1;for(let K=1;K<=6;++K)T["MAINUV"+K]=!1;if(j.texturesEnabled){if(T.DIFFUSEDIRECTUV=0,T.BUMPDIRECTUV=0,T.AMBIENTDIRECTUV=0,T.OPACITYDIRECTUV=0,T.EMISSIVEDIRECTUV=0,T.SPECULARDIRECTUV=0,T.LIGHTMAPDIRECTUV=0,this._diffuseTexture&&L.DiffuseTextureEnabled){if(!this._diffuseTexture.isReadyOrNotBlocking())return!1;(0,G.V)(this._diffuseTexture,T,"DIFFUSE")}else T.DIFFUSE=!1;if(this._ambientTexture&&L.AmbientTextureEnabled){if(!this._ambientTexture.isReadyOrNotBlocking())return!1;(0,G.V)(this._ambientTexture,T,"AMBIENT")}else T.AMBIENT=!1;if(this._opacityTexture&&L.OpacityTextureEnabled){if(!this._opacityTexture.isReadyOrNotBlocking())return!1;(0,G.V)(this._opacityTexture,T,"OPACITY"),T.OPACITYRGB=this._opacityTexture.getAlphaFromRGB}else T.OPACITY=!1;if(this._reflectionTexture&&L.ReflectionTextureEnabled){if(!this._reflectionTexture.isReadyOrNotBlocking())return!1;switch(T._needNormals=!0,T.REFLECTION=!0,T.ROUGHNESS=this._roughness>0,T.REFLECTIONOVERALPHA=this._useReflectionOverAlpha,T.INVERTCUBICMAP=this._reflectionTexture.coordinatesMode===u.c.INVCUBIC_MODE,T.REFLECTIONMAP_3D=this._reflectionTexture.isCube,T.REFLECTIONMAP_OPPOSITEZ=T.REFLECTIONMAP_3D&&this.va().useRightHandedSystem?!this._reflectionTexture.invertZ:this._reflectionTexture.invertZ,T.RGBDREFLECTION=this._reflectionTexture.isRGBD,this._reflectionTexture.coordinatesMode){case u.c.EXPLICIT_MODE:T.setReflectionMode("REFLECTIONMAP_EXPLICIT");break;case u.c.PLANAR_MODE:T.setReflectionMode("REFLECTIONMAP_PLANAR");break;case u.c.PROJECTION_MODE:T.setReflectionMode("REFLECTIONMAP_PROJECTION");break;case u.c.SKYBOX_MODE:T.setReflectionMode("REFLECTIONMAP_SKYBOX");break;case u.c.SPHERICAL_MODE:T.setReflectionMode("REFLECTIONMAP_SPHERICAL");break;case u.c.EQUIRECTANGULAR_MODE:T.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR");break;case u.c.FIXED_EQUIRECTANGULAR_MODE:T.setReflectionMode("REFLECTIONMAP_EQUIRECTANGULAR_FIXED");break;case u.c.FIXED_EQUIRECTANGULAR_MIRRORED_MODE:T.setReflectionMode("REFLECTIONMAP_MIRROREDEQUIRECTANGULAR_FIXED");break;case u.c.CUBIC_MODE:case u.c.INVCUBIC_MODE:default:T.setReflectionMode("REFLECTIONMAP_CUBIC")}T.USE_LOCAL_REFLECTIONMAP_CUBIC=!!this._reflectionTexture.boundingBoxSize}else T.REFLECTION=!1,T.REFLECTIONMAP_OPPOSITEZ=!1;if(this._emissiveTexture&&L.EmissiveTextureEnabled){if(!this._emissiveTexture.isReadyOrNotBlocking())return!1;(0,G.V)(this._emissiveTexture,T,"EMISSIVE")}else T.EMISSIVE=!1;if(this._lightmapTexture&&L.LightmapTextureEnabled){if(!this._lightmapTexture.isReadyOrNotBlocking())return!1;(0,G.V)(this._lightmapTexture,T,"LIGHTMAP"),T.USELIGHTMAPASSHADOWMAP=this._useLightmapAsShadowmap,T.RGBDLIGHTMAP=this._lightmapTexture.isRGBD}else T.LIGHTMAP=!1;if(this._specularTexture&&L.SpecularTextureEnabled){if(!this._specularTexture.isReadyOrNotBlocking())return!1;(0,G.V)(this._specularTexture,T,"SPECULAR"),T.GLOSSINESS=this._useGlossinessFromSpecularMapAlpha}else T.SPECULAR=!1;if(j.getEngine().getCaps().standardDerivatives&&this._bumpTexture&&L.BumpTextureEnabled){if(!this._bumpTexture.isReady())return!1;(0,G.V)(this._bumpTexture,T,"BUMP"),T.PARALLAX=this._useParallax,T.PARALLAX_RHS=j.useRightHandedSystem,T.PARALLAXOCCLUSION=this._useParallaxOcclusion,T.OBJECTSPACE_NORMALMAP=this._useObjectSpaceNormalMap}else T.BUMP=!1,T.PARALLAX=!1,T.PARALLAX_RHS=!1,T.PARALLAXOCCLUSION=!1;if(this._refractionTexture&&L.RefractionTextureEnabled){if(!this._refractionTexture.isReadyOrNotBlocking())return!1;T._needUVs=!0,T.REFRACTION=!0,T.REFRACTIONMAP_3D=this._refractionTexture.isCube,T.RGBDREFRACTION=this._refractionTexture.isRGBD,T.USE_LOCAL_REFRACTIONMAP_CUBIC=!!this._refractionTexture.boundingBoxSize}else T.REFRACTION=!1;T.TWOSIDEDLIGHTING=!this._backFaceCulling&&this._twoSidedLighting}else T.DIFFUSE=!1,T.AMBIENT=!1,T.OPACITY=!1,T.REFLECTION=!1,T.EMISSIVE=!1,T.LIGHTMAP=!1,T.BUMP=!1,T.REFRACTION=!1;T.ALPHAFROMDIFFUSE=this._shouldUseAlphaFromDiffuseTexture(),T.EMISSIVEASILLUMINATION=this._useEmissiveAsIllumination,T.LINKEMISSIVEWITHDIFFUSE=this._linkEmissiveWithDiffuse,T.SPECULAROVERALPHA=this._useSpecularOverAlpha,T.PREMULTIPLYALPHA=7===this.alphaMode||8===this.alphaMode,T.ALPHATEST_AFTERALLALPHACOMPUTATIONS=null!==this.transparencyMode,T.ALPHABLEND=null===this.transparencyMode||this.needAlphaBlendingForMesh(K)}if(this._eventInfo.isReadyForSubMesh=!0,this._eventInfo.defines=T,this._eventInfo.subMesh=b,this._callbackPluginEventIsReadyForSubMesh(this._eventInfo),!this._eventInfo.isReadyForSubMesh)return!1;if(T._areImageProcessingDirty&&this._imageProcessingConfiguration){if(!this._imageProcessingConfiguration.isReady())return!1;this._imageProcessingConfiguration.prepareDefines(T),T.IS_REFLECTION_LINEAR=null!=this.reflectionTexture&&!this.reflectionTexture.gammaSpace,T.IS_REFRACTION_LINEAR=null!=this.refractionTexture&&!this.refractionTexture.gammaSpace}T._areFresnelDirty&&(L.FresnelEnabled?(this._diffuseFresnelParameters||this._opacityFresnelParameters||this._emissiveFresnelParameters||this._refractionFresnelParameters||this._reflectionFresnelParameters)&&(T.DIFFUSEFRESNEL=this._diffuseFresnelParameters&&this._diffuseFresnelParameters.isEnabled,T.OPACITYFRESNEL=this._opacityFresnelParameters&&this._opacityFresnelParameters.isEnabled,T.REFLECTIONFRESNEL=this._reflectionFresnelParameters&&this._reflectionFresnelParameters.isEnabled,T.REFLECTIONFRESNELFROMSPECULAR=this._useReflectionFresnelFromSpecular,T.REFRACTIONFRESNEL=this._refractionFresnelParameters&&this._refractionFresnelParameters.isEnabled,T.EMISSIVEFRESNEL=this._emissiveFresnelParameters&&this._emissiveFresnelParameters.isEnabled,T._needNormals=!0,T.FRESNEL=!0):T.FRESNEL=!1),(0,G.W)(K,j,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,this._shouldTurnAlphaTestOn(K)||this._forceAlphaTest,T,this._applyDecalMapAfterDetailMap),(0,G.R)(j,F,this,T,z,null,b.getRenderingMesh().hasThinInstances),this._eventInfo.defines=T,this._eventInfo.mesh=K,this._callbackPluginEventPrepareDefinesBeforeAttributes(this._eventInfo),(0,G.N)(K,T,!0,!0,!0),this._callbackPluginEventPrepareDefines(this._eventInfo);let t=!1;if(T.isDirty){const z=T._areLightsDisposed;T.markAsProcessed();const k=new I.c;T.REFLECTION&&k.addFallback(0,"REFLECTION"),T.SPECULAR&&k.addFallback(0,"SPECULAR"),T.BUMP&&k.addFallback(0,"BUMP"),T.PARALLAX&&k.addFallback(1,"PARALLAX"),T.PARALLAX_RHS&&k.addFallback(1,"PARALLAX_RHS"),T.PARALLAXOCCLUSION&&k.addFallback(0,"PARALLAXOCCLUSION"),T.SPECULAROVERALPHA&&k.addFallback(0,"SPECULAROVERALPHA"),T.FOG&&k.addFallback(1,"FOG"),T.POINTSIZE&&k.addFallback(0,"POINTSIZE"),T.LOGARITHMICDEPTH&&k.addFallback(0,"LOGARITHMICDEPTH"),(0,G.z)(T,k,this._maxSimultaneousLights),T.SPECULARTERM&&k.addFallback(0,"SPECULARTERM"),T.DIFFUSEFRESNEL&&k.addFallback(1,"DIFFUSEFRESNEL"),T.OPACITYFRESNEL&&k.addFallback(2,"OPACITYFRESNEL"),T.REFLECTIONFRESNEL&&k.addFallback(3,"REFLECTIONFRESNEL"),T.EMISSIVEFRESNEL&&k.addFallback(4,"EMISSIVEFRESNEL"),T.FRESNEL&&k.addFallback(4,"FRESNEL"),T.MULTIVIEW&&k.addFallback(0,"MULTIVIEW");const l=[Y.f.PositionKind];T.NORMAL&&l.push(Y.f.NormalKind),T.TANGENT&&l.push(Y.f.TangentKind);for(let K=1;K<=6;++K)T["UV"+K]&&l.push(`uv${1===K?"":K}`);T.VERTEXCOLOR&&l.push(Y.f.ColorKind),(0,G.F)(l,K,T,k),(0,G.G)(l,T),(0,G.K)(l,K,T),(0,G.B)(l,K,T);let U="default";const B=["world","view","viewProjection","vEyePosition","vLightsType","vAmbientColor","vDiffuseColor","vSpecularColor","vEmissiveColor","visibility","vFogInfos","vFogColor","pointSize","vDiffuseInfos","vAmbientInfos","vOpacityInfos","vReflectionInfos","vEmissiveInfos","vSpecularInfos","vBumpInfos","vLightmapInfos","vRefractionInfos","mBones","diffuseMatrix","ambientMatrix","opacityMatrix","reflectionMatrix","emissiveMatrix","specularMatrix","bumpMatrix","normalMatrix","lightmapMatrix","refractionMatrix","diffuseLeftColor","diffuseRightColor","opacityParts","reflectionLeftColor","reflectionRightColor","emissiveLeftColor","emissiveRightColor","refractionLeftColor","refractionRightColor","vReflectionPosition","vReflectionSize","vRefractionPosition","vRefractionSize","logarithmicDepthConstant","vTangentSpaceParams","alphaCutOff","boneTextureWidth","morphTargetTextureInfo","morphTargetTextureIndices"],u=["diffuseSampler","ambientSampler","opacitySampler","reflectionCubeSampler","reflection2DSampler","emissiveSampler","specularSampler","bumpSampler","lightmapSampler","refractionCubeSampler","refraction2DSampler","boneSampler","morphTargets","oitDepthSampler","oitFrontColorSampler"],m=["Material","Scene","Mesh"],D={maxSimultaneousLights:this._maxSimultaneousLights,maxSimultaneousMorphTargets:T.NUM_MORPH_INFLUENCERS};this._eventInfo.fallbacks=k,this._eventInfo.fallbackRank=0,this._eventInfo.defines=T,this._eventInfo.uniforms=B,this._eventInfo.attributes=l,this._eventInfo.samplers=u,this._eventInfo.uniformBuffersNames=m,this._eventInfo.customCode=void 0,this._eventInfo.mesh=K,this._eventInfo.indexParameters=D,this._callbackPluginEventGeneric(128,this._eventInfo),S.e.AddUniformsAndSamplers(B,u),A.b.AddUniforms(B),A.b.AddSamplers(u),X.d&&(X.d.PrepareUniforms(B,T),X.d.PrepareSamplers(u,T)),(0,G.fb)({uniformsNames:B,uniformBuffersNames:m,samplers:u,defines:T,maxSimultaneousLights:this._maxSimultaneousLights}),(0,Q.c)(B);const x={};this.customShaderNameResolve&&(U=this.customShaderNameResolve(U,B,m,u,T,l,x));const i=T.toString(),r=b.effect;let L=j.getEngine().createEffect(U,{attributes:l,uniformsNames:B,uniformBuffersNames:m,samplers:u,defines:i,fallbacks:k,onCompiled:this.onCompiled,onError:this.onError,indexParameters:D,processFinalCode:x.processFinalCode,processCodeAfterIncludes:this._eventInfo.customCode,multiTarget:T.PREPASS,shaderLanguage:this._shaderLanguage,extraInitializationsAsync:this._shadersLoaded?void 0:async()=>{1===this._shaderLanguage?await Promise.all([Promise.all([e.e(21),e.e(19)]).then(e.bind(e,12656)),Promise.all([e.e(22),e.e(20)]).then(e.bind(e,12807))]):await Promise.all([Promise.all([e.e(25),e.e(24)]).then(e.bind(e,12896)),Promise.all([e.e(27),e.e(26)]).then(e.bind(e,13055))]),this._shadersLoaded=!0}},F);if(this._eventInfo.customCode=void 0,L)if(this._onEffectCreatedObservable&&(M.effect=L,M.subMesh=b,this._onEffectCreatedObservable.notifyObservers(M)),this.allowShaderHotSwapping&&r&&!L.isReady()){if(L=r,T.markAsUnprocessed(),t=this.isFrozen,z)return T._areLightsDisposed=!0,!1}else j.resetCachedMaterial(),b.setEffect(L,T,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(T._renderId=j.getRenderId(),k._wasPreviouslyReady=!t,k._wasPreviouslyUsingInstances=z,this._checkScenePerformancePriority(),!0)}buildUniformLayout(){const K=this._uniformBuffer;K.addUniform("diffuseLeftColor",4),K.addUniform("diffuseRightColor",4),K.addUniform("opacityParts",4),K.addUniform("reflectionLeftColor",4),K.addUniform("reflectionRightColor",4),K.addUniform("refractionLeftColor",4),K.addUniform("refractionRightColor",4),K.addUniform("emissiveLeftColor",4),K.addUniform("emissiveRightColor",4),K.addUniform("vDiffuseInfos",2),K.addUniform("vAmbientInfos",2),K.addUniform("vOpacityInfos",2),K.addUniform("vReflectionInfos",2),K.addUniform("vReflectionPosition",3),K.addUniform("vReflectionSize",3),K.addUniform("vEmissiveInfos",2),K.addUniform("vLightmapInfos",2),K.addUniform("vSpecularInfos",2),K.addUniform("vBumpInfos",3),K.addUniform("diffuseMatrix",16),K.addUniform("ambientMatrix",16),K.addUniform("opacityMatrix",16),K.addUniform("reflectionMatrix",16),K.addUniform("emissiveMatrix",16),K.addUniform("lightmapMatrix",16),K.addUniform("specularMatrix",16),K.addUniform("bumpMatrix",16),K.addUniform("vTangentSpaceParams",2),K.addUniform("pointSize",1),K.addUniform("alphaCutOff",1),K.addUniform("refractionMatrix",16),K.addUniform("vRefractionInfos",4),K.addUniform("vRefractionPosition",3),K.addUniform("vRefractionSize",3),K.addUniform("vSpecularColor",4),K.addUniform("vEmissiveColor",3),K.addUniform("vDiffuseColor",4),K.addUniform("vAmbientColor",3),super.buildUniformLayout()}bindForSubMesh(K,b,e){const z=this.va(),k=e.materialDefines;if(!k)return;const j=e.effect;if(!j)return;this._activeEffect=j,b.getMeshUniformBuffer().bindToEffect(j,"Mesh"),b.transferToEffect(K),this._uniformBuffer.bindToEffect(j,"Material"),this.prePassConfiguration.bindForSubMesh(this._activeEffect,z,b,K,this.isFrozen),S.e.Bind(z.getEngine().currentRenderPassId,this._activeEffect,b,K),this._eventInfo.subMesh=e,this._callbackPluginEventHardBindForSubMesh(this._eventInfo),k.OBJECTSPACE_NORMALMAP&&(K.toNormalMatrix(this._normalMatrix),this.bindOnlyNormalMatrix(this._normalMatrix));const F=this._mustRebind(z,j,e,b.visibility);(0,G.e)(b,j);const Y=this._uniformBuffer;if(F){if(this.bindViewProjection(j),!Y.useUbo||!this.isFrozen||!Y.isSync||e._drawWrapper._forceRebindOnNextCall){if(L.FresnelEnabled&&k.FRESNEL&&(this.diffuseFresnelParameters&&this.diffuseFresnelParameters.isEnabled&&(Y.updateColor4("diffuseLeftColor",this.diffuseFresnelParameters.leftColor,this.diffuseFresnelParameters.power),Y.updateColor4("diffuseRightColor",this.diffuseFresnelParameters.rightColor,this.diffuseFresnelParameters.bias)),this.opacityFresnelParameters&&this.opacityFresnelParameters.isEnabled&&Y.updateColor4("opacityParts",new l.c(this.opacityFresnelParameters.leftColor.toLuminance(),this.opacityFresnelParameters.rightColor.toLuminance(),this.opacityFresnelParameters.bias),this.opacityFresnelParameters.power),this.reflectionFresnelParameters&&this.reflectionFresnelParameters.isEnabled&&(Y.updateColor4("reflectionLeftColor",this.reflectionFresnelParameters.leftColor,this.reflectionFresnelParameters.power),Y.updateColor4("reflectionRightColor",this.reflectionFresnelParameters.rightColor,this.reflectionFresnelParameters.bias)),this.refractionFresnelParameters&&this.refractionFresnelParameters.isEnabled&&(Y.updateColor4("refractionLeftColor",this.refractionFresnelParameters.leftColor,this.refractionFresnelParameters.power),Y.updateColor4("refractionRightColor",this.refractionFresnelParameters.rightColor,this.refractionFresnelParameters.bias)),this.emissiveFresnelParameters&&this.emissiveFresnelParameters.isEnabled&&(Y.updateColor4("emissiveLeftColor",this.emissiveFresnelParameters.leftColor,this.emissiveFresnelParameters.power),Y.updateColor4("emissiveRightColor",this.emissiveFresnelParameters.rightColor,this.emissiveFresnelParameters.bias))),z.texturesEnabled){if(this._diffuseTexture&&L.DiffuseTextureEnabled&&(Y.updateFloat2("vDiffuseInfos",this._diffuseTexture.coordinatesIndex,this._diffuseTexture.level),(0,G.y)(this._diffuseTexture,Y,"diffuse")),this._ambientTexture&&L.AmbientTextureEnabled&&(Y.updateFloat2("vAmbientInfos",this._ambientTexture.coordinatesIndex,this._ambientTexture.level),(0,G.y)(this._ambientTexture,Y,"ambient")),this._opacityTexture&&L.OpacityTextureEnabled&&(Y.updateFloat2("vOpacityInfos",this._opacityTexture.coordinatesIndex,this._opacityTexture.level),(0,G.y)(this._opacityTexture,Y,"opacity")),this._hasAlphaChannel()&&Y.updateFloat("alphaCutOff",this.alphaCutOff),this._reflectionTexture&&L.ReflectionTextureEnabled&&(Y.updateFloat2("vReflectionInfos",this._reflectionTexture.level,this.roughness),Y.qj("reflectionMatrix",this._reflectionTexture.getReflectionTextureMatrix()),this._reflectionTexture.boundingBoxSize)){const K=this._reflectionTexture;Y.updateVector3("vReflectionPosition",K.boundingBoxPosition),Y.updateVector3("vReflectionSize",K.boundingBoxSize)}if(this._emissiveTexture&&L.EmissiveTextureEnabled&&(Y.updateFloat2("vEmissiveInfos",this._emissiveTexture.coordinatesIndex,this._emissiveTexture.level),(0,G.y)(this._emissiveTexture,Y,"emissive")),this._lightmapTexture&&L.LightmapTextureEnabled&&(Y.updateFloat2("vLightmapInfos",this._lightmapTexture.coordinatesIndex,this._lightmapTexture.level),(0,G.y)(this._lightmapTexture,Y,"lightmap")),this._specularTexture&&L.SpecularTextureEnabled&&(Y.updateFloat2("vSpecularInfos",this._specularTexture.coordinatesIndex,this._specularTexture.level),(0,G.y)(this._specularTexture,Y,"specular")),this._bumpTexture&&z.getEngine().getCaps().standardDerivatives&&L.BumpTextureEnabled&&(Y.updateFloat3("vBumpInfos",this._bumpTexture.coordinatesIndex,1/this._bumpTexture.level,this.parallaxScaleBias),(0,G.y)(this._bumpTexture,Y,"bump"),z._mirroredCameraPosition?Y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?1:-1,this._invertNormalMapY?1:-1):Y.updateFloat2("vTangentSpaceParams",this._invertNormalMapX?-1:1,this._invertNormalMapY?-1:1)),this._refractionTexture&&L.RefractionTextureEnabled){let K=1;if(this._refractionTexture.isCube||(Y.qj("refractionMatrix",this._refractionTexture.getReflectionTextureMatrix()),this._refractionTexture.depth&&(K=this._refractionTexture.depth)),Y.updateFloat4("vRefractionInfos",this._refractionTexture.level,this.indexOfRefraction,K,this.invertRefractionY?-1:1),this._refractionTexture.boundingBoxSize){const K=this._refractionTexture;Y.updateVector3("vRefractionPosition",K.boundingBoxPosition),Y.updateVector3("vRefractionSize",K.boundingBoxSize)}}}this.pointsCloud&&Y.updateFloat("pointSize",this.pointSize),Y.updateColor4("vSpecularColor",this.specularColor,this.specularPower),Y.updateColor3("vEmissiveColor",L.EmissiveTextureEnabled?this.emissiveColor:l.c.BlackReadOnly),Y.updateColor4("vDiffuseColor",this.diffuseColor,this.alpha),z.ambientColor.multiplyToRef(this.ambientColor,this._globalAmbientColor),Y.updateColor3("vAmbientColor",this._globalAmbientColor)}z.texturesEnabled&&(this._diffuseTexture&&L.DiffuseTextureEnabled&&j.setTexture("diffuseSampler",this._diffuseTexture),this._ambientTexture&&L.AmbientTextureEnabled&&j.setTexture("ambientSampler",this._ambientTexture),this._opacityTexture&&L.OpacityTextureEnabled&&j.setTexture("opacitySampler",this._opacityTexture),this._reflectionTexture&&L.ReflectionTextureEnabled&&(this._reflectionTexture.isCube?j.setTexture("reflectionCubeSampler",this._reflectionTexture):j.setTexture("reflection2DSampler",this._reflectionTexture)),this._emissiveTexture&&L.EmissiveTextureEnabled&&j.setTexture("emissiveSampler",this._emissiveTexture),this._lightmapTexture&&L.LightmapTextureEnabled&&j.setTexture("lightmapSampler",this._lightmapTexture),this._specularTexture&&L.SpecularTextureEnabled&&j.setTexture("specularSampler",this._specularTexture),this._bumpTexture&&z.getEngine().getCaps().standardDerivatives&&L.BumpTextureEnabled&&j.setTexture("bumpSampler",this._bumpTexture),this._refractionTexture&&L.RefractionTextureEnabled&&(this._refractionTexture.isCube?j.setTexture("refractionCubeSampler",this._refractionTexture):j.setTexture("refraction2DSampler",this._refractionTexture))),this.va().useOrderIndependentTransparency&&this.needAlphaBlendingForMesh(b)&&this.va().depthPeelingRenderer.bind(j),this._eventInfo.subMesh=e,this._callbackPluginEventBindForSubMesh(this._eventInfo),(0,Q.d)(j,this,z),this.bindEyePosition(j)}else z.getEngine()._features.needToAlwaysBindUniformBuffers&&(this._needToBindSceneUbo=!0);if(F||!this.isFrozen){var A;if(z.lightsEnabled&&!this._disableLighting&&(0,G.l)(z,b,j,k,this._maxSimultaneousLights),(z.fogEnabled&&b.applyFog&&z.fogMode!==T.e.FOGMODE_NONE||this._reflectionTexture||this._refractionTexture||b.receiveShadows||k.PREPASS)&&this.bindView(j),(0,G.h)(z,b,j),k.NUM_MORPH_INFLUENCERS&&(0,G.q)(b,j),k.BAKED_VERTEX_ANIMATION_TEXTURE)null===(A=b.bakedVertexAnimationManager)||void 0===A||A.bind(j,k.INSTANCES);this.useLogarithmicDepth&&(0,G.o)(k,j,z),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(this._activeEffect)}this._afterBind(b,this._activeEffect,e),Y.update()}getAnimatables(){const K=super.getAnimatables();return this._diffuseTexture&&this._diffuseTexture.animations&&this._diffuseTexture.animations.length>0&&K.push(this._diffuseTexture),this._ambientTexture&&this._ambientTexture.animations&&this._ambientTexture.animations.length>0&&K.push(this._ambientTexture),this._opacityTexture&&this._opacityTexture.animations&&this._opacityTexture.animations.length>0&&K.push(this._opacityTexture),this._reflectionTexture&&this._reflectionTexture.animations&&this._reflectionTexture.animations.length>0&&K.push(this._reflectionTexture),this._emissiveTexture&&this._emissiveTexture.animations&&this._emissiveTexture.animations.length>0&&K.push(this._emissiveTexture),this._specularTexture&&this._specularTexture.animations&&this._specularTexture.animations.length>0&&K.push(this._specularTexture),this._bumpTexture&&this._bumpTexture.animations&&this._bumpTexture.animations.length>0&&K.push(this._bumpTexture),this._lightmapTexture&&this._lightmapTexture.animations&&this._lightmapTexture.animations.length>0&&K.push(this._lightmapTexture),this._refractionTexture&&this._refractionTexture.animations&&this._refractionTexture.animations.length>0&&K.push(this._refractionTexture),K}getActiveTextures(){const K=super.getActiveTextures();return this._diffuseTexture&&K.push(this._diffuseTexture),this._ambientTexture&&K.push(this._ambientTexture),this._opacityTexture&&K.push(this._opacityTexture),this._reflectionTexture&&K.push(this._reflectionTexture),this._emissiveTexture&&K.push(this._emissiveTexture),this._specularTexture&&K.push(this._specularTexture),this._bumpTexture&&K.push(this._bumpTexture),this._lightmapTexture&&K.push(this._lightmapTexture),this._refractionTexture&&K.push(this._refractionTexture),K}hasTexture(K){return!!super.hasTexture(K)||(this._diffuseTexture===K||(this._ambientTexture===K||(this._opacityTexture===K||(this._reflectionTexture===K||(this._emissiveTexture===K||(this._specularTexture===K||(this._bumpTexture===K||(this._lightmapTexture===K||this._refractionTexture===K))))))))}dispose(K,b){var e,z,k,j,T,F,l,Y,A;b&&(null===(e=this._diffuseTexture)||void 0===e||e.dispose(),null===(z=this._ambientTexture)||void 0===z||z.dispose(),null===(k=this._opacityTexture)||void 0===k||k.dispose(),null===(j=this._reflectionTexture)||void 0===j||j.dispose(),null===(T=this._emissiveTexture)||void 0===T||T.dispose(),null===(F=this._specularTexture)||void 0===F||F.dispose(),null===(l=this._bumpTexture)||void 0===l||l.dispose(),null===(Y=this._lightmapTexture)||void 0===Y||Y.dispose(),null===(A=this._refractionTexture)||void 0===A||A.dispose());this._imageProcessingConfiguration&&this._imageProcessingObserver&&this._imageProcessingConfiguration.onUpdateParameters.remove(this._imageProcessingObserver),super.dispose(K,b)}clone(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const z=i.e.Clone((()=>new L(K,this.va())),this,{cloneTexturesOnlyOnce:b});return z.name=K,z.id=K,this.stencil.copyTo(z.stencil),this._clonePlugins(z,e),z}static Parse(K,b,e){const z=i.e.Parse((()=>new L(K.name,b)),K,b,e);return K.stencil&&z.stencil.parse(K.stencil,b,e),t.b._ParsePlugins(K,z,b,e),z}static get DiffuseTextureEnabled(){return D.c.DiffuseTextureEnabled}static set DiffuseTextureEnabled(K){D.c.DiffuseTextureEnabled=K}static get DetailTextureEnabled(){return D.c.DetailTextureEnabled}static set DetailTextureEnabled(K){D.c.DetailTextureEnabled=K}static get AmbientTextureEnabled(){return D.c.AmbientTextureEnabled}static set AmbientTextureEnabled(K){D.c.AmbientTextureEnabled=K}static get OpacityTextureEnabled(){return D.c.OpacityTextureEnabled}static set OpacityTextureEnabled(K){D.c.OpacityTextureEnabled=K}static get ReflectionTextureEnabled(){return D.c.ReflectionTextureEnabled}static set ReflectionTextureEnabled(K){D.c.ReflectionTextureEnabled=K}static get EmissiveTextureEnabled(){return D.c.EmissiveTextureEnabled}static set EmissiveTextureEnabled(K){D.c.EmissiveTextureEnabled=K}static get SpecularTextureEnabled(){return D.c.SpecularTextureEnabled}static set SpecularTextureEnabled(K){D.c.SpecularTextureEnabled=K}static get BumpTextureEnabled(){return D.c.BumpTextureEnabled}static set BumpTextureEnabled(K){D.c.BumpTextureEnabled=K}static get LightmapTextureEnabled(){return D.c.LightmapTextureEnabled}static set LightmapTextureEnabled(K){D.c.LightmapTextureEnabled=K}static get RefractionTextureEnabled(){return D.c.RefractionTextureEnabled}static set RefractionTextureEnabled(K){D.c.RefractionTextureEnabled=K}static get ColorGradingTextureEnabled(){return D.c.ColorGradingTextureEnabled}static set ColorGradingTextureEnabled(K){D.c.ColorGradingTextureEnabled=K}static get FresnelEnabled(){return D.c.FresnelEnabled}static set FresnelEnabled(K){D.c.FresnelEnabled=K}}L.ForceGLSL=!1,(0,z.b)([(0,k.E)("diffuseTexture")],L.prototype,"_diffuseTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],L.prototype,"diffuseTexture",void 0),(0,z.b)([(0,k.E)("ambientTexture")],L.prototype,"_ambientTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"ambientTexture",void 0),(0,z.b)([(0,k.E)("opacityTexture")],L.prototype,"_opacityTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],L.prototype,"opacityTexture",void 0),(0,z.b)([(0,k.E)("reflectionTexture")],L.prototype,"_reflectionTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"reflectionTexture",void 0),(0,z.b)([(0,k.E)("emissiveTexture")],L.prototype,"_emissiveTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"emissiveTexture",void 0),(0,z.b)([(0,k.E)("specularTexture")],L.prototype,"_specularTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"specularTexture",void 0),(0,z.b)([(0,k.E)("bumpTexture")],L.prototype,"_bumpTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"bumpTexture",void 0),(0,z.b)([(0,k.E)("lightmapTexture")],L.prototype,"_lightmapTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"lightmapTexture",void 0),(0,z.b)([(0,k.E)("refractionTexture")],L.prototype,"_refractionTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"refractionTexture",void 0),(0,z.b)([(0,k.m)("ambient")],L.prototype,"ambientColor",void 0),(0,z.b)([(0,k.m)("diffuse")],L.prototype,"diffuseColor",void 0),(0,z.b)([(0,k.m)("specular")],L.prototype,"specularColor",void 0),(0,z.b)([(0,k.m)("emissive")],L.prototype,"emissiveColor",void 0),(0,z.b)([(0,k.M)()],L.prototype,"specularPower",void 0),(0,z.b)([(0,k.M)("useAlphaFromDiffuseTexture")],L.prototype,"_useAlphaFromDiffuseTexture",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],L.prototype,"useAlphaFromDiffuseTexture",void 0),(0,z.b)([(0,k.M)("useEmissiveAsIllumination")],L.prototype,"_useEmissiveAsIllumination",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useEmissiveAsIllumination",void 0),(0,z.b)([(0,k.M)("linkEmissiveWithDiffuse")],L.prototype,"_linkEmissiveWithDiffuse",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"linkEmissiveWithDiffuse",void 0),(0,z.b)([(0,k.M)("useSpecularOverAlpha")],L.prototype,"_useSpecularOverAlpha",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useSpecularOverAlpha",void 0),(0,z.b)([(0,k.M)("useReflectionOverAlpha")],L.prototype,"_useReflectionOverAlpha",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useReflectionOverAlpha",void 0),(0,z.b)([(0,k.M)("disableLighting")],L.prototype,"_disableLighting",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsLightsDirty")],L.prototype,"disableLighting",void 0),(0,z.b)([(0,k.M)("useObjectSpaceNormalMap")],L.prototype,"_useObjectSpaceNormalMap",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useObjectSpaceNormalMap",void 0),(0,z.b)([(0,k.M)("useParallax")],L.prototype,"_useParallax",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useParallax",void 0),(0,z.b)([(0,k.M)("useParallaxOcclusion")],L.prototype,"_useParallaxOcclusion",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useParallaxOcclusion",void 0),(0,z.b)([(0,k.M)()],L.prototype,"parallaxScaleBias",void 0),(0,z.b)([(0,k.M)("roughness")],L.prototype,"_roughness",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"roughness",void 0),(0,z.b)([(0,k.M)()],L.prototype,"indexOfRefraction",void 0),(0,z.b)([(0,k.M)()],L.prototype,"invertRefractionY",void 0),(0,z.b)([(0,k.M)()],L.prototype,"alphaCutOff",void 0),(0,z.b)([(0,k.M)("useLightmapAsShadowmap")],L.prototype,"_useLightmapAsShadowmap",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useLightmapAsShadowmap",void 0),(0,z.b)([(0,k.r)("diffuseFresnelParameters")],L.prototype,"_diffuseFresnelParameters",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"diffuseFresnelParameters",void 0),(0,z.b)([(0,k.r)("opacityFresnelParameters")],L.prototype,"_opacityFresnelParameters",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsFresnelAndMiscDirty")],L.prototype,"opacityFresnelParameters",void 0),(0,z.b)([(0,k.r)("reflectionFresnelParameters")],L.prototype,"_reflectionFresnelParameters",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"reflectionFresnelParameters",void 0),(0,z.b)([(0,k.r)("refractionFresnelParameters")],L.prototype,"_refractionFresnelParameters",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"refractionFresnelParameters",void 0),(0,z.b)([(0,k.r)("emissiveFresnelParameters")],L.prototype,"_emissiveFresnelParameters",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"emissiveFresnelParameters",void 0),(0,z.b)([(0,k.M)("useReflectionFresnelFromSpecular")],L.prototype,"_useReflectionFresnelFromSpecular",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsFresnelDirty")],L.prototype,"useReflectionFresnelFromSpecular",void 0),(0,z.b)([(0,k.M)("useGlossinessFromSpecularMapAlpha")],L.prototype,"_useGlossinessFromSpecularMapAlpha",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"useGlossinessFromSpecularMapAlpha",void 0),(0,z.b)([(0,k.M)("maxSimultaneousLights")],L.prototype,"_maxSimultaneousLights",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsLightsDirty")],L.prototype,"maxSimultaneousLights",void 0),(0,z.b)([(0,k.M)("invertNormalMapX")],L.prototype,"_invertNormalMapX",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"invertNormalMapX",void 0),(0,z.b)([(0,k.M)("invertNormalMapY")],L.prototype,"_invertNormalMapY",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"invertNormalMapY",void 0),(0,z.b)([(0,k.M)("twoSidedLighting")],L.prototype,"_twoSidedLighting",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsTexturesDirty")],L.prototype,"twoSidedLighting",void 0),(0,z.b)([(0,k.M)("applyDecalMapAfterDetailMap")],L.prototype,"_applyDecalMapAfterDetailMap",void 0),(0,z.b)([(0,k.b)("_markAllSubMeshesAsMiscDirty")],L.prototype,"applyDecalMapAfterDetailMap",void 0),(0,m.e)("BABYLON.StandardMaterial",L),T.e.DefaultMaterialFactory=K=>new L("default material",K)},11017:(K,b,e)=>{"use strict";e.d(b,{d:()=>j});var z=e(10696),k=e(10686);class j{constructor(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._valueCache={},this._engine=K,this._noUBO=!K.supportsUniformBuffers||k,this._dynamic=e,this._name=z??"no-name",this._data=b||[],this._uniformLocations={},this._uniformSizes={},this._uniformArraySizes={},this._uniformLocationPointer=0,this._needSync=!1,this._engine._features.trackUbosInFrame&&(this._buffers=[],this._bufferIndex=-1,this._createBufferOnWrite=!1,this._currentFrameId=0),this._noUBO?(this.updateMatrix3x3=this._updateMatrix3x3ForEffect,this.updateMatrix2x2=this._updateMatrix2x2ForEffect,this.updateFloat=this._updateFloatForEffect,this.updateFloat2=this._updateFloat2ForEffect,this.updateFloat3=this._updateFloat3ForEffect,this.updateFloat4=this._updateFloat4ForEffect,this.updateFloatArray=this._updateFloatArrayForEffect,this.updateArray=this._updateArrayForEffect,this.updateIntArray=this._updateIntArrayForEffect,this.updateUIntArray=this._updateUIntArrayForEffect,this.qj=this._updateMatrixForEffect,this.updateMatrices=this._updateMatricesForEffect,this.updateVector3=this._updateVector3ForEffect,this.updateVector4=this._updateVector4ForEffect,this.updateColor3=this._updateColor3ForEffect,this.updateColor4=this._updateColor4ForEffect,this.updateDirectColor4=this._updateDirectColor4ForEffect,this.updateInt=this._updateIntForEffect,this.updateInt2=this._updateInt2ForEffect,this.updateInt3=this._updateInt3ForEffect,this.updateInt4=this._updateInt4ForEffect,this.updateUInt=this._updateUIntForEffect,this.updateUInt2=this._updateUInt2ForEffect,this.updateUInt3=this._updateUInt3ForEffect,this.updateUInt4=this._updateUInt4ForEffect):(this._engine._uniformBuffers.push(this),this.updateMatrix3x3=this._updateMatrix3x3ForUniform,this.updateMatrix2x2=this._updateMatrix2x2ForUniform,this.updateFloat=this._updateFloatForUniform,this.updateFloat2=this._updateFloat2ForUniform,this.updateFloat3=this._updateFloat3ForUniform,this.updateFloat4=this._updateFloat4ForUniform,this.updateFloatArray=this._updateFloatArrayForUniform,this.updateArray=this._updateArrayForUniform,this.updateIntArray=this._updateIntArrayForUniform,this.updateUIntArray=this._updateUIntArrayForUniform,this.qj=this._updateMatrixForUniform,this.updateMatrices=this._updateMatricesForUniform,this.updateVector3=this._updateVector3ForUniform,this.updateVector4=this._updateVector4ForUniform,this.updateColor3=this._updateColor3ForUniform,this.updateColor4=this._updateColor4ForUniform,this.updateDirectColor4=this._updateDirectColor4ForUniform,this.updateInt=this._updateIntForUniform,this.updateInt2=this._updateInt2ForUniform,this.updateInt3=this._updateInt3ForUniform,this.updateInt4=this._updateInt4ForUniform,this.updateUInt=this._updateUIntForUniform,this.updateUInt2=this._updateUInt2ForUniform,this.updateUInt3=this._updateUInt3ForUniform,this.updateUInt4=this._updateUInt4ForUniform)}get useUbo(){return!this._noUBO}get isSync(){return!this._needSync}isDynamic(){return void 0!==this._dynamic}getData(){return this._bufferData}getBuffer(){return this._buffer}_fillAlignment(K){let b;if(b=K<=2?K:4,this._uniformLocationPointer%b!==0){const K=this._uniformLocationPointer;this._uniformLocationPointer+=b-this._uniformLocationPointer%b;const e=this._uniformLocationPointer-K;for(let b=0;b<e;b++)this._data.push(0)}}addUniform(K,b){let e,z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this._noUBO&&void 0===this._uniformLocations[K]){if(z>0){if(b instanceof Array)throw"addUniform should not be use with Array in UBO: "+K;if(this._fillAlignment(4),this._uniformArraySizes[K]={strideSize:b,arraySize:z},16==b)b*=z;else{b=b*z+(4-b)*z}e=[];for(let K=0;K<b;K++)e.push(0)}else{if(b instanceof Array)e=b,b=e.length;else{e=[];for(let K=0;K<b;K++)e.push(0)}this._fillAlignment(b)}this._uniformSizes[K]=b,this._uniformLocations[K]=this._uniformLocationPointer,this._uniformLocationPointer+=b;for(let K=0;K<b;K++)this._data.push(e[K]);this._needSync=!0}}addMatrix(K,b){this.addUniform(K,Array.prototype.slice.call(b.Ti()))}addFloat2(K,b,e){const z=[b,e];this.addUniform(K,z)}addFloat3(K,b,e,z){const k=[b,e,z];this.addUniform(K,k)}addColor3(K,b){const e=[b.r,b.g,b.b];this.addUniform(K,e)}addColor4(K,b,e){const z=[b.r,b.g,b.b,e];this.addUniform(K,z)}addVector3(K,b){const e=[b.x,b.y,b.z];this.addUniform(K,e)}addMatrix3x3(K){this.addUniform(K,12)}addMatrix2x2(K){this.addUniform(K,8)}create(){this._noUBO||this._buffer||(this._fillAlignment(4),this._bufferData=new Float32Array(this._data),this._rebuild(),this._needSync=!0)}_getNames(){const K=[];let b=0;for(const e in this._uniformLocations)if(K.push(e),10===++b)break;return K.join(",")}_rebuild(){!this._noUBO&&this._bufferData&&(this._dynamic?this._buffer=this._engine.createDynamicUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()):this._buffer=this._engine.createUniformBuffer(this._bufferData,this._name+"_UniformList:"+this._getNames()),this._engine._features.trackUbosInFrame&&(this._buffers.push([this._buffer,this._engine._features.checkUbosContentBeforeUpload?this._bufferData.slice():void 0]),this._bufferIndex=this._buffers.length-1,this._createBufferOnWrite=!1))}_rebuildAfterContextLost(){this._engine._features.trackUbosInFrame&&(this._buffers=[],this._currentFrameId=0),this._rebuild()}get _numBuffers(){return this._buffers.length}get _indexBuffer(){return this._bufferIndex}get name(){return this._name}get currentEffect(){return this._currentEffect}_buffersEqual(K,b){for(let e=0;e<K.length;++e)if(K[e]!==b[e])return!1;return!0}_copyBuffer(K,b){for(let e=0;e<K.length;++e)b[e]=K[e]}update(){if(!this._noUBO)if(this.bindUniformBuffer(),this._buffer)if(this._dynamic||this._needSync){if(this._buffers&&this._buffers.length>1&&this._buffers[this._bufferIndex][1]){if(this._buffersEqual(this._bufferData,this._buffers[this._bufferIndex][1]))return this._needSync=!1,void(this._createBufferOnWrite=this._engine._features.trackUbosInFrame);this._copyBuffer(this._bufferData,this._buffers[this._bufferIndex][1])}this._engine.updateUniformBuffer(this._buffer,this._bufferData),this._engine._features._collectUbosUpdatedInFrame&&(j._UpdatedUbosInFrame[this._name]||(j._UpdatedUbosInFrame[this._name]=0),j._UpdatedUbosInFrame[this._name]++),this._needSync=!1,this._createBufferOnWrite=this._engine._features.trackUbosInFrame}else this._createBufferOnWrite=this._engine._features.trackUbosInFrame;else this.create()}_createNewBuffer(){this._bufferIndex+1<this._buffers.length?(this._bufferIndex++,this._buffer=this._buffers[this._bufferIndex][0],this._createBufferOnWrite=!1,this._needSync=!0):this._rebuild()}_checkNewFrame(){this._engine._features.trackUbosInFrame&&this._currentFrameId!==this._engine.frameId&&(this._currentFrameId=this._engine.frameId,this._createBufferOnWrite=!1,this._buffers&&this._buffers.length>0?(this._needSync=0!==this._bufferIndex,this._bufferIndex=0,this._buffer=this._buffers[this._bufferIndex][0]):this._bufferIndex=-1)}updateUniform(K,b,e){this._checkNewFrame();let k=this._uniformLocations[K];if(void 0===k){if(this._buffer)return void z.b.Error("Cannot add an uniform after UBO has been created. uniformName="+K);this.addUniform(K,e),k=this._uniformLocations[K]}if(this._buffer||this.create(),this._dynamic)for(let z=0;z<e;z++)this._bufferData[k+z]=b[z];else{let K=!1;for(let z=0;z<e;z++)(16===e&&!this._engine._features.uniformBufferHardCheckMatrix||this._bufferData[k+z]!==Math.fround(b[z]))&&(K=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[k+z]=b[z]);this._needSync=this._needSync||K}}updateUniformArray(K,b,e){this._checkNewFrame();const j=this._uniformLocations[K];if(void 0===j)return void z.b.Error("Cannot add an uniform Array dynamically. Please, add it using addUniform and make sure that uniform buffers are supported by the current engine.");this._buffer||this.create();const T=this._uniformArraySizes[K];if(this._dynamic)for(let z=0;z<e;z++)this._bufferData[j+z]=b[z];else{let K=!1,z=0,F=0;for(let l=0;l<e;l++)if(this._bufferData[j+4*F+z]!==k.f.FloatRound(b[l])&&(K=!0,this._createBufferOnWrite&&this._createNewBuffer(),this._bufferData[j+4*F+z]=b[l]),z++,z===T.strideSize){for(;z<4;z++)this._bufferData[j+4*F+z]=0;z=0,F++}this._needSync=this._needSync||K}}_cacheMatrix(K,b){this._checkNewFrame();const e=this._valueCache[K],z=b.updateFlag;return(void 0===e||e!==z)&&(this._valueCache[K]=z,!0)}_updateMatrix3x3ForUniform(K,b){for(let e=0;e<3;e++)j._TempBuffer[4*e]=b[3*e],j._TempBuffer[4*e+1]=b[3*e+1],j._TempBuffer[4*e+2]=b[3*e+2],j._TempBuffer[4*e+3]=0;this.updateUniform(K,j._TempBuffer,12)}_updateMatrix3x3ForEffect(K,b){this._currentEffect.setMatrix3x3(K,b)}_updateMatrix2x2ForEffect(K,b){this._currentEffect.setMatrix2x2(K,b)}_updateMatrix2x2ForUniform(K,b){for(let e=0;e<2;e++)j._TempBuffer[4*e]=b[2*e],j._TempBuffer[4*e+1]=b[2*e+1],j._TempBuffer[4*e+2]=0,j._TempBuffer[4*e+3]=0;this.updateUniform(K,j._TempBuffer,8)}_updateFloatForEffect(K,b){this._currentEffect.setFloat(K,b)}_updateFloatForUniform(K,b){j._TempBuffer[0]=b,this.updateUniform(K,j._TempBuffer,1)}_updateFloat2ForEffect(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setFloat2(K+z,b,e)}_updateFloat2ForUniform(K,b,e){j._TempBuffer[0]=b,j._TempBuffer[1]=e,this.updateUniform(K,j._TempBuffer,2)}_updateFloat3ForEffect(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setFloat3(K+k,b,e,z)}_updateFloat3ForUniform(K,b,e,z){j._TempBuffer[0]=b,j._TempBuffer[1]=e,j._TempBuffer[2]=z,this.updateUniform(K,j._TempBuffer,3)}_updateFloat4ForEffect(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setFloat4(K+j,b,e,z,k)}_updateFloat4ForUniform(K,b,e,z,k){j._TempBuffer[0]=b,j._TempBuffer[1]=e,j._TempBuffer[2]=z,j._TempBuffer[3]=k,this.updateUniform(K,j._TempBuffer,4)}_updateFloatArrayForEffect(K,b){this._currentEffect.setFloatArray(K,b)}_updateFloatArrayForUniform(K,b){this.updateUniformArray(K,b,b.length)}_updateArrayForEffect(K,b){this._currentEffect.setArray(K,b)}_updateArrayForUniform(K,b){this.updateUniformArray(K,b,b.length)}_updateIntArrayForEffect(K,b){this._currentEffect.setIntArray(K,b)}_updateIntArrayForUniform(K,b){j._TempBufferInt32View.set(b),this.updateUniformArray(K,j._TempBuffer,b.length)}_updateUIntArrayForEffect(K,b){this._currentEffect.setUIntArray(K,b)}_updateUIntArrayForUniform(K,b){j._TempBufferUInt32View.set(b),this.updateUniformArray(K,j._TempBuffer,b.length)}_updateMatrixForEffect(K,b){this._currentEffect.setMatrix(K,b)}_updateMatrixForUniform(K,b){this._cacheMatrix(K,b)&&this.updateUniform(K,b.Ti(),16)}_updateMatricesForEffect(K,b){this._currentEffect.setMatrices(K,b)}_updateMatricesForUniform(K,b){this.updateUniform(K,b,b.length)}_updateVector3ForEffect(K,b){this._currentEffect.setVector3(K,b)}_updateVector3ForUniform(K,b){j._TempBuffer[0]=b.x,j._TempBuffer[1]=b.y,j._TempBuffer[2]=b.z,this.updateUniform(K,j._TempBuffer,3)}_updateVector4ForEffect(K,b){this._currentEffect.setVector4(K,b)}_updateVector4ForUniform(K,b){j._TempBuffer[0]=b.x,j._TempBuffer[1]=b.y,j._TempBuffer[2]=b.z,j._TempBuffer[3]=b.w,this.updateUniform(K,j._TempBuffer,4)}_updateColor3ForEffect(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setColor3(K+e,b)}_updateColor3ForUniform(K,b){j._TempBuffer[0]=b.r,j._TempBuffer[1]=b.g,j._TempBuffer[2]=b.b,this.updateUniform(K,j._TempBuffer,3)}_updateColor4ForEffect(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setColor4(K+z,b,e)}_updateDirectColor4ForEffect(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setDirectColor4(K+e,b)}_updateColor4ForUniform(K,b,e){j._TempBuffer[0]=b.r,j._TempBuffer[1]=b.g,j._TempBuffer[2]=b.b,j._TempBuffer[3]=e,this.updateUniform(K,j._TempBuffer,4)}_updateDirectColor4ForUniform(K,b){j._TempBuffer[0]=b.r,j._TempBuffer[1]=b.g,j._TempBuffer[2]=b.b,j._TempBuffer[3]=b.a,this.updateUniform(K,j._TempBuffer,4)}_updateIntForEffect(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setInt(K+e,b)}_updateIntForUniform(K,b){j._TempBufferInt32View[0]=b,this.updateUniform(K,j._TempBuffer,1)}_updateInt2ForEffect(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setInt2(K+z,b,e)}_updateInt2ForUniform(K,b,e){j._TempBufferInt32View[0]=b,j._TempBufferInt32View[1]=e,this.updateUniform(K,j._TempBuffer,2)}_updateInt3ForEffect(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setInt3(K+k,b,e,z)}_updateInt3ForUniform(K,b,e,z){j._TempBufferInt32View[0]=b,j._TempBufferInt32View[1]=e,j._TempBufferInt32View[2]=z,this.updateUniform(K,j._TempBuffer,3)}_updateInt4ForEffect(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setInt4(K+j,b,e,z,k)}_updateInt4ForUniform(K,b,e,z,k){j._TempBufferInt32View[0]=b,j._TempBufferInt32View[1]=e,j._TempBufferInt32View[2]=z,j._TempBufferInt32View[3]=k,this.updateUniform(K,j._TempBuffer,4)}_updateUIntForEffect(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";this._currentEffect.setUInt(K+e,b)}_updateUIntForUniform(K,b){j._TempBufferUInt32View[0]=b,this.updateUniform(K,j._TempBuffer,1)}_updateUInt2ForEffect(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this._currentEffect.setUInt2(K+z,b,e)}_updateUInt2ForUniform(K,b,e){j._TempBufferUInt32View[0]=b,j._TempBufferUInt32View[1]=e,this.updateUniform(K,j._TempBuffer,2)}_updateUInt3ForEffect(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";this._currentEffect.setUInt3(K+k,b,e,z)}_updateUInt3ForUniform(K,b,e,z){j._TempBufferUInt32View[0]=b,j._TempBufferUInt32View[1]=e,j._TempBufferUInt32View[2]=z,this.updateUniform(K,j._TempBuffer,3)}_updateUInt4ForEffect(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";this._currentEffect.setUInt4(K+j,b,e,z,k)}_updateUInt4ForUniform(K,b,e,z,k){j._TempBufferUInt32View[0]=b,j._TempBufferUInt32View[1]=e,j._TempBufferUInt32View[2]=z,j._TempBufferUInt32View[3]=k,this.updateUniform(K,j._TempBuffer,4)}setTexture(K,b){this._currentEffect.setTexture(K,b)}setTextureArray(K,b){this._currentEffect.setTextureArray(K,b)}bindTexture(K,b){this._currentEffect._bindTexture(K,b)}updateUniformDirectly(K,b){this.updateUniform(K,b,b.length),this.update()}bindToEffect(K,b){this._currentEffect=K,this._currentEffectName=b}bindUniformBuffer(){!this._noUBO&&this._buffer&&this._currentEffect&&this._currentEffect.bindUniformBuffer(this._buffer,this._currentEffectName)}unbindEffect(){this._currentEffect=void 0,this._currentEffectName=void 0}setDataBuffer(K){if(!this._buffers)return this._buffer===K;for(let b=0;b<this._buffers.length;++b){if(this._buffers[b][0]===K)return this._bufferIndex=b,this._buffer=K,this._createBufferOnWrite=!1,this._currentEffect=void 0,!0}return!1}dispose(){if(this._noUBO)return;const K=this._engine._uniformBuffers,b=K.indexOf(this);if(-1!==b&&(K[b]=K[K.length-1],K.pop()),this._engine._features.trackUbosInFrame&&this._buffers)for(let e=0;e<this._buffers.length;++e){const K=this._buffers[e][0];this._engine._releaseBuffer(K)}else this._buffer&&this._engine._releaseBuffer(this._buffer)&&(this._buffer=null)}}j._UpdatedUbosInFrame={},j._MAX_UNIFORM_SIZE=256,j._TempBuffer=new Float32Array(j._MAX_UNIFORM_SIZE),j._TempBufferInt32View=new Int32Array(j._TempBuffer.buffer),j._TempBufferUInt32View=new Uint32Array(j._TempBuffer.buffer)},11291:(K,b,e)=>{"use strict";e.d(b,{e:()=>T,i:()=>z});var z,k,j=e(10967);!function(K){K[K.LOCAL=0]="LOCAL",K[K.WORLD=1]="WORLD",K[K.BONE=2]="BONE"}(z||(z={}));class T{}T.X=new j.k(1,0,0),T.Y=new j.k(0,1,0),T.Z=new j.k(0,0,1),function(K){K[K.X=0]="X",K[K.Y=1]="Y",K[K.Z=2]="Z"}(k||(k={}))},10994:(K,b,e)=>{"use strict";e.d(b,{c:()=>X,g:()=>t,i:()=>U});var z=e(10975),k=e(10799),j=e(10969),T=e(10984);function F(K){return Math.pow(K,j.g)}function l(K){return K<=.04045?.0773993808*K:Math.pow(.947867299*(K+.055),2.4)}function Y(K){return Math.pow(K,j.e)}function A(K){return K<=.0031308?12.92*K:1.055*Math.pow(K,.41666)-.055}class X{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.r=K,this.g=b,this.b=e}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+"}"}getClassName(){return"hb"}getHashCode(){let K=255*this.r|0;return K=397*K^255*this.g,K=397*K^255*this.b,K}toArray(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K[b]=this.r,K[b+1]=this.g,K[b+2]=this.b,this}Sc(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return X.FromArrayToRef(K,b,this),this}toColor4(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new t(this.r,this.g,this.b,K)}Ti(){return[this.r,this.g,this.b]}toLuminance(){return.3*this.r+.59*this.g+.11*this.b}multiply(K){return new X(this.r*K.r,this.g*K.g,this.b*K.b)}multiplyToRef(K,b){return b.r=this.r*K.r,b.g=this.g*K.g,b.b=this.b*K.b,b}multiplyInPlace(K){return this.r*=K.r,this.g*=K.g,this.b*=K.b,this}multiplyByFloats(K,b,e){return new X(this.r*K,this.g*b,this.b*e)}divide(K){throw new ReferenceError("Can not divide a color")}divideToRef(K,b){throw new ReferenceError("Can not divide a color")}divideInPlace(K){throw new ReferenceError("Can not divide a color")}minimizeInPlace(K){return this.minimizeInPlaceFromFloats(K.r,K.g,K.b)}maximizeInPlace(K){return this.maximizeInPlaceFromFloats(K.r,K.g,K.b)}minimizeInPlaceFromFloats(K,b,e){return this.r=Math.min(K,this.r),this.g=Math.min(b,this.g),this.b=Math.min(e,this.b),this}maximizeInPlaceFromFloats(K,b,e){return this.r=Math.max(K,this.r),this.g=Math.max(b,this.g),this.b=Math.max(e,this.b),this}floorToRef(K){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(K){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}equals(K){return K&&this.r===K.r&&this.g===K.g&&this.b===K.b}equalsFloats(K,b,e){return this.equalsToFloats(K,b,e)}equalsToFloats(K,b,e){return this.r===K&&this.g===b&&this.b===e}equalsWithEpsilon(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.c;return(0,T.w)(this.r,K.r,b)&&(0,T.w)(this.g,K.g,b)&&(0,T.w)(this.b,K.b,b)}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(K){throw new ReferenceError("Can not negate a color")}scale(K){return new X(this.r*K,this.g*K,this.b*K)}scaleInPlace(K){return this.r*=K,this.g*=K,this.b*=K,this}scaleToRef(K,b){return b.r=this.r*K,b.g=this.g*K,b.b=this.b*K,b}scaleAndAddToRef(K,b){return b.r+=this.r*K,b.g+=this.g*K,b.b+=this.b*K,b}clampToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;return e.r=(0,T.e)(this.r,K,b),e.g=(0,T.e)(this.g,K,b),e.b=(0,T.e)(this.b,K,b),e}add(K){return new X(this.r+K.r,this.g+K.g,this.b+K.b)}addInPlace(K){return this.r+=K.r,this.g+=K.g,this.b+=K.b,this}addInPlaceFromFloats(K,b,e){return this.r+=K,this.g+=b,this.b+=e,this}addToRef(K,b){return b.r=this.r+K.r,b.g=this.g+K.g,b.b=this.b+K.b,b}Qc(K){return new X(this.r-K.r,this.g-K.g,this.b-K.b)}subtractToRef(K,b){return b.r=this.r-K.r,b.g=this.g-K.g,b.b=this.b-K.b,b}$h(K){return this.r-=K.r,this.g-=K.g,this.b-=K.b,this}subtractFromFloats(K,b,e){return new X(this.r-K,this.g-b,this.b-e)}subtractFromFloatsToRef(K,b,e,z){return z.r=this.r-K,z.g=this.g-b,z.b=this.b-e,z}clone(){return new X(this.r,this.g,this.b)}p(K){return this.r=K.r,this.g=K.g,this.b=K.b,this}Yd(K,b,e){return this.r=K,this.g=b,this.b=e,this}set(K,b,e){return this.Yd(K,b,e)}Wd(K){return this.r=this.g=this.b=K,this}toHexString(){const K=Math.round(255*this.r),b=Math.round(255*this.g),e=Math.round(255*this.b);return"#"+(0,T.v)(K)+(0,T.v)(b)+(0,T.v)(e)}fromHexString(K){return"#"!==K.substring(0,1)||7!==K.length||(this.r=parseInt(K.substring(1,3),16)/255,this.g=parseInt(K.substring(3,5),16)/255,this.b=parseInt(K.substring(5,7),16)/255),this}toHSV(){return this.toHSVToRef(new X)}toHSVToRef(K){const b=this.r,e=this.g,z=this.b,k=Math.max(b,e,z),j=Math.min(b,e,z);let T=0,F=0;const l=k,Y=k-j;return 0!==k&&(F=Y/k),k!=j&&(k==b?(T=(e-z)/Y,e<z&&(T+=6)):k==e?T=(z-b)/Y+2:k==z&&(T=(b-e)/Y+4),T*=60),K.r=T,K.g=F,K.b=l,K}toLinearSpace(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=new X;return this.toLinearSpaceToRef(b,K),b}toLinearSpaceToRef(K){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(K.r=l(this.r),K.g=l(this.g),K.b=l(this.b)):(K.r=F(this.r),K.g=F(this.g),K.b=F(this.b)),this}toGammaSpace(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=new X;return this.toGammaSpaceToRef(b,K),b}toGammaSpaceToRef(K){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(K.r=A(this.r),K.g=A(this.g),K.b=A(this.b)):(K.r=Y(this.r),K.g=Y(this.g),K.b=Y(this.b)),this}static HSVtoRGBToRef(K,b,e,z){const k=e*b,j=K/60,T=k*(1-Math.abs(j%2-1));let F=0,l=0,Y=0;j>=0&&j<=1?(F=k,l=T):j>=1&&j<=2?(F=T,l=k):j>=2&&j<=3?(l=k,Y=T):j>=3&&j<=4?(l=T,Y=k):j>=4&&j<=5?(F=T,Y=k):j>=5&&j<=6&&(F=k,Y=T);const A=e-k;return z.r=F+A,z.g=l+A,z.b=Y+A,z}static FromHSV(K,b,e){const z=new X(0,0,0);return X.HSVtoRGBToRef(K,b,e,z),z}static FromHexString(K){return new X(0,0,0).fromHexString(K)}static Bg(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new X(K[b],K[b+1],K[b+2])}static FromArrayToRef(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;e.r=K[b],e.g=K[b+1],e.b=K[b+2]}static FromInts(K,b,e){return new X(K/255,b/255,e/255)}static Lerp(K,b,e){const z=new X(0,0,0);return X.LerpToRef(K,b,e,z),z}static LerpToRef(K,b,e,z){z.r=K.r+(b.r-K.r)*e,z.g=K.g+(b.g-K.g)*e,z.b=K.b+(b.b-K.b)*e}static Hermite(K,b,e,z,k){const j=k*k,T=k*j,F=2*T-3*j+1,l=-2*T+3*j,Y=T-2*j+k,A=T-j,t=K.r*F+e.r*l+b.r*Y+z.r*A,U=K.g*F+e.g*l+b.g*Y+z.g*A,B=K.b*F+e.b*l+b.b*Y+z.b*A;return new X(t,U,B)}static Hermite1stDerivative(K,b,e,z,k){const j=X.Black();return this.Hermite1stDerivativeToRef(K,b,e,z,k,j),j}static Hermite1stDerivativeToRef(K,b,e,z,k,j){const T=k*k;j.r=6*(T-k)*K.r+(3*T-4*k+1)*b.r+6*(-T+k)*e.r+(3*T-2*k)*z.r,j.g=6*(T-k)*K.g+(3*T-4*k+1)*b.g+6*(-T+k)*e.g+(3*T-2*k)*z.g,j.b=6*(T-k)*K.b+(3*T-4*k+1)*b.b+6*(-T+k)*e.b+(3*T-2*k)*z.b}static Red(){return new X(1,0,0)}static Green(){return new X(0,1,0)}static Blue(){return new X(0,0,1)}static Black(){return new X(0,0,0)}static get BlackReadOnly(){return X._BlackReadOnly}static White(){return new X(1,1,1)}static Purple(){return new X(.5,0,.5)}static Magenta(){return new X(1,0,1)}static Yellow(){return new X(1,1,0)}static Gray(){return new X(.5,.5,.5)}static Teal(){return new X(0,1,1)}static Random(){return new X(Math.random(),Math.random(),Math.random())}}X._BlackReadOnly=X.Black(),Object.defineProperties(X.prototype,{dimension:{value:[3]},rank:{value:1}});class t{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=K,this.g=b,this.b=e,this.a=z}Ti(){return[this.r,this.g,this.b,this.a]}toArray(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K[b]=this.r,K[b+1]=this.g,K[b+2]=this.b,K[b+3]=this.a,this}Sc(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=K[b],this.g=K[b+1],this.b=K[b+2],this.a=K[b+3],this}equals(K){return K&&this.r===K.r&&this.g===K.g&&this.b===K.b&&this.a===K.a}add(K){return new t(this.r+K.r,this.g+K.g,this.b+K.b,this.a+K.a)}addToRef(K,b){return b.r=this.r+K.r,b.g=this.g+K.g,b.b=this.b+K.b,b.a=this.a+K.a,b}addInPlace(K){return this.r+=K.r,this.g+=K.g,this.b+=K.b,this.a+=K.a,this}addInPlaceFromFloats(K,b,e,z){return this.r+=K,this.g+=b,this.b+=e,this.a+=z,this}Qc(K){return new t(this.r-K.r,this.g-K.g,this.b-K.b,this.a-K.a)}subtractToRef(K,b){return b.r=this.r-K.r,b.g=this.g-K.g,b.b=this.b-K.b,b.a=this.a-K.a,b}$h(K){return this.r-=K.r,this.g-=K.g,this.b-=K.b,this.a-=K.a,this}subtractFromFloats(K,b,e,z){return new t(this.r-K,this.g-b,this.b-e,this.a-z)}subtractFromFloatsToRef(K,b,e,z,k){return k.r=this.r-K,k.g=this.g-b,k.b=this.b-e,k.a=this.a-z,k}scale(K){return new t(this.r*K,this.g*K,this.b*K,this.a*K)}scaleInPlace(K){return this.r*=K,this.g*=K,this.b*=K,this.a*=K,this}scaleToRef(K,b){return b.r=this.r*K,b.g=this.g*K,b.b=this.b*K,b.a=this.a*K,b}scaleAndAddToRef(K,b){return b.r+=this.r*K,b.g+=this.g*K,b.b+=this.b*K,b.a+=this.a*K,b}clampToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;return e.r=(0,T.e)(this.r,K,b),e.g=(0,T.e)(this.g,K,b),e.b=(0,T.e)(this.b,K,b),e.a=(0,T.e)(this.a,K,b),e}multiply(K){return new t(this.r*K.r,this.g*K.g,this.b*K.b,this.a*K.a)}multiplyToRef(K,b){return b.r=this.r*K.r,b.g=this.g*K.g,b.b=this.b*K.b,b.a=this.a*K.a,b}multiplyInPlace(K){return this.r*=K.r,this.g*=K.g,this.b*=K.b,this.a*=K.a,this}multiplyByFloats(K,b,e,z){return new t(this.r*K,this.g*b,this.b*e,this.a*z)}divide(K){throw new ReferenceError("Can not divide a color")}divideToRef(K,b){throw new ReferenceError("Can not divide a color")}divideInPlace(K){throw new ReferenceError("Can not divide a color")}minimizeInPlace(K){return this.r=Math.min(this.r,K.r),this.g=Math.min(this.g,K.g),this.b=Math.min(this.b,K.b),this.a=Math.min(this.a,K.a),this}maximizeInPlace(K){return this.r=Math.max(this.r,K.r),this.g=Math.max(this.g,K.g),this.b=Math.max(this.b,K.b),this.a=Math.max(this.a,K.a),this}minimizeInPlaceFromFloats(K,b,e,z){return this.r=Math.min(K,this.r),this.g=Math.min(b,this.g),this.b=Math.min(e,this.b),this.a=Math.min(z,this.a),this}maximizeInPlaceFromFloats(K,b,e,z){return this.r=Math.max(K,this.r),this.g=Math.max(b,this.g),this.b=Math.max(e,this.b),this.a=Math.max(z,this.a),this}floorToRef(K){throw new ReferenceError("Can not floor a color")}floor(){throw new ReferenceError("Can not floor a color")}fractToRef(K){throw new ReferenceError("Can not fract a color")}fract(){throw new ReferenceError("Can not fract a color")}negate(){throw new ReferenceError("Can not negate a color")}negateInPlace(){throw new ReferenceError("Can not negate a color")}negateToRef(K){throw new ReferenceError("Can not negate a color")}equalsWithEpsilon(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:j.c;return(0,T.w)(this.r,K.r,b)&&(0,T.w)(this.g,K.g,b)&&(0,T.w)(this.b,K.b,b)&&(0,T.w)(this.a,K.a,b)}equalsToFloats(K,b,e,z){return this.r===K&&this.g===b&&this.b===e&&this.a===z}toString(){return"{R: "+this.r+" G:"+this.g+" B:"+this.b+" A:"+this.a+"}"}getClassName(){return"pb"}getHashCode(){let K=255*this.r|0;return K=397*K^255*this.g,K=397*K^255*this.b,K=397*K^255*this.a,K}clone(){return(new t).p(this)}p(K){return this.r=K.r,this.g=K.g,this.b=K.b,this.a=K.a,this}Yd(K,b,e,z){return this.r=K,this.g=b,this.b=e,this.a=z,this}set(K,b,e,z){return this.Yd(K,b,e,z)}Wd(K){return this.r=this.g=this.b=this.a=K,this}toHexString(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=Math.round(255*this.r),e=Math.round(255*this.g),z=Math.round(255*this.b);if(K)return"#"+(0,T.v)(b)+(0,T.v)(e)+(0,T.v)(z);const k=Math.round(255*this.a);return"#"+(0,T.v)(b)+(0,T.v)(e)+(0,T.v)(z)+(0,T.v)(k)}fromHexString(K){return"#"!==K.substring(0,1)||9!==K.length&&7!==K.length||(this.r=parseInt(K.substring(1,3),16)/255,this.g=parseInt(K.substring(3,5),16)/255,this.b=parseInt(K.substring(5,7),16)/255,9===K.length&&(this.a=parseInt(K.substring(7,9),16)/255)),this}toLinearSpace(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=new t;return this.toLinearSpaceToRef(b,K),b}toLinearSpaceToRef(K){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(K.r=l(this.r),K.g=l(this.g),K.b=l(this.b)):(K.r=F(this.r),K.g=F(this.g),K.b=F(this.b)),K.a=this.a,this}toGammaSpace(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=new t;return this.toGammaSpaceToRef(b,K),b}toGammaSpaceToRef(K){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(K.r=A(this.r),K.g=A(this.g),K.b=A(this.b)):(K.r=Y(this.r),K.g=Y(this.g),K.b=Y(this.b)),K.a=this.a,this}static FromHexString(K){return"#"!==K.substring(0,1)||9!==K.length&&7!==K.length?new t(0,0,0,0):new t(0,0,0,1).fromHexString(K)}static Lerp(K,b,e){return t.LerpToRef(K,b,e,new t)}static LerpToRef(K,b,e,z){return z.r=K.r+(b.r-K.r)*e,z.g=K.g+(b.g-K.g)*e,z.b=K.b+(b.b-K.b)*e,z.a=K.a+(b.a-K.a)*e,z}static Hermite(K,b,e,z,k){const j=k*k,T=k*j,F=2*T-3*j+1,l=-2*T+3*j,Y=T-2*j+k,A=T-j,X=K.r*F+e.r*l+b.r*Y+z.r*A,U=K.g*F+e.g*l+b.g*Y+z.g*A,B=K.b*F+e.b*l+b.b*Y+z.b*A,u=K.a*F+e.a*l+b.a*Y+z.a*A;return new t(X,U,B,u)}static Hermite1stDerivative(K,b,e,z,k){const j=new t;return this.Hermite1stDerivativeToRef(K,b,e,z,k,j),j}static Hermite1stDerivativeToRef(K,b,e,z,k,j){const T=k*k;j.r=6*(T-k)*K.r+(3*T-4*k+1)*b.r+6*(-T+k)*e.r+(3*T-2*k)*z.r,j.g=6*(T-k)*K.g+(3*T-4*k+1)*b.g+6*(-T+k)*e.g+(3*T-2*k)*z.g,j.b=6*(T-k)*K.b+(3*T-4*k+1)*b.b+6*(-T+k)*e.b+(3*T-2*k)*z.b,j.a=6*(T-k)*K.a+(3*T-4*k+1)*b.a+6*(-T+k)*e.a+(3*T-2*k)*z.a}static FromColor3(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t(K.r,K.g,K.b,b)}static Bg(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(K[b],K[b+1],K[b+2],K[b+3])}static FromArrayToRef(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;e.r=K[b],e.g=K[b+1],e.b=K[b+2],e.a=K[b+3]}static FromInts(K,b,e,z){return new t(K/255,b/255,e/255,z/255)}static CheckColors4(K,b){if(K.length===3*b){const b=[];for(let e=0;e<K.length;e+=3){const z=e/3*4;b[z]=K[e],b[z+1]=K[e+1],b[z+2]=K[e+2],b[z+3]=1}return b}return K}}Object.defineProperties(t.prototype,{dimension:{value:[4]},rank:{value:1}});class U{}U.hb=(0,z.e)(3,X.Black),U.pb=(0,z.e)(3,(()=>new t(0,0,0,0))),(0,k.e)("BABYLON.Color3",X),(0,k.e)("BABYLON.Color4",t)},10969:(K,b,e)=>{"use strict";e.d(b,{c:()=>T,d:()=>j,e:()=>z,g:()=>k});const z=1/2.2,k=2.2,j=(1+Math.sqrt(5))/2,T=.001},11066:(K,b,e)=>{"use strict";e.d(b,{e:()=>k});var z=e(11068);class k{static GetPlanes(K){const b=[];for(let e=0;e<6;e++)b.push(new z.b(0,0,0,0));return k.GetPlanesToRef(K,b),b}static GetNearPlaneToRef(K,b){const e=K.m;b.k.x=e[3]+e[2],b.k.y=e[7]+e[6],b.k.z=e[11]+e[10],b.d=e[15]+e[14],b.normalize()}static GetFarPlaneToRef(K,b){const e=K.m;b.k.x=e[3]-e[2],b.k.y=e[7]-e[6],b.k.z=e[11]-e[10],b.d=e[15]-e[14],b.normalize()}static GetLeftPlaneToRef(K,b){const e=K.m;b.k.x=e[3]+e[0],b.k.y=e[7]+e[4],b.k.z=e[11]+e[8],b.d=e[15]+e[12],b.normalize()}static GetRightPlaneToRef(K,b){const e=K.m;b.k.x=e[3]-e[0],b.k.y=e[7]-e[4],b.k.z=e[11]-e[8],b.d=e[15]-e[12],b.normalize()}static GetTopPlaneToRef(K,b){const e=K.m;b.k.x=e[3]-e[1],b.k.y=e[7]-e[5],b.k.z=e[11]-e[9],b.d=e[15]-e[13],b.normalize()}static GetBottomPlaneToRef(K,b){const e=K.m;b.k.x=e[3]+e[1],b.k.y=e[7]+e[5],b.k.z=e[11]+e[9],b.d=e[15]+e[13],b.normalize()}static GetPlanesToRef(K,b){k.GetNearPlaneToRef(K,b[0]),k.GetFarPlaneToRef(K,b[1]),k.GetLeftPlaneToRef(K,b[2]),k.GetRightPlaneToRef(K,b[3]),k.GetTopPlaneToRef(K,b[4]),k.GetBottomPlaneToRef(K,b[5])}static IsPointInFrustum(K,b){for(let e=0;e<6;e++)if(b[e].dotCoordinate(K)<0)return!1;return!0}}},11117:(K,b,e)=>{"use strict";e.d(b,{d:()=>F,h:()=>l});var z=e(10936),k=e(10967),j=e(10938);class T{static extractMinAndMaxIndexed(K,b,e,z,k,j){for(let T=e;T<e+z;T++){const e=3*b[T],z=K[e],F=K[e+1],l=K[e+2];k.minimizeInPlaceFromFloats(z,F,l),j.maximizeInPlaceFromFloats(z,F,l)}}static extractMinAndMax(K,b,e,z,k,j){for(let T=b,F=b*z;T<b+e;T++,F+=z){const b=K[F],e=K[F+1],z=K[F+2];k.minimizeInPlaceFromFloats(b,e,z),j.maximizeInPlaceFromFloats(b,e,z)}}}function F(K,b,e,z){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;const F=new k.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new k.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return T.extractMinAndMaxIndexed(K,b,e,z,F,l),j&&(F.x-=F.x*j.x+j.y,F.y-=F.y*j.x+j.y,F.z-=F.z*j.x+j.y,l.x+=l.x*j.x+j.y,l.y+=l.y*j.x+j.y,l.z+=l.z*j.x+j.y),{minimum:F,maximum:l}}function l(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4?arguments[4]:void 0;const F=new k.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),l=new k.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return j||(j=3),T.extractMinAndMax(K,b,e,j,F,l),z&&(F.x-=F.x*z.x+z.y,F.y-=F.y*z.x+z.y,F.z-=F.z*z.x+z.y,l.x+=l.x*z.x+z.y,l.y+=l.y*z.x+z.y,l.z+=l.z*z.x+z.y),{minimum:F,maximum:l}}(0,z.b)([j.e.filter((function(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];let[z,k]=b;return!Array.isArray(z)&&!Array.isArray(k)}))],T,"extractMinAndMaxIndexed",null),(0,z.b)([j.e.filter((function(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];let[z]=b;return!Array.isArray(z)}))],T,"extractMinAndMax",null)},11485:(K,b,e)=>{"use strict";e.d(b,{b:()=>z.e});e(11291),e(10994),e(10969),e(11066),e(11491),e(11068),e(11179);var z=e(10967);e(11252)},11491:(K,b,e)=>{"use strict";e.d(b,{b:()=>F,f:()=>A,j:()=>X});var z,k=e(10984),j=e(10967),T=e(10969);!function(K){K[K.CW=0]="CW",K[K.CCW=1]="CCW"}(z||(z={}));class F{static Interpolate(K,b,e,z,k){const j=1-3*z+3*b,T=3*z-6*b,F=3*b;let l=K;for(let Y=0;Y<5;Y++){const b=l*l;l-=(j*(b*l)+T*b+F*l-K)*(1/(3*j*b+2*T*l+F)),l=Math.min(1,Math.max(0,l))}return 3*Math.pow(1-l,2)*l*e+3*(1-l)*Math.pow(l,2)*k+Math.pow(l,3)}}class l{constructor(K){this._radians=K,this._radians<0&&(this._radians+=2*Math.PI)}degrees(){return 180*this._radians/Math.PI}radians(){return this._radians}static BetweenTwoPoints(K,b){const e=b.Qc(K),z=Math.atan2(e.y,e.x);return new l(z)}static BetweenTwoVectors(K,b){let e=K.lengthSquared()*b.lengthSquared();if(0===e)return new l(Math.PI/2);e=Math.sqrt(e);let z=K.dot(b)/e;z=(0,k.e)(z,-1,1);const j=Math.acos(z);return new l(j)}static FromRadians(K){return new l(K)}static FromDegrees(K){return new l(K*Math.PI/180)}}class Y{constructor(K,b,e){this.startPoint=K,this.midPoint=b,this.endPoint=e;const z=Math.pow(b.x,2)+Math.pow(b.y,2),k=(Math.pow(K.x,2)+Math.pow(K.y,2)-z)/2,T=(z-Math.pow(e.x,2)-Math.pow(e.y,2))/2,F=(K.x-b.x)*(b.y-e.y)-(b.x-e.x)*(K.y-b.y);this.centerPoint=new j.h((k*(b.y-e.y)-T*(K.y-b.y))/F,((K.x-b.x)*T-(b.x-e.x)*k)/F),this.radius=this.centerPoint.Qc(this.startPoint).length(),this.startAngle=l.BetweenTwoPoints(this.centerPoint,this.startPoint);const Y=this.startAngle.degrees();let A=l.BetweenTwoPoints(this.centerPoint,this.midPoint).degrees(),X=l.BetweenTwoPoints(this.centerPoint,this.endPoint).degrees();A-Y>180&&(A-=360),A-Y<-180&&(A+=360),X-A>180&&(X-=360),X-A<-180&&(X+=360),this.orientation=A-Y<0?0:1,this.angle=l.FromDegrees(0===this.orientation?Y-X:X-Y)}}class A{constructor(K,b){this._points=new Array,this._length=0,this.closed=!1,this._points.push(new j.h(K,b))}addLineTo(K,b){if(this.closed)return this;const e=new j.h(K,b),z=this._points[this._points.length-1];return this._points.push(e),this._length+=e.Qc(z).length(),this}addArcTo(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const T=this._points[this._points.length-1],F=new j.h(K,b),l=new j.h(e,z),A=new Y(T,F,l);let X=A.angle.radians()/k;0===A.orientation&&(X*=-1);let t=A.startAngle.radians()+X;for(let j=0;j<k;j++){const K=Math.cos(t)*A.radius+A.centerPoint.x,b=Math.sin(t)*A.radius+A.centerPoint.y;this.addLineTo(K,b),t+=X}return this}addQuadraticCurveTo(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:36;if(this.closed)return this;const j=(K,b,e,z)=>(1-K)*(1-K)*b+2*K*(1-K)*e+K*K*z,T=this._points[this._points.length-1];for(let F=0;F<=k;F++){const l=F/k,Y=j(l,T.x,K,e),A=j(l,T.y,b,z);this.addLineTo(Y,A)}return this}addBezierCurveTo(K,b,e,z,k,j){let T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:36;if(this.closed)return this;const F=(K,b,e,z,k)=>(1-K)*(1-K)*(1-K)*b+3*K*(1-K)*(1-K)*e+3*K*K*(1-K)*z+K*K*K*k,l=this._points[this._points.length-1];for(let Y=0;Y<=T;Y++){const A=Y/T,X=F(A,l.x,K,e,k),t=F(A,l.y,b,z,j);this.addLineTo(X,t)}return this}isPointInside(K){let b=!1;const e=this._points.length;for(let z=e-1,k=0;k<e;z=k++){let e=this._points[z],j=this._points[k],T=j.x-e.x,F=j.y-e.y;if(Math.abs(F)>Number.EPSILON){if(F<0&&(e=this._points[k],T=-T,j=this._points[z],F=-F),K.y<e.y||K.y>j.y)continue;if(K.y===e.y&&K.x===e.x)return!0;{const z=F*(K.x-e.x)-T*(K.y-e.y);if(0===z)return!0;if(z<0)continue;b=!b}}else{if(K.y!==e.y)continue;if(j.x<=K.x&&K.x<=e.x||e.x<=K.x&&K.x<=j.x)return!0}}return b}close(){return this.closed=!0,this}length(){let K=this._length;if(this.closed){const b=this._points[this._points.length-1];K+=this._points[0].Qc(b).length()}return K}area(){const K=this._points.length;let b=0;for(let e=K-1,z=0;z<K;e=z++)b+=this._points[e].x*this._points[z].y-this._points[z].x*this._points[e].y;return.5*b}getPoints(){return this._points}getPointAtLengthPosition(K){if(K<0||K>1)return j.h.Zero();const b=K*this.length();let e=0;for(let z=0;z<this._points.length;z++){const K=(z+1)%this._points.length,k=this._points[z],T=this._points[K].Qc(k),F=T.length()+e;if(b>=e&&b<=F){const K=T.normalize(),z=b-e;return new j.h(k.x+K.x*z,k.y+K.y*z)}e=F}return j.h.Zero()}static StartingAt(K,b){return new A(K,b)}}class X{constructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.path=K,this._curve=new Array,this._distances=new Array,this._tangents=new Array,this._normals=new Array,this._binormals=new Array,this._pointAtData={id:0,point:j.k.Zero(),previousPointArrayIndex:0,position:0,subPosition:0,interpolateReady:!1,interpolationMatrix:j.b.Identity()};for(let k=0;k<K.length;k++)this._curve[k]=K[k].clone();this._raw=e||!1,this._alignTangentsWithPath=z,this._compute(b,z)}getCurve(){return this._curve}getPoints(){return this._curve}length(){return this._distances[this._distances.length-1]}getTangents(){return this._tangents}getNormals(){return this._normals}getBinormals(){return this._binormals}getDistances(){return this._distances}getPointAt(K){return this._updatePointAtData(K).point}getTangentAt(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(K,b),b?j.k.TransformCoordinates(j.k.Forward(),this._pointAtData.interpolationMatrix):this._tangents[this._pointAtData.previousPointArrayIndex]}getNormalAt(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(K,b),b?j.k.TransformCoordinates(j.k.Right(),this._pointAtData.interpolationMatrix):this._normals[this._pointAtData.previousPointArrayIndex]}getBinormalAt(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._updatePointAtData(K,b),b?j.k.TransformCoordinates(j.k.UpReadOnly,this._pointAtData.interpolationMatrix):this._binormals[this._pointAtData.previousPointArrayIndex]}getDistanceAt(K){return this.length()*K}getPreviousPointIndexAt(K){return this._updatePointAtData(K),this._pointAtData.previousPointArrayIndex}getSubPositionAt(K){return this._updatePointAtData(K),this._pointAtData.subPosition}getClosestPositionTo(K){let b=Number.MAX_VALUE,e=0;for(let z=0;z<this._curve.length-1;z++){const k=this._curve[z+0],T=this._curve[z+1].Qc(k).normalize(),F=this._distances[z+1]-this._distances[z+0],l=Math.min(Math.max(j.k.Dot(T,K.Qc(k).normalize()),0)*j.k.Distance(k,K)/F,1),Y=j.k.Distance(k.add(T.scale(l*F)),K);Y<b&&(b=Y,e=(this._distances[z+0]+F*l)/this.length())}return e}slice(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(K<0&&(K=1- -1*K%1),b<0&&(b=1- -1*b%1),K>b){const e=K;K=b,b=e}const e=this.getCurve(),z=this.getPointAt(K);let k=this.getPreviousPointIndexAt(K);const j=this.getPointAt(b),T=this.getPreviousPointIndexAt(b)+1,F=[];return 0!==K&&(k++,F.push(z)),F.push(...e.slice(k,T)),1===b&&1!==K||F.push(j),new X(F,this.getNormalAt(K),this._raw,this._alignTangentsWithPath)}update(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];for(let z=0;z<K.length;z++)this._curve[z].x=K[z].x,this._curve[z].y=K[z].y,this._curve[z].z=K[z].z;return this._compute(b,e),this}_compute(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this._curve.length;if(e<2)return;this._tangents[0]=this._getFirstNonNullVector(0),this._raw||this._tangents[0].normalize(),this._tangents[e-1]=this._curve[e-1].Qc(this._curve[e-2]),this._raw||this._tangents[e-1].normalize();const z=this._tangents[0],k=this._normalVector(z,K);let T,F,l,Y,A;this._normals[0]=k,this._raw||this._normals[0].normalize(),this._binormals[0]=j.k.Cross(z,this._normals[0]),this._raw||this._binormals[0].normalize(),this._distances[0]=0;for(let X=1;X<e;X++)T=this._getLastNonNullVector(X),X<e-1&&(F=this._getFirstNonNullVector(X),this._tangents[X]=b?F:T.add(F),this._tangents[X].normalize()),this._distances[X]=this._distances[X-1]+this._curve[X].Qc(this._curve[X-1]).length(),l=this._tangents[X],A=this._binormals[X-1],this._normals[X]=j.k.Cross(A,l),this._raw||(0===this._normals[X].length()?(Y=this._normals[X-1],this._normals[X]=Y.clone()):this._normals[X].normalize()),this._binormals[X]=j.k.Cross(l,this._normals[X]),this._raw||this._binormals[X].normalize();this._pointAtData.id=NaN}_getFirstNonNullVector(K){let b=1,e=this._curve[K+b].Qc(this._curve[K]);for(;0===e.length()&&K+b+1<this._curve.length;)b++,e=this._curve[K+b].Qc(this._curve[K]);return e}_getLastNonNullVector(K){let b=1,e=this._curve[K].Qc(this._curve[K-b]);for(;0===e.length()&&K>b+1;)b++,e=this._curve[K].Qc(this._curve[K-b]);return e}_normalVector(K,b){let e,z=K.length();if(0===z&&(z=1),void 0===b||null===b){let b;b=(0,k.w)(Math.abs(K.y)/z,1,T.c)?(0,k.w)(Math.abs(K.x)/z,1,T.c)?(0,k.w)(Math.abs(K.z)/z,1,T.c)?j.k.Zero():new j.k(0,0,1):new j.k(1,0,0):new j.k(0,-1,0),e=j.k.Cross(K,b)}else e=j.k.Cross(K,b),j.k.CrossToRef(e,K,e);return e.normalize(),e}_updatePointAtData(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._pointAtData.id===K)return this._pointAtData.interpolateReady||this._updateInterpolationMatrix(),this._pointAtData;this._pointAtData.id=K;const e=this.getPoints();if(K<=0)return this._setPointAtData(0,0,e[0],0,b);if(K>=1)return this._setPointAtData(1,1,e[e.length-1],e.length-1,b);let z,k=e[0],T=0;const F=K*this.length();for(let l=1;l<e.length;l++){z=e[l];const Y=j.k.Distance(k,z);if(T+=Y,T===F)return this._setPointAtData(K,1,z,l,b);if(T>F){const e=(T-F)/Y,j=k.Qc(z),A=z.add(j.scaleInPlace(e));return this._setPointAtData(K,1-e,A,l-1,b)}k=z}return this._pointAtData}_setPointAtData(K,b,e,z,k){return this._pointAtData.point=e,this._pointAtData.position=K,this._pointAtData.subPosition=b,this._pointAtData.previousPointArrayIndex=z,this._pointAtData.interpolateReady=k,k&&this._updateInterpolationMatrix(),this._pointAtData}_updateInterpolationMatrix(){this._pointAtData.interpolationMatrix=j.b.Identity();const K=this._pointAtData.previousPointArrayIndex;if(K!==this._tangents.length-1){const b=K+1,e=this._tangents[K].clone(),z=this._normals[K].clone(),k=this._binormals[K].clone(),T=this._tangents[b].clone(),F=this._normals[b].clone(),l=this._binormals[b].clone(),Y=j.d.RotationQuaternionFromAxis(z,k,e),A=j.d.RotationQuaternionFromAxis(F,l,T);j.d.Slerp(Y,A,this._pointAtData.subPosition).toRotationMatrix(this._pointAtData.interpolationMatrix)}}}},11068:(K,b,e)=>{"use strict";e.d(b,{b:()=>k});var z=e(10967);class k{constructor(K,b,e,k){this.k=new z.k(K,b,e),this.d=k}Ti(){return[this.k.x,this.k.y,this.k.z,this.d]}clone(){return new k(this.k.x,this.k.y,this.k.z,this.d)}getClassName(){return"Plane"}getHashCode(){let K=this.k.getHashCode();return K=397*K^this.d,K}normalize(){const K=Math.sqrt(this.k.x*this.k.x+this.k.y*this.k.y+this.k.z*this.k.z);let b=0;return 0!==K&&(b=1/K),this.k.x*=b,this.k.y*=b,this.k.z*=b,this.d*=b,this}transform(K){const b=k._TmpMatrix;K.invertToRef(b);const e=b.m,z=this.k.x,j=this.k.y,T=this.k.z,F=this.d,l=z*e[0]+j*e[1]+T*e[2]+F*e[3],Y=z*e[4]+j*e[5]+T*e[6]+F*e[7],A=z*e[8]+j*e[9]+T*e[10]+F*e[11],X=z*e[12]+j*e[13]+T*e[14]+F*e[15];return new k(l,Y,A,X)}dotCoordinate(K){return this.k.x*K.x+this.k.y*K.y+this.k.z*K.z+this.d}copyFromPoints(K,b,e){const z=b.x-K.x,k=b.y-K.y,j=b.z-K.z,T=e.x-K.x,F=e.y-K.y,l=e.z-K.z,Y=k*l-j*F,A=j*T-z*l,X=z*F-k*T,t=Math.sqrt(Y*Y+A*A+X*X);let U;return U=0!==t?1/t:0,this.k.x=Y*U,this.k.y=A*U,this.k.z=X*U,this.d=-(this.k.x*K.x+this.k.y*K.y+this.k.z*K.z),this}isFrontFacingTo(K,b){return z.k.Dot(this.k,K)<=b}signedDistanceTo(K){return z.k.Dot(K,this.k)+this.d}static Bg(K){return new k(K[0],K[1],K[2],K[3])}static FromPoints(K,b,e){const z=new k(0,0,0,0);return z.copyFromPoints(K,b,e),z}static FromPositionAndNormal(K,b){const e=new k(0,0,0,0);return this.FromPositionAndNormalToRef(K,b,e)}static FromPositionAndNormalToRef(K,b,e){return e.k.p(b),e.k.normalize(),e.d=-K.dot(e.k),e}static SignedDistanceToPlaneFromPositionAndNormal(K,b,e){const k=-(b.x*K.x+b.y*K.y+b.z*K.z);return z.k.Dot(e,b)+k}}k._TmpMatrix=z.b.Identity()},10984:(K,b,e)=>{"use strict";function z(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1401298e-51;return Math.abs(K-b)<=e}function k(K,b){return K===b?K:Math.random()*(b-K)+K}function j(K,b,e){return K+(b-K)*e}function T(K,b,e,z,k){const j=k*k,T=k*j;return K*(2*T-3*j+1)+e*(-2*T+3*j)+b*(T-2*j+k)+z*(T-j)}function F(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(e,Math.max(b,K))}function l(K){return K-=2*Math.PI*Math.floor((K+Math.PI)/(2*Math.PI))}function Y(K){const b=K.toString(16);return K<=15?("0"+b).toUpperCase():b.toUpperCase()}function A(K){if(Math.log2)return Math.floor(Math.log2(K));if(K<0)return NaN;if(0===K)return-1/0;let b=0;if(K<1){for(;K<1;)b++,K*=2;b=-b}else if(K>1)for(;K>1;)b++,K=Math.floor(K/2);return b}function X(K,b){const e=K%b;return 0===e?b:X(b,e)}e.d(b,{e:()=>F,g:()=>T,j:()=>X,l:()=>A,m:()=>j,q:()=>l,t:()=>k,v:()=>Y,w:()=>z})},11179:(K,b,e)=>{"use strict";e.d(b,{c:()=>z});class z{constructor(K,b){this.width=K,this.height=b}toString(){return`{W: ${this.width}, H: ${this.height}}`}getClassName(){return"Size"}getHashCode(){let K=0|this.width;return K=397*K^this.height,K}p(K){this.width=K.width,this.height=K.height}Yd(K,b){return this.width=K,this.height=b,this}set(K,b){return this.Yd(K,b)}multiplyByFloats(K,b){return new z(this.width*K,this.height*b)}clone(){return new z(this.width,this.height)}equals(K){return!!K&&(this.width===K.width&&this.height===K.height)}get surface(){return this.width*this.height}static Zero(){return new z(0,0)}add(K){return new z(this.width+K.width,this.height+K.height)}Qc(K){return new z(this.width-K.width,this.height-K.height)}scale(K){return new z(this.width*K,this.height*K)}static Lerp(K,b,e){const k=K.width+(b.width-K.width)*e,j=K.height+(b.height-K.height)*e;return new z(k,j)}}},10967:(K,b,e)=>{"use strict";e.d(b,{b:()=>B,d:()=>U,e:()=>m,h:()=>A,k:()=>X,o:()=>t});var z=e(10969),k=e(10975),j=e(10799),T=e(10778),F=e(10720),l=e(10984);const Y=K=>parseInt(K.toString().replace(/\W/g,""));class A{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=K,this.y=b}toString(){return`{X: ${this.x} Y: ${this.y}}`}getClassName(){return"Vector2"}getHashCode(){let K=Y(this.x);return K=397*K^Y(this.y),K}toArray(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K[b]=this.x,K[b+1]=this.y,this}Sc(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return A.FromArrayToRef(K,b,this),this}Ti(){return[this.x,this.y]}p(K){return this.x=K.x,this.y=K.y,this}Yd(K,b){return this.x=K,this.y=b,this}set(K,b){return this.Yd(K,b)}Wd(K){return this.Yd(K,K)}add(K){return new A(this.x+K.x,this.y+K.y)}addToRef(K,b){return b.x=this.x+K.x,b.y=this.y+K.y,b}addInPlace(K){return this.x+=K.x,this.y+=K.y,this}addInPlaceFromFloats(K,b){return this.x+=K,this.y+=b,this}addVector3(K){return new A(this.x+K.x,this.y+K.y)}Qc(K){return new A(this.x-K.x,this.y-K.y)}subtractToRef(K,b){return b.x=this.x-K.x,b.y=this.y-K.y,b}$h(K){return this.x-=K.x,this.y-=K.y,this}multiplyInPlace(K){return this.x*=K.x,this.y*=K.y,this}multiply(K){return new A(this.x*K.x,this.y*K.y)}multiplyToRef(K,b){return b.x=this.x*K.x,b.y=this.y*K.y,b}multiplyByFloats(K,b){return new A(this.x*K,this.y*b)}divide(K){return new A(this.x/K.x,this.y/K.y)}divideToRef(K,b){return b.x=this.x/K.x,b.y=this.y/K.y,b}divideInPlace(K){return this.x=this.x/K.x,this.y=this.y/K.y,this}minimizeInPlace(K){return this.minimizeInPlaceFromFloats(K.x,K.y)}maximizeInPlace(K){return this.maximizeInPlaceFromFloats(K.x,K.y)}minimizeInPlaceFromFloats(K,b){return this.x=Math.min(K,this.x),this.y=Math.min(b,this.y),this}maximizeInPlaceFromFloats(K,b){return this.x=Math.max(K,this.x),this.y=Math.max(b,this.y),this}subtractFromFloats(K,b){return new A(this.x-K,this.y-b)}subtractFromFloatsToRef(K,b,e){return e.x=this.x-K,e.y=this.y-b,e}negate(){return new A(-this.x,-this.y)}negateInPlace(){return this.x*=-1,this.y*=-1,this}negateToRef(K){return K.x=-this.x,K.y=-this.y,K}scaleInPlace(K){return this.x*=K,this.y*=K,this}scale(K){return new A(this.x*K,this.y*K)}scaleToRef(K,b){return b.x=this.x*K,b.y=this.y*K,b}scaleAndAddToRef(K,b){return b.x+=this.x*K,b.y+=this.y*K,b}equals(K){return K&&this.x===K.x&&this.y===K.y}equalsWithEpsilon(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.c;return K&&(0,l.w)(this.x,K.x,b)&&(0,l.w)(this.y,K.y,b)}equalsToFloats(K,b){return this.x===K&&this.y===b}floor(){return new A(Math.floor(this.x),Math.floor(this.y))}floorToRef(K){return K.x=Math.floor(this.x),K.y=Math.floor(this.y),K}fract(){return new A(this.x-Math.floor(this.x),this.y-Math.floor(this.y))}fractToRef(K){return K.x=this.x-Math.floor(this.x),K.y=this.y-Math.floor(this.y),K}rotateToRef(K,b){const e=Math.cos(K),z=Math.sin(K),k=e*this.x-z*this.y,j=z*this.x+e*this.y;return b.x=k,b.y=j,b}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}lengthSquared(){return this.x*this.x+this.y*this.y}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(K){return 0===K||1===K?this:this.scaleInPlace(1/K)}normalizeToNew(){const K=new A;return this.normalizeToRef(K),K}normalizeToRef(K){const b=this.length();return 0===b&&(K.x=this.x,K.y=this.y),this.scaleToRef(1/b,K)}clone(){return new A(this.x,this.y)}dot(K){return this.x*K.x+this.y*K.y}static Zero(){return new A(0,0)}static One(){return new A(1,1)}static Random(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new A((0,l.t)(K,b),(0,l.t)(K,b))}static RandomToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Yd((0,l.t)(K,b),(0,l.t)(K,b))}static get ZeroReadOnly(){return A._ZeroReadOnly}static Bg(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new A(K[b],K[b+1])}static FromArrayToRef(K,b,e){return e.x=K[b],e.y=K[b+1],e}static FromFloatsToRef(K,b,e){return e.Yd(K,b),e}static CatmullRom(K,b,e,z,k){const j=k*k,T=k*j,F=.5*(2*b.x+(-K.x+e.x)*k+(2*K.x-5*b.x+4*e.x-z.x)*j+(-K.x+3*b.x-3*e.x+z.x)*T),l=.5*(2*b.y+(-K.y+e.y)*k+(2*K.y-5*b.y+4*e.y-z.y)*j+(-K.y+3*b.y-3*e.y+z.y)*T);return new A(F,l)}static ClampToRef(K,b,e,z){return z.x=(0,l.e)(K.x,b.x,e.x),z.y=(0,l.e)(K.y,b.y,e.y),z}static Clamp(K,b,e){const z=(0,l.e)(K.x,b.x,e.x),k=(0,l.e)(K.y,b.y,e.y);return new A(z,k)}static Hermite(K,b,e,z,k){const j=k*k,T=k*j,F=2*T-3*j+1,l=-2*T+3*j,Y=T-2*j+k,X=T-j,t=K.x*F+e.x*l+b.x*Y+z.x*X,U=K.y*F+e.y*l+b.y*Y+z.y*X;return new A(t,U)}static Hermite1stDerivative(K,b,e,z,k){return this.Hermite1stDerivativeToRef(K,b,e,z,k,new A)}static Hermite1stDerivativeToRef(K,b,e,z,k,j){const T=k*k;return j.x=6*(T-k)*K.x+(3*T-4*k+1)*b.x+6*(-T+k)*e.x+(3*T-2*k)*z.x,j.y=6*(T-k)*K.y+(3*T-4*k+1)*b.y+6*(-T+k)*e.y+(3*T-2*k)*z.y,j}static Lerp(K,b,e){return A.LerpToRef(K,b,e,new A)}static LerpToRef(K,b,e,z){return z.x=K.x+(b.x-K.x)*e,z.y=K.y+(b.y-K.y)*e,z}static Dot(K,b){return K.x*b.x+K.y*b.y}static Normalize(K){return A.NormalizeToRef(K,new A)}static NormalizeToRef(K,b){return K.normalizeToRef(b),b}static Minimize(K,b){const e=K.x<b.x?K.x:b.x,z=K.y<b.y?K.y:b.y;return new A(e,z)}static Maximize(K,b){const e=K.x>b.x?K.x:b.x,z=K.y>b.y?K.y:b.y;return new A(e,z)}static Transform(K,b){return A.TransformToRef(K,b,new A)}static TransformToRef(K,b,e){const z=b.m,k=K.x*z[0]+K.y*z[4]+z[12],j=K.x*z[1]+K.y*z[5]+z[13];return e.x=k,e.y=j,e}static PointInTriangle(K,b,e,z){const k=.5*(-e.y*z.x+b.y*(-e.x+z.x)+b.x*(e.y-z.y)+e.x*z.y),j=k<0?-1:1,T=(b.y*z.x-b.x*z.y+(z.y-b.y)*K.x+(b.x-z.x)*K.y)*j,F=(b.x*e.y-b.y*e.x+(b.y-e.y)*K.x+(e.x-b.x)*K.y)*j;return T>0&&F>0&&T+F<2*k*j}static Distance(K,b){return Math.sqrt(A.DistanceSquared(K,b))}static DistanceSquared(K,b){const e=K.x-b.x,z=K.y-b.y;return e*e+z*z}static Center(K,b){return A.CenterToRef(K,b,new A)}static CenterToRef(K,b,e){return e.Yd((K.x+b.x)/2,(K.y+b.y)/2)}static DistanceOfPointFromSegment(K,b,e){const z=A.DistanceSquared(b,e);if(0===z)return A.Distance(K,b);const k=e.Qc(b),j=Math.max(0,Math.min(1,A.Dot(K.Qc(b),k)/z)),T=b.add(k.multiplyByFloats(j,j));return A.Distance(K,T)}}A._ZeroReadOnly=A.Zero(),Object.defineProperties(A.prototype,{dimension:{value:[2]},rank:{value:1}});class X{get x(){return this._x}set x(K){this._x=K,this._isDirty=!0}get y(){return this._y}set y(K){this._y=K,this._isDirty=!0}get z(){return this._z}set z(K){this._z=K,this._isDirty=!0}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this._isDirty=!0,this._x=K,this._y=b,this._z=e}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z}}`}getClassName(){return"gb"}getHashCode(){let K=Y(this._x);return K=397*K^Y(this._y),K=397*K^Y(this._z),K}Ti(){return[this._x,this._y,this._z]}toArray(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K[b]=this._x,K[b+1]=this._y,K[b+2]=this._z,this}Sc(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return X.FromArrayToRef(K,b,this),this}toQuaternion(){return U.RotationYawPitchRoll(this._y,this._x,this._z)}addInPlace(K){return this._x+=K._x,this._y+=K._y,this._z+=K._z,this._isDirty=!0,this}addInPlaceFromFloats(K,b,e){return this._x+=K,this._y+=b,this._z+=e,this._isDirty=!0,this}add(K){return new X(this._x+K._x,this._y+K._y,this._z+K._z)}addToRef(K,b){return b._x=this._x+K._x,b._y=this._y+K._y,b._z=this._z+K._z,b._isDirty=!0,b}$h(K){return this._x-=K._x,this._y-=K._y,this._z-=K._z,this._isDirty=!0,this}Qc(K){return new X(this._x-K._x,this._y-K._y,this._z-K._z)}subtractToRef(K,b){return this.subtractFromFloatsToRef(K._x,K._y,K._z,b)}subtractFromFloats(K,b,e){return new X(this._x-K,this._y-b,this._z-e)}subtractFromFloatsToRef(K,b,e,z){return z._x=this._x-K,z._y=this._y-b,z._z=this._z-e,z._isDirty=!0,z}negate(){return new X(-this._x,-this._y,-this._z)}negateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}negateToRef(K){return K._x=-1*this._x,K._y=-1*this._y,K._z=-1*this._z,K._isDirty=!0,K}scaleInPlace(K){return this._x*=K,this._y*=K,this._z*=K,this._isDirty=!0,this}scale(K){return new X(this._x*K,this._y*K,this._z*K)}scaleToRef(K,b){return b._x=this._x*K,b._y=this._y*K,b._z=this._z*K,b._isDirty=!0,b}getNormalToRef(K){const b=this.length();let e=Math.acos(this.y/b);const z=Math.atan2(this.z,this.x);e>Math.PI/2?e-=Math.PI/2:e+=Math.PI/2;const k=b*Math.sin(e)*Math.cos(z),j=b*Math.cos(e),T=b*Math.sin(e)*Math.sin(z);return K.set(k,j,T),K}applyRotationQuaternionToRef(K,b){const e=this._x,z=this._y,k=this._z,j=K._x,T=K._y,F=K._z,l=K._w,Y=2*(T*k-F*z),A=2*(F*e-j*k),X=2*(j*z-T*e);return b._x=e+l*Y+T*X-F*A,b._y=z+l*A+F*Y-j*X,b._z=k+l*X+j*A-T*Y,b._isDirty=!0,b}applyRotationQuaternionInPlace(K){return this.applyRotationQuaternionToRef(K,this)}applyRotationQuaternion(K){return this.applyRotationQuaternionToRef(K,new X)}scaleAndAddToRef(K,b){return b._x+=this._x*K,b._y+=this._y*K,b._z+=this._z*K,b._isDirty=!0,b}projectOnPlane(K,b){return this.projectOnPlaneToRef(K,b,new X)}projectOnPlaneToRef(K,b,e){const z=K.k,k=K.d,j=u.gb[0];this.subtractToRef(b,j),j.normalize();const T=X.Dot(j,z);if(Math.abs(T)<1e-10)e.Wd(1/0);else{const K=-(X.Dot(b,z)+k)/T,F=j.scaleInPlace(K);b.addToRef(F,e)}return e}equals(K){return K&&this._x===K._x&&this._y===K._y&&this._z===K._z}equalsWithEpsilon(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.c;return K&&(0,l.w)(this._x,K._x,b)&&(0,l.w)(this._y,K._y,b)&&(0,l.w)(this._z,K._z,b)}equalsToFloats(K,b,e){return this._x===K&&this._y===b&&this._z===e}multiplyInPlace(K){return this._x*=K._x,this._y*=K._y,this._z*=K._z,this._isDirty=!0,this}multiply(K){return this.multiplyByFloats(K._x,K._y,K._z)}multiplyToRef(K,b){return b._x=this._x*K._x,b._y=this._y*K._y,b._z=this._z*K._z,b._isDirty=!0,b}multiplyByFloats(K,b,e){return new X(this._x*K,this._y*b,this._z*e)}divide(K){return new X(this._x/K._x,this._y/K._y,this._z/K._z)}divideToRef(K,b){return b._x=this._x/K._x,b._y=this._y/K._y,b._z=this._z/K._z,b._isDirty=!0,b}divideInPlace(K){return this._x=this._x/K._x,this._y=this._y/K._y,this._z=this._z/K._z,this._isDirty=!0,this}minimizeInPlace(K){return this.minimizeInPlaceFromFloats(K._x,K._y,K._z)}maximizeInPlace(K){return this.maximizeInPlaceFromFloats(K._x,K._y,K._z)}minimizeInPlaceFromFloats(K,b,e){return K<this._x&&(this.x=K),b<this._y&&(this.y=b),e<this._z&&(this.z=e),this}maximizeInPlaceFromFloats(K,b,e){return K>this._x&&(this.x=K),b>this._y&&(this.y=b),e>this._z&&(this.z=e),this}isNonUniformWithinEpsilon(K){const b=Math.abs(this._x),e=Math.abs(this._y);if(!(0,l.w)(b,e,K))return!0;const z=Math.abs(this._z);return!(0,l.w)(b,z,K)||!(0,l.w)(e,z,K)}get isNonUniform(){const K=Math.abs(this._x);if(K!==Math.abs(this._y))return!0;return K!==Math.abs(this._z)}floorToRef(K){return K._x=Math.floor(this._x),K._y=Math.floor(this._y),K._z=Math.floor(this._z),K._isDirty=!0,K}floor(){return new X(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z))}fractToRef(K){return K._x=this.x-Math.floor(this._x),K._y=this.y-Math.floor(this._y),K._z=this.z-Math.floor(this._z),K._isDirty=!0,K}fract(){return new X(this.x-Math.floor(this._x),this.y-Math.floor(this._y),this.z-Math.floor(this._z))}length(){return Math.sqrt(this.lengthSquared())}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z}get hasAZeroComponent(){return this._x*this._y*this._z===0}normalize(){return this.normalizeFromLength(this.length())}reorderInPlace(K){if("xyz"===(K=K.toLowerCase()))return this;const b=u.gb[0].p(this);return this.x=b[K[0]],this.y=b[K[1]],this.z=b[K[2]],this}rotateByQuaternionToRef(K,b){return K.toRotationMatrix(u.Matrix[0]),X.TransformCoordinatesToRef(this,u.Matrix[0],b),b}rotateByQuaternionAroundPointToRef(K,b,e){return this.subtractToRef(b,u.gb[0]),u.gb[0].rotateByQuaternionToRef(K,u.gb[0]),b.addToRef(u.gb[0],e),e}cross(K){return X.CrossToRef(this,K,new X)}normalizeFromLength(K){return 0===K||1===K?this:this.scaleInPlace(1/K)}normalizeToNew(){return this.normalizeToRef(new X)}normalizeToRef(K){const b=this.length();return 0===b||1===b?(K._x=this._x,K._y=this._y,K._z=this._z,K._isDirty=!0,K):this.scaleToRef(1/b,K)}clone(){return new X(this._x,this._y,this._z)}p(K){return this.Yd(K._x,K._y,K._z)}Yd(K,b,e){return this._x=K,this._y=b,this._z=e,this._isDirty=!0,this}set(K,b,e){return this.Yd(K,b,e)}Wd(K){return this._x=this._y=this._z=K,this._isDirty=!0,this}static GetClipFactor(K,b,e,z){const k=X.Dot(K,e);return(k-z)/(k-X.Dot(b,e))}static GetAngleBetweenVectors(K,b,e){const z=K.normalizeToRef(u.gb[1]),k=b.normalizeToRef(u.gb[2]);let j=X.Dot(z,k);j=(0,l.e)(j,-1,1);const T=Math.acos(j),F=u.gb[3];return X.CrossToRef(z,k,F),X.Dot(F,e)>0?isNaN(T)?0:T:isNaN(T)?-Math.PI:-Math.acos(j)}static GetAngleBetweenVectorsOnPlane(K,b,e){u.gb[0].p(K);const z=u.gb[0];u.gb[1].p(b);const k=u.gb[1];u.gb[2].p(e);const j=u.gb[2],T=u.gb[3],F=u.gb[4];z.normalize(),k.normalize(),j.normalize(),X.CrossToRef(j,z,T),X.CrossToRef(T,j,F);const Y=Math.atan2(X.Dot(k,T),X.Dot(k,F));return(0,l.q)(Y)}static PitchYawRollToMoveBetweenPointsToRef(K,b,e){const z=m.gb[0];return b.subtractToRef(K,z),e._y=Math.atan2(z.x,z.z)||0,e._x=Math.atan2(Math.sqrt(z.x**2+z.z**2),z.y)||0,e._z=0,e._isDirty=!0,e}static PitchYawRollToMoveBetweenPoints(K,b){const e=X.Zero();return X.PitchYawRollToMoveBetweenPointsToRef(K,b,e)}static SlerpToRef(K,b,e,k){e=(0,l.e)(e,0,1);const j=u.gb[0],T=u.gb[1];j.p(K);const F=j.length();j.normalizeFromLength(F),T.p(b);const Y=T.length();T.normalizeFromLength(Y);const A=X.Dot(j,T);let t,U;if(A<1-z.c){const K=Math.acos(A),b=1/Math.sin(K);t=Math.sin((1-e)*K)*b,U=Math.sin(e*K)*b}else t=1-e,U=e;return j.scaleInPlace(t),T.scaleInPlace(U),k.p(j).addInPlace(T),k.scaleInPlace((0,l.m)(F,Y,e)),k}static SmoothToRef(K,b,e,z,k){return X.SlerpToRef(K,b,0===z?1:e/z,k),k}static Bg(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new X(K[b],K[b+1],K[b+2])}static FromFloatArray(K,b){return X.Bg(K,b)}static FromArrayToRef(K,b,e){return e._x=K[b],e._y=K[b+1],e._z=K[b+2],e._isDirty=!0,e}static FromFloatArrayToRef(K,b,e){return X.FromArrayToRef(K,b,e)}static FromFloatsToRef(K,b,e,z){return z.Yd(K,b,e),z}static Zero(){return new X(0,0,0)}static One(){return new X(1,1,1)}static Up(){return new X(0,1,0)}static get UpReadOnly(){return X._UpReadOnly}static get DownReadOnly(){return X._DownReadOnly}static get RightReadOnly(){return X._RightReadOnly}static get LeftReadOnly(){return X._LeftReadOnly}static get LeftHandedForwardReadOnly(){return X._LeftHandedForwardReadOnly}static get RightHandedForwardReadOnly(){return X._RightHandedForwardReadOnly}static get LeftHandedBackwardReadOnly(){return X._LeftHandedBackwardReadOnly}static get RightHandedBackwardReadOnly(){return X._RightHandedBackwardReadOnly}static get ZeroReadOnly(){return X._ZeroReadOnly}static get OneReadOnly(){return X._OneReadOnly}static Down(){return new X(0,-1,0)}static Forward(){return new X(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?-1:1)}static Backward(){return new X(0,0,arguments.length>0&&void 0!==arguments[0]&&arguments[0]?1:-1)}static Right(){return new X(1,0,0)}static Left(){return new X(-1,0,0)}static Random(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new X((0,l.t)(K,b),(0,l.t)(K,b),(0,l.t)(K,b))}static RandomToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Yd((0,l.t)(K,b),(0,l.t)(K,b),(0,l.t)(K,b))}static TransformCoordinates(K,b){const e=X.Zero();return X.TransformCoordinatesToRef(K,b,e),e}static TransformCoordinatesToRef(K,b,e){return X.TransformCoordinatesFromFloatsToRef(K._x,K._y,K._z,b,e),e}static TransformCoordinatesFromFloatsToRef(K,b,e,z,k){const j=z.m,T=K*j[0]+b*j[4]+e*j[8]+j[12],F=K*j[1]+b*j[5]+e*j[9]+j[13],l=K*j[2]+b*j[6]+e*j[10]+j[14],Y=1/(K*j[3]+b*j[7]+e*j[11]+j[15]);return k._x=T*Y,k._y=F*Y,k._z=l*Y,k._isDirty=!0,k}static TransformNormal(K,b){const e=X.Zero();return X.TransformNormalToRef(K,b,e),e}static TransformNormalToRef(K,b,e){return this.TransformNormalFromFloatsToRef(K._x,K._y,K._z,b,e),e}static TransformNormalFromFloatsToRef(K,b,e,z,k){const j=z.m;return k._x=K*j[0]+b*j[4]+e*j[8],k._y=K*j[1]+b*j[5]+e*j[9],k._z=K*j[2]+b*j[6]+e*j[10],k._isDirty=!0,k}static CatmullRom(K,b,e,z,k){const j=k*k,T=k*j,F=.5*(2*b._x+(-K._x+e._x)*k+(2*K._x-5*b._x+4*e._x-z._x)*j+(-K._x+3*b._x-3*e._x+z._x)*T),l=.5*(2*b._y+(-K._y+e._y)*k+(2*K._y-5*b._y+4*e._y-z._y)*j+(-K._y+3*b._y-3*e._y+z._y)*T),Y=.5*(2*b._z+(-K._z+e._z)*k+(2*K._z-5*b._z+4*e._z-z._z)*j+(-K._z+3*b._z-3*e._z+z._z)*T);return new X(F,l,Y)}static Clamp(K,b,e){const z=new X;return X.ClampToRef(K,b,e,z),z}static ClampToRef(K,b,e,z){let k=K._x;k=k>e._x?e._x:k,k=k<b._x?b._x:k;let j=K._y;j=j>e._y?e._y:j,j=j<b._y?b._y:j;let T=K._z;return T=T>e._z?e._z:T,T=T<b._z?b._z:T,z.Yd(k,j,T),z}static CheckExtends(K,b,e){b.minimizeInPlace(K),e.maximizeInPlace(K)}static Hermite(K,b,e,z,k){const j=k*k,T=k*j,F=2*T-3*j+1,l=-2*T+3*j,Y=T-2*j+k,A=T-j,t=K._x*F+e._x*l+b._x*Y+z._x*A,U=K._y*F+e._y*l+b._y*Y+z._y*A,B=K._z*F+e._z*l+b._z*Y+z._z*A;return new X(t,U,B)}static Hermite1stDerivative(K,b,e,z,k){const j=new X;return this.Hermite1stDerivativeToRef(K,b,e,z,k,j),j}static Hermite1stDerivativeToRef(K,b,e,z,k,j){const T=k*k;return j._x=6*(T-k)*K._x+(3*T-4*k+1)*b._x+6*(-T+k)*e._x+(3*T-2*k)*z._x,j._y=6*(T-k)*K._y+(3*T-4*k+1)*b._y+6*(-T+k)*e._y+(3*T-2*k)*z._y,j._z=6*(T-k)*K._z+(3*T-4*k+1)*b._z+6*(-T+k)*e._z+(3*T-2*k)*z._z,j._isDirty=!0,j}static Lerp(K,b,e){const z=new X(0,0,0);return X.LerpToRef(K,b,e,z),z}static LerpToRef(K,b,e,z){return z._x=K._x+(b._x-K._x)*e,z._y=K._y+(b._y-K._y)*e,z._z=K._z+(b._z-K._z)*e,z._isDirty=!0,z}static Dot(K,b){return K._x*b._x+K._y*b._y+K._z*b._z}dot(K){return this._x*K._x+this._y*K._y+this._z*K._z}static Cross(K,b){const e=new X;return X.CrossToRef(K,b,e),e}static CrossToRef(K,b,e){const z=K._y*b._z-K._z*b._y,k=K._z*b._x-K._x*b._z,j=K._x*b._y-K._y*b._x;return e.Yd(z,k,j),e}static Normalize(K){const b=X.Zero();return X.NormalizeToRef(K,b),b}static NormalizeToRef(K,b){return K.normalizeToRef(b),b}static Project(K,b,e,z){const k=new X;return X.ProjectToRef(K,b,e,z,k),k}static ProjectToRef(K,b,e,z,k){var j;const T=z.width,l=z.height,Y=z.x,A=z.y,t=u.Matrix[1],U=null===(j=F.b.LastCreatedEngine)||void 0===j?void 0:j.isNDCHalfZRange,m=U?1:.5,D=U?0:.5;B.FromValuesToRef(T/2,0,0,0,0,-l/2,0,0,0,0,m,0,Y+T/2,l/2+A,D,1,t);const I=u.Matrix[0];return b.multiplyToRef(e,I),I.multiplyToRef(t,I),X.TransformCoordinatesToRef(K,I,k),k}static Reflect(K,b){return this.ReflectToRef(K,b,new X)}static ReflectToRef(K,b,e){const z=m.gb[0];return z.p(b).scaleInPlace(2*X.Dot(K,b)),e.p(K).$h(z)}static _UnprojectFromInvertedMatrixToRef(K,b,e){X.TransformCoordinatesToRef(K,b,e);const z=b.m,k=K._x*z[3]+K._y*z[7]+K._z*z[11]+z[15];return(0,l.w)(k,1)&&e.scaleInPlace(1/k),e}static UnprojectFromTransform(K,b,e,z,k){return this.Unproject(K,b,e,z,k,B.IdentityReadOnly)}static Unproject(K,b,e,z,k,j){const T=new X;return X.UnprojectToRef(K,b,e,z,k,j,T),T}static UnprojectToRef(K,b,e,z,k,j,T){return X.UnprojectFloatsToRef(K._x,K._y,K._z,b,e,z,k,j,T),T}static UnprojectFloatsToRef(K,b,e,z,k,j,T,l,Y){var A;const t=u.Matrix[0];j.multiplyToRef(T,t),t.multiplyToRef(l,t),t.invert();const U=u.gb[0];return U.x=K/z*2-1,U.y=-(b/k*2-1),null!==(A=F.b.LastCreatedEngine)&&void 0!==A&&A.isNDCHalfZRange?U.z=e:U.z=2*e-1,X._UnprojectFromInvertedMatrixToRef(U,t,Y),Y}static Minimize(K,b){const e=new X;return e.p(K),e.minimizeInPlace(b),e}static Maximize(K,b){const e=new X;return e.p(K),e.maximizeInPlace(b),e}static Distance(K,b){return Math.sqrt(X.DistanceSquared(K,b))}static DistanceSquared(K,b){const e=K._x-b._x,z=K._y-b._y,k=K._z-b._z;return e*e+z*z+k*k}static ProjectOnTriangleToRef(K,b,e,k,j){const T=u.gb[0],F=u.gb[1],Y=u.gb[2],A=u.gb[3],t=u.gb[4];e.subtractToRef(b,T),k.subtractToRef(b,F),k.subtractToRef(e,Y);const U=T.length(),B=F.length(),m=Y.length();if(U<z.c||B<z.c||m<z.c)return j.p(b),X.Distance(K,b);K.subtractToRef(b,t),X.CrossToRef(T,F,A);const D=A.length();if(D<z.c)return j.p(b),X.Distance(K,b);A.normalizeFromLength(D);let I=t.length();if(I<z.c)return j.p(b),0;t.normalizeFromLength(I);const x=X.Dot(A,t),Q=u.gb[5],G=u.gb[6];Q.p(A).scaleInPlace(-I*x),G.p(K).addInPlace(Q);const i=u.gb[4],S=u.gb[5],M=u.gb[7],r=u.gb[8];i.p(T).scaleInPlace(1/U),r.p(F).scaleInPlace(1/B),i.addInPlace(r).scaleInPlace(-1),S.p(T).scaleInPlace(-1/U),r.p(Y).scaleInPlace(1/m),S.addInPlace(r).scaleInPlace(-1),M.p(Y).scaleInPlace(-1/m),r.p(F).scaleInPlace(-1/B),M.addInPlace(r).scaleInPlace(-1);const L=u.gb[9];let c;L.p(G).$h(b),X.CrossToRef(i,L,r),c=X.Dot(r,A);const v=c;L.p(G).$h(e),X.CrossToRef(S,L,r),c=X.Dot(r,A);const w=c;L.p(G).$h(k),X.CrossToRef(M,L,r),c=X.Dot(r,A);const h=c,R=u.gb[10];let n,P;v>0&&w<0?(R.p(T),n=b,P=e):w>0&&h<0?(R.p(Y),n=e,P=k):(R.p(F).scaleInPlace(-1),n=k,P=b);const d=u.gb[9],p=u.gb[4];n.subtractToRef(G,r),P.subtractToRef(G,d),X.CrossToRef(r,d,p);if(!(X.Dot(p,A)<0))return j.p(G),Math.abs(I*x);const a=u.gb[5];X.CrossToRef(R,p,a),a.normalize();const O=u.gb[9];O.p(n).$h(G);const g=O.length();if(g<z.c)return j.p(n),X.Distance(K,n);O.normalizeFromLength(g);const N=X.Dot(a,O),Z=u.gb[7];Z.p(G).addInPlace(a.scaleInPlace(g*N)),r.p(Z).$h(n),I=R.length(),R.normalizeFromLength(I);let y=X.Dot(r,R)/Math.max(I,z.c);return y=(0,l.e)(y,0,1),Z.p(n).addInPlace(R.scaleInPlace(y*I)),j.p(Z),X.Distance(K,Z)}static Center(K,b){return X.CenterToRef(K,b,X.Zero())}static CenterToRef(K,b,e){return e.Yd((K._x+b._x)/2,(K._y+b._y)/2,(K._z+b._z)/2)}static RotationFromAxis(K,b,e){const z=new X;return X.RotationFromAxisToRef(K,b,e,z),z}static RotationFromAxisToRef(K,b,e,z){const k=u.Quaternion[0];return U.RotationQuaternionFromAxisToRef(K,b,e,k),k.toEulerAnglesToRef(z),z}}X._UpReadOnly=X.Up(),X._DownReadOnly=X.Down(),X._LeftHandedForwardReadOnly=X.Forward(!1),X._RightHandedForwardReadOnly=X.Forward(!0),X._LeftHandedBackwardReadOnly=X.Backward(!1),X._RightHandedBackwardReadOnly=X.Backward(!0),X._RightReadOnly=X.Right(),X._LeftReadOnly=X.Left(),X._ZeroReadOnly=X.Zero(),X._OneReadOnly=X.One(),Object.defineProperties(X.prototype,{dimension:{value:[3]},rank:{value:1}});class t{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.x=K,this.y=b,this.z=e,this.w=z}toString(){return`{X: ${this.x} Y: ${this.y} Z: ${this.z} W: ${this.w}}`}getClassName(){return"Vector4"}getHashCode(){let K=Y(this.x);return K=397*K^Y(this.y),K=397*K^Y(this.z),K=397*K^Y(this.w),K}Ti(){return[this.x,this.y,this.z,this.w]}toArray(K,b){return void 0===b&&(b=0),K[b]=this.x,K[b+1]=this.y,K[b+2]=this.z,K[b+3]=this.w,this}Sc(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return t.FromArrayToRef(K,b,this),this}addInPlace(K){return this.x+=K.x,this.y+=K.y,this.z+=K.z,this.w+=K.w,this}addInPlaceFromFloats(K,b,e,z){return this.x+=K,this.y+=b,this.z+=e,this.w+=z,this}add(K){return new t(this.x+K.x,this.y+K.y,this.z+K.z,this.w+K.w)}addToRef(K,b){return b.x=this.x+K.x,b.y=this.y+K.y,b.z=this.z+K.z,b.w=this.w+K.w,b}$h(K){return this.x-=K.x,this.y-=K.y,this.z-=K.z,this.w-=K.w,this}Qc(K){return new t(this.x-K.x,this.y-K.y,this.z-K.z,this.w-K.w)}subtractToRef(K,b){return b.x=this.x-K.x,b.y=this.y-K.y,b.z=this.z-K.z,b.w=this.w-K.w,b}subtractFromFloats(K,b,e,z){return new t(this.x-K,this.y-b,this.z-e,this.w-z)}subtractFromFloatsToRef(K,b,e,z,k){return k.x=this.x-K,k.y=this.y-b,k.z=this.z-e,k.w=this.w-z,k}negate(){return new t(-this.x,-this.y,-this.z,-this.w)}negateInPlace(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this}negateToRef(K){return K.x=-this.x,K.y=-this.y,K.z=-this.z,K.w=-this.w,K}scaleInPlace(K){return this.x*=K,this.y*=K,this.z*=K,this.w*=K,this}scale(K){return new t(this.x*K,this.y*K,this.z*K,this.w*K)}scaleToRef(K,b){return b.x=this.x*K,b.y=this.y*K,b.z=this.z*K,b.w=this.w*K,b}scaleAndAddToRef(K,b){return b.x+=this.x*K,b.y+=this.y*K,b.z+=this.z*K,b.w+=this.w*K,b}equals(K){return K&&this.x===K.x&&this.y===K.y&&this.z===K.z&&this.w===K.w}equalsWithEpsilon(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.c;return K&&(0,l.w)(this.x,K.x,b)&&(0,l.w)(this.y,K.y,b)&&(0,l.w)(this.z,K.z,b)&&(0,l.w)(this.w,K.w,b)}equalsToFloats(K,b,e,z){return this.x===K&&this.y===b&&this.z===e&&this.w===z}multiplyInPlace(K){return this.x*=K.x,this.y*=K.y,this.z*=K.z,this.w*=K.w,this}multiply(K){return new t(this.x*K.x,this.y*K.y,this.z*K.z,this.w*K.w)}multiplyToRef(K,b){return b.x=this.x*K.x,b.y=this.y*K.y,b.z=this.z*K.z,b.w=this.w*K.w,b}multiplyByFloats(K,b,e,z){return new t(this.x*K,this.y*b,this.z*e,this.w*z)}divide(K){return new t(this.x/K.x,this.y/K.y,this.z/K.z,this.w/K.w)}divideToRef(K,b){return b.x=this.x/K.x,b.y=this.y/K.y,b.z=this.z/K.z,b.w=this.w/K.w,b}divideInPlace(K){return this.divideToRef(K,this)}minimizeInPlace(K){return K.x<this.x&&(this.x=K.x),K.y<this.y&&(this.y=K.y),K.z<this.z&&(this.z=K.z),K.w<this.w&&(this.w=K.w),this}maximizeInPlace(K){return K.x>this.x&&(this.x=K.x),K.y>this.y&&(this.y=K.y),K.z>this.z&&(this.z=K.z),K.w>this.w&&(this.w=K.w),this}minimizeInPlaceFromFloats(K,b,e,z){return this.x=Math.min(K,this.x),this.y=Math.min(b,this.y),this.z=Math.min(e,this.z),this.w=Math.min(z,this.w),this}maximizeInPlaceFromFloats(K,b,e,z){return this.x=Math.max(K,this.x),this.y=Math.max(b,this.y),this.z=Math.max(e,this.z),this.w=Math.max(z,this.w),this}floorToRef(K){return K.x=Math.floor(this.x),K.y=Math.floor(this.y),K.z=Math.floor(this.z),K.w=Math.floor(this.w),K}floor(){return new t(Math.floor(this.x),Math.floor(this.y),Math.floor(this.z),Math.floor(this.w))}fractToRef(K){return K.x=this.x-Math.floor(this.x),K.y=this.y-Math.floor(this.y),K.z=this.z-Math.floor(this.z),K.w=this.w-Math.floor(this.w),K}fract(){return new t(this.x-Math.floor(this.x),this.y-Math.floor(this.y),this.z-Math.floor(this.z),this.w-Math.floor(this.w))}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSquared(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(K){return 0===K||1===K?this:this.scaleInPlace(1/K)}normalizeToNew(){return this.normalizeToRef(new t)}normalizeToRef(K){const b=this.length();return 0===b||1===b?(K.x=this.x,K.y=this.y,K.z=this.z,K.w=this.w,K):this.scaleToRef(1/b,K)}toVector3(){return new X(this.x,this.y,this.z)}clone(){return new t(this.x,this.y,this.z,this.w)}p(K){return this.x=K.x,this.y=K.y,this.z=K.z,this.w=K.w,this}Yd(K,b,e,z){return this.x=K,this.y=b,this.z=e,this.w=z,this}set(K,b,e,z){return this.Yd(K,b,e,z)}Wd(K){return this.x=this.y=this.z=this.w=K,this}dot(K){return this.x*K.x+this.y*K.y+this.z*K.z+this.w*K.w}static Bg(K,b){return b||(b=0),new t(K[b],K[b+1],K[b+2],K[b+3])}static FromArrayToRef(K,b,e){return e.x=K[b],e.y=K[b+1],e.z=K[b+2],e.w=K[b+3],e}static FromFloatArrayToRef(K,b,e){return t.FromArrayToRef(K,b,e),e}static FromFloatsToRef(K,b,e,z,k){return k.x=K,k.y=b,k.z=e,k.w=z,k}static Zero(){return new t(0,0,0,0)}static One(){return new t(1,1,1,1)}static Random(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new t((0,l.t)(K,b),(0,l.t)(K,b),(0,l.t)(K,b),(0,l.t)(K,b))}static RandomToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2?arguments[2]:void 0;return e.x=(0,l.t)(K,b),e.y=(0,l.t)(K,b),e.z=(0,l.t)(K,b),e.w=(0,l.t)(K,b),e}static Clamp(K,b,e){return t.ClampToRef(K,b,e,new t)}static ClampToRef(K,b,e,z){return z.x=(0,l.e)(K.x,b.x,e.x),z.y=(0,l.e)(K.y,b.y,e.y),z.z=(0,l.e)(K.z,b.z,e.z),z.w=(0,l.e)(K.w,b.w,e.w),z}static CheckExtends(K,b,e){b.minimizeInPlace(K),e.maximizeInPlace(K)}static get ZeroReadOnly(){return t._ZeroReadOnly}static Normalize(K){return t.NormalizeToRef(K,new t)}static NormalizeToRef(K,b){return K.normalizeToRef(b),b}static Minimize(K,b){const e=new t;return e.p(K),e.minimizeInPlace(b),e}static Maximize(K,b){const e=new t;return e.p(K),e.maximizeInPlace(b),e}static Distance(K,b){return Math.sqrt(t.DistanceSquared(K,b))}static DistanceSquared(K,b){const e=K.x-b.x,z=K.y-b.y,k=K.z-b.z,j=K.w-b.w;return e*e+z*z+k*k+j*j}static Center(K,b){return t.CenterToRef(K,b,new t)}static CenterToRef(K,b,e){return e.x=(K.x+b.x)/2,e.y=(K.y+b.y)/2,e.z=(K.z+b.z)/2,e.w=(K.w+b.w)/2,e}static TransformCoordinates(K,b){return t.TransformCoordinatesToRef(K,b,new t)}static TransformCoordinatesToRef(K,b,e){return t.TransformCoordinatesFromFloatsToRef(K._x,K._y,K._z,b,e),e}static TransformCoordinatesFromFloatsToRef(K,b,e,z,k){const j=z.m,T=K*j[0]+b*j[4]+e*j[8]+j[12],F=K*j[1]+b*j[5]+e*j[9]+j[13],l=K*j[2]+b*j[6]+e*j[10]+j[14],Y=K*j[3]+b*j[7]+e*j[11]+j[15];return k.x=T,k.y=F,k.z=l,k.w=Y,k}static TransformNormal(K,b){return t.TransformNormalToRef(K,b,new t)}static TransformNormalToRef(K,b,e){const z=b.m,k=K.x*z[0]+K.y*z[4]+K.z*z[8],j=K.x*z[1]+K.y*z[5]+K.z*z[9],T=K.x*z[2]+K.y*z[6]+K.z*z[10];return e.x=k,e.y=j,e.z=T,e.w=K.w,e}static TransformNormalFromFloatsToRef(K,b,e,z,k,j){const T=k.m;return j.x=K*T[0]+b*T[4]+e*T[8],j.y=K*T[1]+b*T[5]+e*T[9],j.z=K*T[2]+b*T[6]+e*T[10],j.w=z,j}static FromVector3(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return new t(K._x,K._y,K._z,b)}static Dot(K,b){return K.x*b.x+K.y*b.y+K.z*b.z+K.w*b.w}}t._ZeroReadOnly=t.Zero(),Object.defineProperties(t.prototype,{dimension:{value:[4]},rank:{value:1}});class U{get x(){return this._x}set x(K){this._x=K,this._isDirty=!0}get y(){return this._y}set y(K){this._y=K,this._isDirty=!0}get z(){return this._z}set z(K){this._z=K,this._isDirty=!0}get w(){return this._w}set w(K){this._w=K,this._isDirty=!0}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this._isDirty=!0,this._x=K,this._y=b,this._z=e,this._w=z}toString(){return`{X: ${this._x} Y: ${this._y} Z: ${this._z} W: ${this._w}}`}getClassName(){return"Quaternion"}getHashCode(){let K=Y(this._x);return K=397*K^Y(this._y),K=397*K^Y(this._z),K=397*K^Y(this._w),K}Ti(){return[this._x,this._y,this._z,this._w]}toArray(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return K[b]=this._x,K[b+1]=this._y,K[b+2]=this._z,K[b+3]=this._w,this}Sc(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return U.FromArrayToRef(K,b,this)}equals(K){return K&&this._x===K._x&&this._y===K._y&&this._z===K._z&&this._w===K._w}equalsWithEpsilon(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.c;return K&&(0,l.w)(this._x,K._x,b)&&(0,l.w)(this._y,K._y,b)&&(0,l.w)(this._z,K._z,b)&&(0,l.w)(this._w,K._w,b)}clone(){return new U(this._x,this._y,this._z,this._w)}p(K){return this._x=K._x,this._y=K._y,this._z=K._z,this._w=K._w,this._isDirty=!0,this}Yd(K,b,e,z){return this._x=K,this._y=b,this._z=e,this._w=z,this._isDirty=!0,this}set(K,b,e,z){return this.Yd(K,b,e,z)}Wd(K){return this.Yd(K,K,K,K)}add(K){return new U(this._x+K._x,this._y+K._y,this._z+K._z,this._w+K._w)}addInPlace(K){return this._x+=K._x,this._y+=K._y,this._z+=K._z,this._w+=K._w,this._isDirty=!0,this}addToRef(K,b){return b._x=this._x+K._x,b._y=this._y+K._y,b._z=this._z+K._z,b._w=this._w+K._w,b._isDirty=!0,b}addInPlaceFromFloats(K,b,e,z){return this._x+=K,this._y+=b,this._z+=e,this._w+=z,this._isDirty=!0,this}subtractToRef(K,b){return b._x=this._x-K._x,b._y=this._y-K._y,b._z=this._z-K._z,b._w=this._w-K._w,b._isDirty=!0,b}subtractFromFloats(K,b,e,z){return this.subtractFromFloatsToRef(K,b,e,z,new U)}subtractFromFloatsToRef(K,b,e,z,k){return k._x=this._x-K,k._y=this._y-b,k._z=this._z-e,k._w=this._w-z,k._isDirty=!0,k}Qc(K){return new U(this._x-K._x,this._y-K._y,this._z-K._z,this._w-K._w)}$h(K){return this._x-=K._x,this._y-=K._y,this._z-=K._z,this._w-=K._w,this._isDirty=!0,this}scale(K){return new U(this._x*K,this._y*K,this._z*K,this._w*K)}scaleToRef(K,b){return b._x=this._x*K,b._y=this._y*K,b._z=this._z*K,b._w=this._w*K,b._isDirty=!0,b}scaleInPlace(K){return this._x*=K,this._y*=K,this._z*=K,this._w*=K,this._isDirty=!0,this}scaleAndAddToRef(K,b){return b._x+=this._x*K,b._y+=this._y*K,b._z+=this._z*K,b._w+=this._w*K,b._isDirty=!0,b}multiply(K){const b=new U(0,0,0,1);return this.multiplyToRef(K,b),b}multiplyToRef(K,b){const e=this._x*K._w+this._y*K._z-this._z*K._y+this._w*K._x,z=-this._x*K._z+this._y*K._w+this._z*K._x+this._w*K._y,k=this._x*K._y-this._y*K._x+this._z*K._w+this._w*K._z,j=-this._x*K._x-this._y*K._y-this._z*K._z+this._w*K._w;return b.Yd(e,z,k,j),b}multiplyInPlace(K){return this.multiplyToRef(K,this)}multiplyByFloats(K,b,e,z){return this._x*=K,this._y*=b,this._z*=e,this._w*=z,this._isDirty=!0,this}divide(K){throw new ReferenceError("Can not divide a quaternion")}divideToRef(K,b){throw new ReferenceError("Can not divide a quaternion")}divideInPlace(K){throw new ReferenceError("Can not divide a quaternion")}minimizeInPlace(){throw new ReferenceError("Can not minimize a quaternion")}minimizeInPlaceFromFloats(){throw new ReferenceError("Can not minimize a quaternion")}maximizeInPlace(){throw new ReferenceError("Can not maximize a quaternion")}maximizeInPlaceFromFloats(){throw new ReferenceError("Can not maximize a quaternion")}negate(){return this.negateToRef(new U)}negateInPlace(){return this._x=-this._x,this._y=-this._y,this._z=-this._z,this._w=-this._w,this._isDirty=!0,this}negateToRef(K){return K._x=-this._x,K._y=-this._y,K._z=-this._z,K._w=-this._w,K._isDirty=!0,K}equalsToFloats(K,b,e,z){return this._x===K&&this._y===b&&this._z===e&&this._w===z}floorToRef(K){throw new ReferenceError("Can not floor a quaternion")}floor(){throw new ReferenceError("Can not floor a quaternion")}fractToRef(K){throw new ReferenceError("Can not fract a quaternion")}fract(){throw new ReferenceError("Can not fract a quaternion")}conjugateToRef(K){return K.Yd(-this._x,-this._y,-this._z,this._w),K}conjugateInPlace(){return this._x*=-1,this._y*=-1,this._z*=-1,this._isDirty=!0,this}conjugate(){return new U(-this._x,-this._y,-this._z,this._w)}invert(){const K=this.conjugate(),b=this.lengthSquared();return 0==b||1==b||K.scaleInPlace(1/b),K}invertInPlace(){this.conjugateInPlace();const K=this.lengthSquared();return 0==K||1==K||this.scaleInPlace(1/K),this}lengthSquared(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this.lengthSquared())}normalize(){return this.normalizeFromLength(this.length())}normalizeFromLength(K){return 0===K||1===K?this:this.scaleInPlace(1/K)}normalizeToNew(){const K=new U(0,0,0,1);return this.normalizeToRef(K),K}normalizeToRef(K){const b=this.length();return 0===b||1===b?K.Yd(this._x,this._y,this._z,this._w):this.scaleToRef(1/b,K)}toEulerAngles(){const K=X.Zero();return this.toEulerAnglesToRef(K),K}toEulerAnglesToRef(K){const b=this._z,e=this._x,z=this._y,k=this._w,j=z*b-e*k,T=.4999999;if(j<-T)K._y=2*Math.atan2(z,k),K._x=Math.PI/2,K._z=0,K._isDirty=!0;else if(j>T)K._y=2*Math.atan2(z,k),K._x=-Math.PI/2,K._z=0,K._isDirty=!0;else{const T=k*k,F=b*b,l=e*e,Y=z*z;K._z=Math.atan2(2*(e*z+b*k),-F-l+Y+T),K._x=Math.asin(-2*j),K._y=Math.atan2(2*(b*e+z*k),F-l-Y+T),K._isDirty=!0}return K}toAlphaBetaGammaToRef(K){const b=this._z,e=this._x,z=this._y,k=this._w,j=Math.sqrt(e*e+z*z),T=Math.sqrt(b*b+k*k),F=2*Math.atan2(j,T),l=2*Math.atan2(b,k),Y=2*Math.atan2(z,e),A=(l+Y)/2,X=(l-Y)/2;return K.set(X,F,A),K}toRotationMatrix(K){return B.FromQuaternionToRef(this,K),K}fromRotationMatrix(K){return U.FromRotationMatrixToRef(K,this),this}dot(K){return this._x*K._x+this._y*K._y+this._z*K._z+this._w*K._w}static FromRotationMatrix(K){const b=new U;return U.FromRotationMatrixToRef(K,b),b}static FromRotationMatrixToRef(K,b){const e=K.m,z=e[0],k=e[4],j=e[8],T=e[1],F=e[5],l=e[9],Y=e[2],A=e[6],X=e[10],t=z+F+X;let U;return t>0?(U=.5/Math.sqrt(t+1),b._w=.25/U,b._x=(A-l)*U,b._y=(j-Y)*U,b._z=(T-k)*U,b._isDirty=!0):z>F&&z>X?(U=2*Math.sqrt(1+z-F-X),b._w=(A-l)/U,b._x=.25*U,b._y=(k+T)/U,b._z=(j+Y)/U,b._isDirty=!0):F>X?(U=2*Math.sqrt(1+F-z-X),b._w=(j-Y)/U,b._x=(k+T)/U,b._y=.25*U,b._z=(l+A)/U,b._isDirty=!0):(U=2*Math.sqrt(1+X-z-F),b._w=(T-k)/U,b._x=(j+Y)/U,b._y=(l+A)/U,b._z=.25*U,b._isDirty=!0),b}static Dot(K,b){return K._x*b._x+K._y*b._y+K._z*b._z+K._w*b._w}static AreClose(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1;const z=U.Dot(K,b);return 1-z*z<=e}static SmoothToRef(K,b,e,z,k){let j=0===z?1:e/z;return j=(0,l.e)(j,0,1),U.SlerpToRef(K,b,j,k),k}static Zero(){return new U(0,0,0,0)}static Inverse(K){return new U(-K._x,-K._y,-K._z,K._w)}static InverseToRef(K,b){return b.set(-K._x,-K._y,-K._z,K._w),b}static Identity(){return new U(0,0,0,1)}static IsIdentity(K){return K&&0===K._x&&0===K._y&&0===K._z&&1===K._w}static RotationAxis(K,b){return U.RotationAxisToRef(K,b,new U)}static RotationAxisToRef(K,b,e){e._w=Math.cos(b/2);const z=Math.sin(b/2)/K.length();return e._x=K._x*z,e._y=K._y*z,e._z=K._z*z,e._isDirty=!0,e}static Bg(K,b){return b||(b=0),new U(K[b],K[b+1],K[b+2],K[b+3])}static FromArrayToRef(K,b,e){return e._x=K[b],e._y=K[b+1],e._z=K[b+2],e._w=K[b+3],e._isDirty=!0,e}static FromFloatsToRef(K,b,e,z,k){return k.Yd(K,b,e,z),k}static FromEulerAngles(K,b,e){const z=new U;return U.RotationYawPitchRollToRef(b,K,e,z),z}static FromEulerAnglesToRef(K,b,e,z){return U.RotationYawPitchRollToRef(b,K,e,z),z}static FromEulerVector(K){const b=new U;return U.RotationYawPitchRollToRef(K._y,K._x,K._z,b),b}static FromEulerVectorToRef(K,b){return U.RotationYawPitchRollToRef(K._y,K._x,K._z,b),b}static FromUnitVectorsToRef(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z.c;const j=X.Dot(K,b)+1;return j<k?Math.abs(K.x)>Math.abs(K.z)?e.set(-K.y,K.x,0,0):e.set(0,-K.z,K.y,0):(X.CrossToRef(K,b,m.gb[0]),e.set(m.gb[0].x,m.gb[0].y,m.gb[0].z,j)),e.normalize()}static RotationYawPitchRoll(K,b,e){const z=new U;return U.RotationYawPitchRollToRef(K,b,e,z),z}static RotationYawPitchRollToRef(K,b,e,z){const k=.5*e,j=.5*b,T=.5*K,F=Math.sin(k),l=Math.cos(k),Y=Math.sin(j),A=Math.cos(j),X=Math.sin(T),t=Math.cos(T);return z._x=t*Y*l+X*A*F,z._y=X*A*l-t*Y*F,z._z=t*A*F-X*Y*l,z._w=t*A*l+X*Y*F,z._isDirty=!0,z}static RotationAlphaBetaGamma(K,b,e){const z=new U;return U.RotationAlphaBetaGammaToRef(K,b,e,z),z}static RotationAlphaBetaGammaToRef(K,b,e,z){const k=.5*(e+K),j=.5*(e-K),T=.5*b;return z._x=Math.cos(j)*Math.sin(T),z._y=Math.sin(j)*Math.sin(T),z._z=Math.sin(k)*Math.cos(T),z._w=Math.cos(k)*Math.cos(T),z._isDirty=!0,z}static RotationQuaternionFromAxis(K,b,e){const z=new U(0,0,0,0);return U.RotationQuaternionFromAxisToRef(K,b,e,z),z}static RotationQuaternionFromAxisToRef(K,b,e,z){const k=u.Matrix[0];return K=K.normalizeToRef(u.gb[0]),b=b.normalizeToRef(u.gb[1]),e=e.normalizeToRef(u.gb[2]),B.FromXYZAxesToRef(K,b,e,k),U.FromRotationMatrixToRef(k,z),z}static FromLookDirectionLH(K,b){const e=new U;return U.FromLookDirectionLHToRef(K,b,e),e}static FromLookDirectionLHToRef(K,b,e){const z=u.Matrix[0];return B.LookDirectionLHToRef(K,b,z),U.FromRotationMatrixToRef(z,e),e}static FromLookDirectionRH(K,b){const e=new U;return U.FromLookDirectionRHToRef(K,b,e),e}static FromLookDirectionRHToRef(K,b,e){const z=u.Matrix[0];return B.LookDirectionRHToRef(K,b,z),U.FromRotationMatrixToRef(z,e)}static Slerp(K,b,e){const z=U.Identity();return U.SlerpToRef(K,b,e,z),z}static SlerpToRef(K,b,e,z){let k,j,T=K._x*b._x+K._y*b._y+K._z*b._z+K._w*b._w,F=!1;if(T<0&&(F=!0,T=-T),T>.999999)j=1-e,k=F?-e:e;else{const K=Math.acos(T),b=1/Math.sin(K);j=Math.sin((1-e)*K)*b,k=F?-Math.sin(e*K)*b:Math.sin(e*K)*b}return z._x=j*K._x+k*b._x,z._y=j*K._y+k*b._y,z._z=j*K._z+k*b._z,z._w=j*K._w+k*b._w,z._isDirty=!0,z}static Hermite(K,b,e,z,k){const j=k*k,T=k*j,F=2*T-3*j+1,l=-2*T+3*j,Y=T-2*j+k,A=T-j,X=K._x*F+e._x*l+b._x*Y+z._x*A,t=K._y*F+e._y*l+b._y*Y+z._y*A,B=K._z*F+e._z*l+b._z*Y+z._z*A,u=K._w*F+e._w*l+b._w*Y+z._w*A;return new U(X,t,B,u)}static Hermite1stDerivative(K,b,e,z,k){const j=new U;return this.Hermite1stDerivativeToRef(K,b,e,z,k,j),j}static Hermite1stDerivativeToRef(K,b,e,z,k,j){const T=k*k;return j._x=6*(T-k)*K._x+(3*T-4*k+1)*b._x+6*(-T+k)*e._x+(3*T-2*k)*z._x,j._y=6*(T-k)*K._y+(3*T-4*k+1)*b._y+6*(-T+k)*e._y+(3*T-2*k)*z._y,j._z=6*(T-k)*K._z+(3*T-4*k+1)*b._z+6*(-T+k)*e._z+(3*T-2*k)*z._z,j._w=6*(T-k)*K._w+(3*T-4*k+1)*b._w+6*(-T+k)*e._w+(3*T-2*k)*z._w,j._isDirty=!0,j}static Normalize(K){const b=U.Zero();return U.NormalizeToRef(K,b),b}static NormalizeToRef(K,b){return K.normalizeToRef(b),b}static Clamp(K,b,e){const z=new U;return U.ClampToRef(K,b,e,z),z}static ClampToRef(K,b,e,z){return z.Yd((0,l.e)(K.x,b.x,e.x),(0,l.e)(K.y,b.y,e.y),(0,l.e)(K.z,b.z,e.z),(0,l.e)(K.w,b.w,e.w))}static Random(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new U((0,l.t)(K,b),(0,l.t)(K,b),(0,l.t)(K,b),(0,l.t)(K,b))}static RandomToRef(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(arguments.length>2?arguments[2]:void 0).Yd((0,l.t)(K,b),(0,l.t)(K,b),(0,l.t)(K,b),(0,l.t)(K,b))}static Minimize(){throw new ReferenceError("Quaternion.Minimize does not make sense")}static Maximize(){throw new ReferenceError("Quaternion.Maximize does not make sense")}static Distance(K,b){return Math.sqrt(U.DistanceSquared(K,b))}static DistanceSquared(K,b){const e=K.x-b.x,z=K.y-b.y,k=K.z-b.z,j=K.w-b.w;return e*e+z*z+k*k+j*j}static Center(K,b){return U.CenterToRef(K,b,U.Zero())}static CenterToRef(K,b,e){return e.Yd((K.x+b.x)/2,(K.y+b.y)/2,(K.z+b.z)/2,(K.w+b.w)/2)}}Object.defineProperties(U.prototype,{dimension:{value:[4]},rank:{value:1}});class B{static get Use64Bits(){return T.e.MatrixUse64Bits}get m(){return this.yj}markAsUpdated(){this.updateFlag=B._UpdateFlagSeed++,this._isIdentity=!1,this._isIdentity3x2=!1,this._isIdentityDirty=!0,this._isIdentity3x2Dirty=!0}_updateIdentityStatus(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._isIdentity=K,this._isIdentity3x2=K||e,this._isIdentityDirty=!this._isIdentity&&b,this._isIdentity3x2Dirty=!this._isIdentity3x2&&z}constructor(){this._isIdentity=!1,this._isIdentityDirty=!0,this._isIdentity3x2=!0,this._isIdentity3x2Dirty=!0,this.updateFlag=-1,T.e.MatrixTrackPrecisionChange&&T.e.MatrixTrackedMatrices.push(this),this.yj=new T.e.MatrixCurrentType(16),this.markAsUpdated()}isIdentity(){if(this._isIdentityDirty){this._isIdentityDirty=!1;const K=this.yj;this._isIdentity=1===K[0]&&0===K[1]&&0===K[2]&&0===K[3]&&0===K[4]&&1===K[5]&&0===K[6]&&0===K[7]&&0===K[8]&&0===K[9]&&1===K[10]&&0===K[11]&&0===K[12]&&0===K[13]&&0===K[14]&&1===K[15]}return this._isIdentity}isIdentityAs3x2(){return this._isIdentity3x2Dirty&&(this._isIdentity3x2Dirty=!1,1!==this.yj[0]||1!==this.yj[5]||1!==this.yj[15]||0!==this.yj[1]||0!==this.yj[2]||0!==this.yj[3]||0!==this.yj[4]||0!==this.yj[6]||0!==this.yj[7]||0!==this.yj[8]||0!==this.yj[9]||0!==this.yj[10]||0!==this.yj[11]||0!==this.yj[12]||0!==this.yj[13]||0!==this.yj[14]?this._isIdentity3x2=!1:this._isIdentity3x2=!0),this._isIdentity3x2}determinant(){if(!0===this._isIdentity)return 1;const K=this.yj,b=K[0],e=K[1],z=K[2],k=K[3],j=K[4],T=K[5],F=K[6],l=K[7],Y=K[8],A=K[9],X=K[10],t=K[11],U=K[12],B=K[13],u=K[14],m=K[15],D=X*m-u*t,I=A*m-B*t,x=A*u-B*X,Q=Y*m-U*t,G=Y*u-X*U,i=Y*B-U*A;return b*+(T*D-F*I+l*x)+e*-(j*D-F*Q+l*G)+z*+(j*I-T*Q+l*i)+k*-(j*x-T*G+F*i)}toString(){return`{${this.m[0]}, ${this.m[1]}, ${this.m[2]}, ${this.m[3]}\n${this.m[4]}, ${this.m[5]}, ${this.m[6]}, ${this.m[7]}\n${this.m[8]}, ${this.m[9]}, ${this.m[10]}, ${this.m[11]}\n${this.m[12]}, ${this.m[13]}, ${this.m[14]}, ${this.m[15]}}`}toArray(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!K)return this.yj;const e=this.yj;for(let z=0;z<16;z++)K[b+z]=e[z];return this}Ti(){return this.yj}Sc(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return B.FromArrayToRef(K,b,this)}Yd(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];return B.FromArrayToRef(b,0,this)}set(){const K=this.yj;for(let b=0;b<16;b++)K[b]=b<0||arguments.length<=b?void 0:arguments[b];return this.markAsUpdated(),this}Wd(K){const b=this.yj;for(let e=0;e<16;e++)b[e]=K;return this.markAsUpdated(),this}invert(){return this.invertToRef(this),this}reset(){return B.FromValuesToRef(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,this),this._updateIdentityStatus(!1),this}add(K){const b=new B;return this.addToRef(K,b),b}addToRef(K,b){const e=this.yj,z=b.yj,k=K.m;for(let j=0;j<16;j++)z[j]=e[j]+k[j];return b.markAsUpdated(),b}addToSelf(K){const b=this.yj,e=K.m;return b[0]+=e[0],b[1]+=e[1],b[2]+=e[2],b[3]+=e[3],b[4]+=e[4],b[5]+=e[5],b[6]+=e[6],b[7]+=e[7],b[8]+=e[8],b[9]+=e[9],b[10]+=e[10],b[11]+=e[11],b[12]+=e[12],b[13]+=e[13],b[14]+=e[14],b[15]+=e[15],this.markAsUpdated(),this}addInPlace(K){const b=this.yj,e=K.m;for(let z=0;z<16;z++)b[z]+=e[z];return this.markAsUpdated(),this}addInPlaceFromFloats(){const K=this.yj;for(let b=0;b<16;b++)K[b]+=b<0||arguments.length<=b?void 0:arguments[b];return this.markAsUpdated(),this}Qc(K){const b=this.yj,e=K.m;for(let z=0;z<16;z++)b[z]-=e[z];return this.markAsUpdated(),this}subtractToRef(K,b){const e=this.yj,z=K.m,k=b.yj;for(let j=0;j<16;j++)k[j]=e[j]-z[j];return b.markAsUpdated(),b}$h(K){const b=this.yj,e=K.m;for(let z=0;z<16;z++)b[z]-=e[z];return this.markAsUpdated(),this}subtractFromFloats(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];return this.subtractFromFloatsToRef(...b,new B)}subtractFromFloatsToRef(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];const z=b.pop(),k=this.yj,j=z.yj,T=b;for(let F=0;F<16;F++)j[F]=k[F]-T[F];return z.markAsUpdated(),z}invertToRef(K){if(!0===this._isIdentity)return B.IdentityToRef(K),K;const b=this.yj,e=b[0],z=b[1],k=b[2],j=b[3],T=b[4],F=b[5],l=b[6],Y=b[7],A=b[8],X=b[9],t=b[10],U=b[11],u=b[12],m=b[13],D=b[14],I=b[15],x=t*I-D*U,Q=X*I-m*U,G=X*D-m*t,i=A*I-u*U,S=A*D-t*u,M=A*m-u*X,r=+(F*x-l*Q+Y*G),L=-(T*x-l*i+Y*S),c=+(T*Q-F*i+Y*M),v=-(T*G-F*S+l*M),w=e*r+z*L+k*c+j*v;if(0===w)return K.p(this),K;const h=1/w,R=l*I-D*Y,n=F*I-m*Y,P=F*D-m*l,d=T*I-u*Y,p=T*D-u*l,a=T*m-u*F,O=l*U-t*Y,g=F*U-X*Y,N=F*t-X*l,Z=T*U-A*Y,y=T*t-A*l,s=T*X-A*F,E=-(z*x-k*Q+j*G),o=+(e*x-k*i+j*S),C=-(e*Q-z*i+j*M),H=+(e*G-z*S+k*M),W=+(z*R-k*n+j*P),f=-(e*R-k*d+j*p),V=+(e*n-z*d+j*a),q=-(e*P-z*p+k*a),J=-(z*O-k*g+j*N),KK=+(e*O-k*Z+j*y),bK=-(e*g-z*Z+j*s),eK=+(e*N-z*y+k*s);return B.FromValuesToRef(r*h,E*h,W*h,J*h,L*h,o*h,f*h,KK*h,c*h,C*h,V*h,bK*h,v*h,H*h,q*h,eK*h,K),K}addAtIndex(K,b){return this.yj[K]+=b,this.markAsUpdated(),this}multiplyAtIndex(K,b){return this.yj[K]*=b,this.markAsUpdated(),this}setTranslationFromFloats(K,b,e){return this.yj[12]=K,this.yj[13]=b,this.yj[14]=e,this.markAsUpdated(),this}addTranslationFromFloats(K,b,e){return this.yj[12]+=K,this.yj[13]+=b,this.yj[14]+=e,this.markAsUpdated(),this}setTranslation(K){return this.setTranslationFromFloats(K._x,K._y,K._z)}getTranslation(){return new X(this.yj[12],this.yj[13],this.yj[14])}getTranslationToRef(K){return K.x=this.yj[12],K.y=this.yj[13],K.z=this.yj[14],K}removeRotationAndScaling(){const K=this.m;return B.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,K[12],K[13],K[14],K[15],this),this._updateIdentityStatus(0===K[12]&&0===K[13]&&0===K[14]&&1===K[15]),this}p(K){K.copyToArray(this.yj);const b=K;return this.updateFlag=b.updateFlag,this._updateIdentityStatus(b._isIdentity,b._isIdentityDirty,b._isIdentity3x2,b._isIdentity3x2Dirty),this}copyToArray(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.yj;return K[b]=e[0],K[b+1]=e[1],K[b+2]=e[2],K[b+3]=e[3],K[b+4]=e[4],K[b+5]=e[5],K[b+6]=e[6],K[b+7]=e[7],K[b+8]=e[8],K[b+9]=e[9],K[b+10]=e[10],K[b+11]=e[11],K[b+12]=e[12],K[b+13]=e[13],K[b+14]=e[14],K[b+15]=e[15],this}multiply(K){const b=new B;return this.multiplyToRef(K,b),b}multiplyInPlace(K){const b=this.yj,e=K.m;for(let z=0;z<16;z++)b[z]*=e[z];return this.markAsUpdated(),this}multiplyByFloats(){const K=this.yj;for(let b=0;b<16;b++)K[b]*=b<0||arguments.length<=b?void 0:arguments[b];return this.markAsUpdated(),this}multiplyByFloatsToRef(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];const z=b.pop(),k=this.yj,j=z.yj,T=b;for(let F=0;F<16;F++)j[F]=k[F]*T[F];return z.markAsUpdated(),z}multiplyToRef(K,b){return this._isIdentity?(b.p(K),b):K._isIdentity?(b.p(this),b):(this.multiplyToArray(K,b.yj,0),b.markAsUpdated(),b)}multiplyToArray(K,b,e){const z=this.yj,k=K.m,j=z[0],T=z[1],F=z[2],l=z[3],Y=z[4],A=z[5],X=z[6],t=z[7],U=z[8],B=z[9],u=z[10],m=z[11],D=z[12],I=z[13],x=z[14],Q=z[15],G=k[0],i=k[1],S=k[2],M=k[3],r=k[4],L=k[5],c=k[6],v=k[7],w=k[8],h=k[9],R=k[10],n=k[11],P=k[12],d=k[13],p=k[14],a=k[15];return b[e]=j*G+T*r+F*w+l*P,b[e+1]=j*i+T*L+F*h+l*d,b[e+2]=j*S+T*c+F*R+l*p,b[e+3]=j*M+T*v+F*n+l*a,b[e+4]=Y*G+A*r+X*w+t*P,b[e+5]=Y*i+A*L+X*h+t*d,b[e+6]=Y*S+A*c+X*R+t*p,b[e+7]=Y*M+A*v+X*n+t*a,b[e+8]=U*G+B*r+u*w+m*P,b[e+9]=U*i+B*L+u*h+m*d,b[e+10]=U*S+B*c+u*R+m*p,b[e+11]=U*M+B*v+u*n+m*a,b[e+12]=D*G+I*r+x*w+Q*P,b[e+13]=D*i+I*L+x*h+Q*d,b[e+14]=D*S+I*c+x*R+Q*p,b[e+15]=D*M+I*v+x*n+Q*a,this}divide(K){return this.divideToRef(K,new B)}divideToRef(K,b){const e=this.yj,z=K.m,k=b.yj;for(let j=0;j<16;j++)k[j]=e[j]/z[j];return b.markAsUpdated(),b}divideInPlace(K){const b=this.yj,e=K.m;for(let z=0;z<16;z++)b[z]/=e[z];return this.markAsUpdated(),this}minimizeInPlace(K){const b=this.yj,e=K.m;for(let z=0;z<16;z++)b[z]=Math.min(b[z],e[z]);return this.markAsUpdated(),this}minimizeInPlaceFromFloats(){const K=this.yj;for(let b=0;b<16;b++)K[b]=Math.min(K[b],b<0||arguments.length<=b?void 0:arguments[b]);return this.markAsUpdated(),this}maximizeInPlace(K){const b=this.yj,e=K.m;for(let z=0;z<16;z++)b[z]=Math.min(b[z],e[z]);return this.markAsUpdated(),this}maximizeInPlaceFromFloats(){const K=this.yj;for(let b=0;b<16;b++)K[b]=Math.min(K[b],b<0||arguments.length<=b?void 0:arguments[b]);return this.markAsUpdated(),this}negate(){return this.negateToRef(new B)}negateInPlace(){const K=this.yj;for(let b=0;b<16;b++)K[b]=-K[b];return this.markAsUpdated(),this}negateToRef(K){const b=this.yj,e=K.yj;for(let z=0;z<16;z++)e[z]=-b[z];return K.markAsUpdated(),K}equals(K){const b=K;if(!b)return!1;if((this._isIdentity||b._isIdentity)&&!this._isIdentityDirty&&!b._isIdentityDirty)return this._isIdentity&&b._isIdentity;const e=this.m,z=b.m;return e[0]===z[0]&&e[1]===z[1]&&e[2]===z[2]&&e[3]===z[3]&&e[4]===z[4]&&e[5]===z[5]&&e[6]===z[6]&&e[7]===z[7]&&e[8]===z[8]&&e[9]===z[9]&&e[10]===z[10]&&e[11]===z[11]&&e[12]===z[12]&&e[13]===z[13]&&e[14]===z[14]&&e[15]===z[15]}equalsWithEpsilon(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=this.yj,z=K.m;for(let k=0;k<16;k++)if(!(0,l.w)(e[k],z[k],b))return!1;return!0}equalsToFloats(){const K=this.yj;for(let b=0;b<16;b++)if(K[b]!=(b<0||arguments.length<=b?void 0:arguments[b]))return!1;return!0}floor(){return this.floorToRef(new B)}floorToRef(K){const b=this.yj,e=K.yj;for(let z=0;z<16;z++)e[z]=Math.floor(b[z]);return K.markAsUpdated(),K}fract(){return this.fractToRef(new B)}fractToRef(K){const b=this.yj,e=K.yj;for(let z=0;z<16;z++)e[z]=b[z]-Math.floor(b[z]);return K.markAsUpdated(),K}clone(){const K=new B;return K.p(this),K}getClassName(){return"Matrix"}getHashCode(){let K=Y(this.yj[0]);for(let b=1;b<16;b++)K=397*K^Y(this.yj[b]);return K}decomposeToTransformNode(K){return K.rotationQuaternion=K.rotationQuaternion||new U,this.decompose(K.Zd,K.rotationQuaternion,K.position)}decompose(K,b,e,z){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._isIdentity)return e&&e.Wd(0),K&&K.Wd(1),b&&b.Yd(0,0,0,1),!0;const j=this.yj;if(e&&e.Yd(j[12],j[13],j[14]),(K=K||u.gb[0]).x=Math.sqrt(j[0]*j[0]+j[1]*j[1]+j[2]*j[2]),K.y=Math.sqrt(j[4]*j[4]+j[5]*j[5]+j[6]*j[6]),K.z=Math.sqrt(j[8]*j[8]+j[9]*j[9]+j[10]*j[10]),z){const b=(k?z.absoluteScaling.x:z.Zd.x)<0?-1:1,e=(k?z.absoluteScaling.y:z.Zd.y)<0?-1:1,j=(k?z.absoluteScaling.z:z.Zd.z)<0?-1:1;K.x*=b,K.y*=e,K.z*=j}else this.determinant()<=0&&(K.y*=-1);if(0===K._x||0===K._y||0===K._z)return b&&b.Yd(0,0,0,1),!1;if(b){const e=1/K._x,z=1/K._y,k=1/K._z;B.FromValuesToRef(j[0]*e,j[1]*e,j[2]*e,0,j[4]*z,j[5]*z,j[6]*z,0,j[8]*k,j[9]*k,j[10]*k,0,0,0,0,1,u.Matrix[0]),U.FromRotationMatrixToRef(u.Matrix[0],b)}return!0}getRow(K){if(K<0||K>3)return null;const b=4*K;return new t(this.yj[b+0],this.yj[b+1],this.yj[b+2],this.yj[b+3])}getRowToRef(K,b){if(K>=0&&K<=3){const e=4*K;b.x=this.yj[e+0],b.y=this.yj[e+1],b.z=this.yj[e+2],b.w=this.yj[e+3]}return b}setRow(K,b){return this.setRowFromFloats(K,b.x,b.y,b.z,b.w)}transpose(){const K=new B;return B.TransposeToRef(this,K),K}transposeToRef(K){return B.TransposeToRef(this,K),K}setRowFromFloats(K,b,e,z,k){if(K<0||K>3)return this;const j=4*K;return this.yj[j+0]=b,this.yj[j+1]=e,this.yj[j+2]=z,this.yj[j+3]=k,this.markAsUpdated(),this}scale(K){const b=new B;return this.scaleToRef(K,b),b}scaleToRef(K,b){for(let e=0;e<16;e++)b.yj[e]=this.yj[e]*K;return b.markAsUpdated(),b}scaleAndAddToRef(K,b){for(let e=0;e<16;e++)b.yj[e]+=this.yj[e]*K;return b.markAsUpdated(),b}scaleInPlace(K){const b=this.yj;for(let e=0;e<16;e++)b[e]*=K;return this.markAsUpdated(),this}toNormalMatrix(K){const b=u.Matrix[0];this.invertToRef(b),b.transposeToRef(K);const e=K.yj;return B.FromValuesToRef(e[0],e[1],e[2],0,e[4],e[5],e[6],0,e[8],e[9],e[10],0,0,0,0,1,K),K}getRotationMatrix(){const K=new B;return this.getRotationMatrixToRef(K),K}getRotationMatrixToRef(K){const b=u.gb[0];if(!this.decompose(b))return B.IdentityToRef(K),K;const e=this.yj,z=1/b._x,k=1/b._y,j=1/b._z;return B.FromValuesToRef(e[0]*z,e[1]*z,e[2]*z,0,e[4]*k,e[5]*k,e[6]*k,0,e[8]*j,e[9]*j,e[10]*j,0,0,0,0,1,K),K}toggleModelMatrixHandInPlace(){const K=this.yj;return K[2]*=-1,K[6]*=-1,K[8]*=-1,K[9]*=-1,K[14]*=-1,this.markAsUpdated(),this}toggleProjectionMatrixHandInPlace(){const K=this.yj;return K[8]*=-1,K[9]*=-1,K[10]*=-1,K[11]*=-1,this.markAsUpdated(),this}static Bg(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const e=new B;return B.FromArrayToRef(K,b,e),e}static FromArrayToRef(K,b,e){for(let z=0;z<16;z++)e.yj[z]=K[z+b];return e.markAsUpdated(),e}static FromFloat32ArrayToRefScaled(K,b,e,z){return z.yj[0]=K[0+b]*e,z.yj[1]=K[1+b]*e,z.yj[2]=K[2+b]*e,z.yj[3]=K[3+b]*e,z.yj[4]=K[4+b]*e,z.yj[5]=K[5+b]*e,z.yj[6]=K[6+b]*e,z.yj[7]=K[7+b]*e,z.yj[8]=K[8+b]*e,z.yj[9]=K[9+b]*e,z.yj[10]=K[10+b]*e,z.yj[11]=K[11+b]*e,z.yj[12]=K[12+b]*e,z.yj[13]=K[13+b]*e,z.yj[14]=K[14+b]*e,z.yj[15]=K[15+b]*e,z.markAsUpdated(),z}static get IdentityReadOnly(){return B._IdentityReadOnly}static FromValuesToRef(K,b,e,z,k,j,T,F,l,Y,A,X,t,U,B,u,m){const D=m.yj;D[0]=K,D[1]=b,D[2]=e,D[3]=z,D[4]=k,D[5]=j,D[6]=T,D[7]=F,D[8]=l,D[9]=Y,D[10]=A,D[11]=X,D[12]=t,D[13]=U,D[14]=B,D[15]=u,m.markAsUpdated()}static FromValues(K,b,e,z,k,j,T,F,l,Y,A,X,t,U,u,m){const D=new B,I=D.yj;return I[0]=K,I[1]=b,I[2]=e,I[3]=z,I[4]=k,I[5]=j,I[6]=T,I[7]=F,I[8]=l,I[9]=Y,I[10]=A,I[11]=X,I[12]=t,I[13]=U,I[14]=u,I[15]=m,D.markAsUpdated(),D}static Compose(K,b,e){const z=new B;return B.ComposeToRef(K,b,e,z),z}static ComposeToRef(K,b,e,z){const k=z.yj,j=b._x,T=b._y,F=b._z,l=b._w,Y=j+j,A=T+T,X=F+F,t=j*Y,U=j*A,B=j*X,u=T*A,m=T*X,D=F*X,I=l*Y,x=l*A,Q=l*X,G=K._x,i=K._y,S=K._z;return k[0]=(1-(u+D))*G,k[1]=(U+Q)*G,k[2]=(B-x)*G,k[3]=0,k[4]=(U-Q)*i,k[5]=(1-(t+D))*i,k[6]=(m+I)*i,k[7]=0,k[8]=(B+x)*S,k[9]=(m-I)*S,k[10]=(1-(t+u))*S,k[11]=0,k[12]=e._x,k[13]=e._y,k[14]=e._z,k[15]=1,z.markAsUpdated(),z}static Identity(){const K=B.FromValues(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return K._updateIdentityStatus(!0),K}static IdentityToRef(K){return B.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1,K),K._updateIdentityStatus(!0),K}static Zero(){const K=B.FromValues(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);return K._updateIdentityStatus(!1),K}static RotationX(K){const b=new B;return B.RotationXToRef(K,b),b}static Invert(K){const b=new B;return K.invertToRef(b),b}static RotationXToRef(K,b){const e=Math.sin(K),z=Math.cos(K);return B.FromValuesToRef(1,0,0,0,0,z,e,0,0,-e,z,0,0,0,0,1,b),b._updateIdentityStatus(1===z&&0===e),b}static RotationY(K){const b=new B;return B.RotationYToRef(K,b),b}static RotationYToRef(K,b){const e=Math.sin(K),z=Math.cos(K);return B.FromValuesToRef(z,0,-e,0,0,1,0,0,e,0,z,0,0,0,0,1,b),b._updateIdentityStatus(1===z&&0===e),b}static RotationZ(K){const b=new B;return B.RotationZToRef(K,b),b}static RotationZToRef(K,b){const e=Math.sin(K),z=Math.cos(K);return B.FromValuesToRef(z,e,0,0,-e,z,0,0,0,0,1,0,0,0,0,1,b),b._updateIdentityStatus(1===z&&0===e),b}static RotationAxis(K,b){const e=new B;return B.RotationAxisToRef(K,b,e),e}static RotationAxisToRef(K,b,e){const z=Math.sin(-b),k=Math.cos(-b),j=1-k;K=K.normalizeToRef(u.gb[0]);const T=e.yj;return T[0]=K._x*K._x*j+k,T[1]=K._x*K._y*j-K._z*z,T[2]=K._x*K._z*j+K._y*z,T[3]=0,T[4]=K._y*K._x*j+K._z*z,T[5]=K._y*K._y*j+k,T[6]=K._y*K._z*j-K._x*z,T[7]=0,T[8]=K._z*K._x*j-K._y*z,T[9]=K._z*K._y*j+K._x*z,T[10]=K._z*K._z*j+k,T[11]=0,T[12]=0,T[13]=0,T[14]=0,T[15]=1,e.markAsUpdated(),e}static RotationAlignToRef(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const j=X.Dot(b,K),T=e.yj;if(j<-1+z.c)T[0]=-1,T[1]=0,T[2]=0,T[3]=0,T[4]=0,T[5]=k?1:-1,T[6]=0,T[7]=0,T[8]=0,T[9]=0,T[10]=k?-1:1,T[11]=0;else{const e=X.Cross(b,K),z=1/(1+j);T[0]=e._x*e._x*z+j,T[1]=e._y*e._x*z-e._z,T[2]=e._z*e._x*z+e._y,T[3]=0,T[4]=e._x*e._y*z+e._z,T[5]=e._y*e._y*z+j,T[6]=e._z*e._y*z-e._x,T[7]=0,T[8]=e._x*e._z*z-e._y,T[9]=e._y*e._z*z+e._x,T[10]=e._z*e._z*z+j,T[11]=0}return T[12]=0,T[13]=0,T[14]=0,T[15]=1,e.markAsUpdated(),e}static RotationYawPitchRoll(K,b,e){const z=new B;return B.RotationYawPitchRollToRef(K,b,e,z),z}static RotationYawPitchRollToRef(K,b,e,z){return U.RotationYawPitchRollToRef(K,b,e,u.Quaternion[0]),u.Quaternion[0].toRotationMatrix(z),z}static Scaling(K,b,e){const z=new B;return B.ScalingToRef(K,b,e,z),z}static ScalingToRef(K,b,e,z){return B.FromValuesToRef(K,0,0,0,0,b,0,0,0,0,e,0,0,0,0,1,z),z._updateIdentityStatus(1===K&&1===b&&1===e),z}static Translation(K,b,e){const z=new B;return B.TranslationToRef(K,b,e,z),z}static TranslationToRef(K,b,e,z){return B.FromValuesToRef(1,0,0,0,0,1,0,0,0,0,1,0,K,b,e,1,z),z._updateIdentityStatus(0===K&&0===b&&0===e),z}static Lerp(K,b,e){const z=new B;return B.LerpToRef(K,b,e,z),z}static LerpToRef(K,b,e,z){const k=z.yj,j=K.m,T=b.m;for(let F=0;F<16;F++)k[F]=j[F]*(1-e)+T[F]*e;return z.markAsUpdated(),z}static DecomposeLerp(K,b,e){const z=new B;return B.DecomposeLerpToRef(K,b,e,z),z}static DecomposeLerpToRef(K,b,e,z){const k=u.gb[0],j=u.Quaternion[0],T=u.gb[1];K.decompose(k,j,T);const F=u.gb[2],l=u.Quaternion[1],Y=u.gb[3];b.decompose(F,l,Y);const A=u.gb[4];X.LerpToRef(k,F,e,A);const t=u.Quaternion[2];U.SlerpToRef(j,l,e,t);const m=u.gb[5];return X.LerpToRef(T,Y,e,m),B.ComposeToRef(A,t,m,z),z}static LookAtLH(K,b,e){const z=new B;return B.LookAtLHToRef(K,b,e,z),z}static LookAtLHToRef(K,b,e,z){const k=u.gb[0],j=u.gb[1],T=u.gb[2];b.subtractToRef(K,T),T.normalize(),X.CrossToRef(e,T,k);const F=k.lengthSquared();0===F?k.x=1:k.normalizeFromLength(Math.sqrt(F)),X.CrossToRef(T,k,j),j.normalize();const l=-X.Dot(k,K),Y=-X.Dot(j,K),A=-X.Dot(T,K);return B.FromValuesToRef(k._x,j._x,T._x,0,k._y,j._y,T._y,0,k._z,j._z,T._z,0,l,Y,A,1,z),z}static LookAtRH(K,b,e){const z=new B;return B.LookAtRHToRef(K,b,e,z),z}static LookAtRHToRef(K,b,e,z){const k=u.gb[0],j=u.gb[1],T=u.gb[2];K.subtractToRef(b,T),T.normalize(),X.CrossToRef(e,T,k);const F=k.lengthSquared();0===F?k.x=1:k.normalizeFromLength(Math.sqrt(F)),X.CrossToRef(T,k,j),j.normalize();const l=-X.Dot(k,K),Y=-X.Dot(j,K),A=-X.Dot(T,K);return B.FromValuesToRef(k._x,j._x,T._x,0,k._y,j._y,T._y,0,k._z,j._z,T._z,0,l,Y,A,1,z),z}static LookDirectionLH(K,b){const e=new B;return B.LookDirectionLHToRef(K,b,e),e}static LookDirectionLHToRef(K,b,e){const z=u.gb[0];z.p(K),z.scaleInPlace(-1);const k=u.gb[1];return X.CrossToRef(b,z,k),B.FromValuesToRef(k._x,k._y,k._z,0,b._x,b._y,b._z,0,z._x,z._y,z._z,0,0,0,0,1,e),e}static LookDirectionRH(K,b){const e=new B;return B.LookDirectionRHToRef(K,b,e),e}static LookDirectionRHToRef(K,b,e){const z=u.gb[2];return X.CrossToRef(b,K,z),B.FromValuesToRef(z._x,z._y,z._z,0,b._x,b._y,b._z,0,K._x,K._y,K._z,0,0,0,0,1,e),e}static OrthoLH(K,b,e,z,k){const j=new B;return B.OrthoLHToRef(K,b,e,z,j,k),j}static OrthoLHToRef(K,b,e,z,k,j){const T=2/K,F=2/b,l=2/(z-e),Y=-(z+e)/(z-e);return B.FromValuesToRef(T,0,0,0,0,F,0,0,0,0,l,0,0,0,Y,1,k),j&&k.multiplyToRef(D,k),k._updateIdentityStatus(1===T&&1===F&&1===l&&0===Y),k}static OrthoOffCenterLH(K,b,e,z,k,j,T){const F=new B;return B.OrthoOffCenterLHToRef(K,b,e,z,k,j,F,T),F}static OrthoOffCenterLHToRef(K,b,e,z,k,j,T,F){const l=2/(b-K),Y=2/(z-e),A=2/(j-k),X=-(j+k)/(j-k),t=(K+b)/(K-b),U=(z+e)/(e-z);return B.FromValuesToRef(l,0,0,0,0,Y,0,0,0,0,A,0,t,U,X,1,T),F&&T.multiplyToRef(D,T),T.markAsUpdated(),T}static ObliqueOffCenterLHToRef(K,b,e,z,k,j,T,F,l,Y,A){const X=-T*Math.cos(F),t=-T*Math.sin(F);return B.TranslationToRef(0,0,-l,u.Matrix[1]),B.FromValuesToRef(1,0,0,0,0,1,0,0,X,t,1,0,0,0,0,1,u.Matrix[0]),u.Matrix[1].multiplyToRef(u.Matrix[0],u.Matrix[0]),B.TranslationToRef(0,0,l,u.Matrix[1]),u.Matrix[0].multiplyToRef(u.Matrix[1],u.Matrix[0]),B.OrthoOffCenterLHToRef(K,b,e,z,k,j,Y,A),u.Matrix[0].multiplyToRef(Y,Y),Y}static OrthoOffCenterRH(K,b,e,z,k,j,T){const F=new B;return B.OrthoOffCenterRHToRef(K,b,e,z,k,j,F,T),F}static OrthoOffCenterRHToRef(K,b,e,z,k,j,T,F){return B.OrthoOffCenterLHToRef(K,b,e,z,k,j,T,F),T.yj[10]*=-1,T}static ObliqueOffCenterRHToRef(K,b,e,z,k,j,T,F,l,Y,A){const X=T*Math.cos(F),t=T*Math.sin(F);return B.TranslationToRef(0,0,l,u.Matrix[1]),B.FromValuesToRef(1,0,0,0,0,1,0,0,X,t,1,0,0,0,0,1,u.Matrix[0]),u.Matrix[1].multiplyToRef(u.Matrix[0],u.Matrix[0]),B.TranslationToRef(0,0,-l,u.Matrix[1]),u.Matrix[0].multiplyToRef(u.Matrix[1],u.Matrix[0]),B.OrthoOffCenterRHToRef(K,b,e,z,k,j,Y,A),u.Matrix[0].multiplyToRef(Y,Y),Y}static PerspectiveLH(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;const T=new B,F=2*e/K,l=2*e/b,Y=(z+e)/(z-e),A=-2*z*e/(z-e),X=Math.tan(j);return B.FromValuesToRef(F,0,0,0,0,l,0,X,0,0,Y,1,0,0,A,0,T),k&&T.multiplyToRef(D,T),T._updateIdentityStatus(!1),T}static PerspectiveFovLH(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const F=new B;return B.PerspectiveFovLHToRef(K,b,e,z,F,!0,k,j,T),F}static PerspectiveFovLHToRef(K,b,e,z,k){let j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const Y=e,A=z,X=1/Math.tan(.5*K),t=j?X/b:X,U=j?X:X*b,u=l&&0===Y?-1:0!==A?(A+Y)/(A-Y):1,m=l&&0===Y?2*A:0!==A?-2*A*Y/(A-Y):-2*Y,I=Math.tan(F);return B.FromValuesToRef(t,0,0,0,0,U,0,I,0,0,u,1,0,0,m,0,k),T&&k.multiplyToRef(D,k),k._updateIdentityStatus(!1),k}static PerspectiveFovReverseLHToRef(K,b,e,z,k){let j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const l=1/Math.tan(.5*K),Y=j?l/b:l,A=j?l:l*b,X=Math.tan(F);return B.FromValuesToRef(Y,0,0,0,0,A,0,X,0,0,-e,1,0,0,1,0,k),T&&k.multiplyToRef(D,k),k._updateIdentityStatus(!1),k}static PerspectiveFovRH(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,T=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const F=new B;return B.PerspectiveFovRHToRef(K,b,e,z,F,!0,k,j,T),F}static PerspectiveFovRHToRef(K,b,e,z,k){let j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]&&arguments[8];const Y=e,A=z,X=1/Math.tan(.5*K),t=j?X/b:X,U=j?X:X*b,u=l&&0===Y?1:0!==A?-(A+Y)/(A-Y):-1,m=l&&0===Y?2*A:0!==A?-2*A*Y/(A-Y):-2*Y,I=Math.tan(F);return B.FromValuesToRef(t,0,0,0,0,U,0,I,0,0,u,-1,0,0,m,0,k),T&&k.multiplyToRef(D,k),k._updateIdentityStatus(!1),k}static PerspectiveFovReverseRHToRef(K,b,e,z,k){let j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=arguments.length>6?arguments[6]:void 0,F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;const l=1/Math.tan(.5*K),Y=j?l/b:l,A=j?l:l*b,X=Math.tan(F);return B.FromValuesToRef(Y,0,0,0,0,A,0,X,0,0,-e,-1,0,0,-1,0,k),T&&k.multiplyToRef(D,k),k._updateIdentityStatus(!1),k}static GetFinalMatrix(K,b,e,z,k,j){const T=K.width,F=K.height,l=K.x,Y=K.y,A=B.FromValues(T/2,0,0,0,0,-F/2,0,0,0,0,j-k,0,l+T/2,F/2+Y,k,1),X=new B;return b.multiplyToRef(e,X),X.multiplyToRef(z,X),X.multiplyToRef(A,X)}static GetAsMatrix2x2(K){const b=K.m,e=[b[0],b[1],b[4],b[5]];return T.e.MatrixUse64Bits?e:new Float32Array(e)}static GetAsMatrix3x3(K){const b=K.m,e=[b[0],b[1],b[2],b[4],b[5],b[6],b[8],b[9],b[10]];return T.e.MatrixUse64Bits?e:new Float32Array(e)}static Transpose(K){const b=new B;return B.TransposeToRef(K,b),b}static TransposeToRef(K,b){const e=K.m,z=e[0],k=e[4],j=e[8],T=e[12],F=e[1],l=e[5],Y=e[9],A=e[13],X=e[2],t=e[6],U=e[10],B=e[14],u=e[3],m=e[7],D=e[11],I=e[15],x=b.yj;return x[0]=z,x[1]=k,x[2]=j,x[3]=T,x[4]=F,x[5]=l,x[6]=Y,x[7]=A,x[8]=X,x[9]=t,x[10]=U,x[11]=B,x[12]=u,x[13]=m,x[14]=D,x[15]=I,b.markAsUpdated(),b._updateIdentityStatus(K._isIdentity,K._isIdentityDirty),b}static Reflection(K){const b=new B;return B.ReflectionToRef(K,b),b}static ReflectionToRef(K,b){K.normalize();const e=K.k.x,z=K.k.y,k=K.k.z,j=-2*e,T=-2*z,F=-2*k;return B.FromValuesToRef(j*e+1,T*e,F*e,0,j*z,T*z+1,F*z,0,j*k,T*k,F*k+1,0,j*K.d,T*K.d,F*K.d,1,b),b}static FromXYZAxesToRef(K,b,e,z){return B.FromValuesToRef(K._x,K._y,K._z,0,b._x,b._y,b._z,0,e._x,e._y,e._z,0,0,0,0,1,z),z}static FromQuaternionToRef(K,b){const e=K._x*K._x,z=K._y*K._y,k=K._z*K._z,j=K._x*K._y,T=K._z*K._w,F=K._z*K._x,l=K._y*K._w,Y=K._y*K._z,A=K._x*K._w;return b.yj[0]=1-2*(z+k),b.yj[1]=2*(j+T),b.yj[2]=2*(F-l),b.yj[3]=0,b.yj[4]=2*(j-T),b.yj[5]=1-2*(k+e),b.yj[6]=2*(Y+A),b.yj[7]=0,b.yj[8]=2*(F+l),b.yj[9]=2*(Y-A),b.yj[10]=1-2*(z+e),b.yj[11]=0,b.yj[12]=0,b.yj[13]=0,b.yj[14]=0,b.yj[15]=1,b.markAsUpdated(),b}}B._UpdateFlagSeed=0,B._IdentityReadOnly=B.Identity(),Object.defineProperties(B.prototype,{dimension:{value:[4,4]},rank:{value:2}});class u{}u.gb=(0,k.f)(11,X.Zero),u.Matrix=(0,k.f)(2,B.Identity),u.Quaternion=(0,k.f)(3,U.Zero);class m{}m.Vector2=(0,k.f)(3,A.Zero),m.gb=(0,k.f)(13,X.Zero),m.Vector4=(0,k.f)(3,t.Zero),m.Quaternion=(0,k.f)(3,U.Zero),m.Matrix=(0,k.f)(8,B.Identity),(0,j.e)("BABYLON.Vector2",A),(0,j.e)("BABYLON.Vector3",X),(0,j.e)("BABYLON.Vector4",t),(0,j.e)("BABYLON.Matrix",B);const D=B.FromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1)},11252:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{constructor(K,b,e,z){this.x=K,this.y=b,this.width=e,this.height=z}toGlobal(K,b){return new z(this.x*K,this.y*b,this.width*K,this.height*b)}toGlobalToRef(K,b,e){return e.x=this.x*K,e.y=this.y*b,e.width=this.width*K,e.height=this.height*b,this}clone(){return new z(this.x,this.y,this.width,this.height)}}},11479:(K,b,e)=>{"use strict";e.d(b,{b:()=>Y,c:()=>A});var z=e(10967),k=e(11485);const j=[Math.sqrt(1/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(3/(4*Math.PI)),-Math.sqrt(3/(4*Math.PI)),Math.sqrt(15/(4*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(5/(16*Math.PI)),-Math.sqrt(15/(4*Math.PI)),Math.sqrt(15/(16*Math.PI))],T=[()=>1,K=>K.y,K=>K.z,K=>K.x,K=>K.x*K.y,K=>K.y*K.z,K=>3*K.z*K.z-1,K=>K.x*K.z,K=>K.x*K.x-K.y*K.y],F=(K,b)=>j[K]*T[K](b),l=[Math.PI,2*Math.PI/3,2*Math.PI/3,2*Math.PI/3,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4,Math.PI/4];class Y{constructor(){this.preScaled=!1,this.l00=z.k.Zero(),this.l1_1=z.k.Zero(),this.l10=z.k.Zero(),this.l11=z.k.Zero(),this.l2_2=z.k.Zero(),this.l2_1=z.k.Zero(),this.l20=z.k.Zero(),this.l21=z.k.Zero(),this.l22=z.k.Zero()}addLight(K,b,e){k.b.gb[0].set(b.r,b.g,b.b);const z=k.b.gb[0],j=k.b.gb[1];z.scaleToRef(e,j),j.scaleToRef(F(0,K),k.b.gb[2]),this.l00.addInPlace(k.b.gb[2]),j.scaleToRef(F(1,K),k.b.gb[2]),this.l1_1.addInPlace(k.b.gb[2]),j.scaleToRef(F(2,K),k.b.gb[2]),this.l10.addInPlace(k.b.gb[2]),j.scaleToRef(F(3,K),k.b.gb[2]),this.l11.addInPlace(k.b.gb[2]),j.scaleToRef(F(4,K),k.b.gb[2]),this.l2_2.addInPlace(k.b.gb[2]),j.scaleToRef(F(5,K),k.b.gb[2]),this.l2_1.addInPlace(k.b.gb[2]),j.scaleToRef(F(6,K),k.b.gb[2]),this.l20.addInPlace(k.b.gb[2]),j.scaleToRef(F(7,K),k.b.gb[2]),this.l21.addInPlace(k.b.gb[2]),j.scaleToRef(F(8,K),k.b.gb[2]),this.l22.addInPlace(k.b.gb[2])}scaleInPlace(K){this.l00.scaleInPlace(K),this.l1_1.scaleInPlace(K),this.l10.scaleInPlace(K),this.l11.scaleInPlace(K),this.l2_2.scaleInPlace(K),this.l2_1.scaleInPlace(K),this.l20.scaleInPlace(K),this.l21.scaleInPlace(K),this.l22.scaleInPlace(K)}convertIncidentRadianceToIrradiance(){this.l00.scaleInPlace(l[0]),this.l1_1.scaleInPlace(l[1]),this.l10.scaleInPlace(l[2]),this.l11.scaleInPlace(l[3]),this.l2_2.scaleInPlace(l[4]),this.l2_1.scaleInPlace(l[5]),this.l20.scaleInPlace(l[6]),this.l21.scaleInPlace(l[7]),this.l22.scaleInPlace(l[8])}convertIrradianceToLambertianRadiance(){this.scaleInPlace(1/Math.PI)}preScaleForRendering(){this.preScaled=!0,this.l00.scaleInPlace(j[0]),this.l1_1.scaleInPlace(j[1]),this.l10.scaleInPlace(j[2]),this.l11.scaleInPlace(j[3]),this.l2_2.scaleInPlace(j[4]),this.l2_1.scaleInPlace(j[5]),this.l20.scaleInPlace(j[6]),this.l21.scaleInPlace(j[7]),this.l22.scaleInPlace(j[8])}updateFromArray(K){return z.k.FromArrayToRef(K[0],0,this.l00),z.k.FromArrayToRef(K[1],0,this.l1_1),z.k.FromArrayToRef(K[2],0,this.l10),z.k.FromArrayToRef(K[3],0,this.l11),z.k.FromArrayToRef(K[4],0,this.l2_2),z.k.FromArrayToRef(K[5],0,this.l2_1),z.k.FromArrayToRef(K[6],0,this.l20),z.k.FromArrayToRef(K[7],0,this.l21),z.k.FromArrayToRef(K[8],0,this.l22),this}updateFromFloatsArray(K){return z.k.FromFloatsToRef(K[0],K[1],K[2],this.l00),z.k.FromFloatsToRef(K[3],K[4],K[5],this.l1_1),z.k.FromFloatsToRef(K[6],K[7],K[8],this.l10),z.k.FromFloatsToRef(K[9],K[10],K[11],this.l11),z.k.FromFloatsToRef(K[12],K[13],K[14],this.l2_2),z.k.FromFloatsToRef(K[15],K[16],K[17],this.l2_1),z.k.FromFloatsToRef(K[18],K[19],K[20],this.l20),z.k.FromFloatsToRef(K[21],K[22],K[23],this.l21),z.k.FromFloatsToRef(K[24],K[25],K[26],this.l22),this}static Bg(K){return(new Y).updateFromArray(K)}static FromPolynomial(K){const b=new Y;return b.l00=K.xx.scale(.376127).add(K.yy.scale(.376127)).add(K.zz.scale(.376126)),b.l1_1=K.y.scale(.977204),b.l10=K.z.scale(.977204),b.l11=K.x.scale(.977204),b.l2_2=K.xy.scale(1.16538),b.l2_1=K.yz.scale(1.16538),b.l20=K.zz.scale(1.34567).Qc(K.xx.scale(.672834)).Qc(K.yy.scale(.672834)),b.l21=K.zx.scale(1.16538),b.l22=K.xx.scale(1.16538).Qc(K.yy.scale(1.16538)),b.l1_1.scaleInPlace(-1),b.l11.scaleInPlace(-1),b.l2_1.scaleInPlace(-1),b.l21.scaleInPlace(-1),b.scaleInPlace(Math.PI),b}}class A{constructor(){this.x=z.k.Zero(),this.y=z.k.Zero(),this.z=z.k.Zero(),this.xx=z.k.Zero(),this.yy=z.k.Zero(),this.zz=z.k.Zero(),this.xy=z.k.Zero(),this.yz=z.k.Zero(),this.zx=z.k.Zero()}get preScaledHarmonics(){return this._harmonics||(this._harmonics=Y.FromPolynomial(this)),this._harmonics.preScaled||this._harmonics.preScaleForRendering(),this._harmonics}addAmbient(K){k.b.gb[0].Yd(K.r,K.g,K.b);const b=k.b.gb[0];this.xx.addInPlace(b),this.yy.addInPlace(b),this.zz.addInPlace(b)}scaleInPlace(K){this.x.scaleInPlace(K),this.y.scaleInPlace(K),this.z.scaleInPlace(K),this.xx.scaleInPlace(K),this.yy.scaleInPlace(K),this.zz.scaleInPlace(K),this.yz.scaleInPlace(K),this.zx.scaleInPlace(K),this.xy.scaleInPlace(K)}updateFromHarmonics(K){return this._harmonics=K,this.x.p(K.l11),this.x.scaleInPlace(1.02333).scaleInPlace(-1),this.y.p(K.l1_1),this.y.scaleInPlace(1.02333).scaleInPlace(-1),this.z.p(K.l10),this.z.scaleInPlace(1.02333),this.xx.p(K.l00),k.b.gb[0].p(K.l20).scaleInPlace(.247708),k.b.gb[1].p(K.l22).scaleInPlace(.429043),this.xx.scaleInPlace(.886277).$h(k.b.gb[0]).addInPlace(k.b.gb[1]),this.yy.p(K.l00),this.yy.scaleInPlace(.886277).$h(k.b.gb[0]).$h(k.b.gb[1]),this.zz.p(K.l00),k.b.gb[0].p(K.l20).scaleInPlace(.495417),this.zz.scaleInPlace(.886277).addInPlace(k.b.gb[0]),this.yz.p(K.l2_1),this.yz.scaleInPlace(.858086).scaleInPlace(-1),this.zx.p(K.l21),this.zx.scaleInPlace(.858086).scaleInPlace(-1),this.xy.p(K.l2_2),this.xy.scaleInPlace(.858086),this.scaleInPlace(1/Math.PI),this}static FromHarmonics(K){return(new A).updateFromHarmonics(K)}static Bg(K){const b=new A;return z.k.FromArrayToRef(K[0],0,b.x),z.k.FromArrayToRef(K[1],0,b.y),z.k.FromArrayToRef(K[2],0,b.z),z.k.FromArrayToRef(K[3],0,b.xx),z.k.FromArrayToRef(K[4],0,b.yy),z.k.FromArrayToRef(K[5],0,b.zz),z.k.FromArrayToRef(K[6],0,b.yz),z.k.FromArrayToRef(K[7],0,b.zx),z.k.FromArrayToRef(K[8],0,b.xy),b}}},11298:(K,b,e)=>{"use strict";e.d(b,{e:()=>Y});var z=e(10967),k=e(10994),j=e(11226),T=e(11261),F=e(11186);e(11307);function l(K){let b=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23];const e=[0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0],j=[];let l=[];const Y=K.width||K.size||1,A=K.height||K.size||1,X=K.depth||K.size||1,t=K.wrap||!1;let U=void 0===K.topBaseAt?1:K.topBaseAt,B=void 0===K.bottomBaseAt?0:K.bottomBaseAt;U=(U+4)%4,B=(B+4)%4;let u=[2,0,3,1][U],m=[2,0,1,3][B],D=[1,-1,1,-1,-1,1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,-1,-1,-1,1];if(t){b=[2,3,0,2,0,1,4,5,6,4,6,7,9,10,11,9,11,8,12,14,15,12,13,14],D=[-1,1,1,1,1,1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1];let K=[[1,1,1],[-1,1,1],[-1,1,-1],[1,1,-1]],e=[[-1,-1,1],[1,-1,1],[1,-1,-1],[-1,-1,-1]];const z=[17,18,19,16],k=[22,23,20,21];for(;u>0;)K.unshift(K.pop()),z.unshift(z.pop()),u--;for(;m>0;)e.unshift(e.pop()),k.unshift(k.pop()),m--;K=K.flat(),e=e.flat(),D=D.concat(K).concat(e),b.push(z[0],z[2],z[3],z[0],z[1],z[2]),b.push(k[0],k[2],k[3],k[0],k[1],k[2])}const I=[Y/2,A/2,X/2];l=D.reduce(((K,b,e)=>K.concat(b*I[e%3])),[]);const x=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE,Q=K.faceUV||new Array(6),G=K.faceColors,i=[];for(let T=0;T<6;T++)void 0===Q[T]&&(Q[T]=new z.o(0,0,1,1)),G&&void 0===G[T]&&(G[T]=new k.g(1,1,1,1));for(let z=0;z<6;z++)if(j.push(Q[z].z,F.c?1-Q[z].w:Q[z].w),j.push(Q[z].x,F.c?1-Q[z].w:Q[z].w),j.push(Q[z].x,F.c?1-Q[z].y:Q[z].y),j.push(Q[z].z,F.c?1-Q[z].y:Q[z].y),G)for(let K=0;K<4;K++)i.push(G[z].r,G[z].g,G[z].b,G[z].a);T.e._ComputeSides(x,l,b,e,j,K.frontUVs,K.backUVs);const S=new T.e;if(S.indices=b,S.xa=l,S.ya=e,S.Aa=j,G){const K=x===T.e.DOUBLESIDE?i.concat(i):i;S.za=K}return S}function Y(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new j.b(K,e);b.sideOrientation=j.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return l(b).Ca(z,b.updatable),z}T.e.CreateBox=l,j.b.CreateBox=function(K,b){return Y(K,{size:b,sideOrientation:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>3?arguments[3]:void 0},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)}},11617:(K,b,e)=>{"use strict";e.d(b,{e:()=>F});var z=e(11226),k=e(11261),j=e(11186);function T(K){const b=[],e=[],z=[],T=[],F=K.radius||.5,l=K.tessellation||64,Y=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,A=0===K.sideOrientation?0:K.sideOrientation||k.e.DEFAULTSIDE;b.push(0,0,0),T.push(.5,.5);const X=2*Math.PI*Y,t=1===Y?X/l:X/(l-1);let U=0;for(let k=0;k<l;k++){const K=Math.cos(U),e=Math.sin(U),z=(K+1)/2,k=(1-e)/2;b.push(F*K,F*e,0),T.push(z,j.c?1-k:k),U+=t}1===Y&&(b.push(b[3],b[4],b[5]),T.push(T[2],j.c?1-T[3]:T[3]));const B=b.length/3;for(let k=1;k<B-1;k++)e.push(k+1,0,k);k.e.ComputeNormals(b,e,z),k.e._ComputeSides(A,b,e,z,T,K.frontUVs,K.backUVs);const u=new k.e;return u.indices=e,u.xa=b,u.ya=z,u.Aa=T,u}function F(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new z.b(K,e);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),k._originalBuilderSideOrientation=b.sideOrientation;return T(b).Ca(k,b.updatable),k}k.e.CreateDisc=T,z.b.CreateDisc=function(K,b,e){return F(K,{radius:b,tessellation:e,sideOrientation:arguments.length>5?arguments[5]:void 0,updatable:arguments.length>4?arguments[4]:void 0},arguments.length>3&&void 0!==arguments[3]?arguments[3]:null)}},11307:(K,b,e)=>{"use strict";e.d(b,{e:()=>m,d:()=>I,g:()=>D});var z=e(10967),k=e(10994),j=e(11226),T=e(11261),F=e(11030);j.b._GroundMeshParser=(K,b)=>l.Parse(K,b);class l extends j.b{constructor(K,b){super(K,b),this.generateOctree=!1}getClassName(){return"GroundMesh"}get subdivisions(){return Math.min(this._subdivisionsX,this._subdivisionsY)}get subdivisionsX(){return this._subdivisionsX}get subdivisionsY(){return this._subdivisionsY}optimize(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32;this._subdivisionsX=K,this._subdivisionsY=K,this.subdivide(K);const e=this;e.createOrUpdateSubmeshesOctree&&e.createOrUpdateSubmeshesOctree(b)}getHeightAtCoordinates(K,b){const e=this.getWorldMatrix(),k=z.e.Matrix[5];e.invertToRef(k);const j=z.e.gb[8];if(z.k.TransformCoordinatesFromFloatsToRef(K,0,b,k,j),K=j.x,b=j.z,K<this._minX||K>=this._maxX||b<=this._minZ||b>this._maxZ)return this.position.y;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const T=this._getFacetAt(K,b),F=-(T.x*K+T.z*b+T.w)/T.y;return z.k.TransformCoordinatesFromFloatsToRef(0,F,0,e,j),j.y}getNormalAtCoordinates(K,b){const e=new z.k(0,1,0);return this.getNormalAtCoordinatesToRef(K,b,e),e}getNormalAtCoordinatesToRef(K,b,e){const k=this.getWorldMatrix(),j=z.e.Matrix[5];k.invertToRef(j);const T=z.e.gb[8];if(z.k.TransformCoordinatesFromFloatsToRef(K,0,b,j,T),K=T.x,b=T.z,K<this._minX||K>this._maxX||b<this._minZ||b>this._maxZ)return this;this._heightQuads&&0!=this._heightQuads.length||(this._initHeightQuads(),this._computeHeightQuads());const F=this._getFacetAt(K,b);return z.k.TransformNormalFromFloatsToRef(F.x,F.y,F.z,k,e),this}updateCoordinateHeights(){return this._heightQuads&&0!=this._heightQuads.length||this._initHeightQuads(),this._computeHeightQuads(),this}_getFacetAt(K,b){const e=Math.floor((K+this._maxX)*this._subdivisionsX/this._width),z=Math.floor(-(b+this._maxZ)*this._subdivisionsY/this._height+this._subdivisionsY),k=this._heightQuads[z*this._subdivisionsX+e];let j;return j=b<k.slope.x*K+k.slope.y?k.facet1:k.facet2,j}_initHeightQuads(){const K=this._subdivisionsX,b=this._subdivisionsY;this._heightQuads=new Array;for(let e=0;e<b;e++)for(let b=0;b<K;b++){const k={slope:z.h.Zero(),facet1:new z.o(0,0,0,0),facet2:new z.o(0,0,0,0)};this._heightQuads[e*K+b]=k}return this}_computeHeightQuads(){const K=this.getVerticesData(F.f.PositionKind);if(!K)return this;const b=z.e.gb[3],e=z.e.gb[2],k=z.e.gb[1],j=z.e.gb[0],T=z.e.gb[4],l=z.e.gb[5],Y=z.e.gb[6],A=z.e.gb[7],X=z.e.gb[8];let t=0,U=0,B=0,u=0,m=0,D=0,I=0;const x=this._subdivisionsX,Q=this._subdivisionsY;for(let F=0;F<Q;F++)for(let Q=0;Q<x;Q++){t=3*Q,U=F*(x+1)*3,B=(F+1)*(x+1)*3,b.x=K[U+t],b.y=K[U+t+1],b.z=K[U+t+2],e.x=K[U+t+3],e.y=K[U+t+4],e.z=K[U+t+5],k.x=K[B+t],k.y=K[B+t+1],k.z=K[B+t+2],j.x=K[B+t+3],j.y=K[B+t+4],j.z=K[B+t+5],u=(j.z-b.z)/(j.x-b.x),m=b.z-u*b.x,e.subtractToRef(b,T),k.subtractToRef(b,l),j.subtractToRef(b,Y),z.k.CrossToRef(Y,l,A),z.k.CrossToRef(T,Y,X),A.normalize(),X.normalize(),D=-(A.x*b.x+A.y*b.y+A.z*b.z),I=-(X.x*e.x+X.y*e.y+X.z*e.z);const G=this._heightQuads[F*x+Q];G.slope.Yd(u,m),G.facet1.Yd(A.x,A.y,A.z,D),G.facet2.Yd(X.x,X.y,X.z,I)}return this}serialize(K){super.serialize(K),K.subdivisionsX=this._subdivisionsX,K.subdivisionsY=this._subdivisionsY,K.minX=this._minX,K.maxX=this._maxX,K.Fi=this._minZ,K.maxZ=this._maxZ,K.width=this._width,K.height=this._height}static Parse(K,b){const e=new l(K.name,b);return e._subdivisionsX=K.subdivisionsX||1,e._subdivisionsY=K.subdivisionsY||1,e._minX=K.minX,e._maxX=K.maxX,e._minZ=K.Fi,e._maxZ=K.maxZ,e._width=K.width,e._height=K.height,e}}var Y=e(10686),A=e(10720),X=e(10969),t=e(11186);function U(K){const b=[],e=[],k=[],j=[];let F,l;const Y=K.width||K.size||1,A=K.height||K.size||1,X=0|(K.subdivisionsX||K.subdivisions||1),U=0|(K.subdivisionsY||K.subdivisions||1);for(F=0;F<=U;F++)for(l=0;l<=X;l++){const K=new z.k(l*Y/X-Y/2,0,(U-F)*A/U-A/2),b=new z.k(0,1,0);e.push(K.x,K.y,K.z),k.push(b.x,b.y,b.z),j.push(l/X,t.c?F/U:1-F/U)}for(F=0;F<U;F++)for(l=0;l<X;l++)b.push(l+1+(F+1)*(X+1)),b.push(l+1+F*(X+1)),b.push(l+F*(X+1)),b.push(l+(F+1)*(X+1)),b.push(l+1+(F+1)*(X+1)),b.push(l+F*(X+1));const B=new T.e;return B.indices=b,B.xa=e,B.ya=k,B.Aa=j,B}function B(K){const b=void 0!==K.xmin&&null!==K.xmin?K.xmin:-1,e=void 0!==K.zmin&&null!==K.zmin?K.zmin:-1,k=void 0!==K.xmax&&null!==K.xmax?K.xmax:1,j=void 0!==K.zmax&&null!==K.zmax?K.zmax:1,F=K.subdivisions||{w:1,h:1},l=K.precision||{w:1,h:1},Y=[],A=[],X=[],t=[];let U,B,u,m;F.h=F.h<1?1:F.h,F.w=F.w<1?1:F.w,l.w=l.w<1?1:l.w,l.h=l.h<1?1:l.h;const D=(k-b)/F.w,I=(j-e)/F.h;function x(K,b,e,k){const j=A.length/3,T=l.w+1;for(U=0;U<l.h;U++)for(B=0;B<l.w;B++){const K=[j+B+U*T,j+(B+1)+U*T,j+(B+1)+(U+1)*T,j+B+(U+1)*T];Y.push(K[1]),Y.push(K[2]),Y.push(K[3]),Y.push(K[0]),Y.push(K[1]),Y.push(K[3])}const F=z.k.Zero(),u=new z.k(0,1,0);for(U=0;U<=l.h;U++)for(F.z=U*(k-b)/l.h+b,B=0;B<=l.w;B++)F.x=B*(e-K)/l.w+K,F.y=0,A.push(F.x,F.y,F.z),X.push(u.x,u.y,u.z),t.push(B/l.w,U/l.h)}for(u=0;u<F.h;u++)for(m=0;m<F.w;m++)x(b+m*D,e+u*I,b+(m+1)*D,e+(u+1)*I);const Q=new T.e;return Q.indices=Y,Q.xa=A,Q.ya=X,Q.Aa=t,Q}function u(K){const b=[],e=[],j=[],F=[];let l,Y;const A=K.colorFilter||new k.c(.3,.59,.11),t=K.alphaFilter||0;let U=!1;if(K.minHeight>K.maxHeight){U=!0;const b=K.maxHeight;K.maxHeight=K.minHeight,K.minHeight=b}for(l=0;l<=K.subdivisions;l++)for(Y=0;Y<=K.subdivisions;Y++){const b=new z.k(Y*K.width/K.subdivisions-K.width/2,0,(K.subdivisions-l)*K.height/K.subdivisions-K.height/2),k=4*(((b.x+K.width/2)/K.width*(K.bufferWidth-1)|0)+((1-(b.z+K.height/2)/K.height)*(K.bufferHeight-1)|0)*K.bufferWidth);let T=K.buffer[k]/255,B=K.buffer[k+1]/255,u=K.buffer[k+2]/255;const m=K.buffer[k+3]/255;U&&(T=1-T,B=1-B,u=1-u);const D=T*A.r+B*A.g+u*A.b;b.y=m>=t?K.minHeight+(K.maxHeight-K.minHeight)*D:K.minHeight-X.c,K.heightBuffer&&(K.heightBuffer[l*(K.subdivisions+1)+Y]=b.y),e.push(b.x,b.y,b.z),j.push(0,0,0),F.push(Y/K.subdivisions,1-l/K.subdivisions)}for(l=0;l<K.subdivisions;l++)for(Y=0;Y<K.subdivisions;Y++){const z=Y+1+(l+1)*(K.subdivisions+1),k=Y+1+l*(K.subdivisions+1),j=Y+l*(K.subdivisions+1),T=Y+(l+1)*(K.subdivisions+1),F=e[3*z+1]>=K.minHeight,A=e[3*k+1]>=K.minHeight,X=e[3*j+1]>=K.minHeight;F&&A&&X&&(b.push(z),b.push(k),b.push(j));e[3*T+1]>=K.minHeight&&F&&X&&(b.push(T),b.push(z),b.push(j))}T.e.ComputeNormals(e,b,j);const B=new T.e;return B.indices=b,B.xa=e,B.ya=j,B.Aa=F,B}function m(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const e=new l(K,arguments.length>2?arguments[2]:void 0);e._setReady(!1),e._subdivisionsX=b.subdivisionsX||b.subdivisions||1,e._subdivisionsY=b.subdivisionsY||b.subdivisions||1,e._width=b.width||1,e._height=b.height||1,e._maxX=e._width/2,e._maxZ=e._height/2,e._minX=-e._maxX,e._minZ=-e._maxZ;return U(b).Ca(e,b.updatable),e._setReady(!0),e}function D(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new j.b(K,e);return B(b).Ca(z,b.updatable),z}function I(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const j=e.width||10,T=e.height||10,F=e.subdivisions||1,X=e.minHeight||0,t=e.maxHeight||1,U=e.colorFilter||new k.c(.3,.59,.11),B=e.alphaFilter||0,m=e.updatable,D=e.onReady;z=z||A.b.LastCreatedScene;const I=new l(K,z);let x;I._subdivisionsX=F,I._subdivisionsY=F,I._width=j,I._height=T,I._maxX=I._width/2,I._maxZ=I._height/2,I._minX=-I._maxX,I._minZ=-I._maxZ,I._setReady(!1),e.passHeightBufferInCallback&&(x=new Float32Array((F+1)*(F+1)));const Q=(K,b,e)=>{u({width:j,height:T,subdivisions:F,minHeight:X,maxHeight:t,colorFilter:U,buffer:K,bufferWidth:b,bufferHeight:e,alphaFilter:B,heightBuffer:x}).Ca(I,m),D&&D(I,x),I._setReady(!0)};if("string"===typeof b){const K=K=>{var b;const e=K.width,k=K.height;if(z.u)return;const j=null===(b=z)||void 0===b?void 0:b.getEngine().resizeImageBitmap(K,e,k);Q(j,e,k)};Y.f.LoadImage(b,K,e.onError?e.onError:()=>{},z.offlineProvider)}else Q(b.data,b.width,b.height);return I}T.e.CreateGround=U,T.e.CreateTiledGround=B,T.e.CreateGroundFromHeightMap=u,j.b.CreateGround=(K,b,e,z,k,j)=>m(K,{width:b,height:e,subdivisions:z,updatable:j},k),j.b.CreateTiledGround=(K,b,e,z,k,j,T,F,l)=>D(K,{xmin:b,zmin:e,xmax:z,zmax:k,subdivisions:j,precision:T,updatable:l},F),j.b.CreateGroundFromHeightMap=(K,b,e,z,k,j,T,F,l,Y,A)=>I(K,b,{width:e,height:z,subdivisions:k,minHeight:j,maxHeight:T,updatable:l,onReady:Y,alphaFilter:A},F)},12358:(K,b,e)=>{"use strict";e.d(b,{d:()=>w,e:()=>c,g:()=>v});var z=e(10967),k=e(11226),j=e(11261),T=e(10994),F=e(11030),l=e(11933),Y=e(11085),A=e(11001),X=e(10960),t=e(11161),U=e(10799),B=e(11201),u=e(10718),m=e(11155),D=e(10720),I=e(11138),x=e(11129);const Q={effect:null,subMesh:null};class G extends m.c{constructor(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};super(K,b,!(arguments.length>4&&void 0!==arguments[4])||arguments[4]),this._textures={},this._textureArrays={},this._externalTextures={},this._floats={},this._ints={},this._uints={},this._floatsArrays={},this._colors3={},this._colors3Arrays={},this._colors4={},this._colors4Arrays={},this._vectors2={},this._vectors3={},this._vectors4={},this._quaternions={},this._quaternionsArrays={},this._matrices={},this._matrixArrays={},this._matrices3x3={},this._matrices2x2={},this._vectors2Arrays={},this._vectors3Arrays={},this._vectors4Arrays={},this._uniformBuffers={},this._textureSamplers={},this._storageBuffers={},this._cachedWorldViewMatrix=new z.b,this._cachedWorldViewProjectionMatrix=new z.b,this._multiview=!1,this._materialHelperNeedsPreviousMatrices=!1,this._shaderPath=e,this._options={needAlphaBlending:!1,needAlphaTesting:!1,attributes:["position","k","uv"],uniforms:["worldViewProjection"],uniformBuffers:[],samplers:[],externalTextures:[],samplerObjects:[],storageBuffers:[],defines:[],useClipPlane:!1,...k}}get shaderPath(){return this._shaderPath}set shaderPath(K){this._shaderPath=K}get options(){return this._options}get isMultiview(){return this._multiview}getClassName(){return"ShaderMaterial"}needAlphaBlending(){return this.alpha<1||this._options.needAlphaBlending}needAlphaTesting(){return this._options.needAlphaTesting}_checkUniform(K){-1===this._options.uniforms.indexOf(K)&&this._options.uniforms.push(K)}setTexture(K,b){return-1===this._options.samplers.indexOf(K)&&this._options.samplers.push(K),this._textures[K]=b,this}removeTexture(K){delete this._textures[K]}setTextureArray(K,b){return-1===this._options.samplers.indexOf(K)&&this._options.samplers.push(K),this._checkUniform(K),this._textureArrays[K]=b,this}setExternalTexture(K,b){return-1===this._options.externalTextures.indexOf(K)&&this._options.externalTextures.push(K),this._externalTextures[K]=b,this}setFloat(K,b){return this._checkUniform(K),this._floats[K]=b,this}setInt(K,b){return this._checkUniform(K),this._ints[K]=b,this}setUInt(K,b){return this._checkUniform(K),this._uints[K]=b,this}setFloats(K,b){return this._checkUniform(K),this._floatsArrays[K]=b,this}setColor3(K,b){return this._checkUniform(K),this._colors3[K]=b,this}setColor3Array(K,b){return this._checkUniform(K),this._colors3Arrays[K]=b.reduce(((K,b)=>(b.toArray(K,K.length),K)),[]),this}setColor4(K,b){return this._checkUniform(K),this._colors4[K]=b,this}setColor4Array(K,b){return this._checkUniform(K),this._colors4Arrays[K]=b.reduce(((K,b)=>(b.toArray(K,K.length),K)),[]),this}setVector2(K,b){return this._checkUniform(K),this._vectors2[K]=b,this}setVector3(K,b){return this._checkUniform(K),this._vectors3[K]=b,this}setVector4(K,b){return this._checkUniform(K),this._vectors4[K]=b,this}setQuaternion(K,b){return this._checkUniform(K),this._quaternions[K]=b,this}setQuaternionArray(K,b){return this._checkUniform(K),this._quaternionsArrays[K]=b.reduce(((K,b)=>(b.toArray(K,K.length),K)),[]),this}setMatrix(K,b){return this._checkUniform(K),this._matrices[K]=b,this}setMatrices(K,b){this._checkUniform(K);const e=new Float32Array(16*b.length);for(let z=0;z<b.length;z++){b[z].copyToArray(e,16*z)}return this._matrixArrays[K]=e,this}setMatrix3x3(K,b){return this._checkUniform(K),this._matrices3x3[K]=b,this}setMatrix2x2(K,b){return this._checkUniform(K),this._matrices2x2[K]=b,this}setArray2(K,b){return this._checkUniform(K),this._vectors2Arrays[K]=b,this}setArray3(K,b){return this._checkUniform(K),this._vectors3Arrays[K]=b,this}setArray4(K,b){return this._checkUniform(K),this._vectors4Arrays[K]=b,this}setUniformBuffer(K,b){return-1===this._options.uniformBuffers.indexOf(K)&&this._options.uniformBuffers.push(K),this._uniformBuffers[K]=b,this}setTextureSampler(K,b){return-1===this._options.samplerObjects.indexOf(K)&&this._options.samplerObjects.push(K),this._textureSamplers[K]=b,this}setStorageBuffer(K,b){return-1===this._options.storageBuffers.indexOf(K)&&this._options.storageBuffers.push(K),this._storageBuffers[K]=b,this}setDefine(K,b){const e=K.trimEnd()+" ",z=this.options.defines.findIndex((b=>b===K||b.startsWith(e)));return z>=0&&this.options.defines.splice(z,1),("boolean"!==typeof b||b)&&this.options.defines.push(e+b),this}isReadyForSubMesh(K,b,e){return this.isReady(K,e,b)}isReady(K,b,e){var z;const k=e&&this._storeEffectOnSubMeshes;if(this.isFrozen){const K=k?e._drawWrapper:this._drawWrapper;if(K.effect&&K._wasPreviouslyReady&&K._wasPreviouslyUsingInstances===b)return!0}const j=this.va(),T=j.getEngine(),l=[],Y=[],A=new B.c;let t=this._shaderPath,U=this._options.uniforms,u=this._options.uniformBuffers,m=this._options.samplers;T.getCaps().multiview&&j.activeCamera&&j.activeCamera.outputRenderTarget&&j.activeCamera.outputRenderTarget.getViewCount()>1&&(this._multiview=!0,l.push("#define MULTIVIEW"),-1!==U.indexOf("viewProjection")&&-1===U.indexOf("viewProjectionR")&&U.push("viewProjectionR"));for(let F=0;F<this._options.defines.length;F++){const K=0===this._options.defines[F].indexOf("#define")?this._options.defines[F]:`#define ${this._options.defines[F]}`;l.push(K)}for(let F=0;F<this._options.attributes.length;F++)Y.push(this._options.attributes[F]);if(K&&K.isVerticesDataPresent(F.f.ColorKind)&&(-1===Y.indexOf(F.f.ColorKind)&&Y.push(F.f.ColorKind),l.push("#define VERTEXCOLOR")),b&&(l.push("#define INSTANCES"),(0,x.gb)(Y,this._materialHelperNeedsPreviousMatrices),null!==K&&void 0!==K&&K.hasThinInstances&&(l.push("#define THIN_INSTANCES"),K&&K.isVerticesDataPresent(F.f.ColorInstanceKind)&&(Y.push(F.f.ColorInstanceKind),l.push("#define INSTANCESCOLOR")))),K&&K.useBones&&K.computeBonesUsingShaders&&K.skeleton){Y.push(F.f.MatricesIndicesKind),Y.push(F.f.MatricesWeightsKind),K.numBoneInfluencers>4&&(Y.push(F.f.MatricesIndicesExtraKind),Y.push(F.f.MatricesWeightsExtraKind));const b=K.skeleton;l.push("#define NUM_BONE_INFLUENCERS "+K.numBoneInfluencers),A.addCPUSkinningFallback(0,K),b.isUsingTextureForMatrices?(l.push("#define BONETEXTURE"),-1===U.indexOf("boneTextureWidth")&&U.push("boneTextureWidth"),-1===this._options.samplers.indexOf("boneSampler")&&this._options.samplers.push("boneSampler")):(l.push("#define BonesPerMesh "+(b.bones.length+1)),-1===U.indexOf("mBones")&&U.push("mBones"))}else l.push("#define NUM_BONE_INFLUENCERS 0");let D=0;const G=K?K.morphTargetManager:null;if(G){const K=G.supportsUVs&&-1!==l.indexOf("#define UV1"),b=G.supportsTangents&&-1!==l.indexOf("#define TANGENT"),e=G.supportsNormals&&-1!==l.indexOf("#define NORMAL");D=G.numMaxInfluencers||G.numInfluencers,K&&l.push("#define MORPHTARGETS_UV"),b&&l.push("#define MORPHTARGETS_TANGENT"),e&&l.push("#define MORPHTARGETS_NORMAL"),D>0&&l.push("#define MORPHTARGETS"),G.isUsingTextureForTargets&&(l.push("#define MORPHTARGETS_TEXTURE"),-1===U.indexOf("morphTargetTextureIndices")&&U.push("morphTargetTextureIndices"),-1===this._options.samplers.indexOf("morphTargets")&&this._options.samplers.push("morphTargets")),l.push("#define NUM_MORPH_INFLUENCERS "+D);for(let z=0;z<D;z++)Y.push(F.f.PositionKind+z),e&&Y.push(F.f.NormalKind+z),b&&Y.push(F.f.TangentKind+z),K&&Y.push(F.f.UVKind+"_"+z);D>0&&(U=U.slice(),U.push("morphTargetInfluences"),U.push("morphTargetCount"),U.push("morphTargetTextureInfo"),U.push("morphTargetTextureIndices"))}else l.push("#define NUM_MORPH_INFLUENCERS 0");if(K){const b=K.bakedVertexAnimationManager;b&&b.isEnabled&&(l.push("#define BAKED_VERTEX_ANIMATION_TEXTURE"),-1===U.indexOf("bakedVertexAnimationSettings")&&U.push("bakedVertexAnimationSettings"),-1===U.indexOf("bakedVertexAnimationTextureSizeInverted")&&U.push("bakedVertexAnimationTextureSizeInverted"),-1===U.indexOf("bakedVertexAnimationTime")&&U.push("bakedVertexAnimationTime"),-1===this._options.samplers.indexOf("bakedVertexAnimationTexture")&&this._options.samplers.push("bakedVertexAnimationTexture")),(0,x.B)(Y,K,l)}for(const F in this._textures)if(!this._textures[F].isReady())return!1;K&&this._shouldTurnAlphaTestOn(K)&&l.push("#define ALPHATEST"),!1!==this._options.useClipPlane&&((0,I.c)(U),(0,I.j)(this,j,l)),j.fogEnabled&&null!==K&&void 0!==K&&K.applyFog&&j.fogMode!==X.e.FOGMODE_NONE&&(l.push("#define FOG"),-1===U.indexOf("view")&&U.push("view"),-1===U.indexOf("vFogInfos")&&U.push("vFogInfos"),-1===U.indexOf("vFogColor")&&U.push("vFogColor")),this._useLogarithmicDepth&&(l.push("#define LOGARITHMICDEPTH"),-1===U.indexOf("logarithmicDepthConstant")&&U.push("logarithmicDepthConstant")),this.customShaderNameResolve&&(U=U.slice(),u=u.slice(),m=m.slice(),t=this.customShaderNameResolve(this.name,U,u,m,l,Y));const i=k?e._getDrawWrapper(void 0,!0):this._drawWrapper,S=(null===i||void 0===i?void 0:i.effect)??null,M=(null===i||void 0===i?void 0:i.defines)??null,r=l.join("\n");let L=S;return M!==r&&(L=T.createEffect(t,{attributes:Y,uniformsNames:U,uniformBuffersNames:u,samplers:m,defines:r,fallbacks:A,onCompiled:this.onCompiled,onError:this.onError,indexParameters:{maxSimultaneousMorphTargets:D},shaderLanguage:this._options.shaderLanguage,extraInitializationsAsync:this._options.extraInitializationsAsync},T),k?e.setEffect(L,r,this._materialContext):i&&i.setEffect(L,r),this._onEffectCreatedObservable&&(Q.effect=L,Q.subMesh=e??(null===K||void 0===K?void 0:K.Rf[0])??null,this._onEffectCreatedObservable.notifyObservers(Q))),i._wasPreviouslyUsingInstances=!!b,!((null===(z=L)||void 0===z||!z.isReady())??1)&&(S!==L&&j.resetCachedMaterial(),i._wasPreviouslyReady=!0,!0)}bindOnlyWorldMatrix(K,b){const e=this.va(),z=b??this.getEffect();z&&(-1!==this._options.uniforms.indexOf("world")&&z.setMatrix("world",K),-1!==this._options.uniforms.indexOf("worldView")&&(K.multiplyToRef(e.getViewMatrix(),this._cachedWorldViewMatrix),z.setMatrix("worldView",this._cachedWorldViewMatrix)),-1!==this._options.uniforms.indexOf("worldViewProjection")&&(K.multiplyToRef(e.getTransformMatrix(),this._cachedWorldViewProjectionMatrix),z.setMatrix("worldViewProjection",this._cachedWorldViewProjectionMatrix)),-1!==this._options.uniforms.indexOf("view")&&z.setMatrix("view",e.getViewMatrix()))}bindForSubMesh(K,b,e){var z;this.bind(K,b,null===(z=e._drawWrapperOverride)||void 0===z?void 0:z.effect,e)}bind(K,b,e,z){const k=z&&this._storeEffectOnSubMeshes,j=e??(k?z.effect:this.getEffect());if(!j)return;const T=this.va();this._activeEffect=j,this.bindOnlyWorldMatrix(K,e);const F=this._options.uniformBuffers;let l=!1;if(j&&F&&F.length>0&&T.getEngine().supportsUniformBuffers)for(let X=0;X<F.length;++X){switch(F[X]){case"Mesh":b&&(b.getMeshUniformBuffer().bindToEffect(j,"Mesh"),b.transferToEffect(K));break;case"Scene":(0,x.u)(j,T.getSceneUniformBuffer()),T.finalizeSceneUbo(),l=!0}}const Y=b&&k?this._mustRebind(T,j,z,b.visibility):T.getCachedMaterial()!==this;if(j&&Y){let K;for(K in l||-1===this._options.uniforms.indexOf("view")||j.setMatrix("view",T.getViewMatrix()),l||-1===this._options.uniforms.indexOf("projection")||j.setMatrix("projection",T.getProjectionMatrix()),l||-1===this._options.uniforms.indexOf("viewProjection")||(j.setMatrix("viewProjection",T.getTransformMatrix()),this._multiview&&j.setMatrix("viewProjectionR",T._transformMatrixR)),T.activeCamera&&-1!==this._options.uniforms.indexOf("cameraPosition")&&j.setVector3("cameraPosition",T.activeCamera.globalPosition),(0,x.e)(b,j),(0,I.d)(j,this,T),this._useLogarithmicDepth&&(0,x.o)(k?z.materialDefines:j.defines,j,T),b&&(0,x.h)(T,b,j),this._textures)j.setTexture(K,this._textures[K]);for(K in this._textureArrays)j.setTextureArray(K,this._textureArrays[K]);for(K in this._ints)j.setInt(K,this._ints[K]);for(K in this._uints)j.setUInt(K,this._uints[K]);for(K in this._floats)j.setFloat(K,this._floats[K]);for(K in this._floatsArrays)j.setArray(K,this._floatsArrays[K]);for(K in this._colors3)j.setColor3(K,this._colors3[K]);for(K in this._colors3Arrays)j.setArray3(K,this._colors3Arrays[K]);for(K in this._colors4){const b=this._colors4[K];j.setFloat4(K,b.r,b.g,b.b,b.a)}for(K in this._colors4Arrays)j.setArray4(K,this._colors4Arrays[K]);for(K in this._vectors2)j.setVector2(K,this._vectors2[K]);for(K in this._vectors3)j.setVector3(K,this._vectors3[K]);for(K in this._vectors4)j.setVector4(K,this._vectors4[K]);for(K in this._quaternions)j.setQuaternion(K,this._quaternions[K]);for(K in this._matrices)j.setMatrix(K,this._matrices[K]);for(K in this._matrixArrays)j.setMatrices(K,this._matrixArrays[K]);for(K in this._matrices3x3)j.setMatrix3x3(K,this._matrices3x3[K]);for(K in this._matrices2x2)j.setMatrix2x2(K,this._matrices2x2[K]);for(K in this._vectors2Arrays)j.setArray2(K,this._vectors2Arrays[K]);for(K in this._vectors3Arrays)j.setArray3(K,this._vectors3Arrays[K]);for(K in this._vectors4Arrays)j.setArray4(K,this._vectors4Arrays[K]);for(K in this._quaternionsArrays)j.setArray4(K,this._quaternionsArrays[K]);for(K in this._uniformBuffers){const b=this._uniformBuffers[K].getBuffer();b&&j.bindUniformBuffer(b,K)}const e=T.getEngine(),F=e.setExternalTexture;if(F)for(K in this._externalTextures)F.call(e,K,this._externalTextures[K]);const Y=e.setTextureSampler;if(Y)for(K in this._textureSamplers)Y.call(e,K,this._textureSamplers[K]);const A=e.setStorageBuffer;if(A)for(K in this._storageBuffers)A.call(e,K,this._storageBuffers[K])}if(j&&b&&(Y||!this.isFrozen)){const K=b.morphTargetManager;K&&K.numInfluencers>0&&(0,x.q)(b,j);const e=b.bakedVertexAnimationManager;if(e&&e.isEnabled){var A;const K=k?z._drawWrapper:this._drawWrapper;null===(A=b.bakedVertexAnimationManager)||void 0===A||A.bind(j,!!K._wasPreviouslyUsingInstances)}}this._afterBind(b,j,z)}getActiveTextures(){const K=super.getActiveTextures();for(const b in this._textures)K.push(this._textures[b]);for(const b in this._textureArrays){const e=this._textureArrays[b];for(let b=0;b<e.length;b++)K.push(e[b])}return K}hasTexture(K){if(super.hasTexture(K))return!0;for(const b in this._textures)if(this._textures[b]===K)return!0;for(const b in this._textureArrays){const e=this._textureArrays[b];for(let b=0;b<e.length;b++)if(e[b]===K)return!0}return!1}clone(K){const b=A.e.Clone((()=>new G(K,this.va(),this._shaderPath,this._options,this._storeEffectOnSubMeshes)),this);b.name=K,b.id=K,"object"===typeof b._shaderPath&&(b._shaderPath={...b._shaderPath}),this._options={...this._options},Object.keys(this._options).forEach((K=>{const b=this._options[K];Array.isArray(b)&&(this._options[K]=b.slice(0))})),this.stencil.copyTo(b.stencil);for(const e in this._textures)b.setTexture(e,this._textures[e]);for(const e in this._textureArrays)b.setTextureArray(e,this._textureArrays[e]);for(const e in this._externalTextures)b.setExternalTexture(e,this._externalTextures[e]);for(const e in this._ints)b.setInt(e,this._ints[e]);for(const e in this._uints)b.setUInt(e,this._uints[e]);for(const e in this._floats)b.setFloat(e,this._floats[e]);for(const e in this._floatsArrays)b.setFloats(e,this._floatsArrays[e]);for(const e in this._colors3)b.setColor3(e,this._colors3[e]);for(const e in this._colors3Arrays)b._colors3Arrays[e]=this._colors3Arrays[e];for(const e in this._colors4)b.setColor4(e,this._colors4[e]);for(const e in this._colors4Arrays)b._colors4Arrays[e]=this._colors4Arrays[e];for(const e in this._vectors2)b.setVector2(e,this._vectors2[e]);for(const e in this._vectors3)b.setVector3(e,this._vectors3[e]);for(const e in this._vectors4)b.setVector4(e,this._vectors4[e]);for(const e in this._quaternions)b.setQuaternion(e,this._quaternions[e]);for(const e in this._quaternionsArrays)b._quaternionsArrays[e]=this._quaternionsArrays[e];for(const e in this._matrices)b.setMatrix(e,this._matrices[e]);for(const e in this._matrixArrays)b._matrixArrays[e]=this._matrixArrays[e].slice();for(const e in this._matrices3x3)b.setMatrix3x3(e,this._matrices3x3[e]);for(const e in this._matrices2x2)b.setMatrix2x2(e,this._matrices2x2[e]);for(const e in this._vectors2Arrays)b.setArray2(e,this._vectors2Arrays[e]);for(const e in this._vectors3Arrays)b.setArray3(e,this._vectors3Arrays[e]);for(const e in this._vectors4Arrays)b.setArray4(e,this._vectors4Arrays[e]);for(const e in this._uniformBuffers)b.setUniformBuffer(e,this._uniformBuffers[e]);for(const e in this._textureSamplers)b.setTextureSampler(e,this._textureSamplers[e]);for(const e in this._storageBuffers)b.setStorageBuffer(e,this._storageBuffers[e]);return b}dispose(K,b,e){if(b){let K;for(K in this._textures)this._textures[K].dispose();for(K in this._textureArrays){const b=this._textureArrays[K];for(let K=0;K<b.length;K++)b[K].dispose()}}this._textures={},super.dispose(K,b,e)}serialize(){const K=A.e.Serialize(this);let b;for(b in K.customType="BABYLON.ShaderMaterial",K.uniqueId=this.uniqueId,K.options=this._options,K.shaderPath=this._shaderPath,K.storeEffectOnSubMeshes=this._storeEffectOnSubMeshes,K.stencil=this.stencil.serialize(),K.textures={},this._textures)K.textures[b]=this._textures[b].serialize();for(b in K.textureArrays={},this._textureArrays){K.textureArrays[b]=[];const e=this._textureArrays[b];for(let z=0;z<e.length;z++)K.textureArrays[b].push(e[z].serialize())}for(b in K.ints={},this._ints)K.ints[b]=this._ints[b];for(b in K.uints={},this._uints)K.uints[b]=this._uints[b];for(b in K.floats={},this._floats)K.floats[b]=this._floats[b];for(b in K.floatsArrays={},this._floatsArrays)K.floatsArrays[b]=this._floatsArrays[b];for(b in K.colors3={},this._colors3)K.colors3[b]=this._colors3[b].Ti();for(b in K.colors3Arrays={},this._colors3Arrays)K.colors3Arrays[b]=this._colors3Arrays[b];for(b in K.colors4={},this._colors4)K.colors4[b]=this._colors4[b].Ti();for(b in K.colors4Arrays={},this._colors4Arrays)K.colors4Arrays[b]=this._colors4Arrays[b];for(b in K.vectors2={},this._vectors2)K.vectors2[b]=this._vectors2[b].Ti();for(b in K.vectors3={},this._vectors3)K.vectors3[b]=this._vectors3[b].Ti();for(b in K.vectors4={},this._vectors4)K.vectors4[b]=this._vectors4[b].Ti();for(b in K.quaternions={},this._quaternions)K.quaternions[b]=this._quaternions[b].Ti();for(b in K.matrices={},this._matrices)K.matrices[b]=this._matrices[b].Ti();for(b in K.matrixArray={},this._matrixArrays)K.matrixArray[b]=this._matrixArrays[b];for(b in K.matrices3x3={},this._matrices3x3)K.matrices3x3[b]=this._matrices3x3[b];for(b in K.matrices2x2={},this._matrices2x2)K.matrices2x2[b]=this._matrices2x2[b];for(b in K.vectors2Arrays={},this._vectors2Arrays)K.vectors2Arrays[b]=this._vectors2Arrays[b];for(b in K.vectors3Arrays={},this._vectors3Arrays)K.vectors3Arrays[b]=this._vectors3Arrays[b];for(b in K.vectors4Arrays={},this._vectors4Arrays)K.vectors4Arrays[b]=this._vectors4Arrays[b];for(b in K.quaternionsArrays={},this._quaternionsArrays)K.quaternionsArrays[b]=this._quaternionsArrays[b];return K}static Parse(K,b,e){const k=A.e.Parse((()=>new G(K.name,b,K.shaderPath,K.options,K.storeEffectOnSubMeshes)),K,b,e);let j;for(j in K.stencil&&k.stencil.parse(K.stencil,b,e),K.textures)k.setTexture(j,t.c.Parse(K.textures[j],b,e));for(j in K.textureArrays){const z=K.textureArrays[j],T=[];for(let K=0;K<z.length;K++)T.push(t.c.Parse(z[K],b,e));k.setTextureArray(j,T)}for(j in K.ints)k.setInt(j,K.ints[j]);for(j in K.uints)k.setUInt(j,K.uints[j]);for(j in K.floats)k.setFloat(j,K.floats[j]);for(j in K.floatsArrays)k.setFloats(j,K.floatsArrays[j]);for(j in K.colors3)k.setColor3(j,T.c.Bg(K.colors3[j]));for(j in K.colors3Arrays){const b=K.colors3Arrays[j].reduce(((K,b,e)=>(e%3===0?K.push([b]):K[K.length-1].push(b),K)),[]).map((K=>T.c.Bg(K)));k.setColor3Array(j,b)}for(j in K.colors4)k.setColor4(j,T.g.Bg(K.colors4[j]));for(j in K.colors4Arrays){const b=K.colors4Arrays[j].reduce(((K,b,e)=>(e%4===0?K.push([b]):K[K.length-1].push(b),K)),[]).map((K=>T.g.Bg(K)));k.setColor4Array(j,b)}for(j in K.vectors2)k.setVector2(j,z.h.Bg(K.vectors2[j]));for(j in K.vectors3)k.setVector3(j,z.k.Bg(K.vectors3[j]));for(j in K.vectors4)k.setVector4(j,z.o.Bg(K.vectors4[j]));for(j in K.quaternions)k.setQuaternion(j,z.d.Bg(K.quaternions[j]));for(j in K.matrices)k.setMatrix(j,z.b.Bg(K.matrices[j]));for(j in K.matrixArray)k._matrixArrays[j]=new Float32Array(K.matrixArray[j]);for(j in K.matrices3x3)k.setMatrix3x3(j,K.matrices3x3[j]);for(j in K.matrices2x2)k.setMatrix2x2(j,K.matrices2x2[j]);for(j in K.vectors2Arrays)k.setArray2(j,K.vectors2Arrays[j]);for(j in K.vectors3Arrays)k.setArray3(j,K.vectors3Arrays[j]);for(j in K.vectors4Arrays)k.setArray4(j,K.vectors4Arrays[j]);for(j in K.quaternionsArrays)k.setArray4(j,K.quaternionsArrays[j]);return k}static ParseFromFileAsync(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return new Promise(((k,j)=>{const T=new u.e;T.addEventListener("readystatechange",(()=>{if(4==T.readyState)if(200==T.status){const b=JSON.parse(T.responseText),j=this.Parse(b,e||D.b.LastCreatedScene,z);K&&(j.name=K),k(j)}else j("Unable to load the ShaderMaterial")})),T.open("GET",b),T.send()}))}static ParseFromSnippetAsync(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise(((z,k)=>{const j=new u.e;j.addEventListener("readystatechange",(()=>{if(4==j.readyState)if(200==j.status){const k=JSON.parse(JSON.parse(j.responseText).jsonPayload),T=JSON.parse(k.shaderMaterial),F=this.Parse(T,b||D.b.LastCreatedScene,e);F.snippetId=K,z(F)}else k("Unable to load the snippet "+K)})),j.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),j.send()}))}}G.SnippetUrl="https://snippet.babylonjs.com",G.CreateFromSnippetAsync=G.ParseFromSnippetAsync,(0,U.e)("BABYLON.ShaderMaterial",G),k.b._LinesMeshParser=(K,b)=>i.Parse(K,b);class i extends k.b{_isShaderMaterial(K){return"ShaderMaterial"===K.getClassName()}constructor(K){let b=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,z=arguments.length>5?arguments[5]:void 0,k=arguments.length>6?arguments[6]:void 0,j=arguments.length>7?arguments[7]:void 0;super(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,b,arguments.length>4?arguments[4]:void 0),this.useVertexColor=z,this.useVertexAlpha=k,this.color=new T.c(1,1,1),this.alpha=1,this._shaderLanguage=0,b&&(this.color=b.color.clone(),this.alpha=b.alpha,this.useVertexColor=b.useVertexColor,this.useVertexAlpha=b.useVertexAlpha),this.intersectionThreshold=.1;const l={attributes:[F.f.PositionKind],uniforms:["world","viewProjection"],needAlphaBlending:!0,defines:[],useClipPlane:null,shaderLanguage:0};if(!1===k?l.needAlphaBlending=!1:l.defines.push("#define VERTEXALPHA"),z?(l.defines.push("#define VERTEXCOLOR"),l.attributes.push(F.f.ColorKind)):(l.uniforms.push("color"),this._color4=new T.g),j)this.material=j;else{this.va().getEngine().isWebGPU&&!i.ForceGLSL&&(this._shaderLanguage=1),l.shaderLanguage=this._shaderLanguage,l.extraInitializationsAsync=async()=>{1===this._shaderLanguage?await Promise.all([e.e(23).then(e.bind(e,13271)),e.e(47).then(e.bind(e,13276))]):await Promise.all([e.e(28).then(e.bind(e,13278)),e.e(48).then(e.bind(e,13286))])},this.material=new G("colorShader",this.va(),"color",l,!1),this.material.doNotSerialize=!0}}isReady(){return!!this._lineMaterial.isReady(this,!!this._userInstancedBuffersStorage||this.hasThinInstances)&&super.isReady()}getClassName(){return"LinesMesh"}get material(){return this._lineMaterial}set material(K){this._lineMaterial=K,this._lineMaterial.fillMode=Y.b.LineListDrawMode}get checkCollisions(){return!1}set checkCollisions(K){}_bind(K,b){if(!this._geometry)return this;const e=this.isUnIndexed?null:this._geometry.getIndexBuffer();if(!this._userInstancedBuffersStorage||this.hasThinInstances?this._geometry._bind(b,e):this._geometry._bind(b,e,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects),!this.useVertexColor&&this._isShaderMaterial(this._lineMaterial)){const{r:K,g:b,b:e}=this.color;this._color4.set(K,b,e,this.alpha),this._lineMaterial.setColor4("color",this._color4)}return this}_draw(K,b,e){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const z=this.va().getEngine();return this._unIndexed?z.drawArraysType(Y.b.LineListDrawMode,K.verticesStart,K.verticesCount,e):z.drawElementsType(Y.b.LineListDrawMode,K.indexStart,K.indexCount,e),this}dispose(K){(arguments.length>2?arguments[2]:void 0)||this._lineMaterial.dispose(!1,!1,!0),super.dispose(K)}clone(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;return new i(K,this.va(),b,this,e)}createInstance(K){const b=new S(K,this);if(this.instancedBuffers){b.instancedBuffers={};for(const K in this.instancedBuffers)b.instancedBuffers[K]=this.instancedBuffers[K]}return b}serialize(K){super.serialize(K),K.color=this.color.Ti(),K.alpha=this.alpha}static Parse(K,b){const e=new i(K.name,b);return e.color=T.c.Bg(K.color),e.alpha=K.alpha,e}}i.ForceGLSL=!1;class S extends l.c{constructor(K,b){super(K,b),this.intersectionThreshold=b.intersectionThreshold}getClassName(){return"InstancedLinesMesh"}}var M=e(10696);function r(K){const b=[],e=[],z=K.lines,k=K.za,T=[];let F=0;for(let j=0;j<z.length;j++){const K=z[j];for(let z=0;z<K.length;z++){const{x:l,y:Y,z:A}=K[z];if(e.push(l,Y,A),k){const K=k[j],{r:b,g:e,b:F,a:l}=K[z];T.push(b,e,F,l)}z>0&&(b.push(F-1),b.push(F)),F++}}const l=new j.e;return l.indices=b,l.xa=e,k&&(l.za=T),l}function L(K){const b=K.dashSize||3,e=K.gapSize||1,k=K.dashNb||200,T=K.points,F=[],l=[],Y=z.k.Zero();let A=0,X=0,t=0,U=0,B=0,u=0,m=0;for(m=0;m<T.length-1;m++)T[m+1].subtractToRef(T[m],Y),A+=Y.length();for(t=A/k,U=b*t/(b+e),m=0;m<T.length-1;m++){T[m+1].subtractToRef(T[m],Y),X=Math.floor(Y.length()/t),Y.normalize();for(let K=0;K<X;K++)B=t*K,F.push(T[m].x+B*Y.x,T[m].y+B*Y.y,T[m].z+B*Y.z),F.push(T[m].x+(B+U)*Y.x,T[m].y+(B+U)*Y.y,T[m].z+(B+U)*Y.z),l.push(u,u+1),u+=2}const D=new j.e;return D.xa=F,D.indices=l,D}function c(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=b.instance,k=b.lines,j=b.za;if(z){const K=z.getVerticesData(F.f.PositionKind);let b,e;j&&(b=z.getVerticesData(F.f.ColorKind));let T=0,l=0;for(let z=0;z<k.length;z++){const F=k[z];for(let k=0;k<F.length;k++)K[T]=F[k].x,K[T+1]=F[k].y,K[T+2]=F[k].z,j&&b&&(e=j[z],b[l]=e[k].r,b[l+1]=e[k].g,b[l+2]=e[k].b,b[l+3]=e[k].a,l+=4),T+=3}return z.updateVerticesData(F.f.PositionKind,K,!1,!1),j&&b&&z.updateVerticesData(F.f.ColorKind,b,!1,!1),z.refreshBoundingInfo(),z}const T=new i(K,e,null,void 0,void 0,!!j,b.useVertexAlpha,b.material);return r(b).Ca(T,b.updatable),T}function v(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=b.za?[b.za]:null;return c(K,{lines:[b.points],updatable:b.updatable,instance:b.instance,za:z,useVertexAlpha:b.useVertexAlpha,material:b.material},e)}function w(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=b.points,T=b.instance,F=b.gapSize||1,l=b.dashSize||3;if(T){const K=K=>{const b=z.k.Zero(),e=K.length/6;let k=0,F=0,l=0,Y=0,A=0,X=0,t=0,U=0;for(t=0;t<j.length-1;t++)j[t+1].subtractToRef(j[t],b),k+=b.length();l=k/e;const B=T._creationDataStorage.dashSize;for(Y=B*l/(B+T._creationDataStorage.gapSize),t=0;t<j.length-1;t++)for(j[t+1].subtractToRef(j[t],b),F=Math.floor(b.length()/l),b.normalize(),U=0;U<F&&X<K.length;)A=l*U,K[X]=j[t].x+A*b.x,K[X+1]=j[t].y+A*b.y,K[X+2]=j[t].z+A*b.z,K[X+3]=j[t].x+(A+Y)*b.x,K[X+4]=j[t].y+(A+Y)*b.y,K[X+5]=j[t].z+(A+Y)*b.z,X+=6,U++;for(;X<K.length;)K[X]=j[t].x,K[X+1]=j[t].y,K[X+2]=j[t].z,X+=3};return(b.dashNb||b.dashSize||b.gapSize||b.useVertexAlpha||b.material)&&M.b.Warn("You have used an option other than points with the instance option. Please be aware that these other options will be ignored."),T.updateMeshPositions(K,!1),T}const Y=new i(K,e,null,void 0,void 0,void 0,b.useVertexAlpha,b.material);return L(b).Ca(Y,b.updatable),Y._creationDataStorage=new k.e,Y._creationDataStorage.dashSize=l,Y._creationDataStorage.gapSize=F,Y}j.e.CreateLineSystem=r,j.e.CreateDashedLines=L,k.b.rb=function(K,b){return v(K,{points:b,updatable:arguments.length>3&&void 0!==arguments[3]&&arguments[3],instance:arguments.length>4&&void 0!==arguments[4]?arguments[4]:null},arguments.length>2&&void 0!==arguments[2]?arguments[2]:null)},k.b.CreateDashedLines=function(K,b,e,z,k){return w(K,{points:b,dashSize:e,gapSize:z,dashNb:k,updatable:arguments.length>6?arguments[6]:void 0,instance:arguments.length>7?arguments[7]:void 0},arguments.length>5&&void 0!==arguments[5]?arguments[5]:null)}},11361:(K,b,e)=>{"use strict";e.d(b,{c:()=>F,f:()=>l});var z=e(11226),k=e(11261),j=e(11186);function T(K){const b=[],e=[],z=[],T=[],F=K.width||K.size||1,l=K.height||K.size||1,Y=0===K.sideOrientation?0:K.sideOrientation||k.e.DEFAULTSIDE,A=F/2,X=l/2;e.push(-A,-X,0),z.push(0,0,-1),T.push(0,j.c?1:0),e.push(A,-X,0),z.push(0,0,-1),T.push(1,j.c?1:0),e.push(A,X,0),z.push(0,0,-1),T.push(1,j.c?0:1),e.push(-A,X,0),z.push(0,0,-1),T.push(0,j.c?0:1),b.push(0),b.push(1),b.push(2),b.push(0),b.push(2),b.push(3),k.e._ComputeSides(Y,e,b,z,T,K.frontUVs,K.backUVs);const t=new k.e;return t.indices=b,t.xa=e,t.ya=z,t.Aa=T,t}function F(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const k=new z.b(K,e);b.sideOrientation=z.b._GetDefaultSideOrientation(b.sideOrientation),k._originalBuilderSideOrientation=b.sideOrientation;return T(b).Ca(k,b.updatable),b.sourcePlane&&(k.translate(b.sourcePlane.k,-b.sourcePlane.d),k.setDirection(b.sourcePlane.k.scale(-1))),k}const l={Vf:F};k.e.Vf=T,z.b.Vf=(K,b,e,z,k)=>F(K,{size:b,width:b,height:b,sideOrientation:k,updatable:z},e)},11600:(K,b,e)=>{"use strict";e.d(b,{e:()=>l});var z=e(10967),k=e(11226),j=e(11261),T=e(11186);function F(K){const b=0|(K.segments||32),e=K.diameterX||K.diameter||1,k=K.diameterY||K.diameter||1,F=K.diameterZ||K.diameter||1,l=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,Y=K.slice&&K.slice<=0?1:K.slice||1,A=0===K.sideOrientation?0:K.sideOrientation||j.e.DEFAULTSIDE,X=!!K.dedupTopBottomIndices,t=new z.k(e/2,k/2,F/2),U=2+b,B=2*U,u=[],m=[],D=[],I=[];for(let j=0;j<=U;j++){const K=j/U,b=K*Math.PI*Y;for(let e=0;e<=B;e++){const k=e/B,j=k*Math.PI*2*l,F=z.b.RotationZ(-b),Y=z.b.RotationY(j),A=z.k.TransformCoordinates(z.k.Up(),F),X=z.k.TransformCoordinates(A,Y),U=X.multiply(t),u=X.divide(t).normalize();m.push(U.x,U.y,U.z),D.push(u.x,u.y,u.z),I.push(k,T.c?1-K:K)}if(j>0){const K=m.length/3;for(let b=K-2*(B+1);b+B+2<K;b++)X?(j>1&&(u.push(b),u.push(b+1),u.push(b+B+1)),(j<U||Y<1)&&(u.push(b+B+1),u.push(b+1),u.push(b+B+2))):(u.push(b),u.push(b+1),u.push(b+B+1),u.push(b+B+1),u.push(b+1),u.push(b+B+2))}}j.e._ComputeSides(A,m,u,D,I,K.frontUVs,K.backUVs);const x=new j.e;return x.indices=u,x.xa=m,x.ya=D,x.Aa=I,x}function l(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new k.b(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return F(b).Ca(z,b.updatable),z}j.e.CreateSphere=F,k.b.CreateSphere=(K,b,e,z,k,j)=>l(K,{segments:b,diameterX:e,diameterY:e,diameterZ:e,sideOrientation:j,updatable:k},z)},11983:(K,b,e)=>{"use strict";e.d(b,{d:()=>X});var z=e(10686),k=e(11991),j=e(11270),T=e(11030),F=e(11261),l=e(10696);function Y(K,b,e,z,k){let j=null,T=null,F=null;try{let l;j=new K.Decoder,T=new K.DecoderBuffer,T.Init(b,b.byteLength);const Y=j.GetEncodedGeometryType(T);switch(Y){case K.TRIANGULAR_MESH:{const b=new K.Mesh;if(l=j.DecodeBufferToMesh(T,b),!l.ok()||0===b.ptr)throw new Error(l.error_msg());const e=3*b.num_faces(),k=4*e,Y=K._malloc(k);try{j.GetTrianglesUInt32Array(b,k,Y);const T=new Uint32Array(e);T.set(new Uint32Array(K.HEAPF32.buffer,Y,e)),z(T)}finally{K._free(Y)}F=b;break}case K.POINT_CLOUD:{const b=new K.PointCloud;if(l=j.DecodeBufferToPointCloud(T,b),!l.ok()||!b.ptr)throw new Error(l.error_msg());F=b;break}default:throw new Error(`Invalid geometry type ${Y}`)}const A=F.num_points(),X=(b,e,z,j)=>{const T=j.data_type(),F=j.num_components(),l=j.normalized(),Y=j.byte_stride(),X=j.byte_offset(),t={[K.DT_FLOAT32]:{typedArrayConstructor:Float32Array,heap:K.HEAPF32},[K.DT_INT8]:{typedArrayConstructor:Int8Array,heap:K.HEAP8},[K.DT_INT16]:{typedArrayConstructor:Int16Array,heap:K.HEAP16},[K.DT_INT32]:{typedArrayConstructor:Int32Array,heap:K.HEAP32},[K.DT_UINT8]:{typedArrayConstructor:Uint8Array,heap:K.HEAPU8},[K.DT_UINT16]:{typedArrayConstructor:Uint16Array,heap:K.HEAPU16},[K.DT_UINT32]:{typedArrayConstructor:Uint32Array,heap:K.HEAPU32}}[T];if(!t)throw new Error(`Invalid data type ${T}`);const U=A*F,B=U*t.typedArrayConstructor.BYTES_PER_ELEMENT,u=K._malloc(B);try{b.GetAttributeDataArrayForAllPoints(e,j,T,B,u);const K=new t.typedArrayConstructor(t.heap.buffer,u,U);k(z,K.slice(),F,X,Y,l)}finally{K._free(u)}};if(e)for(const K in e){const b=e[K],z=j.GetAttributeByUniqueId(F,b);X(j,F,K,z)}else{const b={position:K.POSITION,k:K.NORMAL,color:K.COLOR,uv:K.TEX_COORD};for(const K in b){const e=j.GetAttributeId(F,b[K]);if(-1!==e){const b=j.GetAttribute(F,e);X(j,F,K,b)}}}return A}finally{F&&K.destroy(F),T&&K.destroy(T),j&&K.destroy(j)}}function A(){let K;onmessage=b=>{const e=b.data;switch(e.id){case"init":{const b=e.decoder;b.url&&importScripts(b.url);const z=b.wasmBinary?{wasmBinary:b.wasmBinary}:{};K=DracoDecoderModule(z),postMessage({id:"initDone"});break}case"decodeMesh":if(!K)throw new Error("Draco decoder module is not available");K.then((K=>{const b=Y(K,e.dataView,e.attributes,(K=>{postMessage({id:"indices",data:K},[K.buffer])}),((K,b,e,z,k,j)=>{postMessage({id:"attribute",kind:K,data:b,size:e,byteOffset:z,byteStride:k,normalized:j},[b.buffer])}));postMessage({id:"decodeMeshDone",totalVertices:b})}))}}}class X{static get DecoderAvailable(){const K=X.Configuration.decoder;return!!(K.wasmUrl&&K.wasmBinaryUrl&&"object"===typeof WebAssembly||K.fallbackUrl)}static GetDefaultNumWorkers(){return"object"===typeof navigator&&navigator.hardwareConcurrency?Math.min(Math.floor(.5*navigator.hardwareConcurrency),4):1}static get Default(){return X._Default||(X._Default=new X),X._Default}static ResetDefault(K){X._Default&&(K||X._Default.dispose(),X._Default=null)}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X.DefaultNumWorkers;const b=X.Configuration.decoder;if(b.workerPool||"object"===typeof K&&K.workerPool)this._workerPoolPromise=Promise.resolve(b.workerPool||K.workerPool);else{const e=b.wasmBinary||"object"===typeof K&&K.wasmBinary,j="number"===typeof K?K:K.numWorkers,T=j&&"function"===typeof Worker&&"function"===typeof URL,F=T||!T&&!b.jsModule,l=b.wasmUrl&&b.wasmBinaryUrl&&"object"===typeof WebAssembly?{url:F?z.f.GetBabylonScriptURL(b.wasmUrl,!0):"",wasmBinaryPromise:e?Promise.resolve(e):z.f.LoadFileAsync(z.f.GetBabylonScriptURL(b.wasmBinaryUrl,!0))}:{url:F?z.f.GetBabylonScriptURL(b.fallbackUrl):"",wasmBinaryPromise:Promise.resolve(void 0)};T?this._workerPoolPromise=l.wasmBinaryPromise.then((K=>{const b=`${Y}(${A})()`,e=URL.createObjectURL(new Blob([b],{type:"application/javascript"}));return new k.e(j,(()=>function(K,b,e){return new Promise(((z,k)=>{const j=b=>{K.removeEventListener("error",j),K.removeEventListener("message",T),k(b)},T=b=>{"initDone"===b.data.id&&(K.removeEventListener("error",j),K.removeEventListener("message",T),z(K))};if(K.addEventListener("error",j),K.addEventListener("message",T),b){const z=b.slice(0);K.postMessage({id:"init",decoder:{url:e,wasmBinary:z}},[z])}else K.postMessage({id:"init",decoder:{url:e}})}))}(new Worker(e),K,l.url)))})):this._decoderModulePromise=l.wasmBinaryPromise.then((async K=>{if("undefined"===typeof DracoDecoderModule&&!b.jsModule){if(!l.url)throw new Error("Draco decoder module is not available");await z.f.LoadBabylonScriptAsync(l.url)}return await(e=K,k=b.jsModule,new Promise((K=>{(k||DracoDecoderModule)({wasmBinary:e}).then((b=>{K({module:b})}))})));var e,k}))}}dispose(){this._workerPoolPromise&&this._workerPoolPromise.then((K=>{K.dispose()})),delete this._workerPoolPromise,delete this._decoderModulePromise}async whenReadyAsync(){this._workerPoolPromise?await this._workerPoolPromise:this._decoderModulePromise&&await this._decoderModulePromise}decodeMeshToMeshDataAsync(K,b,e){const z=K instanceof ArrayBuffer?new Int8Array(K):new Int8Array(K.buffer,K.byteOffset,K.byteLength);if(this._workerPoolPromise)return this._workerPoolPromise.then((K=>new Promise(((k,j)=>{K.push(((K,T)=>{let F=null;const Y=[],A=b=>{K.removeEventListener("error",A),K.removeEventListener("message",X),j(b),T()},X=b=>{const z=b.data;switch(z.id){case"decodeMeshDone":K.removeEventListener("error",A),K.removeEventListener("message",X),k({indices:F,attributes:Y,totalVertices:z.totalVertices}),T();break;case"indices":F=z.data;break;case"attribute":Y.push({kind:z.kind,data:z.data,size:z.size,byteOffset:z.byteOffset,byteStride:z.byteStride,normalized:(j=z.kind,t=z.normalized,e&&void 0!==e[j]?(t!==e[j]&&l.b.Warn(`Normalized flag from Draco data (${t}) does not match normalized flag from glTF accessor (${e[j]}). Using flag from glTF accessor.`),e[j]):t)})}var j,t};K.addEventListener("error",A),K.addEventListener("message",X);const t=z.slice();K.postMessage({id:"decodeMesh",dataView:t,attributes:b},[t.buffer])}))}))));if(this._decoderModulePromise)return this._decoderModulePromise.then((K=>{let e=null;const k=[],j=Y(K.module,z,b,(K=>{e=K}),((K,b,e,z,j,T)=>{k.push({kind:K,data:b,size:e,byteOffset:z,byteStride:j,normalized:T})}));return{indices:e,attributes:k,totalVertices:j}}));throw new Error("Draco decoder module is not available")}async decodeMeshToGeometryAsync(K,b,e,z){const k=await this.decodeMeshToMeshDataAsync(e,z),F=new j.c(K,b);k.indices&&F.setIndices(k.indices);for(const j of k.attributes)F.setVerticesBuffer(new T.f(b.getEngine(),j.data,j.kind,!1,void 0,j.byteStride,void 0,j.byteOffset,j.size,void 0,j.normalized,!0),k.totalVertices);return F}async _decodeMeshToGeometryForGltfAsync(K,b,e,z,k){const F=await this.decodeMeshToMeshDataAsync(e,z,k),l=new j.c(K,b);F.indices&&l.setIndices(F.indices);for(const j of F.attributes)l.setVerticesBuffer(new T.f(b.getEngine(),j.data,j.kind,!1,void 0,j.byteStride,void 0,j.byteOffset,j.size,void 0,j.normalized,!0),F.totalVertices);return l}async decodeMeshAsync(K,b){const e=await this.decodeMeshToMeshDataAsync(K,b),z=new F.e;e.indices&&(z.indices=e.indices);for(const k of e.attributes){const K=T.f.GetFloatData(k.data,k.size,T.f.GetDataType(k.data),k.byteOffset,k.byteStride,k.normalized,e.totalVertices);z.set(K,k.kind)}return z}}X.Configuration={decoder:{wasmUrl:`${z.f._DefaultCdnUrl}/draco_wasm_wrapper_gltf.js`,wasmBinaryUrl:`${z.f._DefaultCdnUrl}/draco_decoder_gltf.wasm`,fallbackUrl:`${z.f._DefaultCdnUrl}/draco_decoder_gltf.js`}},X.DefaultNumWorkers=X.GetDefaultNumWorkers(),X._Default=null},11430:(K,b,e)=>{"use strict";e.d(b,{b:()=>k});var z=e(11033);class k extends z.b{constructor(K){super(),this._buffer=K}get underlyingResource(){return this._buffer}}},11283:(K,b,e)=>{"use strict";e.d(b,{e:()=>S});var z=e(10936),k=e(10690),j=e(10967),T=e(11030),F=e(11261),l=e(11286),Y=e(11021),A=e(11100),X=e(11017);class t{constructor(){this._checkCollisions=!1,this._collisionMask=-1,this._collisionGroup=-1,this._surroundingMeshes=null,this._collider=null,this._oldPositionForCollisions=new j.k(0,0,0),this._diffPositionForCollisions=new j.k(0,0,0),this._collisionResponse=!0}}var U=e(10710),B=e(11117),u=e(10994),m=e(10969),D=e(11291),I=e(10799),x=e(10938),Q=e(10750);class G{constructor(){this.facetNb=0,this.partitioningSubdivisions=10,this.partitioningBBoxRatio=1.01,this.facetDataEnabled=!1,this.facetParameters={},this.bbSize=j.k.Zero(),this.subDiv={max:1,X:1,Y:1,Z:1},this.facetDepthSort=!1,this.facetDepthSortEnabled=!1}}class i{constructor(){this._hasVertexAlpha=!1,this._useVertexColors=!0,this._numBoneInfluencers=4,this._applyFog=!0,this._receiveShadows=!1,this._facetData=new G,this._visibility=1,this._skeleton=null,this._layerMask=268435455,this._computeBonesUsingShaders=!0,this._isActive=!1,this._onlyForInstances=!1,this._isActiveIntermediate=!1,this._onlyForInstancesIntermediate=!1,this._actAsRegularMesh=!1,this._currentLOD=null,this._currentLODIsUpToDate=!1,this._collisionRetryCount=3,this._morphTargetManager=null,this._renderingGroupId=0,this._bakedVertexAnimationManager=null,this._material=null,this._positions=null,this._pointerOverDisableMeshTesting=!1,this._meshCollisionData=new t,this._enableDistantPicking=!1,this._rawBoundingInfo=null,this._sideOrientationHint=!1,this._inheritVisibility=!1}}class S extends l.c{static get BILLBOARDMODE_NONE(){return l.c.BILLBOARDMODE_NONE}static get BILLBOARDMODE_X(){return l.c.BILLBOARDMODE_X}static get BILLBOARDMODE_Y(){return l.c.BILLBOARDMODE_Y}static get BILLBOARDMODE_Z(){return l.c.BILLBOARDMODE_Z}static get BILLBOARDMODE_ALL(){return l.c.BILLBOARDMODE_ALL}static get BILLBOARDMODE_USE_POSITION(){return l.c.BILLBOARDMODE_USE_POSITION}get facetNb(){return this._internalAbstractMeshDataInfo._facetData.facetNb}get partitioningSubdivisions(){return this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions}set partitioningSubdivisions(K){this._internalAbstractMeshDataInfo._facetData.partitioningSubdivisions=K}get partitioningBBoxRatio(){return this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio}set partitioningBBoxRatio(K){this._internalAbstractMeshDataInfo._facetData.partitioningBBoxRatio=K}get mustDepthSortFacets(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSort}set mustDepthSortFacets(K){this._internalAbstractMeshDataInfo._facetData.facetDepthSort=K}get facetDepthSortFrom(){return this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom}set facetDepthSortFrom(K){this._internalAbstractMeshDataInfo._facetData.facetDepthSortFrom=K}get collisionRetryCount(){return this._internalAbstractMeshDataInfo._collisionRetryCount}set collisionRetryCount(K){this._internalAbstractMeshDataInfo._collisionRetryCount=K}get isFacetDataEnabled(){return this._internalAbstractMeshDataInfo._facetData.facetDataEnabled}get morphTargetManager(){return this._internalAbstractMeshDataInfo._morphTargetManager}set morphTargetManager(K){this._internalAbstractMeshDataInfo._morphTargetManager!==K&&(this._internalAbstractMeshDataInfo._morphTargetManager=K,this._syncGeometryWithMorphTargetManager())}get bakedVertexAnimationManager(){return this._internalAbstractMeshDataInfo._bakedVertexAnimationManager}set bakedVertexAnimationManager(K){this._internalAbstractMeshDataInfo._bakedVertexAnimationManager!==K&&(this._internalAbstractMeshDataInfo._bakedVertexAnimationManager=K,this._markSubMeshesAsAttributesDirty())}_syncGeometryWithMorphTargetManager(){}_updateNonUniformScalingState(K){return!!super._updateNonUniformScalingState(K)&&(this._markSubMeshesAsMiscDirty(),!0)}get rawBoundingInfo(){return this._internalAbstractMeshDataInfo._rawBoundingInfo}set rawBoundingInfo(K){this._internalAbstractMeshDataInfo._rawBoundingInfo=K}set sk(K){this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver&&this.onCollideObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollideObserver=this.onCollideObservable.add(K)}set onCollisionPositionChange(K){this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver&&this.onCollisionPositionChangeObservable.remove(this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver),this._internalAbstractMeshDataInfo._meshCollisionData._onCollisionPositionChangeObserver=this.onCollisionPositionChangeObservable.add(K)}get visibility(){return this._internalAbstractMeshDataInfo._visibility}set visibility(K){if(this._internalAbstractMeshDataInfo._visibility===K)return;const b=this._internalAbstractMeshDataInfo._visibility;this._internalAbstractMeshDataInfo._visibility=K,(1===b&&1!==K||1!==b&&1===K)&&this._markSubMeshesAsDirty((K=>{K.markAsMiscDirty(),K.markAsPrePassDirty()}))}get inheritVisibility(){return this._internalAbstractMeshDataInfo._inheritVisibility}set inheritVisibility(K){this._internalAbstractMeshDataInfo._inheritVisibility=K}get isVisible(){if(!this._isVisible||!this.inheritVisibility||!this._parentNode)return this._isVisible;if(this._isVisible){let K=this._parentNode;for(;K;){const b=K.isVisible;if("undefined"!==typeof b)return b;K=K.parent}}return this._isVisible}set isVisible(K){this._isVisible=K}get pointerOverDisableMeshTesting(){return this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting}set pointerOverDisableMeshTesting(K){this._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting=K}get renderingGroupId(){return this._internalAbstractMeshDataInfo._renderingGroupId}set renderingGroupId(K){this._internalAbstractMeshDataInfo._renderingGroupId=K}get material(){return this._internalAbstractMeshDataInfo._material}set material(K){this._setMaterial(K)}_setMaterial(K){this._internalAbstractMeshDataInfo._material!==K&&(this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),this._internalAbstractMeshDataInfo._material=K,K&&K.meshMap&&(K.meshMap[this.uniqueId]=this),this.onMaterialChangedObservable.hasObservers()&&this.onMaterialChangedObservable.notifyObservers(this),this.Rf&&(this.resetDrawCache(),this._unBindEffect()))}getMaterialForRenderPass(K){var b;return null===(b=this._internalAbstractMeshDataInfo._materialForRenderPass)||void 0===b?void 0:b[K]}setMaterialForRenderPass(K,b){this.resetDrawCache(K),this._internalAbstractMeshDataInfo._materialForRenderPass||(this._internalAbstractMeshDataInfo._materialForRenderPass=[]),this._internalAbstractMeshDataInfo._materialForRenderPass[K]=b}get receiveShadows(){return this._internalAbstractMeshDataInfo._receiveShadows}set receiveShadows(K){this._internalAbstractMeshDataInfo._receiveShadows!==K&&(this._internalAbstractMeshDataInfo._receiveShadows=K,this._markSubMeshesAsLightDirty())}get hasVertexAlpha(){return this._internalAbstractMeshDataInfo._hasVertexAlpha}set hasVertexAlpha(K){this._internalAbstractMeshDataInfo._hasVertexAlpha!==K&&(this._internalAbstractMeshDataInfo._hasVertexAlpha=K,this._markSubMeshesAsAttributesDirty(),this._markSubMeshesAsMiscDirty())}get useVertexColors(){return this._internalAbstractMeshDataInfo._useVertexColors}set useVertexColors(K){this._internalAbstractMeshDataInfo._useVertexColors!==K&&(this._internalAbstractMeshDataInfo._useVertexColors=K,this._markSubMeshesAsAttributesDirty())}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(K){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==K&&(this._internalAbstractMeshDataInfo._computeBonesUsingShaders=K,this._markSubMeshesAsAttributesDirty())}get numBoneInfluencers(){return this._internalAbstractMeshDataInfo._numBoneInfluencers}set numBoneInfluencers(K){this._internalAbstractMeshDataInfo._numBoneInfluencers!==K&&(this._internalAbstractMeshDataInfo._numBoneInfluencers=K,this._markSubMeshesAsAttributesDirty())}get applyFog(){return this._internalAbstractMeshDataInfo._applyFog}set applyFog(K){this._internalAbstractMeshDataInfo._applyFog!==K&&(this._internalAbstractMeshDataInfo._applyFog=K,this._markSubMeshesAsMiscDirty())}get enableDistantPicking(){return this._internalAbstractMeshDataInfo._enableDistantPicking}set enableDistantPicking(K){this._internalAbstractMeshDataInfo._enableDistantPicking=K}get layerMask(){return this._internalAbstractMeshDataInfo._layerMask}set layerMask(K){K!==this._internalAbstractMeshDataInfo._layerMask&&(this._internalAbstractMeshDataInfo._layerMask=K,this._resyncLightSources())}get collisionMask(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask}set collisionMask(K){this._internalAbstractMeshDataInfo._meshCollisionData._collisionMask=isNaN(K)?-1:K}get collisionResponse(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse}set collisionResponse(K){this._internalAbstractMeshDataInfo._meshCollisionData._collisionResponse=K}get collisionGroup(){return this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup}set collisionGroup(K){this._internalAbstractMeshDataInfo._meshCollisionData._collisionGroup=isNaN(K)?-1:K}get surroundingMeshes(){return this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes}set surroundingMeshes(K){this._internalAbstractMeshDataInfo._meshCollisionData._surroundingMeshes=K}get lightSources(){return this._lightSources}set skeleton(K){const b=this._internalAbstractMeshDataInfo._skeleton;b&&b.needInitialSkinMatrix&&b._unregisterMeshWithPoseMatrix(this),K&&K.needInitialSkinMatrix&&K._registerMeshWithPoseMatrix(this),this._internalAbstractMeshDataInfo._skeleton=K,this._internalAbstractMeshDataInfo._skeleton||(this._bonesTransformMatrices=null),this._markSubMeshesAsAttributesDirty()}get skeleton(){return this._internalAbstractMeshDataInfo._skeleton}constructor(K){var b;let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;switch(super(K,e,!1),b=this,this._internalAbstractMeshDataInfo=new i,this._waitingMaterialId=null,this._waitingMorphTargetManagerId=null,this.li=S.mi,this.onCollideObservable=new k.d,this.onCollisionPositionChangeObservable=new k.d,this.onMaterialChangedObservable=new k.d,this.definedFacingForward=!0,this._occlusionQuery=null,this._renderingGroup=null,this.alphaIndex=Number.MAX_VALUE,this._isVisible=!0,this.ub=!0,this.isNearPickable=!1,this.isNearGrabbable=!1,this.showSubMeshesBoundingBox=!1,this.isBlocker=!1,this.enablePointerMoveEvents=!1,this.outlineColor=u.c.Red(),this.outlineWidth=.02,this.overlayColor=u.c.Red(),this.overlayAlpha=.5,this.useOctreeForRenderingSelection=!0,this.useOctreeForPicking=!0,this.useOctreeForCollisions=!0,this.ob=!1,this.Da=!1,this.actionManager=null,this.ellipsoid=new j.k(.5,1,.5),this.ellipsoidOffset=new j.k(0,0,0),this.edgesWidth=1,this.edgesColor=new u.g(1,0,0,1),this._edgesRenderer=null,this._masterMesh=null,this._boundingInfo=null,this._boundingInfoIsDirty=!0,this._renderId=0,this._intersectionsInProgress=new Array,this._unIndexed=!1,this._lightSources=new Array,this._waitingData={lods:null,actions:null,uc:null},this._bonesTransformMatrices=null,this._transformMatrixTexture=null,this.onRebuildObservable=new k.d,this._onCollisionPositionChange=function(K,e){let z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.subtractToRef(b._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions.length()>Q.e.CollisionsEpsilon&&b.position.addInPlace(b._internalAbstractMeshDataInfo._meshCollisionData._diffPositionForCollisions),z&&b.onCollideObservable.notifyObservers(z),b.onCollisionPositionChangeObservable.notifyObservers(b.position)},e=this.va(),e.Wh(this),this._resyncLightSources(),this._uniformBuffer=new X.d(this.va().getEngine(),void 0,void 0,K,!this.va().getEngine().isWebGPU),this._buildUniformLayout(),e.performancePriority){case 2:this.Da=!0;case 1:this.ob=!0,this.ub=!1}}_buildUniformLayout(){this._uniformBuffer.addUniform("world",16),this._uniformBuffer.addUniform("visibility",1),this._uniformBuffer.create()}transferToEffect(K){const b=this._uniformBuffer;b.qj("world",K),b.updateFloat("visibility",this._internalAbstractMeshDataInfo._visibility),b.update()}getMeshUniformBuffer(){return this._uniformBuffer}getClassName(){return"AbstractMesh"}toString(K){let b="Name: "+this.name+", isInstance: "+("InstancedMesh"!==this.getClassName()?"YES":"NO");b+=", # of submeshes: "+(this.Rf?this.Rf.length:0);const e=this._internalAbstractMeshDataInfo._skeleton;return e&&(b+=", skeleton: "+e.name),K&&(b+=", billboard mode: "+["NONE","X","Y",null,"Z",null,null,"ALL"][this.billboardMode],b+=", freeze wrld mat: "+(this._isWorldMatrixFrozen||this._waitingData.uc?"YES":"NO")),b}_getEffectiveParent(){return this._masterMesh&&this.billboardMode!==l.c.BILLBOARDMODE_NONE?this._masterMesh:super._getEffectiveParent()}_getActionManagerForTrigger(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.actionManager&&(b||this.actionManager.isRecursive)){if(!K)return this.actionManager;if(this.actionManager.hasSpecificTrigger(K))return this.actionManager}return this.parent?this.parent._getActionManagerForTrigger(K,!1):null}_rebuild(){if(this.onRebuildObservable.notifyObservers(this),null!==this._occlusionQuery&&(this._occlusionQuery=null),this.Rf){for(const K of this.Rf)K._rebuild();this.resetDrawCache()}}_resyncLightSources(){this._lightSources.length=0;for(const K of this.va().lights)K.isEnabled()&&K.canAffectMesh(this)&&this._lightSources.push(K);this._markSubMeshesAsLightDirty()}_resyncLightSource(K){const b=K.isEnabled()&&K.canAffectMesh(this),e=this._lightSources.indexOf(K);let z=!1;if(-1===e){if(!b)return;this._lightSources.push(K)}else{if(b)return;z=!0,this._lightSources.splice(e,1)}this._markSubMeshesAsLightDirty(z)}_unBindEffect(){for(const K of this.Rf)K.setEffect(null)}_removeLightSource(K,b){const e=this._lightSources.indexOf(K);-1!==e&&(this._lightSources.splice(e,1),this._markSubMeshesAsLightDirty(b))}_markSubMeshesAsDirty(K){if(this.Rf)for(const b of this.Rf)for(let e=0;e<b._drawWrappers.length;++e){const z=b._drawWrappers[e];z&&z.defines&&z.defines.markAllAsDirty&&K(z.defines)}}_markSubMeshesAsLightDirty(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._markSubMeshesAsDirty((b=>b.markAsLightDirty(K)))}_markSubMeshesAsAttributesDirty(){this._markSubMeshesAsDirty((K=>K.markAsAttributesDirty()))}_markSubMeshesAsMiscDirty(){this._markSubMeshesAsDirty((K=>K.markAsMiscDirty()))}rg(K){return this._currentRenderId=Number.MAX_VALUE,super.rg(K),this._isDirty=!0,this}resetDrawCache(K){if(this.Rf)for(const b of this.Rf)b.resetDrawCache(K)}get isBlocked(){return!1}getLOD(K){return this}getTotalVertices(){return 0}getTotalIndices(){return 0}Lf(){return null}getVerticesData(K){return null}Ga(K,b,e,z){return this}updateVerticesData(K,b,e,z){return this}setIndices(K,b){return this}isVerticesDataPresent(K){return!1}getBoundingInfo(){return this._masterMesh?this._masterMesh.getBoundingInfo():(this._boundingInfoIsDirty&&(this._boundingInfoIsDirty=!1,this.Ea()),this._boundingInfo)}getRawBoundingInfo(){return this.rawBoundingInfo??this.getBoundingInfo()}setBoundingInfo(K){return this._boundingInfo=K,this}get hasBoundingInfo(){return null!==this._boundingInfo}buildBoundingInfo(K,b,e){return this._boundingInfo=new A.b(K,b,e),this._boundingInfo}normalizeToUnitCube(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;return super.normalizeToUnitCube(K,b,e)}get useBones(){return this.skeleton&&this.va().skeletonsEnabled&&this.isVerticesDataPresent(T.f.MatricesIndicesKind)&&this.isVerticesDataPresent(T.f.MatricesWeightsKind)}_preActivate(){}_preActivateForIntermediateRendering(K){}_activate(K,b){return this._renderId=K,!0}_postActivate(){}_freeze(){}_unFreeze(){}getWorldMatrix(){return this._masterMesh&&this.billboardMode===l.c.BILLBOARDMODE_NONE?this._masterMesh.getWorldMatrix():super.getWorldMatrix()}_getWorldMatrixDeterminant(){return this._masterMesh?this._masterMesh._getWorldMatrixDeterminant():super._getWorldMatrixDeterminant()}get isAnInstance(){return!1}get hasInstances(){return!1}get hasThinInstances(){return!1}movePOV(K,b,e){return this.position.addInPlace(this.calcMovePOV(K,b,e)),this}calcMovePOV(K,b,e){const z=new j.b;(this.rotationQuaternion?this.rotationQuaternion:j.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z)).toRotationMatrix(z);const k=j.k.Zero(),T=this.definedFacingForward?-1:1;return j.k.TransformCoordinatesFromFloatsToRef(K*T,b,e*T,z,k),k}rotatePOV(K,b,e){return this.rotation.addInPlace(this.calcRotatePOV(K,b,e)),this}calcRotatePOV(K,b,e){const z=this.definedFacingForward?1:-1;return new j.k(K*z,b,e*z)}Fa(K,b){if(K){const e=(0,B.h)(K,0,this.getTotalVertices(),b);this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new A.b(e.minimum,e.maximum)}if(this.Rf)for(let e=0;e<this.Rf.length;e++)this.Rf[e].refreshBoundingInfo(K);this.Ea()}_refreshBoundingInfoDirect(K){if(this._boundingInfo?this._boundingInfo.reConstruct(K.minimum,K.maximum):this._boundingInfo=new A.b(K.minimum,K.maximum),this.Rf)for(let b=0;b<this.Rf.length;b++)this.Rf[b].refreshBoundingInfo(null);this.Ea()}static _ApplySkeleton(K,b,e,z,k,F,l){!function(K,b,e,z,k,F,l){const Y=j.e.gb[0],A=j.e.Matrix[0],X=j.e.Matrix[1],t=b===T.f.NormalKind?j.k.TransformNormalFromFloatsToRef:j.k.TransformCoordinatesFromFloatsToRef;for(let T=0,U=0;T<K.length;T+=3,U+=4){let b,B;for(A.reset(),b=0;b<4;b++)B=k[U+b],B>0&&(j.b.FromFloat32ArrayToRefScaled(e,Math.floor(16*z[U+b]),B,X),A.addToSelf(X));if(F&&l)for(b=0;b<4;b++)B=l[U+b],B>0&&(j.b.FromFloat32ArrayToRefScaled(e,Math.floor(16*F[U+b]),B,X),A.addToSelf(X));t(K[T],K[T+1],K[T+2],A,Y),Y.toArray(K,T)}}(K,b,e,z,k,F,l)}_getData(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:T.f.PositionKind;const z=K.cache,k=K=>{if(z){const b=z._vertexData||(z._vertexData={});return b[K]||this.copyVerticesData(K,b),b[K]}return this.getVerticesData(K)};if(b||(b=k(e)),!b)return null;if(z?(z._outputData?z._outputData.set(b):z._outputData=new Float32Array(b),b=z._outputData):(K.applyMorph&&this.morphTargetManager||K.applySkeleton&&this.skeleton)&&(b=b.slice()),K.applyMorph&&this.morphTargetManager&&function(K,b,e){let z=null;switch(b){case T.f.PositionKind:z=K=>K.getPositions();break;case T.f.NormalKind:z=K=>K.getNormals();break;case T.f.TangentKind:z=K=>K.getTangents();break;case T.f.UVKind:z=K=>K.getUVs();break;default:return}for(let k=0;k<K.length;k++){let b=K[k];for(let j=0;j<e.numTargets;j++){const T=e.getTarget(j),F=T.influence;if(0!==F){const e=z(T);e&&(b+=(e[k]-K[k])*F)}}K[k]=b}}(b,e,this.morphTargetManager),K.applySkeleton&&this.skeleton){const K=k(T.f.MatricesIndicesKind),z=k(T.f.MatricesWeightsKind);if(z&&K){const j=this.numBoneInfluencers>4,F=j?k(T.f.MatricesIndicesExtraKind):null,l=j?k(T.f.MatricesWeightsExtraKind):null,Y=this.skeleton.getTransformMatrices(this);S._ApplySkeleton(b,e,Y,K,z,F,l)}}if(!1!==K.updatePositionsArray&&e===T.f.PositionKind){const K=this._internalAbstractMeshDataInfo._positions||[],e=K.length;if(K.length=b.length/3,e<K.length)for(let b=e;b<K.length;b++)K[b]=new j.k;for(let z=0,k=0;z<K.length;z++,k+=3)K[z].Yd(b[k],b[k+1],b[k+2]);this._internalAbstractMeshDataInfo._positions=K}return b}getNormalsData(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getData({applySkeleton:K,applyMorph:b,updatePositionsArray:!1},null,T.f.NormalKind)}Hd(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return this._getData({applySkeleton:K,applyMorph:b,updatePositionsArray:!1},e,T.f.PositionKind)}Ea(){return this._boundingInfo?this._boundingInfo.update(this.worldMatrixFromCache):this._boundingInfo=new A.b(j.k.Zero(),j.k.Zero(),this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}_updateSubMeshesBoundingInfo(K){if(!this.Rf)return this;const b=this.Rf.length;for(let e=0;e<b;e++){const z=this.Rf[e];(b>1||!z.IsGlobal)&&z.updateBoundingInfo(K)}return this}_afterComputeWorldMatrix(){this.Da||(this._boundingInfoIsDirty=!0)}isInFrustum(K){return this.getBoundingInfo().isInFrustum(K,this.li)}isCompletelyInFrustum(K){return this.getBoundingInfo().isCompletelyInFrustum(K)}intersectsMesh(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;const z=this.getBoundingInfo(),k=K.getBoundingInfo();if(z.intersects(k,b))return!0;if(e)for(const j of this.getChildMeshes())if(j.intersectsMesh(K,b,!0))return!0;return!1}intersectsPoint(K){return this.getBoundingInfo().intersectsPoint(K)}get checkCollisions(){return this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions}set checkCollisions(K){this._internalAbstractMeshDataInfo._meshCollisionData._checkCollisions=K}get collider(){return this._internalAbstractMeshDataInfo._meshCollisionData._collider}moveWithCollisions(K){this.getAbsolutePosition().addToRef(this.ellipsoidOffset,this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions);const b=this.va().collisionCoordinator;return this._internalAbstractMeshDataInfo._meshCollisionData._collider||(this._internalAbstractMeshDataInfo._meshCollisionData._collider=b.createCollider()),this._internalAbstractMeshDataInfo._meshCollisionData._collider._radius=this.ellipsoid,b.getNewPosition(this._internalAbstractMeshDataInfo._meshCollisionData._oldPositionForCollisions,K,this._internalAbstractMeshDataInfo._meshCollisionData._collider,this.collisionRetryCount,this,this._onCollisionPositionChange,this.uniqueId),this}_collideForSubMesh(K,b,e){var z;if(this._generatePointsArray(),!this._positions)return this;if(!K._lastColliderWorldVertices||!K._lastColliderTransformMatrix.equals(b)){K._lastColliderTransformMatrix=b.clone(),K._lastColliderWorldVertices=[],K._trianglePlanes=[];const e=K.verticesStart,z=K.verticesStart+K.verticesCount;for(let k=e;k<z;k++)K._lastColliderWorldVertices.push(j.k.TransformCoordinates(this._positions[k],b))}return e._collide(K._trianglePlanes,K._lastColliderWorldVertices,this.Lf(),K.indexStart,K.indexStart+K.indexCount,K.verticesStart,!!K.Ha(),this,this._shouldConvertRHS(),7===(null===(z=K.Ha())||void 0===z?void 0:z.fillMode)),this}_processCollisionsForSubMeshes(K,b){const e=this._scene.getCollidingSubMeshCandidates(this,K),z=e.length;for(let k=0;k<z;k++){const j=e.data[k];z>1&&!j._checkCollision(K)||this._collideForSubMesh(j,b,K)}return this}_shouldConvertRHS(){return!1}_checkCollision(K){if(!this.getBoundingInfo()._checkCollision(K))return this;const b=j.e.Matrix[0],e=j.e.Matrix[1];return j.b.ScalingToRef(1/K._radius.x,1/K._radius.y,1/K._radius.z,b),this.worldMatrixFromCache.multiplyToRef(b,e),this._processCollisionsForSubMeshes(K,e),this}_generatePointsArray(){return!1}intersects(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0,T=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const F=new Y.c,l=this.getClassName(),A="InstancedLinesMesh"===l||"LinesMesh"===l||"GreasedLineMesh"===l?this.intersectionThreshold:0,X=this.getBoundingInfo();if(!this.Rf)return F;if(!T&&(!K.intersectsSphere(X.boundingSphere,A)||!K.intersectsBox(X.boundingBox,A)))return F;if(z)return F.hit=!T,F.pickedMesh=T?null:this,F.distance=T?0:j.k.Distance(K.origin,X.boundingSphere.center),F.subMeshId=0,F;if(!this._generatePointsArray())return F;let t=null;const U=this._scene.getIntersectingSubMeshCandidates(this,K),B=U.length;let u=!1;for(let j=0;j<B;j++){const K=U.data[j].Ha();if(K&&(7==K.fillMode||0==K.fillMode||1==K.fillMode||2==K.fillMode||4==K.fillMode)){u=!0;break}}if(!u)return F.hit=!0,F.pickedMesh=this,F.distance=j.k.Distance(K.origin,X.boundingSphere.center),F.subMeshId=-1,F;for(let j=0;j<B;j++){const z=U.data[j];if(B>1&&!T&&!z.canIntersects(K))continue;const k=z.intersects(K,this._positions,this.Lf(),b,e);if(k&&(b||!t||k.distance<t.distance)&&(t=k,t.subMeshId=j,b))break}if(t){const b=k??this.getWorldMatrix(),e=j.e.gb[0],z=j.e.gb[1];j.k.TransformCoordinatesToRef(K.origin,b,e),K.direction.scaleToRef(t.distance,z);const T=j.k.TransformNormal(z,b).addInPlace(e);return F.hit=!0,F.distance=j.k.Distance(e,T),F.pickedPoint=T,F.pickedMesh=this,F.bu=t.bu||0,F.bv=t.bv||0,F.subMeshFaceId=t.faceId,F.faceId=t.faceId+U.data[t.subMeshId].indexStart/(-1!==this.getClassName().indexOf("LinesMesh")?2:3),F.subMeshId=t.subMeshId,F}return F}clone(K,b,e){return null}releaseSubMeshes(){if(this.Rf)for(;this.Rf.length;)this.Rf[0].dispose();else this.Rf=[];return this}dispose(K){let b,e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const z=this.va();for(this._scene.useMaterialMeshMap&&this._internalAbstractMeshDataInfo._material&&this._internalAbstractMeshDataInfo._material.meshMap&&(this._internalAbstractMeshDataInfo._material.meshMap[this.uniqueId]=void 0),z.freeActiveMeshes(),z.freeRenderingGroups(),z.renderingManager.maintainStateBetweenFrames&&z.renderingManager.restoreDispachedFlags(),void 0!==this.actionManager&&null!==this.actionManager&&(this.actionManager.disposeWhenUnowned&&!this._scene.meshes.some((K=>K!==this&&K.actionManager===this.actionManager))&&this.actionManager.dispose(),this.actionManager=null),this._internalAbstractMeshDataInfo._skeleton=null,this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null),b=0;b<this._intersectionsInProgress.length;b++){const K=this._intersectionsInProgress[b],e=K._intersectionsInProgress.indexOf(this);K._intersectionsInProgress.splice(e,1)}this._intersectionsInProgress.length=0;z.lights.forEach((K=>{let b=K.includedOnlyMeshes.indexOf(this);-1!==b&&K.includedOnlyMeshes.splice(b,1),b=K.excludedMeshes.indexOf(this),-1!==b&&K.excludedMeshes.splice(b,1);const e=K.getShadowGenerators();if(e){const K=e.values();for(let e=K.next();!0!==e.done;e=K.next()){const K=e.value.getShadowMap();K&&K.renderList&&(b=K.renderList.indexOf(this),-1!==b&&K.renderList.splice(b,1))}}})),"InstancedMesh"===this.getClassName()&&"InstancedLinesMesh"===this.getClassName()||this.releaseSubMeshes();const k=z.getEngine();if(null!==this._occlusionQuery&&(this.isOcclusionQueryInProgress=!1,k.deleteQuery(this._occlusionQuery),this._occlusionQuery=null),k.wipeCaches(),z.sd(this),this._parentContainer){const K=this._parentContainer.meshes.indexOf(this);K>-1&&this._parentContainer.meshes.splice(K,1),this._parentContainer=null}if(e&&this.material&&("MultiMaterial"===this.material.getClassName()?this.material.dispose(!1,!0,!0):this.material.dispose(!1,!0)),!K)for(b=0;b<z._i.length;b++)z._i[b].j===this&&(z._i[b].dispose(),b--);this._internalAbstractMeshDataInfo._facetData.facetDataEnabled&&this.disableFacetData(),this._uniformBuffer.dispose(),this.onAfterWorldMatrixUpdateObservable.clear(),this.onCollideObservable.clear(),this.onCollisionPositionChangeObservable.clear(),this.onRebuildObservable.clear(),super.dispose(K,e)}_initFacetData(){const K=this._internalAbstractMeshDataInfo._facetData;K.facetNormals||(K.facetNormals=[]),K.facetPositions||(K.facetPositions=[]),K.facetPartitioning||(K.facetPartitioning=new Array),K.facetNb=this.Lf().length/3|0,K.partitioningSubdivisions=K.partitioningSubdivisions?K.partitioningSubdivisions:10,K.partitioningBBoxRatio=K.partitioningBBoxRatio?K.partitioningBBoxRatio:1.01;for(let b=0;b<K.facetNb;b++)K.facetNormals[b]=j.k.Zero(),K.facetPositions[b]=j.k.Zero();return K.facetDataEnabled=!0,this}updateFacetData(){const K=this._internalAbstractMeshDataInfo._facetData;K.facetDataEnabled||this._initFacetData();const b=this.getVerticesData(T.f.PositionKind),e=this.Lf(),z=this.getVerticesData(T.f.NormalKind),k=this.getBoundingInfo();if(K.facetDepthSort&&!K.facetDepthSortEnabled){if(K.facetDepthSortEnabled=!0,e instanceof Uint16Array)K.depthSortedIndices=new Uint16Array(e);else if(e instanceof Uint32Array)K.depthSortedIndices=new Uint32Array(e);else{let b=!1;for(let K=0;K<e.length;K++)if(e[K]>65535){b=!0;break}K.depthSortedIndices=b?new Uint32Array(e):new Uint16Array(e)}if(K.facetDepthSortFunction=function(K,b){return b.sqDistance-K.sqDistance},!K.facetDepthSortFrom){const b=this.va().activeCamera;K.facetDepthSortFrom=b?b.position:j.k.Zero()}K.depthSortedFacets=[];for(let b=0;b<K.facetNb;b++){const e={ind:3*b,sqDistance:0};K.depthSortedFacets.push(e)}K.invertedMatrix=j.b.Identity(),K.facetDepthSortOrigin=j.k.Zero()}K.bbSize.x=k.maximum.x-k.minimum.x>m.c?k.maximum.x-k.minimum.x:m.c,K.bbSize.y=k.maximum.y-k.minimum.y>m.c?k.maximum.y-k.minimum.y:m.c,K.bbSize.z=k.maximum.z-k.minimum.z>m.c?k.maximum.z-k.minimum.z:m.c;let l=K.bbSize.x>K.bbSize.y?K.bbSize.x:K.bbSize.y;if(l=l>K.bbSize.z?l:K.bbSize.z,K.subDiv.max=K.partitioningSubdivisions,K.subDiv.X=Math.floor(K.subDiv.max*K.bbSize.x/l),K.subDiv.Y=Math.floor(K.subDiv.max*K.bbSize.y/l),K.subDiv.Z=Math.floor(K.subDiv.max*K.bbSize.z/l),K.subDiv.X=K.subDiv.X<1?1:K.subDiv.X,K.subDiv.Y=K.subDiv.Y<1?1:K.subDiv.Y,K.subDiv.Z=K.subDiv.Z<1?1:K.subDiv.Z,K.facetParameters.facetNormals=this.getFacetLocalNormals(),K.facetParameters.facetPositions=this.getFacetLocalPositions(),K.facetParameters.facetPartitioning=this.getFacetLocalPartitioning(),K.facetParameters.bInfo=k,K.facetParameters.bbSize=K.bbSize,K.facetParameters.subDiv=K.subDiv,K.facetParameters.ratio=this.partitioningBBoxRatio,K.facetParameters.depthSort=K.facetDepthSort,K.facetDepthSort&&K.facetDepthSortEnabled&&(this.xj(!0),this._worldMatrix.invertToRef(K.invertedMatrix),j.k.TransformCoordinatesToRef(K.facetDepthSortFrom,K.invertedMatrix,K.facetDepthSortOrigin),K.facetParameters.distanceTo=K.facetDepthSortOrigin),K.facetParameters.depthSortedFacets=K.depthSortedFacets,z&&F.e.ComputeNormals(b,e,z,K.facetParameters),K.facetDepthSort&&K.facetDepthSortEnabled){K.depthSortedFacets.sort(K.facetDepthSortFunction);const b=K.depthSortedIndices.length/3|0;for(let z=0;z<b;z++){const b=K.depthSortedFacets[z].ind;K.depthSortedIndices[3*z]=e[b],K.depthSortedIndices[3*z+1]=e[b+1],K.depthSortedIndices[3*z+2]=e[b+2]}this.updateIndices(K.depthSortedIndices,void 0,!0)}return this}getFacetLocalNormals(){const K=this._internalAbstractMeshDataInfo._facetData;return K.facetNormals||this.updateFacetData(),K.facetNormals}getFacetLocalPositions(){const K=this._internalAbstractMeshDataInfo._facetData;return K.facetPositions||this.updateFacetData(),K.facetPositions}getFacetLocalPartitioning(){const K=this._internalAbstractMeshDataInfo._facetData;return K.facetPartitioning||this.updateFacetData(),K.facetPartitioning}getFacetPosition(K){const b=j.k.Zero();return this.getFacetPositionToRef(K,b),b}getFacetPositionToRef(K,b){const e=this.getFacetLocalPositions()[K],z=this.getWorldMatrix();return j.k.TransformCoordinatesToRef(e,z,b),this}getFacetNormal(K){const b=j.k.Zero();return this.getFacetNormalToRef(K,b),b}getFacetNormalToRef(K,b){const e=this.getFacetLocalNormals()[K];return j.k.TransformNormalToRef(e,this.getWorldMatrix(),b),this}getFacetsAtLocalCoordinates(K,b,e){const z=this.getBoundingInfo(),k=this._internalAbstractMeshDataInfo._facetData,j=Math.floor((K-z.minimum.x*k.partitioningBBoxRatio)*k.subDiv.X*k.partitioningBBoxRatio/k.bbSize.x),T=Math.floor((b-z.minimum.y*k.partitioningBBoxRatio)*k.subDiv.Y*k.partitioningBBoxRatio/k.bbSize.y),F=Math.floor((e-z.minimum.z*k.partitioningBBoxRatio)*k.subDiv.Z*k.partitioningBBoxRatio/k.bbSize.z);return j<0||j>k.subDiv.max||T<0||T>k.subDiv.max||F<0||F>k.subDiv.max?null:k.facetPartitioning[j+k.subDiv.max*T+k.subDiv.max*k.subDiv.max*F]}getClosestFacetAtCoordinates(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],T=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];const F=this.getWorldMatrix(),l=j.e.Matrix[5];F.invertToRef(l);const Y=j.e.gb[8];j.k.TransformCoordinatesFromFloatsToRef(K,b,e,l,Y);const A=this.getClosestFacetAtLocalCoordinates(Y.x,Y.y,Y.z,z,k,T);return z&&j.k.TransformCoordinatesFromFloatsToRef(z.x,z.y,z.z,F,z),A}getClosestFacetAtLocalCoordinates(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4],j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=null,F=0,l=0,Y=0,A=0,X=0,t=0,U=0,B=0;const u=this.getFacetLocalPositions(),m=this.getFacetLocalNormals(),D=this.getFacetsAtLocalCoordinates(K,b,e);if(!D)return null;let I,x,Q,G=Number.MAX_VALUE,i=G;for(let S=0;S<D.length;S++)I=D[S],x=m[I],Q=u[I],A=(K-Q.x)*x.x+(b-Q.y)*x.y+(e-Q.z)*x.z,(!k||k&&j&&A>=0||k&&!j&&A<=0)&&(A=x.x*Q.x+x.y*Q.y+x.z*Q.z,X=-(x.x*K+x.y*b+x.z*e-A)/(x.x*x.x+x.y*x.y+x.z*x.z),t=K+x.x*X,U=b+x.y*X,B=e+x.z*X,F=t-K,l=U-b,Y=B-e,i=F*F+l*l+Y*Y,i<G&&(G=i,T=I,z&&(z.x=t,z.y=U,z.z=B)));return T}getFacetDataParameters(){return this._internalAbstractMeshDataInfo._facetData.facetParameters}disableFacetData(){const K=this._internalAbstractMeshDataInfo._facetData;return K.facetDataEnabled&&(K.facetDataEnabled=!1,K.facetPositions=[],K.facetNormals=[],K.facetPartitioning=new Array,K.facetParameters=null,K.depthSortedIndices=new Uint32Array(0)),this}updateIndices(K,b){return this}createNormals(K){const b=this.getVerticesData(T.f.PositionKind),e=this.Lf();let z;return z=this.isVerticesDataPresent(T.f.NormalKind)?this.getVerticesData(T.f.NormalKind):[],F.e.ComputeNormals(b,e,z,{useRightHandedSystem:this.va().useRightHandedSystem}),this.Ga(T.f.NormalKind,z,K),this}alignWithNormal(K,b){b||(b=D.e.Y);const e=j.e.gb[0],z=j.e.gb[1];return j.k.CrossToRef(b,K,z),j.k.CrossToRef(K,z,e),this.rotationQuaternion?j.d.RotationQuaternionFromAxisToRef(e,K,z,this.rotationQuaternion):j.k.RotationFromAxisToRef(e,K,z,this.rotation),this}_checkOcclusionQuery(){return!1}disableEdgesRendering(){throw(0,U.c)("EdgesRenderer")}enableEdgesRendering(K,b,e){throw(0,U.c)("EdgesRenderer")}aj(){return this._scene._i.filter((K=>K.j===this))}}S.OCCLUSION_TYPE_NONE=0,S.OCCLUSION_TYPE_OPTIMISTIC=1,S.OCCLUSION_TYPE_STRICT=2,S.OCCLUSION_ALGORITHM_TYPE_ACCURATE=0,S.OCCLUSION_ALGORITHM_TYPE_CONSERVATIVE=1,S.CULLINGSTRATEGY_STANDARD=0,S.mi=1,S.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,S.CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,(0,z.b)([x.e.filter((function(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];let[z,k,j,T,F]=b;return!Array.isArray(z)&&!Array.isArray(k)&&!Array.isArray(j)&&!Array.isArray(T)&&!Array.isArray(F)}))],S,"_ApplySkeleton",null),(0,I.e)("BABYLON.AbstractMesh",S)},11270:(K,b,e)=>{"use strict";e.d(b,{c:()=>m});var z=e(10967),k=e(10994),j=e(11261),T=e(11030),F=e(11089),l=e(11274),Y=e(11100),A=e(10686),X=e(10963),t=e(11117),U=e(10720),B=e(11186),u=e(10696);class m{get boundingBias(){return this._boundingBias}set boundingBias(K){this._boundingBias?this._boundingBias.p(K):this._boundingBias=K.clone(),this.Ea(!0,null)}static CreateGeometryForMesh(K){const b=new m(m.RandomId(),K.va());return b.Ca(K),b}get meshes(){return this._meshes}constructor(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.delayLoadState=0,this._totalVertices=0,this._isDisposed=!1,this._indexBufferIsUpdatable=!1,this._positionsCache=[],this._parentContainer=null,this.useBoundingInfoFromGeometry=!1,this._scene=b||U.b.LastCreatedScene,this._scene&&(this.id=K,this.uniqueId=this._scene.getUniqueId(),this._engine=this._scene.getEngine(),this._meshes=[],this._vertexBuffers={},this._indices=[],this._updatable=z,e?this.setAllVerticesData(e,z):this._totalVertices=0,this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObjects={}),k&&(this.Ca(k),k.xj(!0)))}get extend(){return this._extend}va(){return this._scene}getEngine(){return this._engine}isReady(){return 1===this.delayLoadState||0===this.delayLoadState}get doNotSerialize(){for(let K=0;K<this._meshes.length;K++)if(!this._meshes[K].doNotSerialize)return!1;return!0}_rebuild(){this._vertexArrayObjects&&(this._vertexArrayObjects={}),0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer"));const K=new Set;for(const b in this._vertexBuffers)K.add(this._vertexBuffers[b].getWrapperBuffer());K.forEach((K=>{K._rebuild()}))}setAllVerticesData(K,b){K.applyToGeometry(this,b),this._notifyUpdate()}Ga(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;e&&Array.isArray(b)&&(b=new Float32Array(b));const k=new T.f(this._engine,b,K,{updatable:e,postponeInternalCreation:0===this._meshes.length,stride:z,label:"Geometry_"+this.id+"_"+K});this.setVerticesBuffer(k)}removeVerticesData(K){this._vertexBuffers[K]&&(this._vertexBuffers[K].dispose(),delete this._vertexBuffers[K]),this._vertexArrayObjects&&this._disposeVertexArrayObjects()}setVerticesBuffer(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const k=K.getKind();this._vertexBuffers[k]&&e&&this._vertexBuffers[k].dispose(),K._buffer&&K._buffer._increaseReferences(),this._vertexBuffers[k]=K;const j=this._meshes,F=j.length;if(k===T.f.PositionKind){this._totalVertices=b??K._maxVerticesCount,this._updateExtend(K.getFloatData(this._totalVertices)),this._resetPointsArrayCache();const e=this._extend&&this._extend.minimum||new z.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),k=this._extend&&this._extend.maximum||new z.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let K=0;K<F;K++){const b=j[K];b.buildBoundingInfo(e,k),b._createGlobalSubMesh(b.isUnIndexed),b.xj(!0),b.synchronizeInstances()}}this._notifyUpdate(k)}updateVerticesDataDirectly(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=this.getVertexBuffer(K);k&&(k.updateDirectly(b,e,z),this._notifyUpdate(K))}updateVerticesData(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=this.getVertexBuffer(K);z&&(z.update(b),K===T.f.PositionKind&&this.Ea(e,b),this._notifyUpdate(K))}Ea(K,b){if(K&&this._updateExtend(b),this._resetPointsArrayCache(),K){const K=this._meshes;for(const b of K){b.hasBoundingInfo?b.getBoundingInfo().reConstruct(this._extend.minimum,this._extend.maximum):b.buildBoundingInfo(this._extend.minimum,this._extend.maximum);const K=b.Rf;for(const b of K)b.refreshBoundingInfo()}}}_bind(K,b,e,z){if(!K)return;void 0===b&&(b=this._indexBuffer);const k=this.getVertexBuffers();if(!k)return;if(b!=this._indexBuffer||!this._vertexArrayObjects&&!z)return void this._engine.bindBuffers(k,b,K,e);const j=z||this._vertexArrayObjects,T=this._engine;j[K.key]||(j[K.key]=T.recordVertexArrayObject(k,b,K,e)),T.bindVertexArrayObject(j[K.key],b)}getTotalVertices(){return this.isReady()?this._totalVertices:0}getVerticesData(K,b,e){const z=this.getVertexBuffer(K);return z?z.getFloatData(this._totalVertices,e||b&&1!==this._meshes.length):null}copyVerticesData(K,b){const e=this.getVertexBuffer(K);if(!e)return;b[K]||(b[K]=new Float32Array(this._totalVertices*e.getSize()));const z=e.getData();z&&function(K,b,e,z,k,j,F,l){const Y=b*T.f.GetTypeByteLength(e),A=F*b;if(l.length!==A)throw new Error("Output length is not valid");if(e===T.f.FLOAT&&k===Y)if(K instanceof Array){const b=z/4;l.set(K,b)}else if(K instanceof ArrayBuffer){const b=new Float32Array(K,z,A);l.set(b)}else{const b=K.byteOffset+z;if(b%4)return u.b.Warn("CopyFloatData: copied misaligned data."),void l.set(new Float32Array(K.buffer.slice(b,b+4*A)));const e=new Float32Array(K.buffer,b,A);l.set(e)}else T.f.ForEach(K,z,k,b,e,A,j,((K,b)=>l[b]=K))}(z,e.getSize(),e.type,e.byteOffset,e.byteStride,e.normalized,this._totalVertices,b[K])}isVertexBufferUpdatable(K){const b=this._vertexBuffers[K];return!!b&&b.isUpdatable()}getVertexBuffer(K){return this.isReady()?this._vertexBuffers[K]:null}getVertexBuffers(){return this.isReady()?this._vertexBuffers:null}isVerticesDataPresent(K){return this._vertexBuffers?void 0!==this._vertexBuffers[K]:!!this._delayInfo&&-1!==this._delayInfo.indexOf(K)}getVerticesDataKinds(){const K=[];let b;if(!this._vertexBuffers&&this._delayInfo)for(b in this._delayInfo)K.push(b);else for(b in this._vertexBuffers)K.push(b);return K}updateIndices(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._indexBuffer)if(this._indexBufferIsUpdatable){const z=K.length!==this._indices.length;if(e||(this._indices=K.slice()),this._engine.updateDynamicIndexBuffer(this._indexBuffer,K,b),z)for(const K of this._meshes)K._createGlobalSubMesh(!0)}else this.setIndices(K,null,!0)}setIndexBuffer(K,b,e){this._indices=[],this._indexBufferIsUpdatable=!1,this._indexBuffer=K,this._totalVertices=b,this._totalIndices=e,K.is32Bits||(K.is32Bits=this._totalIndices>65535);for(const z of this._meshes)z._createGlobalSubMesh(!0),z.synchronizeInstances();this._notifyUpdate()}setIndices(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indices=K,this._indexBufferIsUpdatable=e,0!==this._meshes.length&&this._indices&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,e,"Geometry_"+this.id+"_IndexBuffer")),void 0!=b&&(this._totalVertices=b);for(const k of this._meshes)k._createGlobalSubMesh(!z),k.synchronizeInstances();this._notifyUpdate()}getTotalIndices(){return this.isReady()?void 0!==this._totalIndices?this._totalIndices:this._indices.length:0}Lf(K,b){if(!this.isReady())return null;const e=this._indices;return b||K&&1!==this._meshes.length?e.slice():e}getIndexBuffer(){return this.isReady()?this._indexBuffer:null}_releaseVertexArrayObject(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;K&&this._vertexArrayObjects&&this._vertexArrayObjects[K.key]&&(this._engine.releaseVertexArrayObject(this._vertexArrayObjects[K.key]),delete this._vertexArrayObjects[K.key])}releaseForMesh(K,b){const e=this._meshes,z=e.indexOf(K);-1!==z&&(e.splice(z,1),this._vertexArrayObjects&&K._invalidateInstanceVertexArrayObject(),K._geometry=null,0===e.length&&b&&this.dispose())}Ca(K){if(K._geometry===this)return;const b=K._geometry;b&&b.releaseForMesh(K),this._vertexArrayObjects&&K._invalidateInstanceVertexArrayObject();const e=this._meshes;K._geometry=this,K._internalAbstractMeshDataInfo._positions=null,this._scene.pushGeometry(this),e.push(K),this.isReady()?this._applyToMesh(K):this._boundingInfo&&K.setBoundingInfo(this._boundingInfo)}_updateExtend(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this.useBoundingInfoFromGeometry&&this._boundingInfo)this._extend={minimum:this._boundingInfo.minimum.clone(),maximum:this._boundingInfo.maximum.clone()};else{if(!K&&(K=this.getVerticesData(T.f.PositionKind),!K))return;this._extend=(0,t.h)(K,0,this._totalVertices,this.boundingBias,3)}}_applyToMesh(K){const b=this._meshes.length;for(const e in this._vertexBuffers)1===b&&this._vertexBuffers[e].create(),e===T.f.PositionKind&&(this._extend||this._updateExtend(),K.buildBoundingInfo(this._extend.minimum,this._extend.maximum),K._createGlobalSubMesh(K.isUnIndexed),K.Ea());1===b&&this._indices&&this._indices.length>0&&(this._indexBuffer=this._engine.createIndexBuffer(this._indices,this._updatable,"Geometry_"+this.id+"_IndexBuffer")),K._syncGeometryWithMorphTargetManager(),K.synchronizeInstances()}_notifyUpdate(K){this.onGeometryUpdated&&this.onGeometryUpdated(this,K),this._vertexArrayObjects&&this._disposeVertexArrayObjects();for(const b of this._meshes)b._markSubMeshesAsAttributesDirty()}load(K,b){2!==this.delayLoadState&&(this.isReady()?b&&b():(this.delayLoadState=2,this._queueLoad(K,b)))}_queueLoad(K,b){this.delayLoadingFile&&(K.addPendingData(this),K._loadFile(this.delayLoadingFile,(e=>{if(!this._delayLoadingFunction)return;this._delayLoadingFunction(JSON.parse(e),this),this.delayLoadState=1,this._delayInfo=[],K.removePendingData(this);const z=this._meshes,k=z.length;for(let K=0;K<k;K++)this._applyToMesh(z[K]);b&&b()}),void 0,!0))}toLeftHanded(){const K=this.Lf(!1);if(null!=K&&K.length>0){for(let b=0;b<K.length;b+=3){const e=K[b+0];K[b+0]=K[b+2],K[b+2]=e}this.setIndices(K)}const b=this.getVerticesData(T.f.PositionKind,!1);if(null!=b&&b.length>0){for(let K=0;K<b.length;K+=3)b[K+2]=-b[K+2];this.Ga(T.f.PositionKind,b,!1)}const e=this.getVerticesData(T.f.NormalKind,!1);if(null!=e&&e.length>0){for(let K=0;K<e.length;K+=3)e[K+2]=-e[K+2];this.Ga(T.f.NormalKind,e,!1)}}_resetPointsArrayCache(){this._positions=null}_generatePointsArray(){if(this._positions)return!0;const K=this.getVerticesData(T.f.PositionKind);if(!K||0===K.length)return!1;for(let b=3*this._positionsCache.length,e=this._positionsCache.length;b<K.length;b+=3,++e)this._positionsCache[e]=z.k.Bg(K,b);for(let b=0,e=0;b<K.length;b+=3,++e)this._positionsCache[e].set(K[0+b],K[1+b],K[2+b]);return this._positionsCache.length=K.length/3,this._positions=this._positionsCache,!0}u(){return this._isDisposed}_disposeVertexArrayObjects(){if(this._vertexArrayObjects){for(const e in this._vertexArrayObjects)this._engine.releaseVertexArrayObject(this._vertexArrayObjects[e]);this._vertexArrayObjects={};const K=this._meshes,b=K.length;for(let e=0;e<b;e++)K[e]._invalidateInstanceVertexArrayObject()}}dispose(){const K=this._meshes,b=K.length;let e;for(e=0;e<b;e++)this.releaseForMesh(K[e]);this._meshes.length=0,this._disposeVertexArrayObjects();for(const z in this._vertexBuffers)this._vertexBuffers[z].dispose();if(this._vertexBuffers={},this._totalVertices=0,this._indexBuffer&&this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null,this._indices=[],this.delayLoadState=0,this.delayLoadingFile=null,this._delayLoadingFunction=null,this._delayInfo=[],this._boundingInfo=null,this._scene.removeGeometry(this),this._parentContainer){const K=this._parentContainer.geometries.indexOf(this);K>-1&&this._parentContainer.geometries.splice(K,1),this._parentContainer=null}this._isDisposed=!0}i(K){const b=new j.e;b.indices=[];const e=this.Lf();if(e)for(let j=0;j<e.length;j++)b.indices.push(e[j]);let z,k=!1,T=!1;for(z in this._vertexBuffers){const K=this.getVerticesData(z);if(K&&(K instanceof Float32Array?b.set(new Float32Array(K),z):b.set(K.slice(0),z),!T)){const K=this.getVertexBuffer(z);K&&(k=K.isUpdatable(),T=!k)}}const F=new m(K,this._scene,b,k);for(z in F.delayLoadState=this.delayLoadState,F.delayLoadingFile=this.delayLoadingFile,F._delayLoadingFunction=this._delayLoadingFunction,this._delayInfo)F._delayInfo=F._delayInfo||[],F._delayInfo.push(z);return F._boundingInfo=new Y.b(this._extend.minimum,this._extend.maximum),F}serialize(){const K={};return K.id=this.id,K.uniqueId=this.uniqueId,K.updatable=this._updatable,X.d&&X.d.HasTags(this)&&(K.tags=X.d.GetTags(this)),K}_toNumberArray(K){return Array.isArray(K)?K:Array.prototype.slice.call(K)}clearCachedData(){this._indices=[],this._resetPointsArrayCache();for(const K in this._vertexBuffers)Object.prototype.hasOwnProperty.call(this._vertexBuffers,K)&&(this._vertexBuffers[K]._buffer._data=null)}serializeVerticeData(){const K=this.serialize();return this.isVerticesDataPresent(T.f.PositionKind)&&(K.xa=this._toNumberArray(this.getVerticesData(T.f.PositionKind)),this.isVertexBufferUpdatable(T.f.PositionKind)&&(K.xa._updatable=!0)),this.isVerticesDataPresent(T.f.NormalKind)&&(K.ya=this._toNumberArray(this.getVerticesData(T.f.NormalKind)),this.isVertexBufferUpdatable(T.f.NormalKind)&&(K.ya._updatable=!0)),this.isVerticesDataPresent(T.f.TangentKind)&&(K.tangents=this._toNumberArray(this.getVerticesData(T.f.TangentKind)),this.isVertexBufferUpdatable(T.f.TangentKind)&&(K.tangents._updatable=!0)),this.isVerticesDataPresent(T.f.UVKind)&&(K.Aa=this._toNumberArray(this.getVerticesData(T.f.UVKind)),this.isVertexBufferUpdatable(T.f.UVKind)&&(K.Aa._updatable=!0)),this.isVerticesDataPresent(T.f.UV2Kind)&&(K.uvs2=this._toNumberArray(this.getVerticesData(T.f.UV2Kind)),this.isVertexBufferUpdatable(T.f.UV2Kind)&&(K.uvs2._updatable=!0)),this.isVerticesDataPresent(T.f.UV3Kind)&&(K.uvs3=this._toNumberArray(this.getVerticesData(T.f.UV3Kind)),this.isVertexBufferUpdatable(T.f.UV3Kind)&&(K.uvs3._updatable=!0)),this.isVerticesDataPresent(T.f.UV4Kind)&&(K.uvs4=this._toNumberArray(this.getVerticesData(T.f.UV4Kind)),this.isVertexBufferUpdatable(T.f.UV4Kind)&&(K.uvs4._updatable=!0)),this.isVerticesDataPresent(T.f.UV5Kind)&&(K.uvs5=this._toNumberArray(this.getVerticesData(T.f.UV5Kind)),this.isVertexBufferUpdatable(T.f.UV5Kind)&&(K.uvs5._updatable=!0)),this.isVerticesDataPresent(T.f.UV6Kind)&&(K.uvs6=this._toNumberArray(this.getVerticesData(T.f.UV6Kind)),this.isVertexBufferUpdatable(T.f.UV6Kind)&&(K.uvs6._updatable=!0)),this.isVerticesDataPresent(T.f.ColorKind)&&(K.za=this._toNumberArray(this.getVerticesData(T.f.ColorKind)),this.isVertexBufferUpdatable(T.f.ColorKind)&&(K.za._updatable=!0)),this.isVerticesDataPresent(T.f.MatricesIndicesKind)&&(K.matricesIndices=this._toNumberArray(this.getVerticesData(T.f.MatricesIndicesKind)),K.matricesIndices._isExpanded=!0,this.isVertexBufferUpdatable(T.f.MatricesIndicesKind)&&(K.matricesIndices._updatable=!0)),this.isVerticesDataPresent(T.f.MatricesWeightsKind)&&(K.matricesWeights=this._toNumberArray(this.getVerticesData(T.f.MatricesWeightsKind)),this.isVertexBufferUpdatable(T.f.MatricesWeightsKind)&&(K.matricesWeights._updatable=!0)),K.indices=this._toNumberArray(this.Lf()),K}static ExtractFromMesh(K,b){const e=K._geometry;return e?e.i(b):null}static RandomId(){return A.f.RandomId()}static _GetGeometryByLoadedUniqueId(K,b){for(let e=0;e<b.geometries.length;e++)if(b.geometries[e]._loadedUniqueId===K)return b.geometries[e];return null}static _ImportGeometry(K,b){const e=b.va(),z=K.geometryUniqueId,j=K.geometryId;if(z||j){const K=z?this._GetGeometryByLoadedUniqueId(z,e):e.getGeometryById(j);K&&K.Ca(b)}else if(K instanceof ArrayBuffer){const e=b._binaryInfo;if(e.positionsAttrDesc&&e.positionsAttrDesc.count>0){const z=new Float32Array(K,e.positionsAttrDesc.offset,e.positionsAttrDesc.count);b.Ga(T.f.PositionKind,z,!1)}if(e.normalsAttrDesc&&e.normalsAttrDesc.count>0){const z=new Float32Array(K,e.normalsAttrDesc.offset,e.normalsAttrDesc.count);b.Ga(T.f.NormalKind,z,!1)}if(e.tangetsAttrDesc&&e.tangetsAttrDesc.count>0){const z=new Float32Array(K,e.tangetsAttrDesc.offset,e.tangetsAttrDesc.count);b.Ga(T.f.TangentKind,z,!1)}if(e.uvsAttrDesc&&e.uvsAttrDesc.count>0){const z=new Float32Array(K,e.uvsAttrDesc.offset,e.uvsAttrDesc.count);if(B.c)for(let K=1;K<z.length;K+=2)z[K]=1-z[K];b.Ga(T.f.UVKind,z,!1)}if(e.uvs2AttrDesc&&e.uvs2AttrDesc.count>0){const z=new Float32Array(K,e.uvs2AttrDesc.offset,e.uvs2AttrDesc.count);if(B.c)for(let K=1;K<z.length;K+=2)z[K]=1-z[K];b.Ga(T.f.UV2Kind,z,!1)}if(e.uvs3AttrDesc&&e.uvs3AttrDesc.count>0){const z=new Float32Array(K,e.uvs3AttrDesc.offset,e.uvs3AttrDesc.count);if(B.c)for(let K=1;K<z.length;K+=2)z[K]=1-z[K];b.Ga(T.f.UV3Kind,z,!1)}if(e.uvs4AttrDesc&&e.uvs4AttrDesc.count>0){const z=new Float32Array(K,e.uvs4AttrDesc.offset,e.uvs4AttrDesc.count);if(B.c)for(let K=1;K<z.length;K+=2)z[K]=1-z[K];b.Ga(T.f.UV4Kind,z,!1)}if(e.uvs5AttrDesc&&e.uvs5AttrDesc.count>0){const z=new Float32Array(K,e.uvs5AttrDesc.offset,e.uvs5AttrDesc.count);if(B.c)for(let K=1;K<z.length;K+=2)z[K]=1-z[K];b.Ga(T.f.UV5Kind,z,!1)}if(e.uvs6AttrDesc&&e.uvs6AttrDesc.count>0){const z=new Float32Array(K,e.uvs6AttrDesc.offset,e.uvs6AttrDesc.count);if(B.c)for(let K=1;K<z.length;K+=2)z[K]=1-z[K];b.Ga(T.f.UV6Kind,z,!1)}if(e.colorsAttrDesc&&e.colorsAttrDesc.count>0){const z=new Float32Array(K,e.colorsAttrDesc.offset,e.colorsAttrDesc.count);b.Ga(T.f.ColorKind,z,!1,e.colorsAttrDesc.stride)}if(e.matricesIndicesAttrDesc&&e.matricesIndicesAttrDesc.count>0){const z=new Int32Array(K,e.matricesIndicesAttrDesc.offset,e.matricesIndicesAttrDesc.count),k=[];for(let K=0;K<z.length;K++){const b=z[K];k.push(255&b),k.push((65280&b)>>8),k.push((16711680&b)>>16),k.push(b>>24&255)}b.Ga(T.f.MatricesIndicesKind,k,!1)}if(e.matricesIndicesExtraAttrDesc&&e.matricesIndicesExtraAttrDesc.count>0){const z=new Int32Array(K,e.matricesIndicesExtraAttrDesc.offset,e.matricesIndicesExtraAttrDesc.count),k=[];for(let K=0;K<z.length;K++){const b=z[K];k.push(255&b),k.push((65280&b)>>8),k.push((16711680&b)>>16),k.push(b>>24&255)}b.Ga(T.f.MatricesIndicesExtraKind,k,!1)}if(e.matricesWeightsAttrDesc&&e.matricesWeightsAttrDesc.count>0){const z=new Float32Array(K,e.matricesWeightsAttrDesc.offset,e.matricesWeightsAttrDesc.count);b.Ga(T.f.MatricesWeightsKind,z,!1)}if(e.indicesAttrDesc&&e.indicesAttrDesc.count>0){const z=new Int32Array(K,e.indicesAttrDesc.offset,e.indicesAttrDesc.count);b.setIndices(z,null)}if(e.subMeshesAttrDesc&&e.subMeshesAttrDesc.count>0){const z=new Int32Array(K,e.subMeshesAttrDesc.offset,5*e.subMeshesAttrDesc.count);b.Rf=[];for(let K=0;K<e.subMeshesAttrDesc.count;K++){const e=z[5*K+0],k=z[5*K+1],j=z[5*K+2],T=z[5*K+3],l=z[5*K+4];F.e.AddToMesh(e,k,j,T,l,b)}}}else if(K.xa&&K.ya&&K.indices){if(b.Ga(T.f.PositionKind,K.xa,K.xa._updatable),b.Ga(T.f.NormalKind,K.ya,K.ya._updatable),K.tangents&&b.Ga(T.f.TangentKind,K.tangents,K.tangents._updatable),K.Aa&&b.Ga(T.f.UVKind,K.Aa,K.Aa._updatable),K.uvs2&&b.Ga(T.f.UV2Kind,K.uvs2,K.uvs2._updatable),K.uvs3&&b.Ga(T.f.UV3Kind,K.uvs3,K.uvs3._updatable),K.uvs4&&b.Ga(T.f.UV4Kind,K.uvs4,K.uvs4._updatable),K.uvs5&&b.Ga(T.f.UV5Kind,K.uvs5,K.uvs5._updatable),K.uvs6&&b.Ga(T.f.UV6Kind,K.uvs6,K.uvs6._updatable),K.za&&b.Ga(T.f.ColorKind,k.g.CheckColors4(K.za,K.xa.length/3),K.za._updatable),K.matricesIndices)if(K.matricesIndices._isExpanded)delete K.matricesIndices._isExpanded,b.Ga(T.f.MatricesIndicesKind,K.matricesIndices,K.matricesIndices._updatable);else{const e=[];for(let b=0;b<K.matricesIndices.length;b++){const z=K.matricesIndices[b];e.push(255&z),e.push((65280&z)>>8),e.push((16711680&z)>>16),e.push(z>>24&255)}b.Ga(T.f.MatricesIndicesKind,e,K.matricesIndices._updatable)}if(K.matricesIndicesExtra)if(K.matricesIndicesExtra._isExpanded)delete K.matricesIndices._isExpanded,b.Ga(T.f.MatricesIndicesExtraKind,K.matricesIndicesExtra,K.matricesIndicesExtra._updatable);else{const e=[];for(let b=0;b<K.matricesIndicesExtra.length;b++){const z=K.matricesIndicesExtra[b];e.push(255&z),e.push((65280&z)>>8),e.push((16711680&z)>>16),e.push(z>>24&255)}b.Ga(T.f.MatricesIndicesExtraKind,e,K.matricesIndicesExtra._updatable)}K.matricesWeights&&(m._CleanMatricesWeights(K,b),b.Ga(T.f.MatricesWeightsKind,K.matricesWeights,K.matricesWeights._updatable)),K.matricesWeightsExtra&&b.Ga(T.f.MatricesWeightsExtraKind,K.matricesWeightsExtra,K.matricesWeights._updatable),b.setIndices(K.indices,null)}if(K.Rf){b.Rf=[];for(let e=0;e<K.Rf.length;e++){const z=K.Rf[e];F.e.AddToMesh(z.materialIndex,z.verticesStart,z.verticesCount,z.indexStart,z.indexCount,b)}}b._shouldGenerateFlatShading&&(b.convertToFlatShadedMesh(),b._shouldGenerateFlatShading=!1),b.xj(!0),e.onMeshImportedObservable.notifyObservers(b)}static _CleanMatricesWeights(K,b){const e=.001;if(!l.b.CleanBoneMatrixWeights)return;let z=0;if(!(K.skeletonId>-1))return;{const e=b.va().getLastSkeletonById(K.skeletonId);if(!e)return;z=e.bones.length}const k=b.getVerticesData(T.f.MatricesIndicesKind),j=b.getVerticesData(T.f.MatricesIndicesExtraKind),F=K.matricesWeights,Y=K.matricesWeightsExtra,A=K.numBoneInfluencer,X=F.length;for(let T=0;T<X;T+=4){let K=0,b=-1;for(let z=0;z<4;z++){const k=F[T+z];K+=k,k<e&&b<0&&(b=z)}if(Y)for(let z=0;z<4;z++){const k=Y[T+z];K+=k,k<e&&b<0&&(b=z+4)}if((b<0||b>A-1)&&(b=A-1),K>e){const b=1/K;for(let K=0;K<4;K++)F[T+K]*=b;if(Y)for(let K=0;K<4;K++)Y[T+K]*=b}else b>=4?(Y[T+b-4]=1-K,j[T+b-4]=z):(F[T+b]=1-K,k[T+b]=z)}b.Ga(T.f.MatricesIndicesKind,k),K.matricesWeightsExtra&&b.Ga(T.f.MatricesIndicesExtraKind,j)}static Parse(K,b,e){const k=new m(K.id,b,void 0,K.updatable);return k._loadedUniqueId=K.uniqueId,X.d&&X.d.AddTagsTo(k,K.tags),K.delayLoadingFile?(k.delayLoadState=4,k.delayLoadingFile=e+K.delayLoadingFile,k._boundingInfo=new Y.b(z.k.Bg(K.boundingBoxMinimum),z.k.Bg(K.boundingBoxMaximum)),k._delayInfo=[],K.hasUVs&&k._delayInfo.push(T.f.UVKind),K.hasUVs2&&k._delayInfo.push(T.f.UV2Kind),K.hasUVs3&&k._delayInfo.push(T.f.UV3Kind),K.hasUVs4&&k._delayInfo.push(T.f.UV4Kind),K.hasUVs5&&k._delayInfo.push(T.f.UV5Kind),K.hasUVs6&&k._delayInfo.push(T.f.UV6Kind),K.hasColors&&k._delayInfo.push(T.f.ColorKind),K.hasMatricesIndices&&k._delayInfo.push(T.f.MatricesIndicesKind),K.hasMatricesWeights&&k._delayInfo.push(T.f.MatricesWeightsKind),k._delayLoadingFunction=j.e.ImportVertexData):j.e.ImportVertexData(K,k),b.pushGeometry(k,!0),k}}},11933:(K,b,e)=>{"use strict";e.d(b,{c:()=>t});var z=e(10967),k=e(10696),j=e(11283),T=e(11226),F=e(10698),l=e(11286),Y=e(11030),A=e(10686),X=e(10799);T.b._instancedMeshFactory=(K,b)=>{const e=new t(K,b);if(b.instancedBuffers){e.instancedBuffers={};for(const K in b.instancedBuffers)e.instancedBuffers[K]=b.instancedBuffers[K]}return e};class t extends j.e{constructor(K,b){super(K,b.va()),this._indexInSourceMeshInstanceArray=-1,this._distanceToCamera=0,b.pj(this),this._sourceMesh=b,this._unIndexed=b._unIndexed,this.position.p(b.position),this.rotation.p(b.rotation),this.Zd.p(b.Zd),b.rotationQuaternion&&(this.rotationQuaternion=b.rotationQuaternion.clone()),this.animations=b.animations.slice();for(const e of b.getAnimationRanges())null!=e&&this.createAnimationRange(e.name,e.from,e.to);this.infiniteDistance=b.infiniteDistance,this.setPivotMatrix(b.getPivotMatrix()),this.refreshBoundingInfo(!0,!0),this._syncSubMeshes()}getClassName(){return"InstancedMesh"}get lightSources(){return this._sourceMesh._lightSources}_resyncLightSources(){}_resyncLightSource(){}_removeLightSource(){}get receiveShadows(){return this._sourceMesh.receiveShadows}set receiveShadows(K){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.receiveShadows)!==K&&A.f.Warn("Setting receiveShadows on an instanced mesh has no effect")}get material(){return this._sourceMesh.material}set material(K){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.material)!==K&&A.f.Warn("Setting material on an instanced mesh has no effect")}get visibility(){return this._sourceMesh.visibility}set visibility(K){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.visibility)!==K&&A.f.Warn("Setting visibility on an instanced mesh has no effect")}get skeleton(){return this._sourceMesh.skeleton}set skeleton(K){var b;(null===(b=this._sourceMesh)||void 0===b?void 0:b.skeleton)!==K&&A.f.Warn("Setting skeleton on an instanced mesh has no effect")}get renderingGroupId(){return this._sourceMesh.renderingGroupId}set renderingGroupId(K){this._sourceMesh&&K!==this._sourceMesh.renderingGroupId&&k.b.Warn("Note - setting renderingGroupId of an instanced mesh has no effect on the scene")}getTotalVertices(){return this._sourceMesh?this._sourceMesh.getTotalVertices():0}getTotalIndices(){return this._sourceMesh.getTotalIndices()}get sourceMesh(){return this._sourceMesh}createInstance(K){return this._sourceMesh.createInstance(K)}isReady(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._sourceMesh.isReady(K,!0)}getVerticesData(K,b,e){return this._sourceMesh.getVerticesData(K,b,e)}copyVerticesData(K,b){this._sourceMesh.copyVerticesData(K,b)}Ga(K,b,e,z){return this.sourceMesh&&this.sourceMesh.Ga(K,b,e,z),this.sourceMesh}updateVerticesData(K,b,e,z){return this.sourceMesh&&this.sourceMesh.updateVerticesData(K,b,e,z),this.sourceMesh}setIndices(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.sourceMesh&&this.sourceMesh.setIndices(K,b),this.sourceMesh}isVerticesDataPresent(K){return this._sourceMesh.isVerticesDataPresent(K)}Lf(){return this._sourceMesh.Lf()}get _positions(){return this._sourceMesh._positions}refreshBoundingInfo(){let K,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;K="object"===typeof b?b:{applySkeleton:b,applyMorph:e};const z=this._sourceMesh.mj?this._sourceMesh.mj.boundingBias:null;return this.Fa(this._sourceMesh._getData(K,null,Y.f.PositionKind),z),this}_preActivate(){return this._currentLOD&&this._currentLOD._preActivate(),this}_activate(K,b){if(super._activate(K,b),this._sourceMesh.Rf||k.b.Warn("Instances should only be created for meshes with geometry."),this._currentLOD){if(this._currentLOD._getWorldMatrixDeterminant()>=0!==this._getWorldMatrixDeterminant()>=0)return this._internalAbstractMeshDataInfo._actAsRegularMesh=!0,!0;if(this._internalAbstractMeshDataInfo._actAsRegularMesh=!1,this._currentLOD._registerInstanceForRenderId(this,K),b){if(!this._currentLOD._internalAbstractMeshDataInfo._isActiveIntermediate)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!0,!0}else if(!this._currentLOD._internalAbstractMeshDataInfo._isActive)return this._currentLOD._internalAbstractMeshDataInfo._onlyForInstances=!0,!0}return!1}_postActivate(){this._sourceMesh.edgesShareWithInstances&&this._sourceMesh._edgesRenderer&&this._sourceMesh._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup?(this._sourceMesh._renderingGroup._edgesRenderers.pushNoDuplicate(this._sourceMesh._edgesRenderer),this._sourceMesh._edgesRenderer.customInstances.push(this.getWorldMatrix())):this._edgesRenderer&&this._edgesRenderer.isEnabled&&this._sourceMesh._renderingGroup&&this._sourceMesh._renderingGroup._edgesRenderers.push(this._edgesRenderer)}getWorldMatrix(){if(this._currentLOD&&this._currentLOD.billboardMode!==l.c.BILLBOARDMODE_NONE&&this._currentLOD._masterMesh!==this){this._billboardWorldMatrix||(this._billboardWorldMatrix=new z.b);const K=this._currentLOD._masterMesh;return this._currentLOD._masterMesh=this,z.e.gb[7].p(this._currentLOD.position),this._currentLOD.position.set(0,0,0),this._billboardWorldMatrix.p(this._currentLOD.xj(!0)),this._currentLOD.position.p(z.e.gb[7]),this._currentLOD._masterMesh=K,this._billboardWorldMatrix}return super.getWorldMatrix()}get isAnInstance(){return!0}getLOD(K){if(!K)return this;const b=this.sourceMesh.getLODLevels();if(b&&0!==b.length){const b=this.getBoundingInfo();this._currentLOD=this.sourceMesh.getLOD(K,b.boundingSphere)}else this._currentLOD=this.sourceMesh;return this._currentLOD}_preActivateForIntermediateRendering(K){return this.sourceMesh._preActivateForIntermediateRendering(K)}_syncSubMeshes(){if(this.releaseSubMeshes(),this._sourceMesh.Rf)for(let K=0;K<this._sourceMesh.Rf.length;K++)this._sourceMesh.Rf[K].clone(this,this._sourceMesh);return this}_generatePointsArray(){return this._sourceMesh._generatePointsArray()}Ea(){return this.hasBoundingInfo?this.getBoundingInfo().update(this.worldMatrixFromCache):this.buildBoundingInfo(this.absolutePosition,this.absolutePosition,this.worldMatrixFromCache),this._updateSubMeshesBoundingInfo(this.worldMatrixFromCache),this}clone(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0;const z=((arguments.length>3?arguments[3]:void 0)||this._sourceMesh).createInstance(K);if(F.c.DeepCopy(this,z,["name","Rf","uniqueId","parent","lightSources","receiveShadows","material","visibility","skeleton","sourceMesh","isAnInstance","facetNb","isFacetDataEnabled","isBlocked","useBones","hasInstances","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","$i","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","hasBoundingInfo"],[]),this.refreshBoundingInfo(),b&&(z.parent=b),!e)for(let k=0;k<this.va().meshes.length;k++){const K=this.va().meshes[k];K.parent===this&&K.clone(K.name,z)}return z.xj(!0),this.onClonedObservable.notifyObservers(z),z}dispose(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._sourceMesh.oj(this),super.dispose(K,b)}_serializeAsParent(K){super._serializeAsParent(K),K.parentId=this._sourceMesh.uniqueId,K.parentInstanceIndex=this._indexInSourceMeshInstanceArray}instantiateHierarchy(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const z=this.clone("Clone of "+(this.name||this.id),K||this.parent,!0,b&&b.newSourcedMesh);z&&e&&e(this,z);for(const k of this.getChildTransformNodes(!0))k.instantiateHierarchy(z,b,e);return z}}T.b.prototype.registerInstancedBuffer=function(K,b){var e,z;if(null===(e=this._userInstancedBuffersStorage)||void 0===e||null===(z=e.vertexBuffers[K])||void 0===z||z.dispose(),!this.instancedBuffers){this.instancedBuffers={};for(const K of this.instances)K.instancedBuffers={}}this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this.instancedBuffers[K]=null,this._userInstancedBuffersStorage.strides[K]=b,this._userInstancedBuffersStorage.sizes[K]=32*b,this._userInstancedBuffersStorage.data[K]=new Float32Array(this._userInstancedBuffersStorage.sizes[K]),this._userInstancedBuffersStorage.vertexBuffers[K]=new Y.f(this.getEngine(),this._userInstancedBuffersStorage.data[K],K,!0,!1,b,!0);for(const k of this.instances)k.instancedBuffers[K]=null;this._invalidateInstanceVertexArrayObject(),this._markSubMeshesAsAttributesDirty()},T.b.prototype._processInstancedBuffers=function(K,b){const e=K?K.length:0;for(const z in this.instancedBuffers){let k=this._userInstancedBuffersStorage.sizes[z];const j=this._userInstancedBuffersStorage.strides[z],T=(e+1)*j;for(;k<T;)k*=2;this._userInstancedBuffersStorage.data[z].length!=k&&(this._userInstancedBuffersStorage.data[z]=new Float32Array(k),this._userInstancedBuffersStorage.sizes[z]=k,this._userInstancedBuffersStorage.vertexBuffers[z]&&(this._userInstancedBuffersStorage.vertexBuffers[z].dispose(),this._userInstancedBuffersStorage.vertexBuffers[z]=null));const F=this._userInstancedBuffersStorage.data[z];let l=0;if(b){const K=this.instancedBuffers[z];K.toArray?K.toArray(F,l):K.copyToArray?K.copyToArray(F,l):F[l]=K,l+=j}for(let b=0;b<e;b++){const e=K[b].instancedBuffers[z];e.toArray?e.toArray(F,l):e.copyToArray?e.copyToArray(F,l):F[l]=e,l+=j}this._userInstancedBuffersStorage.vertexBuffers[z]?this._userInstancedBuffersStorage.vertexBuffers[z].updateDirectly(F,0):(this._userInstancedBuffersStorage.vertexBuffers[z]=new Y.f(this.getEngine(),this._userInstancedBuffersStorage.data[z],z,!0,!1,j,!0),this._invalidateInstanceVertexArrayObject())}},T.b.prototype._invalidateInstanceVertexArrayObject=function(){if(this._userInstancedBuffersStorage&&void 0!==this._userInstancedBuffersStorage.vertexArrayObjects){for(const K in this._userInstancedBuffersStorage.vertexArrayObjects)this.getEngine().releaseVertexArrayObject(this._userInstancedBuffersStorage.vertexArrayObjects[K]);this._userInstancedBuffersStorage.vertexArrayObjects={}}},T.b.prototype._disposeInstanceSpecificData=function(){for(this._instanceDataStorage.instancesBuffer&&(this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null);this.instances.length;)this.instances[0].dispose();for(const K in this.instancedBuffers)this._userInstancedBuffersStorage.vertexBuffers[K]&&this._userInstancedBuffersStorage.vertexBuffers[K].dispose();this._invalidateInstanceVertexArrayObject(),this.instancedBuffers={}},(0,X.e)("BABYLON.InstancedMesh",t)},11226:(K,b,e)=>{"use strict";e.d(b,{b:()=>R,e:()=>L});var z=e(10690),k=e(10686),j=e(10698),T=e(10963),F=e(11233),l=e(11237),Y=e(10967),A=e(10994),X=e(11243),t=e(11030),U=e(11261),B=e(11270),u=e(11283),m=e(11089),D=e(11085),I=e(11294),x=e(11274),Q=e(11001),G=e(10696),i=e(10799),S=e(10710),M=e(11049);class r{constructor(K,b){this.distanceOrScreenCoverage=K,this.mesh=b}}class L{}class c{constructor(){this.visibleInstances={},this.batchCache=new v,this.batchCacheReplacementModeInFrozenMode=new v,this.instancesBufferSize=2048}}class v{constructor(){this.mustReturn=!1,this.visibleInstances=new Array,this.renderSelf=[],this.hardwareInstancedRendering=[]}}class w{constructor(){this.instancesCount=0,this.matrixBuffer=null,this.previousMatrixBuffer=null,this.matrixBufferSize=512,this.matrixData=null,this.boundingVectors=[],this.worldMatrices=null}}class h{constructor(){this._areNormalsFrozen=!1,this._source=null,this.meshMap=null,this._preActivateId=-1,this._LODLevels=new Array,this._useLODScreenCoverage=!1,this._effectiveMaterial=null,this._forcedInstanceCount=0,this._overrideRenderingFillMode=null}}class R extends u.e{static _GetDefaultSideOrientation(K){return K||R.FRONTSIDE}get useLODScreenCoverage(){return this._internalMeshDataInfo._useLODScreenCoverage}set useLODScreenCoverage(K){this._internalMeshDataInfo._useLODScreenCoverage=K,this._sortLODLevels()}get computeBonesUsingShaders(){return this._internalAbstractMeshDataInfo._computeBonesUsingShaders}set computeBonesUsingShaders(K){this._internalAbstractMeshDataInfo._computeBonesUsingShaders!==K&&(K&&this._internalMeshDataInfo._sourcePositions&&(this.Ga(t.f.PositionKind,this._internalMeshDataInfo._sourcePositions,!0),this._internalMeshDataInfo._sourceNormals&&this.Ga(t.f.NormalKind,this._internalMeshDataInfo._sourceNormals,!0),this._internalMeshDataInfo._sourcePositions=null,this._internalMeshDataInfo._sourceNormals=null),this._internalAbstractMeshDataInfo._computeBonesUsingShaders=K,this._markSubMeshesAsAttributesDirty())}get onBeforeRenderObservable(){return this._internalMeshDataInfo._onBeforeRenderObservable||(this._internalMeshDataInfo._onBeforeRenderObservable=new z.d),this._internalMeshDataInfo._onBeforeRenderObservable}get onBeforeBindObservable(){return this._internalMeshDataInfo._onBeforeBindObservable||(this._internalMeshDataInfo._onBeforeBindObservable=new z.d),this._internalMeshDataInfo._onBeforeBindObservable}get onAfterRenderObservable(){return this._internalMeshDataInfo._onAfterRenderObservable||(this._internalMeshDataInfo._onAfterRenderObservable=new z.d),this._internalMeshDataInfo._onAfterRenderObservable}get onBetweenPassObservable(){return this._internalMeshDataInfo._onBetweenPassObservable||(this._internalMeshDataInfo._onBetweenPassObservable=new z.d),this._internalMeshDataInfo._onBetweenPassObservable}get onBeforeDrawObservable(){return this._internalMeshDataInfo._onBeforeDrawObservable||(this._internalMeshDataInfo._onBeforeDrawObservable=new z.d),this._internalMeshDataInfo._onBeforeDrawObservable}set onBeforeDraw(K){this._onBeforeDrawObserver&&this.onBeforeDrawObservable.remove(this._onBeforeDrawObserver),this._onBeforeDrawObserver=this.onBeforeDrawObservable.add(K)}get hasInstances(){return this.instances.length>0}get hasThinInstances(){return(this.forcedInstanceCount||this._thinInstanceDataStorage.instancesCount||0)>0}get forcedInstanceCount(){return this._internalMeshDataInfo._forcedInstanceCount}set forcedInstanceCount(K){this._internalMeshDataInfo._forcedInstanceCount=K}get sideOrientation(){return this._internalMeshDataInfo._sideOrientation}set sideOrientation(K){this._internalMeshDataInfo._sideOrientation=K,this._internalAbstractMeshDataInfo._sideOrientationHint=this._scene.useRightHandedSystem&&1===K||!this._scene.useRightHandedSystem&&0===K}get overrideMaterialSideOrientation(){return this.sideOrientation}set overrideMaterialSideOrientation(K){this.sideOrientation=K,this.material&&(this.material.sideOrientation=null)}get overrideRenderingFillMode(){return this._internalMeshDataInfo._overrideRenderingFillMode}set overrideRenderingFillMode(K){this._internalMeshDataInfo._overrideRenderingFillMode=K}get material(){return this._internalAbstractMeshDataInfo._material}set material(K){K&&(this.material&&null===this.material.sideOrientation||this._internalAbstractMeshDataInfo._sideOrientationHint)&&(K.sideOrientation=null),this._setMaterial(K)}get source(){return this._internalMeshDataInfo._source}get cloneMeshMap(){return this._internalMeshDataInfo.meshMap}get isUnIndexed(){return this._unIndexed}set isUnIndexed(K){this._unIndexed!==K&&(this._unIndexed=K,this._markSubMeshesAsAttributesDirty())}get worldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesData}get previousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.instancesPreviousData}get manualUpdateOfWorldMatrixInstancedBuffer(){return this._instanceDataStorage.manualUpdate}set manualUpdateOfWorldMatrixInstancedBuffer(K){this._instanceDataStorage.manualUpdate=K}get manualUpdateOfPreviousWorldMatrixInstancedBuffer(){return this._instanceDataStorage.previousManualUpdate}set manualUpdateOfPreviousWorldMatrixInstancedBuffer(K){this._instanceDataStorage.previousManualUpdate=K}get forceWorldMatrixInstancedBufferUpdate(){return this._instanceDataStorage.forceMatrixUpdates}set forceWorldMatrixInstancedBufferUpdate(K){this._instanceDataStorage.forceMatrixUpdates=K}_copySource(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=this.va();if(K._geometry&&K._geometry.Ca(this),j.c.DeepCopy(K,this,["name","material","skeleton","instances","parent","uniqueId","source","metadata","morphTargetManager","hasInstances","worldMatrixInstancedBuffer","previousWorldMatrixInstancedBuffer","hasLODLevels","mj","isBlocked","areNormalsFrozen","facetNb","isFacetDataEnabled","lightSources","useBones","isAnInstance","collider","edgesRenderer","forward","up","right","absolutePosition","absoluteScaling","absoluteRotationQuaternion","$i","nonUniformScaling","behaviors","worldMatrixFromCache","hasThinInstances","cloneMeshMap","hasBoundingInfo","physicsBody","physicsImpostor"],["_poseMatrix"]),this._internalMeshDataInfo._source=K,z.useClonedMeshMap&&(K._internalMeshDataInfo.meshMap||(K._internalMeshDataInfo.meshMap={}),K._internalMeshDataInfo.meshMap[this.uniqueId]=this),this._originalBuilderSideOrientation=K._originalBuilderSideOrientation,this._creationDataStorage=K._creationDataStorage,K._ranges){const b=K._ranges;for(const K in b)Object.prototype.hasOwnProperty.call(b,K)&&b[K]&&this.createAnimationRange(K,b[K].from,b[K].to)}if(K.metadata&&K.metadata.clone?this.metadata=K.metadata.clone():this.metadata=K.metadata,this._internalMetadata=K._internalMetadata,T.d&&T.d.HasTags(K)&&T.d.AddTagsTo(this,T.d.GetTags(K,!0)),this.yb(K.isEnabled(!1)),this.parent=K.parent,this.setPivotMatrix(K.getPivotMatrix(),this._postMultiplyPivotMatrix),this.id=this.name+"."+K.id,this.material=K.material,!b){const b=K.getDescendants(!0);for(let K=0;K<b.length;K++){const e=b[K];e.clone&&e.clone(this.name+"."+e.name,this)}}if(K.morphTargetManager&&(this.morphTargetManager=K.morphTargetManager),z.getPhysicsEngine){const b=z.getPhysicsEngine();if(e&&b)if(1===b.getPluginVersion()){const e=b.getImpostorForPhysicsObject(K);e&&(this.physicsImpostor=e.clone(this))}else 2===b.getPluginVersion()&&K.physicsBody&&K.physicsBody.clone(this)}for(let k=0;k<z._i.length;k++){const b=z._i[k];b.j===K&&b.clone(b.name,this)}this.skeleton=K.skeleton,this.refreshBoundingInfo(!0,!0),this.xj(!0)}constructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4?arguments[4]:void 0,T=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];super(K,b),this._internalMeshDataInfo=new h,this.delayLoadState=0,this.instances=[],this._creationDataStorage=null,this._geometry=null,this._instanceDataStorage=new c,this._thinInstanceDataStorage=new w,this._shouldGenerateFlatShading=!1,this._originalBuilderSideOrientation=R.DEFAULTSIDE,this.ignoreCameraMaxZ=!1,b=this.va(),this._scene.useRightHandedSystem?this.sideOrientation=0:this.sideOrientation=1,this._onBeforeDraw=(K,b,e)=>{K&&e&&(this._uniformBuffer?this.transferToEffect(b):e.bindOnlyWorldMatrix(b))},k&&this._copySource(k,j,T),null!==e&&(this.parent=e),this._instanceDataStorage.hardwareInstancedRendering=this.getEngine().getCaps().instancedArrays,this._internalMeshDataInfo._onMeshReadyObserverAdded=K=>{K.unregisterOnNextCall=!0,this.isReady(!0)?this.onMeshReadyObservable.notifyObservers(this):this._internalMeshDataInfo._checkReadinessObserver||(this._internalMeshDataInfo._checkReadinessObserver=this._scene.onBeforeRenderObservable.add((()=>{this.isReady(!0)&&(this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),this._internalMeshDataInfo._checkReadinessObserver=null,this.onMeshReadyObservable.notifyObservers(this))})))},this.onMeshReadyObservable=new z.d(this._internalMeshDataInfo._onMeshReadyObserverAdded),k&&k.onClonedObservable.notifyObservers(this)}instantiateHierarchy(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const z=0===this.getTotalVertices()||b&&b.doNotInstantiate&&(!0===b.doNotInstantiate||b.doNotInstantiate(this))?this.clone("Clone of "+(this.name||this.id),K||this.parent,!0):this.createInstance("instance of "+(this.name||this.id));z.parent=K||this.parent,z.position=this.position.clone(),z.Zd=this.Zd.clone(),this.rotationQuaternion?z.rotationQuaternion=this.rotationQuaternion.clone():z.rotation=this.rotation.clone(),e&&e(this,z);for(const k of this.getChildTransformNodes(!0))"InstancedMesh"===k.getClassName()&&"Mesh"===z.getClassName()&&k.sourceMesh===this?k.instantiateHierarchy(z,{doNotInstantiate:b&&b.doNotInstantiate||!1,newSourcedMesh:z},e):k.instantiateHierarchy(z,b,e);return z}getClassName(){return"Mesh"}get _isMesh(){return!0}toString(K){let b=super.toString(K);if(b+=", n vertices: "+this.getTotalVertices(),b+=", parent: "+(this._waitingParentId?this._waitingParentId:this.parent?this.parent.name:"NONE"),this.animations)for(let e=0;e<this.animations.length;e++)b+=", animation[0]: "+this.animations[e].toString(K);if(K)if(this._geometry){const K=this.Lf(),e=this.getVerticesData(t.f.PositionKind);e&&K&&(b+=", flat shading: "+(e.length/3===K.length?"YES":"NO"))}else b+=", flat shading: UNKNOWN";return b}_unBindEffect(){super._unBindEffect();for(const K of this.instances)K._unBindEffect()}get hasLODLevels(){return this._internalMeshDataInfo._LODLevels.length>0}getLODLevels(){return this._internalMeshDataInfo._LODLevels}_sortLODLevels(){const K=this._internalMeshDataInfo._useLODScreenCoverage?-1:1;this._internalMeshDataInfo._LODLevels.sort(((b,e)=>b.distanceOrScreenCoverage<e.distanceOrScreenCoverage?K:b.distanceOrScreenCoverage>e.distanceOrScreenCoverage?-K:0))}addLODLevel(K,b){if(b&&b._masterMesh)return G.b.Warn("You cannot use a mesh as LOD level twice"),this;const e=new r(K,b);return this._internalMeshDataInfo._LODLevels.push(e),b&&(b._masterMesh=this),this._sortLODLevels(),this}getLODLevelAtDistance(K){const b=this._internalMeshDataInfo;for(let e=0;e<b._LODLevels.length;e++){const z=b._LODLevels[e];if(z.distanceOrScreenCoverage===K)return z.mesh}return null}removeLODLevel(K){const b=this._internalMeshDataInfo;for(let e=0;e<b._LODLevels.length;e++)b._LODLevels[e].mesh===K&&(b._LODLevels.splice(e,1),K&&(K._masterMesh=null));return this._sortLODLevels(),this}getLOD(K,b){const e=this._internalMeshDataInfo;if(!e._LODLevels||0===e._LODLevels.length)return this;const z=b||this.getBoundingInfo().boundingSphere,k=K.mode===l.e.ORTHOGRAPHIC_CAMERA?K.Fi:z.centerWorld.Qc(K.globalPosition).length();let j=k,T=1;if(e._useLODScreenCoverage){const b=K.screenArea;let e=z.radiusWorld*K.Fi/k;e=e*e*Math.PI,j=e/b,T=-1}if(T*e._LODLevels[e._LODLevels.length-1].distanceOrScreenCoverage>T*j)return this.onLODLevelSelection&&this.onLODLevelSelection(j,this,this),this;for(let F=0;F<e._LODLevels.length;F++){const K=e._LODLevels[F];if(T*K.distanceOrScreenCoverage<T*j){if(K.mesh){if(4===K.mesh.delayLoadState)return K.mesh._checkDelayState(),this;if(2===K.mesh.delayLoadState)return this;K.mesh._preActivate(),K.mesh._updateSubMeshesBoundingInfo(this.worldMatrixFromCache)}return this.onLODLevelSelection&&this.onLODLevelSelection(j,this,K.mesh),K.mesh}}return this.onLODLevelSelection&&this.onLODLevelSelection(j,this,this),this}get mj(){return this._geometry}getTotalVertices(){return null===this._geometry||void 0===this._geometry?0:this._geometry.getTotalVertices()}getVerticesData(K,b,e,z){var k,j;if(!this._geometry)return null;let T=z||null===(k=this._userInstancedBuffersStorage)||void 0===k||null===(j=k.vertexBuffers[K])||void 0===j?void 0:j.getFloatData(this.instances.length+1,e||b&&1!==this._geometry.meshes.length);return T||(T=this._geometry.getVerticesData(K,b,e)),T}copyVerticesData(K,b){this._geometry&&this._geometry.copyVerticesData(K,b)}getVertexBuffer(K,b){var e;return this._geometry?(b||null===(e=this._userInstancedBuffersStorage)||void 0===e?void 0:e.vertexBuffers[K])??this._geometry.getVertexBuffer(K):null}isVerticesDataPresent(K,b){var e;return this._geometry?!b&&void 0!==(null===(e=this._userInstancedBuffersStorage)||void 0===e?void 0:e.vertexBuffers[K])||this._geometry.isVerticesDataPresent(K):!!this._delayInfo&&-1!==this._delayInfo.indexOf(K)}isVertexBufferUpdatable(K,b){if(!this._geometry)return!!this._delayInfo&&-1!==this._delayInfo.indexOf(K);if(!b){var e;const b=null===(e=this._userInstancedBuffersStorage)||void 0===e?void 0:e.vertexBuffers[K];if(b)return b.isUpdatable()}return this._geometry.isVertexBufferUpdatable(K)}getVerticesDataKinds(K){if(!this._geometry){const K=[];return this._delayInfo&&this._delayInfo.forEach((function(b){K.push(b)})),K}const b=this._geometry.getVerticesDataKinds();if(!K&&this._userInstancedBuffersStorage)for(const e in this._userInstancedBuffersStorage.vertexBuffers)-1===b.indexOf(e)&&b.push(e);return b}getTotalIndices(){return this._geometry?this._geometry.getTotalIndices():0}Lf(K,b){return this._geometry?this._geometry.Lf(K,b):[]}get isBlocked(){return null!==this._masterMesh&&void 0!==this._masterMesh}isReady(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(2===this.delayLoadState)return!1;if(!super.isReady(K))return!1;if(!this.Rf||0===this.Rf.length)return!0;if(!K)return!0;const e=this.getEngine(),z=this.va(),k=b||e.getCaps().instancedArrays&&(this.instances.length>0||this.hasThinInstances);this.xj();const j=this.material||z.defaultMaterial;if(j)if(j._storeEffectOnSubMeshes)for(const t of this.Rf){const K=t.Ha();if(K)if(K._storeEffectOnSubMeshes){if(!K.isReadyForSubMesh(this,t,k))return!1}else if(!K.isReady(this,k))return!1}else if(!j.isReady(this,k))return!1;const T=e.currentRenderPassId;for(const t of this.lightSources){const K=t.getShadowGenerators();if(!K)continue;const b=K.values();for(let z=b.next();!0!==z.done;z=b.next()){var F,l,Y,A;const K=z.value;if(K&&(null===(F=K.getShadowMap())||void 0===F||!F.renderList||null!==(l=K.getShadowMap())&&void 0!==l&&l.renderList&&-1!==(null===(Y=K.getShadowMap())||void 0===Y||null===(A=Y.renderList)||void 0===A?void 0:A.indexOf(this)))){const b=K.getShadowMap().renderPassIds??[e.currentRenderPassId];for(let z=0;z<b.length;++z){e.currentRenderPassId=b[z];for(const b of this.Rf){var X;if(!K.isReady(b,k,(null===(X=b.Ha())||void 0===X?void 0:X.needAlphaBlendingForMesh(this))??!1))return e.currentRenderPassId=T,!1}}e.currentRenderPassId=T}}}for(const t of this._internalMeshDataInfo._LODLevels)if(t.mesh&&!t.mesh.isReady(k))return!1;return!0}get areNormalsFrozen(){return this._internalMeshDataInfo._areNormalsFrozen}uh(){return this._internalMeshDataInfo._areNormalsFrozen=!0,this}unfreezeNormals(){return this._internalMeshDataInfo._areNormalsFrozen=!1,this}set overridenInstanceCount(K){this._instanceDataStorage.overridenInstanceCount=K}_preActivate(){const K=this._internalMeshDataInfo,b=this.va().getRenderId();return K._preActivateId===b||(K._preActivateId=b,this._instanceDataStorage.visibleInstances=null),this}_preActivateForIntermediateRendering(K){return this._instanceDataStorage.visibleInstances&&(this._instanceDataStorage.visibleInstances.intermediateDefaultRenderId=K),this}_registerInstanceForRenderId(K,b){return this._instanceDataStorage.visibleInstances||(this._instanceDataStorage.visibleInstances={defaultRenderId:b,selfDefaultRenderId:this._renderId}),this._instanceDataStorage.visibleInstances[b]||(void 0!==this._instanceDataStorage.previousRenderId&&this._instanceDataStorage.isFrozen&&(this._instanceDataStorage.visibleInstances[this._instanceDataStorage.previousRenderId]=null),this._instanceDataStorage.previousRenderId=b,this._instanceDataStorage.visibleInstances[b]=new Array),this._instanceDataStorage.visibleInstances[b].push(K),this}_afterComputeWorldMatrix(){super._afterComputeWorldMatrix(),this.hasThinInstances&&(this.Da||this.thinInstanceRefreshBoundingInfo(!1))}_postActivate(){this.edgesShareWithInstances&&this.edgesRenderer&&this.edgesRenderer.isEnabled&&this._renderingGroup&&(this._renderingGroup._edgesRenderers.pushNoDuplicate(this.edgesRenderer),this.edgesRenderer.customInstances.push(this.getWorldMatrix()))}refreshBoundingInfo(){let K,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.hasBoundingInfo&&this.getBoundingInfo().isLocked)return this;K="object"===typeof b?b:{applySkeleton:b,applyMorph:e};const z=this.mj?this.mj.boundingBias:null;return this.Fa(this._getData(K,null,t.f.PositionKind),z),this}_createGlobalSubMesh(K){const b=this.getTotalVertices();if(!b||!this.Lf())return null;if(this.Rf&&this.Rf.length>0){const e=this.Lf();if(!e)return null;const z=e.length;let k=!1;if(K)k=!0;else for(const K of this.Rf){if(K.indexStart+K.indexCount>z){k=!0;break}if(K.verticesStart+K.verticesCount>b){k=!0;break}}if(!k)return this.Rf[0]}return this.releaseSubMeshes(),new m.e(0,0,b,0,this.getTotalIndices(),this)}subdivide(K){if(K<1)return;const b=this.getTotalIndices();let e=b/K|0,z=0;for(;e%3!==0;)e++;this.releaseSubMeshes();for(let k=0;k<K&&!(z>=b);k++)m.e.CreateFromIndices(0,z,k===K-1?b-z:e,this,void 0,!1),z+=e;this.refreshBoundingInfo(),this.synchronizeInstances()}Ga(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;if(this._geometry)this._geometry.Ga(K,b,e,z);else{const z=new U.e;z.set(b,K);const k=this.va();new B.c(B.c.RandomId(),k,z,e,this)}return this}removeVerticesData(K){this._geometry&&this._geometry.removeVerticesData(K)}markVerticesDataAsUpdatable(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=this.getVertexBuffer(K);e&&e.isUpdatable()!==b&&this.Ga(K,this.getVerticesData(K),b)}setVerticesBuffer(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._geometry||(this._geometry=B.c.CreateGeometryForMesh(this)),this._geometry.setVerticesBuffer(K,null,b),this}updateVerticesData(K,b,e,z){return this._geometry?(z?(this.makeGeometryUnique(),this.updateVerticesData(K,b,e,!1)):this._geometry.updateVerticesData(K,b,e),this):this}updateMeshPositions(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const e=this.getVerticesData(t.f.PositionKind);if(!e)return this;if(K(e),this.updateVerticesData(t.f.PositionKind,e,!1,!1),b){const K=this.Lf(),b=this.getVerticesData(t.f.NormalKind);if(!b)return this;U.e.ComputeNormals(e,K,b),this.updateVerticesData(t.f.NormalKind,b,!1,!1)}return this}makeGeometryUnique(){if(!this._geometry)return this;if(1===this._geometry.meshes.length)return this;const K=this._geometry,b=this._geometry.i(B.c.RandomId());return K.releaseForMesh(this,!0),b.Ca(this),this}setIndexBuffer(K,b,e){let z=this._geometry;z||(z=new B.c(B.c.RandomId(),this.va(),void 0,void 0,this)),z.setIndexBuffer(K,b,e)}setIndices(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this._geometry)this._geometry.setIndices(K,b,e,z);else{const b=new U.e;b.indices=K;const z=this.va();new B.c(B.c.RandomId(),z,b,e,this)}return this}updateIndices(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._geometry?(this._geometry.updateIndices(K,b,e),this):this}toLeftHanded(){return this._geometry?(this._geometry.toLeftHanded(),this):this}_bind(K,b,e){let z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!this._geometry)return this;const k=this.va().getEngine();let j;if(this._unIndexed)if(this._getRenderingFillMode(e)===D.b.WireFrameFillMode)j=K._getLinesIndexBuffer(this.Lf(),k);else j=null;else switch(this._getRenderingFillMode(e)){case D.b.PointFillMode:j=null;break;case D.b.WireFrameFillMode:j=K._getLinesIndexBuffer(this.Lf(),k);break;default:case D.b.TriangleFillMode:j=this._geometry.getIndexBuffer()}return this._bindDirect(b,j,z)}_bindDirect(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this._geometry?(this.morphTargetManager&&this.morphTargetManager.isUsingTextureForTargets&&this.morphTargetManager._bind(K),e&&this._userInstancedBuffersStorage&&!this.hasThinInstances?this._geometry._bind(K,b,this._userInstancedBuffersStorage.vertexBuffers,this._userInstancedBuffersStorage.vertexArrayObjects):this._geometry._bind(K,b),this):this}_draw(K,b,e){if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;this._internalMeshDataInfo._onBeforeDrawObservable&&this._internalMeshDataInfo._onBeforeDrawObservable.notifyObservers(this);const z=this.va().getEngine();return this._unIndexed&&b!==D.b.WireFrameFillMode||b==D.b.PointFillMode?z.drawArraysType(b,K.verticesStart,K.verticesCount,this.forcedInstanceCount||e):b==D.b.WireFrameFillMode?z.drawElementsType(b,0,K._linesIndexCount,this.forcedInstanceCount||e):z.drawElementsType(b,K.indexStart,K.indexCount,this.forcedInstanceCount||e),this}registerBeforeRender(K){return this.onBeforeRenderObservable.add(K),this}unregisterBeforeRender(K){return this.onBeforeRenderObservable.removeCallback(K),this}registerAfterRender(K){return this.onAfterRenderObservable.add(K),this}unregisterAfterRender(K){return this.onAfterRenderObservable.removeCallback(K),this}_getInstancesRenderList(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._instanceDataStorage.isFrozen){if(b)return this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.hardwareInstancedRendering[K]=!1,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode.renderSelf[K]=!0,this._instanceDataStorage.batchCacheReplacementModeInFrozenMode;if(this._instanceDataStorage.previousBatch)return this._instanceDataStorage.previousBatch}const e=this.va(),z=e._isInIntermediateRendering(),k=z?this._internalAbstractMeshDataInfo._onlyForInstancesIntermediate:this._internalAbstractMeshDataInfo._onlyForInstances,j=this._instanceDataStorage.batchCache;if(j.mustReturn=!1,j.renderSelf[K]=b||!k&&this.isEnabled()&&this.isVisible,j.visibleInstances[K]=null,this._instanceDataStorage.visibleInstances&&!b){const b=this._instanceDataStorage.visibleInstances,k=e.getRenderId(),T=z?b.intermediateDefaultRenderId:b.defaultRenderId;j.visibleInstances[K]=b[k],!j.visibleInstances[K]&&T&&(j.visibleInstances[K]=b[T])}return j.hardwareInstancedRendering[K]=!b&&this._instanceDataStorage.hardwareInstancedRendering&&null!==j.visibleInstances[K]&&void 0!==j.visibleInstances[K],this._instanceDataStorage.previousBatch=j,j}_renderWithInstances(K,b,e,z,k){const j=e.visibleInstances[K._id],T=j?j.length:0,F=this._instanceDataStorage,l=F.instancesBufferSize;let A=F.instancesBuffer,X=F.instancesPreviousBuffer;const U=16*(T+1)*4;for(;F.instancesBufferSize<U;)F.instancesBufferSize*=2;F.instancesData&&l==F.instancesBufferSize||(F.instancesData=new Float32Array(F.instancesBufferSize/4)),(this._scene.needsPreviousWorldMatrices&&!F.instancesPreviousData||l!=F.instancesBufferSize)&&(F.instancesPreviousData=new Float32Array(F.instancesBufferSize/4));let B=0,u=0;const m=e.renderSelf[K._id],D=!A||l!==F.instancesBufferSize||this._scene.needsPreviousWorldMatrices&&!F.instancesPreviousBuffer;if(this._instanceDataStorage.manualUpdate||F.isFrozen&&!D)u=(m?1:0)+T;else{const b=this.getWorldMatrix();if(m&&(this._scene.needsPreviousWorldMatrices&&(F.masterMeshPreviousWorldMatrix?(F.masterMeshPreviousWorldMatrix.copyToArray(F.instancesPreviousData,B),F.masterMeshPreviousWorldMatrix.p(b)):(F.masterMeshPreviousWorldMatrix=b.clone(),F.masterMeshPreviousWorldMatrix.copyToArray(F.instancesPreviousData,B))),b.copyToArray(F.instancesData,B),B+=16,u++),j){var I;if(R.INSTANCEDMESH_SORT_TRANSPARENT&&this._scene.activeCamera&&null!==(I=K.Ha())&&void 0!==I&&I.needAlphaBlendingForMesh(K.getRenderingMesh())){const K=this._scene.activeCamera.globalPosition;for(let b=0;b<j.length;b++){const e=j[b];e._distanceToCamera=Y.k.Distance(e.getBoundingInfo().boundingSphere.centerWorld,K)}j.sort(((K,b)=>K._distanceToCamera>b._distanceToCamera?-1:K._distanceToCamera<b._distanceToCamera?1:0))}for(let K=0;K<j.length;K++){const b=j[K],e=b.getWorldMatrix();e.copyToArray(F.instancesData,B),this._scene.needsPreviousWorldMatrices&&(b._previousWorldMatrix?(b._previousWorldMatrix.copyToArray(F.instancesPreviousData,B),b._previousWorldMatrix.p(e)):(b._previousWorldMatrix=e.clone(),b._previousWorldMatrix.copyToArray(F.instancesPreviousData,B))),B+=16,u++}}}return D?(A&&A.dispose(),X&&X.dispose(),A=new t.b(k,F.instancesData,!0,16,!1,!0),F.instancesBuffer=A,this._userInstancedBuffersStorage||(this._userInstancedBuffersStorage={data:{},vertexBuffers:{},strides:{},sizes:{},vertexArrayObjects:this.getEngine().getCaps().vertexArrayObject?{}:void 0}),this._userInstancedBuffersStorage.vertexBuffers.world0=A.createVertexBuffer("world0",0,4),this._userInstancedBuffersStorage.vertexBuffers.world1=A.createVertexBuffer("world1",4,4),this._userInstancedBuffersStorage.vertexBuffers.world2=A.createVertexBuffer("world2",8,4),this._userInstancedBuffersStorage.vertexBuffers.world3=A.createVertexBuffer("world3",12,4),this._scene.needsPreviousWorldMatrices&&(X=new t.b(k,F.instancesPreviousData,!0,16,!1,!0),F.instancesPreviousBuffer=X,this._userInstancedBuffersStorage.vertexBuffers.previousWorld0=X.createVertexBuffer("previousWorld0",0,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld1=X.createVertexBuffer("previousWorld1",4,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld2=X.createVertexBuffer("previousWorld2",8,4),this._userInstancedBuffersStorage.vertexBuffers.previousWorld3=X.createVertexBuffer("previousWorld3",12,4)),this._invalidateInstanceVertexArrayObject()):this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||(A.updateDirectly(F.instancesData,0,u),!this._scene.needsPreviousWorldMatrices||this._instanceDataStorage.manualUpdate&&!this._instanceDataStorage.previousManualUpdate||X.updateDirectly(F.instancesPreviousData,0,u)),this._processInstancedBuffers(j,m),this.va()._activeIndices.addCount(K.indexCount*u,!1),k._currentDrawContext&&(k._currentDrawContext.useInstancing=!0),this._bind(K,z,b),this._draw(K,b,u),!this._scene.needsPreviousWorldMatrices||D||!this._instanceDataStorage.manualUpdate||this._instanceDataStorage.isFrozen&&!this._instanceDataStorage.forceMatrixUpdates||this._instanceDataStorage.previousManualUpdate||X.updateDirectly(F.instancesData,0,u),k.unbindInstanceAttributes(),this}_renderWithThinInstances(K,b,e,z){var k;const j=(null===(k=this._thinInstanceDataStorage)||void 0===k?void 0:k.instancesCount)??0;this.va()._activeIndices.addCount(K.indexCount*j,!1),z._currentDrawContext&&(z._currentDrawContext.useInstancing=!0),this._bind(K,e,b),this._draw(K,b,j),this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData&&this._thinInstanceDataStorage.matrixData&&(this._thinInstanceDataStorage.previousMatrixBuffer?this._thinInstanceDataStorage.previousMatrixBuffer.updateDirectly(this._thinInstanceDataStorage.matrixData,0,j):this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.matrixData,!1)),z.unbindInstanceAttributes()}_processInstancedBuffers(K,b){}_processRendering(K,b,e,z,k,j,T,F){const l=this.va(),Y=l.getEngine();if(z=this._getRenderingFillMode(z),j&&b.getRenderingMesh().hasThinInstances)return this._renderWithThinInstances(b,z,e,Y),this;if(j)this._renderWithInstances(b,z,k,e,Y);else{Y._currentDrawContext&&(Y._currentDrawContext.useInstancing=!1);let e=0;k.renderSelf[b._id]&&(T&&T(!1,K.getWorldMatrix(),F),e++,this._draw(b,z,this._instanceDataStorage.overridenInstanceCount));const j=k.visibleInstances[b._id];if(j){const K=j.length;e+=K;for(let e=0;e<K;e++){const K=j[e].getWorldMatrix();T&&T(!0,K,F),this._draw(b,z)}}l._activeIndices.addCount(b.indexCount*e,!1)}return this}_rebuild(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._instanceDataStorage.instancesBuffer&&(K&&this._instanceDataStorage.instancesBuffer.dispose(),this._instanceDataStorage.instancesBuffer=null),this._userInstancedBuffersStorage){for(const b in this._userInstancedBuffersStorage.vertexBuffers){const e=this._userInstancedBuffersStorage.vertexBuffers[b];e&&(K&&e.dispose(),this._userInstancedBuffersStorage.vertexBuffers[b]=null)}this._userInstancedBuffersStorage.vertexArrayObjects&&(this._userInstancedBuffersStorage.vertexArrayObjects={})}this._internalMeshDataInfo._effectiveMaterial=null,super._rebuild(K)}_freeze(){if(this.Rf){for(let K=0;K<this.Rf.length;K++)this._getInstancesRenderList(K);this._internalMeshDataInfo._effectiveMaterial=null,this._instanceDataStorage.isFrozen=!0}}_unFreeze(){this._instanceDataStorage.isFrozen=!1,this._instanceDataStorage.previousBatch=null}renderWithRenderPassId(K,b,e,z){let k=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];const j=this._scene.getEngine(),T=j.currentRenderPassId;if(void 0!==K&&(j.currentRenderPassId=K),z)(!k||k&&z.isInFrustum(this._scene._frustumPlanes))&&this.render(z,!!b,e);else for(let F=0;F<this.Rf.length;F++){const K=this.Rf[F];(!k||k&&K.isInFrustum(this._scene._frustumPlanes))&&this.render(K,!!b,e)}return void 0!==K&&(j.currentRenderPassId=T),this}directRender(){if(!this.Rf)return this;for(const K of this.Rf)this.render(K,!1);return this}render(K,b,e){var z,k,j;const T=this.va();this._internalAbstractMeshDataInfo._isActiveIntermediate?this._internalAbstractMeshDataInfo._isActiveIntermediate=!1:this._internalAbstractMeshDataInfo._isActive=!1;const F=(null===(z=T.activeCameras)||void 0===z?void 0:z.length)??0;if((F>1&&T.activeCamera===T.activeCameras[0]||F<=1)&&this._checkOcclusionQuery()&&!this._occlusionDataStorage.forceRenderingWhenOccluded)return this;const l=this._getInstancesRenderList(K._id,!!e);if(l.mustReturn)return this;if(!this._geometry||!this._geometry.getVertexBuffers()||!this._unIndexed&&!this._geometry.getIndexBuffer())return this;const Y=T.getEngine();let A=0,X=null;this.ignoreCameraMaxZ&&T.activeCamera&&!T._isInIntermediateRendering()&&(A=T.activeCamera.maxZ,X=T.activeCamera,T.activeCamera.maxZ=0,T.updateTransformMatrix(!0)),this._internalMeshDataInfo._onBeforeRenderObservable&&this._internalMeshDataInfo._onBeforeRenderObservable.notifyObservers(this);const t=K.getRenderingMesh(),U=l.hardwareInstancedRendering[K._id]||t.hasThinInstances||!!this._userInstancedBuffersStorage&&!K.getMesh()._internalAbstractMeshDataInfo._actAsRegularMesh,B=this._instanceDataStorage,u=K.Ha();if(!u)return X&&(X.maxZ=A,T.updateTransformMatrix(!0)),this;if(B.isFrozen&&this._internalMeshDataInfo._effectiveMaterial&&this._internalMeshDataInfo._effectiveMaterial===u){if(u._storeEffectOnSubMeshes&&(null===(k=K._drawWrapper)||void 0===k||!k._wasPreviouslyReady)||!u._storeEffectOnSubMeshes&&!u._getDrawWrapper()._wasPreviouslyReady)return X&&(X.maxZ=A,T.updateTransformMatrix(!0)),this}else{if(u._storeEffectOnSubMeshes){if(!u.isReadyForSubMesh(this,K,U))return X&&(X.maxZ=A,T.updateTransformMatrix(!0)),this}else if(!u.isReady(this,U))return X&&(X.maxZ=A,T.updateTransformMatrix(!0)),this;this._internalMeshDataInfo._effectiveMaterial=u}let m;b&&Y.setAlphaMode(this._internalMeshDataInfo._effectiveMaterial.alphaMode),m=this._internalMeshDataInfo._effectiveMaterial._storeEffectOnSubMeshes?K._drawWrapper:this._internalMeshDataInfo._effectiveMaterial._getDrawWrapper();const I=(null===(j=m)||void 0===j?void 0:j.effect)??null;for(const D of T._beforeRenderingMeshStage)D.action(this,K,l,I);if(!m||!I)return X&&(X.maxZ=A,T.updateTransformMatrix(!0)),this;const x=e||this;let Q;if(B.isFrozen||!this._internalMeshDataInfo._effectiveMaterial.Lg&&null===this._internalMeshDataInfo._effectiveMaterial.sideOrientation&&!this._internalMeshDataInfo._effectiveMaterial.twoSidedLighting)Q=B.sideOrientation;else{const K=x._getWorldMatrixDeterminant();Q=this._internalMeshDataInfo._effectiveMaterial._getEffectiveOrientation(this),K<0&&(Q=Q===D.b.ClockWiseSideOrientation?D.b.CounterClockWiseSideOrientation:D.b.ClockWiseSideOrientation),B.sideOrientation=Q}const G=this._internalMeshDataInfo._effectiveMaterial._preBind(m,Q);this._internalMeshDataInfo._effectiveMaterial.forceDepthWrite&&Y.setDepthWrite(!0);const i=this._internalMeshDataInfo._effectiveMaterial,S=i.fillMode;this._internalMeshDataInfo._onBeforeBindObservable&&this._internalMeshDataInfo._onBeforeBindObservable.notifyObservers(this),U||this._bind(K,I,S,!1);const M=x.getWorldMatrix();i._storeEffectOnSubMeshes?i.bindForSubMesh(M,this,K):i.bind(M,this),!i.Lg&&i.separateCullingPass&&(Y.setState(!0,i.zOffset,!1,!G,i.cullBackFaces,i.stencil,i.zOffsetUnits),this._processRendering(this,K,I,S,l,U,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),Y.setState(!0,i.zOffset,!1,G,i.cullBackFaces,i.stencil,i.zOffsetUnits),this._internalMeshDataInfo._onBetweenPassObservable&&this._internalMeshDataInfo._onBetweenPassObservable.notifyObservers(K)),this._processRendering(this,K,I,S,l,U,this._onBeforeDraw,this._internalMeshDataInfo._effectiveMaterial),this._internalMeshDataInfo._effectiveMaterial.unbind();for(const D of T._afterRenderingMeshStage)D.action(this,K,l,I);return this._internalMeshDataInfo._onAfterRenderObservable&&this._internalMeshDataInfo._onAfterRenderObservable.notifyObservers(this),X&&(X.maxZ=A,T.updateTransformMatrix(!0)),2!==T.performancePriority||B.isFrozen||this._freeze(),this}cleanMatrixWeights(){this.isVerticesDataPresent(t.f.MatricesWeightsKind)&&(this.isVerticesDataPresent(t.f.MatricesWeightsExtraKind)?this._normalizeSkinWeightsAndExtra():this._normalizeSkinFourWeights())}_normalizeSkinFourWeights(){const K=this.getVerticesData(t.f.MatricesWeightsKind),b=K.length;for(let e=0;e<b;e+=4){const b=K[e]+K[e+1]+K[e+2]+K[e+3];if(0===b)K[e]=1;else{const z=1/b;K[e]*=z,K[e+1]*=z,K[e+2]*=z,K[e+3]*=z}}this.Ga(t.f.MatricesWeightsKind,K)}_normalizeSkinWeightsAndExtra(){const K=this.getVerticesData(t.f.MatricesWeightsExtraKind),b=this.getVerticesData(t.f.MatricesWeightsKind),e=b.length;for(let z=0;z<e;z+=4){let e=b[z]+b[z+1]+b[z+2]+b[z+3];if(e+=K[z]+K[z+1]+K[z+2]+K[z+3],0===e)b[z]=1;else{const k=1/e;b[z]*=k,b[z+1]*=k,b[z+2]*=k,b[z+3]*=k,K[z]*=k,K[z+1]*=k,K[z+2]*=k,K[z+3]*=k}}this.Ga(t.f.MatricesWeightsKind,b),this.Ga(t.f.MatricesWeightsKind,K)}validateSkinning(){const K=this.getVerticesData(t.f.MatricesWeightsExtraKind),b=this.getVerticesData(t.f.MatricesWeightsKind);if(null===b||null==this.skeleton)return{skinned:!1,valid:!0,Tl:"not skinned"};const e=b.length;let z=0,k=0,j=0,T=0;const F=null===K?4:8,l=[];for(let t=0;t<=F;t++)l[t]=0;for(let t=0;t<e;t+=4){let e=b[t],Y=e,A=0===Y?0:1;for(let k=1;k<F;k++){const j=k<4?b[t+k]:K[t+k-4];j>e&&z++,0!==j&&A++,Y+=j,e=j}if(l[A]++,A>j&&(j=A),0===Y)k++;else{const e=1/Y;let z=0;for(let k=0;k<F;k++)z+=k<4?Math.abs(b[t+k]-b[t+k]*e):Math.abs(K[t+k-4]-K[t+k-4]*e);z>.001&&T++}}const Y=this.skeleton.bones.length,A=this.getVerticesData(t.f.MatricesIndicesKind),X=this.getVerticesData(t.f.MatricesIndicesExtraKind);let U=0;for(let t=0;t<e;t+=4)for(let K=0;K<F;K++){const b=K<4?A[t+K]:X[t+K-4];(b>=Y||b<0)&&U++}return{skinned:!0,valid:0===k&&0===T&&0===U,Tl:"Number of Weights = "+e/4+"\nMaximum influences = "+j+"\nMissing Weights = "+k+"\nNot Sorted = "+z+"\nNot Normalized = "+T+"\nWeightCounts = ["+l+"]\nNumber of bones = "+Y+"\nBad Bone Indices = "+U}}_checkDelayState(){const K=this.va();return this._geometry?this._geometry.load(K):4===this.delayLoadState&&(this.delayLoadState=2,this._queueLoad(K)),this}_queueLoad(K){K.addPendingData(this);const b=-1!==this.delayLoadingFile.indexOf(".babylonbinarymeshdata");return k.f.LoadFile(this.delayLoadingFile,(b=>{b instanceof ArrayBuffer?this._delayLoadingFunction(b,this):this._delayLoadingFunction(JSON.parse(b),this),this.instances.forEach((K=>{K.refreshBoundingInfo(),K._syncSubMeshes()})),this.delayLoadState=1,K.removePendingData(this)}),(()=>{}),K.offlineProvider,b),this}isInFrustum(K){return 2!==this.delayLoadState&&(!!super.isInFrustum(K)&&(this._checkDelayState(),!0))}setMaterialById(K){const b=this.va().materials;let e;for(e=b.length-1;e>-1;e--)if(b[e].id===K)return this.material=b[e],this;const z=this.va().multiMaterials;for(e=z.length-1;e>-1;e--)if(z[e].id===K)return this.material=z[e],this;return this}getAnimatables(){const K=[];return this.material&&K.push(this.material),this.skeleton&&K.push(this.skeleton),K}bakeTransformIntoVertices(K){if(!this.isVerticesDataPresent(t.f.PositionKind))return this;const b=this.Rf.splice(0);this._resetPointsArrayCache();let e=this.getVerticesData(t.f.PositionKind);const z=Y.k.Zero();let k;for(k=0;k<e.length;k+=3)Y.k.TransformCoordinatesFromFloatsToRef(e[k],e[k+1],e[k+2],K,z).toArray(e,k);if(this.Ga(t.f.PositionKind,e,this.getVertexBuffer(t.f.PositionKind).isUpdatable()),this.isVerticesDataPresent(t.f.NormalKind)){for(e=this.getVerticesData(t.f.NormalKind),k=0;k<e.length;k+=3)Y.k.TransformNormalFromFloatsToRef(e[k],e[k+1],e[k+2],K,z).normalize().toArray(e,k);this.Ga(t.f.NormalKind,e,this.getVertexBuffer(t.f.NormalKind).isUpdatable())}if(this.isVerticesDataPresent(t.f.TangentKind)){for(e=this.getVerticesData(t.f.TangentKind),k=0;k<e.length;k+=4)Y.k.TransformNormalFromFloatsToRef(e[k],e[k+1],e[k+2],K,z).normalize().toArray(e,k);this.Ga(t.f.TangentKind,e,this.getVertexBuffer(t.f.TangentKind).isUpdatable())}return K.determinant()<0&&this.flipFaces(),this.releaseSubMeshes(),this.Rf=b,this}bakeCurrentTransformIntoVertices(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.bakeTransformIntoVertices(this.xj(!0)),this.resetLocalMatrix(K),this}get _positions(){return this._internalAbstractMeshDataInfo._positions||this._geometry&&this._geometry._positions||null}_resetPointsArrayCache(){return this._geometry&&this._geometry._resetPointsArrayCache(),this}_generatePointsArray(){return!!this._geometry&&this._geometry._generatePointsArray()}clone(){let K=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,b=arguments.length>2?arguments[2]:void 0,e=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return new R(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",this.va(),K,this,b,e)}dispose(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.morphTargetManager=null,this._geometry&&this._geometry.releaseForMesh(this,!0);const e=this._internalMeshDataInfo;if(e._onBeforeDrawObservable&&e._onBeforeDrawObservable.clear(),e._onBeforeBindObservable&&e._onBeforeBindObservable.clear(),e._onBeforeRenderObservable&&e._onBeforeRenderObservable.clear(),e._onAfterRenderObservable&&e._onAfterRenderObservable.clear(),e._onBetweenPassObservable&&e._onBetweenPassObservable.clear(),this._scene.useClonedMeshMap){if(e.meshMap)for(const K in e.meshMap){const b=e.meshMap[K];b&&(b._internalMeshDataInfo._source=null,e.meshMap[K]=void 0)}e._source&&e._source._internalMeshDataInfo.meshMap&&(e._source._internalMeshDataInfo.meshMap[this.uniqueId]=void 0)}else{const K=this.va().meshes;for(const b of K){const K=b;K._internalMeshDataInfo&&K._internalMeshDataInfo._source&&K._internalMeshDataInfo._source===this&&(K._internalMeshDataInfo._source=null)}}e._source=null,this._instanceDataStorage.visibleInstances={},this._disposeInstanceSpecificData(),this._disposeThinInstanceSpecificData(),this._internalMeshDataInfo._checkReadinessObserver&&this._scene.onBeforeRenderObservable.remove(this._internalMeshDataInfo._checkReadinessObserver),super.dispose(K,b)}_disposeInstanceSpecificData(){}_disposeThinInstanceSpecificData(){}_invalidateInstanceVertexArrayObject(){}applyDisplacementMap(K,b,e,z,j,T){let F=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7?arguments[7]:void 0;const Y=this.va();return k.f.LoadImage(K,(K=>{const k=K.width,l=K.height,Y=this.getEngine().createCanvas(k,l).getContext("2d");Y.drawImage(K,0,0);const A=Y.getImageData(0,0,k,l).data;this.applyDisplacementMapFromBuffer(A,k,l,b,e,j,T,F),z&&z(this)}),l||(()=>{}),Y.offlineProvider),this}applyDisplacementMapFromBuffer(K,b,e,z,k,j,T){let F=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if(!this.isVerticesDataPresent(t.f.PositionKind)||!this.isVerticesDataPresent(t.f.NormalKind)||!this.isVerticesDataPresent(t.f.UVKind))return G.b.Warn("Cannot call applyDisplacementMap: Given mesh is not complete. Position, Normal or UV are missing"),this;const l=this.getVerticesData(t.f.PositionKind,!0,!0),A=this.getVerticesData(t.f.NormalKind),X=this.getVerticesData(t.f.UVKind);let B=Y.k.Zero();const u=Y.k.Zero(),m=Y.h.Zero();j=j||Y.h.Zero(),T=T||new Y.h(1,1);for(let t=0;t<l.length;t+=3){Y.k.FromArrayToRef(l,t,B),Y.k.FromArrayToRef(A,t,u),Y.h.FromArrayToRef(X,t/3*2,m);const F=4*((Math.abs(m.x*T.x+j.x%1)*(b-1)%b|0)+(Math.abs(m.y*T.y+j.y%1)*(e-1)%e|0)*b),U=.3*(K[F]/255)+.59*(K[F+1]/255)+.11*(K[F+2]/255);u.normalize(),u.scaleInPlace(z+(k-z)*U),B=B.add(u),B.toArray(l,t)}return U.e.ComputeNormals(l,this.Lf(),A),F?(this.Ga(t.f.PositionKind,l),this.Ga(t.f.NormalKind,A),this.Ga(t.f.UVKind,X)):(this.updateVerticesData(t.f.PositionKind,l),this.updateVerticesData(t.f.NormalKind,A)),this}_getFlattenedNormals(K,b){const e=new Float32Array(3*K.length);let z=0;const k=this.sideOrientation===(this._scene.useRightHandedSystem?1:0);for(let j=0;j<K.length;j+=3){const T=Y.k.Bg(b,3*K[j]),F=Y.k.Bg(b,3*K[j+1]),l=Y.k.Bg(b,3*K[j+2]),A=T.Qc(F),X=l.Qc(F),t=Y.k.Normalize(Y.k.Cross(A,X));k&&t.scaleInPlace(-1);for(let K=0;K<3;K++)e[z++]=t.x,e[z++]=t.y,e[z++]=t.z}return e}_convertToUnIndexedMesh(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=this.getVerticesDataKinds().filter((K=>{var b;return!(null!==(b=this.getVertexBuffer(K))&&void 0!==b&&b.getIsInstanced())})),e=this.Lf(),z={},k=(K,b)=>{const z=new Float32Array(e.length*b);let k=0;for(let j=0;j<e.length;j++)for(let T=0;T<b;T++)z[k++]=K[e[j]*b+T];return z},j=this.getBoundingInfo(),T=this.mj?this.Rf.slice(0):[];for(const F of b)z[F]=this.getVerticesData(F);for(const F of b){const b=this.getVertexBuffer(F),j=b.getSize();if(K&&F===t.f.NormalKind){const K=this._getFlattenedNormals(e,z[t.f.PositionKind]);this.Ga(t.f.NormalKind,K,b.isUpdatable(),j)}else this.Ga(F,k(z[F],j),b.isUpdatable(),j)}if(this.morphTargetManager){for(let b=0;b<this.morphTargetManager.numTargets;b++){const z=this.morphTargetManager.getTarget(b),j=z.getPositions();z.setPositions(k(j,3));const T=z.getNormals();T&&z.setNormals(K?this._getFlattenedNormals(e,j):k(T,3));const F=z.getTangents();F&&z.setTangents(k(F,3));const l=z.getUVs();l&&z.setUVs(k(l,2))}this.morphTargetManager.synchronize()}for(let F=0;F<e.length;F++)e[F]=F;this.setIndices(e),this._unIndexed=!0,this.releaseSubMeshes();for(const F of T){const K=F.getBoundingInfo();m.e.AddToMesh(F.materialIndex,F.indexStart,F.indexCount,F.indexStart,F.indexCount,this).setBoundingInfo(K)}return this.setBoundingInfo(j),this.synchronizeInstances(),this}convertToFlatShadedMesh(){return this._convertToUnIndexedMesh(!0)}convertToUnIndexedMesh(){return this._convertToUnIndexedMesh()}flipFaces(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b=U.e.ExtractFromMesh(this);let e;if(K&&this.isVerticesDataPresent(t.f.NormalKind)&&b.ya){for(e=0;e<b.ya.length;e++)b.ya[e]*=-1;this.Ga(t.f.NormalKind,b.ya,this.isVertexBufferUpdatable(t.f.NormalKind))}if(b.indices){let K;for(e=0;e<b.indices.length;e+=3)K=b.indices[e+1],b.indices[e+1]=b.indices[e+2],b.indices[e+2]=K;this.setIndices(b.indices,null,this.isVertexBufferUpdatable(t.f.PositionKind),!0)}return this}increaseVertices(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;const b=U.e.ExtractFromMesh(this),e=b.indices&&!Array.isArray(b.indices)&&Array.from?Array.from(b.indices):b.indices,z=b.xa&&!Array.isArray(b.xa)&&Array.from?Array.from(b.xa):b.xa,k=b.Aa&&!Array.isArray(b.Aa)&&Array.from?Array.from(b.Aa):b.Aa,j=b.ya&&!Array.isArray(b.ya)&&Array.from?Array.from(b.ya):b.ya;if(e&&z){b.indices=e,b.xa=z,k&&(b.Aa=k),j&&(b.ya=j);const T=K+1,F=new Array;for(let K=0;K<T+1;K++)F[K]=new Array;let l,A;const X=new Y.k(0,0,0),U=new Y.k(0,0,0),B=new Y.h(0,0),u=new Array,m=new Array,D=new Array;let I,x,Q,G=z.length;k&&(x=k.length),j&&(Q=j.length);for(let K=0;K<e.length;K+=3){m[0]=e[K],m[1]=e[K+1],m[2]=e[K+2];for(let K=0;K<3;K++)if(l=m[K],A=m[(K+1)%3],void 0===D[l]&&void 0===D[A]?(D[l]=new Array,D[A]=new Array):(void 0===D[l]&&(D[l]=new Array),void 0===D[A]&&(D[A]=new Array)),void 0===D[l][A]&&void 0===D[A][l]){D[l][A]=[],X.x=(z[3*A]-z[3*l])/T,X.y=(z[3*A+1]-z[3*l+1])/T,X.z=(z[3*A+2]-z[3*l+2])/T,j&&(U.x=(j[3*A]-j[3*l])/T,U.y=(j[3*A+1]-j[3*l+1])/T,U.z=(j[3*A+2]-j[3*l+2])/T),k&&(B.x=(k[2*A]-k[2*l])/T,B.y=(k[2*A+1]-k[2*l+1])/T),D[l][A].push(l);for(let K=1;K<T;K++)D[l][A].push(z.length/3),z[G++]=z[3*l]+K*X.x,z[G++]=z[3*l+1]+K*X.y,z[G++]=z[3*l+2]+K*X.z,j&&(j[Q++]=j[3*l]+K*U.x,j[Q++]=j[3*l+1]+K*U.y,j[Q++]=j[3*l+2]+K*U.z),k&&(k[x++]=k[2*l]+K*B.x,k[x++]=k[2*l+1]+K*B.y);D[l][A].push(A),D[A][l]=new Array,I=D[l][A].length;for(let K=0;K<I;K++)D[A][l][K]=D[l][A][I-1-K]}F[0][0]=e[K],F[1][0]=D[e[K]][e[K+1]][1],F[1][1]=D[e[K]][e[K+2]][1];for(let b=2;b<T;b++){F[b][0]=D[e[K]][e[K+1]][b],F[b][b]=D[e[K]][e[K+2]][b],X.x=(z[3*F[b][b]]-z[3*F[b][0]])/b,X.y=(z[3*F[b][b]+1]-z[3*F[b][0]+1])/b,X.z=(z[3*F[b][b]+2]-z[3*F[b][0]+2])/b,j&&(U.x=(j[3*F[b][b]]-j[3*F[b][0]])/b,U.y=(j[3*F[b][b]+1]-j[3*F[b][0]+1])/b,U.z=(j[3*F[b][b]+2]-j[3*F[b][0]+2])/b),k&&(B.x=(k[2*F[b][b]]-k[2*F[b][0]])/b,B.y=(k[2*F[b][b]+1]-k[2*F[b][0]+1])/b);for(let K=1;K<b;K++)F[b][K]=z.length/3,z[G++]=z[3*F[b][0]]+K*X.x,z[G++]=z[3*F[b][0]+1]+K*X.y,z[G++]=z[3*F[b][0]+2]+K*X.z,j&&(j[Q++]=j[3*F[b][0]]+K*U.x,j[Q++]=j[3*F[b][0]+1]+K*U.y,j[Q++]=j[3*F[b][0]+2]+K*U.z),k&&(k[x++]=k[2*F[b][0]]+K*B.x,k[x++]=k[2*F[b][0]+1]+K*B.y)}F[T]=D[e[K+1]][e[K+2]],u.push(F[0][0],F[1][0],F[1][1]);for(let K=1;K<T;K++){let b;for(b=0;b<K;b++)u.push(F[K][b],F[K+1][b],F[K+1][b+1]),u.push(F[K][b],F[K+1][b+1],F[K][b+1]);u.push(F[K][b],F[K+1][b],F[K+1][b+1])}}b.indices=u,b.Ca(this,this.isVertexBufferUpdatable(t.f.PositionKind))}else G.b.Warn("Couldn't increase number of vertices : VertexData must contain at least indices and positions")}forceSharedVertices(){const K=U.e.ExtractFromMesh(this),b=K.Aa,e=K.indices,z=K.xa,k=K.za,j=K.matricesIndices,T=K.matricesWeights,F=K.matricesIndicesExtra,l=K.matricesWeightsExtra;if(void 0===e||void 0===z||null===e||null===z)G.b.Warn("VertexData contains empty entries");else{const Y=new Array,A=new Array,X=new Array,B=new Array,u=new Array,m=new Array,D=new Array,I=new Array;let x=new Array,Q=0;const G={};let i,S;for(let K=0;K<e.length;K+=3){S=[e[K],e[K+1],e[K+2]],x=[];for(let K=0;K<3;K++){x[K]="";for(let b=0;b<3;b++)Math.abs(z[3*S[K]+b])<1e-8&&(z[3*S[K]+b]=0),x[K]+=z[3*S[K]+b]+"|"}if(x[0]!=x[1]&&x[0]!=x[2]&&x[1]!=x[2])for(let K=0;K<3;K++){if(i=G[x[K]],void 0===i){G[x[K]]=Q,i=Q++;for(let b=0;b<3;b++)Y.push(z[3*S[K]+b]);if(null!==k&&void 0!==k)for(let b=0;b<4;b++)B.push(k[4*S[K]+b]);if(null!==b&&void 0!==b)for(let e=0;e<2;e++)X.push(b[2*S[K]+e]);if(null!==j&&void 0!==j)for(let b=0;b<4;b++)u.push(j[4*S[K]+b]);if(null!==T&&void 0!==T)for(let b=0;b<4;b++)m.push(T[4*S[K]+b]);if(null!==F&&void 0!==F)for(let b=0;b<4;b++)D.push(F[4*S[K]+b]);if(null!==l&&void 0!==l)for(let b=0;b<4;b++)I.push(l[4*S[K]+b])}A.push(i)}}const M=new Array;U.e.ComputeNormals(Y,A,M),K.xa=Y,K.indices=A,K.ya=M,null!==b&&void 0!==b&&(K.Aa=X),null!==k&&void 0!==k&&(K.za=B),null!==j&&void 0!==j&&(K.matricesIndices=u),null!==T&&void 0!==T&&(K.matricesWeights=m),null!==F&&void 0!==F&&(K.matricesIndicesExtra=D),null!==T&&void 0!==T&&(K.matricesWeightsExtra=I),K.Ca(this,this.isVertexBufferUpdatable(t.f.PositionKind))}}static _instancedMeshFactory(K,b){throw(0,S.c)("InstancedMesh")}static _PhysicsImpostorParser(K,b,e){throw(0,S.c)("PhysicsImpostor")}createInstance(K){const b=R._instancedMeshFactory(K,this);return b.parent=this.parent,b}synchronizeInstances(){for(let K=0;K<this.instances.length;K++){this.instances[K]._syncSubMeshes()}return this}optimizeIndices(K){const b=this.Lf(),e=this.getVerticesData(t.f.PositionKind);if(!e||!b)return this;const z=[];for(let k=0;k<e.length;k+=3)z.push(Y.k.Bg(e,k));const j=[];return k.d.SyncAsyncForLoop(z.length,40,(K=>{const b=z.length-1-K,e=z[b];for(let k=0;k<b;++k){const K=z[k];if(e.equals(K)){j[b]=k;break}}}),(()=>{for(let K=0;K<b.length;++K)b[K]=j[b[K]]||b[K];const e=this.Rf.slice(0);this.setIndices(b),this.Rf=e,K&&K(this)})),this}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K.name=this.name,K.id=this.id,K.uniqueId=this.uniqueId,K.type=this.getClassName(),T.d&&T.d.HasTags(this)&&(K.tags=T.d.GetTags(this)),K.position=this.position.Ti(),this.rotationQuaternion?K.rotationQuaternion=this.rotationQuaternion.Ti():this.rotation&&(K.rotation=this.rotation.Ti()),K.Zd=this.Zd.Ti(),this._postMultiplyPivotMatrix?K.pivotMatrix=this.getPivotMatrix().Ti():K.localMatrix=this.getPivotMatrix().Ti(),K.isEnabled=this.isEnabled(!1),K.isVisible=this.isVisible,K.infiniteDistance=this.infiniteDistance,K.pickable=this.ub,K.receiveShadows=this.receiveShadows,K.billboardMode=this.billboardMode,K.visibility=this.visibility,K.ob=this.ob,K.checkCollisions=this.checkCollisions,K.ellipsoid=this.ellipsoid.Ti(),K.ellipsoidOffset=this.ellipsoidOffset.Ti(),K.Da=this.Da,K.isBlocker=this.isBlocker,K.sideOrientation=this.sideOrientation,this.parent&&this.parent._serializeAsParent(K),K.isUnIndexed=this.isUnIndexed;const b=this._geometry;if(b&&this.Rf){K.geometryUniqueId=b.uniqueId,K.geometryId=b.id,K.Rf=[];for(let b=0;b<this.Rf.length;b++){const e=this.Rf[b];K.Rf.push({materialIndex:e.materialIndex,verticesStart:e.verticesStart,verticesCount:e.verticesCount,indexStart:e.indexStart,indexCount:e.indexCount})}}if(this.material?this.material.doNotSerialize||(K.materialUniqueId=this.material.uniqueId,K.materialId=this.material.id):(this.material=null,K.materialUniqueId=this._scene.defaultMaterial.uniqueId,K.materialId=this._scene.defaultMaterial.id),this.morphTargetManager&&(K.morphTargetManagerId=this.morphTargetManager.uniqueId),this.skeleton&&(K.skeletonId=this.skeleton.id,K.numBoneInfluencers=this.numBoneInfluencers),this.va()._getComponent(M.e.NAME_PHYSICSENGINE)){const b=this.getPhysicsImpostor();b&&(K.physicsMass=b.getParam("mass"),K.physicsFriction=b.getParam("friction"),K.physicsRestitution=b.getParam("mass"),K.physicsImpostor=b.type)}this.metadata&&(K.metadata=this.metadata),K.instances=[];for(let e=0;e<this.instances.length;e++){const b=this.instances[e];if(b.doNotSerialize)continue;const z={name:b.name,id:b.id,isEnabled:b.isEnabled(!1),isVisible:b.isVisible,ub:b.ub,checkCollisions:b.checkCollisions,position:b.position.Ti(),Zd:b.Zd.Ti()};if(b.parent&&b.parent._serializeAsParent(z),b.rotationQuaternion?z.rotationQuaternion=b.rotationQuaternion.Ti():b.rotation&&(z.rotation=b.rotation.Ti()),this.va()._getComponent(M.e.NAME_PHYSICSENGINE)){const K=b.getPhysicsImpostor();K&&(z.physicsMass=K.getParam("mass"),z.physicsFriction=K.getParam("friction"),z.physicsRestitution=K.getParam("mass"),z.physicsImpostor=K.type)}b.metadata&&(z.metadata=b.metadata),b.actionManager&&(z.actions=b.actionManager.serialize(b.name)),K.instances.push(z),Q.e.AppendSerializedAnimations(b,z),z.ranges=b.serializeAnimationRanges()}if(this._thinInstanceDataStorage.instancesCount&&this._thinInstanceDataStorage.matrixData&&(K.thinInstances={instancesCount:this._thinInstanceDataStorage.instancesCount,matrixData:Array.from(this._thinInstanceDataStorage.matrixData),matrixBufferSize:this._thinInstanceDataStorage.matrixBufferSize,enablePicking:this.thinInstanceEnablePicking},this._userThinInstanceBuffersStorage)){const b={data:{},sizes:{},strides:{}};for(const K in this._userThinInstanceBuffersStorage.data)b.data[K]=Array.from(this._userThinInstanceBuffersStorage.data[K]),b.sizes[K]=this._userThinInstanceBuffersStorage.sizes[K],b.strides[K]=this._userThinInstanceBuffersStorage.strides[K];K.thinInstances.userThinInstance=b}return Q.e.AppendSerializedAnimations(this,K),K.ranges=this.serializeAnimationRanges(),K.layerMask=this.layerMask,K.alphaIndex=this.alphaIndex,K.hasVertexAlpha=this.hasVertexAlpha,K.overlayAlpha=this.overlayAlpha,K.overlayColor=this.overlayColor.Ti(),K.renderOverlay=this.renderOverlay,K.applyFog=this.applyFog,this.actionManager&&(K.actions=this.actionManager.serialize(this.name)),K}_syncGeometryWithMorphTargetManager(){if(!this.mj)return;this._markSubMeshesAsAttributesDirty();const K=this._internalAbstractMeshDataInfo._morphTargetManager;if(K&&K.vertexCount){if(K.vertexCount!==this.getTotalVertices())return G.b.Error("Mesh is incompatible with morph targets. Targets and mesh must all have the same vertices count."),void(this.morphTargetManager=null);if(K.isUsingTextureForTargets)return;for(let b=0;b<K.numInfluencers;b++){const e=K.getActiveTarget(b),z=e.getPositions();if(!z)return void G.b.Error("Invalid morph target. Target must have positions.");this.mj.Ga(t.f.PositionKind+b,z,!1,3);const k=e.getNormals();k&&this.mj.Ga(t.f.NormalKind+b,k,!1,3);const j=e.getTangents();j&&this.mj.Ga(t.f.TangentKind+b,j,!1,3);const T=e.getUVs();T&&this.mj.Ga(t.f.UVKind+"_"+b,T,!1,2)}}else{let K=0;for(;this.mj.isVerticesDataPresent(t.f.PositionKind+K);)this.mj.removeVerticesData(t.f.PositionKind+K),this.mj.isVerticesDataPresent(t.f.NormalKind+K)&&this.mj.removeVerticesData(t.f.NormalKind+K),this.mj.isVerticesDataPresent(t.f.TangentKind+K)&&this.mj.removeVerticesData(t.f.TangentKind+K),this.mj.isVerticesDataPresent(t.f.UVKind+K)&&this.mj.removeVerticesData(t.f.UVKind+"_"+K),K++}}static Parse(K,b,e){let z;if(z=K.type&&"LinesMesh"===K.type?R._LinesMeshParser(K,b):K.type&&"GroundMesh"===K.type?R._GroundMeshParser(K,b):K.type&&"GoldbergMesh"===K.type?R._GoldbergMeshParser(K,b):K.type&&"GreasedLineMesh"===K.type?R._GreasedLineMeshParser(K,b):K.type&&"TrailMesh"===K.type?R._TrailMeshParser(K,b):new R(K.name,b),z.id=K.id,z._waitingParsedUniqueId=K.uniqueId,T.d&&T.d.AddTagsTo(z,K.tags),z.position=Y.k.Bg(K.position),void 0!==K.metadata&&(z.metadata=K.metadata),K.rotationQuaternion?z.rotationQuaternion=Y.d.Bg(K.rotationQuaternion):K.rotation&&(z.rotation=Y.k.Bg(K.rotation)),z.Zd=Y.k.Bg(K.Zd),K.localMatrix?z.setPreTransformMatrix(Y.b.Bg(K.localMatrix)):K.pivotMatrix&&z.setPivotMatrix(Y.b.Bg(K.pivotMatrix)),z.yb(K.isEnabled),z.isVisible=K.isVisible,z.infiniteDistance=K.infiniteDistance,z.ob=!!K.ob,z.showBoundingBox=K.showBoundingBox,z.showSubMeshesBoundingBox=K.showSubMeshesBoundingBox,void 0!==K.applyFog&&(z.applyFog=K.applyFog),void 0!==K.pickable&&(z.ub=K.pickable),void 0!==K.alphaIndex&&(z.alphaIndex=K.alphaIndex),z.receiveShadows=K.receiveShadows,void 0!==K.billboardMode&&(z.billboardMode=K.billboardMode),void 0!==K.visibility&&(z.visibility=K.visibility),z.checkCollisions=K.checkCollisions,z.Da=!!K.Da,K.ellipsoid&&(z.ellipsoid=Y.k.Bg(K.ellipsoid)),K.ellipsoidOffset&&(z.ellipsoidOffset=Y.k.Bg(K.ellipsoidOffset)),null!=K.overrideMaterialSideOrientation&&(z.sideOrientation=K.overrideMaterialSideOrientation),void 0!==K.sideOrientation&&(z.sideOrientation=K.sideOrientation),void 0!==K.isBlocker&&(z.isBlocker=K.isBlocker),z._shouldGenerateFlatShading=K.useFlatShading,K.uc&&(z._waitingData.uc=K.uc),void 0!==K.parentId&&(z._waitingParentId=K.parentId),void 0!==K.parentInstanceIndex&&(z._waitingParentInstanceIndex=K.parentInstanceIndex),void 0!==K.actions&&(z._waitingData.actions=K.actions),void 0!==K.overlayAlpha&&(z.overlayAlpha=K.overlayAlpha),void 0!==K.overlayColor&&(z.overlayColor=A.c.Bg(K.overlayColor)),void 0!==K.renderOverlay&&(z.renderOverlay=K.renderOverlay),z.isUnIndexed=!!K.isUnIndexed,z.hasVertexAlpha=K.hasVertexAlpha,K.delayLoadingFile?(z.delayLoadState=4,z.delayLoadingFile=e+K.delayLoadingFile,z.buildBoundingInfo(Y.k.Bg(K.boundingBoxMinimum),Y.k.Bg(K.boundingBoxMaximum)),K._binaryInfo&&(z._binaryInfo=K._binaryInfo),z._delayInfo=[],K.hasUVs&&z._delayInfo.push(t.f.UVKind),K.hasUVs2&&z._delayInfo.push(t.f.UV2Kind),K.hasUVs3&&z._delayInfo.push(t.f.UV3Kind),K.hasUVs4&&z._delayInfo.push(t.f.UV4Kind),K.hasUVs5&&z._delayInfo.push(t.f.UV5Kind),K.hasUVs6&&z._delayInfo.push(t.f.UV6Kind),K.hasColors&&z._delayInfo.push(t.f.ColorKind),K.hasMatricesIndices&&z._delayInfo.push(t.f.MatricesIndicesKind),K.hasMatricesWeights&&z._delayInfo.push(t.f.MatricesWeightsKind),z._delayLoadingFunction=B.c._ImportGeometry,x.b.ForceFullSceneLoadingForIncremental&&z._checkDelayState()):B.c._ImportGeometry(K,z),K.materialUniqueId?z._waitingMaterialId=K.materialUniqueId:K.materialId&&(z._waitingMaterialId=K.materialId),K.morphTargetManagerId>-1&&(z._waitingMorphTargetManagerId=K.morphTargetManagerId),void 0!==K.skeletonId&&null!==K.skeletonId&&(z.skeleton=b.getLastSkeletonById(K.skeletonId),K.numBoneInfluencers&&(z.numBoneInfluencers=K.numBoneInfluencers)),K.animations){for(let b=0;b<K.animations.length;b++){const e=K.animations[b],k=(0,i.d)("BABYLON.Animation");k&&z.animations.push(k.Parse(e))}X.e.ParseAnimationRanges(z,K,b)}if(K.autoAnimate&&b.beginAnimation(z,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),K.layerMask&&!isNaN(K.layerMask)?z.layerMask=Math.abs(parseInt(K.layerMask)):z.layerMask=268435455,K.physicsImpostor&&(z.physicsImpostor=R._PhysicsImpostorParser(b,z,K)),K.lodMeshIds&&(z._waitingData.lods={ids:K.lodMeshIds,distances:K.lodDistances?K.lodDistances:null,coverages:K.lodCoverages?K.lodCoverages:null}),K.instances)for(let k=0;k<K.instances.length;k++){const e=K.instances[k],j=z.createInstance(e.name);if(e.id&&(j.id=e.id),T.d&&(e.tags?T.d.AddTagsTo(j,e.tags):T.d.AddTagsTo(j,K.tags)),j.position=Y.k.Bg(e.position),void 0!==e.metadata&&(j.metadata=e.metadata),void 0!==e.parentId&&(j._waitingParentId=e.parentId),void 0!==e.parentInstanceIndex&&(j._waitingParentInstanceIndex=e.parentInstanceIndex),void 0!==e.isEnabled&&null!==e.isEnabled&&j.yb(e.isEnabled),void 0!==e.isVisible&&null!==e.isVisible&&(j.isVisible=e.isVisible),void 0!==e.ub&&null!==e.ub&&(j.ub=e.ub),e.rotationQuaternion?j.rotationQuaternion=Y.d.Bg(e.rotationQuaternion):e.rotation&&(j.rotation=Y.k.Bg(e.rotation)),j.Zd=Y.k.Bg(e.Zd),void 0!=e.checkCollisions&&null!=e.checkCollisions&&(j.checkCollisions=e.checkCollisions),void 0!=e.pickable&&null!=e.pickable&&(j.ub=e.pickable),void 0!=e.showBoundingBox&&null!=e.showBoundingBox&&(j.showBoundingBox=e.showBoundingBox),void 0!=e.showSubMeshesBoundingBox&&null!=e.showSubMeshesBoundingBox&&(j.showSubMeshesBoundingBox=e.showSubMeshesBoundingBox),void 0!=e.alphaIndex&&null!=e.showSubMeshesBoundingBox&&(j.alphaIndex=e.alphaIndex),e.physicsImpostor&&(j.physicsImpostor=R._PhysicsImpostorParser(b,j,e)),void 0!==e.actions&&(j._waitingData.actions=e.actions),e.animations){for(let K=0;K<e.animations.length;K++){const b=e.animations[K],z=(0,i.d)("BABYLON.Animation");z&&j.animations.push(z.Parse(b))}X.e.ParseAnimationRanges(j,e,b),e.autoAnimate&&b.beginAnimation(j,e.autoAnimateFrom,e.autoAnimateTo,e.autoAnimateLoop,e.autoAnimateSpeed||1)}}if(K.thinInstances){const b=K.thinInstances;if(z.thinInstanceEnablePicking=!!b.enablePicking,b.matrixData?(z.Nb("matrix",new Float32Array(b.matrixData),16,!1),z._thinInstanceDataStorage.matrixBufferSize=b.matrixBufferSize,z._thinInstanceDataStorage.instancesCount=b.instancesCount):z._thinInstanceDataStorage.matrixBufferSize=b.matrixBufferSize,K.thinInstances.userThinInstance){const b=K.thinInstances.userThinInstance;for(const K in b.data)z.Nb(K,new Float32Array(b.data[K]),b.strides[K],!1),z._userThinInstanceBuffersStorage.sizes[K]=b.sizes[K]}}return z}setPositionsForCPUSkinning(){const K=this._internalMeshDataInfo;if(!K._sourcePositions){const b=this.getVerticesData(t.f.PositionKind);if(!b)return K._sourcePositions;K._sourcePositions=new Float32Array(b),this.isVertexBufferUpdatable(t.f.PositionKind)||this.Ga(t.f.PositionKind,b,!0)}return K._sourcePositions}setNormalsForCPUSkinning(){const K=this._internalMeshDataInfo;if(!K._sourceNormals){const b=this.getVerticesData(t.f.NormalKind);if(!b)return K._sourceNormals;K._sourceNormals=new Float32Array(b),this.isVertexBufferUpdatable(t.f.NormalKind)||this.Ga(t.f.NormalKind,b,!0)}return K._sourceNormals}applySkeleton(K){if(!this.mj)return this;if(this.mj._softwareSkinningFrameId==this.va().getFrameId())return this;if(this.mj._softwareSkinningFrameId=this.va().getFrameId(),!this.isVerticesDataPresent(t.f.PositionKind))return this;if(!this.isVerticesDataPresent(t.f.MatricesIndicesKind))return this;if(!this.isVerticesDataPresent(t.f.MatricesWeightsKind))return this;const b=this.isVerticesDataPresent(t.f.NormalKind),e=this._internalMeshDataInfo;if(!e._sourcePositions){const K=this.Rf.slice();this.setPositionsForCPUSkinning(),this.Rf=K}b&&!e._sourceNormals&&this.setNormalsForCPUSkinning();let z=this.getVerticesData(t.f.PositionKind);if(!z)return this;z instanceof Float32Array||(z=new Float32Array(z));let k=this.getVerticesData(t.f.NormalKind);if(b){if(!k)return this;k instanceof Float32Array||(k=new Float32Array(k))}const j=this.getVerticesData(t.f.MatricesIndicesKind),T=this.getVerticesData(t.f.MatricesWeightsKind);if(!T||!j)return this;const F=this.numBoneInfluencers>4,l=F?this.getVerticesData(t.f.MatricesIndicesExtraKind):null,A=F?this.getVerticesData(t.f.MatricesWeightsExtraKind):null,X=K.getTransformMatrices(this),U=Y.k.Zero(),B=new Y.b,u=new Y.b;let m,D=0;for(let t=0;t<z.length;t+=3,D+=4){let K;for(m=0;m<4;m++)K=T[D+m],K>0&&(Y.b.FromFloat32ArrayToRefScaled(X,Math.floor(16*j[D+m]),K,u),B.addToSelf(u));if(F)for(m=0;m<4;m++)K=A[D+m],K>0&&(Y.b.FromFloat32ArrayToRefScaled(X,Math.floor(16*l[D+m]),K,u),B.addToSelf(u));Y.k.TransformCoordinatesFromFloatsToRef(e._sourcePositions[t],e._sourcePositions[t+1],e._sourcePositions[t+2],B,U),U.toArray(z,t),b&&(Y.k.TransformNormalFromFloatsToRef(e._sourceNormals[t],e._sourceNormals[t+1],e._sourceNormals[t+2],B,U),U.toArray(k,t)),B.reset()}return this.updateVerticesData(t.f.PositionKind,z),b&&this.updateVerticesData(t.f.NormalKind,k),this}static MinMax(K){let b=null,e=null;return K.forEach((function(K){const z=K.getBoundingInfo().boundingBox;b&&e?(b.minimizeInPlace(z.minimumWorld),e.maximizeInPlace(z.maximumWorld)):(b=z.minimumWorld,e=z.maximumWorld)})),b&&e?{min:b,max:e}:{min:Y.k.Zero(),max:Y.k.Zero()}}static Center(K){const b=K instanceof Array?R.MinMax(K):K;return Y.k.Center(b.min,b.max)}static MergeMeshes(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0;return(0,F.j)(R._MergeMeshesCoroutine(K,b,e,z,k,j,!1))}static MergeMeshesAsync(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0;return(0,F.h)(R._MergeMeshesCoroutine(K,b,e,z,k,j,!0),(0,F.b)())}static*_MergeMeshesCoroutine(K){let b,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],z=arguments.length>2?arguments[2]:void 0,k=arguments.length>3?arguments[3]:void 0,j=arguments.length>4?arguments[4]:void 0,T=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0;if(0===(K=K.filter(Boolean)).length)return null;if(!z){let e=0;for(b=0;b<K.length;b++)if(e+=K[b].getTotalVertices(),e>=65536)return G.b.Warn("Cannot merge meshes because resulting mesh will have more than 65536 vertices. Please use allow32BitsIndices = true to use 32 bits indices"),null}T&&(j=!1);const l=new Array,Y=new Array,A=new Array,X=K[0].sideOrientation;for(b=0;b<K.length;b++){const e=K[b];if(e.isAnInstance)return G.b.Warn("Cannot merge instance meshes."),null;if(X!==e.sideOrientation)return G.b.Warn("Cannot merge meshes with different sideOrientation values."),null;if(j&&A.push(e.getTotalIndices()),T)if(e.material){const K=e.material;if(K instanceof I.b){for(let b=0;b<K.Tf.length;b++)l.indexOf(K.Tf[b])<0&&l.push(K.Tf[b]);for(let b=0;b<e.Rf.length;b++)Y.push(l.indexOf(K.Tf[e.Rf[b].materialIndex])),A.push(e.Rf[b].indexCount)}else{l.indexOf(K)<0&&l.push(K);for(let b=0;b<e.Rf.length;b++)Y.push(l.indexOf(K)),A.push(e.Rf[b].indexCount)}}else for(let K=0;K<e.Rf.length;K++)Y.push(0),A.push(e.Rf[K].indexCount)}const t=K[0],B=K=>{const b=K.xj(!0);return{vertexData:U.e.ExtractFromMesh(K,!1,!1),transform:b}},{vertexData:u,transform:D}=B(t);F&&(yield);const x=new Array(K.length-1);for(let U=1;U<K.length;U++)x[U-1]=B(K[U]),F&&(yield);const Q=u._mergeCoroutine(D,x,z,F,!e);let i=Q.next();for(;!i.done;)F&&(yield),i=Q.next();const S=i.value;k||(k=new R(t.name+"_merged",t.va()));const M=S._applyToCoroutine(k,void 0,F);let r=M.next();for(;!r.done;)F&&(yield),r=M.next();if(k.checkCollisions=t.checkCollisions,k.sideOrientation=t.sideOrientation,e)for(b=0;b<K.length;b++)K[b].dispose();if(j||T){k.releaseSubMeshes(),b=0;let K=0;for(;b<A.length;)m.e.CreateFromIndices(0,K,A[b],k,void 0,!1),K+=A[b],b++;for(const b of k.Rf)b.refreshBoundingInfo();k.xj(!0)}if(T){const K=new I.b(t.name+"_merged",t.va());K.Tf=l;for(let b=0;b<k.Rf.length;b++)k.Rf[b].materialIndex=Y[b];k.material=K}else k.material=t.material;return k}pj(K){K._indexInSourceMeshInstanceArray=this.instances.length,this.instances.push(K)}oj(K){const b=K._indexInSourceMeshInstanceArray;if(-1!=b){if(b!==this.instances.length-1){const K=this.instances[this.instances.length-1];this.instances[b]=K,K._indexInSourceMeshInstanceArray=b}K._indexInSourceMeshInstanceArray=-1,this.instances.pop()}}_shouldConvertRHS(){return this._scene.useRightHandedSystem&&this.sideOrientation===D.b.CounterClockWiseSideOrientation}_getRenderingFillMode(K){const b=this.va();return b.forcePointsCloud?D.b.PointFillMode:b.forceWireframe?D.b.WireFrameFillMode:this.overrideRenderingFillMode??K}setMaterialByID(K){return this.setMaterialById(K)}static CreateRibbon(K,b,e,z,k,j,T,F,l){throw new Error("Import MeshBuilder to populate this function")}static CreateDisc(K,b,e,z,k,j){throw new Error("Import MeshBuilder to populate this function")}static CreateBox(K,b,e,z,k){throw new Error("Import MeshBuilder to populate this function")}static CreateSphere(K,b,e,z,k,j){throw new Error("Import MeshBuilder to populate this function")}static CreateHemisphere(K,b,e,z){throw new Error("Import MeshBuilder to populate this function")}static CreateCylinder(K,b,e,z,k,j,T,F,l){throw new Error("Import MeshBuilder to populate this function")}static CreateTorus(K,b,e,z,k,j,T){throw new Error("Import MeshBuilder to populate this function")}static CreateTorusKnot(K,b,e,z,k,j,T,F,l,Y){throw new Error("Import MeshBuilder to populate this function")}static rb(K,b,e,z,k){throw new Error("Import MeshBuilder to populate this function")}static CreateDashedLines(K,b,e,z,k,j,T,F){throw new Error("Import MeshBuilder to populate this function")}static CreatePolygon(K,b,e,z,k,j,T){throw new Error("Import MeshBuilder to populate this function")}static ExtrudePolygon(K,b,e,z,k,j,T,F){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShape(K,b,e,z,k,j,T,F,l,Y){throw new Error("Import MeshBuilder to populate this function")}static ExtrudeShapeCustom(K,b,e,z,k,j,T,F,l,Y,A,X){throw new Error("Import MeshBuilder to populate this function")}static CreateLathe(K,b,e,z,k,j,T){throw new Error("Import MeshBuilder to populate this function")}static Vf(K,b,e,z,k){throw new Error("Import MeshBuilder to populate this function")}static CreateGround(K,b,e,z,k,j){throw new Error("Import MeshBuilder to populate this function")}static CreateTiledGround(K,b,e,z,k,j,T,F,l){throw new Error("Import MeshBuilder to populate this function")}static CreateGroundFromHeightMap(K,b,e,z,k,j,T,F,l,Y,A){throw new Error("Import MeshBuilder to populate this function")}static CreateTube(K,b,e,z,k,j,T,F,l,Y){throw new Error("Import MeshBuilder to populate this function")}static CreatePolyhedron(K,b,e){throw new Error("Import MeshBuilder to populate this function")}static CreateIcoSphere(K,b,e){throw new Error("Import MeshBuilder to populate this function")}static CreateDecal(K,b,e,z,k,j){throw new Error("Import MeshBuilder to populate this function")}static CreateCapsule(K,b,e){throw new Error("Import MeshBuilder to populate this function")}static ExtendToGoldberg(K){throw new Error("Import MeshBuilder to populate this function")}}R.FRONTSIDE=U.e.FRONTSIDE,R.BACKSIDE=U.e.BACKSIDE,R.DOUBLESIDE=U.e.DOUBLESIDE,R.DEFAULTSIDE=U.e.DEFAULTSIDE,R.NO_CAP=0,R.CAP_START=1,R.CAP_END=2,R.CAP_ALL=3,R.NO_FLIP=0,R.FLIP_TILE=1,R.ROTATE_TILE=2,R.FLIP_ROW=3,R.ROTATE_ROW=4,R.FLIP_N_ROTATE_TILE=5,R.FLIP_N_ROTATE_ROW=6,R.CENTER=0,R.LEFT=1,R.RIGHT=2,R.TOP=3,R.BOTTOM=4,R.INSTANCEDMESH_SORT_TRANSPARENT=!1,R._GroundMeshParser=(K,b)=>{throw(0,S.c)("GroundMesh")},R._GoldbergMeshParser=(K,b)=>{throw(0,S.c)("GoldbergMesh")},R._LinesMeshParser=(K,b)=>{throw(0,S.c)("LinesMesh")},R._GreasedLineMeshParser=(K,b)=>{throw(0,S.c)("GreasedLineMesh")},R._GreasedLineRibbonMeshParser=(K,b)=>{throw(0,S.c)("GreasedLineRibbonMesh")},R._TrailMeshParser=(K,b)=>{throw(0,S.c)("TrailMesh")},(0,i.e)("BABYLON.Mesh",R)},11261:(K,b,e)=>{"use strict";e.d(b,{e:()=>B});var z=e(10936),k=e(10967),j=e(11030),T=e(10710),F=e(10994),l=e(10696),Y=e(10938),A=e(11233),X=e(10728),t=e(11089);class U{}class B{constructor(){this.uniqueId=0,this.metadata={},this._applyTo=(0,A.d)(this._applyToCoroutine.bind(this)),this.uniqueId=B._UniqueIDGenerator,B._UniqueIDGenerator++}set(K,b){switch(K.length||l.b.Warn(`Setting vertex data kind '${b}' with an empty array`),b){case j.f.PositionKind:this.xa=K;break;case j.f.NormalKind:this.ya=K;break;case j.f.TangentKind:this.tangents=K;break;case j.f.UVKind:this.Aa=K;break;case j.f.UV2Kind:this.uvs2=K;break;case j.f.UV3Kind:this.uvs3=K;break;case j.f.UV4Kind:this.uvs4=K;break;case j.f.UV5Kind:this.uvs5=K;break;case j.f.UV6Kind:this.uvs6=K;break;case j.f.ColorKind:this.za=K;break;case j.f.MatricesIndicesKind:this.matricesIndices=K;break;case j.f.MatricesWeightsKind:this.matricesWeights=K;break;case j.f.MatricesIndicesExtraKind:this.matricesIndicesExtra=K;break;case j.f.MatricesWeightsExtraKind:this.matricesWeightsExtra=K}}Ca(K,b){return this._applyTo(K,b,!1),this}applyToGeometry(K,b){return this._applyTo(K,b,!1),this}updateMesh(K){return this._update(K),this}updateGeometry(K){return this._update(K),this}*_applyToCoroutine(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;if(this.xa&&(K.Ga(j.f.PositionKind,this.xa,b),e&&(yield)),this.ya&&(K.Ga(j.f.NormalKind,this.ya,b),e&&(yield)),this.tangents&&(K.Ga(j.f.TangentKind,this.tangents,b),e&&(yield)),this.Aa&&(K.Ga(j.f.UVKind,this.Aa,b),e&&(yield)),this.uvs2&&(K.Ga(j.f.UV2Kind,this.uvs2,b),e&&(yield)),this.uvs3&&(K.Ga(j.f.UV3Kind,this.uvs3,b),e&&(yield)),this.uvs4&&(K.Ga(j.f.UV4Kind,this.uvs4,b),e&&(yield)),this.uvs5&&(K.Ga(j.f.UV5Kind,this.uvs5,b),e&&(yield)),this.uvs6&&(K.Ga(j.f.UV6Kind,this.uvs6,b),e&&(yield)),this.za&&(K.Ga(j.f.ColorKind,this.za,b),this.hasVertexAlpha&&void 0!==K.hasVertexAlpha&&(K.hasVertexAlpha=!0),e&&(yield)),this.matricesIndices&&(K.Ga(j.f.MatricesIndicesKind,this.matricesIndices,b),e&&(yield)),this.matricesWeights&&(K.Ga(j.f.MatricesWeightsKind,this.matricesWeights,b),e&&(yield)),this.matricesIndicesExtra&&(K.Ga(j.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,b),e&&(yield)),this.matricesWeightsExtra&&(K.Ga(j.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,b),e&&(yield)),this.indices?(K.setIndices(this.indices,null,b),e&&(yield)):K.setIndices([],null),K.Rf&&this.materialInfos&&this.materialInfos.length>1){const b=K;b.Rf=[];for(const K of this.materialInfos)new t.e(K.materialIndex,K.verticesStart,K.verticesCount,K.indexStart,K.indexCount,b)}return this}_update(K,b,e){return this.xa&&K.updateVerticesData(j.f.PositionKind,this.xa,b,e),this.ya&&K.updateVerticesData(j.f.NormalKind,this.ya,b,e),this.tangents&&K.updateVerticesData(j.f.TangentKind,this.tangents,b,e),this.Aa&&K.updateVerticesData(j.f.UVKind,this.Aa,b,e),this.uvs2&&K.updateVerticesData(j.f.UV2Kind,this.uvs2,b,e),this.uvs3&&K.updateVerticesData(j.f.UV3Kind,this.uvs3,b,e),this.uvs4&&K.updateVerticesData(j.f.UV4Kind,this.uvs4,b,e),this.uvs5&&K.updateVerticesData(j.f.UV5Kind,this.uvs5,b,e),this.uvs6&&K.updateVerticesData(j.f.UV6Kind,this.uvs6,b,e),this.za&&K.updateVerticesData(j.f.ColorKind,this.za,b,e),this.matricesIndices&&K.updateVerticesData(j.f.MatricesIndicesKind,this.matricesIndices,b,e),this.matricesWeights&&K.updateVerticesData(j.f.MatricesWeightsKind,this.matricesWeights,b,e),this.matricesIndicesExtra&&K.updateVerticesData(j.f.MatricesIndicesExtraKind,this.matricesIndicesExtra,b,e),this.matricesWeightsExtra&&K.updateVerticesData(j.f.MatricesWeightsExtraKind,this.matricesWeightsExtra,b,e),this.indices&&K.setIndices(this.indices,null),this}static _TransformVector3Coordinates(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.length;const j=k.e.gb[0],T=k.e.gb[1];for(let F=e;F<e+z;F+=3)k.k.FromArrayToRef(K,F,j),k.k.TransformCoordinatesToRef(j,b,T),K[F]=T.x,K[F+1]=T.y,K[F+2]=T.z}static _TransformVector3Normals(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.length;const j=k.e.gb[0],T=k.e.gb[1];for(let F=e;F<e+z;F+=3)k.k.FromArrayToRef(K,F,j),k.k.TransformNormalToRef(j,b,T),K[F]=T.x,K[F+1]=T.y,K[F+2]=T.z}static _TransformVector4Normals(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:K.length;const j=k.e.Vector4[0],T=k.e.Vector4[1];for(let F=e;F<e+z;F+=4)k.o.FromArrayToRef(K,F,j),k.o.TransformNormalToRef(j,b,T),K[F]=T.x,K[F+1]=T.y,K[F+2]=T.z,K[F+3]=T.w}static _FlipFaces(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:K.length;for(let z=b;z<b+e;z+=3){const b=K[z+1];K[z+1]=K[z+2],K[z+2]=b}}transform(K){const b=K.determinant()<0;return this.xa&&B._TransformVector3Coordinates(this.xa,K),this.ya&&B._TransformVector3Normals(this.ya,K),this.tangents&&B._TransformVector4Normals(this.tangents,K),b&&this.indices&&B._FlipFaces(this.indices),this}splitBasedOnMaterialID(){if(!this.materialInfos||this.materialInfos.length<2)return[this];const K=[];for(const b of this.materialInfos){const e=new B;if(this.xa&&(e.xa=this.xa.slice(3*b.verticesStart,3*(b.verticesCount+b.verticesStart))),this.ya&&(e.ya=this.ya.slice(3*b.verticesStart,3*(b.verticesCount+b.verticesStart))),this.tangents&&(e.tangents=this.tangents.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.za&&(e.za=this.za.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.Aa&&(e.Aa=this.Aa.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs2&&(e.uvs2=this.uvs2.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs3&&(e.uvs3=this.uvs3.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs4&&(e.uvs4=this.uvs4.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs5&&(e.uvs5=this.uvs5.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.uvs6&&(e.uvs6=this.uvs6.slice(2*b.verticesStart,2*(b.verticesCount+b.verticesStart))),this.matricesIndices&&(e.matricesIndices=this.matricesIndices.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesIndicesExtra&&(e.matricesIndicesExtra=this.matricesIndicesExtra.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesWeights&&(e.matricesWeights=this.matricesWeights.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.matricesWeightsExtra&&(e.matricesWeightsExtra=this.matricesWeightsExtra.slice(4*b.verticesStart,4*(b.verticesCount+b.verticesStart))),this.indices){e.indices=[];for(let K=b.indexStart;K<b.indexStart+b.indexCount;K++)e.indices.push(this.indices[K]-b.verticesStart)}const z=new U;z.indexStart=0,z.indexCount=e.indices?e.indices.length:0,z.materialIndex=b.materialIndex,z.verticesStart=0,z.verticesCount=(e.xa?e.xa.length:0)/3,e.materialInfos=[z],K.push(e)}return K}merge(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const j=Array.isArray(K)?K.map((K=>({vertexData:K}))):[{vertexData:K}];return(0,A.j)(this._mergeCoroutine(void 0,j,b,!1,e,z,k))}*_mergeCoroutine(K,b){var e,z;let k=arguments.length>2&&void 0!==arguments[2]&&arguments[2],T=arguments.length>3?arguments[3]:void 0,F=arguments.length>4?arguments[4]:void 0,l=arguments.length>5&&void 0!==arguments[5]&&arguments[5],Y=arguments.length>6&&void 0!==arguments[6]&&arguments[6];this._validate();let A=b.map((K=>K.vertexData)),X=this;if(Y)for(const j of A)j&&(j._validate(),!this.ya&&j.ya&&(this.ya=new Float32Array(this.xa.length)),!this.tangents&&j.tangents&&(this.tangents=new Float32Array(this.xa.length/3*4)),!this.Aa&&j.Aa&&(this.Aa=new Float32Array(this.xa.length/3*2)),!this.uvs2&&j.uvs2&&(this.uvs2=new Float32Array(this.xa.length/3*2)),!this.uvs3&&j.uvs3&&(this.uvs3=new Float32Array(this.xa.length/3*2)),!this.uvs4&&j.uvs4&&(this.uvs4=new Float32Array(this.xa.length/3*2)),!this.uvs5&&j.uvs5&&(this.uvs5=new Float32Array(this.xa.length/3*2)),!this.uvs6&&j.uvs6&&(this.uvs6=new Float32Array(this.xa.length/3*2)),!this.za&&j.za&&(this.za=new Float32Array(this.xa.length/3*4),this.za.fill(1)),!this.matricesIndices&&j.matricesIndices&&(this.matricesIndices=new Float32Array(this.xa.length/3*4)),!this.matricesWeights&&j.matricesWeights&&(this.matricesWeights=new Float32Array(this.xa.length/3*4)),!this.matricesIndicesExtra&&j.matricesIndicesExtra&&(this.matricesIndicesExtra=new Float32Array(this.xa.length/3*4)),!this.matricesWeightsExtra&&j.matricesWeightsExtra&&(this.matricesWeightsExtra=new Float32Array(this.xa.length/3*4)));for(const j of A)if(j)if(Y)this.ya&&!j.ya&&(j.ya=new Float32Array(j.xa.length)),this.tangents&&!j.tangents&&(j.tangents=new Float32Array(j.xa.length/3*4)),this.Aa&&!j.Aa&&(j.Aa=new Float32Array(j.xa.length/3*2)),this.uvs2&&!j.uvs2&&(j.uvs2=new Float32Array(j.xa.length/3*2)),this.uvs3&&!j.uvs3&&(j.uvs3=new Float32Array(j.xa.length/3*2)),this.uvs4&&!j.uvs4&&(j.uvs4=new Float32Array(j.xa.length/3*2)),this.uvs5&&!j.uvs5&&(j.uvs5=new Float32Array(j.xa.length/3*2)),this.uvs6&&!j.uvs6&&(j.uvs6=new Float32Array(j.xa.length/3*2)),this.za&&!j.za&&(j.za=new Float32Array(j.xa.length/3*4),j.za.fill(1)),this.matricesIndices&&!j.matricesIndices&&(j.matricesIndices=new Float32Array(j.xa.length/3*4)),this.matricesWeights&&!j.matricesWeights&&(j.matricesWeights=new Float32Array(j.xa.length/3*4)),this.matricesIndicesExtra&&!j.matricesIndicesExtra&&(j.matricesIndicesExtra=new Float32Array(j.xa.length/3*4)),this.matricesWeightsExtra&&!j.matricesWeightsExtra&&(j.matricesWeightsExtra=new Float32Array(j.xa.length/3*4));else if(j._validate(),!this.ya!==!j.ya||!this.tangents!==!j.tangents||!this.Aa!==!j.Aa||!this.uvs2!==!j.uvs2||!this.uvs3!==!j.uvs3||!this.uvs4!==!j.uvs4||!this.uvs5!==!j.uvs5||!this.uvs6!==!j.uvs6||!this.za!==!j.za||!this.matricesIndices!==!j.matricesIndices||!this.matricesWeights!==!j.matricesWeights||!this.matricesIndicesExtra!==!j.matricesIndicesExtra||!this.matricesWeightsExtra!==!j.matricesWeightsExtra)throw new Error("Cannot merge vertex data that do not have the same set of attributes");if(l){let e=0,z=0,k=0;const j=[];let T=null;const F=[];for(const b of this.splitBasedOnMaterialID())F.push({vertexData:b,transform:K});for(const K of b)if(K.vertexData)for(const b of K.vertexData.splitBasedOnMaterialID())F.push({vertexData:b,transform:K.transform});F.sort(((K,b)=>{const e=K.vertexData.materialInfos?K.vertexData.materialInfos[0].materialIndex:0,z=b.vertexData.materialInfos?b.vertexData.materialInfos[0].materialIndex:0;return e>z?1:e===z?0:-1}));for(const K of F){const b=K.vertexData;if(e=b.materialInfos?b.materialInfos[0].materialIndex:0,T&&T.materialIndex===e)T.indexCount+=b.indices.length,T.verticesCount+=b.xa.length/3;else{const K=new U;K.materialIndex=e,K.indexStart=z,K.indexCount=b.indices.length,K.verticesStart=k,K.verticesCount=b.xa.length/3,j.push(K),T=K}z+=b.indices.length,k+=b.xa.length/3}const l=F.splice(0,1)[0];X=l.vertexData,K=l.transform,A=F.map((K=>K.vertexData)),b=F,this.materialInfos=j}const t=A.reduce(((K,b)=>{var e;return K+((null===(e=b.indices)||void 0===e?void 0:e.length)??0)}),(null===(e=X.indices)||void 0===e?void 0:e.length)??0);let u=F||A.some((K=>K.indices===X.indices))?null===(z=X.indices)||void 0===z?void 0:z.slice():X.indices;if(t>0){var m;let e=(null===(m=u)||void 0===m?void 0:m.length)??0;if(u||(u=new Array(t)),u.length!==t){if(Array.isArray(u))u.length=t;else{const K=k||u instanceof Uint32Array?new Uint32Array(t):new Uint16Array(t);K.set(u),u=K}K&&K.determinant()<0&&B._FlipFaces(u,0,e)}let z=X.xa?X.xa.length/3:0;for(const{vertexData:K,transform:k}of b)if(K.indices){for(let b=0;b<K.indices.length;b++)u[e+b]=K.indices[b]+z;k&&k.determinant()<0&&B._FlipFaces(u,e,K.indices.length),z+=K.xa.length/3,e+=K.indices.length,T&&(yield)}}return this.indices=u,this.xa=B._MergeElement(j.f.PositionKind,X.xa,K,b.map((K=>[K.vertexData.xa,K.transform]))),T&&(yield),X.ya&&(this.ya=B._MergeElement(j.f.NormalKind,X.ya,K,b.map((K=>[K.vertexData.ya,K.transform]))),T&&(yield)),X.tangents&&(this.tangents=B._MergeElement(j.f.TangentKind,X.tangents,K,b.map((K=>[K.vertexData.tangents,K.transform]))),T&&(yield)),X.Aa&&(this.Aa=B._MergeElement(j.f.UVKind,X.Aa,K,b.map((K=>[K.vertexData.Aa,K.transform]))),T&&(yield)),X.uvs2&&(this.uvs2=B._MergeElement(j.f.UV2Kind,X.uvs2,K,b.map((K=>[K.vertexData.uvs2,K.transform]))),T&&(yield)),X.uvs3&&(this.uvs3=B._MergeElement(j.f.UV3Kind,X.uvs3,K,b.map((K=>[K.vertexData.uvs3,K.transform]))),T&&(yield)),X.uvs4&&(this.uvs4=B._MergeElement(j.f.UV4Kind,X.uvs4,K,b.map((K=>[K.vertexData.uvs4,K.transform]))),T&&(yield)),X.uvs5&&(this.uvs5=B._MergeElement(j.f.UV5Kind,X.uvs5,K,b.map((K=>[K.vertexData.uvs5,K.transform]))),T&&(yield)),X.uvs6&&(this.uvs6=B._MergeElement(j.f.UV6Kind,X.uvs6,K,b.map((K=>[K.vertexData.uvs6,K.transform]))),T&&(yield)),X.za&&(this.za=B._MergeElement(j.f.ColorKind,X.za,K,b.map((K=>[K.vertexData.za,K.transform]))),(void 0!==X.hasVertexAlpha||b.some((K=>void 0!==K.vertexData.hasVertexAlpha)))&&(this.hasVertexAlpha=X.hasVertexAlpha||b.some((K=>K.vertexData.hasVertexAlpha))),T&&(yield)),X.matricesIndices&&(this.matricesIndices=B._MergeElement(j.f.MatricesIndicesKind,X.matricesIndices,K,b.map((K=>[K.vertexData.matricesIndices,K.transform]))),T&&(yield)),X.matricesWeights&&(this.matricesWeights=B._MergeElement(j.f.MatricesWeightsKind,X.matricesWeights,K,b.map((K=>[K.vertexData.matricesWeights,K.transform]))),T&&(yield)),X.matricesIndicesExtra&&(this.matricesIndicesExtra=B._MergeElement(j.f.MatricesIndicesExtraKind,X.matricesIndicesExtra,K,b.map((K=>[K.vertexData.matricesIndicesExtra,K.transform]))),T&&(yield)),X.matricesWeightsExtra&&(this.matricesWeightsExtra=B._MergeElement(j.f.MatricesWeightsExtraKind,X.matricesWeightsExtra,K,b.map((K=>[K.vertexData.matricesWeightsExtra,K.transform])))),this}static _MergeElement(K,b,e,z){const k=z.filter((K=>null!==K[0]&&void 0!==K[0]));if(!b&&0==k.length)return b;if(!b)return this._MergeElement(K,k[0][0],k[0][1],k.slice(1));const T=k.reduce(((K,b)=>K+b[0].length),b.length),F=K===j.f.PositionKind?B._TransformVector3Coordinates:K===j.f.NormalKind?B._TransformVector3Normals:K===j.f.TangentKind?B._TransformVector4Normals:()=>{};if(b instanceof Float32Array){const K=new Float32Array(T);K.set(b),e&&F(K,e,0,b.length);let z=b.length;for(const[b,e]of k)K.set(b,z),e&&F(K,e,z,b.length),z+=b.length;return K}{const K=new Array(T);for(let e=0;e<b.length;e++)K[e]=b[e];e&&F(K,e,0,b.length);let z=b.length;for(const[b,e]of k){for(let e=0;e<b.length;e++)K[z+e]=b[e];e&&F(K,e,z,b.length),z+=b.length}return K}}_validate(){if(!this.xa)throw new X.h("Positions are required",X.d.MeshInvalidPositionsError);const K=(K,b)=>{const e=j.f.DeduceStride(K);if(b.length%e!==0)throw new Error("The "+K+"s array count must be a multiple of "+e);return b.length/e},b=K(j.f.PositionKind,this.xa),e=(e,z)=>{const k=K(e,z);if(k!==b)throw new Error("The "+e+"s element count ("+k+") does not match the positions count ("+b+")")};this.ya&&e(j.f.NormalKind,this.ya),this.tangents&&e(j.f.TangentKind,this.tangents),this.Aa&&e(j.f.UVKind,this.Aa),this.uvs2&&e(j.f.UV2Kind,this.uvs2),this.uvs3&&e(j.f.UV3Kind,this.uvs3),this.uvs4&&e(j.f.UV4Kind,this.uvs4),this.uvs5&&e(j.f.UV5Kind,this.uvs5),this.uvs6&&e(j.f.UV6Kind,this.uvs6),this.za&&e(j.f.ColorKind,this.za),this.matricesIndices&&e(j.f.MatricesIndicesKind,this.matricesIndices),this.matricesWeights&&e(j.f.MatricesWeightsKind,this.matricesWeights),this.matricesIndicesExtra&&e(j.f.MatricesIndicesExtraKind,this.matricesIndicesExtra),this.matricesWeightsExtra&&e(j.f.MatricesWeightsExtraKind,this.matricesWeightsExtra)}clone(){const K=this.serialize();return B.Parse(K)}serialize(){const K={};if(this.xa&&(K.xa=Array.from(this.xa)),this.ya&&(K.ya=Array.from(this.ya)),this.tangents&&(K.tangents=Array.from(this.tangents)),this.Aa&&(K.Aa=Array.from(this.Aa)),this.uvs2&&(K.uvs2=Array.from(this.uvs2)),this.uvs3&&(K.uvs3=Array.from(this.uvs3)),this.uvs4&&(K.uvs4=Array.from(this.uvs4)),this.uvs5&&(K.uvs5=Array.from(this.uvs5)),this.uvs6&&(K.uvs6=Array.from(this.uvs6)),this.za&&(K.za=Array.from(this.za),K.hasVertexAlpha=this.hasVertexAlpha),this.matricesIndices&&(K.matricesIndices=Array.from(this.matricesIndices),K.matricesIndices._isExpanded=!0),this.matricesWeights&&(K.matricesWeights=Array.from(this.matricesWeights)),this.matricesIndicesExtra&&(K.matricesIndicesExtra=Array.from(this.matricesIndicesExtra),K.matricesIndicesExtra._isExpanded=!0),this.matricesWeightsExtra&&(K.matricesWeightsExtra=Array.from(this.matricesWeightsExtra)),K.indices=Array.from(this.indices),this.materialInfos){K.materialInfos=[];for(const b of this.materialInfos){const e={indexStart:b.indexStart,indexCount:b.indexCount,materialIndex:b.materialIndex,verticesStart:b.verticesStart,verticesCount:b.verticesCount};K.materialInfos.push(e)}}return K}static ExtractFromMesh(K,b,e){return B._ExtractFrom(K,b,e)}static ExtractFromGeometry(K,b,e){return B._ExtractFrom(K,b,e)}static _ExtractFrom(K,b,e){const z=new B;if(K.isVerticesDataPresent(j.f.PositionKind)&&(z.xa=K.getVerticesData(j.f.PositionKind,b,e)),K.isVerticesDataPresent(j.f.NormalKind)&&(z.ya=K.getVerticesData(j.f.NormalKind,b,e)),K.isVerticesDataPresent(j.f.TangentKind)&&(z.tangents=K.getVerticesData(j.f.TangentKind,b,e)),K.isVerticesDataPresent(j.f.UVKind)&&(z.Aa=K.getVerticesData(j.f.UVKind,b,e)),K.isVerticesDataPresent(j.f.UV2Kind)&&(z.uvs2=K.getVerticesData(j.f.UV2Kind,b,e)),K.isVerticesDataPresent(j.f.UV3Kind)&&(z.uvs3=K.getVerticesData(j.f.UV3Kind,b,e)),K.isVerticesDataPresent(j.f.UV4Kind)&&(z.uvs4=K.getVerticesData(j.f.UV4Kind,b,e)),K.isVerticesDataPresent(j.f.UV5Kind)&&(z.uvs5=K.getVerticesData(j.f.UV5Kind,b,e)),K.isVerticesDataPresent(j.f.UV6Kind)&&(z.uvs6=K.getVerticesData(j.f.UV6Kind,b,e)),K.isVerticesDataPresent(j.f.ColorKind)){const k=K.mj||K,T=k.getVertexBuffer(j.f.ColorKind),F=k.getVerticesData(j.f.ColorKind,b,e);if(3===T.getSize()){const K=new Float32Array(4*F.length/3);for(let b=0,e=0;b<F.length;b+=3,e+=4)K[e]=F[b],K[e+1]=F[b+1],K[e+2]=F[b+2],K[e+3]=1;z.za=K}else{if(4!==T.getSize())throw new Error(`Unexpected number of color components: ${T.getSize()}`);z.za=F}}return K.isVerticesDataPresent(j.f.MatricesIndicesKind)&&(z.matricesIndices=K.getVerticesData(j.f.MatricesIndicesKind,b,e)),K.isVerticesDataPresent(j.f.MatricesWeightsKind)&&(z.matricesWeights=K.getVerticesData(j.f.MatricesWeightsKind,b,e)),K.isVerticesDataPresent(j.f.MatricesIndicesExtraKind)&&(z.matricesIndicesExtra=K.getVerticesData(j.f.MatricesIndicesExtraKind,b,e)),K.isVerticesDataPresent(j.f.MatricesWeightsExtraKind)&&(z.matricesWeightsExtra=K.getVerticesData(j.f.MatricesWeightsExtraKind,b,e)),z.indices=K.Lf(b,e),z}static CreateRibbon(K){throw(0,T.c)("ribbonBuilder")}static CreateBox(K){throw(0,T.c)("boxBuilder")}static CreateTiledBox(K){throw(0,T.c)("tiledBoxBuilder")}static CreateTiledPlane(K){throw(0,T.c)("tiledPlaneBuilder")}static CreateSphere(K){throw(0,T.c)("sphereBuilder")}static CreateCylinder(K){throw(0,T.c)("cylinderBuilder")}static CreateTorus(K){throw(0,T.c)("torusBuilder")}static CreateLineSystem(K){throw(0,T.c)("linesBuilder")}static CreateDashedLines(K){throw(0,T.c)("linesBuilder")}static CreateGround(K){throw(0,T.c)("groundBuilder")}static CreateTiledGround(K){throw(0,T.c)("groundBuilder")}static CreateGroundFromHeightMap(K){throw(0,T.c)("groundBuilder")}static Vf(K){throw(0,T.c)("planeBuilder")}static CreateDisc(K){throw(0,T.c)("discBuilder")}static CreatePolygon(K,b,e,z,k,j,F){throw(0,T.c)("polygonBuilder")}static CreateIcoSphere(K){throw(0,T.c)("icoSphereBuilder")}static CreatePolyhedron(K){throw(0,T.c)("polyhedronBuilder")}static CreateCapsule(){arguments.length>0&&void 0!==arguments[0]||k.k.Up();throw(0,T.c)("capsuleBuilder")}static CreateTorusKnot(K){throw(0,T.c)("torusKnotBuilder")}static ComputeNormals(K,b,e,z){let j=0,T=0,F=0,l=0,Y=0,A=0,X=0,t=0,U=0,B=0,u=0,m=0,D=0,I=0,x=0,Q=0,G=0,i=0,S=0,M=0,r=!1,L=!1,c=!1,v=!1,w=1,h=0,R=null;z&&(r=!!z.facetNormals,L=!!z.facetPositions,c=!!z.facetPartitioning,w=!0===z.useRightHandedSystem?-1:1,h=z.ratio||0,v=!!z.depthSort,R=z.distanceTo,v&&void 0===R&&(R=k.k.Zero()));let n=0,P=0,d=0,p=0;for(c&&z&&z.bbSize&&(n=z.subDiv.X*h/z.bbSize.x,P=z.subDiv.Y*h/z.bbSize.y,d=z.subDiv.Z*h/z.bbSize.z,p=z.subDiv.max*z.subDiv.max,z.facetPartitioning.length=0),j=0;j<K.length;j++)e[j]=0;const a=b.length/3|0;for(j=0;j<a;j++){if(m=3*b[3*j],D=m+1,I=m+2,x=3*b[3*j+1],Q=x+1,G=x+2,i=3*b[3*j+2],S=i+1,M=i+2,T=K[m]-K[x],F=K[D]-K[Q],l=K[I]-K[G],Y=K[i]-K[x],A=K[S]-K[Q],X=K[M]-K[G],t=w*(F*X-l*A),U=w*(l*Y-T*X),B=w*(T*A-F*Y),u=Math.sqrt(t*t+U*U+B*B),u=0===u?1:u,t/=u,U/=u,B/=u,r&&z&&(z.facetNormals[j].x=t,z.facetNormals[j].y=U,z.facetNormals[j].z=B),L&&z&&(z.facetPositions[j].x=(K[m]+K[x]+K[i])/3,z.facetPositions[j].y=(K[D]+K[Q]+K[S])/3,z.facetPositions[j].z=(K[I]+K[G]+K[M])/3),c&&z){const b=Math.floor((z.facetPositions[j].x-z.bInfo.minimum.x*h)*n),e=Math.floor((z.facetPositions[j].y-z.bInfo.minimum.y*h)*P),k=Math.floor((z.facetPositions[j].z-z.bInfo.minimum.z*h)*d),T=Math.floor((K[m]-z.bInfo.minimum.x*h)*n),F=Math.floor((K[D]-z.bInfo.minimum.y*h)*P),l=Math.floor((K[I]-z.bInfo.minimum.z*h)*d),Y=Math.floor((K[x]-z.bInfo.minimum.x*h)*n),A=Math.floor((K[Q]-z.bInfo.minimum.y*h)*P),X=Math.floor((K[G]-z.bInfo.minimum.z*h)*d),t=Math.floor((K[i]-z.bInfo.minimum.x*h)*n),U=Math.floor((K[S]-z.bInfo.minimum.y*h)*P),B=Math.floor((K[M]-z.bInfo.minimum.z*h)*d),u=T+z.subDiv.max*F+p*l,r=Y+z.subDiv.max*A+p*X,L=t+z.subDiv.max*U+p*B,c=b+z.subDiv.max*e+p*k;z.facetPartitioning[c]=z.facetPartitioning[c]?z.facetPartitioning[c]:new Array,z.facetPartitioning[u]=z.facetPartitioning[u]?z.facetPartitioning[u]:new Array,z.facetPartitioning[r]=z.facetPartitioning[r]?z.facetPartitioning[r]:new Array,z.facetPartitioning[L]=z.facetPartitioning[L]?z.facetPartitioning[L]:new Array,z.facetPartitioning[u].push(j),r!=u&&z.facetPartitioning[r].push(j),L!=r&&L!=u&&z.facetPartitioning[L].push(j),c!=u&&c!=r&&c!=L&&z.facetPartitioning[c].push(j)}if(v&&z&&z.facetPositions){const K=z.depthSortedFacets[j];K.ind=3*j,K.sqDistance=k.k.DistanceSquared(z.facetPositions[j],R)}e[m]+=t,e[D]+=U,e[I]+=B,e[x]+=t,e[Q]+=U,e[G]+=B,e[i]+=t,e[S]+=U,e[M]+=B}for(j=0;j<e.length/3;j++)t=e[3*j],U=e[3*j+1],B=e[3*j+2],u=Math.sqrt(t*t+U*U+B*B),u=0===u?1:u,t/=u,U/=u,B/=u,e[3*j]=t,e[3*j+1]=U,e[3*j+2]=B}static _ComputeSides(K,b,e,z,j,T,F){const l=e.length,Y=z.length;let A,X;switch(K=K||B.DEFAULTSIDE){case B.FRONTSIDE:break;case B.BACKSIDE:for(A=0;A<l;A+=3){const K=e[A];e[A]=e[A+2],e[A+2]=K}for(X=0;X<Y;X++)z[X]=-z[X];break;case B.DOUBLESIDE:{const K=b.length,t=K/3;for(let e=0;e<K;e++)b[K+e]=b[e];for(A=0;A<l;A+=3)e[A+l]=e[A+2]+t,e[A+1+l]=e[A+1]+t,e[A+2+l]=e[A]+t;for(X=0;X<Y;X++)z[Y+X]=-z[X];const U=j.length;let B=0;for(B=0;B<U;B++)j[B+U]=j[B];for(T=T||new k.o(0,0,1,1),F=F||new k.o(0,0,1,1),B=0,A=0;A<U/2;A++)j[B]=T.x+(T.z-T.x)*j[B],j[B+1]=T.y+(T.w-T.y)*j[B+1],j[B+U]=F.x+(F.z-F.x)*j[B+U],j[B+U+1]=F.y+(F.w-F.y)*j[B+U+1],B+=2;break}}}static Parse(K){const b=new B,e=K.xa;e&&b.set(e,j.f.PositionKind);const z=K.ya;z&&b.set(z,j.f.NormalKind);const k=K.tangents;k&&b.set(k,j.f.TangentKind);const T=K.Aa;T&&b.set(T,j.f.UVKind);const l=K.uvs2;l&&b.set(l,j.f.UV2Kind);const Y=K.uvs3;Y&&b.set(Y,j.f.UV3Kind);const A=K.uvs4;A&&b.set(A,j.f.UV4Kind);const X=K.uvs5;X&&b.set(X,j.f.UV5Kind);const t=K.uvs6;t&&b.set(t,j.f.UV6Kind);const u=K.za;u&&(b.set(F.g.CheckColors4(u,e.length/3),j.f.ColorKind),void 0!==K.hasVertexAlpha&&(b.hasVertexAlpha=K.hasVertexAlpha));const m=K.matricesIndices;m&&b.set(m,j.f.MatricesIndicesKind);const D=K.matricesWeights;D&&b.set(D,j.f.MatricesWeightsKind);const I=K.indices;I&&(b.indices=I);const x=K.materialInfos;if(x){b.materialInfos=[];for(const K of x){const e=new U;e.indexCount=K.indexCount,e.indexStart=K.indexStart,e.verticesCount=K.verticesCount,e.verticesStart=K.verticesStart,e.materialIndex=K.materialIndex,b.materialInfos.push(e)}}return b}static ImportVertexData(K,b){const e=B.Parse(K);b.setAllVerticesData(e,K.updatable)}}B.FRONTSIDE=0,B.BACKSIDE=1,B.DOUBLESIDE=2,B.DEFAULTSIDE=0,B._UniqueIDGenerator=0,(0,z.b)([Y.e.filter((function(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];let[z]=b;return!Array.isArray(z)}))],B,"_TransformVector3Coordinates",null),(0,z.b)([Y.e.filter((function(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];let[z]=b;return!Array.isArray(z)}))],B,"_TransformVector3Normals",null),(0,z.b)([Y.e.filter((function(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];let[z]=b;return!Array.isArray(z)}))],B,"_TransformVector4Normals",null),(0,z.b)([Y.e.filter((function(){for(var K=arguments.length,b=new Array(K),e=0;e<K;e++)b[e]=arguments[e];let[z]=b;return!Array.isArray(z)}))],B,"_FlipFaces",null)},12356:(K,b,e)=>{"use strict";e.d(b,{d:()=>uK});var z=e(10967),k=e(11226),j=e(11030),T=e(11261),F=e(11186);function l(K){let b=K.pathArray;const e=K.closeArray||!1,z=K.closePath||!1,k=K.invertUV||!1,l=Math.floor(b[0].length/2);let Y=K.offset||l;Y=Y>l?l:Math.floor(Y);const A=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE,X=K.Aa,t=K.za,U=[],B=[],u=[],m=[],D=[],I=[],x=[],Q=[];let G;const i=[],S=[];let M,r,L;if(b.length<2){const K=[],e=[];for(r=0;r<b[0].length-Y;r++)K.push(b[0][r]),e.push(b[0][r+Y]);b=[K,e]}let c=0;const v=z?1:0,w=e?1:0;let h,R,n,P,d,p;for(G=b[0].length,M=0;M<b.length+w;M++){for(x[M]=0,D[M]=[0],h=M===b.length?b[0]:b[M],R=h.length,G=G<R?G:R,L=0;L<R;)U.push(h[L].x,h[L].y,h[L].z),L>0&&(n=h[L].Qc(h[L-1]).length(),P=n+x[M],D[M].push(P),x[M]=P),L++;z&&(L--,U.push(h[0].x,h[0].y,h[0].z),n=h[L].Qc(h[0]).length(),P=n+x[M],D[M].push(P),x[M]=P),i[M]=R+v,S[M]=c,c+=R+v}let a,O,g=null,N=null;for(r=0;r<G+v;r++)for(Q[r]=0,I[r]=[0],M=0;M<b.length-1+w;M++)d=b[M],p=M===b.length-1?b[0]:b[M+1],r===G?(g=d[0],N=p[0]):(g=d[r],N=p[r]),n=N.Qc(g).length(),P=n+Q[r],I[r].push(P),Q[r]=P;if(X)for(M=0;M<X.length;M++)m.push(X[M].x,F.c?1-X[M].y:X[M].y);else for(M=0;M<b.length+w;M++)for(r=0;r<G+v;r++)a=0!=x[M]?D[M][r]/x[M]:0,O=0!=Q[r]?I[r][M]/Q[r]:0,k?m.push(O,a):m.push(a,F.c?1-O:O);M=0;let Z=0,y=i[M]-1,s=i[M+1]-1,E=y<s?y:s,o=S[1]-S[0];const C=i.length-1;for(;Z<=E&&M<C;)B.push(Z,Z+o,Z+1),B.push(Z+o+1,Z+1,Z+o),Z+=1,Z===E&&(M++,o=S[M+1]-S[M],y=i[M]-1,s=i[M+1]-1,Z=S[M],E=y<s?y+Z:s+Z);if(T.e.ComputeNormals(U,B,u),z){let K=0,e=0;for(M=0;M<b.length;M++){K=3*S[M],e=M+1<b.length?3*(S[M+1]-1):u.length-3,u[K]=.5*(u[K]+u[e]),u[K+1]=.5*(u[K+1]+u[e+1]),u[K+2]=.5*(u[K+2]+u[e+2]);const z=Math.sqrt(u[K]*u[K]+u[K+1]*u[K+1]+u[K+2]*u[K+2]);u[K]/=z,u[K+1]/=z,u[K+2]/=z,u[e]=u[K],u[e+1]=u[K+1],u[e+2]=u[K+2]}}if(e){let K=3*S[0],e=3*S[b.length];for(r=0;r<G+v;r++){u[K]=.5*(u[K]+u[e]),u[K+1]=.5*(u[K+1]+u[e+1]),u[K+2]=.5*(u[K+2]+u[e+2]);const b=Math.sqrt(u[K]*u[K]+u[K+1]*u[K+1]+u[K+2]*u[K+2]);u[K]/=b,u[K+1]/=b,u[K+2]/=b,u[e]=u[K],u[e+1]=u[K+1],u[e+2]=u[K+2],K+=3,e+=3}}T.e._ComputeSides(A,U,B,u,m,K.frontUVs,K.backUVs);let H=null;if(t){H=new Float32Array(4*t.length);for(let K=0;K<t.length;K++)H[4*K]=t[K].r,H[4*K+1]=t[K].g,H[4*K+2]=t[K].b,H[4*K+3]=t[K].a}const W=new T.e,f=new Float32Array(U),V=new Float32Array(u),q=new Float32Array(m);return W.indices=B,W.xa=f,W.ya=V,W.Aa=q,H&&W.set(H,j.f.ColorKind),z&&(W._idx=S),W}function Y(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const Y=b.pathArray,A=b.closeArray,X=b.closePath,t=k.b._GetDefaultSideOrientation(b.sideOrientation),U=b.instance,B=b.updatable;if(U){const K=z.e.gb[0].Wd(Number.MAX_VALUE),e=z.e.gb[1].Wd(-Number.MAX_VALUE),l=b=>{let z=Y[0].length;const j=U;let T=0;const F=j._originalBuilderSideOrientation===k.b.DOUBLESIDE?2:1;for(let k=1;k<=F;++k)for(let F=0;F<Y.length;++F){const k=Y[F],l=k.length;z=z<l?z:l;for(let j=0;j<z;++j){const z=k[j];b[T]=z.x,b[T+1]=z.y,b[T+2]=z.z,K.minimizeInPlaceFromFloats(z.x,z.y,z.z),e.maximizeInPlaceFromFloats(z.x,z.y,z.z),T+=3}if(j._creationDataStorage&&j._creationDataStorage.closePath){const K=k[0];b[T]=K.x,b[T+1]=K.y,b[T+2]=K.z,T+=3}}},A=U.getVerticesData(j.f.PositionKind);if(l(A),U.hasBoundingInfo?U.getBoundingInfo().reConstruct(K,e,U._worldMatrix):U.buildBoundingInfo(K,e,U._worldMatrix),U.updateVerticesData(j.f.PositionKind,A,!1,!1),b.za){const K=U.getVerticesData(j.f.ColorKind);for(let e=0,z=0;e<b.za.length;e++,z+=4){const k=b.za[e];K[z]=k.r,K[z+1]=k.g,K[z+2]=k.b,K[z+3]=k.a}U.updateVerticesData(j.f.ColorKind,K,!1,!1)}if(b.Aa){const K=U.getVerticesData(j.f.UVKind);for(let e=0;e<b.Aa.length;e++)K[2*e]=b.Aa[e].x,K[2*e+1]=F.c?1-b.Aa[e].y:b.Aa[e].y;U.updateVerticesData(j.f.UVKind,K,!1,!1)}if(!U.areNormalsFrozen||U.isFacetDataEnabled){const K=U.Lf(),b=U.getVerticesData(j.f.NormalKind),e=U.isFacetDataEnabled?U.getFacetDataParameters():null;if(T.e.ComputeNormals(A,K,b,e),U._creationDataStorage&&U._creationDataStorage.closePath){let K=0,e=0;for(let z=0;z<Y.length;z++)K=3*U._creationDataStorage.idx[z],e=z+1<Y.length?3*(U._creationDataStorage.idx[z+1]-1):b.length-3,b[K]=.5*(b[K]+b[e]),b[K+1]=.5*(b[K+1]+b[e+1]),b[K+2]=.5*(b[K+2]+b[e+2]),b[e]=b[K],b[e+1]=b[K+1],b[e+2]=b[K+2]}U.areNormalsFrozen||U.updateVerticesData(j.f.NormalKind,b,!1,!1)}return U}{const z=new k.b(K,e);z._originalBuilderSideOrientation=t,z._creationDataStorage=new k.e;const j=l(b);return X&&(z._creationDataStorage.idx=j._idx),z._creationDataStorage.closePath=X,z._creationDataStorage.closeArray=A,j.Ca(z,B),z}}T.e.CreateRibbon=l,k.b.CreateRibbon=function(K,b){return Y(K,{pathArray:b,closeArray:arguments.length>2&&void 0!==arguments[2]&&arguments[2],closePath:arguments.length>3?arguments[3]:void 0,offset:arguments.length>4?arguments[4]:void 0,updatable:arguments.length>6&&void 0!==arguments[6]&&arguments[6],sideOrientation:arguments.length>7?arguments[7]:void 0,instance:arguments.length>8?arguments[8]:void 0},arguments.length>5?arguments[5]:void 0)};var A=e(11617),X=e(11298),t=e(10994);function U(K){const b=K.pattern||k.b.NO_FLIP,e=K.tileWidth||K.tileSize||1,z=K.tileHeight||K.tileSize||1,j=K.alignHorizontal||0,F=K.alignVertical||0,l=K.width||K.size||1,Y=Math.floor(l/e);let A=l-Y*e;const X=K.height||K.size||1,t=Math.floor(X/z);let U=X-t*z;const B=e*Y/2,u=z*t/2;let m=0,D=0,I=0,x=0,Q=0,G=0;if(A>0||U>0){switch(I=-B,x=-u,Q=B,G=u,j){case k.b.CENTER:A/=2,I-=A,Q+=A;break;case k.b.LEFT:Q+=A,m=-A/2;break;case k.b.RIGHT:I-=A,m=A/2}switch(F){case k.b.CENTER:U/=2,x-=U,G+=U;break;case k.b.BOTTOM:G+=U,D=-U/2;break;case k.b.TOP:x-=U,D=U/2}}const i=[],S=[],M=[];M[0]=[0,0,1,0,1,1,0,1],M[1]=[0,0,1,0,1,1,0,1],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(M[1]=[1,1,0,1,0,0,1,0]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(M[1]=[1,0,0,0,0,1,1,1]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(M[1]=[0,1,1,1,1,0,0,0]);let r=[];const L=[],c=[];let v=0;for(let T=0;T<t;T++)for(let K=0;K<Y;K++)i.push(K*e-B+m,T*z-u+D,0),i.push((K+1)*e-B+m,T*z-u+D,0),i.push((K+1)*e-B+m,(T+1)*z-u+D,0),i.push(K*e-B+m,(T+1)*z-u+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),r=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?r.concat(M[(K%2+T%2)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?r.concat(M[T%2]):r.concat(M[0]),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1),v+=4;if(A>0||U>0){const K=U>0&&(F===k.b.CENTER||F===k.b.TOP),T=U>0&&(F===k.b.CENTER||F===k.b.BOTTOM),l=A>0&&(j===k.b.CENTER||j===k.b.RIGHT),X=A>0&&(j===k.b.CENTER||j===k.b.LEFT);let M,w,h,R,n=[];if(K&&l&&(i.push(I+m,x+D,0),i.push(-B+m,x+D,0),i.push(-B+m,x+U+D,0),i.push(I+m,x+U+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,M=1-A/e,w=1-U/z,h=1,R=1,n=[M,w,h,w,h,R,M,R],b===k.b.ROTATE_ROW&&(n=[1-M,1-w,1-h,1-w,1-h,1-R,1-M,1-R]),b===k.b.FLIP_ROW&&(n=[1-M,w,1-h,w,1-h,R,1-M,R]),b===k.b.FLIP_N_ROTATE_ROW&&(n=[M,1-w,h,1-w,h,1-R,M,1-R]),r=r.concat(n),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K&&X&&(i.push(B+m,x+D,0),i.push(Q+m,x+D,0),i.push(Q+m,x+U+D,0),i.push(B+m,x+U+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,M=0,w=1-U/z,h=A/e,R=1,n=[M,w,h,w,h,R,M,R],(b===k.b.ROTATE_ROW||b===k.b.ROTATE_TILE&&Y%2===0)&&(n=[1-M,1-w,1-h,1-w,1-h,1-R,1-M,1-R]),(b===k.b.FLIP_ROW||b===k.b.FLIP_TILE&&Y%2===0)&&(n=[1-M,w,1-h,w,1-h,R,1-M,R]),(b===k.b.FLIP_N_ROTATE_ROW||b===k.b.FLIP_N_ROTATE_TILE&&Y%2===0)&&(n=[M,1-w,h,1-w,h,1-R,M,1-R]),r=r.concat(n),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),T&&l&&(i.push(I+m,u+D,0),i.push(-B+m,u+D,0),i.push(-B+m,G+D,0),i.push(I+m,G+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,M=1-A/e,w=0,h=1,R=U/z,n=[M,w,h,w,h,R,M,R],(b===k.b.ROTATE_ROW&&t%2===1||b===k.b.ROTATE_TILE&&t%1===0)&&(n=[1-M,1-w,1-h,1-w,1-h,1-R,1-M,1-R]),(b===k.b.FLIP_ROW&&t%2===1||b===k.b.FLIP_TILE&&t%2===0)&&(n=[1-M,w,1-h,w,1-h,R,1-M,R]),(b===k.b.FLIP_N_ROTATE_ROW&&t%2===1||b===k.b.FLIP_N_ROTATE_TILE&&t%2===0)&&(n=[M,1-w,h,1-w,h,1-R,M,1-R]),r=r.concat(n),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),T&&X&&(i.push(B+m,u+D,0),i.push(Q+m,u+D,0),i.push(Q+m,G+D,0),i.push(B+m,G+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,M=0,w=0,h=A/e,R=U/z,n=[M,w,h,w,h,R,M,R],(b===k.b.ROTATE_ROW&&t%2===1||b===k.b.ROTATE_TILE&&(t+Y)%2===1)&&(n=[1-M,1-w,1-h,1-w,1-h,1-R,1-M,1-R]),(b===k.b.FLIP_ROW&&t%2===1||b===k.b.FLIP_TILE&&(t+Y)%2===1)&&(n=[1-M,w,1-h,w,1-h,R,1-M,R]),(b===k.b.FLIP_N_ROTATE_ROW&&t%2===1||b===k.b.FLIP_N_ROTATE_TILE&&(t+Y)%2===1)&&(n=[M,1-w,h,1-w,h,1-R,M,1-R]),r=r.concat(n),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)),K){const K=[];M=0,w=1-U/z,h=1,R=1,K[0]=[M,w,h,w,h,R,M,R],K[1]=[M,w,h,w,h,R,M,R],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(K[1]=[1-M,1-w,1-h,1-w,1-h,1-R,1-M,1-R]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(K[1]=[1-M,w,1-h,w,1-h,R,1-M,R]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(K[1]=[M,1-w,h,1-w,h,1-R,M,1-R]);for(let z=0;z<Y;z++)i.push(z*e-B+m,x+D,0),i.push((z+1)*e-B+m,x+D,0),i.push((z+1)*e-B+m,x+U+D,0),i.push(z*e-B+m,x+U+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,r=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?r.concat(K[(z+1)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?r.concat(K[1]):r.concat(K[0]),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(T){const K=[];M=0,w=0,h=1,R=U/z,K[0]=[M,w,h,w,h,R,M,R],K[1]=[M,w,h,w,h,R,M,R],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(K[1]=[1-M,1-w,1-h,1-w,1-h,1-R,1-M,1-R]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(K[1]=[1-M,w,1-h,w,1-h,R,1-M,R]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(K[1]=[M,1-w,h,1-w,h,1-R,M,1-R]);for(let z=0;z<Y;z++)i.push(z*e-B+m,G-U+D,0),i.push((z+1)*e-B+m,G-U+D,0),i.push((z+1)*e-B+m,G+D,0),i.push(z*e-B+m,G+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,r=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?r.concat(K[(z+t)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?r.concat(K[t%2]):r.concat(K[0]),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(l){const K=[];M=1-A/e,w=0,h=1,R=1,K[0]=[M,w,h,w,h,R,M,R],K[1]=[M,w,h,w,h,R,M,R],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(K[1]=[1-M,1-w,1-h,1-w,1-h,1-R,1-M,1-R]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(K[1]=[1-M,w,1-h,w,1-h,R,1-M,R]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(K[1]=[M,1-w,h,1-w,h,1-R,M,1-R]);for(let e=0;e<t;e++)i.push(I+m,e*z-u+D,0),i.push(I+A+m,e*z-u+D,0),i.push(I+A+m,(e+1)*z-u+D,0),i.push(I+m,(e+1)*z-u+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,r=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?r.concat(K[(e+1)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?r.concat(K[e%2]):r.concat(K[0]),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}if(X){const K=[];M=0,w=0,h=A/z,R=1,K[0]=[M,w,h,w,h,R,M,R],K[1]=[M,w,h,w,h,R,M,R],b!==k.b.ROTATE_TILE&&b!==k.b.ROTATE_ROW||(K[1]=[1-M,1-w,1-h,1-w,1-h,1-R,1-M,1-R]),b!==k.b.FLIP_TILE&&b!==k.b.FLIP_ROW||(K[1]=[1-M,w,1-h,w,1-h,R,1-M,R]),b!==k.b.FLIP_N_ROTATE_TILE&&b!==k.b.FLIP_N_ROTATE_ROW||(K[1]=[M,1-w,h,1-w,h,1-R,M,1-R]);for(let e=0;e<t;e++)i.push(Q-A+m,e*z-u+D,0),i.push(Q+m,e*z-u+D,0),i.push(Q+m,(e+1)*z-u+D,0),i.push(Q-A+m,(e+1)*z-u+D,0),c.push(v,v+1,v+3,v+1,v+2,v+3),v+=4,r=b===k.b.FLIP_TILE||b===k.b.ROTATE_TILE||b===k.b.FLIP_N_ROTATE_TILE?r.concat(K[(e+Y)%2]):b===k.b.FLIP_ROW||b===k.b.ROTATE_ROW||b===k.b.FLIP_N_ROTATE_ROW?r.concat(K[e%2]):r.concat(K[0]),L.push(1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1),S.push(0,0,-1,0,0,-1,0,0,-1,0,0,-1)}}const w=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE;T.e._ComputeSides(w,i,c,S,r,K.frontUVs,K.backUVs);const h=new T.e;h.indices=c,h.xa=i,h.ya=S,h.Aa=r;const R=w===T.e.DOUBLESIDE?L.concat(L):L;return h.za=R,h}function B(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new k.b(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return U(b).Ca(z,b.updatable),z}function u(K){const b=K.faceUV||new Array(6),e=K.faceColors,j=K.pattern||k.b.NO_FLIP,l=K.width||K.size||1,Y=K.height||K.size||1,A=K.depth||K.size||1,X=K.tileWidth||K.tileSize||1,B=K.tileHeight||K.tileSize||1,u=K.alignHorizontal||0,m=K.alignVertical||0,D=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE;for(let k=0;k<6;k++)void 0===b[k]&&(b[k]=new z.o(0,0,1,1)),e&&void 0===e[k]&&(e[k]=new t.g(1,1,1,1));const I=l/2,x=Y/2,Q=A/2,G=[];for(let z=0;z<2;z++)G[z]=U({pattern:j,tileWidth:X,tileHeight:B,width:l,height:Y,alignVertical:m,alignHorizontal:u,sideOrientation:D});for(let z=2;z<4;z++)G[z]=U({pattern:j,tileWidth:X,tileHeight:B,width:A,height:Y,alignVertical:m,alignHorizontal:u,sideOrientation:D});let i=m;m===k.b.BOTTOM?i=k.b.TOP:m===k.b.TOP&&(i=k.b.BOTTOM);for(let z=4;z<6;z++)G[z]=U({pattern:j,tileWidth:X,tileHeight:B,width:l,height:A,alignVertical:i,alignHorizontal:u,sideOrientation:D});let S=[],M=[],r=[],L=[];const c=[],v=[],w=[],h=[];let R=0,n=0;for(let k=0;k<6;k++){const K=G[k].xa.length;v[k]=[],w[k]=[];for(let b=0;b<K/3;b++)v[k].push(new z.k(G[k].xa[3*b],G[k].xa[3*b+1],G[k].xa[3*b+2])),w[k].push(new z.k(G[k].ya[3*b],G[k].ya[3*b+1],G[k].ya[3*b+2]));R=G[k].Aa.length,h[k]=[];for(let e=0;e<R;e+=2)h[k][e]=b[k].x+(b[k].z-b[k].x)*G[k].Aa[e],h[k][e+1]=b[k].y+(b[k].w-b[k].y)*G[k].Aa[e+1],F.c&&(h[k][e+1]=1-h[k][e+1]);if(r=r.concat(h[k]),L=L.concat(G[k].indices.map((K=>K+n))),n+=v[k].length,e)for(let b=0;b<4;b++)c.push(e[k].r,e[k].g,e[k].b,e[k].a)}const P=new z.k(0,0,Q),d=z.b.RotationY(Math.PI);S=v[0].map((K=>z.k.TransformNormal(K,d).add(P))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[]),M=w[0].map((K=>z.k.TransformNormal(K,d))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[]),S=S.concat(v[1].map((K=>K.Qc(P))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[])),M=M.concat(w[1].map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[]));const p=new z.k(I,0,0),a=z.b.RotationY(-Math.PI/2);S=S.concat(v[2].map((K=>z.k.TransformNormal(K,a).add(p))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[])),M=M.concat(w[2].map((K=>z.k.TransformNormal(K,a))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[]));const O=z.b.RotationY(Math.PI/2);S=S.concat(v[3].map((K=>z.k.TransformNormal(K,O).Qc(p))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[])),M=M.concat(w[3].map((K=>z.k.TransformNormal(K,O))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[]));const g=new z.k(0,x,0),N=z.b.RotationX(Math.PI/2);S=S.concat(v[4].map((K=>z.k.TransformNormal(K,N).add(g))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[])),M=M.concat(w[4].map((K=>z.k.TransformNormal(K,N))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[]));const Z=z.b.RotationX(-Math.PI/2);S=S.concat(v[5].map((K=>z.k.TransformNormal(K,Z).Qc(g))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[])),M=M.concat(w[5].map((K=>z.k.TransformNormal(K,Z))).map((K=>[K.x,K.y,K.z])).reduce(((K,b)=>K.concat(b)),[])),T.e._ComputeSides(D,S,L,M,r);const y=new T.e;if(y.indices=L,y.xa=S,y.ya=M,y.Aa=r,e){const K=D===T.e.DOUBLESIDE?c.concat(c):c;y.za=K}return y}function m(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new k.b(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return u(b).Ca(z,b.updatable),z}T.e.CreateTiledPlane=U;T.e.CreateTiledBox=u;var D=e(11600),I=e(10960),x=e(11291);function Q(K){const b=K.height||2;let e=0===K.diameterTop?0:K.diameterTop||K.diameter||1,j=0===K.diameterBottom?0:K.diameterBottom||K.diameter||1;e=e||1e-5,j=j||1e-5;const l=0|(K.tessellation||24),Y=0|(K.subdivisions||1),A=!!K.hasRings,X=!!K.enclose,U=0===K.cap?0:K.cap||k.b.CAP_ALL,B=K.arc&&(K.arc<=0||K.arc>1)?1:K.arc||1,u=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE,m=K.faceUV||new Array(3),D=K.faceColors,I=2+(1+(1!==B&&X?2:0))*(A?Y:1);let Q;for(Q=0;Q<I;Q++)D&&void 0===D[Q]&&(D[Q]=new t.g(1,1,1,1));for(Q=0;Q<I;Q++)m&&void 0===m[Q]&&(m[Q]=new z.o(0,0,1,1));const G=[],i=[],S=[],M=[],r=[],L=2*Math.PI*B/l;let c,v,w;const h=(j-e)/2/b,R=z.k.Zero(),n=z.k.Zero(),P=z.k.Zero(),d=z.k.Zero(),p=z.k.Zero(),a=x.e.Y;let O,g,N,Z=1,y=1,s=0,E=0;for(O=0;O<=Y;O++)for(v=O/Y,w=(v*(e-j)+j)/2,Z=A&&0!==O&&O!==Y?2:1,N=0;N<Z;N++){for(A&&(y+=N),X&&(y+=2*N),g=0;g<=l;g++)c=g*L,R.x=Math.cos(-c)*w,R.y=-b/2+v*b,R.z=Math.sin(-c)*w,0===e&&O===Y?(n.x=S[S.length-3*(l+1)],n.y=S[S.length-3*(l+1)+1],n.z=S[S.length-3*(l+1)+2]):(n.x=R.x,n.z=R.z,n.y=Math.sqrt(n.x*n.x+n.z*n.z)*h,n.normalize()),0===g&&(P.p(R),d.p(n)),i.push(R.x,R.y,R.z),S.push(n.x,n.y,n.z),E=A?s!==y?m[y].y:m[y].w:m[y].y+(m[y].w-m[y].y)*v,M.push(m[y].x+(m[y].z-m[y].x)*g/l,F.c?1-E:E),D&&r.push(D[y].r,D[y].g,D[y].b,D[y].a);1!==B&&X&&(i.push(R.x,R.y,R.z),i.push(0,R.y,0),i.push(0,R.y,0),i.push(P.x,P.y,P.z),z.k.CrossToRef(a,n,p),p.normalize(),S.push(p.x,p.y,p.z,p.x,p.y,p.z),z.k.CrossToRef(d,a,p),p.normalize(),S.push(p.x,p.y,p.z,p.x,p.y,p.z),E=A?s!==y?m[y+1].y:m[y+1].w:m[y+1].y+(m[y+1].w-m[y+1].y)*v,M.push(m[y+1].x,F.c?1-E:E),M.push(m[y+1].z,F.c?1-E:E),E=A?s!==y?m[y+2].y:m[y+2].w:m[y+2].y+(m[y+2].w-m[y+2].y)*v,M.push(m[y+2].x,F.c?1-E:E),M.push(m[y+2].z,F.c?1-E:E),D&&(r.push(D[y+1].r,D[y+1].g,D[y+1].b,D[y+1].a),r.push(D[y+1].r,D[y+1].g,D[y+1].b,D[y+1].a),r.push(D[y+2].r,D[y+2].g,D[y+2].b,D[y+2].a),r.push(D[y+2].r,D[y+2].g,D[y+2].b,D[y+2].a))),s!==y&&(s=y)}const o=1!==B&&X?l+4:l;for(O=0,y=0;y<Y;y++){let K=0,b=0,e=0,z=0;for(g=0;g<l;g++)K=O*(o+1)+g,b=(O+1)*(o+1)+g,e=O*(o+1)+(g+1),z=(O+1)*(o+1)+(g+1),G.push(K,b,e),G.push(z,e,b);1!==B&&X&&(G.push(K+2,b+2,e+2),G.push(z+2,e+2,b+2),G.push(K+4,b+4,e+4),G.push(z+4,e+4,b+4)),O=A?O+2:O+1}const C=K=>{const k=K?e/2:j/2;if(0===k)return;let T,Y,A;const X=K?m[I-1]:m[0];let t=null;D&&(t=K?D[I-1]:D[0]);const U=i.length/3,u=K?b/2:-b/2,x=new z.k(0,u,0);i.push(x.x,x.y,x.z),S.push(0,K?1:-1,0);const Q=X.y+.5*(X.w-X.y);M.push(X.x+.5*(X.z-X.x),F.c?1-Q:Q),t&&r.push(t.r,t.g,t.b,t.a);const L=new z.h(.5,.5);for(A=0;A<=l;A++){T=2*Math.PI*A*B/l;const b=Math.cos(-T),e=Math.sin(-T);Y=new z.k(b*k,u,e*k);const j=new z.h(b*L.x+.5,e*L.y+.5);i.push(Y.x,Y.y,Y.z),S.push(0,K?1:-1,0);const U=X.y+(X.w-X.y)*j.y;M.push(X.x+(X.z-X.x)*j.x,F.c?1-U:U),t&&r.push(t.r,t.g,t.b,t.a)}for(A=0;A<l;A++)K?(G.push(U),G.push(U+(A+2)),G.push(U+(A+1))):(G.push(U),G.push(U+(A+1)),G.push(U+(A+2)))};U!==k.b.CAP_START&&U!==k.b.CAP_ALL||C(!1),U!==k.b.CAP_END&&U!==k.b.CAP_ALL||C(!0),T.e._ComputeSides(u,i,G,S,M,K.frontUVs,K.backUVs);const H=new T.e;return H.indices=G,H.xa=i,H.ya=S,H.Aa=M,D&&(H.za=r),H}function G(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const z=new k.b(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return Q(b).Ca(z,b.updatable),z}function i(K){const b=[],e=[],k=[],j=[],l=K.diameter||1,Y=K.thickness||.5,A=0|(K.tessellation||16),X=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE,t=A+1;for(let T=0;T<=A;T++){const K=T/A,X=T*Math.PI*2/A-Math.PI/2,U=z.b.Translation(l/2,0,0).multiply(z.b.RotationY(X));for(let l=0;l<=A;l++){const X=1-l/A,B=l*Math.PI*2/A+Math.PI,u=Math.cos(B),m=Math.sin(B);let D=new z.k(u,m,0),I=D.scale(Y/2);const x=new z.h(K,X);I=z.k.TransformCoordinates(I,U),D=z.k.TransformNormal(D,U),e.push(I.x,I.y,I.z),k.push(D.x,D.y,D.z),j.push(x.x,F.c?1-x.y:x.y);const Q=(T+1)%t,G=(l+1)%t;b.push(T*t+l),b.push(T*t+G),b.push(Q*t+l),b.push(T*t+G),b.push(Q*t+G),b.push(Q*t+l)}}T.e._ComputeSides(X,e,b,k,j,K.frontUVs,K.backUVs);const U=new T.e;return U.indices=b,U.xa=e,U.ya=k,U.Aa=j,U}function S(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const z=new k.b(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return i(b).Ca(z,b.updatable),z}T.e.CreateCylinder=Q,k.b.CreateCylinder=(K,b,e,z,j,T,F,l,Y)=>{void 0!==F&&F instanceof I.e||(void 0!==F&&(Y=l||k.b.DEFAULTSIDE,l=F),F=T,T=1);return G(K,{height:b,diameterTop:e,diameterBottom:z,tessellation:j,subdivisions:T,sideOrientation:Y,updatable:l},F)};function M(K){const b=[],e=[],k=[],j=[],l=K.radius||2,Y=K.tube||.5,A=K.radialSegments||32,X=K.tubularSegments||32,t=K.p||2,U=K.q||3,B=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE,u=K=>{const b=Math.cos(K),e=Math.sin(K),k=U/t*K,j=Math.cos(k),T=l*(2+j)*.5*b,F=l*(2+j)*e*.5,Y=l*Math.sin(k)*.5;return new z.k(T,F,Y)};let m,D;for(m=0;m<=A;m++){const K=m%A/A*2*t*Math.PI,b=u(K),k=u(K+.01),T=k.Qc(b);let l=k.add(b);const U=z.k.Cross(T,l);for(l=z.k.Cross(U,T),U.normalize(),l.normalize(),D=0;D<X;D++){const K=D%X/X*2*Math.PI,z=-Y*Math.cos(K),k=Y*Math.sin(K);e.push(b.x+z*l.x+k*U.x),e.push(b.y+z*l.y+k*U.y),e.push(b.z+z*l.z+k*U.z),j.push(m/A),j.push(F.c?1-D/X:D/X)}}for(m=0;m<A;m++)for(D=0;D<X;D++){const K=(D+1)%X,e=m*X+D,z=(m+1)*X+D,k=(m+1)*X+K,j=m*X+K;b.push(j),b.push(z),b.push(e),b.push(j),b.push(k),b.push(z)}T.e.ComputeNormals(e,b,k),T.e._ComputeSides(B,e,b,k,j,K.frontUVs,K.backUVs);const I=new T.e;return I.indices=b,I.xa=e,I.ya=k,I.Aa=j,I}function r(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2?arguments[2]:void 0;const z=new k.b(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return M(b).Ca(z,b.updatable),z}T.e.CreateTorus=i,k.b.CreateTorus=(K,b,e,z,k,j,T)=>S(K,{diameter:b,thickness:e,tessellation:z,sideOrientation:T,updatable:j},k);T.e.CreateTorusKnot=M,k.b.CreateTorusKnot=(K,b,e,z,k,j,T,F,l,Y)=>r(K,{radius:b,tube:e,radialSegments:z,tubularSegments:k,p:j,q:T,sideOrientation:Y,updatable:l},F);var L=e(12358),c=e(10696),v=e(11491),w=e(10969),h=e(10720);class R extends z.h{constructor(K,b){super(K.x,K.y),this.index=b}}class n{constructor(){this.elements=[]}add(K){const b=[];return K.forEach((K=>{const e=new R(K,this.elements.length);b.push(e),this.elements.push(e)})),b}computeBounds(){const K=new z.h(this.elements[0].x,this.elements[0].y),b=new z.h(this.elements[0].x,this.elements[0].y);return this.elements.forEach((e=>{e.x<K.x?K.x=e.x:e.x>b.x&&(b.x=e.x),e.y<K.y?K.y=e.y:e.y>b.y&&(b.y=e.y)})),{min:K,max:b,width:b.x-K.x,height:b.y-K.y}}}class P{_addToepoint(K){for(const b of K)this._epoints.push(b.x,b.y)}constructor(K,b,e){let z,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;this._points=new n,this._outlinepoints=new n,this._holes=new Array,this._epoints=new Array,this._eholes=new Array,this.bjsEarcut=k,this._name=K,this._scene=e||h.b.LastCreatedScene,z=b instanceof v.f?b.getPoints():b,this._addToepoint(z),this._points.add(z),this._outlinepoints.add(z),"undefined"===typeof this.bjsEarcut&&c.b.Warn("Earcut was not found, the polygon will not be built.")}addHole(K){this._points.add(K);const b=new n;return b.add(K),this._holes.push(b),this._eholes.push(this._epoints.length/2),this._addToepoint(K),this}build(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const z=new k.b(this._name,this._scene),T=this.buildVertexData(b,e);return z.Ga(j.f.PositionKind,T.xa,K),z.Ga(j.f.NormalKind,T.ya,K),z.Ga(j.f.UVKind,T.Aa,K),z.setIndices(T.indices),z}buildVertexData(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;const e=new T.e,z=[],k=[],j=[],F=this._points.computeBounds();this._points.elements.forEach((K=>{z.push(0,1,0),k.push(K.x,0,K.y),j.push((K.x-F.min.x)/F.width,(K.y-F.min.y)/F.height)}));const l=[],Y=this.bjsEarcut(this._epoints,this._eholes,2);for(let T=0;T<Y.length;T++)l.push(Y[T]);if(K>0){const e=k.length/3;this._points.elements.forEach((b=>{z.push(0,-1,0),k.push(b.x,-K,b.y),j.push(1-(b.x-F.min.x)/F.width,1-(b.y-F.min.y)/F.height)}));const T=l.length;for(let K=0;K<T;K+=3){const b=l[K+0],z=l[K+1],k=l[K+2];l.push(k+e),l.push(z+e),l.push(b+e)}this._addSide(k,z,j,l,F,this._outlinepoints,K,!1,b),this._holes.forEach((e=>{this._addSide(k,z,j,l,F,e,K,!0,b)}))}return e.indices=l,e.xa=k,e.ya=z,e.Aa=j,e}_addSide(K,b,e,k,j,T,F,l,Y){let A=K.length/3,X=0;for(let t=0;t<T.elements.length;t++){const U=T.elements[t],B=T.elements[(t+1)%T.elements.length];K.push(U.x,0,U.y),K.push(U.x,-F,U.y),K.push(B.x,0,B.y),K.push(B.x,-F,B.y);const u=T.elements[(t+T.elements.length-1)%T.elements.length],m=T.elements[(t+2)%T.elements.length];let D=new z.k(-(B.y-U.y),0,B.x-U.x),I=new z.k(-(U.y-u.y),0,U.x-u.x),x=new z.k(-(m.y-B.y),0,m.x-B.x);l||(D=D.scale(-1),I=I.scale(-1),x=x.scale(-1));const Q=D.normalizeToNew();let G=I.normalizeToNew(),i=x.normalizeToNew();const S=z.k.Dot(G,Q);G=S>Y?S<w.c-1?new z.k(U.x,0,U.y).Qc(new z.k(B.x,0,B.y)).normalize():I.add(D).normalize():Q;const M=z.k.Dot(x,D);i=M>Y?M<w.c-1?new z.k(B.x,0,B.y).Qc(new z.k(U.x,0,U.y)).normalize():x.add(D).normalize():Q,e.push(X/j.width,0),e.push(X/j.width,1),X+=D.length(),e.push(X/j.width,0),e.push(X/j.width,1),b.push(G.x,G.y,G.z),b.push(G.x,G.y,G.z),b.push(i.x,i.y,i.z),b.push(i.x,i.y,i.z),l?(k.push(A),k.push(A+2),k.push(A+1),k.push(A+1),k.push(A+2),k.push(A+3)):(k.push(A),k.push(A+1),k.push(A+2),k.push(A+1),k.push(A+3),k.push(A+2)),A+=4}}}function d(K,b,e,k,l,Y,A){const X=e||new Array(3),U=k,B=[],u=A||!1;for(let j=0;j<3;j++)void 0===X[j]&&(X[j]=new z.o(0,0,1,1)),U&&void 0===U[j]&&(U[j]=new t.g(1,1,1,1));const m=K.getVerticesData(j.f.PositionKind),D=K.getVerticesData(j.f.NormalKind),I=K.getVerticesData(j.f.UVKind),x=K.Lf(),Q=m.length/9;let G=0,i=0,S=0,M=0,r=0;const L=[0];if(u)for(let z=Q;z<m.length/3;z+=4)i=m[3*(z+2)]-m[3*z],S=m[3*(z+2)+2]-m[3*z+2],M=Math.sqrt(i*i+S*S),r+=M,L.push(r);let c=0,v=0;for(let z=0;z<D.length;z+=3)Math.abs(D[z+1])<.001&&(v=1),Math.abs(D[z+1]-1)<.001&&(v=0),Math.abs(D[z+1]+1)<.001&&(v=2),c=z/3,1===v?(G=c-Q,I[2*c]=G%4<1.5?u?X[v].x+(X[v].z-X[v].x)*L[Math.floor(G/4)]/r:X[v].x:u?X[v].x+(X[v].z-X[v].x)*L[Math.floor(G/4)+1]/r:X[v].z,I[2*c+1]=G%2===0?F.c?1-X[v].w:X[v].w:F.c?1-X[v].y:X[v].y):(I[2*c]=(1-I[2*c])*X[v].x+I[2*c]*X[v].z,I[2*c+1]=(1-I[2*c+1])*X[v].y+I[2*c+1]*X[v].w,F.c&&(I[2*c+1]=1-I[2*c+1])),U&&B.push(U[v].r,U[v].g,U[v].b,U[v].a);T.e._ComputeSides(b,m,x,D,I,l,Y);const w=new T.e;if(w.indices=x,w.xa=m,w.ya=D,w.Aa=I,U){const K=b===T.e.DOUBLESIDE?B.concat(B):B;w.za=K}return w}function p(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut;b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation);const T=b.shape,F=b.holes||[],l=b.depth||0,Y=b.smoothingThreshold||2,A=[];let X=[];for(let k=0;k<T.length;k++)A[k]=new z.h(T[k].x,T[k].z);A[0].equalsWithEpsilon(A[A.length-1],1e-8)&&A.pop();const t=new P(K,A,e||h.b.LastCreatedScene,j);for(let k=0;k<F.length;k++){X=[];for(let K=0;K<F[k].length;K++)X.push(new z.h(F[k][K].x,F[k][K].z));t.addHole(X)}const U=t.build(!1,l,Y);U._originalBuilderSideOrientation=b.sideOrientation;return d(U,b.sideOrientation,b.faceUV,b.faceColors,b.frontUVs,b.backUVs,b.wrap).Ca(U,b.updatable),U}function a(K,b){return p(K,b,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3&&void 0!==arguments[3]?arguments[3]:earcut)}function O(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=b.path,j=b.shape,T=b.scale||1,F=b.rotation||0,l=0===b.cap?0:b.cap||k.b.NO_CAP,Y=b.updatable,A=k.b._GetDefaultSideOrientation(b.sideOrientation),X=b.instance||null,t=b.invertUV||!1,U=b.closeShape||!1;return N(K,j,z,T,F,null,null,b.closePath||!1,U,l,!1,e,!!Y,A,X,t,b.frontUVs||null,b.backUVs||null,b.firstNormal||null,!!b.adjustFrame)}function g(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=b.path,j=b.shape,T=b.scaleFunction||(()=>1),F=b.rotationFunction||(()=>0),l=b.closePath||b.ribbonCloseArray||!1,Y=b.closeShape||b.ribbonClosePath||!1,A=0===b.cap?0:b.cap||k.b.NO_CAP,X=b.updatable,t=b.firstNormal||null,U=b.adjustFrame||!1;return N(K,j,z,null,null,T,F,l,Y,A,!0,e,!!X,k.b._GetDefaultSideOrientation(b.sideOrientation),b.instance||null,b.invertUV||!1,b.frontUVs||null,b.backUVs||null,t,U)}function N(K,b,e,j,T,F,l,A,X,t,U,B,u,m,D,I,x,Q,G,i){const S=(K,b,e,j,T,F,l,Y,A,X,t)=>{const U=e.getTangents(),B=e.getNormals(),u=e.getBinormals(),m=e.getDistances();if(t)for(let k=0;k<U.length;k++)if(0==U[k].x&&0==U[k].y&&0==U[k].z&&U[k].p(U[k-1]),0==B[k].x&&0==B[k].y&&0==B[k].z&&B[k].p(B[k-1]),0==u[k].x&&0==u[k].y&&0==u[k].z&&u[k].p(u[k-1]),k>0){let K=U[k-1];z.k.Dot(K,U[k])<0&&U[k].scaleInPlace(-1),K=B[k-1],z.k.Dot(K,B[k])<0&&B[k].scaleInPlace(-1),K=u[k-1],z.k.Dot(K,u[k])<0&&u[k].scaleInPlace(-1)}let D=0;const I=X&&Y?Y:()=>null!==F?F:0,x=X&&l?l:()=>null!==T?T:1;let Q=A===k.b.NO_CAP||A===k.b.CAP_END?0:2;const G=z.e.Matrix[0];for(let k=0;k<b.length;k++){const e=[],T=I(k,m[k]),F=x(k,m[k]);z.b.RotationAxisToRef(U[k],D,G);for(let j=0;j<K.length;j++){const T=U[k].scale(K[j].z).add(B[k].scale(K[j].x)).add(u[k].scale(K[j].y)),l=z.k.Zero();z.k.TransformCoordinatesToRef(T,G,l),l.scaleInPlace(F).addInPlace(b[k]),e[j]=l}j[Q]=e,D+=T,Q++}const i=K=>{const b=Array(),e=z.k.Zero();let k;for(k=0;k<K.length;k++)e.addInPlace(K[k]);for(e.scaleInPlace(1/K.length),k=0;k<K.length;k++)b.push(e);return b};switch(A){case k.b.NO_CAP:break;case k.b.CAP_START:j[0]=i(j[2]),j[1]=j[2];break;case k.b.CAP_END:j[Q]=j[Q-1],j[Q+1]=i(j[Q-1]);break;case k.b.CAP_ALL:j[0]=i(j[2]),j[1]=j[2],j[Q]=j[Q-1],j[Q+1]=i(j[Q-1])}return j};let M,r;if(D){const K=D._creationDataStorage;return M=G?K.path3D.update(e,G):K.path3D.update(e),r=S(b,e,K.path3D,K.pathArray,j,T,F,l,K.cap,U,i),D=Y("",{pathArray:r,closeArray:!1,closePath:!1,offset:0,updatable:!1,sideOrientation:0,instance:D},B||void 0)}M=G?new v.j(e,G):new v.j(e);r=S(b,e,M,new Array,j,T,F,l,t=t<0||t>3?0:t,U,i);const L=Y(K,{pathArray:r,closeArray:A,closePath:X,updatable:u,sideOrientation:m,invertUV:I,frontUVs:x||void 0,backUVs:Q||void 0},B);return L._creationDataStorage.pathArray=r,L._creationDataStorage.path3D=M,L._creationDataStorage.cap=t,L}T.e.CreatePolygon=d,k.b.CreatePolygon=function(K,b,e,z,k,j){return p(K,{shape:b,holes:z,updatable:k,sideOrientation:j},e,arguments.length>6&&void 0!==arguments[6]?arguments[6]:earcut)},k.b.ExtrudePolygon=function(K,b,e,z,k,j,T){return a(K,{shape:b,holes:k,depth:e,updatable:j,sideOrientation:T},z,arguments.length>7&&void 0!==arguments[7]?arguments[7]:earcut)};function Z(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=b.arc?b.arc<=0||b.arc>1?1:b.arc:1,T=void 0===b.closed||b.closed,F=b.shape,l=b.radius||1,A=b.tessellation||64,X=b.clip||0,t=b.updatable,U=k.b._GetDefaultSideOrientation(b.sideOrientation),B=b.cap||k.b.NO_CAP,u=2*Math.PI,m=[],D=b.invertUV||!1;let I=0,x=0;const Q=u/A*j;let G,i;for(I=0;I<=A-X;I++){for(i=[],B!=k.b.CAP_START&&B!=k.b.CAP_ALL||(i.push(new z.k(0,F[0].y,0)),i.push(new z.k(Math.cos(I*Q)*F[0].x*l,F[0].y,Math.sin(I*Q)*F[0].x*l))),x=0;x<F.length;x++)G=new z.k(Math.cos(I*Q)*F[x].x*l,F[x].y,Math.sin(I*Q)*F[x].x*l),i.push(G);B!=k.b.CAP_END&&B!=k.b.CAP_ALL||(i.push(new z.k(Math.cos(I*Q)*F[F.length-1].x*l,F[F.length-1].y,Math.sin(I*Q)*F[F.length-1].x*l)),i.push(new z.k(0,F[F.length-1].y,0))),m.push(i)}return Y(K,{pathArray:m,closeArray:T,sideOrientation:U,updatable:t,invertUV:D,frontUVs:b.frontUVs,backUVs:b.backUVs},e)}k.b.ExtrudeShape=function(K,b,e,z,j,T){let F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8?arguments[8]:void 0,A=arguments.length>9?arguments[9]:void 0;return O(K,{shape:b,path:e,scale:z,rotation:j,cap:0===T?0:T||k.b.NO_CAP,sideOrientation:Y,instance:A,updatable:l},F)},k.b.ExtrudeShapeCustom=(K,b,e,z,j,T,F,l,Y,A,X,t)=>g(K,{shape:b,path:e,scaleFunction:z,rotationFunction:j,ribbonCloseArray:T,ribbonClosePath:F,cap:0===l?0:l||k.b.NO_CAP,sideOrientation:X,instance:t,updatable:A},Y);k.b.CreateLathe=(K,b,e,z,k,j,T)=>Z(K,{shape:b,radius:e,tessellation:z,sideOrientation:T,updatable:j},k);var y=e(11361),s=e(11307);function E(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=b.path;let T=b.instance,F=1;void 0!==b.radius?F=b.radius:T&&(F=T._creationDataStorage.radius);const l=b.tessellation||64,A=b.radiusFunction||null;let X=b.cap||k.b.NO_CAP;const t=b.invertUV||!1,U=b.updatable,B=k.b._GetDefaultSideOrientation(b.sideOrientation);b.arc=b.arc&&(b.arc<=0||b.arc>1)?1:b.arc||1;const u=(K,b,e,j,T,F,l,Y)=>{const A=b.getTangents(),X=b.getNormals(),t=b.getDistances(),U=2*Math.PI/T*Y,B=F||(()=>j);let u,m,D,I;const x=z.e.Matrix[0];let Q=l===k.b.NO_CAP||l===k.b.CAP_END?0:2;for(let k=0;k<K.length;k++){m=B(k,t[k]),u=Array(),D=X[k];for(let b=0;b<T;b++)z.b.RotationAxisToRef(A[k],U*b,x),I=u[b]?u[b]:z.k.Zero(),z.k.TransformCoordinatesToRef(D,x,I),I.scaleInPlace(m).addInPlace(K[k]),u[b]=I;e[Q]=u,Q++}const G=(b,e)=>{const z=Array();for(let k=0;k<b;k++)z.push(K[e]);return z};switch(l){case k.b.NO_CAP:break;case k.b.CAP_START:e[0]=G(T,0),e[1]=e[2].slice(0);break;case k.b.CAP_END:e[Q]=e[Q-1].slice(0),e[Q+1]=G(T,K.length-1);break;case k.b.CAP_ALL:e[0]=G(T,0),e[1]=e[2].slice(0),e[Q]=e[Q-1].slice(0),e[Q+1]=G(T,K.length-1)}return e};let m,D;if(T){const K=T._creationDataStorage,e=b.arc||K.arc;return m=K.path3D.update(j),D=u(j,m,K.pathArray,F,K.tessellation,A,K.cap,e),T=Y("",{pathArray:D,instance:T}),K.path3D=m,K.pathArray=D,K.arc=e,K.radius=F,T}m=new v.j(j);X=X<0||X>3?0:X,D=u(j,m,new Array,F,l,A,X,b.arc);const I=Y(K,{pathArray:D,closePath:!0,closeArray:!1,updatable:U,sideOrientation:B,invertUV:t,frontUVs:b.frontUVs,backUVs:b.backUVs},e);return I._creationDataStorage.pathArray=D,I._creationDataStorage.path3D=m,I._creationDataStorage.tessellation=l,I._creationDataStorage.cap=X,I._creationDataStorage.arc=b.arc,I._creationDataStorage.radius=F,I}function o(K){const b=[];b[0]={vertex:[[0,0,1.732051],[1.632993,0,-.5773503],[-.8164966,1.414214,-.5773503],[-.8164966,-1.414214,-.5773503]],face:[[0,1,2],[0,2,3],[0,3,1],[1,3,2]]},b[1]={vertex:[[0,0,1.414214],[1.414214,0,0],[0,1.414214,0],[-1.414214,0,0],[0,-1.414214,0],[0,0,-1.414214]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,1],[1,4,5],[1,5,2],[2,5,3],[3,5,4]]},b[2]={vertex:[[0,0,1.070466],[.7136442,0,.7978784],[-.3568221,.618034,.7978784],[-.3568221,-.618034,.7978784],[.7978784,.618034,.3568221],[.7978784,-.618034,.3568221],[-.9341724,.381966,.3568221],[.1362939,1,.3568221],[.1362939,-1,.3568221],[-.9341724,-.381966,.3568221],[.9341724,.381966,-.3568221],[.9341724,-.381966,-.3568221],[-.7978784,.618034,-.3568221],[-.1362939,1,-.3568221],[-.1362939,-1,-.3568221],[-.7978784,-.618034,-.3568221],[.3568221,.618034,-.7978784],[.3568221,-.618034,-.7978784],[-.7136442,0,-.7978784],[0,0,-1.070466]],face:[[0,1,4,7,2],[0,2,6,9,3],[0,3,8,5,1],[1,5,11,10,4],[2,7,13,12,6],[3,9,15,14,8],[4,10,16,13,7],[5,8,14,17,11],[6,12,18,15,9],[10,11,17,19,16],[12,13,16,19,18],[14,15,18,19,17]]},b[3]={vertex:[[0,0,1.175571],[1.051462,0,.5257311],[.3249197,1,.5257311],[-.8506508,.618034,.5257311],[-.8506508,-.618034,.5257311],[.3249197,-1,.5257311],[.8506508,.618034,-.5257311],[.8506508,-.618034,-.5257311],[-.3249197,1,-.5257311],[-1.051462,0,-.5257311],[-.3249197,-1,-.5257311],[0,0,-1.175571]],face:[[0,1,2],[0,2,3],[0,3,4],[0,4,5],[0,5,1],[1,5,7],[1,7,6],[1,6,2],[2,6,8],[2,8,3],[3,8,9],[3,9,4],[4,9,10],[4,10,5],[5,10,7],[6,7,11],[6,11,8],[7,10,11],[8,11,9],[9,11,10]]},b[4]={vertex:[[0,0,1.070722],[.7148135,0,.7971752],[-.104682,.7071068,.7971752],[-.6841528,.2071068,.7971752],[-.104682,-.7071068,.7971752],[.6101315,.7071068,.5236279],[1.04156,.2071068,.1367736],[.6101315,-.7071068,.5236279],[-.3574067,1,.1367736],[-.7888348,-.5,.5236279],[-.9368776,.5,.1367736],[-.3574067,-1,.1367736],[.3574067,1,-.1367736],[.9368776,-.5,-.1367736],[.7888348,.5,-.5236279],[.3574067,-1,-.1367736],[-.6101315,.7071068,-.5236279],[-1.04156,-.2071068,-.1367736],[-.6101315,-.7071068,-.5236279],[.104682,.7071068,-.7971752],[.6841528,-.2071068,-.7971752],[.104682,-.7071068,-.7971752],[-.7148135,0,-.7971752],[0,0,-1.070722]],face:[[0,2,3],[1,6,5],[4,9,11],[7,15,13],[8,16,10],[12,14,19],[17,22,18],[20,21,23],[0,1,5,2],[0,3,9,4],[0,4,7,1],[1,7,13,6],[2,5,12,8],[2,8,10,3],[3,10,17,9],[4,11,15,7],[5,6,14,12],[6,13,20,14],[8,12,19,16],[9,17,18,11],[10,16,22,17],[11,18,21,15],[13,15,21,20],[14,20,23,19],[16,19,23,22],[18,22,23,21]]},b[5]={vertex:[[0,0,1.322876],[1.309307,0,.1889822],[-.9819805,.8660254,.1889822],[.1636634,-1.299038,.1889822],[.3273268,.8660254,-.9449112],[-.8183171,-.4330127,-.9449112]],face:[[0,3,1],[2,4,5],[0,1,4,2],[0,2,5,3],[1,3,5,4]]},b[6]={vertex:[[0,0,1.159953],[1.013464,0,.5642542],[-.3501431,.9510565,.5642542],[-.7715208,-.6571639,.5642542],[.6633206,.9510565,-.03144481],[.8682979,-.6571639,-.3996071],[-1.121664,.2938926,-.03144481],[-.2348831,-1.063314,-.3996071],[.5181548,.2938926,-.9953061],[-.5850262,-.112257,-.9953061]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,9,7],[5,7,9,8],[0,3,7,5,1],[2,4,8,9,6]]},b[7]={vertex:[[0,0,1.118034],[.8944272,0,.6708204],[-.2236068,.8660254,.6708204],[-.7826238,-.4330127,.6708204],[.6708204,.8660254,.2236068],[1.006231,-.4330127,-.2236068],[-1.006231,.4330127,.2236068],[-.6708204,-.8660254,-.2236068],[.7826238,.4330127,-.6708204],[.2236068,-.8660254,-.6708204],[-.8944272,0,-.6708204],[0,0,-1.118034]],face:[[0,1,4,2],[0,2,6,3],[1,5,8,4],[3,6,10,7],[5,9,11,8],[7,10,11,9],[0,3,7,9,5,1],[2,4,8,11,10,6]]},b[8]={vertex:[[-.729665,.670121,.319155],[-.655235,-.29213,-.754096],[-.093922,-.607123,.537818],[.702196,.595691,.485187],[.776626,-.36656,-.588064]],face:[[1,4,2],[0,1,2],[3,0,2],[4,3,2],[4,1,0,3]]},b[9]={vertex:[[-.868849,-.100041,.61257],[-.329458,.976099,.28078],[-.26629,-.013796,-.477654],[-.13392,-1.034115,.229829],[.738834,.707117,-.307018],[.859683,-.535264,-.338508]],face:[[3,0,2],[5,3,2],[4,5,2],[1,4,2],[0,1,2],[0,3,5,4,1]]},b[10]={vertex:[[-.610389,.243975,.531213],[-.187812,-.48795,-.664016],[-.187812,.9759,-.664016],[.187812,-.9759,.664016],[.798201,.243975,.132803]],face:[[1,3,0],[3,4,0],[3,1,4],[0,2,1],[0,4,2],[2,4,1]]},b[11]={vertex:[[-1.028778,.392027,-.048786],[-.640503,-.646161,.621837],[-.125162,-.395663,-.540059],[.004683,.888447,-.651988],[.125161,.395663,.540059],[.632925,-.791376,.433102],[1.031672,.157063,-.354165]],face:[[3,2,0],[2,1,0],[2,5,1],[0,4,3],[0,1,4],[4,1,5],[2,3,6],[3,4,6],[5,2,6],[4,5,6]]},b[12]={vertex:[[-.669867,.334933,-.529576],[-.669867,.334933,.529577],[-.4043,1.212901,0],[-.334933,-.669867,-.529576],[-.334933,-.669867,.529577],[.334933,.669867,-.529576],[.334933,.669867,.529577],[.4043,-1.212901,0],[.669867,-.334933,-.529576],[.669867,-.334933,.529577]],face:[[8,9,7],[6,5,2],[3,8,7],[5,0,2],[4,3,7],[0,1,2],[9,4,7],[1,6,2],[9,8,5,6],[8,3,0,5],[3,4,1,0],[4,9,6,1]]},b[13]={vertex:[[-.931836,.219976,-.264632],[-.636706,.318353,.692816],[-.613483,-.735083,-.264632],[-.326545,.979634,0],[-.318353,-.636706,.692816],[-.159176,.477529,-.856368],[.159176,-.477529,-.856368],[.318353,.636706,.692816],[.326545,-.979634,0],[.613482,.735082,-.264632],[.636706,-.318353,.692816],[.931835,-.219977,-.264632]],face:[[11,10,8],[7,9,3],[6,11,8],[9,5,3],[2,6,8],[5,0,3],[4,2,8],[0,1,3],[10,4,8],[1,7,3],[10,11,9,7],[11,6,5,9],[6,2,0,5],[2,4,1,0],[4,10,7,1]]},b[14]={vertex:[[-.93465,.300459,-.271185],[-.838689,-.260219,-.516017],[-.711319,.717591,.128359],[-.710334,-.156922,.080946],[-.599799,.556003,-.725148],[-.503838,-.004675,-.969981],[-.487004,.26021,.48049],[-.460089,-.750282,-.512622],[-.376468,.973135,-.325605],[-.331735,-.646985,.084342],[-.254001,.831847,.530001],[-.125239,-.494738,-.966586],[.029622,.027949,.730817],[.056536,-.982543,-.262295],[.08085,1.087391,.076037],[.125583,-.532729,.485984],[.262625,.599586,.780328],[.391387,-.726999,-.716259],[.513854,-.868287,.139347],[.597475,.85513,.326364],[.641224,.109523,.783723],[.737185,-.451155,.538891],[.848705,-.612742,-.314616],[.976075,.365067,.32976],[1.072036,-.19561,.084927]],face:[[15,18,21],[12,20,16],[6,10,2],[3,0,1],[9,7,13],[2,8,4,0],[0,4,5,1],[1,5,11,7],[7,11,17,13],[13,17,22,18],[18,22,24,21],[21,24,23,20],[20,23,19,16],[16,19,14,10],[10,14,8,2],[15,9,13,18],[12,15,21,20],[6,12,16,10],[3,6,2,0],[9,3,1,7],[9,15,12,6,3],[22,17,11,5,4,8,14,19,23,24]]};const e=K.type&&(K.type<0||K.type>=b.length)?0:K.type||0,k=K.size,j=K.sizeX||k||1,l=K.sizeY||k||1,Y=K.sizeZ||k||1,A=K.custom||b[e],X=A.face.length,U=K.faceUV||new Array(X),B=K.faceColors,u=void 0===K.flat||K.flat,m=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE,D=[],I=[],x=[],Q=[],G=[];let i=0,S=0;const M=[];let r,L,c,v,w,h,R=0,n=0;if(u)for(n=0;n<X;n++)B&&void 0===B[n]&&(B[n]=new t.g(1,1,1,1)),U&&void 0===U[n]&&(U[n]=new z.o(0,0,1,1));if(u)for(n=0;n<X;n++){const K=A.face[n].length;for(c=2*Math.PI/K,v=.5*Math.tan(c/2),w=.5,R=0;R<K;R++)D.push(A.vertex[A.face[n][R]][0]*j,A.vertex[A.face[n][R]][1]*l,A.vertex[A.face[n][R]][2]*Y),M.push(i),i++,r=U[n].x+(U[n].z-U[n].x)*(.5+v),L=U[n].y+(U[n].w-U[n].y)*(w-.5),Q.push(r,F.c?1-L:L),h=v*Math.cos(c)-w*Math.sin(c),w=v*Math.sin(c)+w*Math.cos(c),v=h,B&&G.push(B[n].r,B[n].g,B[n].b,B[n].a);for(R=0;R<K-2;R++)I.push(M[0+S],M[R+2+S],M[R+1+S]);S+=K}else{for(R=0;R<A.vertex.length;R++)D.push(A.vertex[R][0]*j,A.vertex[R][1]*l,A.vertex[R][2]*Y),Q.push(0,F.c?1:0);for(n=0;n<X;n++)for(R=0;R<A.face[n].length-2;R++)I.push(A.face[n][0],A.face[n][R+2],A.face[n][R+1])}T.e.ComputeNormals(D,I,x),T.e._ComputeSides(m,D,I,x,Q,K.frontUVs,K.backUVs);const P=new T.e;return P.xa=D,P.indices=I,P.ya=x,P.Aa=Q,B&&u&&(P.za=G),P}function C(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new k.b(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return o(b).Ca(z,b.updatable),z}k.b.CreateTube=(K,b,e,z,k,j,T,F,l,Y)=>E(K,{path:b,radius:e,tessellation:z,radiusFunction:k,arc:1,cap:j,updatable:F,sideOrientation:l,instance:Y},T);function H(K){const b=K.sideOrientation||T.e.DEFAULTSIDE,e=K.radius||1,k=void 0===K.flat||K.flat,j=0|(K.subdivisions||4),l=K.radiusX||e,Y=K.radiusY||e,A=K.radiusZ||e,X=(1+Math.sqrt(5))/2,t=[-1,X,-0,1,X,0,-1,-X,0,1,-X,0,0,-1,-X,0,1,-X,0,-1,X,0,1,X,X,0,1,X,0,-1,-X,0,1,-X,0,-1],U=[0,11,5,0,5,1,0,1,7,0,7,10,12,22,23,1,5,20,5,11,4,23,22,13,22,18,6,7,1,8,14,21,4,14,4,2,16,13,6,15,6,19,3,8,9,4,21,5,13,17,23,6,13,22,19,6,18,9,8,1],B=[0,1,2,3,4,5,6,7,8,9,10,11,0,2,3,3,3,4,7,8,9,9,10,11],u=[5,1,3,1,6,4,0,0,5,3,4,2,2,2,4,0,2,0,1,1,6,0,6,2,0,4,3,3,4,4,3,1,4,2,4,4,0,2,1,1,2,2,3,3,1,3,2,4],m=[0,0,0,0,1,0,0,1,1,0,0,0,1,1,0,0,1,1,1,0],D=[],I=[],x=[],Q=[];let G=0;const i=new Array(3),S=new Array(3);let M;for(M=0;M<3;M++)i[M]=z.k.Zero(),S[M]=z.h.Zero();for(let T=0;T<20;T++){for(M=0;M<3;M++){const K=U[3*T+M];i[M].Yd(t[3*B[K]],t[3*B[K]+1],t[3*B[K]+2]),i[M].normalize(),S[M].Yd(.134765625*u[2*K]+.05859375+-.0390625*m[T],.2333984375*u[2*K+1]+.025390625+.01953125*m[T])}const K=(K,b,e,T)=>{const X=z.k.Lerp(i[0],i[2],b/j),t=z.k.Lerp(i[1],i[2],b/j),U=j===b?i[2]:z.k.Lerp(X,t,K/(j-b));let B;if(U.normalize(),k){const K=z.k.Lerp(i[0],i[2],T/j),b=z.k.Lerp(i[1],i[2],T/j);B=z.k.Lerp(K,b,e/(j-T))}else B=new z.k(U.x,U.y,U.z);B.x/=l,B.y/=Y,B.z/=A,B.normalize();const u=z.h.Lerp(S[0],S[2],b/j),m=z.h.Lerp(S[1],S[2],b/j),M=j===b?S[2]:z.h.Lerp(u,m,K/(j-b));I.push(U.x*l,U.y*Y,U.z*A),x.push(B.x,B.y,B.z),Q.push(M.x,F.c?1-M.y:M.y),D.push(G),G++};for(let b=0;b<j;b++)for(let e=0;e+b<j;e++)K(e,b,e+1/3,b+1/3),K(e+1,b,e+1/3,b+1/3),K(e,b+1,e+1/3,b+1/3),e+b+1<j&&(K(e+1,b,e+2/3,b+2/3),K(e+1,b+1,e+2/3,b+2/3),K(e,b+1,e+2/3,b+2/3))}T.e._ComputeSides(b,I,D,x,Q,K.frontUVs,K.backUVs);const r=new T.e;return r.indices=D,r.xa=I,r.ya=x,r.Aa=Q,r}function W(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const z=new k.b(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),z._originalBuilderSideOrientation=b.sideOrientation;return H(b).Ca(z,b.updatable),z}T.e.CreatePolyhedron=o,k.b.CreatePolyhedron=(K,b,e)=>C(K,b,e);T.e.CreateIcoSphere=H,k.b.CreateIcoSphere=(K,b,e)=>W(K,b,e);var f=e(10984);const V=new z.k(1,0,0),q=new z.k(-1,0,0),J=new z.k(0,1,0),KK=new z.k(0,-1,0),bK=new z.k(0,0,1),eK=new z.k(0,0,-1);class zK{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z.k.Zero(),b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.k.Up(),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z.h.Zero(),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,T=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,F=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;this.position=K,this.k=b,this.uv=e,this.vertexIdx=k,this.vertexIdxForBones=j,this.localPositionOverride=T,this.localNormalOverride=F,this.matrixIndicesOverride=l,this.matrixWeightsOverride=Y}clone(){var K,b,e,z;return new zK(this.position.clone(),this.k.clone(),this.uv.clone(),this.vertexIdx,this.vertexIdxForBones,null===(K=this.localPositionOverride)||void 0===K?void 0:K.slice(),null===(b=this.localNormalOverride)||void 0===b?void 0:b.slice(),null===(e=this.matrixIndicesOverride)||void 0===e?void 0:e.slice(),null===(z=this.matrixWeightsOverride)||void 0===z?void 0:z.slice())}}function kK(K,b,e){var l,Y,A,X;const t=!!b.skeleton,U=e.localMode||t,B=b.Lf(),u=t?b.Hd(!0,!0):b.getVerticesData(j.f.PositionKind),m=t?b.getNormalsData(!0,!0):b.getVerticesData(j.f.NormalKind),D=U?t?b.getVerticesData(j.f.PositionKind):u:null,I=U?t?b.getVerticesData(j.f.NormalKind):m:null,x=b.getVerticesData(j.f.UVKind),Q=t?b.getVerticesData(j.f.MatricesIndicesKind):null,G=t?b.getVerticesData(j.f.MatricesWeightsKind):null,i=t?b.getVerticesData(j.f.MatricesIndicesExtraKind):null,S=t?b.getVerticesData(j.f.MatricesWeightsExtraKind):null,M=e.position||z.k.Zero();let r=e.k||z.k.Up();const L=e.size||z.k.One(),c=e.angle||0;if(!r){const K=new z.k(0,0,1),e=b.va().activeCamera,k=z.k.TransformCoordinates(K,e.getWorldMatrix());r=e.globalPosition.Qc(k)}const v=-Math.atan2(r.z,r.x)-Math.PI/2,w=Math.sqrt(r.x*r.x+r.z*r.z),h=Math.atan2(r.y,w),R=new T.e;R.indices=[],R.xa=[],R.ya=[],R.Aa=[],R.matricesIndices=t?[]:null,R.matricesWeights=t?[]:null,R.matricesIndicesExtra=i?[]:null,R.matricesWeightsExtra=S?[]:null;let n=0;const P=(K,b)=>{const k=new zK;if(!B||!u||!m)return k;const j=B[K];if(k.vertexIdx=3*j,k.vertexIdxForBones=4*j,k.position=new z.k(u[3*j],u[3*j+1],u[3*j+2]),z.k.TransformCoordinatesToRef(k.position,b,k.position),k.k=new z.k(m[3*j],m[3*j+1],m[3*j+2]),z.k.TransformNormalToRef(k.k,b,k.k),e.captureUVS&&x){const K=x[2*j+1];k.uv=new z.h(x[2*j],F.c?1-K:K)}return k},d=[0,0,0,0],p=(K,b)=>{if(0===K.length)return K;const e=.5*Math.abs(z.k.Dot(L,b)),k=(K,b,e,z)=>{for(let k=0;k<z;++k)if(K[e+k]===b)return e+k;return-1},j=(K,j)=>{const T=z.k.GetClipFactor(K.position,j.position,b,e);let F=d,l=d;if(Q&&G){const b=K.matrixIndicesOverride?0:K.vertexIdxForBones,e=K.matrixIndicesOverride??Q,z=K.matrixWeightsOverride??G,Y=j.matrixIndicesOverride?0:j.vertexIdxForBones,A=j.matrixIndicesOverride??Q,X=j.matrixWeightsOverride??G;F=[0,0,0,0],l=[0,0,0,0];let t=0;for(let K=0;K<4;++K)if(z[b+K]>0){const j=k(A,e[b+K],Y,4);F[t]=e[b+K],l[t]=(0,f.m)(z[b+K],j>=0?X[j]:0,T),t++}for(let K=0;K<4&&t<4;++K){const z=A[Y+K];-1===k(e,z,b,4)&&(F[t]=z,l[t]=(0,f.m)(0,X[Y+K],T),t++)}const U=l[0]+l[1]+l[2]+l[3];l[0]/=U,l[1]/=U,l[2]/=U,l[3]/=U}const Y=K.localPositionOverride?K.localPositionOverride[0]:(null===D||void 0===D?void 0:D[K.vertexIdx])??0,A=K.localPositionOverride?K.localPositionOverride[1]:(null===D||void 0===D?void 0:D[K.vertexIdx+1])??0,X=K.localPositionOverride?K.localPositionOverride[2]:(null===D||void 0===D?void 0:D[K.vertexIdx+2])??0,t=j.localPositionOverride?j.localPositionOverride[0]:(null===D||void 0===D?void 0:D[j.vertexIdx])??0,U=j.localPositionOverride?j.localPositionOverride[1]:(null===D||void 0===D?void 0:D[j.vertexIdx+1])??0,B=j.localPositionOverride?j.localPositionOverride[2]:(null===D||void 0===D?void 0:D[j.vertexIdx+2])??0,u=K.localNormalOverride?K.localNormalOverride[0]:(null===I||void 0===I?void 0:I[K.vertexIdx])??0,m=K.localNormalOverride?K.localNormalOverride[1]:(null===I||void 0===I?void 0:I[K.vertexIdx+1])??0,x=K.localNormalOverride?K.localNormalOverride[2]:(null===I||void 0===I?void 0:I[K.vertexIdx+2])??0,i=u+((j.localNormalOverride?j.localNormalOverride[0]:(null===I||void 0===I?void 0:I[j.vertexIdx])??0)-u)*T,S=m+((j.localNormalOverride?j.localNormalOverride[1]:(null===I||void 0===I?void 0:I[j.vertexIdx+1])??0)-m)*T,M=x+((j.localNormalOverride?j.localNormalOverride[2]:(null===I||void 0===I?void 0:I[j.vertexIdx+2])??0)-x)*T,r=Math.sqrt(i*i+S*S+M*M);return new zK(z.k.Lerp(K.position,j.position,T),z.k.Lerp(K.k,j.k,T).normalize(),z.h.Lerp(K.uv,j.uv,T),-1,-1,D?[Y+(t-Y)*T,A+(U-A)*T,X+(B-X)*T]:null,I?[i/r,S/r,M/r]:null,F,l)};let T=null;K.length>3&&(T=[]);for(let F=0;F<K.length;F+=3){let k=0,l=null,Y=null,A=null,X=null;const t=z.k.Dot(K[F].position,b)-e>0,U=z.k.Dot(K[F+1].position,b)-e>0,B=z.k.Dot(K[F+2].position,b)-e>0;switch(k=(t?1:0)+(U?1:0)+(B?1:0),k){case 0:K.length>3?(T.push(K[F]),T.push(K[F+1]),T.push(K[F+2])):T=K;break;case 1:if(T=T??new Array,t&&(l=K[F+1],Y=K[F+2],A=j(K[F],l),X=j(K[F],Y)),U){l=K[F],Y=K[F+2],A=j(K[F+1],l),X=j(K[F+1],Y),T.push(A),T.push(Y.clone()),T.push(l.clone()),T.push(Y.clone()),T.push(A.clone()),T.push(X);break}B&&(l=K[F],Y=K[F+1],A=j(K[F+2],l),X=j(K[F+2],Y)),l&&Y&&A&&X&&(T.push(l.clone()),T.push(Y.clone()),T.push(A),T.push(X),T.push(A.clone()),T.push(Y.clone()));break;case 2:T=T??new Array,t||(l=K[F].clone(),Y=j(l,K[F+1]),A=j(l,K[F+2]),T.push(l),T.push(Y),T.push(A)),U||(l=K[F+1].clone(),Y=j(l,K[F+2]),A=j(l,K[F]),T.push(l),T.push(Y),T.push(A)),B||(l=K[F+2].clone(),Y=j(l,K[F]),A=j(l,K[F+1]),T.push(l),T.push(Y),T.push(A))}}return T},a=b instanceof k.b?b:null,O=null===a||void 0===a?void 0:a._thinInstanceDataStorage.matrixData,g=(null===a||void 0===a?void 0:a.Rb)||1,N=z.e.Matrix[0];N.p(z.b.IdentityReadOnly);for(let k=0;k<g;++k){if(null!==a&&void 0!==a&&a.hasThinInstances&&O){const K=16*k;N.setRowFromFloats(0,O[K+0],O[K+1],O[K+2],O[K+3]),N.setRowFromFloats(1,O[K+4],O[K+5],O[K+6],O[K+7]),N.setRowFromFloats(2,O[K+8],O[K+9],O[K+10],O[K+11]),N.setRowFromFloats(3,O[K+12],O[K+13],O[K+14],O[K+15])}const K=z.b.RotationYawPitchRoll(v,h,c).multiply(z.b.Translation(M.x,M.y,M.z)),j=z.b.Invert(K),T=b.getWorldMatrix(),l=N.multiply(T).multiply(j),Y=new Array(3);for(let b=0;b<B.length;b+=3){let K=Y;if(K[0]=P(b,l),K[1]=P(b+1,l),K[2]=P(b+2,l),!(e.cullBackFaces&&-K[0].k.z<=0&&-K[1].k.z<=0&&-K[2].k.z<=0)&&(K=p(K,V),K&&(K=p(K,q),K&&(K=p(K,J),K&&(K=p(K,KK),K&&(K=p(K,bK),K&&(K=p(K,eK),K)))))))for(let b=0;b<K.length;b++){const z=K[b];if(R.indices.push(n),U?(z.localPositionOverride?(R.xa[3*n]=z.localPositionOverride[0],R.xa[3*n+1]=z.localPositionOverride[1],R.xa[3*n+2]=z.localPositionOverride[2]):D&&(R.xa[3*n]=D[z.vertexIdx],R.xa[3*n+1]=D[z.vertexIdx+1],R.xa[3*n+2]=D[z.vertexIdx+2]),z.localNormalOverride?(R.ya[3*n]=z.localNormalOverride[0],R.ya[3*n+1]=z.localNormalOverride[1],R.ya[3*n+2]=z.localNormalOverride[2]):I&&(R.ya[3*n]=I[z.vertexIdx],R.ya[3*n+1]=I[z.vertexIdx+1],R.ya[3*n+2]=I[z.vertexIdx+2])):(z.position.toArray(R.xa,3*n),z.k.toArray(R.ya,3*n)),R.matricesIndices&&R.matricesWeights&&(z.matrixIndicesOverride?(R.matricesIndices[4*n]=z.matrixIndicesOverride[0],R.matricesIndices[4*n+1]=z.matrixIndicesOverride[1],R.matricesIndices[4*n+2]=z.matrixIndicesOverride[2],R.matricesIndices[4*n+3]=z.matrixIndicesOverride[3]):(Q&&(R.matricesIndices[4*n]=Q[z.vertexIdxForBones],R.matricesIndices[4*n+1]=Q[z.vertexIdxForBones+1],R.matricesIndices[4*n+2]=Q[z.vertexIdxForBones+2],R.matricesIndices[4*n+3]=Q[z.vertexIdxForBones+3]),i&&R.matricesIndicesExtra&&(R.matricesIndicesExtra[4*n]=i[z.vertexIdxForBones],R.matricesIndicesExtra[4*n+1]=i[z.vertexIdxForBones+1],R.matricesIndicesExtra[4*n+2]=i[z.vertexIdxForBones+2],R.matricesIndicesExtra[4*n+3]=i[z.vertexIdxForBones+3])),z.matrixWeightsOverride?(R.matricesWeights[4*n]=z.matrixWeightsOverride[0],R.matricesWeights[4*n+1]=z.matrixWeightsOverride[1],R.matricesWeights[4*n+2]=z.matrixWeightsOverride[2],R.matricesWeights[4*n+3]=z.matrixWeightsOverride[3]):(G&&(R.matricesWeights[4*n]=G[z.vertexIdxForBones],R.matricesWeights[4*n+1]=G[z.vertexIdxForBones+1],R.matricesWeights[4*n+2]=G[z.vertexIdxForBones+2],R.matricesWeights[4*n+3]=G[z.vertexIdxForBones+3]),S&&R.matricesWeightsExtra&&(R.matricesWeightsExtra[4*n]=S[z.vertexIdxForBones],R.matricesWeightsExtra[4*n+1]=S[z.vertexIdxForBones+1],R.matricesWeightsExtra[4*n+2]=S[z.vertexIdxForBones+2],R.matricesWeightsExtra[4*n+3]=S[z.vertexIdxForBones+3]))),e.captureUVS)z.uv.toArray(R.Aa,2*n);else{R.Aa.push(.5+z.position.x/L.x);const K=.5+z.position.y/L.y;R.Aa.push(F.c?1-K:K)}n++}}}0===R.indices.length&&(R.indices=null),0===R.xa.length&&(R.xa=null),0===R.ya.length&&(R.ya=null),0===R.Aa.length&&(R.Aa=null),0===(null===(l=R.matricesIndices)||void 0===l?void 0:l.length)&&(R.matricesIndices=null),0===(null===(Y=R.matricesWeights)||void 0===Y?void 0:Y.length)&&(R.matricesWeights=null),0===(null===(A=R.matricesIndicesExtra)||void 0===A?void 0:A.length)&&(R.matricesIndicesExtra=null),0===(null===(X=R.matricesWeightsExtra)||void 0===X?void 0:X.length)&&(R.matricesWeightsExtra=null);const Z=new k.b(K,b.va());return R.Ca(Z),U?(Z.skeleton=b.skeleton,Z.parent=b):(Z.position=M.clone(),Z.rotation=new z.k(h,v,c)),Z.xj(!0),Z.refreshBoundingInfo(!0,!0),Z}function jK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6};const b=0|Math.max(K.subdivisions?K.subdivisions:2,1),e=0|Math.max(K.tessellation?K.tessellation:16,3),k=Math.max(K.height?K.height:1,0),j=Math.max(K.radius?K.radius:.25,0),l=0|Math.max(K.capSubdivisions?K.capSubdivisions:6,1),Y=e,A=b,X=Math.max(K.radiusTop?K.radiusTop:j,0),t=Math.max(K.radiusBottom?K.radiusBottom:j,0),U=k-(X+t),B=2*Math.PI,u=Math.max(K.topCapSubdivisions?K.topCapSubdivisions:l,1),m=Math.max(K.bottomCapSubdivisions?K.bottomCapSubdivisions:l,1),D=Math.acos((t-X)/k);let I=[];const x=[],Q=[],G=[];let i=0;const S=[],M=.5*U,r=.5*Math.PI;let L,c;const v=z.k.Zero(),w=z.k.Zero(),h=Math.cos(D),R=Math.sin(D),n=new z.h(X*R,M+X*h).Qc(new z.h(t*R,t*h-M)).length(),P=X*D+n+t*(r-D);let d=0;for(c=0;c<=u;c++){const K=[],b=r-D*(c/u);d+=X*D/u;const e=Math.cos(b),z=Math.sin(b),k=e*X;for(L=0;L<=Y;L++){const b=L/Y,j=b*B+0,T=Math.sin(j),l=Math.cos(j);w.x=k*T,w.y=M+z*X,w.z=k*l,x.push(w.x,w.y,w.z),v.set(e*T,z,e*l),Q.push(v.x,v.y,v.z),G.push(b,F.c?d/P:1-d/P),K.push(i),i++}S.push(K)}const p=k-X-t+h*X-h*t,a=R*(t-X)/p;for(c=1;c<=A;c++){const K=[];d+=n/A;const b=R*(c*(t-X)/A+X);for(L=0;L<=Y;L++){const e=L/Y,z=e*B+0,k=Math.sin(z),j=Math.cos(z);w.x=b*k,w.y=M+h*X-c*p/A,w.z=b*j,x.push(w.x,w.y,w.z),v.set(k,a,j).normalize(),Q.push(v.x,v.y,v.z),G.push(e,F.c?d/P:1-d/P),K.push(i),i++}S.push(K)}for(c=1;c<=m;c++){const K=[],b=r-D-(Math.PI-D)*(c/m);d+=t*D/m;const e=Math.cos(b),z=Math.sin(b),k=e*t;for(L=0;L<=Y;L++){const b=L/Y,j=b*B+0,T=Math.sin(j),l=Math.cos(j);w.x=k*T,w.y=z*t-M,w.z=k*l,x.push(w.x,w.y,w.z),v.set(e*T,z,e*l),Q.push(v.x,v.y,v.z),G.push(b,F.c?d/P:1-d/P),K.push(i),i++}S.push(K)}for(L=0;L<Y;L++)for(c=0;c<u+A+m;c++){const K=S[c][L],b=S[c+1][L],e=S[c+1][L+1],z=S[c][L+1];I.push(K),I.push(b),I.push(z),I.push(b),I.push(e),I.push(z)}if(I=I.reverse(),K.orientation&&!K.orientation.equals(z.k.Up())){const b=new z.b;K.orientation.clone().scale(.5*Math.PI).cross(z.k.Up()).toQuaternion().toRotationMatrix(b);const e=z.k.Zero();for(let K=0;K<x.length;K+=3)e.set(x[K],x[K+1],x[K+2]),z.k.TransformCoordinatesToRef(e.clone(),b,e),x[K]=e.x,x[K+1]=e.y,x[K+2]=e.z}const O=new T.e;return O.xa=x,O.ya=Q,O.Aa=G,O.indices=I,O}function TK(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{orientation:z.k.Up(),subdivisions:2,tessellation:16,height:1,radius:.25,capSubdivisions:6,updatable:!1},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=new k.b(K,e);return jK(b).Ca(j,b.updatable),j}k.b.CreateDecal=(K,b,e,z,k,j)=>kK(K,b,{position:e,k:z,size:k,angle:j});k.b.CreateCapsule=(K,b,e)=>TK(K,b,e),T.e.CreateCapsule=jK;class FK{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.x=K,this.y=b,K!==Math.floor(K)&&(K=Math.floor(K),c.b.Warn("x is not an integer, floor(x) used")),b!==Math.floor(b)&&(b=Math.floor(b),c.b.Warn("y is not an integer, floor(y) used"))}clone(){return new FK(this.x,this.y)}rotate60About(K){const b=this.x;return this.x=K.x+K.y-this.y,this.y=b+this.y-K.x,this}rotateNeg60About(K){const b=this.x;return this.x=b+this.y-K.y,this.y=K.x+K.y-b,this}rotate120(K,b){K!==Math.floor(K)&&(K=Math.floor(K),c.b.Warn("m not an integer only floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),c.b.Warn("n not an integer only floor(n) used"));const e=this.x;return this.x=K-e-this.y,this.y=b+e,this}rotateNeg120(K,b){K!==Math.floor(K)&&(K=Math.floor(K),c.b.Warn("m is not an integer, floor(m) used")),b!==Math.floor(b)&&(b=Math.floor(b),c.b.Warn("n is not an integer,   floor(n) used"));const e=this.x;return this.x=this.y-b,this.y=K+b-e-this.y,this}toCartesianOrigin(K,b){const e=z.k.Zero();return e.x=K.x+2*this.x*b+this.y*b,e.y=K.y+Math.sqrt(3)*this.y*b,e}static Zero(){return new FK(0,0)}}class lK{constructor(){this.cartesian=[],this.vertices=[],this.max=[],this.min=[],this.closestTo=[],this.innerFacets=[],this.isoVecsABOB=[],this.isoVecsOBOA=[],this.isoVecsBAOA=[],this.vertexTypes=[],this.IDATA=new YK("icosahedron","Regular",[[0,w.d,-1],[-w.d,1,0],[-1,0,-w.d],[1,0,-w.d],[w.d,1,0],[0,w.d,1],[-1,0,w.d],[-w.d,-1,0],[0,-w.d,-1],[w.d,-1,0],[1,0,w.d],[0,-w.d,1]],[[0,2,1],[0,3,2],[0,4,3],[0,5,4],[0,1,5],[7,6,1],[8,7,2],[9,8,3],[10,9,4],[6,10,5],[2,7,1],[3,8,2],[4,9,3],[5,10,4],[1,6,5],[11,6,7],[11,7,8],[11,8,9],[11,9,10],[11,10,6]])}setIndices(){let K=12;const b={},e=this.m,z=this.n;let k,j,T,F,l,Y=e,A=1,X=0;0!==z&&(Y=(0,f.j)(e,z)),A=e/Y,X=z/Y;const t=FK.Zero(),U=new FK(e,z),B=new FK(-z,e+z),u=FK.Zero(),m=FK.Zero(),D=FK.Zero();let I,x,Q,G,i=[];const S=[],M=this.vertByDist,r=(e,z,k,j)=>{I=e+"|"+k,x=z+"|"+j,I in b||x in b?I in b&&!(x in b)?b[x]=b[I]:x in b&&!(I in b)&&(b[I]=b[x]):(b[I]=K,b[x]=K,K++),M[k][0]>2?S[b[I]]=[-M[k][0],M[k][1],b[I]]:S[b[I]]=[i[M[k][0]],M[k][1],b[I]]};this.IDATA.edgematch=[[1,"B"],[2,"B"],[3,"B"],[4,"B"],[0,"B"],[10,"O",14,"A"],[11,"O",10,"A"],[12,"O",11,"A"],[13,"O",12,"A"],[14,"O",13,"A"],[0,"O"],[1,"O"],[2,"O"],[3,"O"],[4,"O"],[19,"B",5,"A"],[15,"B",6,"A"],[16,"B",7,"A"],[17,"B",8,"A"],[18,"B",9,"A"]];for(let L=0;L<20;L++){if(i=this.IDATA.face[L],T=i[2],F=i[1],l=i[0],Q=t.x+"|"+t.y,I=L+"|"+Q,I in b||(b[I]=T,S[T]=[i[M[Q][0]],M[Q][1]]),Q=U.x+"|"+U.y,I=L+"|"+Q,I in b||(b[I]=F,S[F]=[i[M[Q][0]],M[Q][1]]),Q=B.x+"|"+B.y,I=L+"|"+Q,I in b||(b[I]=l,S[l]=[i[M[Q][0]],M[Q][1]]),k=this.IDATA.edgematch[L][0],j=this.IDATA.edgematch[L][1],"B"===j)for(let K=1;K<Y;K++)m.x=e-K*(A+X),m.y=z+K*A,D.x=-K*X,D.y=K*(A+X),Q=m.x+"|"+m.y,G=D.x+"|"+D.y,r(L,k,Q,G);if("O"===j)for(let K=1;K<Y;K++)D.x=-K*X,D.y=K*(A+X),u.x=K*A,u.y=K*X,Q=D.x+"|"+D.y,G=u.x+"|"+u.y,r(L,k,Q,G);if(k=this.IDATA.edgematch[L][2],j=this.IDATA.edgematch[L][3],j&&"A"===j)for(let K=1;K<Y;K++)u.x=K*A,u.y=K*X,m.x=e-(Y-K)*(A+X),m.y=z+(Y-K)*A,Q=u.x+"|"+u.y,G=m.x+"|"+m.y,r(L,k,Q,G);for(let e=0;e<this.vertices.length;e++)Q=this.vertices[e].x+"|"+this.vertices[e].y,I=L+"|"+Q,I in b||(b[I]=K++,M[Q][0]>2?S[b[I]]=[-M[Q][0],M[Q][1],b[I]]:S[b[I]]=[i[M[Q][0]],M[Q][1],b[I]])}this.closestTo=S,this.vecToidx=b}calcCoeffs(){const K=this.m,b=this.n,e=Math.sqrt(3)/3,z=K*K+b*b+K*b;this.coau=(K+b)/z,this.cobu=-b/z,this.coav=-e*(K-b)/z,this.cobv=e*(2*K+b)/z}createInnerFacets(){const K=this.m,b=this.n;for(let e=0;e<b+K+1;e++)for(let K=this.min[e];K<this.max[e]+1;K++)K<this.max[e]&&K<this.max[e+1]+1&&this.innerFacets.push(["|"+K+"|"+e,"|"+K+"|"+(e+1),"|"+(K+1)+"|"+e]),e>0&&K<this.max[e-1]&&K+1<this.max[e]+1&&this.innerFacets.push(["|"+K+"|"+e,"|"+(K+1)+"|"+e,"|"+(K+1)+"|"+(e-1)])}edgeVecsABOB(){const K=this.m,b=this.n,e=new FK(-b,K+b);for(let z=1;z<K+b;z++){const K=new FK(this.min[z],z),b=new FK(this.min[z-1],z-1),k=new FK(this.min[z+1],z+1),j=K.clone(),T=b.clone(),F=k.clone();j.rotate60About(e),T.rotate60About(e),F.rotate60About(e);const l=new FK(this.max[j.y],j.y),Y=new FK(this.max[j.y-1],j.y-1),A=new FK(this.max[j.y-1]-1,j.y-1);j.x===l.x&&j.y===l.y||(j.x!==Y.x?(this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,Y,A]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,A,l])):j.y===F.y?(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,b,Y]),this.vertexTypes.push([1,0,1]),this.isoVecsABOB.push([K,Y,k])):(this.vertexTypes.push([1,1,0]),this.isoVecsABOB.push([K,b,Y]),this.vertexTypes.push([1,0,0]),this.isoVecsABOB.push([K,Y,l])))}}mapABOBtoOBOA(){const K=new FK(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const e=[];for(let z=0;z<3;z++)K.x=this.isoVecsABOB[b][z].x,K.y=this.isoVecsABOB[b][z].y,0===this.vertexTypes[b][z]&&K.rotateNeg120(this.m,this.n),e.push(K.clone());this.isoVecsOBOA.push(e)}}mapABOBtoBAOA(){const K=new FK(0,0);for(let b=0;b<this.isoVecsABOB.length;b++){const e=[];for(let z=0;z<3;z++)K.x=this.isoVecsABOB[b][z].x,K.y=this.isoVecsABOB[b][z].y,1===this.vertexTypes[b][z]&&K.rotate120(this.m,this.n),e.push(K.clone());this.isoVecsBAOA.push(e)}}MapToFace(K,b){const e=this.IDATA.face[K],k=e[2],j=e[1],T=e[0],F=z.k.Bg(this.IDATA.vertex[k]),l=z.k.Bg(this.IDATA.vertex[j]),Y=z.k.Bg(this.IDATA.vertex[T]),A=l.Qc(F),X=Y.Qc(F),t=A.scale(this.coau).add(X.scale(this.cobu)),U=A.scale(this.coav).add(X.scale(this.cobv)),B=[];let u,m=z.e.gb[0];for(let z=0;z<this.cartesian.length;z++)m=t.scale(this.cartesian[z].x).add(U.scale(this.cartesian[z].y)).add(F),B[z]=[m.x,m.y,m.z],u=K+"|"+this.vertices[z].x+"|"+this.vertices[z].y,b.vertex[this.vecToidx[u]]=[m.x,m.y,m.z]}build(K,b){const e=[],z=FK.Zero(),k=new FK(K,b),j=new FK(-b,K+b);e.push(z,k,j);for(let Q=b;Q<K+1;Q++)for(let b=0;b<K+1-Q;b++)e.push(new FK(b,Q));if(b>0){const z=(0,f.j)(K,b),k=K/z,j=b/z;for(let F=1;F<z;F++)e.push(new FK(F*k,F*j)),e.push(new FK(-F*j,F*(k+j))),e.push(new FK(K-F*(k+j),b+F*k));const T=K/b;for(let F=1;F<b;F++)for(let z=0;z<F*T;z++)e.push(new FK(z,F)),e.push(new FK(z,F).rotate120(K,b)),e.push(new FK(z,F).rotateNeg120(K,b))}e.sort(((K,b)=>K.x-b.x)),e.sort(((K,b)=>K.y-b.y));const T=new Array(K+b+1),F=new Array(K+b+1);for(let Q=0;Q<T.length;Q++)T[Q]=1/0,F[Q]=-1/0;let l=0,Y=0;const A=e.length;for(let Q=0;Q<A;Q++)Y=e[Q].x,l=e[Q].y,T[l]=Math.min(Y,T[l]),F[l]=Math.max(Y,F[l]);const X=(e,z)=>{const k=e.clone();return"A"===z&&k.rotateNeg120(K,b),"B"===z&&k.rotate120(K,b),k.x<0?k.y:k.x+k.y},t=[],U=[],B=[],u=[],m={},D=[];let I=-1,x=-1;for(let Q=0;Q<A;Q++)t[Q]=e[Q].toCartesianOrigin(new FK(0,0),.5),U[Q]=X(e[Q],"O"),B[Q]=X(e[Q],"A"),u[Q]=X(e[Q],"B"),U[Q]===B[Q]&&B[Q]===u[Q]?(I=3,x=U[Q]):U[Q]===B[Q]?(I=4,x=U[Q]):B[Q]===u[Q]?(I=5,x=B[Q]):u[Q]===U[Q]&&(I=6,x=U[Q]),U[Q]<B[Q]&&U[Q]<u[Q]&&(I=2,x=U[Q]),B[Q]<U[Q]&&B[Q]<u[Q]&&(I=1,x=B[Q]),u[Q]<B[Q]&&u[Q]<U[Q]&&(I=0,x=u[Q]),D.push([I,x,e[Q].x,e[Q].y]);D.sort(((K,b)=>K[2]-b[2])),D.sort(((K,b)=>K[3]-b[3])),D.sort(((K,b)=>K[1]-b[1])),D.sort(((K,b)=>K[0]-b[0]));for(let Q=0;Q<D.length;Q++)m[D[Q][2]+"|"+D[Q][3]]=[D[Q][0],D[Q][1],Q];return this.m=K,this.n=b,this.vertices=e,this.vertByDist=m,this.cartesian=t,this.min=T,this.max=F,this}}class YK{constructor(K,b,e,z){this.name=K,this.category=b,this.vertex=e,this.face=z}}class AK extends YK{innerToData(K,b){for(let e=0;e<b.innerFacets.length;e++)this.face.push(b.innerFacets[e].map((e=>b.vecToidx[K+e])))}mapABOBtoDATA(K,b){const e=b.IDATA.edgematch[K][0];for(let z=0;z<b.isoVecsABOB.length;z++){const k=[];for(let j=0;j<3;j++)0===b.vertexTypes[z][j]?k.push(K+"|"+b.isoVecsABOB[z][j].x+"|"+b.isoVecsABOB[z][j].y):k.push(e+"|"+b.isoVecsABOB[z][j].x+"|"+b.isoVecsABOB[z][j].y);this.face.push([b.vecToidx[k[0]],b.vecToidx[k[1]],b.vecToidx[k[2]]])}}mapOBOAtoDATA(K,b){const e=b.IDATA.edgematch[K][0];for(let z=0;z<b.isoVecsOBOA.length;z++){const k=[];for(let j=0;j<3;j++)1===b.vertexTypes[z][j]?k.push(K+"|"+b.isoVecsOBOA[z][j].x+"|"+b.isoVecsOBOA[z][j].y):k.push(e+"|"+b.isoVecsOBOA[z][j].x+"|"+b.isoVecsOBOA[z][j].y);this.face.push([b.vecToidx[k[0]],b.vecToidx[k[1]],b.vecToidx[k[2]]])}}mapBAOAtoDATA(K,b){const e=b.IDATA.edgematch[K][2];for(let z=0;z<b.isoVecsBAOA.length;z++){const k=[];for(let j=0;j<3;j++)1===b.vertexTypes[z][j]?k.push(K+"|"+b.isoVecsBAOA[z][j].x+"|"+b.isoVecsBAOA[z][j].y):k.push(e+"|"+b.isoVecsBAOA[z][j].x+"|"+b.isoVecsBAOA[z][j].y);this.face.push([b.vecToidx[k[0]],b.vecToidx[k[1]],b.vecToidx[k[2]]])}}orderData(K){const b=[];for(let j=0;j<13;j++)b[j]=[];const e=K.closestTo;for(let j=0;j<e.length;j++)e[j][0]>-1?e[j][1]>0&&b[e[j][0]].push([j,e[j][1]]):b[12].push([j,e[j][0]]);const z=[];for(let j=0;j<12;j++)z[j]=j;let k=12;for(let j=0;j<12;j++){b[j].sort(((K,b)=>K[1]-b[1]));for(let K=0;K<b[j].length;K++)z[b[j][K][0]]=k++}for(let j=0;j<b[12].length;j++)z[b[12][j][0]]=k++;for(let j=0;j<this.vertex.length;j++)this.vertex[j].push(z[j]);this.vertex.sort(((K,b)=>K[3]-b[3]));for(let j=0;j<this.vertex.length;j++)this.vertex[j].pop();for(let j=0;j<this.face.length;j++)for(let K=0;K<this.face[j].length;K++)this.face[j][K]=z[this.face[j][K]];this.sharedNodes=b[12].length,this.poleNodes=this.vertex.length-this.sharedNodes}setOrder(K,b){const e=[],z=[];let k=b.pop();z.push(k);let j=this.face[k].indexOf(K);j=(j+2)%3;let T=this.face[k][j];e.push(T);let F=0;for(;b.length>0;)k=b[F],this.face[k].indexOf(T)>-1?(j=(this.face[k].indexOf(T)+1)%3,T=this.face[k][j],e.push(T),z.push(k),b.splice(F,1),F=0):F++;return this.adjacentFaces.push(e),z}toGoldbergPolyhedronData(){const K=new YK("GeoDual","Goldberg",[],[]);K.name="GD dual";const b=this.vertex.length,e=new Array(b);for(let l=0;l<b;l++)e[l]=[];for(let l=0;l<this.face.length;l++)for(let K=0;K<3;K++)e[this.face[l][K]].push(l);let z=0,k=0,j=0,T=[],F=[];this.adjacentFaces=[];for(let l=0;l<e.length;l++)K.face[l]=this.setOrder(l,e[l].concat([])),e[l].forEach((b=>{z=0,k=0,j=0,T=this.face[b];for(let K=0;K<3;K++)F=this.vertex[T[K]],z+=F[0],k+=F[1],j+=F[2];K.vertex[b]=[z/3,k/3,j/3]}));return K}static BuildGeodesicData(K){const b=new AK("Geodesic-m-n","Geodesic",[[0,w.d,-1],[-w.d,1,0],[-1,0,-w.d],[1,0,-w.d],[w.d,1,0],[0,w.d,1],[-1,0,w.d],[-w.d,-1,0],[0,-w.d,-1],[w.d,-1,0],[1,0,w.d],[0,-w.d,1]],[]);K.setIndices(),K.calcCoeffs(),K.createInnerFacets(),K.edgeVecsABOB(),K.mapABOBtoOBOA(),K.mapABOBtoBAOA();for(let e=0;e<K.IDATA.face.length;e++)K.MapToFace(e,b),b.innerToData(e,K),"B"===K.IDATA.edgematch[e][1]&&b.mapABOBtoDATA(e,K),"O"===K.IDATA.edgematch[e][1]&&b.mapOBOAtoDATA(e,K),"A"===K.IDATA.edgematch[e][3]&&b.mapBAOAtoDATA(e,K);b.orderData(K);return b.vertex=b.vertex.map((function(K){const b=K[0],e=K[1],z=K[2],k=Math.sqrt(b*b+e*e+z*z);return K[0]*=1/k,K[1]*=1/k,K[2]*=1/k,K})),b}}k.b._GoldbergMeshParser=(K,b)=>XK.Parse(K,b);class XK extends k.b{constructor(){super(...arguments),this.goldbergData={faceColors:[],faceCenters:[],faceZaxis:[],faceXaxis:[],faceYaxis:[],nbSharedFaces:0,nbUnsharedFaces:0,nbFaces:0,nbFacesAtPole:0,adjacentFaces:[]}}relatedGoldbergFace(K,b){return void 0===b?(K>this.goldbergData.nbUnsharedFaces-1&&(c.b.Warn("Maximum number of unshared faces used"),K=this.goldbergData.nbUnsharedFaces-1),this.goldbergData.nbUnsharedFaces+K):(K>11&&(c.b.Warn("Last pole used"),K=11),b>this.goldbergData.nbFacesAtPole-1&&(c.b.Warn("Maximum number of faces at a pole used"),b=this.goldbergData.nbFacesAtPole-1),12+K*this.goldbergData.nbFacesAtPole+b)}_changeGoldbergFaceColors(K){for(let e=0;e<K.length;e++){const b=K[e][0],z=K[e][1],k=K[e][2];for(let K=b;K<z+1;K++)this.goldbergData.faceColors[K]=k}const b=[];for(let e=0;e<12;e++)for(let K=0;K<5;K++)b.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);for(let e=12;e<this.goldbergData.faceColors.length;e++)for(let K=0;K<6;K++)b.push(this.goldbergData.faceColors[e].r,this.goldbergData.faceColors[e].g,this.goldbergData.faceColors[e].b,this.goldbergData.faceColors[e].a);return b}setGoldbergFaceColors(K){const b=this._changeGoldbergFaceColors(K);this.Ga(j.f.ColorKind,b)}updateGoldbergFaceColors(K){const b=this._changeGoldbergFaceColors(K);this.updateVerticesData(j.f.ColorKind,b)}_changeGoldbergFaceUVs(K){const b=this.getVerticesData(j.f.UVKind);for(let e=0;e<K.length;e++){const z=K[e][0],k=K[e][1],j=K[e][2],T=K[e][3],F=K[e][4],l=[],Y=[];let A,X;for(let K=0;K<5;K++)A=j.x+T*Math.cos(F+K*Math.PI/2.5),X=j.y+T*Math.sin(F+K*Math.PI/2.5),A<0&&(A=0),A>1&&(A=1),l.push(A,X);for(let K=0;K<6;K++)A=j.x+T*Math.cos(F+K*Math.PI/3),X=j.y+T*Math.sin(F+K*Math.PI/3),A<0&&(A=0),A>1&&(A=1),Y.push(A,X);for(let K=z;K<Math.min(12,k+1);K++)for(let e=0;e<5;e++)b[10*K+2*e]=l[2*e],b[10*K+2*e+1]=l[2*e+1];for(let K=Math.max(12,z);K<k+1;K++)for(let e=0;e<6;e++)b[12*K-24+2*e]=Y[2*e],b[12*K-23+2*e]=Y[2*e+1]}return b}setGoldbergFaceUVs(K){const b=this._changeGoldbergFaceUVs(K);this.Ga(j.f.UVKind,b)}updateGoldbergFaceUVs(K){const b=this._changeGoldbergFaceUVs(K);this.updateVerticesData(j.f.UVKind,b)}placeOnGoldbergFaceAt(K,b,e){const k=z.k.RotationFromAxis(this.goldbergData.faceXaxis[b],this.goldbergData.faceYaxis[b],this.goldbergData.faceZaxis[b]);K.rotation=k,K.position=this.goldbergData.faceCenters[b].add(this.goldbergData.faceXaxis[b].scale(e.x)).add(this.goldbergData.faceYaxis[b].scale(e.y)).add(this.goldbergData.faceZaxis[b].scale(e.z))}serialize(K){super.serialize(K),K.type="GoldbergMesh";const b={};if(b.adjacentFaces=this.goldbergData.adjacentFaces,b.nbSharedFaces=this.goldbergData.nbSharedFaces,b.nbUnsharedFaces=this.goldbergData.nbUnsharedFaces,b.nbFaces=this.goldbergData.nbFaces,b.nbFacesAtPole=this.goldbergData.nbFacesAtPole,this.goldbergData.faceColors){b.faceColors=[];for(const K of this.goldbergData.faceColors)b.faceColors.push(K.Ti())}if(this.goldbergData.faceCenters){b.faceCenters=[];for(const K of this.goldbergData.faceCenters)b.faceCenters.push(K.Ti())}if(this.goldbergData.faceZaxis){b.faceZaxis=[];for(const K of this.goldbergData.faceZaxis)b.faceZaxis.push(K.Ti())}if(this.goldbergData.faceYaxis){b.faceYaxis=[];for(const K of this.goldbergData.faceYaxis)b.faceYaxis.push(K.Ti())}if(this.goldbergData.faceXaxis){b.faceXaxis=[];for(const K of this.goldbergData.faceXaxis)b.faceXaxis.push(K.Ti())}K.goldbergData=b}static Parse(K,b){const e=K.goldbergData;e.faceColors=e.faceColors.map((K=>t.g.Bg(K))),e.faceCenters=e.faceCenters.map((K=>z.k.Bg(K))),e.faceZaxis=e.faceZaxis.map((K=>z.k.Bg(K))),e.faceXaxis=e.faceXaxis.map((K=>z.k.Bg(K))),e.faceYaxis=e.faceYaxis.map((K=>z.k.Bg(K)));const k=new XK(K.name,b);return k.goldbergData=e,k}}var tK=e(11286);class UK{constructor(K){this._paths=[],this._tempPaths=[],this._holes=[],this._resolution=K}moveTo(K,b){this._currentPath=new v.f(K,b),this._tempPaths.push(this._currentPath)}lineTo(K,b){this._currentPath.addLineTo(K,b)}quadraticCurveTo(K,b,e,z){this._currentPath.addQuadraticCurveTo(K,b,e,z,this._resolution)}bezierCurveTo(K,b,e,z,k,j){this._currentPath.addBezierCurveTo(K,b,e,z,k,j,this._resolution)}extractHoles(){for(const K of this._tempPaths)K.area()>0?this._holes.push(K):this._paths.push(K);if(!this._paths.length&&this._holes.length){const K=this._holes;this._holes=this._paths,this._paths=K}this._tempPaths.length=0}get paths(){return this._paths}get holes(){return this._holes}}function BK(K,b,e,z,k,j){const T=j.glyphs[K]||j.glyphs["?"];if(!T)return null;const F=new UK(k);if(T.o){const K=T.o.split(" ");for(let k=0,j=K.length;k<j;){switch(K[k++]){case"m":{const j=parseInt(K[k++])*b+e,T=parseInt(K[k++])*b+z;F.moveTo(j,T);break}case"l":{const j=parseInt(K[k++])*b+e,T=parseInt(K[k++])*b+z;F.lineTo(j,T);break}case"q":{const j=parseInt(K[k++])*b+e,T=parseInt(K[k++])*b+z,l=parseInt(K[k++])*b+e,Y=parseInt(K[k++])*b+z;F.quadraticCurveTo(l,Y,j,T);break}case"b":{const j=parseInt(K[k++])*b+e,T=parseInt(K[k++])*b+z,l=parseInt(K[k++])*b+e,Y=parseInt(K[k++])*b+z,A=parseInt(K[k++])*b+e,X=parseInt(K[k++])*b+z;F.bezierCurveTo(l,Y,A,X,j,T);break}}}}return F.extractHoles(),{offsetX:T.ha*b,shapePath:F}}const uK={CreateBox:X.e,CreateTiledBox:m,CreateSphere:D.e,CreateDisc:A.e,CreateIcoSphere:W,CreateRibbon:Y,CreateCylinder:G,CreateTorus:S,CreateTorusKnot:r,CreateLineSystem:L.e,rb:L.g,CreateDashedLines:L.d,ExtrudeShape:O,ExtrudeShapeCustom:g,CreateLathe:Z,CreateTiledPlane:B,Vf:y.c,CreateGround:s.e,CreateTiledGround:s.g,CreateGroundFromHeightMap:s.d,CreatePolygon:p,ExtrudePolygon:a,CreateTube:E,CreatePolyhedron:C,CreateGeodesic:function(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=b.m||1;z!==Math.floor(z)&&(z=Math.floor(z),c.b.Warn("m not an integer only floor(m) used"));let k=b.n||0;if(k!==Math.floor(k)&&(k=Math.floor(k),c.b.Warn("n not an integer only floor(n) used")),k>z){const K=k;k=z,z=K,c.b.Warn("n > m therefore m and n swapped")}const j=new lK;return j.build(z,k),C(K,{custom:AK.BuildGeodesicData(j),size:b.size,sizeX:b.sizeX,sizeY:b.sizeY,sizeZ:b.sizeZ,faceUV:b.faceUV,faceColors:b.faceColors,flat:b.flat,updatable:b.updatable,sideOrientation:b.sideOrientation,frontUVs:b.frontUVs,backUVs:b.backUVs},e)},CreateGoldberg:function(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const j=b.size,l=b.sizeX||j||1,Y=b.sizeY||j||1,A=b.sizeZ||j||1;let X=b.m||1;X!==Math.floor(X)&&(X=Math.floor(X),c.b.Warn("m not an integer only floor(m) used"));let U=b.n||0;if(U!==Math.floor(U)&&(U=Math.floor(U),c.b.Warn("n not an integer only floor(n) used")),U>X){const K=U;U=X,X=K,c.b.Warn("n > m therefore m and n swapped")}const B=new lK;B.build(X,U);const u=AK.BuildGeodesicData(B),m=u.toGoldbergPolyhedronData(),D=new XK(K,e);b.sideOrientation=k.b._GetDefaultSideOrientation(b.sideOrientation),D._originalBuilderSideOrientation=b.sideOrientation;(function(K,b){const e=K.size,k=K.sizeX||e||1,j=K.sizeY||e||1,l=K.sizeZ||e||1,Y=0===K.sideOrientation?0:K.sideOrientation||T.e.DEFAULTSIDE,A=[],X=[],t=[],U=[];let B=1/0,u=-1/0,m=1/0,D=-1/0;for(let z=0;z<b.vertex.length;z++)B=Math.min(B,b.vertex[z][0]*k),u=Math.max(u,b.vertex[z][0]*k),m=Math.min(m,b.vertex[z][1]*j),D=Math.max(D,b.vertex[z][1]*j);let I=0;for(let T=0;T<b.face.length;T++){const K=b.face[T],e=z.k.Bg(b.vertex[K[0]]),Y=z.k.Bg(b.vertex[K[2]]),x=z.k.Bg(b.vertex[K[1]]),Q=Y.Qc(e),G=x.Qc(e),i=z.k.Cross(G,Q).normalize();for(let z=0;z<K.length;z++){t.push(i.x,i.y,i.z);const e=b.vertex[K[z]];A.push(e[0]*k,e[1]*j,e[2]*l);const T=(e[1]*j-m)/(D-m);U.push((e[0]*k-B)/(u-B),F.c?1-T:T)}for(let b=0;b<K.length-2;b++)X.push(I,I+b+2,I+b+1);I+=K.length}T.e._ComputeSides(Y,A,X,t,U);const x=new T.e;return x.xa=A,x.indices=X,x.ya=t,x.Aa=U,x})(b,m).Ca(D,b.updatable),D.goldbergData.nbSharedFaces=u.sharedNodes,D.goldbergData.nbUnsharedFaces=u.poleNodes,D.goldbergData.adjacentFaces=u.adjacentFaces,D.goldbergData.nbFaces=D.goldbergData.nbSharedFaces+D.goldbergData.nbUnsharedFaces,D.goldbergData.nbFacesAtPole=(D.goldbergData.nbUnsharedFaces-12)/12;for(let k=0;k<u.vertex.length;k++)D.goldbergData.faceCenters.push(z.k.Bg(u.vertex[k])),D.goldbergData.faceCenters[k].x*=l,D.goldbergData.faceCenters[k].y*=Y,D.goldbergData.faceCenters[k].z*=A,D.goldbergData.faceColors.push(new t.g(1,1,1,1));for(let k=0;k<m.face.length;k++){const K=m.face[k],b=z.k.Bg(m.vertex[K[0]]),e=z.k.Bg(m.vertex[K[2]]),j=z.k.Bg(m.vertex[K[1]]),T=e.Qc(b),F=j.Qc(b),l=z.k.Cross(F,T).normalize(),Y=z.k.Cross(F,l).normalize();D.goldbergData.faceXaxis.push(F.normalize()),D.goldbergData.faceYaxis.push(l),D.goldbergData.faceZaxis.push(Y)}return D},CreateDecal:kK,CreateCapsule:TK,CreateText:function(K,b,e){let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{size:50,resolution:8,depth:1},T=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:earcut;const l=function(K,b,e,z){const k=Array.from(K),j=b/z.resolution,T=(z.boundingBox.yMax-z.boundingBox.yMin+z.underlineThickness)*j,F=[];let l=0,Y=0;for(let A=0;A<k.length;A++){const K=k[A];if("\n"===K)l=0,Y-=T;else{const b=BK(K,j,l,Y,e,z);b&&(l+=b.offsetX,F.push(b.shapePath))}}return F}(b,j.size||50,j.resolution||8,e),Y=[];let A=0;for(const B of l){if(!B.paths.length)continue;const b=B.holes.slice();for(const e of B.paths){var X,t;const l=[],U=[],B=e.getPoints();for(const K of B)U.push(new z.k(K.x,0,K.y));const u=b.slice();for(const K of u){const k=K.getPoints();let j=!1;for(const K of k)if(e.isPointInside(K)){j=!0;break}if(!j)continue;const T=[];for(const K of k)T.push(new z.k(K.x,0,K.y));l.push(T),b.splice(b.indexOf(K),1)}if(!l.length&&b.length)for(const K of b){const b=K.getPoints(),e=[];for(const K of b)e.push(new z.k(K.x,0,K.y));l.push(e)}const m=a(K,{shape:U,holes:l.length?l:void 0,depth:j.depth||1,faceUV:j.faceUV||(null===(X=j.perLetterFaceUV)||void 0===X?void 0:X.call(j,A)),faceColors:j.faceColors||(null===(t=j.perLetterFaceColors)||void 0===t?void 0:t.call(j,A)),sideOrientation:k.b._GetDefaultSideOrientation(j.sideOrientation||k.b.DOUBLESIDE)},T,F);Y.push(m),A++}}const U=k.b.MergeMeshes(Y,!0,!0);if(U){const b=U.getBoundingInfo().boundingBox;U.position.x+=-(b.minimumWorld.x+b.maximumWorld.x)/2,U.position.y+=-(b.minimumWorld.y+b.maximumWorld.y)/2,U.position.z+=-(b.minimumWorld.z+b.maximumWorld.z)/2+b.extendSize.z,U.name=K;const e=new tK.c("pivot",T);e.rotation.x=-Math.PI/2,U.parent=e,U.bakeCurrentTransformIntoVertices(),U.parent=null,e.dispose()}return U}}},11089:(K,b,e)=>{"use strict";e.d(b,{e:()=>l});var z=e(11030),k=e(11096),j=e(11100),T=e(11117),F=e(11125);class l{get materialDefines(){var K;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.defines:null===(K=this._getDrawWrapper())||void 0===K?void 0:K.defines}set materialDefines(K){(this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)).defines=K}_getDrawWrapper(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K=K??this._engine.currentRenderPassId;let e=this._drawWrappers[K];return!e&&b&&(this._drawWrappers[K]=e=new F.b(this._mesh.va().getEngine())),e}_removeDrawWrapper(K){var b;arguments.length>1&&void 0!==arguments[1]&&!arguments[1]||(null===(b=this._drawWrappers[K])||void 0===b||b.dispose());this._drawWrappers[K]=void 0}get effect(){var K;return this._mainDrawWrapperOverride?this._mainDrawWrapperOverride.effect:(null===(K=this._getDrawWrapper())||void 0===K?void 0:K.effect)??null}get _drawWrapper(){return this._mainDrawWrapperOverride??this._getDrawWrapper(void 0,!0)}get _drawWrapperOverride(){return this._mainDrawWrapperOverride}_setMainDrawWrapperOverride(K){this._mainDrawWrapperOverride=K}setEffect(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2?arguments[2]:void 0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const k=this._drawWrapper;k.setEffect(K,b,z),void 0!==e&&(k.materialContext=e),K||(k.defines=null,k.materialContext=void 0)}resetDrawCache(K){if(this._drawWrappers){if(void 0!==K)return void this._removeDrawWrapper(K);for(const K of this._drawWrappers)null===K||void 0===K||K.dispose()}this._drawWrappers=[]}static AddToMesh(K,b,e,z,k,j,T){return new l(K,b,e,z,k,j,T,!(arguments.length>7&&void 0!==arguments[7])||arguments[7])}constructor(K,b,e,z,k,j,T){let F=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8];this.materialIndex=K,this.verticesStart=b,this.verticesCount=e,this.indexStart=z,this.indexCount=k,this._mainDrawWrapperOverride=null,this._linesIndexCount=0,this._linesIndexBuffer=null,this._lastColliderWorldVertices=null,this._lastColliderTransformMatrix=null,this._wasDispatched=!1,this._renderId=0,this._alphaIndex=0,this._distanceToCamera=0,this._currentMaterial=null,this._mesh=j,this._renderingMesh=T||j,l&&j.Rf.push(this),this._engine=this._mesh.va().getEngine(),this.resetDrawCache(),this._trianglePlanes=[],this._id=j.Rf.length-1,F&&(this.refreshBoundingInfo(),j.xj(!0))}get IsGlobal(){return 0===this.verticesStart&&this.verticesCount===this._mesh.getTotalVertices()&&0===this.indexStart&&this.indexCount===this._mesh.getTotalIndices()}getBoundingInfo(){return this.IsGlobal||this._mesh.hasThinInstances?this._mesh.getBoundingInfo():this._boundingInfo}setBoundingInfo(K){return this._boundingInfo=K,this}getMesh(){return this._mesh}getRenderingMesh(){return this._renderingMesh}getReplacementMesh(){return this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null}getEffectiveMesh(){const K=this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:null;return K||this._renderingMesh}Ha(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const b=this._renderingMesh.getMaterialForRenderPass(this._engine.currentRenderPassId)??this._renderingMesh.material;if(!b)return K?this._mesh.va().defaultMaterial:null;if(this._isMultiMaterial(b)){const K=b.getSubMaterial(this.materialIndex);return this._currentMaterial!==K&&(this._currentMaterial=K,this.resetDrawCache()),K}return b}_isMultiMaterial(K){return void 0!==K.getSubMaterial}refreshBoundingInfo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._lastColliderWorldVertices=null,this.IsGlobal||!this._renderingMesh||!this._renderingMesh.mj)return this;if(K||(K=this._renderingMesh.getVerticesData(z.f.PositionKind)),!K)return this._boundingInfo=this._mesh.getBoundingInfo(),this;const b=this._renderingMesh.Lf();let e;if(0===this.indexStart&&this.indexCount===b.length){const K=this._renderingMesh.getBoundingInfo();e={minimum:K.minimum.clone(),maximum:K.maximum.clone()}}else e=(0,T.d)(K,b,this.indexStart,this.indexCount,this._renderingMesh.mj.boundingBias);return this._boundingInfo?this._boundingInfo.reConstruct(e.minimum,e.maximum):this._boundingInfo=new j.b(e.minimum,e.maximum),this}_checkCollision(K){return this.getBoundingInfo()._checkCollision(K)}updateBoundingInfo(K){let b=this.getBoundingInfo();return b||(this.refreshBoundingInfo(),b=this.getBoundingInfo()),b&&b.update(K),this}isInFrustum(K){const b=this.getBoundingInfo();return!!b&&b.isInFrustum(K,this._mesh.li)}isCompletelyInFrustum(K){const b=this.getBoundingInfo();return!!b&&b.isCompletelyInFrustum(K)}render(K){return this._renderingMesh.render(this,K,this._mesh._internalAbstractMeshDataInfo._actAsRegularMesh?this._mesh:void 0),this}_getLinesIndexBuffer(K,b){if(!this._linesIndexBuffer){const e=[];for(let b=this.indexStart;b<this.indexStart+this.indexCount;b+=3)e.push(K[b],K[b+1],K[b+1],K[b+2],K[b+2],K[b]);this._linesIndexBuffer=b.createIndexBuffer(e),this._linesIndexCount=e.length}return this._linesIndexBuffer}canIntersects(K){const b=this.getBoundingInfo();return!!b&&K.intersectsBox(b.boundingBox)}intersects(K,b,e,z,k){const j=this.Ha();if(!j)return null;let T=3,F=!1;switch(j.fillMode){case 3:case 5:case 6:case 8:return null;case 7:T=1,F=!0}return 4===j.fillMode?e.length?this._intersectLines(K,b,e,this._mesh.intersectionThreshold,z):this._intersectUnIndexedLines(K,b,e,this._mesh.intersectionThreshold,z):!e.length&&this._mesh._unIndexed?this._intersectUnIndexedTriangles(K,b,e,z,k):this._intersectTriangles(K,b,e,T,F,z,k)}_intersectLines(K,b,e,z,j){let T=null;for(let F=this.indexStart;F<this.indexStart+this.indexCount;F+=2){const l=b[e[F]],Y=b[e[F+1]],A=K.intersectionSegment(l,Y,z);if(!(A<0)&&((j||!T||A<T.distance)&&(T=new k.d(null,null,A),T.faceId=F/2,j)))break}return T}_intersectUnIndexedLines(K,b,e,z,j){let T=null;for(let F=this.verticesStart;F<this.verticesStart+this.verticesCount;F+=2){const e=b[F],l=b[F+1],Y=K.intersectionSegment(e,l,z);if(!(Y<0)&&((j||!T||Y<T.distance)&&(T=new k.d(null,null,Y),T.faceId=F/2,j)))break}return T}_intersectTriangles(K,b,e,z,k,j,T){let F=null,l=-1;for(let Y=this.indexStart;Y<this.indexStart+this.indexCount-(3-z);Y+=z){l++;const z=e[Y],A=e[Y+1],X=e[Y+2];if(k&&4294967295===X){Y+=2;continue}const t=b[z],U=b[A],B=b[X];if(!t||!U||!B)continue;if(T&&!T(t,U,B,K,z,A,X))continue;const u=K.intersectsTriangle(t,U,B);if(u){if(u.distance<0)continue;if((j||!F||u.distance<F.distance)&&(F=u,F.faceId=l,j))break}}return F}_intersectUnIndexedTriangles(K,b,e,z,k){let j=null;for(let T=this.verticesStart;T<this.verticesStart+this.verticesCount;T+=3){const e=b[T],F=b[T+1],l=b[T+2];if(k&&!k(e,F,l,K,-1,-1,-1))continue;const Y=K.intersectsTriangle(e,F,l);if(Y){if(Y.distance<0)continue;if((z||!j||Y.distance<j.distance)&&(j=Y,j.faceId=T/3,z))break}}return j}_rebuild(){this._linesIndexBuffer&&(this._linesIndexBuffer=null)}clone(K,b){const e=new l(this.materialIndex,this.verticesStart,this.verticesCount,this.indexStart,this.indexCount,K,b,!1);if(!this.IsGlobal){const K=this.getBoundingInfo();if(!K)return e;e._boundingInfo=new j.b(K.minimum,K.maximum)}return e}dispose(){this._linesIndexBuffer&&(this._mesh.va().getEngine()._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null);const K=this._mesh.Rf.indexOf(this);this._mesh.Rf.splice(K,1),this.resetDrawCache()}getClassName(){return"SubMesh"}static CreateFromIndices(K,b,e,z,k){let j=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],T=Number.MAX_VALUE,F=-Number.MAX_VALUE;const Y=(k||z).Lf();for(let l=b;l<b+e;l++){const K=Y[l];K<T&&(T=K),K>F&&(F=K)}return new l(K,T,F-T+1,b,e,z,k,j)}}},11977:(K,b,e)=>{"use strict";var z=e(11226),k=e(11030),j=e(10967),T=e(10696),F=e(11100);z.b.prototype.thinInstanceAdd=function(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.va().getEngine().getCaps().instancedArrays)return T.b.Error("Thin Instances are not supported on this device as Instanced Array extension not supported"),-1;this._thinInstanceUpdateBufferSize("matrix",Array.isArray(K)?K.length:1);const e=this._thinInstanceDataStorage.instancesCount;if(Array.isArray(K))for(let z=0;z<K.length;++z)this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,K[z],z===K.length-1&&b);else this.thinInstanceSetMatrixAt(this._thinInstanceDataStorage.instancesCount++,K,b);return e},z.b.prototype.thinInstanceAddSelf=function(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.thinInstanceAdd(j.b.IdentityReadOnly,K)},z.b.prototype.thinInstanceRegisterAttribute=function(K,b){K===k.f.ColorKind&&(K=k.f.ColorInstanceKind),this.removeVerticesData(K),this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.strides[K]=b,this._userThinInstanceBuffersStorage.sizes[K]=b*Math.max(32,this._thinInstanceDataStorage.instancesCount),this._userThinInstanceBuffersStorage.data[K]=new Float32Array(this._userThinInstanceBuffersStorage.sizes[K]),this._userThinInstanceBuffersStorage.vertexBuffers[K]=new k.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[K],K,!0,!1,b,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[K])},z.b.prototype.thinInstanceSetMatrixAt=function(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!this._thinInstanceDataStorage.matrixData||K>=this._thinInstanceDataStorage.instancesCount)return!1;const z=this._thinInstanceDataStorage.matrixData;return b.copyToArray(z,16*K),this._thinInstanceDataStorage.worldMatrices&&(this._thinInstanceDataStorage.worldMatrices[K]=b),e&&(this.Tb("matrix"),this.Da||this.thinInstanceRefreshBoundingInfo(!1)),!0},z.b.prototype.thinInstanceSetAttributeAt=function(K,b,e){let z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return K===k.f.ColorKind&&(K=k.f.ColorInstanceKind),!(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.data[K]||b>=this._thinInstanceDataStorage.instancesCount)&&(this._thinInstanceUpdateBufferSize(K,0),this._userThinInstanceBuffersStorage.data[K].set(e,b*this._userThinInstanceBuffersStorage.strides[K]),z&&this.Tb(K),!0)},Object.defineProperty(z.b.prototype,"Rb",{get:function(){return this._thinInstanceDataStorage.instancesCount},set:function(K){var b;const e=this._thinInstanceDataStorage.matrixData??(null===(b=this.source)||void 0===b?void 0:b._thinInstanceDataStorage.matrixData);K<=(e?e.length/16:0)&&(this._thinInstanceDataStorage.instancesCount=K)},enumerable:!0,configurable:!0}),z.b.prototype._thinInstanceCreateMatrixBuffer=function(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=new k.b(this.getEngine(),b,!e,16,!1,!0);for(let k=0;k<4;k++)this.setVerticesBuffer(z.createVertexBuffer(K+k,4*k,4));return z},z.b.prototype.Nb=function(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];var j;if(e=e||16,"matrix"===K)null===(j=this._thinInstanceDataStorage.matrixBuffer)||void 0===j||j.dispose(),this._thinInstanceDataStorage.matrixBuffer=null,this._thinInstanceDataStorage.matrixBufferSize=b?b.length:32*e,this._thinInstanceDataStorage.matrixData=b,this._thinInstanceDataStorage.worldMatrices=null,null!==b?(this._thinInstanceDataStorage.instancesCount=b.length/e,this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",b,z),this.Da||this.thinInstanceRefreshBoundingInfo(!1)):(this._thinInstanceDataStorage.instancesCount=0,this.Da||this.refreshBoundingInfo());else if("previousMatrix"===K){var T;null===(T=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===T||T.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=null,this._thinInstanceDataStorage.previousMatrixData=b,null!==b&&(this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",b,z))}else{var F;if(K===k.f.ColorKind&&(K=k.f.ColorInstanceKind),null===b)null!==(F=this._userThinInstanceBuffersStorage)&&void 0!==F&&F.data[K]&&(this.removeVerticesData(K),delete this._userThinInstanceBuffersStorage.data[K],delete this._userThinInstanceBuffersStorage.strides[K],delete this._userThinInstanceBuffersStorage.sizes[K],delete this._userThinInstanceBuffersStorage.vertexBuffers[K]);else this._thinInstanceInitializeUserStorage(),this._userThinInstanceBuffersStorage.data[K]=b,this._userThinInstanceBuffersStorage.strides[K]=e,this._userThinInstanceBuffersStorage.sizes[K]=b.length,this._userThinInstanceBuffersStorage.vertexBuffers[K]=new k.f(this.getEngine(),b,K,!z,!1,e,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[K])}},z.b.prototype.Tb=function(K){var b;if("matrix"===K)this.vj&&this._thinInstanceDataStorage.matrixBuffer&&!this._thinInstanceDataStorage.matrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(K),null===(b=this._thinInstanceDataStorage.matrixBuffer)||void 0===b||b.updateDirectly(this._thinInstanceDataStorage.matrixData,0,this._thinInstanceDataStorage.instancesCount);else if("previousMatrix"===K){var e;this.vj&&this._thinInstanceDataStorage.previousMatrixBuffer&&!this._thinInstanceDataStorage.previousMatrixBuffer.isUpdatable()&&this._thinInstanceRecreateBuffer(K),null===(e=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===e||e.updateDirectly(this._thinInstanceDataStorage.previousMatrixData,0,this._thinInstanceDataStorage.instancesCount)}else{var z;K===k.f.ColorKind&&(K=k.f.ColorInstanceKind),null!==(z=this._userThinInstanceBuffersStorage)&&void 0!==z&&z.vertexBuffers[K]&&(this.vj&&!this._userThinInstanceBuffersStorage.vertexBuffers[K].isUpdatable()&&this._thinInstanceRecreateBuffer(K),this._userThinInstanceBuffersStorage.vertexBuffers[K].updateDirectly(this._userThinInstanceBuffersStorage.data[K],0))}},z.b.prototype.thinInstancePartialBufferUpdate=function(K,b,e){var z;"matrix"===K?this._thinInstanceDataStorage.matrixBuffer&&this._thinInstanceDataStorage.matrixBuffer.updateDirectly(b,e):(K===k.f.ColorKind&&(K=k.f.ColorInstanceKind),null!==(z=this._userThinInstanceBuffersStorage)&&void 0!==z&&z.vertexBuffers[K]&&this._userThinInstanceBuffersStorage.vertexBuffers[K].updateDirectly(b,e))},z.b.prototype.thinInstanceGetWorldMatrices=function(){if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return[];const K=this._thinInstanceDataStorage.matrixData;if(!this._thinInstanceDataStorage.worldMatrices){this._thinInstanceDataStorage.worldMatrices=[];for(let b=0;b<this._thinInstanceDataStorage.instancesCount;++b)this._thinInstanceDataStorage.worldMatrices[b]=j.b.Bg(K,16*b)}return this._thinInstanceDataStorage.worldMatrices},z.b.prototype.thinInstanceRefreshBoundingInfo=function(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this._thinInstanceDataStorage.matrixData||!this._thinInstanceDataStorage.matrixBuffer)return;const z=this._thinInstanceDataStorage.boundingVectors;if(K||!this.rawBoundingInfo){z.length=0,this.refreshBoundingInfo(b,e);const K=this.getBoundingInfo();this.rawBoundingInfo=new F.b(K.minimum,K.maximum)}const k=this.getBoundingInfo(),T=this._thinInstanceDataStorage.matrixData;if(0===z.length)for(let j=0;j<k.boundingBox.vectors.length;++j)z.push(k.boundingBox.vectors[j].clone());j.e.gb[0].Wd(Number.POSITIVE_INFINITY),j.e.gb[1].Wd(Number.NEGATIVE_INFINITY);for(let F=0;F<this._thinInstanceDataStorage.instancesCount;++F){j.b.FromArrayToRef(T,16*F,j.e.Matrix[0]);for(let K=0;K<z.length;++K)j.k.TransformCoordinatesToRef(z[K],j.e.Matrix[0],j.e.gb[2]),j.e.gb[0].minimizeInPlace(j.e.gb[2]),j.e.gb[1].maximizeInPlace(j.e.gb[2])}k.reConstruct(j.e.gb[0],j.e.gb[1]),this.Ea()},z.b.prototype._thinInstanceRecreateBuffer=function(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var e;if("matrix"===K)null===(e=this._thinInstanceDataStorage.matrixBuffer)||void 0===e||e.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",this._thinInstanceDataStorage.matrixData,b);else if("previousMatrix"===K){var z;if(this._scene.needsPreviousWorldMatrices)null===(z=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===z||z.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",this._thinInstanceDataStorage.previousMatrixData??this._thinInstanceDataStorage.matrixData,b)}else{var j;K===k.f.ColorKind&&(K=k.f.ColorInstanceKind),null===(j=this._userThinInstanceBuffersStorage.vertexBuffers[K])||void 0===j||j.dispose(),this._userThinInstanceBuffersStorage.vertexBuffers[K]=new k.f(this.getEngine(),this._userThinInstanceBuffersStorage.data[K],K,!b,!1,this._userThinInstanceBuffersStorage.strides[K],!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[K])}},z.b.prototype._thinInstanceUpdateBufferSize=function(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;K===k.f.ColorKind&&(K=k.f.ColorInstanceKind);const e="matrix"===K;if(!e&&(!this._userThinInstanceBuffersStorage||!this._userThinInstanceBuffersStorage.strides[K]))return;const z=e?16:this._userThinInstanceBuffersStorage.strides[K],j=e?this._thinInstanceDataStorage.matrixBufferSize:this._userThinInstanceBuffersStorage.sizes[K];let T=e?this._thinInstanceDataStorage.matrixData:this._userThinInstanceBuffersStorage.data[K];const F=(this._thinInstanceDataStorage.instancesCount+b)*z;let l=j;for(;l<F;)l*=2;if(!T||j!=l){if(T){const K=new Float32Array(l);K.set(T,0),T=K}else T=new Float32Array(l);var Y,A,X;if(e){if(null===(Y=this._thinInstanceDataStorage.matrixBuffer)||void 0===Y||Y.dispose(),this._thinInstanceDataStorage.matrixBuffer=this._thinInstanceCreateMatrixBuffer("world",T,!1),this._thinInstanceDataStorage.matrixData=T,this._thinInstanceDataStorage.matrixBufferSize=l,this._scene.needsPreviousWorldMatrices&&!this._thinInstanceDataStorage.previousMatrixData)null===(A=this._thinInstanceDataStorage.previousMatrixBuffer)||void 0===A||A.dispose(),this._thinInstanceDataStorage.previousMatrixBuffer=this._thinInstanceCreateMatrixBuffer("previousWorld",T,!1)}else null===(X=this._userThinInstanceBuffersStorage.vertexBuffers[K])||void 0===X||X.dispose(),this._userThinInstanceBuffersStorage.data[K]=T,this._userThinInstanceBuffersStorage.sizes[K]=l,this._userThinInstanceBuffersStorage.vertexBuffers[K]=new k.f(this.getEngine(),T,K,!0,!1,z,!0),this.setVerticesBuffer(this._userThinInstanceBuffersStorage.vertexBuffers[K])}},z.b.prototype._thinInstanceInitializeUserStorage=function(){this._userThinInstanceBuffersStorage||(this._userThinInstanceBuffersStorage={data:{},sizes:{},vertexBuffers:{},strides:{}})},z.b.prototype._disposeThinInstanceSpecificData=function(){var K;null!==(K=this._thinInstanceDataStorage)&&void 0!==K&&K.matrixBuffer&&(this._thinInstanceDataStorage.matrixBuffer.dispose(),this._thinInstanceDataStorage.matrixBuffer=null)}},11286:(K,b,e)=>{"use strict";e.d(b,{c:()=>X});var z=e(10936),k=e(10938),j=e(11001),T=e(10690),F=e(10967),l=e(11243),Y=e(10799);const A=F.b.Compose(F.k.One(),F.d.FromEulerAngles(0,Math.PI,0),F.k.Zero());class X extends l.e{get billboardMode(){return this._billboardMode}set billboardMode(K){this._billboardMode!==K&&(this._billboardMode=K,this._cache.useBillboardPosition=0!==(this._billboardMode&X.BILLBOARDMODE_USE_POSITION),this._computeUseBillboardPath())}get preserveParentRotationForBillboard(){return this._preserveParentRotationForBillboard}set preserveParentRotationForBillboard(K){K!==this._preserveParentRotationForBillboard&&(this._preserveParentRotationForBillboard=K,this._computeUseBillboardPath())}_computeUseBillboardPath(){this._cache.useBillboardPath=this._billboardMode!==X.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}get infiniteDistance(){return this._infiniteDistance}set infiniteDistance(K){this._infiniteDistance!==K&&(this._infiniteDistance=K)}constructor(K){let b=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];super(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,!1),this._forward=new F.k(0,0,1),this._up=new F.k(0,1,0),this._right=new F.k(1,0,0),this._position=F.k.Zero(),this._rotation=F.k.Zero(),this._rotationQuaternion=null,this._scaling=F.k.One(),this._transformToBoneReferal=null,this._isAbsoluteSynced=!1,this._billboardMode=X.BILLBOARDMODE_NONE,this._preserveParentRotationForBillboard=!1,this.scalingDeterminant=1,this._infiniteDistance=!1,this.ignoreNonUniformScaling=!1,this.reIntegrateRotationIntoRotationQuaternion=!1,this._poseMatrix=null,this.zj=F.b.Zero(),this._usePivotMatrix=!1,this._absolutePosition=F.k.Zero(),this._absoluteScaling=F.k.Zero(),this._absoluteRotationQuaternion=F.d.Identity(),this._pivotMatrix=F.b.Identity(),this._postMultiplyPivotMatrix=!1,this._isWorldMatrixFrozen=!1,this._indexInSceneTransformNodesArray=-1,this.onAfterWorldMatrixUpdateObservable=new T.d,this._nonUniformScaling=!1,b&&this.va().addTransformNode(this)}getClassName(){return"sb"}get position(){return this._position}set position(K){this._position=K,this._markAsDirtyInternal()}isUsingPivotMatrix(){return this._usePivotMatrix}isUsingPostMultiplyPivotMatrix(){return this._postMultiplyPivotMatrix}get rotation(){return this._rotation}set rotation(K){this._rotation=K,this._rotationQuaternion=null,this._markAsDirtyInternal()}get Zd(){return this._scaling}set Zd(K){this._scaling=K,this._markAsDirtyInternal()}get rotationQuaternion(){return this._rotationQuaternion}set rotationQuaternion(K){this._rotationQuaternion=K,K&&this._rotation.Wd(0),this._markAsDirtyInternal()}_markAsDirtyInternal(){this._isDirty||(this._isDirty=!0,this.customMarkAsDirty&&this.customMarkAsDirty())}get forward(){return F.k.TransformNormalFromFloatsToRef(0,0,this.va().useRightHandedSystem?-1:1,this.getWorldMatrix(),this._forward),this._forward.normalize()}get up(){return F.k.TransformNormalFromFloatsToRef(0,1,0,this.getWorldMatrix(),this._up),this._up.normalize()}get right(){return F.k.TransformNormalFromFloatsToRef(this.va().useRightHandedSystem?-1:1,0,0,this.getWorldMatrix(),this._right),this._right.normalize()}updatePoseMatrix(K){return this._poseMatrix?(this._poseMatrix.p(K),this):(this._poseMatrix=K.clone(),this)}getPoseMatrix(){return this._poseMatrix||(this._poseMatrix=F.b.Identity()),this._poseMatrix}_isSynchronized(){const K=this._cache;return this._billboardMode===K.billboardMode&&this._billboardMode===X.BILLBOARDMODE_NONE&&(!K.pivotMatrixUpdated&&(!this._infiniteDistance&&(!this._position._isDirty&&(!this._scaling._isDirty&&!(this._rotationQuaternion&&this._rotationQuaternion._isDirty||this._rotation._isDirty)))))}_initCache(){super._initCache();const K=this._cache;K.localMatrixUpdated=!1,K.billboardMode=-1,K.infiniteDistance=!1,K.useBillboardPosition=!1,K.useBillboardPath=!1}get absolutePosition(){return this.getAbsolutePosition()}get absoluteScaling(){return this._syncAbsoluteScalingAndRotation(),this._absoluteScaling}get absoluteRotationQuaternion(){return this._syncAbsoluteScalingAndRotation(),this._absoluteRotationQuaternion}setPreTransformMatrix(K){return this.setPivotMatrix(K,!1)}setPivotMatrix(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._pivotMatrix.p(K),this._usePivotMatrix=!this._pivotMatrix.isIdentity(),this._cache.pivotMatrixUpdated=!0,this._postMultiplyPivotMatrix=b,this._postMultiplyPivotMatrix&&(this._pivotMatrixInverse?this._pivotMatrix.invertToRef(this._pivotMatrixInverse):this._pivotMatrixInverse=F.b.Invert(this._pivotMatrix)),this}getPivotMatrix(){return this._pivotMatrix}instantiateHierarchy(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const z=this.clone("Clone of "+(this.name||this.id),K||this.parent,!0);z&&e&&e(this,z);for(const k of this.getChildTransformNodes(!0))k.instantiateHierarchy(z,b,e);return z}uc(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return K?arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(this._rotation.Wd(0),this._rotationQuaternion=this._rotationQuaternion||F.d.Identity(),K.decompose(this._scaling,this._rotationQuaternion,this._position),this.xj(!0)):(this._worldMatrix=K,this._absolutePosition.Yd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._afterComputeWorldMatrix()):(this._isWorldMatrixFrozen=!1,this.xj(!0)),this._isDirty=!1,this._isWorldMatrixFrozen=!0,this}unfreezeWorldMatrix(){return this._isWorldMatrixFrozen=!1,this.xj(!0),this}get $i(){return this._isWorldMatrixFrozen}getAbsolutePosition(){return this.xj(),this._absolutePosition}setAbsolutePosition(K){if(!K)return this;let b,e,z;if(void 0===K.x){if(arguments.length<3)return this;b=arguments[0],e=arguments[1],z=arguments[2]}else b=K.x,e=K.y,z=K.z;if(this.parent){const K=F.e.Matrix[0];this.parent.getWorldMatrix().invertToRef(K),F.k.TransformCoordinatesFromFloatsToRef(b,e,z,K,this.position)}else this.position.x=b,this.position.y=e,this.position.z=z;return this._absolutePosition.p(K),this}setPositionWithLocalVector(K){return this.xj(),this.position=F.k.TransformNormal(K,this.zj),this}getPositionExpressedInLocalSpace(){this.xj();const K=F.e.Matrix[0];return this.zj.invertToRef(K),F.k.TransformNormal(this.position,K)}locallyTranslate(K){return this.xj(!0),this.position=F.k.TransformCoordinates(K,this.zj),this}lookAt(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;const j=X._LookAtVectorCache,T=0===k?this.position:this.getAbsolutePosition();if(K.subtractToRef(T,j),this.setDirection(j,b,e,z),1===k&&this.parent)if(this.rotationQuaternion){const K=F.e.Matrix[0];this.rotationQuaternion.toRotationMatrix(K);const b=F.e.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(b),b.invert(),K.multiplyToRef(b,K),this.rotationQuaternion.fromRotationMatrix(K)}else{const K=F.e.Quaternion[0];F.d.FromEulerVectorToRef(this.rotation,K);const b=F.e.Matrix[0];K.toRotationMatrix(b);const e=F.e.Matrix[1];this.parent.getWorldMatrix().getRotationMatrixToRef(e),e.invert(),b.multiplyToRef(e,b),K.fromRotationMatrix(b),K.toEulerAnglesToRef(this.rotation)}return this}Me(K){const b=F.k.Zero();return this.getDirectionToRef(K,b),b}getDirectionToRef(K,b){return F.k.TransformNormalToRef(K,this.getWorldMatrix(),b),this}setDirection(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const k=-Math.atan2(K.z,K.x)+Math.PI/2,j=Math.sqrt(K.x*K.x+K.z*K.z),T=-Math.atan2(K.y,j);return this.rotationQuaternion?F.d.RotationYawPitchRollToRef(k+b,T+e,z,this.rotationQuaternion):(this.rotation.x=T+e,this.rotation.y=k+b,this.rotation.z=z),this}setPivotPoint(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;0==this.va().getRenderId()&&this.xj(!0);const e=this.getWorldMatrix();if(1==b){const b=F.e.Matrix[0];e.invertToRef(b),K=F.k.TransformCoordinates(K,b)}return this.setPivotMatrix(F.b.Translation(-K.x,-K.y,-K.z),!0)}getPivotPoint(){const K=F.k.Zero();return this.getPivotPointToRef(K),K}getPivotPointToRef(K){return K.x=-this._pivotMatrix.m[12],K.y=-this._pivotMatrix.m[13],K.z=-this._pivotMatrix.m[14],this}getAbsolutePivotPoint(){const K=F.k.Zero();return this.getAbsolutePivotPointToRef(K),K}getAbsolutePivotPointToRef(K){return this.getPivotPointToRef(K),F.k.TransformCoordinatesToRef(K,this.getWorldMatrix(),K),this}rg(K){if(this._isDirty)return this;if(this._children)for(const b of this._children)b.rg(K);return super.rg(K)}setParent(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!K&&!this.parent)return this;const z=F.e.Quaternion[0],k=F.e.gb[0],j=F.e.gb[1],T=F.e.Matrix[1];F.b.IdentityToRef(T);const l=F.e.Matrix[0];this.xj(!0);let Y=this.rotationQuaternion;return Y||(Y=X._TmpRotation,F.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,Y)),F.b.ComposeToRef(this.Zd,Y,this.position,l),this.parent&&l.multiplyToRef(this.parent.xj(!0),l),K&&(K.xj(!0).invertToRef(T),l.multiplyToRef(T,l)),l.decompose(j,z,k,b?this:void 0),this.rotationQuaternion?this.rotationQuaternion.p(z):z.toEulerAnglesToRef(this.rotation),this.Zd.p(j),this.position.p(k),this.parent=K,e&&this.setPivotMatrix(F.b.Identity()),this}addChild(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return K.setParent(this,b),this}removeChild(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return K.setParent(null,b),this}get nonUniformScaling(){return this._nonUniformScaling}_updateNonUniformScalingState(K){return this._nonUniformScaling!==K&&(this._nonUniformScaling=K,!0)}attachToBone(K,b){return this._currentParentWhenAttachingToBone=this.parent,this._transformToBoneReferal=b,this.parent=K,K.getSkeleton().prepare(!0),K.getFinalMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this}detachFromBone(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.parent?(this.parent.getWorldMatrix().determinant()<0&&(this.scalingDeterminant*=-1),this._transformToBoneReferal=null,this.parent=K?this._currentParentWhenAttachingToBone:null,this):(K&&(this.parent=this._currentParentWhenAttachingToBone),this)}rotate(K,b,e){let z;if(K.normalize(),this.rotationQuaternion||(this.rotationQuaternion=this.rotation.toQuaternion(),this.rotation.Wd(0)),e&&0!==e){if(this.parent){const e=this.parent.getWorldMatrix(),z=F.e.Matrix[0];e.invertToRef(z),K=F.k.TransformNormal(K,z),e.determinant()<0&&(b*=-1)}z=F.d.RotationAxisToRef(K,b,X._RotationAxisCache),z.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion)}else z=F.d.RotationAxisToRef(K,b,X._RotationAxisCache),this.rotationQuaternion.multiplyToRef(z,this.rotationQuaternion);return this}rotateAround(K,b,e){b.normalize(),this.rotationQuaternion||(this.rotationQuaternion=F.d.RotationYawPitchRoll(this.rotation.y,this.rotation.x,this.rotation.z),this.rotation.Wd(0));const z=F.e.gb[0],k=F.e.gb[1],j=F.e.gb[2],T=F.e.Quaternion[0],l=F.e.Matrix[0],Y=F.e.Matrix[1],A=F.e.Matrix[2],X=F.e.Matrix[3];return K.subtractToRef(this.position,z),F.b.TranslationToRef(z.x,z.y,z.z,l),F.b.TranslationToRef(-z.x,-z.y,-z.z,Y),F.b.RotationAxisToRef(b,e,A),Y.multiplyToRef(A,X),X.multiplyToRef(l,X),X.decompose(k,T,j),this.position.addInPlace(j),T.multiplyToRef(this.rotationQuaternion,this.rotationQuaternion),this}translate(K,b,e){const z=K.scale(b);if(e&&0!==e)this.setAbsolutePosition(this.getAbsolutePosition().add(z));else{const K=this.getPositionExpressedInLocalSpace().add(z);this.setPositionWithLocalVector(K)}return this}addRotation(K,b,e){let z;this.rotationQuaternion?z=this.rotationQuaternion:(z=F.e.Quaternion[1],F.d.RotationYawPitchRollToRef(this.rotation.y,this.rotation.x,this.rotation.z,z));const k=F.e.Quaternion[0];return F.d.RotationYawPitchRollToRef(b,K,e,k),z.multiplyInPlace(k),this.rotationQuaternion||z.toEulerAnglesToRef(this.rotation),this}_getEffectiveParent(){return this.parent}isWorldMatrixCameraDependent(){return this._infiniteDistance&&!this.parent||this._billboardMode!==X.BILLBOARDMODE_NONE&&!this.preserveParentRotationForBillboard}xj(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._isWorldMatrixFrozen&&!this._isDirty)return this._worldMatrix;const e=this.va().getRenderId();if(!this._isDirty&&!K&&(this._currentRenderId===e||this.isSynchronized()))return this._currentRenderId=e,this._worldMatrix;b=b||this.va().activeCamera,this._updateCache();const z=this._cache;z.pivotMatrixUpdated=!1,z.billboardMode=this.billboardMode,z.infiniteDistance=this.infiniteDistance,z.parent=this._parentNode,this._currentRenderId=e,this._childUpdateId+=1,this._isDirty=!1,this._position._isDirty=!1,this._rotation._isDirty=!1,this._scaling._isDirty=!1;const k=this._getEffectiveParent(),j=X._TmpScaling;let T,l=this._position;if(this._infiniteDistance&&!this.parent&&b){const K=b.getWorldMatrix(),e=new F.k(K.m[12],K.m[13],K.m[14]);l=X._TmpTranslation,l.Yd(this._position.x+e.x,this._position.y+e.y,this._position.z+e.z)}if(j.Yd(this._scaling.x*this.scalingDeterminant,this._scaling.y*this.scalingDeterminant,this._scaling.z*this.scalingDeterminant),this._rotationQuaternion){if(this._rotationQuaternion._isDirty=!1,T=this._rotationQuaternion,this.reIntegrateRotationIntoRotationQuaternion){this.rotation.lengthSquared()&&(this._rotationQuaternion.multiplyInPlace(F.d.RotationYawPitchRoll(this._rotation.y,this._rotation.x,this._rotation.z)),this._rotation.Yd(0,0,0))}}else T=X._TmpRotation,F.d.RotationYawPitchRollToRef(this._rotation.y,this._rotation.x,this._rotation.z,T);if(this._usePivotMatrix){const K=F.e.Matrix[1];F.b.ScalingToRef(j.x,j.y,j.z,K);const b=F.e.Matrix[0];T.toRotationMatrix(b),this._pivotMatrix.multiplyToRef(K,F.e.Matrix[4]),F.e.Matrix[4].multiplyToRef(b,this.zj),this._postMultiplyPivotMatrix&&this.zj.multiplyToRef(this._pivotMatrixInverse,this.zj),this.zj.addTranslationFromFloats(l.x,l.y,l.z)}else F.b.ComposeToRef(j,T,l,this.zj);if(k&&k.getWorldMatrix){if(K&&k.xj(K),z.useBillboardPath){if(this._transformToBoneReferal){const K=this.parent;K.getSkeleton().prepare(),K.getFinalMatrix().multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),F.e.Matrix[7])}else F.e.Matrix[7].p(k.getWorldMatrix());const K=F.e.gb[5],b=F.e.gb[6],e=F.e.Quaternion[0];F.e.Matrix[7].decompose(b,e,K),F.b.ScalingToRef(b.x,b.y,b.z,F.e.Matrix[7]),F.e.Matrix[7].setTranslation(K),X.BillboardUseParentOrientation&&(this._position.applyRotationQuaternionToRef(e,K),this.zj.setTranslation(K)),this.zj.multiplyToRef(F.e.Matrix[7],this._worldMatrix)}else if(this._transformToBoneReferal){const K=this.parent;K.getSkeleton().prepare(),this.zj.multiplyToRef(K.getFinalMatrix(),F.e.Matrix[6]),F.e.Matrix[6].multiplyToRef(this._transformToBoneReferal.getWorldMatrix(),this._worldMatrix)}else this.zj.multiplyToRef(k.getWorldMatrix(),this._worldMatrix);this._markSyncedWithParent()}else this._worldMatrix.p(this.zj);if(z.useBillboardPath&&b&&this.billboardMode&&!z.useBillboardPosition){const K=F.e.gb[0];if(this._worldMatrix.getTranslationToRef(K),F.e.Matrix[1].p(b.getViewMatrix()),this._scene.useRightHandedSystem&&F.e.Matrix[1].multiplyToRef(A,F.e.Matrix[1]),F.e.Matrix[1].setTranslationFromFloats(0,0,0),F.e.Matrix[1].invertToRef(F.e.Matrix[0]),(this.billboardMode&X.BILLBOARDMODE_ALL)!==X.BILLBOARDMODE_ALL){F.e.Matrix[0].decompose(void 0,F.e.Quaternion[0],void 0);const K=F.e.gb[1];F.e.Quaternion[0].toEulerAnglesToRef(K),(this.billboardMode&X.BILLBOARDMODE_X)!==X.BILLBOARDMODE_X&&(K.x=0),(this.billboardMode&X.BILLBOARDMODE_Y)!==X.BILLBOARDMODE_Y&&(K.y=0),(this.billboardMode&X.BILLBOARDMODE_Z)!==X.BILLBOARDMODE_Z&&(K.z=0),F.b.RotationYawPitchRollToRef(K.y,K.x,K.z,F.e.Matrix[0])}this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(F.e.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(F.e.gb[0])}else if(z.useBillboardPath&&b&&z.useBillboardPosition){const K=F.e.gb[0];this._worldMatrix.getTranslationToRef(K);const e=b.globalPosition;this._worldMatrix.invertToRef(F.e.Matrix[1]);const z=F.e.gb[1];F.k.TransformCoordinatesToRef(e,F.e.Matrix[1],z),z.normalize();const k=-Math.atan2(z.z,z.x)+Math.PI/2,j=Math.sqrt(z.x*z.x+z.z*z.z),T=-Math.atan2(z.y,j);if(F.d.RotationYawPitchRollToRef(k,T,0,F.e.Quaternion[0]),(this.billboardMode&X.BILLBOARDMODE_ALL)!==X.BILLBOARDMODE_ALL){const K=F.e.gb[1];F.e.Quaternion[0].toEulerAnglesToRef(K),(this.billboardMode&X.BILLBOARDMODE_X)!==X.BILLBOARDMODE_X&&(K.x=0),(this.billboardMode&X.BILLBOARDMODE_Y)!==X.BILLBOARDMODE_Y&&(K.y=0),(this.billboardMode&X.BILLBOARDMODE_Z)!==X.BILLBOARDMODE_Z&&(K.z=0),F.b.RotationYawPitchRollToRef(K.y,K.x,K.z,F.e.Matrix[0])}else F.b.FromQuaternionToRef(F.e.Quaternion[0],F.e.Matrix[0]);this._worldMatrix.setTranslationFromFloats(0,0,0),this._worldMatrix.multiplyToRef(F.e.Matrix[0],this._worldMatrix),this._worldMatrix.setTranslation(F.e.gb[0])}return this.ignoreNonUniformScaling?this._updateNonUniformScalingState(!1):this._scaling.isNonUniformWithinEpsilon(1e-6)?this._updateNonUniformScalingState(!0):k&&k._nonUniformScaling?this._updateNonUniformScalingState(k._nonUniformScaling):this._updateNonUniformScalingState(!1),this._afterComputeWorldMatrix(),this._absolutePosition.Yd(this._worldMatrix.m[12],this._worldMatrix.m[13],this._worldMatrix.m[14]),this._isAbsoluteSynced=!1,this.onAfterWorldMatrixUpdateObservable.notifyObservers(this),this._poseMatrix||(this._poseMatrix=F.b.Invert(this._worldMatrix)),this._worldMatrixDeterminantIsDirty=!0,this._worldMatrix}resetLocalMatrix(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.xj(),K){const K=this.getChildren();for(let b=0;b<K.length;++b){const e=K[b];if(e){e.xj();const K=F.e.Matrix[0];e.zj.multiplyToRef(this.zj,K);const b=F.e.Quaternion[0];K.decompose(e.Zd,b,e.position),e.rotationQuaternion?e.rotationQuaternion.p(b):b.toEulerAnglesToRef(e.rotation)}}}this.Zd.Yd(1,1,1),this.position.Yd(0,0,0),this.rotation.Yd(0,0,0),this.rotationQuaternion&&(this.rotationQuaternion=F.d.Identity()),this._worldMatrix=F.b.Identity()}_afterComputeWorldMatrix(){}registerAfterWorldMatrixUpdate(K){return this.onAfterWorldMatrixUpdateObservable.add(K),this}unregisterAfterWorldMatrixUpdate(K){return this.onAfterWorldMatrixUpdateObservable.removeCallback(K),this}getPositionInCameraSpace(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return K||(K=this.va().activeCamera),F.k.TransformCoordinates(this.getAbsolutePosition(),K.getViewMatrix())}getDistanceToCamera(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return K||(K=this.va().activeCamera),this.getAbsolutePosition().Qc(K.globalPosition).length()}clone(K,b,e){const z=j.e.Clone((()=>new X(K,this.va())),this);if(z.name=K,z.id=K,b&&(z.parent=b),!e){const b=this.getDescendants(!0);for(let e=0;e<b.length;e++){const k=b[e];k.clone&&k.clone(K+"."+k.name,z)}}return z}serialize(K){const b=j.e.Serialize(this,K);return b.type=this.getClassName(),b.uniqueId=this.uniqueId,this.parent&&this.parent._serializeAsParent(b),b.localMatrix=this.getPivotMatrix().Ti(),b.isEnabled=this.isEnabled(),j.e.AppendSerializedAnimations(this,b),b.ranges=this.serializeAnimationRanges(),b}static Parse(K,b,e){const z=j.e.Parse((()=>new X(K.name,b)),K,b,e);if(K.localMatrix?z.setPreTransformMatrix(F.b.Bg(K.localMatrix)):K.pivotMatrix&&z.setPivotMatrix(F.b.Bg(K.pivotMatrix)),z.yb(K.isEnabled),z._waitingParsedUniqueId=K.uniqueId,void 0!==K.parentId&&(z._waitingParentId=K.parentId),void 0!==K.parentInstanceIndex&&(z._waitingParentInstanceIndex=K.parentInstanceIndex),K.animations){for(let b=0;b<K.animations.length;b++){const e=K.animations[b],k=(0,Y.d)("BABYLON.Animation");k&&z.animations.push(k.Parse(e))}l.e.ParseAnimationRanges(z,K,b)}return K.autoAnimate&&b.beginAnimation(z,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),z}getChildTransformNodes(K,b){const e=[];return this._getDescendants(e,K,(K=>(!b||b(K))&&K instanceof X)),e}dispose(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.va().stopAnimation(this),this.va().removeTransformNode(this),this._parentContainer){const K=this._parentContainer.transformNodes.indexOf(this);K>-1&&this._parentContainer.transformNodes.splice(K,1),this._parentContainer=null}if(this.onAfterWorldMatrixUpdateObservable.clear(),K){const K=this.getChildTransformNodes(!0);for(const b of K)b.parent=null,b.xj(!0)}super.dispose(K,b)}normalizeToUnitCube(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,z=null,k=null;b&&(this.rotationQuaternion?(k=this.rotationQuaternion.clone(),this.rotationQuaternion.Yd(0,0,0,1)):this.rotation&&(z=this.rotation.clone(),this.rotation.Yd(0,0,0)));const j=this.getHierarchyBoundingVectors(K,e),T=j.max.Qc(j.min),F=Math.max(T.x,T.y,T.z);if(0===F)return this;const l=1/F;return this.Zd.scaleInPlace(l),b&&(this.rotationQuaternion&&k?this.rotationQuaternion.p(k):this.rotation&&z&&this.rotation.p(z)),this}_syncAbsoluteScalingAndRotation(){this._isAbsoluteSynced||(this._worldMatrix.decompose(this._absoluteScaling,this._absoluteRotationQuaternion),this._isAbsoluteSynced=!0)}}X.BILLBOARDMODE_NONE=0,X.BILLBOARDMODE_X=1,X.BILLBOARDMODE_Y=2,X.BILLBOARDMODE_Z=4,X.BILLBOARDMODE_ALL=7,X.BILLBOARDMODE_USE_POSITION=128,X.BillboardUseParentOrientation=!1,X._TmpRotation=F.d.Zero(),X._TmpScaling=F.k.Zero(),X._TmpTranslation=F.k.Zero(),X._LookAtVectorCache=new F.k(0,0,0),X._RotationAxisCache=new F.d,(0,z.b)([(0,k.L)("position")],X.prototype,"_position",void 0),(0,z.b)([(0,k.L)("rotation")],X.prototype,"_rotation",void 0),(0,z.b)([(0,k.A)("rotationQuaternion")],X.prototype,"_rotationQuaternion",void 0),(0,z.b)([(0,k.L)("Zd")],X.prototype,"_scaling",void 0),(0,z.b)([(0,k.M)("billboardMode")],X.prototype,"_billboardMode",void 0),(0,z.b)([(0,k.M)()],X.prototype,"scalingDeterminant",void 0),(0,z.b)([(0,k.M)("infiniteDistance")],X.prototype,"_infiniteDistance",void 0),(0,z.b)([(0,k.M)()],X.prototype,"ignoreNonUniformScaling",void 0),(0,z.b)([(0,k.M)()],X.prototype,"reIntegrateRotationIntoRotationQuaternion",void 0)},11505:(K,b,e)=>{"use strict";e.d(b,{d:()=>Y});var z=e(10967),k=e(10984),j=e(11479),T=e(10969),F=e(10994);class l{constructor(K,b,e,z){this.name=K,this.worldAxisForNormal=b,this.worldAxisForFileX=e,this.worldAxisForFileY=z}}class Y{static ConvertCubeMapTextureToSphericalPolynomial(K){var b;if(!K.isCube)return null;null===(b=K.va())||void 0===b||b.getEngine().flushFramebuffer();const e=K.getSize().width,z=K.readPixels(0,void 0,void 0,!1),k=K.readPixels(1,void 0,void 0,!1);let j,T;K.isRenderTarget?(j=K.readPixels(3,void 0,void 0,!1),T=K.readPixels(2,void 0,void 0,!1)):(j=K.readPixels(2,void 0,void 0,!1),T=K.readPixels(3,void 0,void 0,!1));const F=K.readPixels(4,void 0,void 0,!1),l=K.readPixels(5,void 0,void 0,!1),Y=K.gammaSpace;let A=0;return 1!=K.textureType&&2!=K.textureType||(A=1),new Promise((K=>{Promise.all([k,z,j,T,F,l]).then((b=>{let[z,k,j,T,F,l]=b;const X={size:e,right:k,left:z,up:j,down:T,front:F,back:l,format:5,type:A,gammaSpace:Y};K(this.ConvertCubeMapToSphericalPolynomial(X))}))}))}static _AreaElement(K,b){return Math.atan2(K*b,Math.sqrt(K*K+b*b+1))}static ConvertCubeMapToSphericalPolynomial(K){const b=new j.b;let e=0;const z=2/K.size,l=z,Y=.5*z,A=Y-1;for(let j=0;j<6;j++){const X=this._FileFaces[j],t=K[X.name];let U=A;const B=5===K.format?4:3;for(let j=0;j<K.size;j++){let u=A;for(let l=0;l<K.size;l++){const A=X.worldAxisForFileX.scale(u).add(X.worldAxisForFileY.scale(U)).add(X.worldAxisForNormal);A.normalize();const m=this._AreaElement(u-Y,U-Y)-this._AreaElement(u-Y,U+Y)-this._AreaElement(u+Y,U-Y)+this._AreaElement(u+Y,U+Y);let D=t[j*K.size*B+l*B+0],I=t[j*K.size*B+l*B+1],x=t[j*K.size*B+l*B+2];isNaN(D)&&(D=0),isNaN(I)&&(I=0),isNaN(x)&&(x=0),0===K.type&&(D/=255,I/=255,x/=255),K.gammaSpace&&(D=Math.pow((0,k.e)(D),T.g),I=Math.pow((0,k.e)(I),T.g),x=Math.pow((0,k.e)(x),T.g));const Q=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const K=Math.max(D,I,x);if(K>Q){const b=Q/K;D*=b,I*=b,x*=b}}else D=(0,k.e)(D,0,Q),I=(0,k.e)(I,0,Q),x=(0,k.e)(x,0,Q);const G=new F.c(D,I,x);b.addLight(A,G,m),e+=m,u+=z}U+=l}}const X=6*(4*Math.PI)/6/e;return b.scaleInPlace(X),b.convertIncidentRadianceToIrradiance(),b.convertIrradianceToLambertianRadiance(),j.c.FromHarmonics(b)}}Y._FileFaces=[new l("right",new z.k(1,0,0),new z.k(0,0,-1),new z.k(0,-1,0)),new l("left",new z.k(-1,0,0),new z.k(0,0,1),new z.k(0,-1,0)),new l("up",new z.k(0,1,0),new z.k(1,0,0),new z.k(0,0,1)),new l("down",new z.k(0,-1,0),new z.k(1,0,0),new z.k(0,0,-1)),new l("front",new z.k(0,0,1),new z.k(1,0,0),new z.k(0,-1,0)),new l("back",new z.k(0,0,-1),new z.k(-1,0,0),new z.k(0,-1,0))],Y.MAX_HDRI_VALUE=4096,Y.PRESERVE_CLAMPED_COLORS=!1},10975:(K,b,e)=>{"use strict";function z(K,b){const e=[];for(let z=0;z<K;++z)e.push(b());return e}function k(K,b){return z(K,b)}e.d(b,{e:()=>z,f:()=>k,j:()=>T});const j=["push","splice","pop","shift","unshift"];function T(K,b){const e=j.map((e=>function(K,b,e){const z=K[b];if("function"!==typeof z)return null;const k=function(){const z=K.length,j=k.previous.apply(K,arguments);return e(b,z),j};return z.next=k,k.previous=z,K[b]=k,()=>{const e=k.previous;if(!e)return;const z=k.next;z?(e.next=z,z.previous=e):(e.next=void 0,K[b]=e),k.next=void 0,k.previous=void 0}}(K,e,b)));return()=>{e.forEach((K=>{null===K||void 0===K||K()}))}}},11906:(K,b,e)=>{"use strict";e.d(b,{d:()=>T});var z=e(11161),k=e(11909);let j=0;const T=K=>{if(!K.environmentBRDFTexture){const b=K.useDelayedTextureLoading;K.useDelayedTextureLoading=!1;const e=K._blockEntityCollection;K._blockEntityCollection=!1;const T=z.c.CreateFromBase64String("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAYAAABccqhmAAAgAElEQVR42u29yY5tWXIlZnbuiSaTbZFUkZRKrCKhElASQA0EoQABgn6hJvoXzfUP+gP9hWb6Bg00IgRoQJaKqUxmZmTEe8/v0uB2u7Fm2T7HIyIrnz88uPvt3f2a2WrMbOvf/u3PvvzP/sUf/N6//i8vf/lv/3v5H//d//Sb//Uq/5u8yf8hV/m/5Cp/L1f5hVzlG7nKJ7mKyJuIXN/hPwqXI/g++zq6rPI5u8z+WqfLre+zy7PrVv9L8brsMiGvk8XLmM/sdfHXal4e3ad6GXPdyu2ij8u/+uv/5cuf/OSLfdtEfvUr+dnf/d0X//t3H/7bf/hP//N/928h/0Yg/4VA/kogfyGQP5Wr/IFAvhbIlwK5CGQTPP+9z5uPeePJSW+yo2+s/GtN30Rnv1E+f5zxof9R/lSXv/nr//mrr3+i+5dfyX7ZZQP07Tffys//8R/l/9TtX7790T/7r/8G8pdy+/8XAvnnAvkzgfwzgfyxQP5AIL8vkJ8K5KsmMVzu1U7p5PA5AXxOAJ8TwPf7sX/51ZeXfcemqnp9w/W77/S7X/6T/vzf/7383RWCX3/z05/9i3/13/0PX//eX/2FyP8tIv+PiPy9iPy/IvIzEfm5iPxCRH4lIt/c/393//9BRD6KyKf7f488fP74/PH544dJAF9cLl98IZfLBZtuqterXr/7Dt9982v95S9+Lv+gF/3i7Spv/8lf/vnf/vGf/dF/JfKnIvLnIvLvReQ/NEngn0TklyLy6/v/34jIt00iGJOBlxAsdvv54/PH5493SQCXy9t2ueh2ueimKorrFbjq9eNH+fDtb+TXv/ol/vHyhX4Fxfbx7euPf/Lnf/PfiPyeiPyhiPxxkwB+fk8AvxzQgJcIrGTwFsiAEXH4/PH54/PHUgLY7whgu2C7bLqpQgHB2xvePn6SDx8+6G9+84384vKF/IPu8iVU9Y/+7C/+jWxffiHytYj8VER+X0T+oEEBvxqQwCMJeIngo5EI3goIwVMIPn98/vj8ESaAbbtu2ybbvl8u2ybbdtluSECA65u8ffqIDx8+6G++/VZ/efkV/sO261dQXP7wT/7kX8vl8qXIFyLylbySwe/dE0CLAr65B/9vGn0gQwRMMqgmhM/J4fPH548eAezbZd/lsm3YtssNAYiqiogAAkCvb5/k46cP8u2HD/rrb7+R/2/b9Wu9yJe//8d/9Ney6S5yEZFdRL68/38khG/uKOCnAwoYkcCoEXwkEgGDDq7CeQfyOTl8/vhd1QCum26ybZtu2yabbrKpQvXue1yvuF6v+vbpTT5+/CDffviAX1++1V9sO77WXb/66R/+4V/dgkbllQi+aBLBV/dE8LWRALwkYCWCNyMZXElkwLTMeMkga/P4/PH547ccAVwuctkvdxSw6bbdtYDbTfSZBN7e8PHTR/3u4wf55vKd/nL7DX6mu3791U9//5+/gkNFZGuSgZUQvnKowKgLWLTAQgRtEniTuEfwaELw0MJvf3LQzynud+53uG+X6y3gN9kul+2y6XVT1U27JCDAFVc8ksAn/e7jR/nN5YP+avtWfq6Xy9f7Vz/9w1dgRYngiyYhfNkkgzYBWHTg44AEMmqQUYQKOmDaiCIa8TmsfmzB+DnZDQjgcpGLbti2y3bZHjRAdRMVvb/dcYU8kcDbPQlsH/CrbddfbF98+RPZfvLFnAQeieCRDC5DMvju/vmD4JkEvjRQgKULeGggowdHkAHTYxihg89vu88I5UeGAPSOAFTlrgPopiqbKPSmCKreUoAAkCcSePukHz590m8vH+WbD9/JP335k6/+tA86KxFchv8jMvhiogE4JQm8XhfKqOAqx5qRPyeGzx8/cgSwbXcUoLJtim27C4Oi93+4v6VxQwKAvl2v+Hj9pB8+fZJvt4/yzfbF9lPdv/wJnsE2BogmyeCRED40tGFvksIXiSbgiYSRRpDNDZ6BDI6ghM+J4fPHeyKAO+zX7cb9t4tedMMNAQju5V+f1uAtBSiu1zsduMrHy5t8ePsk3376KN98sX/xE5FPAnm7/782o0DiUINXMkCXCB7/P94/e87AWUmARQWVvgMuKej9t1RLBp+Tw+ePgwngsutFFdu26WXbbl+rSvdfbnqAiuA23QcBgCugV1zl7e1NPm5v+LC96XfbJ/1W9y++fgXjA3bDYXV+MuhRwSPwL3JLMFYC+HS/LU8HYrGwIhwyNOF12SvgM4SgztdifP85MXz+KGsA2C6X7aJ6bXSAOwrY5OYIqGy3d5uq4P5GhABXuV6veLvRAf10fZMPb2/y3b7vX7+g+9v98/WOBq7GG7RNAlYy+Dgkhhb+Xxp0sE8IAC4SGAP/TbgVJK/PoJPBnAiwPKxsXfbbnRg+i3s/JAK4Q/4b9NfLtomBAqCickMBjy7BuywAUVyv8na94tMjCVzf9KNcLl/0SeA6oAEYb1i9g+FtSALb/bKL8/+t+wxXFMyswqiHoK4ToIgKqslgpg1qUC0QoYbvJZg/B/q5v4szHmPX7YEAsD0CX25OwEUVm9xag1+agKg+nxQArnKjAtDr9U0+Xd/k4/UqH7bL5YsewrcBBiMJZPRAp6TwQgWfjM9vgRbgUYGL8AvLWH2gqhesCokeUmCSwPsnhs8fP2YNYMO2XeSmAWxy2VQaXeDmDIhApf33rD4PTUCuV+DtCn27XuXT5ir8VmCJ2G5BpBM8/r/dEcJb8/0lEQMtJHA5TAlqNuLRhJChhEpSqFabH3di+G1AGj+W1/dyAR4IYJNNnuLf6+tWC9CHHiAtFhAIFLjK2/Uqn65X+SS67aK+3QeTDoy/IG2ogQ7fb/dAtz5vBgrYGqrwNtCHsVfgIvwK07OTQBURVNCBFpKCOjqCHn5L/67TgTN+fpySAC56nwSUi256kXsSuFGAVyLoUIDo8/Pz7fdoErr/v17lk162HbgHvFpIYDfoAJJfW4sGPjkU4VNAF8ZEcLmLhdc7kljdY1y1Dq9yLiI4IiRqcLujb138KIPn80ejATwRwIbtBvn1cqv+2J78/5EI5N4cJA8qIPcmwRsKAHDF9WYP6mV7VmrgLuTpxYTcMEW0LAmoQxFsuvAI8tv/a/C5fV2ZMMiKg++FCM7RDPRu8ebWY7VG6VJi+Bzk35MI2LsAckMAgwvQ0gC5DQjd3ABg2HQLAPpEAlZ1Bu7VV7MGHDFRAbo3VKsTbAY9sPWC/uvx86gBbDK3D1eEQS8pbAeSgSwmhepnJb6uBv/o/PzHLzxWA/X7TH77De5j6AGQi6o0CUGfCOD2X7cXAlCFQABtEsGLDtxuOyQB2UTQBKZe5GUPXgkUYCUAbZJRhBDeuq8xBf+bgwbehDm+BFQi2IJksOocvA8ysIMfxluVcRsY/eB3JzH8GFDAXQO48X/dcIf9jyDHptIigDsFkEe066tBSETQUYF7ElDdYEBytN4+rk9UcBPfrKaZqFHWcw3i4J8/X4ev2//bSXqAhwTay6OEIPLD2Ipt8OtAGzxkwLw9WVFRjTc/qC6H3+YK/b1oAA0KuOizHfieCLaHHiAb5NYTIC9EMEbZrVEQt1xwhVy1UfBh8PUOquMizwaap3tQXfY5B//tea/NZdfhsvbz+PURQTDSGWB87VX/7WSd4KxjUqrIgE0IUkoKGnhIvwvawpGf6eECXJ7tv4qbA7DJgwpsKthEmmYgfaAAffYF3HLxo0vwNjJ0SwRWMG4db4eh1gPNm18vQ+us/0eGmxDemu/fnM/X4evq/8342ksGHgLY5LyT/zg0wM8lcMjgGFXwqIOVFJBQw99eCvF9oZL9Mfl3QwAvIXDsBRC9R+fz8x0FPBLB0xJEpwUobrfAkARgIAF41h3wQgP6QAmX5E/7eI43IxGwwf/moIkRyWRJQIPgt9CA9b39nzt4bYUWjAlCjWDPgv8IEjgLJfzuaAsrv9VdVG4OwOXW/fdoA35qAdL0BDwvf6AAUVHd8LIEu94A3K+Q+2YxaB84MOH62P//qoo38fCRDERE2zf0JfmDa+MieElAjcDPKz+mRKCOtdgGtXaBjgNJ4H2owSpNeAW/rRH4CaHSpMwnBYYycjgSJwfie9CR6mPu20Uv8kABF206AvXlBMiIBPSlB9wjBW1fwEuSb94296VCqgMaGCt/G1BbExi3IG+r3a3J6P48Gv/J0YmEYoiGY7V/SxwFCwGoE/xa0AJ0CEiV9QPCJb1OJ5F1VTjEY2/MO9AEJvj1BJTQpqLfTlGwjABuzT962e4IoKnyrdh3+/6mzDVJ4PHOxj0JqGKoy20+wBMN6D1gLWi9NQHfVP5MEEPzjGYy8BMAOnTAJgEr8HUIejRo5xrA5xkR5AngmiSHs+zDDAmMgWzTg55GSJEmHE8IvWPAoYTfhWak/Wn/bQ0CGLSAjv83SUEfKp5q24LXuQICpzrjrgWoza8xVE00CQCORdhMJuTUT/rjuls0gO4Iby8BIEgK6gS7BsGuTtDrScH/fR68biUHNVGBnxjeNyHEvQe/ve3LZQqgG3rof6cEclsNflG9J4KtaQ8WHcVBHS1BtHE4QP9OBMS98mpbKTeDW7dJwRsnHpMBTFJpV4I+b0kY/NqInVFSyBLANbnMSgBM8F+Fqfxq/h657/Up+GaBnwV9hRqc9bZ/vA6vu+T9E8KPJWns94UfTeCj2QXwCHS9dNL8Xf3Ho/rfewSeFODGDV69AU0y6NFAE1DP3qK++rdB7/1HRxf86gT376zOr99T/h/ioBiXWQkgQgVeIrCC/WomhDmQK+hASI2ARQZKooHMLdCJwGEBBXC3+uERwg+VOHZ9ioAt9H80AI06wGgJ3nQA3BoCut6AhxYwgcPOFnxuFnrphk+NIKIGrWPQtgz3b0i7Y6D5rs1GKqTop0nQX52vmQC4BkjA+r4a7Kx9WLENGeegkhSETBCrNXIMdi/444Rw1n6E96ry7OPuj8UfLxtQ78NA2iSBbg7gIiIbdDLsb5agPhLC3RkYKv8NDbS2YGsatNRAG2oQwf9ZIOydgy1MAzBkAw8UwEEIDzSAqdPQ6za0PkeJAMH3Z0wXniUSZoHvBXU2mcjQgv56TedIKglCpIoQfgwCIjOytd8WgN0bfxoR8Fn9Gx0Aj5Zgq0lIZbsH/ibSJoFnS+C98g9ooHEELI3gliy25yONIiE6pb0NfBlyNEYyENoodkKwgl6I6s8kARgJ4ZoEfuYWHLEJa0LhSBXm7kImGeSfVdoJ1DO2G7WXsehAptupSOoyrCSF904k+6vt98X/ZcM98Hsd4JYIXhQAIg3/f9AAUYhsLQKAtkHVBnzjCKhOoYl2ym+iBtvzDzQ2DLXJ4PUmbJHAVnBQX4jkxfvHhNDqAdHXGQJgv0aSDGItgOseHIU+K9hXnIJzkoGlEKzNHagTdJ6VWEUH4iCKH4fd2AwDPaYBm4Wgng4gQ9V/CoGiuNmD04AQtNGMGzSAAQ2I2pzfogY9LRh7BrbOh4+D30sAencljFu2CUFrwY8UAWRfWwGvVOVfbx2uIILM0pwDv082dUTw8hYs8L+uIWiHGpWgClnAa1lMPJogovvvbePPs/q3Xr++kgCsfgB5oQF9WYKPJqEn6G+OE3i5AqouF59FQOmahQC8rlPLj38kg1c2f30vw+XaoIX24/pMGIgSBoZqoH3wo0sIIGlA9PWcCPrAtpPB8eBf6x1o6cHra+2+tpIFP4PgBfxZtZUJfo4qxELT948D9ucK8Mt9+ccjIQw6QJcEbrD/1g340ATuDgDkFfx6twSf1f9xvuBECYxq/7ythQQGm+5JDx6Brw4CkMGT3wgscCUoQ4sU2t6DR2ciBjTgtcpenQoZVX9NuL4Owc+dVaDursYVkVALX+shjSBKBuvCYDUZjE5BdNkxdHAUBexyHwB6NP7Iyw7sxUDViwge1t+mz8B/LAvVx/c3PeBBCToB8IUGOgqA3iV4yUg6UAOxaUFHDx6CYS8SorMOue0CCJGAf5YfRhoAI+A1CvwxqNkAY5yAIx2EQmkFfeWOXi+nEdSQQA0ZHMEItiagJArQxDXIrj8nCfQi4HZPAttrIahso9oPQ/2/JwV5JQU8zw+7I4D7/sBn4EO6rjw0FR+i3Z9fHtahzsFvJgM0X+tmVH5vaYiNDGAigewAz+gyNLThnjCURQFR1b9d3lZvnVqmj9mEPDKIUIC4KCCjBXywS4N+otp/Hk3QVthOkwEKlV9PQwXjT7s/zwF4Qf9toAAzFdjuaEB6S7D1//U5FIQu2MevO0rQQH8ZmoXE6B/IkgE60XCjVoq8gt2iCG0S8L5GdxkM1cGsfsCMArSCAnrr7dzAZxCEEpepvB8tqHJ/q+bmJGGts/AcAXFOMMeTwC7Pw0B6CtCtA2vWgonqBQJFSwH0JQK29OB2kvgj2HHXAoyeAIsCQO0kMNECAhFMqCBf8mElAkyBbX1tJQP2RJ/ha0gpAfS9l+/5n00CkrQpq0MZbOdAuxmMvHswog62jZj7BnYQe19b14kxNq2D/ehX/p68HEcF+x3yP7z/V/A/q/5DA3i5A/dzA5pdgbKp3v3/wQF4Bb70WkCTHGRAA6+KL0bFl6FJaFw0ImZwm6igSwbbwPn9RMBWf3sN2JgA/BVh/Rg0kQBgePf6HglAHLFQwqQQOwDjbdVxNZjR4iM6Qa3WxwvNxh0JFb3g/WzFQQS8b/ttKcDWoABtUMAd8j9hf0MB2uDXhzX4CHj03L9DBU3Qjz0C0l4mLSLQPicOOwZoVCB6P6dA7nDbGkVuxcNr8PU2JQO4wX5trEqmccZaHU4q8oCDFOpzAnOwqyMIMktNNNAHouDGxO37DgArQZzlmp/14W1QlqHTMaIIx7SCx0+5yza7AKJ3IXBrNAHVDcMZAU/BT/vgv/ULPOA+XiLggAREDF2g0ci6xNDRglegd7P7TWWH5oJfayliEg7bScQRBVgI4Ookg/F6rvpLWP29swREqA3CaG8/FpKqS8DTAV4TiBqIqtxfzaQRLys5I0XEFIFrPbZRQb+16Fgi2LvJv8EFUPW1gGfQv1T/F/d/HBnccP7rAwnIIyHI4ArgWeGbU4eHy6Tx/EeTZIb5bo/BsMBjmjBE08f/RB0PHYBd9eVRAGY7cHRwiBf8WeCPHY1bgBTa9xKTELzEkQX9CPtl0gJiqsAmCT7I8xbjivh3JGFI+D2nBcSJQJ8agDX+O9iBL7UfG4bzAkcaICrbtYHz1ycSmGmAjJfL3CMgT3tQpmrfB7gxSzC1DnvdhQMieG47u75+kTouKNkM8c/+vq/Q7ZYjO/hhVvRq8F/9gGfhP8aqE9EIdR6LTwJ1h0BItyDqB8iFwuNqASscRnYioxOg9ApvnYA35f8e9Ohbfe8J4rknoFkO0lmA2gmAG0YK0DkB4ieEjiLoMD8wBzom27ANZkzIoU8EMHk/uo1mzeVoEoRWKn8L/62EYAX/lsB7D/LXg74uAMr9oGivJ0CNJCGD6i9DhZdQF+gtOp4S+NODRzsDVbhdgv4BqTMNyIL9SCKwL9/FGPp5oQKxIf8A/UX6r231H7YIqLML0Ae2GtrADOvRQH5b/MPE9dt9BGLNG8jVTAQvIaK5TtvvvWQgDvyXIClUA78S9Nfg7VtIBlO7cbsEYkQDMot+ygQ7QwmOawTHnAM2XUSnJvPIYRYMmYPS+sv3J+cfP3d04JYIXsF/EwMbBKB9Q9AY+BiSwFj9mzrSXmcJhFPVHySTbgHJCPvRQ/z7G/SVUETsg0ZF+i3CRoCjhf7y1A9mOiDD7TwdwEoEXjLwAv+avLE2B7Jnb+OqDpBoAchoQJskxKnss0vu7Q2YhcDv4ySeLOg9GsCKiUIihP7yfW7zbTsBh0TQfN0iAWn9f72Z56/Ax9P7j5OAH/Qvv3/QxKfk0DgDuP+R3USg3bzBC7bO/QT9Eeh9QvDPG7glBQzJwK740lAFFgFk8P88CqDGAa223YckWYhr+c0BPdwetl2ocnsfzePAWcVnnAIp6gDVhDLyfV4nqFEDPxHsbWD3k4BDkN+pARqKMLYBPzYEvxp9xmCHQQdgWH/9EtH2TIFpu3AH/cdGydv1j0TQbRrq+D/mLcX3ZACZ15bF378CG0My6Kq/zoGOQwhASDFwFbxyNGBuSxbCEhQ/uEPe/6gAERWQObCVVfjPpQX+rexxYhYFxIkgpgX7Y/vPs+Pvxf9vwt8kAs7i32t3QCP+3SPaTwIytQXP38u0PESm+YER+o9B3vr8mETAUfDrEkPI80ck0FZ0dXh9U+HRbhey0cAc2H7A4y4egoD6y8JfkBiigLdFP8v2W00E8deT2IeAKujZ/QAVKpAtKI20gLWksHedfgPcb+0+NEHefd9vB9rayi8h7J91gBbaw20MsnWAF5xHkyDUCOoXp+yrOwwxcKj0aL6fFppaaKDv6OpHR5sgx5BAlK/+fYhuP1D196o8e7lFBaKqv5YIMnFQpd0FGVR35RJCnCDaABaXBtgbiSwtICMtalKC+1JQ6bx/PLcDPQL91QFodQNKpwOgF/9eqcBxBBqRcKAAVk+ArQOMx1RYGgB6naDhlK+uQQwJYx4meQbxtNnYQwMjt/d4f3M9ZE4UOld1LAh99fbfzOxiEkKFCkTJIUIMUeVnJ/9sDt8/e1NEJOi9oVHDGYhgnSLss9DX2IAqw1zALUncKcDr0FB5NP+0cBQNrEezDiyiADPkt9qGpwoPdL0AGPx/NOKeyf3b9WJNdfcFv6bKd2cLMJVfJ6Y3B6wB9WFUfWWEwKMfGiQL+3bz9XGQz2EHKhF41GCtZyDi/gUCsNhYoAr3UNJ58YidHKqnMb/6AB5J4N73/4L+t7mAkeeP3P+1LNSB/l0SkMEd8DcEuUlguEw6t2AU/PCE/q++Akw6QFf1u6SBrj1ZnnhG50AfkoGIdf7gJv1KcSfgzWWkQ9U33Z3tHXYASKJ9e/YhU90rvD+q9Ej69/wxYJVs506Eg/r3DkMDzEdDBRGgcZay49XihLA30P+l8N+hf1f57/0AoxbQbwYaan/rBMirE9Dk+sBzTkC8JNDEUlv5McB8PP19Y01Gayep+hC/2zvQ/2HGLAurowsNGlA1cnqGGzeH5weiYLZm7h3QQC4O2tXdhvMMk1ZS5ebpgI8eMrPvPGkwaxayk8Yc6PMOBPEdC1XZ+2UfbfOPtxLMQQAG9BcZFoF0gp/RKjxe7+oAw9T7ZPWhgedodgz0gf5KBtrtIZhQAZpAV1Bi36w6t98qVfH7hqGI318lLCjLCUFlxRHwqYEH9a2qb4XjWvDT7kBwfbZA5P0+PNuRuW1yf4yNQH3zzwv6b70QOJ0G9OT/dhoYRUGT15uQH/71MjQLtQlxfDuiCXrtM+SkA+icQdH6sU/xz7Ze7FlubV4TpoTQ2osdpaEjtqADmEU7OkBEFoLeC3IWFFeswJXKXzkboNL+wzcFHU8hTGKIboO7CLi1/P+5F+gydQhuvRbwEgxvtACmANikhLTbj0gCYk8KdlYgmj+4Ymaod7TwahwadICuX0Cm2fE5iNHPK0x/CDV66Kyg1MnqjNFBnhBoLQCgUULfaVe5nq/6EQWY67bXCszUb+7232fVPz51iGB12owK9peyP1T4raMFF/OEYJP792mgXYfZ04GHMAhBkCSmSj+dKqRPgVFGHbpLEGMiGFeQWfSgrY52VxaeDUPSNJI0P7NoisG729HHl78z6hxfs9rV3m4JjgM/lsui2qmThjCfDFSb+I9vwUqG5wwL55U7C+6ot8B+7N2o6r3q37T9trfpjgmTvv7PSQATLLeRAOZhIJHBQfDQQJPBdUwEbVW3+L08EcEE/9G4ANrCeWcnPKRHDupbNynMx5AA9IRYLmrc/YLSiD5EaEBS/s/TgnU9ILcH19n+CpHwegLejx7Mn/d25fdN+e9U/1vgb7bqf08MOtf8EXxaoh+GY8L6gDfhvs4i6HQ7seYI2sv1GchdMsBIG3xlvxcCRzdgCPTn+6q/TW00VE8Q9FaFv+R2VlOM1vm/hhjhDCdgNflVKME5B47I9xT8z0YgPAJ8myb/LqHy36j/Mwqw9AALxuO1JVjiuQAYLcFzIhiEPe05fk8tRjGw7yWQbsfuLAT2VqOId1osnr0F49VM8INACPHDoBz4B5mqqSnUgyh3ArjXxfQH5BbgUS8gP7aU+w0zHD9GGD0CGHf+P1p/DeivlhU4BbxR9a2kYFR58YaDZCUR2P0DMmgED2eg77puegy6PgDphEB0CwlG/i9d+/Hs34pBEQrBn0W51mqGnJAk3ACCHeiqkQ1XFQA5AlKH7Lk8yJKWY3/nym14h2C3JvxeMwD9ZVMz0BPMi1n1RbKl1cYhIVblF3G0ATsRiCMUvoK9//OgcwYMoe+ZKOLlC6/Xk50br9NFz9fanqA8UIYSpCwlBO4kHc4WLLBfBHVaKwKgLQjmP4Un61Vq+3s7Bsyi0WztmLjJwJwFeE0I2vD/1Q6MVwefxfUf32skCPbCnxQqf+QMPEUDHZ7vGeyj020JgkPXXwsldA7SYR1RE3h94NvNtugswcgxXEkIcBPCGZ1rmrgDC0A4K88nm2fn/eTnpQtWyZfybRoK8Dro4zYDIMGsf7saTBzvX0SMbkAD6o9CYbsfMK38cJKD9l2FJt9/VGs0h5Gib33pxMKWNsigFUh3G2un+/N1WUglI/EEx8fq27vUNnwsiOoKecL7kQS8VnWAGCFUgn6dBtQhv40CmIYggwK0uwDHRGAuBXVdfwzHUjZzATLMAoyJ4FmBhzaWBlrHld9CCWpPHRqofBqMReMGTJ78q9rDes1Tv7/0m0v0AFHXNR6P6g30SHivin7V1BOhh3iWPwvps/yE836L2XiwnUT8x2iHgfqhnwn667QHEE8oLQjEvtEW7GYBZDrDVkwNIO4G5GiBDf9fGoFM6n+vbEtzXwP6u9AduaWnGYSLAlVdl/AU+ikrSeEIKgwdaZ4AACAASURBVKj4/wtgHcHtdO2nWKcBkPfxcvnNQvsj2Me9f02r76T8q0IBn9OLKfz1HX8yVXQYGoAB/2UeBQ5/5kCL6+H/OGGoRnLSwdd3oH8r7KkGTbgIxEwVWvnF8KOpHnyzfF9Jod5Px+IF1h8owyitDw/XEgRb5bPqbt1uvn7qBIQ16vtS/u+DP3cR7CH0WWJgd5mTJKYgNzoGjQrfvu99NDBC+bnyW1x/qhTatv2OaMKgJWPvv5kwnMgxHYGFRtJW8VMl3uP+MgoqSZyWFKr7+KIDw1d6+IiOgZI4+d5iYL3imzbgyO+tph9t2oSBxOM3ugHtPoFZ1LM0hF4kXNEBssvVgPdjdXZWK7uKvyS3q1Xb1WQwtVDqSUggq+Vw3t56JA2cz7PXOwGNW1ecwxPhfe3QEUsDsFaAz8jg0nf+iZMAHNg/XSazDuC18Iq1HBRrOsAQ8NLB+16g614jmuSgs3bROxE55D+WDDQNA4ivdMJ9M1b309UqknaDU8ObV9/PwmMPATvTMAxpABLBzugUtV9bLdhNDQA+7B9tQJ06/7QNDHGSwtgZOCIA47InIoDdROQGtt0U1HI3GaoUnCnC/rzBMQJteN17+VaAzYNA7e+PFqHQUyXPUYB7iQYa5ZFjq1Zqpx8Uqu/XT7+6BWC1Xaj0GlBIwMoHu7UzcI/6/Acb8KIq+hzmGWmAYnADrIpvKP7TZeLaf0LAeQkGgebbq9FToI44p654F47tekKkI0L5PQNZPsDwPBpy/ni+wKMN76Vav4+2cFZFf8+JwAraMt0DFB7beA/u4Zz/a+RXx0M/ct4/jwaNAS8G17eSwmta0Fhx0VRxJkHMivso+onMXr+YwdWKbgioy1jp4x4AzIKg5lEA7wvHEYCRmdx11TAuT6lDLVl4KvXkAET9P4RT8H2u+lg9EPQIpw+/NpJ7RwE8HaDv/Mu4f3OdNkq/EfAiEiOANjEALvcWL9gfFV4NZbgbQc6qPky4Pm35QZxtH1f4j+P/jXuaYPcWwIEH/fmEPBoAO4m4LGxV3txOQqDU+dXgey+UwSzuqP++uImO/u/6ogCb7wTc1n61sL+vZi87rxnrNas+giTg6QLzaUCjIp6JfhwtGI7AjBBB9JjDY4ePYVR6ZPgN4owVv6Q2N5hhVHwNeYrM+w6dN6K1sMHZm/Ce7bHe3dzKr1xw1w4JrSQMZtgnoQHlr18fzunAszD4qurNUg/TDqzx/lfCaO6t4tACMUQ6P6htWjDPC1hCoZ8kpODzJ70MUR9AODcgwyqyPhmE+wfHYB/hvSqt6qeXUShhXH+d9SR8DzrDaZZdpSp/HxqLMQuATgDU/qDPRgOIeT8cvz/h/XC6BtE7ACLOWPE0KIS4UUjmZaJ2grBphiWgT41BUVWZfP3AnEIT6OrfoF122l2rMycBoU5i/OXoUZ4/aglsXwLzHNU++FVF3qikOj5HXm2PBitT1WuvJRAB+6O//W0/PY8vQH5IrAsMs/WuVmAdHBrQgrbOxJShXwRSsu08h8JMBpo0+aDTALwV4tbswgzHrftG/dJKIAQb5h9KCssWIMeto+GYqG12/HWGjx8kzqNJaa0noMWOr2KwW01AMwJoNvhMQda2/RKQP/3ecABM3g9uD6BY68Ntz9+nDOMb5iV+hIE+dP/Zs/wwJhJ9mgBnohBuStABUXjugF3hkXF9ZZJAjefKdHZCc389LoStKvIl7QIEb1d9RyciQgFDI9Cjyccc/23Aam7/PZJBhgDgin5CtQvbCzX8ip9YgIFtOAt+w0owp/hOiCWgEGbVHuYjRigPGR/YOnEoqPDoV5z5YqB3mRq2ox5ICmSSgAP1Ne+XV2NE+/vuFbCTRADxtS70VRBCjgBk2OyDUQiUgfl77b7DwaHm2rAZ7osRSOOUoHgKfNBSLI767+oDYrfwZvqChSpGfj3pFwZFsCJg2jeIQQBUiyI4WgD68ww4qO8khuWkkIuDrxWv2nv+UTBpJYiPd0KemTA8qqFiuUF1jWS3BoG6pADJq751JqBI0wvAVPyMQvjcX1zbELltKK+zBiXRFiRxG+b7q3M9xuLdzR8g0gCGNzSM5gNYfqGO9CBT8OHct6oB3KsSDBisUnwsFuISQaRHxDSv0vptt2oeLHMERfRn/FG/Cx01EpgIQG8LP+/i37PKw53xn6sYCM4/JwSRrCnIeB1ZkLsawDhaPKv/njU3wnZ/dBdGE8+YTHSG8+ofGgIjsC19YnwdM/KAnTSsqj6ig7uGgIPw3nYFzhhIIvriAxFP9CQd4HSlnzgxONIdrE7A8ZDPx9fjib8ifgegNIliRgdx95+E1T7+3nQVNNhEzDgGA3T2rEDLduwtPpuuouPcs8swwXFjdTaMKt+jA5gUAQPcf95KJQxYU0cYxEDvsBSmYuukp7AwnqniC9Afa5z8vboI68ImT0t26CvwBzSggkj447r9IojvCn7U92J/Hw0QSdwZKNNjxPCfSxRqnATkdwpOwh88oc4J8KTSm/wdbZjrc+4iFP8YO0/5JJDCfaijK5xVXevqfg6zGRrQf83chvX4aRfAE//6vv5+6490U4ADdO7QgM/5bcHP/n4OtCQhBEFeDWSvos8DPq8/IwzLzjpa8/U6MMSkBklDm8e0mn3QIY7XG1Om8wzN48y7HwhOK3P0/ZwUQHHv4psbdoVeb9VlAjChBCdtDDpOKTh9ZfcagOYq31RFjN4/gwBYzp8lAwYNwBELhZoxECeZxMlAzWGdCRV0fQWGHo8+8Kx+AAxnCIzowAxy9KvNepWfsfp4RR9kUrD88CPVTuXRybhqqTHcnxEGndsgub1Gdug8yz9fHt3Hpl57x/mfCOC29FOSQ7/noAZR5W3Ob24UMpuPYAYiQrQgk1gnFoUIKr4vKFpV15pHUJO3Y5rfH3UFHU4bGkU+NKJ9f2hJyOMxDBDpjAgwiYqvk5TqNl9EH2Arb6fA3yaA4cBtPWewhkEcIQJBlGzYp6zRmr1v+e3Fv27xpzvyI44NGDkCIi7CGNV9Dw0M8NtHC2vUwHINumCGNG8erxOwtQINsW88Tlwdoc+F85nI559ngEDpt2F/Uu3hiXYrkN/pBFS26hYDAkFgErMK67y9mGBA3L5ore5izf8b3n805MOq/t7XU4WHv1DUF/5gugCSOAIW/59uMwl6CHWAib8bvfxWl9/rBGEMTTwDfG+ezEYG4yk6FvRPuPwE+wvc39IRjENWM+/cm5b0W4Pf4WuKUnw/vD6eDbB1ETs5vl77Dhnm/51g6wPWwQAqxnivgQaeS3gy/u/1H4hpTPrIgHAN0mSgXUX13YP5PMIuQAfBr/f70cdeE+QoCX3i8nFMLcAjInBoAIYqt1LhC1WdtvmSab28AYffaeivCB+ohdYQgfUa/WS4ToMsNLHLc9nnvPZLwn1/EefPVf+U/xvnCVSEQEkEQEnEQJO7S7RvYDxNeNYKrG7DKMhtsQ8cMmhgPKKKj+F7CiHYFR5KIIPxOmg5IVAtu3ACQSPh7CzUQOgAej5CWEkIe3vgxz0ROGO//qYfz/dnLT+ZxDr4QW0eNCJBorCFOVC312Ec2TiY5Bk0cAaQmiA1VH1MOwDHQ0kHdEDDf+2UTWhS4Z8diQMicLx8MLBfverLcP/jQzF0P8EJj5+NGK9RCz755S6F/f1+X/gxeP+Wsedv+vF8/54aSPJYFjIQd624MDz/UDLQnr8HU3ztKHRf8Qeno1vyAQJBaLcMtTV3cvgP56COCqd/QP9xLgBkH4BxO13n4hNUDtACC6G1S3zqooZ6Ba4lp/zcAFb7iERKQwQcF39IFJjdXECGADw0IE4gg674pYAnk4HoHPx54tD5daO5vxrugSkMjgiiqc7TVKAT6AT8R4ckbHEQCYR/IZBxJgA+XZjsR7vaoRpIxWqeqfXuGC2CxwudicwePEB1kNkaZCuwyF0DuKv/4sz9mzP/Qxdg3BDkBTMC8Q+loD6UGBzx0Kz6eAX/KArOQTlPHFoI4vVtf4rNuLrca9edRn4xBP7k8w+9AgZCgBfEUZWfEs8iFNZ3UO7TqmkjCO/rWdgco/yIqHcQWaC2EGTzgz5y/iXQAvyx3riyxxV/JeBriaGB9OrTA5g9/eokM+37GszqfA/UZk9iW5UnCtBqBl3XoNN6Ag/+zy6A5evPAp+TIFDn15gQw9rjrOzFX0s2JBVAxa/nP1a6AsNWYGjPNGPLTQgBsNUFvOA3Ht9o/rGDN0tWOCcxJGp+f7++kkP7PxcGv1+GjkaLt/fawpwwerQxBJNW4b+PJsYEgiAYYdEAGIlDNaAbRkIgK3ut0jKByp+8yz23X6GttmBmjwDvChgiYLP5V/zhH6/110sGcKo5CkggCngxnIPoPja0j2B+1BRkiYJiviaLJqghDI63G2nAgAxMCuDdnoD0wIQm+urMB3VuAwbBrFGgGgnhAFqg9+ujKsLxB3qGCQNEEtPinIQlAj4WgIw7/iXc9V/x/yUWFs2KH504bAh4aYWf4TrTLGTy9YbftyLeVOWNfYNyt/ji29mQnqMAltU3ioTtbX343yv/1u0YPUBz6zB702tQucnX0gWaFh6DgPdmhXaapGotw0SFz1qDiTMdd8h45HfcqCPRUhA3+NmKz1l9teCPaMd4urGaewRitNBDdahR5c3AfQmDCFT9vmtQEwqAYXX4XI2n23Z9B/Yb1FL+LWox6wHGbZSo6FR1LzyG+3hriSZvWT6jfXhl2cmQZJDrAbuYAqAHo1GA/EOgD8eGcU7A8eDvH4fQBuAhBL/Zp/vamPTrRENDGLTV/7E1WEPLDlP/PwzU4YhusIMUgfIPAr6Dhv5R4y2r8ldFwiFoYHnmr8TAHbhRQSZOctH598ZYhqt6wP7q/ouqe77RJxvzFYaji/z4vna4v5cUMDXqDAJ5ytktqtBDckyjvJg04hl16LB0xFfyMfD77PZjErGQRRjYIfSvoAXntks0ok8MsUC4KARWnYPlJBeIgLeFrUgDOHYCag0/XNAbWgRwQuLAsaQwIhC1g7+jCNKuT38JfnYSyTi+QQEwwHeT4/dWHYxJPxfOj5oAnRQqgU3YgGZSOaDyK3n/qkDYBKptzR3oD6B4fyRKjp2AzSl80YR/3P+/1vBjX18Jbu+YsrMRgbqPP8zrDLTAaupphfeZtyPs9BPztpLSBZjowF3woYRwBwOWaqbev15b7X4RWsiqYiY6ZkFEIoUwUA2OrkeEQE8HYNyD/rl3m88jCGgO/nPW3xy8x4Q/HBcM1dYg5q8N+B/SBSYhtD0EY1PRGLDoKIBHF3yLz4H/gSYQJRETgqeB2d4vC8L2NVnQn4PoVJJAcP0inahAfdXVI8CFszjRagCTtRdV7Sr895NBpRKXIT64RMFw/iw5eChhEvmmyUIH+k+Qu3cLzOAN6ILlFvgWnx3YWFDz0f38ze9GlfP6UQ3ojEY0gtqRIEbA5/WgQFhsEuIeL75uTzvqHktAWfj/OD6sQXssROcGiRgFn0QVkld7OznMDT7CJKzhMIqxW9B+LCOQdH4uyxIcE49VTSeLj0wKjzcp2oDXQA8YoDEGBLMW0BJw+eAxXejPV/IXd59/tp5rVyYXDw5BlRetSpQAcvgfOwVM8ObzBq/AQ2wX4lwkQV3vNhYFfn2LFgaoDU1ogqsfqGkJYmrj9Tr22KQwBLzbLuzDeA9yzyJjVRfwegWq0H+FThDPA6ZhZwX2M2Kh4waovCzAWJTzD/qY00c+6PM8coz08VNqglzx54LfHuTJK7z2rwX35ABLg1DzsZ7Qv7l/f2yXDlbf4C/irg0MJ0aCuD0wP74MrxfdFlX7tq+vtRdCpvt599EG9Yz3V+P+Oj/n4zLruZHcJ7oMt/MNp9eD6HEeFb6/TMfbWo85Pb79HJo8t3371/PuIAZqMvjPC34nVV6ZB4hEuA7AzA5cfU0y2n6ux89D/35/n2/vWY5Bf0qwf3tPLISO1Tap9qzFB6eap/beqI94NCCbGwgqOItY3CGl446CaQ8i2Q9g0AvmgJOnBoAA0gu17tsKtKS7D4udgCYERy2QIceCX/P7mBW+g/7D9S6Mn50CS0eAoQPDcBjopIA5+EcxEjLweRjXq0UbLIjcBxsGx2IZvlf0ATjz/6qypAmY7bhrk4ahsIis6ccXKHdueAfUgk+RWPCLh42c6zEeKyJpRTdRAOqBbl/Wq/uT+q+Fx3FoTIuCzc6+hN8j4veGjuAnhSE5gKnco3A3XwYlq2sq+lmP4yEOpqEoG0M+mGDYuYT0pKCFHgLHKt3T7T9p8GcWH+n1UwGa8X6kQt2x4CeqPexegT6o/Z4Cr313PHdgrsS2ZReLfpKIf+IMFnmVmwxQ9AhithYT73+p2s+JIVfrjwiHnpAZrSsr9CMstQXP1+1+510N/q8E/YoekMN9OMFvi5LvkRDsy9rgFCOoPdpgaQIWBZjf5KCSQszZJ1ivTvLokpen6tsJAVND0NFqb6GUGg2Im4Dyx9Pn7/0dm4pADAslJzTv+dKNrAPQ0wyySm7bj1RQgbAXsRa4R+mBJzpaQmHLmy0BLoL+Nh2ZRca8uUc6P37k97n451fvTieAE8BdZ2ItqFEK6oOJIYPsiU4woo140Oh+H/UC++gatHYcOFT+2y3AYvD1rM/fpxdUcsAi70c0OxAEP45X/hymE9XeoC0zfYhbcqfbhs09HpwnKMDR6g0mmYyKth/UcLl9ITGQ8N1S6s+gA1HvQCc2pluPvN2Br8SyZyfyxPP/VhCi1L1HWX2CQCuAE8TIq/sBYdANZmTIwqq0sb0HIzhhugBeUpBZLFyA8y+EErsBUYDZHYN9QAAooQwOws+uQlhdESSSqk5Qsh8LSYI6LDS1AbmOvLlRBqQIeITvM36+TP63VfE5hFClCTr9zEyVFwS3STQBy66DMHB+PJWIrfgGnYBx2dTboPa2X49GaBVlePA7CFx4iaGi4ns0aLVjMGvtPTDtmO4XEE8E5Kb/8qYai+NHl60LgAICcUCoJPVeiYG6Pxw/X9VFNVbFn9FNPzXoIRDTyzcpREYB5Fm1EQQn3KRi9wKApR8Tz48SwxnV3qM0q7ZhpdKvr0zfY+gO4oQf+EGPFYW/Xf5hwWsUgxiBbShGoGIx+D2eH1h2EeR3UQMH4zMaUKr4033nzkSkfQADelFbLOQCalxdxvN8mInhPas9bxtGJw29Fx3Y8429MAS0fL33Oeo7qFZeiToCC3B/VSNYuU0fgDnkhxGgMFdxiYEY7MYel+OHPH30IMeVFK1C79l+QdXVpFqHlMAXEf3EYDyfkkGdNvJ8f3RAXU0jpgM7jMNA5yCrtfzOicKG/M9bgEkEjqqPPDEcDfqVwGZv6zcO9avDfOhf4OmLFd9OLBHHdxp51HvOBlnAoQksYjASA1xnIhPsapTCPjbsGB2YevpPpgM73EYeSYIftgPgte6CWesVBB9QEgfnWYMgoeC8ql69bWoRIqYHvSIv/u26bj/jdqZ9KSGk74JRo6QS9PuTiSHm6Z62kLUGH0UO4rwWrhtRETkR4iKRdI8giJ2D2nUCMjsA0TXiVDb98NAf/rCMlajA9wesWHZrAe1dlwRyVI2jx4KkyUHSx7YDe6YD4tOC6XW01puEdAJwaEJzf1uATHi6ZlSCpBQscsh6C1xRcWEG4bCFeKcAVhVlDu54JQIkTT21hptIT/Afk0kMcS9BKfjBJozcDXCrtgbWXxbMAw3INQIxtQJPAGwXmYaBbYh4SCsuKwLOAQ5awKskCMmRg8P3xwlBfbosQaDqyZqBkyQe1CLQACoTgN4qbyHsPwkTiF2pYaj6MAXBmUosQHnUEYCsBL3MW39SNKMJ5PfoBsT33DVJCEbFnBCMOkHfvj6Xq8uw+dgRIhGgAiUqf5QgKDFyhe8nnYrlqn9sG1GoAfirubygX4H+8IM1CmQrMFAJ5ExzKIp54nPoVU2Auh6eBShDlTV4u5c4HE/fVvjFrsII0Ik6QX+Iq68jB19ziLoKC27FYe0gC+j1RSS+BgB7AvAM3m8HLdy5fV60C8RMVuhD1ieQB32MCCq0QPJuvuw5IHF/geMKwOPdpmsxBwVEfGEOgeincJqNmuSFIPhPq/xM81CWIIi+gCFBqDX3QPYd2OcCRo6GZBoA3AM+00aesAOQ7/2Pe/vBCXoguD4OBD1WfPwClzcui12AuH+gC0gEwW72KfjBCQRBr05D0IQc7N8PzOCMehPWK384MPVDJQim7yDdoiRTItzzFV/ZOX9sYFetP0fsQzb6O7wOoFjxk89YoQXv+BmSN+yYHYO+BsDRAXHhuJXsEFbdIEGZQWUkNVNzGA9NZUVBIQL7jASR0AclE4Pb7JN3BO72mG92+o8UG3nybj+mASh0FsLKn9GPxDrEcS2Au35BzHO1BksriIJdpqWjKR1wlpR4fN977rZqI+XbYjYDgVDpcYQalOYKMiuQbB3G6Pu/HlMbi9a0EMkksXtjvvXTfgMKAEZRN/i/O7yD8Da2S2Bdh3ICWfp8yuMkYl5a4df4vVWt4UF0yyqEnaT6swYyWB8/j111Y1ERS9oB0SLMtBGDEBD1PEHwtdjUEAHnqmoHU4wCDAoAS+lHwtu9eQLUAgmxVvAuMB9cELMV3m8EUtcBYYI9nkNIEEJYrQeUHfnzzRyC39j8CgSkir/E0P2odnAmAqDnDIhqrtV9BDNS2POjv/0pwKr6z1h/PMz3uf9ykFYq9TtoAXSwpz0HljdvBCVAPY6t7osv6gFhMpkX13rcfXQMIpuTsfTibkfOPRAC2meLRipI4mDPwMD5x+v3+Ey+qEfACwoUEkKQSMZxYJDz9R68PyP43yvo2aYf881rNQbZgRU/jp80QnW/hdXqJxMvCFxXQSNHpE8QiF4XI+wFfQcw7VL2Md7RRajsKgh2D+6SLAKPF356+/7yXYBTUgFy/38StUjFHweD+iiHh8/LV/i/TSvGk4L5x7F6AsIKbgb4C0YjgdGRIToGUx7cgS3JKP8pRcgak95BJGQbjaJdBYQ1qHYnYHL8F45QgHx2gLMQ2cDxBD/4SeR0LSDi5XzPQNjM4ySE/HGG6g+ugltLNSARn281BPtNO72eJLjdX4ITSEgpQvJYFEUg24f1qAYQNQdxx6Q/RcB85j9f+03zf2QV33IDPHegNgPABTfqFR8cZK9TA7/ll0EQbUUHW8Gr1d+MSadia+LRHwhunv87yWoJ3h/pRDwJAbDNQQFd2P2mH4kP/wDT/ZeN3CK3+ZjvgVpw4r20AMafb58j4N1UMknuj6iCx883PU9g2VHVH5JX2eEcPghSgRBCKPzK0Q3fknwPN0Hk0CyC0zBkz//7duEetgFjVtypASDI4CsknYJgYDhqsBxxy29+eyxrAZX75EEf8f+CkOcijMDDHx4ASYGGu8WHgPwpHJc0qOG8FgFTuVk0cRZVePFwHEIUEu8xSHoL5qWg4I7/HgOKXe2dcnu2SSdCGIDTA+AcxY1zYL6Q6AAFu+/1GvjKPSeEoJV3NiM4Dz9C6oWkEav+NWjPWXNOIkKgNTi2I8LeBgaZHJxqrC4oNXoB9pzzMws/OW3ghSyQJgjbygOVEDhoj4nHLld8HPD6UUMFVLIgKrTL7cFoBRLQgEdXIseZ2/HhFPKbk4d5tYWwwR0nIFQSD2P5gQhs6meVfB+Bkyz2fOIvX/zxqsSODuAGIOLtPNnmIPCrv6Kqvgz3q4tCwNl9lWYfnsdHj2HTgQw5IBHwULmfSu1jEV3gDFSxTBmqSEVqiYK2IkWcRiAkwV/cyW9YhqHXDw9dkNQAcO6HFNJT7oChfrPUYc3KY17zAd+evAwF2w5SCKLV4EuCEKsKfjBVWHu9Q9Arh4CoBqEMWYBsNX7YgKP/69uC3M7/mOOz232QT+ox4iCyJGEFP4oBHd+GVvXBwX35nqp7qeIbV6L6tdZub3ueJ+gBIKgC6S5gOQFxDoGr+Bv2nzqbknd7ph/EmXzO0o+kZdc/wqvQkAOUffVMzKtYgx5Vob1/+HAfCdzHSiXHenX35/2JTr3KZ9Ruj2lYiMhLIFoNyMq9hFroeYMTE0bSLbhb4l3YlFPa6hMd2jk8dmrDgdQCnC4/+ANFlYTB6ATlx2GDGXP1rvL+SnWHw+cJes5/rRWt4H2pw9GklD4uSMpwasIQiaYR92gIyFX5S8dtRZt/nCAH48VXW3hRE/HKOsGquj8EM85Q9cfeAV4XwNGAlmIFIwPYrfLKuxV476RRetzcdeAsRSZhiHizCKEIOHn3EMOWy5X4uIJnXX6sFiBFLaBm/THOQAkVJK9j6TKwiSDTBWpwHkSPQJX7U959uAkoaTUuug6oQCBz1Zlxm0OJSIoIw04M+7zCGuYiznCfHww9AN6Ir+HXA7lfn2oBSJ2FOOh8SzINfmcAyITq8JX/sOMPx6A9LeYtVfwgCBZhdu25OB9/XmWWNPUEPD5dUuJ68wd1AqD2+w1PI9KxE9BW5t3z/igdYGWiL7L+wPv9jgVY8f0ZcbCKCuLAHN+c5wa69Zpr0J9t2KnpAGzyiAIPiFalJ8/xXrrA6Y+/8NoDnWCPNwFJzf5DpVkHte8hx76P+HU1+HEytEeSEIzAsu5r6wPJGu6oLz8VrKofXLce+ywIHhNa/Dmw8LrptWXZ4NKZm4pr/QQ7Qk8ehMrPtAF7PQCD309QgRgRZMKgAbFREAfBBXNalbHA9cEHMo4IgIUuPjjBWEUFEQpYTkhVO43eRiynJw9Jjj8TOUIlJExK+0wA4gWgQvcFBHAc7P4/u78/Ff4CC5ATB3P3oUwFClYgcALcxzp/B9Ez4DUV8RjBbsCBrMH4dLNwIDaCGhA6o3pXksdBvYBsktrXDgNJKAFy1Z+ZGIy5NXgXoBT8a3ZgVSPIUAMV6DjLxhsV8wX4n4ibbONObHNyCr8Z4FinNFjg8ziiF5zSV8A99u7Zdf5OisvVaAAAG3VJREFU/kIPAJLWX3hUIFD6o7MD4WkHIMXBk4IftSrPNBJVk0OoC7ice8HGS8XBKDoz/YFBLaQi392lGpCMJfhD9xVkx5Xbj73P9V4m1j0v73x9FjDDPlYvATkgFAVWcdNvJBamliOjAwRV0EpeRymAe717kMYRyy/j5FwFBX0fP7Dyx8gq8wn2ZXi8GfGYR+lFcGJSxa3Y84WgzBHetlU4cvKY44Ps4iP9fsgsPGEhQTAcHqwwGCj61SoPexKwasXFqtxq8qhD9SixoBBYcJEDNzmIoi3J7QkoJActVHocTVpPBCDhElAvMDK1PT/Sq3DwB/ygmyB9GNhYDH4so4Foy48kkPtZfZEv1PQTxYpyX0EI3Bu+/5krcN8fgwVdwWu2JNVNWAk+PcOOPMNdGFyAZ5Aj6gicgzNfwuHZg0HrLxBWfjSRl88fVCo/apX/IBrIvf65ZxtEoK9Bec4KZIPLe76osQns46NwW0pUPCPAyMc4A/KXOwZzFLGbAqD5xhhbgBcWfoJBAlarcCSQgdQJ+Movnih4gjZQTw51rz588y/ZgxVUEAQ8soCfX8OR26JwujCLGFAMsOjnwGrlPuQw9D/PPv8BYVR7pG/eeFtQpsLzR2KFI8SwKj9KlX++HeLOPuSBKrKeHBi7L4b+Kx184+ptAp4Trcscv69oARVYzWgaK01H1X0K3zNSmARKtxXYHvwJuT+8gLGGWgpHcWOmBeljFB2Ckg6wiAYOqfxEK3GMCAj6kIiTWdCBCXhkjUKMgJcLk271N9uLSbtvvK0S69OXAvoA5z94VsFubbmZvx4QAnXgBnJxENyQjy38wef81uPhxMpPJIQzr5ckuUTKe0wZyN57iFTWga8GvCwlh5UqvYgmaNV9XSxEVWs40kkosFwA70RgNOu8mLZfR6wDiwRa35y7j08NksqPQhcfkRBK/J8R75Iz+9C8gJpqzwiIeZII3QnYOkJWbVEI5jNuA+o2BwK82ifwnpSgHwaC+GNAdmW2VXfC+vPu6wR6lBj84C9WfvivZyUhZMJlJhjSukDlFJ3g4AvGJfC1iEpQJ/CaEd7G9wds7p71+odruKrHip/C7RdsxeVjzIxhoNkFGOW/+sk/YVAGtltfzZAIfzix8gcHhZCXpcGN2u69qWqD9OlRFAy7x2fQBhHUiETB+DocqvArYt98f+AEAXApsEmEcNLC0t2uPHCqPQIXwHYDfI4/9+8LMpchqr5HK39MJSrBXwnutNqjovjHFdq+fcHLp7YLR4mGgduW5hFpAXUoL4cTTuW5HJSkB5PC0S7A+8c+837DyoM1J9iv/po/o3BunlDqPjOSO/YbLFd+FGy9sxKFeT8b+nLNPrkAyD53FtT27yUS32yqUaEGTMBiASGcZ0FmK8nWxbvjC1q6WQC4VdWdAcBY8eFoAzIrC0b7Wt8wlPcIdE1FhUWeKU1Igv8Q/0dl4k/NnYSxdlDon8diUDeuQB4c8XVzcahRgyyZmNC+LAgeCfSVALde8/t1DCYawNoePGT83wlOpFUdOZKwxn89OsMEf0X8CxJCBN/dwKbFwkSMgx0ACJJDJD4iC1JEYh6XcEqVHpx4+J4I4UiAl26r5x64sttvSlAn3LBuQCz6edU8C+J5epBrC4YP52EFDgHrCw1B0eU9bOaTgh3wmYvQV3Oqqcf53XnVNXUBELX1xtSgFrirlII5d3HFulxBCNEfZx0h7K2f34XwdHpuYQcguN189Ow/nPXclaUcqMH5leCXjKOjbv3F0a7i2ZaRHmBe5zwnhA9S736ZC8AH8LHkg/T5znYgmES1dtuzGo92qwHIquiWX+4KgVLd8utv9Ml1BQNhEJW/FOgweiTguCUoQHkEwYhjfQIgm8eAzPKzHqAG5xGiiPyxeGRRaYetUpDVpHVC1T9bHGyaknb/TQTnuG7rDYwYCUT7/cMjtILzA+Go/FPw581F/mWeTkDuBsBCAK8ki+A29nMzPn4Rzjv6QV7xWW4fzQFUxb9jQQ1qc28kMi4mDl1NBr4usIsz5ltZqNm7AeJXfuTHd7nioLEyPBISU+8/tP1AC4Il/n+YGmjg2NiBRdl6yCw//zG5ph7bqaBuz8B4VMU/TqSsNPbwCeZA1cdxyG9SgKzRZPL+GXFOiH1/SFZ9wX8M3zUgvH8a4rMBjZj/h1W9MrwTiN6MlsCKiI4gycBzgV/xUaQGjGDHwHiYi0VIzeEAasCpNuL76AC7BIEl7i4AIxnAfoMxk35eJbZ68wWEUChs8IPz/EEE9BkUoNA4RCWSLJkY1h0Y/dG9bVCtUVPe7QRhtStXG4nOECDfUxc4Uw/Ik8JkA9o9+a83IrfHH11EdFUWc4phNgVFWkPsIHBnCvCCYBSgqEN9qtoXuwHhByYoJJA7BxIkkRwpDGgAHo+vQ3ZGOwCFJCJKUAx4MBpFZWvReeLgtBBkDDQu2OJxXa7SE/P4ZiUPHABjY1DsFIhPAaygWewiXK72hHjow/k8gCL6gKES8qcDZ7A+EhYlWCPGCX1wXIwzkQEKt8cP6iqkC0FEhFj/ZYtvXCtwuBLcDT5wXN+9H6ZEIkTwV/x/s78fXFX3siWHEKrC3tw7EFZ31Ll7ttknQyEMGgAqCaVe1bGk8r8nFWCQQR0h7CY0dsU/mIeIuA1AGCo02Q0YVXxub36sG1Qgfo0CBBUXxap+ECFEycQVyViBEBFPt14TK9rZHB9EwMG7DPXOv0OVHkdtx7OSCXfb3av4CFZGTwQBwT7/hKPHE4PzpJ4L4+FM9r1n8B+B+9R9I4Fu9brYUZgCunZWNxdQgIs8mASBQ4F8hJpEiaf4GPihk8FdAxin/kybjZjTj+mAQy6ihZ9whDvHAWB6BKrBXQr+5SBfqPaINwiz12UIwoTmbPACZY/fshBBBKNlW8ZCHwH/cVKSOZMm4Mxk4OwE9JeB+EFkn1IzcPQoiSB4vGgNeJSoik1A7m0TCmE/HrggB+/1M12C1Z18ACGoIeH1pH2IhAqFWgBq+kDFEWAvA3X8tpW0cnSD5WAOriOHhnYraF1eLTkS8P/QsHUBdtMPnOrMaANJE9AZiaKWII5Ue/8PTHn/UcCSTgIF2xN4zdmAQYIAKeBFl6FiO0aKfq5jcImHfPwTxcEdRmD3LcFoAva1Hdjm9UgGggI9YOoPkOBYLsT8HlG3nucMDGkOOJ8CkNOELdSO7D5qqAeJYBb2GpABgRi2gxLITgrOQ9C937HgB+0i7MeRx3gfPWCXLtgbLJAu/gCFBPzRX8eADJqCvA3FViC/BlOQC4LZyrBq8BdQAOUKoKjqR7v7EFfVFMojPgEoSlJesNIePyLHwW9NRgq7E6HvUN8A0yj0wyWDHRZ3J2A1jHdMyu3hCGwSDwdRir7h9VP7AKLgPoMCgKziOFLtrUm8aIFHlgxYfz8WBYUU55iAXauo+evJaIK/NTgRJM9sUcZRzcCnMdNKMJc7usnAyrpxHYkTRHK+n1HxS01LheAHqRWwKIDqLvQC0+PupHZgBawfVGsiniTVHwZHRqbUI/D4Cd+ftgyLAR1ehkIiqaKFw7MJEwUIuK5zsu4svoFYCFKgBJZACBuppOId2RDkPZas8H9kULcA9a0KTCQDGtpnzT+RMJiOGseHl4BQ1C29AWUXIIf/OIwwqoNEK3SCuA7FRiBrE9B4/PcrGJ1OQNj83F4Xbol/TgVHfMiIZLAdcaVkgh8sLrd+liNQH/FqsNTfj15m1J0X+ffZuq/gTY7QnvIfJz6UzBJLs83ItQpt3RfZz5iuGfNPajpngUm0R8DoA5jDlzsOTAwZjzsC3Jjxg7H914PjlcskGdghgx9HG4OOQH34uwQyzz61/0qiYNQjXxECuWYbGM/DrjtPH/Mw/K+gBLLSA+cEfPr4MroArzcDuybbr8Zc72i2UnzeHnTgzD4Ug78SzIvCoARVOQxaFFR3TzWnkkHUVFShEuqKxZnKz4p4YYcf8ZhYhuu8wFgSHcuuwCJagI4bgchJQK/qe9c/RT6nGcg6KGREJpb+MI0EY/b0jcsni3AJBeCQNsBOFVYoApcM2Aom4VFgIRdHpeIG8D3YaxBD+qCiQ+rBOSVnci8hzkAG1t/pgHA4uwDzmu8xFKkkkIqCfkIRs204r/hiDgutoAAcowBMZ9+KS0CcXVBOHCvJw2jMQSJyeoeExF2DuTuRcuWAo9sefyUQ6/oBaIjPtiRH1KvQKvygAHb171d+vc4GRMDPoxN/kL5pwlVh1mBQ1quQJAJ5j0TgOAis+h8d3mnC8xTKE34+8sDNjyVXE6nFMN+H39TQDmocHScENvN74LoGScGU4f7g6IG3n3C3qnG6JBS+Z5tHOOzRYQx+u7MZmAl0OSsRLAS/VIKfRAWU92+12aaVPksGDBWQuCMvgNy2M2Mt8EwqbjosZAec5xLEAmXmcFTHiOWARWglpNpjdEtBQRxJJU5VL5/7F1X86XntXgUK4q+KggsUoIIK8oA+kgy4+zLaACqQGTVOX6MBWdehL6BxHn+tlyBMDGAqufd7WOX5WTJwKYDfXJJP2GXDPk7Tj5Ed7BOG7DMFaBRAJgI/+H2Ngeb2SKb0zkoGlQBHkefDr7xMA5HZeJPtKIzyApI9gmnPgf1c3mulfhe0gFekDCdNFnrOwi4Gs6eTACNjB+Uegcgojog4V25P8bctRYY6RL8AJklE9ACFAGZdBEahd4d4CmghFhbzcwaXYH5qTlS6DY+KfNH5Avzjo2JJ0poDkSCMxLn73H/eB+ifvgvyIFCWAji7BWC8hd0qj0FziMdrS70BlVbgamIgcmotGZDNPwm0L9l5iHv7WRoAFx57ScFS2r2iwot8oKu8l+TOCOg2mZ2nFdjTgOFQENzKkJ8OjEnsE8f6AzyXwT6MNF3RDRnuj0Lwo6wTlBMDIyqaz6G+RiLJMg/KUrQV/rh9uH0tWduwoxmky0kSMQ+rnXxZsGadgnxfgk1pCnsIsGYltvfdzTOBIclIsN8MLAGcz5gBwj94AE8DuC9Molip/JGwB57nRyJiyD3pyk6q5ij+3TzRLohcqyqCEQBTepF15+WVmW8SEr5jMUUkx3oMIsrH3ndwAQganKzyMpOJNxMQooGBYwcByw7axIhgPRGEr6GSGJhkAELoQ1YRg+dPeD5IIRDIqq5PA2Jh0Rq0YcS8XBi0ghGRFpCtWTdum5+yLOsQf2EuYY8AfnbQZDgCjHxBSKwTGpt8QCIDVH3/4H5OwEvldhliINwAFLsEyyIfGKV+vm3eEehVqKTdNxtDiPoLHCRiuwTJxCECxMDqDjTvZ63KaPKvRgV2i/F3ohm88V8LN8hgJcXD5pVGIPPNn9EBqSQC0I4AMxBUcQNCkarkFgSn/oCs9GCVep4eUG5BRAOcQOCWlGSc3If0IFqRfURQGRrKewPKEJ9sLnIowKCcw+f48N6UHjqYtgInaCCkBbPSj8VEkCr2g8U43wY1xX/BNkwreQrzg+oaJghOCGTU8RBxuIp6VFOGoEXgEsBLIgV6gBgxoLSI5CgiYNT+GBHsU01GthrceiMUtv9KgAYktgVNeGrBbtiOQVi9x8WjiAW7UNUnm4Vet7WtsFgDCDYEwQ/EVL1PnQf/xCDLTowTh4c4HPRDoQaiwhKIAae4B7xgCBydI/CDPOrevK0FR4p6w3VfoXgQiB3T1N8Y1PCD0X19JqcHGfzB5WkQE4p/kdeXBcEVUXEIFqSij82lMyrWq/7c+LFHA7z5/dwOHHg8s/Y8C2CmhbmALtare+4UWLfb25BmXABKABTniC8gRAP2yvDAiUAsElnrxFzITQa/sAFecAOY7zPV/8jMQHSbWAiUPGkQNABhw85xrSCv+mMSzFR8+7mjw01A8f4F8S/td4jnDHYxpT8/OEyV3gz2+GTfdAeAszswfJNGlQhEIjB0Bls0BKn4Iw7WKu9f1gmSagmvqleEwJwnZwjO7npz1HdCJ1hS/mlBcRXyF3i/M7NxqJFoeH27z7nnJaBmpUZKHsTbGUc1ALEoIGsGYl9ixS50gjAT/VhB8IzvGTrBVfWEz1MzAkRFTtecW731VdjNQPukVdhdn0Y8d/a7WYH6i/TBPBzUFwAlHwtGHOQISrgb1AMUgDETTA3+THAdeRJhg59V/Ektofa9I8wxVICkC7QQSAd2O3cftzPzdMK6aA4iZI4ILfYRbb9RgqICt2AxVnYZ4kkBvHOBxT/zN9ybHx/f5Ql2fkGCX6ANm6F8WCfqAS+Eq5AGcHJd2IFHagTMHAAj+mWBnDXuc81CjhsAi5dL2K8QCYI1aJ/PJtSSxEFXASv7C2I3ZB9/a0j/7nDn/j1pHsz9Jr8fNpxPBUAUUYD4wz5GBlmyAiORjtAIGDFwzSUwqiNZ1d1tPiB7/Q9VeI9KeJU16/knkEeQJEALjY4rkp74fCZiMDSA/PgvT/aT2gYgp5E/P29AKBQAo6TRth5T4VesQFb0i4K7RA2MZpgyFXCEQHCOixuYMPgy2L7+45ezSSKt2oUkURlpXkEMOLSiXPuDQZjk63N5bmzOSxQdLHX7AhwUEA0BAeQPJIQzkAuFlOK/GtyLdiGDKEBdllQ7YouxV2Xdwza9So4Kp5Z0yAgUhTlJgFzSFrznIHYIwKcCu2/L3LsCg6UI1b1/CA+ApIV5/32HqOIjdQusE4azip5Wc1b0q/QGIAlaWEJbXP3r/L+AEipw/+BtkQVY9fIM2i/ZhgVEgJO6DZ1ksVtlYdoQAPhVO0oKmYBmnAYco4DRCRB3TwCziptaE0auER9/VzRqKNOEYINOQg2m1l9GpGNQAhh1v6UmxNQh2M4+LmlUzll0OTjYQOaGlZAEMCrdhmBphaMBwBADrSQQc3//He8KgFETT7p6BHnjj2X9EXsDjrgBS6ihoAmcSQVYmE4JgYWFpp1waAQRoqDzxDhU+HxSnZHz/9JEY6Y5MJA+cwoWrt99+U3Mc/9g/NQTFaigAEtwB1yBzwzucZSX7RZEILhR1d5GDCsBLVUdIQvsldZfEJt5i/MHx2hGJZFkVVyK242iFeh58oBUFqIQbkfp2DV2X0CkAYgv1sU+P+I/HmBu8nErugdRnUWhfp+A/ddlbEH3uQlBsNobUEMHasK1HOYn8BEEvCUaiuigXRIKj+sGOPA4KAWz9/s7WxcgB4+a6/fI2osEwv4yOENAiPf+wQhbc/5f0gGisWuQaRFmGoIqguARWsBQgTTocDLMT5OJUQnhqdCEig+/EShKSEgTVV0MBMnz04BcshPnLk/+OaV0/dwKzB4QUt1NB6uTDfGOP+cNm9mEsBAFiM7AQh9AKVEU75vy68jeOxrUC4mDEuYO0oLqoSdHaEF2eXYYSm0V+oEOwpLmYFOF3Z4CmAeBTIGueiIw2xoKPzDBJVBXQ5g5O8/twwA+QguIjJt3+g0NQEcDfUXgO5gsqlTBLkQLdl86K3CWneitQ8sg/5oWAUJP2C3V3RoEyji5n4b9lB4t9pz2CA+cAFn1Z9I/uzYsU/ELtEBOCHYQQqGcFejV+yeuRJX31zsKV5IGjway9z6PLDxKwNEPsBuOEiqw57jGgOtZ1Y++T50AuMFl7hPIbhskiOwsATtRoc7rS7dXrpcgrMCGJca6ELJo+Y0be0BW5ZKGcFz4y8W9BduwcDnK9iO5fagsKpp9ANnvDPxeP8THNyIVFo1AMas8Qk5v2Ytm0LCCYAXqn+wQsPTBh/5Bcnne14Os3uCQt28vsK1WUESJFviBgAW//3u9PLxusXchcCR2WsNzv/ImvgZzzkUByDUAIrjTvmSHAowpJBQE4SUlxMxnARlQbIqkArVAJ6pBBvELCCKlkyCDAP45BYfEPfcUpfMch3Vn4bheYK4E66BxAxHSVd5INgEPgU/NBCDfNQ8Ho1CoINAPQAW/QT8OCIZlNFCB84XhoDChFByHGjx35v9BLgyhmojqHYb5QYXnuAecvua0hZe6BV9f7v4ibvgvamrmAc1TmaEir0LQ9h97eYAYVoM/nWA60i8Q3Ifezha9BqaaL3zvqd6IAuwwLSCCuCLuJWch4h30giPtyiAphKEBcCu9BV5wwzkMxID8rhMwdwMhcSFgrBT3RUTQboAUg3+p+Qe1IGarOioVnazmefV3lHpwA0AcLWCahUiXwePHWJsP+GH1gnp/we5KfOhJAbsj0H/BIEb04TbrTPsAyb2LLu93KwfCvn5PLAwrOXAa72eEQRo1CNdw5IprsAZ3hApy9zlcITG2vpCihsRSYxNS+J4vdBZ6B52eqRcQ/QXmSjAWSfa/5GA5qEg4iJFtm624AqXLrSA2gx8p1Mdqcghv41S0lSp/xAYs9gakQc4Ie2RTUYwYgt748mV+FU1Xgp14eW3XYZ6cdqGTNHwHICTwEeTPl0jEZwIgP9gDEaogeg5IHWCF+1eoAhvEKPB/EAeTRsM/pSAP5wjWEUMM1/NJRhwJbpJSgK7S7zF3EOsI5jBQBK9DV80Z8Y0COzvmWzJXgDl40KEC6cqvqgi4OB5cpgLFYK/1CvDiItXqC6/S87wfAUfPtxqfGNzlYaOjlf1IsHPPvffHgDAoEeEST4ZLZUd/RSo91/BjXY5ggWgQ4In3fyj4mUqPrInHOCLKO3wUwRsfyXpt1nEIRLrqcWeTuk7bigsbid1zD4iDRQtnIdQsyIXnFCn1I9D7ADgxEhOvR5AJosoUbu1FkJyYCi9OhQERoIx+4AX/YqUXQhtYEwKN4Cy1HntLMmtaAQpqfrT/UCoLSxeswjA5UWPPi0mjajUWxMTdVusNvt/ChMdmILK5IRMFu90BMEzFYHdg2GAgeYVHMMJIBTA7EFTx/5fpgTFXz9w/en0ZjD8kCDoKPNGwlB01BmoWQbh+AxR689mBponGJOr9OwmMu3dtJ/ylW1Tik4ElUPmR9RqII+pVhD9ychABMQ51gOIZg+/G+5mGIzLB1JJC5WhzYjhJ7IWmLDpA8jzsAafUPkB2WnFBF4iSxkq1ty7f25rv/+EQLOxs2oUdTSA9HIR9swdBlCcFe9owPC3XWDDC0ISVzsEVbSCF/sWdA5Fu4HJqankp2SeQCYYrImNalfmhpVxYrGkUS4LeSUjg8dD7+D7w/ybIfy7vlB9/HJ978zr7/45Qgajzj+4EjIK/ULHPRAOlKr/aG0AFcqCyu0GcW45Igh6JMJmhA49/U+cEssHNJhtXDC1MOya3j/sAiAGcrEtqtgjBD6wEzSDc7D8o6C8rIqAZyPk+NQoNLAZ1hR64Yl1FBY648smUYKnSg1Xwk/0DyRyArByMUobyByhCcPnOaPyoegREFS4jNfYAw+IHCjdC1J2WDZBke/OyN85J24WiXwDYPoJyYuCD238ulvuzwt6KgHf0shWKsqCFFGjB/w8HU8eeTED9wAAAAABJRU5ErkJggg==","EnvironmentBRDFTexture"+j++,K,!0,!1,z.c.BILINEAR_SAMPLINGMODE);K._blockEntityCollection=e;const F=K.getEngine().getLoadedTexturesCache(),l=F.indexOf(T.getInternalTexture());-1!==l&&F.splice(l,1),T.isRGBD=!0,T.wrapU=z.c.CLAMP_ADDRESSMODE,T.wrapV=z.c.CLAMP_ADDRESSMODE,K.environmentBRDFTexture=T,K.useDelayedTextureLoading=b,k.c.ExpandRGBDTexture(T);const Y=K.getEngine().onContextRestoredObservable.add((()=>{T.isRGBD=!0;const b=K.onBeforeRenderObservable.add((()=>{T.isReady()&&(K.onBeforeRenderObservable.remove(b),k.c.ExpandRGBDTexture(T))}))}));K.Ui.add((()=>{K.getEngine().onContextRestoredObservable.remove(Y)}))}return K.environmentBRDFTexture}},11233:(K,b,e)=>{"use strict";function z(K,b,e){try{const z=K.next();z.done?b(z):z.value?z.value.then((()=>{z.value=void 0,b(z)}),e):b(z)}catch(z){e(z)}}function k(){let K,b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:25;return(e,k,j)=>{const T=performance.now();void 0===K||T-K>b?(K=T,setTimeout((()=>{z(e,k,j)}),0)):z(e,k,j)}}function j(K,b,e,z,k){const j=()=>{let T;const F=K=>{K.done?e(K.value):void 0===T?T=!0:j()};do{T=void 0,k&&k.aborted?z(new Error("Aborted")):b(K,F,z),void 0===T&&(T=!1)}while(T)};j()}function T(K,b){let e;return j(K,z,(K=>e=K),(K=>{throw K}),b),e}function F(K,b,e){return new Promise(((z,k)=>{j(K,b,z,k,e)}))}function l(K,b){return function(){return T(K(...arguments),b)}}e.d(b,{b:()=>k,d:()=>l,h:()=>F,j:()=>T})},11497:(K,b,e)=>{"use strict";e.d(b,{c:()=>B});var z=e(10984),k=e(10696),j=e(11505),T=e(11507);e(11531);const F=131072,l=131072;function Y(K){return K.charCodeAt(0)+(K.charCodeAt(1)<<8)+(K.charCodeAt(2)<<16)+(K.charCodeAt(3)<<24)}const A=Y("DXT1"),X=Y("DXT3"),t=Y("DXT5"),U=Y("DX10");class B{static GetDDSInfo(K){const b=new Int32Array(K.buffer,K.byteOffset,31),e=new Int32Array(K.buffer,K.byteOffset,35);let z=1;b[2]&F&&(z=Math.max(1,b[7]));const k=b[21],j=k===U?e[32]:0;let T=0;switch(k){case 113:T=2;break;case 116:T=1;break;case U:if(10===j){T=2;break}if(2===j){T=1;break}}return{width:b[4],height:b[3],mipmapCount:z,isFourCC:4===(4&b[20]),isRGB:64===(64&b[20]),isLuminance:(b[20]&l)===l,isCube:512===(512&b[28]),isCompressed:k===A||k===X||k===t,dxgiFormat:j,textureType:T}}static _GetHalfFloatAsFloatRGBAArrayBuffer(K,b,e,z,k,j){const F=new Float32Array(z),l=new Uint16Array(k,e);let Y=0;for(let A=0;A<b;A++)for(let b=0;b<K;b++){const e=4*(b+A*K);F[Y]=(0,T.d)(l[e]),F[Y+1]=(0,T.d)(l[e+1]),F[Y+2]=(0,T.d)(l[e+2]),B.StoreLODInAlphaChannel?F[Y+3]=j:F[Y+3]=(0,T.d)(l[e+3]),Y+=4}return F}static _GetHalfFloatRGBAArrayBuffer(K,b,e,z,k,j){if(B.StoreLODInAlphaChannel){const F=new Uint16Array(z),l=new Uint16Array(k,e);let Y=0;for(let e=0;e<b;e++)for(let b=0;b<K;b++){const z=4*(b+e*K);F[Y]=l[z],F[Y+1]=l[z+1],F[Y+2]=l[z+2],F[Y+3]=(0,T.g)(j),Y+=4}return F}return new Uint16Array(k,e,z)}static _GetFloatRGBAArrayBuffer(K,b,e,z,k,j){if(B.StoreLODInAlphaChannel){const T=new Float32Array(z),F=new Float32Array(k,e);let l=0;for(let e=0;e<b;e++)for(let b=0;b<K;b++){const z=4*(b+e*K);T[l]=F[z],T[l+1]=F[z+1],T[l+2]=F[z+2],T[l+3]=j,l+=4}return T}return new Float32Array(k,e,z)}static _GetFloatAsHalfFloatRGBAArrayBuffer(K,b,e,z,k,j){const F=new Uint16Array(z),l=new Float32Array(k,e);let Y=0;for(let A=0;A<b;A++)for(let b=0;b<K;b++)F[Y]=(0,T.g)(l[Y]),F[Y+1]=(0,T.g)(l[Y+1]),F[Y+2]=(0,T.g)(l[Y+2]),B.StoreLODInAlphaChannel?F[Y+3]=(0,T.g)(j):F[Y+3]=(0,T.g)(l[Y+3]),Y+=4;return F}static _GetFloatAsUIntRGBAArrayBuffer(K,b,e,k,j,T){const F=new Uint8Array(k),l=new Float32Array(j,e);let Y=0;for(let A=0;A<b;A++)for(let b=0;b<K;b++){const e=4*(b+A*K);F[Y]=255*(0,z.e)(l[e]),F[Y+1]=255*(0,z.e)(l[e+1]),F[Y+2]=255*(0,z.e)(l[e+2]),B.StoreLODInAlphaChannel?F[Y+3]=T:F[Y+3]=255*(0,z.e)(l[e+3]),Y+=4}return F}static _GetHalfFloatAsUIntRGBAArrayBuffer(K,b,e,k,j,F){const l=new Uint8Array(k),Y=new Uint16Array(j,e);let A=0;for(let X=0;X<b;X++)for(let b=0;b<K;b++){const e=4*(b+X*K);l[A]=255*(0,z.e)((0,T.d)(Y[e])),l[A+1]=255*(0,z.e)((0,T.d)(Y[e+1])),l[A+2]=255*(0,z.e)((0,T.d)(Y[e+2])),B.StoreLODInAlphaChannel?l[A+3]=F:l[A+3]=255*(0,z.e)((0,T.d)(Y[e+3])),A+=4}return l}static _GetRGBAArrayBuffer(K,b,e,z,k,j,T,F,l){const Y=new Uint8Array(z),A=new Uint8Array(k,e);let X=0;for(let t=0;t<b;t++)for(let b=0;b<K;b++){const e=4*(b+t*K);Y[X]=A[e+j],Y[X+1]=A[e+T],Y[X+2]=A[e+F],Y[X+3]=A[e+l],X+=4}return Y}static _ExtractLongWordOrder(K){return 0===K||255===K||-16777216===K?0:1+B._ExtractLongWordOrder(K>>8)}static _GetRGBArrayBuffer(K,b,e,z,k,j,T,F){const l=new Uint8Array(z),Y=new Uint8Array(k,e);let A=0;for(let X=0;X<b;X++)for(let b=0;b<K;b++){const e=3*(b+X*K);l[A]=Y[e+j],l[A+1]=Y[e+T],l[A+2]=Y[e+F],A+=3}return l}static _GetLuminanceArrayBuffer(K,b,e,z,k){const j=new Uint8Array(z),T=new Uint8Array(k,e);let F=0;for(let l=0;l<b;l++)for(let b=0;b<K;b++){const e=b+l*K;j[F]=T[e],F++}return j}static UploadDDSLevels(K,b,e,z,T,l){let Y=arguments.length>6&&void 0!==arguments[6]?arguments[6]:-1,u=arguments.length>7?arguments[7]:void 0,m=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],D=null;z.sphericalPolynomial&&(D=[]);const I=!!K.getCaps().s3tc;b.generateMipMaps=T;const x=new Int32Array(e.buffer,e.byteOffset,31);let Q,G,i,S,M,r,L,c=0,v=0,w=1;if(542327876!==x[0])return void k.b.Error("Invalid magic number in DDS header");if(!z.isFourCC&&!z.isRGB&&!z.isLuminance)return void k.b.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");if(z.isCompressed&&!I)return void k.b.Error("Compressed textures are not supported on this platform.");let h=x[22];S=x[1]+4;let R=!1;if(z.isFourCC)switch(Q=x[21],Q){case A:w=8,v=33777;break;case X:w=16,v=33778;break;case t:w=16,v=33779;break;case 113:R=!0,h=64;break;case 116:R=!0,h=128;break;case U:{S+=20;let K=!1;switch(z.dxgiFormat){case 10:R=!0,h=64,K=!0;break;case 2:R=!0,h=128,K=!0;break;case 88:z.isRGB=!0,z.isFourCC=!1,h=32,K=!0}if(K)break}default:return void k.b.Error(["Unsupported FourCC code:",(n=Q,String.fromCharCode(255&n,n>>8&255,n>>16&255,n>>24&255))])}var n;const P=B._ExtractLongWordOrder(x[23]),d=B._ExtractLongWordOrder(x[24]),p=B._ExtractLongWordOrder(x[25]),a=B._ExtractLongWordOrder(x[26]);R&&(v=K._getRGBABufferInternalSizedFormat(z.textureType)),r=1,x[2]&F&&!1!==T&&(r=Math.max(1,x[7]));const O=u||0,g=K.getCaps();for(let k=O;k<l;k++){for(G=x[4],i=x[3],L=0;L<r;++L){if(-1===Y||Y===L){const j=-1===Y?L:0;if(!z.isCompressed&&z.isFourCC){b.format=5,c=G*i*4;let z=null;if(K._badOS||K._badDesktopOS||!g.textureHalfFloat&&!g.textureFloat)128===h?(z=B._GetFloatAsUIntRGBAArrayBuffer(G,i,e.byteOffset+S,c,e.buffer,j),D&&0==j&&D.push(B._GetFloatRGBAArrayBuffer(G,i,e.byteOffset+S,c,e.buffer,j))):64===h&&(z=B._GetHalfFloatAsUIntRGBAArrayBuffer(G,i,e.byteOffset+S,c,e.buffer,j),D&&0==j&&D.push(B._GetHalfFloatAsFloatRGBAArrayBuffer(G,i,e.byteOffset+S,c,e.buffer,j))),b.type=0;else{const K=g.textureFloat&&(m&&g.textureFloatLinearFiltering||!m),k=g.textureHalfFloat&&(m&&g.textureHalfFloatLinearFiltering||!m),T=(128===h||64===h&&!k)&&K?1:(64===h||128===h&&!K)&&k?2:0;let F,l=null;if(128===h)switch(T){case 1:F=B._GetFloatRGBAArrayBuffer,l=null;break;case 2:F=B._GetFloatAsHalfFloatRGBAArrayBuffer,l=B._GetFloatRGBAArrayBuffer;break;case 0:F=B._GetFloatAsUIntRGBAArrayBuffer,l=B._GetFloatRGBAArrayBuffer}else switch(T){case 1:F=B._GetHalfFloatAsFloatRGBAArrayBuffer,l=null;break;case 2:F=B._GetHalfFloatRGBAArrayBuffer,l=B._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:F=B._GetHalfFloatAsUIntRGBAArrayBuffer,l=B._GetHalfFloatAsFloatRGBAArrayBuffer}b.type=T,z=F(G,i,e.byteOffset+S,c,e.buffer,j),D&&0==j&&D.push(l?l(G,i,e.byteOffset+S,c,e.buffer,j):z)}z&&K._uploadDataToTextureDirectly(b,z,k,j)}else if(z.isRGB)b.type=0,24===h?(b.format=4,c=G*i*3,M=B._GetRGBArrayBuffer(G,i,e.byteOffset+S,c,e.buffer,P,d,p),K._uploadDataToTextureDirectly(b,M,k,j)):(b.format=5,c=G*i*4,M=B._GetRGBAArrayBuffer(G,i,e.byteOffset+S,c,e.buffer,P,d,p,a),K._uploadDataToTextureDirectly(b,M,k,j));else if(z.isLuminance){const z=K._getUnpackAlignement(),T=G;c=Math.floor((G+z-1)/z)*z*(i-1)+T,M=B._GetLuminanceArrayBuffer(G,i,e.byteOffset+S,c,e.buffer),b.format=1,b.type=0,K._uploadDataToTextureDirectly(b,M,k,j)}else c=Math.max(4,G)/4*Math.max(4,i)/4*w,M=new Uint8Array(e.buffer,e.byteOffset+S,c),b.type=0,K._uploadCompressedDataToTextureDirectly(b,v,G,i,M,k,j)}S+=h?G*i*(h/8):c,G*=.5,i*=.5,G=Math.max(1,G),i=Math.max(1,i)}if(void 0!==u)break}D&&D.length>0?z.sphericalPolynomial=j.d.ConvertCubeMapToSphericalPolynomial({size:x[4],right:D[0],left:D[1],up:D[2],down:D[3],front:D[4],back:D[5],format:5,type:1,gammaSpace:!1}):z.sphericalPolynomial=void 0}}B.StoreLODInAlphaChannel=!1},10942:(K,b,e)=>{"use strict";e.d(b,{e:()=>j,f:()=>T});const z={},k={};function j(K){const b=K.getClassName();return k[b]||(k[b]={}),k[b]}function T(K){const b=K.getClassName();if(z[b])return z[b];z[b]={};const e=z[b];let j=K,T=b;for(;T;){const K=k[T];for(const k in K)e[k]=K[k];let b,z=!1;do{if(b=Object.getPrototypeOf(j),!b.getClassName){z=!0;break}if(b.getClassName()!==T)break;j=b}while(b);if(z)break;T=b.getClassName(),j=b}return e}},10938:(K,b,e)=>{"use strict";e.d(b,{A:()=>m,E:()=>F,H:()=>A,L:()=>X,M:()=>T,b:()=>j,e:()=>I,i:()=>U,m:()=>l,n:()=>B,r:()=>Y,u:()=>u,v:()=>D,w:()=>t});var z=e(10942);function k(K,b){return(e,k)=>{const j=(0,z.e)(e);j[k]||(j[k]={type:K,sourceName:b})}}function j(K){return function(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(e,z)=>{const k=b||"_"+z;Object.defineProperty(e,z,{get:function(){return this[k]},set:function(b){"function"===typeof this.equals&&this.equals(b)||this[k]!==b&&(this[k]=b,e[K].apply(this))},enumerable:!0,configurable:!0})}}(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null)}function T(K){return k(0,K)}function F(K){return k(1,K)}function l(K){return k(2,K)}function Y(K){return k(3,K)}function A(K){return k(4,K)}function X(K){return k(5,K)}function t(K){return k(6,K)}function U(K){return k(7,K)}function B(K){return k(8,K)}function u(K){return k(9,K)}function m(K){return k(10,K)}function D(K){return k(12,K)}function I(K,b,e,z){const k=e.value;e.value=function(){let e=k;if("undefined"!==typeof _native&&_native[b]){const K=_native[b];e=z?function(){return z(...arguments)?K(...arguments):k(...arguments)}:K}return K[b]=e,e(...arguments)}}I.filter=function(K){return(b,e,z)=>I(b,e,z,K)}},11001:(K,b,e)=>{"use strict";e.d(b,{e:()=>Y});var z=e(10710),k=e(10963),j=e(10994),T=e(10967),F=e(10942);const l=function(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const j=K();k.d&&k.d.HasTags(b)&&k.d.AddTagsTo(j,k.d.GetTags(b,!0));const T=(0,F.f)(j),l={};for(const k in T){const K=T[k],F=b[k],A=K.type;if(void 0!==F&&null!==F&&("uniqueId"!==k||Y.AllowLoadingUniqueId))switch(A){case 0:case 6:case 11:j[k]=F;break;case 1:z.cloneTexturesOnlyOnce&&l[F.uniqueId]?j[k]=l[F.uniqueId]:(j[k]=e||F.isRenderTarget?F:F.clone(),l[F.uniqueId]=j[k]);break;case 2:case 3:case 4:case 5:case 7:case 10:case 12:j[k]=e?F:F.clone()}}return j};class Y{static AppendSerializedAnimations(K,b){if(K.animations){b.animations=[];for(let e=0;e<K.animations.length;e++){const z=K.animations[e];b.animations.push(z.serialize())}}}static Serialize(K,b){b||(b={}),k.d&&(b.tags=k.d.GetTags(K));const e=(0,F.f)(K);for(const z in e){const k=e[z],j=k.sourceName||z,T=k.type,F=K[z];if(void 0!==F&&null!==F&&("uniqueId"!==z||Y.AllowLoadingUniqueId))switch(T){case 0:b[j]=F;break;case 1:case 3:case 7:case 9:b[j]=F.serialize();break;case 2:case 4:case 5:case 8:case 10:case 12:b[j]=F.Ti();break;case 6:case 11:b[j]=F.id}}return b}static ParseProperties(K,b,e,z){z||(z="");const k=(0,F.f)(b);for(const F in k){const l=k[F],A=K[l.sourceName||F],X=l.type;if(void 0!==A&&null!==A&&("uniqueId"!==F||Y.AllowLoadingUniqueId)){const K=b;switch(X){case 0:K[F]=A;break;case 1:e&&(K[F]=Y._TextureParser(A,e,z));break;case 2:K[F]=j.c.Bg(A);break;case 3:K[F]=Y._FresnelParametersParser(A);break;case 4:K[F]=T.h.Bg(A);break;case 5:K[F]=T.k.Bg(A);break;case 6:e&&(K[F]=e.getLastMeshById(A));break;case 7:K[F]=Y._ColorCurvesParser(A);break;case 8:K[F]=j.g.Bg(A);break;case 9:K[F]=Y._ImageProcessingConfigurationParser(A);break;case 10:K[F]=T.d.Bg(A);break;case 11:e&&(K[F]=e.getCameraById(A));break;case 12:K[F]=T.b.Bg(A)}}}}static Parse(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const j=K();return k.d&&k.d.AddTagsTo(j,b.tags),Y.ParseProperties(b,j,e,z),j}static Clone(K,b){return l(K,b,!1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}static Instanciate(K,b){return l(K,b,!0)}}Y.AllowLoadingUniqueId=!1,Y._ImageProcessingConfigurationParser=K=>{throw(0,z.c)("ImageProcessingConfiguration")},Y._FresnelParametersParser=K=>{throw(0,z.c)("FresnelParameters")},Y._ColorCurvesParser=K=>{throw(0,z.c)("ColorCurves")},Y._TextureParser=(K,b,e)=>{throw(0,z.c)("Texture")}},10698:(K,b,e)=>{"use strict";e.d(b,{c:()=>j});var z=e(10696);const k=(K,b,e)=>K?K.getClassName&&"Mesh"===K.getClassName()?null:!K.getClassName||"SubMesh"!==K.getClassName()&&"PhysicsBody"!==K.getClassName()?K.clone?K.clone():Array.isArray(K)?K.slice():e&&"object"===typeof K?{...K}:null:K.clone(b):null;class j{static DeepCopy(K,b,e,j){let T=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const F=function(K){const b=[];do{Object.getOwnPropertyNames(K).forEach((function(K){-1===b.indexOf(K)&&b.push(K)}))}while(K=Object.getPrototypeOf(K));return b}(K);for(const Y of F){if("_"===Y[0]&&(!j||-1===j.indexOf(Y)))continue;if(Y.endsWith("Observable"))continue;if(e&&-1!==e.indexOf(Y))continue;const F=K[Y],A=typeof F;if("function"!==A)try{if("object"===A)if(F instanceof Uint8Array)b[Y]=Uint8Array.from(F);else if(F instanceof Array){if(b[Y]=[],F.length>0)if("object"==typeof F[0])for(let K=0;K<F.length;K++){const e=k(F[K],b,T);-1===b[Y].indexOf(e)&&b[Y].push(e)}else b[Y]=F.slice(0)}else b[Y]=k(F,b,T);else b[Y]=F}catch(l){z.b.Warn(l.message)}}}}},10710:(K,b,e)=>{"use strict";e.d(b,{c:()=>k});const z={};function k(K){if(!(arguments.length>1&&void 0!==arguments[1]&&arguments[1])||!z[K])return z[K]=!0,`${K} needs to be imported before as it contains a side-effect required by your code.`}},10693:(K,b,e)=>{"use strict";function z(){return"undefined"!==typeof window}function k(){return"undefined"!==typeof navigator}function j(){return"undefined"!==typeof document}function T(K){let b="",e=K.firstChild;for(;e;)3===e.nodeType&&(b+=e.textContent),e=e.nextSibling;return b}e.d(b,{c:()=>T,d:()=>j,g:()=>k,k:()=>z})},11966:(K,b,e)=>{"use strict";e.r(b),e.d(b,{Dispose:()=>t,DumpData:()=>X,DumpDataAsync:()=>A,DumpFramebuffer:()=>Y,DumpTools:()=>U});var z=e(11524),k=e(10686),j=e(10984),T=e(10720);let F,l=null;async function Y(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",j=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0;const F=await e.readPixels(0,0,K,b);X(K,b,new Uint8Array(F.buffer),z,k,j,!0,void 0,T)}function A(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7?arguments[7]:void 0;return new Promise((l=>{X(K,b,e,(K=>l(K)),z,k,j,T,F)}))}function X(K,b,Y,A){let X=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",U=arguments.length>5?arguments[5]:void 0,B=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],m=arguments.length>8?arguments[8]:void 0;(async function(){return l||(l=new Promise(((K,b)=>{let k,j=null;const l={Yg:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};Promise.resolve().then(e.bind(e,11415)).then((Y=>{let{ThinEngine:A}=Y;try{k=new OffscreenCanvas(100,100),j=new A(k,!1,l)}catch(U){k=document.createElement("canvas"),j=new A(k,!1,l)}T.b.Instances.pop(),T.b.OnEnginesDisposedObservable.add((K=>{j&&K!==j&&!j.u&&0===T.b.Instances.length&&t()})),j.getCaps().parallelShaderCompile=void 0;const X=new z.c(j);e.e(34).then(e.bind(e,13175)).then((e=>{let{passPixelShader:T}=e;if(!j)return void b("Engine is not defined");const l=new z.g({kd:j,name:T.name,fragmentShader:T.shader,samplerNames:["textureSampler"]});F={canvas:k,kd:j,renderer:X,wrapper:l},K(F)}))})).catch(b)}))),await l})().then((e=>{if(e.kd.setSize(K,b,!0),Y instanceof Float32Array){const K=new Uint8Array(Y.length);let b=Y.length;for(;b--;){const e=Y[b];K[b]=Math.round(255*(0,j.e)(e))}Y=K}const z=e.kd.createRawTexture(Y,K,b,5,!1,!B,1);e.renderer.setViewport(),e.renderer.applyEffectWrapper(e.wrapper),e.wrapper.effect._bindTexture("textureSampler",z),e.renderer.draw(),u?k.f.ToBlob(e.canvas,(K=>{const b=new FileReader;b.onload=K=>{const b=K.target.result;A&&A(b)},b.readAsArrayBuffer(K)}),X,m):k.f.EncodeScreenshotCanvasData(e.canvas,A,X,U,m),z.dispose()}))}function t(){var K;F?(F.wrapper.dispose(),F.renderer.dispose(),F.kd.dispose()):null===(K=l)||void 0===K||K.then((K=>{K.wrapper.dispose(),K.renderer.dispose(),K.kd.dispose()}));l=null,F=null}const U={DumpData:X,DumpDataAsync:A,DumpFramebuffer:Y,Dispose:t};k.f.DumpData=X,k.f.DumpDataAsync=A,k.f.DumpFramebuffer=Y},11959:(K,b,e)=>{"use strict";e.d(b,{c:()=>B,g:()=>D,k:()=>Q,o:()=>G});var z=e(10686),k=e(10967),j=e(10984),T=e(11479),F=e(10780),l=e(11170),Y=(e(10960),e(11518)),A=e(10696);e(11909),e(11922),e(11966);const X="image/png",t=2,U=[134,22,135,150,246,214,150,54];function B(K){const b=new DataView(K.buffer,K.byteOffset,K.byteLength);let e=0;for(let T=0;T<U.length;T++)if(b.getUint8(e++)!==U[T])return A.b.Error("Not a babylon environment map"),null;let z="",k=0;for(;k=b.getUint8(e++);)z+=String.fromCharCode(k);let j=JSON.parse(z);return j=u(j),j.ah&&(j.ah.specularDataPosition=e,j.ah.lodGenerationScale=j.ah.lodGenerationScale||.8),j}function u(K){if(K.version>t)throw new Error(`Unsupported babylon environment map version "${K.version}". Latest supported version is "${t}".`);return 2===K.version?K:K={...K,version:2,imageType:X}}function m(K,b){const e=(b=u(b)).ah;let z=Math.log2(b.width);if(z=Math.round(z)+1,e.mipmaps.length!==6*z)throw new Error(`Unsupported specular mipmaps number "${e.mipmaps.length}"`);const k=new Array(z);for(let j=0;j<z;j++){k[j]=new Array(6);for(let b=0;b<6;b++){const z=e.mipmaps[6*j+b];k[j][b]=new Uint8Array(K.buffer,K.byteOffset+e.specularDataPosition+z.position,z.length)}}return k}function D(K,b,e){const z=(e=u(e)).ah;if(!z)return Promise.resolve();K._lodGenerationScale=z.lodGenerationScale;return x(K,m(b,e),e.imageType)}function I(K,b,e,z,k,j,T,F,l,Y,A){return new Promise(((X,t)=>{if(e){const e=b.createTexture(null,!0,!0,null,1,null,(K=>{t(K)}),K);null===z||void 0===z||z.onEffectCreatedObservable.addOnce((F=>{F.executeWhenCompiled((()=>{z.externalTextureSamplerBinding=!0,z.onApply=z=>{z._bindTexture("textureSampler",e),z.setFloat2("scale",1,b._features.needsInvertingBitmap&&K instanceof ImageBitmap?-1:1)},b.scenes.length&&(b.scenes[0].postProcessManager.directRender([z],Y,!0,j,T),b.restoreDefaultFramebuffer(),e.dispose(),URL.revokeObjectURL(k),X())}))}))}else{if(b._uploadImageToTexture(A,K,j,T),F){const e=l[T];e&&b._uploadImageToTexture(e._texture,K,j,0)}X()}}))}async function x(K,b){let k=arguments.length>2&&void 0!==arguments[2]?arguments[2]:X;if(!z.f.IsExponentOfTwo(K.width))throw new Error("Texture size must be a power of two");const T=(0,j.l)(K.width)+1,A=K.getEngine();let t=!1,U=!1,B=null,u=null,m=null;const D=A.getCaps();K.format=5,K.type=0,K.generateMipMaps=!0,K._cachedAnisotropicFilteringLevel=null,A.updateTextureSamplingMode(3,K),D.textureLOD?A._features.supportRenderAndCopyToLodForFloatTextures?D.textureHalfFloatRender&&D.textureHalfFloatLinearFiltering?(t=!0,K.type=2):D.textureFloatRender&&D.textureFloatLinearFiltering&&(t=!0,K.type=1):t=!1:(t=!1,U=!0,m={});let x=0;if(t)A.isWebGPU?(x=1,await e.e(39).then(e.bind(e,13200))):await e.e(41).then(e.bind(e,13210)),B=new Y.b("rgbdDecode","rgbdDecode",null,null,1,null,3,A,!1,void 0,K.type,void 0,null,!1,void 0,x),K._isRGBD=!1,K.invertY=!1,u=A.createRenderTargetCubeTexture(K.width,{generateDepthBuffer:!1,generateMipMaps:!0,generateStencilBuffer:!1,samplingMode:3,type:K.type,format:5});else if(K._isRGBD=!0,K.invertY=!0,U){const b=3,e=K._lodGenerationScale,z=K._lodGenerationOffset;for(let k=0;k<b;k++){const j=(T-1)*e+z,Y=z+(j-z)*(1-k/(b-1)),X=Math.round(Math.min(Math.max(Y,0),j)),t=new F.e(A,2);t.isCube=!0,t.invertY=!0,t.generateMipMaps=!1,A.updateTextureSamplingMode(2,t);const U=new l.d(null);switch(U._isCube=!0,U._texture=t,m[X]=U,k){case 0:K._lodTextureLow=U;break;case 1:K._lodTextureMid=U;break;case 2:K._lodTextureHigh=U}}}const Q=[];for(let e=0;e<b.length;e++)for(let z=0;z<6;z++){const j=b[e][z],T=new Blob([j],{type:k}),F=URL.createObjectURL(T);let l;if(A._features.forceBitmapOverHTMLImageElement)l=A.createImageBitmap(T,{premultiplyAlpha:"none"}).then((b=>I(b,A,t,B,F,z,e,U,m,u,K)));else{const b=new Image;b.src=F,l=new Promise(((k,j)=>{b.onload=()=>{I(b,A,t,B,F,z,e,U,m,u,K).then((()=>k())).catch((K=>{j(K)}))},b.onerror=K=>{j(K)}}))}Q.push(l)}if(b.length<T){let e;const z=Math.pow(2,T-1-b.length),k=z*z*4;switch(K.type){case 0:e=new Uint8Array(k);break;case 2:e=new Uint16Array(k);break;case 1:e=new Float32Array(k)}for(let j=b.length;j<T;j++)for(let b=0;b<6;b++)A._uploadArrayBufferViewToTexture(K,e,b,j)}return Promise.all(Q).then((()=>{u&&(A._releaseTexture(K),u._swapAndDie(K)),B&&B.dispose(),U&&(K._lodTextureHigh&&K._lodTextureHigh._texture&&(K._lodTextureHigh._texture.isReady=!0),K._lodTextureMid&&K._lodTextureMid._texture&&(K._lodTextureMid._texture.isReady=!0),K._lodTextureLow&&K._lodTextureLow._texture&&(K._lodTextureLow._texture.isReady=!0))}))}function Q(K,b){const e=(b=u(b)).irradiance;if(!e)return;const z=new T.c;k.k.FromArrayToRef(e.x,0,z.x),k.k.FromArrayToRef(e.y,0,z.y),k.k.FromArrayToRef(e.z,0,z.z),k.k.FromArrayToRef(e.xx,0,z.xx),k.k.FromArrayToRef(e.yy,0,z.yy),k.k.FromArrayToRef(e.zz,0,z.zz),k.k.FromArrayToRef(e.yz,0,z.yz),k.k.FromArrayToRef(e.zx,0,z.zx),k.k.FromArrayToRef(e.xy,0,z.xy),K._sphericalPolynomial=z}function G(K,b,e,z,k){const j=x(K.getEngine().createRawCubeTexture(null,K.width,K.format,K.type,K.generateMipMaps,K.invertY,K.samplingMode,K._compression),b).then((()=>K));return K.onRebuildCallback=K=>({proxy:j,isReady:!0,isAsync:!0}),K._source=13,K._bufferViewArrayArray=b,K._lodGenerationScale=z,K._lodGenerationOffset=k,K._sphericalPolynomial=e,x(K,b).then((()=>(K.isReady=!0,K)))}},10728:(K,b,e)=>{"use strict";e.d(b,{b:()=>z,d:()=>k,h:()=>j});class z extends Error{}z._setPrototypeOf=Object.setPrototypeOf||((K,b)=>(K.__proto__=b,K));const k={MeshInvalidPositionsError:0,UnsupportedTextureError:1e3,GLTFLoaderUnexpectedMagicError:2e3,SceneLoaderError:3e3,LoadFileError:4e3,RequestFileError:4001,ReadFileError:4002};class j extends z{constructor(K,b,e){super(K),this.errorCode=b,this.innerError=e,this.name="RuntimeError",z._setPrototypeOf(this,j.prototype)}}},10723:(K,b,e)=>{"use strict";e.d(b,{e:()=>w,i:()=>x,k:()=>c,r:()=>M,o:()=>m,s:()=>i,v:()=>S,z:()=>r,D:()=>Q});var z=e(10718),k=e(10693),j=e(10690);class T{}T.FilesToLoad={};var F=e(10728),l=e(10733),Y=e(10736),A=e(10720),X=e(10696),t=e(10745),U=e(10739),B=e(10750);const u=new RegExp(/^data:([^,]+\/[^,]+)?;base64,/i);class m extends F.h{constructor(K,b){super(K,F.d.LoadFileError),this.name="LoadFileError",F.b._setPrototypeOf(this,m.prototype),b instanceof z.e?this.request=b:this.file=b}}class D extends F.h{constructor(K,b){super(K,F.d.RequestFileError),this.request=b,this.name="RequestFileError",F.b._setPrototypeOf(this,D.prototype)}}class I extends F.h{constructor(K,b){super(K,F.d.ReadFileError),this.file=b,this.name="ReadFileError",F.b._setPrototypeOf(this,I.prototype)}}const x={DefaultRetryStrategy:class{static ExponentialBackoff(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return(e,z,k)=>0!==z.status||k>=K||-1!==e.indexOf("file:")?-1:Math.pow(2,k)*b}}.ExponentialBackoff(),BaseUrl:"",CorsBehavior:"anonymous",PreprocessUrl:K=>K,ScriptBaseUrl:"",ScriptPreprocessUrl:K=>K,CleanUrl:K=>K=K.replace(/#/gm,"%23")},Q=(K,b)=>{if((!K||0!==K.indexOf("data:"))&&x.CorsBehavior)if("string"===typeof x.CorsBehavior||x.CorsBehavior instanceof String)b.crossOrigin=x.CorsBehavior;else{const e=x.CorsBehavior(K);e&&(b.crossOrigin=e)}},G={getRequiredSize:null},i=function(K,b,e,k){let j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",F=arguments.length>5?arguments[5]:void 0;const Y=A.b.LastCreatedEngine;if("undefined"===typeof HTMLImageElement&&(null===Y||void 0===Y||!Y._features.forceBitmapOverHTMLImageElement))return e("LoadImage is only supported in web or BabylonNative environments."),null;let X,t=!1;K instanceof ArrayBuffer||ArrayBuffer.isView(K)?"undefined"!==typeof Blob&&"undefined"!==typeof URL?(X=URL.createObjectURL(new Blob([K],{type:j})),t=!0):X=`data:${j};base64,`+(0,l.i)(K):K instanceof Blob?(X=URL.createObjectURL(K),t=!0):(X=x.CleanUrl(K),X=x.PreprocessUrl(X));const U=b=>{if(e){const z=X||K.toString();e(`Error while trying to load image: ${0===z.indexOf("http")||z.length<=128?z:z.slice(0,128)+"..."}`,b)}};if(null!==Y&&void 0!==Y&&Y._features.forceBitmapOverHTMLImageElement)return M(X,(z=>{Y.createImageBitmap(new Blob([z],{type:j}),{premultiplyAlpha:"none",...F}).then((K=>{b(K),t&&URL.revokeObjectURL(X)})).catch((b=>{e&&e("Error while trying to load image: "+K,b)}))}),void 0,k||void 0,!0,((K,b)=>{U(b)})),null;const B=new Image;if(G.getRequiredSize){const b=G.getRequiredSize(K);b.width&&(B.width=b.width),b.height&&(B.height=b.height)}Q(X,B);const u=[],m=()=>{u.forEach((K=>{K.target.removeEventListener(K.name,K.handler)})),u.length=0};u.push({target:B,name:"load",handler:()=>{m(),b(B),t&&B.src&&URL.revokeObjectURL(B.src)}}),u.push({target:B,name:"error",handler:K=>{m(),U(K),t&&B.src&&URL.revokeObjectURL(B.src)}}),u.push({target:document,name:"securitypolicyviolation",handler:K=>{if(K.blockedURI!==B.src||"Tl"===K.disposition)return;m();const b=new Error(`CSP violation of policy ${K.effectiveDirective} ${K.blockedURI}. Current policy is ${K.originalPolicy}`);A.b.UseFallbackTexture=!1,U(b),t&&B.src&&URL.revokeObjectURL(B.src),B.src=""}}),u.forEach((K=>{K.target.addEventListener(K.name,K.handler)}));const D="blob:"===X.substring(0,5),I="data:"===X.substring(0,5),i=()=>{D||I||!z.e.IsCustomRequestAvailable?B.src=X:M(X,((K,b,e)=>{const z=new Blob([K],{type:!j&&e?e:j}),k=URL.createObjectURL(z);t=!0,B.src=k}),void 0,k||void 0,!0,((K,b)=>{U(b)}))},S=()=>{k&&k.loadImage(X,B)};if(!D&&!I&&k&&k.enableTexturesOffline)k.open(S,i);else{if(-1!==X.indexOf("file:")){const K=decodeURIComponent(X.substring(5).toLowerCase());if(T.FilesToLoad[K]&&"undefined"!==typeof URL){try{let b;try{b=URL.createObjectURL(T.FilesToLoad[K])}catch(r){b=URL.createObjectURL(T.FilesToLoad[K])}B.src=b,t=!0}catch(L){B.src=""}return B}}i()}return B},S=(K,b,e,z,k)=>{const T=new FileReader,F={onCompleteObservable:new j.d,abort:()=>T.abort()};return T.onloadend=()=>F.onCompleteObservable.notifyObservers(F),k&&(T.onerror=()=>{k(new I(`Unable to read ${K.name}`,K))}),T.onload=K=>{b(K.target.result)},e&&(T.onprogress=e),z?T.readAsArrayBuffer(K):T.readAsText(K),F},M=(K,b,e,z,k,l,Y)=>{if(K.name)return S(K,b,e,k,l?K=>{l(void 0,K)}:void 0);const A=K;if(-1!==A.indexOf("file:")){let K=decodeURIComponent(A.substring(5).toLowerCase());0===K.indexOf("./")&&(K=K.substring(2));const z=T.FilesToLoad[K];if(z)return S(z,b,e,k,l?K=>l(void 0,new m(K.message,K.file)):void 0)}const{match:U,type:B}=v(A);if(U){const K={onCompleteObservable:new j.d,abort:()=>()=>{}};try{const K=k?w(A):h(A);b(K,void 0,B)}catch(F){l?l(void 0,F):X.b.Error(F.message||"Failed to parse the Data URL")}return t.e.SetImmediate((()=>{K.onCompleteObservable.notifyObservers(K)})),K}return r(A,((K,e)=>{b(K,null===e||void 0===e?void 0:e.responseURL,null===e||void 0===e?void 0:e.getResponseHeader("content-type"))}),e,z,k,l?K=>{l(K.request,new m(K.message,K.request))}:void 0,Y)},r=(K,b,e,T,F,l,Y)=>{K=x.CleanUrl(K),K=x.PreprocessUrl(K);const A=x.BaseUrl+K;let t=!1;const U={onCompleteObservable:new j.d,abort:()=>t=!0},B=()=>{let K,j=new z.e,T=null;const B=()=>{j&&(e&&j.removeEventListener("progress",e),K&&j.removeEventListener("readystatechange",K),j.removeEventListener("loadend",u))};let u=()=>{B(),U.onCompleteObservable.notifyObservers(U),U.onCompleteObservable.clear(),e=void 0,K=null,u=null,l=void 0,Y=void 0,b=void 0};U.abort=()=>{t=!0,u&&u(),j&&j.readyState!==(XMLHttpRequest.DONE||4)&&j.abort(),null!==T&&(clearTimeout(T),T=null),j=null};const m=K=>{const b=K.message||"Unknown error";l&&j?l(new D(b,j)):X.b.Error(b)},I=X=>{if(j){if(j.open("GET",A),Y)try{Y(j)}catch(U){return void m(U)}F&&(j.responseType="arraybuffer"),e&&j.addEventListener("progress",e),u&&j.addEventListener("loadend",u),K=()=>{if(!t&&j&&j.readyState===(XMLHttpRequest.DONE||4)){if(K&&j.removeEventListener("readystatechange",K),j.status>=200&&j.status<300||0===j.status&&(!(0,k.k)()||L())){try{b&&b(F?j.response:j.responseText,j)}catch(U){m(U)}return}const e=x.DefaultRetryStrategy;if(e){const K=e(A,j,X);if(-1!==K)return B(),j=new z.e,void(T=setTimeout((()=>I(X+1)),K))}const Y=new D("Error status: "+j.status+" "+j.statusText+" - Unable to load "+A,j);l&&l(Y)}},j.addEventListener("readystatechange",K),j.send()}};I(0)};if(T&&T.enableSceneOffline){const z=K=>{K&&K.status>400?l&&l(K):B()},k=()=>{T&&T.loadFile(x.BaseUrl+K,(K=>{!t&&b&&b(K),U.onCompleteObservable.notifyObservers(U)}),e?K=>{!t&&e&&e(K)}:void 0,z,F)};T.open(k,z)}else B();return U},L=()=>"undefined"!==typeof location&&"file:"===location.protocol,c=K=>u.test(K),v=K=>{const b=u.exec(K);if(null===b||0===b.length)return{match:!1,type:""};return{match:!0,type:b[0].replace("data:","").replace("base64,","")}};function w(K){return(0,l.b)(K.split(",")[1])}const h=K=>(0,l.c)(K.split(",")[1]);let R;B.e._FileToolsLoadImage=i,U.d.loadFile=M,Y.p.loadFile=M;((K,b,e,z,k,j,T,F,l,Y)=>{R={DecodeBase64UrlToBinary:K,DecodeBase64UrlToString:b,DefaultRetryStrategy:e.DefaultRetryStrategy,BaseUrl:e.BaseUrl,CorsBehavior:e.CorsBehavior,PreprocessUrl:e.PreprocessUrl,IsBase64DataUrl:z,IsFileURL:k,LoadFile:j,LoadImage:T,ReadFile:F,RequestFile:l,SetCorsBehavior:Y},Object.defineProperty(R,"DefaultRetryStrategy",{get:function(){return e.DefaultRetryStrategy},set:function(K){e.DefaultRetryStrategy=K}}),Object.defineProperty(R,"BaseUrl",{get:function(){return e.BaseUrl},set:function(K){e.BaseUrl=K}}),Object.defineProperty(R,"PreprocessUrl",{get:function(){return e.PreprocessUrl},set:function(K){e.PreprocessUrl=K}}),Object.defineProperty(R,"CorsBehavior",{get:function(){return e.CorsBehavior},set:function(K){e.CorsBehavior=K}})})(w,h,x,c,L,M,i,S,r,Q)},10801:(K,b,e)=>{"use strict";function z(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(K=>{const b=16*Math.random()|0;return("x"===K?b:3&b|8).toString(16)}))}e.d(b,{b:()=>z})},10792:(K,b,e)=>{"use strict";e.d(b,{b:()=>j});var z=e(10696),k=e(10799);class j{static Instantiate(K){if(this.RegisteredExternalClasses&&this.RegisteredExternalClasses[K])return this.RegisteredExternalClasses[K];const b=(0,k.d)(K);if(b)return b;z.b.Warn(K+" not found, you may have missed an import.");const e=K.split(".");let j=window||this;for(let z=0,k=e.length;z<k;z++)j=j[e[z]];return"function"!==typeof j?null:j}}j.RegisteredExternalClasses={}},10696:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});class z{static _CheckLimit(K,b){let e=z._LogLimitOutputs[K];return e?e.current++:(e={limit:b,current:1},z._LogLimitOutputs[K]=e),e.current<=e.limit}static _GenerateLimitMessage(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const e=z._LogLimitOutputs[K];if(!e||!z.MessageLimitReached)return;const k=this._Levels[b];e.current===e.limit&&z[k.name](z.MessageLimitReached.replace(/%LIMIT%/g,""+e.limit).replace(/%TYPE%/g,k.name??""))}static _AddLogEntry(K){z._LogCache=K+z._LogCache,z.OnNewCacheEntry&&z.OnNewCacheEntry(K)}static _FormatMessage(K){const b=K=>K<10?"0"+K:""+K,e=new Date;return"["+b(e.getHours())+":"+b(e.getMinutes())+":"+b(e.getSeconds())+"]: "+K}static _LogDisabled(K,b){}static _LogEnabled(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0;const k=Array.isArray(b)?b[0]:b;if(void 0!==e&&!z._CheckLimit(k,e))return;const j=z._FormatMessage(k),T=this._Levels[K],F=Array.isArray(b)?b.slice(1):[];T.logFunc&&T.logFunc("BJS - "+j,...F);const l=`<div style='color:${T.color}'>${j}</div><br>`;z._AddLogEntry(l),z._GenerateLimitMessage(k,K)}static get LogCache(){return z._LogCache}static ClearLogCache(){z._LogCache="",z._LogLimitOutputs={},z.errorsCount=0}static set LogLevels(K){z.Log=z._LogDisabled,z.Warn=z._LogDisabled,z.Error=z._LogDisabled,[z.MessageLogLevel,z.WarningLogLevel,z.ErrorLogLevel].forEach((b=>{if((K&b)===b){const K=this._Levels[b];z[K.name]=z._LogEnabled.bind(z,b)}}))}}z.NoneLogLevel=0,z.MessageLogLevel=1,z.WarningLogLevel=2,z.ErrorLogLevel=4,z.AllLogLevel=7,z.MessageLimitReached="Too many %TYPE%s (%LIMIT%), no more %TYPE%s will be reported for this message.",z._LogCache="",z._LogLimitOutputs={},z._Levels=[{},{color:"white",logFunc:console.log,name:"Log"},{color:"orange",logFunc:console.warn,name:"Warn"},{},{color:"red",logFunc:console.error,name:"Error"}],z.errorsCount=0,z.Log=z._LogEnabled.bind(z,z.MessageLogLevel),z.Warn=z._LogEnabled.bind(z,z.WarningLogLevel),z.Error=z._LogEnabled.bind(z,z.ErrorLogLevel)},10690:(K,b,e)=>{"use strict";e.d(b,{d:()=>j});class z{constructor(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;this.initialize(K,b,e,z)}initialize(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;return this.mask=K,this.skipNextObservers=b,this.target=e,this.currentTarget=z,this}}class k{constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.callback=K,this.mask=b,this.scope=e,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1,this._remove=null}remove(){this._remove&&this._remove()}}class j{static FromPromise(K,b){const e=new j;return K.then((K=>{e.notifyObservers(K)})).catch((K=>{if(!b)throw K;b.notifyObservers(K)})),e}get observers(){return this._observers}constructor(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyIfTriggered=b,this._observers=new Array,this._numObserversMarkedAsDeleted=0,this._hasNotified=!1,this._eventState=new z(0),K&&(this._onObserverAdded=K)}add(K){let b=arguments.length>2&&void 0!==arguments[2]&&arguments[2],e=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!K)return null;const z=new k(K,arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:null);return z.unregisterOnNextCall=e,b?this._observers.unshift(z):this._observers.push(z),this._onObserverAdded&&this._onObserverAdded(z),this._hasNotified&&this.notifyIfTriggered&&void 0!==this._lastNotifiedValue&&this.notifyObserver(z,this._lastNotifiedValue),z._remove=()=>{this.remove(z)},z}addOnce(K){return this.add(K,void 0,void 0,void 0,!0)}remove(K){if(!K)return!1;K._remove=null;return-1!==this._observers.indexOf(K)&&(this._deferUnregister(K),!0)}removeCallback(K,b){for(let e=0;e<this._observers.length;e++){const z=this._observers[e];if(!z._willBeUnregistered&&(z.callback===K&&(!b||b===z.scope)))return this._deferUnregister(z),!0}return!1}_deferUnregister(K){K._willBeUnregistered||(this._numObserversMarkedAsDeleted++,K.unregisterOnNextCall=!1,K._willBeUnregistered=!0,setTimeout((()=>{this._remove(K)}),0))}_remove(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!K)return!1;const e=this._observers.indexOf(K);return-1!==e&&(b&&this._numObserversMarkedAsDeleted--,this._observers.splice(e,1),!0)}makeObserverTopPriority(K){this._remove(K,!1),this._observers.unshift(K)}makeObserverBottomPriority(K){this._remove(K,!1),this._observers.push(K)}notifyObservers(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=K),!this._observers.length)return!0;const j=this._eventState;j.mask=b,j.target=e,j.currentTarget=z,j.skipNextObservers=!1,j.lastReturnValue=K,j.userInfo=k;for(const T of this._observers)if(!T._willBeUnregistered&&(T.mask&b&&(T.unregisterOnNextCall&&this._deferUnregister(T),T.scope?j.lastReturnValue=T.callback.apply(T.scope,[K,j]):j.lastReturnValue=T.callback(K,j)),j.skipNextObservers))return!1;return!0}notifyObserver(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(this.notifyIfTriggered&&(this._hasNotified=!0,this._lastNotifiedValue=b),K._willBeUnregistered)return;const z=this._eventState;z.mask=e,z.skipNextObservers=!1,K.unregisterOnNextCall&&this._deferUnregister(K),K.callback(b,z)}hasObservers(){return this._observers.length-this._numObserversMarkedAsDeleted>0}clear(){for(;this._observers.length;){const K=this._observers.pop();K&&(K._remove=null)}this._onObserverAdded=null,this._numObserversMarkedAsDeleted=0,this.cleanLastNotifiedState()}cleanLastNotifiedState(){this._hasNotified=!1,this._lastNotifiedValue=void 0}clone(){const K=new j;return K._observers=this._observers.slice(0),K}hasSpecificMask(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;for(const b of this._observers)if(b.mask&K||b.mask===K)return!0;return!1}}},10810:(K,b,e)=>{"use strict";e.d(b,{e:()=>k});var z=e(10707);class k{get min(){return this._min}get max(){return this._max}get average(){return this._average}get lastSecAverage(){return this._lastSecAverage}get current(){return this._current}get total(){return this._totalAccumulated}get count(){return this._totalValueCount}constructor(){this._startMonitoringTime=0,this._min=0,this._max=0,this._average=0,this._lastSecAverage=0,this._current=0,this._totalValueCount=0,this._totalAccumulated=0,this._lastSecAccumulated=0,this._lastSecTime=0,this._lastSecValueCount=0}fetchNewFrame(){this._totalValueCount++,this._current=0,this._lastSecValueCount++}addCount(K,b){k.Enabled&&(this._current+=K,b&&this._fetchResult())}beginMonitoring(){k.Enabled&&(this._startMonitoringTime=z.e.Now)}endMonitoring(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!k.Enabled)return;K&&this.fetchNewFrame();const b=z.e.Now;this._current=b-this._startMonitoringTime,K&&this._fetchResult()}Qi(){this._fetchResult()}_fetchResult(){this._totalAccumulated+=this._current,this._lastSecAccumulated+=this._current,this._min=Math.min(this._min,this._current),this._max=Math.max(this._max,this._current),this._average=this._totalAccumulated/this._totalValueCount;const K=z.e.Now;K-this._lastSecTime>1e3&&(this._lastSecAverage=this._lastSecAccumulated/this._lastSecValueCount,this._lastSecTime=K,this._lastSecAccumulated=0,this._lastSecValueCount=0)}}k.Enabled=!0},10707:(K,b,e)=>{"use strict";e.d(b,{e:()=>k});var z=e(10693);class k{static get Now(){return(0,z.k)()&&window.performance&&window.performance.now?window.performance.now():Date.now()}}},11909:(K,b,e)=>{"use strict";e.d(b,{c:()=>j});var z=e(11518),k=e(11507);class j{static ExpandRGBDTexture(K){const b=K._texture;if(!b||!K.isRGBD)return;const k=b.getEngine(),j=k.getCaps(),T=b.isReady;let F=!1;j.textureHalfFloatRender&&j.textureHalfFloatLinearFiltering?(F=!0,b.type=2):j.textureFloatRender&&j.textureFloatLinearFiltering&&(F=!0,b.type=1),F&&(b.isReady=!1,b._isRGBD=!1,b.invertY=!1);const l=async()=>{const j=k.isWebGPU,T=j?1:0;b.isReady=!1,j?await Promise.all([e.e(39).then(e.bind(e,13200)),e.e(40).then(e.bind(e,13205))]):await Promise.all([e.e(41).then(e.bind(e,13210)),e.e(42).then(e.bind(e,13215))]);const F=new z.b("rgbdDecode","rgbdDecode",null,null,1,null,3,k,!1,void 0,b.type,void 0,null,!1,void 0,T);F.externalTextureSamplerBinding=!0;const l=k.createRenderTargetTexture(b.width,{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:b.samplingMode,type:b.type,format:5});F.onEffectCreatedObservable.addOnce((e=>{e.executeWhenCompiled((()=>{F.onApply=K=>{K._bindTexture("textureSampler",b),K.setFloat2("scale",1,1)},K.va().postProcessManager.directRender([F],l,!0),k.restoreDefaultFramebuffer(),k._releaseTexture(b),F&&F.dispose(),l._swapAndDie(b),b.isReady=!0}))}))};F&&(T?l():K.onLoadObservable.addOnce(l))}static EncodeTextureToRGBD(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,k.b)("rgbdEncode",K,b,e,1,5)}}},10951:(K,b,e)=>{"use strict";e.d(b,{e:()=>k,h:()=>z});class z{constructor(K){this.length=0,this.data=new Array(K),this._id=z._GlobalId++}push(K){this.data[this.length++]=K,this.length>this.data.length&&(this.data.length*=2)}forEach(K){for(let b=0;b<this.length;b++)K(this.data[b])}sort(K){this.data.sort(K)}reset(){this.length=0}dispose(){this.reset(),this.data&&(this.data.length=0)}concat(K){if(0!==K.length){this.length+K.length>this.data.length&&(this.data.length=2*(this.length+K.length));for(let b=0;b<K.length;b++)this.data[this.length++]=(K.data||K)[b]}}indexOf(K){const b=this.data.indexOf(K);return b>=this.length?-1:b}contains(K){return-1!==this.indexOf(K)}}z._GlobalId=0;class k extends z{constructor(){super(...arguments),this._duplicateId=0}push(K){super.push(K),K.__smartArrayFlags||(K.__smartArrayFlags={}),K.__smartArrayFlags[this._id]=this._duplicateId}pushNoDuplicate(K){return(!K.__smartArrayFlags||K.__smartArrayFlags[this._id]!==this._duplicateId)&&(this.push(K),!0)}reset(){super.reset(),this._duplicateId++}concatWithNoDuplicate(K){if(0!==K.length){this.length+K.length>this.data.length&&(this.data.length=2*(this.length+K.length));for(let b=0;b<K.length;b++){const e=(K.data||K)[b];this.pushNoDuplicate(e)}}}}},10733:(K,b,e)=>{"use strict";e.d(b,{b:()=>T,c:()=>j,f:()=>z,i:()=>k});const z=K=>{if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(K);let b="";for(let e=0;e<K.byteLength;e++)b+=String.fromCharCode(K[e]);return b},k=K=>{const b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let e,z,k,j,T,F,l,Y="",A=0;const X=ArrayBuffer.isView(K)?new Uint8Array(K.buffer,K.byteOffset,K.byteLength):new Uint8Array(K);for(;A<X.length;)e=X[A++],z=A<X.length?X[A++]:Number.NaN,k=A<X.length?X[A++]:Number.NaN,j=e>>2,T=(3&e)<<4|z>>4,F=(15&z)<<2|k>>6,l=63&k,isNaN(z)?F=l=64:isNaN(k)&&(l=64),Y+=b.charAt(j)+b.charAt(T)+b.charAt(F)+b.charAt(l);return Y},j=K=>atob(K),T=K=>{const b=j(K),e=b.length,z=new Uint8Array(new ArrayBuffer(e));for(let k=0;k<e;k++)z[k]=b.charCodeAt(k);return z.buffer}},10963:(K,b,e)=>{"use strict";e.d(b,{d:()=>k});class z{static Eval(K,b){return"true"===(K=K.match(/\([^()]*\)/g)?K.replace(/\([^()]*\)/g,(K=>(K=K.slice(1,K.length-1),z._HandleParenthesisContent(K,b)))):z._HandleParenthesisContent(K,b))||"false"!==K&&z.Eval(K,b)}static _HandleParenthesisContent(K,b){let e;b=b||(K=>"true"===K);const k=K.split("||");for(const j in k)if(Object.prototype.hasOwnProperty.call(k,j)){let K=z._SimplifyNegation(k[j].trim());const T=K.split("&&");if(T.length>1)for(let k=0;k<T.length;++k){const j=z._SimplifyNegation(T[k].trim());if(e="true"!==j&&"false"!==j?"!"===j[0]?!b(j.substring(1)):b(j):"true"===j,!e){K="false";break}}if(e||"true"===K){e=!0;break}e="true"!==K&&"false"!==K?"!"===K[0]?!b(K.substring(1)):b(K):"true"===K}return e?"true":"false"}static _SimplifyNegation(K){return"!true"===(K=(K=K.replace(/^[\s!]+/,(K=>(K=K.replace(/[\s]/g,(()=>""))).length%2?"!":""))).trim())?K="false":"!false"===K&&(K="true"),K}}class k{static EnableFor(K){K._tags=K._tags||{},K.hasTags=()=>k.HasTags(K),K.addTags=b=>k.AddTagsTo(K,b),K.removeTags=b=>k.RemoveTagsFrom(K,b),K.matchesTagsQuery=b=>k.MatchesQuery(K,b)}static DisableFor(K){delete K._tags,delete K.hasTags,delete K.addTags,delete K.removeTags,delete K.matchesTagsQuery}static HasTags(K){if(!K._tags)return!1;const b=K._tags;for(const e in b)if(Object.prototype.hasOwnProperty.call(b,e))return!0;return!1}static GetTags(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!K._tags)return null;if(b){const b=[];for(const e in K._tags)Object.prototype.hasOwnProperty.call(K._tags,e)&&!0===K._tags[e]&&b.push(e);return b.join(" ")}return K._tags}static AddTagsTo(K,b){if(!b)return;if("string"!==typeof b)return;b.split(" ").forEach((function(b){k._AddTagTo(K,b)}))}static _AddTagTo(K,b){""!==(b=b.trim())&&"true"!==b&&"false"!==b&&(b.match(/[\s]/)||b.match(/^([!]|([|]|[&]){2})/)||(k.EnableFor(K),K._tags[b]=!0))}static RemoveTagsFrom(K,b){if(!k.HasTags(K))return;const e=b.split(" ");for(const z in e)k._RemoveTagFrom(K,e[z])}static _RemoveTagFrom(K,b){delete K._tags[b]}static MatchesQuery(K,b){return void 0===b||(""===b?k.HasTags(K):z.Eval(b,(b=>k.HasTags(K)&&K._tags[b])))}}},11507:(K,b,e)=>{"use strict";e.d(b,{b:()=>l,d:()=>t,g:()=>X});e(11161),e(11514);var z=e(11518),k=e(10750),j=e(10799),T=e(11001);class F extends z.b{getClassName(){return"PassPostProcess"}constructor(K,b){super(K,"pass",null,null,b,arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,arguments.length>3?arguments[3]:void 0,arguments.length>4?arguments[4]:void 0,arguments.length>5?arguments[5]:void 0,void 0,arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,void 0,null,arguments.length>7&&void 0!==arguments[7]&&arguments[7])}_gatherImports(K,b){K?(this._webGPUReady=!0,b.push(Promise.all([e.e(33).then(e.bind(e,13173))]))):b.push(Promise.all([e.e(34).then(e.bind(e,13175))])),super._gatherImports(K,b)}static _Parse(K,b,e,z){return T.e.Parse((()=>new F(K.name,K.options,b,K.renderTargetSamplingMode,K._engine,K.reusable)),K,e,z)}}(0,j.e)("BABYLON.PassPostProcess",F);z.b;function l(K,b,e,k,j,T,F,l){const Y=b.getEngine();return b.isReady=!1,j=j??b.samplingMode,k=k??b.type,T=T??b.format,F=F??b.width,l=l??b.height,-1===k&&(k=0),new Promise((A=>{const X=new z.b("postprocess",K,null,null,1,null,j,Y,!1,void 0,k,void 0,null,!1,T);X.externalTextureSamplerBinding=!0;const t=Y.createRenderTargetTexture({width:F,height:l},{generateDepthBuffer:!1,generateMipMaps:!1,generateStencilBuffer:!1,samplingMode:j,type:k,format:T});X.onEffectCreatedObservable.addOnce((K=>{K.executeWhenCompiled((()=>{X.onApply=K=>{K._bindTexture("textureSampler",b),K.setFloat2("scale",1,1)},e.postProcessManager.directRender([X],t,!0),Y.restoreDefaultFramebuffer(),Y._releaseTexture(b),X&&X.dispose(),t._swapAndDie(b),b.type=k,b.format=5,b.isReady=!0,A(b)}))}))}))}let Y,A;function X(K){Y||(Y=new Float32Array(1),A=new Int32Array(Y.buffer)),Y[0]=K;const b=A[0];let e=b>>16&32768,z=b>>12&2047;const k=b>>23&255;return k<103?e:k>142?(e|=31744,e|=(255==k?0:1)&&8388607&b,e):k<113?(z|=2048,e|=(z>>114-k)+(z>>113-k&1),e):(e|=k-112<<10|z>>1,e+=1&z,e)}function t(K){const b=(32768&K)>>15,e=(31744&K)>>10,z=1023&K;return 0===e?(b?-1:1)*Math.pow(2,-14)*(z/Math.pow(2,10)):31==e?z?NaN:1/0*(b?-1:1):(b?-1:1)*Math.pow(2,e-15)*(1+z/Math.pow(2,10))}k.e._RescalePostProcessFactory=K=>new F("rescale",1,null,2,K,!1,0)},10745:(K,b,e)=>{"use strict";e.d(b,{e:()=>k});var z=e(10693);class k{static SetImmediate(K){(0,z.k)()&&window.setImmediate?window.setImmediate(K):setTimeout(K,1)}}},10803:(K,b,e)=>{"use strict";function z(K){let b=1;do{b*=2}while(b<K);return b===K}function k(K,b,e){return K*(1-e)+b*e}function j(K){const b=T(K),e=F(K);return b-K>K-e?e:b}function T(K){return K--,K|=K>>1,K|=K>>2,K|=K>>4,K|=K>>8,K|=K>>16,++K}function F(K){return K|=K>>1,K|=K>>2,K|=K>>4,K|=K>>8,(K|=K>>16)-(K>>1)}function l(K,b){let e;switch(arguments.length>2&&void 0!==arguments[2]?arguments[2]:2){case 1:e=F(K);break;case 2:e=j(K);break;default:e=T(K)}return Math.min(e,b)}e.d(b,{c:()=>F,g:()=>l,k:()=>z,l:()=>k,m:()=>j})},10686:(K,b,e)=>{"use strict";e.d(b,{d:()=>D,f:()=>m});var z=e(10690),k=e(10693),j=e(10696),T=e(10698),F=e(10707),l=e(10710),Y=e(10718),A=e(10720),X=e(10723),t=e(10745),U=e(10792),B=e(10801),u=e(10803);class m{static get BaseUrl(){return X.i.BaseUrl}static set BaseUrl(K){X.i.BaseUrl=K}static get CleanUrl(){return X.i.CleanUrl}static set CleanUrl(K){X.i.CleanUrl=K}static IsAbsoluteUrl(K){return 0===K.indexOf("//")||-1!==K.indexOf("://")&&(-1!==K.indexOf(".")&&(-1!==K.indexOf("/")&&(!(K.indexOf(":")>K.indexOf("/"))&&(K.indexOf("://")<K.indexOf(".")||(0===K.indexOf("data:")||0===K.indexOf("blob:"))))))}static set ScriptBaseUrl(K){X.i.ScriptBaseUrl=K}static get ScriptBaseUrl(){return X.i.ScriptBaseUrl}static set ScriptPreprocessUrl(K){X.i.ScriptPreprocessUrl=K}static get ScriptPreprocessUrl(){return X.i.ScriptPreprocessUrl}static get DefaultRetryStrategy(){return X.i.DefaultRetryStrategy}static set DefaultRetryStrategy(K){X.i.DefaultRetryStrategy=K}static get CorsBehavior(){return X.i.CorsBehavior}static set CorsBehavior(K){X.i.CorsBehavior=K}static get UseFallbackTexture(){return A.b.UseFallbackTexture}static set UseFallbackTexture(K){A.b.UseFallbackTexture=K}static get RegisteredExternalClasses(){return U.b.RegisteredExternalClasses}static set RegisteredExternalClasses(K){U.b.RegisteredExternalClasses=K}static get fallbackTexture(){return A.b.FallbackTexture}static set fallbackTexture(K){A.b.FallbackTexture=K}static FetchToRef(K,b,e,z,k,j){const T=4*((Math.abs(K)*e%e|0)+(Math.abs(b)*z%z|0)*e);j.r=k[T]/255,j.g=k[T+1]/255,j.b=k[T+2]/255,j.a=k[T+3]/255}static Mix(K,b,e){return 0}static Instantiate(K){return U.b.Instantiate(K)}static SetImmediate(K){t.e.SetImmediate(K)}static IsExponentOfTwo(K){return!0}static FloatRound(K){return Math.fround(K)}static GetFilename(K){const b=K.lastIndexOf("/");return b<0?K:K.substring(b+1)}static GetFolderPath(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=K.lastIndexOf("/");return e<0?b?K:"":K.substring(0,e+1)}static ToDegrees(K){return 180*K/Math.PI}static ToRadians(K){return K*Math.PI/180}static SmoothAngleChange(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.9;const z=this.ToRadians(K),k=this.ToRadians(b);return this.ToDegrees(Math.atan2((1-e)*Math.sin(k)+e*Math.sin(z),(1-e)*Math.cos(k)+e*Math.cos(z)))}static MakeArray(K,b){return!0===b||void 0!==K&&null!=K?Array.isArray(K)?K:[K]:null}static GetPointerPrefix(K){return(0,k.k)()&&!window.PointerEvent?"mouse":"pointer"}static SetCorsBehavior(K,b){(0,X.D)(K,b)}static SetReferrerPolicyBehavior(K,b){b.referrerPolicy=K}static get PreprocessUrl(){return X.i.PreprocessUrl}static set PreprocessUrl(K){X.i.PreprocessUrl=K}static LoadImage(K,b,e,z,k,j){return(0,X.s)(K,b,e,z,k,j)}static LoadFile(K,b,e,z,k,j){return(0,X.r)(K,b,e,z,k,j)}static LoadFileAsync(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((e,z)=>{(0,X.r)(K,(K=>{e(K)}),void 0,void 0,b,((K,b)=>{z(b)}))}))}static GetBabylonScriptURL(K,b){if(!K)return"";if(m.ScriptBaseUrl&&K.startsWith(m._DefaultCdnUrl)){const b="/"===m.ScriptBaseUrl[m.ScriptBaseUrl.length-1]?m.ScriptBaseUrl.substring(0,m.ScriptBaseUrl.length-1):m.ScriptBaseUrl;K=K.replace(m._DefaultCdnUrl,b)}return K=m.ScriptPreprocessUrl(K),b&&(K=m.GetAbsoluteUrl(K)),K}static LoadBabylonScript(K,b,e,z){K=m.GetBabylonScriptURL(K),m.LoadScript(K,b,e)}static LoadBabylonScriptAsync(K){return K=m.GetBabylonScriptURL(K),m.LoadScriptAsync(K)}static LoadScript(K,b,e,z){let j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("function"===typeof importScripts){try{importScripts(K),b&&b()}catch(l){null===e||void 0===e||e(`Unable to load script '${K}' in worker`,l)}return}if(!(0,k.k)())return void(null===e||void 0===e||e(`Cannot load script '${K}' outside of a window or a worker`));const T=document.getElementsByTagName("head")[0],F=document.createElement("script");j?(F.setAttribute("type","module"),F.innerText=K):(F.setAttribute("type","text/javascript"),F.setAttribute("src",K)),z&&(F.id=z),F.onload=()=>{b&&b()},F.onerror=b=>{e&&e(`Unable to load script '${K}'`,b)},T.appendChild(F)}static LoadScriptAsync(K,b){return new Promise(((e,z)=>{this.LoadScript(K,(()=>{e()}),((K,b)=>{z(b||new Error(K))}),b)}))}static ReadFileAsDataURL(K,b,e){const k=new FileReader,j={onCompleteObservable:new z.d,abort:()=>k.abort()};return k.onloadend=()=>{j.onCompleteObservable.notifyObservers(j)},k.onload=K=>{b(K.target.result)},k.onprogress=e,k.readAsDataURL(K),j}static ReadFile(K,b,e,z,k){return(0,X.v)(K,b,e,z,k)}static FileAsURL(K){const b=new Blob([K]);return window.URL.createObjectURL(b)}static Format(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return K.toFixed(b)}static DeepCopy(K,b,e,z){T.c.DeepCopy(K,b,e,z)}static IsEmpty(K){for(const b in K)if(Object.prototype.hasOwnProperty.call(K,b))return!1;return!0}static RegisterTopRootEvents(K,b){for(let z=0;z<b.length;z++){const k=b[z];K.addEventListener(k.name,k.handler,!1);try{window.parent&&window.parent.addEventListener(k.name,k.handler,!1)}catch(e){}}}static UnregisterTopRootEvents(K,b){for(let z=0;z<b.length;z++){const k=b[z];K.removeEventListener(k.name,k.handler);try{K.parent&&K.parent.removeEventListener(k.name,k.handler)}catch(e){}}}static async DumpFramebuffer(K,b,e,z){throw(0,l.c)("DumpTools")}static DumpData(K,b,e,z){throw(0,l.c)("DumpTools")}static DumpDataAsync(K,b,e){throw(0,l.c)("DumpTools")}static _IsOffScreenCanvas(K){return void 0!==K.convertToBlob}static ToBlob(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",z=arguments.length>3?arguments[3]:void 0;m._IsOffScreenCanvas(K)||K.toBlob||(K.toBlob=function(K,b,e){setTimeout((()=>{const z=atob(this.toDataURL(b,e).split(",")[1]),k=z.length,j=new Uint8Array(k);for(let K=0;K<k;K++)j[K]=z.charCodeAt(K);K(new Blob([j]))}))}),m._IsOffScreenCanvas(K)?K.convertToBlob({type:e,quality:z}).then((K=>b(K))):K.toBlob((function(K){b(K)}),e,z)}static DownloadBlob(K,b){if("download"in document.createElement("a")){if(!b){const K=new Date;b="screenshot_"+((K.getFullYear()+"-"+(K.getMonth()+1)).slice(2)+"-"+K.getDate()+"_"+K.getHours()+"-"+("0"+K.getMinutes()).slice(-2))+".png"}m.Download(K,b)}else if(K&&"undefined"!==typeof URL){const b=URL.createObjectURL(K),e=window.open("");if(!e)return;const z=e.document.createElement("img");z.onload=function(){URL.revokeObjectURL(b)},z.src=b,e.document.body.appendChild(z)}}static EncodeScreenshotCanvasData(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0;if("string"!==typeof z&&b){if(b){if(m._IsOffScreenCanvas(K))return void K.convertToBlob({type:e,quality:k}).then((K=>{const e=new FileReader;e.readAsDataURL(K),e.onloadend=()=>{const K=e.result;b(K)}}));const z=K.toDataURL(e,k);b(z)}}else this.ToBlob(K,(function(K){K&&m.DownloadBlob(K,z),b&&b("")}),e,k)}static Download(K,b){if("undefined"===typeof URL)return;const e=window.URL.createObjectURL(K),z=document.createElement("a");document.body.appendChild(z),z.style.display="none",z.href=e,z.download=b,z.addEventListener("click",(()=>{z.parentElement&&z.parentElement.removeChild(z)})),z.click(),window.URL.revokeObjectURL(e)}static BackCompatCameraNoPreventDefault(K){return"boolean"===typeof K[0]?K[0]:"boolean"===typeof K[1]&&K[1]}static CreateScreenshot(K,b,e,z){throw(0,l.c)("ScreenshotTools")}static CreateScreenshotAsync(K,b,e){throw(0,l.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTarget(K,b,e,z){throw(0,l.c)("ScreenshotTools")}static CreateScreenshotUsingRenderTargetAsync(K,b,e){throw(0,l.c)("ScreenshotTools")}static RandomId(){return(0,B.b)()}static IsBase64(K){return(0,X.k)(K)}static DecodeBase64(K){return(0,X.e)(K)}static get errorsCount(){return j.b.errorsCount}static Log(K){j.b.Log(K)}static Warn(K){j.b.Warn(K)}static Error(K){j.b.Error(K)}static get LogCache(){return j.b.LogCache}static ClearLogCache(){j.b.ClearLogCache()}static set LogLevels(K){j.b.LogLevels=K}static set PerformanceLogLevel(K){return(K&m.PerformanceUserMarkLogLevel)===m.PerformanceUserMarkLogLevel?(m.StartPerformanceCounter=m._StartUserMark,void(m.EndPerformanceCounter=m._EndUserMark)):(K&m.PerformanceConsoleLogLevel)===m.PerformanceConsoleLogLevel?(m.StartPerformanceCounter=m._StartPerformanceConsole,void(m.EndPerformanceCounter=m._EndPerformanceConsole)):(m.StartPerformanceCounter=m._StartPerformanceCounterDisabled,void(m.EndPerformanceCounter=m._EndPerformanceCounterDisabled))}static _StartPerformanceCounterDisabled(K,b){}static _EndPerformanceCounterDisabled(K,b){}static _StartUserMark(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!m._Performance){if(!(0,k.k)())return;m._Performance=window.performance}b&&m._Performance.mark&&m._Performance.mark(K+"-Begin")}static _EndUserMark(K){(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&m._Performance.mark&&(m._Performance.mark(K+"-End"),m._Performance.measure(K,K+"-Begin",K+"-End"))}static _StartPerformanceConsole(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];b&&(m._StartUserMark(K,b),console.time&&console.time(K))}static _EndPerformanceConsole(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];b&&(m._EndUserMark(K,b),console.timeEnd(K))}static get Now(){return F.e.Now}static GetClassName(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=null;if(!b&&K.getClassName)e=K.getClassName();else{if(K instanceof Object){e=(b?K:Object.getPrototypeOf(K)).constructor.__bjsclassName__}e||(e=typeof K)}return e}static First(K,b){for(const e of K)if(b(e))return e;return null}static getFullClassName(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=null,z=null;if(!b&&K.getClassName)e=K.getClassName();else{if(K instanceof Object){const k=b?K:Object.getPrototypeOf(K);e=k.constructor.__bjsclassName__,z=k.constructor.__bjsmoduleName__}e||(e=typeof K)}return e?(null!=z?z+".":"")+e:null}static DelayAsync(K){return new Promise((b=>{setTimeout((()=>{b()}),K)}))}static IsSafari(){return!!(0,k.g)()&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}}m.UseCustomRequestHeaders=!1,m.CustomRequestHeaders=Y.e.CustomRequestHeaders,m.GetDOMTextContent=k.c,m._DefaultCdnUrl="https://cdn.babylonjs.com",m.GetAbsoluteUrl="object"===typeof document?K=>{const b=document.createElement("a");return b.href=K,b.href}:"function"===typeof URL&&"object"===typeof location?K=>new URL(K,location.origin).href:()=>{throw new Error("Unable to get absolute URL. Override BABYLON.Tools.GetAbsoluteUrl to a custom implementation for the current context.")},m.NoneLogLevel=j.b.NoneLogLevel,m.MessageLogLevel=j.b.MessageLogLevel,m.WarningLogLevel=j.b.WarningLogLevel,m.ErrorLogLevel=j.b.ErrorLogLevel,m.AllLogLevel=j.b.AllLogLevel,m.IsWindowObjectExist=k.k,m.PerformanceNoneLogLevel=0,m.PerformanceUserMarkLogLevel=1,m.PerformanceConsoleLogLevel=2,m.StartPerformanceCounter=m._StartPerformanceCounterDisabled,m.EndPerformanceCounter=m._EndPerformanceCounterDisabled;class D{constructor(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.iterations=K,this.index=z-1,this._done=!1,this._fn=b,this._successCallback=e}executeNext(){this._done||(this.index+1<this.iterations?(++this.index,this._fn(this)):this.breakLoop())}breakLoop(){this._done=!0,this._successCallback()}static Run(K,b,e){const z=new D(K,b,e,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return z.executeNext(),z}static SyncAsyncForLoop(K,b,e,z,k){let j=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return D.Run(Math.ceil(K/b),(z=>{k&&k()?z.breakLoop():setTimeout((()=>{for(let j=0;j<b;++j){const T=z.index*b+j;if(T>=K)break;if(e(T),k&&k()){z.breakLoop();break}}z.executeNext()}),j)}),z)}}m.Mix=u.l,m.IsExponentOfTwo=u.k,A.b.FallbackTexture="data:image/jpg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4QBmRXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAAExAAIAAAAQAAAATgAAAAAAAABgAAAAAQAAAGAAAAABcGFpbnQubmV0IDQuMC41AP/bAEMABAIDAwMCBAMDAwQEBAQFCQYFBQUFCwgIBgkNCw0NDQsMDA4QFBEODxMPDAwSGBITFRYXFxcOERkbGRYaFBYXFv/bAEMBBAQEBQUFCgYGChYPDA8WFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFv/AABEIAQABAAMBIgACEQEDEQH/xAAfAAABBQEBAQEBAQAAAAAAAAAAAQIDBAUGBwgJCgv/xAC1EAACAQMDAgQDBQUEBAAAAX0BAgMABBEFEiExQQYTUWEHInEUMoGRoQgjQrHBFVLR8CQzYnKCCQoWFxgZGiUmJygpKjQ1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4eLj5OXm5+jp6vHy8/T19vf4+fr/xAAfAQADAQEBAQEBAQEBAAAAAAAAAQIDBAUGBwgJCgv/xAC1EQACAQIEBAMEBwUEBAABAncAAQIDEQQFITEGEkFRB2FxEyIygQgUQpGhscEJIzNS8BVictEKFiQ04SXxFxgZGiYnKCkqNTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqCg4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2dri4+Tl5ufo6ery8/T19vf4+fr/2gAMAwEAAhEDEQA/APH6KKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76CiiigD5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BQooooA+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/voKKKKAPl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FCiiigD6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++gooooA+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gUKKKKAPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76Pl+iiivuj+BT6gooor4U/vo+X6KKK+6P4FPqCiiivhT++j5fooor7o/gU+oKKKK+FP76P//Z"},10799:(K,b,e)=>{"use strict";e.d(b,{d:()=>j,e:()=>k});const z={};function k(K,b){z[K]=b}function j(K){return z[K]}},11070:(K,b,e)=>{"use strict";e.d(b,{d:()=>z});class z{static get UniqueId(){const K=this._UniqueIdCounter;return this._UniqueIdCounter++,K}}z._UniqueIdCounter=1},10718:(K,b,e)=>{"use strict";e.d(b,{e:()=>z});class z{constructor(){this._xhr="undefined"!==typeof _native&&_native.XMLHttpRequest?new _native.XMLHttpRequest:new XMLHttpRequest,this._requestURL=""}static get IsCustomRequestAvailable(){return Object.keys(z.CustomRequestHeaders).length>0||z.CustomRequestModifiers.length>0}get requestURL(){return this._requestURL}_injectCustomRequestHeaders(){if(!this._shouldSkipRequestModifications(this._requestURL))for(const K in z.CustomRequestHeaders){const b=z.CustomRequestHeaders[K];b&&this._xhr.setRequestHeader(K,b)}}_shouldSkipRequestModifications(K){return z.SkipRequestModificationForBabylonCDN&&(K.includes("preview.babylonjs.com")||K.includes("cdn.babylonjs.com"))}get onprogress(){return this._xhr.onprogress}set onprogress(K){this._xhr.onprogress=K}get readyState(){return this._xhr.readyState}get status(){return this._xhr.status}get statusText(){return this._xhr.statusText}get response(){return this._xhr.response}get responseURL(){return this._xhr.responseURL}get responseText(){return this._xhr.responseText}get responseType(){return this._xhr.responseType}set responseType(K){this._xhr.responseType=K}get timeout(){return this._xhr.timeout}set timeout(K){this._xhr.timeout=K}addEventListener(K,b,e){this._xhr.addEventListener(K,b,e)}removeEventListener(K,b,e){this._xhr.removeEventListener(K,b,e)}abort(){this._xhr.abort()}send(K){z.CustomRequestHeaders&&this._injectCustomRequestHeaders(),this._xhr.send(K)}open(K,b){for(const e of z.CustomRequestModifiers){if(this._shouldSkipRequestModifications(b))return;e(this._xhr,b)}b=(b=b.replace("file:http:","http:")).replace("file:https:","https:"),this._requestURL=b,this._xhr.open(K,b,!0)}setRequestHeader(K,b){this._xhr.setRequestHeader(K,b)}getResponseHeader(K){return this._xhr.getResponseHeader(K)}}z.CustomRequestHeaders={},z.CustomRequestModifiers=new Array,z.SkipRequestModificationForBabylonCDN=!0},11991:(K,b,e)=>{"use strict";e.d(b,{e:()=>k});class z{constructor(K){this._pendingActions=new Array,this._workerInfos=K.map((K=>({workerPromise:Promise.resolve(K),idle:!0})))}dispose(){for(const K of this._workerInfos)K.workerPromise.then((K=>{K.terminate()}));this._workerInfos.length=0,this._pendingActions.length=0}push(K){this._executeOnIdleWorker(K)||this._pendingActions.push(K)}_executeOnIdleWorker(K){for(const b of this._workerInfos)if(b.idle)return this._execute(b,K),!0;return!1}_execute(K,b){K.idle=!1,K.workerPromise.then((e=>{b(e,(()=>{const b=this._pendingActions.shift();b?this._execute(K,b):K.idle=!0}))}))}}class k extends z{constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:k.DefaultOptions;super([]),this._maxWorkers=K,this._createWorkerAsync=b,this._options=e}push(K){if(!this._executeOnIdleWorker(K))if(this._workerInfos.length<this._maxWorkers){const b={workerPromise:this._createWorkerAsync(),idle:!1};this._workerInfos.push(b),this._execute(b,K)}else this._pendingActions.push(K)}_execute(K,b){K.timeoutId&&(clearTimeout(K.timeoutId),delete K.timeoutId),super._execute(K,((e,z)=>{b(e,(()=>{z(),K.idle&&(K.timeoutId=setTimeout((()=>{K.workerPromise.then((K=>{K.terminate()}));const b=this._workerInfos.indexOf(K);-1!==b&&this._workerInfos.splice(b,1)}),this._options.idleTimeElapsedBeforeRelease))}))}))}}k.DefaultOptions={idleTimeElapsedBeforeRelease:1e3}},11408:(K,b,e)=>{"use strict";e.d(b,{b:()=>DK});var z=e(10967),k=e(11146);class j extends k.d{constructor(){super(),this.IMAGEPROCESSING=!1,this.VIGNETTE=!1,this.VIGNETTEBLENDMODEMULTIPLY=!1,this.VIGNETTEBLENDMODEOPAQUE=!1,this.TONEMAPPING=0,this.CONTRAST=!1,this.COLORCURVES=!1,this.COLORGRADING=!1,this.COLORGRADING3D=!1,this.SAMPLER3DGREENDEPTH=!1,this.SAMPLER3DBGRMAP=!1,this.DITHER=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.EXPOSURE=!1,this.SKIPFINALCOLORCLAMP=!1,this.rebuild()}}var T=e(10994),F=(e(11413),e(10799));class l{get noiseTexture(){return this._noiseTexture}set noiseTexture(K){this._noiseTexture!==K&&(this._noiseTexture=K,this._reset())}get isAnimationSheetEnabled(){return this._isAnimationSheetEnabled}set isAnimationSheetEnabled(K){this._isAnimationSheetEnabled!=K&&(this._isAnimationSheetEnabled=K,this._reset())}get useLogarithmicDepth(){return this._useLogarithmicDepth}set useLogarithmicDepth(K){this._useLogarithmicDepth=K&&this.va().getEngine().getCaps().fragmentDepthSupported}va(){return this._scene}_hasTargetStopDurationDependantGradient(){return this._startSizeGradients&&this._startSizeGradients.length>0||this._emitRateGradients&&this._emitRateGradients.length>0||this._lifeTimeGradients&&this._lifeTimeGradients.length>0}getDragGradients(){return this._dragGradients}getLimitVelocityGradients(){return this._limitVelocityGradients}getColorGradients(){return this._colorGradients}getSizeGradients(){return this._sizeGradients}getColorRemapGradients(){return this._colorRemapGradients}getAlphaRemapGradients(){return this._alphaRemapGradients}getLifeTimeGradients(){return this._lifeTimeGradients}getAngularSpeedGradients(){return this._angularSpeedGradients}getVelocityGradients(){return this._velocityGradients}getStartSizeGradients(){return this._startSizeGradients}getEmitRateGradients(){return this._emitRateGradients}get direction1(){return this.particleEmitterType.direction1?this.particleEmitterType.direction1:z.k.Zero()}set direction1(K){this.particleEmitterType.direction1&&(this.particleEmitterType.direction1=K)}get direction2(){return this.particleEmitterType.direction2?this.particleEmitterType.direction2:z.k.Zero()}set direction2(K){this.particleEmitterType.direction2&&(this.particleEmitterType.direction2=K)}get minEmitBox(){return this.particleEmitterType.minEmitBox?this.particleEmitterType.minEmitBox:z.k.Zero()}set minEmitBox(K){this.particleEmitterType.minEmitBox&&(this.particleEmitterType.minEmitBox=K)}get maxEmitBox(){return this.particleEmitterType.maxEmitBox?this.particleEmitterType.maxEmitBox:z.k.Zero()}set maxEmitBox(K){this.particleEmitterType.maxEmitBox&&(this.particleEmitterType.maxEmitBox=K)}get billboardMode(){return this._billboardMode}set billboardMode(K){this._billboardMode!==K&&(this._billboardMode=K,this._reset())}get isBillboardBased(){return this._isBillboardBased}set isBillboardBased(K){this._isBillboardBased!==K&&(this._isBillboardBased=K,this._reset())}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K)}_attachImageProcessingConfiguration(K){K!==this._imageProcessingConfiguration&&(!K&&this._scene?this._imageProcessingConfiguration=this._scene.imageProcessingConfiguration:this._imageProcessingConfiguration=K)}_reset(){}_removeGradientAndTexture(K,b,e){if(!b)return this;let z=0;for(const k of b){if(k.gradient===K){b.splice(z,1);break}z++}return e&&e.dispose(),this}constructor(K){this.animations=[],this.renderingGroupId=0,this.j=z.k.Zero(),this.emitRate=10,this.manualEmitCount=-1,this.updateSpeed=.01,this.targetStopDuration=0,this.disposeOnStop=!1,this.minEmitPower=1,this.maxEmitPower=1,this.minLifeTime=1,this.maxLifeTime=1,this.minSize=1,this.maxSize=1,this.minScaleX=1,this.maxScaleX=1,this.minScaleY=1,this.maxScaleY=1,this.minInitialRotation=0,this.maxInitialRotation=0,this.minAngularSpeed=0,this.maxAngularSpeed=0,this.layerMask=268435455,this.customShader=null,this.preventAutoStart=!1,this.applyFog=!1,this._wasDispatched=!1,this._rootUrl="",this.noiseStrength=new z.k(10,10,10),this.onAnimationEnd=null,this.blendMode=l.BLENDMODE_ONEONE,this.forceDepthWrite=!1,this.preWarmCycles=0,this.preWarmStepOffset=1,this.spriteCellChangeSpeed=1,this.startSpriteCellID=0,this.endSpriteCellID=0,this.spriteCellWidth=0,this.spriteCellHeight=0,this.spriteCellLoop=!0,this.spriteRandomStartCell=!1,this.translationPivot=new z.h(0,0),this.beginAnimationOnStart=!1,this.beginAnimationFrom=0,this.beginAnimationTo=60,this.beginAnimationLoop=!1,this.Kf=new z.k(0,0,0),this._useLogarithmicDepth=!1,this.gravity=z.k.Zero(),this._colorGradients=null,this._sizeGradients=null,this._lifeTimeGradients=null,this._angularSpeedGradients=null,this._velocityGradients=null,this._limitVelocityGradients=null,this._dragGradients=null,this._emitRateGradients=null,this._startSizeGradients=null,this._rampGradients=null,this._colorRemapGradients=null,this._alphaRemapGradients=null,this.startDelay=0,this.limitVelocityDamping=.4,this.color1=new T.g(1,1,1,1),this.color2=new T.g(1,1,1,1),this.colorDead=new T.g(0,0,0,1),this.textureMask=new T.g(1,1,1,1),this._isSubEmitter=!1,this._billboardMode=7,this._isBillboardBased=!0,this._imageProcessingConfigurationDefines=new j,this.id=K,this.name=K}createPointEmitter(K,b){throw new Error("Method not implemented.")}createHemisphericEmitter(){throw new Error("Method not implemented.")}createSphereEmitter(){throw new Error("Method not implemented.")}createDirectedSphereEmitter(){arguments.length>1&&void 0!==arguments[1]||new z.k(0,1,0),arguments.length>2&&void 0!==arguments[2]||new z.k(0,1,0);throw new Error("Method not implemented.")}createCylinderEmitter(){throw new Error("Method not implemented.")}createDirectedCylinderEmitter(){arguments.length>3&&void 0!==arguments[3]||new z.k(0,1,0),arguments.length>4&&void 0!==arguments[4]||new z.k(0,1,0);throw new Error("Method not implemented.")}createConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI;throw new Error("Method not implemented.")}createDirectedConeEmitter(){arguments.length>1&&void 0!==arguments[1]||Math.PI,arguments.length>2&&void 0!==arguments[2]||new z.k(0,1,0),arguments.length>3&&void 0!==arguments[3]||new z.k(0,1,0);throw new Error("Method not implemented.")}createBoxEmitter(K,b,e,z){throw new Error("Method not implemented.")}}l.BLENDMODE_ONEONE=0,l.BLENDMODE_STANDARD=1,l.BLENDMODE_ADD=2,l.BLENDMODE_MULTIPLY=3,l.BLENDMODE_MULTIPLYADD=4,(0,F.e)("BABYLON.BaseParticleSystem",l);var Y=e(10984),A=e(10698);class X{constructor(){this.direction1=new z.k(0,1,0),this.direction2=new z.k(0,1,0),this.minEmitBox=new z.k(-.5,-.5,-.5),this.maxEmitBox=new z.k(.5,.5,.5)}startDirectionFunction(K,b,e,k){const j=(0,Y.t)(this.direction1.x,this.direction2.x),T=(0,Y.t)(this.direction1.y,this.direction2.y),F=(0,Y.t)(this.direction1.z,this.direction2.z);if(k)return b.x=j,b.y=T,void(b.z=F);z.k.TransformNormalFromFloatsToRef(j,T,F,K,b)}startPositionFunction(K,b,e,k){const j=(0,Y.t)(this.minEmitBox.x,this.maxEmitBox.x),T=(0,Y.t)(this.minEmitBox.y,this.maxEmitBox.y),F=(0,Y.t)(this.minEmitBox.z,this.maxEmitBox.z);if(k)return b.x=j,b.y=T,void(b.z=F);z.k.TransformCoordinatesFromFloatsToRef(j,T,F,K,b)}clone(){const K=new X;return A.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2),K.setVector3("minEmitBox",this.minEmitBox),K.setVector3("maxEmitBox",this.maxEmitBox)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3),K.addUniform("minEmitBox",3),K.addUniform("maxEmitBox",3)}getEffectDefines(){return"#define BOXEMITTER"}getClassName(){return"BoxParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.Ti(),K.direction2=this.direction2.Ti(),K.minEmitBox=this.minEmitBox.Ti(),K.maxEmitBox=this.maxEmitBox.Ti(),K}parse(K){z.k.FromArrayToRef(K.direction1,0,this.direction1),z.k.FromArrayToRef(K.direction2,0,this.direction2),z.k.FromArrayToRef(K.minEmitBox,0,this.minEmitBox),z.k.FromArrayToRef(K.maxEmitBox,0,this.maxEmitBox)}}class t{get radius(){return this._radius}set radius(K){this._radius=K,this._buildHeight()}get angle(){return this._angle}set angle(K){this._angle=K,this._buildHeight()}_buildHeight(){0!==this._angle?this._height=this._radius/Math.tan(this._angle/2):this._height=1}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.directionRandomizer=e,this.radiusRange=1,this.heightRange=1,this.emitFromSpawnPointOnly=!1,this.angle=b,this.radius=K}startDirectionFunction(K,b,e,k){k?z.e.gb[0].p(e.Ud).normalize():e.position.subtractToRef(K.getTranslation(),z.e.gb[0]).normalize();const j=(0,Y.t)(0,this.directionRandomizer),T=(0,Y.t)(0,this.directionRandomizer),F=(0,Y.t)(0,this.directionRandomizer);b.x=z.e.gb[0].x+j,b.y=z.e.gb[0].y+T,b.z=z.e.gb[0].z+F,b.normalize()}startPositionFunction(K,b,e,k){const j=(0,Y.t)(0,2*Math.PI);let T;this.emitFromSpawnPointOnly?T=1e-4:(T=(0,Y.t)(0,this.heightRange),T=1-T*T);let F=this._radius-(0,Y.t)(0,this._radius*this.radiusRange);F*=T;const l=F*Math.sin(j),A=F*Math.cos(j),X=T*this._height;if(k)return b.x=l,b.y=X,void(b.z=A);z.k.TransformCoordinatesFromFloatsToRef(l,X,A,K,b)}clone(){const K=new t(this._radius,this._angle,this.directionRandomizer);return A.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat2("radius",this._radius,this.radiusRange),K.setFloat("coneAngle",this._angle),K.setFloat2("height",this._height,this.heightRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",2),K.addUniform("coneAngle",1),K.addUniform("height",2),K.addUniform("directionRandomizer",1)}getEffectDefines(){let K="#define CONEEMITTER";return this.emitFromSpawnPointOnly&&(K+="\n#define CONEEMITTERSPAWNPOINT"),K}getClassName(){return"ConeParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this._radius,K.angle=this._angle,K.directionRandomizer=this.directionRandomizer,K.radiusRange=this.radiusRange,K.heightRange=this.heightRange,K.emitFromSpawnPointOnly=this.emitFromSpawnPointOnly,K}parse(K){this.radius=K.radius,this.angle=K.angle,this.directionRandomizer=K.directionRandomizer,this.radiusRange=void 0!==K.radiusRange?K.radiusRange:1,this.heightRange=void 0!==K.radiusRange?K.heightRange:1,this.emitFromSpawnPointOnly=void 0!==K.emitFromSpawnPointOnly&&K.emitFromSpawnPointOnly}}class U extends t{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.k(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.k(0,1,0);super(K,b),this.direction1=e,this.direction2=k}startDirectionFunction(K,b){const e=(0,Y.t)(this.direction1.x,this.direction2.x),k=(0,Y.t)(this.direction1.y,this.direction2.y),j=(0,Y.t)(this.direction1.z,this.direction2.z);z.k.TransformNormalFromFloatsToRef(e,k,j,K,b)}clone(){const K=new U(this.radius,this.angle,this.direction1,this.direction2);return A.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CONEEMITTER\n#define DIRECTEDCONEEMITTER"}getClassName(){return"ConeDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.Ti(),K.direction2=this.direction2.Ti(),K}parse(K){super.parse(K),this.direction1.p(K.direction1),this.direction2.p(K.direction2)}}class B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.radius=K,this.height=b,this.radiusRange=e,this.directionRandomizer=k,this._tempVector=z.k.Zero()}startDirectionFunction(K,b,e,k,j){e.position.subtractToRef(K.getTranslation(),this._tempVector),this._tempVector.normalize(),z.k.TransformNormalToRef(this._tempVector,j,this._tempVector);const T=(0,Y.t)(-this.directionRandomizer/2,this.directionRandomizer/2);let F=Math.atan2(this._tempVector.x,this._tempVector.z);F+=(0,Y.t)(-Math.PI/2,Math.PI/2)*this.directionRandomizer,this._tempVector.y=T,this._tempVector.x=Math.sin(F),this._tempVector.z=Math.cos(F),this._tempVector.normalize(),k?b.p(this._tempVector):z.k.TransformNormalFromFloatsToRef(this._tempVector.x,this._tempVector.y,this._tempVector.z,K,b)}startPositionFunction(K,b,e,k){const j=(0,Y.t)(-this.height/2,this.height/2),T=(0,Y.t)(0,2*Math.PI),F=(0,Y.t)((1-this.radiusRange)*(1-this.radiusRange),1),l=Math.sqrt(F)*this.radius,A=l*Math.cos(T),X=l*Math.sin(T);k?b.Yd(A,j,X):z.k.TransformCoordinatesFromFloatsToRef(A,j,X,K,b)}clone(){const K=new B(this.radius,this.directionRandomizer);return A.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define CYLINDEREMITTER"}getClassName(){return"CylinderParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.height=this.height,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.height=K.height,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class u extends B{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.k(0,1,0),j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.k(0,1,0);super(K,b,e),this.direction1=k,this.direction2=j}startDirectionFunction(K,b,e,k){const j=(0,Y.t)(this.direction1.x,this.direction2.x),T=(0,Y.t)(this.direction1.y,this.direction2.y),F=(0,Y.t)(this.direction1.z,this.direction2.z);k?b.Yd(j,T,F):z.k.TransformNormalFromFloatsToRef(j,T,F,K,b)}clone(){const K=new u(this.radius,this.height,this.radiusRange,this.direction1,this.direction2);return A.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("height",this.height),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("height",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define CYLINDEREMITTER\n#define DIRECTEDCYLINDEREMITTER"}getClassName(){return"CylinderDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.Ti(),K.direction2=this.direction2.Ti(),K}parse(K){super.parse(K),z.k.FromArrayToRef(K.direction1,0,this.direction1),z.k.FromArrayToRef(K.direction2,0,this.direction2)}}class m{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=b,this.directionRandomizer=e}startDirectionFunction(K,b,e,k){const j=e.position.Qc(K.getTranslation()).normalize(),T=(0,Y.t)(0,this.directionRandomizer),F=(0,Y.t)(0,this.directionRandomizer),l=(0,Y.t)(0,this.directionRandomizer);j.x+=T,j.y+=F,j.z+=l,j.normalize(),k?b.p(j):z.k.TransformNormalFromFloatsToRef(j.x,j.y,j.z,K,b)}startPositionFunction(K,b,e,k){const j=this.radius-(0,Y.t)(0,this.radius*this.radiusRange),T=(0,Y.t)(0,1),F=(0,Y.t)(0,2*Math.PI),l=Math.acos(2*T-1),A=j*Math.cos(F)*Math.sin(l),X=j*Math.cos(l),t=j*Math.sin(F)*Math.sin(l);k?b.Yd(A,Math.abs(X),t):z.k.TransformCoordinatesFromFloatsToRef(A,Math.abs(X),t,K,b)}clone(){const K=new m(this.radius,this.directionRandomizer);return A.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define HEMISPHERICEMITTER"}getClassName(){return"HemisphericParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class D{constructor(){this.direction1=new z.k(0,1,0),this.direction2=new z.k(0,1,0)}startDirectionFunction(K,b,e,k){const j=(0,Y.t)(this.direction1.x,this.direction2.x),T=(0,Y.t)(this.direction1.y,this.direction2.y),F=(0,Y.t)(this.direction1.z,this.direction2.z);k?b.Yd(j,T,F):z.k.TransformNormalFromFloatsToRef(j,T,F,K,b)}startPositionFunction(K,b,e,k){k?b.Yd(0,0,0):z.k.TransformCoordinatesFromFloatsToRef(0,0,0,K,b)}clone(){const K=new D;return A.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define POINTEMITTER"}getClassName(){return"PointParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.direction1=this.direction1.Ti(),K.direction2=this.direction2.Ti(),K}parse(K){z.k.FromArrayToRef(K.direction1,0,this.direction1),z.k.FromArrayToRef(K.direction2,0,this.direction2)}}class I{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.radius=K,this.radiusRange=b,this.directionRandomizer=e}startDirectionFunction(K,b,e,k){const j=e.position.Qc(K.getTranslation()).normalize(),T=(0,Y.t)(0,this.directionRandomizer),F=(0,Y.t)(0,this.directionRandomizer),l=(0,Y.t)(0,this.directionRandomizer);j.x+=T,j.y+=F,j.z+=l,j.normalize(),k?b.p(j):z.k.TransformNormalFromFloatsToRef(j.x,j.y,j.z,K,b)}startPositionFunction(K,b,e,k){const j=this.radius-(0,Y.t)(0,this.radius*this.radiusRange),T=(0,Y.t)(0,1),F=(0,Y.t)(0,2*Math.PI),l=Math.acos(2*T-1),A=j*Math.cos(F)*Math.sin(l),X=j*Math.cos(l),t=j*Math.sin(F)*Math.sin(l);k?b.Yd(A,X,t):z.k.TransformCoordinatesFromFloatsToRef(A,X,t,K,b)}clone(){const K=new I(this.radius,this.directionRandomizer);return A.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setFloat("directionRandomizer",this.directionRandomizer)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("directionRandomizer",1)}getEffectDefines(){return"#define SPHEREEMITTER"}getClassName(){return"SphereParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.radius=this.radius,K.radiusRange=this.radiusRange,K.directionRandomizer=this.directionRandomizer,K}parse(K){this.radius=K.radius,this.radiusRange=K.radiusRange,this.directionRandomizer=K.directionRandomizer}}class x extends I{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.k(0,1,0),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.k(0,1,0);super(K),this.direction1=b,this.direction2=e}startDirectionFunction(K,b){const e=(0,Y.t)(this.direction1.x,this.direction2.x),k=(0,Y.t)(this.direction1.y,this.direction2.y),j=(0,Y.t)(this.direction1.z,this.direction2.z);z.k.TransformNormalFromFloatsToRef(e,k,j,K,b)}clone(){const K=new x(this.radius,this.direction1,this.direction2);return A.c.DeepCopy(this,K),K}applyToShader(K){K.setFloat("radius",this.radius),K.setFloat("radiusRange",this.radiusRange),K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("radius",1),K.addUniform("radiusRange",1),K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return"#define SPHEREEMITTER\n#define DIRECTEDSPHEREEMITTER"}getClassName(){return"SphereDirectedParticleEmitter"}serialize(){const K=super.serialize();return K.direction1=this.direction1.Ti(),K.direction2=this.direction2.Ti(),K}parse(K){super.parse(K),this.direction1.p(K.direction1),this.direction2.p(K.direction2)}}class Q{constructor(){this.particlePositionGenerator=()=>{},this.particleDestinationGenerator=()=>{}}startDirectionFunction(K,b,e,k){const j=z.e.gb[0];if(this.particleDestinationGenerator){this.particleDestinationGenerator(-1,e,j);const K=z.e.gb[1];j.subtractToRef(e.position,K),K.scaleToRef(1/e.lifeTime,j)}else j.set(0,0,0);k?b.p(j):z.k.TransformNormalToRef(j,K,b)}startPositionFunction(K,b,e,k){const j=z.e.gb[0];this.particlePositionGenerator?this.particlePositionGenerator(-1,e,j):j.set(0,0,0),k?b.p(j):z.k.TransformCoordinatesToRef(j,K,b)}clone(){const K=new Q;return A.c.DeepCopy(this,K),K}applyToShader(K){}buildUniformLayout(K){}getEffectDefines(){return"#define CUSTOMEMITTER"}getClassName(){return"CustomParticleEmitter"}serialize(){const K={};return K.type=this.getClassName(),K.particlePositionGenerator=this.particlePositionGenerator,K.particleDestinationGenerator=this.particleDestinationGenerator,K}parse(K){K.particlePositionGenerator&&(this.particlePositionGenerator=K.particlePositionGenerator),K.particleDestinationGenerator&&(this.particleDestinationGenerator=K.particleDestinationGenerator)}}var G=e(11030);class i{get mesh(){return this._mesh}set mesh(K){this._mesh!==K&&(this._mesh=K,K?(this._indices=K.Lf(),this._positions=K.getVerticesData(G.f.PositionKind),this._normals=K.getVerticesData(G.f.NormalKind)):(this._indices=null,this._positions=null,this._normals=null))}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this._indices=null,this._positions=null,this._normals=null,this._storedNormal=z.k.Zero(),this._mesh=null,this.direction1=new z.k(0,1,0),this.direction2=new z.k(0,1,0),this.useMeshNormalsForDirection=!0,this.mesh=K}startDirectionFunction(K,b,e,k){if(this.useMeshNormalsForDirection&&this._normals)return void z.k.TransformNormalToRef(this._storedNormal,K,b);const j=(0,Y.t)(this.direction1.x,this.direction2.x),T=(0,Y.t)(this.direction1.y,this.direction2.y),F=(0,Y.t)(this.direction1.z,this.direction2.z);k?b.Yd(j,T,F):z.k.TransformNormalFromFloatsToRef(j,T,F,K,b)}startPositionFunction(K,b,e,k){if(!this._indices||!this._positions)return;const j=3*Math.random()*(this._indices.length/3)|0,T=Math.random(),F=Math.random()*(1-T),l=1-T-F,Y=this._indices[j],A=this._indices[j+1],X=this._indices[j+2],t=z.e.gb[0],U=z.e.gb[1],B=z.e.gb[2],u=z.e.gb[3];z.k.FromArrayToRef(this._positions,3*Y,t),z.k.FromArrayToRef(this._positions,3*A,U),z.k.FromArrayToRef(this._positions,3*X,B),u.x=T*t.x+F*U.x+l*B.x,u.y=T*t.y+F*U.y+l*B.y,u.z=T*t.z+F*U.z+l*B.z,k?b.Yd(u.x,u.y,u.z):z.k.TransformCoordinatesFromFloatsToRef(u.x,u.y,u.z,K,b),this.useMeshNormalsForDirection&&this._normals&&(z.k.FromArrayToRef(this._normals,3*Y,t),z.k.FromArrayToRef(this._normals,3*A,U),z.k.FromArrayToRef(this._normals,3*X,B),this._storedNormal.x=T*t.x+F*U.x+l*B.x,this._storedNormal.y=T*t.y+F*U.y+l*B.y,this._storedNormal.z=T*t.z+F*U.z+l*B.z)}clone(){const K=new i(this.mesh);return A.c.DeepCopy(this,K),K}applyToShader(K){K.setVector3("direction1",this.direction1),K.setVector3("direction2",this.direction2)}buildUniformLayout(K){K.addUniform("direction1",3),K.addUniform("direction2",3)}getEffectDefines(){return""}getClassName(){return"MeshParticleEmitter"}serialize(){var K;const b={};return b.type=this.getClassName(),b.direction1=this.direction1.Ti(),b.direction2=this.direction2.Ti(),b.meshId=null===(K=this.mesh)||void 0===K?void 0:K.id,b.useMeshNormalsForDirection=this.useMeshNormalsForDirection,b}parse(K,b){z.k.FromArrayToRef(K.direction1,0,this.direction1),z.k.FromArrayToRef(K.direction2,0,this.direction2),K.meshId&&b&&(this.mesh=b.getLastMeshById(K.meshId)),this.useMeshNormalsForDirection=K.useMeshNormalsForDirection}}var S=e(10756);class M{_isUbo(K){return void 0!==K.addUniform}constructor(K){this._isUbo(K)?(this.setMatrix3x3=K.updateMatrix3x3.bind(K),this.setMatrix2x2=K.updateMatrix2x2.bind(K),this.setFloat=K.updateFloat.bind(K),this.setFloat2=K.updateFloat2.bind(K),this.setFloat3=K.updateFloat3.bind(K),this.setFloat4=K.updateFloat4.bind(K),this.setFloatArray=K.updateFloatArray.bind(K),this.setArray=K.updateArray.bind(K),this.setIntArray=K.updateIntArray.bind(K),this.setMatrix=K.qj.bind(K),this.setMatrices=K.updateMatrices.bind(K),this.setVector3=K.updateVector3.bind(K),this.setVector4=K.updateVector4.bind(K),this.setColor3=K.updateColor3.bind(K),this.setColor4=K.updateColor4.bind(K),this.setDirectColor4=K.updateDirectColor4.bind(K),this.setInt=K.updateInt.bind(K),this.setInt2=K.updateInt2.bind(K),this.setInt3=K.updateInt3.bind(K),this.setInt4=K.updateInt4.bind(K)):(this.setMatrix3x3=K.setMatrix3x3.bind(K),this.setMatrix2x2=K.setMatrix2x2.bind(K),this.setFloat=K.setFloat.bind(K),this.setFloat2=K.setFloat2.bind(K),this.setFloat3=K.setFloat3.bind(K),this.setFloat4=K.setFloat4.bind(K),this.setFloatArray=K.setFloatArray.bind(K),this.setArray=K.setArray.bind(K),this.setIntArray=K.setIntArray.bind(K),this.setMatrix=K.setMatrix.bind(K),this.setMatrices=K.setMatrices.bind(K),this.setVector3=K.setVector3.bind(K),this.setVector4=K.setVector4.bind(K),this.setColor3=K.setColor3.bind(K),this.setColor4=K.setColor4.bind(K),this.setDirectColor4=K.setDirectColor4.bind(K),this.setInt=K.setInt.bind(K),this.setInt2=K.setInt2.bind(K),this.setInt3=K.setInt3.bind(K),this.setInt4=K.setInt4.bind(K))}}var r=e(10764);const L="gpuUpdateParticlesPixelShader",c="#version 300 es\nvoid main() {discard;}\n";r.d.ShadersStore[L]=c;const v="gpuUpdateParticlesVertexShader",w="#version 300 es\n#define PI 3.14159\nuniform float currentCount;uniform float timeDelta;uniform float stopFactor;\n#ifndef LOCAL\nuniform mat4 emitterWM;\n#endif\nuniform vec2 lifeTime;uniform vec2 emitPower;uniform vec2 sizeRange;uniform vec4 scaleRange;\n#ifndef COLORGRADIENTS\nuniform vec4 color1;uniform vec4 color2;\n#endif\nuniform vec3 gravity;uniform sampler2D randomSampler;uniform sampler2D randomSampler2;uniform vec4 angleRange;\n#ifdef BOXEMITTER\nuniform vec3 direction1;uniform vec3 direction2;uniform vec3 minEmitBox;uniform vec3 maxEmitBox;\n#endif\n#ifdef POINTEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#endif\n#ifdef HEMISPHERICEMITTER\nuniform float radius;uniform float radiusRange;uniform float directionRandomizer;\n#endif\n#ifdef SPHEREEMITTER\nuniform float radius;uniform float radiusRange;\n#ifdef DIRECTEDSPHEREEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nuniform float radius;uniform float height;uniform float radiusRange;\n#ifdef DIRECTEDCYLINDEREMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\n#ifdef CONEEMITTER\nuniform vec2 radius;uniform float coneAngle;uniform vec2 height;\n#ifdef DIRECTEDCONEEMITTER\nuniform vec3 direction1;uniform vec3 direction2;\n#else\nuniform float directionRandomizer;\n#endif\n#endif\nin vec3 position;\n#ifdef CUSTOMEMITTER\nin vec3 initialPosition;\n#endif\nin float age;in float life;in vec4 seed;in vec3 size;\n#ifndef COLORGRADIENTS\nin vec4 color;\n#endif\nin vec3 direction;\n#ifndef BILLBOARD\nin vec3 initialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nin float angle;\n#else\nin vec2 angle;\n#endif\n#ifdef ANIMATESHEET\nin float cellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nin float cellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nin vec3 noiseCoordinates1;in vec3 noiseCoordinates2;\n#endif\nout vec3 outPosition;\n#ifdef CUSTOMEMITTER\nout vec3 outInitialPosition;\n#endif\nout float outAge;out float outLife;out vec4 outSeed;out vec3 outSize;\n#ifndef COLORGRADIENTS\nout vec4 outColor;\n#endif\nout vec3 outDirection;\n#ifndef BILLBOARD\nout vec3 outInitialDirection;\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nout float outAngle;\n#else\nout vec2 outAngle;\n#endif\n#ifdef ANIMATESHEET\nout float outCellIndex;\n#ifdef ANIMATESHEETRANDOMSTART\nout float outCellStartOffset;\n#endif\n#endif\n#ifdef NOISE\nout vec3 outNoiseCoordinates1;out vec3 outNoiseCoordinates2;\n#endif\n#ifdef SIZEGRADIENTS\nuniform sampler2D sizeGradientSampler;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nuniform sampler2D angularSpeedGradientSampler;\n#endif \n#ifdef VELOCITYGRADIENTS\nuniform sampler2D velocityGradientSampler;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\nuniform sampler2D limitVelocityGradientSampler;uniform float limitVelocityDamping;\n#endif\n#ifdef DRAGGRADIENTS\nuniform sampler2D dragGradientSampler;\n#endif\n#ifdef NOISE\nuniform vec3 noiseStrength;uniform sampler2D noiseSampler;\n#endif\n#ifdef ANIMATESHEET\nuniform vec4 cellInfos;\n#endif\nvec3 getRandomVec3(float offset) {return texture(randomSampler2,vec2(float(gl_VertexID)*offset/currentCount,0)).rgb;}\nvec4 getRandomVec4(float offset) {return texture(randomSampler,vec2(float(gl_VertexID)*offset/currentCount,0));}\nvoid main() {float newAge=age+timeDelta; \nif (newAge>=life && stopFactor != 0.) {vec3 newPosition;vec3 newDirection;vec4 randoms=getRandomVec4(seed.x);outLife=lifeTime.x+(lifeTime.y-lifeTime.x)*randoms.r;outAge=newAge-life;outSeed=seed;\n#ifdef SIZEGRADIENTS \noutSize.x=texture(sizeGradientSampler,vec2(0,0)).r;\n#else\noutSize.x=sizeRange.x+(sizeRange.y-sizeRange.x)*randoms.g;\n#endif\noutSize.y=scaleRange.x+(scaleRange.y-scaleRange.x)*randoms.b;outSize.z=scaleRange.z+(scaleRange.w-scaleRange.z)*randoms.a; \n#ifndef COLORGRADIENTS\noutColor=color1+(color2-color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \noutAngle.y=angleRange.x+(angleRange.y-angleRange.x)*randoms.a;outAngle.x=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#else\noutAngle=angleRange.z+(angleRange.w-angleRange.z)*randoms.r;\n#endif \n#ifdef POINTEMITTER\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=vec3(0,0,0);newDirection=direction1+(direction2-direction1)*randoms3;\n#elif defined(BOXEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);newPosition=minEmitBox+(maxEmitBox-minEmitBox)*randoms2;newDirection=direction1+(direction2-direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,abs(randY),randZ);newDirection=newPosition+directionRandomizer*randoms3; \n#elif defined(SPHEREEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float phi=2.0*PI*randoms2.x;float theta=acos(2.0*randoms2.y-1.0);float randX=cos(phi)*sin(theta);float randY=cos(theta);float randZ=sin(phi)*sin(theta);newPosition=(radius-(radius*radiusRange*randoms2.z))*vec3(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(direction1+(direction2-direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nvec3 randoms2=getRandomVec3(seed.y);vec3 randoms3=getRandomVec3(seed.z);float yPos=(randoms2.x-0.5)*height;float angle=randoms2.y*PI*2.;float inverseRadiusRangeSquared=((1.-radiusRange)*(1.-radiusRange));float positionRadius=radius*sqrt(inverseRadiusRangeSquared+(randoms2.z*(1.-inverseRadiusRangeSquared)));float xPos=positionRadius*cos(angle);float zPos=positionRadius*sin(angle);newPosition=vec3(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nangle=angle+((randoms3.x-0.5)*PI)*directionRandomizer;newDirection=vec3(cos(angle),(randoms3.y-0.5)*directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nvec3 randoms2=getRandomVec3(seed.y);float s=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nfloat h=0.0001;\n#else\nfloat h=randoms2.y*height.y;h=1.-h*h; \n#endif\nfloat lRadius=radius.x-radius.x*randoms2.z*radius.y;lRadius=lRadius*h;float randX=lRadius*sin(s);float randZ=lRadius*cos(s);float randY=h *height.x;newPosition=vec3(randX,randY,randZ); \nvec3 randoms3=getRandomVec3(seed.z);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=direction1+(direction2-direction1)*randoms3;\n#else\nif (abs(cos(coneAngle))==1.0) {newDirection=vec3(0.,1.0,0.);} else {newDirection=normalize(newPosition+directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=initialPosition;outInitialPosition=initialPosition;\n#else \nnewPosition=vec3(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w)-vec3(0.5,0.5,0.5));\n#endif\nfloat power=emitPower.x+(emitPower.y-emitPower.x)*randoms.a;\n#ifdef LOCAL\noutPosition=newPosition;\n#else\noutPosition=(emitterWM*vec4(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#ifndef BILLBOARD \noutInitialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nvec3 initial=newDirection;\n#else \nvec3 initial=(emitterWM*vec4(newDirection,0.)).xyz;\n#endif\noutDirection=initial*power;\n#ifndef BILLBOARD \noutInitialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \noutCellIndex=cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\noutNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif\n} else {float directionScale=timeDelta;outAge=newAge;float ageGradient=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale*=texture(velocityGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale*=1.0-texture(dragGradientSampler,vec2(ageGradient,0)).r;\n#endif\n#if defined(CUSTOMEMITTER)\noutPosition=position+(direction-position)*ageGradient; \noutInitialPosition=initialPosition;\n#else\noutPosition=position+direction*directionScale;\n#endif\noutLife=life;outSeed=seed;\n#ifndef COLORGRADIENTS \noutColor=color;\n#endif\n#ifdef SIZEGRADIENTS\noutSize.x=texture(sizeGradientSampler,vec2(ageGradient,0)).r;outSize.yz=size.yz;\n#else\noutSize=size;\n#endif \n#ifndef BILLBOARD \noutInitialDirection=initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\noutDirection=direction;\n#else\nvec3 updatedDirection=direction+gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nfloat limitVelocity=texture(limitVelocityGradientSampler,vec2(ageGradient,0)).r;float currentVelocity=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*limitVelocityDamping;}\n#endif\noutDirection=updatedDirection;\n#ifdef NOISE\nfloat fetchedR=texture(noiseSampler,vec2(noiseCoordinates1.x,noiseCoordinates1.y)*vec2(0.5)+vec2(0.5)).r;float fetchedG=texture(noiseSampler,vec2(noiseCoordinates1.z,noiseCoordinates2.x)*vec2(0.5)+vec2(0.5)).r;float fetchedB=texture(noiseSampler,vec2(noiseCoordinates2.y,noiseCoordinates2.z)*vec2(0.5)+vec2(0.5)).r;vec3 force=vec3(2.*fetchedR-1.,2.*fetchedG-1.,2.*fetchedB-1.)*noiseStrength;outDirection=outDirection+force*timeDelta;outNoiseCoordinates1=noiseCoordinates1;outNoiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nfloat angularSpeed=texture(angularSpeedGradientSampler,vec2(ageGradient,0)).r;outAngle=angle+angularSpeed*timeDelta;\n#else\noutAngle=vec2(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nfloat offsetAge=outAge;float dist=cellInfos.y-cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\noutCellStartOffset=cellStartOffset;offsetAge+=cellStartOffset;\n#else\nfloat cellStartOffset=0.;\n#endif \nfloat ratio=0.;if (cellInfos.w==1.0) {ratio=clamp(mod(cellStartOffset+cellInfos.z*offsetAge,life)/life,0.,1.0);}\nelse {ratio=clamp(cellStartOffset+cellInfos.z*offsetAge/life,0.,1.0);}\noutCellIndex=float(int(cellInfos.x+ratio*dist));\n#endif\n}}";r.d.ShadersStore[v]=w;(0,F.e)("BABYLON.WebGL2ParticleSystem",class{constructor(K,b){this._renderVAO=[],this._updateVAO=[],this.alignDataInBuffer=!1,this._parent=K,this._engine=b,this._updateEffectOptions={attributes:["position","initialPosition","age","life","seed","size","color","direction","initialDirection","angle","cellIndex","cellStartOffset","noiseCoordinates1","noiseCoordinates2"],uniformsNames:["currentCount","timeDelta","emitterWM","lifeTime","color1","color2","sizeRange","scaleRange","gravity","emitPower","direction1","direction2","minEmitBox","maxEmitBox","radius","directionRandomizer","height","coneAngle","stopFactor","angleRange","radiusRange","cellInfos","noiseStrength","limitVelocityDamping"],uniformBuffersNames:[],samplers:["randomSampler","randomSampler2","sizeGradientSampler","angularSpeedGradientSampler","velocityGradientSampler","limitVelocityGradientSampler","noiseSampler","dragGradientSampler"],defines:"",fallbacks:null,onCompiled:null,onError:null,indexParameters:null,maxSimultaneousLights:0,transformFeedbackVaryings:[]}}contextLost(){this._updateEffect=void 0,this._renderVAO.length=0,this._updateVAO.length=0}isUpdateBufferCreated(){return!!this._updateEffect}isUpdateBufferReady(){var K;return(null===(K=this._updateEffect)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){return this._updateEffectOptions.transformFeedbackVaryings=["outPosition"],this._updateEffectOptions.transformFeedbackVaryings.push("outAge"),this._updateEffectOptions.transformFeedbackVaryings.push("outSize"),this._updateEffectOptions.transformFeedbackVaryings.push("outLife"),this._updateEffectOptions.transformFeedbackVaryings.push("outSeed"),this._updateEffectOptions.transformFeedbackVaryings.push("outDirection"),this._parent.particleEmitterType instanceof Q&&this._updateEffectOptions.transformFeedbackVaryings.push("outInitialPosition"),this._parent._colorGradientsTexture||this._updateEffectOptions.transformFeedbackVaryings.push("outColor"),this._parent._isBillboardBased||this._updateEffectOptions.transformFeedbackVaryings.push("outInitialDirection"),this._parent.noiseTexture&&(this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates1"),this._updateEffectOptions.transformFeedbackVaryings.push("outNoiseCoordinates2")),this._updateEffectOptions.transformFeedbackVaryings.push("outAngle"),this._parent.isAnimationSheetEnabled&&(this._updateEffectOptions.transformFeedbackVaryings.push("outCellIndex"),this._parent.spriteRandomStartCell&&this._updateEffectOptions.transformFeedbackVaryings.push("outCellStartOffset")),this._updateEffectOptions.defines=K,this._updateEffect=new S.d("gpuUpdateParticles",this._updateEffectOptions,this._engine),new M(this._updateEffect)}createVertexBuffers(K,b){this._updateVAO.push(this._createUpdateVAO(K)),this._renderVAO.push(this._engine.recordVertexArrayObject(b,null,this._parent._getWrapper(this._parent.blendMode).effect)),this._engine.bindArrayBuffer(null),this._renderVertexBuffers=b}createParticleBuffer(K){return K}bindDrawBuffers(K,b,e){e?this._engine.bindBuffers(this._renderVertexBuffers,e,b):this._engine.bindVertexArrayObject(this._renderVAO[K],null)}preUpdateParticleBuffer(){const K=this._engine;if(this._engine.enableEffect(this._updateEffect),!K.setState)throw new Error("GPU particles cannot work without a full Engine. ThinEngine is not supported")}updateParticleBuffer(K,b,e){this._updateEffect.setTexture("randomSampler",this._parent._randomTexture),this._updateEffect.setTexture("randomSampler2",this._parent._randomTexture2),this._parent._sizeGradientsTexture&&this._updateEffect.setTexture("sizeGradientSampler",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateEffect.setTexture("angularSpeedGradientSampler",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateEffect.setTexture("velocityGradientSampler",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateEffect.setTexture("limitVelocityGradientSampler",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateEffect.setTexture("dragGradientSampler",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateEffect.setTexture("noiseSampler",this._parent.noiseTexture),this._engine.bindVertexArrayObject(this._updateVAO[K],null);const z=this._engine;z.bindTransformFeedbackBuffer(b.getBuffer()),z.setRasterizerState(!1),z.beginTransformFeedback(!0),z.drawArraysType(3,0,e),z.endTransformFeedback(),z.setRasterizerState(!0),z.bindTransformFeedbackBuffer(null)}releaseBuffers(){}releaseVertexBuffers(){for(let K=0;K<this._updateVAO.length;K++)this._engine.releaseVertexArrayObject(this._updateVAO[K]);this._updateVAO.length=0;for(let K=0;K<this._renderVAO.length;K++)this._engine.releaseVertexArrayObject(this._renderVAO[K]);this._renderVAO.length=0}_createUpdateVAO(K){const b={};b.position=K.createVertexBuffer("position",0,3);let e=3;b.age=K.createVertexBuffer("age",e,1),e+=1,b.size=K.createVertexBuffer("size",e,3),e+=3,b.life=K.createVertexBuffer("life",e,1),e+=1,b.seed=K.createVertexBuffer("seed",e,4),e+=4,b.direction=K.createVertexBuffer("direction",e,3),e+=3,this._parent.particleEmitterType instanceof Q&&(b.initialPosition=K.createVertexBuffer("initialPosition",e,3),e+=3),this._parent._colorGradientsTexture||(b.color=K.createVertexBuffer("color",e,4),e+=4),this._parent._isBillboardBased||(b.initialDirection=K.createVertexBuffer("initialDirection",e,3),e+=3),this._parent.noiseTexture&&(b.noiseCoordinates1=K.createVertexBuffer("noiseCoordinates1",e,3),e+=3,b.noiseCoordinates2=K.createVertexBuffer("noiseCoordinates2",e,3),e+=3),this._parent._angularSpeedGradientsTexture?(b.angle=K.createVertexBuffer("angle",e,1),e+=1):(b.angle=K.createVertexBuffer("angle",e,2),e+=2),this._parent._isAnimationSheetEnabled&&(b.cellIndex=K.createVertexBuffer("cellIndex",e,1),e+=1,this._parent.spriteRandomStartCell&&(b.cellStartOffset=K.createVertexBuffer("cellStartOffset",e,1),e+=1));const z=this._engine.recordVertexArrayObject(b,null,this._updateEffect);return this._engine.bindArrayBuffer(null),z}});class h{constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,z=arguments.length>3?arguments[3]:void 0;this._engine=K,this._label=z,this._engine._storageBuffers.push(this),this._create(b,e)}_create(K,b){this._bufferSize=K,this._creationFlags=b,this._buffer=this._engine.createStorageBuffer(K,b,this._label)}_rebuild(){this._create(this._bufferSize,this._creationFlags)}getBuffer(){return this._buffer}update(K,b,e){this._buffer&&this._engine.updateStorageBuffer(this._buffer,K,b,e)}read(K,b,e,z){return this._engine.readFromStorageBuffer(this._buffer,K,b,e,z)}dispose(){const K=this._engine._storageBuffers,b=K.indexOf(this);-1!==b&&(K[b]=K[K.length-1],K.pop()),this._engine._releaseBuffer(this._buffer),this._buffer=null}}var R=e(10936),n=e(10938),P=e(11001),d=e(11161),p=e(11070),a=e(10696),O=e(10785),g=e(10810);class N{constructor(){this._gpuTimeInFrameId=-1,this.counter=new g.e}_addDuration(K,b){K<this._gpuTimeInFrameId||(this._gpuTimeInFrameId!==K?(this.counter._fetchResult(),this.counter.fetchNewFrame(),this.counter.addCount(b,!1),this._gpuTimeInFrameId=K):this.counter.addCount(b,!1))}}class Z{get options(){return this._options}get shaderPath(){return this._shaderPath}constructor(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._bindings={},this._samplers={},this._contextIsDirty=!1,this.fastMode=!1,this.onCompiled=null,this.onError=null,this.name=K,this._engine=b,this.uniqueId=p.d.UniqueId,b.enableGPUTimingMeasurements&&(this.gpuTimeInFrame=new N),this._engine.getCaps().supportComputeShaders?z.bindingsMapping?(this._context=b.createComputeContext(),this._shaderPath=e,this._options={bindingsMapping:{},defines:[],...z}):a.b.Error("You must provide the binding mappings as browsers don't support reflection for wgsl shaders yet!"):a.b.Error("This engine does not support compute shaders!")}getClassName(){return"ComputeShader"}setTexture(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const z=this._bindings[K];this._bindings[K]={type:e?0:4,object:b,indexInGroupEntries:null===z||void 0===z?void 0:z.indexInGroupEntries},this._contextIsDirty||(this._contextIsDirty=!z||z.object!==b||z.type!==this._bindings[K].type)}setStorageTexture(K,b){const e=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==b),this._bindings[K]={type:1,object:b,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setExternalTexture(K,b){const e=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==b),this._bindings[K]={type:6,object:b,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setVideoTexture(K,b){return!!b.externalTexture&&(this.setExternalTexture(K,b.externalTexture),!0)}setUniformBuffer(K,b){const e=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==b),this._bindings[K]={type:Z._BufferIsDataBuffer(b)?7:2,object:b,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setStorageBuffer(K,b){const e=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!e||e.object!==b),this._bindings[K]={type:Z._BufferIsDataBuffer(b)?7:3,object:b,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}setTextureSampler(K,b){const e=this._bindings[K];this._contextIsDirty||(this._contextIsDirty=!e||!b.compareSampler(e.object)),this._bindings[K]={type:5,object:b,indexInGroupEntries:null===e||void 0===e?void 0:e.indexInGroupEntries}}isReady(){let K=this._effect;for(const k in this._bindings){const K=this._bindings[k],b=K.type,e=K.object;switch(b){case 0:case 4:case 1:if(!e.isReady())return!1;break;case 6:if(!e.isReady())return!1;break}}const b=[],e=this._shaderPath;if(this._options.defines)for(let k=0;k<this._options.defines.length;k++)b.push(this._options.defines[k]);const z=b.join("\n");return this._cachedDefines!==z&&(this._cachedDefines=z,K=this._engine.createComputeEffect(e,{defines:z,entryPoint:this._options.entryPoint,onCompiled:this.onCompiled,onError:this.onError}),this._effect=K),!!K.isReady()}dispatch(K,b,e){return!(!this.fastMode&&!this._checkContext())&&(this._engine.computeDispatch(this._effect,this._context,this._bindings,K,b,e,this._options.bindingsMapping,this.gpuTimeInFrame),!0)}dispatchIndirect(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.fastMode&&!this._checkContext())return!1;const e=Z._BufferIsDataBuffer(K)?K:K.getBuffer();return this._engine.computeDispatchIndirect(this._effect,this._context,this._bindings,e,b,this._options.bindingsMapping,this.gpuTimeInFrame),!0}_checkContext(){if(!this.isReady())return!1;for(const b in this._bindings){const e=this._bindings[b];if(!this._options.bindingsMapping[b])throw new Error("ComputeShader ('"+this.name+"'): No binding mapping has been provided for the property '"+b+"'");switch(e.type){case 0:{const z=this._samplers[b],k=e.object;var K;if(!z||!k._texture||!z.compareSampler(k._texture))this._samplers[b]=(new O.b).setParameters(k.wrapU,k.wrapV,k.wrapR,k.anisotropicFilteringLevel,k._texture.samplingMode,null===(K=k._texture)||void 0===K?void 0:K._comparisonFunction),this._contextIsDirty=!0;break}case 6:this._contextIsDirty=!0;break;case 2:{const K=e.object;K.getBuffer()!==e.buffer&&(e.buffer=K.getBuffer(),this._contextIsDirty=!0);break}}}return this._contextIsDirty&&(this._contextIsDirty=!1,this._context.clear()),!0}dispatchWhenReady(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return new Promise((k=>{const j=()=>{this.dispatch(K,b,e)?k():setTimeout(j,z)};j()}))}serialize(){const K=P.e.Serialize(this);K.options=this._options,K.shaderPath=this._shaderPath,K.gj={},K.textures={};for(const b in this._bindings){const e=this._bindings[b],z=e.object;switch(e.type){case 0:case 4:case 1:{const k=z.serialize();k&&(K.textures[b]=k,K.gj[b]={type:e.type});break}}}return K}static Parse(K,b,e){const z=P.e.Parse((()=>new Z(K.name,b.getEngine(),K.shaderPath,K.options)),K,b,e);for(const k in K.textures){const j=K.gj[k],T=d.c.Parse(K.textures[k],b,e);0===j.type?z.setTexture(k,T):4===j.type?z.setTexture(k,T,!1):z.setStorageTexture(k,T)}return z}static _BufferIsDataBuffer(K){return void 0!==K.underlyingResource}}(0,R.b)([(0,n.M)()],Z.prototype,"name",void 0),(0,R.b)([(0,n.M)()],Z.prototype,"fastMode",void 0),(0,F.e)("BABYLON.ComputeShader",Z);var y=e(11017);const s="gpuUpdateParticlesComputeShader",E="struct Particle {position : vec3<f32>,\nage : f32,\nsize : vec3<f32>,\nlife : f32,\nseed : vec4<f32>,\ndirection : vec3<f32>,\ndummy0: f32,\n#ifdef CUSTOMEMITTER\ninitialPosition : vec3<f32>,\ndummy1: f32,\n#endif\n#ifndef COLORGRADIENTS\ncolor : vec4<f32>,\n#endif\n#ifndef BILLBOARD\ninitialDirection : vec3<f32>,\ndummy2: f32,\n#endif\n#ifdef NOISE\nnoiseCoordinates1 : vec3<f32>,\ndummy3: f32,\nnoiseCoordinates2 : vec3<f32>,\ndummy4: f32,\n#endif\n#ifdef ANGULARSPEEDGRADIENTS\nangle : f32,\n#else\nangle : vec2<f32>,\n#endif\n#ifdef ANIMATESHEET\ncellIndex : f32,\n#ifdef ANIMATESHEETRANDOMSTART\ncellStartOffset : f32,\n#endif\n#endif\n};struct Particles {particles : array<Particle>,};struct SimParams {currentCount : f32,\ntimeDelta : f32,\nstopFactor : f32,\nrandomTextureSize: i32,\nlifeTime : vec2<f32>,\nemitPower : vec2<f32>,\n#ifndef COLORGRADIENTS\ncolor1 : vec4<f32>,\ncolor2 : vec4<f32>,\n#endif\nsizeRange : vec2<f32>,\nscaleRange : vec4<f32>,\nangleRange : vec4<f32>,\ngravity : vec3<f32>,\n#ifdef LIMITVELOCITYGRADIENTS\nlimitVelocityDamping : f32,\n#endif\n#ifdef ANIMATESHEET\ncellInfos : vec4<f32>,\n#endif\n#ifdef NOISE\nnoiseStrength : vec3<f32>,\n#endif\n#ifndef LOCAL\nemitterWM : mat4x4<f32>,\n#endif\n#ifdef BOXEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\nminEmitBox : vec3<f32>,\nmaxEmitBox : vec3<f32>,\n#endif\n#ifdef CONEEMITTER\nradius : vec2<f32>,\nconeAngle : f32,\nheight : vec2<f32>,\n#ifdef DIRECTEDCONEEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef CYLINDEREMITTER\nradius : f32,\nheight : f32,\nradiusRange : f32,\n#ifdef DIRECTEDCYLINDEREMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n#ifdef HEMISPHERICEMITTER\nradius : f32,\nradiusRange : f32,\ndirectionRandomizer : f32,\n#endif\n#ifdef POINTEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#endif\n#ifdef SPHEREEMITTER\nradius : f32,\nradiusRange : f32,\n#ifdef DIRECTEDSPHEREEMITTER\ndirection1 : vec3<f32>,\ndirection2 : vec3<f32>,\n#else\ndirectionRandomizer : f32,\n#endif\n#endif\n};@binding(0) @group(0) var<uniform> params : SimParams;@binding(1) @group(0) var<storage,read> particlesIn : Particles;@binding(2) @group(0) var<storage,read_write> particlesOut : Particles;@binding(3) @group(0) var randomTexture : texture_2d<f32>;@binding(4) @group(0) var randomTexture2 : texture_2d<f32>;\n#ifdef SIZEGRADIENTS\n@binding(0) @group(1) var sizeGradientSampler : sampler;@binding(1) @group(1) var sizeGradientTexture : texture_2d<f32>;\n#endif \n#ifdef ANGULARSPEEDGRADIENTS\n@binding(2) @group(1) var angularSpeedGradientSampler : sampler;@binding(3) @group(1) var angularSpeedGradientTexture : texture_2d<f32>;\n#endif \n#ifdef VELOCITYGRADIENTS\n@binding(4) @group(1) var velocityGradientSampler : sampler;@binding(5) @group(1) var velocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef LIMITVELOCITYGRADIENTS\n@binding(6) @group(1) var limitVelocityGradientSampler : sampler;@binding(7) @group(1) var limitVelocityGradientTexture : texture_2d<f32>;\n#endif\n#ifdef DRAGGRADIENTS\n@binding(8) @group(1) var dragGradientSampler : sampler;@binding(9) @group(1) var dragGradientTexture : texture_2d<f32>;\n#endif\n#ifdef NOISE\n@binding(10) @group(1) var noiseSampler : sampler;@binding(11) @group(1) var noiseTexture : texture_2d<f32>;\n#endif\nfn getRandomVec3(offset : f32,vertexID : f32)->vec3<f32> {return textureLoad(randomTexture2,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0).rgb;}\nfn getRandomVec4(offset : f32,vertexID : f32)->vec4<f32> {return textureLoad(randomTexture,vec2<i32>(i32(vertexID*offset/params.currentCount*f32(params.randomTextureSize)) % params.randomTextureSize,0),0);}\n@compute @workgroup_size(64)\nfn main(@builtin(global_invocation_id) GlobalInvocationID : vec3<u32>) {let index : u32=GlobalInvocationID.x;let vertexID : f32=f32(index);if (index>=u32(params.currentCount)) {return;}\nlet PI : f32=3.14159;let timeDelta : f32=params.timeDelta;let newAge : f32=particlesIn.particles[index].age+timeDelta;let life : f32=particlesIn.particles[index].life;let seed : vec4<f32>=particlesIn.particles[index].seed;let direction : vec3<f32>=particlesIn.particles[index].direction;if (newAge>=life && params.stopFactor != 0.) {var newPosition : vec3<f32>;var newDirection : vec3<f32>;let randoms : vec4<f32>=getRandomVec4(seed.x,vertexID);let outLife : f32=params.lifeTime.x+(params.lifeTime.y-params.lifeTime.x)*randoms.r;particlesOut.particles[index].life=outLife;particlesOut.particles[index].age=newAge-life;particlesOut.particles[index].seed=seed;var sizex : f32;\n#ifdef SIZEGRADIENTS \nsizex=textureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(0.,0.),0.).r;\n#else\nsizex=params.sizeRange.x+(params.sizeRange.y-params.sizeRange.x)*randoms.g;\n#endif\nparticlesOut.particles[index].size=vec3<f32>(\nsizex,\nparams.scaleRange.x+(params.scaleRange.y-params.scaleRange.x)*randoms.b,\nparams.scaleRange.z+(params.scaleRange.w-params.scaleRange.z)*randoms.a);\n#ifndef COLORGRADIENTS\nparticlesOut.particles[index].color=params.color1+(params.color2-params.color1)*randoms.b;\n#endif\n#ifndef ANGULARSPEEDGRADIENTS \nparticlesOut.particles[index].angle=vec2<f32>(\nparams.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r,\nparams.angleRange.x+(params.angleRange.y-params.angleRange.x)*randoms.a);\n#else\nparticlesOut.particles[index].angle=params.angleRange.z+(params.angleRange.w-params.angleRange.z)*randoms.r;\n#endif \n#if defined(POINTEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=vec3<f32>(0.,0.,0.);newDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#elif defined(BOXEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);newPosition=params.minEmitBox+(params.maxEmitBox-params.minEmitBox)*randoms2;newDirection=params.direction1+(params.direction2-params.direction1)*randoms3; \n#elif defined(HEMISPHERICEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,abs(randY),randZ);newDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#elif defined(SPHEREEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let phi : f32=2.0*PI*randoms2.x;let theta : f32=acos(-1.0+2.0*randoms2.y);let randX : f32=cos(phi)*sin(theta);let randY : f32=cos(theta);let randZ : f32=sin(phi)*sin(theta);newPosition=(params.radius-(params.radius*params.radiusRange*randoms2.z))*vec3<f32>(randX,randY,randZ);\n#ifdef DIRECTEDSPHEREEMITTER\nnewDirection=normalize(params.direction1+(params.direction2-params.direction1)*randoms3);\n#else\nnewDirection=normalize(newPosition+params.directionRandomizer*randoms3);\n#endif\n#elif defined(CYLINDEREMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);let yPos : f32=(-0.5+randoms2.x)*params.height;var angle : f32=randoms2.y*PI*2.;let inverseRadiusRangeSquared : f32=(1.-params.radiusRange)*(1.-params.radiusRange);let positionRadius : f32=params.radius*sqrt(inverseRadiusRangeSquared+randoms2.z*(1.-inverseRadiusRangeSquared));let xPos : f32=positionRadius*cos(angle);let zPos : f32=positionRadius*sin(angle);newPosition=vec3<f32>(xPos,yPos,zPos);\n#ifdef DIRECTEDCYLINDEREMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nangle=angle+(-0.5+randoms3.x)*PI*params.directionRandomizer;newDirection=vec3<f32>(cos(angle),(-0.5+randoms3.y)*params.directionRandomizer,sin(angle));newDirection=normalize(newDirection);\n#endif\n#elif defined(CONEEMITTER)\nlet randoms2 : vec3<f32>=getRandomVec3(seed.y,vertexID);let s : f32=2.0*PI*randoms2.x;\n#ifdef CONEEMITTERSPAWNPOINT\nlet h : f32=0.0001;\n#else\nvar h : f32=randoms2.y*params.height.y;h=1.-h*h; \n#endif\nvar lRadius : f32=params.radius.x-params.radius.x*randoms2.z*params.radius.y;lRadius=lRadius*h;let randX : f32=lRadius*sin(s);let randZ : f32=lRadius*cos(s);let randY : f32=h *params.height.x;newPosition=vec3<f32>(randX,randY,randZ); \nlet randoms3 : vec3<f32>=getRandomVec3(seed.z,vertexID);\n#ifdef DIRECTEDCONEEMITTER\nnewDirection=params.direction1+(params.direction2-params.direction1)*randoms3;\n#else\nif (abs(cos(params.coneAngle))==1.0) {newDirection=vec3<f32>(0.,1.0,0.);} else {newDirection=normalize(newPosition+params.directionRandomizer*randoms3); }\n#endif\n#elif defined(CUSTOMEMITTER)\nnewPosition=particlesIn.particles[index].initialPosition;particlesOut.particles[index].initialPosition=newPosition;\n#else \nnewPosition=vec3<f32>(0.,0.,0.);newDirection=2.0*(getRandomVec3(seed.w,vertexID)-vec3<f32>(0.5,0.5,0.5));\n#endif\nlet power : f32=params.emitPower.x+(params.emitPower.y-params.emitPower.x)*randoms.a;\n#ifdef LOCAL\nparticlesOut.particles[index].position=newPosition;\n#else\nparticlesOut.particles[index].position=(params.emitterWM*vec4<f32>(newPosition,1.)).xyz;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=direction;\n#endif\n#else\n#ifdef LOCAL\nlet initial : vec3<f32>=newDirection;\n#else \nlet initial : vec3<f32>=(params.emitterWM*vec4<f32>(newDirection,0.)).xyz;\n#endif\nparticlesOut.particles[index].direction=initial*power;\n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=initial;\n#endif\n#endif\n#ifdef ANIMATESHEET \nparticlesOut.particles[index].cellIndex=params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nparticlesOut.particles[index].cellStartOffset=randoms.a*outLife;\n#endif \n#endif\n#ifdef NOISE\nparticlesOut.particles[index].noiseCoordinates1=particlesIn.particles[index].noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=particlesIn.particles[index].noiseCoordinates2;\n#endif\n} else {var directionScale : f32=timeDelta;particlesOut.particles[index].age=newAge;let ageGradient : f32=newAge/life;\n#ifdef VELOCITYGRADIENTS\ndirectionScale=directionScale*textureSampleLevel(velocityGradientTexture,velocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;\n#endif\n#ifdef DRAGGRADIENTS\ndirectionScale=directionScale*(1.0-textureSampleLevel(dragGradientTexture,dragGradientSampler,vec2<f32>(ageGradient,0.),0.).r);\n#endif\nlet position : vec3<f32>=particlesIn.particles[index].position;\n#if defined(CUSTOMEMITTER)\nparticlesOut.particles[index].position=position+(direction-position)*ageGradient; \nparticlesOut.particles[index].initialPosition=particlesIn.particles[index].initialPosition;\n#else\nparticlesOut.particles[index].position=position+direction*directionScale;\n#endif\nparticlesOut.particles[index].life=life;particlesOut.particles[index].seed=seed;\n#ifndef COLORGRADIENTS \nparticlesOut.particles[index].color=particlesIn.particles[index].color;\n#endif\n#ifdef SIZEGRADIENTS\nparticlesOut.particles[index].size=vec3<f32>(\ntextureSampleLevel(sizeGradientTexture,sizeGradientSampler,vec2<f32>(ageGradient,0.),0.).r,\nparticlesIn.particles[index].size.yz);\n#else\nparticlesOut.particles[index].size=particlesIn.particles[index].size;\n#endif \n#ifndef BILLBOARD \nparticlesOut.particles[index].initialDirection=particlesIn.particles[index].initialDirection;\n#endif\n#ifdef CUSTOMEMITTER\nparticlesOut.particles[index].direction=direction;\n#else\nvar updatedDirection : vec3<f32>=direction+params.gravity*timeDelta;\n#ifdef LIMITVELOCITYGRADIENTS\nlet limitVelocity : f32=textureSampleLevel(limitVelocityGradientTexture,limitVelocityGradientSampler,vec2<f32>(ageGradient,0.),0.).r;let currentVelocity : f32=length(updatedDirection);if (currentVelocity>limitVelocity) {updatedDirection=updatedDirection*params.limitVelocityDamping;}\n#endif\nparticlesOut.particles[index].direction=updatedDirection;\n#ifdef NOISE\nlet noiseCoordinates1 : vec3<f32>=particlesIn.particles[index].noiseCoordinates1;let noiseCoordinates2 : vec3<f32>=particlesIn.particles[index].noiseCoordinates2;let fetchedR : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.x,noiseCoordinates1.y)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedG : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates1.z,noiseCoordinates2.x)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let fetchedB : f32=textureSampleLevel(noiseTexture,noiseSampler,vec2<f32>(noiseCoordinates2.y,noiseCoordinates2.z)*vec2<f32>(0.5,0.5)+vec2<f32>(0.5,0.5),0.).r;let force : vec3<f32>=vec3<f32>(-1.+2.*fetchedR,-1.+2.*fetchedG,-1.+2.*fetchedB)*params.noiseStrength;particlesOut.particles[index].direction=particlesOut.particles[index].direction+force*timeDelta;particlesOut.particles[index].noiseCoordinates1=noiseCoordinates1;particlesOut.particles[index].noiseCoordinates2=noiseCoordinates2;\n#endif \n#endif \n#ifdef ANGULARSPEEDGRADIENTS\nlet angularSpeed : f32=textureSampleLevel(angularSpeedGradientTexture,angularSpeedGradientSampler,vec2<f32>(ageGradient,0.),0.).r;particlesOut.particles[index].angle=particlesIn.particles[index].angle+angularSpeed*timeDelta;\n#else\nlet angle : vec2<f32>=particlesIn.particles[index].angle;particlesOut.particles[index].angle=vec2<f32>(angle.x+angle.y*timeDelta,angle.y);\n#endif\n#ifdef ANIMATESHEET \nvar offsetAge : f32=particlesOut.particles[index].age;let dist : f32=params.cellInfos.y-params.cellInfos.x;\n#ifdef ANIMATESHEETRANDOMSTART\nlet cellStartOffset : f32=particlesIn.particles[index].cellStartOffset;particlesOut.particles[index].cellStartOffset=cellStartOffset;offsetAge=offsetAge+cellStartOffset;\n#else\nlet cellStartOffset : f32=0.;\n#endif \nvar ratio : f32;if (params.cellInfos.w==1.0) {ratio=clamp(((cellStartOffset+params.cellInfos.z*offsetAge) % life)/life,0.,1.0);}\nelse {ratio=clamp((cellStartOffset+params.cellInfos.z*offsetAge)/life,0.,1.0);}\nparticlesOut.particles[index].cellIndex=f32(i32(params.cellInfos.x+ratio*dist));\n#endif\n}}\n";r.d.ShadersStoreWGSL[s]=E;(0,F.e)("BABYLON.ComputeShaderParticleSystem",class{constructor(K,b){this._bufferComputeShader=[],this._renderVertexBuffers=[],this.alignDataInBuffer=!0,this._parent=K,this._engine=b}contextLost(){this._updateComputeShader=void 0,this._bufferComputeShader.length=0,this._renderVertexBuffers.length=0}isUpdateBufferCreated(){return!!this._updateComputeShader}isUpdateBufferReady(){var K;return(null===(K=this._updateComputeShader)||void 0===K?void 0:K.isReady())??!1}createUpdateBuffer(K){var b;const e={params:{group:0,binding:0},particlesIn:{group:0,binding:1},particlesOut:{group:0,binding:2},randomTexture:{group:0,binding:3},randomTexture2:{group:0,binding:4}};return this._parent._sizeGradientsTexture&&(e.sizeGradientTexture={group:1,binding:1}),this._parent._angularSpeedGradientsTexture&&(e.angularSpeedGradientTexture={group:1,binding:3}),this._parent._velocityGradientsTexture&&(e.velocityGradientTexture={group:1,binding:5}),this._parent._limitVelocityGradientsTexture&&(e.limitVelocityGradientTexture={group:1,binding:7}),this._parent._dragGradientsTexture&&(e.dragGradientTexture={group:1,binding:9}),this._parent.noiseTexture&&(e.noiseTexture={group:1,binding:11}),this._updateComputeShader=new Z("updateParticles",this._engine,"gpuUpdateParticles",{bindingsMapping:e,defines:K.split("\n")}),null===(b=this._simParamsComputeShader)||void 0===b||b.dispose(),this._simParamsComputeShader=new y.d(this._engine,void 0,void 0,"ComputeShaderParticleSystemUBO"),this._simParamsComputeShader.addUniform("currentCount",1),this._simParamsComputeShader.addUniform("timeDelta",1),this._simParamsComputeShader.addUniform("stopFactor",1),this._simParamsComputeShader.addUniform("randomTextureSize",1),this._simParamsComputeShader.addUniform("lifeTime",2),this._simParamsComputeShader.addUniform("emitPower",2),this._parent._colorGradientsTexture||(this._simParamsComputeShader.addUniform("color1",4),this._simParamsComputeShader.addUniform("color2",4)),this._simParamsComputeShader.addUniform("sizeRange",2),this._simParamsComputeShader.addUniform("scaleRange",4),this._simParamsComputeShader.addUniform("angleRange",4),this._simParamsComputeShader.addUniform("gravity",3),this._parent._limitVelocityGradientsTexture&&this._simParamsComputeShader.addUniform("limitVelocityDamping",1),this._parent.isAnimationSheetEnabled&&this._simParamsComputeShader.addUniform("cellInfos",4),this._parent.noiseTexture&&this._simParamsComputeShader.addUniform("noiseStrength",3),this._parent.isLocal||this._simParamsComputeShader.addUniform("emitterWM",16),this._parent.particleEmitterType&&this._parent.particleEmitterType.buildUniformLayout(this._simParamsComputeShader),this._updateComputeShader.setUniformBuffer("params",this._simParamsComputeShader),new M(this._simParamsComputeShader)}createVertexBuffers(K,b){this._renderVertexBuffers.push(b)}createParticleBuffer(K){const b=new h(this._engine,4*K.length,11,"ComputeShaderParticleSystemBuffer");return b.update(K),this._bufferComputeShader.push(b),b.getBuffer()}bindDrawBuffers(K,b,e){this._engine.bindBuffers(this._renderVertexBuffers[K],e,b)}preUpdateParticleBuffer(){}updateParticleBuffer(K,b,e){this._simParamsComputeShader.update(),this._updateComputeShader.setTexture("randomTexture",this._parent._randomTexture,!1),this._updateComputeShader.setTexture("randomTexture2",this._parent._randomTexture2,!1),this._parent._sizeGradientsTexture&&this._updateComputeShader.setTexture("sizeGradientTexture",this._parent._sizeGradientsTexture),this._parent._angularSpeedGradientsTexture&&this._updateComputeShader.setTexture("angularSpeedGradientTexture",this._parent._angularSpeedGradientsTexture),this._parent._velocityGradientsTexture&&this._updateComputeShader.setTexture("velocityGradientTexture",this._parent._velocityGradientsTexture),this._parent._limitVelocityGradientsTexture&&this._updateComputeShader.setTexture("limitVelocityGradientTexture",this._parent._limitVelocityGradientsTexture),this._parent._dragGradientsTexture&&this._updateComputeShader.setTexture("dragGradientTexture",this._parent._dragGradientsTexture),this._parent.noiseTexture&&this._updateComputeShader.setTexture("noiseTexture",this._parent.noiseTexture),this._updateComputeShader.setStorageBuffer("particlesIn",this._bufferComputeShader[K]),this._updateComputeShader.setStorageBuffer("particlesOut",this._bufferComputeShader[1^K]),this._updateComputeShader.dispatch(Math.ceil(e/64))}releaseBuffers(){var K;for(let b=0;b<this._bufferComputeShader.length;++b)this._bufferComputeShader[b].dispose();this._bufferComputeShader.length=0,null===(K=this._simParamsComputeShader)||void 0===K||K.dispose(),this._simParamsComputeShader=null,this._updateComputeShader=null}releaseVertexBuffers(){this._renderVertexBuffers.length=0}});class o{constructor(K,b,e){this.gradient=K,this.color1=b,this.color2=e}getColorToRef(K){this.color2?T.g.LerpToRef(this.color1,this.color2,Math.random(),K):K.p(this.color1)}}class C{constructor(K,b){this.gradient=K,this.color=b}}class H{constructor(K,b,e){this.gradient=K,this.factor1=b,this.factor2=e}getFactor(){return void 0===this.factor2||this.factor2===this.factor1?this.factor1:this.factor1+(this.factor2-this.factor1)*Math.random()}}class W{static GetCurrentGradient(K,b,e){if(b[0].gradient>K)return void e(b[0],b[0],1);for(let k=0;k<b.length-1;k++){const z=b[k],j=b[k+1];if(K>=z.gradient&&K<=j.gradient){return void e(z,j,(K-z.gradient)/(j.gradient-z.gradient))}}const z=b.length-1;e(b[z],b[z],1)}}var f=e(10690),V=e(11440),q=e(10720);class J{constructor(K){this.particleSystem=K,this.position=z.k.Zero(),this.direction=z.k.Zero(),this.color=new T.g(0,0,0,0),this.colorStep=new T.g(0,0,0,0),this.lifeTime=1,this.age=0,this.size=0,this.scale=new z.h(1,1),this.angle=0,this.angularSpeed=0,this.cellIndex=0,this._attachedSubEmitters=null,this._currentColor1=new T.g(0,0,0,0),this._currentColor2=new T.g(0,0,0,0),this._currentSize1=0,this._currentSize2=0,this._currentAngularSpeed1=0,this._currentAngularSpeed2=0,this._currentVelocity1=0,this._currentVelocity2=0,this._currentLimitVelocity1=0,this._currentLimitVelocity2=0,this._currentDrag1=0,this._currentDrag2=0,this.id=J._Count++,this.particleSystem.isAnimationSheetEnabled&&this._updateCellInfoFromSystem()}_updateCellInfoFromSystem(){this.cellIndex=this.particleSystem.startSpriteCellID}updateCellIndex(){let K=this.age,b=this.particleSystem.spriteCellChangeSpeed;this.particleSystem.spriteRandomStartCell&&(void 0===this._randomCellOffset&&(this._randomCellOffset=Math.random()*this.lifeTime),0===b?(b=1,K=this._randomCellOffset):K+=this._randomCellOffset);const e=this._initialEndSpriteCellID-this._initialStartSpriteCellID+1;let z;z=this._initialSpriteCellLoop?(0,Y.e)(K*b%this.lifeTime/this.lifeTime):(0,Y.e)(K*b/this.lifeTime),this.cellIndex=this._initialStartSpriteCellID+z*e|0}_inheritParticleInfoToSubEmitter(K){if(K.particleSystem.j.position){const b=K.particleSystem.j;if(b.position.p(this.position),K.inheritDirection){const K=z.e.gb[0];this.direction.normalizeToRef(K),b.setDirection(K,0,Math.PI/2)}}else{K.particleSystem.j.p(this.position)}this.direction.scaleToRef(K.inheritedVelocityAmount/2,z.e.gb[0]),K.particleSystem._inheritedVelocityOffset.p(z.e.gb[0])}_inheritParticleInfoToSubEmitters(){this._attachedSubEmitters&&this._attachedSubEmitters.length>0&&this._attachedSubEmitters.forEach((K=>{this._inheritParticleInfoToSubEmitter(K)}))}_reset(){this.age=0,this.id=J._Count++,this._currentColorGradient=null,this._currentSizeGradient=null,this._currentAngularSpeedGradient=null,this._currentVelocityGradient=null,this._currentLimitVelocityGradient=null,this._currentDragGradient=null,this.cellIndex=this.particleSystem.startSpriteCellID,this._randomCellOffset=void 0}copyTo(K){K.position.p(this.position),this._initialDirection?K._initialDirection?K._initialDirection.p(this._initialDirection):K._initialDirection=this._initialDirection.clone():K._initialDirection=null,K.direction.p(this.direction),this.Ud&&(K.Ud?K.Ud.p(this.Ud):K.Ud=this.Ud.clone()),K.color.p(this.color),K.colorStep.p(this.colorStep),K.lifeTime=this.lifeTime,K.age=this.age,K._randomCellOffset=this._randomCellOffset,K.size=this.size,K.scale.p(this.scale),K.angle=this.angle,K.angularSpeed=this.angularSpeed,K.particleSystem=this.particleSystem,K.cellIndex=this.cellIndex,K.id=this.id,K._attachedSubEmitters=this._attachedSubEmitters,this._currentColorGradient&&(K._currentColorGradient=this._currentColorGradient,K._currentColor1.p(this._currentColor1),K._currentColor2.p(this._currentColor2)),this._currentSizeGradient&&(K._currentSizeGradient=this._currentSizeGradient,K._currentSize1=this._currentSize1,K._currentSize2=this._currentSize2),this._currentAngularSpeedGradient&&(K._currentAngularSpeedGradient=this._currentAngularSpeedGradient,K._currentAngularSpeed1=this._currentAngularSpeed1,K._currentAngularSpeed2=this._currentAngularSpeed2),this._currentVelocityGradient&&(K._currentVelocityGradient=this._currentVelocityGradient,K._currentVelocity1=this._currentVelocity1,K._currentVelocity2=this._currentVelocity2),this._currentLimitVelocityGradient&&(K._currentLimitVelocityGradient=this._currentLimitVelocityGradient,K._currentLimitVelocity1=this._currentLimitVelocity1,K._currentLimitVelocity2=this._currentLimitVelocity2),this._currentDragGradient&&(K._currentDragGradient=this._currentDragGradient,K._currentDrag1=this._currentDrag1,K._currentDrag2=this._currentDrag2),this.particleSystem.isAnimationSheetEnabled&&(K._initialStartSpriteCellID=this._initialStartSpriteCellID,K._initialEndSpriteCellID=this._initialEndSpriteCellID,K._initialSpriteCellLoop=this._initialSpriteCellLoop),this.particleSystem.useRampGradients&&(K.remapData&&this.remapData?K.remapData.p(this.remapData):K.remapData=new z.o(0,0,0,0)),this._randomNoiseCoordinates1&&(K._randomNoiseCoordinates1?(K._randomNoiseCoordinates1.p(this._randomNoiseCoordinates1),K._randomNoiseCoordinates2.p(this._randomNoiseCoordinates2)):(K._randomNoiseCoordinates1=this._randomNoiseCoordinates1.clone(),K._randomNoiseCoordinates2=this._randomNoiseCoordinates2.clone()))}}J._Count=0;var KK=e(11125),bK=(e(11447),e(11138)),eK=e(11129),zK=e(11010);class kK extends l{set onDispose(K){this._onDisposeObserver&&this.Ui.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ui.add(K)}get useRampGradients(){return this._useRampGradients}set useRampGradients(K){this._useRampGradients!==K&&(this._useRampGradients=K,this._resetEffect())}get particles(){return this.bj}get shaderLanguage(){return this._shaderLanguage}getActiveCount(){return this.bj.length}getClassName(){return"tb"}isStopping(){return this._stopped&&this.isAlive()}getCustomEffect(){var K;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[b])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new KK.b(this._engine),this._customWrappers[b].effect=K,this._customWrappers[b].drawContext&&(this._customWrappers[b].drawContext.useInstancing=this._useInstancing)}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new f.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"particles"}get vertexBuffers(){return this._vertexBuffers}get indexBuffer(){return this._indexBuffer}constructor(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4],F=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.01;super(K),this._emitterInverseWorldMatrix=z.b.Identity(),this._inheritedVelocityOffset=new z.k,this.Ui=new f.d,this.onStoppedObservable=new f.d,this.bj=new Array,this._stockParticles=new Array,this._newPartsExcess=0,this._vertexBuffers={},this._scaledColorStep=new T.g(0,0,0,0),this._colorDiff=new T.g(0,0,0,0),this._scaledDirection=z.k.Zero(),this._scaledGravity=z.k.Zero(),this._currentRenderId=-1,this._useInstancing=!1,this._started=!1,this._stopped=!1,this._actualFrame=0,this._currentEmitRate1=0,this._currentEmitRate2=0,this._currentStartSize1=0,this._currentStartSize2=0,this.updateInAnimate=!0,this._rawTextureWidth=256,this._useRampGradients=!1,this.isLocal=!1,this.isGPU=!1,this._shaderLanguage=0,this._onBeforeDrawParticlesObservable=null,this._emitFromParticle=K=>{},this.recycleParticle=K=>{const b=this.bj.pop();b!==K&&b.copyTo(K),this._stockParticles.push(b)},this._createParticle=()=>{let K;return 0!==this._stockParticles.length?(K=this._stockParticles.pop(),K._reset()):K=new J(this),this._prepareParticle(K),K},this._shadersLoaded=!1,this._capacity=b,this._epsilon=F,this._isAnimationSheetEnabled=j,e&&"Scene"!==e.getClassName()?(this._engine=e,this.defaultProjectionMatrix=z.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=e||q.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene._i.push(this)),this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._initShaderSourceAsync(),this._attachImageProcessingConfiguration(null),this._customWrappers={0:new KK.b(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers=[],this._useInstancing=this._engine.getCaps().instancedArrays,this._createIndexBuffer(),this._createVertexBuffers(),this.particleEmitterType=new X;let l=null;this.updateFunction=K=>{let b=null;var e;this.noiseTexture&&(b=this.noiseTexture.getSize(),null===(e=this.noiseTexture.getContent())||void 0===e||e.then((K=>{l=K})));const k=K===this.bj;for(let j=0;j<K.length;j++){const e=K[j];let F=this._scaledUpdateSpeed;const A=e.age;if(e.age+=F,e.age>e.lifeTime){const K=e.age-A;F=(e.lifeTime-A)*F/K,e.age=e.lifeTime}const X=e.age/e.lifeTime;this._colorGradients&&this._colorGradients.length>0?W.GetCurrentGradient(X,this._colorGradients,((K,b,z)=>{K!==e._currentColorGradient&&(e._currentColor1.p(e._currentColor2),b.getColorToRef(e._currentColor2),e._currentColorGradient=K),T.g.LerpToRef(e._currentColor1,e._currentColor2,z,e.color)})):(e.colorStep.scaleToRef(F,this._scaledColorStep),e.color.addInPlace(this._scaledColorStep),e.color.a<0&&(e.color.a=0)),this._angularSpeedGradients&&this._angularSpeedGradients.length>0&&W.GetCurrentGradient(X,this._angularSpeedGradients,((K,b,z)=>{K!==e._currentAngularSpeedGradient&&(e._currentAngularSpeed1=e._currentAngularSpeed2,e._currentAngularSpeed2=b.getFactor(),e._currentAngularSpeedGradient=K),e.angularSpeed=(0,Y.m)(e._currentAngularSpeed1,e._currentAngularSpeed2,z)})),e.angle+=e.angularSpeed*F;let t=F;if(this._velocityGradients&&this._velocityGradients.length>0&&W.GetCurrentGradient(X,this._velocityGradients,((K,b,z)=>{K!==e._currentVelocityGradient&&(e._currentVelocity1=e._currentVelocity2,e._currentVelocity2=b.getFactor(),e._currentVelocityGradient=K),t*=(0,Y.m)(e._currentVelocity1,e._currentVelocity2,z)})),e.direction.scaleToRef(t,this._scaledDirection),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&W.GetCurrentGradient(X,this._limitVelocityGradients,((K,b,z)=>{K!==e._currentLimitVelocityGradient&&(e._currentLimitVelocity1=e._currentLimitVelocity2,e._currentLimitVelocity2=b.getFactor(),e._currentLimitVelocityGradient=K);const k=(0,Y.m)(e._currentLimitVelocity1,e._currentLimitVelocity2,z);e.direction.length()>k&&e.direction.scaleInPlace(this.limitVelocityDamping)})),this._dragGradients&&this._dragGradients.length>0&&W.GetCurrentGradient(X,this._dragGradients,((K,b,z)=>{K!==e._currentDragGradient&&(e._currentDrag1=e._currentDrag2,e._currentDrag2=b.getFactor(),e._currentDragGradient=K);const k=(0,Y.m)(e._currentDrag1,e._currentDrag2,z);this._scaledDirection.scaleInPlace(1-k)})),this.isLocal&&e.Ud?(e.Ud.addInPlace(this._scaledDirection),z.k.TransformCoordinatesToRef(e.Ud,this._emitterWorldMatrix,e.position)):e.position.addInPlace(this._scaledDirection),l&&b&&e._randomNoiseCoordinates1){const K=this._fetchR(e._randomNoiseCoordinates1.x,e._randomNoiseCoordinates1.y,b.width,b.height,l),k=this._fetchR(e._randomNoiseCoordinates1.z,e._randomNoiseCoordinates2.x,b.width,b.height,l),j=this._fetchR(e._randomNoiseCoordinates2.y,e._randomNoiseCoordinates2.z,b.width,b.height,l),T=z.e.gb[0],Y=z.e.gb[1];T.Yd((2*K-1)*this.noiseStrength.x,(2*k-1)*this.noiseStrength.y,(2*j-1)*this.noiseStrength.z),T.scaleToRef(F,Y),e.direction.addInPlace(Y)}this.gravity.scaleToRef(F,this._scaledGravity),e.direction.addInPlace(this._scaledGravity),this._sizeGradients&&this._sizeGradients.length>0&&W.GetCurrentGradient(X,this._sizeGradients,((K,b,z)=>{K!==e._currentSizeGradient&&(e._currentSize1=e._currentSize2,e._currentSize2=b.getFactor(),e._currentSizeGradient=K),e.size=(0,Y.m)(e._currentSize1,e._currentSize2,z)})),this._useRampGradients&&(this._colorRemapGradients&&this._colorRemapGradients.length>0&&W.GetCurrentGradient(X,this._colorRemapGradients,((K,b,z)=>{const k=(0,Y.m)(K.factor1,b.factor1,z),j=(0,Y.m)(K.factor2,b.factor2,z);e.remapData.x=k,e.remapData.y=j-k})),this._alphaRemapGradients&&this._alphaRemapGradients.length>0&&W.GetCurrentGradient(X,this._alphaRemapGradients,((K,b,z)=>{const k=(0,Y.m)(K.factor1,b.factor1,z),j=(0,Y.m)(K.factor2,b.factor2,z);e.remapData.z=k,e.remapData.w=j-k}))),this._isAnimationSheetEnabled&&e.updateCellIndex(),e._inheritParticleInfoToSubEmitters(),e.age>=e.lifeTime&&(this._emitFromParticle(e),e._attachedSubEmitters&&(e._attachedSubEmitters.forEach((K=>{K.particleSystem.disposeOnStop=!0,K.particleSystem.stop()})),e._attachedSubEmitters=null),this.recycleParticle(e),k&&j--)}}}serialize(K){throw new Error("Method not implemented.")}clone(K,b){throw new Error("Method not implemented.")}_addFactorGradient(K,b,e,z){const k=new H(b,e,z);K.push(k),K.sort(((K,b)=>K.gradient<b.gradient?-1:K.gradient>b.gradient?1:0))}_removeFactorGradient(K,b){if(!K)return;let e=0;for(const z of K){if(z.gradient===b){K.splice(e,1);break}e++}}addLifeTimeGradient(K,b,e){return this._lifeTimeGradients||(this._lifeTimeGradients=[]),this._addFactorGradient(this._lifeTimeGradients,K,b,e),this}removeLifeTimeGradient(K){return this._removeFactorGradient(this._lifeTimeGradients,K),this}addSizeGradient(K,b,e){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,K,b,e),this}removeSizeGradient(K){return this._removeFactorGradient(this._sizeGradients,K),this}addColorRemapGradient(K,b,e){return this._colorRemapGradients||(this._colorRemapGradients=[]),this._addFactorGradient(this._colorRemapGradients,K,b,e),this}removeColorRemapGradient(K){return this._removeFactorGradient(this._colorRemapGradients,K),this}addAlphaRemapGradient(K,b,e){return this._alphaRemapGradients||(this._alphaRemapGradients=[]),this._addFactorGradient(this._alphaRemapGradients,K,b,e),this}removeAlphaRemapGradient(K){return this._removeFactorGradient(this._alphaRemapGradients,K),this}addAngularSpeedGradient(K,b,e){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,K,b,e),this}removeAngularSpeedGradient(K){return this._removeFactorGradient(this._angularSpeedGradients,K),this}addVelocityGradient(K,b,e){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,K,b,e),this}removeVelocityGradient(K){return this._removeFactorGradient(this._velocityGradients,K),this}addLimitVelocityGradient(K,b,e){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,K,b,e),this}removeLimitVelocityGradient(K){return this._removeFactorGradient(this._limitVelocityGradients,K),this}addDragGradient(K,b,e){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,K,b,e),this}removeDragGradient(K){return this._removeFactorGradient(this._dragGradients,K),this}addEmitRateGradient(K,b,e){return this._emitRateGradients||(this._emitRateGradients=[]),this._addFactorGradient(this._emitRateGradients,K,b,e),this}removeEmitRateGradient(K){return this._removeFactorGradient(this._emitRateGradients,K),this}addStartSizeGradient(K,b,e){return this._startSizeGradients||(this._startSizeGradients=[]),this._addFactorGradient(this._startSizeGradients,K,b,e),this}removeStartSizeGradient(K){return this._removeFactorGradient(this._startSizeGradients,K),this}_createRampGradientTexture(){if(!this._rampGradients||!this._rampGradients.length||this._rampGradientsTexture||!this._scene)return;const K=new Uint8Array(4*this._rawTextureWidth),b=T.i.hb[0];for(let e=0;e<this._rawTextureWidth;e++){const z=e/this._rawTextureWidth;W.GetCurrentGradient(z,this._rampGradients,((z,k,j)=>{T.c.LerpToRef(z.color,k.color,j,b),K[4*e]=255*b.r,K[4*e+1]=255*b.g,K[4*e+2]=255*b.b,K[4*e+3]=255}))}this._rampGradientsTexture=V.e.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1)}getRampGradients(){return this._rampGradients}forceRefreshGradients(){this._syncRampGradientTexture()}_syncRampGradientTexture(){this._rampGradients&&(this._rampGradients.sort(((K,b)=>K.gradient<b.gradient?-1:K.gradient>b.gradient?1:0)),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._createRampGradientTexture())}addRampGradient(K,b){this._rampGradients||(this._rampGradients=[]);const e=new C(K,b);return this._rampGradients.push(e),this._syncRampGradientTexture(),this}removeRampGradient(K){return this._removeGradientAndTexture(K,this._rampGradients,this._rampGradientsTexture),this._rampGradientsTexture=null,this._rampGradients&&this._rampGradients.length>0&&this._createRampGradientTexture(),this}addColorGradient(K,b,e){this._colorGradients||(this._colorGradients=[]);const z=new o(K,b,e);return this._colorGradients.push(z),this._colorGradients.sort(((K,b)=>K.gradient<b.gradient?-1:K.gradient>b.gradient?1:0)),this}removeColorGradient(K){if(!this._colorGradients)return this;let b=0;for(const e of this._colorGradients){if(e.gradient===K){this._colorGradients.splice(b,1);break}b++}return this}resetDrawCache(){for(const K of this._drawWrappers)if(K)for(const b of K)null===b||void 0===b||b.dispose();this._drawWrappers=[]}_fetchR(K,b,e,z,k){return k[4*(((K=.5*Math.abs(K)+.5)*e%e|0)+((b=.5*Math.abs(b)+.5)*z%z|0)*e)]/255}_reset(){this._resetEffect()}_resetEffect(){this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),this._createVertexBuffers()}_createVertexBuffers(){this._vertexBufferSize=this._useInstancing?10:12,this._isAnimationSheetEnabled&&(this._vertexBufferSize+=1),this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode||(this._vertexBufferSize+=3),this._useRampGradients&&(this._vertexBufferSize+=4);const K=this._engine,b=this._vertexBufferSize*(this._useInstancing?1:4);this._vertexData=new Float32Array(this._capacity*b),this._vertexBuffer=new G.b(K,this._vertexData,!0,b);let e=0;const z=this._vertexBuffer.createVertexBuffer(G.f.PositionKind,e,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[G.f.PositionKind]=z,e+=3;const k=this._vertexBuffer.createVertexBuffer(G.f.ColorKind,e,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers[G.f.ColorKind]=k,e+=4;const j=this._vertexBuffer.createVertexBuffer("angle",e,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.angle=j,e+=1;const T=this._vertexBuffer.createVertexBuffer("size",e,2,this._vertexBufferSize,this._useInstancing);if(this._vertexBuffers.size=T,e+=2,this._isAnimationSheetEnabled){const K=this._vertexBuffer.createVertexBuffer("cellIndex",e,1,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.cellIndex=K,e+=1}if(!this._isBillboardBased||8===this.billboardMode||9===this.billboardMode){const K=this._vertexBuffer.createVertexBuffer("direction",e,3,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.direction=K,e+=3}if(this._useRampGradients){const K=this._vertexBuffer.createVertexBuffer("remapData",e,4,this._vertexBufferSize,this._useInstancing);this._vertexBuffers.remapData=K,e+=4}let F;if(this._useInstancing){const b=new Float32Array([0,0,1,0,0,1,1,1]);this._spriteBuffer=new G.b(K,b,!1,2),F=this._spriteBuffer.createVertexBuffer("offset",0,2)}else F=this._vertexBuffer.createVertexBuffer("offset",e,2,this._vertexBufferSize,this._useInstancing),e+=2;this._vertexBuffers.offset=F,this.resetDrawCache()}_createIndexBuffer(){if(this._useInstancing)return void(this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3])));const K=[],b=[];let e=0;for(let z=0;z<this._capacity;z++)K.push(e),K.push(e+1),K.push(e+2),K.push(e),K.push(e+2),K.push(e+3),b.push(e,e+1,e+1,e+2,e+2,e+3,e+3,e,e,e+3),e+=4;this._indexBuffer=this._engine.createIndexBuffer(K),this._linesIndexBuffer=this._engine.createIndexBuffer(b)}getCapacity(){return this._capacity}isAlive(){return this._alive}isStarted(){return this._started}_preStart(){}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";if(K)setTimeout((()=>{this.start(0)}),K);else{if(this._started=!0,this._stopped=!1,this._actualFrame=0,this._preStart(),this._emitRateGradients&&(this._emitRateGradients.length>0&&(this._currentEmitRateGradient=this._emitRateGradients[0],this._currentEmitRate1=this._currentEmitRateGradient.getFactor(),this._currentEmitRate2=this._currentEmitRate1),this._emitRateGradients.length>1&&(this._currentEmitRate2=this._emitRateGradients[1].getFactor())),this._startSizeGradients&&(this._startSizeGradients.length>0&&(this._currentStartSizeGradient=this._startSizeGradients[0],this._currentStartSize1=this._currentStartSizeGradient.getFactor(),this._currentStartSize2=this._currentStartSize1),this._startSizeGradients.length>1&&(this._currentStartSize2=this._startSizeGradients[1].getFactor())),this.preWarmCycles){var b;-1!==(null===(b=this.j)||void 0===b?void 0:b.getClassName().indexOf("Mesh"))&&this.j.xj(!0);const K=this.noiseTexture;if(K&&K.onGeneratedObservable)K.onGeneratedObservable.addOnce((()=>{setTimeout((()=>{for(let b=0;b<this.preWarmCycles;b++)this.animate(!0),K.render()}))}));else for(let b=0;b<this.preWarmCycles;b++)this.animate(!0)}this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop)}}stop(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0,this._postStop(K))}_postStop(K){}reset(){this._stockParticles.length=0,this.bj.length=0}_appendParticleVertex(K,b,e,k){let j=K*this._vertexBufferSize;if(this._vertexData[j++]=b.position.x+this.Kf.x,this._vertexData[j++]=b.position.y+this.Kf.y,this._vertexData[j++]=b.position.z+this.Kf.z,this._vertexData[j++]=b.color.r,this._vertexData[j++]=b.color.g,this._vertexData[j++]=b.color.b,this._vertexData[j++]=b.color.a,this._vertexData[j++]=b.angle,this._vertexData[j++]=b.scale.x*b.size,this._vertexData[j++]=b.scale.y*b.size,this._isAnimationSheetEnabled&&(this._vertexData[j++]=b.cellIndex),this._isBillboardBased)8!==this.billboardMode&&9!==this.billboardMode||(this._vertexData[j++]=b.direction.x,this._vertexData[j++]=b.direction.y,this._vertexData[j++]=b.direction.z);else if(b._initialDirection){let K=b._initialDirection;this.isLocal&&(z.k.TransformNormalToRef(K,this._emitterWorldMatrix,z.e.gb[0]),K=z.e.gb[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[j++]=K.x,this._vertexData[j++]=K.y,this._vertexData[j++]=K.z}else{let K=b.direction;this.isLocal&&(z.k.TransformNormalToRef(K,this._emitterWorldMatrix,z.e.gb[0]),K=z.e.gb[0]),0===K.x&&0===K.z&&(K.x=.001),this._vertexData[j++]=K.x,this._vertexData[j++]=K.y,this._vertexData[j++]=K.z}this._useRampGradients&&b.remapData&&(this._vertexData[j++]=b.remapData.x,this._vertexData[j++]=b.remapData.y,this._vertexData[j++]=b.remapData.z,this._vertexData[j++]=b.remapData.w),this._useInstancing||(this._isAnimationSheetEnabled&&(0===e?e=this._epsilon:1===e&&(e=1-this._epsilon),0===k?k=this._epsilon:1===k&&(k=1-this._epsilon)),this._vertexData[j++]=e,this._vertexData[j++]=k)}_prepareParticle(K){}_update(K){if(this._alive=this.bj.length>0,this.j.position){const K=this.j;this._emitterWorldMatrix=K.getWorldMatrix()}else{const K=this.j;this._emitterWorldMatrix=z.b.Translation(K.x,K.y,K.z)}let b;this._emitterWorldMatrix.invertToRef(this._emitterInverseWorldMatrix),this.updateFunction(this.bj);for(let e=0;e<K&&this.bj.length!==this._capacity;e++){if(b=this._createParticle(),this.bj.push(b),this.targetStopDuration&&this._lifeTimeGradients&&this._lifeTimeGradients.length>0){const K=(0,Y.e)(this._actualFrame/this.targetStopDuration);W.GetCurrentGradient(K,this._lifeTimeGradients,((e,z)=>{const k=e,j=z,T=k.getFactor(),F=j.getFactor(),l=(K-k.gradient)/(j.gradient-k.gradient);b.lifeTime=(0,Y.m)(T,F,l)}))}else b.lifeTime=(0,Y.t)(this.minLifeTime,this.maxLifeTime);const K=(0,Y.t)(this.minEmitPower,this.maxEmitPower);if(this.startPositionFunction?this.startPositionFunction(this._emitterWorldMatrix,b.position,b,this.isLocal):this.particleEmitterType.startPositionFunction(this._emitterWorldMatrix,b.position,b,this.isLocal),this.isLocal&&(b.Ud?b.Ud.p(b.position):b.Ud=b.position.clone(),z.k.TransformCoordinatesToRef(b.Ud,this._emitterWorldMatrix,b.position)),this.startDirectionFunction?this.startDirectionFunction(this._emitterWorldMatrix,b.direction,b,this.isLocal):this.particleEmitterType.startDirectionFunction(this._emitterWorldMatrix,b.direction,b,this.isLocal,this._emitterInverseWorldMatrix),0===K?b._initialDirection?b._initialDirection.p(b.direction):b._initialDirection=b.direction.clone():b._initialDirection=null,b.direction.scaleInPlace(K),this._sizeGradients&&0!==this._sizeGradients.length?(b._currentSizeGradient=this._sizeGradients[0],b._currentSize1=b._currentSizeGradient.getFactor(),b.size=b._currentSize1,this._sizeGradients.length>1?b._currentSize2=this._sizeGradients[1].getFactor():b._currentSize2=b._currentSize1):b.size=(0,Y.t)(this.minSize,this.maxSize),b.scale.Yd((0,Y.t)(this.minScaleX,this.maxScaleX),(0,Y.t)(this.minScaleY,this.maxScaleY)),this._startSizeGradients&&this._startSizeGradients[0]&&this.targetStopDuration){const K=this._actualFrame/this.targetStopDuration;W.GetCurrentGradient(K,this._startSizeGradients,((K,e,z)=>{K!==this._currentStartSizeGradient&&(this._currentStartSize1=this._currentStartSize2,this._currentStartSize2=e.getFactor(),this._currentStartSizeGradient=K);const k=(0,Y.m)(this._currentStartSize1,this._currentStartSize2,z);b.scale.scaleInPlace(k)}))}if(this._angularSpeedGradients&&0!==this._angularSpeedGradients.length?(b._currentAngularSpeedGradient=this._angularSpeedGradients[0],b.angularSpeed=b._currentAngularSpeedGradient.getFactor(),b._currentAngularSpeed1=b.angularSpeed,this._angularSpeedGradients.length>1?b._currentAngularSpeed2=this._angularSpeedGradients[1].getFactor():b._currentAngularSpeed2=b._currentAngularSpeed1):b.angularSpeed=(0,Y.t)(this.minAngularSpeed,this.maxAngularSpeed),b.angle=(0,Y.t)(this.minInitialRotation,this.maxInitialRotation),this._velocityGradients&&this._velocityGradients.length>0&&(b._currentVelocityGradient=this._velocityGradients[0],b._currentVelocity1=b._currentVelocityGradient.getFactor(),this._velocityGradients.length>1?b._currentVelocity2=this._velocityGradients[1].getFactor():b._currentVelocity2=b._currentVelocity1),this._limitVelocityGradients&&this._limitVelocityGradients.length>0&&(b._currentLimitVelocityGradient=this._limitVelocityGradients[0],b._currentLimitVelocity1=b._currentLimitVelocityGradient.getFactor(),this._limitVelocityGradients.length>1?b._currentLimitVelocity2=this._limitVelocityGradients[1].getFactor():b._currentLimitVelocity2=b._currentLimitVelocity1),this._dragGradients&&this._dragGradients.length>0&&(b._currentDragGradient=this._dragGradients[0],b._currentDrag1=b._currentDragGradient.getFactor(),this._dragGradients.length>1?b._currentDrag2=this._dragGradients[1].getFactor():b._currentDrag2=b._currentDrag1),this._colorGradients&&0!==this._colorGradients.length)b._currentColorGradient=this._colorGradients[0],b._currentColorGradient.getColorToRef(b.color),b._currentColor1.p(b.color),this._colorGradients.length>1?this._colorGradients[1].getColorToRef(b._currentColor2):b._currentColor2.p(b.color);else{const K=(0,Y.t)(0,1);T.g.LerpToRef(this.color1,this.color2,K,b.color),this.colorDead.subtractToRef(b.color,this._colorDiff),this._colorDiff.scaleToRef(1/b.lifeTime,b.colorStep)}this._isAnimationSheetEnabled&&(b._initialStartSpriteCellID=this.startSpriteCellID,b._initialEndSpriteCellID=this.endSpriteCellID,b._initialSpriteCellLoop=this.spriteCellLoop),b.direction.addInPlace(this._inheritedVelocityOffset),this._useRampGradients&&(b.remapData=new z.o(0,1,0,1)),this.noiseTexture&&(b._randomNoiseCoordinates1?(b._randomNoiseCoordinates1.Yd(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2.Yd(Math.random(),Math.random(),Math.random())):(b._randomNoiseCoordinates1=new z.k(Math.random(),Math.random(),Math.random()),b._randomNoiseCoordinates2=new z.k(Math.random(),Math.random(),Math.random()))),b._inheritParticleInfoToSubEmitters()}}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=[G.f.PositionKind,G.f.ColorKind,"angle","offset","size"];return K&&z.push("cellIndex"),b||z.push("direction"),e&&z.push("remapData"),z}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["invView","view","projection","textureMask","translationPivot","eyePosition"];return(0,bK.c)(z),K&&z.push("particlesInfos"),b&&z.push("logarithmicDepthConstant"),e&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bK.j)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&0!==this._scene.fogMode&&K.push("#define FOG")),this._isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),b===l.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this._useRampGradients&&K.push("#define RAMPGRADIENT"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case 2:K.push("#define BILLBOARDY");break;case 8:case 9:K.push("#define BILLBOARDSTRETCHED"),9===this.billboardMode&&K.push("#define BILLBOARDSTRETCHED_LOCAL");break;case 7:K.push("#define BILLBOARDMODE_ALL")}e&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,b,e){b.push(...kK._GetAttributeNamesOrOptions(this._isAnimationSheetEnabled,this._isBillboardBased&&8!==this.billboardMode&&9!==this.billboardMode,this._useRampGradients)),K.push(...kK._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),e.push("diffuseSampler","rampSampler"),this._imageProcessingConfiguration&&((0,zK.g)(K,this._imageProcessingConfigurationDefines),(0,zK.c)(e,this._imageProcessingConfigurationDefines))}_getWrapper(K){const b=this._getCustomDrawWrapper(K);if(null!==b&&void 0!==b&&b.effect)return b;const e=[];this.fillDefines(e,K);const z=this._engine._features.supportRenderPasses?this._engine.currentRenderPassId:0;let k=this._drawWrappers[z];k||(k=this._drawWrappers[z]=[]);let j=k[K];j||(j=new KK.b(this._engine),j.drawContext&&(j.drawContext.useInstancing=this._useInstancing),k[K]=j);const T=e.join("\n");if(j.defines!==T){const K=[],b=[],e=[];this.fillUniformsAttributesAndSamplerNames(b,K,e),j.setEffect(this._engine.createEffect("particles",K,b,e,T,void 0,void 0,void 0,void 0,this._shaderLanguage),T)}return j}animate(){var K;let b,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._started){if(!e&&this._scene){if(!this.isReady())return;if(this._currentRenderId===this._scene.getFrameId())return;this._currentRenderId=this._scene.getFrameId()}if(this._scaledUpdateSpeed=this.updateSpeed*(e?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this.manualEmitCount>-1)b=this.manualEmitCount,this._newPartsExcess=0,this.manualEmitCount=0;else{let K=this.emitRate;if(this._emitRateGradients&&this._emitRateGradients.length>0&&this.targetStopDuration){const b=this._actualFrame/this.targetStopDuration;W.GetCurrentGradient(b,this._emitRateGradients,((b,e,z)=>{b!==this._currentEmitRateGradient&&(this._currentEmitRate1=this._currentEmitRate2,this._currentEmitRate2=e.getFactor(),this._currentEmitRateGradient=b),K=(0,Y.m)(this._currentEmitRate1,this._currentEmitRate2,z)}))}b=K*this._scaledUpdateSpeed|0,this._newPartsExcess+=K*this._scaledUpdateSpeed-b}if(this._newPartsExcess>1&&(b+=this._newPartsExcess|0,this._newPartsExcess-=this._newPartsExcess|0),this._alive=!1,this._stopped?b=0:(this._actualFrame+=this._scaledUpdateSpeed,this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop()),this._update(b),this._stopped&&(this._alive||(this._started=!1,this.onAnimationEnd&&this.onAnimationEnd(),this.disposeOnStop&&this._scene&&this._scene._toBeDisposed.push(this))),!e){let K=0;for(let b=0;b<this.bj.length;b++){const e=this.bj[b];this._appendParticleVertices(K,e),K+=this._useInstancing?1:4}this._vertexBuffer&&this._vertexBuffer.updateDirectly(this._vertexData,0,this.bj.length)}0===this.manualEmitCount&&this.disposeOnStop&&this.stop()}}_appendParticleVertices(K,b){this._appendParticleVertex(K++,b,0,0),this._useInstancing||(this._appendParticleVertex(K++,b,1,0),this._appendParticleVertex(K++,b,1,1),this._appendParticleVertex(K++,b,0,1))}rebuild(){var K;this._engine.getCaps().vertexArrayObject&&(this._vertexArrayObject=null),this._createIndexBuffer(),null===(K=this._spriteBuffer)||void 0===K||K._rebuild(),this._createVertexBuffers(),this.resetDrawCache()}async _initShaderSourceAsync(){this._engine.isWebGPU&&!kK.ForceGLSL?(this._shaderLanguage=1,await Promise.all([Promise.resolve().then(e.bind(e,11685)),Promise.resolve().then(e.bind(e,11646))])):await Promise.all([Promise.resolve().then(e.bind(e,11634)),Promise.resolve().then(e.bind(e,11626))]),this._shadersLoaded=!0}isReady(){if(!this._shadersLoaded)return!1;if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady())return!1;if(this.blendMode!==l.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(l.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(l.BLENDMODE_ADD).effect.isReady())return!1}return!0}_render(K){const b=this._getWrapper(K),e=b.effect,k=this._engine;k.enableEffect(b);const j=this.defaultViewMatrix??this._scene.getViewMatrix();if(e.setTexture("diffuseSampler",this.particleTexture),e.setMatrix("view",j),e.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();e.setFloat3("particlesInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,this.spriteCellWidth/K.width)}if(e.setVector2("translationPivot",this.translationPivot),e.setFloat4("textureMask",this.textureMask.r,this.textureMask.g,this.textureMask.b,this.textureMask.a),this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;e.setVector3("eyePosition",K.globalPosition)}this._rampGradientsTexture&&(this._rampGradients&&this._rampGradients.length||(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),e.setTexture("rampSampler",this._rampGradientsTexture));const T=e.defines;var F,Y,A,X,t,U;(this._scene&&((0,bK.d)(e,this,this._scene),this.applyFog&&(0,eK.h)(this._scene,void 0,e)),T.indexOf("#define BILLBOARDMODE_ALL")>=0&&(j.invertToRef(z.e.Matrix[0]),e.setMatrix("invView",z.e.Matrix[0])),void 0!==this._vertexArrayObject)?null!==(F=this._scene)&&void 0!==F&&F.forceWireframe?k.bindBuffers(this._vertexBuffers,this._linesIndexBufferUseInstancing,e):(this._vertexArrayObject||(this._vertexArrayObject=this._engine.recordVertexArrayObject(this._vertexBuffers,null,e)),this._engine.bindVertexArrayObject(this._vertexArrayObject,null!==(Y=this._scene)&&void 0!==Y&&Y.forceWireframe?this._linesIndexBufferUseInstancing:this._indexBuffer)):this._indexBuffer?k.bindBuffers(this._vertexBuffers,null!==(A=this._scene)&&void 0!==A&&A.forceWireframe?this._linesIndexBuffer:this._indexBuffer,e):k.bindBuffers(this._vertexBuffers,null!==(X=this._scene)&&void 0!==X&&X.forceWireframe?this._linesIndexBufferUseInstancing:null,e);switch(this.useLogarithmicDepth&&this._scene&&(0,eK.o)(T,e,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(e),K){case l.BLENDMODE_ADD:k.setAlphaMode(1);break;case l.BLENDMODE_ONEONE:k.setAlphaMode(6);break;case l.BLENDMODE_STANDARD:k.setAlphaMode(2);break;case l.BLENDMODE_MULTIPLY:k.setAlphaMode(4)}(this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(e),this._useInstancing)?null!==(t=this._scene)&&void 0!==t&&t.forceWireframe?k.drawElementsType(6,0,10,this.bj.length):k.drawArraysType(7,0,4,this.bj.length):null!==(U=this._scene)&&void 0!==U&&U.forceWireframe?k.drawElementsType(1,0,10*this.bj.length):k.drawElementsType(0,0,6*this.bj.length);return this.bj.length}render(){if(!this.isReady()||!this.bj.length)return 0;const K=this._engine;K.setState&&(K.setState(!1),this.forceDepthWrite&&K.setDepthWrite(!0));let b=0;return b=this.blendMode===l.BLENDMODE_MULTIPLYADD?this._render(l.BLENDMODE_MULTIPLY)+this._render(l.BLENDMODE_ADD):this._render(this.blendMode),this._engine.unbindInstanceAttributes(),this._engine.setAlphaMode(0),b}_onDispose(){}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.resetDrawCache(),this._vertexBuffer&&(this._vertexBuffer.dispose(),this._vertexBuffer=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._indexBuffer&&(this._engine._releaseBuffer(this._indexBuffer),this._indexBuffer=null),this._linesIndexBuffer&&(this._engine._releaseBuffer(this._linesIndexBuffer),this._linesIndexBuffer=null),this._linesIndexBufferUseInstancing&&(this._engine._releaseBuffer(this._linesIndexBufferUseInstancing),this._linesIndexBufferUseInstancing=null),this._vertexArrayObject&&(this._engine.releaseVertexArrayObject(this._vertexArrayObject),this._vertexArrayObject=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this._rampGradientsTexture&&(this._rampGradientsTexture.dispose(),this._rampGradientsTexture=null),this._onDispose(b,e),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.clear(),this._scene){const K=this._scene._i.indexOf(this);K>-1&&this._scene._i.splice(K,1),this._scene._activeParticleSystems.dispose()}this.Ui.notifyObservers(this),this.Ui.clear(),this.onStoppedObservable.clear(),this.reset()}}kK.ForceGLSL=!1;var jK,TK=e(10710);!function(K){K[K.ATTACHED=0]="ATTACHED",K[K.END=1]="END"}(jK||(jK={}));class FK{constructor(K){if(this.particleSystem=K,this.type=1,this.inheritDirection=!1,this.inheritedVelocityAmount=0,!K.j||!K.j.dispose){const b=(0,F.d)("BABYLON.AbstractMesh");K.j=new b("SubemitterSystemEmitter",K.va()),K._disposeEmitterOnDispose=!0}}clone(){let K=this.particleSystem.j;if(K){if(K instanceof z.k)K=K.clone();else if(-1!==K.getClassName().indexOf("Mesh")){K=new((0,F.d)("BABYLON.Mesh"))("",K.va()),K.isVisible=!1}}else K=new z.k;const b=new FK(this.particleSystem.clone(this.particleSystem.name,K));return b.particleSystem.name+="Clone",b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem._disposeEmitterOnDispose=!0,b.particleSystem.disposeOnStop=!0,b}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return b.type=this.type,b.inheritDirection=this.inheritDirection,b.inheritedVelocityAmount=this.inheritedVelocityAmount,b.particleSystem=this.particleSystem.serialize(K),b}static _ParseParticleSystem(K,b,e){throw(0,TK.c)("ParseParticle")}static Parse(K,b,e){const z=K.particleSystem,k=new FK(FK._ParseParticleSystem(z,b,e,!0));return k.type=K.type,k.inheritDirection=K.inheritDirection,k.inheritedVelocityAmount=K.inheritedVelocityAmount,k.particleSystem._isSubEmitter=!0,k}dispose(){this.particleSystem.dispose()}}var lK=e(10750);function YK(K,b){const e=new D;return e.direction1=K,e.direction2=b,e}function AK(){return new m(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function XK(){return new I(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1)}function tK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.k(0,1,0),e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.k(0,1,0);return new x(K,b,e)}function UK(){return new B(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0)}function BK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.k(0,1,0),j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.k(0,1,0);return new u(K,b,e,k,j)}function uK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4;return new t(K,b)}function mK(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.k(0,1,0),k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.k(0,1,0);return new U(K,b,e,k)}class DK extends kK{constructor(){super(...arguments),this._disposeEmitterOnDispose=!1,this._emitFromParticle=K=>{if(!this._subEmitters||0===this._subEmitters.length)return;const b=Math.floor(Math.random()*this._subEmitters.length);this._subEmitters[b].forEach((b=>{if(1===b.type){const e=b.clone();K._inheritParticleInfoToSubEmitter(e),e.particleSystem._rootParticleSystem=this,this.activeSubSystems.push(e.particleSystem),e.particleSystem.start()}}))}}createPointEmitter(K,b){const e=YK(K,b);return this.particleEmitterType=e,e}createHemisphericEmitter(){const K=AK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=XK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=tK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.k(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=UK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=BK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.k(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=uK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=mK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.k(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,b,e,z){const k=new X;return this.particleEmitterType=k,this.direction1=K,this.direction2=b,this.minEmitBox=e,this.maxEmitBox=z,k}_prepareSubEmitterInternalArray(){this._subEmitters=new Array,this.subEmitters&&this.subEmitters.forEach((K=>{K instanceof DK?this._subEmitters.push([new FK(K)]):K instanceof FK?this._subEmitters.push([K]):K instanceof Array&&this._subEmitters.push(K)}))}_stopSubEmitters(){this.activeSubSystems&&(this.activeSubSystems.forEach((K=>{K.stop(!0)})),this.activeSubSystems=[])}_removeFromRoot(){if(!this._rootParticleSystem)return;const K=this._rootParticleSystem.activeSubSystems.indexOf(this);-1!==K&&this._rootParticleSystem.activeSubSystems.splice(K,1),this._rootParticleSystem=null}_preStart(){this._prepareSubEmitterInternalArray(),this._subEmitters&&0!=this._subEmitters.length&&(this.activeSubSystems=[])}_postStop(K){K&&this._stopSubEmitters()}_prepareParticle(K){if(this._subEmitters&&this._subEmitters.length>0){const b=this._subEmitters[Math.floor(Math.random()*this._subEmitters.length)];K._attachedSubEmitters=[],b.forEach((b=>{if(0===b.type){const e=b.clone();K._attachedSubEmitters.push(e),e.particleSystem.start()}}))}}_onDispose(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var e;(this._removeFromRoot(),this.subEmitters&&!this._subEmitters&&this._prepareSubEmitterInternalArray(),K)&&(null===(e=this.particles)||void 0===e||e.forEach((K=>{if(K._attachedSubEmitters)for(let b=K._attachedSubEmitters.length-1;b>=0;b-=1)K._attachedSubEmitters[b].dispose()})));if(b&&this.activeSubSystems)for(let z=this.activeSubSystems.length-1;z>=0;z-=1)this.activeSubSystems[z].dispose();if(this._subEmitters&&this._subEmitters.length){for(let K=0;K<this._subEmitters.length;K++)for(const b of this._subEmitters[K])b.dispose();this._subEmitters=[],this.subEmitters=[]}this._disposeEmitterOnDispose&&this.j&&this.j.dispose&&this.j.dispose(!0)}static _Parse(K,b,e,k){let j;j=e instanceof lK.e?null:e;const l=(0,F.d)("BABYLON.Texture");if(l&&j&&(K.texture?b.particleTexture=l.Parse(K.texture,j,k):K.textureName&&(b.particleTexture=new l(k+K.textureName,j,!1,void 0===K.invertY||K.invertY),b.particleTexture.name=K.textureName)),K.emitterId||0===K.emitterId||void 0!==K.j?K.emitterId&&j?b.j=j.getLastMeshById(K.emitterId):b.j=z.k.Bg(K.j):b.j=z.k.Zero(),b.isLocal=!!K.isLocal,void 0!==K.renderingGroupId&&(b.renderingGroupId=K.renderingGroupId),void 0!==K.isBillboardBased&&(b.isBillboardBased=K.isBillboardBased),void 0!==K.billboardMode&&(b.billboardMode=K.billboardMode),void 0!==K.useLogarithmicDepth&&(b.useLogarithmicDepth=K.useLogarithmicDepth),K.animations){for(let e=0;e<K.animations.length;e++){const z=K.animations[e],k=(0,F.d)("BABYLON.Animation");k&&b.animations.push(k.Parse(z))}b.beginAnimationOnStart=K.beginAnimationOnStart,b.beginAnimationFrom=K.beginAnimationFrom,b.beginAnimationTo=K.beginAnimationTo,b.beginAnimationLoop=K.beginAnimationLoop}if(K.autoAnimate&&j&&j.beginAnimation(b,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1),b.startDelay=0|K.startDelay,b.minAngularSpeed=K.minAngularSpeed,b.maxAngularSpeed=K.maxAngularSpeed,b.minSize=K.minSize,b.maxSize=K.maxSize,K.minScaleX&&(b.minScaleX=K.minScaleX,b.maxScaleX=K.maxScaleX,b.minScaleY=K.minScaleY,b.maxScaleY=K.maxScaleY),void 0!==K.preWarmCycles&&(b.preWarmCycles=K.preWarmCycles,b.preWarmStepOffset=K.preWarmStepOffset),void 0!==K.minInitialRotation&&(b.minInitialRotation=K.minInitialRotation,b.maxInitialRotation=K.maxInitialRotation),b.minLifeTime=K.minLifeTime,b.maxLifeTime=K.maxLifeTime,b.minEmitPower=K.minEmitPower,b.maxEmitPower=K.maxEmitPower,b.emitRate=K.emitRate,b.gravity=z.k.Bg(K.gravity),K.noiseStrength&&(b.noiseStrength=z.k.Bg(K.noiseStrength)),b.color1=T.g.Bg(K.color1),b.color2=T.g.Bg(K.color2),b.colorDead=T.g.Bg(K.colorDead),b.updateSpeed=K.updateSpeed,b.targetStopDuration=K.targetStopDuration,b.blendMode=K.blendMode,K.colorGradients)for(const z of K.colorGradients)b.addColorGradient(z.gradient,T.g.Bg(z.color1),z.color2?T.g.Bg(z.color2):void 0);if(K.rampGradients){for(const e of K.rampGradients)b.addRampGradient(e.gradient,T.c.Bg(e.color));b.useRampGradients=K.useRampGradients}if(K.colorRemapGradients)for(const z of K.colorRemapGradients)b.addColorRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.alphaRemapGradients)for(const z of K.alphaRemapGradients)b.addAlphaRemapGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.sizeGradients)for(const z of K.sizeGradients)b.addSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.angularSpeedGradients)for(const z of K.angularSpeedGradients)b.addAngularSpeedGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.velocityGradients)for(const z of K.velocityGradients)b.addVelocityGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.dragGradients)for(const z of K.dragGradients)b.addDragGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.emitRateGradients)for(const z of K.emitRateGradients)b.addEmitRateGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.startSizeGradients)for(const z of K.startSizeGradients)b.addStartSizeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.lifeTimeGradients)for(const z of K.lifeTimeGradients)b.addLifeTimeGradient(z.gradient,void 0!==z.factor1?z.factor1:z.factor,z.factor2);if(K.limitVelocityGradients){for(const e of K.limitVelocityGradients)b.addLimitVelocityGradient(e.gradient,void 0!==e.factor1?e.factor1:e.factor,e.factor2);b.limitVelocityDamping=K.limitVelocityDamping}if(K.noiseTexture&&j){const e=(0,F.d)("BABYLON.ProceduralTexture");b.noiseTexture=e.Parse(K.noiseTexture,j,k)}let Y;if(K.particleEmitterType){switch(K.particleEmitterType.type){case"SphereParticleEmitter":Y=new I;break;case"SphereDirectedParticleEmitter":Y=new x;break;case"ConeEmitter":case"ConeParticleEmitter":Y=new t;break;case"ConeDirectedParticleEmitter":Y=new U;break;case"CylinderParticleEmitter":Y=new B;break;case"CylinderDirectedParticleEmitter":Y=new u;break;case"HemisphericParticleEmitter":Y=new m;break;case"PointParticleEmitter":Y=new D;break;case"MeshParticleEmitter":Y=new i;break;case"CustomParticleEmitter":Y=new Q;break;default:Y=new X}Y.parse(K.particleEmitterType,j)}else Y=new X,Y.parse(K,j);b.particleEmitterType=Y,b.startSpriteCellID=K.startSpriteCellID,b.endSpriteCellID=K.endSpriteCellID,b.spriteCellLoop=K.spriteCellLoop??!0,b.spriteCellWidth=K.spriteCellWidth,b.spriteCellHeight=K.spriteCellHeight,b.spriteCellChangeSpeed=K.spriteCellChangeSpeed,b.spriteRandomStartCell=K.spriteRandomStartCell,b.disposeOnStop=K.disposeOnStop??!1,b.manualEmitCount=K.manualEmitCount??-1}static Parse(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]&&arguments[3],j=arguments.length>4?arguments[4]:void 0;const F=K.name;let l,Y,A=null,X=null;if(b instanceof lK.e?l=b:(Y=b,l=Y.getEngine()),K.customShader&&l.createEffectForParticles){X=K.customShader;const b=X.shaderOptions.defines.length>0?X.shaderOptions.defines.join("\n"):"";A=l.createEffectForParticles(X.shaderPath.fragmentElement,X.shaderOptions.uniforms,X.shaderOptions.samplers,b)}const t=new DK(F,j||K.kb,b,A,K.isAnimationSheetEnabled);if(t.customShader=X,t._rootUrl=e,K.id&&(t.id=K.id),K.subEmitters){t.subEmitters=[];for(const z of K.subEmitters){const K=[];for(const k of z)K.push(FK.Parse(k,b,e));t.subEmitters.push(K)}}return DK._Parse(K,t,b,e),K.textureMask&&(t.textureMask=T.g.Bg(K.textureMask)),K.Kf&&(t.Kf=z.k.Bg(K.Kf)),K.preventAutoStart&&(t.preventAutoStart=K.preventAutoStart),k||t.preventAutoStart||t.start(),t}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};if(DK._Serialize(b,this,K),b.textureMask=this.textureMask.Ti(),b.customShader=this.customShader,b.preventAutoStart=this.preventAutoStart,b.Kf=this.Kf.Ti(),this.subEmitters){b.subEmitters=[],this._subEmitters||this._prepareSubEmitterInternalArray();for(const e of this._subEmitters){const z=[];for(const b of e)z.push(b.serialize(K));b.subEmitters.push(z)}}return b}static _Serialize(K,b,e){if(K.name=b.name,K.id=b.id,K.kb=b.getCapacity(),K.disposeOnStop=b.disposeOnStop,K.manualEmitCount=b.manualEmitCount,b.j.position){const e=b.j;K.emitterId=e.id}else{const e=b.j;K.j=e.Ti()}b.particleEmitterType&&(K.particleEmitterType=b.particleEmitterType.serialize()),b.particleTexture&&(e?K.texture=b.particleTexture.serialize():(K.textureName=b.particleTexture.name,K.invertY=!!b.particleTexture._invertY)),K.isLocal=b.isLocal,P.e.AppendSerializedAnimations(b,K),K.beginAnimationOnStart=b.beginAnimationOnStart,K.beginAnimationFrom=b.beginAnimationFrom,K.beginAnimationTo=b.beginAnimationTo,K.beginAnimationLoop=b.beginAnimationLoop,K.startDelay=b.startDelay,K.renderingGroupId=b.renderingGroupId,K.isBillboardBased=b.isBillboardBased,K.billboardMode=b.billboardMode,K.minAngularSpeed=b.minAngularSpeed,K.maxAngularSpeed=b.maxAngularSpeed,K.minSize=b.minSize,K.maxSize=b.maxSize,K.minScaleX=b.minScaleX,K.maxScaleX=b.maxScaleX,K.minScaleY=b.minScaleY,K.maxScaleY=b.maxScaleY,K.minEmitPower=b.minEmitPower,K.maxEmitPower=b.maxEmitPower,K.minLifeTime=b.minLifeTime,K.maxLifeTime=b.maxLifeTime,K.emitRate=b.emitRate,K.gravity=b.gravity.Ti(),K.noiseStrength=b.noiseStrength.Ti(),K.color1=b.color1.Ti(),K.color2=b.color2.Ti(),K.colorDead=b.colorDead.Ti(),K.updateSpeed=b.updateSpeed,K.targetStopDuration=b.targetStopDuration,K.blendMode=b.blendMode,K.preWarmCycles=b.preWarmCycles,K.preWarmStepOffset=b.preWarmStepOffset,K.minInitialRotation=b.minInitialRotation,K.maxInitialRotation=b.maxInitialRotation,K.startSpriteCellID=b.startSpriteCellID,K.spriteCellLoop=b.spriteCellLoop,K.endSpriteCellID=b.endSpriteCellID,K.spriteCellChangeSpeed=b.spriteCellChangeSpeed,K.spriteCellWidth=b.spriteCellWidth,K.spriteCellHeight=b.spriteCellHeight,K.spriteRandomStartCell=b.spriteRandomStartCell,K.isAnimationSheetEnabled=b.isAnimationSheetEnabled,K.useLogarithmicDepth=b.useLogarithmicDepth;const z=b.getColorGradients();if(z){K.colorGradients=[];for(const b of z){const e={gradient:b.gradient,color1:b.color1.Ti()};b.color2?e.color2=b.color2.Ti():e.color2=b.color1.Ti(),K.colorGradients.push(e)}}const k=b.getRampGradients();if(k){K.rampGradients=[];for(const b of k){const e={gradient:b.gradient,color:b.color.Ti()};K.rampGradients.push(e)}K.useRampGradients=b.useRampGradients}const j=b.getColorRemapGradients();if(j){K.colorRemapGradients=[];for(const b of j){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.colorRemapGradients.push(e)}}const T=b.getAlphaRemapGradients();if(T){K.alphaRemapGradients=[];for(const b of T){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.alphaRemapGradients.push(e)}}const F=b.getSizeGradients();if(F){K.sizeGradients=[];for(const b of F){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.sizeGradients.push(e)}}const l=b.getAngularSpeedGradients();if(l){K.angularSpeedGradients=[];for(const b of l){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.angularSpeedGradients.push(e)}}const Y=b.getVelocityGradients();if(Y){K.velocityGradients=[];for(const b of Y){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.velocityGradients.push(e)}}const A=b.getDragGradients();if(A){K.dragGradients=[];for(const b of A){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.dragGradients.push(e)}}const X=b.getEmitRateGradients();if(X){K.emitRateGradients=[];for(const b of X){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.emitRateGradients.push(e)}}const t=b.getStartSizeGradients();if(t){K.startSizeGradients=[];for(const b of t){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.startSizeGradients.push(e)}}const U=b.getLifeTimeGradients();if(U){K.lifeTimeGradients=[];for(const b of U){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.lifeTimeGradients.push(e)}}const B=b.getLimitVelocityGradients();if(B){K.limitVelocityGradients=[];for(const b of B){const e={gradient:b.gradient,factor1:b.factor1};void 0!==b.factor2?e.factor2=b.factor2:e.factor2=b.factor1,K.limitVelocityGradients.push(e)}K.limitVelocityDamping=b.limitVelocityDamping}b.noiseTexture&&(K.noiseTexture=b.noiseTexture.serialize())}clone(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let k=null;const j=this._engine;if(j.createEffectForParticles&&null!=this.customShader){k=this.customShader;const K=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"",b=j.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,K);z[0]?z[0].effect=b:this.setCustomEffect(b,0)}const T=this.serialize(e),F=DK.Parse(T,this._scene||this._engine,this._rootUrl);return F.name=K,F.customShader=k,F._customWrappers=z,void 0===b&&(b=this.j),this.noiseTexture&&(F.noiseTexture=this.noiseTexture.clone()),F.j=b,this.preventAutoStart||F.start(),F}}DK.BILLBOARDMODE_Y=2,DK.BILLBOARDMODE_ALL=7,DK.BILLBOARDMODE_STRETCHED=8,DK.BILLBOARDMODE_STRETCHED_LOCAL=9,FK._ParseParticleSystem=DK.Parse;var IK=e(10990),xK=e(10960),QK=e(11455);QK.e.prototype.createTransformFeedback=function(){const K=this._gl.createTransformFeedback();if(!K)throw new Error("Unable to create Transform Feedback");return K},QK.e.prototype.deleteTransformFeedback=function(K){this._gl.deleteTransformFeedback(K)},QK.e.prototype.bindTransformFeedback=function(K){this._gl.bindTransformFeedback(this._gl.TRANSFORM_FEEDBACK,K)},QK.e.prototype.beginTransformFeedback=function(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._gl.beginTransformFeedback(K?this._gl.POINTS:this._gl.TRIANGLES)},QK.e.prototype.endTransformFeedback=function(){this._gl.endTransformFeedback()},QK.e.prototype.setTranformFeedbackVaryings=function(K,b){this._gl.transformFeedbackVaryings(K,b,this._gl.INTERLEAVED_ATTRIBS)},QK.e.prototype.bindTransformFeedbackBuffer=function(K){this._gl.bindBufferBase(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K?K.underlyingResource:null)},QK.e.prototype.readTransformFeedbackBuffer=function(K){this._gl.getBufferSubData(this._gl.TRANSFORM_FEEDBACK_BUFFER,0,K)};const GK="clipPlaneFragmentDeclaration2",iK="#ifdef CLIPPLANE\nin float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nin float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nin float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nin float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nin float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nin float fClipDistance6;\n#endif\n";r.d.IncludesShadersStore[GK]=iK;e(11537),e(11545),e(11549),e(11558),e(11564),e(11568),e(11570),e(11574);const SK="gpuRenderParticlesPixelShader",MK="precision highp float;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nuniform sampler2D diffuseSampler;varying vec2 vUV;varying vec4 vColor;\n#include<clipPlaneFragmentDeclaration2> \n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#include<fogFragmentDeclaration>\nvoid main() {\n#include<clipPlaneFragment> \nvec4 textureColor=texture2D(diffuseSampler,vUV);gl_FragColor=textureColor*vColor;\n#ifdef BLENDMULTIPLYMODE\nfloat alpha=vColor.a*textureColor.a;gl_FragColor.rgb=gl_FragColor.rgb*alpha+vec3(1.0)*(1.0-alpha);\n#endif \n#include<logDepthFragment>\n#include<fogFragment>(color,gl_FragColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\ngl_FragColor.rgb=toLinearSpace(gl_FragColor.rgb);gl_FragColor=applyImageProcessing(gl_FragColor);\n#endif\n#endif\n}\n";r.d.ShadersStore[SK]=MK;const rK="clipPlaneVertexDeclaration2",LK="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;out float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;out float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;out float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;out float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;out float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;out float fClipDistance6;\n#endif\n";r.d.IncludesShadersStore[rK]=LK;e(11577),e(11582),e(11591),e(11597);const cK="gpuRenderParticlesVertexShader",vK="precision highp float;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;uniform vec3 worldOffset;\n#ifdef LOCAL\nuniform mat4 emitterWM;\n#endif\nattribute vec3 position;attribute float age;attribute float life;attribute vec3 size;\n#ifndef BILLBOARD\nattribute vec3 initialDirection;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\nattribute float angle;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\nattribute vec2 offset;attribute vec2 uv;varying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration2>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef COLORGRADIENTS\nuniform sampler2D colorGradientSampler;\n#else\nuniform vec4 colorDead;attribute vec4 color;\n#endif\n#ifdef ANIMATESHEET\nuniform vec3 sheetInfos;\n#endif\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;\n#ifdef LOCAL\nreturn ((emitterWM*vec4(position,1.0)).xyz+worldOffset)+alignedCorner;\n#else\nreturn (position+worldOffset)+alignedCorner;\n#endif\n}\n#endif\nvoid main() {\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex/sheetInfos.z);float columnOffset=cellIndex-rowOffset*sheetInfos.z;vec2 uvScale=sheetInfos.xy;vec2 uvOffset=vec2(uv.x ,1.0-uv.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=uv;\n#endif\nfloat ratio=min(1.0,age/life);\n#ifdef COLORGRADIENTS\nvColor=texture2D(colorGradientSampler,vec2(ratio,0));\n#else\nvColor=color*vec4(1.0-ratio)+colorDead*vec4(ratio);\n#endif\nvec2 cornerPos=(offset-translationPivot)*size.yz*size.x;\n#ifdef BILLBOARD\nvec4 rotatedCorner;rotatedCorner.w=0.;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=(position+worldOffset)-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=(position+worldOffset)-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner.xyz);vec4 viewPosition=(view*vec4(vPositionW,1.0));\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;\n#ifdef LOCAL\nvec4 viewPosition=view*vec4(((emitterWM*vec4(position,1.0)).xyz+worldOffset),1.0)+rotatedCorner;\n#else\nvec4 viewPosition=view*vec4((position+worldOffset),1.0)+rotatedCorner;\n#endif\nvPositionW=(invView*viewPosition).xyz;\n#endif\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=0.;rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(initialDirection);vPositionW=rotate(yaxis,rotatedCorner);vec4 viewPosition=view*vec4(vPositionW,1.0);\n#endif\ngl_Position=projection*viewPosition;\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n}";r.d.ShadersStore[cK]=vK;class wK extends l{static get IsSupported(){if(!q.b.LastCreatedEngine)return!1;const K=q.b.LastCreatedEngine.getCaps();return K.supportTransformFeedbacks||K.supportComputeShaders}_createIndexBuffer(){this._linesIndexBufferUseInstancing=this._engine.createIndexBuffer(new Uint32Array([0,1,1,3,3,2,2,0,0,3]),void 0,"GPUParticleSystemLinesIndexBuffer")}getCapacity(){return this._capacity}get maxActiveParticleCount(){return this._maxActiveParticleCount}set maxActiveParticleCount(K){this._maxActiveParticleCount=Math.min(K,this._capacity)}get activeParticleCount(){return this.maxActiveParticleCount}set activeParticleCount(K){this.maxActiveParticleCount=K}createPointEmitter(K,b){const e=YK(K,b);return this.particleEmitterType=e,e}createHemisphericEmitter(){const K=AK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createSphereEmitter(){const K=XK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1);return this.particleEmitterType=K,K}createDirectedSphereEmitter(){const K=tK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:new z.k(0,1,0),arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.k(0,1,0));return this.particleEmitterType=K,K}createCylinderEmitter(){const K=UK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:0);return this.particleEmitterType=K,K}createDirectedCylinderEmitter(){const K=BK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.k(0,1,0),arguments.length>4&&void 0!==arguments[4]?arguments[4]:new z.k(0,1,0));return this.particleEmitterType=K,K}createConeEmitter(){const K=uK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4);return this.particleEmitterType=K,K}createDirectedConeEmitter(){const K=mK(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,arguments.length>1&&void 0!==arguments[1]?arguments[1]:Math.PI/4,arguments.length>2&&void 0!==arguments[2]?arguments[2]:new z.k(0,1,0),arguments.length>3&&void 0!==arguments[3]?arguments[3]:new z.k(0,1,0));return this.particleEmitterType=K,K}createBoxEmitter(K,b,e,z){const k=new X;return this.particleEmitterType=k,this.direction1=K,this.direction2=b,this.minEmitBox=e,this.maxEmitBox=z,k}isReady(){if(!this.j||this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.isReady()||!this.particleTexture||!this.particleTexture.isReady()||this._rebuildingAfterContextLost)return!1;if(this.blendMode!==DK.BLENDMODE_MULTIPLYADD){if(!this._getWrapper(this.blendMode).effect.isReady())return!1}else{if(!this._getWrapper(DK.BLENDMODE_MULTIPLY).effect.isReady())return!1;if(!this._getWrapper(DK.BLENDMODE_ADD).effect.isReady())return!1}return this._platform.isUpdateBufferCreated()?this._platform.isUpdateBufferReady():(this._recreateUpdateEffect(),!1)}isStarted(){return this._started}isStopped(){return this._stopped}isStopping(){return!1}getActiveCount(){return this._currentActiveCount}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.startDelay;if(!this.targetStopDuration&&this._hasTargetStopDurationDependantGradient())throw"Particle system started with a targetStopDuration dependant gradient (eg. startSizeGradients) but no targetStopDuration set";K?setTimeout((()=>{this.start(0)}),K):(this._started=!0,this._stopped=!1,this._preWarmDone=!1,this.beginAnimationOnStart&&this.animations&&this.animations.length>0&&this._scene&&this._scene.beginAnimation(this,this.beginAnimationFrom,this.beginAnimationTo,this.beginAnimationLoop))}stop(){this._stopped||(this.onStoppedObservable.notifyObservers(this),this._stopped=!0)}reset(){this._releaseBuffers(),this._platform.releaseVertexBuffers(),this._currentActiveCount=0,this._targetIndex=0}getClassName(){return"GPUParticleSystem"}getCustomEffect(){var K;let b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(null===(K=this._customWrappers[b])||void 0===K?void 0:K.effect)??this._customWrappers[0].effect}_getCustomDrawWrapper(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._customWrappers[K]??this._customWrappers[0]}setCustomEffect(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._customWrappers[b]=new KK.b(this._engine),this._customWrappers[b].effect=K}get onBeforeDrawParticlesObservable(){return this._onBeforeDrawParticlesObservable||(this._onBeforeDrawParticlesObservable=new f.d),this._onBeforeDrawParticlesObservable}get vertexShaderName(){return"gpuRenderParticles"}get vertexBuffers(){return this._renderVertexBuffers[1^this._targetIndex]}get indexBuffer(){return null}_removeGradientAndTexture(K,b,e){return super._removeGradientAndTexture(K,b,e),this._releaseBuffers(),this}addColorGradient(K,b){this._colorGradients||(this._colorGradients=[]);const e=new o(K,b);return this._colorGradients.push(e),this._refreshColorGradient(!0),this._releaseBuffers(),this}_refreshColorGradient(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._colorGradients&&(K&&this._colorGradients.sort(((K,b)=>K.gradient<b.gradient?-1:K.gradient>b.gradient?1:0)),this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null))}forceRefreshGradients(){this._refreshColorGradient(),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture"),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture"),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture"),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture"),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture"),this.reset()}removeColorGradient(K){return this._removeGradientAndTexture(K,this._colorGradients,this._colorGradientsTexture),this._colorGradientsTexture=null,this}resetDrawCache(){for(const b in this._drawWrappers){var K;null===(K=this._drawWrappers[b].drawContext)||void 0===K||K.reset()}}_addFactorGradient(K,b,e){const z=new H(b,e);K.push(z),this._releaseBuffers()}addSizeGradient(K,b){return this._sizeGradients||(this._sizeGradients=[]),this._addFactorGradient(this._sizeGradients,K,b),this._refreshFactorGradient(this._sizeGradients,"_sizeGradientsTexture",!0),this._releaseBuffers(),this}removeSizeGradient(K){return this._removeGradientAndTexture(K,this._sizeGradients,this._sizeGradientsTexture),this._sizeGradientsTexture=null,this}_refreshFactorGradient(K,b){if(!K)return;arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&K.sort(((K,b)=>K.gradient<b.gradient?-1:K.gradient>b.gradient?1:0));const e=this;e[b]&&(e[b].dispose(),e[b]=null)}addAngularSpeedGradient(K,b){return this._angularSpeedGradients||(this._angularSpeedGradients=[]),this._addFactorGradient(this._angularSpeedGradients,K,b),this._refreshFactorGradient(this._angularSpeedGradients,"_angularSpeedGradientsTexture",!0),this._releaseBuffers(),this}removeAngularSpeedGradient(K){return this._removeGradientAndTexture(K,this._angularSpeedGradients,this._angularSpeedGradientsTexture),this._angularSpeedGradientsTexture=null,this}addVelocityGradient(K,b){return this._velocityGradients||(this._velocityGradients=[]),this._addFactorGradient(this._velocityGradients,K,b),this._refreshFactorGradient(this._velocityGradients,"_velocityGradientsTexture",!0),this._releaseBuffers(),this}removeVelocityGradient(K){return this._removeGradientAndTexture(K,this._velocityGradients,this._velocityGradientsTexture),this._velocityGradientsTexture=null,this}addLimitVelocityGradient(K,b){return this._limitVelocityGradients||(this._limitVelocityGradients=[]),this._addFactorGradient(this._limitVelocityGradients,K,b),this._refreshFactorGradient(this._limitVelocityGradients,"_limitVelocityGradientsTexture",!0),this._releaseBuffers(),this}removeLimitVelocityGradient(K){return this._removeGradientAndTexture(K,this._limitVelocityGradients,this._limitVelocityGradientsTexture),this._limitVelocityGradientsTexture=null,this}addDragGradient(K,b){return this._dragGradients||(this._dragGradients=[]),this._addFactorGradient(this._dragGradients,K,b),this._refreshFactorGradient(this._dragGradients,"_dragGradientsTexture",!0),this._releaseBuffers(),this}removeDragGradient(K){return this._removeGradientAndTexture(K,this._dragGradients,this._dragGradientsTexture),this._dragGradientsTexture=null,this}addEmitRateGradient(){return this}removeEmitRateGradient(){return this}addStartSizeGradient(){return this}removeStartSizeGradient(){return this}addColorRemapGradient(){return this}removeColorRemapGradient(){return this}addAlphaRemapGradient(){return this}removeAlphaRemapGradient(){return this}addRampGradient(){return this}removeRampGradient(){return this}getRampGradients(){return null}get useRampGradients(){return!1}set useRampGradients(K){}addLifeTimeGradient(){return this}removeLifeTimeGradient(){return this}constructor(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(super(K),this.layerMask=268435455,this._accumulatedCount=0,this._renderVertexBuffers=[],this._targetIndex=0,this._currentRenderId=-1,this._currentRenderingCameraUniqueId=-1,this._started=!1,this._stopped=!1,this._timeDelta=0,this.updateInAnimate=!1,this._actualFrame=0,this._rawTextureWidth=256,this._rebuildingAfterContextLost=!1,this.Ui=new f.d,this.onStoppedObservable=new f.d,this.forceDepthWrite=!1,this._preWarmDone=!1,this.isLocal=!1,this.isGPU=!0,this._onBeforeDrawParticlesObservable=null,e&&"Scene"!==e.getClassName()?(this._engine=e,this.defaultProjectionMatrix=z.b.PerspectiveFovLH(.8,1,.1,100,this._engine.isNDCHalfZRange)):(this._scene=e||q.b.LastCreatedScene,this._engine=this._scene.getEngine(),this.uniqueId=this._scene.getUniqueId(),this._scene._i.push(this)),this._engine.getCaps().supportComputeShaders){if(!(0,F.d)("BABYLON.ComputeShaderParticleSystem"))throw new Error("The ComputeShaderParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,F.d)("BABYLON.ComputeShaderParticleSystem"))(this,this._engine)}else{if(!(0,F.d)("BABYLON.WebGL2ParticleSystem"))throw new Error("The WebGL2ParticleSystem class is not available! Make sure you have imported it.");this._platform=new((0,F.d)("BABYLON.WebGL2ParticleSystem"))(this,this._engine)}this._customWrappers={0:new KK.b(this._engine)},this._customWrappers[0].effect=k,this._drawWrappers={0:new KK.b(this._engine)},this._drawWrappers[0].drawContext&&(this._drawWrappers[0].drawContext.useInstancing=!0),this._createIndexBuffer(),this._attachImageProcessingConfiguration(null),(b=b??{}).randomTextureSize||delete b.randomTextureSize;const T={kb:5e4,randomTextureSize:this._engine.getCaps().maxTextureSize,...b},l=b;isFinite(l)&&(T.kb=l),this._capacity=T.kb,this._maxActiveParticleCount=T.kb,this._currentActiveCount=0,this._isAnimationSheetEnabled=j,this.particleEmitterType=new X;const Y=Math.min(this._engine.getCaps().maxTextureSize,T.randomTextureSize);let A=[];for(let z=0;z<Y;++z)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture=new V.e(new Float32Array(A),Y,1,5,e,!1,!1,1,1),this._randomTexture.name="GPUParticleSystem_random1",this._randomTexture.wrapU=1,this._randomTexture.wrapV=1,A=[];for(let z=0;z<Y;++z)A.push(Math.random()),A.push(Math.random()),A.push(Math.random()),A.push(Math.random());this._randomTexture2=new V.e(new Float32Array(A),Y,1,5,e,!1,!1,1,1),this._randomTexture2.name="GPUParticleSystem_random2",this._randomTexture2.wrapU=1,this._randomTexture2.wrapV=1,this._randomTextureSize=Y}_reset(){this._releaseBuffers()}_createVertexBuffers(K,b,e){const z={};z.position=b.createVertexBuffer("position",0,3,this._attributesStrideSize,!0);let k=3;z.age=b.createVertexBuffer("age",k,1,this._attributesStrideSize,!0),k+=1,z.size=b.createVertexBuffer("size",k,3,this._attributesStrideSize,!0),k+=3,z.life=b.createVertexBuffer("life",k,1,this._attributesStrideSize,!0),k+=1,k+=4,this.billboardMode===DK.BILLBOARDMODE_STRETCHED&&(z.direction=b.createVertexBuffer("direction",k,3,this._attributesStrideSize,!0)),k+=3,this._platform.alignDataInBuffer&&(k+=1),this.particleEmitterType instanceof Q&&(k+=3,this._platform.alignDataInBuffer&&(k+=1)),this._colorGradientsTexture||(z.color=b.createVertexBuffer("color",k,4,this._attributesStrideSize,!0),k+=4),this._isBillboardBased||(z.initialDirection=b.createVertexBuffer("initialDirection",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),this.noiseTexture&&(z.noiseCoordinates1=b.createVertexBuffer("noiseCoordinates1",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1),z.noiseCoordinates2=b.createVertexBuffer("noiseCoordinates2",k,3,this._attributesStrideSize,!0),k+=3,this._platform.alignDataInBuffer&&(k+=1)),z.angle=b.createVertexBuffer("angle",k,1,this._attributesStrideSize,!0),this._angularSpeedGradientsTexture?k++:k+=2,this._isAnimationSheetEnabled&&(z.cellIndex=b.createVertexBuffer("cellIndex",k,1,this._attributesStrideSize,!0),k+=1,this.spriteRandomStartCell&&(z.cellStartOffset=b.createVertexBuffer("cellStartOffset",k,1,this._attributesStrideSize,!0),k+=1)),z.offset=e.createVertexBuffer("offset",0,2),z.uv=e.createVertexBuffer("uv",2,2),this._renderVertexBuffers.push(z),this._platform.createVertexBuffers(K,z),this.resetDrawCache()}_initialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._buffer0&&!K)return;const b=this._engine,e=[];this._attributesStrideSize=21,this._targetIndex=0,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1),this.particleEmitterType instanceof Q&&(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this.isBillboardBased||(this._attributesStrideSize+=3,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=1)),this._colorGradientsTexture&&(this._attributesStrideSize-=4),this._angularSpeedGradientsTexture&&(this._attributesStrideSize-=1),this._isAnimationSheetEnabled&&(this._attributesStrideSize+=1,this.spriteRandomStartCell&&(this._attributesStrideSize+=1)),this.noiseTexture&&(this._attributesStrideSize+=6,this._platform.alignDataInBuffer&&(this._attributesStrideSize+=2)),this._platform.alignDataInBuffer&&(this._attributesStrideSize+=3-(this._attributesStrideSize+3&3));const k=this.particleEmitterType instanceof Q,j=z.e.gb[0];let T=0;for(let z=0;z<this._capacity;z++)if(e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(0),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),k?(this.particleEmitterType.particleDestinationGenerator(z,null,j),e.push(j.x),e.push(j.y),e.push(j.z)):(e.push(0),e.push(0),e.push(0)),this._platform.alignDataInBuffer&&e.push(0),T+=16,k&&(this.particleEmitterType.particlePositionGenerator(z,null,j),e.push(j.x),e.push(j.y),e.push(j.z),this._platform.alignDataInBuffer&&e.push(0),T+=4),this._colorGradientsTexture||(e.push(0),e.push(0),e.push(0),e.push(0),T+=4),this.isBillboardBased||(e.push(0),e.push(0),e.push(0),this._platform.alignDataInBuffer&&e.push(0),T+=4),this.noiseTexture&&(e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),this._platform.alignDataInBuffer&&e.push(0),e.push(Math.random()),e.push(Math.random()),e.push(Math.random()),this._platform.alignDataInBuffer&&e.push(0),T+=8),e.push(0),T+=1,this._angularSpeedGradientsTexture||(e.push(0),T+=1),this._isAnimationSheetEnabled&&(e.push(0),T+=1,this.spriteRandomStartCell&&(e.push(0),T+=1)),this._platform.alignDataInBuffer){let K=3-(T+3&3);for(T+=K;K-- >0;)e.push(0)}const F=new Float32Array([.5,.5,1,1,-.5,.5,0,1,.5,-.5,1,0,-.5,-.5,0,0]),l=this._platform.createParticleBuffer(e),Y=this._platform.createParticleBuffer(e);this._buffer0=new G.b(b,l,!1,this._attributesStrideSize),this._buffer1=new G.b(b,Y,!1,this._attributesStrideSize),this._spriteBuffer=new G.b(b,F,!1,4),this._renderVertexBuffers=[],this._createVertexBuffers(this._buffer0,this._buffer1,this._spriteBuffer),this._createVertexBuffers(this._buffer1,this._buffer0,this._spriteBuffer),this._sourceBuffer=this._buffer0,this._targetBuffer=this._buffer1}_recreateUpdateEffect(){this._createColorGradientTexture(),this._createSizeGradientTexture(),this._createAngularSpeedGradientTexture(),this._createVelocityGradientTexture(),this._createLimitVelocityGradientTexture(),this._createDragGradientTexture();let K=this.particleEmitterType?this.particleEmitterType.getEffectDefines():"";return this._isBillboardBased&&(K+="\n#define BILLBOARD"),this._colorGradientsTexture&&(K+="\n#define COLORGRADIENTS"),this._sizeGradientsTexture&&(K+="\n#define SIZEGRADIENTS"),this._angularSpeedGradientsTexture&&(K+="\n#define ANGULARSPEEDGRADIENTS"),this._velocityGradientsTexture&&(K+="\n#define VELOCITYGRADIENTS"),this._limitVelocityGradientsTexture&&(K+="\n#define LIMITVELOCITYGRADIENTS"),this._dragGradientsTexture&&(K+="\n#define DRAGGRADIENTS"),this.isAnimationSheetEnabled&&(K+="\n#define ANIMATESHEET",this.spriteRandomStartCell&&(K+="\n#define ANIMATESHEETRANDOMSTART")),this.noiseTexture&&(K+="\n#define NOISE"),this.isLocal&&(K+="\n#define LOCAL"),this._platform.isUpdateBufferCreated()&&this._cachedUpdateDefines===K||(this._cachedUpdateDefines=K,this._updateBuffer=this._platform.createUpdateBuffer(K)),this._platform.isUpdateBufferReady()}_getWrapper(K){const b=this._getCustomDrawWrapper(K);if(null!==b&&void 0!==b&&b.effect)return b;const e=[];this.fillDefines(e,K);let z=this._drawWrappers[K];z||(z=new KK.b(this._engine),z.drawContext&&(z.drawContext.useInstancing=!0),this._drawWrappers[K]=z);const k=e.join("\n");if(z.defines!==k){const K=[],b=[],e=[];this.fillUniformsAttributesAndSamplerNames(b,K,e),z.setEffect(this._engine.createEffect("gpuRenderParticles",K,b,e,k),k)}return z}static _GetAttributeNamesOrOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const k=[G.f.PositionKind,"age","life","size","angle"];return K||k.push(G.f.ColorKind),b&&k.push("cellIndex"),e||k.push("initialDirection"),z&&k.push("direction"),k.push("offset",G.f.UVKind),k}static _GetEffectCreationOptions(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=["emitterWM","Kf","view","projection","colorDead","invView","translationPivot","eyePosition"];return(0,bK.c)(z),K&&z.push("sheetInfos"),b&&z.push("logarithmicDepthConstant"),e&&(z.push("vFogInfos"),z.push("vFogColor")),z}fillDefines(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._scene&&((0,bK.j)(this,this._scene,K),this.applyFog&&this._scene.fogEnabled&&this._scene.fogMode!==xK.e.FOGMODE_NONE&&K.push("#define FOG")),b===DK.BLENDMODE_MULTIPLY&&K.push("#define BLENDMULTIPLYMODE"),this.isLocal&&K.push("#define LOCAL"),this.useLogarithmicDepth&&K.push("#define LOGARITHMICDEPTH"),this._isBillboardBased)switch(K.push("#define BILLBOARD"),this.billboardMode){case DK.BILLBOARDMODE_Y:K.push("#define BILLBOARDY");break;case DK.BILLBOARDMODE_STRETCHED:K.push("#define BILLBOARDSTRETCHED");break;case DK.BILLBOARDMODE_ALL:K.push("#define BILLBOARDMODE_ALL")}this._colorGradientsTexture&&K.push("#define COLORGRADIENTS"),this.isAnimationSheetEnabled&&K.push("#define ANIMATESHEET"),e&&this._imageProcessingConfiguration&&(this._imageProcessingConfiguration.prepareDefines(this._imageProcessingConfigurationDefines),K.push(""+this._imageProcessingConfigurationDefines.toString()))}fillUniformsAttributesAndSamplerNames(K,b,e){b.push(...wK._GetAttributeNamesOrOptions(!!this._colorGradientsTexture,this._isAnimationSheetEnabled,this._isBillboardBased,this._isBillboardBased&&this.billboardMode===DK.BILLBOARDMODE_STRETCHED)),K.push(...wK._GetEffectCreationOptions(this._isAnimationSheetEnabled,this.useLogarithmicDepth,this.applyFog)),e.push("diffuseSampler","colorGradientSampler"),this._imageProcessingConfiguration&&(IK.d.PrepareUniforms(K,this._imageProcessingConfigurationDefines),IK.d.PrepareSamplers(e,this._imageProcessingConfigurationDefines))}animate(){var K;let b=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._timeDelta=this.updateSpeed*(b?this.preWarmStepOffset:(null===(K=this._scene)||void 0===K?void 0:K.getAnimationRatio())||1),this._actualFrame+=this._timeDelta,this._stopped||this.targetStopDuration&&this._actualFrame>=this.targetStopDuration&&this.stop(),this.updateInAnimate&&this._update()}_createFactorGradientTexture(K,b){const e=this[b];if(!K||!K.length||e)return;const z=new Float32Array(this._rawTextureWidth);for(let k=0;k<this._rawTextureWidth;k++){const b=k/this._rawTextureWidth;W.GetCurrentGradient(b,K,((K,b,e)=>{z[k]=(0,Y.m)(K.factor1,b.factor1,e)}))}this[b]=V.e.CreateRTexture(z,this._rawTextureWidth,1,this._scene||this._engine,!1,!1,1),this[b].name=b.substring(1)}_createSizeGradientTexture(){this._createFactorGradientTexture(this._sizeGradients,"_sizeGradientsTexture")}_createAngularSpeedGradientTexture(){this._createFactorGradientTexture(this._angularSpeedGradients,"_angularSpeedGradientsTexture")}_createVelocityGradientTexture(){this._createFactorGradientTexture(this._velocityGradients,"_velocityGradientsTexture")}_createLimitVelocityGradientTexture(){this._createFactorGradientTexture(this._limitVelocityGradients,"_limitVelocityGradientsTexture")}_createDragGradientTexture(){this._createFactorGradientTexture(this._dragGradients,"_dragGradientsTexture")}_createColorGradientTexture(){if(!this._colorGradients||!this._colorGradients.length||this._colorGradientsTexture)return;const K=new Uint8Array(4*this._rawTextureWidth),b=T.i.pb[0];for(let e=0;e<this._rawTextureWidth;e++){const z=e/this._rawTextureWidth;W.GetCurrentGradient(z,this._colorGradients,((z,k,j)=>{T.g.LerpToRef(z.color1,k.color1,j,b),K[4*e]=255*b.r,K[4*e+1]=255*b.g,K[4*e+2]=255*b.b,K[4*e+3]=255*b.a}))}this._colorGradientsTexture=V.e.CreateRGBATexture(K,this._rawTextureWidth,1,this._scene,!1,!1,1),this._colorGradientsTexture.name="colorGradients"}_render(K,b){var e,k,j,T;const F=this._getWrapper(K),l=F.effect;this._engine.enableEffect(F);const Y=(null===(e=this._scene)||void 0===e?void 0:e.getViewMatrix())||z.b.IdentityReadOnly;if(l.setMatrix("view",Y),l.setMatrix("projection",this.defaultProjectionMatrix??this._scene.getProjectionMatrix()),l.setTexture("diffuseSampler",this.particleTexture),l.setVector2("translationPivot",this.translationPivot),l.setVector3("Kf",this.Kf),this.isLocal&&l.setMatrix("emitterWM",b),this._colorGradientsTexture?l.setTexture("colorGradientSampler",this._colorGradientsTexture):l.setDirectColor4("colorDead",this.colorDead),this._isAnimationSheetEnabled&&this.particleTexture){const K=this.particleTexture.getBaseSize();l.setFloat3("sheetInfos",this.spriteCellWidth/K.width,this.spriteCellHeight/K.height,K.width/this.spriteCellWidth)}if(this._isBillboardBased&&this._scene){const K=this._scene.activeCamera;l.setVector3("eyePosition",K.globalPosition)}const A=l.defines;if(this._scene&&((0,bK.d)(l,this,this._scene),this.applyFog&&(0,eK.h)(this._scene,void 0,l)),A.indexOf("#define BILLBOARDMODE_ALL")>=0){const K=Y.clone();K.invert(),l.setMatrix("invView",K)}switch(this.useLogarithmicDepth&&this._scene&&(0,eK.o)(A,l,this._scene),this._imageProcessingConfiguration&&!this._imageProcessingConfiguration.applyByPostProcess&&this._imageProcessingConfiguration.bind(l),K){case DK.BLENDMODE_ADD:this._engine.setAlphaMode(1);break;case DK.BLENDMODE_ONEONE:this._engine.setAlphaMode(6);break;case DK.BLENDMODE_STANDARD:this._engine.setAlphaMode(2);break;case DK.BLENDMODE_MULTIPLY:this._engine.setAlphaMode(4)}return this._platform.bindDrawBuffers(this._targetIndex,l,null!==(k=this._scene)&&void 0!==k&&k.forceWireframe?this._linesIndexBufferUseInstancing:null),this._onBeforeDrawParticlesObservable&&this._onBeforeDrawParticlesObservable.notifyObservers(l),null!==(j=this._scene)&&void 0!==j&&j.forceWireframe?this._engine.drawElementsType(6,0,10,this._currentActiveCount):this._engine.drawArraysType(7,0,4,this._currentActiveCount),this._engine.setAlphaMode(0),null!==(T=this._scene)&&void 0!==T&&T.forceWireframe&&this._engine.unbindInstanceAttributes(),this._currentActiveCount}_update(K){if(!this.j||!this._targetBuffer)return;if(!this._recreateUpdateEffect()||this._rebuildingAfterContextLost)return;if(!K)if(this.j.position){K=this.j.getWorldMatrix()}else{const b=this.j;K=z.e.Matrix[0],z.b.TranslationToRef(b.x,b.y,b.z,K)}this._platform.preUpdateParticleBuffer(),this._updateBuffer.setFloat("currentCount",this._currentActiveCount),this._updateBuffer.setFloat("timeDelta",this._timeDelta),this._updateBuffer.setFloat("stopFactor",this._stopped?0:1),this._updateBuffer.setInt("randomTextureSize",this._randomTextureSize),this._updateBuffer.setFloat2("lifeTime",this.minLifeTime,this.maxLifeTime),this._updateBuffer.setFloat2("emitPower",this.minEmitPower,this.maxEmitPower),this._colorGradientsTexture||(this._updateBuffer.setDirectColor4("color1",this.color1),this._updateBuffer.setDirectColor4("color2",this.color2)),this._updateBuffer.setFloat2("sizeRange",this.minSize,this.maxSize),this._updateBuffer.setFloat4("scaleRange",this.minScaleX,this.maxScaleX,this.minScaleY,this.maxScaleY),this._updateBuffer.setFloat4("angleRange",this.minAngularSpeed,this.maxAngularSpeed,this.minInitialRotation,this.maxInitialRotation),this._updateBuffer.setVector3("gravity",this.gravity),this._limitVelocityGradientsTexture&&this._updateBuffer.setFloat("limitVelocityDamping",this.limitVelocityDamping),this.particleEmitterType&&this.particleEmitterType.applyToShader(this._updateBuffer),this._isAnimationSheetEnabled&&this._updateBuffer.setFloat4("cellInfos",this.startSpriteCellID,this.endSpriteCellID,this.spriteCellChangeSpeed,this.spriteCellLoop?1:0),this.noiseTexture&&this._updateBuffer.setVector3("noiseStrength",this.noiseStrength),this.isLocal||this._updateBuffer.setMatrix("emitterWM",K),this._platform.updateParticleBuffer(this._targetIndex,this._targetBuffer,this._currentActiveCount),this._targetIndex++,2===this._targetIndex&&(this._targetIndex=0);const b=this._sourceBuffer;this._sourceBuffer=this._targetBuffer,this._targetBuffer=b}render(){let K,b=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._started)return 0;if(!this.isReady())return 0;if(!b&&this._scene){if(!this._preWarmDone&&this.preWarmCycles){for(let K=0;K<this.preWarmCycles;K++)this.animate(!0),this.render(!0,!0);this._preWarmDone=!0}if(this._currentRenderId===this._scene.getRenderId()&&(!this._scene.activeCamera||this._scene.activeCamera&&this._currentRenderingCameraUniqueId===this._scene.activeCamera.uniqueId))return 0;this._currentRenderId=this._scene.getRenderId(),this._scene.activeCamera&&(this._currentRenderingCameraUniqueId=this._scene.activeCamera.uniqueId)}if(this._initialize(),this._accumulatedCount+=this.emitRate*this._timeDelta,this._accumulatedCount>1){const K=0|this._accumulatedCount;this._accumulatedCount-=K,this._currentActiveCount+=K}if(this._currentActiveCount=Math.min(this._maxActiveParticleCount,this._currentActiveCount),!this._currentActiveCount)return 0;if(this.j.position){K=this.j.getWorldMatrix()}else{const b=this.j;K=z.e.Matrix[0],z.b.TranslationToRef(b.x,b.y,b.z,K)}const k=this._engine;this.updateInAnimate||this._update(K);let j=0;return b||e||(k.setState(!1),this.forceDepthWrite&&k.setDepthWrite(!0),j=this.blendMode===DK.BLENDMODE_MULTIPLYADD?this._render(DK.BLENDMODE_MULTIPLY,K)+this._render(DK.BLENDMODE_ADD,K):this._render(this.blendMode,K),this._engine.setAlphaMode(0)),j}rebuild(){const K=()=>{this._recreateUpdateEffect()&&this._platform.isUpdateBufferReady()?(this._initialize(!0),this._rebuildingAfterContextLost=!1):setTimeout(K,10)};this._createIndexBuffer(),this._cachedUpdateDefines="",this._platform.contextLost(),this._rebuildingAfterContextLost=!0,K()}_releaseBuffers(){this._buffer0&&(this._buffer0.dispose(),this._buffer0=null),this._buffer1&&(this._buffer1.dispose(),this._buffer1=null),this._spriteBuffer&&(this._spriteBuffer.dispose(),this._spriteBuffer=null),this._platform.releaseBuffers()}dispose(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const b in this._drawWrappers){this._drawWrappers[b].dispose()}if(this._drawWrappers={},this._scene){const K=this._scene._i.indexOf(this);K>-1&&this._scene._i.splice(K,1)}this._releaseBuffers(),this._platform.releaseVertexBuffers();for(let b=0;b<this._renderVertexBuffers.length;++b){const K=this._renderVertexBuffers[b];for(const b in K)K[b].dispose()}this._renderVertexBuffers=[],this._colorGradientsTexture&&(this._colorGradientsTexture.dispose(),this._colorGradientsTexture=null),this._sizeGradientsTexture&&(this._sizeGradientsTexture.dispose(),this._sizeGradientsTexture=null),this._angularSpeedGradientsTexture&&(this._angularSpeedGradientsTexture.dispose(),this._angularSpeedGradientsTexture=null),this._velocityGradientsTexture&&(this._velocityGradientsTexture.dispose(),this._velocityGradientsTexture=null),this._limitVelocityGradientsTexture&&(this._limitVelocityGradientsTexture.dispose(),this._limitVelocityGradientsTexture=null),this._dragGradientsTexture&&(this._dragGradientsTexture.dispose(),this._dragGradientsTexture=null),this._randomTexture&&(this._randomTexture.dispose(),this._randomTexture=null),this._randomTexture2&&(this._randomTexture2.dispose(),this._randomTexture2=null),K&&this.particleTexture&&(this.particleTexture.dispose(),this.particleTexture=null),K&&this.noiseTexture&&(this.noiseTexture.dispose(),this.noiseTexture=null),this.onStoppedObservable.clear(),this.Ui.notifyObservers(this),this.Ui.clear()}clone(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z={...this._customWrappers};let k=null;const j=this._engine;if(j.createEffectForParticles&&null!=this.customShader){k=this.customShader;const K=k.shaderOptions.defines.length>0?k.shaderOptions.defines.join("\n"):"";z[0]=j.createEffectForParticles(k.shaderPath.fragmentElement,k.shaderOptions.uniforms,k.shaderOptions.samplers,K,void 0,void 0,void 0,this)}const T=this.serialize(e),F=wK.Parse(T,this._scene||this._engine,this._rootUrl);return F.name=K,F.customShader=k,F._customWrappers=z,void 0===b&&(b=this.j),this.noiseTexture&&(F.noiseTexture=this.noiseTexture.clone()),F.j=b,F}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={};return DK._Serialize(b,this,K),b.activeParticleCount=this.activeParticleCount,b.randomTextureSize=this._randomTextureSize,b.customShader=this.customShader,b}static Parse(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4?arguments[4]:void 0;const j=K.name;let T,F;b instanceof lK.e?T=b:(F=b,T=F.getEngine());const l=new wK(j,{kb:k||K.kb,randomTextureSize:K.randomTextureSize},b,null,K.isAnimationSheetEnabled);if(l._rootUrl=e,K.customShader&&T.createEffectForParticles){const b=K.customShader,e=b.shaderOptions.defines.length>0?b.shaderOptions.defines.join("\n"):"",z=T.createEffectForParticles(b.shaderPath.fragmentElement,b.shaderOptions.uniforms,b.shaderOptions.samplers,e,void 0,void 0,void 0,l);l.setCustomEffect(z,0),l.customShader=b}return K.id&&(l.id=K.id),K.activeParticleCount&&(l.activeParticleCount=K.activeParticleCount),DK._Parse(K,l,b,e),K.preventAutoStart&&(l.preventAutoStart=K.preventAutoStart),z||l.preventAutoStart||l.start(),l}}var hK=e(10686),RK=e(11600),nK=e(10932);class PK{constructor(){this._emitterNodeIsOwned=!0,this.systems=[]}get emitterNode(){return this._emitterNode}set emitterNode(K){this._emitterNodeIsOwned&&this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!1);for(const b of this.systems)b.j=K;this._emitterNode=K}setEmitterAsSphere(K,b,e){this._emitterNodeIsOwned&&this._emitterNode&&this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNodeIsOwned=!0,this._emitterCreationOptions={kind:"Sphere",options:K,renderingGroupId:b};const z=(0,RK.e)("emitterSphere",{diameter:K.diameter,segments:K.segments},e);z.renderingGroupId=b;const k=new nK.c("emitterSphereMaterial",e);k.emissiveColor=K.color,z.material=k;for(const j of this.systems)j.j=z;this._emitterNode=z}start(K){for(const b of this.systems)K&&(b.j=K),b.start()}dispose(){for(const K of this.systems)K.dispose();this.systems.length=0,this._emitterNode&&(this._emitterNode.dispose&&this._emitterNode.dispose(),this._emitterNode=null)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const b={systems:[]};for(const e of this.systems)b.systems.push(e.serialize(K));return this._emitterNode&&(b.j=this._emitterCreationOptions),b}static Parse(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;const k=new PK,j=this.BaseAssetsUrl+"/textures/";b=b||q.b.LastCreatedScene;for(const T of K.systems)k.systems.push(e?wK.Parse(T,b,j,!0,z):DK.Parse(T,b,j,!0,z));if(K.j){const e=K.j.options;if("Sphere"===K.j.kind)k.setEmitterAsSphere({diameter:e.diameter,segments:e.segments,color:T.c.Bg(e.color)},K.j.renderingGroupId,b)}return k}}PK.BaseAssetsUrl="https://assets.babylonjs.com/particles";var dK=e(10718);class pK{static CreateDefault(K){let b,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,z=arguments.length>2?arguments[2]:void 0;return b=arguments.length>3&&void 0!==arguments[3]&&arguments[3]?new wK("default system",{kb:e},z):new DK("default system",e,z),b.j=K,b.particleTexture=new d.c("https://assets.babylonjs.com/textures/flare.png",b.va()),b.createConeEmitter(.1,Math.PI/4),b.color1=new T.g(1,1,1,1),b.color2=new T.g(1,1,1,1),b.colorDead=new T.g(1,1,1,0),b.minSize=.1,b.maxSize=.1,b.minEmitPower=2,b.maxEmitPower=2,b.updateSpeed=1/60,b.emitRate=30,b}static CreateAsync(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3?arguments[3]:void 0;b||(b=q.b.LastCreatedScene);const k={};return b.addPendingData(k),new Promise(((j,T)=>{if(e&&!wK.IsSupported)return b.removePendingData(k),T("Particle system with GPU is not supported.");hK.f.LoadFile(`${pK.BaseAssetsUrl}/systems/${K}.json`,(K=>{b.removePendingData(k);const T=JSON.parse(K.toString());return j(PK.Parse(T,b,e,z))}),void 0,void 0,void 0,(()=>(b.removePendingData(k),T(`An error occurred with the creation of your particle system. Check if your type '${K}' exists.`))))}))}static ExportSet(K){const b=new PK;for(const e of K)b.systems.push(e);return b}static ParseFromFileAsync(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",j=arguments.length>5?arguments[5]:void 0;return new Promise(((T,F)=>{const l=new dK.e;l.addEventListener("readystatechange",(()=>{if(4==l.readyState)if(200==l.status){const b=JSON.parse(l.responseText);let F;F=z?wK.Parse(b,e,k,!1,j):DK.Parse(b,e,k,!1,j),K&&(F.name=K),T(F)}else F("Unable to load the particle system")})),l.open("GET",b),l.send()}))}static ParseFromSnippetAsync(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",k=arguments.length>4?arguments[4]:void 0;if("_BLANK"===K){const K=this.CreateDefault(null);return K.start(),Promise.resolve(K)}return new Promise(((j,T)=>{const F=new dK.e;F.addEventListener("readystatechange",(()=>{if(4==F.readyState)if(200==F.status){const T=JSON.parse(JSON.parse(F.responseText).jsonPayload),l=JSON.parse(T.particleSystem);let Y;Y=e?wK.Parse(l,b,z,!1,k):DK.Parse(l,b,z,!1,k),Y.snippetId=K,j(Y)}else T("Unable to load the snippet "+K)})),F.open("GET",this.SnippetUrl+"/"+K.replace(/#/g,"/")),F.send()}))}}pK.BaseAssetsUrl=PK.BaseAssetsUrl,pK.SnippetUrl="https://snippet.babylonjs.com",pK.CreateFromSnippetAsync=pK.ParseFromSnippetAsync;var aK=e(11226),OK=e(11049),gK=e(11609);(0,gK.g)(OK.e.NAME_PARTICLESYSTEM,((K,b,e,z)=>{const k=(0,gK.i)(OK.e.NAME_PARTICLESYSTEM);if(k&&void 0!==K._i&&null!==K._i)for(let j=0,T=K._i.length;j<T;j++){const T=K._i[j];e._i.push(k(T,b,z))}})),(0,gK.d)(OK.e.NAME_PARTICLESYSTEM,((K,b,e)=>{if(K.activeParticleCount){return wK.Parse(K,b,e)}return DK.Parse(K,b,e)})),lK.e.prototype.createEffectForParticles=function(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],z=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",j=arguments.length>4?arguments[4]:void 0,T=arguments.length>5?arguments[5]:void 0,F=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,Y=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,A=[],X=[];const t=[];return l?l.fillUniformsAttributesAndSamplerNames(X,A,t):(A=DK._GetAttributeNamesOrOptions(),X=DK._GetEffectCreationOptions()),-1===k.indexOf(" BILLBOARD")&&(k+="\n#define BILLBOARD\n"),null!==l&&void 0!==l&&l.isAnimationSheetEnabled&&-1===k.indexOf(" ANIMATESHEET")&&(k+="\n#define ANIMATESHEET\n"),-1===z.indexOf("diffuseSampler")&&z.push("diffuseSampler"),this.createEffect({vertex:(null===l||void 0===l?void 0:l.vertexShaderName)??"particles",fragmentElement:K},A,X.concat(b),t.concat(z),k,j,T,F,void 0,Y,(async()=>{0===Y?await Promise.resolve().then(e.bind(e,11634)):await Promise.resolve().then(e.bind(e,11685))}))},aK.b.prototype.getEmittedParticleSystems=function(){const K=[];for(let b=0;b<this.va()._i.length;b++){const e=this.va()._i[b];e.j===this&&K.push(e)}return K},aK.b.prototype.getHierarchyEmittedParticleSystems=function(){const K=[],b=this.getDescendants();b.push(this);for(let e=0;e<this.va()._i.length;e++){const z=this.va()._i[e],k=z.j;k.position&&-1!==b.indexOf(k)&&K.push(z)}return K};e(11100),e(11111),e(11283);e(11261),e(11617),e(11291),e(11089),e(11294);e(11485);var NK;e(11620),e(11170);!function(K){K[K.Color=2]="Color",K[K.UV=1]="UV",K[K.Random=0]="Random",K[K.Stated=3]="Stated"}(NK||(NK={}));e(11626),e(11634),e(11646),e(11685)},11518:(K,b,e)=>{"use strict";e.d(b,{b:()=>B});var z=e(10936),k=e(10951),j=e(10690),T=e(10967),F=e(10756),l=e(10938),Y=e(11001),A=e(10799),X=e(10750),t=e(10803),U=e(11524);X.e.prototype.setTextureFromPostProcess=function(K,b,e){var z;let k=null;b&&(b._forcedOutputTexture?k=b._forcedOutputTexture:b._textures.data[b._currentRenderTextureInd]&&(k=b._textures.data[b._currentRenderTextureInd])),this._bindTexture(K,(null===(z=k)||void 0===z?void 0:z.texture)??null,e)},X.e.prototype.setTextureFromPostProcessOutput=function(K,b,e){var z;this._bindTexture(K,(null===b||void 0===b||null===(z=b._outputTexture)||void 0===z?void 0:z.texture)??null,e)},F.d.prototype.setTextureFromPostProcess=function(K,b){this._engine.setTextureFromPostProcess(this._samplers[K],b,K)},F.d.prototype.setTextureFromPostProcessOutput=function(K,b){this._engine.setTextureFromPostProcessOutput(this._samplers[K],b,K)};class B{static get ForceGLSL(){return U.g.ForceGLSL}static set ForceGLSL(K){U.g.ForceGLSL=K}static RegisterShaderCodeProcessing(K,b){U.g.RegisterShaderCodeProcessing(K,b)}get name(){return this._effectWrapper.name}set name(K){this._effectWrapper.name=K}get alphaMode(){return this._effectWrapper.alphaMode}set alphaMode(K){this._effectWrapper.alphaMode=K}get samples(){return this._samples}set samples(K){this._samples=Math.min(K,this._engine.getCaps().maxMSAASamples),this._textures.forEach((K=>{K.setSamples(this._samples)}))}get shaderLanguage(){return this._shaderLanguage}getEffectName(){return this._fragmentUrl}set onActivate(K){this._onActivateObserver&&this.onActivateObservable.remove(this._onActivateObserver),K&&(this._onActivateObserver=this.onActivateObservable.add(K))}set onSizeChanged(K){this._onSizeChangedObserver&&this.onSizeChangedObservable.remove(this._onSizeChangedObserver),this._onSizeChangedObserver=this.onSizeChangedObservable.add(K)}set onApply(K){this._onApplyObserver&&this.onApplyObservable.remove(this._onApplyObserver),this._onApplyObserver=this.onApplyObservable.add(K)}set onBeforeRender(K){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(K)}set onAfterRender(K){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(K)}get inputTexture(){return this._textures.data[this._currentRenderTextureInd]}set inputTexture(K){this._forcedOutputTexture=K}restoreDefaultInputTexture(){this._forcedOutputTexture&&(this._forcedOutputTexture=null,this.markTextureDirty())}getCamera(){return this._camera}get texelSize(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.texelSize:(this._forcedOutputTexture&&this._texelSize.Yd(1/this._forcedOutputTexture.width,1/this._forcedOutputTexture.height),this._texelSize)}constructor(K,b,e,z,F,l){var Y;let A=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,X=arguments.length>7?arguments[7]:void 0,t=arguments.length>8?arguments[8]:void 0,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:null,m=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,D=arguments.length>11&&void 0!==arguments[11]?arguments[11]:"postprocess",I=arguments.length>12?arguments[12]:void 0,x=arguments.length>13&&void 0!==arguments[13]&&arguments[13],Q=arguments.length>14&&void 0!==arguments[14]?arguments[14]:5,G=arguments.length>15?arguments[15]:void 0,i=arguments.length>16?arguments[16]:void 0;this._parentContainer=null,this.width=-1,this.height=-1,this.nodeMaterialSource=null,this._outputTexture=null,this.Ci=!0,this.forceAutoClearInAlphaMode=!1,this.animations=[],this.enablePixelPerfectMode=!1,this.forceFullscreenViewport=!0,this.scaleMode=1,this.alwaysForcePOT=!1,this._samples=1,this.adaptScaleToCurrentViewport=!1,this._webGPUReady=!1,this._reusable=!1,this._renderId=0,this.externalTextureSamplerBinding=!1,this._textures=new k.h(2),this._textureCache=[],this._currentRenderTextureInd=0,this._scaleRatio=new T.h(1,1),this._texelSize=T.h.Zero(),this.onActivateObservable=new j.d,this.onSizeChangedObservable=new j.d,this.onApplyObservable=new j.d,this.onBeforeRenderObservable=new j.d,this.onAfterRenderObservable=new j.d;let S,M=1,r=null;if(e&&!Array.isArray(e)){const K=e;e=K.uniforms??null,z=K.samplers??null,M=K.size??1,l=K.camera??null,A=K.samplingMode??1,X=K.kd,t=K.reusable,u=Array.isArray(K.defines)?K.defines.join("\n"):K.defines??null,m=K.textureType??0,D=K.vertexUrl??"postprocess",I=K.indexParameters,x=K.blockCompilation??!1,Q=K.textureFormat??5,G=K.shaderLanguage??0,r=K.uniformBuffers??null,i=K.extraInitializations,S=K.effectWrapper}else F&&(M="number"===typeof F?F:{width:F.width,height:F.height});const L=!!S;if(this._effectWrapper=S??new U.g({name:K,useShaderStore:!0,useAsPostProcess:!0,fragmentShader:b,kd:X||(null===(Y=l)||void 0===Y?void 0:Y.va().getEngine()),uniforms:e,samplers:z,uniformBuffers:r,defines:u,vertexUrl:D,indexParameters:I,blockCompilation:x,shaderLanguage:G,extraInitializations:i}),this.name=K,this.onEffectCreatedObservable=this._effectWrapper.onEffectCreatedObservable,null!=l?(this._camera=l,this._scene=l.va(),l.attachPostProcess(this),this._engine=this._scene.getEngine(),this._scene.postProcesses.push(this),this.uniqueId=this._scene.getUniqueId()):X&&(this._engine=X,this._engine.postProcesses.push(this)),this._options=M,this.renderTargetSamplingMode=A||1,this._reusable=t||!1,this._textureType=m,this._textureFormat=Q,this._shaderLanguage=G||0,this._samplers=z||[],-1===this._samplers.indexOf("textureSampler")&&this._samplers.push("textureSampler"),this._fragmentUrl=b,this._vertexUrl=D,this._parameters=e||[],-1===this._parameters.indexOf("scale")&&this._parameters.push("scale"),this._uniformBuffers=r||[],this._indexParameters=I,!L){this._webGPUReady=1===this._shaderLanguage;const K=[];this._gatherImports(this._engine.isWebGPU&&!B.ForceGLSL,K),this._effectWrapper._webGPUReady=this._webGPUReady,this._effectWrapper._postConstructor(x,u,i,K)}}_gatherImports(){let K=arguments.length>1?arguments[1]:void 0;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._webGPUReady?K.push(Promise.all([e.e(37).then(e.bind(e,13186))])):K.push(Promise.all([Promise.resolve().then(e.bind(e,11527))]))}getClassName(){return"PostProcess"}getEngine(){return this._engine}getEffect(){return this._effectWrapper.drawWrapper.effect}shareOutputWith(K){return this._disposeTextures(),this._shareOutputWithPostProcess=K,this}useOwnOutput(){0==this._textures.length&&(this._textures=new k.h(2)),this._shareOutputWithPostProcess=null}updateEffect(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3?arguments[3]:void 0,k=arguments.length>4?arguments[4]:void 0,j=arguments.length>5?arguments[5]:void 0,T=arguments.length>6?arguments[6]:void 0,F=arguments.length>7?arguments[7]:void 0;this._effectWrapper.updateEffect(K,b,e,z,k,j,T,F),this._postProcessDefines=Array.isArray(this._effectWrapper.options.defines)?this._effectWrapper.options.defines.join("\n"):this._effectWrapper.options.defines}isReusable(){return this._reusable}markTextureDirty(){this.width=-1}_createRenderTargetTexture(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(let k=0;k<this._textureCache.length;k++)if(this._textureCache[k].texture.width===K.width&&this._textureCache[k].texture.height===K.height&&this._textureCache[k].postProcessChannel===e&&this._textureCache[k].texture._generateDepthBuffer===b.generateDepthBuffer&&this._textureCache[k].texture.samples===b.samples)return this._textureCache[k].texture;const z=this._engine.createRenderTargetTexture(K,b);return this._textureCache.push({texture:z,postProcessChannel:e,lastUsedRenderId:-1}),z}_flushTextureCache(){const K=this._renderId;for(let b=this._textureCache.length-1;b>=0;b--)if(K-this._textureCache[b].lastUsedRenderId>100){let K=!1;for(let e=0;e<this._textures.length;e++)if(this._textures.data[e]===this._textureCache[b].texture){K=!0;break}K||(this._textureCache[b].texture.dispose(),this._textureCache.splice(b,1))}}resize(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]&&arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this._textures.length>0&&this._textures.reset(),this.width=K,this.height=b;let j=null;if(e)for(let l=0;l<e._postProcesses.length;l++)if(null!==e._postProcesses[l]){j=e._postProcesses[l];break}const T={width:this.width,height:this.height},F={generateMipMaps:z,generateDepthBuffer:k||j===this,generateStencilBuffer:(k||j===this)&&this._engine.isStencilEnable,samplingMode:this.renderTargetSamplingMode,type:this._textureType,format:this._textureFormat,samples:this._samples,label:"PostProcessRTT-"+this.name};this._textures.push(this._createRenderTargetTexture(T,F,0)),this._reusable&&this._textures.push(this._createRenderTargetTexture(T,F,1)),this._texelSize.Yd(1/this.width,1/this.height),this.onSizeChangedObservable.notifyObservers(this)}_getTarget(){let K;if(this._shareOutputWithPostProcess)K=this._shareOutputWithPostProcess.inputTexture;else if(this._forcedOutputTexture)K=this._forcedOutputTexture,this.width=this._forcedOutputTexture.width,this.height=this._forcedOutputTexture.height;else{let b;K=this.inputTexture;for(let e=0;e<this._textureCache.length;e++)if(this._textureCache[e].texture===K){b=this._textureCache[e];break}b&&(b.lastUsedRenderId=this._renderId)}return K}activate(K){var b,e;let z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,k=arguments.length>2?arguments[2]:void 0;const j=(K=K||this._camera).va(),T=j.getEngine(),F=T.getCaps().maxTextureSize,l=(z?z.width:this._engine.getRenderWidth(!0))*this._options|0,Y=(z?z.height:this._engine.getRenderHeight(!0))*this._options|0;let A=this._options.width||l,X=this._options.height||Y;const U=7!==this.renderTargetSamplingMode&&1!==this.renderTargetSamplingMode&&2!==this.renderTargetSamplingMode;let B=null;if(!this._shareOutputWithPostProcess&&!this._forcedOutputTexture){if(this.adaptScaleToCurrentViewport){const K=T.currentViewport;K&&(A*=K.width,X*=K.height)}(U||this.alwaysForcePOT)&&(this._options.width||(A=T.needPOTTextures?(0,t.g)(A,F,this.scaleMode):A),this._options.height||(X=T.needPOTTextures?(0,t.g)(X,F,this.scaleMode):X)),this.width===A&&this.height===X&&(B=this._getTarget())||this.resize(A,X,K,U,k),this._textures.forEach((K=>{K.samples!==this.samples&&this._engine.updateRenderTargetTextureSampleCount(K,this.samples)})),this._flushTextureCache(),this._renderId++}return B||(B=this._getTarget()),this.enablePixelPerfectMode?(this._scaleRatio.Yd(l/A,Y/X),this._engine.bindFramebuffer(B,0,l,Y,this.forceFullscreenViewport)):(this._scaleRatio.Yd(1,1),this._engine.bindFramebuffer(B,0,void 0,void 0,this.forceFullscreenViewport)),null===(b=(e=this._engine)._debugInsertMarker)||void 0===b||b.call(e,`post process ${this.name} input`),this.onActivateObservable.notifyObservers(K),this.Ci&&(0===this.alphaMode||this.forceAutoClearInAlphaMode)&&this._engine.clear(this.clearColor?this.clearColor:j.clearColor,j._allowPostProcessClearColor,!0,!0),this._reusable&&(this._currentRenderTextureInd=(this._currentRenderTextureInd+1)%2),B}get isSupported(){return this._effectWrapper.drawWrapper.effect.isSupported}get aspectRatio(){return this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.aspectRatio:this._forcedOutputTexture?this._forcedOutputTexture.width/this._forcedOutputTexture.height:this.width/this.height}isReady(){return this._effectWrapper.isReady()}apply(){if(!this._effectWrapper.isReady())return null;let K;var b;(this._engine.enableEffect(this._effectWrapper.drawWrapper),this._engine.setState(!1),this._engine.setDepthBuffer(!1),this._engine.setDepthWrite(!1),this.alphaConstants&&this.getEngine().setAlphaConstants(this.alphaConstants.r,this.alphaConstants.g,this.alphaConstants.b,this.alphaConstants.a),K=this._shareOutputWithPostProcess?this._shareOutputWithPostProcess.inputTexture:this._forcedOutputTexture?this._forcedOutputTexture:this.inputTexture,this.externalTextureSamplerBinding)||this._effectWrapper.drawWrapper.effect._bindTexture("textureSampler",null===(b=K)||void 0===b?void 0:b.texture);return this._effectWrapper.drawWrapper.effect.setVector2("scale",this._scaleRatio),this.onApplyObservable.notifyObservers(this._effectWrapper.drawWrapper.effect),this._effectWrapper.bind(),this._effectWrapper.drawWrapper.effect}_disposeTextures(){this._shareOutputWithPostProcess||this._forcedOutputTexture?this._disposeTextureCache():(this._disposeTextureCache(),this._textures.dispose())}_disposeTextureCache(){for(let K=this._textureCache.length-1;K>=0;K--)this._textureCache[K].texture.dispose();this._textureCache.length=0}setPrePassRenderer(K){return!!this._prePassEffectConfiguration&&(this._prePassEffectConfiguration=K.addEffectConfiguration(this._prePassEffectConfiguration),this._prePassEffectConfiguration.enabled=!0,!0)}dispose(K){let b;if(K=K||this._camera,this._disposeTextures(),this._scene&&(b=this._scene.postProcesses.indexOf(this),-1!==b&&this._scene.postProcesses.splice(b,1)),this._parentContainer){const K=this._parentContainer.postProcesses.indexOf(this);K>-1&&this._parentContainer.postProcesses.splice(K,1),this._parentContainer=null}if(b=this._engine.postProcesses.indexOf(this),-1!==b&&this._engine.postProcesses.splice(b,1),K){if(K.detachPostProcess(this),b=K._postProcesses.indexOf(this),0===b&&K._postProcesses.length>0){const K=this._camera._getFirstPostProcess();K&&K.markTextureDirty()}this.onActivateObservable.clear(),this.onAfterRenderObservable.clear(),this.onApplyObservable.clear(),this.onBeforeRenderObservable.clear(),this.onSizeChangedObservable.clear(),this.onEffectCreatedObservable.clear()}}serialize(){const K=Y.e.Serialize(this),b=this.getCamera()||this._scene&&this._scene.activeCamera;return K.customType="BABYLON."+this.getClassName(),K.cameraId=b?b.id:null,K.reusable=this._reusable,K.textureType=this._textureType,K.fragmentUrl=this._fragmentUrl,K.parameters=this._parameters,K.samplers=this._samplers,K.uniformBuffers=this._uniformBuffers,K.options=this._options,K.defines=this._postProcessDefines,K.textureFormat=this._textureFormat,K.vertexUrl=this._vertexUrl,K.indexParameters=this._indexParameters,K}clone(){const K=this.serialize();K._engine=this._engine,K.cameraId=null;const b=B.Parse(K,this._scene,"");return b?(b.onActivateObservable=this.onActivateObservable.clone(),b.onSizeChangedObservable=this.onSizeChangedObservable.clone(),b.onApplyObservable=this.onApplyObservable.clone(),b.onBeforeRenderObservable=this.onBeforeRenderObservable.clone(),b.onAfterRenderObservable=this.onAfterRenderObservable.clone(),b._prePassEffectConfiguration=this._prePassEffectConfiguration,b):null}static Parse(K,b,e){const z=(0,A.d)(K.customType);if(!z||!z._Parse)return null;const k=b?b.getCameraById(K.cameraId):null;return z._Parse(K,k,b,e)}static _Parse(K,b,e,z){return Y.e.Parse((()=>new B(K.name,K.fragmentUrl,K.parameters,K.samplers,K.options,b,K.renderTargetSamplingMode,K._engine,K.reusable,K.defines,K.textureType,K.vertexUrl,K.indexParameters,!1,K.textureFormat)),K,e,z)}}(0,z.b)([(0,l.M)()],B.prototype,"uniqueId",void 0),(0,z.b)([(0,l.M)()],B.prototype,"name",null),(0,z.b)([(0,l.M)()],B.prototype,"width",void 0),(0,z.b)([(0,l.M)()],B.prototype,"height",void 0),(0,z.b)([(0,l.M)()],B.prototype,"renderTargetSamplingMode",void 0),(0,z.b)([(0,l.n)()],B.prototype,"clearColor",void 0),(0,z.b)([(0,l.M)()],B.prototype,"Ci",void 0),(0,z.b)([(0,l.M)()],B.prototype,"forceAutoClearInAlphaMode",void 0),(0,z.b)([(0,l.M)()],B.prototype,"alphaMode",null),(0,z.b)([(0,l.M)()],B.prototype,"alphaConstants",void 0),(0,z.b)([(0,l.M)()],B.prototype,"enablePixelPerfectMode",void 0),(0,z.b)([(0,l.M)()],B.prototype,"forceFullscreenViewport",void 0),(0,z.b)([(0,l.M)()],B.prototype,"scaleMode",void 0),(0,z.b)([(0,l.M)()],B.prototype,"alwaysForcePOT",void 0),(0,z.b)([(0,l.M)("samples")],B.prototype,"_samples",void 0),(0,z.b)([(0,l.M)()],B.prototype,"adaptScaleToCurrentViewport",void 0),(0,A.e)("BABYLON.PostProcess",B)},11037:(K,b,e)=>{"use strict";e.d(b,{b:()=>j});var z=e(11030),k=e(10690);class j{constructor(K){this._vertexBuffers={},this.onBeforeRenderObservable=new k.d,this._scene=K}_prepareBuffers(){if(this._vertexBuffers[z.f.PositionKind])return;const K=[];K.push(1,1),K.push(-1,1),K.push(-1,-1),K.push(1,-1),this._vertexBuffers[z.f.PositionKind]=new z.f(this._scene.getEngine(),K,z.f.PositionKind,!1,!1,2),this._buildIndexBuffer()}_buildIndexBuffer(){const K=[];K.push(0),K.push(1),K.push(2),K.push(0),K.push(2),K.push(3),this._indexBuffer=this._scene.getEngine().createIndexBuffer(K)}_rebuild(){const K=this._vertexBuffers[z.f.PositionKind];K&&(K._rebuild(),this._buildIndexBuffer())}_prepareFrame(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=this._scene.activeCamera;return!!e&&(b=b||e._postProcesses.filter((K=>null!=K)),!(!b||0===b.length||!this._scene.postProcessesEnabled)&&(b[0].activate(e,K,null!==b&&void 0!==b),!0))}directRender(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]&&arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5];const T=this._scene.getEngine();for(let l=0;l<K.length;l++){var F;if(l<K.length-1)K[l+1].activate(this._scene.activeCamera,null===b||void 0===b?void 0:b.texture);else b?T.bindFramebuffer(b,z,void 0,void 0,e,k):j||T.restoreDefaultFramebuffer(),null===(F=T._debugInsertMarker)||void 0===F||F.call(T,`post process ${K[l].name} output`);const Y=K[l],A=Y.apply();A&&(Y.onBeforeRenderObservable.notifyObservers(A),this._prepareBuffers(),T.bindBuffers(this._vertexBuffers,this._indexBuffer,A),T.drawElementsType(0,0,6),Y.onAfterRenderObservable.notifyObservers(A))}T.setDepthBuffer(!0),T.setDepthWrite(!0)}_finalizeFrame(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const j=this._scene.activeCamera;if(!j)return;if(this.onBeforeRenderObservable.notifyObservers(this),0===(z=z||j._postProcesses.filter((K=>null!=K))).length||!this._scene.postProcessesEnabled)return;const T=this._scene.getEngine();for(let l=0,Y=z.length;l<Y;l++){const A=z[l];var F;if(l<Y-1)A._outputTexture=z[l+1].activate(j,null===b||void 0===b?void 0:b.texture);else b?(T.bindFramebuffer(b,e,void 0,void 0,k),A._outputTexture=b):(T.restoreDefaultFramebuffer(),A._outputTexture=null),null===(F=T._debugInsertMarker)||void 0===F||F.call(T,`post process ${z[l].name} output`);if(K)break;const X=A.apply();X&&(A.onBeforeRenderObservable.notifyObservers(X),this._prepareBuffers(),T.bindBuffers(this._vertexBuffers,this._indexBuffer,X),T.drawElementsType(0,0,6),A.onAfterRenderObservable.notifyObservers(X))}T.setDepthBuffer(!0),T.setDepthWrite(!0),T.setAlphaMode(0)}dispose(){const K=this._vertexBuffers[z.f.PositionKind];K&&(K.dispose(),this._vertexBuffers[z.f.PositionKind]=null),this._indexBuffer&&(this._scene.getEngine()._releaseBuffer(this._indexBuffer),this._indexBuffer=null)}}},11046:(K,b,e)=>{"use strict";e.d(b,{c:()=>F});var z=e(10951),k=e(10967);class j{set opaqueSortCompareFn(K){this._opaqueSortCompareFn=K||j.PainterSortCompare,this._renderOpaque=this._renderOpaqueSorted}set alphaTestSortCompareFn(K){this._alphaTestSortCompareFn=K||j.PainterSortCompare,this._renderAlphaTest=this._renderAlphaTestSorted}set transparentSortCompareFn(K){this._transparentSortCompareFn=K||j.defaultTransparentSortCompare,this._renderTransparent=this._renderTransparentSorted}constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,j=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this.index=K,this._opaqueSubMeshes=new z.h(256),this._transparentSubMeshes=new z.h(256),this._alphaTestSubMeshes=new z.h(256),this._depthOnlySubMeshes=new z.h(256),this._particleSystems=new z.h(256),this._spriteManagers=new z.h(256),this._empty=!0,this._edgesRenderers=new z.e(16),this._scene=b,this.opaqueSortCompareFn=e,this.alphaTestSortCompareFn=k,this.transparentSortCompareFn=j}render(K,b,e,z){if(K)return void K(this._opaqueSubMeshes,this._alphaTestSubMeshes,this._transparentSubMeshes,this._depthOnlySubMeshes);const k=this._scene.getEngine();0!==this._depthOnlySubMeshes.length&&(k.setColorWrite(!1),this._renderAlphaTest(this._depthOnlySubMeshes),k.setColorWrite(!0)),0!==this._opaqueSubMeshes.length&&this._renderOpaque(this._opaqueSubMeshes),0!==this._alphaTestSubMeshes.length&&this._renderAlphaTest(this._alphaTestSubMeshes);const j=k.getStencilBuffer();if(k.setStencilBuffer(!1),b&&this._renderSprites(),e&&this._renderParticles(z),this.onBeforeTransparentRendering&&this.onBeforeTransparentRendering(),0!==this._transparentSubMeshes.length||this._scene.useOrderIndependentTransparency){if(k.setStencilBuffer(j),this._scene.useOrderIndependentTransparency){const K=this._scene.depthPeelingRenderer.render(this._transparentSubMeshes);K.length&&this._renderTransparent(K)}else this._renderTransparent(this._transparentSubMeshes);k.setAlphaMode(0)}if(k.setStencilBuffer(!1),this._edgesRenderers.length){for(let K=0;K<this._edgesRenderers.length;K++)this._edgesRenderers.data[K].render();k.setAlphaMode(0)}k.setStencilBuffer(j)}_renderOpaqueSorted(K){j._RenderSorted(K,this._opaqueSortCompareFn,this._scene.activeCamera,!1)}_renderAlphaTestSorted(K){j._RenderSorted(K,this._alphaTestSortCompareFn,this._scene.activeCamera,!1)}_renderTransparentSorted(K){j._RenderSorted(K,this._transparentSortCompareFn,this._scene.activeCamera,!0)}static _RenderSorted(K,b,e,z){let T,F=0;const l=e?e.globalPosition:j._ZeroVector;if(z)for(;F<K.length;F++)T=K.data[F],T._alphaIndex=T.getMesh().alphaIndex,T._distanceToCamera=k.k.Distance(T.getBoundingInfo().boundingSphere.centerWorld,l);const Y=K.length===K.data.length?K.data:K.data.slice(0,K.length);b&&Y.sort(b);const A=Y[0].getMesh().va();for(F=0;F<Y.length;F++)if(T=Y[F],!A._activeMeshesFrozenButKeepClipping||T.isInFrustum(A._frustumPlanes)){if(z){const K=T.Ha();if(K&&K.needDepthPrePass){const b=K.va().getEngine();b.setColorWrite(!1),b.setAlphaMode(0),T.render(!1),b.setColorWrite(!0)}}T.render(z)}}static defaultTransparentSortCompare(K,b){return K._alphaIndex>b._alphaIndex?1:K._alphaIndex<b._alphaIndex?-1:j.backToFrontSortCompare(K,b)}static backToFrontSortCompare(K,b){return K._distanceToCamera<b._distanceToCamera?1:K._distanceToCamera>b._distanceToCamera?-1:0}static frontToBackSortCompare(K,b){return K._distanceToCamera<b._distanceToCamera?-1:K._distanceToCamera>b._distanceToCamera?1:0}static PainterSortCompare(K,b){const e=K.getMesh(),z=b.getMesh();return e.material&&z.material?e.material.uniqueId-z.material.uniqueId:e.uniqueId-z.uniqueId}prepare(){this._opaqueSubMeshes.reset(),this._transparentSubMeshes.reset(),this._alphaTestSubMeshes.reset(),this._depthOnlySubMeshes.reset(),this._particleSystems.reset(),this.prepareSprites(),this._edgesRenderers.reset(),this._empty=!0}prepareSprites(){this._spriteManagers.reset()}dispose(){this._opaqueSubMeshes.dispose(),this._transparentSubMeshes.dispose(),this._alphaTestSubMeshes.dispose(),this._depthOnlySubMeshes.dispose(),this._particleSystems.dispose(),this._spriteManagers.dispose(),this._edgesRenderers.dispose()}dispatch(K,b,e){void 0===b&&(b=K.getMesh()),void 0===e&&(e=K.Ha()),null!==e&&void 0!==e&&(e.needAlphaBlendingForMesh(b)?this._transparentSubMeshes.push(K):e.needAlphaTesting()?(e.needDepthPrePass&&this._depthOnlySubMeshes.push(K),this._alphaTestSubMeshes.push(K)):(e.needDepthPrePass&&this._depthOnlySubMeshes.push(K),this._opaqueSubMeshes.push(K)),b._renderingGroup=this,b._edgesRenderer&&b.isEnabled()&&b.isVisible&&b._edgesRenderer.isEnabled&&this._edgesRenderers.pushNoDuplicate(b._edgesRenderer),this._empty=!1)}dispatchSprites(K){this._spriteManagers.push(K),this._empty=!1}dispatchParticles(K){this._particleSystems.push(K),this._empty=!1}_renderParticles(K){if(0===this._particleSystems.length)return;const b=this._scene.activeCamera;this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);for(let e=0;e<this._particleSystems.length;e++){const z=this._particleSystems.data[e];if(0===(b&&b.layerMask&z.layerMask))continue;const k=z.j;k.position&&K&&-1===K.indexOf(k)||this._scene._activeParticles.addCount(z.render(),!1)}this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene)}_renderSprites(){if(!this._scene.spritesEnabled||0===this._spriteManagers.length)return;const K=this._scene.activeCamera;this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);for(let b=0;b<this._spriteManagers.length;b++){const e=this._spriteManagers.data[b];0!==(K&&K.layerMask&e.layerMask)&&e.render()}this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene)}}j._ZeroVector=k.k.Zero();class T{}class F{get maintainStateBetweenFrames(){return this._maintainStateBetweenFrames}set maintainStateBetweenFrames(K){K!==this._maintainStateBetweenFrames&&(this._maintainStateBetweenFrames=K,this._maintainStateBetweenFrames||this.restoreDispachedFlags())}restoreDispachedFlags(){for(const K of this._scene.meshes)if(K.Rf)for(const b of K.Rf)b._wasDispatched=!1;if(this._scene.spriteManagers)for(const K of this._scene.spriteManagers)K._wasDispatched=!1;for(const K of this._scene._i)K._wasDispatched=!1}constructor(K){this._useSceneAutoClearSetup=!1,this._renderingGroups=new Array,this._autoClearDepthStencil={},this._customOpaqueSortCompareFn={},this._customAlphaTestSortCompareFn={},this._customTransparentSortCompareFn={},this._renderingGroupInfo=new T,this._maintainStateBetweenFrames=!1,this._scene=K;for(let b=F.MIN_RENDERINGGROUPS;b<F.MAX_RENDERINGGROUPS;b++)this._autoClearDepthStencil[b]={Ci:!0,depth:!0,stencil:!0}}getRenderingGroup(K){const b=K||0;return this._prepareRenderingGroup(b),this._renderingGroups[b]}_clearDepthStencilBuffer(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._depthStencilBufferAlreadyCleaned||(this._scene.getEngine().clear(null,!1,K,b),this._depthStencilBufferAlreadyCleaned=!0)}render(K,b,e,z){const k=this._renderingGroupInfo;if(k.Ad=this._scene,k.camera=this._scene.activeCamera,this._scene.spriteManagers&&z)for(let j=0;j<this._scene.spriteManagers.length;j++){const K=this._scene.spriteManagers[j];this.dispatchSprites(K)}for(let j=F.MIN_RENDERINGGROUPS;j<F.MAX_RENDERINGGROUPS;j++){this._depthStencilBufferAlreadyCleaned=j===F.MIN_RENDERINGGROUPS;const T=this._renderingGroups[j];if(!T||T._empty)continue;const l=1<<j;if(k.renderingGroupId=j,this._scene.onBeforeRenderingGroupObservable.notifyObservers(k,l),F.AUTOCLEAR){const K=this._useSceneAutoClearSetup?this._scene.getAutoClearDepthStencilSetup(j):this._autoClearDepthStencil[j];K&&K.Ci&&this._clearDepthStencilBuffer(K.depth,K.stencil)}for(const K of this._scene._beforeRenderingGroupDrawStage)K.action(j);T.render(K,z,e,b);for(const K of this._scene._afterRenderingGroupDrawStage)K.action(j);this._scene.onAfterRenderingGroupObservable.notifyObservers(k,l)}}reset(){if(!this.maintainStateBetweenFrames)for(let K=F.MIN_RENDERINGGROUPS;K<F.MAX_RENDERINGGROUPS;K++){const b=this._renderingGroups[K];b&&b.prepare()}}resetSprites(){if(!this.maintainStateBetweenFrames)for(let K=F.MIN_RENDERINGGROUPS;K<F.MAX_RENDERINGGROUPS;K++){const b=this._renderingGroups[K];b&&b.prepareSprites()}}dispose(){this.freeRenderingGroups(),this._renderingGroups.length=0,this._renderingGroupInfo=null}freeRenderingGroups(){for(let K=F.MIN_RENDERINGGROUPS;K<F.MAX_RENDERINGGROUPS;K++){const b=this._renderingGroups[K];b&&b.dispose()}}_prepareRenderingGroup(K){void 0===this._renderingGroups[K]&&(this._renderingGroups[K]=new j(K,this._scene,this._customOpaqueSortCompareFn[K],this._customAlphaTestSortCompareFn[K],this._customTransparentSortCompareFn[K]))}dispatchSprites(K){this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(K.renderingGroupId).dispatchSprites(K))}dispatchParticles(K){this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(K.renderingGroupId).dispatchParticles(K))}dispatch(K,b,e){void 0===b&&(b=K.getMesh()),this.maintainStateBetweenFrames&&K._wasDispatched||(K._wasDispatched=!0,this.getRenderingGroup(b.renderingGroupId).dispatch(K,b,e))}setRenderingOrder(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(this._customOpaqueSortCompareFn[K]=b,this._customAlphaTestSortCompareFn[K]=e,this._customTransparentSortCompareFn[K]=z,this._renderingGroups[K]){const b=this._renderingGroups[K];b.opaqueSortCompareFn=this._customOpaqueSortCompareFn[K],b.alphaTestSortCompareFn=this._customAlphaTestSortCompareFn[K],b.transparentSortCompareFn=this._customTransparentSortCompareFn[K]}}setRenderingAutoClearDepthStencil(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._autoClearDepthStencil[K]={Ci:b,depth:e,stencil:z}}getAutoClearDepthStencilSetup(K){return this._autoClearDepthStencil[K]}}F.MAX_RENDERINGGROUPS=4,F.MIN_RENDERINGGROUPS=0,F.AUTOCLEAR=!0},11669:(K,b,e)=>{"use strict";const z="clipPlaneFragment",k="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fragmentInputs.fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fragmentInputs.fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fragmentInputs.fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fragmentInputs.fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fragmentInputs.fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fragmentInputs.fClipDistance6>0.0)\n{discard;}\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11648:(K,b,e)=>{"use strict";const z="clipPlaneFragmentDeclaration",k="#ifdef CLIPPLANE\nvarying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nvarying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nvarying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nvarying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nvarying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nvarying fClipDistance6: f32;\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11701:(K,b,e)=>{"use strict";const z="clipPlaneVertex",k="#ifdef CLIPPLANE\nvertexOutputs.fClipDistance=dot(worldPos,uniforms.vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nvertexOutputs.fClipDistance2=dot(worldPos,uniforms.vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nvertexOutputs.fClipDistance3=dot(worldPos,uniforms.vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nvertexOutputs.fClipDistance4=dot(worldPos,uniforms.vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nvertexOutputs.fClipDistance5=dot(worldPos,uniforms.vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nvertexOutputs.fClipDistance6=dot(worldPos,uniforms.vClipPlane6);\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11690:(K,b,e)=>{"use strict";const z="clipPlaneVertexDeclaration",k="#ifdef CLIPPLANE\nuniform vClipPlane: vec4<f32>;varying fClipDistance: f32;\n#endif\n#ifdef CLIPPLANE2\nuniform vClipPlane2: vec4<f32>;varying fClipDistance2: f32;\n#endif\n#ifdef CLIPPLANE3\nuniform vClipPlane3: vec4<f32>;varying fClipDistance3: f32;\n#endif\n#ifdef CLIPPLANE4\nuniform vClipPlane4: vec4<f32>;varying fClipDistance4: f32;\n#endif\n#ifdef CLIPPLANE5\nuniform vClipPlane5: vec4<f32>;varying fClipDistance5: f32;\n#endif\n#ifdef CLIPPLANE6\nuniform vClipPlane6: vec4<f32>;varying fClipDistance6: f32;\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11682:(K,b,e)=>{"use strict";const z="fogFragment",k="#ifdef FOG\nvar fog: f32=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor= vec4f(mix(uniforms.vFogColor,color.rgb,fog),color.a);\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11665:(K,b,e)=>{"use strict";const z="fogFragmentDeclaration",k="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\nconst E=2.71828;uniform vFogInfos: vec4f;uniform vFogColor: vec3f;varying vFogDistance: vec3f;fn CalcFogFactor()->f32\n{var fogCoeff: f32=1.0;var fogStart: f32=uniforms.vFogInfos.y;var fogEnd: f32=uniforms.vFogInfos.z;var fogDensity: f32=uniforms.vFogInfos.w;var fogDistance: f32=length(fragmentInputs.vFogDistance);if (FOGMODE_LINEAR==uniforms.vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==uniforms.vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11704:(K,b,e)=>{"use strict";const z="fogVertex",k="#ifdef FOG\nvertexOutputs.vFogDistance=(scene.view*worldPos).xyz;\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11698:(K,b,e)=>{"use strict";const z="fogVertexDeclaration",k="#ifdef FOG\nvarying vFogDistance: vec3f;\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11660:(K,b,e)=>{"use strict";const z="helperFunctions",k="const PI: f32=3.1415926535897932384626433832795;const RECIPROCAL_PI: f32=0.3183098861837907;const RECIPROCAL_PI2: f32=0.15915494309189535;const HALF_MIN: f32=5.96046448e-08; \nconst LinearEncodePowerApprox: f32=2.2;const GammaEncodePowerApprox: f32=1.0/LinearEncodePowerApprox;const LuminanceEncodeApprox: vec3<f32>=vec3<f32> (0.2126,0.7152,0.0722);const Epsilon:f32=0.0000001;fn square(x: f32)->f32 {return x*x;}\nfn saturate(x: f32)->f32 {return clamp(x,0.0,1.0);}\nfn saturateVec3(x: vec3f)->vec3f {return clamp(x,vec3f(0.0),vec3f(1.0));}\nfn saturateEps(x: f32)->f32 {return clamp(x,Epsilon,1.0);} \nfn maxEps(x: f32)->f32 {return max(x,Epsilon);}\nfn maxEpsVec3(x: vec3f)->vec3f {return max(x,vec3f(Epsilon));}\nfn absEps(x: f32)->f32 {return abs(x)+Epsilon;}\nfn transposeMat3(inMatrix: mat3x3f)->mat3x3f {let i0: vec3<f32>=inMatrix[0];let i1: vec3<f32>=inMatrix[1];let i2: vec3<f32>=inMatrix[2];let outMatrix:mat3x3f=mat3x3f(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nfn inverseMat3(inMatrix: mat3x3f)->mat3x3f {let a00: f32=inMatrix[0][0];let a01: f32=inMatrix[0][1];let a02: f32=inMatrix[0][2];let a10: f32=inMatrix[1][0];let a11: f32=inMatrix[1][1];let a12: f32=inMatrix[1][2];let a20: f32=inMatrix[2][0];let a21: f32=inMatrix[2][1];let a22: f32=inMatrix[2][2];let b01: f32=a22*a11-a12*a21;let b11: f32=-a22*a10+a12*a20;let b21: f32=a21*a10-a11*a20;let det: f32=a00*b01+a01*b11+a02*b21;return mat3x3f(b01/det,(-a22*a01+a02*a21)/det,(a12*a01-a02*a11)/det,\nb11/det,(a22*a00-a02*a20)/det,(-a12*a00+a02*a10)/det,\nb21/det,(-a21*a00+a01*a20)/det,(a11*a00-a01*a10)/det);}\n#if USE_EXACT_SRGB_CONVERSIONS\nfn toLinearSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=0.0773993808*color;let remainingSection: vec3<f32>=pow(0.947867299*(color+vec3<f32>(0.055)),vec3<f32>(2.4));return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.04045)));}\nfn toGammaSpaceExact(color: vec3<f32>)->vec3<f32>\n{let nearZeroSection: vec3<f32>=12.92*color;let remainingSection: vec3<f32>=1.055*pow(color,vec3<f32>(0.41666))-vec3<f32>(0.055);return mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3<f32>(0.0031308)));}\n#endif\nfn toLinearSpace(color: f32)->f32\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nvar nearZeroSection=0.0773993808*color;var remainingSection=pow(0.947867299*(color+0.055),2.4);return select(remainingSection,nearZeroSection,color<=0.04045);\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nfn toLinearSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(LinearEncodePowerApprox));\n#endif\n}\nfn toLinearSpaceVec4(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4f(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4f(pow(color.rgb,vec3f(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpace(color: vec4<f32>)->vec4<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4<f32>(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4<f32>(pow(color.rgb,vec3<f32>(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfn toGammaSpaceVec3(color: vec3<f32>)->vec3<f32>\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3<f32>(GammaEncodePowerApprox));\n#endif\n}\nfn squareVec3(value: vec3<f32>)->vec3<f32>\n{return value*value;}\nfn pow5(value: f32)->f32 {let sq: f32=value*value;return sq*sq*value;}\nfn getLuminance(color: vec3<f32>)->f32\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfn getRand(seed: vec2<f32>)->f32 {return fract(sin(dot(seed.xy ,vec2<f32>(12.9898,78.233)))*43758.5453);}\nfn dither(seed: vec2<f32>,varianceAmount: f32)->f32 {let rand: f32=getRand(seed);let normVariance: f32=varianceAmount/255.0;let dither: f32=mix(-normVariance,normVariance,rand);return dither;}\nconst rgbdMaxRange: f32=255.0;fn toRGBD(color: vec3<f32>)->vec4<f32> {let maxRGB: f32=max(max(color.r,max(color.g,color.b)),Epsilon);var D: f32 =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);var rgb: vec3<f32> =color.rgb*D;rgb=toGammaSpaceVec3(rgb);return vec4<f32>(clamp(rgb,vec3<f32>(0.,0.,0.),vec3<f32>(1.,1.,1.)),D); }\nfn fromRGBD(rgbd: vec4<f32>)->vec3<f32> {let rgb=toLinearSpaceVec3(rgbd.rgb);return rgb/rgbd.a;}\nfn parallaxCorrectNormal(vertexPos: vec3<f32>,origVec: vec3<f32>,cubeSize: vec3<f32>,cubePos: vec3<f32>)->vec3<f32> {let invOrigVec: vec3<f32>=vec3<f32>(1.0,1.0,1.0)/origVec;let halfSize: vec3<f32>=cubeSize*0.5;let intersecAtMaxPlane: vec3<f32>=(cubePos+halfSize-vertexPos)*invOrigVec;let intersecAtMinPlane: vec3<f32>=(cubePos-halfSize-vertexPos)*invOrigVec;let largestIntersec: vec3<f32>=max(intersecAtMaxPlane,intersecAtMinPlane);let distance: f32=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);let intersectPositionWS: vec3<f32>=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11654:(K,b,e)=>{"use strict";const z="imageProcessingDeclaration",k="#ifdef EXPOSURE\nuniform exposureLinear: f32;\n#endif\n#ifdef CONTRAST\nuniform contrast: f32;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vInverseScreenSize: vec2f;\n#endif\n#ifdef VIGNETTE\nuniform vignetteSettings1: vec4f;uniform vignetteSettings2: vec4f;\n#endif\n#ifdef COLORCURVES\nuniform vCameraColorCurveNegative: vec4f;uniform vCameraColorCurveNeutral: vec4f;uniform vCameraColorCurvePositive: vec4f;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nvar txColorTransformSampler: sampler;var txColorTransform: texture_3d<f32>;\n#else\nvar txColorTransformSampler: sampler;var txColorTransform: texture_2d<f32>;\n#endif\nuniform colorTransformSettings: vec4f;\n#endif\n#ifdef DITHER\nuniform ditherIntensity: f32;\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11662:(K,b,e)=>{"use strict";const z="imageProcessingFunctions",k="#if TONEMAPPING==3\nconst PBRNeutralStartCompression: f32=0.8-0.04;const PBRNeutralDesaturation: f32=0.15;fn PBRNeutralToneMapping( color: vec3f )->vec3f {var x: f32=min(color.r,min(color.g,color.b));var offset: f32=select(0.04,x-6.25*x*x,x<0.08);var result=color;result-=offset;var peak: f32=max(result.r,max(result.g,result.b));if (peak<PBRNeutralStartCompression) {return result;}\nvar d: f32=1.-PBRNeutralStartCompression;var newPeak: f32=1.-d*d/(peak+d-PBRNeutralStartCompression);result*=newPeak/peak;var g: f32=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(result,newPeak* vec3f(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst ACESInputMat: mat3x3f= mat3x3f(\nvec3f(0.59719,0.07600,0.02840),\nvec3f(0.35458,0.90834,0.13383),\nvec3f(0.04823,0.01566,0.83777)\n);const ACESOutputMat: mat3x3f= mat3x3f(\nvec3f( 1.60475,-0.10208,-0.00327),\nvec3f(-0.53108, 1.10813,-0.07276),\nvec3f(-0.07367,-0.00605, 1.07602)\n);fn RRTAndODTFit(v: vec3f)->vec3f\n{var a: vec3f=v*(v+0.0245786)-0.000090537;var b: vec3f=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nfn ACESFitted(color: vec3f)->vec3f\n{var output=ACESInputMat*color;output=RRTAndODTFit(output);output=ACESOutputMat*output;output=saturateVec3(output);return output;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nfn applyImageProcessing(result: vec4f)->vec4f {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\nvar rgb=result.rgb;;\n#ifdef EXPOSURE\nrgb*=uniforms.exposureLinear;\n#endif\n#ifdef VIGNETTE\nvar viewportXY: vec2f=fragmentInputs.position.xy*uniforms.vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;var vignetteXY1: vec3f= vec3f(viewportXY*uniforms.vignetteSettings1.xy+uniforms.vignetteSettings1.zw,1.0);var vignetteTerm: f32=dot(vignetteXY1,vignetteXY1);var vignette: f32=pow(vignetteTerm,uniforms.vignetteSettings2.w);var vignetteColor: vec3f=uniforms.vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvar vignetteColorMultiplier: vec3f=mix(vignetteColor, vec3f(1,1,1),vignette);rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nrgb=mix(vignetteColor,rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nrgb=PBRNeutralToneMapping(rgb);\n#elif TONEMAPPING==2\nrgb=ACESFitted(rgb);\n#elif TONEMAPPING==1\nconst tonemappingCalibration: f32=1.590579;rgb=1.0-exp2(-tonemappingCalibration*rgb);\n#endif\nrgb=toGammaSpaceVec3(rgb);rgb=saturateVec3(rgb);\n#ifdef CONTRAST\nvar resultHighContrast: vec3f=rgb*rgb*(3.0-2.0*rgb);if (uniforms.contrast<1.0) {rgb=mix( vec3f(0.5,0.5,0.5),rgb,uniforms.contrast);} else {rgb=mix(rgb,resultHighContrast,uniforms.contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvar colorTransformInput: vec3f=rgb*uniforms.colorTransformSettings.xxx+uniforms.colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput).rgb;\n#else\nvar colorTransformOutput: vec3f=textureSample(txColorTransform,txColorTransformSampler,colorTransformInput,uniforms.colorTransformSettings.yz).rgb;\n#endif\nrgb=mix(rgb,colorTransformOutput,uniforms.colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nvar luma: f32=getLuminance(rgb);var curveMix: vec2f=clamp( vec2f(luma*3.0-1.5,luma*-3.0+1.5), vec2f(0.0), vec2f(1.0));var colorCurve: vec4f=uniforms.vCameraColorCurveNeutral+curveMix.x*uniforms.vCameraColorCurvePositive-curveMix.y*uniforms.vCameraColorCurveNegative;rgb*=colorCurve.rgb;rgb=mix( vec3f(luma),rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nvar rand: f32=getRand(fragmentInputs.position.xy*uniforms.vInverseScreenSize);var dither: f32=mix(-uniforms.ditherIntensity,uniforms.ditherIntensity,rand);rgb=saturateVec3(rgb+ vec3f(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn vec4f(rgb,result.a);}";e(10764).d.IncludesShadersStoreWGSL[z]=k},11657:(K,b,e)=>{"use strict";const z="logDepthDeclaration",k="#ifdef LOGARITHMICDEPTH\nuniform logarithmicDepthConstant: f32;varying vFragmentDepth: f32;\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11673:(K,b,e)=>{"use strict";const z="logDepthFragment",k="#ifdef LOGARITHMICDEPTH\nfragmentOutputs.fragDepth=log2(fragmentInputs.vFragmentDepth)*uniforms.logarithmicDepthConstant*0.5;\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11709:(K,b,e)=>{"use strict";const z="logDepthVertex",k="#ifdef LOGARITHMICDEPTH\nvertexOutputs.vFragmentDepth=1.0+vertexOutputs.position.w;vertexOutputs.position.z=log2(max(0.000001,vertexOutputs.vFragmentDepth))*uniforms.logarithmicDepthConstant;\n#endif\n";e(10764).d.IncludesShadersStoreWGSL[z]=k},11646:(K,b,e)=>{"use strict";e.r(b),e.d(b,{particlesPixelShaderWGSL:()=>T});var z=e(10764);e(11648),e(11654),e(11657),e(11660),e(11662),e(11665),e(11669),e(11673),e(11682);const k="particlesPixelShader",j="varying vUV: vec2f;varying vColor: vec4f;uniform textureMask: vec4f;var diffuseSamplerSampler: sampler;var diffuseSampler: texture_2d<f32>;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;var rampSamplerSampler: sampler;var rampSampler: texture_2d<f32>;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\n@fragment\nfn main(input: FragmentInputs)->FragmentOutputs {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvar textureColor: vec4f=textureSample(diffuseSampler,diffuseSamplerSampler,input.vUV);var baseColor: vec4f=(textureColor*uniforms.textureMask+( vec4f(1.,1.,1.,1.)-uniforms.textureMask))*input.vColor;\n#ifdef RAMPGRADIENT\nvar alpha: f32=baseColor.a;var remappedColorIndex: f32=clamp((alpha-input.remapRanges.x)/input.remapRanges.y,0.0,1.0);var rampColor: vec4f=textureSample(rampSampler,rampSamplerSampler,vec2f(1.0-remappedColorIndex,0.));baseColor=vec4f(baseColor.rgb*rampColor.rgb,baseColor.a);var finalAlpha: f32=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-input.remapRanges.z)/input.remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nvar sourceAlpha: f32=input.vColor.a*textureColor.a;baseColor=vec4f(baseColor.rgb*sourceAlpha+ vec3f(1.0)*(1.0-sourceAlpha),baseColor.a);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor=vec4f(toLinearSpaceVec3(baseColor.rgb),baseColor.a);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\nfragmentOutputs.color=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.d.ShadersStoreWGSL[k]=j;const T={name:k,shader:j}},11685:(K,b,e)=>{"use strict";e.r(b),e.d(b,{particlesVertexShaderWGSL:()=>T});var z=e(10764);e(11690),e(11698),e(11657),e(11701),e(11704),e(11709);const k="particlesVertexShader",j="attribute position: vec3f;attribute color: vec4f;attribute angle: f32;attribute size: vec2f;\n#ifdef ANIMATESHEET\nattribute cellIndex: f32;\n#endif\n#ifndef BILLBOARD\nattribute direction: vec3f;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute direction: vec3f;\n#endif\n#ifdef RAMPGRADIENT\nattribute remapData: vec4f;\n#endif\nattribute offset: vec2f;uniform view: mat4x4f;uniform projection: mat4x4f;uniform translationPivot: vec2f;\n#ifdef ANIMATESHEET\nuniform particlesInfos: vec3f; \n#endif\nvarying vUV: vec2f;varying vColor: vec4f;varying vPositionW: vec3f;\n#ifdef RAMPGRADIENT\nvarying remapRanges: vec4f;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform invView: mat4x4f;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform eyePosition: vec3f;\n#endif\nfn rotate(yaxis: vec3f,rotatedCorner: vec3f)->vec3f {var xaxis: vec3f=normalize(cross( vec3f(0.,1.0,0.),yaxis));var zaxis: vec3f=normalize(cross(yaxis,xaxis));var row0: vec3f= vec3f(xaxis.x,xaxis.y,xaxis.z);var row1: vec3f= vec3f(yaxis.x,yaxis.y,yaxis.z);var row2: vec3f= vec3f(zaxis.x,zaxis.y,zaxis.z);var rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return vertexInputs.position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nfn rotateAlign(toCamera: vec3f,rotatedCorner: vec3f)->vec3f {var normalizedToCamera: vec3f=normalize(toCamera);var normalizedCrossDirToCamera: vec3f=normalize(cross(normalize(vertexInputs.direction),normalizedToCamera));var row0: vec3f= vec3f(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);var row2: vec3f= vec3f(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvar row1: vec3f=vertexInputs.direction;\n#else\nvar crossProduct: vec3f=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));var row1: vec3f= vec3f(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nvar rotMatrix: mat3x3f= mat3x3f(row0,row1,row2);var alignedCorner: vec3f=rotMatrix*rotatedCorner;return input.position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\n@vertex\nfn main(input : VertexInputs)->FragmentInputs {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvar cornerPos: vec2f;cornerPos=( vec2f(input.offset.x-0.5,input.offset.y -0.5)-uniforms.translationPivot)*input.size;\n#ifdef BILLBOARD\nvar rotatedCorner: vec3f;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=input.position-uniforms.eyePosition;yaxis.y=0.;vertexOutputs.vPositionW=rotate(normalize(yaxis),rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var toCamera: vec3f=input.position-uniforms.eyePosition;vertexOutputs.vPositionW=rotateAlign(toCamera,rotatedCorner);var viewPos: vec3f=(uniforms.view* vec4f(vertexOutputs.vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.y=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.z=0.;var viewPos: vec3f=(uniforms.view* vec4f(input.position,1.0)).xyz+rotatedCorner;vertexOutputs.vPositionW=(uniforms.invView* vec4f(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nvertexOutputs.remapRanges=input.remapData;\n#endif\nvertexOutputs.position=uniforms.projection* vec4f(viewPos,1.0);\n#else\nvar rotatedCorner: vec3f;rotatedCorner.x=cornerPos.x*cos(input.angle)-cornerPos.y*sin(input.angle)+uniforms.translationPivot.x;rotatedCorner.z=cornerPos.x*sin(input.angle)+cornerPos.y*cos(input.angle)+uniforms.translationPivot.y;rotatedCorner.y=0.;var yaxis: vec3f=normalize(vertexInputs.direction);vertexOutputs.vPositionW=rotate(yaxis,rotatedCorner);vertexOutputs.position=uniforms.projection*uniforms.view* vec4f(vertexOutputs.vPositionW,1.0);\n#endif\nvertexOutputs.vColor=input.color;\n#ifdef ANIMATESHEET\nvar rowOffset: f32=floor(input.cellIndex*uniforms.particlesInfos.z);var columnOffset: f32=input.cellIndex-rowOffset/uniforms.particlesInfos.z;var uvScale: vec2f=uniforms.particlesInfos.xy;var uvOffset: vec2f= vec2f(input.offset.x ,1.0-input.offset.y);vertexOutputs.vUV=(uvOffset+ vec2f(columnOffset,rowOffset))*uvScale;\n#else\nvertexOutputs.vUV=input.offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvar worldPos: vec4f= vec4f(vertexOutputs.vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.d.ShadersStoreWGSL[k]=j;const T={name:k,shader:j}},11568:(K,b,e)=>{"use strict";const z="clipPlaneFragment",k="#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6)\nif (false) {}\n#endif\n#ifdef CLIPPLANE\nelse if (fClipDistance>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE2\nelse if (fClipDistance2>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE3\nelse if (fClipDistance3>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE4\nelse if (fClipDistance4>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE5\nelse if (fClipDistance5>0.0)\n{discard;}\n#endif\n#ifdef CLIPPLANE6\nelse if (fClipDistance6>0.0)\n{discard;}\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11628:(K,b,e)=>{"use strict";const z="clipPlaneFragmentDeclaration",k="#ifdef CLIPPLANE\nvarying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nvarying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nvarying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nvarying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nvarying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nvarying float fClipDistance6;\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11582:(K,b,e)=>{"use strict";const z="clipPlaneVertex",k="#ifdef CLIPPLANE\nfClipDistance=dot(worldPos,vClipPlane);\n#endif\n#ifdef CLIPPLANE2\nfClipDistance2=dot(worldPos,vClipPlane2);\n#endif\n#ifdef CLIPPLANE3\nfClipDistance3=dot(worldPos,vClipPlane3);\n#endif\n#ifdef CLIPPLANE4\nfClipDistance4=dot(worldPos,vClipPlane4);\n#endif\n#ifdef CLIPPLANE5\nfClipDistance5=dot(worldPos,vClipPlane5);\n#endif\n#ifdef CLIPPLANE6\nfClipDistance6=dot(worldPos,vClipPlane6);\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11638:(K,b,e)=>{"use strict";const z="clipPlaneVertexDeclaration",k="#ifdef CLIPPLANE\nuniform vec4 vClipPlane;varying float fClipDistance;\n#endif\n#ifdef CLIPPLANE2\nuniform vec4 vClipPlane2;varying float fClipDistance2;\n#endif\n#ifdef CLIPPLANE3\nuniform vec4 vClipPlane3;varying float fClipDistance3;\n#endif\n#ifdef CLIPPLANE4\nuniform vec4 vClipPlane4;varying float fClipDistance4;\n#endif\n#ifdef CLIPPLANE5\nuniform vec4 vClipPlane5;varying float fClipDistance5;\n#endif\n#ifdef CLIPPLANE6\nuniform vec4 vClipPlane6;varying float fClipDistance6;\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11574:(K,b,e)=>{"use strict";const z="fogFragment",k="#ifdef FOG\nfloat fog=CalcFogFactor();\n#ifdef PBR\nfog=toLinearSpace(fog);\n#endif\ncolor.rgb=mix(vFogColor,color.rgb,fog);\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11564:(K,b,e)=>{"use strict";const z="fogFragmentDeclaration",k="#ifdef FOG\n#define FOGMODE_NONE 0.\n#define FOGMODE_EXP 1.\n#define FOGMODE_EXP2 2.\n#define FOGMODE_LINEAR 3.\n#define E 2.71828\nuniform vec4 vFogInfos;uniform vec3 vFogColor;varying vec3 vFogDistance;float CalcFogFactor()\n{float fogCoeff=1.0;float fogStart=vFogInfos.y;float fogEnd=vFogInfos.z;float fogDensity=vFogInfos.w;float fogDistance=length(vFogDistance);if (FOGMODE_LINEAR==vFogInfos.x)\n{fogCoeff=(fogEnd-fogDistance)/(fogEnd-fogStart);}\nelse if (FOGMODE_EXP==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDensity);}\nelse if (FOGMODE_EXP2==vFogInfos.x)\n{fogCoeff=1.0/pow(E,fogDistance*fogDistance*fogDensity*fogDensity);}\nreturn clamp(fogCoeff,0.0,1.0);}\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11591:(K,b,e)=>{"use strict";const z="fogVertex",k="#ifdef FOG\nvFogDistance=(view*worldPos).xyz;\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11577:(K,b,e)=>{"use strict";const z="fogVertexDeclaration",k="#ifdef FOG\nvarying vec3 vFogDistance;\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11549:(K,b,e)=>{"use strict";const z="helperFunctions",k="const float PI=3.1415926535897932384626433832795;const float RECIPROCAL_PI=0.3183098861837907;const float RECIPROCAL_PI2=0.15915494309189535;const float HALF_MIN=5.96046448e-08; \nconst float LinearEncodePowerApprox=2.2;const float GammaEncodePowerApprox=1.0/LinearEncodePowerApprox;const vec3 LuminanceEncodeApprox=vec3(0.2126,0.7152,0.0722);const float Epsilon=0.0000001;\n#define saturate(x) clamp(x,0.0,1.0)\n#define absEps(x) abs(x)+Epsilon\n#define maxEps(x) max(x,Epsilon)\n#define saturateEps(x) clamp(x,Epsilon,1.0)\nmat3 transposeMat3(mat3 inMatrix) {vec3 i0=inMatrix[0];vec3 i1=inMatrix[1];vec3 i2=inMatrix[2];mat3 outMatrix=mat3(\nvec3(i0.x,i1.x,i2.x),\nvec3(i0.y,i1.y,i2.y),\nvec3(i0.z,i1.z,i2.z)\n);return outMatrix;}\nmat3 inverseMat3(mat3 inMatrix) {float a00=inMatrix[0][0],a01=inMatrix[0][1],a02=inMatrix[0][2];float a10=inMatrix[1][0],a11=inMatrix[1][1],a12=inMatrix[1][2];float a20=inMatrix[2][0],a21=inMatrix[2][1],a22=inMatrix[2][2];float b01=a22*a11-a12*a21;float b11=-a22*a10+a12*a20;float b21=a21*a10-a11*a20;float det=a00*b01+a01*b11+a02*b21;return mat3(b01,(-a22*a01+a02*a21),(a12*a01-a02*a11),\nb11,(a22*a00-a02*a20),(-a12*a00+a02*a10),\nb21,(-a21*a00+a01*a20),(a11*a00-a01*a10))/det;}\n#if USE_EXACT_SRGB_CONVERSIONS\nvec3 toLinearSpaceExact(vec3 color)\n{vec3 nearZeroSection=0.0773993808*color;vec3 remainingSection=pow(0.947867299*(color+vec3(0.055)),vec3(2.4));\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.04045)));\n#else\nreturn\nvec3(\ncolor.r<=0.04045 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.04045 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.04045 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\nvec3 toGammaSpaceExact(vec3 color)\n{vec3 nearZeroSection=12.92*color;vec3 remainingSection=1.055*pow(color,vec3(0.41666))-vec3(0.055);\n#if defined(WEBGL2) || defined(WEBGPU) || defined(NATIVE)\nreturn mix(remainingSection,nearZeroSection,lessThanEqual(color,vec3(0.0031308)));\n#else\nreturn\nvec3(\ncolor.r<=0.0031308 ? nearZeroSection.r : remainingSection.r,\ncolor.g<=0.0031308 ? nearZeroSection.g : remainingSection.g,\ncolor.b<=0.0031308 ? nearZeroSection.b : remainingSection.b);\n#endif\n}\n#endif\nfloat toLinearSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=0.0773993808*color;float remainingSection=pow(0.947867299*(color+0.055),2.4);return color<=0.04045 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,LinearEncodePowerApprox);\n#endif\n}\nvec3 toLinearSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toLinearSpaceExact(color);\n#else\nreturn pow(color,vec3(LinearEncodePowerApprox));\n#endif\n}\nvec4 toLinearSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toLinearSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(LinearEncodePowerApprox)),color.a);\n#endif\n}\nfloat toGammaSpace(float color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nfloat nearZeroSection=12.92*color;float remainingSection=1.055*pow(color,0.41666)-0.055;return color<=0.0031308 ? nearZeroSection : remainingSection;\n#else\nreturn pow(color,GammaEncodePowerApprox);\n#endif\n}\nvec3 toGammaSpace(vec3 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn toGammaSpaceExact(color);\n#else\nreturn pow(color,vec3(GammaEncodePowerApprox));\n#endif\n}\nvec4 toGammaSpace(vec4 color)\n{\n#if USE_EXACT_SRGB_CONVERSIONS\nreturn vec4(toGammaSpaceExact(color.rgb),color.a);\n#else\nreturn vec4(pow(color.rgb,vec3(GammaEncodePowerApprox)),color.a);\n#endif\n}\nfloat square(float value)\n{return value*value;}\nvec3 square(vec3 value)\n{return value*value;}\nfloat pow5(float value) {float sq=value*value;return sq*sq*value;}\nfloat getLuminance(vec3 color)\n{return clamp(dot(color,LuminanceEncodeApprox),0.,1.);}\nfloat getRand(vec2 seed) {return fract(sin(dot(seed.xy ,vec2(12.9898,78.233)))*43758.5453);}\nfloat dither(vec2 seed,float varianceAmount) {float rand=getRand(seed);float normVariance=varianceAmount/255.0;float dither=mix(-normVariance,normVariance,rand);return dither;}\nconst float rgbdMaxRange=255.0;vec4 toRGBD(vec3 color) {float maxRGB=maxEps(max(color.r,max(color.g,color.b)));float D =max(rgbdMaxRange/maxRGB,1.);D =clamp(floor(D)/255.0,0.,1.);vec3 rgb=color.rgb*D;rgb=toGammaSpace(rgb);return vec4(clamp(rgb,0.,1.),D); }\nvec3 fromRGBD(vec4 rgbd) {rgbd.rgb=toLinearSpace(rgbd.rgb);return rgbd.rgb/rgbd.a;}\nvec3 parallaxCorrectNormal( vec3 vertexPos,vec3 origVec,vec3 cubeSize,vec3 cubePos ) {vec3 invOrigVec=vec3(1.0,1.0,1.0)/origVec;vec3 halfSize=cubeSize*0.5;vec3 intersecAtMaxPlane=(cubePos+halfSize-vertexPos)*invOrigVec;vec3 intersecAtMinPlane=(cubePos-halfSize-vertexPos)*invOrigVec;vec3 largestIntersec=max(intersecAtMaxPlane,intersecAtMinPlane);float distance=min(min(largestIntersec.x,largestIntersec.y),largestIntersec.z);vec3 intersectPositionWS=vertexPos+origVec*distance;return intersectPositionWS-cubePos;}\n";e(10764).d.IncludesShadersStore[z]=k},11537:(K,b,e)=>{"use strict";const z="imageProcessingDeclaration",k="#ifdef EXPOSURE\nuniform float exposureLinear;\n#endif\n#ifdef CONTRAST\nuniform float contrast;\n#endif\n#if defined(VIGNETTE) || defined(DITHER)\nuniform vec2 vInverseScreenSize;\n#endif\n#ifdef VIGNETTE\nuniform vec4 vignetteSettings1;uniform vec4 vignetteSettings2;\n#endif\n#ifdef COLORCURVES\nuniform vec4 vCameraColorCurveNegative;uniform vec4 vCameraColorCurveNeutral;uniform vec4 vCameraColorCurvePositive;\n#endif\n#ifdef COLORGRADING\n#ifdef COLORGRADING3D\nuniform highp sampler3D txColorTransform;\n#else\nuniform sampler2D txColorTransform;\n#endif\nuniform vec4 colorTransformSettings;\n#endif\n#ifdef DITHER\nuniform float ditherIntensity;\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11558:(K,b,e)=>{"use strict";const z="imageProcessingFunctions",k="#if defined(COLORGRADING) && !defined(COLORGRADING3D)\n/** \n* Polyfill for SAMPLE_TEXTURE_3D,which is unsupported in WebGL.\n* sampler3dSetting.x=textureOffset (0.5/textureSize).\n* sampler3dSetting.y=textureSize.\n*/\n#define inline\nvec3 sampleTexture3D(sampler2D colorTransform,vec3 color,vec2 sampler3dSetting)\n{float sliceSize=2.0*sampler3dSetting.x; \n#ifdef SAMPLER3DGREENDEPTH\nfloat sliceContinuous=(color.g-sampler3dSetting.x)*sampler3dSetting.y;\n#else\nfloat sliceContinuous=(color.b-sampler3dSetting.x)*sampler3dSetting.y;\n#endif\nfloat sliceInteger=floor(sliceContinuous);float sliceFraction=sliceContinuous-sliceInteger;\n#ifdef SAMPLER3DGREENDEPTH\nvec2 sliceUV=color.rb;\n#else\nvec2 sliceUV=color.rg;\n#endif\nsliceUV.x*=sliceSize;sliceUV.x+=sliceInteger*sliceSize;sliceUV=saturate(sliceUV);vec4 slice0Color=texture2D(colorTransform,sliceUV);sliceUV.x+=sliceSize;sliceUV=saturate(sliceUV);vec4 slice1Color=texture2D(colorTransform,sliceUV);vec3 result=mix(slice0Color.rgb,slice1Color.rgb,sliceFraction);\n#ifdef SAMPLER3DBGRMAP\ncolor.rgb=result.rgb;\n#else\ncolor.rgb=result.bgr;\n#endif\nreturn color;}\n#endif\n#if TONEMAPPING==3\nconst float PBRNeutralStartCompression=0.8-0.04;const float PBRNeutralDesaturation=0.15;vec3 PBRNeutralToneMapping( vec3 color ) {float x=min(color.r,min(color.g,color.b));float offset=x<0.08 ? x-6.25*x*x : 0.04;color-=offset;float peak=max(color.r,max(color.g,color.b));if (peak<PBRNeutralStartCompression) return color;float d=1.-PBRNeutralStartCompression;float newPeak=1.-d*d/(peak+d-PBRNeutralStartCompression);color*=newPeak/peak;float g=1.-1./(PBRNeutralDesaturation*(peak-newPeak)+1.);return mix(color,newPeak*vec3(1,1,1),g);}\n#endif\n#if TONEMAPPING==2\nconst mat3 ACESInputMat=mat3(\nvec3(0.59719,0.07600,0.02840),\nvec3(0.35458,0.90834,0.13383),\nvec3(0.04823,0.01566,0.83777)\n);const mat3 ACESOutputMat=mat3(\nvec3( 1.60475,-0.10208,-0.00327),\nvec3(-0.53108, 1.10813,-0.07276),\nvec3(-0.07367,-0.00605, 1.07602)\n);vec3 RRTAndODTFit(vec3 v)\n{vec3 a=v*(v+0.0245786)-0.000090537;vec3 b=v*(0.983729*v+0.4329510)+0.238081;return a/b;}\nvec3 ACESFitted(vec3 color)\n{color=ACESInputMat*color;color=RRTAndODTFit(color);color=ACESOutputMat*color;color=saturate(color);return color;}\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_DEFINITIONS\nvec4 applyImageProcessing(vec4 result) {\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATSTART\n#ifdef EXPOSURE\nresult.rgb*=exposureLinear;\n#endif\n#ifdef VIGNETTE\nvec2 viewportXY=gl_FragCoord.xy*vInverseScreenSize;viewportXY=viewportXY*2.0-1.0;vec3 vignetteXY1=vec3(viewportXY*vignetteSettings1.xy+vignetteSettings1.zw,1.0);float vignetteTerm=dot(vignetteXY1,vignetteXY1);float vignette=pow(vignetteTerm,vignetteSettings2.w);vec3 vignetteColor=vignetteSettings2.rgb;\n#ifdef VIGNETTEBLENDMODEMULTIPLY\nvec3 vignetteColorMultiplier=mix(vignetteColor,vec3(1,1,1),vignette);result.rgb*=vignetteColorMultiplier;\n#endif\n#ifdef VIGNETTEBLENDMODEOPAQUE\nresult.rgb=mix(vignetteColor,result.rgb,vignette);\n#endif\n#endif\n#if TONEMAPPING==3\nresult.rgb=PBRNeutralToneMapping(result.rgb);\n#elif TONEMAPPING==2\nresult.rgb=ACESFitted(result.rgb);\n#elif TONEMAPPING==1\nconst float tonemappingCalibration=1.590579;result.rgb=1.0-exp2(-tonemappingCalibration*result.rgb);\n#endif\nresult.rgb=toGammaSpace(result.rgb);result.rgb=saturate(result.rgb);\n#ifdef CONTRAST\nvec3 resultHighContrast=result.rgb*result.rgb*(3.0-2.0*result.rgb);if (contrast<1.0) {result.rgb=mix(vec3(0.5,0.5,0.5),result.rgb,contrast);} else {result.rgb=mix(result.rgb,resultHighContrast,contrast-1.0);}\n#endif\n#ifdef COLORGRADING\nvec3 colorTransformInput=result.rgb*colorTransformSettings.xxx+colorTransformSettings.yyy;\n#ifdef COLORGRADING3D\nvec3 colorTransformOutput=texture(txColorTransform,colorTransformInput).rgb;\n#else\nvec3 colorTransformOutput=sampleTexture3D(txColorTransform,colorTransformInput,colorTransformSettings.yz).rgb;\n#endif\nresult.rgb=mix(result.rgb,colorTransformOutput,colorTransformSettings.www);\n#endif\n#ifdef COLORCURVES\nfloat luma=getLuminance(result.rgb);vec2 curveMix=clamp(vec2(luma*3.0-1.5,luma*-3.0+1.5),vec2(0.0),vec2(1.0));vec4 colorCurve=vCameraColorCurveNeutral+curveMix.x*vCameraColorCurvePositive-curveMix.y*vCameraColorCurveNegative;result.rgb*=colorCurve.rgb;result.rgb=mix(vec3(luma),result.rgb,colorCurve.a);\n#endif\n#ifdef DITHER\nfloat rand=getRand(gl_FragCoord.xy*vInverseScreenSize);float dither=mix(-ditherIntensity,ditherIntensity,rand);result.rgb=saturate(result.rgb+vec3(dither));\n#endif\n#define CUSTOM_IMAGEPROCESSINGFUNCTIONS_UPDATERESULT_ATEND\nreturn result;}";e(10764).d.IncludesShadersStore[z]=k},11545:(K,b,e)=>{"use strict";const z="logDepthDeclaration",k="#ifdef LOGARITHMICDEPTH\nuniform float logarithmicDepthConstant;varying float vFragmentDepth;\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11570:(K,b,e)=>{"use strict";const z="logDepthFragment",k="#ifdef LOGARITHMICDEPTH\ngl_FragDepthEXT=log2(vFragmentDepth)*logarithmicDepthConstant*0.5;\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11597:(K,b,e)=>{"use strict";const z="logDepthVertex",k="#ifdef LOGARITHMICDEPTH\nvFragmentDepth=1.0+gl_Position.w;gl_Position.z=log2(max(0.000001,vFragmentDepth))*logarithmicDepthConstant;\n#endif\n";e(10764).d.IncludesShadersStore[z]=k},11626:(K,b,e)=>{"use strict";e.r(b),e.d(b,{particlesPixelShader:()=>T});var z=e(10764);e(11628),e(11537),e(11545),e(11549),e(11558),e(11564),e(11568),e(11570),e(11574);const k="particlesPixelShader",j="#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec2 vUV;varying vec4 vColor;uniform vec4 textureMask;uniform sampler2D diffuseSampler;\n#include<clipPlaneFragmentDeclaration>\n#include<imageProcessingDeclaration>\n#include<logDepthDeclaration>\n#include<helperFunctions>\n#include<imageProcessingFunctions>\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;uniform sampler2D rampSampler;\n#endif\n#include<fogFragmentDeclaration>\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\nvec4 textureColor=texture2D(diffuseSampler,vUV);vec4 baseColor=(textureColor*textureMask+(vec4(1.,1.,1.,1.)-textureMask))*vColor;\n#ifdef RAMPGRADIENT\nfloat alpha=baseColor.a;float remappedColorIndex=clamp((alpha-remapRanges.x)/remapRanges.y,0.0,1.0);vec4 rampColor=texture2D(rampSampler,vec2(1.0-remappedColorIndex,0.));baseColor.rgb*=rampColor.rgb;float finalAlpha=baseColor.a;baseColor.a=clamp((alpha*rampColor.a-remapRanges.z)/remapRanges.w,0.0,1.0);\n#endif\n#ifdef BLENDMULTIPLYMODE\nfloat sourceAlpha=vColor.a*textureColor.a;baseColor.rgb=baseColor.rgb*sourceAlpha+vec3(1.0)*(1.0-sourceAlpha);\n#endif\n#include<logDepthFragment>\n#include<fogFragment>(color,baseColor)\n#ifdef IMAGEPROCESSINGPOSTPROCESS\nbaseColor.rgb=toLinearSpace(baseColor.rgb);\n#else\n#ifdef IMAGEPROCESSING\nbaseColor.rgb=toLinearSpace(baseColor.rgb);baseColor=applyImageProcessing(baseColor);\n#endif\n#endif\ngl_FragColor=baseColor;\n#define CUSTOM_FRAGMENT_MAIN_END\n}";z.d.ShadersStore[k]=j;const T={name:k,shader:j}},11634:(K,b,e)=>{"use strict";e.r(b),e.d(b,{particlesVertexShader:()=>T});var z=e(10764);e(11638),e(11577),e(11545),e(11582),e(11591),e(11597);const k="particlesVertexShader",j="attribute vec3 position;attribute vec4 color;attribute float angle;attribute vec2 size;\n#ifdef ANIMATESHEET\nattribute float cellIndex;\n#endif\n#ifndef BILLBOARD\nattribute vec3 direction;\n#endif\n#ifdef BILLBOARDSTRETCHED\nattribute vec3 direction;\n#endif\n#ifdef RAMPGRADIENT\nattribute vec4 remapData;\n#endif\nattribute vec2 offset;uniform mat4 view;uniform mat4 projection;uniform vec2 translationPivot;\n#ifdef ANIMATESHEET\nuniform vec3 particlesInfos; \n#endif\nvarying vec2 vUV;varying vec4 vColor;varying vec3 vPositionW;\n#ifdef RAMPGRADIENT\nvarying vec4 remapRanges;\n#endif\n#if defined(BILLBOARD) && !defined(BILLBOARDY) && !defined(BILLBOARDSTRETCHED)\nuniform mat4 invView;\n#endif\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#include<logDepthDeclaration>\n#ifdef BILLBOARD\nuniform vec3 eyePosition;\n#endif\nvec3 rotate(vec3 yaxis,vec3 rotatedCorner) {vec3 xaxis=normalize(cross(vec3(0.,1.0,0.),yaxis));vec3 zaxis=normalize(cross(yaxis,xaxis));vec3 row0=vec3(xaxis.x,xaxis.y,xaxis.z);vec3 row1=vec3(yaxis.x,yaxis.y,yaxis.z);vec3 row2=vec3(zaxis.x,zaxis.y,zaxis.z);mat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#ifdef BILLBOARDSTRETCHED\nvec3 rotateAlign(vec3 toCamera,vec3 rotatedCorner) {vec3 normalizedToCamera=normalize(toCamera);vec3 normalizedCrossDirToCamera=normalize(cross(normalize(direction),normalizedToCamera));vec3 row0=vec3(normalizedCrossDirToCamera.x,normalizedCrossDirToCamera.y,normalizedCrossDirToCamera.z);vec3 row2=vec3(normalizedToCamera.x,normalizedToCamera.y,normalizedToCamera.z);\n#ifdef BILLBOARDSTRETCHED_LOCAL\nvec3 row1=direction;\n#else\nvec3 crossProduct=normalize(cross(normalizedToCamera,normalizedCrossDirToCamera));vec3 row1=vec3(crossProduct.x,crossProduct.y,crossProduct.z);\n#endif\nmat3 rotMatrix= mat3(row0,row1,row2);vec3 alignedCorner=rotMatrix*rotatedCorner;return position+alignedCorner;}\n#endif\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvec2 cornerPos;cornerPos=(vec2(offset.x-0.5,offset.y -0.5)-translationPivot)*size;\n#ifdef BILLBOARD\nvec3 rotatedCorner;\n#ifdef BILLBOARDY\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=position-eyePosition;yaxis.y=0.;vPositionW=rotate(normalize(yaxis),rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#elif defined(BILLBOARDSTRETCHED)\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 toCamera=position-eyePosition;vPositionW=rotateAlign(toCamera,rotatedCorner);vec3 viewPos=(view*vec4(vPositionW,1.0)).xyz;\n#else\nrotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.y=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.z=0.;rotatedCorner.xy+=translationPivot;vec3 viewPos=(view*vec4(position,1.0)).xyz+rotatedCorner;vPositionW=(invView*vec4(viewPos,1)).xyz;\n#endif\n#ifdef RAMPGRADIENT\nremapRanges=remapData;\n#endif\ngl_Position=projection*vec4(viewPos,1.0);\n#else\nvec3 rotatedCorner;rotatedCorner.x=cornerPos.x*cos(angle)-cornerPos.y*sin(angle);rotatedCorner.z=cornerPos.x*sin(angle)+cornerPos.y*cos(angle);rotatedCorner.y=0.;rotatedCorner.xz+=translationPivot;vec3 yaxis=normalize(direction);vPositionW=rotate(yaxis,rotatedCorner);gl_Position=projection*view*vec4(vPositionW,1.0);\n#endif\nvColor=color;\n#ifdef ANIMATESHEET\nfloat rowOffset=floor(cellIndex*particlesInfos.z);float columnOffset=cellIndex-rowOffset/particlesInfos.z;vec2 uvScale=particlesInfos.xy;vec2 uvOffset=vec2(offset.x ,1.0-offset.y);vUV=(uvOffset+vec2(columnOffset,rowOffset))*uvScale;\n#else\nvUV=offset;\n#endif\n#if defined(CLIPPLANE) || defined(CLIPPLANE2) || defined(CLIPPLANE3) || defined(CLIPPLANE4) || defined(CLIPPLANE5) || defined(CLIPPLANE6) || defined(FOG)\nvec4 worldPos=vec4(vPositionW,1.0);\n#endif\n#include<clipPlaneVertex>\n#include<fogVertex>\n#include<logDepthVertex>\n#define CUSTOM_VERTEX_MAIN_END\n}";z.d.ShadersStore[k]=j;const T={name:k,shader:j}},11527:(K,b,e)=>{"use strict";e.r(b),e.d(b,{postprocessVertexShader:()=>j});const z="postprocessVertexShader",k="attribute vec2 position;uniform vec2 scale;varying vec2 vUV;const vec2 madd=vec2(0.5,0.5);\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\nvUV=(position*madd+madd)*scale;gl_Position=vec4(position,0.0,1.0);\n#define CUSTOM_VERTEX_MAIN_END\n}";e(10764).d.ShadersStore[z]=k;const j={name:z,shader:k}},11062:(K,b,e)=>{"use strict";e.d(b,{c:()=>z});class z{}z._IsPickingAvailable=!1},11243:(K,b,e)=>{"use strict";e.d(b,{e:()=>X});var z=e(10936),k=e(10967),j=e(10938),T=e(10690),F=e(10720),l=e(10710),Y=e(11001);class A{constructor(){this._doNotSerialize=!1,this._isDisposed=!1,this._sceneRootNodesIndex=-1,this._isEnabled=!0,this._isParentEnabled=!0,this._isReady=!0,this._onEnabledStateChangedObservable=new T.d,this._onClonedObservable=new T.d}}class X{static AddNodeConstructor(K,b){this._NodeConstructors[K]=b}static Construct(K,b,e,z){const k=this._NodeConstructors[K];return k?k(b,e,z):null}set accessibilityTag(K){this._accessibilityTag=K,this.onAccessibilityTagChangedObservable.notifyObservers(K)}get accessibilityTag(){return this._accessibilityTag}get doNotSerialize(){return!!this._nodeDataStorage._doNotSerialize||!!this._parentNode&&this._parentNode.doNotSerialize}set doNotSerialize(K){this._nodeDataStorage._doNotSerialize=K}u(){return this._nodeDataStorage._isDisposed}set parent(K){if(this._parentNode===K)return;const b=this._parentNode;if(this._parentNode&&void 0!==this._parentNode._children&&null!==this._parentNode._children){const b=this._parentNode._children.indexOf(this);-1!==b&&this._parentNode._children.splice(b,1),K||this._nodeDataStorage._isDisposed||this._addToSceneRootNodes()}this._parentNode=K,this._isDirty=!0,this._parentNode&&(void 0!==this._parentNode._children&&null!==this._parentNode._children||(this._parentNode._children=new Array),this._parentNode._children.push(this),b||this._removeFromSceneRootNodes()),this._syncParentEnabledState()}get parent(){return this._parentNode}_serializeAsParent(K){K.parentId=this.uniqueId}_addToSceneRootNodes(){-1===this._nodeDataStorage._sceneRootNodesIndex&&(this._nodeDataStorage._sceneRootNodesIndex=this._scene.rootNodes.length,this._scene.rootNodes.push(this))}_removeFromSceneRootNodes(){if(-1!==this._nodeDataStorage._sceneRootNodesIndex){const K=this._scene.rootNodes,b=K.length-1;K[this._nodeDataStorage._sceneRootNodesIndex]=K[b],K[this._nodeDataStorage._sceneRootNodesIndex]._nodeDataStorage._sceneRootNodesIndex=this._nodeDataStorage._sceneRootNodesIndex,this._scene.rootNodes.pop(),this._nodeDataStorage._sceneRootNodesIndex=-1}}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}getClassName(){return"Node"}set onDispose(K){this._onDisposeObserver&&this.Ui.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ui.add(K)}get onEnabledStateChangedObservable(){return this._nodeDataStorage._onEnabledStateChangedObservable}get onClonedObservable(){return this._nodeDataStorage._onClonedObservable}constructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._isDirty=!1,this._nodeDataStorage=new A,this.state="",this.metadata=null,this.reservedDataStore=null,this._accessibilityTag=null,this.onAccessibilityTagChangedObservable=new T.d,this._parentContainer=null,this.animations=[],this._ranges={},this.onReady=null,this._currentRenderId=-1,this._parentUpdateId=-1,this._childUpdateId=-1,this._waitingParentId=null,this._waitingParentInstanceIndex=null,this._waitingParsedUniqueId=null,this._cache={},this._parentNode=null,this._children=null,this._worldMatrix=k.b.Identity(),this._worldMatrixDeterminant=0,this._worldMatrixDeterminantIsDirty=!0,this._animationPropertiesOverride=null,this._isNode=!0,this.Ui=new T.d,this._onDisposeObserver=null,this._behaviors=new Array,this.name=K,this.id=K,this._scene=b||F.b.LastCreatedScene,this.uniqueId=this._scene.getUniqueId(),this._initCache(),e&&this._addToSceneRootNodes()}va(){return this._scene}getEngine(){return this._scene.getEngine()}addBehavior(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return-1!==this._behaviors.indexOf(K)||(K.init(),this._scene.isLoading&&!b?this._scene.onDataLoadedObservable.addOnce((()=>{K.attach(this)})):K.attach(this),this._behaviors.push(K)),this}removeBehavior(K){const b=this._behaviors.indexOf(K);return-1===b||(this._behaviors[b].detach(),this._behaviors.splice(b,1)),this}get behaviors(){return this._behaviors}getBehaviorByName(K){for(const b of this._behaviors)if(b.name===K)return b;return null}getWorldMatrix(){return this._currentRenderId!==this._scene.getRenderId()&&this.xj(),this._worldMatrix}_getWorldMatrixDeterminant(){return this._worldMatrixDeterminantIsDirty&&(this._worldMatrixDeterminantIsDirty=!1,this._worldMatrixDeterminant=this._worldMatrix.determinant()),this._worldMatrixDeterminant}get worldMatrixFromCache(){return this._worldMatrix}_initCache(){this._cache={}}updateCache(K){!K&&this.isSynchronized()||this._updateCache()}_getActionManagerForTrigger(K){return this.parent?this.parent._getActionManagerForTrigger(K,!1):null}_updateCache(K){}_isSynchronized(){return!0}_markSyncedWithParent(){this._parentNode&&(this._parentUpdateId=this._parentNode._childUpdateId)}isSynchronizedWithParent(){return!this._parentNode||!this._parentNode._isDirty&&this._parentUpdateId===this._parentNode._childUpdateId&&this._parentNode.isSynchronized()}isSynchronized(){return!(this._parentNode&&!this.isSynchronizedWithParent())&&this._isSynchronized()}isReady(){return this._nodeDataStorage._isReady}rg(K){return this._currentRenderId=Number.MAX_VALUE,this._isDirty=!0,this}isEnabled(){return!1===(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])?this._nodeDataStorage._isEnabled:!!this._nodeDataStorage._isEnabled&&this._nodeDataStorage._isParentEnabled}_syncParentEnabledState(){this._nodeDataStorage._isParentEnabled=!this._parentNode||this._parentNode.isEnabled(),this._children&&this._children.forEach((K=>{K._syncParentEnabledState()}))}yb(K){this._nodeDataStorage._isEnabled!==K&&(this._nodeDataStorage._isEnabled=K,this._syncParentEnabledState(),this._nodeDataStorage._onEnabledStateChangedObservable.notifyObservers(K))}isDescendantOf(K){return!!this.parent&&(this.parent===K||this.parent.isDescendantOf(K))}_getDescendants(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;if(this._children)for(let z=0;z<this._children.length;z++){const k=this._children[z];e&&!e(k)||K.push(k),b||k._getDescendants(K,!1,e)}}getDescendants(K,b){const e=[];return this._getDescendants(e,K,b),e}getChildMeshes(K,b){const e=[];return this._getDescendants(e,K,(K=>(!b||b(K))&&void 0!==K.li)),e}getChildren(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getDescendants(b,K)}_setReady(K){K!==this._nodeDataStorage._isReady&&(K?(this.onReady&&this.onReady(this),this._nodeDataStorage._isReady=!0):this._nodeDataStorage._isReady=!1)}getAnimationByName(K){for(let b=0;b<this.animations.length;b++){const e=this.animations[b];if(e.name===K)return e}return null}createAnimationRange(K,b,e){if(!this._ranges[K]){this._ranges[K]=X._AnimationRangeFactory(K,b,e);for(let z=0,k=this.animations.length;z<k;z++)this.animations[z]&&this.animations[z].createRange(K,b,e)}}deleteAnimationRange(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let e=0,z=this.animations.length;e<z;e++)this.animations[e]&&this.animations[e].deleteRange(K,b);this._ranges[K]=null}getAnimationRange(K){return this._ranges[K]||null}clone(K,b,e){const z=Y.e.Clone((()=>new X(K,this.va())),this);if(b&&(z.parent=b),!e){const b=this.getDescendants(!0);for(let e=0;e<b.length;e++){const k=b[e];k.clone(K+"."+k.name,z)}}return z}getAnimationRanges(){const K=[];let b;for(b in this._ranges)K.push(this._ranges[b]);return K}beginAnimation(K,b,e,z){const k=this.getAnimationRange(K);return k?this._scene.beginAnimation(this,k.from,k.to,b,e,z):null}serializeAnimationRanges(){const K=[];for(const b in this._ranges){const e=this._ranges[b];if(!e)continue;const z={};z.name=b,z.from=e.from,z.to=e.to,K.push(z)}return K}xj(K){return this._worldMatrix||(this._worldMatrix=k.b.Identity()),this._worldMatrix}dispose(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this._nodeDataStorage._isDisposed=!0,!K){const e=this.getDescendants(!0);for(const z of e)z.dispose(K,b)}this.parent?this.parent=null:this._removeFromSceneRootNodes(),this.Ui.notifyObservers(this),this.Ui.clear(),this.onEnabledStateChangedObservable.clear(),this.onClonedObservable.clear();for(const e of this._behaviors)e.detach();this._behaviors.length=0,this.metadata=null}static ParseAnimationRanges(K,b,e){if(b.ranges)for(let z=0;z<b.ranges.length;z++){const e=b.ranges[z];K.createAnimationRange(e.name,e.from,e.to)}}getHierarchyBoundingVectors(){let K,b,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],z=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.va().incrementRenderId(),this.xj(!0);const j=this;if(j.getBoundingInfo&&j.Rf){const e=j.getBoundingInfo();K=e.boundingBox.minimumWorld.clone(),b=e.boundingBox.maximumWorld.clone()}else K=new k.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),b=new k.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);if(e){const e=this.getDescendants(!1);for(const j of e){const e=j;if(e.xj(!0),z&&!z(e))continue;if(!e.getBoundingInfo||0===e.getTotalVertices())continue;const T=e.getBoundingInfo().boundingBox,F=T.minimumWorld,l=T.maximumWorld;k.k.CheckExtends(F,K,b),k.k.CheckExtends(l,K,b)}}return{min:K,max:b}}}X._AnimationRangeFactory=(K,b,e)=>{throw(0,l.c)("AnimationRange")},X._NodeConstructors={},(0,z.b)([(0,j.M)()],X.prototype,"name",void 0),(0,z.b)([(0,j.M)()],X.prototype,"id",void 0),(0,z.b)([(0,j.M)()],X.prototype,"uniqueId",void 0),(0,z.b)([(0,j.M)()],X.prototype,"state",void 0),(0,z.b)([(0,j.M)()],X.prototype,"metadata",void 0)},10960:(K,b,e)=>{"use strict";e.d(b,{e:()=>KK});var z=e(10686),k=e(10707),j=e(10690),T=e(10951);class F{constructor(){this._count=0,this._data={}}p(K){this.clear(),K.forEach(((K,b)=>this.add(K,b)))}get(K){const b=this._data[K];if(void 0!==b)return b}getOrAddWithFactory(K,b){let e=this.get(K);return void 0!==e||(e=b(K),e&&this.add(K,e)),e}getOrAdd(K,b){const e=this.get(K);return void 0!==e?e:(this.add(K,b),b)}contains(K){return void 0!==this._data[K]}add(K,b){return void 0===this._data[K]&&(this._data[K]=b,++this._count,!0)}set(K,b){return void 0!==this._data[K]&&(this._data[K]=b,!0)}getAndRemove(K){const b=this.get(K);return void 0!==b?(delete this._data[K],--this._count,b):null}remove(K){return!!this.contains(K)&&(delete this._data[K],--this._count,!0)}clear(){this._data={},this._count=0}get count(){return this._count}forEach(K){for(const b in this._data){K(b,this._data[b])}}first(K){for(const b in this._data){const e=K(b,this._data[b]);if(e)return e}return null}}var l=e(10963),Y=e(10967),A=e(10990),X=e(11017),t=e(11021);class U{constructor(K,b,e,z,k,j){this.source=K,this.pointerX=b,this.pointerY=e,this.meshUnderPointer=z,this.sourceEvent=k,this.additionalData=j}static CreateNew(K,b,e){const z=K.va();return new U(K,z.pointerX,z.pointerY,z.meshUnderPointer||K,b,e)}static CreateNewFromSprite(K,b,e,z){return new U(K,b.pointerX,b.pointerY,b.meshUnderPointer,e,z)}static CreateNewFromScene(K,b){return new U(null,K.pointerX,K.pointerY,K.meshUnderPointer,b)}static CreateNewFromPrimitive(K,b,e,z){return new U(K,b.x,b.y,null,e,z)}}var B=e(11037),u=e(11046),m=e(11049),D=e(10693),I=e(10720),x=e(10710),Q=e(11054);class G{constructor(){this.hoverCursor="",this.actions=[],this.isRecursive=!1,this.disposeWhenUnowned=!0}static get HasTriggers(){for(const K in G.Triggers)if(Object.prototype.hasOwnProperty.call(G.Triggers,K))return!0;return!1}static get HasPickTriggers(){for(const K in G.Triggers)if(Object.prototype.hasOwnProperty.call(G.Triggers,K)){const b=parseInt(K);if(b>=1&&b<=7)return!0}return!1}static HasSpecificTrigger(K){for(const b in G.Triggers)if(Object.prototype.hasOwnProperty.call(G.Triggers,b)){if(parseInt(b)===K)return!0}return!1}}G.Triggers={};var i,S,M,r,L,c,v,w=e(11057);!function(K){K[K.Generic=0]="Generic",K[K.Keyboard=1]="Keyboard",K[K.Mouse=2]="Mouse",K[K.Touch=3]="Touch",K[K.DualShock=4]="DualShock",K[K.Xbox=5]="Xbox",K[K.Switch=6]="Switch",K[K.DualSense=7]="DualSense"}(i||(i={})),function(K){K[K.Horizontal=0]="Horizontal",K[K.Vertical=1]="Vertical",K[K.LeftClick=2]="LeftClick",K[K.MiddleClick=3]="MiddleClick",K[K.RightClick=4]="RightClick",K[K.BrowserBack=5]="BrowserBack",K[K.BrowserForward=6]="BrowserForward",K[K.MouseWheelX=7]="MouseWheelX",K[K.MouseWheelY=8]="MouseWheelY",K[K.MouseWheelZ=9]="MouseWheelZ",K[K.Move=12]="Move"}(S||(S={})),function(K){K[K.Horizontal=0]="Horizontal",K[K.Vertical=1]="Vertical",K[K.LeftClick=2]="LeftClick",K[K.MiddleClick=3]="MiddleClick",K[K.RightClick=4]="RightClick",K[K.BrowserBack=5]="BrowserBack",K[K.BrowserForward=6]="BrowserForward",K[K.MouseWheelX=7]="MouseWheelX",K[K.MouseWheelY=8]="MouseWheelY",K[K.MouseWheelZ=9]="MouseWheelZ",K[K.DeltaHorizontal=10]="DeltaHorizontal",K[K.DeltaVertical=11]="DeltaVertical"}(M||(M={})),function(K){K[K.Cross=0]="Cross",K[K.Circle=1]="Circle",K[K.Square=2]="Square",K[K.Triangle=3]="Triangle",K[K.L1=4]="L1",K[K.R1=5]="R1",K[K.L2=6]="L2",K[K.R2=7]="R2",K[K.Share=8]="Share",K[K.Options=9]="Options",K[K.L3=10]="L3",K[K.R3=11]="R3",K[K.DPadUp=12]="DPadUp",K[K.DPadDown=13]="DPadDown",K[K.DPadLeft=14]="DPadLeft",K[K.DPadRight=15]="DPadRight",K[K.Home=16]="Home",K[K.TouchPad=17]="TouchPad",K[K.LStickXAxis=18]="LStickXAxis",K[K.LStickYAxis=19]="LStickYAxis",K[K.RStickXAxis=20]="RStickXAxis",K[K.RStickYAxis=21]="RStickYAxis"}(r||(r={})),function(K){K[K.Cross=0]="Cross",K[K.Circle=1]="Circle",K[K.Square=2]="Square",K[K.Triangle=3]="Triangle",K[K.L1=4]="L1",K[K.R1=5]="R1",K[K.L2=6]="L2",K[K.R2=7]="R2",K[K.Create=8]="Create",K[K.Options=9]="Options",K[K.L3=10]="L3",K[K.R3=11]="R3",K[K.DPadUp=12]="DPadUp",K[K.DPadDown=13]="DPadDown",K[K.DPadLeft=14]="DPadLeft",K[K.DPadRight=15]="DPadRight",K[K.Home=16]="Home",K[K.TouchPad=17]="TouchPad",K[K.LStickXAxis=18]="LStickXAxis",K[K.LStickYAxis=19]="LStickYAxis",K[K.RStickXAxis=20]="RStickXAxis",K[K.RStickYAxis=21]="RStickYAxis"}(L||(L={})),function(K){K[K.A=0]="A",K[K.B=1]="B",K[K.X=2]="X",K[K.Y=3]="Y",K[K.LB=4]="LB",K[K.RB=5]="RB",K[K.LT=6]="LT",K[K.RT=7]="RT",K[K.Back=8]="Back",K[K.Start=9]="Start",K[K.LS=10]="LS",K[K.RS=11]="RS",K[K.DPadUp=12]="DPadUp",K[K.DPadDown=13]="DPadDown",K[K.DPadLeft=14]="DPadLeft",K[K.DPadRight=15]="DPadRight",K[K.Home=16]="Home",K[K.LStickXAxis=17]="LStickXAxis",K[K.LStickYAxis=18]="LStickYAxis",K[K.RStickXAxis=19]="RStickXAxis",K[K.RStickYAxis=20]="RStickYAxis"}(c||(c={})),function(K){K[K.B=0]="B",K[K.A=1]="A",K[K.Y=2]="Y",K[K.X=3]="X",K[K.L=4]="L",K[K.R=5]="R",K[K.ZL=6]="ZL",K[K.ZR=7]="ZR",K[K.Minus=8]="Minus",K[K.Plus=9]="Plus",K[K.LS=10]="LS",K[K.RS=11]="RS",K[K.DPadUp=12]="DPadUp",K[K.DPadDown=13]="DPadDown",K[K.DPadLeft=14]="DPadLeft",K[K.DPadRight=15]="DPadRight",K[K.Home=16]="Home",K[K.Capture=17]="Capture",K[K.LStickXAxis=18]="LStickXAxis",K[K.LStickYAxis=19]="LStickYAxis",K[K.RStickXAxis=20]="RStickXAxis",K[K.RStickYAxis=21]="RStickYAxis"}(v||(v={}));var h=e(11059);class R{static CreateDeviceEvent(K,b,e,z,k,j,T){switch(K){case i.Keyboard:return this._CreateKeyboardEvent(e,z,k,j);case i.Mouse:if(e===S.MouseWheelX||e===S.MouseWheelY||e===S.MouseWheelZ)return this._CreateWheelEvent(K,b,e,z,k,j);case i.Touch:return this._CreatePointerEvent(K,b,e,z,k,j,T);default:throw`Unable to generate event for device ${i[K]}`}}static _CreatePointerEvent(K,b,e,z,k,j,T){const F=this._CreateMouseEvent(K,b,e,z,k,j);K===i.Mouse?(F.deviceType=i.Mouse,F.pointerId=1,F.pointerType="mouse"):(F.deviceType=i.Touch,F.pointerId=T??b,F.pointerType="touch");let l=0;return l+=k.pollInput(K,b,S.LeftClick),l+=2*k.pollInput(K,b,S.RightClick),l+=4*k.pollInput(K,b,S.MiddleClick),F.buttons=l,e===S.Move?F.type="pointermove":e>=S.LeftClick&&e<=S.RightClick&&(F.type=1===z?"pointerdown":"pointerup",F.button=e-2),F}static _CreateWheelEvent(K,b,e,z,k,j){const T=this._CreateMouseEvent(K,b,e,z,k,j);switch(T.pointerId=1,T.type="wheel",T.deltaMode=h.e.DOM_DELTA_PIXEL,T.deltaX=0,T.deltaY=0,T.deltaZ=0,e){case S.MouseWheelX:T.deltaX=z;break;case S.MouseWheelY:T.deltaY=z;break;case S.MouseWheelZ:T.deltaZ=z}return T}static _CreateMouseEvent(K,b,e,z,k,j){const T=this._CreateEvent(j),F=k.pollInput(K,b,S.Horizontal),l=k.pollInput(K,b,S.Vertical);return j?(T.movementX=0,T.movementY=0,T.offsetX=T.movementX-j.getBoundingClientRect().x,T.offsetY=T.movementY-j.getBoundingClientRect().y):(T.movementX=k.pollInput(K,b,10),T.movementY=k.pollInput(K,b,11),T.offsetX=0,T.offsetY=0),this._CheckNonCharacterKeys(T,k),T.clientX=F,T.clientY=l,T.x=F,T.y=l,T.deviceType=K,T.deviceSlot=b,T.inputIndex=e,T}static _CreateKeyboardEvent(K,b,e,z){const k=this._CreateEvent(z);return this._CheckNonCharacterKeys(k,e),k.deviceType=i.Keyboard,k.deviceSlot=0,k.inputIndex=K,k.type=1===b?"keydown":"keyup",k.key=String.fromCharCode(K),k.keyCode=K,k}static _CheckNonCharacterKeys(K,b){const e=b.isDeviceAvailable(i.Keyboard),z=e&&1===b.pollInput(i.Keyboard,0,18),k=e&&1===b.pollInput(i.Keyboard,0,17),j=e&&(1===b.pollInput(i.Keyboard,0,91)||1===b.pollInput(i.Keyboard,0,92)||1===b.pollInput(i.Keyboard,0,93)),T=e&&1===b.pollInput(i.Keyboard,0,16);K.altKey=z,K.ctrlKey=k,K.metaKey=j,K.shiftKey=T}static _CreateEvent(K){const b={preventDefault:()=>{}};return b.target=K,b}}class n{constructor(K,b,e){this._nativeInput=_native.DeviceInputSystem?new _native.DeviceInputSystem(K,b,((K,b,z,k)=>{const j=R.CreateDeviceEvent(K,b,z,k,this);e(K,b,j)})):this._createDummyNativeInput()}pollInput(K,b,e){return this._nativeInput.pollInput(K,b,e)}isDeviceAvailable(K){return K===i.Mouse||K===i.Touch}dispose(){this._nativeInput.dispose()}_createDummyNativeInput(){return{pollInput:()=>0,isDeviceAvailable:()=>!1,dispose:()=>{}}}}const P=Object.keys(S).length/2;class d{constructor(K,b,e,k){this._inputs=[],this._keyboardActive=!1,this._pointerActive=!1,this._usingSafari=z.f.IsSafari(),this._usingMacOS=(0,D.g)()&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),this._keyboardDownEvent=K=>{},this._keyboardUpEvent=K=>{},this._keyboardBlurEvent=K=>{},this._pointerMoveEvent=K=>{},this._pointerDownEvent=K=>{},this._pointerUpEvent=K=>{},this._pointerCancelEvent=K=>{},this._pointerWheelEvent=K=>{},this._pointerBlurEvent=K=>{},this._pointerMacOSChromeOutEvent=K=>{},this._eventsAttached=!1,this._mouseId=-1,this._isUsingFirefox=(0,D.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Firefox"),this._isUsingChromium=(0,D.g)()&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Chrome"),this._maxTouchPoints=0,this._pointerInputClearObserver=null,this._gamepadConnectedEvent=K=>{},this._gamepadDisconnectedEvent=K=>{},this._eventPrefix=z.f.GetPointerPrefix(K),this._engine=K,this._onDeviceConnected=b,this._onDeviceDisconnected=e,this._onInputChanged=k,this._mouseId=this._isUsingFirefox?0:1,this._enableEvents(),this._usingMacOS&&(this._metaKeys=[]),this._engine._onEngineViewChanged||(this._engine._onEngineViewChanged=()=>{this._enableEvents()})}pollInput(K,b,e){const k=this._inputs[K][b];if(!k)throw`Unable to find device ${i[K]}`;K>=i.DualShock&&K<=i.DualSense&&this._updateDevice(K,b,e);const j=k[e];if(void 0===j)throw`Unable to find input ${e} for device ${i[K]} in slot ${b}`;return e===S.Move&&z.f.Warn("Unable to provide information for PointerInput.Move.  Try using PointerInput.Horizontal or PointerInput.Vertical for move data."),j}isDeviceAvailable(K){return void 0!==this._inputs[K]}dispose(){this._onDeviceConnected=()=>{},this._onDeviceDisconnected=()=>{},this._onInputChanged=()=>{},delete this._engine._onEngineViewChanged,this._elementToAttachTo&&this._disableEvents()}_enableEvents(){const K=null===this||void 0===this?void 0:this._engine.getInputElement();if(K&&(!this._eventsAttached||this._elementToAttachTo!==K)){if(this._disableEvents(),this._inputs)for(const K of this._inputs)if(K)for(const b in K){const e=K[+b];if(e)for(let K=0;K<e.length;K++)e[K]=0}this._elementToAttachTo=K,this._elementToAttachTo.tabIndex=-1!==this._elementToAttachTo.tabIndex?this._elementToAttachTo.tabIndex:this._engine.canvasTabIndex,this._handleKeyActions(),this._handlePointerActions(),this._handleGamepadActions(),this._eventsAttached=!0,this._checkForConnectedDevices()}}_disableEvents(){this._elementToAttachTo&&(this._elementToAttachTo.removeEventListener("blur",this._keyboardBlurEvent),this._elementToAttachTo.removeEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.removeEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.removeEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.removeEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.removeEventListener(this._wheelEventName,this._pointerWheelEvent),this._usingMacOS&&this._isUsingChromium&&this._elementToAttachTo.removeEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent),window.removeEventListener("gamepadconnected",this._gamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)),this._pointerInputClearObserver&&this._engine.onEndFrameObservable.remove(this._pointerInputClearObserver),this._eventsAttached=!1}_checkForConnectedDevices(){if(navigator.getGamepads){const K=navigator.getGamepads();for(const b of K)b&&this._addGamePad(b)}"function"===typeof matchMedia&&matchMedia("(pointer:fine)").matches&&this._addPointerDevice(i.Mouse,0,0,0)}_addGamePad(K){const b=this._getGamepadDeviceType(K.id),e=K.index;this._gamepads=this._gamepads||new Array(K.index+1),this._registerDevice(b,e,K.buttons.length+K.axes.length),this._gamepads[e]=b}_addPointerDevice(K,b,e,z){this._pointerActive||(this._pointerActive=!0),this._registerDevice(K,b,P);const k=this._inputs[K][b];k[0]=e,k[1]=z}_registerDevice(K,b,e){if(void 0===b)throw`Unable to register device ${i[K]} to undefined slot.`;if(this._inputs[K]||(this._inputs[K]={}),!this._inputs[K][b]){const z=new Array(e);z.fill(0),this._inputs[K][b]=z,this._onDeviceConnected(K,b)}}_unregisterDevice(K,b){this._inputs[K][b]&&(delete this._inputs[K][b],this._onDeviceDisconnected(K,b))}_handleKeyActions(){this._keyboardDownEvent=K=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(i.Keyboard,0,255));const b=this._inputs[i.Keyboard][0];if(b){b[K.keyCode]=1;const e=K;e.inputIndex=K.keyCode,this._usingMacOS&&K.metaKey&&"Meta"!==K.key&&(this._metaKeys.includes(K.keyCode)||this._metaKeys.push(K.keyCode)),this._onInputChanged(i.Keyboard,0,e)}},this._keyboardUpEvent=K=>{this._keyboardActive||(this._keyboardActive=!0,this._registerDevice(i.Keyboard,0,255));const b=this._inputs[i.Keyboard][0];if(b){b[K.keyCode]=0;const e=K;if(e.inputIndex=K.keyCode,this._usingMacOS&&"Meta"===K.key&&this._metaKeys.length>0){for(const K of this._metaKeys){const e=R.CreateDeviceEvent(i.Keyboard,0,K,0,this,this._elementToAttachTo);b[K]=0,this._onInputChanged(i.Keyboard,0,e)}this._metaKeys.splice(0,this._metaKeys.length)}this._onInputChanged(i.Keyboard,0,e)}},this._keyboardBlurEvent=()=>{if(this._keyboardActive){const K=this._inputs[i.Keyboard][0];for(let b=0;b<K.length;b++)if(0!==K[b]){K[b]=0;const e=R.CreateDeviceEvent(i.Keyboard,0,b,0,this,this._elementToAttachTo);this._onInputChanged(i.Keyboard,0,e)}this._usingMacOS&&this._metaKeys.splice(0,this._metaKeys.length)}},this._elementToAttachTo.addEventListener("keydown",this._keyboardDownEvent),this._elementToAttachTo.addEventListener("keyup",this._keyboardUpEvent),this._elementToAttachTo.addEventListener("blur",this._keyboardBlurEvent)}_handlePointerActions(){this._maxTouchPoints=(0,D.g)()&&navigator.maxTouchPoints||2,this._activeTouchIds||(this._activeTouchIds=new Array(this._maxTouchPoints));for(let z=0;z<this._maxTouchPoints;z++)this._activeTouchIds[z]=-1;this._pointerMoveEvent=K=>{const b=this._getPointerType(K);let e=b===i.Mouse?0:this._activeTouchIds.indexOf(K.pointerId);if(b===i.Touch&&-1===e){const k=this._activeTouchIds.indexOf(-1);if(!(k>=0))return void z.f.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);e=k,this._activeTouchIds[k]=K.pointerId,this._onDeviceConnected(b,e)}this._inputs[b]||(this._inputs[b]={}),this._inputs[b][e]||this._addPointerDevice(b,e,K.clientX,K.clientY);const k=this._inputs[b][e];if(k){const z=K;z.inputIndex=S.Move,k[S.Horizontal]=K.clientX,k[S.Vertical]=K.clientY,b===i.Touch&&0===k[S.LeftClick]&&(k[S.LeftClick]=1),void 0===K.pointerId&&(K.pointerId=this._mouseId),this._onInputChanged(b,e,z),this._usingSafari||-1===K.button||(z.inputIndex=K.button+2,k[K.button+2]=k[K.button+2]?0:1,this._onInputChanged(b,e,z))}},this._pointerDownEvent=K=>{const b=this._getPointerType(K);let e=b===i.Mouse?0:K.pointerId;if(b===i.Touch){let b=this._activeTouchIds.indexOf(K.pointerId);if(-1===b&&(b=this._activeTouchIds.indexOf(-1)),!(b>=0))return void z.f.Warn(`Max number of touches exceeded.  Ignoring touches in excess of ${this._maxTouchPoints}`);e=b,this._activeTouchIds[b]=K.pointerId}this._inputs[b]||(this._inputs[b]={}),this._inputs[b][e]?b===i.Touch&&this._onDeviceConnected(b,e):this._addPointerDevice(b,e,K.clientX,K.clientY);const k=this._inputs[b][e];if(k){const z=k[S.Horizontal],T=k[S.Vertical];if(b===i.Mouse){if(void 0===K.pointerId&&(K.pointerId=this._mouseId),!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(this._mouseId)}catch(j){}}else if(K.pointerId&&!document.pointerLockElement)try{this._elementToAttachTo.setPointerCapture(K.pointerId)}catch(j){}k[S.Horizontal]=K.clientX,k[S.Vertical]=K.clientY,k[K.button+2]=1;const F=K;F.inputIndex=K.button+2,this._onInputChanged(b,e,F),z===K.clientX&&T===K.clientY||(F.inputIndex=S.Move,this._onInputChanged(b,e,F))}},this._pointerUpEvent=K=>{var b;const e=this._getPointerType(K),z=e===i.Mouse?0:this._activeTouchIds.indexOf(K.pointerId);if(e===i.Touch){if(-1===z)return;this._activeTouchIds[z]=-1}const k=null===(b=this._inputs[e])||void 0===b?void 0:b[z];if(k&&0!==k[K.button+2]){var j,T,F,l;const b=k[S.Horizontal],Y=k[S.Vertical];k[S.Horizontal]=K.clientX,k[S.Vertical]=K.clientY,k[K.button+2]=0;const A=K;void 0===K.pointerId&&(K.pointerId=this._mouseId),b===K.clientX&&Y===K.clientY||(A.inputIndex=S.Move,this._onInputChanged(e,z,A)),A.inputIndex=K.button+2,e===i.Mouse&&this._mouseId>=0&&null!==(j=(T=this._elementToAttachTo).hasPointerCapture)&&void 0!==j&&j.call(T,this._mouseId)?this._elementToAttachTo.releasePointerCapture(this._mouseId):K.pointerId&&null!==(F=(l=this._elementToAttachTo).hasPointerCapture)&&void 0!==F&&F.call(l,K.pointerId)&&this._elementToAttachTo.releasePointerCapture(K.pointerId),this._onInputChanged(e,z,A),e===i.Touch&&this._onDeviceDisconnected(e,z)}},this._pointerCancelEvent=K=>{if("mouse"===K.pointerType){var b,e;const K=this._inputs[i.Mouse][0];this._mouseId>=0&&null!==(b=(e=this._elementToAttachTo).hasPointerCapture)&&void 0!==b&&b.call(e,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let b=S.LeftClick;b<=S.BrowserForward;b++)if(1===K[b]){K[b]=0;const e=R.CreateDeviceEvent(i.Mouse,0,b,0,this,this._elementToAttachTo);this._onInputChanged(i.Mouse,0,e)}}else{var z,k;const b=this._activeTouchIds.indexOf(K.pointerId);if(-1===b)return;null!==(z=(k=this._elementToAttachTo).hasPointerCapture)&&void 0!==z&&z.call(k,K.pointerId)&&this._elementToAttachTo.releasePointerCapture(K.pointerId),this._inputs[i.Touch][b][S.LeftClick]=0;const e=R.CreateDeviceEvent(i.Touch,b,S.LeftClick,0,this,this._elementToAttachTo,K.pointerId);this._onInputChanged(i.Touch,b,e),this._activeTouchIds[b]=-1,this._onDeviceDisconnected(i.Touch,b)}},this._wheelEventName="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";let K=!1;const b=function(){};try{const e=Object.defineProperty({},"passive",{get:function(){K=!0}});this._elementToAttachTo.addEventListener("test",b,e),this._elementToAttachTo.removeEventListener("test",b,e)}catch(e){}this._pointerBlurEvent=()=>{if(this.isDeviceAvailable(i.Mouse)){var K,b;const e=this._inputs[i.Mouse][0];this._mouseId>=0&&null!==(K=(b=this._elementToAttachTo).hasPointerCapture)&&void 0!==K&&K.call(b,this._mouseId)&&this._elementToAttachTo.releasePointerCapture(this._mouseId);for(let K=S.LeftClick;K<=S.BrowserForward;K++)if(1===e[K]){e[K]=0;const b=R.CreateDeviceEvent(i.Mouse,0,K,0,this,this._elementToAttachTo);this._onInputChanged(i.Mouse,0,b)}}if(this.isDeviceAvailable(i.Touch)){const K=this._inputs[i.Touch];for(let b=0;b<this._activeTouchIds.length;b++){var e,z,k;const j=this._activeTouchIds[b];if(null!==(e=(z=this._elementToAttachTo).hasPointerCapture)&&void 0!==e&&e.call(z,j)&&this._elementToAttachTo.releasePointerCapture(j),-1!==j&&1===(null===(k=K[b])||void 0===k?void 0:k[S.LeftClick])){K[b][S.LeftClick]=0;const e=R.CreateDeviceEvent(i.Touch,b,S.LeftClick,0,this,this._elementToAttachTo,j);this._onInputChanged(i.Touch,b,e),this._activeTouchIds[b]=-1,this._onDeviceDisconnected(i.Touch,b)}}}},this._pointerWheelEvent=K=>{const b=i.Mouse;this._inputs[b]||(this._inputs[b]=[]),this._inputs[b][0]||(this._pointerActive=!0,this._registerDevice(b,0,P));const e=this._inputs[b][0];if(e){e[S.MouseWheelX]=K.deltaX||0,e[S.MouseWheelY]=K.deltaY||K.wheelDelta||0,e[S.MouseWheelZ]=K.deltaZ||0;const z=K;void 0===K.pointerId&&(K.pointerId=this._mouseId),0!==e[S.MouseWheelX]&&(z.inputIndex=S.MouseWheelX,this._onInputChanged(b,0,z)),0!==e[S.MouseWheelY]&&(z.inputIndex=S.MouseWheelY,this._onInputChanged(b,0,z)),0!==e[S.MouseWheelZ]&&(z.inputIndex=S.MouseWheelZ,this._onInputChanged(b,0,z))}},this._usingMacOS&&this._isUsingChromium&&(this._pointerMacOSChromeOutEvent=K=>{K.buttons>1&&this._pointerCancelEvent(K)},this._elementToAttachTo.addEventListener("lostpointercapture",this._pointerMacOSChromeOutEvent)),this._elementToAttachTo.addEventListener(this._eventPrefix+"move",this._pointerMoveEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"down",this._pointerDownEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"up",this._pointerUpEvent),this._elementToAttachTo.addEventListener(this._eventPrefix+"cancel",this._pointerCancelEvent),this._elementToAttachTo.addEventListener("blur",this._pointerBlurEvent),this._elementToAttachTo.addEventListener(this._wheelEventName,this._pointerWheelEvent,!!K&&{passive:!1}),this._pointerInputClearObserver=this._engine.onEndFrameObservable.add((()=>{if(this.isDeviceAvailable(i.Mouse)){const K=this._inputs[i.Mouse][0];K[S.MouseWheelX]=0,K[S.MouseWheelY]=0,K[S.MouseWheelZ]=0}}))}_handleGamepadActions(){this._gamepadConnectedEvent=K=>{this._addGamePad(K.gamepad)},this._gamepadDisconnectedEvent=K=>{if(this._gamepads){const b=this._getGamepadDeviceType(K.gamepad.id),e=K.gamepad.index;this._unregisterDevice(b,e),delete this._gamepads[e]}},window.addEventListener("gamepadconnected",this._gamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this._gamepadDisconnectedEvent)}_updateDevice(K,b,e){const z=navigator.getGamepads()[b];if(z&&K===this._gamepads[b]){const k=this._inputs[K][b];e>=z.buttons.length?k[e]=z.axes[e-z.buttons.length].valueOf():k[e]=z.buttons[e].value}}_getGamepadDeviceType(K){return-1!==K.indexOf("054c")?-1!==K.indexOf("0ce6")?i.DualSense:i.DualShock:-1!==K.indexOf("Xbox One")||-1!==K.search("Xbox 360")||-1!==K.search("xinput")?i.Xbox:-1!==K.indexOf("057e")?i.Switch:i.Generic}_getPointerType(K){let b=i.Mouse;return("touch"===K.pointerType||"pen"===K.pointerType||K.touches)&&(b=i.Touch),b}}class p{constructor(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.deviceType=b,this.deviceSlot=e,this.onInputChangedObservable=new j.d,this._deviceInputSystem=K}getInput(K){return this._deviceInputSystem.pollInput(this.deviceType,this.deviceSlot,K)}}class a{constructor(K){this._registeredManagers=new Array,this._refCount=0,this.registerManager=K=>{for(let b=0;b<this._devices.length;b++){const e=this._devices[b];for(const z in e){const e=+z;K._addDevice(new p(this._deviceInputSystem,b,e))}}this._registeredManagers.push(K)},this.unregisterManager=K=>{const b=this._registeredManagers.indexOf(K);b>-1&&this._registeredManagers.splice(b,1)};const b=Object.keys(i).length/2;this._devices=new Array(b);const e=(K,b)=>{this._devices[K]||(this._devices[K]=new Array),this._devices[K][b]||(this._devices[K][b]=b);for(const e of this._registeredManagers){const z=new p(this._deviceInputSystem,K,b);e._addDevice(z)}},z=(K,b)=>{var e;null!==(e=this._devices[K])&&void 0!==e&&e[b]&&delete this._devices[K][b];for(const z of this._registeredManagers)z._removeDevice(K,b)},k=(K,b,e)=>{if(e)for(const z of this._registeredManagers)z._onInputChanged(K,b,e)};"undefined"!==typeof _native?this._deviceInputSystem=new n(e,z,k):this._deviceInputSystem=new d(K,e,z,k)}dispose(){this._deviceInputSystem.dispose()}}class O{getDeviceSource(K,b){if(void 0===b){if(void 0===this._firstDevice[K])return null;b=this._firstDevice[K]}return this._devices[K]&&void 0!==this._devices[K][b]?this._devices[K][b]:null}getDeviceSources(K){return this._devices[K]?this._devices[K].filter((K=>!!K)):[]}constructor(K){const b=Object.keys(i).length/2;this._devices=new Array(b),this._firstDevice=new Array(b),this._engine=K,this._engine._deviceSourceManager||(this._engine._deviceSourceManager=new a(K)),this._engine._deviceSourceManager._refCount++,this.onDeviceConnectedObservable=new j.d((K=>{for(const b of this._devices)if(b)for(const e of b)e&&this.onDeviceConnectedObservable.notifyObserver(K,e)})),this.onDeviceDisconnectedObservable=new j.d,this._engine._deviceSourceManager.registerManager(this),this._onDisposeObserver=K.Ui.add((()=>{this.dispose()}))}dispose(){this.onDeviceConnectedObservable.clear(),this.onDeviceDisconnectedObservable.clear(),this._engine._deviceSourceManager&&(this._engine._deviceSourceManager.unregisterManager(this),--this._engine._deviceSourceManager._refCount<1&&(this._engine._deviceSourceManager.dispose(),delete this._engine._deviceSourceManager)),this._engine.Ui.remove(this._onDisposeObserver)}_addDevice(K){this._devices[K.deviceType]||(this._devices[K.deviceType]=new Array),this._devices[K.deviceType][K.deviceSlot]||(this._devices[K.deviceType][K.deviceSlot]=K,this._updateFirstDevices(K.deviceType)),this.onDeviceConnectedObservable.notifyObservers(K)}_removeDevice(K,b){var e,z;const k=null===(e=this._devices[K])||void 0===e?void 0:e[b];this.onDeviceDisconnectedObservable.notifyObservers(k),null!==(z=this._devices[K])&&void 0!==z&&z[b]&&delete this._devices[K][b],this._updateFirstDevices(K)}_onInputChanged(K,b,e){var z,k;null===(z=this._devices[K])||void 0===z||null===(k=z[b])||void 0===k||k.onInputChangedObservable.notifyObservers(e)}_updateFirstDevices(K){switch(K){case i.Keyboard:case i.Mouse:this._firstDevice[K]=0;break;case i.Touch:case i.DualSense:case i.DualShock:case i.Xbox:case i.Switch:case i.Generic:{delete this._firstDevice[K];const b=this._devices[K];if(b)for(let e=0;e<b.length;e++)if(b[e]){this._firstDevice[K]=e;break}break}}}}var g=e(11062);class N{constructor(){this._singleClick=!1,this._doubleClick=!1,this._hasSwiped=!1,this._ignore=!1}get singleClick(){return this._singleClick}get doubleClick(){return this._doubleClick}get hasSwiped(){return this._hasSwiped}get ignore(){return this._ignore}set singleClick(K){this._singleClick=K}set doubleClick(K){this._doubleClick=K}set hasSwiped(K){this._hasSwiped=K}set ignore(K){this._ignore=K}}class Z{constructor(K){this._alreadyAttached=!1,this._meshPickProceed=!1,this._currentPickResult=null,this._previousPickResult=null,this._activePointerIds=new Array,this._activePointerIdsCount=0,this._doubleClickOccured=!1,this._isSwiping=!1,this._swipeButtonPressed=-1,this._skipPointerTap=!1,this._isMultiTouchGesture=!1,this._pointerX=0,this._pointerY=0,this._startingPointerPosition=new Y.h(0,0),this._previousStartingPointerPosition=new Y.h(0,0),this._startingPointerTime=0,this._previousStartingPointerTime=0,this._pointerCaptures={},this._meshUnderPointerId={},this._movePointerInfo=null,this._cameraObserverCount=0,this._delayedClicks=[null,null,null,null,null],this._deviceSourceManager=null,this._scene=K||I.b.LastCreatedScene,this._scene}get meshUnderPointer(){return this._movePointerInfo&&(this._movePointerInfo._generatePickInfo(),this._movePointerInfo=null),this._pointerOverMesh}getMeshUnderPointerByPointerId(K){return this._meshUnderPointerId[K]||null}get unTranslatedPointer(){return new Y.h(this._unTranslatedPointerX,this._unTranslatedPointerY)}get pointerX(){return this._pointerX}set pointerX(K){this._pointerX=K}get pointerY(){return this._pointerY}set pointerY(K){this._pointerY=K}_updatePointerPosition(K){const b=this._scene.getEngine().getInputElementClientRect();b&&(this._pointerX=K.clientX-b.left,this._pointerY=K.clientY-b.top,this._unTranslatedPointerX=this._pointerX,this._unTranslatedPointerY=this._pointerY)}_processPointerMove(K,b){const e=this._scene,z=e.getEngine(),k=z.getInputElement();k&&(k.tabIndex=z.canvasTabIndex,e.doNotHandleCursors||(k.style.cursor=e.defaultCursor)),this._setCursorAndPointerOverMesh(K,b,e);for(const l of e._pointerMoveStage){var j;const e=!(null===(j=K=K||this._pickMove(b))||void 0===j||!j.pickedMesh);K=l.action(this._unTranslatedPointerX,this._unTranslatedPointerY,K,e,k)}const T=b.inputIndex>=S.MouseWheelX&&b.inputIndex<=S.MouseWheelZ?Q.b.POINTERWHEEL:Q.b.POINTERMOVE;let F;e.onPointerMove&&(K=K||this._pickMove(b),e.onPointerMove(b,K,T)),K?(F=new Q.h(T,b,K),this._setRayOnPointerInfo(K,b)):(F=new Q.h(T,b,null,this),this._movePointerInfo=F),e.onPointerObservable.hasObservers()&&e.onPointerObservable.notifyObservers(F,T)}_setRayOnPointerInfo(K,b){const e=this._scene;K&&g.c._IsPickingAvailable&&(K.ray||(K.ray=e.createPickingRay(b.offsetX,b.offsetY,Y.b.Identity(),e.activeCamera)))}_addCameraPointerObserver(K,b){return this._cameraObserverCount++,this._scene.onPointerObservable.add(K,b)}_removeCameraPointerObserver(K){return this._cameraObserverCount--,this._scene.onPointerObservable.remove(K)}_checkForPicking(){return!!(this._scene.onPointerObservable.observers.length>this._cameraObserverCount||this._scene.onPointerPick)}_checkPrePointerObservable(K,b,e){const z=this._scene,k=new Q.e(e,b,this._unTranslatedPointerX,this._unTranslatedPointerY);return K&&(k.originalPickingInfo=K,k.ray=K.ray,"xr-near"===b.pointerType&&K.originMesh&&(k.nearInteractionPickingInfo=K)),z.onPrePointerObservable.notifyObservers(k,e),!!k.skipOnPointerObservable}_pickMove(K){const b=this._scene,e=b.Oc(this._unTranslatedPointerX,this._unTranslatedPointerY,b.pointerMovePredicate,b.pointerMoveFastCheck,b.cameraToUseForPointers,b.pointerMoveTrianglePredicate);return this._setCursorAndPointerOverMesh(e,K,b),e}_setCursorAndPointerOverMesh(K,b,e){const z=e.getEngine().getInputElement();if(null!==K&&void 0!==K&&K.pickedMesh){if(this.setPointerOverMesh(K.pickedMesh,b.pointerId,K,b),!e.doNotHandleCursors&&z&&this._pointerOverMesh){const K=this._pointerOverMesh._getActionManagerForTrigger();K&&K.hasPointerTriggers&&(z.style.cursor=K.hoverCursor||e.hoverCursor)}}else this.setPointerOverMesh(null,b.pointerId,K,b)}simulatePointerMove(K,b){const e=new PointerEvent("pointermove",b);e.inputIndex=S.Move,this._checkPrePointerObservable(K,e,Q.b.POINTERMOVE)||this._processPointerMove(K,e)}simulatePointerDown(K,b){const e=new PointerEvent("pointerdown",b);e.inputIndex=e.button+2,this._checkPrePointerObservable(K,e,Q.b.POINTERDOWN)||this._processPointerDown(K,e)}_processPointerDown(K,b){var e;const z=this._scene;if(null!==(e=K)&&void 0!==e&&e.pickedMesh){this._pickedDownMesh=K.pickedMesh;const e=K.pickedMesh._getActionManagerForTrigger();if(e){if(e.hasPickTriggers)switch(e.processTrigger(5,U.CreateNew(K.pickedMesh,b,K)),b.button){case 0:e.processTrigger(2,U.CreateNew(K.pickedMesh,b,K));break;case 1:e.processTrigger(4,U.CreateNew(K.pickedMesh,b,K));break;case 2:e.processTrigger(3,U.CreateNew(K.pickedMesh,b,K))}e.hasSpecificTrigger(8)&&window.setTimeout((()=>{const K=z.Oc(this._unTranslatedPointerX,this._unTranslatedPointerY,(K=>K.ub&&K.isVisible&&K.isReady()&&K.actionManager&&K.actionManager.hasSpecificTrigger(8)&&K===this._pickedDownMesh),!1,z.cameraToUseForPointers);null!==K&&void 0!==K&&K.pickedMesh&&e&&0!==this._activePointerIdsCount&&Date.now()-this._startingPointerTime>Z.LongPressDelay&&!this._isPointerSwiping()&&(this._startingPointerTime=0,e.processTrigger(8,U.CreateNew(K.pickedMesh,b)))}),Z.LongPressDelay)}}else for(const T of z._pointerDownStage)K=T.action(this._unTranslatedPointerX,this._unTranslatedPointerY,K,b,!1);let k;const j=Q.b.POINTERDOWN;K?(z.onPointerDown&&z.onPointerDown(b,K,j),k=new Q.h(j,b,K),this._setRayOnPointerInfo(K,b)):k=new Q.h(j,b,null,this),z.onPointerObservable.hasObservers()&&z.onPointerObservable.notifyObservers(k,j)}_isPointerSwiping(){return this._isSwiping}simulatePointerUp(K,b,e){const z=new PointerEvent("pointerup",b);z.inputIndex=S.Move;const k=new N;e?k.doubleClick=!0:k.singleClick=!0,this._checkPrePointerObservable(K,z,Q.b.POINTERUP)||this._processPointerUp(K,z,k)}_processPointerUp(K,b,e){var z;const k=this._scene;if(null!==(z=K)&&void 0!==z&&z.pickedMesh){if(this._pickedUpMesh=K.pickedMesh,this._pickedDownMesh===this._pickedUpMesh&&(k.onPointerPick&&k.onPointerPick(b,K),e.singleClick&&!e.ignore&&k.onPointerObservable.observers.length>this._cameraObserverCount)){const e=Q.b.POINTERPICK,z=new Q.h(e,b,K);this._setRayOnPointerInfo(K,b),k.onPointerObservable.notifyObservers(z,e)}const z=K.pickedMesh._getActionManagerForTrigger();if(z&&!e.ignore){z.processTrigger(7,U.CreateNew(K.pickedMesh,b,K)),!e.hasSwiped&&e.singleClick&&z.processTrigger(1,U.CreateNew(K.pickedMesh,b,K));const k=K.pickedMesh._getActionManagerForTrigger(6);e.doubleClick&&k&&k.processTrigger(6,U.CreateNew(K.pickedMesh,b,K))}}else if(!e.ignore)for(const j of k._pointerUpStage)K=j.action(this._unTranslatedPointerX,this._unTranslatedPointerY,K,b,e.doubleClick);if(this._pickedDownMesh&&this._pickedDownMesh!==this._pickedUpMesh){const K=this._pickedDownMesh._getActionManagerForTrigger(16);K&&K.processTrigger(16,U.CreateNew(this._pickedDownMesh,b))}if(!e.ignore){const z=new Q.h(Q.b.POINTERUP,b,K);if(this._setRayOnPointerInfo(K,b),k.onPointerObservable.notifyObservers(z,Q.b.POINTERUP),k.onPointerUp&&k.onPointerUp(b,K,Q.b.POINTERUP),!e.hasSwiped&&!this._skipPointerTap&&!this._isMultiTouchGesture){let z=0;if(e.singleClick?z=Q.b.POINTERTAP:e.doubleClick&&(z=Q.b.POINTERDOUBLETAP),z){const e=new Q.h(z,b,K);k.onPointerObservable.hasObservers()&&k.onPointerObservable.hasSpecificMask(z)&&k.onPointerObservable.notifyObservers(e,z)}}}}isPointerCaptured(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._pointerCaptures[K]}attachControl(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;const k=this._scene,j=k.getEngine();z||(z=j.getInputElement()),this._alreadyAttached&&this.Bi(),z&&(this._alreadyAttachedTo=z),this._deviceSourceManager=new O(j),this._initActionManager=K=>{if(!this._meshPickProceed){const b=k.skipPointerUpPicking||0===k._registeredActions&&!this._checkForPicking()&&!k.onPointerUp?null:k.Oc(this._unTranslatedPointerX,this._unTranslatedPointerY,k.pointerUpPredicate,k.pointerUpFastCheck,k.cameraToUseForPointers,k.pointerUpTrianglePredicate);this._currentPickResult=b,b&&(K=b.hit&&b.pickedMesh?b.pickedMesh._getActionManagerForTrigger():null),this._meshPickProceed=!0}return K},this._delayedSimpleClick=(K,b,e)=>{if((Date.now()-this._previousStartingPointerTime>Z.DoubleClickDelay&&!this._doubleClickOccured||K!==this._previousButtonPressed)&&(this._doubleClickOccured=!1,b.singleClick=!0,b.ignore=!1,this._delayedClicks[K])){const b=this._delayedClicks[K].evt,e=Q.b.POINTERTAP,z=new Q.h(e,b,this._currentPickResult);k.onPointerObservable.hasObservers()&&k.onPointerObservable.hasSpecificMask(e)&&k.onPointerObservable.notifyObservers(z,e),this._delayedClicks[K]=null}},this._initClickEvent=(K,b,e,z)=>{const k=new N;this._currentPickResult=null;let j=null,T=K.hasSpecificMask(Q.b.POINTERPICK)||b.hasSpecificMask(Q.b.POINTERPICK)||K.hasSpecificMask(Q.b.POINTERTAP)||b.hasSpecificMask(Q.b.POINTERTAP)||K.hasSpecificMask(Q.b.POINTERDOUBLETAP)||b.hasSpecificMask(Q.b.POINTERDOUBLETAP);!T&&G&&(j=this._initActionManager(j,k),j&&(T=j.hasPickTriggers));let F=!1;if(T){const T=e.button;if(k.hasSwiped=this._isPointerSwiping(),!k.hasSwiped){let A=!Z.ExclusiveDoubleClickMode;if(A||(A=!K.hasSpecificMask(Q.b.POINTERDOUBLETAP)&&!b.hasSpecificMask(Q.b.POINTERDOUBLETAP),A&&!G.HasSpecificTrigger(6)&&(j=this._initActionManager(j,k),j&&(A=!j.hasSpecificTrigger(6)))),A)(Date.now()-this._previousStartingPointerTime>Z.DoubleClickDelay||T!==this._previousButtonPressed)&&(k.singleClick=!0,z(k,this._currentPickResult),F=!0);else{const K={evt:e,clickInfo:k,timeoutId:window.setTimeout(this._delayedSimpleClick.bind(this,T,k,z),Z.DoubleClickDelay)};this._delayedClicks[T]=K}let X=K.hasSpecificMask(Q.b.POINTERDOUBLETAP)||b.hasSpecificMask(Q.b.POINTERDOUBLETAP);if(!X&&G.HasSpecificTrigger(6)&&(j=this._initActionManager(j,k),j&&(X=j.hasSpecificTrigger(6))),X)if(T===this._previousButtonPressed&&Date.now()-this._previousStartingPointerTime<Z.DoubleClickDelay&&!this._doubleClickOccured){if(k.hasSwiped||this._isPointerSwiping())if(this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=T,Z.ExclusiveDoubleClickMode){var l;if(this._delayedClicks[T])clearTimeout(null===(l=this._delayedClicks[T])||void 0===l?void 0:l.timeoutId),this._delayedClicks[T]=null;z(k,this._previousPickResult)}else z(k,this._currentPickResult);else{var Y;if(this._previousStartingPointerTime=0,this._doubleClickOccured=!0,k.doubleClick=!0,k.ignore=!1,Z.ExclusiveDoubleClickMode&&this._delayedClicks[T])clearTimeout(null===(Y=this._delayedClicks[T])||void 0===Y?void 0:Y.timeoutId),this._delayedClicks[T]=null;z(k,this._currentPickResult)}F=!0}else this._doubleClickOccured=!1,this._previousStartingPointerTime=this._startingPointerTime,this._previousStartingPointerPosition.x=this._startingPointerPosition.x,this._previousStartingPointerPosition.y=this._startingPointerPosition.y,this._previousButtonPressed=T}}F||z(k,this._currentPickResult)},this._onPointerMove=K=>{if(this._updatePointerPosition(K),this._isSwiping||-1===this._swipeButtonPressed||(this._isSwiping=Math.abs(this._startingPointerPosition.x-this._pointerX)>Z.DragMovementThreshold||Math.abs(this._startingPointerPosition.y-this._pointerY)>Z.DragMovementThreshold),j.isPointerLock&&j._verifyPointerLock(),this._checkPrePointerObservable(null,K,K.inputIndex>=S.MouseWheelX&&K.inputIndex<=S.MouseWheelZ?Q.b.POINTERWHEEL:Q.b.POINTERMOVE))return;if(!k.cameraToUseForPointers&&!k.activeCamera)return;if(k.Ki)return void this._processPointerMove(new t.c,K);k.pointerMovePredicate||(k.pointerMovePredicate=K=>K.ub&&K.isVisible&&K.isReady()&&K.isEnabled()&&(K.enablePointerMoveEvents||k.constantlyUpdateMeshUnderPointer||null!==K._getActionManagerForTrigger())&&(!k.cameraToUseForPointers||0!==(k.cameraToUseForPointers.layerMask&K.layerMask)));const b=k._registeredActions>0||k.constantlyUpdateMeshUnderPointer?this._pickMove(K):null;this._processPointerMove(b,K)},this._onPointerDown=K=>{const b=this._activePointerIds.indexOf(-1);if(-1===b?this._activePointerIds.push(K.pointerId):this._activePointerIds[b]=K.pointerId,this._activePointerIdsCount++,this._pickedDownMesh=null,this._meshPickProceed=!1,Z.ExclusiveDoubleClickMode)for(let z=0;z<this._delayedClicks.length;z++)if(this._delayedClicks[z])if(K.button===z){var e;clearTimeout(null===(e=this._delayedClicks[z])||void 0===e?void 0:e.timeoutId)}else{const K=this._delayedClicks[z].clickInfo;this._doubleClickOccured=!1,K.singleClick=!0,K.ignore=!1;const b=this._delayedClicks[z].evt,e=Q.b.POINTERTAP,j=new Q.h(e,b,this._currentPickResult);k.onPointerObservable.hasObservers()&&k.onPointerObservable.hasSpecificMask(e)&&k.onPointerObservable.notifyObservers(j,e),this._delayedClicks[z]=null}if(this._updatePointerPosition(K),-1===this._swipeButtonPressed&&(this._swipeButtonPressed=K.button),k.preventDefaultOnPointerDown&&z&&(K.preventDefault(),z.focus()),this._startingPointerPosition.x=this._pointerX,this._startingPointerPosition.y=this._pointerY,this._startingPointerTime=Date.now(),this._checkPrePointerObservable(null,K,Q.b.POINTERDOWN))return;if(!k.cameraToUseForPointers&&!k.activeCamera)return;let j;this._pointerCaptures[K.pointerId]=!0,k.pointerDownPredicate||(k.pointerDownPredicate=K=>K.ub&&K.isVisible&&K.isReady()&&K.isEnabled()&&(!k.cameraToUseForPointers||0!==(k.cameraToUseForPointers.layerMask&K.layerMask))),this._pickedDownMesh=null,j=k.skipPointerDownPicking||0===k._registeredActions&&!this._checkForPicking()&&!k.onPointerDown?new t.c:k.Oc(this._unTranslatedPointerX,this._unTranslatedPointerY,k.pointerDownPredicate,k.pointerDownFastCheck,k.cameraToUseForPointers,k.pointerDownTrianglePredicate),this._processPointerDown(j,K)},this._onPointerUp=K=>{const b=this._activePointerIds.indexOf(K.pointerId);-1!==b&&(this._activePointerIds[b]=-1,this._activePointerIdsCount--,this._pickedUpMesh=null,this._meshPickProceed=!1,this._updatePointerPosition(K),k.preventDefaultOnPointerUp&&z&&(K.preventDefault(),z.focus()),this._initClickEvent(k.onPrePointerObservable,k.onPointerObservable,K,((b,e)=>{if(k.onPrePointerObservable.hasObservers()&&(this._skipPointerTap=!1,!b.ignore)){if(this._checkPrePointerObservable(null,K,Q.b.POINTERUP))return this._swipeButtonPressed===K.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1),void(0===K.buttons&&(this._pointerCaptures[K.pointerId]=!1));b.hasSwiped||(b.singleClick&&k.onPrePointerObservable.hasSpecificMask(Q.b.POINTERTAP)&&this._checkPrePointerObservable(null,K,Q.b.POINTERTAP)&&(this._skipPointerTap=!0),b.doubleClick&&k.onPrePointerObservable.hasSpecificMask(Q.b.POINTERDOUBLETAP)&&this._checkPrePointerObservable(null,K,Q.b.POINTERDOUBLETAP)&&(this._skipPointerTap=!0))}this._pointerCaptures[K.pointerId]?(0===K.buttons&&(this._pointerCaptures[K.pointerId]=!1),(k.cameraToUseForPointers||k.activeCamera)&&(k.pointerUpPredicate||(k.pointerUpPredicate=K=>K.ub&&K.isVisible&&K.isReady()&&K.isEnabled()&&(!k.cameraToUseForPointers||0!==(k.cameraToUseForPointers.layerMask&K.layerMask))),!this._meshPickProceed&&(G&&G.HasTriggers||this._checkForPicking()||k.onPointerUp)&&this._initActionManager(null,b),e||(e=this._currentPickResult),this._processPointerUp(e,K,b),this._previousPickResult=this._currentPickResult,this._swipeButtonPressed===K.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1))):this._swipeButtonPressed===K.button&&(this._isSwiping=!1,this._swipeButtonPressed=-1)})))},this._onKeyDown=K=>{const b=w.e.KEYDOWN;if(k.onPreKeyboardObservable.hasObservers()){const e=new w.g(b,K);if(k.onPreKeyboardObservable.notifyObservers(e,b),e.skipOnKeyboardObservable)return}if(k.onKeyboardObservable.hasObservers()){const e=new w.h(b,K);k.onKeyboardObservable.notifyObservers(e,b)}k.actionManager&&k.actionManager.processTrigger(14,U.CreateNewFromScene(k,K))},this._onKeyUp=K=>{const b=w.e.KEYUP;if(k.onPreKeyboardObservable.hasObservers()){const e=new w.g(b,K);if(k.onPreKeyboardObservable.notifyObservers(e,b),e.skipOnKeyboardObservable)return}if(k.onKeyboardObservable.hasObservers()){const e=new w.h(b,K);k.onKeyboardObservable.notifyObservers(e,b)}k.actionManager&&k.actionManager.processTrigger(15,U.CreateNewFromScene(k,K))},this._deviceSourceManager.onDeviceConnectedObservable.add((z=>{z.deviceType===i.Mouse?z.onInputChangedObservable.add((k=>{this._originMouseEvent=k,k.inputIndex===S.LeftClick||k.inputIndex===S.MiddleClick||k.inputIndex===S.RightClick||k.inputIndex===S.BrowserBack||k.inputIndex===S.BrowserForward?b&&1===z.getInput(k.inputIndex)?this._onPointerDown(k):K&&0===z.getInput(k.inputIndex)&&this._onPointerUp(k):e&&(k.inputIndex===S.Move?this._onPointerMove(k):k.inputIndex!==S.MouseWheelX&&k.inputIndex!==S.MouseWheelY&&k.inputIndex!==S.MouseWheelZ||this._onPointerMove(k))})):z.deviceType===i.Touch?z.onInputChangedObservable.add((k=>{k.inputIndex===S.LeftClick&&(b&&1===z.getInput(k.inputIndex)?(this._onPointerDown(k),this._activePointerIdsCount>1&&(this._isMultiTouchGesture=!0)):K&&0===z.getInput(k.inputIndex)&&(this._onPointerUp(k),0===this._activePointerIdsCount&&(this._isMultiTouchGesture=!1))),e&&k.inputIndex===S.Move&&this._onPointerMove(k)})):z.deviceType===i.Keyboard&&z.onInputChangedObservable.add((K=>{"keydown"===K.type?this._onKeyDown(K):"keyup"===K.type&&this._onKeyUp(K)}))})),this._alreadyAttached=!0}Bi(){this._alreadyAttached&&(this._deviceSourceManager.dispose(),this._deviceSourceManager=null,this._alreadyAttachedTo&&!this._scene.doNotHandleCursors&&(this._alreadyAttachedTo.style.cursor=this._scene.defaultCursor),this._alreadyAttached=!1,this._alreadyAttachedTo=null)}setPointerOverMesh(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0,z=arguments.length>3?arguments[3]:void 0;if(this._meshUnderPointerId[b]===K&&(!K||!K._internalAbstractMeshDataInfo._pointerOverDisableMeshTesting))return;const k=this._meshUnderPointerId[b];let j;k&&(j=k._getActionManagerForTrigger(10),j&&j.processTrigger(10,U.CreateNew(k,z,{pointerId:b}))),K?(this._meshUnderPointerId[b]=K,this._pointerOverMesh=K,j=K._getActionManagerForTrigger(9),j&&j.processTrigger(9,U.CreateNew(K,z,{pointerId:b,pickResult:e}))):(delete this._meshUnderPointerId[b],this._pointerOverMesh=null)}getPointerOverMesh(){return this.meshUnderPointer}_invalidateMesh(K){this._pointerOverMesh===K&&(this._pointerOverMesh=null),this._pickedDownMesh===K&&(this._pickedDownMesh=null),this._pickedUpMesh===K&&(this._pickedUpMesh=null);for(const b in this._meshUnderPointerId)this._meshUnderPointerId[b]===K&&delete this._meshUnderPointerId[b]}}Z.DragMovementThreshold=10,Z.LongPressDelay=500,Z.DoubleClickDelay=300,Z.ExclusiveDoubleClickMode=!1;var y=e(10810),s=e(10994),E=e(11066),o=e(11070),C=e(10723),H=e(11079),W=e(10975);class f{constructor(){this.pointerDownFastCheck=!1,this.pointerUpFastCheck=!1,this.pointerMoveFastCheck=!1,this.Ki=!1,this.skipPointerDownPicking=!1,this.skipPointerUpPicking=!1}}var V,q=e(10696),J=e(10799);!function(K){K[K.BackwardCompatible=0]="BackwardCompatible",K[K.Intermediate=1]="Intermediate",K[K.Aggressive=2]="Aggressive"}(V||(V={}));class KK{static DefaultMaterialFactory(K){throw(0,x.c)("nb")}static CollisionCoordinatorFactory(){throw(0,x.c)("DefaultCollisionCoordinator")}get clearColor(){return this._clearColor}set clearColor(K){K!==this._clearColor&&(this._clearColor=K,this.onClearColorChangedObservable.notifyObservers(this._clearColor))}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}get performancePriority(){return this._performancePriority}set performancePriority(K){if(K!==this._performancePriority){switch(this._performancePriority=K,K){case 0:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Ki=!1,this.Ci=!0;break;case 1:this.skipFrustumClipping=!1,this._renderingManager.maintainStateBetweenFrames=!1,this.Ki=!0,this.Ci=!1;break;case 2:this.skipFrustumClipping=!0,this._renderingManager.maintainStateBetweenFrames=!0,this.Ki=!0,this.Ci=!1}this.onScenePerformancePriorityChangedObservable.notifyObservers(K)}}set forceWireframe(K){this._forceWireframe!==K&&(this._forceWireframe=K,this.markAllMaterialsAsDirty(16))}get forceWireframe(){return this._forceWireframe}set skipFrustumClipping(K){this._skipFrustumClipping!==K&&(this._skipFrustumClipping=K)}get skipFrustumClipping(){return this._skipFrustumClipping}set forcePointsCloud(K){this._forcePointsCloud!==K&&(this._forcePointsCloud=K,this.markAllMaterialsAsDirty(16))}get forcePointsCloud(){return this._forcePointsCloud}get environmentTexture(){return this._environmentTexture}set environmentTexture(K){this._environmentTexture!==K&&(this._environmentTexture=K,this.markAllMaterialsAsDirty(1))}getNodes(){let K=[];return K=K.concat(this.meshes),K=K.concat(this.lights),K=K.concat(this.cameras),K=K.concat(this.transformNodes),this.skeletons.forEach((b=>K=K.concat(b.bones))),K}get animationPropertiesOverride(){return this._animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}set onDispose(K){this._onDisposeObserver&&this.Ui.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ui.add(K)}set beforeRender(K){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),K&&(this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(K))}set afterRender(K){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),K&&(this._onAfterRenderObserver=this.onAfterRenderObservable.add(K))}set beforeCameraRender(K){this._onBeforeCameraRenderObserver&&this.onBeforeCameraRenderObservable.remove(this._onBeforeCameraRenderObserver),this._onBeforeCameraRenderObserver=this.onBeforeCameraRenderObservable.add(K)}set afterCameraRender(K){this._onAfterCameraRenderObserver&&this.onAfterCameraRenderObservable.remove(this._onAfterCameraRenderObserver),this._onAfterCameraRenderObserver=this.onAfterCameraRenderObservable.add(K)}get pointerDownPredicate(){return this._pointerPickingConfiguration.pointerDownPredicate}set pointerDownPredicate(K){this._pointerPickingConfiguration.pointerDownPredicate=K}get pointerUpPredicate(){return this._pointerPickingConfiguration.pointerUpPredicate}set pointerUpPredicate(K){this._pointerPickingConfiguration.pointerUpPredicate=K}get pointerMovePredicate(){return this._pointerPickingConfiguration.pointerMovePredicate}set pointerMovePredicate(K){this._pointerPickingConfiguration.pointerMovePredicate=K}get pointerDownFastCheck(){return this._pointerPickingConfiguration.pointerDownFastCheck}set pointerDownFastCheck(K){this._pointerPickingConfiguration.pointerDownFastCheck=K}get pointerUpFastCheck(){return this._pointerPickingConfiguration.pointerUpFastCheck}set pointerUpFastCheck(K){this._pointerPickingConfiguration.pointerUpFastCheck=K}get pointerMoveFastCheck(){return this._pointerPickingConfiguration.pointerMoveFastCheck}set pointerMoveFastCheck(K){this._pointerPickingConfiguration.pointerMoveFastCheck=K}get Ki(){return this._pointerPickingConfiguration.Ki}set Ki(K){this._pointerPickingConfiguration.Ki=K}get skipPointerDownPicking(){return this._pointerPickingConfiguration.skipPointerDownPicking}set skipPointerDownPicking(K){this._pointerPickingConfiguration.skipPointerDownPicking=K}get skipPointerUpPicking(){return this._pointerPickingConfiguration.skipPointerUpPicking}set skipPointerUpPicking(K){this._pointerPickingConfiguration.skipPointerUpPicking=K}get unTranslatedPointer(){return this._inputManager.unTranslatedPointer}static get DragMovementThreshold(){return Z.DragMovementThreshold}static set DragMovementThreshold(K){Z.DragMovementThreshold=K}static get LongPressDelay(){return Z.LongPressDelay}static set LongPressDelay(K){Z.LongPressDelay=K}static get DoubleClickDelay(){return Z.DoubleClickDelay}static set DoubleClickDelay(K){Z.DoubleClickDelay=K}static get ExclusiveDoubleClickMode(){return Z.ExclusiveDoubleClickMode}static set ExclusiveDoubleClickMode(K){Z.ExclusiveDoubleClickMode=K}bindEyePosition(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vEyePosition",e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const z=this._forcedViewPosition?this._forcedViewPosition:this._mirroredCameraPosition?this._mirroredCameraPosition:this.activeCamera.globalPosition,k=this.useRightHandedSystem===(null!=this._mirroredCameraPosition);return Y.e.Vector4[0].set(z.x,z.y,z.z,k?-1:1),K&&(e?K.setFloat3(b,Y.e.Vector4[0].x,Y.e.Vector4[0].y,Y.e.Vector4[0].z):K.setVector4(b,Y.e.Vector4[0])),Y.e.Vector4[0]}finalizeSceneUbo(){const K=this.getSceneUniformBuffer(),b=this.bindEyePosition(null);return K.updateFloat4("vEyePosition",b.x,b.y,b.z,b.w),K.update(),K}set useRightHandedSystem(K){this._useRightHandedSystem!==K&&(this._useRightHandedSystem=K,this.markAllMaterialsAsDirty(16))}get useRightHandedSystem(){return this._useRightHandedSystem}setStepId(K){this._currentStepId=K}getStepId(){return this._currentStepId}getInternalStep(){return this._currentInternalStep}set fogEnabled(K){this._fogEnabled!==K&&(this._fogEnabled=K,this.markAllMaterialsAsDirty(16))}get fogEnabled(){return this._fogEnabled}set fogMode(K){this._fogMode!==K&&(this._fogMode=K,this.markAllMaterialsAsDirty(16))}get fogMode(){return this._fogMode}get prePass(){return!!this.prePassRenderer&&this.prePassRenderer.defaultRT.enabled}set shadowsEnabled(K){this._shadowsEnabled!==K&&(this._shadowsEnabled=K,this.markAllMaterialsAsDirty(2))}get shadowsEnabled(){return this._shadowsEnabled}set lightsEnabled(K){this._lightsEnabled!==K&&(this._lightsEnabled=K,this.markAllMaterialsAsDirty(2))}get lightsEnabled(){return this._lightsEnabled}get activeCameras(){return this._activeCameras}set activeCameras(K){this._unObserveActiveCameras&&(this._unObserveActiveCameras(),this._unObserveActiveCameras=null),K&&(this._unObserveActiveCameras=(0,W.j)(K,(()=>{this.onActiveCamerasChanged.notifyObservers(this)}))),this._activeCameras=K}get activeCamera(){return this._activeCamera}set activeCamera(K){K!==this._activeCamera&&(this._activeCamera=K,this.onActiveCameraChanged.notifyObservers(this))}get defaultMaterial(){return this.di||(this.di=KK.DefaultMaterialFactory(this)),this.di}set defaultMaterial(K){this.di=K}set texturesEnabled(K){this._texturesEnabled!==K&&(this._texturesEnabled=K,this.markAllMaterialsAsDirty(1))}get texturesEnabled(){return this._texturesEnabled}get frameGraph(){return this._frameGraph}set frameGraph(K){if(this._frameGraph)return this._frameGraph=K,void(K||(this.customRenderFunction=this._currentCustomRenderFunction));this._frameGraph=K,K&&(this._currentCustomRenderFunction=this.customRenderFunction,this.customRenderFunction=this._renderWithFrameGraph)}set skeletonsEnabled(K){this._skeletonsEnabled!==K&&(this._skeletonsEnabled=K,this.markAllMaterialsAsDirty(8))}get skeletonsEnabled(){return this._skeletonsEnabled}get collisionCoordinator(){return this._collisionCoordinator||(this._collisionCoordinator=KK.CollisionCoordinatorFactory(),this._collisionCoordinator.init(this)),this._collisionCoordinator}get renderingManager(){return this._renderingManager}get frustumPlanes(){return this._frustumPlanes}_registerTransientComponents(){if(this._transientComponents.length>0){for(const K of this._transientComponents)K.register();this._transientComponents.length=0}}o(K){this._components.push(K),this._transientComponents.push(K);const b=K;b.addFromContainer&&b.serialize&&this._serializableComponents.push(b)}_getComponent(K){for(const b of this._components)if(b.name===K)return b;return null}constructor(K,b){this._inputManager=new Z(this),this.cameraToUseForPointers=null,this._isScene=!0,this._blockEntityCollection=!1,this.Ci=!0,this.autoClearDepthAndStencil=!0,this._clearColor=new s.g(.2,.2,.3,1),this.onClearColorChangedObservable=new j.d,this.ambientColor=new s.c(0,0,0),this.environmentIntensity=1,this._performancePriority=0,this.onScenePerformancePriorityChangedObservable=new j.d,this._forceWireframe=!1,this._skipFrustumClipping=!1,this._forcePointsCloud=!1,this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this._i=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.effectLayers=[],this.Kj=null,this.layers=[],this.lensFlareSystems=[],this.proceduralTextures=[],this.animationsEnabled=!0,this._animationPropertiesOverride=null,this.useConstantAnimationDeltaTime=!1,this.constantlyUpdateMeshUnderPointer=!1,this.hoverCursor="pointer",this.defaultCursor="",this.doNotHandleCursors=!1,this.preventDefaultOnPointerDown=!0,this.preventDefaultOnPointerUp=!0,this.metadata=null,this.reservedDataStore=null,this.disableOfflineSupportExceptionRules=[],this.Ui=new j.d,this._onDisposeObserver=null,this.onBeforeRenderObservable=new j.d,this._onBeforeRenderObserver=null,this.onAfterRenderObservable=new j.d,this.onAfterRenderCameraObservable=new j.d,this._onAfterRenderObserver=null,this.onBeforeAnimationsObservable=new j.d,this.onAfterAnimationsObservable=new j.d,this.onBeforeDrawPhaseObservable=new j.d,this.onAfterDrawPhaseObservable=new j.d,this.onReadyObservable=new j.d,this.onBeforeCameraRenderObservable=new j.d,this._onBeforeCameraRenderObserver=null,this.onAfterCameraRenderObservable=new j.d,this._onAfterCameraRenderObserver=null,this.onBeforeActiveMeshesEvaluationObservable=new j.d,this.onAfterActiveMeshesEvaluationObservable=new j.d,this.onBeforeParticlesRenderingObservable=new j.d,this.onAfterParticlesRenderingObservable=new j.d,this.onDataLoadedObservable=new j.d,this.onNewCameraAddedObservable=new j.d,this.onCameraRemovedObservable=new j.d,this.onNewLightAddedObservable=new j.d,this.onLightRemovedObservable=new j.d,this.onNewGeometryAddedObservable=new j.d,this.onGeometryRemovedObservable=new j.d,this.onNewTransformNodeAddedObservable=new j.d,this.onTransformNodeRemovedObservable=new j.d,this.onNewMeshAddedObservable=new j.d,this.onMeshRemovedObservable=new j.d,this.onNewSkeletonAddedObservable=new j.d,this.onSkeletonRemovedObservable=new j.d,this.onNewMaterialAddedObservable=new j.d,this.onNewMultiMaterialAddedObservable=new j.d,this.onMaterialRemovedObservable=new j.d,this.onMultiMaterialRemovedObservable=new j.d,this.onNewTextureAddedObservable=new j.d,this.onTextureRemovedObservable=new j.d,this.onBeforeRenderTargetsRenderObservable=new j.d,this.onAfterRenderTargetsRenderObservable=new j.d,this.onBeforeStepObservable=new j.d,this.onAfterStepObservable=new j.d,this.onActiveCameraChanged=new j.d,this.onActiveCamerasChanged=new j.d,this.onBeforeRenderingGroupObservable=new j.d,this.onAfterRenderingGroupObservable=new j.d,this.onMeshImportedObservable=new j.d,this.onAnimationFileImportedObservable=new j.d,this._registeredForLateAnimationBindings=new T.e(256),this._pointerPickingConfiguration=new f,this.onPrePointerObservable=new j.d,this.onPointerObservable=new j.d,this.onPreKeyboardObservable=new j.d,this.onKeyboardObservable=new j.d,this._useRightHandedSystem=!1,this._timeAccumulator=0,this._currentStepId=0,this._currentInternalStep=0,this._fogEnabled=!0,this._fogMode=KK.FOGMODE_NONE,this.fogColor=new s.c(.2,.2,.3),this.fogDensity=.1,this.fogStart=0,this.fogEnd=1e3,this.needsPreviousWorldMatrices=!1,this._shadowsEnabled=!0,this._lightsEnabled=!0,this._unObserveActiveCameras=null,this._texturesEnabled=!0,this._frameGraph=null,this.physicsEnabled=!0,this.particlesEnabled=!0,this.spritesEnabled=!0,this._skeletonsEnabled=!0,this.lensFlaresEnabled=!0,this.collisionsEnabled=!0,this.gravity=new Y.k(0,-9.807,0),this.postProcessesEnabled=!0,this.renderTargetsEnabled=!0,this.dumpNextRenderTargets=!1,this.customRenderTargets=[],this.importedMeshesFiles=[],this.probesEnabled=!0,this._meshesForIntersections=new T.e(256),this.proceduralTexturesEnabled=!0,this._totalVertices=new y.e,this._activeIndices=new y.e,this._activeParticles=new y.e,this._activeBones=new y.e,this._animationTime=0,this.animationTimeScale=1,this._renderId=0,this._frameId=0,this._executeWhenReadyTimeoutId=null,this._intermediateRendering=!1,this._defaultFrameBufferCleared=!1,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1,this._toBeDisposed=new Array(256),this._activeRequests=new Array,this._pendingData=new Array,this._isDisposed=!1,this.dispatchAllSubMeshesOfActiveMeshes=!1,this._activeMeshes=new T.h(256),this._processedMaterials=new T.h(256),this._renderTargets=new T.e(256),this._materialsRenderTargets=new T.e(256),this._activeParticleSystems=new T.h(256),this._activeSkeletons=new T.e(32),this._softwareSkinnedMeshes=new T.e(32),this._activeAnimatables=new Array,this._transformMatrix=Y.b.Zero(),this.requireLightSorting=!1,this._components=[],this._serializableComponents=[],this._transientComponents=[],this._beforeCameraUpdateStage=m.h.Create(),this._beforeClearStage=m.h.Create(),this._beforeRenderTargetClearStage=m.h.Create(),this._gatherRenderTargetsStage=m.h.Create(),this._gatherActiveCameraRenderTargetsStage=m.h.Create(),this._isReadyForMeshStage=m.h.Create(),this._beforeEvaluateActiveMeshStage=m.h.Create(),this._evaluateSubMeshStage=m.h.Create(),this._preActiveMeshStage=m.h.Create(),this._cameraDrawRenderTargetStage=m.h.Create(),this._beforeCameraDrawStage=m.h.Create(),this._beforeRenderTargetDrawStage=m.h.Create(),this._beforeRenderingGroupDrawStage=m.h.Create(),this._beforeRenderingMeshStage=m.h.Create(),this._afterRenderingMeshStage=m.h.Create(),this._afterRenderingGroupDrawStage=m.h.Create(),this._afterCameraDrawStage=m.h.Create(),this._afterCameraPostProcessStage=m.h.Create(),this._afterRenderTargetDrawStage=m.h.Create(),this._afterRenderTargetPostProcessStage=m.h.Create(),this._afterRenderStage=m.h.Create(),this._pointerMoveStage=m.h.Create(),this._pointerDownStage=m.h.Create(),this._pointerUpStage=m.h.Create(),this._geometriesByUniqueId=null,this._defaultMeshCandidates={data:[],length:0},this._defaultSubMeshCandidates={data:[],length:0},this._preventFreeActiveMeshesAndRenderingGroups=!1,this._activeMeshesFrozen=!1,this._activeMeshesFrozenButKeepClipping=!1,this._skipEvaluateActiveMeshesCompletely=!1,this._allowPostProcessClearColor=!0,this.getDeterministicFrameTime=()=>this._engine.getTimeStep(),this._registeredActions=0,this._blockMaterialDirtyMechanism=!1,this._perfCollector=null,this.activeCameras=[];const e={useGeometryUniqueIdsMap:!0,useMaterialMeshMap:!0,useClonedMeshMap:!0,virtual:!1,...b};K=this._engine=K||I.b.LastCreatedEngine,e.virtual?K._virtualScenes.push(this):(I.b._LastCreatedScene=this,K.scenes.push(this)),this._uid=null,this._renderingManager=new u.c(this),B.b&&(this.postProcessManager=new B.b(this)),(0,D.k)()&&this.attachControl(),this._createUbo(),A.d&&(this._imageProcessingConfiguration=new A.d),this.setDefaultCandidateProviders(),e.useGeometryUniqueIdsMap&&(this._geometriesByUniqueId={}),this.useMaterialMeshMap=e.useMaterialMeshMap,this.useClonedMeshMap=e.useClonedMeshMap,b&&b.virtual||K.onNewSceneAddedObservable.notifyObservers(this)}getClassName(){return"Scene"}_getDefaultMeshCandidates(){return this._defaultMeshCandidates.data=this.meshes,this._defaultMeshCandidates.length=this.meshes.length,this._defaultMeshCandidates}_getDefaultSubMeshCandidates(K){return this._defaultSubMeshCandidates.data=K.Rf,this._defaultSubMeshCandidates.length=K.Rf.length,this._defaultSubMeshCandidates}setDefaultCandidateProviders(){this.getActiveMeshCandidates=()=>this._getDefaultMeshCandidates(),this.getActiveSubMeshCandidates=K=>this._getDefaultSubMeshCandidates(K),this.getIntersectingSubMeshCandidates=(K,b)=>this._getDefaultSubMeshCandidates(K),this.getCollidingSubMeshCandidates=(K,b)=>this._getDefaultSubMeshCandidates(K)}get meshUnderPointer(){return this._inputManager.meshUnderPointer}get pointerX(){return this._inputManager.pointerX}set pointerX(K){this._inputManager.pointerX=K}get pointerY(){return this._inputManager.pointerY}set pointerY(K){this._inputManager.pointerY=K}getCachedMaterial(){return this._cachedMaterial}getCachedEffect(){return this._cachedEffect}getCachedVisibility(){return this._cachedVisibility}isCachedMaterialInvalid(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this._cachedEffect!==b||this._cachedMaterial!==K||this._cachedVisibility!==e}getEngine(){return this._engine}getTotalVertices(){return this._totalVertices.current}get totalVerticesPerfCounter(){return this._totalVertices}getActiveIndices(){return this._activeIndices.current}get totalActiveIndicesPerfCounter(){return this._activeIndices}getActiveParticles(){return this._activeParticles.current}get activeParticlesPerfCounter(){return this._activeParticles}getActiveBones(){return this._activeBones.current}get activeBonesPerfCounter(){return this._activeBones}getActiveMeshes(){return this._activeMeshes}getAnimationRatio(){return void 0!==this._animationRatio?this._animationRatio:1}getRenderId(){return this._renderId}getFrameId(){return this._frameId}incrementRenderId(){this._renderId++}_createUbo(){this.setSceneUniformBuffer(this.createSceneUniformBuffer())}simulatePointerMove(K,b){return this._inputManager.simulatePointerMove(K,b),this}simulatePointerDown(K,b){return this._inputManager.simulatePointerDown(K,b),this}simulatePointerUp(K,b,e){return this._inputManager.simulatePointerUp(K,b,e),this}isPointerCaptured(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this._inputManager.isPointerCaptured(K)}attachControl(){let K=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._inputManager.attachControl(K,b,e)}Bi(){this._inputManager.Bi()}isReady(){var K,b;let e,z=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._isDisposed)return!1;const k=this.getEngine(),j=k.currentRenderPassId;k.currentRenderPassId=(null===(K=this.activeCamera)||void 0===K?void 0:K.renderPassId)??j;let T=!0;for(this._pendingData.length>0&&(T=!1),null===(b=this.prePassRenderer)||void 0===b||b.update(),this.useOrderIndependentTransparency&&this.depthPeelingRenderer&&T&&(T=this.depthPeelingRenderer.isReady()),z&&(this._processedMaterials.reset(),this._materialsRenderTargets.reset()),e=0;e<this.meshes.length;e++){const K=this.meshes[e];if(!K.Rf||0===K.Rf.length)continue;if(!K.isReady(!0)){T=!1;continue}const b=K.hasThinInstances||"InstancedMesh"===K.getClassName()||"InstancedLinesMesh"===K.getClassName()||k.getCaps().instancedArrays&&K.instances.length>0;for(const e of this._isReadyForMeshStage)e.action(K,b)||(T=!1);if(!z)continue;const j=K.material||this.defaultMaterial;if(j)if(j._storeEffectOnSubMeshes)for(const e of K.Rf){const K=e.Ha();K&&K.hasRenderTargetTextures&&null!=K.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(K)&&(this._processedMaterials.push(K),this._materialsRenderTargets.concatWithNoDuplicate(K.getRenderTargetTextures()))}else j.hasRenderTargetTextures&&null!=j.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(j)&&(this._processedMaterials.push(j),this._materialsRenderTargets.concatWithNoDuplicate(j.getRenderTargetTextures()))}if(z)for(e=0;e<this._materialsRenderTargets.length;++e){this._materialsRenderTargets.data[e].isReadyForRendering()||(T=!1)}for(e=0;e<this.geometries.length;e++){2===this.geometries[e].delayLoadState&&(T=!1)}if(this.activeCameras&&this.activeCameras.length>0)for(const F of this.activeCameras)F.isReady(!0)||(T=!1);else this.activeCamera&&(this.activeCamera.isReady(!0)||(T=!1));for(const F of this._i)F.isReady()||(T=!1);if(this.layers)for(const F of this.layers)F.isReady()||(T=!1);return k.areAllEffectsReady()||(T=!1),k.currentRenderPassId=j,T}resetCachedMaterial(){this._cachedMaterial=null,this._cachedEffect=null,this._cachedVisibility=null}registerBeforeRender(K){this.onBeforeRenderObservable.add(K)}unregisterBeforeRender(K){this.onBeforeRenderObservable.removeCallback(K)}registerAfterRender(K){this.onAfterRenderObservable.add(K)}unregisterAfterRender(K){this.onAfterRenderObservable.removeCallback(K)}_executeOnceBeforeRender(K){const b=()=>{K(),setTimeout((()=>{this.unregisterBeforeRender(b)}))};this.registerBeforeRender(b)}executeOnceBeforeRender(K,b){void 0!==b?setTimeout((()=>{this._executeOnceBeforeRender(K)}),b):this._executeOnceBeforeRender(K)}addPendingData(K){this._pendingData.push(K)}removePendingData(K){const b=this.isLoading,e=this._pendingData.indexOf(K);-1!==e&&this._pendingData.splice(e,1),b&&!this.isLoading&&this.onDataLoadedObservable.notifyObservers(this)}getWaitingItemsCount(){return this._pendingData.length}get isLoading(){return this._pendingData.length>0}executeWhenReady(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.onReadyObservable.addOnce(K),null===this._executeWhenReadyTimeoutId&&this._checkIsReady(b)}whenReadyAsync(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return new Promise((b=>{this.executeWhenReady((()=>{b()}),K)}))}_checkIsReady(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._registerTransientComponents(),this.isReady(K)?(this.onReadyObservable.notifyObservers(this),this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):this._isDisposed?(this.onReadyObservable.clear(),void(this._executeWhenReadyTimeoutId=null)):void(this._executeWhenReadyTimeoutId=setTimeout((()=>{this.incrementRenderId(),this._checkIsReady(K)}),100))}get animatables(){return this._activeAnimatables}resetLastAnimationTimeFrame(){this._animationTimeLast=k.e.Now}getViewMatrix(){return this._viewMatrix}getProjectionMatrix(){return this._projectionMatrix}getTransformMatrix(){return this._transformMatrix}setTransformMatrix(K,b,e,z){e||z||!this._multiviewSceneUbo||(this._multiviewSceneUbo.dispose(),this._multiviewSceneUbo=null),this._viewUpdateFlag===K.updateFlag&&this._projectionUpdateFlag===b.updateFlag||(this._viewUpdateFlag=K.updateFlag,this._projectionUpdateFlag=b.updateFlag,this._viewMatrix=K,this._projectionMatrix=b,this._viewMatrix.multiplyToRef(this._projectionMatrix,this._transformMatrix),this._frustumPlanes?E.e.GetPlanesToRef(this._transformMatrix,this._frustumPlanes):this._frustumPlanes=E.e.GetPlanes(this._transformMatrix),this._multiviewSceneUbo&&this._multiviewSceneUbo.useUbo?this._updateMultiviewUbo(e,z):this._sceneUbo.useUbo&&(this._sceneUbo.qj("viewProjection",this._transformMatrix),this._sceneUbo.qj("view",this._viewMatrix),this._sceneUbo.qj("projection",this._projectionMatrix)))}getSceneUniformBuffer(){return this._multiviewSceneUbo?this._multiviewSceneUbo:this._sceneUbo}createSceneUniformBuffer(K){const b=new X.d(this._engine,void 0,!1,K??"Ad");return b.addUniform("viewProjection",16),b.addUniform("view",16),b.addUniform("projection",16),b.addUniform("vEyePosition",4),b}setSceneUniformBuffer(K){this._sceneUbo=K,this._viewUpdateFlag=-1,this._projectionUpdateFlag=-1}getUniqueId(){return o.d.UniqueId}Wh(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._blockEntityCollection||(this.meshes.push(K),K._resyncLightSources(),K.parent||K._addToSceneRootNodes(),this.onNewMeshAddedObservable.notifyObservers(K),b&&K.getChildMeshes().forEach((K=>{this.Wh(K)})))}sd(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const e=this.meshes.indexOf(K);return-1!==e&&(this.meshes.splice(e,1),K.parent||K._removeFromSceneRootNodes()),this._inputManager._invalidateMesh(K),this.onMeshRemovedObservable.notifyObservers(K),b&&K.getChildMeshes().forEach((K=>{this.sd(K)})),e}addTransformNode(K){this._blockEntityCollection||K.va()===this&&-1!==K._indexInSceneTransformNodesArray||(K._indexInSceneTransformNodesArray=this.transformNodes.length,this.transformNodes.push(K),K.parent||K._addToSceneRootNodes(),this.onNewTransformNodeAddedObservable.notifyObservers(K))}removeTransformNode(K){const b=K._indexInSceneTransformNodesArray;if(-1!==b){if(b!==this.transformNodes.length-1){const K=this.transformNodes[this.transformNodes.length-1];this.transformNodes[b]=K,K._indexInSceneTransformNodesArray=b}K._indexInSceneTransformNodesArray=-1,this.transformNodes.pop(),K.parent||K._removeFromSceneRootNodes()}return this.onTransformNodeRemovedObservable.notifyObservers(K),b}removeSkeleton(K){const b=this.skeletons.indexOf(K);return-1!==b&&(this.skeletons.splice(b,1),this.onSkeletonRemovedObservable.notifyObservers(K),this._executeActiveContainerCleanup(this._activeSkeletons)),b}removeMorphTargetManager(K){const b=this.morphTargetManagers.indexOf(K);return-1!==b&&this.morphTargetManagers.splice(b,1),b}removeLight(K){const b=this.lights.indexOf(K);if(-1!==b){for(const b of this.meshes)b._removeLightSource(K,!1);this.lights.splice(b,1),this.sortLightsByPriority(),K.parent||K._removeFromSceneRootNodes()}return this.onLightRemovedObservable.notifyObservers(K),b}removeCamera(K){const b=this.cameras.indexOf(K);if(-1!==b&&(this.cameras.splice(b,1),K.parent||K._removeFromSceneRootNodes()),this.activeCameras){const b=this.activeCameras.indexOf(K);-1!==b&&this.activeCameras.splice(b,1)}return this.activeCamera===K&&(this.cameras.length>0?this.activeCamera=this.cameras[0]:this.activeCamera=null),this.onCameraRemovedObservable.notifyObservers(K),b}removeParticleSystem(K){const b=this._i.indexOf(K);return-1!==b&&(this._i.splice(b,1),this._executeActiveContainerCleanup(this._activeParticleSystems)),b}removeAnimation(K){const b=this.animations.indexOf(K);return-1!==b&&this.animations.splice(b,1),b}stopAnimation(K,b,e){}removeAnimationGroup(K){const b=this.animationGroups.indexOf(K);return-1!==b&&this.animationGroups.splice(b,1),b}removeMultiMaterial(K){const b=this.multiMaterials.indexOf(K);return-1!==b&&this.multiMaterials.splice(b,1),this.onMultiMaterialRemovedObservable.notifyObservers(K),b}removeMaterial(K){const b=K._indexInSceneMaterialArray;if(-1!==b&&b<this.materials.length){if(b!==this.materials.length-1){const K=this.materials[this.materials.length-1];this.materials[b]=K,K._indexInSceneMaterialArray=b}K._indexInSceneMaterialArray=-1,this.materials.pop()}return this.onMaterialRemovedObservable.notifyObservers(K),b}removeActionManager(K){const b=this.actionManagers.indexOf(K);return-1!==b&&this.actionManagers.splice(b,1),b}removeTexture(K){const b=this.textures.indexOf(K);return-1!==b&&this.textures.splice(b,1),this.onTextureRemovedObservable.notifyObservers(K),b}addLight(K){if(!this._blockEntityCollection){this.lights.push(K),this.sortLightsByPriority(),K.parent||K._addToSceneRootNodes();for(const b of this.meshes)-1===b.lightSources.indexOf(K)&&(b.lightSources.push(K),b._resyncLightSources());this.onNewLightAddedObservable.notifyObservers(K)}}sortLightsByPriority(){this.requireLightSorting&&this.lights.sort(H.c.CompareLightsPriority)}addCamera(K){this._blockEntityCollection||(this.cameras.push(K),this.onNewCameraAddedObservable.notifyObservers(K),K.parent||K._addToSceneRootNodes())}addSkeleton(K){this._blockEntityCollection||(this.skeletons.push(K),this.onNewSkeletonAddedObservable.notifyObservers(K))}addParticleSystem(K){this._blockEntityCollection||this._i.push(K)}addAnimation(K){this._blockEntityCollection||this.animations.push(K)}addAnimationGroup(K){this._blockEntityCollection||this.animationGroups.push(K)}addMultiMaterial(K){this._blockEntityCollection||(this.multiMaterials.push(K),this.onNewMultiMaterialAddedObservable.notifyObservers(K))}addMaterial(K){this._blockEntityCollection||K.va()===this&&-1!==K._indexInSceneMaterialArray||(K._indexInSceneMaterialArray=this.materials.length,this.materials.push(K),this.onNewMaterialAddedObservable.notifyObservers(K))}addMorphTargetManager(K){this._blockEntityCollection||this.morphTargetManagers.push(K)}addGeometry(K){this._blockEntityCollection||(this._geometriesByUniqueId&&(this._geometriesByUniqueId[K.uniqueId]=this.geometries.length),this.geometries.push(K))}addActionManager(K){this.actionManagers.push(K)}addTexture(K){this._blockEntityCollection||(this.textures.push(K),this.onNewTextureAddedObservable.notifyObservers(K))}switchActiveCamera(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._engine.getInputElement()&&(this.activeCamera&&this.activeCamera.Bi(),this.activeCamera=K,b&&K.attachControl())}setActiveCameraById(K){const b=this.getCameraById(K);return b?(this.activeCamera=b,b):null}setActiveCameraByName(K){const b=this.getCameraByName(K);return b?(this.activeCamera=b,b):null}getAnimationGroupByName(K){for(let b=0;b<this.animationGroups.length;b++)if(this.animationGroups[b].name===K)return this.animationGroups[b];return null}_getMaterial(K,b){for(let e=0;e<this.materials.length;e++){const K=this.materials[e];if(b(K))return K}if(K)for(let e=0;e<this.multiMaterials.length;e++){const K=this.multiMaterials[e];if(b(K))return K}return null}getMaterialByUniqueID(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(b,(b=>b.uniqueId===K))}getMaterialById(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(b,(b=>b.id===K))}getMaterialByName(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._getMaterial(b,(b=>b.name===K))}getLastMaterialById(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(let e=this.materials.length-1;e>=0;e--)if(this.materials[e].id===K)return this.materials[e];if(b)for(let e=this.multiMaterials.length-1;e>=0;e--)if(this.multiMaterials[e].id===K)return this.multiMaterials[e];return null}getTextureByUniqueId(K){for(let b=0;b<this.textures.length;b++)if(this.textures[b].uniqueId===K)return this.textures[b];return null}getTextureByName(K){for(let b=0;b<this.textures.length;b++)if(this.textures[b].name===K)return this.textures[b];return null}getCameraById(K){for(let b=0;b<this.cameras.length;b++)if(this.cameras[b].id===K)return this.cameras[b];return null}getCameraByUniqueId(K){for(let b=0;b<this.cameras.length;b++)if(this.cameras[b].uniqueId===K)return this.cameras[b];return null}getCameraByName(K){for(let b=0;b<this.cameras.length;b++)if(this.cameras[b].name===K)return this.cameras[b];return null}getBoneById(K){for(let b=0;b<this.skeletons.length;b++){const e=this.skeletons[b];for(let b=0;b<e.bones.length;b++)if(e.bones[b].id===K)return e.bones[b]}return null}getBoneByName(K){for(let b=0;b<this.skeletons.length;b++){const e=this.skeletons[b];for(let b=0;b<e.bones.length;b++)if(e.bones[b].name===K)return e.bones[b]}return null}getLightByName(K){for(let b=0;b<this.lights.length;b++)if(this.lights[b].name===K)return this.lights[b];return null}getLightById(K){for(let b=0;b<this.lights.length;b++)if(this.lights[b].id===K)return this.lights[b];return null}getLightByUniqueId(K){for(let b=0;b<this.lights.length;b++)if(this.lights[b].uniqueId===K)return this.lights[b];return null}getParticleSystemById(K){for(let b=0;b<this._i.length;b++)if(this._i[b].id===K)return this._i[b];return null}getGeometryById(K){for(let b=0;b<this.geometries.length;b++)if(this.geometries[b].id===K)return this.geometries[b];return null}_getGeometryByUniqueId(K){if(this._geometriesByUniqueId){const b=this._geometriesByUniqueId[K];if(void 0!==b)return this.geometries[b]}else for(let b=0;b<this.geometries.length;b++)if(this.geometries[b].uniqueId===K)return this.geometries[b];return null}pushGeometry(K,b){return!(!b&&this._getGeometryByUniqueId(K.uniqueId))&&(this.addGeometry(K),this.onNewGeometryAddedObservable.notifyObservers(K),!0)}removeGeometry(K){let b;if(this._geometriesByUniqueId){if(b=this._geometriesByUniqueId[K.uniqueId],void 0===b)return!1}else if(b=this.geometries.indexOf(K),b<0)return!1;if(b!==this.geometries.length-1){const K=this.geometries[this.geometries.length-1];K&&(this.geometries[b]=K,this._geometriesByUniqueId&&(this._geometriesByUniqueId[K.uniqueId]=b))}return this._geometriesByUniqueId&&(this._geometriesByUniqueId[K.uniqueId]=void 0),this.geometries.pop(),this.onGeometryRemovedObservable.notifyObservers(K),!0}getGeometries(){return this.geometries}getMeshById(K){for(let b=0;b<this.meshes.length;b++)if(this.meshes[b].id===K)return this.meshes[b];return null}getMeshesById(K){return this.meshes.filter((function(b){return b.id===K}))}getTransformNodeById(K){for(let b=0;b<this.transformNodes.length;b++)if(this.transformNodes[b].id===K)return this.transformNodes[b];return null}getTransformNodeByUniqueId(K){for(let b=0;b<this.transformNodes.length;b++)if(this.transformNodes[b].uniqueId===K)return this.transformNodes[b];return null}getTransformNodesById(K){return this.transformNodes.filter((function(b){return b.id===K}))}getMeshByUniqueId(K){for(let b=0;b<this.meshes.length;b++)if(this.meshes[b].uniqueId===K)return this.meshes[b];return null}getLastMeshById(K){for(let b=this.meshes.length-1;b>=0;b--)if(this.meshes[b].id===K)return this.meshes[b];return null}getLastTransformNodeById(K){for(let b=this.transformNodes.length-1;b>=0;b--)if(this.transformNodes[b].id===K)return this.transformNodes[b];return null}getLastEntryById(K){let b;for(b=this.meshes.length-1;b>=0;b--)if(this.meshes[b].id===K)return this.meshes[b];for(b=this.transformNodes.length-1;b>=0;b--)if(this.transformNodes[b].id===K)return this.transformNodes[b];for(b=this.cameras.length-1;b>=0;b--)if(this.cameras[b].id===K)return this.cameras[b];for(b=this.lights.length-1;b>=0;b--)if(this.lights[b].id===K)return this.lights[b];return null}getNodeById(K){const b=this.getMeshById(K);if(b)return b;const e=this.getTransformNodeById(K);if(e)return e;const z=this.getLightById(K);if(z)return z;const k=this.getCameraById(K);if(k)return k;const j=this.getBoneById(K);return j||null}getNodeByName(K){const b=this.getMeshByName(K);if(b)return b;const e=this.getTransformNodeByName(K);if(e)return e;const z=this.getLightByName(K);if(z)return z;const k=this.getCameraByName(K);if(k)return k;const j=this.getBoneByName(K);return j||null}getMeshByName(K){for(let b=0;b<this.meshes.length;b++)if(this.meshes[b].name===K)return this.meshes[b];return null}getTransformNodeByName(K){for(let b=0;b<this.transformNodes.length;b++)if(this.transformNodes[b].name===K)return this.transformNodes[b];return null}getLastSkeletonById(K){for(let b=this.skeletons.length-1;b>=0;b--)if(this.skeletons[b].id===K)return this.skeletons[b];return null}getSkeletonByUniqueId(K){for(let b=0;b<this.skeletons.length;b++)if(this.skeletons[b].uniqueId===K)return this.skeletons[b];return null}getSkeletonById(K){for(let b=0;b<this.skeletons.length;b++)if(this.skeletons[b].id===K)return this.skeletons[b];return null}getSkeletonByName(K){for(let b=0;b<this.skeletons.length;b++)if(this.skeletons[b].name===K)return this.skeletons[b];return null}getMorphTargetManagerById(K){for(let b=0;b<this.morphTargetManagers.length;b++)if(this.morphTargetManagers[b].uniqueId===K)return this.morphTargetManagers[b];return null}getMorphTargetById(K){for(let b=0;b<this.morphTargetManagers.length;++b){const e=this.morphTargetManagers[b];for(let b=0;b<e.numTargets;++b){const z=e.getTarget(b);if(z.id===K)return z}}return null}getMorphTargetByName(K){for(let b=0;b<this.morphTargetManagers.length;++b){const e=this.morphTargetManagers[b];for(let b=0;b<e.numTargets;++b){const z=e.getTarget(b);if(z.name===K)return z}}return null}getPostProcessByName(K){for(let b=0;b<this.postProcesses.length;++b){const e=this.postProcesses[b];if(e.name===K)return e}return null}isActiveMesh(K){return-1!==this._activeMeshes.indexOf(K)}get uid(){return this._uid||(this._uid=z.f.RandomId()),this._uid}addExternalData(K,b){return this._externalData||(this._externalData=new F),this._externalData.add(K,b)}getExternalData(K){return this._externalData?this._externalData.get(K):null}getOrAddExternalDataWithFactory(K,b){return this._externalData||(this._externalData=new F),this._externalData.getOrAddWithFactory(K,b)}removeExternalData(K){return this._externalData.remove(K)}_evaluateSubMesh(K,b,e,z){if(z||K.isInFrustum(this._frustumPlanes)){for(const z of this._evaluateSubMeshStage)z.action(b,K);const e=K.Ha();null!==e&&void 0!==e&&(e.hasRenderTargetTextures&&null!=e.getRenderTargetTextures&&-1===this._processedMaterials.indexOf(e)&&(this._processedMaterials.push(e),this._materialsRenderTargets.concatWithNoDuplicate(e.getRenderTargetTextures())),this._renderingManager.dispatch(K,b,e))}}freeProcessedMaterials(){this._processedMaterials.dispose()}get blockfreeActiveMeshesAndRenderingGroups(){return this._preventFreeActiveMeshesAndRenderingGroups}set blockfreeActiveMeshesAndRenderingGroups(K){this._preventFreeActiveMeshesAndRenderingGroups!==K&&(K&&(this.freeActiveMeshes(),this.freeRenderingGroups()),this._preventFreeActiveMeshesAndRenderingGroups=K)}freeActiveMeshes(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._activeMeshes.dispose(),this.activeCamera&&this.activeCamera._activeMeshes&&this.activeCamera._activeMeshes.dispose(),this.activeCameras))for(let K=0;K<this.activeCameras.length;K++){const b=this.activeCameras[K];b&&b._activeMeshes&&b._activeMeshes.dispose()}}freeRenderingGroups(){if(!this.blockfreeActiveMeshesAndRenderingGroups&&(this._renderingManager&&this._renderingManager.freeRenderingGroups(),this.textures))for(let K=0;K<this.textures.length;K++){const b=this.textures[K];b&&b.renderList&&b.freeRenderingGroups()}}_isInIntermediateRendering(){return this._intermediateRendering}freezeActiveMeshes(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2?arguments[2]:void 0,z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],k=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return this.executeWhenReady((()=>{if(this.activeCamera){if(this._frustumPlanes||this.updateTransformMatrix(),this._evaluateActiveMeshes(),this._activeMeshesFrozen=!0,this._activeMeshesFrozenButKeepClipping=k,this._skipEvaluateActiveMeshesCompletely=K,z)for(let K=0;K<this._activeMeshes.length;K++)this._activeMeshes.data[K]._freeze();b&&b()}else e&&e("No active camera found")})),this}unfreezeActiveMeshes(){for(let K=0;K<this.meshes.length;K++){const b=this.meshes[K];b._internalAbstractMeshDataInfo&&(b._internalAbstractMeshDataInfo._isActive=!1)}for(let K=0;K<this._activeMeshes.length;K++)this._activeMeshes.data[K]._unFreeze();return this._activeMeshesFrozen=!1,this}_executeActiveContainerCleanup(K){(!this._engine.snapshotRendering||1!==this._engine.snapshotRenderingMode)&&this._activeMeshesFrozen&&this._activeMeshes.length||this.onBeforeRenderObservable.addOnce((()=>K.dispose()))}_evaluateActiveMeshes(){if(this._engine.snapshotRendering&&1===this._engine.snapshotRenderingMode){var K;if(this._activeMeshes.length>0)null===(K=this.activeCamera)||void 0===K||K._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset();return}if(this._activeMeshesFrozen&&this._activeMeshes.length){if(!this._skipEvaluateActiveMeshesCompletely){const K=this._activeMeshes.length;for(let b=0;b<K;b++){this._activeMeshes.data[b].xj()}}if(this._activeParticleSystems){const K=this._activeParticleSystems.length;for(let b=0;b<K;b++)this._activeParticleSystems.data[b].animate()}return void this._renderingManager.resetSprites()}if(!this.activeCamera)return;this.onBeforeActiveMeshesEvaluationObservable.notifyObservers(this),this.activeCamera._activeMeshes.reset(),this._activeMeshes.reset(),this._renderingManager.reset(),this._processedMaterials.reset(),this._activeParticleSystems.reset(),this._activeSkeletons.reset(),this._softwareSkinnedMeshes.reset(),this._materialsRenderTargets.reset();for(const z of this._beforeEvaluateActiveMeshStage)z.action();const b=this.getActiveMeshCandidates(),e=b.length;for(let z=0;z<e;z++){const K=b.data[z];if(K._internalAbstractMeshDataInfo._currentLODIsUpToDate=!1,K.isBlocked)continue;if(this._totalVertices.addCount(K.getTotalVertices(),!1),!K.isReady()||!K.isEnabled()||K.Zd.hasAZeroComponent)continue;K.xj(),K.actionManager&&K.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(K);let e=this.customLODSelector?this.customLODSelector(K,this.activeCamera):K.getLOD(this.activeCamera);if(K._internalAbstractMeshDataInfo._currentLOD=e,K._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0,void 0!==e&&null!==e&&(e!==K&&0!==e.billboardMode&&e.xj(),K._preActivate(),K.isVisible&&K.visibility>0&&0!==(K.layerMask&this.activeCamera.layerMask)&&(this._skipFrustumClipping||K.ob||K.isInFrustum(this._frustumPlanes)))){this._activeMeshes.push(K),this.activeCamera._activeMeshes.push(K),e!==K&&e._activate(this._renderId,!1);for(const b of this._preActiveMeshStage)b.action(K);K._activate(this._renderId,!1)&&(K.isAnInstance?K._internalAbstractMeshDataInfo._actAsRegularMesh&&(e=K):e._internalAbstractMeshDataInfo._onlyForInstances=!1,e._internalAbstractMeshDataInfo._isActive=!0,this._activeMesh(K,e)),K._postActivate()}}if(this.onAfterActiveMeshesEvaluationObservable.notifyObservers(this),this.particlesEnabled){this.onBeforeParticlesRenderingObservable.notifyObservers(this);for(let K=0;K<this._i.length;K++){const b=this._i[K];if(!b.isStarted()||!b.j)continue;const e=b.j;e.position&&!e.isEnabled()||(this._activeParticleSystems.push(b),b.animate(),this._renderingManager.dispatchParticles(b))}this.onAfterParticlesRenderingObservable.notifyObservers(this)}}_prepareSkeleton(K){this._skeletonsEnabled&&K.skeleton&&(this._activeSkeletons.pushNoDuplicate(K.skeleton)&&(K.skeleton.prepare(),this._activeBones.addCount(K.skeleton.bones.length,!1)),K.computeBonesUsingShaders||this._softwareSkinnedMeshes.pushNoDuplicate(K)&&this.frameGraph&&K.applySkeleton(K.skeleton))}_activeMesh(K,b){this._prepareSkeleton(b);let e=K.hasInstances||K.isAnInstance||this.dispatchAllSubMeshesOfActiveMeshes||this._skipFrustumClipping||b.ob;if(b&&b.Rf&&b.Rf.length>0){const z=this.getActiveSubMeshCandidates(b),k=z.length;e=e||1===k;for(let j=0;j<k;j++){const k=z.data[j];this._evaluateSubMesh(k,b,K,e)}}}updateTransformMatrix(K){const b=this.activeCamera;if(b)if(b._renderingMultiview){const e=b._rigCameras[0],z=b._rigCameras[1];this.setTransformMatrix(e.getViewMatrix(),e.getProjectionMatrix(K),z.getViewMatrix(),z.getProjectionMatrix(K))}else this.setTransformMatrix(b.getViewMatrix(),b.getProjectionMatrix(K))}_bindFrameBuffer(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];K&&K._multiviewTexture?K._multiviewTexture._bindFrameBuffer():K&&K.outputRenderTarget?K.outputRenderTarget._bindFrameBuffer():this._engine._currentFrameBufferIsDefaultFrameBuffer()||this._engine.restoreDefaultFramebuffer(),b&&this._clearFrameBuffer(K)}_clearFrameBuffer(K){if(K&&K._multiviewTexture);else if(K&&K.outputRenderTarget&&!K._renderingMultiview){const b=K.outputRenderTarget;b.onClearObservable.hasObservers()?b.onClearObservable.notifyObservers(this._engine):b.skipInitialClear||K.isRightCamera||(this.Ci&&this._engine.clear(b.clearColor||this._clearColor,!b._cleared,!0,!0),b._cleared=!0)}else this._defaultFrameBufferCleared?this._engine.clear(null,!1,!0,!0):(this._defaultFrameBufferCleared=!0,this._clear())}_renderForCamera(K,b){var e;let k=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(K&&K._skipRendering)return;const j=this._engine;if(this._activeCamera=K,!this.activeCamera)throw new Error("Active camera not set");if(j.setViewport(this.activeCamera.viewport),this.resetCachedMaterial(),this._renderId++,!this.prePass&&k){let b=!0;K._renderingMultiview&&K.outputRenderTarget&&(b=K.outputRenderTarget.skipInitialClear,this.Ci&&(this._defaultFrameBufferCleared=!1,K.outputRenderTarget.skipInitialClear=!1)),this._bindFrameBuffer(this._activeCamera),K._renderingMultiview&&K.outputRenderTarget&&(K.outputRenderTarget.skipInitialClear=b)}this.updateTransformMatrix(),this.onBeforeCameraRenderObservable.notifyObservers(this.activeCamera),this._evaluateActiveMeshes();for(let z=0;z<this._softwareSkinnedMeshes.length;z++){const K=this._softwareSkinnedMeshes.data[z];K.applySkeleton(K.skeleton)}this.onBeforeRenderTargetsRenderObservable.notifyObservers(this),this._renderTargets.concatWithNoDuplicate(this._materialsRenderTargets),K.customRenderTargets&&K.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(K.customRenderTargets),b&&b.customRenderTargets&&b.customRenderTargets.length>0&&this._renderTargets.concatWithNoDuplicate(b.customRenderTargets),this.environmentTexture&&this.environmentTexture.isRenderTarget&&this._renderTargets.pushNoDuplicate(this.environmentTexture);for(const z of this._gatherActiveCameraRenderTargetsStage)z.action(this._renderTargets);let T=!1;if(this.renderTargetsEnabled){if(this._intermediateRendering=!0,this._renderTargets.length>0){z.f.StartPerformanceCounter("Render targets",this._renderTargets.length>0);for(let K=0;K<this._renderTargets.length;K++){const b=this._renderTargets.data[K];if(b._shouldRender()){this._renderId++;const K=b.activeCamera&&b.activeCamera!==this.activeCamera;b.render(K,this.dumpNextRenderTargets),T=!0}}z.f.EndPerformanceCounter("Render targets",this._renderTargets.length>0),this._renderId++}for(const K of this._cameraDrawRenderTargetStage)T=K.action(this.activeCamera)||T;this._intermediateRendering=!1}this._engine.currentRenderPassId=(null===(e=K.outputRenderTarget)||void 0===e?void 0:e.renderPassId)??K.renderPassId??0,T&&!this.prePass&&(this._bindFrameBuffer(this._activeCamera,!1),this.updateTransformMatrix()),this.onAfterRenderTargetsRenderObservable.notifyObservers(this),!this.postProcessManager||K._multiviewTexture||this.prePass||this.postProcessManager._prepareFrame();for(const z of this._beforeCameraDrawStage)z.action(this.activeCamera);this.onBeforeDrawPhaseObservable.notifyObservers(this),j.snapshotRendering&&1===j.snapshotRenderingMode&&this.finalizeSceneUbo(),this._renderingManager.render(null,null,!0,!0),this.onAfterDrawPhaseObservable.notifyObservers(this);for(const z of this._afterCameraDrawStage)z.action(this.activeCamera);if(this.postProcessManager&&!K._multiviewTexture){const b=K.outputRenderTarget?K.outputRenderTarget.renderTarget:void 0;this.postProcessManager._finalizeFrame(K.isIntermediate,b)}for(const z of this._afterCameraPostProcessStage)z.action(this.activeCamera);this._renderTargets.reset(),this.onAfterCameraRenderObservable.notifyObservers(this.activeCamera)}_processSubCameras(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(0===K.cameraRigMode||K._renderingMultiview)return K._renderingMultiview&&!this._multiviewSceneUbo&&this._createMultiviewUbo(),this._renderForCamera(K,void 0,b),void this.onAfterRenderCameraObservable.notifyObservers(K);if(K._useMultiviewToSingleView)this._renderMultiviewToSingleView(K);else{this.onBeforeCameraRenderObservable.notifyObservers(K);for(let b=0;b<K._rigCameras.length;b++)this._renderForCamera(K._rigCameras[b],K)}this._activeCamera=K,this.updateTransformMatrix(),this.onAfterRenderCameraObservable.notifyObservers(K)}_checkIntersections(){for(let K=0;K<this._meshesForIntersections.length;K++){const b=this._meshesForIntersections.data[K];if(b.actionManager)for(let K=0;b.actionManager&&K<b.actionManager.actions.length;K++){const e=b.actionManager.actions[K];if(12===e.trigger||13===e.trigger){const K=e.getTriggerParameter(),z=K.mesh?K.mesh:K,k=z.intersectsMesh(b,K.usePreciseIntersection),j=b._intersectionsInProgress.indexOf(z);k&&-1===j?12===e.trigger?(e._executeCurrent(U.CreateNew(b,void 0,z)),b._intersectionsInProgress.push(z)):13===e.trigger&&b._intersectionsInProgress.push(z):!k&&j>-1&&(13===e.trigger&&e._executeCurrent(U.CreateNew(b,void 0,z)),b.actionManager.hasSpecificTrigger(13,(K=>{const b=K.mesh?K.mesh:K;return z===b}))&&13!==e.trigger||b._intersectionsInProgress.splice(j,1))}}}}_advancePhysicsEngineStep(K){}_animate(K){}animate(){if(this._engine.isDeterministicLockStep()){let K=Math.max(KK.MinDeltaTime,Math.min(this._engine.getDeltaTime(),KK.MaxDeltaTime))+this._timeAccumulator;const b=this._engine.getTimeStep(),e=1e3/b/1e3;let z=0;const k=this._engine.getLockstepMaxSteps();let j=Math.floor(K/b);for(j=Math.min(j,k);K>0&&z<j;)this.onBeforeStepObservable.notifyObservers(this),this._animationRatio=b*e,this._animate(b),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(b),this.onAfterStepObservable.notifyObservers(this),this._currentStepId++,z++,K-=b;this._timeAccumulator=K<0?0:K}else{const K=this.useConstantAnimationDeltaTime?16:Math.max(KK.MinDeltaTime,Math.min(this._engine.getDeltaTime(),KK.MaxDeltaTime));this._animationRatio=.06*K,this._animate(),this.onAfterAnimationsObservable.notifyObservers(this),this.physicsEnabled&&this._advancePhysicsEngineStep(K)}}_clear(){(this.autoClearDepthAndStencil||this.Ci)&&this._engine.clear(this._clearColor,this.Ci||this.forceWireframe||this.forcePointsCloud,this.autoClearDepthAndStencil,this.autoClearDepthAndStencil)}_checkCameraRenderTarget(K){var b;if(null===K||void 0===K||!K.outputRenderTarget||null!==K&&void 0!==K&&K.isRigCamera||(K.outputRenderTarget._cleared=!1),null!==K&&void 0!==K&&null!==(b=K.rigCameras)&&void 0!==b&&b.length)for(let e=0;e<K.rigCameras.length;++e){const b=K.rigCameras[e].outputRenderTarget;b&&(b._cleared=!1)}}resetDrawCache(K){if(this.meshes)for(const b of this.meshes)b.resetDrawCache(K)}_renderWithFrameGraph(){var K;let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.activeCamera=null,this._activeParticleSystems.reset(),this._activeSkeletons.reset(),b)for(const k of this.cameras)if(k.update(),0!==k.cameraRigMode)for(let K=0;K<k._rigCameras.length;K++)k._rigCameras[K].update();for(const k of this._beforeClearStage)k.action();const e=this.getActiveMeshCandidates(),z=e.length;for(let k=0;k<z;k++){const K=e.data[k];K.isBlocked||(this._totalVertices.addCount(K.getTotalVertices(),!1),K.isReady()&&K.isEnabled()&&!K.Zd.hasAZeroComponent&&(K.xj(),K.actionManager&&K.actionManager.hasSpecificTriggers2(12,13)&&this._meshesForIntersections.pushNoDuplicate(K)))}if(this.particlesEnabled)for(let k=0;k<this._i.length;k++){const K=this._i[k];if(!K.isStarted()||!K.j)continue;const b=K.j;b.position&&!b.isEnabled()||(this._activeParticleSystems.push(K),K.animate())}null===(K=this.frameGraph)||void 0===K||K.execute()}render(){var K;let b=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.u){this.onReadyObservable.hasObservers()&&null===this._executeWhenReadyTimeoutId&&this._checkIsReady(),this._frameId++,this._defaultFrameBufferCleared=!1,this._checkCameraRenderTarget(this.activeCamera),null!==(K=this.activeCameras)&&void 0!==K&&K.length&&this.activeCameras.forEach(this._checkCameraRenderTarget),this._registerTransientComponents(),this._activeParticles.fetchNewFrame(),this._totalVertices.fetchNewFrame(),this._activeIndices.fetchNewFrame(),this._activeBones.fetchNewFrame(),this._meshesForIntersections.reset(),this.resetCachedMaterial(),this.onBeforeAnimationsObservable.notifyObservers(this),this.actionManager&&this.actionManager.processTrigger(11),e||this.animate();for(const K of this._beforeCameraUpdateStage)K.action();if(b)if(this.activeCameras&&this.activeCameras.length>0)for(let K=0;K<this.activeCameras.length;K++){const b=this.activeCameras[K];if(b.update(),0!==b.cameraRigMode)for(let K=0;K<b._rigCameras.length;K++)b._rigCameras[K].update()}else if(this.activeCamera&&(this.activeCamera.update(),0!==this.activeCamera.cameraRigMode))for(let K=0;K<this.activeCamera._rigCameras.length;K++)this.activeCamera._rigCameras[K].update();if(this.onBeforeRenderObservable.notifyObservers(this),this.customRenderFunction)this._renderId++,this._engine.currentRenderPassId=0,this.customRenderFunction(b,e);else{var k;const K=this.getEngine();this.onBeforeRenderTargetsRenderObservable.notifyObservers(this);const b=null!==(k=this.activeCameras)&&void 0!==k&&k.length?this.activeCameras[0]:this.activeCamera;if(this.renderTargetsEnabled){z.f.StartPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!0;for(let e=0;e<this.customRenderTargets.length;e++){const z=this.customRenderTargets[e];if(z._shouldRender()){if(this._renderId++,this.activeCamera=z.activeCamera||this.activeCamera,!this.activeCamera)throw new Error("Active camera not set");K.setViewport(this.activeCamera.viewport),this.updateTransformMatrix(),z.render(b!==this.activeCamera,this.dumpNextRenderTargets)}}z.f.EndPerformanceCounter("Custom render targets",this.customRenderTargets.length>0),this._intermediateRendering=!1,this._renderId++}this._engine.currentRenderPassId=(null===b||void 0===b?void 0:b.renderPassId)??0,this.activeCamera=b,this._activeCamera&&22!==this._activeCamera.cameraRigMode&&!this.prePass&&this._bindFrameBuffer(this._activeCamera,!1),this.onAfterRenderTargetsRenderObservable.notifyObservers(this);for(const e of this._beforeClearStage)e.action();this._clearFrameBuffer(this.activeCamera);for(const e of this._gatherRenderTargetsStage)e.action(this._renderTargets);if(this.activeCameras&&this.activeCameras.length>0)for(let e=0;e<this.activeCameras.length;e++)this._processSubCameras(this.activeCameras[e],e>0);else{if(!this.activeCamera)throw new Error("No camera defined");this._processSubCameras(this.activeCamera,!!this.activeCamera.outputRenderTarget)}}this._checkIntersections();for(const K of this._afterRenderStage)K.action();if(this.afterRender&&this.afterRender(),this.onAfterRenderObservable.notifyObservers(this),this._toBeDisposed.length){for(let K=0;K<this._toBeDisposed.length;K++){const b=this._toBeDisposed[K];b&&b.dispose()}this._toBeDisposed.length=0}this.dumpNextRenderTargets&&(this.dumpNextRenderTargets=!1),this._activeBones.addCount(0,!0),this._activeIndices.addCount(0,!0),this._activeParticles.addCount(0,!0),this._engine.restoreDefaultFramebuffer()}}freezeMaterials(){for(let K=0;K<this.materials.length;K++)this.materials[K].freeze()}unfreezeMaterials(){for(let K=0;K<this.materials.length;K++)this.materials[K].unfreeze()}dispose(){if(this.u)return;this.beforeRender=null,this.afterRender=null,this.metadata=null,this.skeletons.length=0,this.morphTargetManagers.length=0,this._transientComponents.length=0,this._isReadyForMeshStage.clear(),this._beforeEvaluateActiveMeshStage.clear(),this._evaluateSubMeshStage.clear(),this._preActiveMeshStage.clear(),this._cameraDrawRenderTargetStage.clear(),this._beforeCameraDrawStage.clear(),this._beforeRenderTargetDrawStage.clear(),this._beforeRenderingGroupDrawStage.clear(),this._beforeRenderingMeshStage.clear(),this._afterRenderingMeshStage.clear(),this._afterRenderingGroupDrawStage.clear(),this._afterCameraDrawStage.clear(),this._afterRenderTargetDrawStage.clear(),this._afterRenderStage.clear(),this._beforeCameraUpdateStage.clear(),this._beforeClearStage.clear(),this._gatherRenderTargetsStage.clear(),this._gatherActiveCameraRenderTargetsStage.clear(),this._pointerMoveStage.clear(),this._pointerDownStage.clear(),this._pointerUpStage.clear(),this.importedMeshesFiles=[],this._activeAnimatables&&this.stopAllAnimations&&(this._activeAnimatables.forEach((K=>{K.onAnimationEndObservable.clear(),K.onAnimationEnd=null})),this.stopAllAnimations()),this.resetCachedMaterial(),this.activeCamera&&(this.activeCamera._activeMeshes.dispose(),this.activeCamera=null),this.activeCameras=null,this._activeMeshes.dispose(),this._renderingManager.dispose(),this._processedMaterials.dispose(),this._activeParticleSystems.dispose(),this._activeSkeletons.dispose(),this._softwareSkinnedMeshes.dispose(),this._renderTargets.dispose(),this._materialsRenderTargets.dispose(),this._registeredForLateAnimationBindings.dispose(),this._meshesForIntersections.dispose(),this._toBeDisposed.length=0;const K=this._activeRequests.slice();for(const k of K)k.abort();this._activeRequests.length=0;try{this.Ui.notifyObservers(this)}catch(z){q.b.Error("An error occurred while calling onDisposeObservable!",z)}this.Bi();if(this._engine.getInputElement())for(let k=0;k<this.cameras.length;k++)this.cameras[k].Bi();this._disposeList(this.animationGroups),this._disposeList(this.lights),this._disposeList(this.meshes,(K=>K.dispose(!0))),this._disposeList(this.transformNodes,(K=>K.dispose(!0)));const b=this.cameras;this._disposeList(b),this.di&&this.di.dispose(),this._disposeList(this.multiMaterials),this._disposeList(this.materials),this._disposeList(this._i),this._disposeList(this.postProcesses),this._disposeList(this.textures),this._disposeList(this.morphTargetManagers),this._sceneUbo.dispose(),this._multiviewSceneUbo&&this._multiviewSceneUbo.dispose(),this.postProcessManager.dispose(),this._disposeList(this._components);let e=this._engine.scenes.indexOf(this);e>-1&&this._engine.scenes.splice(e,1),I.b._LastCreatedScene===this&&(this._engine.scenes.length>0?I.b._LastCreatedScene=this._engine.scenes[this._engine.scenes.length-1]:I.b._LastCreatedScene=null),e=this._engine._virtualScenes.indexOf(this),e>-1&&this._engine._virtualScenes.splice(e,1),this._engine.wipeCaches(!0),this.Ui.clear(),this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderTargetsRenderObservable.clear(),this.onAfterRenderTargetsRenderObservable.clear(),this.onAfterStepObservable.clear(),this.onBeforeStepObservable.clear(),this.onBeforeActiveMeshesEvaluationObservable.clear(),this.onAfterActiveMeshesEvaluationObservable.clear(),this.onBeforeParticlesRenderingObservable.clear(),this.onAfterParticlesRenderingObservable.clear(),this.onBeforeDrawPhaseObservable.clear(),this.onAfterDrawPhaseObservable.clear(),this.onBeforeAnimationsObservable.clear(),this.onAfterAnimationsObservable.clear(),this.onDataLoadedObservable.clear(),this.onBeforeRenderingGroupObservable.clear(),this.onAfterRenderingGroupObservable.clear(),this.onMeshImportedObservable.clear(),this.onBeforeCameraRenderObservable.clear(),this.onAfterCameraRenderObservable.clear(),this.onAfterRenderCameraObservable.clear(),this.onReadyObservable.clear(),this.onNewCameraAddedObservable.clear(),this.onCameraRemovedObservable.clear(),this.onNewLightAddedObservable.clear(),this.onLightRemovedObservable.clear(),this.onNewGeometryAddedObservable.clear(),this.onGeometryRemovedObservable.clear(),this.onNewTransformNodeAddedObservable.clear(),this.onTransformNodeRemovedObservable.clear(),this.onNewMeshAddedObservable.clear(),this.onMeshRemovedObservable.clear(),this.onNewSkeletonAddedObservable.clear(),this.onSkeletonRemovedObservable.clear(),this.onNewMaterialAddedObservable.clear(),this.onNewMultiMaterialAddedObservable.clear(),this.onMaterialRemovedObservable.clear(),this.onMultiMaterialRemovedObservable.clear(),this.onNewTextureAddedObservable.clear(),this.onTextureRemovedObservable.clear(),this.onPrePointerObservable.clear(),this.onPointerObservable.clear(),this.onPreKeyboardObservable.clear(),this.onKeyboardObservable.clear(),this.onActiveCameraChanged.clear(),this.onScenePerformancePriorityChangedObservable.clear(),this.onClearColorChangedObservable.clear(),this._isDisposed=!0}_disposeList(K,b){const e=K.slice(0);b=b??(K=>K.dispose());for(const z of e)b(z);K.length=0}get u(){return this._isDisposed}clearCachedVertexData(){for(let K=0;K<this.meshes.length;K++){const b=this.meshes[K].mj;b&&b.clearCachedData()}}cleanCachedTextureBuffer(){for(const K of this.textures){K._buffer&&(K._buffer=null)}}getWorldExtends(K){const b=new Y.k(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e=new Y.k(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);return K=K||(()=>!0),this.meshes.filter(K).forEach((K=>{if(K.xj(!0),!K.Rf||0===K.Rf.length||K.infiniteDistance)return;const z=K.getBoundingInfo(),k=z.boundingBox.minimumWorld,j=z.boundingBox.maximumWorld;Y.k.CheckExtends(k,b,e),Y.k.CheckExtends(j,b,e)})),{min:b,max:e}}createPickingRay(K,b,e,z){throw(0,x.c)("Ray")}createPickingRayToRef(K,b,e,z,k){throw(0,x.c)("Ray")}createPickingRayInCameraSpace(K,b,e){throw(0,x.c)("Ray")}createPickingRayInCameraSpaceToRef(K,b,e,z){throw(0,x.c)("Ray")}Oc(K,b,e,z,k,j){const T=(0,x.c)("Ray",!0);return T&&q.b.Warn(T),new t.c}pickWithBoundingInfo(K,b,e,z,k){const j=(0,x.c)("Ray",!0);return j&&q.b.Warn(j),new t.c}pickWithRay(K,b,e,z){throw(0,x.c)("Ray")}multiPick(K,b,e,z,k){throw(0,x.c)("Ray")}multiPickWithRay(K,b,e){throw(0,x.c)("Ray")}setPointerOverMesh(K,b,e){this._inputManager.setPointerOverMesh(K,b,e)}getPointerOverMesh(){return this._inputManager.getPointerOverMesh()}_rebuildGeometries(){for(const K of this.geometries)K._rebuild();for(const K of this.meshes)K._rebuild();this.postProcessManager&&this.postProcessManager._rebuild();for(const K of this._components)K.rebuild();for(const K of this._i)K.rebuild();if(this.spriteManagers)for(const K of this.spriteManagers)K.rebuild()}_rebuildTextures(){for(const K of this.textures)K._rebuild(!0);this.markAllMaterialsAsDirty(1)}_getByTags(K,b,e){if(void 0===b)return K;const z=[];for(const k in K){const j=K[k];l.d&&l.d.MatchesQuery(j,b)&&(!e||e(j))&&z.push(j)}return z}getMeshesByTags(K,b){return this._getByTags(this.meshes,K,b)}getCamerasByTags(K,b){return this._getByTags(this.cameras,K,b)}getLightsByTags(K,b){return this._getByTags(this.lights,K,b)}getMaterialByTags(K,b){return this._getByTags(this.materials,K,b).concat(this._getByTags(this.multiMaterials,K,b))}getTransformNodesByTags(K,b){return this._getByTags(this.transformNodes,K,b)}setRenderingOrder(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this._renderingManager.setRenderingOrder(K,b,e,z)}setRenderingAutoClearDepthStencil(K,b){let e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],z=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this._renderingManager.setRenderingAutoClearDepthStencil(K,b,e,z)}getAutoClearDepthStencilSetup(K){return this._renderingManager.getAutoClearDepthStencilSetup(K)}_forceBlockMaterialDirtyMechanism(K){this._blockMaterialDirtyMechanism=K}get blockMaterialDirtyMechanism(){return this._blockMaterialDirtyMechanism}set blockMaterialDirtyMechanism(K){this._blockMaterialDirtyMechanism!==K&&(this._blockMaterialDirtyMechanism=K,K||this.markAllMaterialsAsDirty(63))}markAllMaterialsAsDirty(K,b){if(!this._blockMaterialDirtyMechanism)for(const e of this.materials)b&&!b(e)||e.rg(K)}_loadFile(K,b,e,z,k,j,T){const F=(0,C.r)(K,b,e,z?this.offlineProvider:void 0,k,j,T);return this._activeRequests.push(F),F.onCompleteObservable.add((K=>{this._activeRequests.splice(this._activeRequests.indexOf(K),1)})),F}_loadFileAsync(K,b,e,z,k){return new Promise(((j,T)=>{this._loadFile(K,(K=>{j(K)}),b,e,z,((K,b)=>{T(b)}),k)}))}_requestFile(K,b,e,z,k,j,T){const F=(0,C.z)(K,b,e,z?this.offlineProvider:void 0,k,j,T);return this._activeRequests.push(F),F.onCompleteObservable.add((K=>{this._activeRequests.splice(this._activeRequests.indexOf(K),1)})),F}_requestFileAsync(K,b,e,z,k){return new Promise(((j,T)=>{this._requestFile(K,(K=>{j(K)}),b,e,z,(K=>{T(K)}),k)}))}_readFile(K,b,e,z,k){const j=(0,C.v)(K,b,e,z,k);return this._activeRequests.push(j),j.onCompleteObservable.add((K=>{this._activeRequests.splice(this._activeRequests.indexOf(K),1)})),j}_readFileAsync(K,b,e){return new Promise(((z,k)=>{this._readFile(K,(K=>{z(K)}),b,e,(K=>{k(K)}))}))}getPerfCollector(){throw(0,x.c)("performanceViewerSceneExtension")}setActiveCameraByID(K){return this.setActiveCameraById(K)}getMaterialByID(K){return this.getMaterialById(K)}getLastMaterialByID(K){return this.getLastMaterialById(K)}getTextureByUniqueID(K){return this.getTextureByUniqueId(K)}getCameraByID(K){return this.getCameraById(K)}getCameraByUniqueID(K){return this.getCameraByUniqueId(K)}getBoneByID(K){return this.getBoneById(K)}getLightByID(K){return this.getLightById(K)}getLightByUniqueID(K){return this.getLightByUniqueId(K)}getParticleSystemByID(K){return this.getParticleSystemById(K)}getGeometryByID(K){return this.getGeometryById(K)}getMeshByID(K){return this.getMeshById(K)}getMeshByUniqueID(K){return this.getMeshByUniqueId(K)}getLastMeshByID(K){return this.getLastMeshById(K)}getMeshesByID(K){return this.getMeshesById(K)}getTransformNodeByID(K){return this.getTransformNodeById(K)}getTransformNodeByUniqueID(K){return this.getTransformNodeByUniqueId(K)}getTransformNodesByID(K){return this.getTransformNodesById(K)}getNodeByID(K){return this.getNodeById(K)}getLastEntryByID(K){return this.getLastEntryById(K)}getLastSkeletonByID(K){return this.getLastSkeletonById(K)}}KK.FOGMODE_NONE=0,KK.FOGMODE_EXP=1,KK.FOGMODE_EXP2=2,KK.FOGMODE_LINEAR=3,KK.MinDeltaTime=1,KK.MaxDeltaTime=1e3,(0,J.e)("BABYLON.Scene",KK)},11049:(K,b,e)=>{"use strict";e.d(b,{e:()=>z,h:()=>k});class z{}z.NAME_EFFECTLAYER="EffectLayer",z.NAME_LAYER="Layer",z.NAME_LENSFLARESYSTEM="LensFlareSystem",z.NAME_BOUNDINGBOXRENDERER="BoundingBoxRenderer",z.NAME_PARTICLESYSTEM="tb",z.NAME_GAMEPAD="Gamepad",z.NAME_SIMPLIFICATIONQUEUE="SimplificationQueue",z.NAME_GEOMETRYBUFFERRENDERER="GeometryBufferRenderer",z.NAME_PREPASSRENDERER="PrePassRenderer",z.NAME_DEPTHRENDERER="DepthRenderer",z.NAME_DEPTHPEELINGRENDERER="DepthPeelingRenderer",z.NAME_IBLSHADOWSRENDERER="IblShadowsRenderer",z.NAME_POSTPROCESSRENDERPIPELINEMANAGER="PostProcessRenderPipelineManager",z.NAME_SPRITE="Sprite",z.NAME_SUBSURFACE="SubSurface",z.NAME_OUTLINERENDERER="Outline",z.NAME_PROCEDURALTEXTURE="ProceduralTexture",z.NAME_SHADOWGENERATOR="ShadowGenerator",z.NAME_OCTREE="wb",z.NAME_PHYSICSENGINE="PhysicsEngine",z.NAME_AUDIO="Audio",z.NAME_FLUIDRENDERER="FluidRenderer",z.STEP_ISREADYFORMESH_EFFECTLAYER=0,z.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER=0,z.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER=0,z.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER=0,z.STEP_CAMERADRAWRENDERTARGET_EFFECTLAYER=1,z.STEP_BEFORECAMERADRAW_PREPASS=0,z.STEP_BEFORECAMERADRAW_EFFECTLAYER=1,z.STEP_BEFORECAMERADRAW_LAYER=2,z.STEP_BEFORERENDERTARGETDRAW_PREPASS=0,z.STEP_BEFORERENDERTARGETDRAW_LAYER=1,z.STEP_BEFORERENDERINGMESH_PREPASS=0,z.STEP_BEFORERENDERINGMESH_OUTLINE=1,z.STEP_AFTERRENDERINGMESH_PREPASS=0,z.STEP_AFTERRENDERINGMESH_OUTLINE=1,z.STEP_AFTERRENDERINGGROUPDRAW_EFFECTLAYER_DRAW=0,z.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER=1,z.STEP_BEFORECAMERAUPDATE_SIMPLIFICATIONQUEUE=0,z.STEP_BEFORECLEAR_PROCEDURALTEXTURE=0,z.STEP_BEFORECLEAR_PREPASS=1,z.STEP_BEFORERENDERTARGETCLEAR_PREPASS=0,z.STEP_AFTERRENDERTARGETDRAW_PREPASS=0,z.STEP_AFTERRENDERTARGETDRAW_LAYER=1,z.STEP_AFTERCAMERADRAW_PREPASS=0,z.STEP_AFTERCAMERADRAW_EFFECTLAYER=1,z.STEP_AFTERCAMERADRAW_LENSFLARESYSTEM=2,z.STEP_AFTERCAMERADRAW_EFFECTLAYER_DRAW=3,z.STEP_AFTERCAMERADRAW_LAYER=4,z.STEP_AFTERCAMERADRAW_FLUIDRENDERER=5,z.STEP_AFTERCAMERAPOSTPROCESS_LAYER=0,z.STEP_AFTERRENDERTARGETPOSTPROCESS_LAYER=0,z.STEP_AFTERRENDER_AUDIO=0,z.STEP_GATHERRENDERTARGETS_DEPTHRENDERER=0,z.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER=1,z.STEP_GATHERRENDERTARGETS_SHADOWGENERATOR=2,z.STEP_GATHERRENDERTARGETS_POSTPROCESSRENDERPIPELINEMANAGER=3,z.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER=0,z.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER=1,z.STEP_POINTERMOVE_SPRITE=0,z.STEP_POINTERDOWN_SPRITE=0,z.STEP_POINTERUP_SPRITE=0;class k extends Array{constructor(K){super(...K)}static Create(){return Object.create(k.prototype)}registerStep(K,b,e){let z=0,k=Number.MAX_VALUE;for(;z<this.length;z++){if(k=this[z].index,K<k)break}this.splice(z,0,{index:K,component:b,action:e.bind(b)})}clear(){this.length=0}}},10936:(K,b,e)=>{"use strict";e.d(b,{b:()=>z});function z(K,b,e,z){var k,j=arguments.length,T=j<3?b:null===z?z=Object.getOwnPropertyDescriptor(b,e):z;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)T=Reflect.decorate(K,b,e,z);else for(var F=K.length-1;F>=0;F--)(k=K[F])&&(T=(j<3?k(T):j>3?k(b,e,T):k(b,e))||T);return j>3&&T&&Object.defineProperty(b,e,T),T}Object.create;Object.create},11871:(K,b,e)=>{"use strict";class z{get resolve(){return this._resolve}get reject(){return this._reject}constructor(){this.promise=new Promise(((K,b)=>{this._resolve=K,this._reject=b}))}}var k=e(10967),j=e(10994),T=e(10686),F=e(11237),l=e(11876),Y=e(11893),A=e(10690),X=e(11440),t=e(11896),U=e(11903),B=e(10720),u=e(10696),m=e(10698);class D{get useTextureToStoreBoneMatrices(){return this._useTextureToStoreBoneMatrices}set useTextureToStoreBoneMatrices(K){this._useTextureToStoreBoneMatrices=K,this._markAsDirty()}get animationPropertiesOverride(){return this._animationPropertiesOverride?this._animationPropertiesOverride:this._scene.animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}get isUsingTextureForMatrices(){return this.useTextureToStoreBoneMatrices&&this._canUseTextureForBones}get uniqueId(){return this._uniqueId}constructor(K,b,e){this.name=K,this.id=b,this.bones=[],this.needInitialSkinMatrix=!1,this._isDirty=!0,this._meshesWithPoseMatrix=new Array,this._identity=k.b.Identity(),this._currentRenderId=-1,this._ranges={},this._absoluteTransformIsDirty=!0,this._canUseTextureForBones=!1,this._uniqueId=0,this._numBonesWithLinkedTransformNode=0,this._hasWaitingData=null,this._parentContainer=null,this.doNotSerialize=!1,this._useTextureToStoreBoneMatrices=!0,this._animationPropertiesOverride=null,this.onBeforeComputeObservable=new A.d,this.bones=[],this._scene=e||B.b.LastCreatedScene,this._uniqueId=this._scene.getUniqueId(),this._scene.addSkeleton(this),this._isDirty=!0;const z=this._scene.getEngine().getCaps();this._canUseTextureForBones=z.textureFloat&&z.maxVertexTextureImageUnits>0}getClassName(){return"Skeleton"}getChildren(){return this.bones.filter((K=>!K.getParent()))}getTransformMatrices(K){if(this.needInitialSkinMatrix){if(!K)throw new Error("getTransformMatrices: When using the needInitialSkinMatrix flag, a mesh must be provided");return K._bonesTransformMatrices||this.prepare(!0),K._bonesTransformMatrices}return this._transformMatrices&&!this._isDirty||this.prepare(!this._transformMatrices),this._transformMatrices}getTransformMatrixTexture(K){return this.needInitialSkinMatrix&&K._transformMatrixTexture?K._transformMatrixTexture:this._transformMatrixTexture}va(){return this._scene}toString(K){let b=`Name: ${this.name}, nBones: ${this.bones.length}`;if(b+=`, nAnimationRanges: ${this._ranges?Object.keys(this._ranges).length:"none"}`,K){b+=", Ranges: {";let K=!0;for(const e in this._ranges)K&&(b+=", ",K=!1),b+=e;b+="}"}return b}getBoneIndexByName(K){for(let b=0,e=this.bones.length;b<e;b++)if(this.bones[b].name===K)return b;return-1}createAnimationRange(K,b,e){if(!this._ranges[K]){this._ranges[K]=new U.e(K,b,e);for(let z=0,k=this.bones.length;z<k;z++)this.bones[z].animations[0]&&this.bones[z].animations[0].createRange(K,b,e)}}deleteAnimationRange(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];for(let e=0,z=this.bones.length;e<z;e++)this.bones[e].animations[0]&&this.bones[e].animations[0].deleteRange(K,b);this._ranges[K]=null}getAnimationRange(K){return this._ranges[K]||null}getAnimationRanges(){const K=[];let b;for(b in this._ranges)K.push(this._ranges[b]);return K}copyAnimationRange(K,b){let e=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._ranges[b]||!K.getAnimationRange(b))return!1;let z=!0;const k=this._getHighestAnimationFrame()+1,j={},T=K.bones;let F,l;for(l=0,F=T.length;l<F;l++)j[T[l].name]=T[l];this.bones.length!==T.length&&(u.b.Warn(`copyAnimationRange: this rig has ${this.bones.length} bones, while source as ${T.length}`),z=!1);const Y=e&&this.dimensionsAtRest&&K.dimensionsAtRest?this.dimensionsAtRest.divide(K.dimensionsAtRest):null;for(l=0,F=this.bones.length;l<F;l++){const K=this.bones[l].name,T=j[K];T?z=z&&this.bones[l].copyAnimationRange(T,b,k,e,Y):(u.b.Warn("copyAnimationRange: not same rig, missing source bone "+K),z=!1)}const A=K.getAnimationRange(b);return A&&(this._ranges[b]=new U.e(b,A.from+k,A.to+k)),z}returnToRest(){for(const K of this.bones)-1!==K._index&&K.returnToRest()}_getHighestAnimationFrame(){let K=0;for(let b=0,e=this.bones.length;b<e;b++)if(this.bones[b].animations[0]){const e=this.bones[b].animations[0].getHighestFrame();K<e&&(K=e)}return K}beginAnimation(K,b,e,z){const k=this.getAnimationRange(K);return k?this._scene.beginAnimation(this,k.from,k.to,b,e,z):null}static MakeAnimationAdditive(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2?arguments[2]:void 0;const z=K.getAnimationRange(e);if(!z)return null;const k=K._scene.getAllAnimatablesByTarget(K);let j=null;for(let F=0;F<k.length;F++){const K=k[F];if(K.fromFrame===(null===z||void 0===z?void 0:z.from)&&K.toFrame===(null===z||void 0===z?void 0:z.to)){j=K;break}}const T=K.getAnimatables();for(let F=0;F<T.length;F++){const K=T[F].animations;if(K)for(let z=0;z<K.length;z++)t.c.MakeAnimationAdditive(K[z],b,e)}return j&&(j.isAdditive=!0),K}_markAsDirty(){this._isDirty=!0,this._absoluteTransformIsDirty=!0}_registerMeshWithPoseMatrix(K){this._meshesWithPoseMatrix.push(K)}_unregisterMeshWithPoseMatrix(K){const b=this._meshesWithPoseMatrix.indexOf(K);b>-1&&this._meshesWithPoseMatrix.splice(b,1)}_computeTransformMatrices(K,b){this.onBeforeComputeObservable.notifyObservers(this);for(let e=0;e<this.bones.length;e++){const z=this.bones[e];z._childUpdateId++;const k=z.getParent();if(k?z.getLocalMatrix().multiplyToRef(k.getFinalMatrix(),z.getFinalMatrix()):b?z.getLocalMatrix().multiplyToRef(b,z.getFinalMatrix()):z.getFinalMatrix().p(z.getLocalMatrix()),-1!==z._index){const b=null===z._index?e:z._index;z.getAbsoluteInverseBindMatrix().multiplyToArray(z.getFinalMatrix(),K,16*b)}}this._identity.copyToArray(K,16*this.bones.length)}prepare(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])){const K=this.va().getRenderId();if(this._currentRenderId===K)return;this._currentRenderId=K}if(this._numBonesWithLinkedTransformNode>0)for(const K of this.bones)if(K._linkedTransformNode){const b=K._linkedTransformNode;K.position=b.position,b.rotationQuaternion?K.rotationQuaternion=b.rotationQuaternion:K.rotation=b.rotation,K.Zd=b.Zd}if(this.needInitialSkinMatrix)for(const K of this._meshesWithPoseMatrix){const b=K.getPoseMatrix();let e=this._isDirty;if(K._bonesTransformMatrices&&K._bonesTransformMatrices.length===16*(this.bones.length+1)||(K._bonesTransformMatrices=new Float32Array(16*(this.bones.length+1)),e=!0),e){if(this._synchronizedWithMesh!==K){this._synchronizedWithMesh=K;for(const K of this.bones)if(!K.getParent()){K.getBindMatrix().multiplyToRef(b,k.e.Matrix[1]),K._updateAbsoluteBindMatrices(k.e.Matrix[1])}if(this.isUsingTextureForMatrices){const b=4*(this.bones.length+1);K._transformMatrixTexture&&K._transformMatrixTexture.getSize().width===b||(K._transformMatrixTexture&&K._transformMatrixTexture.dispose(),K._transformMatrixTexture=X.e.CreateRGBATexture(K._bonesTransformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))}}this._computeTransformMatrices(K._bonesTransformMatrices,b),this.isUsingTextureForMatrices&&K._transformMatrixTexture&&K._transformMatrixTexture.update(K._bonesTransformMatrices)}}else{if(!this._isDirty)return;this._transformMatrices&&this._transformMatrices.length===16*(this.bones.length+1)||(this._transformMatrices=new Float32Array(16*(this.bones.length+1)),this.isUsingTextureForMatrices&&(this._transformMatrixTexture&&this._transformMatrixTexture.dispose(),this._transformMatrixTexture=X.e.CreateRGBATexture(this._transformMatrices,4*(this.bones.length+1),1,this._scene,!1,!1,1,1))),this._computeTransformMatrices(this._transformMatrices,null),this.isUsingTextureForMatrices&&this._transformMatrixTexture&&this._transformMatrixTexture.update(this._transformMatrices)}this._isDirty=!1}getAnimatables(){if(!this._animatables||this._animatables.length!==this.bones.length){this._animatables=[];for(let K=0;K<this.bones.length;K++)this._animatables.push(this.bones[K])}return this._animatables}clone(K,b){const e=new D(K,b||K,this._scene);e.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let z=0;z<this.bones.length;z++){const K=this.bones[z];let b=null;const k=K.getParent();if(k){const K=this.bones.indexOf(k);b=e.bones[K]}const j=new Y.b(K.name,e,b,K.getBindMatrix().clone(),K.getRestMatrix().clone());j._index=K._index,K._linkedTransformNode&&j.linkTransformNode(K._linkedTransformNode),m.c.DeepCopy(K.animations,j.animations)}if(this._ranges){e._ranges={};for(const K in this._ranges){const b=this._ranges[K];b&&(e._ranges[K]=b.clone())}}return this._isDirty=!0,e.prepare(!0),e}enableBlending(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.01;this.bones.forEach((b=>{b.animations.forEach((b=>{b.enableBlending=!0,b.blendingSpeed=K}))}))}dispose(){if(this._meshesWithPoseMatrix.length=0,this.va().stopAnimation(this),this.va().removeSkeleton(this),this._parentContainer){const K=this._parentContainer.skeletons.indexOf(this);K>-1&&this._parentContainer.skeletons.splice(K,1),this._parentContainer=null}this._transformMatrixTexture&&(this._transformMatrixTexture.dispose(),this._transformMatrixTexture=null)}serialize(){const K={};K.name=this.name,K.id=this.id,this.dimensionsAtRest&&(K.dimensionsAtRest=this.dimensionsAtRest.Ti()),K.bones=[],K.needInitialSkinMatrix=this.needInitialSkinMatrix;for(let e=0;e<this.bones.length;e++){var b;const z=this.bones[e],k=z.getParent(),j={parentBoneIndex:k?this.bones.indexOf(k):-1,index:z.getIndex(),name:z.name,id:z.id,matrix:z.getBindMatrix().Ti(),rest:z.getRestMatrix().Ti(),linkedTransformNodeId:null===(b=z.getTransformNode())||void 0===b?void 0:b.id};K.bones.push(j),z.length&&(j.length=z.length),z.metadata&&(j.metadata=z.metadata),z.animations&&z.animations.length>0&&(j.animation=z.animations[0].serialize()),K.ranges=[];for(const b in this._ranges){const e=this._ranges[b];if(!e)continue;const z={};z.name=b,z.from=e.from,z.to=e.to,K.ranges.push(z)}}return K}static Parse(K,b){const e=new D(K.name,K.id,b);let z;for(K.dimensionsAtRest&&(e.dimensionsAtRest=k.k.Bg(K.dimensionsAtRest)),e.needInitialSkinMatrix=K.needInitialSkinMatrix,z=0;z<K.bones.length;z++){const b=K.bones[z],j=K.bones[z].index;let T=null;b.parentBoneIndex>-1&&(T=e.bones[b.parentBoneIndex]);const F=b.rest?k.b.Bg(b.rest):null,l=new Y.b(b.name,e,T,k.b.Bg(b.matrix),F,null,j);void 0!==b.id&&null!==b.id&&(l.id=b.id),b.length&&(l.length=b.length),b.metadata&&(l.metadata=b.metadata),b.animation&&l.animations.push(t.c.Parse(b.animation)),void 0!==b.linkedTransformNodeId&&null!==b.linkedTransformNodeId&&(e._hasWaitingData=!0,l._waitingTransformNodeId=b.linkedTransformNodeId)}if(K.ranges)for(z=0;z<K.ranges.length;z++){const b=K.ranges[z];e.createAnimationRange(b.name,b.from,b.to)}return e}computeAbsoluteMatrices(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];(this._absoluteTransformIsDirty||K)&&(this.bones[0].computeAbsoluteMatrices(),this._absoluteTransformIsDirty=!1)}computeAbsoluteTransforms(){let K=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.computeAbsoluteMatrices(K)}getPoseMatrix(){let K=null;return this._meshesWithPoseMatrix.length>0&&(K=this._meshesWithPoseMatrix[0].getPoseMatrix()),K}sortBones(){const K=[],b=new Array(this.bones.length);for(let e=0;e<this.bones.length;e++)this._sortBones(e,K,b);this.bones=K}_sortBones(K,b,e){if(e[K])return;e[K]=!0;const z=this.bones[K];if(!z)return;void 0===z._index&&(z._index=K);const k=z.getParent();k&&this._sortBones(this.bones.indexOf(k),b,e),b.push(z)}setCurrentPoseAsRest(){this.bones.forEach((K=>{K.setCurrentPoseAsRest()}))}}var I=e(11085),x=e(10936),Q=e(10938),G=e(11906),i=e(11917),S=e(10799),M=e(11001);class r extends i.d{get refractionTexture(){return this.subSurface.refractionTexture}set refractionTexture(K){this.subSurface.refractionTexture=K,K?this.subSurface.isRefractionEnabled=!0:this.subSurface.linkRefractionWithTransparency||(this.subSurface.isRefractionEnabled=!1)}get indexOfRefraction(){return this.subSurface.indexOfRefraction}set indexOfRefraction(K){this.subSurface.indexOfRefraction=K}get invertRefractionY(){return this.subSurface.invertRefractionY}set invertRefractionY(K){this.subSurface.invertRefractionY=K}get linkRefractionWithTransparency(){return this.subSurface.linkRefractionWithTransparency}set linkRefractionWithTransparency(K){this.subSurface.linkRefractionWithTransparency=K,K&&(this.subSurface.isRefractionEnabled=!0)}get usePhysicalLightFalloff(){return this._lightFalloff===i.d.LIGHTFALLOFF_PHYSICAL}set usePhysicalLightFalloff(K){K!==this.usePhysicalLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=K?i.d.LIGHTFALLOFF_PHYSICAL:i.d.LIGHTFALLOFF_STANDARD)}get useGLTFLightFalloff(){return this._lightFalloff===i.d.LIGHTFALLOFF_GLTF}set useGLTFLightFalloff(K){K!==this.useGLTFLightFalloff&&(this._markAllSubMeshesAsTexturesDirty(),this._lightFalloff=K?i.d.LIGHTFALLOFF_GLTF:i.d.LIGHTFALLOFF_STANDARD)}get imageProcessingConfiguration(){return this._imageProcessingConfiguration}set imageProcessingConfiguration(K){this._attachImageProcessingConfiguration(K),this._markAllSubMeshesAsTexturesDirty()}get cameraColorCurvesEnabled(){return this.imageProcessingConfiguration.colorCurvesEnabled}set cameraColorCurvesEnabled(K){this.imageProcessingConfiguration.colorCurvesEnabled=K}get cameraColorGradingEnabled(){return this.imageProcessingConfiguration.colorGradingEnabled}set cameraColorGradingEnabled(K){this.imageProcessingConfiguration.colorGradingEnabled=K}get cameraToneMappingEnabled(){return this._imageProcessingConfiguration.toneMappingEnabled}set cameraToneMappingEnabled(K){this._imageProcessingConfiguration.toneMappingEnabled=K}get cameraExposure(){return this._imageProcessingConfiguration.exposure}set cameraExposure(K){this._imageProcessingConfiguration.exposure=K}get cameraContrast(){return this._imageProcessingConfiguration.contrast}set cameraContrast(K){this._imageProcessingConfiguration.contrast=K}get cameraColorGradingTexture(){return this._imageProcessingConfiguration.colorGradingTexture}set cameraColorGradingTexture(K){this._imageProcessingConfiguration.colorGradingTexture=K}get cameraColorCurves(){return this._imageProcessingConfiguration.colorCurves}set cameraColorCurves(K){this._imageProcessingConfiguration.colorCurves=K}constructor(K,b){super(K,b,arguments.length>2&&void 0!==arguments[2]&&arguments[2]),this.directIntensity=1,this.emissiveIntensity=1,this.environmentIntensity=1,this.specularIntensity=1,this.disableBumpMap=!1,this.ambientTextureStrength=1,this.ambientTextureImpactOnAnalyticalLights=r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,this.metallicF0Factor=1,this.metallicReflectanceColor=j.c.White(),this.useOnlyMetallicFromMetallicReflectanceTexture=!1,this.ambientColor=new j.c(0,0,0),this.albedoColor=new j.c(1,1,1),this.reflectivityColor=new j.c(1,1,1),this.reflectionColor=new j.c(1,1,1),this.emissiveColor=new j.c(0,0,0),this.microSurface=1,this.useLightmapAsShadowmap=!1,this.useAlphaFromAlbedoTexture=!1,this.forceAlphaTest=!1,this.alphaCutOff=.4,this.useSpecularOverAlpha=!0,this.useMicroSurfaceFromReflectivityMapAlpha=!1,this.useRoughnessFromMetallicTextureAlpha=!0,this.useRoughnessFromMetallicTextureGreen=!1,this.useMetallnessFromMetallicTextureBlue=!1,this.useAmbientOcclusionFromMetallicTextureRed=!1,this.useAmbientInGrayScale=!1,this.useAutoMicroSurfaceFromReflectivityMap=!1,this.useRadianceOverAlpha=!0,this.useObjectSpaceNormalMap=!1,this.useParallax=!1,this.useParallaxOcclusion=!1,this.parallaxScaleBias=.05,this.disableLighting=!1,this.forceIrradianceInFragment=!1,this.maxSimultaneousLights=4,this.invertNormalMapX=!1,this.invertNormalMapY=!1,this.twoSidedLighting=!1,this.useAlphaFresnel=!1,this.useLinearAlphaFresnel=!1,this.environmentBRDFTexture=null,this.forceNormalForward=!1,this.enableSpecularAntiAliasing=!1,this.useHorizonOcclusion=!0,this.useRadianceOcclusion=!0,this.unlit=!1,this.applyDecalMapAfterDetailMap=!1,this._environmentBRDFTexture=(0,G.d)(this.va())}getClassName(){return"PBRMaterial"}clone(K){let b=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";const z=M.e.Clone((()=>new r(K,this.va())),this,{cloneTexturesOnlyOnce:b});return z.id=K,z.name=K,this.stencil.copyTo(z.stencil),this._clonePlugins(z,e),z}serialize(){const K=super.serialize();return K.customType="BABYLON.PBRMaterial",K}static Parse(K,b,e){const z=M.e.Parse((()=>new r(K.name,b)),K,b,e);return K.stencil&&z.stencil.parse(K.stencil,b,e),I.b._ParsePlugins(K,z,b,e),K.clearCoat&&z.clearCoat.parse(K.clearCoat,b,e),K.anisotropy&&z.anisotropy.parse(K.anisotropy,b,e),K.brdf&&z.brdf.parse(K.brdf,b,e),K.sheen&&z.sheen.parse(K.sheen,b,e),K.subSurface&&z.subSurface.parse(K.subSurface,b,e),K.iridescence&&z.iridescence.parse(K.iridescence,b,e),z}}r.PBRMATERIAL_OPAQUE=i.d.PBRMATERIAL_OPAQUE,r.PBRMATERIAL_ALPHATEST=i.d.PBRMATERIAL_ALPHATEST,r.PBRMATERIAL_ALPHABLEND=i.d.PBRMATERIAL_ALPHABLEND,r.PBRMATERIAL_ALPHATESTANDBLEND=i.d.PBRMATERIAL_ALPHATESTANDBLEND,r.DEFAULT_AO_ON_ANALYTICAL_LIGHTS=i.d.DEFAULT_AO_ON_ANALYTICAL_LIGHTS,(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"directIntensity",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveIntensity",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"environmentIntensity",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"specularIntensity",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"disableBumpMap",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"albedoTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTexture",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTextureStrength",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientTextureImpactOnAnalyticalLights",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"opacityTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectivityTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicTexture",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallic",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"roughness",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicF0Factor",void 0),(0,x.b)([(0,Q.m)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicReflectanceColor",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useOnlyMetallicFromMetallicReflectanceTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"metallicReflectanceTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectanceTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"microSurfaceTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"bumpTexture",void 0),(0,x.b)([(0,Q.E)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty",null)],r.prototype,"lightmapTexture",void 0),(0,x.b)([(0,Q.m)("ambient"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"ambientColor",void 0),(0,x.b)([(0,Q.m)("albedo"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"albedoColor",void 0),(0,x.b)([(0,Q.m)("reflectivity"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectivityColor",void 0),(0,x.b)([(0,Q.m)("reflection"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"reflectionColor",void 0),(0,x.b)([(0,Q.m)("emissive"),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"emissiveColor",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"microSurface",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLightmapAsShadowmap",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"useAlphaFromAlbedoTexture",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"forceAlphaTest",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesAndMiscDirty")],r.prototype,"alphaCutOff",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useSpecularOverAlpha",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useMicroSurfaceFromReflectivityMapAlpha",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMetallicTextureAlpha",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRoughnessFromMetallicTextureGreen",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useMetallnessFromMetallicTextureBlue",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAmbientOcclusionFromMetallicTextureRed",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAmbientInGrayScale",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAutoMicroSurfaceFromReflectivityMap",void 0),(0,x.b)([(0,Q.M)()],r.prototype,"usePhysicalLightFalloff",null),(0,x.b)([(0,Q.M)()],r.prototype,"useGLTFLightFalloff",null),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRadianceOverAlpha",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useObjectSpaceNormalMap",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallax",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useParallaxOcclusion",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"parallaxScaleBias",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsLightsDirty")],r.prototype,"disableLighting",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"forceIrradianceInFragment",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsLightsDirty")],r.prototype,"maxSimultaneousLights",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapX",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"invertNormalMapY",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"twoSidedLighting",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useAlphaFresnel",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useLinearAlphaFresnel",void 0),(0,x.b)([(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"environmentBRDFTexture",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"forceNormalForward",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"enableSpecularAntiAliasing",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useHorizonOcclusion",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsTexturesDirty")],r.prototype,"useRadianceOcclusion",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsMiscDirty")],r.prototype,"unlit",void 0),(0,x.b)([(0,Q.M)(),(0,Q.b)("_markAllSubMeshesAsMiscDirty")],r.prototype,"applyDecalMapAfterDetailMap",void 0),(0,S.e)("BABYLON.PBRMaterial",r);var L=e(11161),c=e(11286),v=e(11030),w=e(11270),h=e(11283),R=e(11226);class n{get influence(){return this._influence}set influence(K){if(this._influence===K)return;const b=this._influence;this._influence=K,this.onInfluenceChanged.hasObservers()&&this.onInfluenceChanged.notifyObservers(0===b||0===K)}get animationPropertiesOverride(){return!this._animationPropertiesOverride&&this._scene?this._scene.animationPropertiesOverride:this._animationPropertiesOverride}set animationPropertiesOverride(K){this._animationPropertiesOverride=K}constructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.name=K,this.animations=[],this._positions=null,this._normals=null,this._tangents=null,this._uvs=null,this._uniqueId=0,this.onInfluenceChanged=new A.d,this._onDataLayoutChanged=new A.d,this._animationPropertiesOverride=null,this.id=K,this._scene=e||B.b.LastCreatedScene,this.influence=b,this._scene&&(this._uniqueId=this._scene.getUniqueId())}get uniqueId(){return this._uniqueId}get hasPositions(){return!!this._positions}get hasNormals(){return!!this._normals}get hasTangents(){return!!this._tangents}get hasUVs(){return!!this._uvs}setPositions(K){const b=this.hasPositions;this._positions=K,b!==this.hasPositions&&this._onDataLayoutChanged.notifyObservers(void 0)}getPositions(){return this._positions}setNormals(K){const b=this.hasNormals;this._normals=K,b!==this.hasNormals&&this._onDataLayoutChanged.notifyObservers(void 0)}getNormals(){return this._normals}setTangents(K){const b=this.hasTangents;this._tangents=K,b!==this.hasTangents&&this._onDataLayoutChanged.notifyObservers(void 0)}getTangents(){return this._tangents}setUVs(K){const b=this.hasUVs;this._uvs=K,b!==this.hasUVs&&this._onDataLayoutChanged.notifyObservers(void 0)}getUVs(){return this._uvs}clone(){const K=M.e.Clone((()=>new n(this.name,this.influence,this._scene)),this);return K._positions=this._positions,K._normals=this._normals,K._tangents=this._tangents,K._uvs=this._uvs,K}serialize(){const K={};return K.name=this.name,K.influence=this.influence,K.xa=Array.prototype.slice.call(this.getPositions()),null!=this.id&&(K.id=this.id),this.hasNormals&&(K.ya=Array.prototype.slice.call(this.getNormals())),this.hasTangents&&(K.tangents=Array.prototype.slice.call(this.getTangents())),this.hasUVs&&(K.Aa=Array.prototype.slice.call(this.getUVs())),M.e.AppendSerializedAnimations(this,K),K}getClassName(){return"MorphTarget"}static Parse(K,b){const e=new n(K.name,K.influence);if(e.setPositions(K.xa),null!=K.id&&(e.id=K.id),K.ya&&e.setNormals(K.ya),K.tangents&&e.setTangents(K.tangents),K.Aa&&e.setUVs(K.Aa),K.animations){for(let b=0;b<K.animations.length;b++){const z=K.animations[b],k=(0,S.d)("BABYLON.Animation");k&&e.animations.push(k.Parse(z))}K.autoAnimate&&b&&b.beginAnimation(e,K.autoAnimateFrom,K.autoAnimateTo,K.autoAnimateLoop,K.autoAnimateSpeed||1)}return e}static FromMesh(K,b,e){b||(b=K.name);const z=new n(b,e,K.va());return z.setPositions(K.getVerticesData(v.f.PositionKind)),K.isVerticesDataPresent(v.f.NormalKind)&&z.setNormals(K.getVerticesData(v.f.NormalKind)),K.isVerticesDataPresent(v.f.TangentKind)&&z.setTangents(K.getVerticesData(v.f.TangentKind)),K.isVerticesDataPresent(v.f.UVKind)&&z.setUVs(K.getVerticesData(v.f.UVKind)),z}}(0,x.b)([(0,Q.M)()],n.prototype,"id",void 0);var P=e(10951),d=e(11780);class p{set areUpdatesFrozen(K){K?this._blockCounter++:(this._blockCounter--,this._blockCounter<=0&&(this._blockCounter=0,this._syncActiveTargets(!0)))}get areUpdatesFrozen(){return this._blockCounter>0}constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(this._targets=new Array,this._targetInfluenceChangedObservers=new Array,this._targetDataLayoutChangedObservers=new Array,this._activeTargets=new P.h(16),this._supportsNormals=!1,this._supportsTangents=!1,this._supportsUVs=!1,this._vertexCount=0,this._uniqueId=0,this._tempInfluences=new Array,this._canUseTextureForTargets=!1,this._blockCounter=0,this._textureVertexStride=0,this._textureWidth=0,this._textureHeight=1,this._parentContainer=null,this.optimizeInfluencers=!0,this.enableNormalMorphing=!0,this.enableTangentMorphing=!0,this.enableUVMorphing=!0,this._numMaxInfluencers=0,this._useTextureToStoreTargets=!0,K||(K=B.b.LastCreatedScene),this._scene=K,this._scene){this._scene.addMorphTargetManager(this),this._uniqueId=this._scene.getUniqueId();const K=this._scene.getEngine().getCaps();this._canUseTextureForTargets=K.canUseGLVertexID&&K.textureFloat&&K.maxVertexTextureImageUnits>0&&K.texture2DArrayMaxLayerCount>1}}get numMaxInfluencers(){return this._numMaxInfluencers}set numMaxInfluencers(K){this._numMaxInfluencers!==K&&(this._numMaxInfluencers=K,this._syncActiveTargets(!0))}get uniqueId(){return this._uniqueId}get vertexCount(){return this._vertexCount}get supportsNormals(){return this._supportsNormals&&this.enableNormalMorphing}get supportsTangents(){return this._supportsTangents&&this.enableTangentMorphing}get supportsUVs(){return this._supportsUVs&&this.enableUVMorphing}get numTargets(){return this._targets.length}get numInfluencers(){return this._activeTargets.length}get influences(){return this._influences}get useTextureToStoreTargets(){return this._useTextureToStoreTargets}set useTextureToStoreTargets(K){this._useTextureToStoreTargets=K}get isUsingTextureForTargets(){var K;return p.EnableTextureStorage&&this.useTextureToStoreTargets&&this._canUseTextureForTargets&&!(null!==(K=this._scene)&&void 0!==K&&K.getEngine().getCaps().disableMorphTargetTexture)}getActiveTarget(K){return this._activeTargets.data[K]}getTarget(K){return this._targets[K]}getTargetByName(K){for(const b of this._targets)if(b.name===K)return b;return null}addTarget(K){this._targets.push(K),this._targetInfluenceChangedObservers.push(K.onInfluenceChanged.add((K=>{this._syncActiveTargets(K)}))),this._targetDataLayoutChangedObservers.push(K._onDataLayoutChanged.add((()=>{this._syncActiveTargets(!0)}))),this._syncActiveTargets(!0)}removeTarget(K){const b=this._targets.indexOf(K);b>=0&&(this._targets.splice(b,1),K.onInfluenceChanged.remove(this._targetInfluenceChangedObservers.splice(b,1)[0]),K._onDataLayoutChanged.remove(this._targetDataLayoutChangedObservers.splice(b,1)[0]),this._syncActiveTargets(!0)),this._scene&&this._scene.stopAnimation(K)}_bind(K){K.setFloat3("morphTargetTextureInfo",this._textureVertexStride,this._textureWidth,this._textureHeight),K.setFloatArray("morphTargetTextureIndices",this._morphTargetTextureIndices),K.setTexture("morphTargets",this._targetStoreTexture),K.setInt("morphTargetCount",this.numInfluencers)}clone(){const K=new p(this._scene);for(const b of this._targets)K.addTarget(b.clone());return K.enableNormalMorphing=this.enableNormalMorphing,K.enableTangentMorphing=this.enableTangentMorphing,K.enableUVMorphing=this.enableUVMorphing,K}serialize(){const K={};K.id=this.uniqueId,K.targets=[];for(const b of this._targets)K.targets.push(b.serialize());return K}_syncActiveTargets(K){if(this.areUpdatesFrozen)return;let b=0;this._activeTargets.reset(),this._supportsNormals=!0,this._supportsTangents=!0,this._supportsUVs=!0,this._vertexCount=0,this._scene&&this._targets.length>this._scene.getEngine().getCaps().texture2DArrayMaxLayerCount&&(this.useTextureToStoreTargets=!1),this._morphTargetTextureIndices&&this._morphTargetTextureIndices.length===this._targets.length||(this._morphTargetTextureIndices=new Float32Array(this._targets.length));let e=-1;for(const z of this._targets){if(e++,0===z.influence&&this.optimizeInfluencers)continue;if(this._activeTargets.length>=p.MaxActiveMorphTargetsInVertexAttributeMode&&!this.isUsingTextureForTargets)break;this._activeTargets.push(z),this._morphTargetTextureIndices[b]=e,this._tempInfluences[b++]=z.influence,this._supportsNormals=this._supportsNormals&&z.hasNormals,this._supportsTangents=this._supportsTangents&&z.hasTangents,this._supportsUVs=this._supportsUVs&&z.hasUVs;const K=z.getPositions();if(K){const b=K.length/3;if(0===this._vertexCount)this._vertexCount=b;else if(this._vertexCount!==b)return void u.b.Error("Incompatible target. Targets must all have the same vertices count.")}}this._morphTargetTextureIndices.length!==b&&(this._morphTargetTextureIndices=this._morphTargetTextureIndices.slice(0,b)),this._influences&&this._influences.length===b||(this._influences=new Float32Array(b));for(let z=0;z<b;z++)this._influences[z]=this._tempInfluences[z];K&&this.synchronize()}synchronize(){if(this._scene&&!this.areUpdatesFrozen){if(this.isUsingTextureForTargets&&(this._vertexCount||this.numMaxInfluencers>0)){this._textureVertexStride=1,this._supportsNormals&&this._textureVertexStride++,this._supportsTangents&&this._textureVertexStride++,this._supportsUVs&&this._textureVertexStride++,this._textureWidth=this._vertexCount*this._textureVertexStride||1,this._textureHeight=1;const K=this._scene.getEngine().getCaps().maxTextureSize;this._textureWidth>K&&(this._textureHeight=Math.ceil(this._textureWidth/K),this._textureWidth=K);let b=!0;if(this._targetStoreTexture){const K=this._targetStoreTexture.getSize();K.width===this._textureWidth&&K.height===this._textureHeight&&this._targetStoreTexture.depth===this._targets.length&&(b=!1)}if(b){this._targetStoreTexture&&this._targetStoreTexture.dispose();const K=this._targets.length,b=new Float32Array(K*this._textureWidth*this._textureHeight*4);let e=0;for(let z=0;z<K;z++){const K=this._targets[z],k=K.getPositions(),j=K.getNormals(),T=K.getUVs(),F=K.getTangents();if(!k)return void(0===z&&u.b.Error("Invalid morph target. Target must have positions."));e=z*this._textureWidth*this._textureHeight*4;for(let z=0;z<this._vertexCount;z++)b[e]=k[3*z],b[e+1]=k[3*z+1],b[e+2]=k[3*z+2],e+=4,this._supportsNormals&&j&&(b[e]=j[3*z],b[e+1]=j[3*z+1],b[e+2]=j[3*z+2],e+=4),this._supportsUVs&&T&&(b[e]=T[2*z],b[e+1]=T[2*z+1],e+=4),this._supportsTangents&&F&&(b[e]=F[3*z],b[e+1]=F[3*z+1],b[e+2]=F[3*z+2],e+=4)}this._targetStoreTexture=d.c.CreateRGBATexture(b,this._textureWidth,this._textureHeight,K,this._scene,!1,!1,1,1)}}for(const K of this._scene.meshes)K.morphTargetManager===this&&K._syncGeometryWithMorphTargetManager()}}dispose(){if(this._targetStoreTexture&&this._targetStoreTexture.dispose(),this._targetStoreTexture=null,this._scene){if(this._scene.removeMorphTargetManager(this),this._parentContainer){const K=this._parentContainer.morphTargetManagers.indexOf(this);K>-1&&this._parentContainer.morphTargetManagers.splice(K,1),this._parentContainer=null}for(const K of this._targets)this._scene.stopAnimation(K)}}static Parse(K,b){const e=new p(b);for(const z of K.targets)e.addTarget(n.Parse(z,b));return e}}p.EnableTextureStorage=!0,p.MaxActiveMorphTargetsInVertexAttributeMode=8;var a=e(11924),O=e(10723),g=e(11100);function N(K,b,e,z){return k.k.Bg(b,e).scaleInPlace(z)}class Z{constructor(K,b,e,z){this.type=K,this.name=b,this.getValue=e,this.getStride=z}_buildAnimation(K,b,e){const z=new t.c(K,this.name,b,this.type);return z.setKeys(e),z}}class y extends Z{buildAnimations(K,b,e,z,k){k(K._babylonTransformNode,this._buildAnimation(b,e,z))}}const s={translation:[new y(t.c.ANIMATIONTYPE_VECTOR3,"position",N,(()=>3))],rotation:[new y(t.c.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",(function(K,b,e,z){return k.d.Bg(b,e).scaleInPlace(z)}),(()=>4))],scale:[new y(t.c.ANIMATIONTYPE_VECTOR3,"Zd",N,(()=>3))],weights:[new class extends Z{buildAnimations(K,b,e,z,k){if(K._numMorphTargets)for(let j=0;j<K._numMorphTargets;j++){const T=new t.c(`${b}_${j}`,this.name,e,this.type);if(T.setKeys(z.map((K=>({frame:K.frame,inTangent:K.inTangent?K.inTangent[j]:void 0,value:K.value[j],outTangent:K.outTangent?K.outTangent[j]:void 0,interpolation:K.interpolation})))),K._primitiveBabylonMeshes)for(const b of K._primitiveBabylonMeshes)if(b.morphTargetManager){const K=b.morphTargetManager.getTarget(j),e=T.clone();K.animations.push(e),k(K,e)}}}}(t.c.ANIMATIONTYPE_FLOAT,"influence",(function(K,b,e,z){const k=new Array(K._numMorphTargets);for(let j=0;j<k.length;j++)k[j]=b[e++]*z;return k}),(K=>K._numMorphTargets))]},E=new Map,o=E;function C(K,b,e){H(K)&&u.b.Warn(`Extension with the name '${K}' already exists`),E.set(K,{isGLTFExtension:b,factory:e})}function H(K){return E.delete(K)}function W(){const K=K=>K&&"object"===typeof K;for(var b=arguments.length,e=new Array(b),z=0;z<b;z++)e[z]=arguments[z];return e.reduce(((b,e)=>(Object.keys(e).forEach((z=>{const k=b[z],j=e[z];Array.isArray(k)&&Array.isArray(j)?b[z]=k.concat(...j):K(k)&&K(j)?b[z]=W(k,j):b[z]=j})),b)),{})}class f{static Get(K,b,e){if(!b||void 0==e||!b[e])throw new Error(`${K}: Failed to find index (${e})`);return b[e]}static TryGet(K,b){return K&&void 0!=b&&K[b]?K[b]:null}static Assign(K){if(K)for(let b=0;b<K.length;b++)K[b].index=b}}class V{static RegisterExtension(K,b){C(K,!1,b)}static UnregisterExtension(K){return H(K)}get xi(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf}get bin(){return this._bin}get parent(){return this._parent}get babylonScene(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene}get rootBabylonMesh(){return this._rootBabylonMesh}get rootUrl(){return this._rootUrl}constructor(K){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=K}dispose(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach((K=>K.dispose&&K.dispose())),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())}importMeshAsync(K,b,e,z,k,j){let T=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";return Promise.resolve().then((()=>{this._babylonScene=b,this._assetContainer=e,this._loadData(z);let j=null;if(K){const b={};if(this._gltf.nodes)for(const K of this._gltf.nodes)K.name&&(b[K.name]=K.index);j=(K instanceof Array?K:[K]).map((K=>{const e=b[K];if(void 0===e)throw new Error(`Failed to find node '${K}'`);return e}))}return this._loadAsync(k,T,j,(()=>({meshes:this._getMeshes(),_i:[],skeletons:this._getSkeletons(),animationGroups:this._getAnimationGroups(),lights:this._babylonLights,transformNodes:this._getTransformNodes(),geometries:this._getGeometries(),spriteManagers:[]})))}))}loadAsync(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return Promise.resolve().then((()=>(this._babylonScene=K,this._loadData(b),this._loadAsync(e,k,null,(()=>{})))))}_loadAsync(K,b,e,z){return Promise.resolve().then((async()=>{this._rootUrl=K,this._uniqueRootUrl=!K.startsWith("file:")&&b?K:`${K}${Date.now()}/`,this._fileName=b,this._allMaterialsDirtyRequired=!1,await this._loadExtensionsAsync();const k=`${a.j[a.j.LOADING]} => ${a.j[a.j.READY]}`,j=`${a.j[a.j.LOADING]} => ${a.j[a.j.COMPLETE]}`;this._parent._startPerformanceCounter(k),this._parent._startPerformanceCounter(j),this._parent._setState(a.j.LOADING),this._extensionsOnLoading();const F=new Array;if(!this.parent.loadOnlyMaterials)if(e)F.push(this.loadSceneAsync("/nodes",{nodes:e,index:-1}));else if(void 0!=this._gltf.Ad||this._gltf.scenes&&this._gltf.scenes[0]){const K=f.Get("/scene",this._gltf.scenes,this._gltf.Ad||0);F.push(this.loadSceneAsync(`/scenes/${K.index}`,K))}if(!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(let K=0;K<this._gltf.materials.length;++K){const b=this._gltf.materials[K],e="/materials/"+K,z=I.b.TriangleFillMode;F.push(this._loadMaterialAsync(e,b,null,z,(()=>{})))}this._allMaterialsDirtyRequired,this._parent.compileMaterials&&F.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&F.push(this._compileShadowGeneratorsAsync());return Promise.all(F).then((()=>(this._rootBabylonMesh&&this._rootBabylonMesh!==this._parent.customRootNode&&this._rootBabylonMesh.yb(!0),this._extensionsOnReady(),this._parent._setState(a.j.READY),this._startAnimations(),z()))).then((K=>(this._parent._endPerformanceCounter(k),T.f.SetImmediate((()=>{this._disposed||Promise.all(this._completePromises).then((()=>{this._parent._endPerformanceCounter(j),this._parent._setState(a.j.COMPLETE),this._parent.onCompleteObservable.notifyObservers(void 0),this._parent.onCompleteObservable.clear(),this.dispose()}),(K=>{this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()}))})),K)))})).catch((K=>{throw this._disposed||(this._parent.onErrorObservable.notifyObservers(K),this._parent.onErrorObservable.clear(),this.dispose()),K}))}_loadData(K){if(this._gltf=K.json,this._setupData(),K.bin){const b=this._gltf.buffers;if(b&&b[0]&&!b[0].uri){const e=b[0];(e.byteLength<K.bin.byteLength-3||e.byteLength>K.bin.byteLength)&&u.b.Warn(`Binary buffer length (${e.byteLength}) from JSON does not match chunk length (${K.bin.byteLength})`),this._bin=K.bin}else u.b.Warn("Unexpected BIN chunk")}}_setupData(){if(f.Assign(this._gltf.accessors),f.Assign(this._gltf.animations),f.Assign(this._gltf.buffers),f.Assign(this._gltf.bufferViews),f.Assign(this._gltf.cameras),f.Assign(this._gltf.images),f.Assign(this._gltf.materials),f.Assign(this._gltf.meshes),f.Assign(this._gltf.nodes),f.Assign(this._gltf.samplers),f.Assign(this._gltf.scenes),f.Assign(this._gltf.skins),f.Assign(this._gltf.textures),this._gltf.nodes){const K={};for(const e of this._gltf.nodes)if(e.children)for(const b of e.children)K[b]=e.index;const b=this._createRootNode();for(const e of this._gltf.nodes){const z=K[e.index];e.parent=void 0===z?b:this._gltf.nodes[z]}}}async _loadExtensionsAsync(){const K=[];if(o.forEach(((b,e)=>{var z;!1===(null===(z=this.parent.extensionOptions[e])||void 0===z?void 0:z.enabled)?b.isGLTFExtension&&this.isExtensionUsed(e)&&u.b.Warn(`Extension ${e} is used but has been explicitly disabled.`):b.isGLTFExtension&&!this.isExtensionUsed(e)||K.push((async()=>{const K=await b.factory(this);return K.name!==e&&u.b.Warn(`The name of the glTF loader extension instance does not match the registered name: ${K.name} !== ${e}`),this._parent.onExtensionLoadedObservable.notifyObservers(K),K})())})),this._extensions.push(...await Promise.all(K)),this._extensions.sort(((K,b)=>(K.order||Number.MAX_VALUE)-(b.order||Number.MAX_VALUE))),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(const e of this._gltf.extensionsRequired){if(!this._extensions.some((K=>K.name===e&&K.enabled))){var b;if(!1===(null===(b=this.parent.extensionOptions[e])||void 0===b?void 0:b.enabled))throw new Error(`Required extension ${e} is disabled`);throw new Error(`Required extension ${e} is not available`)}}}_createRootNode(){if(void 0!==this._parent.customRootNode)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:null===this._rootBabylonMesh?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;const K=new R.b("__root__",this._babylonScene);this._rootBabylonMesh=K,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.yb(!1);const b={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case a.i.AUTO:this._babylonScene.useRightHandedSystem||(b.rotation=[0,1,0,0],b.scale=[1,1,-1],V._LoadTransform(b,this._rootBabylonMesh));break;case a.i.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error(`Invalid coordinate system mode (${this._parent.coordinateSystemMode})`)}return this._parent.onMeshLoadedObservable.notifyObservers(K),b}loadSceneAsync(K,b){const e=this._extensionsLoadSceneAsync(K,b);if(e)return e;const z=new Array;if(this.logOpen(`${K} ${b.name||""}`),b.nodes)for(const k of b.nodes){const b=f.Get(`${K}/nodes/${k}`,this._gltf.nodes,k);z.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(K=>{K.parent=this._rootBabylonMesh})))}for(const k of this._postSceneLoadActions)k();return z.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(z).then((()=>{}))}_forEachPrimitive(K,b){if(K._primitiveBabylonMeshes)for(const e of K._primitiveBabylonMeshes)b(e)}_getGeometries(){const K=[],b=this._gltf.nodes;if(b)for(const e of b)this._forEachPrimitive(e,(b=>{const e=b.mj;e&&-1===K.indexOf(e)&&K.push(e)}));return K}_getMeshes(){const K=[];this._rootBabylonMesh instanceof h.e&&K.push(this._rootBabylonMesh);const b=this._gltf.nodes;if(b)for(const e of b)this._forEachPrimitive(e,(b=>{K.push(b)}));return K}_getTransformNodes(){const K=[],b=this._gltf.nodes;if(b)for(const e of b)e._babylonTransformNode&&"sb"===e._babylonTransformNode.getClassName()&&K.push(e._babylonTransformNode),e._babylonTransformNodeForSkin&&K.push(e._babylonTransformNodeForSkin);return K}_getSkeletons(){const K=[],b=this._gltf.skins;if(b)for(const e of b)e._data&&K.push(e._data.babylonSkeleton);return K}_getAnimationGroups(){const K=[],b=this._gltf.animations;if(b)for(const e of b)e._babylonAnimationGroup&&K.push(e._babylonAnimationGroup);return K}_startAnimations(){switch(this._parent.animationStartMode){case a.e.NONE:break;case a.e.FIRST:{const K=this._getAnimationGroups();0!==K.length&&K[0].start(!0);break}case a.e.ALL:{const K=this._getAnimationGroups();for(const b of K)b.start(!0);break}default:return void u.b.Error(`Invalid animation start mode (${this._parent.animationStartMode})`)}}loadNodeAsync(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadNodeAsync(K,b,e);if(z)return z;if(b._babylonTransformNode)throw new Error(`${K}: Invalid recursive node hierarchy`);const k=new Array;this.logOpen(`${K} ${b.name||""}`);const j=z=>{if(V.AddPointerMetadata(z,K),V._LoadTransform(b,z),void 0!=b.camera){const e=f.Get(`${K}/camera`,this._gltf.cameras,b.camera);k.push(this.loadCameraAsync(`/cameras/${e.index}`,e,(K=>{K.parent=z})))}if(b.children)for(const e of b.children){const b=f.Get(`${K}/children/${e}`,this._gltf.nodes,e);k.push(this.loadNodeAsync(`/nodes/${b.index}`,b,(K=>{K.parent=z})))}e(z)},T=void 0!=b.mesh,F=this._parent.loadSkins&&void 0!=b.skin;if(!T||F){const K=b.name||`node${b.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new c.c(K,this._babylonScene);e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,void 0==b.mesh?b._babylonTransformNode=e:b._babylonTransformNodeForSkin=e,j(e)}if(T)if(F){const e=f.Get(`${K}/mesh`,this._gltf.meshes,b.mesh);k.push(this._loadMeshAsync(`/meshes/${e.index}`,b,e,(e=>{const z=b._babylonTransformNodeForSkin;e.metadata=W(z.metadata,e.metadata||{});const j=f.Get(`${K}/skin`,this._gltf.skins,b.skin);k.push(this._loadSkinAsync(`/skins/${j.index}`,b,j,(K=>{this._forEachPrimitive(b,(b=>{b.skeleton=K})),this._postSceneLoadActions.push((()=>{if(void 0!=j.skeleton){const K=f.Get(`/skins/${j.index}/skeleton`,this._gltf.nodes,j.skeleton).parent;b.index===K.index?e.parent=z.parent:e.parent=K._babylonTransformNode}else e.parent=this._rootBabylonMesh;this._parent.onSkinLoadedObservable.notifyObservers({node:z,skinnedNode:e})}))})))})))}else{const e=f.Get(`${K}/mesh`,this._gltf.meshes,b.mesh);k.push(this._loadMeshAsync(`/meshes/${e.index}`,b,e,j))}return this.logClose(),Promise.all(k).then((()=>(this._forEachPrimitive(b,(K=>{K.mj&&K.mj.useBoundingInfoFromGeometry?K.Ea():K.refreshBoundingInfo(!0,!0)})),b._babylonTransformNode)))}_loadMeshAsync(K,b,e,z){const k=e.primitives;if(!k||!k.length)throw new Error(`${K}: Primitives are missing`);void 0==k[0].index&&f.Assign(k);const j=new Array;this.logOpen(`${K} ${e.name||""}`);const T=b.name||`node${b.index}`;if(1===k.length){const z=e.primitives[0];j.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${z.index}`,T,b,e,z,(K=>{b._babylonTransformNode=K,b._primitiveBabylonMeshes=[K]})))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,b._babylonTransformNode=new c.c(T,this._babylonScene),b._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._primitiveBabylonMeshes=[];for(const z of k)j.push(this._loadMeshPrimitiveAsync(`${K}/primitives/${z.index}`,`${T}_primitive${z.index}`,b,e,z,(K=>{K.parent=b._babylonTransformNode,b._primitiveBabylonMeshes.push(K)})))}return z(b._babylonTransformNode),this.logClose(),Promise.all(j).then((()=>b._babylonTransformNode))}_loadMeshPrimitiveAsync(K,b,e,z,k,j){const T=this._extensionsLoadMeshPrimitiveAsync(K,b,e,z,k,j);if(T)return T;this.logOpen(`${K}`);const F=0===this._disableInstancedMesh&&this._parent.createInstances&&void 0==e.skin&&!z.primitives[0].targets;let l,Y;if(F&&k._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,l=k._instanceData.babylonSourceMesh.createInstance(b),l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,Y=k._instanceData.promise;else{const j=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new R.b(b,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.sideOrientation=this._babylonScene.useRightHandedSystem?I.b.CounterClockWiseSideOrientation:I.b.ClockWiseSideOrientation,this._createMorphTargets(K,e,z,k,T),j.push(this._loadVertexDataAsync(K,k,T).then((b=>this._loadMorphTargetsAsync(K,k,T,b).then((()=>{this._disposed||(this._babylonScene._blockEntityCollection=!!this._assetContainer,b.Ca(T),b._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1)})))));const A=V._GetDrawMode(K,k.mode);if(void 0==k.material){let K=this._defaultBabylonMaterialData[A];K||(K=this._createDefaultMaterial("__GLTFLoader._default",A),this._parent.onMaterialLoadedObservable.notifyObservers(K),this._defaultBabylonMaterialData[A]=K),T.material=K}else if(!this.parent.skipMaterials){const b=f.Get(`${K}/material`,this._gltf.materials,k.material);j.push(this._loadMaterialAsync(`/materials/${b.index}`,b,T,A,(K=>{T.material=K})))}Y=Promise.all(j),F&&(k._instanceData={babylonSourceMesh:T,promise:Y}),l=T}return V.AddPointerMetadata(l,K),this._parent.onMeshLoadedObservable.notifyObservers(l),j(l),this.logClose(),Y.then((()=>l))}_loadVertexDataAsync(K,b,e){const z=this._extensionsLoadVertexDataAsync(K,b,e);if(z)return z;const j=b.attributes;if(!j)throw new Error(`${K}: Attributes are missing`);const T=new Array,F=new w.c(e.name,this._babylonScene);if(void 0==b.indices)e.isUnIndexed=!0;else{const e=f.Get(`${K}/indices`,this._gltf.accessors,b.indices);T.push(this._loadIndicesAccessorAsync(`/accessors/${e.index}`,e).then((K=>{F.setIndices(K)})))}const l=(b,z,l)=>{if(void 0==j[b])return;e._delayInfo=e._delayInfo||[],-1===e._delayInfo.indexOf(z)&&e._delayInfo.push(z);const Y=f.Get(`${K}/attributes/${b}`,this._gltf.accessors,j[b]);T.push(this._loadVertexAccessorAsync(`/accessors/${Y.index}`,Y,z).then((K=>{if(K.getKind()===v.f.PositionKind&&!this.parent.alwaysComputeBoundingBox&&!e.skeleton&&Y.min&&Y.max){const K=k.e.gb[0].Yd(...Y.min),b=k.e.gb[1].Yd(...Y.max);if(Y.normalized&&5126!==Y.componentType){let e=1;switch(Y.componentType){case 5120:e=127;break;case 5121:e=255;break;case 5122:e=32767;break;case 5123:e=65535}const z=1/e;K.scaleInPlace(z),b.scaleInPlace(z)}F._boundingInfo=new g.b(K,b),F.useBoundingInfoFromGeometry=!0}F.setVerticesBuffer(K,Y.count)}))),z==v.f.MatricesIndicesExtraKind&&(e.numBoneInfluencers=8),l&&l(Y)};return l("POSITION",v.f.PositionKind),l("NORMAL",v.f.NormalKind),l("TANGENT",v.f.TangentKind),l("TEXCOORD_0",v.f.UVKind),l("TEXCOORD_1",v.f.UV2Kind),l("TEXCOORD_2",v.f.UV3Kind),l("TEXCOORD_3",v.f.UV4Kind),l("TEXCOORD_4",v.f.UV5Kind),l("TEXCOORD_5",v.f.UV6Kind),l("JOINTS_0",v.f.MatricesIndicesKind),l("WEIGHTS_0",v.f.MatricesWeightsKind),l("JOINTS_1",v.f.MatricesIndicesExtraKind),l("WEIGHTS_1",v.f.MatricesWeightsExtraKind),l("COLOR_0",v.f.ColorKind,(K=>{"VEC4"===K.type&&(e.hasVertexAlpha=!0)})),Promise.all(T).then((()=>F))}_createMorphTargets(K,b,e,z,k){if(!z.targets||!this._parent.loadMorphTargets)return;if(void 0==b._numMorphTargets)b._numMorphTargets=z.targets.length;else if(z.targets.length!==b._numMorphTargets)throw new Error(`${K}: Primitives do not have the same number of targets`);const j=e.extras?e.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,k.morphTargetManager=new p(this._babylonScene),k.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,k.morphTargetManager.areUpdatesFrozen=!0;for(let T=0;T<z.targets.length;T++){const K=b.weights?b.weights[T]:e.weights?e.weights[T]:0,z=j?j[T]:`morphTarget${T}`;k.morphTargetManager.addTarget(new n(z,K,k.va()))}}_loadMorphTargetsAsync(K,b,e,z){if(!b.targets||!this._parent.loadMorphTargets)return Promise.resolve();const k=new Array,j=e.morphTargetManager;for(let T=0;T<j.numTargets;T++){const e=j.getTarget(T);k.push(this._loadMorphTargetVertexDataAsync(`${K}/targets/${T}`,z,b.targets[T],e))}return Promise.all(k).then((()=>{j.areUpdatesFrozen=!1}))}_loadMorphTargetVertexDataAsync(K,b,e,z){const k=new Array,j=(z,j,T)=>{if(void 0==e[z])return;const F=b.getVertexBuffer(j);if(!F)return;const l=f.Get(`${K}/${z}`,this._gltf.accessors,e[z]);k.push(this._loadFloatAccessorAsync(`/accessors/${l.index}`,l).then((K=>{T(F,K)})))};return j("POSITION",v.f.PositionKind,((K,b)=>{const e=new Float32Array(b.length);K.forEach(b.length,((K,z)=>{e[z]=b[z]+K})),z.setPositions(e)})),j("NORMAL",v.f.NormalKind,((K,b)=>{const e=new Float32Array(b.length);K.forEach(e.length,((K,z)=>{e[z]=b[z]+K})),z.setNormals(e)})),j("TANGENT",v.f.TangentKind,((K,b)=>{const e=new Float32Array(b.length/3*4);let k=0;K.forEach(b.length/3*4,((K,z)=>{(z+1)%4!==0&&(e[k]=b[k]+K,k++)})),z.setTangents(e)})),Promise.all(k).then((()=>{}))}static _LoadTransform(K,b){if(void 0!=K.skin)return;let e=k.k.Zero(),z=k.d.Identity(),j=k.k.One();if(K.matrix){k.b.Bg(K.matrix).decompose(j,z,e)}else K.translation&&(e=k.k.Bg(K.translation)),K.rotation&&(z=k.d.Bg(K.rotation)),K.scale&&(j=k.k.Bg(K.scale));b.position=e,b.rotationQuaternion=z,b.Zd=j}_loadSkinAsync(K,b,e,z){if(!this._parent.loadSkins)return Promise.resolve();const k=this._extensionsLoadSkinAsync(K,b,e);if(k)return k;if(e._data)return z(e._data.babylonSkeleton),e._data.promise;const j=`skeleton${e.index}`;this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new D(e.name||j,j,this._babylonScene);T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(K,e,T);const F=this._loadSkinInverseBindMatricesDataAsync(K,e).then((K=>{this._updateBoneMatrices(T,K)}));return e._data={babylonSkeleton:T,promise:F},z(T),F}_loadBones(K,b,e){if(void 0==b.skeleton||this._parent.alwaysComputeSkeletonRootNode){const e=this._findSkeletonRootNode(`${K}/joints`,b.joints);if(e)if(void 0===b.skeleton)b.skeleton=e.index;else{const z=(K,b)=>{for(;b.parent;b=b.parent)if(b.parent===K)return!0;return!1},k=f.Get(`${K}/skeleton`,this._gltf.nodes,b.skeleton);k===e||z(k,e)||(u.b.Warn(`${K}/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root`),b.skeleton=e.index)}else u.b.Warn(`${K}: Failed to find common root`)}const z={};for(const k of b.joints){const j=f.Get(`${K}/joints/${k}`,this._gltf.nodes,k);this._loadBone(j,b,e,z)}}_findSkeletonRootNode(K,b){if(0===b.length)return null;const e={};for(const k of b){const b=[];let z=f.Get(`${K}/${k}`,this._gltf.nodes,k);for(;-1!==z.index;)b.unshift(z),z=z.parent;e[k]=b}let z=null;for(let k=0;;++k){let K=e[b[0]];if(k>=K.length)return z;const j=K[k];for(let T=1;T<b.length;++T)if(K=e[b[T]],k>=K.length||j!==K[k])return z;z=j}}_loadBone(K,b,e,z){K._isJoint=!0;let k=z[K.index];if(k)return k;let j=null;K.index!==b.skeleton&&(K.parent&&-1!==K.parent.index?j=this._loadBone(K.parent,b,e,z):void 0!==b.skeleton&&u.b.Warn(`/skins/${b.index}/skeleton: Skeleton node is not a common root`));const T=b.joints.indexOf(K.index);return k=new Y.b(K.name||`joint${K.index}`,e,j,this._getNodeMatrix(K),null,null,T),z[K.index]=k,this._postSceneLoadActions.push((()=>{k.linkTransformNode(K._babylonTransformNode)})),k}_loadSkinInverseBindMatricesDataAsync(K,b){if(void 0==b.inverseBindMatrices)return Promise.resolve(null);const e=f.Get(`${K}/inverseBindMatrices`,this._gltf.accessors,b.inverseBindMatrices);return this._loadFloatAccessorAsync(`/accessors/${e.index}`,e)}_updateBoneMatrices(K,b){for(const e of K.bones){const K=k.b.Identity(),z=e._index;b&&-1!==z&&(k.b.FromArrayToRef(b,16*z,K),K.invertToRef(K));const j=e.getParent();j&&K.multiplyToRef(j.getAbsoluteInverseBindMatrix(),K),e.qj(K,!1,!1),e._updateAbsoluteBindMatrices(void 0,!1)}}_getNodeMatrix(K){return K.matrix?k.b.Bg(K.matrix):k.b.Compose(K.scale?k.k.Bg(K.scale):k.k.One(),K.rotation?k.d.Bg(K.rotation):k.d.Identity(),K.translation?k.k.Bg(K.translation):k.k.Zero())}loadCameraAsync(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadCameraAsync(K,b,e);if(z)return z;const j=new Array;this.logOpen(`${K} ${b.name||""}`),this._babylonScene._blockEntityCollection=!!this._assetContainer;const T=new l.d(b.name||`camera${b.index}`,k.k.Zero(),this._babylonScene,!1);switch(T._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,T.ignoreParentScaling=!0,b._babylonCamera=T,T.rotation.set(0,Math.PI,0),b.type){case"perspective":{const e=b.perspective;if(!e)throw new Error(`${K}: Camera perspective properties are missing`);T.fov=e.yfov,T.Fi=e.znear,T.maxZ=e.zfar||0;break}case"orthographic":if(!b.orthographic)throw new Error(`${K}: Camera orthographic properties are missing`);T.mode=F.e.ORTHOGRAPHIC_CAMERA,T.orthoLeft=-b.orthographic.xmag,T.orthoRight=b.orthographic.xmag,T.orthoBottom=-b.orthographic.ymag,T.orthoTop=b.orthographic.ymag,T.Fi=b.orthographic.znear,T.maxZ=b.orthographic.zfar;break;default:throw new Error(`${K}: Invalid camera type (${b.type})`)}return V.AddPointerMetadata(T,K),this._parent.onCameraLoadedObservable.notifyObservers(T),e(T),this.logClose(),Promise.all(j).then((()=>T))}_loadAnimationsAsync(){const K=this._gltf.animations;if(!K)return Promise.resolve();const b=new Array;for(let e=0;e<K.length;e++){const z=K[e];b.push(this.loadAnimationAsync(`/animations/${z.index}`,z).then((K=>{0===K.targetedAnimations.length&&K.dispose()})))}return Promise.all(b).then((()=>{}))}loadAnimationAsync(K,b){const z=this._extensionsLoadAnimationAsync(K,b);return z||e.e(38).then(e.bind(e,13193)).then((e=>{let{AnimationGroup:z}=e;this._babylonScene._blockEntityCollection=!!this._assetContainer;const k=new z(b.name||`animation${b.index}`,this._babylonScene);k._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,b._babylonAnimationGroup=k;const j=new Array;f.Assign(b.channels),f.Assign(b.samplers);for(const T of b.channels)j.push(this._loadAnimationChannelAsync(`${K}/channels/${T.index}`,K,b,T,((K,b)=>{K.animations=K.animations||[],K.animations.push(b),k.addTargetedAnimation(b,K)})));return Promise.all(j).then((()=>(k.normalize(0),k)))}))}_loadAnimationChannelAsync(K,b,e,z,k){const j=this._extensionsLoadAnimationChannelAsync(K,b,e,z,k);if(j)return j;if(void 0==z.target.node)return Promise.resolve();const T=f.Get(`${K}/target/node`,this._gltf.nodes,z.target.node),F=z.target.path,l="weights"===F;if(l&&!T._numMorphTargets||!l&&!T._babylonTransformNode)return Promise.resolve();if(!this._parent.loadNodeAnimations&&!l&&!T._isJoint)return Promise.resolve();let Y;switch(F){case"translation":Y=s.translation;break;case"rotation":Y=s.rotation;break;case"scale":Y=s.scale;break;case"weights":Y=s.weights;break;default:throw new Error(`${K}/target/path: Invalid value (${z.target.path})`)}const A={object:T,info:Y};return this._loadAnimationChannelFromTargetInfoAsync(K,b,e,z,A,k)}_loadAnimationChannelFromTargetInfoAsync(K,b,e,z,k,j){const T=this.parent.targetFps,F=1/T,l=f.Get(`${K}/sampler`,e.samplers,z.sampler);return this._loadAnimationSamplerAsync(`${b}/samplers/${z.sampler}`,l).then((K=>{let b=0;const l=k.object,Y=k.info;for(const k of Y){const Y=k.getStride(l),A=K.input,X=K.output,t=new Array(A.length);let U=0;switch(K.interpolation){case"STEP":for(let K=0;K<A.length;K++){const b=k.getValue(l,X,U,1);U+=Y,t[K]={frame:A[K]*T,value:b,interpolation:1}}break;case"CUBICSPLINE":for(let K=0;K<A.length;K++){const b=k.getValue(l,X,U,F);U+=Y;const e=k.getValue(l,X,U,1);U+=Y;const z=k.getValue(l,X,U,F);U+=Y,t[K]={frame:A[K]*T,inTangent:b,value:e,outTangent:z}}break;case"LINEAR":for(let K=0;K<A.length;K++){const b=k.getValue(l,X,U,1);U+=Y,t[K]={frame:A[K]*T,value:b}}}if(U>0){const K=`${e.name||`animation${e.index}`}_channel${z.index}_${b}`;k.buildAnimations(l,K,T,t,((K,e)=>{++b,j(K,e)}))}}}))}_loadAnimationSamplerAsync(K,b){if(b._data)return b._data;const e=b.interpolation||"LINEAR";switch(e){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(`${K}/interpolation: Invalid value (${b.interpolation})`)}const z=f.Get(`${K}/input`,this._gltf.accessors,b.input),k=f.Get(`${K}/output`,this._gltf.accessors,b.output);return b._data=Promise.all([this._loadFloatAccessorAsync(`/accessors/${z.index}`,z),this._loadFloatAccessorAsync(`/accessors/${k.index}`,k)]).then((K=>{let[b,z]=K;return{input:b,interpolation:e,output:z}})),b._data}loadBufferAsync(K,b,e,z){const k=this._extensionsLoadBufferAsync(K,b,e,z);if(k)return k;if(!b._data)if(b.uri)b._data=this.loadUriAsync(`${K}/uri`,b,b.uri);else{if(!this._bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);b._data=this._bin.readAsync(0,b.byteLength)}return b._data.then((b=>{try{return new Uint8Array(b.buffer,b.byteOffset+e,z)}catch(k){throw new Error(`${K}: ${k.message}`)}}))}loadBufferViewAsync(K,b){const e=this._extensionsLoadBufferViewAsync(K,b);if(e)return e;if(b._data)return b._data;const z=f.Get(`${K}/buffer`,this._gltf.buffers,b.buffer);return b._data=this.loadBufferAsync(`/buffers/${z.index}`,z,b.byteOffset||0,b.byteLength),b._data}_loadAccessorAsync(K,b,e){if(b._data)return b._data;const z=V._GetNumComponents(K,b.type),k=z*v.f.GetTypeByteLength(b.componentType),j=z*b.count;if(void 0==b.bufferView)b._data=Promise.resolve(new e(j));else{const T=f.Get(`${K}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${T.index}`,T).then((F=>{if(5126!==b.componentType||b.normalized||T.byteStride&&T.byteStride!==k){const K=new e(j);return v.f.ForEach(F,b.byteOffset||0,T.byteStride||k,z,b.componentType,K.length,b.normalized||!1,((b,e)=>{K[e]=b})),K}return V._GetTypedArray(K,b.componentType,F,b.byteOffset,j)}))}if(b.sparse){const j=b.sparse;b._data=b._data.then((T=>{const F=T,l=f.Get(`${K}/sparse/indices/bufferView`,this._gltf.bufferViews,j.indices.bufferView),Y=f.Get(`${K}/sparse/values/bufferView`,this._gltf.bufferViews,j.values.bufferView);return Promise.all([this.loadBufferViewAsync(`/bufferViews/${l.index}`,l),this.loadBufferViewAsync(`/bufferViews/${Y.index}`,Y)]).then((T=>{let[l,Y]=T;const A=V._GetTypedArray(`${K}/sparse/indices`,j.indices.componentType,l,j.indices.byteOffset,j.count),X=z*j.count;let t;if(5126!==b.componentType||b.normalized){const T=V._GetTypedArray(`${K}/sparse/values`,b.componentType,Y,j.values.byteOffset,X);t=new e(X),v.f.ForEach(T,0,k,z,b.componentType,t.length,b.normalized||!1,((K,b)=>{t[b]=K}))}else t=V._GetTypedArray(`${K}/sparse/values`,b.componentType,Y,j.values.byteOffset,X);let U=0;for(let K=0;K<A.length;K++){let b=A[K]*z;for(let K=0;K<z;K++)F[b++]=t[U++]}return F}))}))}return b._data}_loadFloatAccessorAsync(K,b){return this._loadAccessorAsync(K,b,Float32Array)}_loadIndicesAccessorAsync(K,b){if("SCALAR"!==b.type)throw new Error(`${K}/type: Invalid value ${b.type}`);if(5121!==b.componentType&&5123!==b.componentType&&5125!==b.componentType)throw new Error(`${K}/componentType: Invalid value ${b.componentType}`);if(b._data)return b._data;if(b.sparse){const e=V._GetTypedArrayConstructor(`${K}/componentType`,b.componentType);b._data=this._loadAccessorAsync(K,b,e)}else{const e=f.Get(`${K}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e).then((e=>V._GetTypedArray(K,b.componentType,e,b.byteOffset,b.count)))}return b._data}_loadVertexBufferViewAsync(K){if(K._babylonBuffer)return K._babylonBuffer;const b=this._babylonScene.getEngine();return K._babylonBuffer=this.loadBufferViewAsync(`/bufferViews/${K.index}`,K).then((K=>new v.b(b,K,!1))),K._babylonBuffer}_loadVertexAccessorAsync(K,b,e){var z;if(null!==(z=b._babylonVertexBuffer)&&void 0!==z&&z[e])return b._babylonVertexBuffer[e];b._babylonVertexBuffer||(b._babylonVertexBuffer={});const k=this._babylonScene.getEngine();if(b.sparse||void 0==b.bufferView)b._babylonVertexBuffer[e]=this._loadFloatAccessorAsync(K,b).then((K=>new v.f(k,K,e,!1)));else{const z=f.Get(`${K}/bufferView`,this._gltf.bufferViews,b.bufferView);b._babylonVertexBuffer[e]=this._loadVertexBufferViewAsync(z).then((j=>{const T=V._GetNumComponents(K,b.type);return new v.f(k,j,e,!1,void 0,z.byteStride,void 0,b.byteOffset,T,b.componentType,b.normalized,!0,void 0,!0)}))}return b._babylonVertexBuffer[e]}_loadMaterialMetallicRoughnessPropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;return b&&(b.baseColorFactor?(e.albedoColor=j.c.Bg(b.baseColorFactor),e.alpha=b.baseColorFactor[3]):e.albedoColor=j.c.White(),e.metallic=void 0==b.metallicFactor?1:b.metallicFactor,e.roughness=void 0==b.roughnessFactor?1:b.roughnessFactor,b.baseColorTexture&&z.push(this.loadTextureInfoAsync(`${K}/baseColorTexture`,b.baseColorTexture,(K=>{K.name=`${e.name} (Base Color)`,e.albedoTexture=K}))),b.metallicRoughnessTexture&&(b.metallicRoughnessTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${K}/metallicRoughnessTexture`,b.metallicRoughnessTexture,(K=>{K.name=`${e.name} (Metallic Roughness)`,e.metallicTexture=K}))),e.useMetallnessFromMetallicTextureBlue=!0,e.useRoughnessFromMetallicTextureGreen=!0,e.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(z).then((()=>{}))}_loadMaterialAsync(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:()=>{};const j=this._extensionsLoadMaterialAsync(K,b,e,z,k);if(j)return j;b._data=b._data||{};let T=b._data[z];if(!T){this.logOpen(`${K} ${b.name||""}`);const e=this.createMaterial(K,b,z);T={babylonMaterial:e,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(K,b,e)},b._data[z]=T,V.AddPointerMetadata(e,K),this._parent.onMaterialLoadedObservable.notifyObservers(e),this.logClose()}return e&&(T.babylonMeshes.push(e),e.Ui.addOnce((()=>{const K=T.babylonMeshes.indexOf(e);-1!==K&&T.babylonMeshes.splice(K,1)}))),k(T.babylonMaterial),T.promise.then((()=>T.babylonMaterial))}_createDefaultMaterial(K,b){this._babylonScene._blockEntityCollection=!!this._assetContainer;const e=new r(K,this._babylonScene);return e._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,e.fillMode=b,e.enableSpecularAntiAliasing=!0,e.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,e.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,e.transparencyMode=r.PBRMATERIAL_OPAQUE,e.metallic=1,e.roughness=1,e}createMaterial(K,b,e){const z=this._extensionsCreateMaterial(K,b,e);if(z)return z;const k=b.name||`material${b.index}`;return this._createDefaultMaterial(k,e)}loadMaterialPropertiesAsync(K,b,e){const z=this._extensionsLoadMaterialPropertiesAsync(K,b,e);if(z)return z;const k=new Array;return k.push(this.loadMaterialBasePropertiesAsync(K,b,e)),b.pbrMetallicRoughness&&k.push(this._loadMaterialMetallicRoughnessPropertiesAsync(`${K}/pbrMetallicRoughness`,b.pbrMetallicRoughness,e)),this.loadMaterialAlphaProperties(K,b,e),Promise.all(k).then((()=>{}))}loadMaterialBasePropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;return e.emissiveColor=b.emissiveFactor?j.c.Bg(b.emissiveFactor):new j.c(0,0,0),b.doubleSided&&(e.Lg=!1,e.twoSidedLighting=!0),b.normalTexture&&(b.normalTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${K}/normalTexture`,b.normalTexture,(K=>{K.name=`${e.name} (Normal)`,e.bumpTexture=K}))),e.invertNormalMapX=!this._babylonScene.useRightHandedSystem,e.invertNormalMapY=this._babylonScene.useRightHandedSystem,void 0!=b.normalTexture.scale&&e.bumpTexture&&(e.bumpTexture.level=b.normalTexture.scale),e.forceIrradianceInFragment=!0),b.occlusionTexture&&(b.occlusionTexture.nonColorData=!0,z.push(this.loadTextureInfoAsync(`${K}/occlusionTexture`,b.occlusionTexture,(K=>{K.name=`${e.name} (Occlusion)`,e.ambientTexture=K}))),e.useAmbientInGrayScale=!0,void 0!=b.occlusionTexture.strength&&(e.ambientTextureStrength=b.occlusionTexture.strength)),b.emissiveTexture&&z.push(this.loadTextureInfoAsync(`${K}/emissiveTexture`,b.emissiveTexture,(K=>{K.name=`${e.name} (Emissive)`,e.emissiveTexture=K}))),Promise.all(z).then((()=>{}))}loadMaterialAlphaProperties(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);switch(b.alphaMode||"OPAQUE"){case"OPAQUE":e.transparencyMode=r.PBRMATERIAL_OPAQUE,e.alpha=1;break;case"MASK":e.transparencyMode=r.PBRMATERIAL_ALPHATEST,e.alphaCutOff=void 0==b.alphaCutoff?.5:b.alphaCutoff,e.albedoTexture&&(e.albedoTexture.ke=!0);break;case"BLEND":e.transparencyMode=r.PBRMATERIAL_ALPHABLEND,e.albedoTexture&&(e.albedoTexture.ke=!0,e.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(`${K}/alphaMode: Invalid value (${b.alphaMode})`)}}loadTextureInfoAsync(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureInfoAsync(K,b,e);if(z)return z;if(this.logOpen(`${K}`),b.texCoord>=6)throw new Error(`${K}/texCoord: Invalid value (${b.texCoord})`);const k=f.Get(`${K}/index`,this._gltf.textures,b.index);k._textureInfo=b;const j=this._loadTextureAsync(`/textures/${b.index}`,k,(z=>{z.coordinatesIndex=b.texCoord||0,V.AddPointerMetadata(z,K),this._parent.onTextureLoadedObservable.notifyObservers(z),e(z)}));return this.logClose(),j}_loadTextureAsync(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};const z=this._extensionsLoadTextureAsync(K,b,e);if(z)return z;this.logOpen(`${K} ${b.name||""}`);const k=void 0==b.sampler?V.DefaultSampler:f.Get(`${K}/sampler`,this._gltf.samplers,b.sampler),j=f.Get(`${K}/source`,this._gltf.images,b.source),T=this._createTextureAsync(K,k,j,e,void 0,!b._textureInfo.nonColorData);return this.logClose(),T}_createTextureAsync(K,b,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:()=>{},j=arguments.length>4?arguments[4]:void 0,T=arguments.length>5?arguments[5]:void 0;const F=this._loadSampler(`/samplers/${b.index}`,b),l=new Array,Y=new z;this._babylonScene._blockEntityCollection=!!this._assetContainer;const A={noMipmap:F.noMipMaps,invertY:!1,samplingMode:F.samplingMode,X:()=>{this._disposed||Y.resolve()},onError:(b,e)=>{this._disposed||Y.reject(new Error(`${K}: ${e&&e.message?e.message:b||"Failed to load texture"}`))},mimeType:e.mimeType,loaderOptions:j,useSRGBBuffer:!!T&&this._parent.useSRGBBuffers},X=new L.c(null,this._babylonScene,A);return X._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,l.push(Y.promise),l.push(this.loadImageAsync(`/images/${e.index}`,e).then((K=>{const b=e.uri||`${this._fileName}#image${e.index}`,z=`data:${this._uniqueRootUrl}${b}`;X.updateURL(z,K);const k=X.getInternalTexture();k&&(k.label=e.name)}))),X.wrapU=F.wrapU,X.wrapV=F.wrapV,k(X),this._parent.useGltfTextureNames&&(X.name=e.name||e.uri||`image${e.index}`),Promise.all(l).then((()=>X))}_loadSampler(K,b){return b._data||(b._data={noMipMaps:9728===b.minFilter||9729===b.minFilter,samplingMode:V._GetTextureSamplingMode(K,b),wrapU:V._GetTextureWrapMode(`${K}/wrapS`,b.wrapS),wrapV:V._GetTextureWrapMode(`${K}/wrapT`,b.wrapT)}),b._data}loadImageAsync(K,b){if(!b._data){if(this.logOpen(`${K} ${b.name||""}`),b.uri)b._data=this.loadUriAsync(`${K}/uri`,b,b.uri);else{const e=f.Get(`${K}/bufferView`,this._gltf.bufferViews,b.bufferView);b._data=this.loadBufferViewAsync(`/bufferViews/${e.index}`,e)}this.logClose()}return b._data}loadUriAsync(K,b,e){const z=this._extensionsLoadUriAsync(K,b,e);if(z)return z;if(!V._ValidateUri(e))throw new Error(`${K}: '${e}' is invalid`);if((0,O.k)(e)){const b=new Uint8Array((0,O.e)(e));return this.log(`${K}: Decoded ${e.substring(0,64)}... (${b.length} bytes)`),Promise.resolve(b)}return this.log(`${K}: Loading ${e}`),this._parent.preprocessUrlAsync(this._rootUrl+e).then((b=>new Promise(((z,k)=>{this._parent._loadFile(this._babylonScene,b,(b=>{this._disposed||(this.log(`${K}: Loaded ${e} (${b.byteLength} bytes)`),z(new Uint8Array(b)))}),!0,(b=>{k(new O.o(`${K}: Failed to load '${e}'${b?": "+b.status+" "+b.statusText:""}`,b))}))}))))}static AddPointerMetadata(K,b){K.metadata=K.metadata||{};const e=K._internalMetadata=K._internalMetadata||{},z=e.xi=e.xi||{};(z.pointers=z.pointers||[]).push(b)}static _GetTextureWrapMode(K,b){switch(b=void 0==b?10497:b){case 33071:return L.c.CLAMP_ADDRESSMODE;case 33648:return L.c.MIRROR_ADDRESSMODE;case 10497:return L.c.WRAP_ADDRESSMODE;default:return u.b.Warn(`${K}: Invalid value (${b})`),L.c.WRAP_ADDRESSMODE}}static _GetTextureSamplingMode(K,b){const e=void 0==b.magFilter?9729:b.magFilter,z=void 0==b.minFilter?9987:b.minFilter;if(9729===e)switch(z){case 9728:return L.c.LINEAR_NEAREST;case 9729:return L.c.LINEAR_LINEAR;case 9984:return L.c.LINEAR_NEAREST_MIPNEAREST;case 9985:return L.c.LINEAR_LINEAR_MIPNEAREST;case 9986:return L.c.LINEAR_NEAREST_MIPLINEAR;case 9987:return L.c.LINEAR_LINEAR_MIPLINEAR;default:return u.b.Warn(`${K}/minFilter: Invalid value (${z})`),L.c.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==e&&u.b.Warn(`${K}/magFilter: Invalid value (${e})`),z){case 9728:return L.c.NEAREST_NEAREST;case 9729:return L.c.NEAREST_LINEAR;case 9984:return L.c.NEAREST_NEAREST_MIPNEAREST;case 9985:return L.c.NEAREST_LINEAR_MIPNEAREST;case 9986:return L.c.NEAREST_NEAREST_MIPLINEAR;case 9987:return L.c.NEAREST_LINEAR_MIPLINEAR;default:return u.b.Warn(`${K}/minFilter: Invalid value (${z})`),L.c.NEAREST_NEAREST_MIPNEAREST}}static _GetTypedArrayConstructor(K,b){switch(b){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5125:return Uint32Array;case 5126:return Float32Array;default:throw new Error(`${K}: Invalid component type ${b}`)}}static _GetTypedArray(K,b,e,z,k){const j=e.buffer;z=e.byteOffset+(z||0);const T=V._GetTypedArrayConstructor(`${K}/componentType`,b),F=v.f.GetTypeByteLength(b);return z%F!==0?(u.b.Warn(`${K}: Copying buffer as byte offset (${z}) is not a multiple of component type byte length (${F})`),new T(j.slice(z,z+k*F),0)):new T(j,z,k)}static _GetNumComponents(K,b){switch(b){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(`${K}: Invalid type (${b})`)}static _ValidateUri(K){return T.f.IsBase64(K)||-1===K.indexOf("..")}static _GetDrawMode(K,b){switch(void 0==b&&(b=4),b){case 0:return I.b.PointListDrawMode;case 1:return I.b.LineListDrawMode;case 2:return I.b.LineLoopDrawMode;case 3:return I.b.LineStripDrawMode;case 4:return I.b.TriangleFillMode;case 5:return I.b.TriangleStripDrawMode;case 6:return I.b.TriangleFanDrawMode}throw new Error(`${K}: Invalid mesh primitive mode (${b})`)}_compileMaterialsAsync(){this._parent._startPerformanceCounter("Compile materials");const K=new Array;if(this._gltf.materials)for(const b of this._gltf.materials)if(b._data)for(const e in b._data){const z=b._data[e];for(const b of z.babylonMeshes){b.xj(!0);const e=z.babylonMaterial;K.push(e.forceCompilationAsync(b)),K.push(e.forceCompilationAsync(b,{useInstances:!0})),this._parent.useClipPlane&&(K.push(e.forceCompilationAsync(b,{clipPlane:!0})),K.push(e.forceCompilationAsync(b,{clipPlane:!0,useInstances:!0})))}}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile materials")}))}_compileShadowGeneratorsAsync(){this._parent._startPerformanceCounter("Compile shadow generators");const K=new Array,b=this._babylonScene.lights;for(const e of b){const b=e.getShadowGenerator();b&&K.push(b.forceCompilationAsync())}return Promise.all(K).then((()=>{this._parent._endPerformanceCounter("Compile shadow generators")}))}_forEachExtensions(K){for(const b of this._extensions)b.enabled&&K(b)}_applyExtensions(K,b,e){for(const z of this._extensions)if(z.enabled){const k=`${z.name}.${b}`,j=K;j._activeLoaderExtensionFunctions=j._activeLoaderExtensionFunctions||{};const T=j._activeLoaderExtensionFunctions;if(!T[k]){T[k]=!0;try{const K=e(z);if(K)return K}finally{delete T[k]}}}return null}_extensionsOnLoading(){this._forEachExtensions((K=>K.onLoading&&K.onLoading()))}_extensionsOnReady(){this._forEachExtensions((K=>K.onReady&&K.onReady()))}_extensionsLoadSceneAsync(K,b){return this._applyExtensions(b,"loadScene",(e=>e.loadSceneAsync&&e.loadSceneAsync(K,b)))}_extensionsLoadNodeAsync(K,b,e){return this._applyExtensions(b,"loadNode",(z=>z.loadNodeAsync&&z.loadNodeAsync(K,b,e)))}_extensionsLoadCameraAsync(K,b,e){return this._applyExtensions(b,"loadCamera",(z=>z.loadCameraAsync&&z.loadCameraAsync(K,b,e)))}_extensionsLoadVertexDataAsync(K,b,e){return this._applyExtensions(b,"loadVertexData",(z=>z._loadVertexDataAsync&&z._loadVertexDataAsync(K,b,e)))}_extensionsLoadMeshPrimitiveAsync(K,b,e,z,k,j){return this._applyExtensions(k,"loadMeshPrimitive",(T=>T._loadMeshPrimitiveAsync&&T._loadMeshPrimitiveAsync(K,b,e,z,k,j)))}_extensionsLoadMaterialAsync(K,b,e,z,k){return this._applyExtensions(b,"loadMaterial",(j=>j._loadMaterialAsync&&j._loadMaterialAsync(K,b,e,z,k)))}_extensionsCreateMaterial(K,b,e){return this._applyExtensions(b,"createMaterial",(z=>z.createMaterial&&z.createMaterial(K,b,e)))}_extensionsLoadMaterialPropertiesAsync(K,b,e){return this._applyExtensions(b,"loadMaterialProperties",(z=>z.loadMaterialPropertiesAsync&&z.loadMaterialPropertiesAsync(K,b,e)))}_extensionsLoadTextureInfoAsync(K,b,e){return this._applyExtensions(b,"loadTextureInfo",(z=>z.loadTextureInfoAsync&&z.loadTextureInfoAsync(K,b,e)))}_extensionsLoadTextureAsync(K,b,e){return this._applyExtensions(b,"loadTexture",(z=>z._loadTextureAsync&&z._loadTextureAsync(K,b,e)))}_extensionsLoadAnimationAsync(K,b){return this._applyExtensions(b,"loadAnimation",(e=>e.loadAnimationAsync&&e.loadAnimationAsync(K,b)))}_extensionsLoadAnimationChannelAsync(K,b,e,z,k){return this._applyExtensions(e,"loadAnimationChannel",(j=>j._loadAnimationChannelAsync&&j._loadAnimationChannelAsync(K,b,e,z,k)))}_extensionsLoadSkinAsync(K,b,e){return this._applyExtensions(e,"loadSkin",(z=>z._loadSkinAsync&&z._loadSkinAsync(K,b,e)))}_extensionsLoadUriAsync(K,b,e){return this._applyExtensions(b,"loadUri",(z=>z._loadUriAsync&&z._loadUriAsync(K,b,e)))}_extensionsLoadBufferViewAsync(K,b){return this._applyExtensions(b,"loadBufferView",(e=>e.loadBufferViewAsync&&e.loadBufferViewAsync(K,b)))}_extensionsLoadBufferAsync(K,b,e,z){return this._applyExtensions(b,"loadBuffer",(k=>k.loadBufferAsync&&k.loadBufferAsync(K,b,e,z)))}static LoadExtensionAsync(K,b,e,z){if(!b.extensions)return null;const k=b.extensions[e];return k?z(`${K}/extensions/${e}`,k):null}static LoadExtraAsync(K,b,e,z){if(!b.extras)return null;const k=b.extras[e];return k?z(`${K}/extras/${e}`,k):null}isExtensionUsed(K){return!!this._gltf.extensionsUsed&&-1!==this._gltf.extensionsUsed.indexOf(K)}logOpen(K){this._parent._logOpen(K)}logClose(){this._parent._logClose()}log(K){this._parent._log(K)}startPerformanceCounter(K){this._parent._startPerformanceCounter(K)}endPerformanceCounter(K){this._parent._endPerformanceCounter(K)}}V.DefaultSampler={index:-1},a.b._CreateGLTF2Loader=K=>new V(K);var q=e(11479),J=e(11959),KK=e(11974);class bK extends KK.d{constructor(K,b,e){let z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,j=arguments.length>5&&void 0!==arguments[5]&&arguments[5],T=arguments.length>6&&void 0!==arguments[6]&&arguments[6],F=arguments.length>7&&void 0!==arguments[7]?arguments[7]:3,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;super("",K),this._texture=K.getEngine().createRawCubeTexture(b,e,z,k,j,T,F,l)}update(K,b,e,z){let k=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;this._texture.getEngine().updateRawCubeTexture(this._texture,K,b,e,z,k)}updateRGBDAsync(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8,z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,J.o)(this._texture,K,b,e,z).then((()=>{}))}clone(){return M.e.Clone((()=>{const K=this.va(),b=this._texture,e=new bK(K,b._bufferViewArray,b.width,b.format,b.type,b.generateMipMaps,b.invertY,b.samplingMode,b._compression);return 13===b.source&&e.updateRGBDAsync(b._bufferViewArrayArray,b._sphericalPolynomial,b._lodGenerationScale,b._lodGenerationOffset),e}),this)}}const eK="EXT_lights_image_based";class zK{constructor(K){this.name=eK,this._loader=K,this.enabled=this._loader.isExtensionUsed(eK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.xi.extensions;if(K&&K[this.name]){const b=K[this.name];this._lights=b.lights}}loadSceneAsync(K,b){return V.LoadExtensionAsync(K,b,this.name,((e,z)=>{this._loader._allMaterialsDirtyRequired=!0;const k=new Array;k.push(this._loader.loadSceneAsync(K,b)),this._loader.logOpen(`${e}`);const j=f.Get(`${e}/light`,this._lights,z.eb);return k.push(this._loadLightAsync(`/extensions/${this.name}/lights/${z.eb}`,j).then((K=>{this._loader.babylonScene.environmentTexture=K}))),this._loader.logClose(),Promise.all(k).then((()=>{}))}))}_loadLightAsync(K,b){if(!b._loaded){const e=new Array;this._loader.logOpen(`${K}`);const z=new Array(b.specularImages.length);for(let k=0;k<b.specularImages.length;k++){const j=b.specularImages[k];z[k]=new Array(j.length);for(let b=0;b<j.length;b++){const T=`${K}/specularImages/${k}/${b}`;this._loader.logOpen(`${T}`);const F=j[b],l=f.Get(T,this._loader.xi.images,F);e.push(this._loader.loadImageAsync(`/images/${F}`,l).then((K=>{z[k][b]=K}))),this._loader.logClose()}}this._loader.logClose(),b._loaded=Promise.all(e).then((()=>{const e=new bK(this._loader.babylonScene,null,b.specularImageSize);if(e.name=b.name||"environment",b._babylonTexture=e,void 0!=b.Ji&&(e.level=b.Ji),b.rotation){let K=k.d.Bg(b.rotation);this._loader.babylonScene.useRightHandedSystem||(K=k.d.Inverse(K)),k.b.FromQuaternionToRef(K,e.getReflectionTextureMatrix())}if(!b.irradianceCoefficients)throw new Error(`${K}: Irradiance coefficients are missing`);const j=q.b.Bg(b.irradianceCoefficients);j.scaleInPlace(b.Ji),j.convertIrradianceToLambertianRadiance();const T=q.c.FromHarmonics(j),F=(z.length-1)/Math.log2(b.specularImageSize);return e.updateRGBDAsync(z,T,F)}))}return b._loaded.then((()=>b._babylonTexture))}}H(eK),C(eK,!0,(K=>new zK(K)));e(11977);const kK="EXT_mesh_gpu_instancing";class jK{constructor(K){this.name=kK,this._loader=K,this.enabled=this._loader.isExtensionUsed(kK)}dispose(){this._loader=null}loadNodeAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((K,z)=>{this._loader._disableInstancedMesh++;const j=this._loader.loadNodeAsync(`/nodes/${b.index}`,b,e);if(this._loader._disableInstancedMesh--,!b._primitiveBabylonMeshes)return j;const T=new Array;let F=0;const l=b=>{if(void 0==z.attributes[b])return void T.push(Promise.resolve(null));const e=f.Get(`${K}/attributes/${b}`,this._loader.xi.accessors,z.attributes[b]);if(T.push(this._loader._loadFloatAccessorAsync(`/accessors/${e.bufferView}`,e)),0===F)F=e.count;else if(F!==e.count)throw new Error(`${K}/attributes: Instance buffer accessors do not have the same count.`)};return l("TRANSLATION"),l("ROTATION"),l("SCALE"),j.then((K=>Promise.all(T).then((e=>{let[z,j,T]=e;const l=new Float32Array(16*F);k.e.gb[0].Yd(0,0,0),k.e.Quaternion[0].Yd(0,0,0,1),k.e.gb[1].Yd(1,1,1);for(let K=0;K<F;++K)z&&k.k.FromArrayToRef(z,3*K,k.e.gb[0]),j&&k.d.FromArrayToRef(j,4*K,k.e.Quaternion[0]),T&&k.k.FromArrayToRef(T,3*K,k.e.gb[1]),k.b.ComposeToRef(k.e.gb[1],k.e.Quaternion[0],k.e.gb[0],k.e.Matrix[0]),k.e.Matrix[0].copyToArray(l,16*K);for(const K of b._primitiveBabylonMeshes)K.Nb("matrix",l,16,!0);return K}))))}))}}H(kK),C(kK,!0,(K=>new jK(K)));class TK{static get Default(){return TK._Default||(TK._Default=new TK),TK._Default}constructor(){const K=TK.Configuration.decoder;this._decoderModulePromise=T.f.LoadBabylonScriptAsync(K.url).then((()=>MeshoptDecoder.ready))}dispose(){delete this._decoderModulePromise}decodeGltfBufferAsync(K,b,e,z,k){return this._decoderModulePromise.then((async()=>{MeshoptDecoder.useWorkers(1);const j=await MeshoptDecoder.decodeGltfBufferAsync(b,e,K,z,k);return MeshoptDecoder.useWorkers(0),j}))}}TK.Configuration={decoder:{url:`${T.f._DefaultCdnUrl}/meshopt_decoder.js`}},TK._Default=null;const FK="EXT_meshopt_compression";class lK{constructor(K){this.name=FK,this.enabled=K.isExtensionUsed(FK),this._loader=K}dispose(){this._loader=null}loadBufferViewAsync(K,b){return V.LoadExtensionAsync(K,b,this.name,((e,z)=>{const k=b;if(k._meshOptData)return k._meshOptData;const j=f.Get(`${K}/buffer`,this._loader.xi.buffers,z.buffer);return k._meshOptData=this._loader.loadBufferAsync(`/buffers/${j.index}`,j,z.byteOffset||0,z.byteLength).then((K=>TK.Default.decodeGltfBufferAsync(K,z.count,z.byteStride,z.mode,z.filter))),k._meshOptData}))}}H(FK),C(FK,!0,(K=>new lK(K)));const YK="EXT_texture_webp";class AK{constructor(K){this.name=YK,this._loader=K,this.enabled=K.isExtensionUsed(YK)}dispose(){this._loader=null}_loadTextureAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=void 0==b.sampler?V.DefaultSampler:f.Get(`${K}/sampler`,this._loader.xi.samplers,b.sampler),T=f.Get(`${z}/source`,this._loader.xi.images,k.source);return this._loader._createTextureAsync(K,j,T,(K=>{e(K)}),void 0,!b._textureInfo.nonColorData)}))}}H(YK),C(YK,!0,(K=>new AK(K)));const XK="EXT_texture_avif";class tK{constructor(K){this.name=XK,this._loader=K,this.enabled=K.isExtensionUsed(XK)}dispose(){this._loader=null}_loadTextureAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=void 0==b.sampler?V.DefaultSampler:f.Get(`${K}/sampler`,this._loader.xi.samplers,b.sampler),T=f.Get(`${z}/source`,this._loader.xi.images,k.source);return this._loader._createTextureAsync(K,j,T,(K=>{e(K)}),void 0,!b._textureInfo.nonColorData)}))}}H(XK),C(XK,!0,(K=>new tK(K)));var UK=e(11983);const BK="KHR_draco_mesh_compression";class uK{constructor(K){this.name=BK,this.useNormalizedFlagFromAccessor=!0,this._loader=K,this.enabled=UK.d.DecoderAvailable&&this._loader.isExtensionUsed(BK)}dispose(){delete this.dracoCompression,this._loader=null}_loadVertexDataAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{if(void 0!=b.mode&&4!==b.mode&&5!==b.mode)throw new Error(`${K}: Unsupported mode ${b.mode}`);const j={},T={},F=(K,z)=>{const F=k.attributes[K];if(void 0!=F&&(e._delayInfo=e._delayInfo||[],-1===e._delayInfo.indexOf(z)&&e._delayInfo.push(z),j[z]=F,this.useNormalizedFlagFromAccessor)){const e=f.TryGet(this._loader.xi.accessors,b.attributes[K]);e&&(T[z]=e.normalized||!1)}};F("POSITION",v.f.PositionKind),F("NORMAL",v.f.NormalKind),F("TANGENT",v.f.TangentKind),F("TEXCOORD_0",v.f.UVKind),F("TEXCOORD_1",v.f.UV2Kind),F("TEXCOORD_2",v.f.UV3Kind),F("TEXCOORD_3",v.f.UV4Kind),F("TEXCOORD_4",v.f.UV5Kind),F("TEXCOORD_5",v.f.UV6Kind),F("JOINTS_0",v.f.MatricesIndicesKind),F("WEIGHTS_0",v.f.MatricesWeightsKind),F("COLOR_0",v.f.ColorKind);const l=f.Get(z,this._loader.xi.bufferViews,k.bufferView);return l._dracoBabylonGeometry||(l._dracoBabylonGeometry=this._loader.loadBufferViewAsync(`/bufferViews/${l.index}`,l).then((b=>(this.dracoCompression||UK.d.Default)._decodeMeshToGeometryForGltfAsync(e.name,this._loader.babylonScene,b,j,T).catch((b=>{throw new Error(`${K}: ${b.message}`)}))))),l._dracoBabylonGeometry}))}}H(BK),C(BK,!0,(K=>new uK(K)));var mK=e(11994),DK=e(11243),IK=e(11942),xK=e(11997);DK.e.AddNodeConstructor("Light_Type_0",((K,b)=>()=>new QK(K,k.k.Zero(),b)));class QK extends xK.e{get shadowAngle(){return this._shadowAngle}set shadowAngle(K){this._shadowAngle=K,this.forceProjectionMatrixCompute()}get direction(){return this._direction}set direction(K){const b=this.needCube();if(this._direction=K,this.needCube()!==b&&this._shadowGenerators){const K=this._shadowGenerators.values();for(let b=K.next();!0!==b.done;b=K.next()){b.value.recreateShadowMap()}}}constructor(K,b,e){super(K,e),this._shadowAngle=Math.PI/2,this.position=b}getClassName(){return"PointLight"}getTypeID(){return IK.b.LIGHTTYPEID_POINTLIGHT}needCube(){return!this.direction}getShadowDirection(K){if(this.direction)return super.getShadowDirection(K);switch(K){case 0:return new k.k(1,0,0);case 1:return new k.k(-1,0,0);case 2:return new k.k(0,-1,0);case 3:return new k.k(0,1,0);case 4:return new k.k(0,0,1);case 5:return new k.k(0,0,-1)}return k.k.Zero()}_setDefaultShadowProjectionMatrix(K,b,e){const z=this.va().activeCamera;if(!z)return;const j=void 0!==this.shadowMinZ?this.shadowMinZ:z.Fi,T=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,F=this.va().getEngine().useReverseDepthBuffer;k.b.PerspectiveFovLHToRef(this.shadowAngle,1,F?T:j,F?j:T,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,F)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}transferToEffect(K,b){return this.computeTransformedInformation()?this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,0,b):this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,0,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,0,0,b),this}transferToNodeMaterialEffect(K,b){return this.computeTransformedInformation()?K.setFloat3(b,this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z):K.setFloat3(b,this.position.x,this.position.y,this.position.z),this}prepareLightSpecificDefines(K,b){K["POINTLIGHT"+b]=!0}}(0,x.b)([(0,Q.M)()],QK.prototype,"shadowAngle",null),(0,S.e)("BABYLON.PointLight",QK),DK.e.AddNodeConstructor("Light_Type_2",((K,b)=>()=>new GK(K,k.k.Zero(),k.k.Zero(),0,0,b)));class GK extends xK.e{get angle(){return this._angle}set angle(K){this._angle=K,this._cosHalfAngle=Math.cos(.5*K),this._projectionTextureProjectionLightDirty=!0,this.forceProjectionMatrixCompute(),this._computeAngleValues()}get innerAngle(){return this._innerAngle}set innerAngle(K){this._innerAngle=K,this._computeAngleValues()}get shadowAngleScale(){return this._shadowAngleScale}set shadowAngleScale(K){this._shadowAngleScale=K,this.forceProjectionMatrixCompute()}get projectionTextureMatrix(){return this._projectionTextureMatrix}get projectionTextureLightNear(){return this._projectionTextureLightNear}set projectionTextureLightNear(K){this._projectionTextureLightNear=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureLightFar(){return this._projectionTextureLightFar}set projectionTextureLightFar(K){this._projectionTextureLightFar=K,this._projectionTextureProjectionLightDirty=!0}get projectionTextureUpDirection(){return this._projectionTextureUpDirection}set projectionTextureUpDirection(K){this._projectionTextureUpDirection=K,this._projectionTextureProjectionLightDirty=!0}get projectionTexture(){return this._projectionTexture}set projectionTexture(K){this._projectionTexture!==K&&(this._projectionTexture=K,this._projectionTextureDirty=!0,this._projectionTexture&&!this._projectionTexture.isReady()&&(GK._IsProceduralTexture(this._projectionTexture)?this._projectionTexture.getEffect().executeWhenCompiled((()=>{this._markMeshesAsLightDirty()})):GK._IsTexture(this._projectionTexture)&&this._projectionTexture.onLoadObservable.addOnce((()=>{this._markMeshesAsLightDirty()}))))}static _IsProceduralTexture(K){return void 0!==K.onGeneratedObservable}static _IsTexture(K){return void 0!==K.onLoadObservable}get projectionTextureProjectionLightMatrix(){return this._projectionTextureProjectionLightMatrix}set projectionTextureProjectionLightMatrix(K){this._projectionTextureProjectionLightMatrix=K,this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0}constructor(K,b,e,z,j,T){super(K,T),this._innerAngle=0,this._projectionTextureMatrix=k.b.Zero(),this._projectionTextureLightNear=1e-6,this._projectionTextureLightFar=1e3,this._projectionTextureUpDirection=k.k.Up(),this._projectionTextureViewLightDirty=!0,this._projectionTextureProjectionLightDirty=!0,this._projectionTextureDirty=!0,this._projectionTextureViewTargetVector=k.k.Zero(),this._projectionTextureViewLightMatrix=k.b.Zero(),this._projectionTextureProjectionLightMatrix=k.b.Zero(),this._projectionTextureScalingMatrix=k.b.FromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1),this.position=b,this.direction=e,this.angle=z,this.exponent=j}getClassName(){return"SpotLight"}getTypeID(){return IK.b.LIGHTTYPEID_SPOTLIGHT}_setDirection(K){super._setDirection(K),this._projectionTextureViewLightDirty=!0}_setPosition(K){super._setPosition(K),this._projectionTextureViewLightDirty=!0}_setDefaultShadowProjectionMatrix(K,b,e){const z=this.va().activeCamera;if(!z)return;this._shadowAngleScale=this._shadowAngleScale||1;const j=this._shadowAngleScale*this._angle,T=void 0!==this.shadowMinZ?this.shadowMinZ:z.Fi,F=void 0!==this.shadowMaxZ?this.shadowMaxZ:z.maxZ,l=this.va().getEngine().useReverseDepthBuffer;k.b.PerspectiveFovLHToRef(j,1,l?F:T,l?T:F,K,!0,this._scene.getEngine().isNDCHalfZRange,void 0,l)}_computeProjectionTextureViewLightMatrix(){this._projectionTextureViewLightDirty=!1,this._projectionTextureDirty=!0,this.getAbsolutePosition().addToRef(this.getShadowDirection(),this._projectionTextureViewTargetVector),k.b.LookAtLHToRef(this.getAbsolutePosition(),this._projectionTextureViewTargetVector,this._projectionTextureUpDirection,this._projectionTextureViewLightMatrix)}_computeProjectionTextureProjectionLightMatrix(){this._projectionTextureProjectionLightDirty=!1,this._projectionTextureDirty=!0;const K=this.projectionTextureLightFar,b=this.projectionTextureLightNear,e=K/(K-b),z=-e*b,j=1/Math.tan(this._angle/2);k.b.FromValuesToRef(j/1,0,0,0,0,j,0,0,0,0,e,1,0,0,z,0,this._projectionTextureProjectionLightMatrix)}_computeProjectionTextureMatrix(){if(this._projectionTextureDirty=!1,this._projectionTextureViewLightMatrix.multiplyToRef(this._projectionTextureProjectionLightMatrix,this._projectionTextureMatrix),this._projectionTexture instanceof L.c){const K=this._projectionTexture.uScale/2,b=this._projectionTexture.vScale/2;k.b.FromValuesToRef(K,0,0,0,0,b,0,0,0,0,.5,0,.5,.5,.5,1,this._projectionTextureScalingMatrix)}this._projectionTextureMatrix.multiplyToRef(this._projectionTextureScalingMatrix,this._projectionTextureMatrix)}_buildUniformLayout(){this._uniformBuffer.addUniform("vLightData",4),this._uniformBuffer.addUniform("vLightDiffuse",4),this._uniformBuffer.addUniform("vLightSpecular",4),this._uniformBuffer.addUniform("vLightDirection",3),this._uniformBuffer.addUniform("vLightFalloff",4),this._uniformBuffer.addUniform("shadowsInfo",3),this._uniformBuffer.addUniform("depthValues",2),this._uniformBuffer.create()}_computeAngleValues(){this._lightAngleScale=1/Math.max(.001,Math.cos(.5*this._innerAngle)-this._cosHalfAngle),this._lightAngleOffset=-this._cosHalfAngle*this._lightAngleScale}transferTexturesToEffect(K,b){return this.projectionTexture&&this.projectionTexture.isReady()&&(this._projectionTextureViewLightDirty&&this._computeProjectionTextureViewLightMatrix(),this._projectionTextureProjectionLightDirty&&this._computeProjectionTextureProjectionLightMatrix(),this._projectionTextureDirty&&this._computeProjectionTextureMatrix(),K.setMatrix("textureProjectionMatrix"+b,this._projectionTextureMatrix),K.setTexture("projectionLightTexture"+b,this.projectionTexture)),this}transferToEffect(K,b){let e;return this.computeTransformedInformation()?(this._uniformBuffer.updateFloat4("vLightData",this.transformedPosition.x,this.transformedPosition.y,this.transformedPosition.z,this.exponent,b),e=k.k.Normalize(this.transformedDirection)):(this._uniformBuffer.updateFloat4("vLightData",this.position.x,this.position.y,this.position.z,this.exponent,b),e=k.k.Normalize(this.direction)),this._uniformBuffer.updateFloat4("vLightDirection",e.x,e.y,e.z,this._cosHalfAngle,b),this._uniformBuffer.updateFloat4("vLightFalloff",this.range,this._inverseSquaredRange,this._lightAngleScale,this._lightAngleOffset,b),this}transferToNodeMaterialEffect(K,b){let e;return e=this.computeTransformedInformation()?k.k.Normalize(this.transformedDirection):k.k.Normalize(this.direction),this.va().useRightHandedSystem?K.setFloat3(b,-e.x,-e.y,-e.z):K.setFloat3(b,e.x,e.y,e.z),this}dispose(){super.dispose(),this._projectionTexture&&this._projectionTexture.dispose()}getDepthMinZ(K){const b=this._scene.getEngine(),e=void 0!==this.shadowMinZ?this.shadowMinZ:K.Fi;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?e:this._scene.getEngine().isNDCHalfZRange?0:e}getDepthMaxZ(K){const b=this._scene.getEngine(),e=void 0!==this.shadowMaxZ?this.shadowMaxZ:K.maxZ;return b.useReverseDepthBuffer&&b.isNDCHalfZRange?0:e}prepareLightSpecificDefines(K,b){K["SPOTLIGHT"+b]=!0,K["PROJECTEDLIGHTTEXTURE"+b]=!(!this.projectionTexture||!this.projectionTexture.isReady())}}(0,x.b)([(0,Q.M)()],GK.prototype,"angle",null),(0,x.b)([(0,Q.M)()],GK.prototype,"innerAngle",null),(0,x.b)([(0,Q.M)()],GK.prototype,"shadowAngleScale",null),(0,x.b)([(0,Q.M)()],GK.prototype,"exponent",void 0),(0,x.b)([(0,Q.M)()],GK.prototype,"projectionTextureLightNear",null),(0,x.b)([(0,Q.M)()],GK.prototype,"projectionTextureLightFar",null),(0,x.b)([(0,Q.M)()],GK.prototype,"projectionTextureUpDirection",null),(0,x.b)([(0,Q.E)("projectedLightTexture")],GK.prototype,"_projectionTexture",void 0),(0,S.e)("BABYLON.SpotLight",GK);const iK="KHR_lights_punctual";class SK{constructor(K){this.name=iK,this._loader=K,this.enabled=this._loader.isExtensionUsed(iK)}dispose(){this._loader=null,delete this._lights}onLoading(){const K=this._loader.xi.extensions;if(K&&K[this.name]){const b=K[this.name];this._lights=b.lights,f.Assign(this._lights)}}loadNodeAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,T)=>(this._loader._allMaterialsDirtyRequired=!0,this._loader.loadNodeAsync(K,b,(K=>{let b;const F=f.Get(z,this._lights,T.eb),l=F.name||K.name;switch(this._loader.babylonScene._blockEntityCollection=!!this._loader._assetContainer,F.type){case"directional":{const K=new mK.d(l,k.k.Backward(),this._loader.babylonScene);K.position.Wd(0),b=K;break}case"point":b=new QK(l,k.k.Zero(),this._loader.babylonScene);break;case"spot":{const K=new GK(l,k.k.Zero(),k.k.Backward(),0,1,this._loader.babylonScene);K.angle=2*(F.spot&&F.spot.outerConeAngle||Math.PI/4),K.innerAngle=2*(F.spot&&F.spot.innerConeAngle||0),b=K;break}default:throw this._loader.babylonScene._blockEntityCollection=!1,new Error(`${z}: Invalid light type (${F.type})`)}b._parentContainer=this._loader._assetContainer,this._loader.babylonScene._blockEntityCollection=!1,F._babylonLight=b,b.falloffType=IK.b.FALLOFF_GLTF,b._g=F.color?j.c.Bg(F.color):j.c.White(),b.Ji=void 0==F.Ji?1:F.Ji,b.range=void 0==F.range?Number.MAX_VALUE:F.range,b.parent=K,this._loader._babylonLights.push(b),V.AddPointerMetadata(b,z),e(K)})))))}}H(iK),C(iK,!0,(K=>new SK(K)));const MK="KHR_materials_pbrSpecularGlossiness";class rK{constructor(K){this.name=MK,this.order=200,this._loader=K,this.enabled=this._loader.isExtensionUsed(MK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialBasePropertiesAsync(K,b,e)),j.push(this._loadSpecularGlossinessPropertiesAsync(z,k,e)),this._loader.loadMaterialAlphaProperties(K,b,e),Promise.all(j).then((()=>{}))}))}_loadSpecularGlossinessPropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;return e.metallic=null,e.roughness=null,b.diffuseFactor?(e.albedoColor=j.c.Bg(b.diffuseFactor),e.alpha=b.diffuseFactor[3]):e.albedoColor=j.c.White(),e.reflectivityColor=b.specularFactor?j.c.Bg(b.specularFactor):j.c.White(),e.microSurface=void 0==b.glossinessFactor?1:b.glossinessFactor,b.diffuseTexture&&z.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTexture`,b.diffuseTexture,(K=>{K.name=`${e.name} (Diffuse)`,e.albedoTexture=K}))),b.specularGlossinessTexture&&(z.push(this._loader.loadTextureInfoAsync(`${K}/specularGlossinessTexture`,b.specularGlossinessTexture,(K=>{K.name=`${e.name} (Specular Glossiness)`,e.reflectivityTexture=K,e.reflectivityTexture.ke=!0}))),e.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(z).then((()=>{}))}}H(MK),C(MK,!0,(K=>new rK(K)));const LK="KHR_materials_unlit";class cK{constructor(K){this.name=LK,this.order=210,this._loader=K,this.enabled=this._loader.isExtensionUsed(LK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,(()=>this._loadUnlitPropertiesAsync(K,b,e)))}_loadUnlitPropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;e.unlit=!0;const k=b.pbrMetallicRoughness;return k&&(k.baseColorFactor?(e.albedoColor=j.c.Bg(k.baseColorFactor),e.alpha=k.baseColorFactor[3]):e.albedoColor=j.c.White(),k.baseColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${K}/baseColorTexture`,k.baseColorTexture,(K=>{K.name=`${e.name} (Base Color)`,e.albedoTexture=K})))),b.doubleSided&&(e.Lg=!1,e.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(K,b,e),Promise.all(z).then((()=>{}))}}H(LK),C(LK,!0,(K=>new cK(K)));const vK="KHR_materials_clearcoat";class wK{constructor(K){this.name=vK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(vK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadClearCoatPropertiesAsync(z,k,e)),Promise.all(j).then((()=>{}))}))}_loadClearCoatPropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;return e.clearCoat.isEnabled=!0,e.clearCoat.useRoughnessFromMainTexture=!1,e.clearCoat.remapF0OnInterfaceChange=!1,void 0!=b.clearcoatFactor?e.clearCoat.Ji=b.clearcoatFactor:e.clearCoat.Ji=0,b.clearcoatTexture&&z.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatTexture`,b.clearcoatTexture,(K=>{K.name=`${e.name} (ClearCoat)`,e.clearCoat.texture=K}))),void 0!=b.clearcoatRoughnessFactor?e.clearCoat.roughness=b.clearcoatRoughnessFactor:e.clearCoat.roughness=0,b.clearcoatRoughnessTexture&&(b.clearcoatRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatRoughnessTexture`,b.clearcoatRoughnessTexture,(K=>{K.name=`${e.name} (ClearCoat Roughness)`,e.clearCoat.textureRoughness=K})))),b.clearcoatNormalTexture&&(b.clearcoatNormalTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${K}/clearcoatNormalTexture`,b.clearcoatNormalTexture,(K=>{K.name=`${e.name} (ClearCoat Normal)`,e.clearCoat.bumpTexture=K}))),e.invertNormalMapX=!e.va().useRightHandedSystem,e.invertNormalMapY=e.va().useRightHandedSystem,void 0!=b.clearcoatNormalTexture.scale&&(e.clearCoat.bumpTexture.level=b.clearcoatNormalTexture.scale)),Promise.all(z).then((()=>{}))}}H(vK),C(vK,!0,(K=>new wK(K)));const hK="KHR_materials_iridescence";class RK{constructor(K){this.name=hK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(hK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadIridescencePropertiesAsync(z,k,e)),Promise.all(j).then((()=>{}))}))}_loadIridescencePropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;return e.iridescence.isEnabled=!0,e.iridescence.Ji=b.iridescenceFactor??0,e.iridescence.indexOfRefraction=b.iridescenceIor??b.iridescenceIOR??1.3,e.iridescence.minimumThickness=b.iridescenceThicknessMinimum??100,e.iridescence.maximumThickness=b.iridescenceThicknessMaximum??400,b.iridescenceTexture&&z.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceTexture`,b.iridescenceTexture,(K=>{K.name=`${e.name} (Iridescence)`,e.iridescence.texture=K}))),b.iridescenceThicknessTexture&&z.push(this._loader.loadTextureInfoAsync(`${K}/iridescenceThicknessTexture`,b.iridescenceThicknessTexture,(K=>{K.name=`${e.name} (Iridescence Thickness)`,e.iridescence.thicknessTexture=K}))),Promise.all(z).then((()=>{}))}}H(hK),C(hK,!0,(K=>new RK(K)));const nK="KHR_materials_anisotropy";class PK{constructor(K){this.name=nK,this.order=195,this._loader=K,this.enabled=this._loader.isExtensionUsed(nK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadIridescencePropertiesAsync(z,k,e)),Promise.all(j).then((()=>{}))}))}_loadIridescencePropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;return e.anisotropy.isEnabled=!0,e.anisotropy.Ji=b.anisotropyStrength??0,e.anisotropy.angle=b.anisotropyRotation??0,b.anisotropyTexture&&(b.anisotropyTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${K}/anisotropyTexture`,b.anisotropyTexture,(K=>{K.name=`${e.name} (Anisotropy Intensity)`,e.anisotropy.texture=K})))),Promise.all(z).then((()=>{}))}}H(nK),C(nK,!0,(K=>new PK(K)));const dK="KHR_materials_emissive_strength";class pK{constructor(K){this.name=dK,this.order=170,this._loader=K,this.enabled=this._loader.isExtensionUsed(dK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>this._loader.loadMaterialPropertiesAsync(K,b,e).then((()=>{this._loadEmissiveProperties(z,k,e)}))))}_loadEmissiveProperties(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);void 0!==b.emissiveStrength&&(e.emissiveIntensity=b.emissiveStrength)}}H(dK),C(dK,!0,(K=>new pK(K)));const aK="KHR_materials_sheen";class OK{constructor(K){this.name=aK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(aK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadSheenPropertiesAsync(z,k,e)),Promise.all(j).then((()=>{}))}))}_loadSheenPropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;return e.sheen.isEnabled=!0,e.sheen.Ji=1,void 0!=b.sheenColorFactor?e.sheen.color=j.c.Bg(b.sheenColorFactor):e.sheen.color=j.c.Black(),b.sheenColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${K}/sheenColorTexture`,b.sheenColorTexture,(K=>{K.name=`${e.name} (Sheen Color)`,e.sheen.texture=K}))),void 0!==b.sheenRoughnessFactor?e.sheen.roughness=b.sheenRoughnessFactor:e.sheen.roughness=0,b.sheenRoughnessTexture&&(b.sheenRoughnessTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${K}/sheenRoughnessTexture`,b.sheenRoughnessTexture,(K=>{K.name=`${e.name} (Sheen Roughness)`,e.sheen.textureRoughness=K})))),e.sheen.albedoScaling=!0,e.sheen.useRoughnessFromMainTexture=!1,Promise.all(z).then((()=>{}))}}H(aK),C(aK,!0,(K=>new OK(K)));const gK="KHR_materials_specular";class NK{constructor(K){this.name=gK,this.order=190,this._loader=K,this.enabled=this._loader.isExtensionUsed(gK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadSpecularPropertiesAsync(z,k,e)),Promise.all(j).then((()=>{}))}))}_loadSpecularPropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const z=new Array;return void 0!==b.specularFactor&&(e.metallicF0Factor=b.specularFactor),void 0!==b.specularColorFactor&&(e.metallicReflectanceColor=j.c.Bg(b.specularColorFactor)),b.specularTexture&&(b.specularTexture.nonColorData=!0,z.push(this._loader.loadTextureInfoAsync(`${K}/specularTexture`,b.specularTexture,(K=>{K.name=`${e.name} (Specular)`,e.metallicReflectanceTexture=K,e.useOnlyMetallicFromMetallicReflectanceTexture=!0})))),b.specularColorTexture&&z.push(this._loader.loadTextureInfoAsync(`${K}/specularColorTexture`,b.specularColorTexture,(K=>{K.name=`${e.name} (Specular Color)`,e.reflectanceTexture=K}))),Promise.all(z).then((()=>{}))}}H(gK),C(gK,!0,(K=>new NK(K)));const ZK="KHR_materials_ior";class yK{constructor(K){this.name=ZK,this.order=180,this._loader=K,this.enabled=this._loader.isExtensionUsed(ZK)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadIorPropertiesAsync(z,k,e)),Promise.all(j).then((()=>{}))}))}_loadIorPropertiesAsync(K,b,e){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);return void 0!==b.ior?e.indexOfRefraction=b.ior:e.indexOfRefraction=yK._DEFAULT_IOR,Promise.resolve()}}yK._DEFAULT_IOR=1.5,H(ZK),C(ZK,!0,(K=>new yK(K)));const sK="KHR_materials_variants";class EK{constructor(K){this.name=sK,this._loader=K,this.enabled=this._loader.isExtensionUsed(sK)}dispose(){this._loader=null}static GetAvailableVariants(K){const b=this._GetExtensionMetadata(K);return b?Object.keys(b.variants):[]}getAvailableVariants(K){return EK.GetAvailableVariants(K)}static SelectVariant(K,b){const e=this._GetExtensionMetadata(K);if(!e)throw new Error(`Cannot select variant on a glTF mesh that does not have the ${sK} extension`);const z=K=>{const b=e.variants[K];if(b)for(const e of b)e.mesh.material=e.material};if(b instanceof Array)for(const k of b)z(k);else z(b);e.lastSelected=b}selectVariant(K,b){EK.SelectVariant(K,b)}static Reset(K){const b=this._GetExtensionMetadata(K);if(!b)throw new Error(`Cannot reset on a glTF mesh that does not have the ${sK} extension`);for(const e of b.original)e.mesh.material=e.material;b.lastSelected=null}reset(K){EK.Reset(K)}static GetLastSelectedVariant(K){const b=this._GetExtensionMetadata(K);if(!b)throw new Error(`Cannot get the last selected variant on a glTF mesh that does not have the ${sK} extension`);return b.lastSelected}getLastSelectedVariant(K){return EK.GetLastSelectedVariant(K)}static _GetExtensionMetadata(K){var b,e;return(null===K||void 0===K||null===(b=K._internalMetadata)||void 0===b||null===(e=b.xi)||void 0===e?void 0:e[sK])||null}onLoading(){const K=this._loader.xi.extensions;if(K&&K[this.name]){const b=K[this.name];this._variants=b.variants}}_loadMeshPrimitiveAsync(K,b,e,z,k,j){return V.LoadExtensionAsync(K,k,this.name,((T,F)=>{const l=new Array;return l.push(this._loader._loadMeshPrimitiveAsync(K,b,e,z,k,(b=>{if(j(b),b instanceof R.b){const e=V._GetDrawMode(K,k.mode),z=this._loader.rootBabylonMesh,j=z?z._internalMetadata=z._internalMetadata||{}:{},Y=j.xi=j.xi||{},A=Y[sK]=Y[sK]||{lastSelected:null,original:[],variants:{}};A.original.push({mesh:b,material:b.material});for(let K=0;K<F.mappings.length;++K){const k=F.mappings[K],j=f.Get(`${T}/mappings/${K}/material`,this._loader.xi.materials,k.material);l.push(this._loader._loadMaterialAsync(`#/materials/${k.material}`,j,b,e,(K=>{for(let e=0;e<k.variants.length;++e){const j=k.variants[e],T=f.Get(`/extensions/${sK}/variants/${j}`,this._variants,j);A.variants[T.name]=A.variants[T.name]||[],A.variants[T.name].push({mesh:b,material:K}),b.onClonedObservable.add((K=>{const e=K;let k=null,j=e;do{if(j=j.parent,!j)return;k=EK._GetExtensionMetadata(j)}while(null===k);if(z&&k===EK._GetExtensionMetadata(z)){j._internalMetadata={};for(const K in z._internalMetadata)j._internalMetadata[K]=z._internalMetadata[K];j._internalMetadata.xi=[];for(const K in z._internalMetadata.xi)j._internalMetadata.xi[K]=z._internalMetadata.xi[K];j._internalMetadata.xi[sK]={lastSelected:null,original:[],variants:{}};for(const K of k.original)j._internalMetadata.xi[sK].original.push({mesh:K.mesh,material:K.material});for(const K in k.variants)if(Object.prototype.hasOwnProperty.call(k.variants,K)){j._internalMetadata.xi[sK].variants[K]=[];for(const b of k.variants[K])j._internalMetadata.xi[sK].variants[K].push({mesh:b.mesh,material:b.material})}k=j._internalMetadata.xi[sK]}for(const z of k.original)z.mesh===b&&(z.mesh=e);for(const z of k.variants[T.name])z.mesh===b&&(z.mesh=e)}))}})))}}}))),Promise.all(l).then((K=>{let[b]=K;return b}))}))}}H(sK),C(sK,!0,(K=>new EK(K)));var oK=e(11514);class CK{}CK.AUTOSAMPLERSUFFIX="Sampler",CK.DISABLEUA="#define DISABLE_UNIFORMITY_ANALYSIS",CK.ALPHA_DISABLE=0,CK.ALPHA_ADD=1,CK.ALPHA_COMBINE=2,CK.ALPHA_SUBTRACT=3,CK.ALPHA_MULTIPLY=4,CK.ALPHA_MAXIMIZED=5,CK.ALPHA_ONEONE=6,CK.ALPHA_PREMULTIPLIED=7,CK.ALPHA_PREMULTIPLIED_PORTERDUFF=8,CK.ALPHA_INTERPOLATE=9,CK.ALPHA_SCREENMODE=10,CK.ALPHA_ONEONE_ONEONE=11,CK.ALPHA_ALPHATOCOLOR=12,CK.ALPHA_REVERSEONEMINUS=13,CK.ALPHA_SRC_DSTONEMINUSSRCALPHA=14,CK.ALPHA_ONEONE_ONEZERO=15,CK.ALPHA_EXCLUSION=16,CK.ALPHA_LAYER_ACCUMULATE=17,CK.ALPHA_EQUATION_ADD=0,CK.ALPHA_EQUATION_SUBSTRACT=1,CK.ALPHA_EQUATION_REVERSE_SUBTRACT=2,CK.ALPHA_EQUATION_MAX=3,CK.ALPHA_EQUATION_MIN=4,CK.ALPHA_EQUATION_DARKEN=5,CK.DELAYLOADSTATE_NONE=0,CK.DELAYLOADSTATE_LOADED=1,CK.DELAYLOADSTATE_LOADING=2,CK.DELAYLOADSTATE_NOTLOADED=4,CK.NEVER=512,CK.ALWAYS=519,CK.LESS=513,CK.EQUAL=514,CK.LEQUAL=515,CK.GREATER=516,CK.GEQUAL=518,CK.NOTEQUAL=517,CK.KEEP=7680,CK.ZERO=0,CK.REPLACE=7681,CK.INCR=7682,CK.DECR=7683,CK.INVERT=5386,CK.INCR_WRAP=34055,CK.DECR_WRAP=34056,CK.TEXTURE_CLAMP_ADDRESSMODE=0,CK.TEXTURE_WRAP_ADDRESSMODE=1,CK.TEXTURE_MIRROR_ADDRESSMODE=2,CK.TEXTURE_CREATIONFLAG_STORAGE=1,CK.TEXTUREFORMAT_ALPHA=0,CK.TEXTUREFORMAT_LUMINANCE=1,CK.TEXTUREFORMAT_LUMINANCE_ALPHA=2,CK.TEXTUREFORMAT_RGB=4,CK.TEXTUREFORMAT_RGBA=5,CK.TEXTUREFORMAT_RED=6,CK.TEXTUREFORMAT_R=6,CK.TEXTUREFORMAT_RG=7,CK.TEXTUREFORMAT_RED_INTEGER=8,CK.TEXTUREFORMAT_R_INTEGER=8,CK.TEXTUREFORMAT_RG_INTEGER=9,CK.TEXTUREFORMAT_RGB_INTEGER=10,CK.TEXTUREFORMAT_RGBA_INTEGER=11,CK.TEXTUREFORMAT_BGRA=12,CK.TEXTUREFORMAT_DEPTH24_STENCIL8=13,CK.TEXTUREFORMAT_DEPTH32_FLOAT=14,CK.TEXTUREFORMAT_DEPTH16=15,CK.TEXTUREFORMAT_DEPTH24=16,CK.TEXTUREFORMAT_DEPTH24UNORM_STENCIL8=17,CK.TEXTUREFORMAT_DEPTH32FLOAT_STENCIL8=18,CK.TEXTUREFORMAT_STENCIL8=19,CK.TEXTUREFORMAT_UNDEFINED=4294967295,CK.TEXTUREFORMAT_COMPRESSED_RGBA_BPTC_UNORM=36492,CK.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_BPTC_UNORM=36493,CK.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT=36495,CK.TEXTUREFORMAT_COMPRESSED_RGB_BPTC_SIGNED_FLOAT=36494,CK.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT5=33779,CK.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919,CK.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT3=33778,CK.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918,CK.TEXTUREFORMAT_COMPRESSED_RGBA_S3TC_DXT1=33777,CK.TEXTUREFORMAT_COMPRESSED_RGB_S3TC_DXT1=33776,CK.TEXTUREFORMAT_COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917,CK.TEXTUREFORMAT_COMPRESSED_SRGB_S3TC_DXT1_EXT=35916,CK.TEXTUREFORMAT_COMPRESSED_RGBA_ASTC_4x4=37808,CK.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840,CK.TEXTUREFORMAT_COMPRESSED_RGB_ETC1_WEBGL=36196,CK.TEXTUREFORMAT_COMPRESSED_RGB8_ETC2=37492,CK.TEXTUREFORMAT_COMPRESSED_SRGB8_ETC2=37493,CK.TEXTUREFORMAT_COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494,CK.TEXTUREFORMAT_COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495,CK.TEXTUREFORMAT_COMPRESSED_RGBA8_ETC2_EAC=37496,CK.TEXTUREFORMAT_COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497,CK.TEXTURETYPE_UNSIGNED_BYTE=0,CK.TEXTURETYPE_UNSIGNED_INT=0,CK.TEXTURETYPE_FLOAT=1,CK.TEXTURETYPE_HALF_FLOAT=2,CK.TEXTURETYPE_BYTE=3,CK.TEXTURETYPE_SHORT=4,CK.TEXTURETYPE_UNSIGNED_SHORT=5,CK.TEXTURETYPE_INT=6,CK.TEXTURETYPE_UNSIGNED_INTEGER=7,CK.TEXTURETYPE_UNSIGNED_SHORT_4_4_4_4=8,CK.TEXTURETYPE_UNSIGNED_SHORT_5_5_5_1=9,CK.TEXTURETYPE_UNSIGNED_SHORT_5_6_5=10,CK.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV=11,CK.TEXTURETYPE_UNSIGNED_INT_24_8=12,CK.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV=13,CK.TEXTURETYPE_UNSIGNED_INT_5_9_9_9_REV=14,CK.TEXTURETYPE_FLOAT_32_UNSIGNED_INT_24_8_REV=15,CK.TEXTURETYPE_UNDEFINED=16,CK.TEXTURE_2D=3553,CK.TEXTURE_2D_ARRAY=35866,CK.TEXTURE_CUBE_MAP=34067,CK.TEXTURE_CUBE_MAP_ARRAY=3735928559,CK.TEXTURE_3D=32879,CK.TEXTURE_NEAREST_SAMPLINGMODE=1,CK.TEXTURE_NEAREST_NEAREST=1,CK.TEXTURE_BILINEAR_SAMPLINGMODE=2,CK.TEXTURE_LINEAR_LINEAR=2,CK.TEXTURE_TRILINEAR_SAMPLINGMODE=3,CK.TEXTURE_LINEAR_LINEAR_MIPLINEAR=3,CK.TEXTURE_NEAREST_NEAREST_MIPNEAREST=4,CK.TEXTURE_NEAREST_LINEAR_MIPNEAREST=5,CK.TEXTURE_NEAREST_LINEAR_MIPLINEAR=6,CK.TEXTURE_NEAREST_LINEAR=7,CK.TEXTURE_NEAREST_NEAREST_MIPLINEAR=8,CK.TEXTURE_LINEAR_NEAREST_MIPNEAREST=9,CK.TEXTURE_LINEAR_NEAREST_MIPLINEAR=10,CK.TEXTURE_LINEAR_LINEAR_MIPNEAREST=11,CK.TEXTURE_LINEAR_NEAREST=12,CK.TEXTURE_EXPLICIT_MODE=0,CK.TEXTURE_SPHERICAL_MODE=1,CK.TEXTURE_PLANAR_MODE=2,CK.TEXTURE_CUBIC_MODE=3,CK.TEXTURE_PROJECTION_MODE=4,CK.TEXTURE_SKYBOX_MODE=5,CK.TEXTURE_INVCUBIC_MODE=6,CK.TEXTURE_EQUIRECTANGULAR_MODE=7,CK.TEXTURE_FIXED_EQUIRECTANGULAR_MODE=8,CK.TEXTURE_FIXED_EQUIRECTANGULAR_MIRRORED_MODE=9,CK.TEXTURE_FILTERING_QUALITY_OFFLINE=4096,CK.TEXTURE_FILTERING_QUALITY_HIGH=64,CK.TEXTURE_FILTERING_QUALITY_MEDIUM=16,CK.TEXTURE_FILTERING_QUALITY_LOW=8,CK.SCALEMODE_FLOOR=1,CK.SCALEMODE_NEAREST=2,CK.SCALEMODE_CEILING=3,CK.MATERIAL_TextureDirtyFlag=1,CK.MATERIAL_LightDirtyFlag=2,CK.MATERIAL_FresnelDirtyFlag=4,CK.MATERIAL_AttributesDirtyFlag=8,CK.MATERIAL_MiscDirtyFlag=16,CK.MATERIAL_PrePassDirtyFlag=32,CK.MATERIAL_AllDirtyFlag=63,CK.MATERIAL_TriangleFillMode=0,CK.MATERIAL_WireFrameFillMode=1,CK.MATERIAL_PointFillMode=2,CK.MATERIAL_PointListDrawMode=3,CK.MATERIAL_LineListDrawMode=4,CK.MATERIAL_LineLoopDrawMode=5,CK.MATERIAL_LineStripDrawMode=6,CK.MATERIAL_TriangleStripDrawMode=7,CK.MATERIAL_TriangleFanDrawMode=8,CK.MATERIAL_ClockWiseSideOrientation=0,CK.MATERIAL_CounterClockWiseSideOrientation=1,CK.ACTION_NothingTrigger=0,CK.ACTION_OnPickTrigger=1,CK.ACTION_OnLeftPickTrigger=2,CK.ACTION_OnRightPickTrigger=3,CK.ACTION_OnCenterPickTrigger=4,CK.ACTION_OnPickDownTrigger=5,CK.ACTION_OnDoublePickTrigger=6,CK.ACTION_OnPickUpTrigger=7,CK.ACTION_OnPickOutTrigger=16,CK.ACTION_OnLongPressTrigger=8,CK.ACTION_OnPointerOverTrigger=9,CK.ACTION_OnPointerOutTrigger=10,CK.ACTION_OnEveryFrameTrigger=11,CK.ACTION_OnIntersectionEnterTrigger=12,CK.ACTION_OnIntersectionExitTrigger=13,CK.ACTION_OnKeyDownTrigger=14,CK.ACTION_OnKeyUpTrigger=15,CK.PARTICLES_BILLBOARDMODE_Y=2,CK.PARTICLES_BILLBOARDMODE_ALL=7,CK.PARTICLES_BILLBOARDMODE_STRETCHED=8,CK.PARTICLES_BILLBOARDMODE_STRETCHED_LOCAL=9,CK.MESHES_CULLINGSTRATEGY_STANDARD=0,CK.MESHES_CULLINGSTRATEGY_BOUNDINGSPHERE_ONLY=1,CK.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION=2,CK.MESHES_CULLINGSTRATEGY_OPTIMISTIC_INCLUSION_THEN_BSPHERE_ONLY=3,CK.SCENELOADER_NO_LOGGING=0,CK.SCENELOADER_MINIMAL_LOGGING=1,CK.SCENELOADER_SUMMARY_LOGGING=2,CK.SCENELOADER_DETAILED_LOGGING=3,CK.PREPASS_IRRADIANCE_TEXTURE_TYPE=0,CK.PREPASS_POSITION_TEXTURE_TYPE=1,CK.PREPASS_VELOCITY_TEXTURE_TYPE=2,CK.PREPASS_REFLECTIVITY_TEXTURE_TYPE=3,CK.PREPASS_COLOR_TEXTURE_TYPE=4,CK.PREPASS_DEPTH_TEXTURE_TYPE=5,CK.PREPASS_NORMAL_TEXTURE_TYPE=6,CK.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE=7,CK.PREPASS_WORLD_NORMAL_TEXTURE_TYPE=8,CK.PREPASS_LOCAL_POSITION_TEXTURE_TYPE=9,CK.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE=10,CK.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE=11,CK.PREPASS_ALBEDO_TEXTURE_TYPE=12,CK.BUFFER_CREATIONFLAG_READ=1,CK.BUFFER_CREATIONFLAG_WRITE=2,CK.BUFFER_CREATIONFLAG_READWRITE=3,CK.BUFFER_CREATIONFLAG_UNIFORM=4,CK.BUFFER_CREATIONFLAG_VERTEX=8,CK.BUFFER_CREATIONFLAG_INDEX=16,CK.BUFFER_CREATIONFLAG_STORAGE=32,CK.BUFFER_CREATIONFLAG_INDIRECT=64,CK.RENDERPASS_MAIN=0,CK.INPUT_ALT_KEY=18,CK.INPUT_CTRL_KEY=17,CK.INPUT_META_KEY1=91,CK.INPUT_META_KEY2=92,CK.INPUT_META_KEY3=93,CK.INPUT_SHIFT_KEY=16,CK.SNAPSHOTRENDERING_STANDARD=0,CK.SNAPSHOTRENDERING_FAST=1,CK.PERSPECTIVE_CAMERA=0,CK.ORTHOGRAPHIC_CAMERA=1,CK.FOVMODE_VERTICAL_FIXED=0,CK.FOVMODE_HORIZONTAL_FIXED=1,CK.RIG_MODE_NONE=0,CK.RIG_MODE_STEREOSCOPIC_ANAGLYPH=10,CK.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_PARALLEL=11,CK.RIG_MODE_STEREOSCOPIC_SIDEBYSIDE_CROSSEYED=12,CK.RIG_MODE_STEREOSCOPIC_OVERUNDER=13,CK.RIG_MODE_STEREOSCOPIC_INTERLACED=14,CK.RIG_MODE_VR=20,CK.RIG_MODE_CUSTOM=22,CK.MAX_SUPPORTED_UV_SETS=6,CK.GL_ALPHA_EQUATION_ADD=32774,CK.GL_ALPHA_EQUATION_MIN=32775,CK.GL_ALPHA_EQUATION_MAX=32776,CK.GL_ALPHA_EQUATION_SUBTRACT=32778,CK.GL_ALPHA_EQUATION_REVERSE_SUBTRACT=32779,CK.GL_ALPHA_FUNCTION_SRC=768,CK.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_COLOR=769,CK.GL_ALPHA_FUNCTION_SRC_ALPHA=770,CK.GL_ALPHA_FUNCTION_ONE_MINUS_SRC_ALPHA=771,CK.GL_ALPHA_FUNCTION_DST_ALPHA=772,CK.GL_ALPHA_FUNCTION_ONE_MINUS_DST_ALPHA=773,CK.GL_ALPHA_FUNCTION_DST_COLOR=774,CK.GL_ALPHA_FUNCTION_ONE_MINUS_DST_COLOR=775,CK.GL_ALPHA_FUNCTION_SRC_ALPHA_SATURATED=776,CK.GL_ALPHA_FUNCTION_CONSTANT_COLOR=32769,CK.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_COLOR=32770,CK.GL_ALPHA_FUNCTION_CONSTANT_ALPHA=32771,CK.GL_ALPHA_FUNCTION_ONE_MINUS_CONSTANT_ALPHA=32772,CK.GL_ALPHA_FUNCTION_SRC1_COLOR=35065,CK.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_COLOR=35066,CK.GL_ALPHA_FUNCTION_SRC1_ALPHA=34185,CK.GL_ALPHA_FUNCTION_ONE_MINUS_SRC1_ALPHA=35067,CK.SnippetUrl="https://snippet.babylonjs.com",CK.FOGMODE_NONE=0,CK.FOGMODE_EXP=1,CK.FOGMODE_EXP2=2,CK.FOGMODE_LINEAR=3,CK.BYTE=5120,CK.UNSIGNED_BYTE=5121,CK.SHORT=5122,CK.UNSIGNED_SHORT=5123,CK.INT=5124,CK.UNSIGNED_INT=5125,CK.FLOAT=5126,CK.PositionKind="position",CK.NormalKind="k",CK.TangentKind="tangent",CK.UVKind="uv",CK.UV2Kind="uv2",CK.UV3Kind="uv3",CK.UV4Kind="uv4",CK.UV5Kind="uv5",CK.UV6Kind="uv6",CK.ColorKind="color",CK.ColorInstanceKind="instanceColor",CK.MatricesIndicesKind="matricesIndices",CK.MatricesWeightsKind="matricesWeights",CK.MatricesIndicesExtraKind="matricesIndicesExtra",CK.MatricesWeightsExtraKind="matricesWeightsExtra";class HK{static _GetDefaultOptions(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:CK.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}}constructor(K,b){this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options={...HK._GetDefaultOptions(),...K},this._scene=b,this._scene._transmissionHelper=this,this.onErrorObservable=new A.d,this._scene.Ui.addOnce((()=>{this.dispose()})),this._parseScene(),this._setupRenderTargets()}updateOptions(K){if(!Object.keys(K).filter((b=>this._options[b]!==K[b])).length)return;const b={...this._options,...K},e=this._options;this._options=b,b.renderSize===e.renderSize&&b.renderTargetTextureType===e.renderTargetTextureType&&b.generateMipmaps===e.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=b.samples,this._opaqueRenderTarget.lodGenerationScale=b.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=b.lodGenerationOffset):this._setupRenderTargets()}getOpaqueTarget(){return this._opaqueRenderTarget}_shouldRenderAsTransmission(K){return!!K&&!!(K instanceof r&&K.subSurface.isRefractionEnabled)}_addMesh(K){this._materialObservers[K.uniqueId]=K.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),T.f.SetImmediate((()=>{this._shouldRenderAsTransmission(K.material)?(K.material.refractionTexture=this._opaqueRenderTarget,-1===this._transparentMeshesCache.indexOf(K)&&this._transparentMeshesCache.push(K)):-1===this._opaqueMeshesCache.indexOf(K)&&this._opaqueMeshesCache.push(K)}))}_removeMesh(K){K.onMaterialChangedObservable.remove(this._materialObservers[K.uniqueId]),delete this._materialObservers[K.uniqueId];let b=this._transparentMeshesCache.indexOf(K);-1!==b&&this._transparentMeshesCache.splice(b,1),b=this._opaqueMeshesCache.indexOf(K),-1!==b&&this._opaqueMeshesCache.splice(b,1)}_parseScene(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))}_onMeshMaterialChanged(K){const b=this._transparentMeshesCache.indexOf(K),e=this._opaqueMeshesCache.indexOf(K);this._shouldRenderAsTransmission(K.material)?(K.material instanceof r&&(K.material.subSurface.refractionTexture=this._opaqueRenderTarget),-1!==e?(this._opaqueMeshesCache.splice(e,1),this._transparentMeshesCache.push(K)):-1===b&&this._transparentMeshesCache.push(K)):-1!==b?(this._transparentMeshesCache.splice(b,1),this._opaqueMeshesCache.push(K)):-1===e&&this._opaqueMeshesCache.push(K)}_isRenderTargetValid(){var K;return null!==(null===(K=this._opaqueRenderTarget)||void 0===K?void 0:K.getInternalTexture())}_setupRenderTargets(){var K;let b,e;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new oK.b("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(null===(K=this._options.clearColor)||void 0===K?void 0:K.clone())??this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.onBeforeBindObservable.add((K=>{e=this._scene.environmentIntensity,this._scene.environmentIntensity=1,b=this._scene.imageProcessingConfiguration.applyByPostProcess,this._options.clearColor?K.clearColor.p(this._options.clearColor):this._scene.clearColor.toLinearSpaceToRef(K.clearColor,this._scene.getEngine().useExactSrgbConversions),this._scene.imageProcessingConfiguration._applyByPostProcess=!0})),this._opaqueRenderTarget.onAfterUnbindObservable.add((()=>{this._scene.environmentIntensity=e,this._scene.imageProcessingConfiguration._applyByPostProcess=b})),this._transparentMeshesCache.forEach((K=>{this._shouldRenderAsTransmission(K.material)&&(K.material.refractionTexture=this._opaqueRenderTarget)}))}dispose(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]}}const WK="KHR_materials_transmission";class fK{constructor(K){this.name=WK,this.order=175,this._loader=K,this.enabled=this._loader.isExtensionUsed(WK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadTransparentPropertiesAsync(z,b,e,k)),Promise.all(j).then((()=>{}))}))}_loadTransparentPropertiesAsync(K,b,e,z){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const k=e;if(k.subSurface.isRefractionEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.useAlbedoToTintRefraction=!0,void 0===z.transmissionFactor)return k.subSurface.refractionIntensity=0,k.subSurface.isRefractionEnabled=!1,Promise.resolve();{var j;k.subSurface.refractionIntensity=z.transmissionFactor;const K=k.va();if(k.subSurface.refractionIntensity&&!K._transmissionHelper)new HK({},k.va());else if(k.subSurface.refractionIntensity&&(null===(j=K._transmissionHelper)||void 0===j||!j._isRenderTargetValid())){var T;null===(T=K._transmissionHelper)||void 0===T||T._setupRenderTargets()}}return k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,z.transmissionTexture?(z.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/transmissionTexture`,z.transmissionTexture,void 0).then((K=>{K.name=`${e.name} (Transmission)`,k.subSurface.refractionIntensityTexture=K,k.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}H(WK),C(WK,!0,(K=>new fK(K)));const VK="KHR_materials_diffuse_transmission";class qK{constructor(K){this.name=VK,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(VK),this.enabled&&(K.parent.transparencyAsCoverage=!0)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadTranslucentPropertiesAsync(z,b,e,k)),Promise.all(j).then((()=>{}))}))}_loadTranslucentPropertiesAsync(K,b,e,z){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);const k=e;if(k.subSurface.isTranslucencyEnabled=!0,k.subSurface.volumeIndexOfRefraction=1,k.subSurface.minimumThickness=0,k.subSurface.maximumThickness=0,k.subSurface.useAlbedoToTintTranslucency=!1,void 0===z.diffuseTransmissionFactor)return k.subSurface.translucencyIntensity=0,k.subSurface.isTranslucencyEnabled=!1,Promise.resolve();k.subSurface.translucencyIntensity=z.diffuseTransmissionFactor;const T=new Array;return k.subSurface.useGltfStyleTextures=!0,z.diffuseTransmissionTexture&&(z.diffuseTransmissionTexture.nonColorData=!0,T.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionTexture`,z.diffuseTransmissionTexture).then((K=>{K.name=`${e.name} (Diffuse Transmission)`,k.subSurface.translucencyIntensityTexture=K})))),void 0!==z.diffuseTransmissionColorFactor?k.subSurface.translucencyColor=j.c.Bg(z.diffuseTransmissionColorFactor):k.subSurface.translucencyColor=j.c.White(),z.diffuseTransmissionColorTexture&&T.push(this._loader.loadTextureInfoAsync(`${K}/diffuseTransmissionColorTexture`,z.diffuseTransmissionColorTexture).then((K=>{K.name=`${e.name} (Diffuse Transmission Color)`,k.subSurface.translucencyColorTexture=K}))),Promise.all(T).then((()=>{}))}}H(VK),C(VK,!0,(K=>new qK(K)));const JK="KHR_materials_volume";class Kb{constructor(K){this.name=JK,this.order=173,this._loader=K,this.enabled=this._loader.isExtensionUsed(JK),this.enabled&&this._loader._disableInstancedMesh++}dispose(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadVolumePropertiesAsync(z,b,e,k)),Promise.all(j).then((()=>{}))}))}_loadVolumePropertiesAsync(K,b,e,z){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);if(!e.subSurface.isRefractionEnabled&&!e.subSurface.isTranslucencyEnabled||!z.thicknessFactor)return Promise.resolve();e.subSurface.volumeIndexOfRefraction=e.indexOfRefraction;const k=void 0!==z.attenuationDistance?z.attenuationDistance:Number.MAX_VALUE;return e.subSurface.tintColorAtDistance=k,void 0!==z.attenuationColor&&3==z.attenuationColor.length&&e.subSurface.tintColor.Yd(z.attenuationColor[0],z.attenuationColor[1],z.attenuationColor[2]),e.subSurface.minimumThickness=0,e.subSurface.maximumThickness=z.thicknessFactor,e.subSurface.useThicknessAsDepth=!0,z.thicknessTexture?(z.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync(`${K}/thicknessTexture`,z.thicknessTexture).then((K=>{K.name=`${e.name} (Thickness)`,e.subSurface.thicknessTexture=K,e.subSurface.useGltfStyleTextures=!0}))):Promise.resolve()}}H(JK),C(JK,!0,(K=>new Kb(K)));const bb="KHR_materials_dispersion";class eb{constructor(K){this.name=bb,this.order=174,this._loader=K,this.enabled=this._loader.isExtensionUsed(bb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=new Array;return j.push(this._loader.loadMaterialPropertiesAsync(K,b,e)),j.push(this._loadDispersionPropertiesAsync(z,b,e,k)),Promise.all(j).then((()=>{}))}))}_loadDispersionPropertiesAsync(K,b,e,z){if(!(e instanceof r))throw new Error(`${K}: Material type not supported`);return e.subSurface.isRefractionEnabled&&z.dispersion?(e.subSurface.isDispersionEnabled=!0,e.subSurface.dispersion=z.dispersion,Promise.resolve()):Promise.resolve()}}H(bb),C(bb,!0,(K=>new eb(K)));const zb="KHR_mesh_quantization";class kb{constructor(K){this.name=zb,this.enabled=K.isExtensionUsed(zb)}dispose(){}}H(zb),C(zb,!0,(K=>new kb(K)));const jb="KHR_texture_basisu";class Tb{constructor(K){this.name=jb,this._loader=K,this.enabled=K.isExtensionUsed(jb)}dispose(){this._loader=null}_loadTextureAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>{const j=void 0==b.sampler?V.DefaultSampler:f.Get(`${K}/sampler`,this._loader.xi.samplers,b.sampler),T=f.Get(`${z}/source`,this._loader.xi.images,k.source);return this._loader._createTextureAsync(K,j,T,(K=>{e(K)}),b._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!b._textureInfo.nonColorData)}))}}H(jb),C(jb,!0,(K=>new Tb(K)));const Fb="KHR_texture_transform";class lb{constructor(K){this.name=Fb,this._loader=K,this.enabled=this._loader.isExtensionUsed(Fb)}dispose(){this._loader=null}loadTextureInfoAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((z,k)=>this._loader.loadTextureInfoAsync(K,b,(K=>{if(!(K instanceof L.c))throw new Error(`${z}: Texture type not supported`);k.offset&&(K.uOffset=k.offset[0],K.vOffset=k.offset[1]),K.uRotationCenter=0,K.vRotationCenter=0,k.rotation&&(K.wAng=-k.rotation),k.scale&&(K.uScale=k.scale[0],K.vScale=k.scale[1]),void 0!=k.texCoord&&(K.coordinatesIndex=k.texCoord),e(K)}))))}}H(Fb),C(Fb,!0,(K=>new lb(K)));const Yb="KHR_xmp_json_ld";class Ab{constructor(K){this.name=Yb,this.order=100,this._loader=K,this.enabled=this._loader.isExtensionUsed(Yb)}dispose(){this._loader=null}onLoading(){var K,b,e;if(null===this._loader.rootBabylonMesh)return;const z=null===(K=this._loader.xi.extensions)||void 0===K?void 0:K.KHR_xmp_json_ld,k=null===(b=this._loader.xi.asset)||void 0===b||null===(e=b.extensions)||void 0===e?void 0:e.KHR_xmp_json_ld;if(z&&k){const K=+k.packet;z.packets&&K<z.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=z.packets[K])}}}function Xb(K,b,e,z){return j.c.Bg(b,e).scale(z)}function tb(K,b,e,z){return b[e]*z}function Ub(K,b,e,z){return-b[e]*z}function Bb(K,b,e,z){return b[e+1]*z}function ub(K,b,e,z){return b[e]*z*2}function mb(K){return{scale:[new Ib(t.c.ANIMATIONTYPE_FLOAT,`${K}.uScale`,tb,(()=>2)),new Ib(t.c.ANIMATIONTYPE_FLOAT,`${K}.vScale`,Bb,(()=>2))],offset:[new Ib(t.c.ANIMATIONTYPE_FLOAT,`${K}.uOffset`,tb,(()=>2)),new Ib(t.c.ANIMATIONTYPE_FLOAT,`${K}.vOffset`,Bb,(()=>2))],rotation:[new Ib(t.c.ANIMATIONTYPE_FLOAT,`${K}.wAng`,Ub,(()=>1))]}}H(Yb),C(Yb,!0,(K=>new Ab(K)));class Db extends Z{buildAnimations(K,b,e,z,k){k(K._babylonCamera,this._buildAnimation(b,e,z))}}class Ib extends Z{buildAnimations(K,b,e,z,k){for(const j in K._data)k(K._data[j].babylonMaterial,this._buildAnimation(b,e,z))}}class xb extends Z{buildAnimations(K,b,e,z,k){k(K._babylonLight,this._buildAnimation(b,e,z))}}const Qb={__array__:{__target__:!0,...s}},Gb={__array__:{__target__:!0,orthographic:{xmag:[new Db(t.c.ANIMATIONTYPE_FLOAT,"orthoLeft",Ub,(()=>1)),new Db(t.c.ANIMATIONTYPE_FLOAT,"orthoRight",Bb,(()=>1))],ymag:[new Db(t.c.ANIMATIONTYPE_FLOAT,"orthoBottom",Ub,(()=>1)),new Db(t.c.ANIMATIONTYPE_FLOAT,"orthoTop",Bb,(()=>1))],zfar:[new Db(t.c.ANIMATIONTYPE_FLOAT,"maxZ",tb,(()=>1))],znear:[new Db(t.c.ANIMATIONTYPE_FLOAT,"Fi",tb,(()=>1))]},perspective:{yfov:[new Db(t.c.ANIMATIONTYPE_FLOAT,"fov",tb,(()=>1))],zfar:[new Db(t.c.ANIMATIONTYPE_FLOAT,"maxZ",tb,(()=>1))],znear:[new Db(t.c.ANIMATIONTYPE_FLOAT,"Fi",tb,(()=>1))]}}},ib={nodes:Qb,materials:{__array__:{__target__:!0,pbrMetallicRoughness:{baseColorFactor:[new Ib(t.c.ANIMATIONTYPE_COLOR3,"albedoColor",Xb,(()=>4)),new Ib(t.c.ANIMATIONTYPE_FLOAT,"alpha",(function(K,b,e,z){return b[e+3]*z}),(()=>4))],metallicFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"metallic",tb,(()=>1))],roughnessFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"roughness",tb,(()=>1))],baseColorTexture:{extensions:{KHR_texture_transform:mb("albedoTexture")}},metallicRoughnessTexture:{extensions:{KHR_texture_transform:mb("metallicTexture")}}},emissiveFactor:[new Ib(t.c.ANIMATIONTYPE_COLOR3,"emissiveColor",Xb,(()=>3))],normalTexture:{scale:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"bumpTexture.level",tb,(()=>1))],extensions:{KHR_texture_transform:mb("bumpTexture")}},occlusionTexture:{strength:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",tb,(()=>1))],extensions:{KHR_texture_transform:mb("ambientTexture")}},emissiveTexture:{extensions:{KHR_texture_transform:mb("emissiveTexture")}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",tb,(()=>1))],anisotropyRotation:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"anisotropy.angle",tb,(()=>1))],anisotropyTexture:{extensions:{KHR_texture_transform:mb("anisotropy.texture")}}},KHR_materials_clearcoat:{clearcoatFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",tb,(()=>1))],clearcoatRoughnessFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",tb,(()=>1))],clearcoatTexture:{extensions:{KHR_texture_transform:mb("clearCoat.texture")}},clearcoatNormalTexture:{scale:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",tb,(()=>1))],extensions:{KHR_texture_transform:mb("clearCoat.bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:mb("clearCoat.textureRoughness")}}},KHR_materials_dispersion:{dispersion:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",tb,(()=>1))]},KHR_materials_emissive_strength:{emissiveStrength:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"emissiveIntensity",tb,(()=>1))]},KHR_materials_ior:{ior:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"indexOfRefraction",tb,(()=>1))]},KHR_materials_iridescence:{iridescenceFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"iridescence.intensity",tb,(()=>1))],iridescenceIor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",tb,(()=>1))],iridescenceThicknessMinimum:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",tb,(()=>1))],iridescenceThicknessMaximum:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",tb,(()=>1))],iridescenceTexture:{extensions:{KHR_texture_transform:mb("iridescence.texture")}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:mb("iridescence.thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:[new Ib(t.c.ANIMATIONTYPE_COLOR3,"sheen.color",Xb,(()=>3))],sheenRoughnessFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"sheen.roughness",tb,(()=>1))],sheenColorTexture:{extensions:{KHR_texture_transform:mb("sheen.texture")}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:mb("sheen.textureRoughness")}}},KHR_materials_specular:{specularFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"metallicF0Factor",tb,(()=>1))],specularColorFactor:[new Ib(t.c.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Xb,(()=>3))],specularTexture:{extensions:{KHR_texture_transform:mb("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:mb("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",tb,(()=>1))],transmissionTexture:{extensions:{KHR_texture_transform:mb("subSurface.refractionIntensityTexture")}}},KHR_materials_volume:{attenuationColor:[new Ib(t.c.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Xb,(()=>3))],attenuationDistance:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",tb,(()=>1))],thicknessFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",tb,(()=>1))],thicknessTexture:{extensions:{KHR_texture_transform:mb("subSurface.thicknessTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:[new Ib(t.c.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",tb,(()=>1))],diffuseTransmissionTexture:{extensions:{KHR_texture_transform:mb("subSurface.translucencyIntensityTexture")}},diffuseTransmissionColorFactor:[new Ib(t.c.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Xb,(()=>3))],diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:mb("subSurface.translucencyColorTexture")}}}}}},cameras:Gb,extensions:{KHR_lights_punctual:{lights:{__array__:{__target__:!0,color:[new xb(t.c.ANIMATIONTYPE_COLOR3,"diffuse",Xb,(()=>3))],Ji:[new xb(t.c.ANIMATIONTYPE_FLOAT,"intensity",tb,(()=>1))],range:[new xb(t.c.ANIMATIONTYPE_FLOAT,"range",tb,(()=>1))],spot:{innerConeAngle:[new xb(t.c.ANIMATIONTYPE_FLOAT,"innerAngle",ub,(()=>1))],outerConeAngle:[new xb(t.c.ANIMATIONTYPE_FLOAT,"angle",ub,(()=>1))]}}}}}};class Sb{constructor(K,b){this._gltf=K,this._infoTree=b}convert(K){let b,e=this._gltf,z=this._infoTree;if(!K.startsWith("/"))throw new Error("Path must start with a /");const k=K.split("/");k.shift();for(const j of k){if(z.__array__)z=z.__array__;else if(z=z[j],!z)throw new Error(`Path ${K} is invalid`);if(void 0===e)throw new Error(`Path ${K} is invalid`);e=e[j],z.__target__&&(b=e)}return{object:b,info:z}}}const Mb="KHR_animation_pointer";class rb extends Sb{constructor(K){super(K,ib)}}class Lb{constructor(K){this.name=Mb,this._loader=K,this._pathToObjectConverter=new rb(this._loader.xi)}get enabled(){return this._loader.isExtensionUsed(Mb)}dispose(){this._loader=null,delete this._pathToObjectConverter}_loadAnimationChannelAsync(K,b,e,z,k){var j;const T=null===(j=z.target.extensions)||void 0===j?void 0:j.KHR_animation_pointer;if(!T||!this._pathToObjectConverter)return null;"pointer"!==z.target.path&&u.b.Warn(`${K}/target/path: Value (${z.target.path}) must be (pointer) when using the ${this.name} extension`),void 0!=z.target.node&&u.b.Warn(`${K}/target/node: Value (${z.target.node}) must not be present when using the ${this.name} extension`);const F=`${K}/extensions/${this.name}`,l=T.pointer;if(!l)throw new Error(`${F}: Pointer is missing`);try{const j=this._pathToObjectConverter.convert(l);return this._loader._loadAnimationChannelFromTargetInfoAsync(K,b,e,z,j,k)}catch(Y){return u.b.Warn(`${F}/pointer: Invalid pointer (${l}) skipped`),null}}}H(Mb),C(Mb,!0,(K=>new Lb(K)));class cb{constructor(K,b,e){this.frame=K,this.action=b,this.onlyOnce=e,this.isDone=!1}_clone(){return new cb(this.frame,this.action,this.onlyOnce)}}var vb=e(10710),wb=e(10750);class hb{get loop(){return this._loop}set loop(K){K!==this._loop&&(this._loop=K,this.updateOptions({loop:K}))}get currentTime(){var K;if(this._htmlAudioElement)return this._htmlAudioElement.currentTime;if(null!==(K=wb.e.audioEngine)&&void 0!==K&&K.audioContext&&(this.isPlaying||this.isPaused)){const K=this.isPaused?0:wb.e.audioEngine.audioContext.currentTime-this._startTime;return this._currentTime+K}return 0}get spatialSound(){return this._spatialSound}set spatialSound(K){if(K==this._spatialSound)return;const b=this.isPlaying;this.pause(),K?(this._spatialSound=K,this._updateSpatialParameters()):this._disableSpatialSound(),b&&this.play()}constructor(K,b,e){var z;let j=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,F=arguments.length>4?arguments[4]:void 0;if(this.autoplay=!1,this._loop=!1,this.useCustomAttenuation=!1,this.isPlaying=!1,this.isPaused=!1,this.refDistance=1,this.rolloffFactor=1,this.maxDistance=100,this.distanceModel="linear",this.metadata=null,this.onEndedObservable=new A.d,this._spatialSound=!1,this._panningModel="equalpower",this._playbackRate=1,this._streaming=!1,this._startTime=0,this._currentTime=0,this._position=k.k.Zero(),this._localDirection=new k.k(1,0,0),this._volume=1,this._isReadyToPlay=!1,this._isDirectional=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._coneOuterGain=0,this._isOutputConnected=!1,this._urlType="Unknown",this.name=K,e=e||B.b.LastCreatedScene)if(this._scene=e,hb._SceneComponentInitialization(e),this._readyToPlayCallback=j,this._customAttenuationFunction=(K,b,e,z,k)=>b<e?K*(1-b/e):0,F&&(this.autoplay=F.autoplay||!1,this._loop=F.loop||!1,void 0!==F.volume&&(this._volume=F.volume),this._spatialSound=F.spatialSound??!1,this.maxDistance=F.maxDistance??100,this.useCustomAttenuation=F.useCustomAttenuation??!1,this.rolloffFactor=F.rolloffFactor||1,this.refDistance=F.refDistance||1,this.distanceModel=F.distanceModel||"linear",this._playbackRate=F.playbackRate||1,this._streaming=F.streaming??!1,this._length=F.length,this._offset=F.offset),null!==(z=wb.e.audioEngine)&&void 0!==z&&z.canUseWebAudio&&wb.e.audioEngine.audioContext){this._soundGain=wb.e.audioEngine.audioContext.createGain(),this._soundGain.gain.value=this._volume,this._inputAudioNode=this._soundGain,this._outputAudioNode=this._soundGain,this._spatialSound&&this._createSpatialParameters(),this._scene.mainSoundTrack.addSound(this);let K=!0;if(b)try{"string"===typeof b?(this._urlType="String",this._url=b):b instanceof ArrayBuffer?this._urlType="ArrayBuffer":b instanceof HTMLMediaElement?this._urlType="MediaElement":b instanceof MediaStream?this._urlType="MediaStream":b instanceof AudioBuffer?this._urlType="AudioBuffer":Array.isArray(b)&&(this._urlType="Array");let e=[],z=!1;switch(this._urlType){case"MediaElement":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wb.e.audioEngine.audioContext.createMediaElementSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"MediaStream":this._streaming=!0,this._isReadyToPlay=!0,this._streamingSource=wb.e.audioEngine.audioContext.createMediaStreamSource(b),this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback();break;case"ArrayBuffer":b.byteLength>0&&(z=!0,this._soundLoaded(b));break;case"AudioBuffer":this._audioBufferLoaded(b);break;case"String":e.push(b);case"Array":0===e.length&&(e=b);for(let K=0;K<e.length;K++){const b=e[K];if(z=F&&F.skipCodecCheck||-1!==b.indexOf(".mp3",b.length-4)&&wb.e.audioEngine.isMP3supported||-1!==b.indexOf(".ogg",b.length-4)&&wb.e.audioEngine.isOGGsupported||-1!==b.indexOf(".wav",b.length-4)||-1!==b.indexOf(".m4a",b.length-4)||-1!==b.indexOf(".mp4",b.length-4)||-1!==b.indexOf("blob:"),z){this._streaming?(this._htmlAudioElement=new Audio(b),this._htmlAudioElement.controls=!1,this._htmlAudioElement.loop=this.loop,T.f.SetCorsBehavior(b,this._htmlAudioElement),this._htmlAudioElement.preload="auto",this._htmlAudioElement.addEventListener("canplaythrough",(()=>{this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback()}),{once:!0}),document.body.appendChild(this._htmlAudioElement),this._htmlAudioElement.load()):this._scene._loadFile(b,(K=>{this._soundLoaded(K)}),void 0,!0,!0,(K=>{K&&u.b.Error("XHR "+K.status+" error on: "+b+"."),u.b.Error("Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}));break}}break;default:K=!1}K?z||(this._isReadyToPlay=!0,this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)):u.b.Error("Parameter must be a URL to the sound, an Array of URLs (.mp3 & .ogg) or an ArrayBuffer of the sound.")}catch(l){u.b.Error("Unexpected error. Sound creation aborted."),this._scene.mainSoundTrack.removeSound(this)}}else this._scene.mainSoundTrack.addSound(this),wb.e.audioEngine&&!wb.e.audioEngine.WarnedWebAudioUnsupported&&(u.b.Error("Web Audio is not supported by your browser."),wb.e.audioEngine.WarnedWebAudioUnsupported=!0),this._readyToPlayCallback&&setTimeout((()=>{this._readyToPlayCallback&&this._readyToPlayCallback()}),1e3)}dispose(){var K;null!==(K=wb.e.audioEngine)&&void 0!==K&&K.canUseWebAudio&&(this.isPlaying&&this.stop(),this._isReadyToPlay=!1,-1===this.soundTrackId?this._scene.mainSoundTrack.removeSound(this):this._scene.soundTracks&&this._scene.soundTracks[this.soundTrackId].removeSound(this),this._soundGain&&(this._soundGain.disconnect(),this._soundGain=null),this._soundPanner&&(this._soundPanner.disconnect(),this._soundPanner=null),this._soundSource&&(this._soundSource.disconnect(),this._soundSource=null),this._audioBuffer=null,this._htmlAudioElement&&(this._htmlAudioElement.pause(),this._htmlAudioElement.src="",document.body.removeChild(this._htmlAudioElement),this._htmlAudioElement=null),this._streamingSource&&(this._streamingSource.disconnect(),this._streamingSource=null),this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._connectedTransformNode=null),this._clearTimeoutsAndObservers())}isReady(){return this._isReadyToPlay}getClassName(){return"Sound"}_audioBufferLoaded(K){var b;null!==(b=wb.e.audioEngine)&&void 0!==b&&b.audioContext&&(this._audioBuffer=K,this._isReadyToPlay=!0,this.autoplay&&this.play(0,this._offset,this._length),this._readyToPlayCallback&&this._readyToPlayCallback())}_soundLoaded(K){var b;null!==(b=wb.e.audioEngine)&&void 0!==b&&b.audioContext&&wb.e.audioEngine.audioContext.decodeAudioData(K,(K=>{this._audioBufferLoaded(K)}),(K=>{u.b.Error("Error while decoding audio data for: "+this.name+" / Error: "+K)}))}setAudioBuffer(K){var b;null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&(this._audioBuffer=K,this._isReadyToPlay=!0)}updateOptions(K){K&&(this.loop=K.loop??this.loop,this.maxDistance=K.maxDistance??this.maxDistance,this.useCustomAttenuation=K.useCustomAttenuation??this.useCustomAttenuation,this.rolloffFactor=K.rolloffFactor??this.rolloffFactor,this.refDistance=K.refDistance??this.refDistance,this.distanceModel=K.distanceModel??this.distanceModel,this._playbackRate=K.playbackRate??this._playbackRate,this._length=K.length??void 0,this.spatialSound=K.spatialSound??this._spatialSound,this._setOffset(K.offset??void 0),this.setVolume(K.volume??this._volume),this._updateSpatialParameters(),this.isPlaying&&(this._streaming&&this._htmlAudioElement?(this._htmlAudioElement.playbackRate=this._playbackRate,this._htmlAudioElement.loop!==this.loop&&(this._htmlAudioElement.loop=this.loop)):this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.loop!==this.loop&&(this._soundSource.loop=this.loop),void 0!==this._offset&&this._soundSource.loopStart!==this._offset&&(this._soundSource.loopStart=this._offset),void 0!==this._length&&this._length!==this._soundSource.loopEnd&&(this._soundSource.loopEnd=(0|this._offset)+this._length))))}_createSpatialParameters(){var K;null!==(K=wb.e.audioEngine)&&void 0!==K&&K.canUseWebAudio&&wb.e.audioEngine.audioContext&&(this._scene.headphone&&(this._panningModel="HRTF"),this._soundPanner=this._soundPanner??wb.e.audioEngine.audioContext.createPanner(),this._soundPanner&&this._outputAudioNode&&(this._updateSpatialParameters(),this._soundPanner.connect(this._outputAudioNode),this._inputAudioNode=this._soundPanner))}_disableSpatialSound(){var K;this._spatialSound&&(this._inputAudioNode=this._soundGain,null===(K=this._soundPanner)||void 0===K||K.disconnect(),this._soundPanner=null,this._spatialSound=!1)}_updateSpatialParameters(){this._spatialSound&&(this._soundPanner?this.useCustomAttenuation?(this._soundPanner.distanceModel="linear",this._soundPanner.maxDistance=Number.MAX_VALUE,this._soundPanner.refDistance=1,this._soundPanner.rolloffFactor=1,this._soundPanner.panningModel=this._panningModel):(this._soundPanner.distanceModel=this.distanceModel,this._soundPanner.maxDistance=this.maxDistance,this._soundPanner.refDistance=this.refDistance,this._soundPanner.rolloffFactor=this.rolloffFactor,this._soundPanner.panningModel=this._panningModel):this._createSpatialParameters())}switchPanningModelToHRTF(){this._panningModel="HRTF",this._switchPanningModel()}switchPanningModelToEqualPower(){this._panningModel="equalpower",this._switchPanningModel()}_switchPanningModel(){var K;null!==(K=wb.e.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.panningModel=this._panningModel)}connectToSoundTrackAudioNode(K){var b;null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._isOutputConnected&&this._outputAudioNode.disconnect(),this._outputAudioNode.connect(K),this._isOutputConnected=!0)}setDirectionalCone(K,b,e){b<K?u.b.Error("setDirectionalCone(): outer angle of the cone must be superior or equal to the inner angle."):(this._coneInnerAngle=K,this._coneOuterAngle=b,this._coneOuterGain=e,this._isDirectional=!0,this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length)))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!=this._coneInnerAngle){var b;if(this._coneOuterAngle<K)return void u.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K,null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle)}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!=this._coneOuterAngle){var b;if(K<this._coneInnerAngle)return void u.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K,null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&(this._soundPanner.coneOuterAngle=this._coneOuterAngle)}}setPosition(K){var b;K.equals(this._position)||(this._position.p(K),null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._spatialSound&&this._soundPanner&&!isNaN(this._position.x)&&!isNaN(this._position.y)&&!isNaN(this._position.z)&&(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z))}setLocalDirectionToMesh(K){var b;this._localDirection=K,null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._connectedTransformNode&&this.isPlaying&&this._updateDirection()}_updateDirection(){if(!this._connectedTransformNode||!this._soundPanner)return;const K=this._connectedTransformNode.getWorldMatrix(),b=k.k.TransformNormal(this._localDirection,K);b.normalize(),this._soundPanner.orientationX.value=b.x,this._soundPanner.orientationY.value=b.y,this._soundPanner.orientationZ.value=b.z}updateDistanceFromListener(){var K;if(null!==(K=wb.e.audioEngine)&&void 0!==K&&K.canUseWebAudio&&this._connectedTransformNode&&this.useCustomAttenuation&&this._soundGain&&this._scene.activeCamera){const K=this._scene.audioListenerPositionProvider?this._connectedTransformNode.position.Qc(this._scene.audioListenerPositionProvider()).length():this._connectedTransformNode.getDistanceToCamera(this._scene.activeCamera);this._soundGain.gain.value=this._customAttenuationFunction(this._volume,K,this.maxDistance,this.refDistance,this.rolloffFactor)}}setAttenuationFunction(K){this._customAttenuationFunction=K}play(K,b,e){var z;if(this._isReadyToPlay&&this._scene.audioEnabled&&null!==(z=wb.e.audioEngine)&&void 0!==z&&z.audioContext)try{var k,j;this._clearTimeoutsAndObservers();let z=K?(null===(k=wb.e.audioEngine)||void 0===k?void 0:k.audioContext.currentTime)+K:null===(j=wb.e.audioEngine)||void 0===j?void 0:j.audioContext.currentTime;if(this._soundSource&&this._streamingSource||this._spatialSound&&this._soundPanner&&(isNaN(this._position.x)||isNaN(this._position.y)||isNaN(this._position.z)||(this._soundPanner.positionX.value=this._position.x,this._soundPanner.positionY.value=this._position.y,this._soundPanner.positionZ.value=this._position.z),this._isDirectional&&(this._soundPanner.coneInnerAngle=this._coneInnerAngle,this._soundPanner.coneOuterAngle=this._coneOuterAngle,this._soundPanner.coneOuterGain=this._coneOuterGain,this._connectedTransformNode?this._updateDirection():this._soundPanner.setOrientation(this._localDirection.x,this._localDirection.y,this._localDirection.z))),this._streaming){if(!this._streamingSource&&this._htmlAudioElement&&(this._streamingSource=wb.e.audioEngine.audioContext.createMediaElementSource(this._htmlAudioElement),this._htmlAudioElement.onended=()=>{this._onended()},this._htmlAudioElement.playbackRate=this._playbackRate),this._streamingSource&&(this._streamingSource.disconnect(),this._inputAudioNode&&this._streamingSource.connect(this._inputAudioNode)),this._htmlAudioElement){const K=()=>{var e;if(null!==(e=wb.e.audioEngine)&&void 0!==e&&e.unlocked){if(!this._htmlAudioElement)return;this._htmlAudioElement.currentTime=b??0;const e=this._htmlAudioElement.play();void 0!==e&&e.catch((()=>{var b,e;(null===(b=wb.e.audioEngine)||void 0===b||b.lock(),this.loop||this.autoplay)&&(this._audioUnlockedObserver=null===(e=wb.e.audioEngine)||void 0===e?void 0:e.onAudioUnlockedObservable.addOnce((()=>{K()})))}))}else{var z;if(this.loop||this.autoplay)this._audioUnlockedObserver=null===(z=wb.e.audioEngine)||void 0===z?void 0:z.onAudioUnlockedObservable.addOnce((()=>{K()}))}};K()}}else{var T;const k=()=>{var k;if(null!==(k=wb.e.audioEngine)&&void 0!==k&&k.audioContext){var j;if(e=e||this._length,void 0!==b&&this._setOffset(b),this._soundSource){const K=this._soundSource;K.onended=()=>{K.disconnect()}}if(this._soundSource=null===(j=wb.e.audioEngine)||void 0===j?void 0:j.audioContext.createBufferSource(),this._soundSource&&this._inputAudioNode){var T;this._soundSource.buffer=this._audioBuffer,this._soundSource.connect(this._inputAudioNode),this._soundSource.loop=this.loop,void 0!==b&&(this._soundSource.loopStart=b),void 0!==e&&(this._soundSource.loopEnd=(0|b)+e),this._soundSource.playbackRate.value=this._playbackRate,this._soundSource.onended=()=>{this._onended()},z=K?(null===(T=wb.e.audioEngine)||void 0===T?void 0:T.audioContext.currentTime)+K:wb.e.audioEngine.audioContext.currentTime;const k=((this.isPaused?this.currentTime:0)+(this._offset??0))%this._soundSource.buffer.duration;this._soundSource.start(z,k,this.loop?void 0:e)}}};"suspended"===(null===(T=wb.e.audioEngine)||void 0===T?void 0:T.audioContext.state)?this._tryToPlayTimeout=setTimeout((()=>{var K;"suspended"===(null===(K=wb.e.audioEngine)||void 0===K?void 0:K.audioContext.state)?(wb.e.audioEngine.lock(),(this.loop||this.autoplay)&&(this._audioUnlockedObserver=wb.e.audioEngine.onAudioUnlockedObservable.addOnce((()=>{k()})))):k()}),500):k()}this._startTime=z,this.isPlaying=!0,this.isPaused=!1}catch(F){u.b.Error("Error while trying to play audio: "+this.name+", "+F.message)}}_onended(){this.isPlaying=!1,this._startTime=0,this._currentTime=0,this.onended&&this.onended(),this.onEndedObservable.notifyObservers(this)}stop(K){var b;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var e;if(this._htmlAudioElement)this._htmlAudioElement.pause(),this._htmlAudioElement.currentTime>0&&(this._htmlAudioElement.currentTime=0);else null===(e=this._streamingSource)||void 0===e||e.disconnect();this.isPlaying=!1}else if(null!==(b=wb.e.audioEngine)&&void 0!==b&&b.audioContext&&this._soundSource){const b=K?wb.e.audioEngine.audioContext.currentTime+K:void 0;this._soundSource.onended=()=>{this.isPlaying=!1,this.isPaused=!1,this._startTime=0,this._currentTime=0,this._soundSource&&(this._soundSource.onended=()=>{}),this._onended()},this._soundSource.stop(b)}else this.isPlaying=!1;else this.isPaused&&(this.isPaused=!1,this._startTime=0,this._currentTime=0)}pause(){var K;if(this.isPlaying)if(this._clearTimeoutsAndObservers(),this._streaming){var b;if(this._htmlAudioElement)this._htmlAudioElement.pause();else null===(b=this._streamingSource)||void 0===b||b.disconnect();this.isPlaying=!1,this.isPaused=!0}else null!==(K=wb.e.audioEngine)&&void 0!==K&&K.audioContext&&this._soundSource&&(this._soundSource.onended=()=>{},this._soundSource.stop(),this.isPlaying=!1,this.isPaused=!0,this._currentTime+=wb.e.audioEngine.audioContext.currentTime-this._startTime)}setVolume(K,b){var e;null!==(e=wb.e.audioEngine)&&void 0!==e&&e.canUseWebAudio&&this._soundGain&&(b&&wb.e.audioEngine.audioContext?(this._soundGain.gain.cancelScheduledValues(wb.e.audioEngine.audioContext.currentTime),this._soundGain.gain.setValueAtTime(this._soundGain.gain.value,wb.e.audioEngine.audioContext.currentTime),this._soundGain.gain.linearRampToValueAtTime(K,wb.e.audioEngine.audioContext.currentTime+b)):this._soundGain.gain.value=K),this._volume=K}setPlaybackRate(K){this._playbackRate=K,this.isPlaying&&(this._streaming&&this._htmlAudioElement?this._htmlAudioElement.playbackRate=this._playbackRate:this._soundSource&&(this._soundSource.playbackRate.value=this._playbackRate))}getPlaybackRate(){return this._playbackRate}getVolume(){return this._volume}attachToMesh(K){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null),this._connectedTransformNode=K,this._spatialSound||(this._spatialSound=!0,this._createSpatialParameters(),this.isPlaying&&this.loop&&(this.stop(),this.play(0,this._offset,this._length))),this._onRegisterAfterWorldMatrixUpdate(this._connectedTransformNode),this._registerFunc=K=>this._onRegisterAfterWorldMatrixUpdate(K),this._connectedTransformNode.registerAfterWorldMatrixUpdate(this._registerFunc)}detachFromMesh(){this._connectedTransformNode&&this._registerFunc&&(this._connectedTransformNode.unregisterAfterWorldMatrixUpdate(this._registerFunc),this._registerFunc=null,this._connectedTransformNode=null)}_onRegisterAfterWorldMatrixUpdate(K){var b;if(K.getBoundingInfo){const b=K.getBoundingInfo();this.setPosition(b.boundingSphere.centerWorld)}else this.setPosition(K.absolutePosition);null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._isDirectional&&this.isPlaying&&this._updateDirection()}clone(){if(this._streaming)return null;{const K=()=>{this._isReadyToPlay?(e._audioBuffer=this.getAudioBuffer(),e._isReadyToPlay=!0,e.autoplay&&e.play(0,this._offset,this._length)):setTimeout(K,300)},b={autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,useCustomAttenuation:this.useCustomAttenuation,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel},e=new hb(this.name+"_cloned",new ArrayBuffer(0),this._scene,null,b);return this.useCustomAttenuation&&e.setAttenuationFunction(this._customAttenuationFunction),e.setPosition(this._position),e.setPlaybackRate(this._playbackRate),K(),e}}getAudioBuffer(){return this._audioBuffer}getSoundSource(){return this._soundSource}getSoundGain(){return this._soundGain}serialize(){const K={name:this.name,url:this._url,autoplay:this.autoplay,loop:this.loop,volume:this._volume,spatialSound:this._spatialSound,maxDistance:this.maxDistance,rolloffFactor:this.rolloffFactor,refDistance:this.refDistance,distanceModel:this.distanceModel,playbackRate:this._playbackRate,panningModel:this._panningModel,soundTrackId:this.soundTrackId,metadata:this.metadata};return this._spatialSound&&(this._connectedTransformNode&&(K.connectedMeshId=this._connectedTransformNode.id),K.position=this._position.Ti(),K.refDistance=this.refDistance,K.distanceModel=this.distanceModel,K.isDirectional=this._isDirectional,K.localDirectionToMesh=this._localDirection.Ti(),K.coneInnerAngle=this._coneInnerAngle,K.coneOuterAngle=this._coneOuterAngle,K.coneOuterGain=this._coneOuterGain),K}static Parse(K,b,e,z){const j=K.name;let T;T=K.url?e+K.url:e+j;const F={autoplay:K.autoplay,loop:K.loop,volume:K.volume,spatialSound:K.spatialSound,maxDistance:K.maxDistance,rolloffFactor:K.rolloffFactor,refDistance:K.refDistance,distanceModel:K.distanceModel,playbackRate:K.playbackRate};let l;if(z){const K=()=>{z._isReadyToPlay?(l._audioBuffer=z.getAudioBuffer(),l._isReadyToPlay=!0,l.autoplay&&l.play(0,l._offset,l._length)):setTimeout(K,300)};l=new hb(j,new ArrayBuffer(0),b,null,F),K()}else l=new hb(j,T,b,(()=>{b.removePendingData(l)}),F),b.addPendingData(l);if(K.position){const b=k.k.Bg(K.position);l.setPosition(b)}if(K.isDirectional&&(l.setDirectionalCone(K.coneInnerAngle||360,K.coneOuterAngle||360,K.coneOuterGain||0),K.localDirectionToMesh)){const b=k.k.Bg(K.localDirectionToMesh);l.setLocalDirectionToMesh(b)}if(K.connectedMeshId){const e=b.getMeshById(K.connectedMeshId);e&&l.attachToMesh(e)}return K.metadata&&(l.metadata=K.metadata),l}_setOffset(K){this._offset!==K&&(this.isPaused&&(this.stop(),this.isPaused=!1),this._offset=K)}_clearTimeoutsAndObservers(){var K;(this._tryToPlayTimeout&&(clearTimeout(this._tryToPlayTimeout),this._tryToPlayTimeout=null),this._audioUnlockedObserver)&&(null===(K=wb.e.audioEngine)||void 0===K||K.onAudioUnlockedObservable.remove(this._audioUnlockedObserver),this._audioUnlockedObserver=null)}}hb._SceneComponentInitialization=K=>{throw(0,vb.c)("AudioSceneComponent")},(0,S.e)("BABYLON.Sound",hb);class Rb{constructor(K,b,e){if(this.loop=!1,this._coneInnerAngle=360,this._coneOuterAngle=360,this._volume=1,this.isPlaying=!1,this.isPaused=!1,this._sounds=[],this._weights=[],b.length!==e.length)throw new Error("Sounds length does not equal weights length");this.loop=K,this._weights=e;let z=0;for(const j of e)z+=j;const k=z>0?1/z:0;for(let j=0;j<this._weights.length;j++)this._weights[j]*=k;this._sounds=b;for(const j of this._sounds)j.onEndedObservable.add((()=>{this._onended()}))}get directionalConeInnerAngle(){return this._coneInnerAngle}set directionalConeInnerAngle(K){if(K!==this._coneInnerAngle){if(this._coneOuterAngle<K)return void u.b.Error("directionalConeInnerAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneInnerAngle=K;for(const b of this._sounds)b.directionalConeInnerAngle=K}}get directionalConeOuterAngle(){return this._coneOuterAngle}set directionalConeOuterAngle(K){if(K!==this._coneOuterAngle){if(K<this._coneInnerAngle)return void u.b.Error("directionalConeOuterAngle: outer angle of the cone must be superior or equal to the inner angle.");this._coneOuterAngle=K;for(const b of this._sounds)b.directionalConeOuterAngle=K}}get volume(){return this._volume}set volume(K){if(K!==this._volume)for(const b of this._sounds)b.setVolume(K)}_onended(){void 0!==this._currentIndex&&(this._sounds[this._currentIndex].autoplay=!1),this.loop&&this.isPlaying?this.play():this.isPlaying=!1}pause(){this.isPlaying&&(this.isPaused=!0,void 0!==this._currentIndex&&this._sounds[this._currentIndex].pause())}stop(){this.isPlaying=!1,void 0!==this._currentIndex&&this._sounds[this._currentIndex].stop()}play(K){if(!this.isPaused){this.stop();const K=Math.random();let b=0;for(let e=0;e<this._weights.length;e++)if(b+=this._weights[e],K<=b){this._currentIndex=e;break}}const b=this._sounds[this._currentIndex??0];b.isReady()?b.play(0,this.isPaused?void 0:K):b.autoplay=!0,this.isPlaying=!0,this.isPaused=!1}}class nb{constructor(K){let b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=-1,this._isInitialized=!1,(K=K||B.b.LastCreatedScene)&&(this._scene=K,this.soundCollection=[],this._options=b,!this._options.mainTrack&&this._scene.soundTracks&&(this._scene.soundTracks.push(this),this.id=this._scene.soundTracks.length-1))}_initializeSoundTrackAudioGraph(){var K;null!==(K=wb.e.audioEngine)&&void 0!==K&&K.canUseWebAudio&&wb.e.audioEngine.audioContext&&(this._outputAudioNode=wb.e.audioEngine.audioContext.createGain(),this._outputAudioNode.connect(wb.e.audioEngine.masterGain),this._options&&this._options.volume&&(this._outputAudioNode.gain.value=this._options.volume),this._isInitialized=!0)}dispose(){if(wb.e.audioEngine&&wb.e.audioEngine.canUseWebAudio){for(this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas();this.soundCollection.length;)this.soundCollection[0].dispose();this._outputAudioNode&&this._outputAudioNode.disconnect(),this._outputAudioNode=null}}addSound(K){var b;this._isInitialized||this._initializeSoundTrackAudioGraph(),null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&K.connectToSoundTrackAudioNode(this._outputAudioNode),void 0!==K.soundTrackId&&(-1===K.soundTrackId?this._scene.mainSoundTrack.removeSound(K):this._scene.soundTracks&&this._scene.soundTracks[K.soundTrackId].removeSound(K)),this.soundCollection.push(K),K.soundTrackId=this.id}removeSound(K){const b=this.soundCollection.indexOf(K);-1!==b&&this.soundCollection.splice(b,1)}setVolume(K){var b;null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.gain.value=K)}switchPanningModelToHRTF(){var K;if(null!==(K=wb.e.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToHRTF()}switchPanningModelToEqualPower(){var K;if(null!==(K=wb.e.audioEngine)&&void 0!==K&&K.canUseWebAudio)for(let b=0;b<this.soundCollection.length;b++)this.soundCollection[b].switchPanningModelToEqualPower()}connectToAnalyser(K){var b;this._connectedAnalyser&&this._connectedAnalyser.stopDebugCanvas(),this._connectedAnalyser=K,null!==(b=wb.e.audioEngine)&&void 0!==b&&b.canUseWebAudio&&this._outputAudioNode&&(this._outputAudioNode.disconnect(),this._connectedAnalyser.connectAudioNodes(this._outputAudioNode,wb.e.audioEngine.masterGain))}}var Pb=e(11049),db=e(10960),pb=(e(11533),e(10707));(0,e(11609).g)(Pb.e.NAME_AUDIO,((K,b,e,z)=>{let k,j=[];if(e.Kj=e.Kj||[],void 0!==K.Kj&&null!==K.Kj)for(let F=0,l=K.Kj.length;F<l;F++){var T;const l=K.Kj[F];null!==(T=wb.e.audioEngine)&&void 0!==T&&T.canUseWebAudio?(l.url||(l.url=l.name),j[l.url]?e.Kj.push(hb.Parse(l,b,z,j[l.url])):(k=hb.Parse(l,b,z),j[l.url]=k,e.Kj.push(k))):e.Kj.push(new hb(l.name,null,b))}j=[]})),Object.defineProperty(db.e.prototype,"mainSoundTrack",{get:function(){let K=this._getComponent(Pb.e.NAME_AUDIO);return K||(K=new ab(this),this.o(K)),this._mainSoundTrack||(this._mainSoundTrack=new nb(this,{mainTrack:!0})),this._mainSoundTrack},enumerable:!0,configurable:!0}),db.e.prototype.getSoundByName=function(K){let b;for(b=0;b<this.mainSoundTrack.soundCollection.length;b++)if(this.mainSoundTrack.soundCollection[b].name===K)return this.mainSoundTrack.soundCollection[b];if(this.soundTracks)for(let e=0;e<this.soundTracks.length;e++)for(b=0;b<this.soundTracks[e].soundCollection.length;b++)if(this.soundTracks[e].soundCollection[b].name===K)return this.soundTracks[e].soundCollection[b];return null},Object.defineProperty(db.e.prototype,"audioEnabled",{get:function(){let K=this._getComponent(Pb.e.NAME_AUDIO);return K||(K=new ab(this),this.o(K)),K.audioEnabled},set:function(K){let b=this._getComponent(Pb.e.NAME_AUDIO);b||(b=new ab(this),this.o(b)),K?b.enableAudio():b.disableAudio()},enumerable:!0,configurable:!0}),Object.defineProperty(db.e.prototype,"headphone",{get:function(){let K=this._getComponent(Pb.e.NAME_AUDIO);return K||(K=new ab(this),this.o(K)),K.headphone},set:function(K){let b=this._getComponent(Pb.e.NAME_AUDIO);b||(b=new ab(this),this.o(b)),K?b.switchAudioModeForHeadphones():b.switchAudioModeForNormalSpeakers()},enumerable:!0,configurable:!0}),Object.defineProperty(db.e.prototype,"audioListenerPositionProvider",{get:function(){let K=this._getComponent(Pb.e.NAME_AUDIO);return K||(K=new ab(this),this.o(K)),K.audioListenerPositionProvider},set:function(K){let b=this._getComponent(Pb.e.NAME_AUDIO);if(b||(b=new ab(this),this.o(b)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerPositionProvider] must be a function that returns a Vector3");b.audioListenerPositionProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(db.e.prototype,"audioListenerRotationProvider",{get:function(){let K=this._getComponent(Pb.e.NAME_AUDIO);return K||(K=new ab(this),this.o(K)),K.audioListenerRotationProvider},set:function(K){let b=this._getComponent(Pb.e.NAME_AUDIO);if(b||(b=new ab(this),this.o(b)),K&&"function"!==typeof K)throw new Error("The value passed to [Scene.audioListenerRotationProvider] must be a function that returns a Vector3");b.audioListenerRotationProvider=K},enumerable:!0,configurable:!0}),Object.defineProperty(db.e.prototype,"audioPositioningRefreshRate",{get:function(){let K=this._getComponent(Pb.e.NAME_AUDIO);return K||(K=new ab(this),this.o(K)),K.audioPositioningRefreshRate},set:function(K){let b=this._getComponent(Pb.e.NAME_AUDIO);b||(b=new ab(this),this.o(b)),b.audioPositioningRefreshRate=K},enumerable:!0,configurable:!0});class ab{get audioEnabled(){return this._audioEnabled}get headphone(){return this._headphone}constructor(K){this.name=Pb.e.NAME_AUDIO,this._audioEnabled=!0,this._headphone=!1,this.audioPositioningRefreshRate=500,this.audioListenerPositionProvider=null,this.audioListenerRotationProvider=null,this._cachedCameraDirection=new k.k,this._cachedCameraPosition=new k.k,this._lastCheck=0,this._invertMatrixTemp=new k.b,this._cameraDirectionTemp=new k.k,(K=K||B.b.LastCreatedScene)&&(this.Ad=K,K.soundTracks=[],K.Kj=[])}register(){this.Ad._afterRenderStage.registerStep(Pb.e.STEP_AFTERRENDER_AUDIO,this,this._afterRender)}rebuild(){}serialize(K){if(K.Kj=[],this.Ad.soundTracks)for(let b=0;b<this.Ad.soundTracks.length;b++){const e=this.Ad.soundTracks[b];for(let b=0;b<e.soundCollection.length;b++)K.Kj.push(e.soundCollection[b].serialize())}}addFromContainer(K){K.Kj&&K.Kj.forEach((K=>{K.play(),K.autoplay=!0,this.Ad.mainSoundTrack.addSound(K)}))}removeFromContainer(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];K.Kj&&K.Kj.forEach((K=>{K.stop(),K.autoplay=!1,this.Ad.mainSoundTrack.removeSound(K),b&&K.dispose()}))}dispose(){const K=this.Ad;if(K._mainSoundTrack&&K.mainSoundTrack.dispose(),K.soundTracks)for(let b=0;b<K.soundTracks.length;b++)K.soundTracks[b].dispose()}disableAudio(){const K=this.Ad;let b;for(this._audioEnabled=!1,wb.e.audioEngine&&wb.e.audioEngine.audioContext&&wb.e.audioEngine.audioContext.suspend(),b=0;b<K.mainSoundTrack.soundCollection.length;b++)K.mainSoundTrack.soundCollection[b].pause();if(K.soundTracks)for(b=0;b<K.soundTracks.length;b++)for(let e=0;e<K.soundTracks[b].soundCollection.length;e++)K.soundTracks[b].soundCollection[e].pause()}enableAudio(){const K=this.Ad;let b;for(this._audioEnabled=!0,wb.e.audioEngine&&wb.e.audioEngine.audioContext&&wb.e.audioEngine.audioContext.resume(),b=0;b<K.mainSoundTrack.soundCollection.length;b++)K.mainSoundTrack.soundCollection[b].isPaused&&K.mainSoundTrack.soundCollection[b].play();if(K.soundTracks)for(b=0;b<K.soundTracks.length;b++)for(let e=0;e<K.soundTracks[b].soundCollection.length;e++)K.soundTracks[b].soundCollection[e].isPaused&&K.soundTracks[b].soundCollection[e].play()}switchAudioModeForHeadphones(){const K=this.Ad;if(this._headphone=!0,K.mainSoundTrack.switchPanningModelToHRTF(),K.soundTracks)for(let b=0;b<K.soundTracks.length;b++)K.soundTracks[b].switchPanningModelToHRTF()}switchAudioModeForNormalSpeakers(){const K=this.Ad;if(this._headphone=!1,K.mainSoundTrack.switchPanningModelToEqualPower(),K.soundTracks)for(let b=0;b<K.soundTracks.length;b++)K.soundTracks[b].switchPanningModelToEqualPower()}_afterRender(){const K=pb.e.Now;if(this._lastCheck&&K-this._lastCheck<this.audioPositioningRefreshRate)return;this._lastCheck=K;const b=this.Ad;if(!this._audioEnabled||!b._mainSoundTrack||!b.soundTracks||0===b._mainSoundTrack.soundCollection.length&&1===b.soundTracks.length)return;const e=wb.e.audioEngine;if(e&&e.audioContext){let K,z=b.activeCamera;if(b.activeCameras&&b.activeCameras.length>0&&(z=b.activeCameras[0]),this.audioListenerPositionProvider){const K=this.audioListenerPositionProvider();e.audioContext.listener.setPosition(K.x||0,K.y||0,K.z||0)}else z?this._cachedCameraPosition.equals(z.globalPosition)||(this._cachedCameraPosition.p(z.globalPosition),e.audioContext.listener.setPosition(z.globalPosition.x,z.globalPosition.y,z.globalPosition.z)):e.audioContext.listener.setPosition(0,0,0);if(this.audioListenerRotationProvider){const K=this.audioListenerRotationProvider();e.audioContext.listener.setOrientation(K.x||0,K.y||0,K.z||0,0,1,0)}else z?(z.rigCameras&&z.rigCameras.length>0&&(z=z.rigCameras[0]),z.getViewMatrix().invertToRef(this._invertMatrixTemp),k.k.TransformNormalToRef(ab._CameraDirection,this._invertMatrixTemp,this._cameraDirectionTemp),this._cameraDirectionTemp.normalize(),isNaN(this._cameraDirectionTemp.x)||isNaN(this._cameraDirectionTemp.y)||isNaN(this._cameraDirectionTemp.z)||this._cachedCameraDirection.equals(this._cameraDirectionTemp)||(this._cachedCameraDirection.p(this._cameraDirectionTemp),e.audioContext.listener.setOrientation(this._cameraDirectionTemp.x,this._cameraDirectionTemp.y,this._cameraDirectionTemp.z,0,1,0))):e.audioContext.listener.setOrientation(0,0,0,0,1,0);for(K=0;K<b.mainSoundTrack.soundCollection.length;K++){const e=b.mainSoundTrack.soundCollection[K];e.useCustomAttenuation&&e.updateDistanceFromListener()}if(b.soundTracks)for(K=0;K<b.soundTracks.length;K++)for(let e=0;e<b.soundTracks[K].soundCollection.length;e++){const z=b.soundTracks[K].soundCollection[e];z.useCustomAttenuation&&z.updateDistanceFromListener()}}}}ab._CameraDirection=new k.k(0,0,-1),hb._SceneComponentInitialization=K=>{let b=K._getComponent(Pb.e.NAME_AUDIO);b||(b=new ab(K),K.o(b))};const Ob="MSFT_audio_emitter";class gb{constructor(K){this.name=Ob,this._loader=K,this.enabled=this._loader.isExtensionUsed(Ob)}dispose(){this._loader=null,this._clips=null,this._emitters=null}onLoading(){const K=this._loader.xi.extensions;if(K&&K[this.name]){const b=K[this.name];this._clips=b.clips,this._emitters=b.emitters,f.Assign(this._clips),f.Assign(this._emitters)}}loadSceneAsync(K,b){return V.LoadExtensionAsync(K,b,this.name,((e,z)=>{const k=new Array;k.push(this._loader.loadSceneAsync(K,b));for(const K of z.emitters){const b=f.Get(`${e}/emitters`,this._emitters,K);if(void 0!=b.refDistance||void 0!=b.maxDistance||void 0!=b.rolloffFactor||void 0!=b.distanceModel||void 0!=b.innerAngle||void 0!=b.outerAngle)throw new Error(`${e}: Direction or Distance properties are not allowed on emitters attached to a scene`);k.push(this._loadEmitterAsync(`${e}/emitters/${b.index}`,b))}return Promise.all(k).then((()=>{}))}))}loadNodeAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((K,z)=>{const j=new Array;return this._loader.loadNodeAsync(K,b,(b=>{for(const e of z.emitters){const z=f.Get(`${K}/emitters`,this._emitters,e);j.push(this._loadEmitterAsync(`${K}/emitters/${z.index}`,z).then((()=>{for(const K of z._babylonSounds)K.attachToMesh(b),void 0==z.innerAngle&&void 0==z.outerAngle||(K.setLocalDirectionToMesh(k.k.Forward()),K.setDirectionalCone(2*T.f.ToDegrees(void 0==z.innerAngle?Math.PI:z.innerAngle),2*T.f.ToDegrees(void 0==z.outerAngle?Math.PI:z.outerAngle),0))})))}e(b)})).then((K=>Promise.all(j).then((()=>K))))}))}loadAnimationAsync(K,b){return V.LoadExtensionAsync(K,b,this.name,((e,z)=>this._loader.loadAnimationAsync(K,b).then((k=>{const j=new Array;f.Assign(z.events);for(const T of z.events)j.push(this._loadAnimationEventAsync(`${e}/events/${T.index}`,K,b,T,k));return Promise.all(j).then((()=>k))}))))}_loadClipAsync(K,b){if(b._objectURL)return b._objectURL;let e;if(b.uri)e=this._loader.loadUriAsync(K,b,b.uri);else{const z=f.Get(`${K}/bufferView`,this._loader.xi.bufferViews,b.bufferView);e=this._loader.loadBufferViewAsync(`/bufferViews/${z.index}`,z)}return b._objectURL=e.then((K=>URL.createObjectURL(new Blob([K],{type:b.mimeType})))),b._objectURL}_loadEmitterAsync(K,b){if(b._babylonSounds=b._babylonSounds||[],!b._babylonData){const K=new Array,e=b.name||`emitter${b.index}`,z={loop:!1,autoplay:!1,volume:void 0==b.volume?1:b.volume};for(let j=0;j<b.clips.length;j++){const k=`/extensions/${this.name}/clips`,T=f.Get(k,this._clips,b.clips[j].clip);K.push(this._loadClipAsync(`${k}/${b.clips[j].clip}`,T).then((K=>{const k=b._babylonSounds[j]=new hb(e,K,this._loader.babylonScene,null,z);k.refDistance=b.refDistance||1,k.maxDistance=b.maxDistance||256,k.rolloffFactor=b.rolloffFactor||1,k.distanceModel=b.distanceModel||"exponential"})))}const k=Promise.all(K).then((()=>{const K=b.clips.map((K=>K.weight||1)),e=new Rb(b.loop||!1,b._babylonSounds,K);b.innerAngle&&(e.directionalConeInnerAngle=2*T.f.ToDegrees(b.innerAngle)),b.outerAngle&&(e.directionalConeOuterAngle=2*T.f.ToDegrees(b.outerAngle)),b.volume&&(e.volume=b.volume),b._babylonData.sound=e}));b._babylonData={loaded:k}}return b._babylonData.loaded}_getEventAction(K,b,e,z,k){switch(e){case"play":return K=>{const e=(k||0)+(K-z);b.play(e)};case"stop":return()=>{b.stop()};case"pause":return()=>{b.pause()};default:throw new Error(`${K}: Unsupported action ${e}`)}}_loadAnimationEventAsync(K,b,e,z,k){if(0==k.targetedAnimations.length)return Promise.resolve();const j=k.targetedAnimations[0],T=z.j,F=f.Get(`/extensions/${this.name}/emitters`,this._emitters,T);return this._loadEmitterAsync(K,F).then((()=>{const b=F._babylonData.sound;if(b){const e=new cb(z.time,this._getEventAction(K,b,z.action,z.time,z.startOffset));j.animation.addEvent(e),k.onAnimationGroupEndObservable.add((()=>{b.stop()})),k.onAnimationGroupPauseObservable.add((()=>{b.pause()}))}}))}}H(Ob),C(Ob,!0,(K=>new gb(K)));const Nb="MSFT_lod";class Zb{constructor(K){var b;this.name=Nb,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new A.d,this.onMaterialLODsLoadedObservable=new A.d,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=K,this.maxLODsToLoad=(null===(b=this._loader.parent.extensionOptions[Nb])||void 0===b?void 0:b.maxLODsToLoad)??this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Nb)}dispose(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()}onReady(){for(let K=0;K<this._nodePromiseLODs.length;K++){const b=Promise.all(this._nodePromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Node LOD ${K}`),this._loader.log(`Loaded node LOD ${K}`)),this.onNodeLODsLoadedObservable.notifyObservers(K),K!==this._nodePromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Node LOD ${K+1}`),this._loadBufferLOD(this._nodeBufferLODs,K+1),this._nodeSignalLODs[K]&&this._nodeSignalLODs[K].resolve())}));this._loader._completePromises.push(b)}for(let K=0;K<this._materialPromiseLODs.length;K++){const b=Promise.all(this._materialPromiseLODs[K]).then((()=>{0!==K&&(this._loader.endPerformanceCounter(`Material LOD ${K}`),this._loader.log(`Loaded material LOD ${K}`)),this.onMaterialLODsLoadedObservable.notifyObservers(K),K!==this._materialPromiseLODs.length-1&&(this._loader.startPerformanceCounter(`Material LOD ${K+1}`),this._loadBufferLOD(this._materialBufferLODs,K+1),this._materialSignalLODs[K]&&this._materialSignalLODs[K].resolve())}));this._loader._completePromises.push(b)}}loadSceneAsync(K,b){const e=this._loader.loadSceneAsync(K,b);return this._loadBufferLOD(this._bufferLODs,0),e}loadNodeAsync(K,b,e){return V.LoadExtensionAsync(K,b,this.name,((K,k)=>{let j;const T=this._getLODs(K,b,this._loader.xi.nodes,k.ids);this._loader.logOpen(`${K}`);for(let b=0;b<T.length;b++){const K=T[b];0!==b&&(this._nodeIndexLOD=b,this._nodeSignalLODs[b]=this._nodeSignalLODs[b]||new z);const k=K=>{e(K),K.yb(!1)},F=this._loader.loadNodeAsync(`/nodes/${K.index}`,K,k).then((K=>{if(0!==b){const K=T[b-1];K._babylonTransformNode&&(this._disposeTransformNode(K._babylonTransformNode),delete K._babylonTransformNode)}return K.yb(!0),K}));this._nodePromiseLODs[b]=this._nodePromiseLODs[b]||[],0===b?j=F:(this._nodeIndexLOD=null,this._nodePromiseLODs[b].push(F))}return this._loader.logClose(),j}))}_loadMaterialAsync(K,b,e,z,k){return this._nodeIndexLOD?null:V.LoadExtensionAsync(K,b,this.name,((K,j)=>{let T;const F=this._getLODs(K,b,this._loader.xi.materials,j.ids);this._loader.logOpen(`${K}`);for(let b=0;b<F.length;b++){const K=F[b];0!==b&&(this._materialIndexLOD=b);const j=this._loader._loadMaterialAsync(`/materials/${K.index}`,K,e,z,(K=>{0===b&&k(K)})).then((K=>{if(0!==b){k(K);const e=F[b-1]._data;e[z]&&(this._disposeMaterials([e[z].babylonMaterial]),delete e[z])}return K}));this._materialPromiseLODs[b]=this._materialPromiseLODs[b]||[],0===b?T=j:(this._materialIndexLOD=null,this._materialPromiseLODs[b].push(j))}return this._loader.logClose(),T}))}_loadUriAsync(K,b,e){if(null!==this._nodeIndexLOD){this._loader.log("deferred");const k=this._nodeIndexLOD-1;return this._nodeSignalLODs[k]=this._nodeSignalLODs[k]||new z,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((()=>this._loader.loadUriAsync(K,b,e)))}if(null!==this._materialIndexLOD){this._loader.log("deferred");const k=this._materialIndexLOD-1;return this._materialSignalLODs[k]=this._materialSignalLODs[k]||new z,this._materialSignalLODs[k].promise.then((()=>this._loader.loadUriAsync(K,b,e)))}return null}loadBufferAsync(K,b,e,k){if(this._loader.parent.useRangeRequests&&!b.uri){if(!this._loader.bin)throw new Error(`${K}: Uri is missing or the binary glTF is missing its binary chunk`);const b=(K,b)=>{const j=e,T=j+k-1;let F=K[b];return F?(F.start=Math.min(F.start,j),F.end=Math.max(F.end,T)):(F={start:j,end:T,loaded:new z},K[b]=F),F.loaded.promise.then((K=>new Uint8Array(K.buffer,K.byteOffset+e-F.start,k)))};return this._loader.log("deferred"),null!==this._nodeIndexLOD?b(this._nodeBufferLODs,this._nodeIndexLOD):null!==this._materialIndexLOD?b(this._materialBufferLODs,this._materialIndexLOD):b(this._bufferLODs,0)}return null}_loadBufferLOD(K,b){const e=K[b];e&&(this._loader.log(`Loading buffer range [${e.start}-${e.end}]`),this._loader.bin.readAsync(e.start,e.end-e.start+1).then((K=>{e.loaded.resolve(K)}),(K=>{e.loaded.reject(K)})))}_getLODs(K,b,e,z){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");const k=[];for(let j=z.length-1;j>=0;j--)if(k.push(f.Get(`${K}/ids/${z[j]}`,e,z[j])),k.length===this.maxLODsToLoad)return k;return k.push(b),k}_disposeTransformNode(K){const b=[],e=K.material;e&&b.push(e);for(const k of K.getChildMeshes())k.material&&b.push(k.material);K.dispose();const z=b.filter((K=>this._loader.babylonScene.meshes.every((b=>b.material!=K))));this._disposeMaterials(z)}_disposeMaterials(K){const b={};for(const e of K){for(const K of e.getActiveTextures())b[K.uniqueId]=K;e.dispose()}for(const e in b)for(const K of this._loader.babylonScene.materials)K.hasTexture(b[e])&&delete b[e];for(const e in b)b[e].dispose()}}H(Nb),C(Nb,!0,(K=>new Zb(K)));const yb="MSFT_minecraftMesh";class sb{constructor(K){this.name=yb,this._loader=K,this.enabled=this._loader.isExtensionUsed(yb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtraAsync(K,b,this.name,((z,k)=>{if(k){if(!(e instanceof r))throw new Error(`${z}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(K,b,e);return e.needAlphaBlending()&&(e.forceDepthWrite=!0,e.separateCullingPass=!0),e.Lg=e.forceDepthWrite,e.twoSidedLighting=!0,k}return null}))}}H(yb),C(yb,!0,(K=>new sb(K)));const Eb="MSFT_sRGBFactors";class ob{constructor(K){this.name=Eb,this._loader=K,this.enabled=this._loader.isExtensionUsed(Eb)}dispose(){this._loader=null}loadMaterialPropertiesAsync(K,b,e){return V.LoadExtraAsync(K,b,this.name,((z,k)=>{if(k){if(!(e instanceof r))throw new Error(`${z}: Material type not supported`);const k=this._loader.loadMaterialPropertiesAsync(K,b,e),j=e.va().getEngine().useExactSrgbConversions;return e.albedoTexture||e.albedoColor.toLinearSpaceToRef(e.albedoColor,j),e.reflectivityTexture||e.reflectivityColor.toLinearSpaceToRef(e.reflectivityColor,j),k}return null}))}}H(Eb),C(Eb,!0,(K=>new ob(K)));var Cb,Hb=e(10801);!function(K){K[K.Input=0]="Input",K[K.Output=1]="Output"}(Cb||(Cb={}));class Wb{constructor(K,b,e){this._ownerBlock=e,this._connectedPoint=[],this.uniqueId=(0,Hb.b)(),this.connectedPointIds=[],this.name=K,this._connectionType=b}get connectionType(){return this._connectionType}_isSingularConnection(){return!0}isConnected(){return this._connectedPoint.length>0}connectTo(K){if(this._connectionType===K._connectionType)throw new Error(`Cannot connect two points of type ${this.connectionType}`);if(this._isSingularConnection()&&this._connectedPoint.length>0||K._isSingularConnection()&&K._connectedPoint.length>0)throw new Error("Max number of connections for point reached");this._connectedPoint.push(K),K._connectedPoint.push(this)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K.uniqueId=this.uniqueId,K.name=this.name,K._connectionType=this._connectionType,K.connectedPointIds=[],K.className=this.getClassName();for(const b of this._connectedPoint)K.connectedPointIds.push(b.uniqueId)}getClassName(){return"FGConnection"}deserialize(K){this.uniqueId=K.uniqueId,this.name=K.name,this._connectionType=K._connectionType,this.connectedPointIds=K.connectedPointIds}static Parse(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;const e=new(T.f.Instantiate(K.className))(K.name,K._connectionType,b);return e.deserialize(K),e}}class fb{constructor(K){this.value=this._toInt(K)}_toInt(K){return 0|K}add(K){return new fb(this.value+K.value)}Qc(K){return new fb(this.value-K.value)}multiply(K){return new fb(Math.imul(this.value,K.value))}divide(K){return new fb(this.value/K.value)}getClassName(){return fb.ClassName}equals(K){return this.value===K.value}static Parse(K){return new fb(K.value)}}fb.ClassName="FlowGraphInteger",(0,S.e)("FlowGraphInteger",fb);class Vb{constructor(K,b){this.typeName=K,this.defaultValue=b}serialize(K){K.typeName=this.typeName,K.defaultValue=this.defaultValue}static Parse(K){return new Vb(K.typeName,K.defaultValue)}}const qb=new Vb("any",void 0),Jb=(new Vb("string",""),new Vb("number",0)),Ke=new Vb("boolean",!1),be=new Vb("Vector2",k.h.Zero()),ee=new Vb("gb",k.k.Zero()),ze=(new Vb("Vector4",k.o.Zero()),new Vb("Matrix",k.b.Identity())),ke=(new Vb("hb",j.c.Black()),new Vb("pb",new j.g(0,0,0,0)),new Vb("Quaternion",k.d.Identity()),new Vb("FlowGraphInteger",new fb(0)));class je extends Wb{constructor(K,b,e,z){super(K,b,e),this.richType=z}_isSingularConnection(){return 0===this.connectionType}setValue(K,b){b._setConnectionValue(this,K)}connectTo(K){super.connectTo(K)}_getValueOrDefault(K){return K._hasConnectionValue(this)?K._getConnectionValue(this):this.richType.defaultValue}getValue(K){return 1===this.connectionType?(K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._updateOutputs(K),this._getValueOrDefault(K)):this.isConnected()?this._connectedPoint[0].getValue(K):this._getValueOrDefault(K)}getClassName(){return"FGDataConnection"}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.richType={},this.richType.serialize(K.richType)}static Parse(K,b){const e=Wb.Parse(K,b);return e.richType=Vb.Parse(K.richType),e}}function Te(K){return"Mesh"===K||"AbstractMesh"===K||"GroundMesh"===K||"InstanceMesh"===K||"LinesMesh"===K||"GoldbergMesh"===K||"GreasedLineMesh"===K||"TrailMesh"===K}function Fe(K){return"Vector2"===K||"gb"===K||"Vector4"===K||"Quaternion"===K||"hb"===K||"pb"===K}function le(K,b,e){var z;const k=(null===b||void 0===b||null===(z=b.getClassName)||void 0===z?void 0:z.call(b))??"";Te(k)?e[K]={name:b.name,className:k}:Fe(k)?e[K]={value:b.Ti(),className:k}:e[K]=b}function Ye(K,b,e){const z=b[K];let T;const F=null===z||void 0===z?void 0:z.className;return T=Te(F)?e.getMeshByName(z.name):Fe(F)?function(K,b){if("Vector2"===K)return k.h.Bg(b);if("gb"===K)return k.k.Bg(b);if("Vector4"===K)return k.o.Bg(b);if("Quaternion"===K)return k.d.Bg(b);if("hb"===K)return new j.c(b[0],b[1],b[2]);if("pb"===K)return new j.g(b[0],b[1],b[2],b[3]);throw new Error(`Unknown vector class name ${K}`)}(F,z.value):"Matrix"===F?k.b.Bg(z.value):F===fb.ClassName?fb.Parse(z):z&&void 0!==z.value?z.value:z,T}(0,S.e)("FGDataConnection",je);class Ae{constructor(K){var b;this.config=K,this.uniqueId=(0,Hb.b)(),this.name=(null===(b=this.config)||void 0===b?void 0:b.name)??this.getClassName(),this.dataInputs=[],this.dataOutputs=[]}_updateOutputs(K){}registerDataInput(K,b){const e=new je(K,0,this,b);return this.dataInputs.push(e),e}registerDataOutput(K,b){const e=new je(K,1,this,b);return this.dataOutputs.push(e),e}getDataInput(K){return this.dataInputs.find((b=>b.name===K))}getDataOutput(K){return this.dataOutputs.find((b=>b.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};K.uniqueId=this.uniqueId,K.config={},this.config&&(K.config.name=this.config.name),K.dataInputs=[],K.dataOutputs=[],K.className=this.getClassName();for(const b of this.dataInputs){const e={};b.serialize(e),K.dataInputs.push(e)}for(const b of this.dataOutputs){const e={};b.serialize(e),K.dataOutputs.push(e)}}getClassName(){return"FGBlock"}static Parse(K,b){const e=T.f.Instantiate(K.className),z={},k=b.valueParseFunction??Ye;if(K.config)for(const T in K.config)z[T]=k(T,K.config,b.Ad);var j;("FGSetPropertyBlock"===(j=K.className)||"FGGetPropertyBlock"===j||"FGPlayAnimationBlock"===j||"FGMeshPickEventBlock"===j)&&(z.pathConverter=b.pathConverter);const F=new e(z);F.uniqueId=K.uniqueId;for(let T=0;T<K.dataInputs.length;T++){const b=F.getDataInput(K.dataInputs[T].name);if(!b)throw new Error("Could not find data input with name "+K.dataInputs[T].name+" in block "+K.className);b.deserialize(K.dataInputs[T])}for(let T=0;T<K.dataOutputs.length;T++){const b=F.getDataOutput(K.dataOutputs[T].name);if(!b)throw new Error("Could not find data output with name "+K.dataOutputs[T].name+" in block "+K.className);b.deserialize(K.dataOutputs[T])}return F.metadata=K.metadata,F.deserialize&&F.deserialize(K),F}}class Xe extends Wb{_isSingularConnection(){return 1===this.connectionType}_activateSignal(K){var b;0===this.connectionType?(K._notifyExecuteNode(this._ownerBlock),this._ownerBlock._execute(K,this),K._increaseExecutionId()):null===(b=this._connectedPoint[0])||void 0===b||b._activateSignal(K)}}(0,S.e)("FlowGraphSignalConnection",Xe);class te extends Ae{constructor(K){super(K),this.signalInputs=[],this.signalOutputs=[],this.in=this._registerSignalInput("in")}_registerSignalInput(K){const b=new Xe(K,0,this);return this.signalInputs.push(b),b}_registerSignalOutput(K){const b=new Xe(K,1,this);return this.signalOutputs.push(b),b}getSignalInput(K){return this.signalInputs.find((b=>b.name===K))}getSignalOutput(K){return this.signalOutputs.find((b=>b.name===K))}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.signalInputs=[],K.signalOutputs=[];for(const b of this.signalInputs){const e={};b.serialize(e),K.signalInputs.push(e)}for(const b of this.signalOutputs){const e={};b.serialize(e),K.signalOutputs.push(e)}}deserialize(K){for(let b=0;b<K.signalInputs.length;b++){const e=this.getSignalInput(K.signalInputs[b].name);if(!e)throw new Error("Could not find signal input with name "+K.signalInputs[b].name+" in block "+K.className);e.deserialize(K.signalInputs[b])}for(let b=0;b<K.signalOutputs.length;b++){const e=this.getSignalOutput(K.signalOutputs[b].name);if(!e)throw new Error("Could not find signal output with name "+K.signalOutputs[b].name+" in block "+K.className);e.deserialize(K.signalOutputs[b])}}getClassName(){return"FGExecutionBlock"}}class Ue extends te{constructor(K){super(K),this.out=this._registerSignalOutput("out"),this.done=this._registerSignalOutput("done")}_startPendingTasks(K){this._preparePendingTasks(K),K._addPendingBlock(this)}}class Be extends Ue{_execute(K){K._notifyExecuteNode(this),this.out._activateSignal(K)}}class ue{constructor(K){this.uniqueId=(0,Hb.b)(),this._userVariables={},this._executionVariables={},this._connectionValues={},this._pendingBlocks=[],this._executionId=0,this.onNodeExecutedObservable=new A.d,this._configuration=K}hasVariable(K){return K in this._userVariables}setVariable(K,b){this._userVariables[K]=b}getVariable(K){return this._userVariables[K]}get userVariables(){return this._userVariables}_getUniqueIdPrefixedName(K,b){return`${K.uniqueId}_${b}`}_setExecutionVariable(K,b,e){this._executionVariables[this._getUniqueIdPrefixedName(K,b)]=e}_getExecutionVariable(K,b,e){return this._hasExecutionVariable(K,b)?this._executionVariables[this._getUniqueIdPrefixedName(K,b)]:e}_deleteExecutionVariable(K,b){delete this._executionVariables[this._getUniqueIdPrefixedName(K,b)]}_hasExecutionVariable(K,b){return this._getUniqueIdPrefixedName(K,b)in this._executionVariables}_hasConnectionValue(K){return K.uniqueId in this._connectionValues}_setConnectionValue(K,b){this._connectionValues[K.uniqueId]=b}_getConnectionValue(K){return this._connectionValues[K.uniqueId]}get configuration(){return this._configuration}_addPendingBlock(K){this._pendingBlocks.push(K)}_removePendingBlock(K){const b=this._pendingBlocks.indexOf(K);-1!==b&&this._pendingBlocks.splice(b,1)}_clearPendingBlocks(){for(const K of this._pendingBlocks)K._cancelPendingTasks(this);this._pendingBlocks.length=0}_notifyExecuteNode(K){this.onNodeExecutedObservable.notifyObservers(K)}_increaseExecutionId(){this._executionId++}get executionId(){return this._executionId}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:le;K.uniqueId=this.uniqueId,K._userVariables={};for(const e in this._userVariables)b(e,this._userVariables[e],K._userVariables);K._connectionValues={};for(const e in this._connectionValues)b(e,this._connectionValues[e],K._connectionValues)}getClassName(){return"FGContext"}static Parse(K,b){const e=b.graph.createContext(),z=b.valueParseFunction??Ye;e.uniqueId=K.uniqueId;for(const k in K._userVariables){const b=z(k,K._userVariables,e._configuration.Ad);e._userVariables[k]=b}for(const k in K._connectionValues){const b=z(k,K._connectionValues,e._configuration.Ad);e._connectionValues[k]=b}return e}}(0,x.b)([(0,Q.M)()],ue.prototype,"uniqueId",void 0);var me,De,Ie=e(11054);function xe(K,b){return!(!K.parent||K.parent!==b&&!xe(K.parent,b))}class Qe extends Be{constructor(K){super(K),this.config=K}_getReferencedMesh(){const K=this.config.pathConverter.convert(this.config.path),b=K.info.getObject(K.object);if(!b||!(b instanceof h.e))throw new Error("Mesh pick event block requires a valid mesh");return b}_preparePendingTasks(K){let b=K._getExecutionVariable(this,"meshPickObserver");if(!b){const e=this._getReferencedMesh();K._setExecutionVariable(this,"mesh",e),b=e.va().onPointerObservable.add((b=>{var z,k,j;b.type===Ie.b.POINTERPICK&&null!==(z=b.pickInfo)&&void 0!==z&&z.pickedMesh&&((null===(k=b.pickInfo)||void 0===k?void 0:k.pickedMesh)===e||xe(null===(j=b.pickInfo)||void 0===j?void 0:j.pickedMesh,e))&&this._execute(K)}));const z=e.Ui.add((()=>this._onDispose));K._setExecutionVariable(this,"meshPickObserver",b),K._setExecutionVariable(this,"meshDisposeObserver",z)}}_onDispose(K){this._cancelPendingTasks(K),K._removePendingBlock(this)}_cancelPendingTasks(K){const b=K._getExecutionVariable(this,"mesh"),e=K._getExecutionVariable(this,"meshPickObserver"),z=K._getExecutionVariable(this,"meshDisposeObserver");b.va().onPointerObservable.remove(e),b.Ui.remove(z),K._deleteExecutionVariable(this,"mesh"),K._deleteExecutionVariable(this,"meshPickObserver"),K._deleteExecutionVariable(this,"meshDisposeObserver")}getClassName(){return Qe.ClassName}serialize(K){super.serialize(K),K.config.path=this.config.path}}Qe.ClassName="FGMeshPickEventBlock",(0,S.e)(Qe.ClassName,Qe),function(K){K[K.Stopped=0]="Stopped",K[K.Started=1]="Started"}(me||(me={}));class Ge{constructor(K){this._eventBlocks=[],this._executionContexts=[],this.state=0,this._scene=K.Ad,this._coordinator=K.coordinator,this._sceneDisposeObserver=this._scene.Ui.add((()=>this.dispose()))}createContext(){const K=new ue({Ad:this._scene,coordinator:this._coordinator});return this._executionContexts.push(K),K}getContext(K){return this._executionContexts[K]}addEventBlock(K){this._eventBlocks.push(K)}start(){if(1!==this.state){this.state=1,0===this._executionContexts.length&&this.createContext();for(const K of this._executionContexts){const b=this._getContextualOrder();for(const e of b)e._startPendingTasks(K)}}}_getContextualOrder(){const K=[];for(const b of this._eventBlocks)if(b.getClassName()===Qe.ClassName){const e=b._getReferencedMesh();let z=0;for(;z<K.length;z++){const b=K[z]._getReferencedMesh();if(e&&b&&xe(e,b))break}K.splice(z,0,b)}else K.push(b);return K}dispose(){if(0!==this.state){this.state=0;for(const K of this._executionContexts)K._clearPendingBlocks();this._executionContexts.length=0,this._eventBlocks.length=0,this._scene.Ui.remove(this._sceneDisposeObserver),this._sceneDisposeObserver=null}}visitAllBlocks(K){const b=[],e=new Set;for(const z of this._eventBlocks)b.push(z),e.add(z.uniqueId);for(;b.length>0;){const z=b.pop();K(z);for(const K of z.dataInputs)for(const z of K._connectedPoint)e.has(z._ownerBlock.uniqueId)||(b.push(z._ownerBlock),e.add(z._ownerBlock.uniqueId));if(z instanceof te)for(const K of z.signalOutputs)for(const z of K._connectedPoint)e.has(z._ownerBlock.uniqueId)||(b.push(z._ownerBlock),e.add(z._ownerBlock.uniqueId))}}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=arguments.length>1?arguments[1]:void 0;K.allBlocks=[],this.visitAllBlocks((b=>{const e={};b.serialize(e),K.allBlocks.push(e)})),K.executionContexts=[];for(const e of this._executionContexts){const z={};e.serialize(z,b),K.executionContexts.push(z)}}static GetDataOutConnectionByUniqueId(K,b){for(const e of K)for(const K of e.dataOutputs)if(K.uniqueId===b)return K;throw new Error("Could not find data out connection with unique id "+b)}static GetSignalInConnectionByUniqueId(K,b){for(const e of K)if(e instanceof te)for(const K of e.signalInputs)if(K.uniqueId===b)return K;throw new Error("Could not find signal in connection with unique id "+b)}static Parse(K,b){const e=b.coordinator.createGraph(),z=[],k=b.valueParseFunction??Ye;for(const j of K.allBlocks){const K=Ae.Parse(j,{Ad:b.coordinator.config.Ad,pathConverter:b.pathConverter,valueParseFunction:k});z.push(K),K instanceof Be&&e.addEventBlock(K)}for(const j of z){for(const K of j.dataInputs)for(const b of K.connectedPointIds){const e=Ge.GetDataOutConnectionByUniqueId(z,b);K.connectTo(e)}if(j instanceof te)for(const K of j.signalOutputs)for(const b of K.connectedPointIds){const e=Ge.GetSignalInConnectionByUniqueId(z,b);K.connectTo(e)}}for(const j of K.executionContexts)ue.Parse(j,{graph:e,valueParseFunction:k});return e}}class ie{constructor(K){this.config=K,this._flowGraphs=[],this._customEventsMap=new Map,this.config.Ad.Ui.add((()=>{this.dispose()}));(ie.SceneCoordinators.get(this.config.Ad)??[]).push(this)}createGraph(){const K=new Ge({Ad:this.config.Ad,coordinator:this});return this._flowGraphs.push(K),K}removeGraph(K){const b=this._flowGraphs.indexOf(K);-1!==b&&(K.dispose(),this._flowGraphs.splice(b,1))}start(){this._flowGraphs.forEach((K=>K.start()))}dispose(){this._flowGraphs.forEach((K=>K.dispose())),this._flowGraphs.length=0;const K=ie.SceneCoordinators.get(this.config.Ad)??[],b=K.indexOf(this);-1!==b&&K.splice(b,1)}serialize(K,b){K._flowGraphs=[],this._flowGraphs.forEach((e=>{const z={};e.serialize(z,b),K._flowGraphs.push(z)}))}static Parse(K,b){var e;const z=b.valueParseFunction??Ye,k=new ie({Ad:b.Ad});return null===(e=K._flowGraphs)||void 0===e||e.forEach((K=>{Ge.Parse(K,{coordinator:k,valueParseFunction:z,pathConverter:b.pathConverter})})),k}get flowGraphs(){return this._flowGraphs}getCustomEventObservable(K){let b=this._customEventsMap.get(K);return b||(b=new A.d,this._customEventsMap.set(K,b)),b}notifyCustomEvent(K,b){const e=this._customEventsMap.get(K);e&&e.notifyObservers(b)}}ie.SceneCoordinators=new Map;class Se extends Be{_preparePendingTasks(K){if(!K._getExecutionVariable(this,"sceneReadyObserver")){const b=K.configuration.Ad.onReadyObservable.add((()=>{this._execute(K)}));K._setExecutionVariable(this,"sceneReadyObserver",b)}}_cancelPendingTasks(K){const b=K._getExecutionVariable(this,"sceneReadyObserver");K.configuration.Ad.onReadyObservable.remove(b),K._deleteExecutionVariable(this,"sceneReadyObserver")}getClassName(){return Se.ClassName}}Se.ClassName="FGSceneReadyEventBlock",(0,S.e)("FGSceneReadyEventBlock",Se);class Me extends Be{_preparePendingTasks(K){if(!K._getExecutionVariable(this,"sceneBeforeRender")){const b=K.configuration.Ad.onBeforeRenderObservable.add((()=>{this._execute(K)}));K._setExecutionVariable(this,"sceneBeforeRender",b)}}_cancelPendingTasks(K){const b=K._getExecutionVariable(this,"sceneBeforeRender");K.configuration.Ad.onBeforeRenderObservable.remove(b),K._deleteExecutionVariable(this,"sceneBeforeRender")}getClassName(){return Me.ClassName}}Me.ClassName="FGSceneTickEventBlock",(0,S.e)(Me.ClassName,Me);class re extends te{constructor(K){super(K),this.out=this._registerSignalOutput("out")}}class Le extends re{constructor(K){super(K),this.message=this.registerDataInput("message",qb)}_execute(K){const b=this.message.getValue(K);u.b.Log(b),this.out._activateSignal(K)}getClassName(){return Le.ClassName}}Le.ClassName="FGConsoleLogBlock",(0,S.e)(Le.ClassName,Le),function(K){K[K.INIT=0]="INIT",K[K.STARTED=1]="STARTED",K[K.ENDED=2]="ENDED"}(De||(De={}));class ce{constructor(K){this.onEachCountObservable=new A.d,this.onTimerAbortedObservable=new A.d,this.onTimerEndedObservable=new A.d,this.onStateChangedObservable=new A.d,this._observer=null,this._breakOnNextTick=!1,this._tick=K=>{const b=Date.now();this._timer=b-this._startTime;const e={startTime:this._startTime,currentTime:b,deltaTime:this._timer,completeRate:this._timer/this._timeToEnd,payload:K},z=this._breakOnNextTick||this._breakCondition(e);z||this._timer>=this._timeToEnd?this._stop(e,z):this.onEachCountObservable.notifyObservers(e)},this._setState(0),this._contextObservable=K.contextObservable,this._observableParameters=K.observableParameters??{},this._breakCondition=K.breakCondition??(()=>!1),this._timeToEnd=K.timeout,K.onEnded&&this.onTimerEndedObservable.add(K.onEnded),K.Nh&&this.onEachCountObservable.add(K.Nh),K.onAborted&&this.onTimerAbortedObservable.add(K.onAborted)}set breakCondition(K){this._breakCondition=K}clearObservables(){this.onEachCountObservable.clear(),this.onTimerAbortedObservable.clear(),this.onTimerEndedObservable.clear(),this.onStateChangedObservable.clear()}start(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._timeToEnd;if(1===this._state)throw new Error("Timer already started. Please stop it before starting again");this._timeToEnd=K,this._startTime=Date.now(),this._timer=0,this._observer=this._contextObservable.add(this._tick,this._observableParameters.mask,this._observableParameters.insertFirst,this._observableParameters.scope),this._setState(1)}stop(){1===this._state&&(this._breakOnNextTick=!0)}dispose(){this._observer&&this._contextObservable.remove(this._observer),this.clearObservables()}_setState(K){this._state=K,this.onStateChangedObservable.notifyObservers(this._state)}_stop(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._contextObservable.remove(this._observer),this._setState(2),b?this.onTimerAbortedObservable.notifyObservers(K):this.onTimerEndedObservable.notifyObservers(K)}}class ve extends Ue{constructor(K){super(K),this.timeout=this.registerDataInput("timeout",Jb)}_preparePendingTasks(K){const b=this.timeout.getValue(K);if(void 0!==b&&b>=0){const e=K._getExecutionVariable(this,"runningTimers")||[],z=K.configuration.Ad,k=new ce({timeout:b,contextObservable:z.onBeforeRenderObservable,onEnded:()=>this._onEnded(k,K)});k.start(),e.push(k),K._setExecutionVariable(this,"runningTimers",e)}}_execute(K){this._startPendingTasks(K),this.out._activateSignal(K)}_onEnded(K,b){const e=b._getExecutionVariable(this,"runningTimers")||[],z=e.indexOf(K);-1!==z?e.splice(z,1):T.f.Warn("FlowGraphTimerBlock: Timer ended but was not found in the running timers list"),b._removePendingBlock(this),this.done._activateSignal(b)}_cancelPendingTasks(K){const b=K._getExecutionVariable(this,"runningTimers")||[];for(const e of b)e.dispose();K._deleteExecutionVariable(this,"runningTimers")}getClassName(){return ve.ClassName}}ve.ClassName="FGTimerBlock",(0,S.e)("FGTimerBlock",ve);class we extends re{constructor(K){super(K),this.config=K;for(let b=0;b<this.config.eventData.length;b++){const K=this.config.eventData[b];this.registerDataInput(K,qb)}}_execute(K){const b=this.config.eventId,e=this.dataInputs.map((b=>b.getValue(K)));K.configuration.coordinator.notifyCustomEvent(b,e),this.out._activateSignal(K)}getClassName(){return we.ClassName}}we.ClassName="FGSendCustomEventBlock",(0,S.e)("FGSendCustomEventBlock",we);class he extends Be{constructor(K){super(K),this.config=K;for(let b=0;b<this.config.eventData.length;b++){const K=this.config.eventData[b];this.registerDataOutput(K,qb)}}_preparePendingTasks(K){const b=K.configuration.coordinator.getCustomEventObservable(this.config.eventId);this._eventObserver=b.add((b=>{for(let e=0;e<b.length;e++)this.dataOutputs[e].setValue(b[e],K);this._execute(K)}))}_cancelPendingTasks(K){const b=K.configuration.coordinator.getCustomEventObservable(this.config.eventId);b?b.remove(this._eventObserver):T.f.Warn(`FlowGraphReceiveCustomEventBlock: Missing observable for event ${this.config.eventId}`)}getClassName(){return he.ClassName}serialize(K){super.serialize(K),K.eventId=this.config.eventId,K.eventData=this.config.eventData}}he.ClassName="FGReceiveCustomEventBlock",(0,S.e)(he.ClassName,he);class Re extends te{constructor(K){super(K),this.config=K,this.outFlows=[];for(let b=0;b<this.config.numberOutputFlows;b++)this.outFlows.push(this._registerSignalOutput(`${b}`))}_execute(K){for(let b=0;b<this.config.numberOutputFlows;b++)this.outFlows[b]._activateSignal(K)}getClassName(){return Re.ClassName}}Re.ClassName="FGSequenceBlock",(0,S.e)(Re.ClassName,Re);const ne=new RegExp(/\{(\w+)\}/g);class Pe{constructor(K,b){this.path=K,this.ownerBlock=b,this.templatedInputs=[];let e=ne.exec(K);for(;e;){const[,z]=e;this.templatedInputs.push(b.registerDataInput(z,ke)),e=ne.exec(K)}}getAccessor(K,b){let e=this.path;for(const z of this.templatedInputs){const K=z.getValue(b).value;e=e.replace(`{${z.name}}`,K.toString())}return K.convert(e)}}class de extends Ae{constructor(K){super(K),this.config=K,this.value=this.registerDataOutput("value",qb),this.templateComponent=new Pe(K.path,this)}_updateOutputs(K){const b=this.templateComponent.getAccessor(this.config.pathConverter,K),e=b.info.get(b.object);this.value.setValue(e,K)}getClassName(){return de.ClassName}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.config.path=this.config.path}}de.ClassName="FGGetPropertyBlock",(0,S.e)(de.ClassName,de);class pe extends re{constructor(K){super(K),this.config=K,this.a=this.registerDataInput("a",qb),this.templateComponent=new Pe(K.path,this)}_execute(K){const b=this.a.getValue(K),e=this.templateComponent.getAccessor(this.config.pathConverter,K);e.info.set(b,e.object),this.out._activateSignal(K)}serialize(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super.serialize(K),K.config.path=this.config.path}getClassName(){return pe.ClassName}}pe.ClassName="FGSetPropertyBlock",(0,S.e)("FGSetPropertyBlock",pe);const ae="cachedOperationValue",Oe="cachedExecutionId";class ge extends Ae{constructor(K,b){super(b),this.value=this.registerDataOutput("value",K)}_updateOutputs(K){const b=K._getExecutionVariable(this,Oe),e=K._getExecutionVariable(this,ae);if(void 0!==e&&b===K.executionId)this.value.setValue(e,K);else{const b=this._doOperation(K);K._setExecutionVariable(this,ae,b),K._setExecutionVariable(this,Oe,K.executionId),this.value.setValue(b,K)}}}class Ne extends ge{constructor(K,b,e,z,k,j){super(e,j),this._operation=z,this._className=k,this.a=this.registerDataInput("a",K),this.b=this.registerDataInput("b",b)}_doOperation(K){return this._operation(this.a.getValue(K),this.b.getValue(K))}getClassName(){return this._className}}class Ze extends ge{constructor(K,b,e,z){super(K,z),this._operation=b,this._className=e}_doOperation(K){return this._operation()}getClassName(){return this._className}}class ye extends ge{constructor(K,b,e,z,k){super(b,k),this._operation=e,this._className=z,this.a=this.registerDataInput("a",K)}_doOperation(K){return this._operation(this.a.getValue(K))}getClassName(){return this._className}}class se extends ge{constructor(K,b,e,z,k,j,T){super(z,T),this._operation=k,this._className=j,this.a=this.registerDataInput("a",K),this.b=this.registerDataInput("b",b),this.c=this.registerDataInput("c",e)}_doOperation(K){return this._operation(this.a.getValue(K),this.b.getValue(K),this.c.getValue(K))}getClassName(){return this._className}}function Ee(K){return K.getClassName?K.getClassName():""}function oe(K,b){return"Vector2"===K&&"Vector2"===b||"gb"===K&&"gb"===b||"Vector4"===K&&"Vector4"===b}function Ce(K,b){return"Matrix"===K&&"Matrix"===b}function He(K,b){return"FlowGraphInteger"===K&&"FlowGraphInteger"===b}class We extends Ne{constructor(K){super(qb,qb,qb,((K,b)=>this._polymorphicAdd(K,b)),We.ClassName,K)}_polymorphicAdd(K,b){const e=Ee(K),z=Ee(b);return oe(e,z)||Ce(e,z)||He(e,z)?K.add(b):K+b}}We.ClassName="FGAddBlock",(0,S.e)(We.ClassName,We);class fe extends Ne{constructor(K){super(qb,qb,qb,((K,b)=>this._polymorphicAdd(K,b)),fe.ClassName,K)}_polymorphicAdd(K,b){const e=Ee(K),z=Ee(b);return oe(e,z)||He(e,z)?K.Qc(b):Ce(e,z)?K.add(b.scale(-1)):K-b}}fe.ClassName="FGSubBlock",(0,S.e)(fe.ClassName,fe);class Ve extends Ne{constructor(K){super(qb,qb,qb,((K,b)=>this._polymorphicMultiply(K,b)),Ve.ClassName,K)}_polymorphicMultiply(K,b){const e=Ee(K),z=Ee(b);return oe(e,z)||He(e,z)?K.multiply(b):Ce(e,z)?k.b.FromValues(K.m[0]*b.m[0],K.m[4]*b.m[4],K.m[8]*b.m[8],K.m[12]*b.m[12],K.m[1]*b.m[1],K.m[5]*b.m[5],K.m[9]*b.m[9],K.m[13]*b.m[13],K.m[2]*b.m[2],K.m[6]*b.m[6],K.m[10]*b.m[10],K.m[14]*b.m[14],K.m[3]*b.m[3],K.m[7]*b.m[7],K.m[11]*b.m[11],K.m[15]*b.m[15]):K*b}}Ve.ClassName="FGMultiplyBlock",(0,S.e)(Ve.ClassName,Ve);class qe extends Ne{constructor(K){super(qb,qb,qb,((K,b)=>this._polymorphicDivide(K,b)),qe.ClassName,K)}_polymorphicDivide(K,b){const e=Ee(K),z=Ee(b);return oe(e,z)||He(e,z)?K.divide(b):Ce(e,z)?k.b.FromValues(K.m[0]/b.m[0],K.m[4]/b.m[4],K.m[8]/b.m[8],K.m[12]/b.m[12],K.m[1]/b.m[1],K.m[5]/b.m[5],K.m[9]/b.m[9],K.m[13]/b.m[13],K.m[2]/b.m[2],K.m[6]/b.m[6],K.m[10]/b.m[10],K.m[14]/b.m[14],K.m[3]/b.m[3],K.m[7]/b.m[7],K.m[11]/b.m[11],K.m[15]/b.m[15]):K/b}}qe.ClassName="FGDivideBlock",(0,S.e)(qe.ClassName,qe);class Je extends Ze{constructor(K){super(Jb,(()=>Math.random()),Je.ClassName,K)}}Je.ClassName="FGRandomBlock",(0,S.e)(Je.ClassName,Je);class Kz extends Ne{constructor(K){super(qb,qb,Jb,((K,b)=>this._polymorphicDot(K,b)),Kz.ClassName,K)}_polymorphicDot(K,b){switch(Ee(K)){case"Vector2":return k.h.Dot(K,b);case"gb":return k.k.Dot(K,b);case"Vector4":return k.o.Dot(K,b);default:throw new Error(`Cannot get dot product of ${K} and ${b}`)}}}Kz.ClassName="FGDotBlock",(0,S.e)(Kz.ClassName,Kz);class bz extends Ze{constructor(K){super(Jb,(()=>Math.E),bz.ClassName,K)}}bz.ClassName="FGEBlock",(0,S.e)(bz.ClassName,bz);class ez extends Ze{constructor(K){super(Jb,(()=>Math.PI),ez.ClassName,K)}}ez.ClassName="FGPIBlock",(0,S.e)(ez.ClassName,ez);class zz extends Ze{constructor(K){super(Jb,(()=>Number.POSITIVE_INFINITY),zz.ClassName,K)}}zz.ClassName="FGInfBlock",(0,S.e)(zz.ClassName,zz);class kz extends Ze{constructor(K){super(Jb,(()=>Number.NaN),kz.ClassName,K)}}function jz(K,b){switch(Ee(K)){case"FlowGraphInteger":return new fb(b(K.value));case"Vector2":return new k.h(b(K.x),b(K.y));case"gb":return new k.k(b(K.x),b(K.y),b(K.z));case"Vector4":return new k.o(b(K.x),b(K.y),b(K.z),b(K.w));case"Matrix":return k.b.FromValues(b(K.m[0]),b(K.m[4]),b(K.m[8]),b(K.m[12]),b(K.m[1]),b(K.m[5]),b(K.m[9]),b(K.m[13]),b(K.m[2]),b(K.m[6]),b(K.m[10]),b(K.m[14]),b(K.m[3]),b(K.m[7]),b(K.m[11]),b(K.m[15]));default:return b(K)}}kz.ClassName="FGNaNBlock",(0,S.e)(kz.ClassName,kz);class Tz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicAbs(K)),Tz.ClassName,K)}_polymorphicAbs(K){return jz(K,Math.abs)}}Tz.ClassName="FGAbsBlock",(0,S.e)(Tz.ClassName,Tz);class Fz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicSign(K)),Fz.ClassName,K)}_polymorphicSign(K){return jz(K,Math.sign)}}Fz.ClassName="FGSignBlock",(0,S.e)(Fz.ClassName,Fz);class lz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicTrunc(K)),lz.ClassName,K)}_polymorphicTrunc(K){return jz(K,Math.trunc)}}lz.ClassName="FGTruncBlock",(0,S.e)(lz.ClassName,lz);class Yz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicFloor(K)),Yz.ClassName,K)}_polymorphicFloor(K){return jz(K,Math.floor)}}Yz.ClassName="FGFloorBlock",(0,S.e)(Yz.ClassName,Yz);class Az extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicCeiling(K)),Az.ClassName,K)}_polymorphicCeiling(K){return jz(K,Math.ceil)}}Az.ClassName="FGCeilBlock",(0,S.e)(Az.ClassName,Az);class Xz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicFract(K)),Xz.ClassName,K)}_polymorphicFract(K){return jz(K,(K=>K-Math.floor(K)))}}Xz.ClassName="FGFractBlock",(0,S.e)(Xz.ClassName,Xz);class tz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicNeg(K)),tz.ClassName,K)}_polymorphicNeg(K){return jz(K,(K=>-K))}}function Uz(K,b,e){switch(Ee(K)){case"FlowGraphInteger":return new fb(e(K.value,b.value));case"Vector2":return new k.h(e(K.x,b.x),e(K.y,b.y));case"gb":return new k.k(e(K.x,b.x),e(K.y,b.y),e(K.z,b.z));case"Vector4":return new k.o(e(K.x,b.x),e(K.y,b.y),e(K.z,b.z),e(K.w,b.w));case"Matrix":return k.b.FromValues(e(K.m[0],b.m[0]),e(K.m[4],b.m[4]),e(K.m[8],b.m[8]),e(K.m[12],b.m[12]),e(K.m[1],b.m[1]),e(K.m[5],b.m[5]),e(K.m[9],b.m[9]),e(K.m[13],b.m[13]),e(K.m[2],b.m[2]),e(K.m[6],b.m[6]),e(K.m[10],b.m[10]),e(K.m[14],b.m[14]),e(K.m[3],b.m[3]),e(K.m[7],b.m[7]),e(K.m[11],b.m[11]),e(K.m[15],b.m[15]));default:return e(K,b)}}tz.ClassName="FGNegBlock",(0,S.e)(tz.ClassName,tz);class Bz extends Ne{constructor(K){super(qb,qb,qb,((K,b)=>this._polymorphicRemainder(K,b)),Bz.ClassName,K)}_polymorphicRemainder(K,b){return Uz(K,b,((K,b)=>K%b))}}Bz.ClassName="FGRemainderBlock",(0,S.e)(Bz.ClassName,Bz);class uz extends Ne{constructor(K){super(qb,qb,qb,((K,b)=>this._polymorphicMin(K,b)),uz.ClassName,K)}_polymorphicMin(K,b){return Uz(K,b,Math.min)}}uz.ClassName="FGMinBlock",(0,S.e)(uz.ClassName,uz);class mz extends Ne{constructor(K){super(qb,qb,qb,((K,b)=>this._polymorphicMax(K,b)),mz.ClassName,K)}_polymorphicMax(K,b){return Uz(K,b,Math.max)}}function Dz(K,b,e){return Math.min(Math.max(K,Math.min(b,e)),Math.max(b,e))}function Iz(K,b,e,z){switch(Ee(K)){case"FlowGraphInteger":return new fb(z(K.value,b.value,e.value));case"Vector2":return new k.h(z(K.x,b.x,e.x),z(K.y,b.y,e.y));case"gb":return new k.k(z(K.x,b.x,e.x),z(K.y,b.y,e.y),z(K.z,b.z,e.z));case"Vector4":return new k.o(z(K.x,b.x,e.x),z(K.y,b.y,e.y),z(K.z,b.z,e.z),z(K.w,b.w,e.w));case"Matrix":return k.b.FromValues(z(K.m[0],b.m[0],e.m[0]),z(K.m[4],b.m[4],e.m[4]),z(K.m[8],b.m[8],e.m[8]),z(K.m[12],b.m[12],e.m[12]),z(K.m[1],b.m[1],e.m[1]),z(K.m[5],b.m[5],e.m[5]),z(K.m[9],b.m[9],e.m[9]),z(K.m[13],b.m[13],e.m[13]),z(K.m[2],b.m[2],e.m[2]),z(K.m[6],b.m[6],e.m[6]),z(K.m[10],b.m[10],e.m[10]),z(K.m[14],b.m[14],e.m[14]),z(K.m[3],b.m[3],e.m[3]),z(K.m[7],b.m[7],e.m[7]),z(K.m[11],b.m[11],e.m[11]),z(K.m[15],b.m[15],e.m[15]));default:return z(K,b,e)}}mz.ClassName="FGMaxBlock",(0,S.e)(mz.ClassName,mz);class xz extends se{constructor(K){super(qb,qb,qb,qb,((K,b,e)=>this._polymorphicClamp(K,b,e)),xz.ClassName,K)}_polymorphicClamp(K,b,e){return Iz(K,b,e,Dz)}}function Qz(K){return Math.min(Math.max(K,0),1)}xz.ClassName="FGClampBlock",(0,S.e)(xz.ClassName,xz);class Gz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicSaturate(K)),Gz.ClassName,K)}_polymorphicSaturate(K){return jz(K,Qz)}}Gz.ClassName="FGSaturateBlock",(0,S.e)(Gz.ClassName,Gz);class iz extends se{constructor(K){super(qb,qb,qb,qb,((K,b,e)=>this._polymorphicInterpolate(K,b,e)),iz.ClassName,K)}_interpolate(K,b,e){return(1-e)*K+e*b}_polymorphicInterpolate(K,b,e){return Iz(K,b,e,this._interpolate)}}iz.ClassName="FGInterpolateBlock",(0,S.e)(iz.ClassName,iz);class Sz extends Ne{constructor(K){super(qb,qb,Ke,((K,b)=>this._polymorphicEq(K,b)),Sz.ClassName,K)}_polymorphicEq(K,b){const e=Ee(K),z=Ee(b);return oe(e,z)||Ce(e,z)||He(e,z)?K.equals(b):K===b}}function Mz(K,b,e){const z=Ee(K);if(z===Ee(b)){if(""===z)return e(K,b);if("FlowGraphInteger"===z)return e(K.value,b.value);throw new Error(`Cannot compare ${K} and ${b}`)}throw new Error(`${K} and ${b} are of different types.`)}Sz.ClassName="FGEqBlock",(0,S.e)(Sz.ClassName,Sz);class rz extends Ne{constructor(K){super(qb,qb,Ke,((K,b)=>this._polymorphicLessThan(K,b)),rz.ClassName,K)}_polymorphicLessThan(K,b){return Mz(K,b,((K,b)=>K<b))}}rz.ClassName="FGLessThanBlock",(0,S.e)(rz.ClassName,rz);class Lz extends Ne{constructor(K){super(qb,qb,Ke,((K,b)=>this._polymorphicLessThanOrEqual(K,b)),Lz.ClassName,K)}_polymorphicLessThanOrEqual(K,b){return Mz(K,b,((K,b)=>K<=b))}}Lz.ClassName="FGLessThanOrEqualBlock";class cz extends Ne{constructor(K){super(qb,qb,Ke,((K,b)=>this._polymorphicGreaterThan(K,b)),cz.ClassName,K)}_polymorphicGreaterThan(K,b){return Mz(K,b,((K,b)=>K>b))}}cz.ClassName="FGGreaterThanBlock",(0,S.e)(cz.ClassName,cz);class vz extends Ne{constructor(K){super(qb,qb,Ke,((K,b)=>this._polymorphicGreaterThanOrEqual(K,b)),vz.ClassName,K)}_polymorphicGreaterThanOrEqual(K,b){return Mz(K,b,((K,b)=>K>=b))}}vz.ClassName="FGGreaterThanOrEqualBlock",(0,S.e)(vz.ClassName,vz);class wz extends ye{constructor(K){super(qb,Ke,(K=>this._polymorphicIsNan(K)),wz.ClassName,K)}_polymorphicIsNan(K){const b=Ee(K);if(""===b)return isNaN(K);if("FlowGraphInteger"===b)return isNaN(K.value);throw new Error(`Cannot get NaN of ${K}`)}}wz.ClassName="FGIsNanBlock",(0,S.e)(wz.ClassName,wz);class hz extends ye{constructor(K){super(qb,Ke,(K=>this._polymorphicIsInf(K)),hz.ClassName,K)}_polymorphicIsInf(K){const b=Ee(K);if(""===b)return!isFinite(K);if("FlowGraphInteger"===b)return!isFinite(K.value);throw new Error(`Cannot get isInf of ${K}`)}}hz.ClassName="FGIsInfBlock";class Rz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicDegToRad(K)),Rz.ClassName,K)}_degToRad(K){return K*Math.PI/180}_polymorphicDegToRad(K){return jz(K,this._degToRad)}}Rz.ClassName="FGDegToRadBlock",(0,S.e)(Rz.ClassName,Rz);class nz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicRadToDeg(K)),nz.ClassName,K)}_radToDeg(K){return 180*K/Math.PI}_polymorphicRadToDeg(K){return jz(K,this._radToDeg)}}nz.ClassName="FGRadToDegBlock",(0,S.e)(nz.ClassName,nz);class Pz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicSin(K)),Pz.ClassName,K)}_polymorphicSin(K){return jz(K,Math.sin)}}Pz.ClassName="FGSinBlock",(0,S.e)(Pz.ClassName,Pz);class dz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicCos(K)),dz.ClassName,K)}_polymorphicCos(K){return jz(K,Math.cos)}}dz.ClassName="FGCosBlock",(0,S.e)(dz.ClassName,dz);class pz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicTan(K)),pz.ClassName,K)}_polymorphicTan(K){return jz(K,Math.tan)}}pz.ClassName="FGTanBlock",(0,S.e)(pz.ClassName,pz);class az extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicAsin(K)),az.ClassName,K)}_polymorphicAsin(K){return jz(K,Math.asin)}}az.ClassName="FGAsinBlock",(0,S.e)(az.ClassName,az);class Oz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicAcos(K)),Oz.ClassName,K)}_polymorphicAcos(K){return jz(K,Math.acos)}}Oz.ClassName="FGAcosBlock",(0,S.e)(Oz.ClassName,Oz);class gz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicAtan(K)),gz.ClassName,K)}_polymorphicAtan(K){return jz(K,Math.atan)}}gz.ClassName="FGAtanBlock",(0,S.e)(gz.ClassName,gz);class Nz extends Ne{constructor(K){super(qb,qb,qb,((K,b)=>this._polymorphicAtan2(K,b)),Nz.ClassName,K)}_polymorphicAtan2(K,b){return Uz(K,b,Math.atan2)}}Nz.ClassName="FGAtan2Block",(0,S.e)(Nz.ClassName,Nz);class Zz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicSinh(K)),Zz.ClassName,K)}_polymorphicSinh(K){return jz(K,Math.sinh)}}Zz.ClassName="FGSinhBlock",(0,S.e)(Zz.ClassName,Zz);class yz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicCosh(K)),yz.ClassName,K)}_polymorphicCosh(K){return jz(K,Math.cosh)}}yz.ClassName="FGCoshBlock",(0,S.e)(yz.ClassName,yz);class sz extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicTanh(K)),sz.ClassName,K)}_polymorphicTanh(K){return jz(K,Math.tanh)}}sz.ClassName="FGTanhBlock",(0,S.e)(sz.ClassName,sz);class Ez extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicAsinh(K)),Ez.ClassName,K)}_polymorphicAsinh(K){return jz(K,Math.asinh)}}Ez.ClassName="FGAsinhBlock",(0,S.e)(Ez.ClassName,Ez);class oz extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicAcosh(K)),oz.ClassName,K)}_polymorphicAcosh(K){return jz(K,Math.acosh)}}oz.ClassName="FGAcoshBlock",(0,S.e)(oz.ClassName,oz);class Cz extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicAtanh(K)),Cz.ClassName,K)}_polymorphicAtanh(K){return jz(K,Math.atanh)}}Cz.ClassName="FGAtanhBlock",(0,S.e)(Cz.ClassName,Cz);class Hz extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicExp(K)),Hz.ClassName,K)}_polymorphicExp(K){return jz(K,Math.exp)}}Hz.ClassName="FGExpBlock",(0,S.e)(Hz.ClassName,Hz);class Wz extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicLog(K)),Wz.ClassName,K)}_polymorphicLog(K){return jz(K,Math.log)}}Wz.ClassName="FGLogBlock",(0,S.e)(Wz.ClassName,Wz);class fz extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicLog2(K)),fz.ClassName,K)}_polymorphicLog2(K){return jz(K,Math.log2)}}fz.ClassName="FGLog2Block",(0,S.e)(fz.ClassName,fz);class Vz extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicLog10(K)),Vz.ClassName,K)}_polymorphicLog10(K){return jz(K,Math.log10)}}Vz.ClassName="FGLog10Block",(0,S.e)(Vz.ClassName,Vz);class qz extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicSqrt(K)),qz.ClassName,K)}_polymorphicSqrt(K){return jz(K,Math.sqrt)}}qz.ClassName="FGSqrtBlock",(0,S.e)(qz.ClassName,qz);class Jz extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicCubeRoot(K)),Jz.ClassName,K)}_polymorphicCubeRoot(K){return jz(K,Math.cbrt)}}Jz.ClassName="FGCubeRootBlock",(0,S.e)(Jz.ClassName,Jz);class Kk extends Ne{constructor(K){super(qb,Jb,Jb,((K,b)=>this._polymorphicPow(K,b)),Kk.ClassName,K)}_polymorphicPow(K,b){return Uz(K,b,Math.pow)}}Kk.ClassName="FGPowBlock",(0,S.e)(Kk.ClassName,Kk);class bk extends ye{constructor(K){super(qb,Jb,(K=>this._polymorphicLength(K)),bk.ClassName,K)}_polymorphicLength(K){switch(Ee(K)){case"Vector2":case"gb":case"Vector4":return K.length();default:throw new Error(`Cannot compute length of value ${K}`)}}}bk.ClassName="FGLengthBlock",(0,S.e)(bk.ClassName,bk);class ek extends ye{constructor(K){super(qb,qb,(K=>this._polymorphicNormalize(K)),ek.ClassName,K)}_polymorphicNormalize(K){switch(Ee(K)){case"Vector2":case"gb":case"Vector4":return K.normalize();default:throw new Error(`Cannot normalize value ${K}`)}}}ek.ClassName="FGNormalizeBlock",(0,S.e)(ek.ClassName,ek);class zk extends Ne{constructor(K){super(ee,ee,ee,((K,b)=>k.k.Cross(K,b)),zk.ClassName,K)}}zk.ClassName="FGCrossBlock",(0,S.e)(zk.ClassName,zk);class kk extends Ne{constructor(K){super(be,Jb,be,((K,b)=>k.h.Transform(K,k.b.RotationZ(b))),kk.ClassName,K)}}kk.ClassName="FGRotate2DBlock",(0,S.e)(kk.ClassName,kk);class jk extends se{constructor(K){super(ee,ee,Jb,ee,((K,b,e)=>k.k.TransformCoordinates(K,k.b.RotationAxis(b,e))),jk.ClassName,K)}}jk.ClassName="FGRotate3DBlock",(0,S.e)(jk.ClassName,jk);class Tk extends ye{constructor(K){super(ze,ze,(K=>k.b.Transpose(K)),Tk.ClassName,K)}}Tk.ClassName="FGTransposeBlock",(0,S.e)(Tk.ClassName,Tk);class Fk extends ye{constructor(K){super(ze,Jb,(K=>K.determinant()),Fk.ClassName,K)}}Fk.ClassName="FGDeterminantBlock",(0,S.e)(Fk.ClassName,Fk);class lk extends ye{constructor(K){super(ze,ze,(K=>k.b.Invert(K)),lk.ClassName,K)}}lk.ClassName="FGInvertMatrixBlock",(0,S.e)(lk.ClassName,lk);class Yk extends Ne{constructor(K){super(ze,ze,ze,((K,b)=>b.multiply(K)),Yk.ClassName,K)}}Yk.ClassName="FGMatMulBlock",(0,S.e)(Yk.ClassName,Yk);class Ak extends ye{constructor(K){super(ke,ke,(K=>new fb(~K.value)),Ak.ClassName,K)}}Ak.ClassName="FGBitwiseNotBlock",(0,S.e)(Ak.ClassName,Ak);class Xk extends Ne{constructor(K){super(ke,ke,ke,((K,b)=>new fb(K.value&b.value)),Xk.ClassName,K)}}Xk.ClassName="FGBitwiseAndBlock",(0,S.e)(Xk.ClassName,Xk);class tk extends Ne{constructor(K){super(ke,ke,ke,((K,b)=>new fb(K.value|b.value)),tk.ClassName,K)}}tk.ClassName="FGBitwiseOrBlock",(0,S.e)(tk.ClassName,tk);class Uk extends Ne{constructor(K){super(ke,ke,ke,((K,b)=>new fb(K.value^b.value)),Uk.ClassName,K)}}Uk.ClassName="FGBitwiseXorBlock",(0,S.e)(Uk.ClassName,Uk);class Bk extends Ne{constructor(K){super(ke,ke,ke,((K,b)=>new fb(K.value<<b.value)),Bk.ClassName,K)}}Bk.ClassName="FGBitwiseLeftShiftBlock",(0,S.e)(Bk.ClassName,Bk);class uk extends Ne{constructor(K){super(ke,ke,ke,((K,b)=>new fb(K.value>>b.value)),uk.ClassName,K)}}uk.ClassName="FGBitwiseRightShiftBlock",(0,S.e)(uk.ClassName,uk);class mk extends ye{constructor(K){super(ke,ke,(K=>new fb(Math.clz32(K.value))),mk.ClassName,K)}}mk.ClassName="FGCountLeadingZerosBlock",(0,S.e)(mk.ClassName,mk);class Dk extends ye{constructor(K){super(ke,ke,(K=>new fb(K.value?31-Math.clz32(K.value&-K.value):32)),Dk.ClassName,K)}}Dk.ClassName="FGCountTrailingZerosBlock",(0,S.e)(Dk.ClassName,Dk);class Ik extends ye{constructor(K){super(ke,ke,(K=>new fb(function(K){let b=0;for(;K;)b+=1&K,K>>=1;return b}(K.value))),Ik.ClassName,K)}}Ik.ClassName="FGCountOneBitsBlock",(0,S.e)(Ik.ClassName,Ik);class xk extends re{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{startIndex:new fb(0)};super(K),this.config=K,this.reset=this._registerSignalInput("reset"),this.n=this.registerDataInput("n",ke),this.value=this.registerDataOutput("value",ke)}_execute(K,b){if(b===this.reset)this.value.setValue(this.config.startIndex,K);else{const b=this.value.getValue(K);b.value<this.n.getValue(K).value&&(this.value.setValue(new fb(b.value+1),K),this.out._activateSignal(K))}}getClassName(){return xk.ClassName}}xk.ClassName="FGDoNBlock",(0,S.e)(xk.ClassName,xk);class Qk extends Ae{constructor(K){super(K),this.config=K,this.output=this.registerDataOutput(K.variableName,qb)}_updateOutputs(K){const b=this.config.variableName;K.hasVariable(b)&&this.output.setValue(K.getVariable(b),K)}getClassName(){return Qk.ClassName}serialize(K){super.serialize(K),K.config.variableName=this.config.variableName}}Qk.ClassName="FGGetVariableBlock",(0,S.e)(Qk.ClassName,Qk);class Gk extends re{constructor(K){super(K),this.config=K,this.input=this.registerDataInput(K.variableName,qb)}_execute(K){const b=this.config.variableName,e=this.input.getValue(K);K.setVariable(b,e),this.out._activateSignal(K)}getClassName(){return Gk.ClassName}}Gk.ClassName="FGSetVariableBlock",(0,S.e)(Gk.ClassName,Gk);class ik extends re{constructor(K){super(K),this.config=K,this.condition=this.registerDataInput("condition",Ke),this.loopBody=this._registerSignalOutput("loopBody")}_execute(K,b){var e;let z=this.condition.getValue(K);for(null!==(e=this.config)&&void 0!==e&&e.isDo&&!z&&this.loopBody._activateSignal(K);z;)this.loopBody._activateSignal(K),z=this.condition.getValue(K);this.out._activateSignal(K)}getClassName(){return ik.ClassName}serialize(K){var b;super.serialize(K),K.isDo=null===(b=this.config)||void 0===b?void 0:b.isDo}}ik.ClassName="FGWhileLoopBlock",(0,S.e)(ik.ClassName,ik);const Sk={"lifecycle/onStart":Se.ClassName,"lifecycle/onTick":Me.ClassName,log:Le.ClassName,"flow/delay":ve.ClassName,"customEvent/send":we.ClassName,"customEvent/receive":he.ClassName,"flow/sequence":Re.ClassName,"world/get":de.ClassName,"world/set":pe.ClassName,"flow/doN":xk.ClassName,"variable/get":Qk.ClassName,"variable/set":Gk.ClassName,"flow/whileLoop":ik.ClassName,"math/random":Je.ClassName,"math/e":bz.ClassName,"math/pi":ez.ClassName,"math/inf":zz.ClassName,"math/nan":kz.ClassName,"math/abs":Tz.ClassName,"math/sign":Fz.ClassName,"math/trunc":lz.ClassName,"math/floor":Yz.ClassName,"math/ceil":Az.ClassName,"math/fract":Xz.ClassName,"math/neg":tz.ClassName,"math/add":We.ClassName,"math/sub":fe.ClassName,"math/mul":Ve.ClassName,"math/div":qe.ClassName,"math/rem":Bz.ClassName,"math/min":uz.ClassName,"math/max":mz.ClassName,"math/clamp":xz.ClassName,"math/saturate":Gz.ClassName,"math/mix":iz.ClassName,"math/eq":Sz.ClassName,"math/lt":rz.ClassName,"math/le":Lz.ClassName,"math/gt":cz.ClassName,"math/ge":vz.ClassName,"math/isnan":wz.ClassName,"math/isinf":hz.ClassName,"math/rad":Rz.ClassName,"math/deg":nz.ClassName,"math/sin":Pz.ClassName,"math/cos":dz.ClassName,"math/tan":pz.ClassName,"math/asin":az.ClassName,"math/acos":Oz.ClassName,"math/atan":gz.ClassName,"math/atan2":Nz.ClassName,"math/sinh":Zz.ClassName,"math/cosh":yz.ClassName,"math/tanh":sz.ClassName,"math/asinh":Ez.ClassName,"math/acosh":oz.ClassName,"math/atanh":Cz.ClassName,"math/exp":Hz.ClassName,"math/log":Wz.ClassName,"math/log2":fz.ClassName,"math/log10":Vz.ClassName,"math/sqrt":qz.ClassName,"math/cbrt":Jz.ClassName,"math/pow":Kk.ClassName,"math/length":bk.ClassName,"math/normalize":ek.ClassName,"math/dot":Kz.ClassName,"math/cross":zk.ClassName,"math/rotate2d":kk.ClassName,"math/rotate3d":jk.ClassName,"math/transpose":Tk.ClassName,"math/determinant":Fk.ClassName,"math/inverse":lk.ClassName,"math/matmul":Yk.ClassName,"math/not":Ak.ClassName,"math/and":Xk.ClassName,"math/or":tk.ClassName,"math/xor":Uk.ClassName,"math/asr":uk.ClassName,"math/lsl":Bk.ClassName,"math/clz":mk.ClassName,"math/ctz":Dk.ClassName,"math/popcnt":Ik.ClassName},Mk={float2:"Vector2",float3:"gb",float4:"Vector4",float4x4:"Matrix",int:"FlowGraphInteger"};function rk(K,b,e){if(void 0!==K.type){const z=b.types&&b.types[K.type];if(!z)throw new Error(`${e}: Unknown type: ${K.type}`);const k=z.signature;if(!k)throw new Error(`${e}: Type ${K.type} has no signature`);const j=Mk[k];return{value:K.value,className:j}}return K.value}function Lk(K,b,e){const z=Sk[b.type];if(!z)throw new Error(`/extensions/KHR_interactivity/nodes/${K}: Unknown block type: ${b.type}`);const k=K.toString(),j=function(K,b,e){const z={},k=K.configuration??[];for(const j of k)if("customEvent"===j.id){const K=b.customEvents&&b.customEvents[j.value];if(!K)throw new Error(`/extensions/KHR_interactivity/nodes/${e}: Unknown custom event: ${j.value}`);z.eventId=K.id,z.eventData=K.values.map((K=>K.id))}else if("variable"===j.id){const K=b.variables&&b.variables[j.value];if(!K)throw new Error(`/extensions/KHR_interactivity/nodes/${e}: Unknown variable: ${j.value}`);z.variableName=K.id}else if("path"===j.id){const K=j.value;z.path=K}else z[j.id]=rk(j,b,`/extensions/KHR_interactivity/nodes/${e}`);return z}(b,e,k);return{className:z,config:j,uniqueId:k,metadata:b.metadata,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[]}}class ck extends Sb{constructor(K){super(K,wk)}}const vk={__array__:{__target__:!0,translation:{type:"gb",get:K=>K._babylonTransformNode.position,set:(K,b)=>{b._babylonTransformNode.position=K},getObject:K=>K._babylonTransformNode}}},wk={nodes:vk},hk="KHR_interactivity";class Rk{constructor(K){this._loader=K,this.name=hk,this.enabled=this._loader.isExtensionUsed(hk),this._pathConverter=new ck(this._loader.xi)}dispose(){this._loader=null,delete this._pathConverter}onReady(){var K;if(!this._loader.babylonScene||!this._pathConverter)return;const b=this._loader.babylonScene,e=function(K){const b={uniqueId:(0,Hb.b)(),_userVariables:{},_connectionValues:{}},e=[b],z=[];for(let j=0;j<K.nodes.length;j++){const b=Lk(j,K.nodes[j],K);z.push(b)}for(let j=0;j<K.nodes.length;j++){const e=K.nodes[j],k=z[j],T=e.flows??[];for(const K of T){const b=K.id,e={uniqueId:(0,Hb.b)(),name:b,_connectionType:1,connectedPointIds:[]};k.signalOutputs.push(e);const T=K.node,F=K.socket,l=z[T];if(!l)throw new Error(`/extensions/KHR_interactivity/nodes/${j}: Could not find node with id ${T} that connects its input with with node ${j}'s output ${b}`);let Y=l.signalInputs.find((K=>K.name===F));Y||(Y={uniqueId:(0,Hb.b)(),name:F,_connectionType:0,connectedPointIds:[]},l.signalInputs.push(Y)),Y.connectedPointIds.push(e.uniqueId),e.connectedPointIds.push(Y.uniqueId)}const F=e.values??[];for(const l of F){const e=l.id,T={uniqueId:(0,Hb.b)(),name:e,_connectionType:0,connectedPointIds:[]};if(k.dataInputs.push(T),void 0!==l.value){const e=rk(l,K,`/extensions/KHR_interactivity/nodes/${j}`);b._connectionValues[T.uniqueId]=e}else{if(void 0===l.node||void 0===l.socket)throw new Error(`/extensions/KHR_interactivity/nodes/${j}: Invalid socket ${e} in node ${j}`);{const K=l.node,b=l.socket,k=z[K];if(!k)throw new Error(`/extensions/KHR_interactivity/nodes/${j}: Could not find node with id ${K} that connects its output with node${j}'s input ${e}`);let F=k.dataOutputs.find((K=>K.name===b));F||(F={uniqueId:(0,Hb.b)(),name:b,_connectionType:1,connectedPointIds:[]},k.dataOutputs.push(F)),T.connectedPointIds.push(F.uniqueId),F.connectedPointIds.push(T.uniqueId)}}}}const k=K.variables??[];for(let j=0;j<k.length;j++){const e=k[j],z=e.id;b._userVariables[z]=rk(e,K,`/extensions/KHR_interactivity/variables/${j}`)}return{allBlocks:z,executionContexts:e}}(null===(K=this._loader.xi.extensions)||void 0===K?void 0:K.KHR_interactivity),z=new ie({Ad:b});Ge.Parse(e,{coordinator:z,pathConverter:this._pathConverter}),z.start()}}H(hk),C(hk,!0,(K=>new Rk(K)));const nk="KHR_node_visibility";class Pk{constructor(K){this.name=nk,this._loader=K,this.enabled=K.isExtensionUsed(nk)}async onReady(){var K;null===(K=this._loader.xi.nodes)||void 0===K||K.forEach((K=>{var b,e,z,k;(null===(b=K._primitiveBabylonMeshes)||void 0===b||b.forEach((K=>{K.inheritVisibility=!0})),null!==(e=K.extensions)&&void 0!==e&&e.KHR_node_visibility)&&(!1===(null===(z=K.extensions)||void 0===z?void 0:z.KHR_node_visibility.visible)&&(K._babylonTransformNode&&(K._babylonTransformNode.isVisible=!1),null===(k=K._primitiveBabylonMeshes)||void 0===k||k.forEach((K=>{K.isVisible=!1}))))}))}dispose(){this._loader=null}}H(nk),C(nk,!0,(K=>new Pk(K)));const dk="ExtrasAsMetadata";class pk{_assignExtras(K,b){if(b.extras&&Object.keys(b.extras).length>0){const e=K.metadata=K.metadata||{};(e.xi=e.xi||{}).extras=b.extras}}constructor(K){this.name=dk,this.enabled=!0,this._loader=K}dispose(){this._loader=null}loadNodeAsync(K,b,e){return this._loader.loadNodeAsync(K,b,(K=>{this._assignExtras(K,b),e(K)}))}loadCameraAsync(K,b,e){return this._loader.loadCameraAsync(K,b,(K=>{this._assignExtras(K,b),e(K)}))}createMaterial(K,b,e){const z=this._loader.createMaterial(K,b,e);return this._assignExtras(z,b),z}}H(dk),C(dk,!1,(K=>new pk(K)))},11924:(K,b,e)=>{"use strict";e.d(b,{b:()=>h,e:()=>M,i:()=>S,j:()=>r});var z=e(10690),k=e(10686),j=e(11354),T=e(11226),F=e(11286),l=e(11283),Y=e(10696),A=e(10720),X=e(11933),t=e(11942),U=e(11237);class B{constructor(){this.rootNodes=[],this.cameras=[],this.lights=[],this.meshes=[],this.skeletons=[],this._i=[],this.animations=[],this.animationGroups=[],this.multiMaterials=[],this.materials=[],this.morphTargetManagers=[],this.geometries=[],this.transformNodes=[],this.actionManagers=[],this.textures=[],this._environmentTexture=null,this.postProcesses=[],this.Kj=null,this.effectLayers=[],this.layers=[],this.reflectionProbes=[]}get environmentTexture(){return this._environmentTexture}set environmentTexture(K){this._environmentTexture=K}getNodes(){let K=[];return K=K.concat(this.meshes),K=K.concat(this.lights),K=K.concat(this.cameras),K=K.concat(this.transformNodes),this.skeletons.forEach((b=>K=K.concat(b.bones))),K}}class u extends B{}class m{constructor(){this.rootNodes=[],this.skeletons=[],this.animationGroups=[]}dispose(){this.rootNodes.slice(0).forEach((K=>{K.dispose()})),this.rootNodes.length=0,this.skeletons.slice(0).forEach((K=>{K.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((K=>{K.dispose()})),this.animationGroups.length=0}}class D extends B{constructor(K){super(),this._wasAddedToScene=!1,(K=K||A.b.LastCreatedScene)&&(this.Ad=K,this.proceduralTextures=[],K.Ui.add((()=>{this._wasAddedToScene||this.dispose()})),this._onContextRestoredObserver=K.getEngine().onContextRestoredObservable.add((()=>{for(const K of this.geometries)K._rebuild();for(const K of this.meshes)K._rebuild();for(const K of this._i)K.rebuild();for(const K of this.textures)K._rebuild()})))}_topologicalSort(K){const b=new Map;for(const T of K)b.set(T.uniqueId,T);const e={dependsOn:new Map,dependedBy:new Map};for(const T of K){const K=T.uniqueId;e.dependsOn.set(K,new Set),e.dependedBy.set(K,new Set)}for(const T of K){const K=T.uniqueId,z=e.dependsOn.get(K);if(T instanceof X.c){const k=T.sourceMesh;b.has(k.uniqueId)&&(z.add(k.uniqueId),e.dependedBy.get(k.uniqueId).add(K))}const k=e.dependedBy.get(K);for(const j of T.getDescendants()){const z=j.uniqueId;if(b.has(z)){k.add(z);e.dependsOn.get(z).add(K)}}}const z=[],k=[];for(const T of K){const K=T.uniqueId;0===e.dependsOn.get(K).size&&(k.push(T),b.delete(K))}const j=k;for(;j.length>0;){const K=j.shift();z.push(K);const k=e.dependedBy.get(K.uniqueId);for(const z of Array.from(k.values())){const k=e.dependsOn.get(z);k.delete(K.uniqueId),0===k.size&&b.get(z)&&(j.push(b.get(z)),b.delete(z))}}return b.size>0&&(Y.b.Error("SceneSerializer._topologicalSort: There were unvisited nodes:"),b.forEach((K=>Y.b.Error(K.name)))),z}_addNodeAndDescendantsToList(K,b,e,z){if(e&&(!z||z(e))&&!b.has(e.uniqueId)){K.push(e),b.add(e.uniqueId);for(const k of e.getDescendants(!0))this._addNodeAndDescendantsToList(K,b,k,z)}}_isNodeInContainer(K){return K instanceof l.e&&-1!==this.meshes.indexOf(K)||(K instanceof F.c&&-1!==this.transformNodes.indexOf(K)||(K instanceof t.b&&-1!==this.lights.indexOf(K)||K instanceof U.e&&-1!==this.cameras.indexOf(K)))}_isValidHierarchy(){for(const K of this.meshes)if(K.parent&&!this._isNodeInContainer(K.parent))return Y.b.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.transformNodes)if(K.parent&&!this._isNodeInContainer(K.parent))return Y.b.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.lights)if(K.parent&&!this._isNodeInContainer(K.parent))return Y.b.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;for(const K of this.cameras)if(K.parent&&!this._isNodeInContainer(K.parent))return Y.b.Warn(`Node ${K.name} has a parent that is not in the container.`),!1;return!0}instantiateModelsToScene(K){let b=arguments.length>1&&void 0!==arguments[1]&&arguments[1],e=arguments.length>2?arguments[2]:void 0;this._isValidHierarchy()||k.f.Warn("SceneSerializer.InstantiateModelsToScene: The Asset Container hierarchy is not valid.");const z={},j={},F=new m,l=[],Y=[],A={doNotInstantiate:!0,...e},X=[],t=new Set;for(const k of this.transformNodes)null===k.parent&&this._addNodeAndDescendantsToList(X,t,k,A.predicate);for(const k of this.meshes)null===k.parent&&this._addNodeAndDescendantsToList(X,t,k,A.predicate);const U=this._topologicalSort(X),B=(e,k)=>{if(((b,e)=>{if(z[b.uniqueId]=e.uniqueId,j[e.uniqueId]=e,K&&(e.name=K(b.name)),e instanceof T.b){const K=e;if(K.morphTargetManager){const e=b.morphTargetManager;K.morphTargetManager=e.clone();for(let b=0;b<e.numTargets;b++){const k=e.getTarget(b),T=K.morphTargetManager.getTarget(b);z[k.uniqueId]=T.uniqueId,j[T.uniqueId]=T}}}})(e,k),e.parent){const K=z[e.parent.uniqueId],b=j[K];k.parent=b||e.parent}if(k.position&&e.position&&k.position.p(e.position),k.rotationQuaternion&&e.rotationQuaternion&&k.rotationQuaternion.p(e.rotationQuaternion),k.rotation&&e.rotation&&k.rotation.p(e.rotation),k.Zd&&e.Zd&&k.Zd.p(e.Zd),k.material){const T=k;if(T.material)if(b){const b=e.material;if(-1===Y.indexOf(b)){let e=b.clone(K?K(b.name):"Clone of "+b.name);if(Y.push(b),z[b.uniqueId]=e.uniqueId,j[e.uniqueId]=e,"MultiMaterial"===b.getClassName()){const k=b;for(const b of k.Tf)b&&(e=b.clone(K?K(b.name):"Clone of "+b.name),Y.push(b),z[b.uniqueId]=e.uniqueId,j[e.uniqueId]=e);k.Tf=k.Tf.map((K=>K&&j[z[K.uniqueId]]))}}"InstancedMesh"!==T.getClassName()&&(T.material=j[z[b.uniqueId]])}else"MultiMaterial"===T.material.getClassName()?-1===this.Ad.multiMaterials.indexOf(T.material)&&this.Ad.addMultiMaterial(T.material):-1===this.Ad.materials.indexOf(T.material)&&this.Ad.addMaterial(T.material)}null===k.parent&&F.rootNodes.push(k)};return U.forEach((K=>{if("InstancedMesh"===K.getClassName()){const b=K,e=b.sourceMesh,k=z[e.uniqueId],T=("number"===typeof k?j[k]:e).createInstance(b.name);B(b,T)}else{let b=!0;"sb"===K.getClassName()||"Node"===K.getClassName()||K.skeleton||!K.getTotalVertices||0===K.getTotalVertices()?b=!1:A.doNotInstantiate&&(b="function"===typeof A.doNotInstantiate?!A.doNotInstantiate(K):!A.doNotInstantiate);const e=b?K.createInstance(`instance of ${K.name}`):K.clone(`Clone of ${K.name}`,null,!0);if(!e)throw new Error(`Could not clone or instantiate node on Asset Container ${K.name}`);B(K,e)}})),this.skeletons.forEach((b=>{if(A.predicate&&!A.predicate(b))return;const e=b.clone(K?K(b.name):"Clone of "+b.name);for(const K of this.meshes)if(K.skeleton===b&&!K.isAnInstance){const b=j[z[K.uniqueId]];if(!b||b.isAnInstance)continue;if(b.skeleton=e,-1!==l.indexOf(e))continue;l.push(e);for(const K of e.bones)K._linkedTransformNode&&(K._linkedTransformNode=j[z[K._linkedTransformNode.uniqueId]])}F.skeletons.push(e)})),this.animationGroups.forEach((b=>{if(A.predicate&&!A.predicate(b))return;const e=b.clone(K?K(b.name):"Clone of "+b.name,(K=>j[z[K.uniqueId]]||K));F.animationGroups.push(e)})),F}addAllToScene(){if(!this._wasAddedToScene){this._isValidHierarchy()||k.f.Warn("SceneSerializer.addAllToScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!0,this.addToScene(null),this.environmentTexture&&(this.Ad.environmentTexture=this.environmentTexture);for(const K of this.Ad._serializableComponents)K.addFromContainer(this);this.Ad.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null}}addToScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;const b=[];this.cameras.forEach((e=>{K&&!K(e)||(this.Ad.addCamera(e),b.push(e))})),this.lights.forEach((e=>{K&&!K(e)||(this.Ad.addLight(e),b.push(e))})),this.meshes.forEach((e=>{K&&!K(e)||(this.Ad.Wh(e),b.push(e))})),this.skeletons.forEach((b=>{K&&!K(b)||this.Ad.addSkeleton(b)})),this.animations.forEach((b=>{K&&!K(b)||this.Ad.addAnimation(b)})),this.animationGroups.forEach((b=>{K&&!K(b)||this.Ad.addAnimationGroup(b)})),this.multiMaterials.forEach((b=>{K&&!K(b)||this.Ad.addMultiMaterial(b)})),this.materials.forEach((b=>{K&&!K(b)||this.Ad.addMaterial(b)})),this.morphTargetManagers.forEach((b=>{K&&!K(b)||this.Ad.addMorphTargetManager(b)})),this.geometries.forEach((b=>{K&&!K(b)||this.Ad.addGeometry(b)})),this.transformNodes.forEach((e=>{K&&!K(e)||(this.Ad.addTransformNode(e),b.push(e))})),this.actionManagers.forEach((b=>{K&&!K(b)||this.Ad.addActionManager(b)})),this.textures.forEach((b=>{K&&!K(b)||this.Ad.addTexture(b)})),this.reflectionProbes.forEach((b=>{K&&!K(b)||this.Ad.addReflectionProbe(b)}));for(const e of b)e.parent&&-1===this.Ad.getNodes().indexOf(e.parent)&&(e.setParent?e.setParent(null):e.parent=null)}removeAllFromScene(){this._isValidHierarchy()||k.f.Warn("SceneSerializer.removeAllFromScene: The Asset Container hierarchy is not valid."),this._wasAddedToScene=!1,this.removeFromScene(null),this.environmentTexture===this.Ad.environmentTexture&&(this.Ad.environmentTexture=null);for(const K of this.Ad._serializableComponents)K.removeFromContainer(this)}removeFromScene(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.cameras.forEach((b=>{K&&!K(b)||this.Ad.removeCamera(b)})),this.lights.forEach((b=>{K&&!K(b)||this.Ad.removeLight(b)})),this.meshes.forEach((b=>{K&&!K(b)||this.Ad.sd(b,!0)})),this.skeletons.forEach((b=>{K&&!K(b)||this.Ad.removeSkeleton(b)})),this.animations.forEach((b=>{K&&!K(b)||this.Ad.removeAnimation(b)})),this.animationGroups.forEach((b=>{K&&!K(b)||this.Ad.removeAnimationGroup(b)})),this.multiMaterials.forEach((b=>{K&&!K(b)||this.Ad.removeMultiMaterial(b)})),this.materials.forEach((b=>{K&&!K(b)||this.Ad.removeMaterial(b)})),this.morphTargetManagers.forEach((b=>{K&&!K(b)||this.Ad.removeMorphTargetManager(b)})),this.geometries.forEach((b=>{K&&!K(b)||this.Ad.removeGeometry(b)})),this.transformNodes.forEach((b=>{K&&!K(b)||this.Ad.removeTransformNode(b)})),this.actionManagers.forEach((b=>{K&&!K(b)||this.Ad.removeActionManager(b)})),this.textures.forEach((b=>{K&&!K(b)||this.Ad.removeTexture(b)})),this.reflectionProbes.forEach((b=>{K&&!K(b)||this.Ad.removeReflectionProbe(b)}))}dispose(){this.cameras.slice(0).forEach((K=>{K.dispose()})),this.cameras.length=0,this.lights.slice(0).forEach((K=>{K.dispose()})),this.lights.length=0,this.meshes.slice(0).forEach((K=>{K.dispose()})),this.meshes.length=0,this.skeletons.slice(0).forEach((K=>{K.dispose()})),this.skeletons.length=0,this.animationGroups.slice(0).forEach((K=>{K.dispose()})),this.animationGroups.length=0,this.multiMaterials.slice(0).forEach((K=>{K.dispose()})),this.multiMaterials.length=0,this.materials.slice(0).forEach((K=>{K.dispose()})),this.materials.length=0,this.geometries.slice(0).forEach((K=>{K.dispose()})),this.geometries.length=0,this.transformNodes.slice(0).forEach((K=>{K.dispose()})),this.transformNodes.length=0,this.actionManagers.slice(0).forEach((K=>{K.dispose()})),this.actionManagers.length=0,this.textures.slice(0).forEach((K=>{K.dispose()})),this.textures.length=0,this.reflectionProbes.slice(0).forEach((K=>{K.dispose()})),this.reflectionProbes.length=0,this.morphTargetManagers.slice(0).forEach((K=>{K.dispose()})),this.morphTargetManagers.length=0,this.environmentTexture&&(this.environmentTexture.dispose(),this.environmentTexture=null);for(const K of this.Ad._serializableComponents)K.removeFromContainer(this,!0);this._onContextRestoredObserver&&(this.Ad.getEngine().onContextRestoredObservable.remove(this._onContextRestoredObserver),this._onContextRestoredObserver=null)}_moveAssets(K,b,e){if(K&&b)for(const z of K){let K=!0;if(e)for(const b of e)if(z===b){K=!1;break}K&&(b.push(z),z._parentContainer=this)}}moveAllFromScene(K){this._wasAddedToScene=!1,void 0===K&&(K=new u);for(const b in this)Object.prototype.hasOwnProperty.call(this,b)&&(this[b]=this[b]||("_environmentTexture"===b?null:[]),this._moveAssets(this.Ad[b],this[b],K[b]));this.environmentTexture=this.Ad.environmentTexture,this.removeAllFromScene()}createRootMesh(){const K=new T.b("assetContainerRootMesh",this.Ad);return this.meshes.forEach((b=>{b.parent||K.addChild(b)})),this.meshes.unshift(K),K}mergeAnimationsTo(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:A.b.LastCreatedScene,b=arguments.length>1?arguments[1]:void 0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!K)return Y.b.Error("No scene available to merge animations to"),[];const z=e||(b=>{let e=null;const z=b.animations.length?b.animations[0].targetProperty:"",k=b.name.split(".").join("").split("_primitive")[0];switch(z){case"position":case"rotationQuaternion":e=K.getTransformNodeByName(b.name)||K.getTransformNodeByName(k);break;case"influence":e=K.getMorphTargetByName(b.name)||K.getMorphTargetByName(k);break;default:e=K.getNodeByName(b.name)||K.getNodeByName(k)}return e});this.getNodes().forEach((K=>{const b=z(K);if(null!==b){for(const e of K.animations){const K=b.animations.filter((K=>K.targetProperty===e.targetProperty));for(const e of K){const K=b.animations.indexOf(e,0);K>-1&&b.animations.splice(K,1)}}b.animations=b.animations.concat(K.animations)}}));const k=[];return this.animationGroups.slice().forEach((K=>{k.push(K.clone(K.name,z)),K.animatables.forEach((K=>{K.stop()}))})),b.forEach((b=>{const e=z(b.target);e&&(K.beginAnimation(e,b.fromFrame,b.toFrame,b.loopAnimation,b.speedRatio,b.onAnimationEnd?b.onAnimationEnd:void 0,void 0,!0,void 0,b.onAnimationLoop?b.onAnimationLoop:void 0),K.stopAnimation(b.target))})),k}populateRootNodes(){this.rootNodes.length=0,this.meshes.forEach((K=>{K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)})),this.transformNodes.forEach((K=>{K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)})),this.lights.forEach((K=>{K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)})),this.cameras.forEach((K=>{K.parent||-1!==this.rootNodes.indexOf(K)||this.rootNodes.push(K)}))}addAllAssetsToContainer(K){if(!K)return;const b=[],e=new Set;for(b.push(K);b.length>0;){const K=b.pop();if(K instanceof T.b?(K.mj&&-1===this.geometries.indexOf(K.mj)&&this.geometries.push(K.mj),this.meshes.push(K)):K instanceof F.c?this.transformNodes.push(K):K instanceof t.b?this.lights.push(K):K instanceof U.e&&this.cameras.push(K),K instanceof l.e){if(K.material&&-1===this.materials.indexOf(K.material)){this.materials.push(K.material);for(const b of K.material.getActiveTextures())-1===this.textures.indexOf(b)&&this.textures.push(b)}K.skeleton&&-1===this.skeletons.indexOf(K.skeleton)&&this.skeletons.push(K.skeleton),K.morphTargetManager&&-1===this.morphTargetManagers.indexOf(K.morphTargetManager)&&this.morphTargetManagers.push(K.morphTargetManager)}for(const z of K.getChildren())e.has(z)||b.push(z);e.add(K)}this.populateRootNodes()}}var I=e(10733);class x{constructor(K){this.byteOffset=0,this.buffer=K}loadAsync(K){return this.buffer.readAsync(this.byteOffset,K).then((K=>{this._dataView=new DataView(K.buffer,K.byteOffset,K.byteLength),this._dataByteOffset=0}))}readUint32(){const K=this._dataView.getUint32(this._dataByteOffset,!0);return this._dataByteOffset+=4,this.byteOffset+=4,K}readUint8Array(K){const b=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._dataByteOffset,K);return this._dataByteOffset+=K,this.byteOffset+=K,b}readString(K){return(0,I.f)(this.readUint8Array(K))}skipBytes(K){this._dataByteOffset+=K,this.byteOffset+=K}}var Q=e(11951);const G="Z2xURg",i={name:"xi",extensions:{".gltf":{isBinary:!1},".glb":{isBinary:!0}},canDirectLoad:K=>-1!==K.indexOf("asset")&&-1!==K.indexOf("version")||K.startsWith("data:base64,"+G)||K.startsWith("data:;base64,"+G)||K.startsWith("data:application/octet-stream;base64,"+G)||K.startsWith("data:model/gltf-binary;base64,"+G)};var S,M,r,L=e(10723),c=e(10728);function v(K,b,e){try{return Promise.resolve(new Uint8Array(K,b,e))}catch(z){return Promise.reject(z)}}!function(K){K[K.AUTO=0]="AUTO",K[K.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"}(S||(S={})),function(K){K[K.NONE=0]="NONE",K[K.FIRST=1]="FIRST",K[K.ALL=2]="ALL"}(M||(M={})),function(K){K[K.LOADING=0]="LOADING",K[K.READY=1]="READY",K[K.COMPLETE=2]="COMPLETE"}(r||(r={}));class w{constructor(){this.coordinateSystemMode=S.AUTO,this.animationStartMode=M.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=K=>Promise.resolve(K),this.extensionOptions={}}p(K){K&&(this.onParsed=K.onParsed,this.coordinateSystemMode=K.coordinateSystemMode??this.coordinateSystemMode,this.animationStartMode=K.animationStartMode??this.animationStartMode,this.loadNodeAnimations=K.loadNodeAnimations??this.loadNodeAnimations,this.loadSkins=K.loadSkins??this.loadSkins,this.loadMorphTargets=K.loadMorphTargets??this.loadMorphTargets,this.compileMaterials=K.compileMaterials??this.compileMaterials,this.useClipPlane=K.useClipPlane??this.useClipPlane,this.compileShadowGenerators=K.compileShadowGenerators??this.compileShadowGenerators,this.transparencyAsCoverage=K.transparencyAsCoverage??this.transparencyAsCoverage,this.useRangeRequests=K.useRangeRequests??this.useRangeRequests,this.createInstances=K.createInstances??this.createInstances,this.alwaysComputeBoundingBox=K.alwaysComputeBoundingBox??this.alwaysComputeBoundingBox,this.loadAllMaterials=K.loadAllMaterials??this.loadAllMaterials,this.loadOnlyMaterials=K.loadOnlyMaterials??this.loadOnlyMaterials,this.skipMaterials=K.skipMaterials??this.skipMaterials,this.useSRGBBuffers=K.useSRGBBuffers??this.useSRGBBuffers,this.targetFps=K.targetFps??this.targetFps,this.alwaysComputeSkeletonRootNode=K.alwaysComputeSkeletonRootNode??this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=K.useGltfTextureNames??this.useGltfTextureNames,this.preprocessUrlAsync=K.preprocessUrlAsync??this.preprocessUrlAsync,this.customRootNode=K.customRootNode,this.onMeshLoaded=K.onMeshLoaded,this.onSkinLoaded=K.onSkinLoaded,this.onTextureLoaded=K.onTextureLoaded,this.onMaterialLoaded=K.onMaterialLoaded,this.onCameraLoaded=K.onCameraLoaded,this.extensionOptions=K.extensionOptions??this.extensionOptions)}}class h extends w{constructor(K){super(),this.onParsedObservable=new z.d,this.onMeshLoadedObservable=new z.d,this.onSkinLoadedObservable=new z.d,this.onTextureLoadedObservable=new z.d,this.onMaterialLoadedObservable=new z.d,this.onCameraLoadedObservable=new z.d,this.onCompleteObservable=new z.d,this.onErrorObservable=new z.d,this.Ui=new z.d,this.onExtensionLoadedObservable=new z.d,this.validate=!1,this.onValidatedObservable=new z.d,this._loader=null,this._state=null,this._requests=new Array,this.name=i.name,this.extensions=i.extensions,this.onLoaderStateChangedObservable=new z.d,this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled,this.p(K)}set onParsed(K){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),K&&(this._onParsedObserver=this.onParsedObservable.add(K))}set onMeshLoaded(K){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),K&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(K))}set onSkinLoaded(K){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),K&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add((b=>K(b.node,b.skinnedNode))))}set onTextureLoaded(K){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),K&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(K))}set onMaterialLoaded(K){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),K&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(K))}set onCameraLoaded(K){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),K&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(K))}set onComplete(K){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(K)}set onError(K){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(K)}set onDispose(K){this._onDisposeObserver&&this.Ui.remove(this._onDisposeObserver),this._onDisposeObserver=this.Ui.add(K)}set onExtensionLoaded(K){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(K)}get loggingEnabled(){return this._loggingEnabled}set loggingEnabled(K){this._loggingEnabled!==K&&(this._loggingEnabled=K,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)}get capturePerformanceCounters(){return this._capturePerformanceCounters}set capturePerformanceCounters(K){this._capturePerformanceCounters!==K&&(this._capturePerformanceCounters=K,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))}set onValidated(K){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(K)}dispose(){this._loader&&(this._loader.dispose(),this._loader=null);for(const K of this._requests)K.abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=K=>Promise.resolve(K),this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.Ui.notifyObservers(void 0),this.Ui.clear()}loadFile(K,b,e,j,T,F,l,A){if(ArrayBuffer.isView(b))return this._loadBinary(K,b,e,j,l,A),null;this._progressCallback=T;const X=b.name||k.f.GetFilename(b);if(F){if(this.useRangeRequests){this.validate&&Y.b.Warn("glTF validation is not supported when range requests are enabled");const e={abort:()=>{},onCompleteObservable:new z.d},k={readAsync:(e,z)=>new Promise(((k,j)=>{this._loadFile(K,b,(K=>{k(new Uint8Array(K))}),!0,(K=>{j(K)}),(K=>{K.setRequestHeader("Range",`bytes=${e}-${e+z-1}`)}))})),byteLength:0};return this._unpackBinaryAsync(new x(k)).then((K=>{e.onCompleteObservable.notifyObservers(e),j(K)}),l?K=>l(void 0,K):void 0),e}return this._loadFile(K,b,(b=>{this._validate(K,new Uint8Array(b,0,b.byteLength),e,X),this._unpackBinaryAsync(new x({readAsync:(K,e)=>v(b,K,e),byteLength:b.byteLength})).then((K=>{j(K)}),l?K=>l(void 0,K):void 0)}),!0,l)}return this._loadFile(K,b,(b=>{try{this._validate(K,b,e,X),j({json:this._parseJson(b)})}catch{l&&l()}}),!1,l)}_loadBinary(K,b,e,z,k,j){this._validate(K,new Uint8Array(b.buffer,b.byteOffset,b.byteLength),e,j),this._unpackBinaryAsync(new x({readAsync:(K,e)=>function(K,b,e){try{if(b<0||b>=K.byteLength)throw new RangeError("Offset is out of range.");if(b+e>K.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(K.buffer,K.byteOffset+b,e))}catch(z){return Promise.reject(z)}}(b,K,e),byteLength:b.byteLength})).then((K=>{z(K)}),k?K=>k(void 0,K):void 0)}importMeshAsync(K,b,e,z,k,j){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(e),this.onParsedObservable.clear(),this._log(`Loading ${j||""}`),this._loader=this._getLoader(e),this._loader.importMeshAsync(K,b,null,e,z,k,j))))}loadAsync(K,b,e,z,k){return Promise.resolve().then((()=>(this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(b),this._loader.loadAsync(K,b,e,z,k))))}loadAssetContainerAsync(K,b,e,z,k){return Promise.resolve().then((()=>{this.onParsedObservable.notifyObservers(b),this.onParsedObservable.clear(),this._log(`Loading ${k||""}`),this._loader=this._getLoader(b);const j=new D(K),T=[];this.onMaterialLoadedObservable.add((K=>{T.push(K)}));const F=[];this.onTextureLoadedObservable.add((K=>{F.push(K)}));const l=[];this.onCameraLoadedObservable.add((K=>{l.push(K)}));const Y=[];return this.onMeshLoadedObservable.add((K=>{K.morphTargetManager&&Y.push(K.morphTargetManager)})),this._loader.importMeshAsync(null,K,j,b,e,z,k).then((K=>(Array.prototype.push.apply(j.geometries,K.geometries),Array.prototype.push.apply(j.meshes,K.meshes),Array.prototype.push.apply(j._i,K._i),Array.prototype.push.apply(j.skeletons,K.skeletons),Array.prototype.push.apply(j.animationGroups,K.animationGroups),Array.prototype.push.apply(j.materials,T),Array.prototype.push.apply(j.textures,F),Array.prototype.push.apply(j.lights,K.lights),Array.prototype.push.apply(j.transformNodes,K.transformNodes),Array.prototype.push.apply(j.cameras,l),Array.prototype.push.apply(j.morphTargetManagers,Y),j)))}))}canDirectLoad(K){return i.canDirectLoad(K)}directLoad(K,b){if(b.startsWith("base64,"+G)||b.startsWith(";base64,"+G)||b.startsWith("application/octet-stream;base64,"+G)||b.startsWith("model/gltf-binary;base64,"+G)){const e=(0,L.e)(b);return this._validate(K,new Uint8Array(e,0,e.byteLength)),this._unpackBinaryAsync(new x({readAsync:(K,b)=>v(e,K,b),byteLength:e.byteLength}))}return this._validate(K,b),Promise.resolve({json:this._parseJson(b)})}createPlugin(K){return new h(K[i.name])}get loaderState(){return this._state}whenCompleteAsync(){return new Promise(((K,b)=>{this.onCompleteObservable.addOnce((()=>{K()})),this.onErrorObservable.addOnce((K=>{b(K)}))}))}_setState(K){this._state!==K&&(this._state=K,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(r[this._state]))}_loadFile(K,b,e,z,k,j){const T=K._loadFile(b,e,(K=>{this._onProgress(K,T)}),!0,z,k,j);return T.onCompleteObservable.add((()=>{T._lengthComputable=!0,T._total=T._loaded})),this._requests.push(T),T}_onProgress(K,b){if(!this._progressCallback)return;b._lengthComputable=K.lengthComputable,b._loaded=K.loaded,b._total=K.total;let e=!0,z=0,k=0;for(const j of this._requests){if(void 0===j._lengthComputable||void 0===j._loaded||void 0===j._total)return;e=e&&j._lengthComputable,z+=j._loaded,k+=j._total}this._progressCallback({lengthComputable:e,loaded:z,total:e?k:0})}_validate(K,b){let e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",z=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";this.validate&&(this._startPerformanceCounter("Validate JSON"),Q.b.ValidateAsync(b,e,z,(b=>this.preprocessUrlAsync(e+b).then((b=>K._loadFileAsync(b,void 0,!0,!0).then((K=>new Uint8Array(K,0,K.byteLength))))))).then((K=>{this._endPerformanceCounter("Validate JSON"),this.onValidatedObservable.notifyObservers(K),this.onValidatedObservable.clear()}),(K=>{this._endPerformanceCounter("Validate JSON"),k.f.Warn(`Failed to validate: ${K.message}`),this.onValidatedObservable.clear()})))}_getLoader(K){const b=K.json.asset||{};this._log(`Asset version: ${b.version}`),b.minVersion&&this._log(`Asset minimum version: ${b.minVersion}`),b.generator&&this._log(`Asset generator: ${b.generator}`);const e=h._parseVersion(b.version);if(!e)throw new Error("Invalid version: "+b.version);if(void 0!==b.minVersion){const K=h._parseVersion(b.minVersion);if(!K)throw new Error("Invalid minimum version: "+b.minVersion);if(h._compareVersion(K,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+b.minVersion)}const z={1:h._CreateGLTF1Loader,2:h._CreateGLTF2Loader}[e.major];if(!z)throw new Error("Unsupported version: "+b.version);return z(this)}_parseJson(K){this._startPerformanceCounter("Parse JSON"),this._log(`JSON length: ${K.length}`);const b=JSON.parse(K);return this._endPerformanceCounter("Parse JSON"),b}_unpackBinaryAsync(K){return this._startPerformanceCounter("Unpack Binary"),K.loadAsync(20).then((()=>{const b=K.readUint32();if(1179937895!==b)throw new c.h("Unexpected magic: "+b,c.d.GLTFLoaderUnexpectedMagicError);const e=K.readUint32();this.loggingEnabled&&this._log(`Binary version: ${e}`);const z=K.readUint32();let k;switch(this.useRangeRequests||z===K.buffer.byteLength||Y.b.Warn(`Length in header does not match actual data length: ${z} != ${K.buffer.byteLength}`),e){case 1:k=this._unpackBinaryV1Async(K,z);break;case 2:k=this._unpackBinaryV2Async(K,z);break;default:throw new Error("Unsupported version: "+e)}return this._endPerformanceCounter("Unpack Binary"),k}))}_unpackBinaryV1Async(K,b){const e=K.readUint32(),z=K.readUint32();if(0!==z)throw new Error(`Unexpected content format: ${z}`);const k=b-K.byteOffset,j={json:this._parseJson(K.readString(e)),bin:null};if(0!==k){const b=K.byteOffset;j.bin={readAsync:(e,z)=>K.buffer.readAsync(b+e,z),byteLength:k}}return Promise.resolve(j)}_unpackBinaryV2Async(K,b){const e=1313821514,z=5130562,k=K.readUint32();if(K.readUint32()!==e)throw new Error("First chunk format is not JSON");return K.byteOffset+k===b?K.loadAsync(k).then((()=>({json:this._parseJson(K.readString(k)),bin:null}))):K.loadAsync(k+8).then((()=>{const j={json:this._parseJson(K.readString(k)),bin:null},T=()=>{const k=K.readUint32();switch(K.readUint32()){case e:throw new Error("Unexpected JSON chunk");case z:{const b=K.byteOffset;j.bin={readAsync:(e,z)=>K.buffer.readAsync(b+e,z),byteLength:k},K.skipBytes(k);break}default:K.skipBytes(k)}return K.byteOffset!==b?K.loadAsync(8).then(T):Promise.resolve(j)};return T()}))}static _parseVersion(K){if("1.0"===K||"1.0.1"===K)return{major:1,minor:0};const b=(K+"").match(/^(\d+)\.(\d+)/);return b?{major:parseInt(b[1]),minor:parseInt(b[2])}:null}static _compareVersion(K,b){return K.major>b.major?1:K.major<b.major?-1:K.minor>b.minor?1:K.minor<b.minor?-1:0}_logOpen(K){this._log(K),this._logIndentLevel++}_logClose(){--this._logIndentLevel}_logEnabled(K){const b=h._logSpaces.substring(0,2*this._logIndentLevel);Y.b.Log(`${b}${K}`)}_logDisabled(K){}_startPerformanceCounterEnabled(K){k.f.StartPerformanceCounter(K)}_startPerformanceCounterDisabled(K){}_endPerformanceCounterEnabled(K){k.f.EndPerformanceCounter(K)}_endPerformanceCounterDisabled(K){}}h.IncrementalLoading=!0,h.HomogeneousCoordinates=!1,h._logSpaces="                                ",(0,j.d)(new h)},11951:(K,b,e)=>{"use strict";e.d(b,{b:()=>T});var z=e(10686);function k(K,b,e,z){const k={externalResourceFunction:z};return e&&(k.uri="file:"===b?e:b+e),ArrayBuffer.isView(K)?GLTFValidator.validateBytes(K,k):GLTFValidator.validateString(K,k)}function j(){const K=[];onmessage=b=>{const e=b.data;switch(e.id){case"init":importScripts(e.url);break;case"validate":k(e.data,e.rootUrl,e.fileName,(b=>new Promise(((e,z)=>{const k=K.length;K.push({resolve:e,reject:z}),postMessage({id:"getExternalResource",index:k,uri:b})})))).then((K=>{postMessage({id:"validate.resolve",value:K})}),(K=>{postMessage({id:"validate.reject",reason:K})}));break;case"getExternalResource.resolve":K[e.index].resolve(e.value);break;case"getExternalResource.reject":K[e.index].reject(e.reason)}}}class T{static ValidateAsync(K,b,e,T){return"function"===typeof Worker?new Promise(((F,l)=>{const Y=`${k}(${j})()`,A=URL.createObjectURL(new Blob([Y],{type:"application/javascript"})),X=new Worker(A),t=K=>{X.removeEventListener("error",t),X.removeEventListener("message",U),l(K)},U=K=>{const b=K.data;switch(b.id){case"getExternalResource":T(b.uri).then((K=>{X.postMessage({id:"getExternalResource.resolve",index:b.index,value:K},[K.buffer])}),(K=>{X.postMessage({id:"getExternalResource.reject",index:b.index,reason:K})}));break;case"validate.resolve":X.removeEventListener("error",t),X.removeEventListener("message",U),F(b.value),X.terminate();break;case"validate.reject":X.removeEventListener("error",t),X.removeEventListener("message",U),l(b.reason),X.terminate()}};if(X.addEventListener("error",t),X.addEventListener("message",U),X.postMessage({id:"init",url:z.f.GetBabylonScriptURL(this.Configuration.url)}),ArrayBuffer.isView(K)){const z=K.slice();X.postMessage({id:"validate",data:z,rootUrl:b,fileName:e},[z.buffer])}else X.postMessage({id:"validate",data:K,rootUrl:b,fileName:e})})):(this._LoadScriptPromise||(this._LoadScriptPromise=z.f.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then((()=>k(K,b,e,T))))}}T.Configuration={url:`${z.f._DefaultCdnUrl}/gltf_validator.js`}},12366:(K,b,e)=>{"use strict";e.d(b,{b:()=>S});var z=e(10936),k=e(10938),j=e(11001),T=e(10967),F=e(11146),l=e(11155),Y=e(11030),A=e(10960),X=e(10799),t=e(10764);e(11628),e(11545),e(11564),e(11549),e(11568),e(11570),e(11574);const U="imageProcessingCompatibility",B="#ifdef IMAGEPROCESSINGPOSTPROCESS\ngl_FragColor.rgb=pow(gl_FragColor.rgb,vec3(2.2));\n#endif\n";t.d.IncludesShadersStore[U]=B;const u="skyPixelShader",m="precision highp float;varying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<clipPlaneFragmentDeclaration>\nuniform vec3 cameraPosition;uniform vec3 cameraOffset;uniform vec3 up;uniform float luminance;uniform float turbidity;uniform float rayleigh;uniform float mieCoefficient;uniform float mieDirectionalG;uniform vec3 sunPosition;\n#ifdef LOGARITHMICDEPTH\n#extension GL_EXT_frag_depth : enable\n#endif\n#include<logDepthDeclaration>\n#include<fogFragmentDeclaration>\nconst float e=2.71828182845904523536028747135266249775724709369995957;const float pi=3.141592653589793238462643383279502884197169;const float n=1.0003;const float N=2.545E25;const float pn=0.035;const vec3 lambda=vec3(680E-9,550E-9,450E-9);const vec3 K=vec3(0.686,0.678,0.666);const float v=4.0;const float rayleighZenithLength=8.4E3;const float mieZenithLength=1.25E3;const float EE=1000.0;const float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;const float cutoffAngle=pi/1.95;const float steepness=1.5;vec3 totalRayleigh(vec3 lambda)\n{return (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));}\nvec3 simplifiedRayleigh()\n{return 0.0005/vec3(94,40,18);}\nfloat rayleighPhase(float cosTheta)\n{ \nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));}\nvec3 totalMie(vec3 lambda,vec3 K,float T)\n{float c=(0.2*T )*10E-18;return 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;}\nfloat hgPhase(float cosTheta,float g)\n{return (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));}\nfloat sunIntensity(float zenithAngleCos)\n{return EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));}\nfloat A=0.15;float B=0.50;float C=0.10;float D=0.20;float EEE=0.02;float F=0.30;float W=1000.0;vec3 Uncharted2Tonemap(vec3 x)\n{return ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;}\n#if DITHER\n#include<helperFunctions>\n#endif\n#define CUSTOM_FRAGMENT_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_FRAGMENT_MAIN_BEGIN\n#include<clipPlaneFragment>\n/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);float rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));vec3 sunDirection=normalize(sunPosition);float sunE=sunIntensity(dot(sunDirection,up));vec3 betaR=simplifiedRayleigh()*rayleighCoefficient;vec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;float zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition+cameraOffset))));float sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));float sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));vec3 Fex=exp(-(betaR*sR+betaM*sM));float cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);float rPhase=rayleighPhase(cosTheta*0.5+0.5);vec3 betaRTheta=betaR*rPhase;float mPhase=hgPhase(cosTheta,mieDirectionalG);vec3 betaMTheta=betaM*mPhase;vec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));Lin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));vec3 direction=normalize(vPositionW-cameraPosition);float theta=acos(direction.y);float phi=atan(direction.z,direction.x);vec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);vec3 L0=vec3(0.1)*Fex;float sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);L0+=(sunE*19000.0*Fex)*sundisk;vec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));vec3 texColor=(Lin+L0);texColor*=0.04 ;texColor+=vec3(0.0,0.001,0.0025)*0.3;float g_fMaxLuminance=1.0;float fLumScaled=0.1/luminance; \nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \nfloat ExposureBias=fLumCompressed;vec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);vec3 retColor=curr*whiteScale;/**\n*--------------------------------------------------------------------------------------------------\n* Sky Color\n*--------------------------------------------------------------------------------------------------\n*/\nfloat alpha=1.0;\n#ifdef VERTEXCOLOR\nretColor.rgb*=vColor.rgb;\n#endif\n#if defined(VERTEXALPHA) || defined(INSTANCESCOLOR) && defined(INSTANCES)\nalpha*=vColor.a;\n#endif\n#if DITHER\nretColor.rgb+=dither(gl_FragCoord.xy,0.5);\n#endif\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\n#include<logDepthFragment>\n#include<fogFragment>\ngl_FragColor=color;\n#include<imageProcessingCompatibility>\n#define CUSTOM_FRAGMENT_MAIN_END\n}\n";t.d.ShadersStore[u]=m;e(11638),e(11577),e(11582),e(11597),e(11591);const D="skyVertexShader",I="precision highp float;attribute vec3 position;\n#ifdef VERTEXCOLOR\nattribute vec4 color;\n#endif\nuniform mat4 world;uniform mat4 view;uniform mat4 viewProjection;\n#ifdef POINTSIZE\nuniform float pointSize;\n#endif\nvarying vec3 vPositionW;\n#ifdef VERTEXCOLOR\nvarying vec4 vColor;\n#endif\n#include<logDepthDeclaration>\n#include<clipPlaneVertexDeclaration>\n#include<fogVertexDeclaration>\n#define CUSTOM_VERTEX_DEFINITIONS\nvoid main(void) {\n#define CUSTOM_VERTEX_MAIN_BEGIN\ngl_Position=viewProjection*world*vec4(position,1.0);vec4 worldPos=world*vec4(position,1.0);vPositionW=vec3(worldPos);\n#include<clipPlaneVertex>\n#include<logDepthVertex>\n#include<fogVertex>\n#ifdef VERTEXCOLOR\nvColor=color;\n#endif\n#if defined(POINTSIZE) && !defined(WEBGPU)\ngl_PointSize=pointSize;\n#endif\n#define CUSTOM_VERTEX_MAIN_END\n}\n";t.d.ShadersStore[D]=I;var x=e(11201),Q=e(11138),G=e(11129);class i extends F.d{constructor(){super(),this.CLIPPLANE=!1,this.CLIPPLANE2=!1,this.CLIPPLANE3=!1,this.CLIPPLANE4=!1,this.CLIPPLANE5=!1,this.CLIPPLANE6=!1,this.POINTSIZE=!1,this.FOG=!1,this.VERTEXCOLOR=!1,this.VERTEXALPHA=!1,this.IMAGEPROCESSINGPOSTPROCESS=!1,this.SKIPFINALCOLORCLAMP=!1,this.DITHER=!1,this.LOGARITHMICDEPTH=!1,this.rebuild()}}class S extends l.c{constructor(K,b){super(K,b),this.luminance=1,this.turbidity=10,this.rayleigh=2,this.mieCoefficient=.005,this.mieDirectionalG=.8,this.distance=500,this.inclination=.49,this.azimuth=.25,this.sunPosition=new T.k(0,100,0),this.useSunPosition=!1,this.cameraOffset=T.k.Zero(),this.up=T.k.Up(),this.dithering=!1,this._cameraPosition=T.k.Zero(),this._skyOrientation=new T.d}needAlphaBlending(){return this.alpha<1}needAlphaTesting(){return!1}getAlphaTestTexture(){return null}isReadyForSubMesh(K,b){const e=b._drawWrapper;if(this.isFrozen&&e.effect&&e._wasPreviouslyReady)return!0;b.materialDefines||(b.materialDefines=new i);const z=b.materialDefines,k=this.va();if(this._isReadyForSubMesh(b))return!0;if((0,G.W)(K,k,this._useLogarithmicDepth,this.pointsCloud,this.fogEnabled,!1,z),(0,G.N)(K,z,!0,!1),z.IMAGEPROCESSINGPOSTPROCESS!==k.imageProcessingConfiguration.applyByPostProcess&&z.markAsMiscDirty(),z.DITHER!==this.dithering&&z.markAsMiscDirty(),z.isDirty){z.markAsProcessed(),k.resetCachedMaterial();const K=new x.c;z.FOG&&K.addFallback(1,"FOG"),z.IMAGEPROCESSINGPOSTPROCESS=k.imageProcessingConfiguration.applyByPostProcess,z.DITHER=this.dithering;const e=[Y.f.PositionKind];z.VERTEXCOLOR&&e.push(Y.f.ColorKind);const j="sky",T=["world","viewProjection","view","vFogInfos","vFogColor","logarithmicDepthConstant","pointSize","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","sunPosition","cameraPosition","cameraOffset","up"];(0,Q.c)(T);const F=z.toString();b.setEffect(k.getEngine().createEffect(j,e,T,[],F,K,this.onCompiled,this.onError),z,this._materialContext)}return!(!b.effect||!b.effect.isReady())&&(z._renderId=k.getRenderId(),e._wasPreviouslyReady=!0,!0)}bindForSubMesh(K,b,e){const z=this.va(),k=e.materialDefines;if(!k)return;const j=e.effect;if(!j)return;this._activeEffect=j,this.bindOnlyWorldMatrix(K),this._activeEffect.setMatrix("viewProjection",z.getTransformMatrix()),this._mustRebind(z,j,e)&&((0,Q.d)(j,this,z),this.pointsCloud&&this._activeEffect.setFloat("pointSize",this.pointSize),this._useLogarithmicDepth&&(0,G.o)(k,j,z)),z.fogEnabled&&b.applyFog&&z.fogMode!==A.e.FOGMODE_NONE&&this._activeEffect.setMatrix("view",z.getViewMatrix()),(0,G.h)(z,b,this._activeEffect);const F=z.activeCamera;if(F){const K=F.getWorldMatrix();this._cameraPosition.x=K.m[12],this._cameraPosition.y=K.m[13],this._cameraPosition.z=K.m[14],this._activeEffect.setVector3("cameraPosition",this._cameraPosition)}if(this._activeEffect.setVector3("cameraOffset",this.cameraOffset),this._activeEffect.setVector3("up",this.up),this.luminance>0&&this._activeEffect.setFloat("luminance",this.luminance),this._activeEffect.setFloat("turbidity",this.turbidity),this._activeEffect.setFloat("rayleigh",this.rayleigh),this._activeEffect.setFloat("mieCoefficient",this.mieCoefficient),this._activeEffect.setFloat("mieDirectionalG",this.mieDirectionalG),!this.useSunPosition){const K=Math.PI*(this.inclination-.5),b=2*Math.PI*(this.azimuth-.5);this.sunPosition.x=this.distance*Math.cos(b)*Math.cos(K),this.sunPosition.y=this.distance*Math.sin(-K),this.sunPosition.z=this.distance*Math.sin(b)*Math.cos(K),T.d.FromUnitVectorsToRef(T.k.UpReadOnly,this.up,this._skyOrientation),this.sunPosition.rotateByQuaternionToRef(this._skyOrientation,this.sunPosition)}this._activeEffect.setVector3("sunPosition",this.sunPosition),this._afterBind(b,this._activeEffect,e)}getAnimatables(){return[]}dispose(K){super.dispose(K)}clone(K){return j.e.Clone((()=>new S(K,this.va())),this)}serialize(){const K=super.serialize();return K.customType="BABYLON.SkyMaterial",K}getClassName(){return"SkyMaterial"}static Parse(K,b,e){return j.e.Parse((()=>new S(K.name,b)),K,b,e)}}(0,z.b)([(0,k.M)()],S.prototype,"luminance",void 0),(0,z.b)([(0,k.M)()],S.prototype,"turbidity",void 0),(0,z.b)([(0,k.M)()],S.prototype,"rayleigh",void 0),(0,z.b)([(0,k.M)()],S.prototype,"mieCoefficient",void 0),(0,z.b)([(0,k.M)()],S.prototype,"mieDirectionalG",void 0),(0,z.b)([(0,k.M)()],S.prototype,"distance",void 0),(0,z.b)([(0,k.M)()],S.prototype,"inclination",void 0),(0,z.b)([(0,k.M)()],S.prototype,"azimuth",void 0),(0,z.b)([(0,k.L)()],S.prototype,"sunPosition",void 0),(0,z.b)([(0,k.M)()],S.prototype,"useSunPosition",void 0),(0,z.b)([(0,k.L)()],S.prototype,"cameraOffset",void 0),(0,z.b)([(0,k.L)()],S.prototype,"up",void 0),(0,z.b)([(0,k.M)()],S.prototype,"dithering",void 0),(0,X.e)("BABYLON.SkyMaterial",S)},10549:(K,b,e)=>{"use strict";function z(K,b){b.headers=K.headers||{},b.statusMessage=K.statusText,b.statusCode=K.status,b.data=K.response}function k(K,b,e){return new Promise((function(k,j){e=e||{};var T,F,l,Y=new XMLHttpRequest,A=e.body,X=e.headers||{};for(T in e.timeout&&(Y.timeout=e.timeout),Y.ontimeout=Y.onerror=function(K){K.timeout="timeout"==K.type,j(K)},Y.open(K,b.href||b),Y.onload=function(){for(l=Y.getAllResponseHeaders().trim().split(/[\r\n]+/),z(Y,Y);F=l.shift();)F=F.split(": "),Y.headers[F.shift().toLowerCase()]=F.join(": ");if((F=Y.headers["content-type"])&&~F.indexOf("application/json"))try{Y.data=JSON.parse(Y.data,e.reviver)}catch(K){return z(Y,K),j(K)}(Y.status>=400?j:k)(Y)},typeof FormData<"u"&&A instanceof FormData||A&&"object"==typeof A&&(X["content-type"]="application/json",A=JSON.stringify(A)),Y.withCredentials=!!e.withCredentials,X)Y.setRequestHeader(T,X[T]);Y.send(A)}))}e.r(b),e.d(b,{del:()=>l,get:()=>j,patch:()=>F,post:()=>T,put:()=>Y,send:()=>k});var j=k.bind(k,"GET"),T=k.bind(k,"POST"),F=k.bind(k,"PATCH"),l=k.bind(k,"DELETE"),Y=k.bind(k,"PUT")},12478:(K,b,e)=>{"use strict";e.d(b,{c:()=>X});const z=.5*(Math.sqrt(3)-1),k=(3-Math.sqrt(3))/6,j=1/3,T=1/6,F=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20,Y=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),A=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);const X=class{constructor(){let K=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Math.random;const b="function"==typeof K?K:function(K){let b=0,e=0,z=0,k=1;const j=function(){let K=4022871197;return function(b){b=b.toString();for(let e=0;e<b.length;e++){K+=b.charCodeAt(e);let z=.02519603282416938*K;K=z>>>0,z-=K,z*=K,K=z>>>0,z-=K,K+=4294967296*z}return 2.3283064365386963e-10*(K>>>0)}}();b=j(" "),e=j(" "),z=j(" "),b-=j(K),b<0&&(b+=1);e-=j(K),e<0&&(e+=1);z-=j(K),z<0&&(z+=1);return function(){const K=2091639*b+2.3283064365386963e-10*k;return b=e,e=z,z=K-(k=0|K)}}(K);this.p=function(K){const b=new Uint8Array(256);for(let e=0;e<256;e++)b[e]=e;for(let e=0;e<255;e++){const z=e+~~(K()*(256-e)),k=b[e];b[e]=b[z],b[z]=k}return b}(b),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}noise2D(K,b){const e=this.permMod12,j=this.perm;let T=0,F=0,l=0;const A=(K+b)*z,X=Math.floor(K+A),t=Math.floor(b+A),U=(X+t)*k,B=K-(X-U),u=b-(t-U);let m,D;B>u?(m=1,D=0):(m=0,D=1);const I=B-m+k,x=u-D+k,Q=B-1+2*k,G=u-1+2*k,i=255&X,S=255&t;let M=.5-B*B-u*u;if(M>=0){const K=3*e[i+j[S]];M*=M,T=M*M*(Y[K]*B+Y[K+1]*u)}let r=.5-I*I-x*x;if(r>=0){const K=3*e[i+m+j[S+D]];r*=r,F=r*r*(Y[K]*I+Y[K+1]*x)}let L=.5-Q*Q-G*G;if(L>=0){const K=3*e[i+1+j[S+1]];L*=L,l=L*L*(Y[K]*Q+Y[K+1]*G)}return 70*(T+F+l)}noise3D(K,b,e){const z=this.permMod12,k=this.perm;let F,l,A,X;const t=(K+b+e)*j,U=Math.floor(K+t),B=Math.floor(b+t),u=Math.floor(e+t),m=(U+B+u)*T,D=K-(U-m),I=b-(B-m),x=e-(u-m);let Q,G,i,S,M,r;D>=I?I>=x?(Q=1,G=0,i=0,S=1,M=1,r=0):D>=x?(Q=1,G=0,i=0,S=1,M=0,r=1):(Q=0,G=0,i=1,S=1,M=0,r=1):I<x?(Q=0,G=0,i=1,S=0,M=1,r=1):D<x?(Q=0,G=1,i=0,S=0,M=1,r=1):(Q=0,G=1,i=0,S=1,M=1,r=0);const L=D-Q+T,c=I-G+T,v=x-i+T,w=D-S+2*T,h=I-M+2*T,R=x-r+2*T,n=D-1+.5,P=I-1+.5,d=x-1+.5,p=255&U,a=255&B,O=255&u;let g=.6-D*D-I*I-x*x;if(g<0)F=0;else{const K=3*z[p+k[a+k[O]]];g*=g,F=g*g*(Y[K]*D+Y[K+1]*I+Y[K+2]*x)}let N=.6-L*L-c*c-v*v;if(N<0)l=0;else{const K=3*z[p+Q+k[a+G+k[O+i]]];N*=N,l=N*N*(Y[K]*L+Y[K+1]*c+Y[K+2]*v)}let Z=.6-w*w-h*h-R*R;if(Z<0)A=0;else{const K=3*z[p+S+k[a+M+k[O+r]]];Z*=Z,A=Z*Z*(Y[K]*w+Y[K+1]*h+Y[K+2]*R)}let y=.6-n*n-P*P-d*d;if(y<0)X=0;else{const K=3*z[p+1+k[a+1+k[O+1]]];y*=y,X=y*y*(Y[K]*n+Y[K+1]*P+Y[K+2]*d)}return 32*(F+l+A+X)}noise4D(K,b,e,z){const k=this.perm;let j,T,Y,X,t;const U=(K+b+e+z)*F,B=Math.floor(K+U),u=Math.floor(b+U),m=Math.floor(e+U),D=Math.floor(z+U),I=(B+u+m+D)*l,x=K-(B-I),Q=b-(u-I),G=e-(m-I),i=z-(D-I);let S=0,M=0,r=0,L=0;x>Q?S++:M++,x>G?S++:r++,x>i?S++:L++,Q>G?M++:r++,Q>i?M++:L++,G>i?r++:L++;const c=S>=3?1:0,v=M>=3?1:0,w=r>=3?1:0,h=L>=3?1:0,R=S>=2?1:0,n=M>=2?1:0,P=r>=2?1:0,d=L>=2?1:0,p=S>=1?1:0,a=M>=1?1:0,O=r>=1?1:0,g=L>=1?1:0,N=x-c+l,Z=Q-v+l,y=G-w+l,s=i-h+l,E=x-R+2*l,o=Q-n+2*l,C=G-P+2*l,H=i-d+2*l,W=x-p+3*l,f=Q-a+3*l,V=G-O+3*l,q=i-g+3*l,J=x-1+4*l,KK=Q-1+4*l,bK=G-1+4*l,eK=i-1+4*l,zK=255&B,kK=255&u,jK=255&m,TK=255&D;let FK=.6-x*x-Q*Q-G*G-i*i;if(FK<0)j=0;else{const K=k[zK+k[kK+k[jK+k[TK]]]]%32*4;FK*=FK,j=FK*FK*(A[K]*x+A[K+1]*Q+A[K+2]*G+A[K+3]*i)}let lK=.6-N*N-Z*Z-y*y-s*s;if(lK<0)T=0;else{const K=k[zK+c+k[kK+v+k[jK+w+k[TK+h]]]]%32*4;lK*=lK,T=lK*lK*(A[K]*N+A[K+1]*Z+A[K+2]*y+A[K+3]*s)}let YK=.6-E*E-o*o-C*C-H*H;if(YK<0)Y=0;else{const K=k[zK+R+k[kK+n+k[jK+P+k[TK+d]]]]%32*4;YK*=YK,Y=YK*YK*(A[K]*E+A[K+1]*o+A[K+2]*C+A[K+3]*H)}let AK=.6-W*W-f*f-V*V-q*q;if(AK<0)X=0;else{const K=k[zK+p+k[kK+a+k[jK+O+k[TK+g]]]]%32*4;AK*=AK,X=AK*AK*(A[K]*W+A[K+1]*f+A[K+2]*V+A[K+3]*q)}let XK=.6-J*J-KK*KK-bK*bK-eK*eK;if(XK<0)t=0;else{const K=k[zK+1+k[kK+1+k[jK+1+k[TK+1]]]]%32*4;XK*=XK,t=XK*XK*(A[K]*J+A[K+1]*KK+A[K+2]*bK+A[K+3]*eK)}return 27*(j+T+Y+X+t)}}}}]);