"use strict";(self.webpackChunkbloxd=self.webpackChunkbloxd||[]).push([[9],{2181:(B,o,e)=>{e.r(o),e.d(o,{Dispose:()=>w,DumpData:()=>K,DumpDataAsync:()=>O,DumpFramebuffer:()=>h,DumpTools:()=>u});var k=e(2072),d=e(499),f=e(701),J=e(539);let Z,t=null;async function h(B,o,e,k){let d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",f=arguments.length>5?arguments[5]:void 0,J=arguments.length>6?arguments[6]:void 0;const Z=await e.readPixels(0,0,B,o);K(B,o,new Uint8Array(Z.buffer),k,d,f,!0,void 0,J)}function O(B,o,e){let k=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"image/png",d=arguments.length>4?arguments[4]:void 0,f=arguments.length>5&&void 0!==arguments[5]&&arguments[5],J=arguments.length>6&&void 0!==arguments[6]&&arguments[6],Z=arguments.length>7?arguments[7]:void 0;return new Promise((t=>{K(B,o,e,(B=>t(B)),k,d,f,J,Z)}))}function K(B,o,h,O){let K=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"image/png",u=arguments.length>5?arguments[5]:void 0,L=arguments.length>6&&void 0!==arguments[6]&&arguments[6],H=arguments.length>7&&void 0!==arguments[7]&&arguments[7],n=arguments.length>8?arguments[8]:void 0;(async function(){return t||(t=new Promise(((B,o)=>{let d,f=null;const t={Mk:!0,depth:!1,stencil:!1,alpha:!0,premultipliedAlpha:!1,antialias:!1,failIfMajorPerformanceCaveat:!1};e.e(22).then(e.bind(e,11931)).then((h=>{let{ThinEngine:O}=h;try{d=new OffscreenCanvas(100,100),f=new O(d,!1,t)}catch(u){d=document.createElement("canvas"),f=new O(d,!1,t)}J.c.Instances.pop(),J.c.OnEnginesDisposedObservable.add((B=>{f&&B!==f&&!f.u&&0===J.c.Instances.length&&w()})),f.getCaps().parallelShaderCompile=void 0;const K=new k.d(f);e.e(33).then(e.bind(e,12855)).then((e=>{let{passPixelShader:J}=e;if(!f)return void o("Engine is not defined");const t=new k.g({Fi:f,name:J.name,fragmentShader:J.shader,samplerNames:["textureSampler"]});Z={canvas:d,Fi:f,renderer:K,wrapper:t},B(Z)}))})).catch(o)}))),await t})().then((e=>{if(e.Fi.setSize(B,o,!0),h instanceof Float32Array){const B=new Uint8Array(h.length);let o=h.length;for(;o--;){const e=h[o];B[o]=Math.round(255*(0,f.b)(e))}h=B}const k=e.Fi.createRawTexture(h,B,o,5,!1,!L,1);e.renderer.setViewport(),e.renderer.applyEffectWrapper(e.wrapper),e.wrapper.effect._bindTexture("textureSampler",k),e.renderer.draw(),H?d.d.ToBlob(e.canvas,(B=>{const o=new FileReader;o.onload=B=>{const o=B.target.result;O&&O(o)},o.readAsArrayBuffer(B)}),K,n):d.d.EncodeScreenshotCanvasData(e.canvas,O,K,u,n),k.dispose()}))}function w(){var B;Z?(Z.wrapper.dispose(),Z.renderer.dispose(),Z.Fi.dispose()):null===(B=t)||void 0===B||B.then((B=>{B.wrapper.dispose(),B.renderer.dispose(),B.Fi.dispose()}));t=null,Z=null}const u={DumpData:K,DumpDataAsync:O,DumpFramebuffer:h,Dispose:w};d.d.DumpData=K,d.d.DumpDataAsync=O,d.d.DumpFramebuffer=h}}]);